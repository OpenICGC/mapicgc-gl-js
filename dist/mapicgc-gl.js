(function(Ja,Ra){typeof exports=="object"&&typeof module<"u"?Ra(exports):typeof define=="function"&&define.amd?define(["exports"],Ra):(Ja=typeof globalThis<"u"?globalThis:Ja||self,Ra(Ja.mapicgcgl={}))})(this,function(Ja){"use strict";var G0e=Object.defineProperty;var q0e=(Ja,Ra,Ch)=>Ra in Ja?G0e(Ja,Ra,{enumerable:!0,configurable:!0,writable:!0,value:Ch}):Ja[Ra]=Ch;var Y=(Ja,Ra,Ch)=>q0e(Ja,typeof Ra!="symbol"?Ra+"":Ra,Ch);var pd,lz,Q3,oo;function Ra(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ch={exports:{}},J7=Ch.exports,PS;function eH(){return PS||(PS=1,function(r,e){(function(t,n){r.exports=n()})(J7,function(){var t={},n={};function i(a,o,u){if(n[a]=u,a==="index"){var d="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",p={};return n.shared(p),n.index(t,p),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([d],{type:"text/javascript"}))),t}}i("shared",["exports"],function(a){function o(f,c,A,g){return new(A||(A=Promise))(function(b,B){function T(k){try{L(g.next(k))}catch(j){B(j)}}function I(k){try{L(g.throw(k))}catch(j){B(j)}}function L(k){var j;k.done?b(k.value):(j=k.value,j instanceof A?j:new A(function(G){G(j)})).then(T,I)}L((g=g.apply(f,c||[])).next())})}function u(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var d,p;function _(){if(p)return d;function f(c,A){this.x=c,this.y=A}return p=1,d=f,f.prototype={clone:function(){return new f(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,A){return this.clone()._rotateAround(c,A)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var A=c.x-this.x,g=c.y-this.y;return A*A+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,A){return Math.atan2(this.x*A-this.y*c,this.x*c+this.y*A)},_matMult:function(c){var A=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=A,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var A=Math.cos(c),g=Math.sin(c),b=g*this.x+A*this.y;return this.x=A*this.x-g*this.y,this.y=b,this},_rotateAround:function(c,A){var g=Math.cos(c),b=Math.sin(c),B=A.y+b*(this.x-A.x)+g*(this.y-A.y);return this.x=A.x+g*(this.x-A.x)-b*(this.y-A.y),this.y=B,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},f.convert=function(c){return c instanceof f?c:Array.isArray(c)?new f(c[0],c[1]):c},d}typeof SuppressedError=="function"&&SuppressedError;var w,v,M=u(_()),P=function(){if(v)return w;function f(c,A,g,b){this.cx=3*c,this.bx=3*(g-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*A,this.by=3*(b-A)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=A,this.p2x=g,this.p2y=b}return v=1,w=f,f.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,A){if(A===void 0&&(A=1e-6),c<0)return 0;if(c>1)return 1;for(var g=c,b=0;b<8;b++){var B=this.sampleCurveX(g)-c;if(Math.abs(B)<A)return g;var T=this.sampleCurveDerivativeX(g);if(Math.abs(T)<1e-6)break;g-=B/T}var I=0,L=1;for(g=c,b=0;b<20&&(B=this.sampleCurveX(g),!(Math.abs(B-c)<A));b++)c>B?I=g:L=g,g=.5*(L-I)+I;return g},solve:function(c,A){return this.sampleCurveY(this.solveCurveX(c,A))}},w}(),D=u(P);let N,z;function W(){return N==null&&(N=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),N}function V(){if(z==null&&(z=!1,W())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let g=0;g<5*5;g++){const b=4*g;c.fillStyle=`rgb(${b},${b+1},${b+2})`,c.fillRect(g%5,Math.floor(g/5),1,1)}const A=c.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&A[g]!==g){z=!0;break}}}return z||!1}var $,q=1e-6,te=typeof Float32Array<"u"?Float32Array:Array;function J(){var f=new te(9);return te!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f}function me(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function xe(){var f=new te(3);return te!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f}function se(f,c,A){var g=new te(3);return g[0]=f,g[1]=c,g[2]=A,g}function oe(f,c,A){var g=c[0],b=c[1],B=c[2],T=c[3];return f[0]=A[0]*g+A[4]*b+A[8]*B+A[12]*T,f[1]=A[1]*g+A[5]*b+A[9]*B+A[13]*T,f[2]=A[2]*g+A[6]*b+A[10]*B+A[14]*T,f[3]=A[3]*g+A[7]*b+A[11]*B+A[15]*T,f}function ve(){var f=new te(4);return te!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f[3]=1,f}function ge(){var f=new te(2);return te!=Float32Array&&(f[0]=0,f[1]=0),f}function Je(f,c){var A=new te(2);return A[0]=f,A[1]=c,A}Math.hypot||(Math.hypot=function(){for(var f=0,c=arguments.length;c--;)f+=arguments[c]*arguments[c];return Math.sqrt(f)}),xe(),$=new te(4),te!=Float32Array&&($[0]=0,$[1]=0,$[2]=0,$[3]=0),xe(),se(1,0,0),se(0,1,0),ve(),ve(),J(),ge();const Ge=8192;function et(f,c,A){return c*(Ge/(f.tileSize*Math.pow(2,A-f.tileID.overscaledZ)))}function Ye(f,c){return(f%c+c)%c}function ct(f,c,A){return f*(1-A)+c*A}function At(f){if(f<=0)return 0;if(f>=1)return 1;const c=f*f,A=c*f;return 4*(f<.5?A:3*(f-c)+A-.75)}function kt(f,c,A,g){const b=new D(f,c,A,g);return B=>b.solve(B)}const ae=kt(.25,.1,.25,1);function Te(f,c,A){return Math.min(A,Math.max(c,f))}function Le(f,c,A){const g=A-c,b=((f-c)%g+g)%g+c;return b===c?A:b}function De(f){for(var c=arguments.length,A=new Array(c>1?c-1:0),g=1;g<c;g++)A[g-1]=arguments[g];for(const b of A)for(const B in b)f[B]=b[B];return f}let at=1;function rt(f,c,A){const g={};for(const b in f)g[b]=c.call(this,f[b],b,f);return g}function xt(f,c,A){const g={};for(const b in f)c.call(this,f[b],b,f)&&(g[b]=f[b]);return g}function vt(f){return Array.isArray(f)?f.map(vt):typeof f=="object"&&f?rt(f,vt):f}const nr={};function qt(f){nr[f]||(typeof console<"u"&&console.warn(f),nr[f]=!0)}function or(f,c,A){return(A.y-f.y)*(c.x-f.x)>(c.y-f.y)*(A.x-f.x)}function gr(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let wr=null;function Ot(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}const ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function $r(f,c,A,g,b){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const B=new VideoFrame(f,{timestamp:0});try{const T=B==null?void 0:B.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const I=T.startsWith("BGR"),L=new Uint8ClampedArray(g*b*4);if(yield B.copyTo(L,function(k,j,G,re,ie){const le=4*Math.max(1,0),fe=(Math.max(0,G)-G)*re*4+le,Se=4*re,Ie=Math.max(0,j),st=Math.max(0,G);return{rect:{x:Ie,y:st,width:Math.min(k.width,j+re)-Ie,height:Math.min(k.height,G+ie)-st},layout:[{offset:fe,stride:Se}]}}(f,c,A,g,b)),I)for(let k=0;k<L.length;k+=4){const j=L[k];L[k]=L[k+2],L[k+2]=j}return L}finally{B.close()}})}let Rr,Jt;function tr(f){return f/Math.PI*180}const mr="AbortError";function _r(){return new Error(mr)}const Ut={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ar(f){return Ut.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}const Sr="global-dispatcher";class Er extends Error{constructor(c,A,g,b){super(`AJAXError: ${A} (${c}): ${g}`),this.status=c,this.statusText=A,this.url=g,this.body=b}}const Dr=()=>gr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,nn=function(f,c){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){const g=ar(f.url);if(g)return g(f,c);if(gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,targetMapId:Sr},c)}if(!(/^file:/.test(A=f.url)||/^file:/.test(Dr())&&!/^\w+:/.test(A))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,b){return o(this,void 0,void 0,function*(){const B=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:Dr(),signal:b.signal});let T,I;g.type!=="json"||B.headers.has("Accept")||B.headers.set("Accept","application/json");try{T=yield fetch(B)}catch(k){throw new Er(0,k.message,g.url,new Blob)}if(!T.ok){const k=yield T.blob();throw new Er(T.status,T.statusText,g.url,k)}I=g.type==="arrayBuffer"||g.type==="image"?T.arrayBuffer():g.type==="json"?T.json():T.text();const L=yield I;if(b.signal.aborted)throw _r();return{data:L,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(f,c);if(gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,mustQueue:!0,targetMapId:Sr},c)}var A;return function(g,b){return new Promise((B,T)=>{var I;const L=new XMLHttpRequest;L.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(L.responseType="arraybuffer");for(const k in g.headers)L.setRequestHeader(k,g.headers[k]);g.type==="json"&&(L.responseType="text",!((I=g.headers)===null||I===void 0)&&I.Accept||L.setRequestHeader("Accept","application/json")),L.withCredentials=g.credentials==="include",L.onerror=()=>{T(new Error(L.statusText))},L.onload=()=>{if(!b.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let k=L.response;if(g.type==="json")try{k=JSON.parse(L.response)}catch(j){return void T(j)}B({data:k,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const k=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});T(new Er(L.status,L.statusText,g.url,k))}},b.signal.addEventListener("abort",()=>{L.abort(),T(_r())}),L.send(g.body)})}(f,c)};function Hr(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;const c=new URL(f),A=window.location;return c.protocol===A.protocol&&c.host===A.host}function Wr(f,c,A){A[f]&&A[f].indexOf(c)!==-1||(A[f]=A[f]||[],A[f].push(c))}function vr(f,c,A){if(A&&A[f]){const g=A[f].indexOf(c);g!==-1&&A[f].splice(g,1)}}class Qn{constructor(c){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};De(this,A),this.type=c}}class un extends Qn{constructor(c){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",De({error:c},A))}}class ni{on(c,A){return this._listeners=this._listeners||{},Wr(c,A,this._listeners),{unsubscribe:()=>{this.off(c,A)}}}off(c,A){return vr(c,A,this._listeners),vr(c,A,this._oneTimeListeners),this}once(c,A){return A?(this._oneTimeListeners=this._oneTimeListeners||{},Wr(c,A,this._oneTimeListeners),this):new Promise(g=>this.once(c,g))}fire(c,A){typeof c=="string"&&(c=new Qn(c,A||{}));const g=c.type;if(this.listens(g)){c.target=this;const b=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const I of b)I.call(this,c);const B=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const I of B)vr(g,I,this._oneTimeListeners),I.call(this,c);const T=this._eventedParent;T&&(De(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(c))}else c instanceof un&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,A){return this._eventedParent=c,this._eventedParentData=A,this}}var Be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ce=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function de(f,c){const A={};for(const g in f)g!=="ref"&&(A[g]=f[g]);return ce.forEach(g=>{g in c&&(A[g]=c[g])}),A}function _e(f,c){if(Array.isArray(f)){if(!Array.isArray(c)||f.length!==c.length)return!1;for(let A=0;A<f.length;A++)if(!_e(f[A],c[A]))return!1;return!0}if(typeof f=="object"&&f!==null&&c!==null){if(typeof c!="object"||Object.keys(f).length!==Object.keys(c).length)return!1;for(const A in f)if(!_e(f[A],c[A]))return!1;return!0}return f===c}function Ue(f,c){f.push(c)}function je(f,c,A){Ue(A,{command:"addSource",args:[f,c[f]]})}function lt(f,c,A){Ue(c,{command:"removeSource",args:[f]}),A[f]=!0}function dt(f,c,A,g){lt(f,A,g),je(f,c,A)}function Ze(f,c,A){let g;for(g in f[A])if(Object.prototype.hasOwnProperty.call(f[A],g)&&g!=="data"&&!_e(f[A][g],c[A][g]))return!1;for(g in c[A])if(Object.prototype.hasOwnProperty.call(c[A],g)&&g!=="data"&&!_e(f[A][g],c[A][g]))return!1;return!0}function ht(f,c,A,g,b,B){f=f||{},c=c||{};for(const T in f)Object.prototype.hasOwnProperty.call(f,T)&&(_e(f[T],c[T])||A.push({command:B,args:[g,T,c[T],b]}));for(const T in c)Object.prototype.hasOwnProperty.call(c,T)&&!Object.prototype.hasOwnProperty.call(f,T)&&(_e(f[T],c[T])||A.push({command:B,args:[g,T,c[T],b]}))}function bt(f){return f.id}function pt(f,c){return f[c.id]=c,f}class We{constructor(c,A,g,b){this.message=(c?`${c}: `:"")+g,b&&(this.identifier=b),A!=null&&A.__line__&&(this.line=A.__line__)}}function hr(f){for(var c=arguments.length,A=new Array(c>1?c-1:0),g=1;g<c;g++)A[g-1]=arguments[g];for(const b of A)for(const B in b)f[B]=b[B];return f}class sr extends Error{constructor(c,A){super(A),this.message=A,this.key=c}}class rr{constructor(c){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=c,this.bindings={};for(const[g,b]of A)this.bindings[g]=b}concat(c){return new rr(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const Nr={kind:"null"},Rt={kind:"number"},ir={kind:"string"},br={kind:"boolean"},kr={kind:"color"},en={kind:"projectionDefinition"},jr={kind:"object"},Br={kind:"value"},Sn={kind:"collator"},Ti={kind:"formatted"},Bn={kind:"padding"},zn={kind:"resolvedImage"},Cn={kind:"variableAnchorOffsetCollection"};function yi(f,c){return{kind:"array",itemType:f,N:c}}function Un(f){if(f.kind==="array"){const c=Un(f.itemType);return typeof f.N=="number"?`array<${c}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${c}>`}return f.kind}const ba=[Nr,Rt,ir,br,kr,en,Ti,jr,yi(Br),Bn,zn,Cn];function Ke(f,c){if(c.kind==="error")return null;if(f.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Ke(f.itemType,c.itemType))&&(typeof f.N!="number"||f.N===c.N))return null}else{if(f.kind===c.kind)return null;if(f.kind==="value"){for(const A of ba)if(!Ke(A,c))return null}}return`Expected ${Un(f)} but found ${Un(c)} instead.`}function Pr(f,c){return c.some(A=>A.kind===f.kind)}function cr(f,c){return c.some(A=>A==="null"?f===null:A==="array"?Array.isArray(f):A==="object"?f&&!Array.isArray(f)&&typeof f=="object":A===typeof f)}function pn(f,c){return f.kind==="array"&&c.kind==="array"?f.itemType.kind===c.itemType.kind&&typeof f.N=="number":f.kind===c.kind}const di=.96422,As=.82521,li=4/29,xs=6/29,vo=3*xs*xs,ss=xs*xs*xs,oh=Math.PI/180,ef=180/Math.PI;function tf(f){return(f%=360)<0&&(f+=360),f}function lc(f){let[c,A,g,b]=f,B,T;const I=Di((.2225045*(c=Ml(c))+.7168786*(A=Ml(A))+.0606169*(g=Ml(g)))/1);c===A&&A===g?B=T=I:(B=Di((.4360747*c+.3850649*A+.1430804*g)/di),T=Di((.0139322*c+.0971045*A+.7141733*g)/As));const L=116*I-16;return[L<0?0:L,500*(B-I),200*(I-T),b]}function Ml(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function Di(f){return f>ss?Math.pow(f,1/3):f/vo+li}function $h(f){let[c,A,g,b]=f,B=(c+16)/116,T=isNaN(A)?B:B+A/500,I=isNaN(g)?B:B-g/200;return B=1*ah(B),T=di*ah(T),I=As*ah(I),[ll(3.1338561*T-1.6168667*B-.4906146*I),ll(-.9787684*T+1.9161415*B+.033454*I),ll(.0719453*T-.2289914*B+1.4052427*I),b]}function ll(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function ah(f){return f>xs?f*f*f:vo*(f-li)}function cc(f){return parseInt(f.padEnd(2,f),16)/255}function rf(f,c){return Vs(c?f/100:f,0,1)}function Vs(f,c,A){return Math.min(Math.max(c,f),A)}function uc(f){return!f.some(Number.isNaN)}const Ni={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function an(f,c,A){return f+A*(c-f)}function Yo(f,c,A){return f.map((g,b)=>an(g,c[b],A))}class dn{constructor(c,A,g){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=c,this.g=A,this.b=g,this.a=b,B||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[c,A,g,b]))}static parse(c){if(c instanceof dn)return c;if(typeof c!="string")return;const A=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=Ni[g];if(b){const[T,I,L]=b;return[T/255,I/255,L/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){const T=g.length<6?1:2;let I=1;return[cc(g.slice(I,I+=T)),cc(g.slice(I,I+=T)),cc(g.slice(I,I+=T)),cc(g.slice(I,I+T)||"ff")]}if(g.startsWith("rgb")){const T=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[I,L,k,j,G,re,ie,le,fe,Se,Ie,st]=T,Qe=[j||" ",ie||" ",Se].join("");if(Qe==="  "||Qe==="  /"||Qe===",,"||Qe===",,,"){const ne=[k,re,fe].join(""),Ce=ne==="%%%"?100:ne===""?255:0;if(Ce){const He=[Vs(+L/Ce,0,1),Vs(+G/Ce,0,1),Vs(+le/Ce,0,1),Ie?rf(+Ie,st):1];if(uc(He))return He}}return}}const B=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(B){const[T,I,L,k,j,G,re,ie,le]=B,fe=[L||" ",j||" ",re].join("");if(fe==="  "||fe==="  /"||fe===",,"||fe===",,,"){const Se=[+I,Vs(+k,0,100),Vs(+G,0,100),ie?rf(+ie,le):1];if(uc(Se))return function(Ie){let[st,Qe,ne,Ce]=Ie;function He(Tt){const Wt=(Tt+st/30)%12,Ft=Qe*Math.min(ne,1-ne);return ne-Ft*Math.max(-1,Math.min(Wt-3,9-Wt,1))}return st=tf(st),Qe/=100,ne/=100,[He(0),He(8),He(4),Ce]}(Se)}}}(c);return A?new dn(...A,!1):void 0}get rgb(){const{r:c,g:A,b:g,a:b}=this,B=b||1/0;return this.overwriteGetter("rgb",[c/B,A/B,g/B,b])}get hcl(){return this.overwriteGetter("hcl",function(c){const[A,g,b,B]=lc(c),T=Math.sqrt(g*g+b*b);return[Math.round(1e4*T)?tf(Math.atan2(b,g)*ef):NaN,T,A,B]}(this.rgb))}get lab(){return this.overwriteGetter("lab",lc(this.rgb))}overwriteGetter(c,A){return Object.defineProperty(this,c,{value:A}),A}toString(){const[c,A,g,b]=this.rgb;return`rgba(${[c,A,g].map(B=>Math.round(255*B)).join(",")},${b})`}static interpolate(c,A,g){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[B,T,I,L]=Yo(c.rgb,A.rgb,g);return new dn(B,T,I,L,!1)}case"hcl":{const[B,T,I,L]=c.hcl,[k,j,G,re]=A.hcl;let ie,le;if(isNaN(B)||isNaN(k))isNaN(B)?isNaN(k)?ie=NaN:(ie=k,I!==1&&I!==0||(le=j)):(ie=B,G!==1&&G!==0||(le=T));else{let Qe=k-B;k>B&&Qe>180?Qe-=360:k<B&&B-k>180&&(Qe+=360),ie=B+g*Qe}const[fe,Se,Ie,st]=function(Qe){let[ne,Ce,He,Tt]=Qe;return ne=isNaN(ne)?0:ne*oh,$h([He,Math.cos(ne)*Ce,Math.sin(ne)*Ce,Tt])}([ie,le??an(T,j,g),an(I,G,g),an(L,re,g)]);return new dn(fe,Se,Ie,st,!1)}case"lab":{const[B,T,I,L]=$h(Yo(c.lab,A.lab,g));return new dn(B,T,I,L,!1)}}}}dn.black=new dn(0,0,0,1),dn.white=new dn(1,1,1,1),dn.transparent=new dn(0,0,0,0),dn.red=new dn(1,0,0,1);class hu{constructor(c,A,g){this.sensitivity=c?A?"variant":"case":A?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,A){return this.collator.compare(c,A)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const nf=["bottom","center","top"];class hc{constructor(c,A,g,b,B,T){this.text=c,this.image=A,this.scale=g,this.fontStack=b,this.textColor=B,this.verticalAlign=T}}class Ei{constructor(c){this.sections=c}static fromString(c){return new Ei([new hc(c,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof Ei?c:Ei.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class ki{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof ki)return c;if(typeof c=="number")return new ki([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const A of c)if(typeof A!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new ki(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,A,g){return new ki(Yo(c.values,A.values,g))}}class pi{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const Gh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Bs{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Bs)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let A=0;A<c.length;A+=2){const g=c[A],b=c[A+1];if(typeof g!="string"||!Gh.has(g)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new Bs(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,A,g){const b=c.values,B=A.values;if(b.length!==B.length)throw new pi(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${A.toString()}`);const T=[];for(let I=0;I<b.length;I+=2){if(b[I]!==B[I])throw new pi(`Cannot interpolate values containing mismatched anchors. from[${I}]: ${b[I]}, to[${I}]: ${B[I]}`);T.push(b[I]);const[L,k]=b[I+1],[j,G]=B[I+1];T.push([an(L,j,g),an(k,G,g)])}return new Bs(T)}}class Si{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new Si({name:c,available:!1}):null}}class Wi{constructor(c,A,g){this.from=c,this.to=A,this.transition=g}static interpolate(c,A,g){return new Wi(c,A,g)}static parse(c){return c instanceof Wi?c:Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"?new Wi(c[0],c[1],c[2]):typeof c=="object"&&typeof c.from=="string"&&typeof c.to=="string"&&typeof c.transition=="number"?new Wi(c.from,c.to,c.transition):typeof c=="string"?new Wi(c,c,1):void 0}}function Ac(f,c,A,g){return typeof f=="number"&&f>=0&&f<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof A=="number"&&A>=0&&A<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[f,c,A,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[f,c,A,g]:[f,c,A]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cl(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof Wi||f instanceof dn||f instanceof hu||f instanceof Ei||f instanceof ki||f instanceof Bs||f instanceof Si)return!0;if(Array.isArray(f)){for(const c of f)if(!cl(c))return!1;return!0}if(typeof f=="object"){for(const c in f)if(!cl(f[c]))return!1;return!0}return!1}function _n(f){if(f===null)return Nr;if(typeof f=="string")return ir;if(typeof f=="boolean")return br;if(typeof f=="number")return Rt;if(f instanceof dn)return kr;if(f instanceof Wi)return en;if(f instanceof hu)return Sn;if(f instanceof Ei)return Ti;if(f instanceof ki)return Bn;if(f instanceof Bs)return Cn;if(f instanceof Si)return zn;if(Array.isArray(f)){const c=f.length;let A;for(const g of f){const b=_n(g);if(A){if(A===b)continue;A=Br;break}A=b}return yi(A||Br,c)}return jr}function Au(f){const c=typeof f;return f===null?"":c==="string"||c==="number"||c==="boolean"?String(f):f instanceof dn||f instanceof Wi||f instanceof Ei||f instanceof ki||f instanceof Bs||f instanceof Si?f.toString():JSON.stringify(f)}class Zo{constructor(c,A){this.type=c,this.value=A}static parse(c,A){if(c.length!==2)return A.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!cl(c[1]))return A.error("invalid value");const g=c[1];let b=_n(g);const B=A.expectedType;return b.kind!=="array"||b.N!==0||!B||B.kind!=="array"||typeof B.N=="number"&&B.N!==0||(b=B),new Zo(b,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const tn={string:ir,number:Rt,boolean:br,object:jr};class Do{constructor(c,A){this.type=c,this.args=A}static parse(c,A){if(c.length<2)return A.error("Expected at least one argument.");let g,b=1;const B=c[0];if(B==="array"){let I,L;if(c.length>2){const k=c[1];if(typeof k!="string"||!(k in tn)||k==="object")return A.error('The item type argument of "array" must be one of string, number, boolean',1);I=tn[k],b++}else I=Br;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return A.error('The length argument to "array" must be a positive integer literal',2);L=c[2],b++}g=yi(I,L)}else{if(!tn[B])throw new Error(`Types doesn't contain name = ${B}`);g=tn[B]}const T=[];for(;b<c.length;b++){const I=A.parse(c[b],b,Br);if(!I)return null;T.push(I)}return new Do(g,T)}evaluate(c){for(let A=0;A<this.args.length;A++){const g=this.args[A].evaluate(c);if(!Ke(this.type,_n(g)))return g;if(A===this.args.length-1)throw new pi(`Expected value to be of type ${Un(this.type)}, but found ${Un(_n(g))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const qh={"to-boolean":br,"to-color":kr,"to-number":Rt,"to-string":ir};class Cs{constructor(c,A){this.type=c,this.args=A}static parse(c,A){if(c.length<2)return A.error("Expected at least one argument.");const g=c[0];if(!qh[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&c.length!==2)return A.error("Expected one argument.");const b=qh[g],B=[];for(let T=1;T<c.length;T++){const I=A.parse(c[T],T,Br);if(!I)return null;B.push(I)}return new Cs(b,B)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let A,g;for(const b of this.args){if(A=b.evaluate(c),g=null,A instanceof dn)return A;if(typeof A=="string"){const B=c.parseColor(A);if(B)return B}else if(Array.isArray(A)&&(g=A.length<3||A.length>4?`Invalid rgba value ${JSON.stringify(A)}: expected an array containing either three or four numeric values.`:Ac(A[0],A[1],A[2],A[3]),!g))return new dn(A[0]/255,A[1]/255,A[2]/255,A[3])}throw new pi(g||`Could not parse color from value '${typeof A=="string"?A:JSON.stringify(A)}'`)}case"padding":{let A;for(const g of this.args){A=g.evaluate(c);const b=ki.parse(A);if(b)return b}throw new pi(`Could not parse padding from value '${typeof A=="string"?A:JSON.stringify(A)}'`)}case"variableAnchorOffsetCollection":{let A;for(const g of this.args){A=g.evaluate(c);const b=Bs.parse(A);if(b)return b}throw new pi(`Could not parse variableAnchorOffsetCollection from value '${typeof A=="string"?A:JSON.stringify(A)}'`)}case"number":{let A=null;for(const g of this.args){if(A=g.evaluate(c),A===null)return 0;const b=Number(A);if(!isNaN(b))return b}throw new pi(`Could not convert ${JSON.stringify(A)} to number.`)}case"formatted":return Ei.fromString(Au(this.args[0].evaluate(c)));case"resolvedImage":return Si.fromString(Au(this.args[0].evaluate(c)));case"projectionDefinition":return this.args[0].evaluate(c);default:return Au(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const fu=["Unknown","Point","LineString","Polygon"];class Zn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let A=this._parseColorCache[c];return A||(A=this._parseColorCache[c]=dn.parse(c)),A}}class Qa{constructor(c,A){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],b=arguments.length>3?arguments[3]:void 0,B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new rr,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=c,this.path=g,this.key=g.map(I=>`[${I}]`).join(""),this.scope=B,this.errors=T,this.expectedType=b,this._isConstant=A}parse(c,A,g,b){let B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return A?this.concat(A,g,b)._parse(c,B):this._parse(c,B)}_parse(c,A){function g(b,B,T){return T==="assert"?new Do(B,[b]):T==="coerce"?new Cs(B,[b]):b}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=c[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const B=this.registry[b];if(B){let T=B.parse(c,this);if(!T)return null;if(this.expectedType){const I=this.expectedType,L=T.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||L.kind!=="value")if(I.kind!=="projectionDefinition"||L.kind!=="string"&&L.kind!=="array")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string")if(I.kind!=="padding"||L.kind!=="value"&&L.kind!=="number"&&L.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||L.kind!=="value"&&L.kind!=="array"){if(this.checkSubtype(I,L))return null}else T=g(T,I,A.typeAnnotation||"coerce");else T=g(T,I,A.typeAnnotation||"coerce");else T=g(T,I,A.typeAnnotation||"coerce");else T=g(T,I,A.typeAnnotation||"coerce");else T=g(T,I,A.typeAnnotation||"assert")}if(!(T instanceof Zo)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const I=new Zn;try{T=new Zo(T.type,T.evaluate(I))}catch(L){return this.error(L.message),null}}return T}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,A,g){const b=typeof c=="number"?this.path.concat(c):this.path,B=g?this.scope.concat(g):this.scope;return new Qa(this.registry,this._isConstant,b,A||null,B,this.errors)}error(c){for(var A=arguments.length,g=new Array(A>1?A-1:0),b=1;b<A;b++)g[b-1]=arguments[b];const B=`${this.key}${g.map(T=>`[${T}]`).join("")}`;this.errors.push(new sr(B,c))}checkSubtype(c,A){const g=Ke(c,A);return g&&this.error(g),g}}class yn{constructor(c,A){this.type=A.type,this.bindings=[].concat(c),this.result=A}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const A of this.bindings)c(A[1]);c(this.result)}static parse(c,A){if(c.length<4)return A.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const g=[];for(let B=1;B<c.length-1;B+=2){const T=c[B];if(typeof T!="string")return A.error(`Expected string, but found ${typeof T} instead.`,B);if(/[^a-zA-Z0-9_]/.test(T))return A.error("Variable names must contain only alphanumeric characters or '_'.",B);const I=A.parse(c[B+1],B+1);if(!I)return null;g.push([T,I])}const b=A.parse(c[c.length-1],c.length-1,A.expectedType,g);return b?new yn(g,b):null}outputDefined(){return this.result.outputDefined()}}class on{constructor(c,A){this.type=A.type,this.name=c,this.boundExpression=A}static parse(c,A){if(c.length!==2||typeof c[1]!="string")return A.error("'var' expression requires exactly one string literal argument.");const g=c[1];return A.scope.has(g)?new on(g,A.scope.get(g)):A.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class du{constructor(c,A,g){this.type=c,this.index=A,this.input=g}static parse(c,A){if(c.length!==3)return A.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const g=A.parse(c[1],1,Rt),b=A.parse(c[2],2,yi(A.expectedType||Br));return g&&b?new du(b.type.itemType,g,b):null}evaluate(c){const A=this.index.evaluate(c),g=this.input.evaluate(c);if(A<0)throw new pi(`Array index out of bounds: ${A} < 0.`);if(A>=g.length)throw new pi(`Array index out of bounds: ${A} > ${g.length-1}.`);if(A!==Math.floor(A))throw new pi(`Array index must be an integer, but found ${A} instead.`);return g[A]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class En{constructor(c,A){this.type=br,this.needle=c,this.haystack=A}static parse(c,A){if(c.length!==3)return A.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const g=A.parse(c[1],1,Br),b=A.parse(c[2],2,Br);return g&&b?Pr(g.type,[br,ir,Rt,Nr,Br])?new En(g,b):A.error(`Expected first argument to be of type boolean, string, number or null, but found ${Un(g.type)} instead`):null}evaluate(c){const A=this.needle.evaluate(c),g=this.haystack.evaluate(c);if(!g)return!1;if(!cr(A,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${Un(_n(A))} instead.`);if(!cr(g,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${Un(_n(g))} instead.`);return g.indexOf(A)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class ul{constructor(c,A,g){this.type=Rt,this.needle=c,this.haystack=A,this.fromIndex=g}static parse(c,A){if(c.length<=2||c.length>=5)return A.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const g=A.parse(c[1],1,Br),b=A.parse(c[2],2,Br);if(!g||!b)return null;if(!Pr(g.type,[br,ir,Rt,Nr,Br]))return A.error(`Expected first argument to be of type boolean, string, number or null, but found ${Un(g.type)} instead`);if(c.length===4){const B=A.parse(c[3],3,Rt);return B?new ul(g,b,B):null}return new ul(g,b)}evaluate(c){const A=this.needle.evaluate(c),g=this.haystack.evaluate(c);if(!cr(A,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${Un(_n(A))} instead.`);let b;if(this.fromIndex&&(b=this.fromIndex.evaluate(c)),cr(g,["string"])){const B=g.indexOf(A,b);return B===-1?-1:[...g.slice(0,B)].length}if(cr(g,["array"]))return g.indexOf(A,b);throw new pi(`Expected second argument to be of type array or string, but found ${Un(_n(g))} instead.`)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class js{constructor(c,A,g,b,B,T){this.inputType=c,this.type=A,this.input=g,this.cases=b,this.outputs=B,this.otherwise=T}static parse(c,A){if(c.length<5)return A.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return A.error("Expected an even number of arguments.");let g,b;A.expectedType&&A.expectedType.kind!=="value"&&(b=A.expectedType);const B={},T=[];for(let k=2;k<c.length-1;k+=2){let j=c[k];const G=c[k+1];Array.isArray(j)||(j=[j]);const re=A.concat(k);if(j.length===0)return re.error("Expected at least one branch label.");for(const le of j){if(typeof le!="number"&&typeof le!="string")return re.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return re.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof le=="number"&&Math.floor(le)!==le)return re.error("Numeric branch labels must be integer values.");if(g){if(re.checkSubtype(g,_n(le)))return null}else g=_n(le);if(B[String(le)]!==void 0)return re.error("Branch labels must be unique.");B[String(le)]=T.length}const ie=A.parse(G,k,b);if(!ie)return null;b=b||ie.type,T.push(ie)}const I=A.parse(c[1],1,Br);if(!I)return null;const L=A.parse(c[c.length-1],c.length-1,b);return L?I.type.kind!=="value"&&A.concat(1).checkSubtype(g,I.type)?null:new js(g,b,I,B,T,L):null}evaluate(c){const A=this.input.evaluate(c);return(_n(A)===this.inputType&&this.outputs[this.cases[A]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class va{constructor(c,A,g){this.type=c,this.branches=A,this.otherwise=g}static parse(c,A){if(c.length<4)return A.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return A.error("Expected an odd number of arguments.");let g;A.expectedType&&A.expectedType.kind!=="value"&&(g=A.expectedType);const b=[];for(let T=1;T<c.length-1;T+=2){const I=A.parse(c[T],T,br);if(!I)return null;const L=A.parse(c[T+1],T+1,g);if(!L)return null;b.push([I,L]),g=g||L.type}const B=A.parse(c[c.length-1],c.length-1,g);if(!B)return null;if(!g)throw new Error("Can't infer output type");return new va(g,b,B)}evaluate(c){for(const[A,g]of this.branches)if(A.evaluate(c))return g.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[A,g]of this.branches)c(A),c(g);c(this.otherwise)}outputDefined(){return this.branches.every(c=>{let[A,g]=c;return g.outputDefined()})&&this.otherwise.outputDefined()}}class pu{constructor(c,A,g,b){this.type=c,this.input=A,this.beginIndex=g,this.endIndex=b}static parse(c,A){if(c.length<=2||c.length>=5)return A.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const g=A.parse(c[1],1,Br),b=A.parse(c[2],2,Rt);if(!g||!b)return null;if(!Pr(g.type,[yi(Br),ir,Br]))return A.error(`Expected first argument to be of type array or string, but found ${Un(g.type)} instead`);if(c.length===4){const B=A.parse(c[3],3,Rt);return B?new pu(g.type,g,b,B):null}return new pu(g.type,g,b)}evaluate(c){const A=this.input.evaluate(c),g=this.beginIndex.evaluate(c);let b;if(this.endIndex&&(b=this.endIndex.evaluate(c)),cr(A,["string"]))return[...A].slice(g,b).join("");if(cr(A,["array"]))return A.slice(g,b);throw new pi(`Expected first argument to be of type array or string, but found ${Un(_n(A))} instead.`)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function za(f,c){const A=f.length-1;let g,b,B=0,T=A,I=0;for(;B<=T;)if(I=Math.floor((B+T)/2),g=f[I],b=f[I+1],g<=c){if(I===A||c<b)return I;B=I+1}else{if(!(g>c))throw new pi("Input is not a number.");T=I-1}return 0}class Ha{constructor(c,A,g){this.type=c,this.input=A,this.labels=[],this.outputs=[];for(const[b,B]of g)this.labels.push(b),this.outputs.push(B)}static parse(c,A){if(c.length-1<4)return A.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return A.error("Expected an even number of arguments.");const g=A.parse(c[1],1,Rt);if(!g)return null;const b=[];let B=null;A.expectedType&&A.expectedType.kind!=="value"&&(B=A.expectedType);for(let T=1;T<c.length;T+=2){const I=T===1?-1/0:c[T],L=c[T+1],k=T,j=T+1;if(typeof I!="number")return A.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(b.length&&b[b.length-1][0]>=I)return A.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const G=A.parse(L,j,B);if(!G)return null;B=B||G.type,b.push([I,G])}return new Ha(B,g,b)}evaluate(c){const A=this.labels,g=this.outputs;if(A.length===1)return g[0].evaluate(c);const b=this.input.evaluate(c);if(b<=A[0])return g[0].evaluate(c);const B=A.length;return b>=A[B-1]?g[B-1].evaluate(c):g[za(A,b)].evaluate(c)}eachChild(c){c(this.input);for(const A of this.outputs)c(A)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function gu(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var lh,ch,Kh=function(){if(ch)return lh;function f(c,A,g,b){this.cx=3*c,this.bx=3*(g-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*A,this.by=3*(b-A)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=A,this.p2x=g,this.p2y=b}return ch=1,lh=f,f.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,A){if(A===void 0&&(A=1e-6),c<0)return 0;if(c>1)return 1;for(var g=c,b=0;b<8;b++){var B=this.sampleCurveX(g)-c;if(Math.abs(B)<A)return g;var T=this.sampleCurveDerivativeX(g);if(Math.abs(T)<1e-6)break;g-=B/T}var I=0,L=1;for(g=c,b=0;b<20&&(B=this.sampleCurveX(g),!(Math.abs(B-c)<A));b++)c>B?I=g:L=g,g=.5*(L-I)+I;return g},solve:function(c,A){return this.sampleCurveY(this.solveCurveX(c,A))}},lh}(),fc=gu(Kh);class In{constructor(c,A,g,b,B){this.type=c,this.operator=A,this.interpolation=g,this.input=b,this.labels=[],this.outputs=[];for(const[T,I]of B)this.labels.push(T),this.outputs.push(I)}static interpolationFactor(c,A,g,b){let B=0;if(c.name==="exponential")B=No(A,c.base,g,b);else if(c.name==="linear")B=No(A,1,g,b);else if(c.name==="cubic-bezier"){const T=c.controlPoints;B=new fc(T[0],T[1],T[2],T[3]).solve(No(A,1,g,b))}return B}static parse(c,A){let[g,b,B,...T]=c;if(!Array.isArray(b)||b.length===0)return A.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const k=b[1];if(typeof k!="number")return A.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:k}}else{if(b[0]!=="cubic-bezier")return A.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const k=b.slice(1);if(k.length!==4||k.some(j=>typeof j!="number"||j<0||j>1))return A.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:k}}}if(c.length-1<4)return A.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return A.error("Expected an even number of arguments.");if(B=A.parse(B,2,Rt),!B)return null;const I=[];let L=null;g==="interpolate-hcl"||g==="interpolate-lab"?L=kr:A.expectedType&&A.expectedType.kind!=="value"&&(L=A.expectedType);for(let k=0;k<T.length;k+=2){const j=T[k],G=T[k+1],re=k+3,ie=k+4;if(typeof j!="number")return A.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(I.length&&I[I.length-1][0]>=j)return A.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);const le=A.parse(G,ie,L);if(!le)return null;L=L||le.type,I.push([j,le])}return pn(L,Rt)||pn(L,en)||pn(L,kr)||pn(L,Bn)||pn(L,Cn)||pn(L,yi(Rt))?new In(L,g,b,B,I):A.error(`Type ${Un(L)} is not interpolatable.`)}evaluate(c){const A=this.labels,g=this.outputs;if(A.length===1)return g[0].evaluate(c);const b=this.input.evaluate(c);if(b<=A[0])return g[0].evaluate(c);const B=A.length;if(b>=A[B-1])return g[B-1].evaluate(c);const T=za(A,b),I=In.interpolationFactor(this.interpolation,b,A[T],A[T+1]),L=g[T].evaluate(c),k=g[T+1].evaluate(c);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return an(L,k,I);case"color":return dn.interpolate(L,k,I);case"padding":return ki.interpolate(L,k,I);case"variableAnchorOffsetCollection":return Bs.interpolate(L,k,I);case"array":return Yo(L,k,I);case"projectionDefinition":return Wi.interpolate(L,k,I)}case"interpolate-hcl":return dn.interpolate(L,k,I,"hcl");case"interpolate-lab":return dn.interpolate(L,k,I,"lab")}}eachChild(c){c(this.input);for(const A of this.outputs)c(A)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function No(f,c,A,g){const b=g-A,B=f-A;return b===0?0:c===1?B/b:(Math.pow(c,B)-1)/(Math.pow(c,b)-1)}const Jo={color:dn.interpolate,number:an,padding:ki.interpolate,variableAnchorOffsetCollection:Bs.interpolate,array:Yo};class ko{constructor(c,A){this.type=c,this.args=A}static parse(c,A){if(c.length<2)return A.error("Expected at least one argument.");let g=null;const b=A.expectedType;b&&b.kind!=="value"&&(g=b);const B=[];for(const I of c.slice(1)){const L=A.parse(I,1+B.length,g,void 0,{typeAnnotation:"omit"});if(!L)return null;g=g||L.type,B.push(L)}if(!g)throw new Error("No output type");const T=b&&B.some(I=>Ke(b,I.type));return new ko(T?Br:g,B)}evaluate(c){let A,g=null,b=0;for(const B of this.args)if(b++,g=B.evaluate(c),g&&g instanceof Si&&!g.available&&(A||(A=g.name),g=null,b===this.args.length&&(g=A)),g!==null)break;return g}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}function Jn(f,c){return f==="=="||f==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function mu(f,c,A,g){return g.compare(c,A)===0}function Qo(f,c,A){const g=f!=="=="&&f!=="!=";return class j7{constructor(B,T,I){this.type=br,this.lhs=B,this.rhs=T,this.collator=I,this.hasUntypedArgument=B.type.kind==="value"||T.type.kind==="value"}static parse(B,T){if(B.length!==3&&B.length!==4)return T.error("Expected two or three arguments.");const I=B[0];let L=T.parse(B[1],1,Br);if(!L)return null;if(!Jn(I,L.type))return T.concat(1).error(`"${I}" comparisons are not supported for type '${Un(L.type)}'.`);let k=T.parse(B[2],2,Br);if(!k)return null;if(!Jn(I,k.type))return T.concat(2).error(`"${I}" comparisons are not supported for type '${Un(k.type)}'.`);if(L.type.kind!==k.type.kind&&L.type.kind!=="value"&&k.type.kind!=="value")return T.error(`Cannot compare types '${Un(L.type)}' and '${Un(k.type)}'.`);g&&(L.type.kind==="value"&&k.type.kind!=="value"?L=new Do(k.type,[L]):L.type.kind!=="value"&&k.type.kind==="value"&&(k=new Do(L.type,[k])));let j=null;if(B.length===4){if(L.type.kind!=="string"&&k.type.kind!=="string"&&L.type.kind!=="value"&&k.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(j=T.parse(B[3],3,Sn),!j)return null}return new j7(L,k,j)}evaluate(B){const T=this.lhs.evaluate(B),I=this.rhs.evaluate(B);if(g&&this.hasUntypedArgument){const L=_n(T),k=_n(I);if(L.kind!==k.kind||L.kind!=="string"&&L.kind!=="number")throw new pi(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${L.kind}, ${k.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const L=_n(T),k=_n(I);if(L.kind!=="string"||k.kind!=="string")return c(B,T,I)}return this.collator?A(B,T,I,this.collator.evaluate(B)):c(B,T,I)}eachChild(B){B(this.lhs),B(this.rhs),this.collator&&B(this.collator)}outputDefined(){return!0}}}const sf=Qo("==",function(f,c,A){return c===A},mu),uh=Qo("!=",function(f,c,A){return c!==A},function(f,c,A,g){return!mu(0,c,A,g)}),hh=Qo("<",function(f,c,A){return c<A},function(f,c,A,g){return g.compare(c,A)<0}),_u=Qo(">",function(f,c,A){return c>A},function(f,c,A,g){return g.compare(c,A)>0}),Wh=Qo("<=",function(f,c,A){return c<=A},function(f,c,A,g){return g.compare(c,A)<=0}),yu=Qo(">=",function(f,c,A){return c>=A},function(f,c,A,g){return g.compare(c,A)>=0});class wa{constructor(c,A,g){this.type=Sn,this.locale=g,this.caseSensitive=c,this.diacriticSensitive=A}static parse(c,A){if(c.length!==2)return A.error("Expected one argument.");const g=c[1];if(typeof g!="object"||Array.isArray(g))return A.error("Collator options argument must be an object.");const b=A.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,br);if(!b)return null;const B=A.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,br);if(!B)return null;let T=null;return g.locale&&(T=A.parse(g.locale,1,ir),!T)?null:new wa(b,B,T)}evaluate(c){return new hu(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}class $s{constructor(c,A,g,b,B){this.type=ir,this.number=c,this.locale=A,this.currency=g,this.minFractionDigits=b,this.maxFractionDigits=B}static parse(c,A){if(c.length!==3)return A.error("Expected two arguments.");const g=A.parse(c[1],1,Rt);if(!g)return null;const b=c[2];if(typeof b!="object"||Array.isArray(b))return A.error("NumberFormat options argument must be an object.");let B=null;if(b.locale&&(B=A.parse(b.locale,1,ir),!B))return null;let T=null;if(b.currency&&(T=A.parse(b.currency,1,ir),!T))return null;let I=null;if(b["min-fraction-digits"]&&(I=A.parse(b["min-fraction-digits"],1,Rt),!I))return null;let L=null;return b["max-fraction-digits"]&&(L=A.parse(b["max-fraction-digits"],1,Rt),!L)?null:new $s(g,B,T,I,L)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class Pl{constructor(c){this.type=Ti,this.sections=c}static parse(c,A){if(c.length<2)return A.error("Expected at least one argument.");const g=c[1];if(!Array.isArray(g)&&typeof g=="object")return A.error("First argument must be an image or text section.");const b=[];let B=!1;for(let T=1;T<=c.length-1;++T){const I=c[T];if(B&&typeof I=="object"&&!Array.isArray(I)){B=!1;let L=null;if(I["font-scale"]&&(L=A.parse(I["font-scale"],1,Rt),!L))return null;let k=null;if(I["text-font"]&&(k=A.parse(I["text-font"],1,yi(ir)),!k))return null;let j=null;if(I["text-color"]&&(j=A.parse(I["text-color"],1,kr),!j))return null;let G=null;if(I["vertical-align"]){if(typeof I["vertical-align"]=="string"&&!nf.includes(I["vertical-align"]))return A.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${I["vertical-align"]}' instead.`);if(G=A.parse(I["vertical-align"],1,ir),!G)return null}const re=b[b.length-1];re.scale=L,re.font=k,re.textColor=j,re.verticalAlign=G}else{const L=A.parse(c[T],1,Br);if(!L)return null;const k=L.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return A.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");B=!0,b.push({content:L,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Pl(b)}evaluate(c){return new Ei(this.sections.map(A=>{const g=A.content.evaluate(c);return _n(g)===zn?new hc("",g,null,null,null,A.verticalAlign?A.verticalAlign.evaluate(c):null):new hc(Au(g),null,A.scale?A.scale.evaluate(c):null,A.font?A.font.evaluate(c).join(","):null,A.textColor?A.textColor.evaluate(c):null,A.verticalAlign?A.verticalAlign.evaluate(c):null)}))}eachChild(c){for(const A of this.sections)c(A.content),A.scale&&c(A.scale),A.font&&c(A.font),A.textColor&&c(A.textColor),A.verticalAlign&&c(A.verticalAlign)}outputDefined(){return!1}}class Fl{constructor(c){this.type=zn,this.input=c}static parse(c,A){if(c.length!==2)return A.error("Expected two arguments.");const g=A.parse(c[1],1,ir);return g?new Fl(g):A.error("No image name provided.")}evaluate(c){const A=this.input.evaluate(c),g=Si.fromString(A);return g&&c.availableImages&&(g.available=c.availableImages.indexOf(A)>-1),g}eachChild(c){c(this.input)}outputDefined(){return!1}}class Xh{constructor(c){this.type=Rt,this.input=c}static parse(c,A){if(c.length!==2)return A.error(`Expected 1 argument, but found ${c.length-1} instead.`);const g=A.parse(c[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?A.error(`Expected argument of type string or array, but found ${Un(g.type)} instead.`):new Xh(g):null}evaluate(c){const A=this.input.evaluate(c);if(typeof A=="string")return[...A].length;if(Array.isArray(A))return A.length;throw new pi(`Expected value to be of type string or array, but found ${Un(_n(A))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const Gs=8192;function bu(f,c){const A=(180+f[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,b=Math.pow(2,c.z);return[Math.round(A*b*Gs),Math.round(g*b*Gs)]}function vu(f,c){const A=Math.pow(2,c.z);return[(b=(f[0]/Gs+c.x)/A,360*b-180),(g=(f[1]/Gs+c.y)/A,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,b}function xa(f,c){f[0]=Math.min(f[0],c[0]),f[1]=Math.min(f[1],c[1]),f[2]=Math.max(f[2],c[0]),f[3]=Math.max(f[3],c[1])}function Rl(f,c){return!(f[0]<=c[0]||f[2]>=c[2]||f[1]<=c[1]||f[3]>=c[3])}function U(f,c,A){const g=f[0]-c[0],b=f[1]-c[1],B=f[0]-A[0],T=f[1]-A[1];return g*T-B*b==0&&g*B<=0&&b*T<=0}function he(f,c,A,g){return(b=[g[0]-A[0],g[1]-A[1]])[0]*(B=[c[0]-f[0],c[1]-f[1]])[1]-b[1]*B[0]!=0&&!(!Or(f,c,A,g)||!Or(A,g,f,c));var b,B}function ke(f,c,A){for(const g of A)for(let b=0;b<g.length-1;++b)if(he(f,c,g[b],g[b+1]))return!0;return!1}function nt(f,c){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,g=!1;for(const I of c)for(let L=0;L<I.length-1;L++){if(U(f,I[L],I[L+1]))return A;(B=I[L])[1]>(b=f)[1]!=(T=I[L+1])[1]>b[1]&&b[0]<(T[0]-B[0])*(b[1]-B[1])/(T[1]-B[1])+B[0]&&(g=!g)}var b,B,T;return g}function Bt(f,c){for(const A of c)if(nt(f,A))return!0;return!1}function Vt(f,c){for(const A of f)if(!nt(A,c))return!1;for(let A=0;A<f.length-1;++A)if(ke(f[A],f[A+1],c))return!1;return!0}function ur(f,c){for(const A of c)if(Vt(f,A))return!0;return!1}function Or(f,c,A,g){const b=g[0]-A[0],B=g[1]-A[1],T=(f[0]-A[0])*B-b*(f[1]-A[1]),I=(c[0]-A[0])*B-b*(c[1]-A[1]);return T>0&&I<0||T<0&&I>0}function Xr(f,c,A){const g=[];for(let b=0;b<f.length;b++){const B=[];for(let T=0;T<f[b].length;T++){const I=bu(f[b][T],A);xa(c,I),B.push(I)}g.push(B)}return g}function An(f,c,A){const g=[];for(let b=0;b<f.length;b++){const B=Xr(f[b],c,A);g.push(B)}return g}function hn(f,c,A,g){if(f[0]<A[0]||f[0]>A[2]){const b=.5*g;let B=f[0]-A[0]>b?-g:A[0]-f[0]>b?g:0;B===0&&(B=f[0]-A[2]>b?-g:A[2]-f[0]>b?g:0),f[0]+=B}xa(c,f)}function Rn(f,c,A,g){const b=Math.pow(2,g.z)*Gs,B=[g.x*Gs,g.y*Gs],T=[];for(const I of f)for(const L of I){const k=[L.x+B[0],L.y+B[1]];hn(k,c,A,b),T.push(k)}return T}function bi(f,c,A,g){const b=Math.pow(2,g.z)*Gs,B=[g.x*Gs,g.y*Gs],T=[];for(const L of f){const k=[];for(const j of L){const G=[j.x+B[0],j.y+B[1]];xa(c,G),k.push(G)}T.push(k)}if(c[2]-c[0]<=b/2){(I=c)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const L of T)for(const k of L)hn(k,c,A,b)}var I;return T}class ii{constructor(c,A){this.type=br,this.geojson=c,this.geometries=A}static parse(c,A){if(c.length!==2)return A.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(cl(c[1])){const g=c[1];if(g.type==="FeatureCollection"){const b=[];for(const B of g.features){const{type:T,coordinates:I}=B.geometry;T==="Polygon"&&b.push(I),T==="MultiPolygon"&&b.push(...I)}if(b.length)return new ii(g,{type:"MultiPolygon",coordinates:b})}else if(g.type==="Feature"){const b=g.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new ii(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new ii(g,g)}return A.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(A,g){const b=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],T=A.canonicalID();if(g.type==="Polygon"){const I=Xr(g.coordinates,B,T),L=Rn(A.geometry(),b,B,T);if(!Rl(b,B))return!1;for(const k of L)if(!nt(k,I))return!1}if(g.type==="MultiPolygon"){const I=An(g.coordinates,B,T),L=Rn(A.geometry(),b,B,T);if(!Rl(b,B))return!1;for(const k of L)if(!Bt(k,I))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(A,g){const b=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],T=A.canonicalID();if(g.type==="Polygon"){const I=Xr(g.coordinates,B,T),L=bi(A.geometry(),b,B,T);if(!Rl(b,B))return!1;for(const k of L)if(!Vt(k,I))return!1}if(g.type==="MultiPolygon"){const I=An(g.coordinates,B,T),L=bi(A.geometry(),b,B,T);if(!Rl(b,B))return!1;for(const k of L)if(!ur(k,I))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xi=class{constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(A,g)=>A<g?-1:A>g?1:0;if(this.data=f,this.length=this.data.length,this.compare=c,this.length>0)for(let A=(this.length>>1)-1;A>=0;A--)this._down(A)}push(f){this.data.push(f),this._up(this.length++)}pop(){if(this.length===0)return;const f=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:c,compare:A}=this,g=c[f];for(;f>0;){const b=f-1>>1,B=c[b];if(A(g,B)>=0)break;c[f]=B,f=b}c[f]=g}_down(f){const{data:c,compare:A}=this,g=this.length>>1,b=c[f];for(;f<g;){let B=1+(f<<1);const T=B+1;if(T<this.length&&A(c[T],c[B])<0&&(B=T),A(c[B],b)>=0)break;c[f]=c[B],f=B}c[f]=b}};function qs(f,c){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:f.length-1,b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:ea;for(;g>A;){if(g-A>600){const L=g-A+1,k=c-A+1,j=Math.log(L),G=.5*Math.exp(2*j/3),re=.5*Math.sqrt(j*G*(L-G)/L)*(k-L/2<0?-1:1);qs(f,c,Math.max(A,Math.floor(c-k*G/L+re)),Math.min(g,Math.floor(c+(L-k)*G/L+re)),b)}const B=f[c];let T=A,I=g;for(ji(f,A,c),b(f[g],B)>0&&ji(f,A,g);T<I;){for(ji(f,T,I),T++,I--;b(f[T],B)<0;)T++;for(;b(f[I],B)>0;)I--}b(f[A],B)===0?ji(f,A,I):(I++,ji(f,I,g)),I<=c&&(A=I+1),c<=I&&(g=I-1)}}function ji(f,c,A){const g=f[c];f[c]=f[A],f[A]=g}function ea(f,c){return f<c?-1:f>c?1:0}function wo(f,c){if(f.length<=1)return[f];const A=[];let g,b;for(const B of f){const T=of(B);T!==0&&(B.area=Math.abs(T),b===void 0&&(b=T<0),b===T<0?(g&&A.push(g),g=[B]):g.push(B))}if(g&&A.push(g),c>1)for(let B=0;B<A.length;B++)A[B].length<=c||(qs(A[B],c,1,A[B].length-1,hl),A[B]=A[B].slice(0,c));return A}function hl(f,c){return c.area-f.area}function of(f){let c=0;for(let A,g,b=0,B=f.length,T=B-1;b<B;T=b++)A=f[b],g=f[T],c+=(g.x-A.x)*(A.y+g.y);return c}const wu=1/298.257223563,xu=wu*(2-wu),Bu=Math.PI/180;class Cu{constructor(c){const A=6378.137*Bu*1e3,g=Math.cos(c*Bu),b=1/(1-xu*(1-g*g)),B=Math.sqrt(b);this.kx=A*B*g,this.ky=A*B*b*(1-xu)}distance(c,A){const g=this.wrap(c[0]-A[0])*this.kx,b=(c[1]-A[1])*this.ky;return Math.sqrt(g*g+b*b)}pointOnLine(c,A){let g,b,B,T,I=1/0;for(let L=0;L<c.length-1;L++){let k=c[L][0],j=c[L][1],G=this.wrap(c[L+1][0]-k)*this.kx,re=(c[L+1][1]-j)*this.ky,ie=0;G===0&&re===0||(ie=(this.wrap(A[0]-k)*this.kx*G+(A[1]-j)*this.ky*re)/(G*G+re*re),ie>1?(k=c[L+1][0],j=c[L+1][1]):ie>0&&(k+=G/this.kx*ie,j+=re/this.ky*ie)),G=this.wrap(A[0]-k)*this.kx,re=(A[1]-j)*this.ky;const le=G*G+re*re;le<I&&(I=le,g=k,b=j,B=L,T=ie)}return{point:[g,b],index:B,t:Math.max(0,Math.min(1,T))}}wrap(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}}function Tu(f,c){return c[0]-f[0]}function Al(f){return f[1]-f[0]+1}function vi(f,c){return f[1]>=f[0]&&f[1]<c}function dc(f,c){if(f[0]>f[1])return[null,null];const A=Al(f);if(c){if(A===2)return[f,null];const b=Math.floor(A/2);return[[f[0],f[0]+b],[f[0]+b,f[1]]]}if(A===1)return[f,null];const g=Math.floor(A/2)-1;return[[f[0],f[0]+g],[f[0]+g+1,f[1]]]}function pc(f,c){if(!vi(c,f.length))return[1/0,1/0,-1/0,-1/0];const A=[1/0,1/0,-1/0,-1/0];for(let g=c[0];g<=c[1];++g)xa(A,f[g]);return A}function Ll(f){const c=[1/0,1/0,-1/0,-1/0];for(const A of f)for(const g of A)xa(c,g);return c}function Ah(f){return f[0]!==-1/0&&f[1]!==-1/0&&f[2]!==1/0&&f[3]!==1/0}function ao(f,c,A){if(!Ah(f)||!Ah(c))return NaN;let g=0,b=0;return f[2]<c[0]&&(g=c[0]-f[2]),f[0]>c[2]&&(g=f[0]-c[2]),f[1]>c[3]&&(b=f[1]-c[3]),f[3]<c[1]&&(b=c[1]-f[3]),A.distance([0,0],[g,b])}function Ol(f,c,A){const g=A.pointOnLine(c,f);return A.distance(f,g.point)}function Eu(f,c,A,g,b){const B=Math.min(Ol(f,[A,g],b),Ol(c,[A,g],b)),T=Math.min(Ol(A,[f,c],b),Ol(g,[f,c],b));return Math.min(B,T)}function On(f,c,A,g,b){if(!vi(c,f.length)||!vi(g,A.length))return 1/0;let B=1/0;for(let T=c[0];T<c[1];++T){const I=f[T],L=f[T+1];for(let k=g[0];k<g[1];++k){const j=A[k],G=A[k+1];if(he(I,L,j,G))return 0;B=Math.min(B,Eu(I,L,j,G,b))}}return B}function Ba(f,c,A,g,b){if(!vi(c,f.length)||!vi(g,A.length))return NaN;let B=1/0;for(let T=c[0];T<=c[1];++T)for(let I=g[0];I<=g[1];++I)if(B=Math.min(B,b.distance(f[T],A[I])),B===0)return B;return B}function fh(f,c,A){if(nt(f,c,!0))return 0;let g=1/0;for(const b of c){const B=b[0],T=b[b.length-1];if(B!==T&&(g=Math.min(g,Ol(f,[T,B],A)),g===0))return g;const I=A.pointOnLine(b,f);if(g=Math.min(g,A.distance(f,I.point)),g===0)return g}return g}function af(f,c,A,g){if(!vi(c,f.length))return NaN;for(let B=c[0];B<=c[1];++B)if(nt(f[B],A,!0))return 0;let b=1/0;for(let B=c[0];B<c[1];++B){const T=f[B],I=f[B+1];for(const L of A)for(let k=0,j=L.length,G=j-1;k<j;G=k++){const re=L[G],ie=L[k];if(he(T,I,re,ie))return 0;b=Math.min(b,Eu(T,I,re,ie,g))}}return b}function Yh(f,c){for(const A of f)for(const g of A)if(nt(g,c,!0))return!0;return!1}function gc(f,c,A){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/0;const b=Ll(f),B=Ll(c);if(g!==1/0&&ao(b,B,A)>=g)return g;if(Rl(b,B)){if(Yh(f,c))return 0}else if(Yh(c,f))return 0;let T=1/0;for(const I of f)for(let L=0,k=I.length,j=k-1;L<k;j=L++){const G=I[j],re=I[L];for(const ie of c)for(let le=0,fe=ie.length,Se=fe-1;le<fe;Se=le++){const Ie=ie[Se],st=ie[le];if(he(G,re,Ie,st))return 0;T=Math.min(T,Eu(G,re,Ie,st,A))}}return T}function mc(f,c,A,g,b,B){if(!B)return;const T=ao(pc(g,B),b,A);T<c&&f.push([T,B,[0,0]])}function Ks(f,c,A,g,b,B,T){if(!B||!T)return;const I=ao(pc(g,B),pc(b,T),A);I<c&&f.push([I,B,T])}function Ts(f,c,A,g){let b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1/0,B=Math.min(g.distance(f[0],A[0][0]),b);if(B===0)return B;const T=new Xi([[0,[0,f.length-1],[0,0]]],Tu),I=Ll(A);for(;T.length>0;){const L=T.pop();if(L[0]>=B)continue;const k=L[1],j=c?50:100;if(Al(k)<=j){if(!vi(k,f.length))return NaN;if(c){const G=af(f,k,A,g);if(isNaN(G)||G===0)return G;B=Math.min(B,G)}else for(let G=k[0];G<=k[1];++G){const re=fh(f[G],A,g);if(B=Math.min(B,re),B===0)return 0}}else{const G=dc(k,c);mc(T,B,g,f,I,G[0]),mc(T,B,g,f,I,G[1])}}return B}function Va(f,c,A,g,b){let B=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,T=Math.min(B,b.distance(f[0],A[0]));if(T===0)return T;const I=new Xi([[0,[0,f.length-1],[0,A.length-1]]],Tu);for(;I.length>0;){const L=I.pop();if(L[0]>=T)continue;const k=L[1],j=L[2],G=c?50:100,re=g?50:100;if(Al(k)<=G&&Al(j)<=re){if(!vi(k,f.length)&&vi(j,A.length))return NaN;let ie;if(c&&g)ie=On(f,k,A,j,b),T=Math.min(T,ie);else if(c&&!g){const le=f.slice(k[0],k[1]+1);for(let fe=j[0];fe<=j[1];++fe)if(ie=Ol(A[fe],le,b),T=Math.min(T,ie),T===0)return T}else if(!c&&g){const le=A.slice(j[0],j[1]+1);for(let fe=k[0];fe<=k[1];++fe)if(ie=Ol(f[fe],le,b),T=Math.min(T,ie),T===0)return T}else ie=Ba(f,k,A,j,b),T=Math.min(T,ie)}else{const ie=dc(k,c),le=dc(j,g);Ks(I,T,b,f,A,ie[0],le[0]),Ks(I,T,b,f,A,ie[0],le[1]),Ks(I,T,b,f,A,ie[1],le[0]),Ks(I,T,b,f,A,ie[1],le[1])}}return T}function ja(f){return f.type==="MultiPolygon"?f.coordinates.map(c=>({type:"Polygon",coordinates:c})):f.type==="MultiLineString"?f.coordinates.map(c=>({type:"LineString",coordinates:c})):f.type==="MultiPoint"?f.coordinates.map(c=>({type:"Point",coordinates:c})):[f]}class xo{constructor(c,A){this.type=Rt,this.geojson=c,this.geometries=A}static parse(c,A){if(c.length!==2)return A.error(`'distance' expression requires exactly one argument, but found ${c.length-1} instead.`);if(cl(c[1])){const g=c[1];if(g.type==="FeatureCollection")return new xo(g,g.features.map(b=>ja(b.geometry)).flat());if(g.type==="Feature")return new xo(g,ja(g.geometry));if("type"in g&&"coordinates"in g)return new xo(g,ja(g))}return A.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(A,g){const b=A.geometry(),B=b.flat().map(L=>vu([L.x,L.y],A.canonical));if(b.length===0)return NaN;const T=new Cu(B[0][1]);let I=1/0;for(const L of g){switch(L.type){case"Point":I=Math.min(I,Va(B,!1,[L.coordinates],!1,T,I));break;case"LineString":I=Math.min(I,Va(B,!1,L.coordinates,!0,T,I));break;case"Polygon":I=Math.min(I,Ts(B,!1,L.coordinates,T,I))}if(I===0)return I}return I}(c,this.geometries);if(c.geometryType()==="LineString")return function(A,g){const b=A.geometry(),B=b.flat().map(L=>vu([L.x,L.y],A.canonical));if(b.length===0)return NaN;const T=new Cu(B[0][1]);let I=1/0;for(const L of g){switch(L.type){case"Point":I=Math.min(I,Va(B,!0,[L.coordinates],!1,T,I));break;case"LineString":I=Math.min(I,Va(B,!0,L.coordinates,!0,T,I));break;case"Polygon":I=Math.min(I,Ts(B,!0,L.coordinates,T,I))}if(I===0)return I}return I}(c,this.geometries);if(c.geometryType()==="Polygon")return function(A,g){const b=A.geometry();if(b.length===0||b[0].length===0)return NaN;const B=wo(b,0).map(L=>L.map(k=>k.map(j=>vu([j.x,j.y],A.canonical)))),T=new Cu(B[0][0][0][1]);let I=1/0;for(const L of g)for(const k of B){switch(L.type){case"Point":I=Math.min(I,Ts([L.coordinates],!1,k,T,I));break;case"LineString":I=Math.min(I,Ts(L.coordinates,!0,k,T,I));break;case"Polygon":I=Math.min(I,gc(k,L.coordinates,T,I))}if(I===0)return I}return I}(c,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const $a={"==":sf,"!=":uh,">":_u,"<":hh,">=":yu,"<=":Wh,array:Do,at:du,boolean:Do,case:va,coalesce:ko,collator:wa,format:Pl,image:Fl,in:En,"index-of":ul,interpolate:In,"interpolate-hcl":In,"interpolate-lab":In,length:Xh,let:yn,literal:Zo,match:js,number:Do,"number-format":$s,object:Do,slice:pu,step:Ha,string:Do,"to-boolean":Cs,"to-color":Cs,"to-number":Cs,"to-string":Cs,var:on,within:ii,distance:xo};class os{constructor(c,A,g,b){this.name=c,this.type=A,this._evaluate=g,this.args=b}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,A){const g=c[0],b=os.definitions[g];if(!b)return A.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const B=Array.isArray(b)?b[0]:b.type,T=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,I=T.filter(k=>{let[j]=k;return!Array.isArray(j)||j.length===c.length-1});let L=null;for(const[k,j]of I){L=new Qa(A.registry,Ul,A.path,null,A.scope);const G=[];let re=!1;for(let ie=1;ie<c.length;ie++){const le=c[ie],fe=Array.isArray(k)?k[ie-1]:k.type,Se=L.parse(le,1+G.length,fe);if(!Se){re=!0;break}G.push(Se)}if(!re)if(Array.isArray(k)&&k.length!==G.length)L.error(`Expected ${k.length} arguments, but found ${G.length} instead.`);else{for(let ie=0;ie<G.length;ie++){const le=Array.isArray(k)?k[ie]:k.type,fe=G[ie];L.concat(ie+1).checkSubtype(le,fe.type)}if(L.errors.length===0)return new os(g,B,j,G)}}if(I.length===1)A.errors.push(...L.errors);else{const k=(I.length?I:T).map(G=>{let[re]=G;return ie=re,Array.isArray(ie)?`(${ie.map(Un).join(", ")})`:`(${Un(ie.type)}...)`;var ie}).join(" | "),j=[];for(let G=1;G<c.length;G++){const re=A.parse(c[G],1+j.length);if(!re)return null;j.push(Un(re.type))}A.error(`Expected arguments of type ${k}, but found (${j.join(", ")}) instead.`)}return null}static register(c,A){os.definitions=A;for(const g in A)c[g]=os}}function $i(f,c){let[A,g,b,B]=c;A=A.evaluate(f),g=g.evaluate(f),b=b.evaluate(f);const T=B?B.evaluate(f):1,I=Ac(A,g,b,T);if(I)throw new pi(I);return new dn(A/255,g/255,b/255,T,!1)}function dh(f,c){return f in c}function Ws(f,c){const A=c[f];return A===void 0?null:A}function Es(f){return{type:f}}function Ul(f){if(f instanceof on)return Ul(f.boundExpression);if(f instanceof os&&f.name==="error"||f instanceof wa||f instanceof ii||f instanceof xo)return!1;const c=f instanceof Cs||f instanceof Do;let A=!0;return f.eachChild(g=>{A=c?A&&Ul(g):A&&g instanceof Zo}),!!A&&Su(f)&&fl(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Su(f){if(f instanceof os&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof ii||f instanceof xo)return!1;let c=!0;return f.eachChild(A=>{c&&!Su(A)&&(c=!1)}),c}function Dl(f){if(f instanceof os&&f.name==="feature-state")return!1;let c=!0;return f.eachChild(A=>{c&&!Dl(A)&&(c=!1)}),c}function fl(f,c){if(f instanceof os&&c.indexOf(f.name)>=0)return!1;let A=!0;return f.eachChild(g=>{A&&!fl(g,c)&&(A=!1)}),A}function _c(f){return{result:"success",value:f}}function ta(f){return{result:"error",value:f}}function Ca(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function Iu(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function Nl(f){return!!f.expression&&f.expression.interpolated}function gn(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function yc(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function Ta(f){return f}function ra(f,c){const A=c.type==="color",g=f.stops&&typeof f.stops[0][0]=="object",b=g||!(g||f.property!==void 0),B=f.type||(Nl(c)?"exponential":"interval");if(A||c.type==="padding"){const j=A?dn.parse:ki.parse;(f=hr({},f)).stops&&(f.stops=f.stops.map(G=>[G[0],j(G[1])])),f.default=j(f.default?f.default:c.default)}if(f.colorSpace&&(T=f.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var T;let I,L,k;if(B==="exponential")I=as;else if(B==="interval")I=Yi;else if(B==="categorical"){I=si,L=Object.create(null);for(const j of f.stops)L[j[0]]=j[1];k=typeof f.stops[0][0]}else{if(B!=="identity")throw new Error(`Unknown function type "${B}"`);I=kl}if(g){const j={},G=[];for(let le=0;le<f.stops.length;le++){const fe=f.stops[le],Se=fe[0].zoom;j[Se]===void 0&&(j[Se]={zoom:Se,type:f.type,property:f.property,default:f.default,stops:[]},G.push(Se)),j[Se].stops.push([fe[0].value,fe[1]])}const re=[];for(const le of G)re.push([j[le].zoom,ra(j[le],c)]);const ie={name:"linear"};return{kind:"composite",interpolationType:ie,interpolationFactor:In.interpolationFactor.bind(void 0,ie),zoomStops:re.map(le=>le[0]),evaluate:(le,fe)=>{let{zoom:Se}=le;return as({stops:re,base:f.base},c,Se).evaluate(Se,fe)}}}if(b){const j=B==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:In.interpolationFactor.bind(void 0,j),zoomStops:f.stops.map(G=>G[0]),evaluate:G=>{let{zoom:re}=G;return I(f,c,re,L,k)}}}return{kind:"source",evaluate(j,G){const re=G&&G.properties?G.properties[f.property]:void 0;return re===void 0?$n(f.default,c.default):I(f,c,re,L,k)}}}function $n(f,c,A){return f!==void 0?f:c!==void 0?c:A!==void 0?A:void 0}function si(f,c,A,g,b){return $n(typeof A===b?g[A]:void 0,f.default,c.default)}function Yi(f,c,A){if(gn(A)!=="number")return $n(f.default,c.default);const g=f.stops.length;if(g===1||A<=f.stops[0][0])return f.stops[0][1];if(A>=f.stops[g-1][0])return f.stops[g-1][1];const b=za(f.stops.map(B=>B[0]),A);return f.stops[b][1]}function as(f,c,A){const g=f.base!==void 0?f.base:1;if(gn(A)!=="number")return $n(f.default,c.default);const b=f.stops.length;if(b===1||A<=f.stops[0][0])return f.stops[0][1];if(A>=f.stops[b-1][0])return f.stops[b-1][1];const B=za(f.stops.map(j=>j[0]),A),T=function(j,G,re,ie){const le=ie-re,fe=j-re;return le===0?0:G===1?fe/le:(Math.pow(G,fe)-1)/(Math.pow(G,le)-1)}(A,g,f.stops[B][0],f.stops[B+1][0]),I=f.stops[B][1],L=f.stops[B+1][1],k=Jo[c.type]||Ta;return typeof I.evaluate=="function"?{evaluate(){for(var j=arguments.length,G=new Array(j),re=0;re<j;re++)G[re]=arguments[re];const ie=I.evaluate.apply(void 0,G),le=L.evaluate.apply(void 0,G);if(ie!==void 0&&le!==void 0)return k(ie,le,T,f.colorSpace)}}:k(I,L,T,f.colorSpace)}function kl(f,c,A){switch(c.type){case"color":A=dn.parse(A);break;case"formatted":A=Ei.fromString(A.toString());break;case"resolvedImage":A=Si.fromString(A.toString());break;case"padding":A=ki.parse(A);break;default:gn(A)===c.type||c.type==="enum"&&c.values[A]||(A=void 0)}return $n(A,f.default,c.default)}os.register($a,{error:[{kind:"error"},[ir],(f,c)=>{let[A]=c;throw new pi(A.evaluate(f))}],typeof:[ir,[Br],(f,c)=>{let[A]=c;return Un(_n(A.evaluate(f)))}],"to-rgba":[yi(Rt,4),[kr],(f,c)=>{let[A]=c;const[g,b,B,T]=A.evaluate(f).rgb;return[255*g,255*b,255*B,T]}],rgb:[kr,[Rt,Rt,Rt],$i],rgba:[kr,[Rt,Rt,Rt,Rt],$i],has:{type:br,overloads:[[[ir],(f,c)=>{let[A]=c;return dh(A.evaluate(f),f.properties())}],[[ir,jr],(f,c)=>{let[A,g]=c;return dh(A.evaluate(f),g.evaluate(f))}]]},get:{type:Br,overloads:[[[ir],(f,c)=>{let[A]=c;return Ws(A.evaluate(f),f.properties())}],[[ir,jr],(f,c)=>{let[A,g]=c;return Ws(A.evaluate(f),g.evaluate(f))}]]},"feature-state":[Br,[ir],(f,c)=>{let[A]=c;return Ws(A.evaluate(f),f.featureState||{})}],properties:[jr,[],f=>f.properties()],"geometry-type":[ir,[],f=>f.geometryType()],id:[Br,[],f=>f.id()],zoom:[Rt,[],f=>f.globals.zoom],"heatmap-density":[Rt,[],f=>f.globals.heatmapDensity||0],"line-progress":[Rt,[],f=>f.globals.lineProgress||0],accumulated:[Br,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[Rt,Es(Rt),(f,c)=>{let A=0;for(const g of c)A+=g.evaluate(f);return A}],"*":[Rt,Es(Rt),(f,c)=>{let A=1;for(const g of c)A*=g.evaluate(f);return A}],"-":{type:Rt,overloads:[[[Rt,Rt],(f,c)=>{let[A,g]=c;return A.evaluate(f)-g.evaluate(f)}],[[Rt],(f,c)=>{let[A]=c;return-A.evaluate(f)}]]},"/":[Rt,[Rt,Rt],(f,c)=>{let[A,g]=c;return A.evaluate(f)/g.evaluate(f)}],"%":[Rt,[Rt,Rt],(f,c)=>{let[A,g]=c;return A.evaluate(f)%g.evaluate(f)}],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(f,c)=>{let[A,g]=c;return Math.pow(A.evaluate(f),g.evaluate(f))}],sqrt:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.sqrt(A.evaluate(f))}],log10:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.log(A.evaluate(f))/Math.LN10}],ln:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.log(A.evaluate(f))}],log2:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.log(A.evaluate(f))/Math.LN2}],sin:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.sin(A.evaluate(f))}],cos:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.cos(A.evaluate(f))}],tan:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.tan(A.evaluate(f))}],asin:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.asin(A.evaluate(f))}],acos:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.acos(A.evaluate(f))}],atan:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.atan(A.evaluate(f))}],min:[Rt,Es(Rt),(f,c)=>Math.min(...c.map(A=>A.evaluate(f)))],max:[Rt,Es(Rt),(f,c)=>Math.max(...c.map(A=>A.evaluate(f)))],abs:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.abs(A.evaluate(f))}],round:[Rt,[Rt],(f,c)=>{let[A]=c;const g=A.evaluate(f);return g<0?-Math.round(-g):Math.round(g)}],floor:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.floor(A.evaluate(f))}],ceil:[Rt,[Rt],(f,c)=>{let[A]=c;return Math.ceil(A.evaluate(f))}],"filter-==":[br,[ir,Br],(f,c)=>{let[A,g]=c;return f.properties()[A.value]===g.value}],"filter-id-==":[br,[Br],(f,c)=>{let[A]=c;return f.id()===A.value}],"filter-type-==":[br,[ir],(f,c)=>{let[A]=c;return f.geometryType()===A.value}],"filter-<":[br,[ir,Br],(f,c)=>{let[A,g]=c;const b=f.properties()[A.value],B=g.value;return typeof b==typeof B&&b<B}],"filter-id-<":[br,[Br],(f,c)=>{let[A]=c;const g=f.id(),b=A.value;return typeof g==typeof b&&g<b}],"filter->":[br,[ir,Br],(f,c)=>{let[A,g]=c;const b=f.properties()[A.value],B=g.value;return typeof b==typeof B&&b>B}],"filter-id->":[br,[Br],(f,c)=>{let[A]=c;const g=f.id(),b=A.value;return typeof g==typeof b&&g>b}],"filter-<=":[br,[ir,Br],(f,c)=>{let[A,g]=c;const b=f.properties()[A.value],B=g.value;return typeof b==typeof B&&b<=B}],"filter-id-<=":[br,[Br],(f,c)=>{let[A]=c;const g=f.id(),b=A.value;return typeof g==typeof b&&g<=b}],"filter->=":[br,[ir,Br],(f,c)=>{let[A,g]=c;const b=f.properties()[A.value],B=g.value;return typeof b==typeof B&&b>=B}],"filter-id->=":[br,[Br],(f,c)=>{let[A]=c;const g=f.id(),b=A.value;return typeof g==typeof b&&g>=b}],"filter-has":[br,[Br],(f,c)=>{let[A]=c;return A.value in f.properties()}],"filter-has-id":[br,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[br,[yi(ir)],(f,c)=>{let[A]=c;return A.value.indexOf(f.geometryType())>=0}],"filter-id-in":[br,[yi(Br)],(f,c)=>{let[A]=c;return A.value.indexOf(f.id())>=0}],"filter-in-small":[br,[ir,yi(Br)],(f,c)=>{let[A,g]=c;return g.value.indexOf(f.properties()[A.value])>=0}],"filter-in-large":[br,[ir,yi(Br)],(f,c)=>{let[A,g]=c;return function(b,B,T,I){for(;T<=I;){const L=T+I>>1;if(B[L]===b)return!0;B[L]>b?I=L-1:T=L+1}return!1}(f.properties()[A.value],g.value,0,g.value.length-1)}],all:{type:br,overloads:[[[br,br],(f,c)=>{let[A,g]=c;return A.evaluate(f)&&g.evaluate(f)}],[Es(br),(f,c)=>{for(const A of c)if(!A.evaluate(f))return!1;return!0}]]},any:{type:br,overloads:[[[br,br],(f,c)=>{let[A,g]=c;return A.evaluate(f)||g.evaluate(f)}],[Es(br),(f,c)=>{for(const A of c)if(A.evaluate(f))return!0;return!1}]]},"!":[br,[br],(f,c)=>{let[A]=c;return!A.evaluate(f)}],"is-supported-script":[br,[ir],(f,c)=>{let[A]=c;const g=f.globals&&f.globals.isSupportedScript;return!g||g(A.evaluate(f))}],upcase:[ir,[ir],(f,c)=>{let[A]=c;return A.evaluate(f).toUpperCase()}],downcase:[ir,[ir],(f,c)=>{let[A]=c;return A.evaluate(f).toLowerCase()}],concat:[ir,Es(Br),(f,c)=>c.map(A=>Au(A.evaluate(f))).join("")],"resolved-locale":[ir,[Sn],(f,c)=>{let[A]=c;return A.evaluate(f).resolvedLocale()}]});class bc{constructor(c,A){var g;this.expression=c,this._warningHistory={},this._evaluator=new Zn,this._defaultValue=A?(g=A).type==="color"&&yc(g.default)?new dn(0,0,0,0):g.type==="color"?dn.parse(g.default)||null:g.type==="padding"?ki.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?Bs.parse(g.default)||null:g.type==="projectionDefinition"?Wi.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=A&&A.type==="enum"?A.values:null}evaluateWithoutErrorHandling(c,A,g,b,B,T){return this._evaluator.globals=c,this._evaluator.feature=A,this._evaluator.featureState=g,this._evaluator.canonical=b,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(c,A,g,b,B,T){this._evaluator.globals=c,this._evaluator.feature=A||null,this._evaluator.featureState=g||null,this._evaluator.canonical=b,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=T||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Ql(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in $a}function Mu(f,c){const A=new Qa($a,Ul,[],c?function(b){const B={color:kr,string:ir,number:Rt,enum:ir,boolean:br,formatted:Ti,padding:Bn,projectionDefinition:en,resolvedImage:zn,variableAnchorOffsetCollection:Cn};return b.type==="array"?yi(B[b.value]||Br,b.length):B[b.type]}(c):void 0),g=A.parse(f,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?_c(new bc(g,c)):ta(A.errors)}class vc{constructor(c,A){this.kind=c,this._styleExpression=A,this.isStateDependent=c!=="constant"&&!Dl(A.expression)}evaluateWithoutErrorHandling(c,A,g,b,B,T){return this._styleExpression.evaluateWithoutErrorHandling(c,A,g,b,B,T)}evaluate(c,A,g,b,B,T){return this._styleExpression.evaluate(c,A,g,b,B,T)}}class Pu{constructor(c,A,g,b){this.kind=c,this.zoomStops=g,this._styleExpression=A,this.isStateDependent=c!=="camera"&&!Dl(A.expression),this.interpolationType=b}evaluateWithoutErrorHandling(c,A,g,b,B,T){return this._styleExpression.evaluateWithoutErrorHandling(c,A,g,b,B,T)}evaluate(c,A,g,b,B,T){return this._styleExpression.evaluate(c,A,g,b,B,T)}interpolationFactor(c,A,g){return this.interpolationType?In.interpolationFactor(this.interpolationType,c,A,g):0}}function zo(f,c){const A=Mu(f,c);if(A.result==="error")return A;const g=A.value.expression,b=Su(g);if(!b&&!Ca(c))return ta([new sr("","data expressions not supported")]);const B=fl(g,["zoom"]);if(!B&&!Iu(c))return ta([new sr("","zoom expressions not supported")]);const T=Fu(g);return T||B?T instanceof sr?ta([T]):T instanceof In&&!Nl(c)?ta([new sr("",'"interpolate" expressions cannot be used with this property')]):_c(T?new Pu(b?"camera":"composite",A.value,T.labels,T instanceof In?T.interpolation:void 0):new vc(b?"constant":"source",A.value)):ta([new sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Bo{constructor(c,A){this._parameters=c,this._specification=A,hr(this,ra(this._parameters,this._specification))}static deserialize(c){return new Bo(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function Fu(f){let c=null;if(f instanceof yn)c=Fu(f.result);else if(f instanceof ko){for(const A of f.args)if(c=Fu(A),c)break}else(f instanceof Ha||f instanceof In)&&f.input instanceof os&&f.input.name==="zoom"&&(c=f);return c instanceof sr||f.eachChild(A=>{const g=Fu(A);g instanceof sr?c=g:!c&&g?c=new sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&g&&c!==g&&(c=new sr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function ph(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(const c of f.slice(1))if(!ph(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const Wp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ru(f){if(f==null)return{filter:()=>!0,needGeometry:!1};ph(f)||(f=Jh(f));const c=Mu(f,Wp);if(c.result==="error")throw new Error(c.value.map(A=>`${A.key}: ${A.message}`).join(", "));return{filter:(A,g,b)=>c.value.evaluate(A,g,{},b),needGeometry:lf(f)}}function Zh(f,c){return f<c?-1:f>c?1:0}function lf(f){if(!Array.isArray(f))return!1;if(f[0]==="within"||f[0]==="distance")return!0;for(let c=1;c<f.length;c++)if(lf(f[c]))return!0;return!1}function Jh(f){if(!f)return!0;const c=f[0];return f.length<=1?c!=="any":c==="=="?gh(f[1],f[2],"=="):c==="!="?Lu(gh(f[1],f[2],"==")):c==="<"||c===">"||c==="<="||c===">="?gh(f[1],f[2],c):c==="any"?(A=f.slice(1),["any"].concat(A.map(Jh))):c==="all"?["all"].concat(f.slice(1).map(Jh)):c==="none"?["all"].concat(f.slice(1).map(Jh).map(Lu)):c==="in"?eA(f[1],f.slice(2)):c==="!in"?Lu(eA(f[1],f.slice(2))):c==="has"?mh(f[1]):c!=="!has"||Lu(mh(f[1]));var A}function gh(f,c,A){switch(f){case"$type":return[`filter-type-${A}`,c];case"$id":return[`filter-id-${A}`,c];default:return[`filter-${A}`,f,c]}}function eA(f,c){if(c.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(A=>typeof A!=typeof c[0])?["filter-in-large",f,["literal",c.sort(Zh)]]:["filter-in-small",f,["literal",c]]}}function mh(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function Lu(f){return["!",f]}function tA(f){const c=typeof f;if(c==="number"||c==="boolean"||c==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let b="[";for(const B of f)b+=`${tA(B)},`;return`${b}]`}const A=Object.keys(f).sort();let g="{";for(let b=0;b<A.length;b++)g+=`${JSON.stringify(A[b])}:${tA(f[A[b]])},`;return`${g}}`}function md(f){let c="";for(const A of ce)c+=`/${tA(f[A])}`;return c}function rA(f){const c=f.value;return c?[new We(f.key,c,"constants have been deprecated as of v8")]:[]}function wi(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function Ou(f){if(Array.isArray(f))return f.map(Ou);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){const c={};for(const A in f)c[A]=Ou(f[A]);return c}return wi(f)}function Ea(f){const c=f.key,A=f.value,g=f.valueSpec||{},b=f.objectElementValidators||{},B=f.style,T=f.styleSpec,I=f.validateSpec;let L=[];const k=gn(A);if(k!=="object")return[new We(c,A,`object expected, ${k} found`)];for(const j in A){const G=j.split(".")[0],re=g[G]||g["*"];let ie;if(b[G])ie=b[G];else if(g[G])ie=I;else if(b["*"])ie=b["*"];else{if(!g["*"]){L.push(new We(c,A[j],`unknown property "${j}"`));continue}ie=I}L=L.concat(ie({key:(c&&`${c}.`)+j,value:A[j],valueSpec:re,style:B,styleSpec:T,object:A,objectKey:j,validateSpec:I},A))}for(const j in g)b[j]||g[j].required&&g[j].default===void 0&&A[j]===void 0&&L.push(new We(c,A,`missing required property "${j}"`));return L}function _d(f){const c=f.value,A=f.valueSpec,g=f.style,b=f.styleSpec,B=f.key,T=f.arrayElementValidator||f.validateSpec;if(gn(c)!=="array")return[new We(B,c,`array expected, ${gn(c)} found`)];if(A.length&&c.length!==A.length)return[new We(B,c,`array length ${A.length} expected, length ${c.length} found`)];if(A["min-length"]&&c.length<A["min-length"])return[new We(B,c,`array length at least ${A["min-length"]} expected, length ${c.length} found`)];let I={type:A.value,values:A.values};b.$version<7&&(I.function=A.function),gn(A.value)==="object"&&(I=A.value);let L=[];for(let k=0;k<c.length;k++)L=L.concat(T({array:c,arrayIndex:k,value:c[k],valueSpec:I,validateSpec:f.validateSpec,style:g,styleSpec:b,key:`${B}[${k}]`}));return L}function yd(f){const c=f.key,A=f.value,g=f.valueSpec;let b=gn(A);return b==="number"&&A!=A&&(b="NaN"),b!=="number"?[new We(c,A,`number expected, ${b} found`)]:"minimum"in g&&A<g.minimum?[new We(c,A,`${A} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&A>g.maximum?[new We(c,A,`${A} is greater than the maximum value ${g.maximum}`)]:[]}function cf(f){const c=f.valueSpec,A=wi(f.value.type);let g,b,B,T={};const I=A!=="categorical"&&f.value.property===void 0,L=!I,k=gn(f.value.stops)==="array"&&gn(f.value.stops[0])==="array"&&gn(f.value.stops[0][0])==="object",j=Ea({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(ie){if(A==="identity")return[new We(ie.key,ie.value,'identity function may not have a "stops" property')];let le=[];const fe=ie.value;return le=le.concat(_d({key:ie.key,value:fe,valueSpec:ie.valueSpec,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:G})),gn(fe)==="array"&&fe.length===0&&le.push(new We(ie.key,fe,"array must have at least one stop")),le},default:function(ie){return ie.validateSpec({key:ie.key,value:ie.value,valueSpec:c,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec})}}});return A==="identity"&&I&&j.push(new We(f.key,f.value,'missing required property "property"')),A==="identity"||f.value.stops||j.push(new We(f.key,f.value,'missing required property "stops"')),A==="exponential"&&f.valueSpec.expression&&!Nl(f.valueSpec)&&j.push(new We(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(L&&!Ca(f.valueSpec)?j.push(new We(f.key,f.value,"property functions not supported")):I&&!Iu(f.valueSpec)&&j.push(new We(f.key,f.value,"zoom functions not supported"))),A!=="categorical"&&!k||f.value.property!==void 0||j.push(new We(f.key,f.value,'"property" property is required')),j;function G(ie){let le=[];const fe=ie.value,Se=ie.key;if(gn(fe)!=="array")return[new We(Se,fe,`array expected, ${gn(fe)} found`)];if(fe.length!==2)return[new We(Se,fe,`array length 2 expected, length ${fe.length} found`)];if(k){if(gn(fe[0])!=="object")return[new We(Se,fe,`object expected, ${gn(fe[0])} found`)];if(fe[0].zoom===void 0)return[new We(Se,fe,"object stop key must have zoom")];if(fe[0].value===void 0)return[new We(Se,fe,"object stop key must have value")];if(B&&B>wi(fe[0].zoom))return[new We(Se,fe[0].zoom,"stop zoom values must appear in ascending order")];wi(fe[0].zoom)!==B&&(B=wi(fe[0].zoom),b=void 0,T={}),le=le.concat(Ea({key:`${Se}[0]`,value:fe[0],valueSpec:{zoom:{}},validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:yd,value:re}}))}else le=le.concat(re({key:`${Se}[0]`,value:fe[0],validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec},fe));return Ql(Ou(fe[1]))?le.concat([new We(`${Se}[1]`,fe[1],"expressions are not allowed in function stops.")]):le.concat(ie.validateSpec({key:`${Se}[1]`,value:fe[1],valueSpec:c,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec}))}function re(ie,le){const fe=gn(ie.value),Se=wi(ie.value),Ie=ie.value!==null?ie.value:le;if(g){if(fe!==g)return[new We(ie.key,Ie,`${fe} stop domain type must match previous stop domain type ${g}`)]}else g=fe;if(fe!=="number"&&fe!=="string"&&fe!=="boolean")return[new We(ie.key,Ie,"stop domain value must be a number, string, or boolean")];if(fe!=="number"&&A!=="categorical"){let st=`number expected, ${fe} found`;return Ca(c)&&A===void 0&&(st+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(ie.key,Ie,st)]}return A!=="categorical"||fe!=="number"||isFinite(Se)&&Math.floor(Se)===Se?A!=="categorical"&&fe==="number"&&b!==void 0&&Se<b?[new We(ie.key,Ie,"stop domain values must appear in ascending order")]:(b=Se,A==="categorical"&&Se in T?[new We(ie.key,Ie,"stop domain values must be unique")]:(T[Se]=!0,[])):[new We(ie.key,Ie,`integer expected, found ${Se}`)]}}function wc(f){const c=(f.expressionContext==="property"?zo:Mu)(Ou(f.value),f.valueSpec);if(c.result==="error")return c.value.map(g=>new We(`${f.key}${g.key}`,f.value,g.message));const A=c.value.expression||c.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!A.outputDefined())return[new We(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!Dl(A))return[new We(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!Dl(A))return[new We(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!fl(A,["zoom","feature-state"]))return[new We(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!Su(A))return[new We(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dl(f){const c=f.key,A=f.value,g=f.valueSpec,b=[];return Array.isArray(g.values)?g.values.indexOf(wi(A))===-1&&b.push(new We(c,A,`expected one of [${g.values.join(", ")}], ${JSON.stringify(A)} found`)):Object.keys(g.values).indexOf(wi(A))===-1&&b.push(new We(c,A,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(A)} found`)),b}function uf(f){return ph(Ou(f.value))?wc(hr({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):nA(f)}function nA(f){const c=f.value,A=f.key;if(gn(c)!=="array")return[new We(A,c,`array expected, ${gn(c)} found`)];const g=f.styleSpec;let b,B=[];if(c.length<1)return[new We(A,c,"filter array must have at least 1 element")];switch(B=B.concat(dl({key:`${A}[0]`,value:c[0],valueSpec:g.filter_operator,style:f.style,styleSpec:f.styleSpec})),wi(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&wi(c[1])==="$type"&&B.push(new We(A,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&B.push(new We(A,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(b=gn(c[1]),b!=="string"&&B.push(new We(`${A}[1]`,c[1],`string expected, ${b} found`)));for(let T=2;T<c.length;T++)b=gn(c[T]),wi(c[1])==="$type"?B=B.concat(dl({key:`${A}[${T}]`,value:c[T],valueSpec:g.geometry_type,style:f.style,styleSpec:f.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&B.push(new We(`${A}[${T}]`,c[T],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let T=1;T<c.length;T++)B=B.concat(nA({key:`${A}[${T}]`,value:c[T],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":b=gn(c[1]),c.length!==2?B.push(new We(A,c,`filter array for "${c[0]}" operator must have 2 elements`)):b!=="string"&&B.push(new We(`${A}[1]`,c[1],`string expected, ${b} found`))}return B}function bd(f,c){const A=f.key,g=f.validateSpec,b=f.style,B=f.styleSpec,T=f.value,I=f.objectKey,L=B[`${c}_${f.layerType}`];if(!L)return[];const k=I.match(/^(.*)-transition$/);if(c==="paint"&&k&&L[k[1]]&&L[k[1]].transition)return g({key:A,value:T,valueSpec:B.transition,style:b,styleSpec:B});const j=f.valueSpec||L[I];if(!j)return[new We(A,T,`unknown property "${I}"`)];let G;if(gn(T)==="string"&&Ca(j)&&!j.tokens&&(G=/^{([^}]+)}$/.exec(T)))return[new We(A,T,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const re=[];return f.layerType==="symbol"&&(I==="text-field"&&b&&!b.glyphs&&re.push(new We(A,T,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&yc(Ou(T))&&wi(T.type)==="identity"&&re.push(new We(A,T,'"text-font" does not support identity functions'))),re.concat(g({key:f.key,value:T,valueSpec:j,style:b,styleSpec:B,expressionContext:"property",propertyType:c,propertyKey:I}))}function vd(f){return bd(f,"paint")}function wd(f){return bd(f,"layout")}function Xp(f){let c=[];const A=f.value,g=f.key,b=f.style,B=f.styleSpec;A.type||A.ref||c.push(new We(g,A,'either "type" or "ref" is required'));let T=wi(A.type);const I=wi(A.ref);if(A.id){const L=wi(A.id);for(let k=0;k<f.arrayIndex;k++){const j=b.layers[k];wi(j.id)===L&&c.push(new We(g,A.id,`duplicate layer id "${A.id}", previously used at line ${j.id.__line__}`))}}if("ref"in A){let L;["type","source","source-layer","filter","layout"].forEach(k=>{k in A&&c.push(new We(g,A[k],`"${k}" is prohibited for ref layers`))}),b.layers.forEach(k=>{wi(k.id)===I&&(L=k)}),L?L.ref?c.push(new We(g,A.ref,"ref cannot reference another ref layer")):T=wi(L.type):c.push(new We(g,A.ref,`ref layer "${I}" not found`))}else if(T!=="background")if(A.source){const L=b.sources&&b.sources[A.source],k=L&&wi(L.type);L?k==="vector"&&T==="raster"?c.push(new We(g,A.source,`layer "${A.id}" requires a raster source`)):k!=="raster-dem"&&T==="hillshade"?c.push(new We(g,A.source,`layer "${A.id}" requires a raster-dem source`)):k==="raster"&&T!=="raster"?c.push(new We(g,A.source,`layer "${A.id}" requires a vector source`)):k!=="vector"||A["source-layer"]?k==="raster-dem"&&T!=="hillshade"?c.push(new We(g,A.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!A.paint||!A.paint["line-gradient"]||k==="geojson"&&L.lineMetrics||c.push(new We(g,A,`layer "${A.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new We(g,A,`layer "${A.id}" must specify a "source-layer"`)):c.push(new We(g,A.source,`source "${A.source}" not found`))}else c.push(new We(g,A,'missing required property "source"'));return c=c.concat(Ea({key:g,value:A,valueSpec:B.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${g}.type`,value:A.type,valueSpec:B.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:A,objectKey:"type"}),filter:uf,layout:L=>Ea({layer:A,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":k=>wd(hr({layerType:T},k))}}),paint:L=>Ea({layer:A,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":k=>vd(hr({layerType:T},k))}})}})),c}function xc(f){const c=f.value,A=f.key,g=gn(c);return g!=="string"?[new We(A,c,`string expected, ${g} found`)]:[]}const pl={promoteId:function(f){let{key:c,value:A}=f;if(gn(A)==="string")return xc({key:c,value:A});{const g=[];for(const b in A)g.push(...xc({key:`${c}.${b}`,value:A[b]}));return g}}};function lo(f){const c=f.value,A=f.key,g=f.styleSpec,b=f.style,B=f.validateSpec;if(!c.type)return[new We(A,c,'"type" is required')];const T=wi(c.type);let I;switch(T){case"vector":case"raster":return I=Ea({key:A,value:c,valueSpec:g[`source_${T.replace("-","_")}`],style:f.style,styleSpec:g,objectElementValidators:pl,validateSpec:B}),I;case"raster-dem":return I=function(L){var k;const j=(k=L.sourceName)!==null&&k!==void 0?k:"",G=L.value,re=L.styleSpec,ie=re.source_raster_dem,le=L.style;let fe=[];const Se=gn(G);if(G===void 0)return fe;if(Se!=="object")return fe.push(new We("source_raster_dem",G,`object expected, ${Se} found`)),fe;const Ie=wi(G.encoding)==="custom",st=["redFactor","greenFactor","blueFactor","baseShift"],Qe=L.value.encoding?`"${L.value.encoding}"`:"Default";for(const ne in G)!Ie&&st.includes(ne)?fe.push(new We(ne,G[ne],`In "${j}": "${ne}" is only valid when "encoding" is set to "custom". ${Qe} encoding found`)):ie[ne]?fe=fe.concat(L.validateSpec({key:ne,value:G[ne],valueSpec:ie[ne],validateSpec:L.validateSpec,style:le,styleSpec:re})):fe.push(new We(ne,G[ne],`unknown property "${ne}"`));return fe}({sourceName:A,value:c,style:f.style,styleSpec:g,validateSpec:B}),I;case"geojson":if(I=Ea({key:A,value:c,valueSpec:g.source_geojson,style:b,styleSpec:g,validateSpec:B,objectElementValidators:pl}),c.cluster)for(const L in c.clusterProperties){const[k,j]=c.clusterProperties[L],G=typeof k=="string"?[k,["accumulated"],["get",L]]:k;I.push(...wc({key:`${A}.${L}.map`,value:j,expressionContext:"cluster-map"})),I.push(...wc({key:`${A}.${L}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return I;case"video":return Ea({key:A,value:c,valueSpec:g.source_video,style:b,validateSpec:B,styleSpec:g});case"image":return Ea({key:A,value:c,valueSpec:g.source_image,style:b,validateSpec:B,styleSpec:g});case"canvas":return[new We(A,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return dl({key:`${A}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function gl(f){const c=f.value,A=f.styleSpec,g=A.light,b=f.style;let B=[];const T=gn(c);if(c===void 0)return B;if(T!=="object")return B=B.concat([new We("light",c,`object expected, ${T} found`)]),B;for(const I in c){const L=I.match(/^(.*)-transition$/);B=B.concat(L&&g[L[1]]&&g[L[1]].transition?f.validateSpec({key:I,value:c[I],valueSpec:A.transition,validateSpec:f.validateSpec,style:b,styleSpec:A}):g[I]?f.validateSpec({key:I,value:c[I],valueSpec:g[I],validateSpec:f.validateSpec,style:b,styleSpec:A}):[new We(I,c[I],`unknown property "${I}"`)])}return B}function Yp(f){const c=f.value,A=f.styleSpec,g=A.sky,b=f.style,B=gn(c);if(c===void 0)return[];if(B!=="object")return[new We("sky",c,`object expected, ${B} found`)];let T=[];for(const I in c)T=T.concat(g[I]?f.validateSpec({key:I,value:c[I],valueSpec:g[I],style:b,styleSpec:A}):[new We(I,c[I],`unknown property "${I}"`)]);return T}function xd(f){const c=f.value,A=f.styleSpec,g=A.terrain,b=f.style;let B=[];const T=gn(c);if(c===void 0)return B;if(T!=="object")return B=B.concat([new We("terrain",c,`object expected, ${T} found`)]),B;for(const I in c)B=B.concat(g[I]?f.validateSpec({key:I,value:c[I],valueSpec:g[I],validateSpec:f.validateSpec,style:b,styleSpec:A}):[new We(I,c[I],`unknown property "${I}"`)]);return B}function zl(f){let c=[];const A=f.value,g=f.key;if(Array.isArray(A)){const b=[],B=[];for(const T in A)A[T].id&&b.includes(A[T].id)&&c.push(new We(g,A,`all the sprites' ids must be unique, but ${A[T].id} is duplicated`)),b.push(A[T].id),A[T].url&&B.includes(A[T].url)&&c.push(new We(g,A,`all the sprites' URLs must be unique, but ${A[T].url} is duplicated`)),B.push(A[T].url),c=c.concat(Ea({key:`${g}[${T}]`,value:A[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return c}return xc({key:g,value:A})}const na={"*":()=>[],array:_d,boolean:function(f){const c=f.value,A=f.key,g=gn(c);return g!=="boolean"?[new We(A,c,`boolean expected, ${g} found`)]:[]},number:yd,color:function(f){const c=f.key,A=f.value,g=gn(A);return g!=="string"?[new We(c,A,`color expected, ${g} found`)]:dn.parse(String(A))?[]:[new We(c,A,`color expected, "${A}" found`)]},constants:rA,enum:dl,filter:uf,function:cf,layer:Xp,object:Ea,source:lo,light:gl,sky:Yp,terrain:xd,projection:function(f){const c=f.value,A=f.styleSpec,g=A.projection,b=f.style,B=gn(c);if(c===void 0)return[];if(B!=="object")return[new We("projection",c,`object expected, ${B} found`)];let T=[];for(const I in c)T=T.concat(g[I]?f.validateSpec({key:I,value:c[I],valueSpec:g[I],style:b,styleSpec:A}):[new We(I,c[I],`unknown property "${I}"`)]);return T},projectionDefinition:function(f){const c=f.key;let A=f.value;A=A instanceof String?A.valueOf():A;const g=gn(A);return g!=="array"||function(b){return Array.isArray(b)&&b.length===3&&typeof b[0]=="string"&&typeof b[1]=="string"&&typeof b[2]=="number"}(A)||function(b){return!!["interpolate","step","literal"].includes(b[0])}(A)?["array","string"].includes(g)?[]:[new We(c,A,`projection expected, invalid type "${g}" found`)]:[new We(c,A,`projection expected, invalid array ${JSON.stringify(A)} found`)]},string:xc,formatted:function(f){return xc(f).length===0?[]:wc(f)},resolvedImage:function(f){return xc(f).length===0?[]:wc(f)},padding:function(f){const c=f.key,A=f.value;if(gn(A)==="array"){if(A.length<1||A.length>4)return[new We(c,A,`padding requires 1 to 4 values; ${A.length} values found`)];const g={type:"number"};let b=[];for(let B=0;B<A.length;B++)b=b.concat(f.validateSpec({key:`${c}[${B}]`,value:A[B],validateSpec:f.validateSpec,valueSpec:g}));return b}return yd({key:c,value:A,valueSpec:{}})},variableAnchorOffsetCollection:function(f){const c=f.key,A=f.value,g=gn(A),b=f.styleSpec;if(g!=="array"||A.length<1||A.length%2!=0)return[new We(c,A,"variableAnchorOffsetCollection requires a non-empty array of even length")];let B=[];for(let T=0;T<A.length;T+=2)B=B.concat(dl({key:`${c}[${T}]`,value:A[T],valueSpec:b.layout_symbol["text-anchor"]})),B=B.concat(_d({key:`${c}[${T+1}]`,value:A[T+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:b}));return B},sprite:zl};function hf(f){const c=f.value,A=f.valueSpec,g=f.styleSpec;return f.validateSpec=hf,A.expression&&yc(wi(c))?cf(f):A.expression&&Ql(Ou(c))?wc(f):A.type&&na[A.type]?na[A.type](f):Ea(hr({},f,{valueSpec:A.type?g[A.type]:A}))}function _h(f){const c=f.value,A=f.key,g=xc(f);return g.length||(c.indexOf("{fontstack}")===-1&&g.push(new We(A,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&g.push(new We(A,c,'"glyphs" url must include a "{range}" token'))),g}function co(f){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Be,A=[];return A=A.concat(hf({key:"",value:f,valueSpec:c.$root,styleSpec:c,style:f,validateSpec:hf,objectElementValidators:{glyphs:_h,"*":()=>[]}})),f.constants&&(A=A.concat(rA({key:"constants",value:f.constants}))),Uu(A)}function Qi(f){return function(c){return f({...c,validateSpec:hf})}}function Uu(f){return[].concat(f).sort((c,A)=>c.line-A.line)}function Sa(f){return function(){for(var c=arguments.length,A=new Array(c),g=0;g<c;g++)A[g]=arguments[g];return Uu(f.apply(this,A))}}co.source=Sa(Qi(lo)),co.sprite=Sa(Qi(zl)),co.glyphs=Sa(Qi(_h)),co.light=Sa(Qi(gl)),co.sky=Sa(Qi(Yp)),co.terrain=Sa(Qi(xd)),co.layer=Sa(Qi(Xp)),co.filter=Sa(Qi(uf)),co.paintProperty=Sa(Qi(vd)),co.layoutProperty=Sa(Qi(wd));const yh=co,Af=yh.light,Bc=yh.sky,bh=yh.paintProperty,iA=yh.layoutProperty;function Zp(f,c){let A=!1;if(c&&c.length)for(const g of c)f.fire(new un(new Error(g.message))),A=!0;return A}class Cc{constructor(c,A,g){const b=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const T=new Int32Array(this.arrayBuffer);c=T[0],this.d=(A=T[1])+2*(g=T[2]);for(let L=0;L<this.d*this.d;L++){const k=T[3+L],j=T[3+L+1];b.push(k===j?null:T.subarray(k,j))}const I=T[3+b.length+1];this.keys=T.subarray(T[3+b.length],I),this.bboxes=T.subarray(I),this.insert=this._insertReadonly}else{this.d=A+2*g;for(let T=0;T<this.d*this.d;T++)b.push([]);this.keys=[],this.bboxes=[]}this.n=A,this.extent=c,this.padding=g,this.scale=A/c,this.uid=0;const B=g/A*c;this.min=-B,this.max=c+B}insert(c,A,g,b,B){this._forEachCell(A,g,b,B,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(A),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(B)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,A,g,b,B,T){this.cells[B].push(T)}query(c,A,g,b,B){const T=this.min,I=this.max;if(c<=T&&A<=T&&I<=g&&I<=b&&!B)return Array.prototype.slice.call(this.keys);{const L=[];return this._forEachCell(c,A,g,b,this._queryCell,L,{},B),L}}_queryCell(c,A,g,b,B,T,I,L){const k=this.cells[B];if(k!==null){const j=this.keys,G=this.bboxes;for(let re=0;re<k.length;re++){const ie=k[re];if(I[ie]===void 0){const le=4*ie;(L?L(G[le+0],G[le+1],G[le+2],G[le+3]):c<=G[le+2]&&A<=G[le+3]&&g>=G[le+0]&&b>=G[le+1])?(I[ie]=!0,T.push(j[ie])):I[ie]=!1}}}}_forEachCell(c,A,g,b,B,T,I,L){const k=this._convertToCellCoord(c),j=this._convertToCellCoord(A),G=this._convertToCellCoord(g),re=this._convertToCellCoord(b);for(let ie=k;ie<=G;ie++)for(let le=j;le<=re;le++){const fe=this.d*le+ie;if((!L||L(this._convertFromCellCoord(ie),this._convertFromCellCoord(le),this._convertFromCellCoord(ie+1),this._convertFromCellCoord(le+1)))&&B.call(this,c,A,g,b,fe,T,I,L))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,A=3+this.cells.length+1+1;let g=0;for(let T=0;T<this.cells.length;T++)g+=this.cells[T].length;const b=new Int32Array(A+g+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let B=A;for(let T=0;T<c.length;T++){const I=c[T];b[3+T]=B,b.set(I,B),B+=I.length}return b[3+c.length]=B,b.set(this.keys,B),B+=this.keys.length,b[3+c.length+1]=B,b.set(this.bboxes,B),B+=this.bboxes.length,b.buffer}static serialize(c,A){const g=c.toArrayBuffer();return A&&A.push(g),{buffer:g}}static deserialize(c){return new Cc(c.buffer)}}const Hl={};function Mr(f,c){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Hl[f])throw new Error(`${f} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:f,writeable:!1}),Hl[f]={klass:c,omit:A.omit||[],shallow:A.shallow||[]}}Mr("Object",Object),Mr("TransferableGridIndex",Cc),Mr("Color",dn),Mr("Error",Error),Mr("AJAXError",Er),Mr("ResolvedImage",Si),Mr("StylePropertyFunction",Bo),Mr("StyleExpression",bc,{omit:["_evaluator"]}),Mr("ZoomDependentExpression",Pu),Mr("ZoomConstantExpression",vc),Mr("CompoundExpression",os,{omit:["_evaluate"]});for(const f in $a)$a[f]._classRegistryKey||Mr(`Expression_${f}`,$a[f]);function Jp(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function Du(f){return f.$name||f.constructor._classRegistryKey}function eg(f){return!function(c){if(c===null||typeof c!="object")return!1;const A=Du(c);return!(!A||A==="Object")}(f)&&(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||Jp(f)||Ot(f)||ArrayBuffer.isView(f)||f instanceof ImageData)}function sA(f,c){if(eg(f))return(Jp(f)||Ot(f))&&c&&c.push(f),ArrayBuffer.isView(f)&&c&&c.push(f.buffer),f instanceof ImageData&&c&&c.push(f.data.buffer),f;if(Array.isArray(f)){const B=[];for(const T of f)B.push(sA(T,c));return B}if(typeof f!="object")throw new Error("can't serialize object of type "+typeof f);const A=Du(f);if(!A)throw new Error(`can't serialize object of unregistered class ${f.constructor.name}`);if(!Hl[A])throw new Error(`${A} is not registered.`);const{klass:g}=Hl[A],b=g.serialize?g.serialize(f,c):{};if(g.serialize){if(c&&b===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const B in f){if(!f.hasOwnProperty(B)||Hl[A].omit.indexOf(B)>=0)continue;const T=f[B];b[B]=Hl[A].shallow.indexOf(B)>=0?T:sA(T,c)}f instanceof Error&&(b.message=f.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return A!=="Object"&&(b.$name=A),b}function Vl(f){if(eg(f))return f;if(Array.isArray(f))return f.map(Vl);if(typeof f!="object")throw new Error("can't deserialize object of type "+typeof f);const c=Du(f)||"Object";if(!Hl[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:A}=Hl[c];if(!A)throw new Error(`can't deserialize unregistered class ${c}`);if(A.deserialize)return A.deserialize(f);const g=Object.create(A.prototype);for(const b of Object.keys(f)){if(b==="$name")continue;const B=f[b];g[b]=Hl[c].shallow.indexOf(b)>=0?B:Vl(B)}return g}class oA{constructor(){this.first=!0}update(c,A){const g=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=A):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=A),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=g,!0))}}const bn={"Latin-1 Supplement":f=>f>=128&&f<=255,"Hangul Jamo":f=>f>=4352&&f<=4607,Khmer:f=>f>=6016&&f<=6143,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Hiragana:f=>f>=12352&&f<=12447,Katakana:f=>f>=12448&&f<=12543,Kanbun:f=>f>=12688&&f<=12703,"CJK Strokes":f=>f>=12736&&f<=12783,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"CJK Unified Ideographs":f=>f>=19968&&f<=40959,"Hangul Syllables":f=>f>=44032&&f<=55215,"Private Use Area":f=>f>=57344&&f<=63743,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function vh(f){for(const c of f)if(ue(c.charCodeAt(0)))return!0;return!1}function Bd(f){for(const c of f)if(!H(c.charCodeAt(0)))return!1;return!0}function E(f){const c=f.map(A=>{try{return new RegExp(`\\p{sc=${A}}`,"u").source}catch{return null}}).filter(A=>A);return new RegExp(c.join("|"),"u")}const F=E(["Arab","Dupl","Mong","Ougr","Syrc"]);function H(f){return!F.test(String.fromCodePoint(f))}const X=E(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ue(f){return!(f!==746&&f!==747&&(f<4352||!(bn["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||bn["CJK Compatibility"](f)||bn["CJK Strokes"](f)||!(!bn["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||bn["Enclosed CJK Letters and Months"](f)||bn["Ideographic Description Characters"](f)||bn.Kanbun(f)||bn.Katakana(f)&&f!==12540||!(!bn["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!bn["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||bn["Vertical Forms"](f)||bn["Yijing Hexagram Symbols"](f)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(f))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(f))||X.test(String.fromCodePoint(f)))))}function ye(f){return!(ue(f)||function(c){return!!(bn["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||bn["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||bn["Letterlike Symbols"](c)||bn["Number Forms"](c)||bn["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||bn["Control Pictures"](c)&&c!==9251||bn["Optical Character Recognition"](c)||bn["Enclosed Alphanumerics"](c)||bn["Geometric Shapes"](c)||bn["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||bn["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||bn["CJK Symbols and Punctuation"](c)||bn.Katakana(c)||bn["Private Use Area"](c)||bn["CJK Compatibility Forms"](c)||bn["Small Form Variants"](c)||bn["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(f))}const be=E(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function we(f){return be.test(String.fromCodePoint(f))}function Ee(f,c){return!(!c&&we(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||bn.Khmer(f))}function Oe(f){for(const c of f)if(we(c.charCodeAt(0)))return!0;return!1}const ot=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){if(ot.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(f,c){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(f.pluginStatus!=="loading")return this.setState(f),f;const A=f.pluginURL,g=new Promise(B=>{this.loadScriptResolve=B});c(A);const b=new Promise(B=>setTimeout(()=>B(),this.TIMEOUT));if(yield Promise.race([g,b]),this.isParsed()){const B={pluginStatus:"loaded",pluginURL:A};return this.setState(B),B}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${A}`)})}};class _t{constructor(c,A){this.zoom=c,A?(this.now=A.now,this.fadeDuration=A.fadeDuration,this.zoomHistory=A.zoomHistory,this.transition=A.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new oA,this.transition={})}isSupportedScript(c){return function(A,g){for(const b of A)if(!Ee(b.charCodeAt(0),g))return!1;return!0}(c,ot.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,A=c-Math.floor(c),g=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:A+(1-A)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*A}}}class St{constructor(c,A){this.property=c,this.value=A,this.expression=function(g,b){if(yc(g))return new Bo(g,b);if(Ql(g)){const B=zo(g,b);if(B.result==="error")throw new Error(B.value.map(T=>`${T.key}: ${T.message}`).join(", "));return B.value}{let B=g;return b.type==="color"&&typeof g=="string"?B=dn.parse(g):b.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(g)?B=Bs.parse(g):b.type==="projectionDefinition"&&typeof g=="string"&&(B=Wi.parse(g)):B=ki.parse(g),{kind:"constant",evaluate:()=>B}}}(A===void 0?c.specification.default:A,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,A,g){return this.property.possiblyEvaluate(this,c,A,g)}}class gt{constructor(c){this.property=c,this.value=new St(c,void 0)}transitioned(c,A){return new Qt(this.property,this.value,A,De({},c.transition,this.transition),c.now)}untransitioned(){return new Qt(this.property,this.value,null,{},0)}}class Yt{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return vt(this._values[c].value.value)}setValue(c,A){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new gt(this._values[c].property)),this._values[c].value=new St(this._values[c].property,A===null?void 0:vt(A))}getTransition(c){return vt(this._values[c].transition)}setTransition(c,A){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new gt(this._values[c].property)),this._values[c].transition=vt(A)||void 0}serialize(){const c={};for(const A of Object.keys(this._values)){const g=this.getValue(A);g!==void 0&&(c[A]=g);const b=this.getTransition(A);b!==void 0&&(c[`${A}-transition`]=b)}return c}transitioned(c,A){const g=new ut(this._properties);for(const b of Object.keys(this._values))g._values[b]=this._values[b].transitioned(c,A._values[b]);return g}untransitioned(){const c=new ut(this._properties);for(const A of Object.keys(this._values))c._values[A]=this._values[A].untransitioned();return c}}class Qt{constructor(c,A,g,b,B){this.property=c,this.value=A,this.begin=B+b.delay||0,this.end=this.begin+b.duration||0,c.specification.transition&&(b.delay||b.duration)&&(this.prior=g)}possiblyEvaluate(c,A,g){const b=c.now||0,B=this.value.possiblyEvaluate(c,A,g),T=this.prior;if(T){if(b>this.end)return this.prior=null,B;if(this.value.isDataDriven())return this.prior=null,B;if(b<this.begin)return T.possiblyEvaluate(c,A,g);{const I=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(c,A,g),B,At(I))}}return B}}class ut{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,A,g){const b=new er(this._properties);for(const B of Object.keys(this._values))b._values[B]=this._values[B].possiblyEvaluate(c,A,g);return b}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class ft{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return vt(this._values[c].value)}setValue(c,A){this._values[c]=new St(this._values[c].property,A===null?void 0:vt(A))}serialize(){const c={};for(const A of Object.keys(this._values)){const g=this.getValue(A);g!==void 0&&(c[A]=g)}return c}possiblyEvaluate(c,A,g){const b=new er(this._properties);for(const B of Object.keys(this._values))b._values[B]=this._values[B].possiblyEvaluate(c,A,g);return b}}class Gt{constructor(c,A,g){this.property=c,this.value=A,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,A,g,b){return this.property.evaluate(this.value,this.parameters,c,A,g,b)}}class er{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class wt{constructor(c){this.specification=c}possiblyEvaluate(c,A){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(A)}interpolate(c,A,g){const b=Jo[this.specification.type];return b?b(c,A,g):c}}class $t{constructor(c,A){this.specification=c,this.overrides=A}possiblyEvaluate(c,A,g,b){return new Gt(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(A,null,{},g,b)}:c.expression,A)}interpolate(c,A,g){if(c.value.kind!=="constant"||A.value.kind!=="constant")return c;if(c.value.value===void 0||A.value.value===void 0)return new Gt(this,{kind:"constant",value:void 0},c.parameters);const b=Jo[this.specification.type];if(b){const B=b(c.value.value,A.value.value,g);return new Gt(this,{kind:"constant",value:B},c.parameters)}return c}evaluate(c,A,g,b,B,T){return c.kind==="constant"?c.value:c.evaluate(A,g,b,B,T)}}class Ir extends $t{possiblyEvaluate(c,A,g,b){if(c.value===void 0)return new Gt(this,{kind:"constant",value:void 0},A);if(c.expression.kind==="constant"){const B=c.expression.evaluate(A,null,{},g,b),T=c.property.specification.type==="resolvedImage"&&typeof B!="string"?B.name:B,I=this._calculate(T,T,T,A);return new Gt(this,{kind:"constant",value:I},A)}if(c.expression.kind==="camera"){const B=this._calculate(c.expression.evaluate({zoom:A.zoom-1}),c.expression.evaluate({zoom:A.zoom}),c.expression.evaluate({zoom:A.zoom+1}),A);return new Gt(this,{kind:"constant",value:B},A)}return new Gt(this,c.expression,A)}evaluate(c,A,g,b,B,T){if(c.kind==="source"){const I=c.evaluate(A,g,b,B,T);return this._calculate(I,I,I,A)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(A.zoom)-1},g,b),c.evaluate({zoom:Math.floor(A.zoom)},g,b),c.evaluate({zoom:Math.floor(A.zoom)+1},g,b),A):c.value}_calculate(c,A,g,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:A}:{from:g,to:A}}interpolate(c){return c}}class Zr{constructor(c){this.specification=c}possiblyEvaluate(c,A,g,b){if(c.value!==void 0){if(c.expression.kind==="constant"){const B=c.expression.evaluate(A,null,{},g,b);return this._calculate(B,B,B,A)}return this._calculate(c.expression.evaluate(new _t(Math.floor(A.zoom-1),A)),c.expression.evaluate(new _t(Math.floor(A.zoom),A)),c.expression.evaluate(new _t(Math.floor(A.zoom+1),A)),A)}}_calculate(c,A,g,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:A}:{from:g,to:A}}interpolate(c){return c}}class Fr{constructor(c){this.specification=c}possiblyEvaluate(c,A,g,b){return!!c.expression.evaluate(A,null,{},g,b)}interpolate(){return!1}}class fn{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const A in c){const g=c[A];g.specification.overridable&&this.overridableProperties.push(A);const b=this.defaultPropertyValues[A]=new St(g,void 0),B=this.defaultTransitionablePropertyValues[A]=new gt(g);this.defaultTransitioningPropertyValues[A]=B.untransitioned(),this.defaultPossiblyEvaluatedValues[A]=b.possiblyEvaluate({})}}}Mr("DataDrivenProperty",$t),Mr("DataConstantProperty",wt),Mr("CrossFadedDataDrivenProperty",Ir),Mr("CrossFadedProperty",Zr),Mr("ColorRampProperty",Fr);const Gn="-transition";class mn extends ni{constructor(c,A){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),A.layout&&(this._unevaluatedLayout=new ft(A.layout)),A.paint)){this._transitionablePaint=new Yt(A.paint);for(const g in c.paint)this.setPaintProperty(g,c.paint[g],{validate:!1});for(const g in c.layout)this.setLayoutProperty(g,c.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new er(A.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,A){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};A!=null&&this._validate(iA,`layers.${this.id}.layout.${c}`,c,A,g)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,A):this.visibility=A)}getPaintProperty(c){return c.endsWith(Gn)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,A){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(A!=null&&this._validate(bh,`layers.${this.id}.paint.${c}`,c,A,g))return!1;if(c.endsWith(Gn))return this._transitionablePaint.setTransition(c.slice(0,-11),A||void 0),!1;{const b=this._transitionablePaint._values[c],B=b.property.specification["property-type"]==="cross-faded-data-driven",T=b.value.isDataDriven(),I=b.value;this._transitionablePaint.setValue(c,A),this._handleSpecialPaintPropertyUpdate(c);const L=this._transitionablePaint._values[c].value;return L.isDataDriven()||T||B||this._handleOverridablePaintPropertyUpdate(c,I,L)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,A,g){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,A){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,A)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,A)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),xt(c,(A,g)=>!(A===void 0||g==="layout"&&!Object.keys(A).length||g==="paint"&&!Object.keys(A).length))}_validate(c,A,g,b){let B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!B||B.validate!==!1)&&Zp(this,c.call(yh,{key:A,layerType:this.type,objectKey:g,value:b,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const A=this.paint.get(c);if(A instanceof Gt&&Ca(A.property.specification)&&(A.value.kind==="source"||A.value.kind==="composite")&&A.value.isStateDependent)return!0}return!1}}const Ln={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vn{constructor(c,A){this._structArray=c,this._pos1=A*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,A){return c._trim(),A&&(c.isTransferred=!0,A.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const A=Object.create(this.prototype);return A.arrayBuffer=c.arrayBuffer,A.length=c.length,A.capacity=c.arrayBuffer.byteLength/A.bytesPerElement,A._refreshViews(),A}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const A=this.uint8;this._refreshViews(),A&&this.uint8.set(A)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gr(f){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,A=0,g=0;return{members:f.map(b=>{const B=Ln[b.type].BYTES_PER_ELEMENT,T=A=Zi(A,Math.max(c,B)),I=b.components||1;return g=Math.max(g,B),A+=B*I,{name:b.name,type:b.type,components:I,offset:T}}),size:Zi(A,Math.max(g,c)),alignment:c}}function Zi(f,c){return Math.ceil(f/c)*c}class Ss extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,A){const g=this.length;return this.resize(g+1),this.emplace(g,c,A)}emplace(c,A,g){const b=2*c;return this.int16[b+0]=A,this.int16[b+1]=g,c}}Ss.prototype.bytesPerElement=4,Mr("StructArrayLayout2i4",Ss);class Ii extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,A,g){const b=this.length;return this.resize(b+1),this.emplace(b,c,A,g)}emplace(c,A,g,b){const B=3*c;return this.int16[B+0]=A,this.int16[B+1]=g,this.int16[B+2]=b,c}}Ii.prototype.bytesPerElement=6,Mr("StructArrayLayout3i6",Ii);class uo extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,A,g,b){const B=this.length;return this.resize(B+1),this.emplace(B,c,A,g,b)}emplace(c,A,g,b,B){const T=4*c;return this.int16[T+0]=A,this.int16[T+1]=g,this.int16[T+2]=b,this.int16[T+3]=B,c}}uo.prototype.bytesPerElement=8,Mr("StructArrayLayout4i8",uo);class jn extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B,T){const I=this.length;return this.resize(I+1),this.emplace(I,c,A,g,b,B,T)}emplace(c,A,g,b,B,T,I){const L=6*c;return this.int16[L+0]=A,this.int16[L+1]=g,this.int16[L+2]=b,this.int16[L+3]=B,this.int16[L+4]=T,this.int16[L+5]=I,c}}jn.prototype.bytesPerElement=12,Mr("StructArrayLayout2i4i12",jn);class Ji extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B,T){const I=this.length;return this.resize(I+1),this.emplace(I,c,A,g,b,B,T)}emplace(c,A,g,b,B,T,I){const L=4*c,k=8*c;return this.int16[L+0]=A,this.int16[L+1]=g,this.uint8[k+4]=b,this.uint8[k+5]=B,this.uint8[k+6]=T,this.uint8[k+7]=I,c}}Ji.prototype.bytesPerElement=8,Mr("StructArrayLayout2i4ub8",Ji);class Is extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,A){const g=this.length;return this.resize(g+1),this.emplace(g,c,A)}emplace(c,A,g){const b=2*c;return this.float32[b+0]=A,this.float32[b+1]=g,c}}Is.prototype.bytesPerElement=8,Mr("StructArrayLayout2f8",Is);class Gi extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B,T,I,L,k,j){const G=this.length;return this.resize(G+1),this.emplace(G,c,A,g,b,B,T,I,L,k,j)}emplace(c,A,g,b,B,T,I,L,k,j,G){const re=10*c;return this.uint16[re+0]=A,this.uint16[re+1]=g,this.uint16[re+2]=b,this.uint16[re+3]=B,this.uint16[re+4]=T,this.uint16[re+5]=I,this.uint16[re+6]=L,this.uint16[re+7]=k,this.uint16[re+8]=j,this.uint16[re+9]=G,c}}Gi.prototype.bytesPerElement=20,Mr("StructArrayLayout10ui20",Gi);class ls extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B,T,I,L,k,j,G,re){const ie=this.length;return this.resize(ie+1),this.emplace(ie,c,A,g,b,B,T,I,L,k,j,G,re)}emplace(c,A,g,b,B,T,I,L,k,j,G,re,ie){const le=12*c;return this.int16[le+0]=A,this.int16[le+1]=g,this.int16[le+2]=b,this.int16[le+3]=B,this.uint16[le+4]=T,this.uint16[le+5]=I,this.uint16[le+6]=L,this.uint16[le+7]=k,this.int16[le+8]=j,this.int16[le+9]=G,this.int16[le+10]=re,this.int16[le+11]=ie,c}}ls.prototype.bytesPerElement=24,Mr("StructArrayLayout4i4ui4i24",ls);class fs extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,A,g){const b=this.length;return this.resize(b+1),this.emplace(b,c,A,g)}emplace(c,A,g,b){const B=3*c;return this.float32[B+0]=A,this.float32[B+1]=g,this.float32[B+2]=b,c}}fs.prototype.bytesPerElement=12,Mr("StructArrayLayout3f12",fs);class Ho extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const A=this.length;return this.resize(A+1),this.emplace(A,c)}emplace(c,A){return this.uint32[1*c+0]=A,c}}Ho.prototype.bytesPerElement=4,Mr("StructArrayLayout1ul4",Ho);class Co extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B,T,I,L,k){const j=this.length;return this.resize(j+1),this.emplace(j,c,A,g,b,B,T,I,L,k)}emplace(c,A,g,b,B,T,I,L,k,j){const G=10*c,re=5*c;return this.int16[G+0]=A,this.int16[G+1]=g,this.int16[G+2]=b,this.int16[G+3]=B,this.int16[G+4]=T,this.int16[G+5]=I,this.uint32[re+3]=L,this.uint16[G+8]=k,this.uint16[G+9]=j,c}}Co.prototype.bytesPerElement=20,Mr("StructArrayLayout6i1ul2ui20",Co);class Mi extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B,T){const I=this.length;return this.resize(I+1),this.emplace(I,c,A,g,b,B,T)}emplace(c,A,g,b,B,T,I){const L=6*c;return this.int16[L+0]=A,this.int16[L+1]=g,this.int16[L+2]=b,this.int16[L+3]=B,this.int16[L+4]=T,this.int16[L+5]=I,c}}Mi.prototype.bytesPerElement=12,Mr("StructArrayLayout2i2i2i12",Mi);class Ga extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B){const T=this.length;return this.resize(T+1),this.emplace(T,c,A,g,b,B)}emplace(c,A,g,b,B,T){const I=4*c,L=8*c;return this.float32[I+0]=A,this.float32[I+1]=g,this.float32[I+2]=b,this.int16[L+6]=B,this.int16[L+7]=T,c}}Ga.prototype.bytesPerElement=16,Mr("StructArrayLayout2f1f2i16",Ga);class ml extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B,T){const I=this.length;return this.resize(I+1),this.emplace(I,c,A,g,b,B,T)}emplace(c,A,g,b,B,T,I){const L=16*c,k=4*c,j=8*c;return this.uint8[L+0]=A,this.uint8[L+1]=g,this.float32[k+1]=b,this.float32[k+2]=B,this.int16[j+6]=T,this.int16[j+7]=I,c}}ml.prototype.bytesPerElement=16,Mr("StructArrayLayout2ub2f2i16",ml);class ia extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,A,g){const b=this.length;return this.resize(b+1),this.emplace(b,c,A,g)}emplace(c,A,g,b){const B=3*c;return this.uint16[B+0]=A,this.uint16[B+1]=g,this.uint16[B+2]=b,c}}ia.prototype.bytesPerElement=6,Mr("StructArrayLayout3ui6",ia);class _l extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B,T,I,L,k,j,G,re,ie,le,fe,Se,Ie){const st=this.length;return this.resize(st+1),this.emplace(st,c,A,g,b,B,T,I,L,k,j,G,re,ie,le,fe,Se,Ie)}emplace(c,A,g,b,B,T,I,L,k,j,G,re,ie,le,fe,Se,Ie,st){const Qe=24*c,ne=12*c,Ce=48*c;return this.int16[Qe+0]=A,this.int16[Qe+1]=g,this.uint16[Qe+2]=b,this.uint16[Qe+3]=B,this.uint32[ne+2]=T,this.uint32[ne+3]=I,this.uint32[ne+4]=L,this.uint16[Qe+10]=k,this.uint16[Qe+11]=j,this.uint16[Qe+12]=G,this.float32[ne+7]=re,this.float32[ne+8]=ie,this.uint8[Ce+36]=le,this.uint8[Ce+37]=fe,this.uint8[Ce+38]=Se,this.uint32[ne+10]=Ie,this.int16[Qe+22]=st,c}}_l.prototype.bytesPerElement=48,Mr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_l);class Pi extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,A,g,b,B,T,I,L,k,j,G,re,ie,le,fe,Se,Ie,st,Qe,ne,Ce,He,Tt,Wt,Ft,Nt,lr,Zt){const fr=this.length;return this.resize(fr+1),this.emplace(fr,c,A,g,b,B,T,I,L,k,j,G,re,ie,le,fe,Se,Ie,st,Qe,ne,Ce,He,Tt,Wt,Ft,Nt,lr,Zt)}emplace(c,A,g,b,B,T,I,L,k,j,G,re,ie,le,fe,Se,Ie,st,Qe,ne,Ce,He,Tt,Wt,Ft,Nt,lr,Zt,fr){const zt=32*c,Ur=16*c;return this.int16[zt+0]=A,this.int16[zt+1]=g,this.int16[zt+2]=b,this.int16[zt+3]=B,this.int16[zt+4]=T,this.int16[zt+5]=I,this.int16[zt+6]=L,this.int16[zt+7]=k,this.uint16[zt+8]=j,this.uint16[zt+9]=G,this.uint16[zt+10]=re,this.uint16[zt+11]=ie,this.uint16[zt+12]=le,this.uint16[zt+13]=fe,this.uint16[zt+14]=Se,this.uint16[zt+15]=Ie,this.uint16[zt+16]=st,this.uint16[zt+17]=Qe,this.uint16[zt+18]=ne,this.uint16[zt+19]=Ce,this.uint16[zt+20]=He,this.uint16[zt+21]=Tt,this.uint16[zt+22]=Wt,this.uint32[Ur+12]=Ft,this.float32[Ur+13]=Nt,this.float32[Ur+14]=lr,this.uint16[zt+30]=Zt,this.uint16[zt+31]=fr,c}}Pi.prototype.bytesPerElement=64,Mr("StructArrayLayout8i15ui1ul2f2ui64",Pi);class Nu extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const A=this.length;return this.resize(A+1),this.emplace(A,c)}emplace(c,A){return this.float32[1*c+0]=A,c}}Nu.prototype.bytesPerElement=4,Mr("StructArrayLayout1f4",Nu);class ff extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,A,g){const b=this.length;return this.resize(b+1),this.emplace(b,c,A,g)}emplace(c,A,g,b){const B=3*c;return this.uint16[6*c+0]=A,this.float32[B+1]=g,this.float32[B+2]=b,c}}ff.prototype.bytesPerElement=12,Mr("StructArrayLayout1ui2f12",ff);class x extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,A,g){const b=this.length;return this.resize(b+1),this.emplace(b,c,A,g)}emplace(c,A,g,b){const B=4*c;return this.uint32[2*c+0]=A,this.uint16[B+2]=g,this.uint16[B+3]=b,c}}x.prototype.bytesPerElement=8,Mr("StructArrayLayout1ul2ui8",x);class l extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,A){const g=this.length;return this.resize(g+1),this.emplace(g,c,A)}emplace(c,A,g){const b=2*c;return this.uint16[b+0]=A,this.uint16[b+1]=g,c}}l.prototype.bytesPerElement=4,Mr("StructArrayLayout2ui4",l);class h extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const A=this.length;return this.resize(A+1),this.emplace(A,c)}emplace(c,A){return this.uint16[1*c+0]=A,c}}h.prototype.bytesPerElement=2,Mr("StructArrayLayout1ui2",h);class m extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,A,g,b){const B=this.length;return this.resize(B+1),this.emplace(B,c,A,g,b)}emplace(c,A,g,b,B){const T=4*c;return this.float32[T+0]=A,this.float32[T+1]=g,this.float32[T+2]=b,this.float32[T+3]=B,c}}m.prototype.bytesPerElement=16,Mr("StructArrayLayout4f16",m);class y extends Vn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class C extends Co{get(c){return new y(this,c)}}Mr("CollisionBoxArray",C);class S extends Vn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}S.prototype.size=48;class R extends _l{get(c){return new S(this,c)}}Mr("PlacedSymbolArray",R);class O extends Vn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}O.prototype.size=64;class Q extends Pi{get(c){return new O(this,c)}}Mr("SymbolInstanceArray",Q);class K extends Nu{getoffsetX(c){return this.float32[1*c+0]}}Mr("GlyphOffsetArray",K);class Z extends Ii{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}Mr("SymbolLineVertexArray",Z);class ee extends Vn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ee.prototype.size=12;class Ae extends ff{get(c){return new ee(this,c)}}Mr("TextAnchorOffsetArray",Ae);class pe extends Vn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}pe.prototype.size=8;class Fe extends x{get(c){return new pe(this,c)}}Mr("FeatureIndexArray",Fe);class Me extends Ss{}class Re extends Ss{}class Ne extends Ss{}class $e extends jn{}class qe extends Ji{}class Xe extends Is{}class tt extends Gi{}class it extends ls{}class Et extends fs{}class Ct extends Ho{}class Dt extends Mi{}class Ht extends ml{}class Lt extends ia{}class dr extends l{}const Ar=Gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Kt}=Ar;class xr{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this._forceNewSegmentOnNextPrepare=!1,this.segments=c}prepareSegment(c,A,g,b){const B=this.segments[this.segments.length-1];return c>xr.MAX_VERTEX_ARRAY_LENGTH&&qt(`Max vertices per segment is ${xr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${xr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!B||B.vertexLength+c>xr.MAX_VERTEX_ARRAY_LENGTH||B.sortKey!==b?this.createNewSegment(A,g,b):B}createNewSegment(c,A,g){const b={vertexOffset:c.length,primitiveOffset:A.length,vertexLength:0,primitiveLength:0,vaos:{}};return g!==void 0&&(b.sortKey=g),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(b),b}getOrCreateLatestSegment(c,A,g){return this.prepareSegment(0,c,A,g)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const c of this.segments)for(const A in c.vaos)c.vaos[A].destroy()}static simpleSegment(c,A,g,b){return new xr([{vertexOffset:c,primitiveOffset:A,vertexLength:g,primitiveLength:b,vaos:{},sortKey:0}])}}function sn(f,c){return 256*(f=Te(Math.floor(f),0,255))+Te(Math.floor(c),0,255)}xr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mr("SegmentVector",xr);const Mn=Gr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var gi,ei,mi,Dn={exports:{}},qn={exports:{}},Kn={exports:{}},Xs=function(){if(mi)return Dn.exports;mi=1;var f=(gi||(gi=1,qn.exports=function(A,g){var b,B,T,I,L,k,j,G;for(B=A.length-(b=3&A.length),T=g,L=3432918353,k=461845907,G=0;G<B;)j=255&A.charCodeAt(G)|(255&A.charCodeAt(++G))<<8|(255&A.charCodeAt(++G))<<16|(255&A.charCodeAt(++G))<<24,++G,T=27492+(65535&(I=5*(65535&(T=(T^=j=(65535&(j=(j=(65535&j)*L+(((j>>>16)*L&65535)<<16)&4294967295)<<15|j>>>17))*k+(((j>>>16)*k&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(I>>>16)&65535)<<16);switch(j=0,b){case 3:j^=(255&A.charCodeAt(G+2))<<16;case 2:j^=(255&A.charCodeAt(G+1))<<8;case 1:T^=j=(65535&(j=(j=(65535&(j^=255&A.charCodeAt(G)))*L+(((j>>>16)*L&65535)<<16)&4294967295)<<15|j>>>17))*k+(((j>>>16)*k&65535)<<16)&4294967295}return T^=A.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0}),qn.exports),c=(ei||(ei=1,Kn.exports=function(A,g){for(var b,B=A.length,T=g^B,I=0;B>=4;)b=1540483477*(65535&(b=255&A.charCodeAt(I)|(255&A.charCodeAt(++I))<<8|(255&A.charCodeAt(++I))<<16|(255&A.charCodeAt(++I))<<24))+((1540483477*(b>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(b=1540483477*(65535&(b^=b>>>24))+((1540483477*(b>>>16)&65535)<<16)),B-=4,++I;switch(B){case 3:T^=(255&A.charCodeAt(I+2))<<16;case 2:T^=(255&A.charCodeAt(I+1))<<8;case 1:T=1540483477*(65535&(T^=255&A.charCodeAt(I)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0}),Kn.exports);return Dn.exports=f,Dn.exports.murmur3=f,Dn.exports.murmur2=c,Dn.exports}(),es=u(Xs);class cs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,A,g,b){this.ids.push(ds(c)),this.positions.push(A,g,b)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const A=ds(c);let g=0,b=this.ids.length-1;for(;g<b;){const T=g+b>>1;this.ids[T]>=A?b=T:g=T+1}const B=[];for(;this.ids[g]===A;)B.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return B}static serialize(c,A){const g=new Float64Array(c.ids),b=new Uint32Array(c.positions);return qa(g,b,0,g.length-1),A&&A.push(g.buffer,b.buffer),{ids:g,positions:b}}static deserialize(c){const A=new cs;return A.ids=c.ids,A.positions=c.positions,A.indexed=!0,A}}function ds(f){const c=+f;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:es(String(f))}function qa(f,c,A,g){for(;A<g;){const b=f[A+g>>1];let B=A-1,T=g+1;for(;;){do B++;while(f[B]<b);do T--;while(f[T]>b);if(B>=T)break;sa(f,B,T),sa(c,3*B,3*T),sa(c,3*B+1,3*T+1),sa(c,3*B+2,3*T+2)}T-A<g-T?(qa(f,c,A,T),A=T+1):(qa(f,c,T+1,g),g=T)}}function sa(f,c,A){const g=f[c];f[c]=f[A],f[A]=g}Mr("FeaturePositionMap",cs);class ts{constructor(c,A){this.gl=c.gl,this.location=A}}class ho extends ts{constructor(c,A){super(c,A),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Ia extends ts{constructor(c,A){super(c,A),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class Tc extends ts{constructor(c,A){super(c,A),this.current=dn.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const Ec=new Float32Array(16);function To(f){return[sn(255*f.r,255*f.g),sn(255*f.b,255*f.a)]}class Ma{constructor(c,A,g){this.value=c,this.uniformNames=A.map(b=>`u_${b}`),this.type=g}setUniform(c,A,g){c.set(g.constantOr(this.value))}getBinding(c,A,g){return this.type==="color"?new Tc(c,A):new ho(c,A)}}class Vo{constructor(c,A){this.uniformNames=A.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,A){this.pixelRatioFrom=A.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=A.tlbr,this.patternTo=c.tlbr}setUniform(c,A,g,b){const B=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;B&&c.set(B)}getBinding(c,A,g){return g.substr(0,9)==="u_pattern"?new Ia(c,A):new ho(c,A)}}class Eo{constructor(c,A,g,b){this.expression=c,this.type=g,this.maxValue=0,this.paintVertexAttributes=A.map(B=>({name:`a_${B}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(c,A,g,b,B){const T=this.paintVertexArray.length,I=this.expression.evaluate(new _t(0),A,{},b,[],B);this.paintVertexArray.resize(c),this._setPaintValue(T,c,I)}updatePaintArray(c,A,g,b){const B=this.expression.evaluate({zoom:0},g,b);this._setPaintValue(c,A,B)}_setPaintValue(c,A,g){if(this.type==="color"){const b=To(g);for(let B=c;B<A;B++)this.paintVertexArray.emplace(B,b[0],b[1])}else{for(let b=c;b<A;b++)this.paintVertexArray.emplace(b,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ci{constructor(c,A,g,b,B,T){this.expression=c,this.uniformNames=A.map(I=>`u_${I}_t`),this.type=g,this.useIntegerZoom=b,this.zoom=B,this.maxValue=0,this.paintVertexAttributes=A.map(I=>({name:`a_${I}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(c,A,g,b,B){const T=this.expression.evaluate(new _t(this.zoom),A,{},b,[],B),I=this.expression.evaluate(new _t(this.zoom+1),A,{},b,[],B),L=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(L,c,T,I)}updatePaintArray(c,A,g,b){const B=this.expression.evaluate({zoom:this.zoom},g,b),T=this.expression.evaluate({zoom:this.zoom+1},g,b);this._setPaintValue(c,A,B,T)}_setPaintValue(c,A,g,b){if(this.type==="color"){const B=To(g),T=To(b);for(let I=c;I<A;I++)this.paintVertexArray.emplace(I,B[0],B[1],T[0],T[1])}else{for(let B=c;B<A;B++)this.paintVertexArray.emplace(B,g,b);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(b))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,A){const g=this.useIntegerZoom?Math.floor(A.zoom):A.zoom,b=Te(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);c.set(b)}getBinding(c,A,g){return new ho(c,A)}}class zi{constructor(c,A,g,b,B,T){this.expression=c,this.type=A,this.useIntegerZoom=g,this.zoom=b,this.layerId=T,this.zoomInPaintVertexArray=new B,this.zoomOutPaintVertexArray=new B}populatePaintArray(c,A,g){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(b,c,A.patterns&&A.patterns[this.layerId],g)}updatePaintArray(c,A,g,b,B){this._setPaintValues(c,A,g.patterns&&g.patterns[this.layerId],B)}_setPaintValues(c,A,g,b){if(!b||!g)return;const{min:B,mid:T,max:I}=g,L=b[B],k=b[T],j=b[I];if(L&&k&&j)for(let G=c;G<A;G++)this.zoomInPaintVertexArray.emplace(G,k.tl[0],k.tl[1],k.br[0],k.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],k.pixelRatio,L.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,k.tl[0],k.tl[1],k.br[0],k.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],k.pixelRatio,j.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,Mn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,Mn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ka{constructor(c,A,g){this.binders={},this._buffers=[];const b=[];for(const B in c.paint._values){if(!g(B))continue;const T=c.paint.get(B);if(!(T instanceof Gt&&Ca(T.property.specification)))continue;const I=z3(B,c.type),L=T.value,k=T.property.specification.type,j=T.property.useIntegerZoom,G=T.property.specification["property-type"],re=G==="cross-faded"||G==="cross-faded-data-driven";if(L.kind==="constant")this.binders[B]=re?new Vo(L.value,I):new Ma(L.value,I,k),b.push(`/u_${B}`);else if(L.kind==="source"||re){const ie=Fb(B,k,"source");this.binders[B]=re?new zi(L,k,j,A,ie,c.id):new Eo(L,I,k,ie),b.push(`/a_${B}`)}else{const ie=Fb(B,k,"composite");this.binders[B]=new ci(L,I,k,j,A,ie),b.push(`/z_${B}`)}}this.cacheKey=b.sort().join("")}getMaxValue(c){const A=this.binders[c];return A instanceof Eo||A instanceof ci?A.maxValue:0}populatePaintArrays(c,A,g,b,B){for(const T in this.binders){const I=this.binders[T];(I instanceof Eo||I instanceof ci||I instanceof zi)&&I.populatePaintArray(c,A,g,b,B)}}setConstantPatternPositions(c,A){for(const g in this.binders){const b=this.binders[g];b instanceof Vo&&b.setConstantPatternPositions(c,A)}}updatePaintArrays(c,A,g,b,B){let T=!1;for(const I in c){const L=A.getPositions(I);for(const k of L){const j=g.feature(k.index);for(const G in this.binders){const re=this.binders[G];if((re instanceof Eo||re instanceof ci||re instanceof zi)&&re.expression.isStateDependent===!0){const ie=b.paint.get(G);re.expression=ie.value,re.updatePaintArray(k.start,k.end,j,c[I],B),T=!0}}}}return T}defines(){const c=[];for(const A in this.binders){const g=this.binders[A];(g instanceof Ma||g instanceof Vo)&&c.push(...g.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return c}getBinderAttributes(){const c=[];for(const A in this.binders){const g=this.binders[A];if(g instanceof Eo||g instanceof ci)for(let b=0;b<g.paintVertexAttributes.length;b++)c.push(g.paintVertexAttributes[b].name);else if(g instanceof zi)for(let b=0;b<Mn.members.length;b++)c.push(Mn.members[b].name)}return c}getBinderUniforms(){const c=[];for(const A in this.binders){const g=this.binders[A];if(g instanceof Ma||g instanceof Vo||g instanceof ci)for(const b of g.uniformNames)c.push(b)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,A){const g=[];for(const b in this.binders){const B=this.binders[b];if(B instanceof Ma||B instanceof Vo||B instanceof ci){for(const T of B.uniformNames)if(A[T]){const I=B.getBinding(c,A[T],T);g.push({name:T,property:b,binding:I})}}}return g}setUniforms(c,A,g,b){for(const{name:B,property:T,binding:I}of A)this.binders[T].setUniform(I,b,g.get(T),B)}updatePaintBuffers(c){this._buffers=[];for(const A in this.binders){const g=this.binders[A];if(c&&g instanceof zi){const b=c.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(g instanceof Eo||g instanceof ci)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(c){for(const A in this.binders){const g=this.binders[A];(g instanceof Eo||g instanceof ci||g instanceof zi)&&g.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const A=this.binders[c];(A instanceof Eo||A instanceof ci||A instanceof zi)&&A.destroy()}}}class qi{constructor(c,A){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const b of c)this.programConfigurations[b.id]=new Ka(b,A,g);this.needsUpload=!1,this._featureMap=new cs,this._bufferOffset=0}populatePaintArrays(c,A,g,b,B,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(c,A,b,B,T);A.id!==void 0&&this._featureMap.add(A.id,g,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,A,g,b){for(const B of g)this.needsUpload=this.programConfigurations[B.id].updatePaintArrays(c,this._featureMap,A,B,b)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const A in this.programConfigurations)this.programConfigurations[A].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function z3(f,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${c}-`,"").replace(/-/g,"_")]}function Fb(f,c,A){const g={color:{source:Is,composite:m},number:{source:Nu,composite:Is}},b=function(B){return{"line-pattern":{source:tt,composite:tt},"fill-pattern":{source:tt,composite:tt},"fill-extrusion-pattern":{source:tt,composite:tt}}[B]}(f);return b&&b[A]||g[c][A]}Mr("ConstantBinder",Ma),Mr("CrossFadedConstantBinder",Vo),Mr("SourceExpressionBinder",Eo),Mr("CrossFadedCompositeBinder",zi),Mr("CompositeExpressionBinder",ci),Mr("ProgramConfiguration",Ka,{omit:["_buffers"]}),Mr("ProgramConfigurationSet",qi);const i_=Math.pow(2,14)-1,Rb=-i_-1;function aA(f){const c=Ge/f.extent,A=f.loadGeometry();for(let g=0;g<A.length;g++){const b=A[g];for(let B=0;B<b.length;B++){const T=b[B],I=Math.round(T.x*c),L=Math.round(T.y*c);T.x=Te(I,Rb,i_),T.y=Te(L,Rb,i_),(I<T.x||I>T.x+1||L<T.y||L>T.y+1)&&qt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return A}function lA(f,c){return{type:f.type,id:f.id,properties:f.properties,geometry:c?aA(f):[]}}const wh=-32768;function Lb(f,c,A,g,b){f.emplaceBack(wh+8*c+g,wh+8*A+b)}class tg{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(A=>A.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Re,this.indexArray=new Lt,this.segments=new xr,this.programConfigurations=new qi(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(c,A,g){const b=this.layers[0],B=[];let T=null,I=!1,L=b.type==="heatmap";if(b.type==="circle"){const j=b;T=j.layout.get("circle-sort-key"),I=!T.isConstant(),L=L||j.paint.get("circle-pitch-alignment")==="map"}const k=L?A.subdivisionGranularity.circle:1;for(const{feature:j,id:G,index:re,sourceLayerIndex:ie}of c){const le=this.layers[0]._featureFilter.needGeometry,fe=lA(j,le);if(!this.layers[0]._featureFilter.filter(new _t(this.zoom),fe,g))continue;const Se=I?T.evaluate(fe,{},g):void 0,Ie={id:G,properties:j.properties,type:j.type,sourceLayerIndex:ie,index:re,geometry:le?fe.geometry:aA(j),patterns:{},sortKey:Se};B.push(Ie)}I&&B.sort((j,G)=>j.sortKey-G.sortKey);for(const j of B){const{geometry:G,index:re,sourceLayerIndex:ie}=j,le=c[re].feature;this.addFeature(j,G,re,g,k),A.featureIndex.insert(le,G,re,ie,this.index)}}update(c,A,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,A,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Kt),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,A,g,b){let B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,T;switch(B){case 1:T=[0,7];break;case 3:T=[0,2,5,7];break;case 5:T=[0,1,3,4,6,7];break;case 7:T=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${B}; valid values are 1, 3, 5, 7.`)}const I=T.length;for(const L of A)for(const k of L){const j=k.x,G=k.y;if(j<0||j>=Ge||G<0||G>=Ge)continue;const re=this.segments.prepareSegment(I*I,this.layoutVertexArray,this.indexArray,c.sortKey),ie=re.vertexLength;for(let le=0;le<I;le++)for(let fe=0;fe<I;fe++)Lb(this.layoutVertexArray,j,G,T[fe],T[le]);for(let le=0;le<I-1;le++)for(let fe=0;fe<I-1;fe++){const Se=ie+le*I+fe,Ie=ie+(le+1)*I+fe;this.indexArray.emplaceBack(Se,Ie+1,Se+1),this.indexArray.emplaceBack(Se,Ie,Ie+1)}re.vertexLength+=I*I,re.primitiveLength+=(I-1)*(I-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,{},b)}}function s_(f,c){for(let A=0;A<f.length;A++)if(rg(c,f[A]))return!0;for(let A=0;A<c.length;A++)if(rg(f,c[A]))return!0;return!!H3(f,c)}function o_(f,c,A){return!!rg(f,c)||!!V3(c,f,A)}function a_(f,c){if(f.length===1)return uz(c,f[0]);for(let A=0;A<c.length;A++){const g=c[A];for(let b=0;b<g.length;b++)if(rg(f,g[b]))return!0}for(let A=0;A<f.length;A++)if(uz(c,f[A]))return!0;for(let A=0;A<c.length;A++)if(H3(f,c[A]))return!0;return!1}function l_(f,c,A){if(f.length>1){if(H3(f,c))return!0;for(let g=0;g<c.length;g++)if(V3(c[g],f,A))return!0}for(let g=0;g<f.length;g++)if(V3(f[g],c,A))return!0;return!1}function H3(f,c){if(f.length===0||c.length===0)return!1;for(let A=0;A<f.length-1;A++){const g=f[A],b=f[A+1];for(let B=0;B<c.length-1;B++)if(Aye(g,b,c[B],c[B+1]))return!0}return!1}function Aye(f,c,A,g){return or(f,A,g)!==or(c,A,g)&&or(f,c,A)!==or(f,c,g)}function V3(f,c,A){const g=A*A;if(c.length===1)return f.distSqr(c[0])<g;for(let b=1;b<c.length;b++)if(cz(f,c[b-1],c[b])<g)return!0;return!1}function cz(f,c,A){const g=c.distSqr(A);if(g===0)return f.distSqr(c);const b=((f.x-c.x)*(A.x-c.x)+(f.y-c.y)*(A.y-c.y))/g;return f.distSqr(b<0?c:b>1?A:A.sub(c)._mult(b)._add(c))}function uz(f,c){let A,g,b,B=!1;for(let T=0;T<f.length;T++){A=f[T];for(let I=0,L=A.length-1;I<A.length;L=I++)g=A[I],b=A[L],g.y>c.y!=b.y>c.y&&c.x<(b.x-g.x)*(c.y-g.y)/(b.y-g.y)+g.x&&(B=!B)}return B}function rg(f,c){let A=!1;for(let g=0,b=f.length-1;g<f.length;b=g++){const B=f[g],T=f[b];B.y>c.y!=T.y>c.y&&c.x<(T.x-B.x)*(c.y-B.y)/(T.y-B.y)+B.x&&(A=!A)}return A}function fye(f,c,A){const g=A[0],b=A[2];if(f.x<g.x&&c.x<g.x||f.x>b.x&&c.x>b.x||f.y<g.y&&c.y<g.y||f.y>b.y&&c.y>b.y)return!1;const B=or(f,c,A[0]);return B!==or(f,c,A[1])||B!==or(f,c,A[2])||B!==or(f,c,A[3])}function c_(f,c,A){const g=c.paint.get(f).value;return g.kind==="constant"?g.value:A.programConfigurations.get(c.id).getMaxValue(f)}function Ob(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function Ub(f,c,A,g,b){if(!c[0]&&!c[1])return f;const B=M.convert(c)._mult(b);A==="viewport"&&B._rotate(-g);const T=[];for(let I=0;I<f.length;I++)T.push(f[I].sub(B));return T}let hz,Az;Mr("CircleBucket",tg,{omit:["layers"]});var dye={get paint(){return Az=Az||new fn({"circle-radius":new $t(Be.paint_circle["circle-radius"]),"circle-color":new $t(Be.paint_circle["circle-color"]),"circle-blur":new $t(Be.paint_circle["circle-blur"]),"circle-opacity":new $t(Be.paint_circle["circle-opacity"]),"circle-translate":new wt(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(Be.paint_circle["circle-stroke-opacity"])})},get layout(){return hz=hz||new fn({"circle-sort-key":new $t(Be.layout_circle["circle-sort-key"])})}};class pye extends mn{constructor(c){super(c,dye)}createBucket(c){return new tg(c)}queryRadius(c){const A=c;return c_("circle-radius",this,A)+c_("circle-stroke-width",this,A)+Ob(this.paint.get("circle-translate"))}queryIntersectsFeature(c){let{queryGeometry:A,feature:g,featureState:b,geometry:B,transform:T,pixelsToTileUnits:I,pixelPosMatrix:L}=c;const k=Ub(A,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-T.bearingInRadians,I),j=this.paint.get("circle-radius").evaluate(g,b)+this.paint.get("circle-stroke-width").evaluate(g,b),G=this.paint.get("circle-pitch-alignment")==="map",re=G?k:function(le,fe){return le.map(Se=>fz(Se,fe))}(k,L),ie=G?j*I:j;for(const le of B)for(const fe of le){const Se=G?fe:fz(fe,L);let Ie=ie;const st=oe([],[fe.x,fe.y,0,1],L);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ie*=st[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ie*=T.cameraToCenterDistance/st[3]),o_(re,Se,Ie))return!0}return!1}}function fz(f,c){const A=oe([],[f.x,f.y,0,1],c);return new M(A[0]/A[3],A[1]/A[3])}class dz extends tg{}let pz;Mr("HeatmapBucket",dz,{omit:["layers"]});var gye={get paint(){return pz=pz||new fn({"heatmap-radius":new $t(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Fr(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(Be.paint_heatmap["heatmap-opacity"])})}};function j3(f,c,A,g){let{width:b,height:B}=c;if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==b*B*A)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${b*B*A}`)}else g=new Uint8Array(b*B*A);return f.width=b,f.height=B,f.data=g,f}function gz(f,c,A){let{width:g,height:b}=c;if(g===f.width&&b===f.height)return;const B=j3({},{width:g,height:b},A);$3(f,B,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,g),height:Math.min(f.height,b)},A),f.width=g,f.height=b,f.data=B.data}function $3(f,c,A,g,b,B){if(b.width===0||b.height===0)return c;if(b.width>f.width||b.height>f.height||A.x>f.width-b.width||A.y>f.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>c.width||b.height>c.height||g.x>c.width-b.width||g.y>c.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const T=f.data,I=c.data;if(T===I)throw new Error("srcData equals dstData, so image is already copied");for(let L=0;L<b.height;L++){const k=((A.y+L)*f.width+A.x)*B,j=((g.y+L)*c.width+g.x)*B;for(let G=0;G<b.width*B;G++)I[j+G]=T[k+G]}return c}class u_{constructor(c,A){j3(this,c,1,A)}resize(c){gz(this,c,1)}clone(){return new u_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,A,g,b,B){$3(c,A,g,b,B,1)}}class jl{constructor(c,A){j3(this,c,4,A)}resize(c){gz(this,c,4)}replace(c,A){A?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new jl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,A,g,b,B){$3(c,A,g,b,B,4)}}function mz(f){const c={},A=f.resolution||256,g=f.clips?f.clips.length:1,b=f.image||new jl({width:A,height:g});if(Math.log(A)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${A}`);const B=(T,I,L)=>{c[f.evaluationKey]=L;const k=f.expression.evaluate(c);b.data[T+I+0]=Math.floor(255*k.r/k.a),b.data[T+I+1]=Math.floor(255*k.g/k.a),b.data[T+I+2]=Math.floor(255*k.b/k.a),b.data[T+I+3]=Math.floor(255*k.a)};if(f.clips)for(let T=0,I=0;T<g;++T,I+=4*A)for(let L=0,k=0;L<A;L++,k+=4){const j=L/(A-1),{start:G,end:re}=f.clips[T];B(I,k,G*(1-j)+re*j)}else for(let T=0,I=0;T<A;T++,I+=4)B(0,I,T/(A-1));return b}Mr("AlphaImage",u_),Mr("RGBAImage",jl);const G3="big-fb";class mye extends mn{createBucket(c){return new dz(c)}constructor(c){super(c,gye),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mz({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(G3)&&this.heatmapFbos.delete(G3)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let _z;var _ye={get paint(){return _z=_z||new fn({"hillshade-illumination-direction":new wt(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(Be.paint_hillshade["hillshade-accent-color"])})}};class yye extends mn{constructor(c){super(c,_ye)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const bye=Gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:vye}=bye;function q3(f,c,A){const g=A.patternDependencies;let b=!1;for(const B of c){const T=B.paint.get(`${f}-pattern`);T.isConstant()||(b=!0);const I=T.constantOr(null);I&&(b=!0,g[I.to]=!0,g[I.from]=!0)}return b}function K3(f,c,A,g,b){const B=b.patternDependencies;for(const T of c){const I=T.paint.get(`${f}-pattern`).value;if(I.kind!=="constant"){let L=I.evaluate({zoom:g-1},A,{},b.availableImages),k=I.evaluate({zoom:g},A,{},b.availableImages),j=I.evaluate({zoom:g+1},A,{},b.availableImages);L=L&&L.name?L.name:L,k=k&&k.name?k.name:k,j=j&&j.name?j.name:j,B[L]=!0,B[k]=!0,B[j]=!0,A.patterns[T.id]={min:L,mid:k,max:j}}}return A}function yz(f,c,A,g,b){let B;if(b===function(T,I,L,k){let j=0;for(let G=I,re=L-k;G<L;G+=k)j+=(T[re]-T[G])*(T[G+1]+T[re+1]),re=G;return j}(f,c,A,g)>0)for(let T=c;T<A;T+=g)B=xz(T/g|0,f[T],f[T+1],B);else for(let T=A-g;T>=c;T-=g)B=xz(T/g|0,f[T],f[T+1],B);return B&&ng(B,B.next)&&(d_(B),B=B.next),B}function Cd(f,c){if(!f)return f;c||(c=f);let A,g=f;do if(A=!1,g.steiner||!ng(g,g.next)&&ps(g.prev,g,g.next)!==0)g=g.next;else{if(d_(g),g=c=g.prev,g===g.next)break;A=!0}while(A||g!==c);return c}function h_(f,c,A,g,b,B,T){if(!f)return;!T&&B&&function(L,k,j,G){let re=L;do re.z===0&&(re.z=W3(re.x,re.y,k,j,G)),re.prevZ=re.prev,re.nextZ=re.next,re=re.next;while(re!==L);re.prevZ.nextZ=null,re.prevZ=null,function(ie){let le,fe=1;do{let Se,Ie=ie;ie=null;let st=null;for(le=0;Ie;){le++;let Qe=Ie,ne=0;for(let He=0;He<fe&&(ne++,Qe=Qe.nextZ,Qe);He++);let Ce=fe;for(;ne>0||Ce>0&&Qe;)ne!==0&&(Ce===0||!Qe||Ie.z<=Qe.z)?(Se=Ie,Ie=Ie.nextZ,ne--):(Se=Qe,Qe=Qe.nextZ,Ce--),st?st.nextZ=Se:ie=Se,Se.prevZ=st,st=Se;Ie=Qe}st.nextZ=null,fe*=2}while(le>1)}(re)}(f,g,b,B);let I=f;for(;f.prev!==f.next;){const L=f.prev,k=f.next;if(B?xye(f,g,b,B):wye(f))c.push(L.i,f.i,k.i),d_(f),f=k.next,I=k.next;else if((f=k)===I){T?T===1?h_(f=Bye(Cd(f),c),c,A,g,b,B,2):T===2&&Cye(f,c,A,g,b,B):h_(Cd(f),c,A,g,b,B,1);break}}}function wye(f){const c=f.prev,A=f,g=f.next;if(ps(c,A,g)>=0)return!1;const b=c.x,B=A.x,T=g.x,I=c.y,L=A.y,k=g.y,j=Math.min(b,B,T),G=Math.min(I,L,k),re=Math.max(b,B,T),ie=Math.max(I,L,k);let le=g.next;for(;le!==c;){if(le.x>=j&&le.x<=re&&le.y>=G&&le.y<=ie&&A_(b,I,B,L,T,k,le.x,le.y)&&ps(le.prev,le,le.next)>=0)return!1;le=le.next}return!0}function xye(f,c,A,g){const b=f.prev,B=f,T=f.next;if(ps(b,B,T)>=0)return!1;const I=b.x,L=B.x,k=T.x,j=b.y,G=B.y,re=T.y,ie=Math.min(I,L,k),le=Math.min(j,G,re),fe=Math.max(I,L,k),Se=Math.max(j,G,re),Ie=W3(ie,le,c,A,g),st=W3(fe,Se,c,A,g);let Qe=f.prevZ,ne=f.nextZ;for(;Qe&&Qe.z>=Ie&&ne&&ne.z<=st;){if(Qe.x>=ie&&Qe.x<=fe&&Qe.y>=le&&Qe.y<=Se&&Qe!==b&&Qe!==T&&A_(I,j,L,G,k,re,Qe.x,Qe.y)&&ps(Qe.prev,Qe,Qe.next)>=0||(Qe=Qe.prevZ,ne.x>=ie&&ne.x<=fe&&ne.y>=le&&ne.y<=Se&&ne!==b&&ne!==T&&A_(I,j,L,G,k,re,ne.x,ne.y)&&ps(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;Qe&&Qe.z>=Ie;){if(Qe.x>=ie&&Qe.x<=fe&&Qe.y>=le&&Qe.y<=Se&&Qe!==b&&Qe!==T&&A_(I,j,L,G,k,re,Qe.x,Qe.y)&&ps(Qe.prev,Qe,Qe.next)>=0)return!1;Qe=Qe.prevZ}for(;ne&&ne.z<=st;){if(ne.x>=ie&&ne.x<=fe&&ne.y>=le&&ne.y<=Se&&ne!==b&&ne!==T&&A_(I,j,L,G,k,re,ne.x,ne.y)&&ps(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function Bye(f,c){let A=f;do{const g=A.prev,b=A.next.next;!ng(g,b)&&vz(g,A,A.next,b)&&f_(g,b)&&f_(b,g)&&(c.push(g.i,A.i,b.i),d_(A),d_(A.next),A=f=b),A=A.next}while(A!==f);return Cd(A)}function Cye(f,c,A,g,b,B){let T=f;do{let I=T.next.next;for(;I!==T.prev;){if(T.i!==I.i&&Mye(T,I)){let L=wz(T,I);return T=Cd(T,T.next),L=Cd(L,L.next),h_(T,c,A,g,b,B,0),void h_(L,c,A,g,b,B,0)}I=I.next}T=T.next}while(T!==f)}function Tye(f,c){let A=f.x-c.x;return A===0&&(A=f.y-c.y,A===0)&&(A=(f.next.y-f.y)/(f.next.x-f.x)-(c.next.y-c.y)/(c.next.x-c.x)),A}function Eye(f,c){const A=function(b,B){let T=B;const I=b.x,L=b.y;let k,j=-1/0;if(ng(b,T))return T;do{if(ng(b,T.next))return T.next;if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){const fe=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(fe<=I&&fe>j&&(j=fe,k=T.x<T.next.x?T:T.next,fe===I))return k}T=T.next}while(T!==B);if(!k)return null;const G=k,re=k.x,ie=k.y;let le=1/0;T=k;do{if(I>=T.x&&T.x>=re&&I!==T.x&&bz(L<ie?I:j,L,re,ie,L<ie?j:I,L,T.x,T.y)){const fe=Math.abs(L-T.y)/(I-T.x);f_(T,b)&&(fe<le||fe===le&&(T.x>k.x||T.x===k.x&&Sye(k,T)))&&(k=T,le=fe)}T=T.next}while(T!==G);return k}(f,c);if(!A)return c;const g=wz(A,f);return Cd(g,g.next),Cd(A,A.next)}function Sye(f,c){return ps(f.prev,f,c.prev)<0&&ps(c.next,f,f.next)<0}function W3(f,c,A,g,b){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-A)*b|0)|f<<8))|f<<4))|f<<2))|f<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-g)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function Iye(f){let c=f,A=f;do(c.x<A.x||c.x===A.x&&c.y<A.y)&&(A=c),c=c.next;while(c!==f);return A}function bz(f,c,A,g,b,B,T,I){return(b-T)*(c-I)>=(f-T)*(B-I)&&(f-T)*(g-I)>=(A-T)*(c-I)&&(A-T)*(B-I)>=(b-T)*(g-I)}function A_(f,c,A,g,b,B,T,I){return!(f===T&&c===I)&&bz(f,c,A,g,b,B,T,I)}function Mye(f,c){return f.next.i!==c.i&&f.prev.i!==c.i&&!function(A,g){let b=A;do{if(b.i!==A.i&&b.next.i!==A.i&&b.i!==g.i&&b.next.i!==g.i&&vz(b,b.next,A,g))return!0;b=b.next}while(b!==A);return!1}(f,c)&&(f_(f,c)&&f_(c,f)&&function(A,g){let b=A,B=!1;const T=(A.x+g.x)/2,I=(A.y+g.y)/2;do b.y>I!=b.next.y>I&&b.next.y!==b.y&&T<(b.next.x-b.x)*(I-b.y)/(b.next.y-b.y)+b.x&&(B=!B),b=b.next;while(b!==A);return B}(f,c)&&(ps(f.prev,f,c.prev)||ps(f,c.prev,c))||ng(f,c)&&ps(f.prev,f,f.next)>0&&ps(c.prev,c,c.next)>0)}function ps(f,c,A){return(c.y-f.y)*(A.x-c.x)-(c.x-f.x)*(A.y-c.y)}function ng(f,c){return f.x===c.x&&f.y===c.y}function vz(f,c,A,g){const b=Nb(ps(f,c,A)),B=Nb(ps(f,c,g)),T=Nb(ps(A,g,f)),I=Nb(ps(A,g,c));return b!==B&&T!==I||!(b!==0||!Db(f,A,c))||!(B!==0||!Db(f,g,c))||!(T!==0||!Db(A,f,g))||!(I!==0||!Db(A,c,g))}function Db(f,c,A){return c.x<=Math.max(f.x,A.x)&&c.x>=Math.min(f.x,A.x)&&c.y<=Math.max(f.y,A.y)&&c.y>=Math.min(f.y,A.y)}function Nb(f){return f>0?1:f<0?-1:0}function f_(f,c){return ps(f.prev,f,f.next)<0?ps(f,c,f.next)>=0&&ps(f,f.prev,c)>=0:ps(f,c,f.prev)<0||ps(f,f.next,c)<0}function wz(f,c){const A=X3(f.i,f.x,f.y),g=X3(c.i,c.x,c.y),b=f.next,B=c.prev;return f.next=c,c.prev=f,A.next=b,b.prev=A,g.next=A,A.prev=g,B.next=g,g.prev=B,g}function xz(f,c,A,g){const b=X3(f,c,A);return g?(b.next=g.next,b.prev=g,g.next.prev=b,g.next=b):(b.prev=b,b.next=b),b}function d_(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function X3(f,c,A){return{i:f,x:c,y:A,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ig{constructor(c,A){if(A>c)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=c,this._minGranularity=A}getGranularityForZoomLevel(c){return Math.max(Math.floor(this._baseZoomGranularity/(1<<c)),this._minGranularity,1)}}class kb{constructor(c){this.fill=c.fill,this.line=c.line,this.tile=c.tile,this.stencil=c.stencil,this.circle=c.circle}}kb.noSubdivision=new kb({fill:new ig(0,0),line:new ig(0,0),tile:new ig(0,0),stencil:new ig(0,0),circle:1}),Mr("SubdivisionGranularityExpression",ig),Mr("SubdivisionGranularitySetting",kb);const sg=-32768,p_=32767;class Pye{constructor(c,A){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=c,this._granularityCellSize=Ge/c,this._canonical=A}_getKey(c,A){return(c+=32768)<<16|(A+=32768)<<0}_vertexToIndex(c,A){if(c<-32768||A<-32768||c>32767||A>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const g=0|Math.round(c),b=0|Math.round(A),B=this._getKey(g,b);if(this._vertexDictionary.has(B))return this._vertexDictionary.get(B);const T=this._vertexBuffer.length/2;return this._vertexDictionary.set(B,T),this._vertexBuffer.push(g,b),T}_subdivideTrianglesScanline(c){if(this._granularity<2)return function(b,B){const T=[];for(let I=0;I<B.length;I+=3){const L=B[I],k=B[I+1],j=B[I+2],G=b[2*L],re=b[2*L+1];(b[2*k]-G)*(b[2*j+1]-re)-(b[2*k+1]-re)*(b[2*j]-G)>0?(T.push(L),T.push(j),T.push(k)):(T.push(L),T.push(k),T.push(j))}return T}(this._vertexBuffer,c);const A=[],g=c.length;for(let b=0;b<g;b+=3){const B=[c[b+0],c[b+1],c[b+2]],T=[this._vertexBuffer[2*c[b+0]+0],this._vertexBuffer[2*c[b+0]+1],this._vertexBuffer[2*c[b+1]+0],this._vertexBuffer[2*c[b+1]+1],this._vertexBuffer[2*c[b+2]+0],this._vertexBuffer[2*c[b+2]+1]];let I=1/0,L=1/0,k=-1/0,j=-1/0;for(let fe=0;fe<3;fe++){const Se=T[2*fe],Ie=T[2*fe+1];I=Math.min(I,Se),k=Math.max(k,Se),L=Math.min(L,Ie),j=Math.max(j,Ie)}if(I===k||L===j)continue;const G=Math.floor(I/this._granularityCellSize),re=Math.ceil(k/this._granularityCellSize),ie=Math.floor(L/this._granularityCellSize),le=Math.ceil(j/this._granularityCellSize);if(G!==re||ie!==le)for(let fe=ie;fe<le;fe++){const Se=this._scanlineGenerateVertexRingForCellRow(fe,T,B);Fye(this._vertexBuffer,Se,A)}else A.push(...B)}return A}_scanlineGenerateVertexRingForCellRow(c,A,g){const b=c*this._granularityCellSize,B=b+this._granularityCellSize,T=[];for(let I=0;I<3;I++){const L=A[2*I],k=A[2*I+1],j=A[2*(I+1)%6],G=A[(2*(I+1)+1)%6],re=A[2*(I+2)%6],ie=A[(2*(I+2)+1)%6],le=j-L,fe=G-k,Se=le===0,Ie=fe===0,st=(b-k)/fe,Qe=(B-k)/fe,ne=Math.min(st,Qe),Ce=Math.max(st,Qe);if(!Ie&&(ne>=1||Ce<=0)||Ie&&(k<b||k>B)){G>=b&&G<=B&&T.push(g[(I+1)%3]);continue}!Ie&&ne>0&&T.push(this._vertexToIndex(L+le*ne,k+fe*ne));const He=L+le*Math.max(ne,0),Tt=L+le*Math.min(Ce,1);Se||this._generateIntraEdgeVertices(T,L,k,j,G,He,Tt),!Ie&&Ce<1&&T.push(this._vertexToIndex(L+le*Ce,k+fe*Ce)),(Ie||G>=b&&G<=B)&&T.push(g[(I+1)%3]),!Ie&&(G<=b||G>=B)&&this._generateInterEdgeVertices(T,L,k,j,G,re,ie,Tt,b,B)}return T}_generateIntraEdgeVertices(c,A,g,b,B,T,I){const L=b-A,k=B-g,j=k===0,G=j?Math.min(A,b):Math.min(T,I),re=j?Math.max(A,b):Math.max(T,I),ie=Math.floor(G/this._granularityCellSize)+1,le=Math.ceil(re/this._granularityCellSize)-1;if(j?A<b:T<I)for(let fe=ie;fe<=le;fe++){const Se=fe*this._granularityCellSize;c.push(this._vertexToIndex(Se,g+k*(Se-A)/L))}else for(let fe=le;fe>=ie;fe--){const Se=fe*this._granularityCellSize;c.push(this._vertexToIndex(Se,g+k*(Se-A)/L))}}_generateInterEdgeVertices(c,A,g,b,B,T,I,L,k,j){const G=B-g,re=T-b,ie=I-B,le=(k-B)/ie,fe=(j-B)/ie,Se=Math.min(le,fe),Ie=Math.max(le,fe),st=b+re*Se;let Qe=Math.floor(Math.min(st,L)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(st,L)/this._granularityCellSize)-1,Ce=L<st;const He=ie===0;if(He&&(I===k||I===j))return;if(He||Se>=1||Ie<=0){const Wt=g-I,Ft=T+(A-T)*Math.min((k-I)/Wt,(j-I)/Wt);Qe=Math.floor(Math.min(Ft,L)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(Ft,L)/this._granularityCellSize)-1,Ce=L<Ft}const Tt=G>0?j:k;if(Ce)for(let Wt=Qe;Wt<=ne;Wt++)c.push(this._vertexToIndex(Wt*this._granularityCellSize,Tt));else for(let Wt=ne;Wt>=Qe;Wt--)c.push(this._vertexToIndex(Wt*this._granularityCellSize,Tt))}_generateOutline(c){const A=[];for(const g of c){const b=Td(g,this._granularity,!0),B=this._pointArrayToIndices(b),T=[];for(let I=1;I<B.length;I++)T.push(B[I-1]),T.push(B[I]);A.push(T)}return A}_handlePoles(c){let A=!1,g=!1;this._canonical&&(this._canonical.y===0&&(A=!0),this._canonical.y===(1<<this._canonical.z)-1&&(g=!0)),(A||g)&&this._fillPoles(c,A,g)}_ensureNoPoleVertices(){const c=this._vertexBuffer;for(let A=0;A<c.length;A+=2){const g=c[A+1];g===sg&&(c[A+1]=-32767),g===p_&&(c[A+1]=32766)}}_generatePoleQuad(c,A,g,b,B,T){b>B!=(T===sg)?(c.push(A),c.push(g),c.push(this._vertexToIndex(b,T)),c.push(g),c.push(this._vertexToIndex(B,T)),c.push(this._vertexToIndex(b,T))):(c.push(g),c.push(A),c.push(this._vertexToIndex(b,T)),c.push(this._vertexToIndex(B,T)),c.push(g),c.push(this._vertexToIndex(b,T)))}_fillPoles(c,A,g){const b=this._vertexBuffer,B=Ge,T=c.length;for(let I=2;I<T;I+=3){const L=c[I-2],k=c[I-1],j=c[I],G=b[2*L],re=b[2*L+1],ie=b[2*k],le=b[2*k+1],fe=b[2*j],Se=b[2*j+1];A&&(re===0&&le===0&&this._generatePoleQuad(c,L,k,G,ie,sg),le===0&&Se===0&&this._generatePoleQuad(c,k,j,ie,fe,sg),Se===0&&re===0&&this._generatePoleQuad(c,j,L,fe,G,sg)),g&&(re===B&&le===B&&this._generatePoleQuad(c,L,k,G,ie,p_),le===B&&Se===B&&this._generatePoleQuad(c,k,j,ie,fe,p_),Se===B&&re===B&&this._generatePoleQuad(c,j,L,fe,G,p_))}}_initializeVertices(c){for(let A=0;A<c.length;A+=2)this._vertexToIndex(c[A],c[A+1])}subdividePolygonInternal(c,A){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:g,holeIndices:b}=function(I){const L=[],k=[];for(const j of I)if(j.length!==0){j!==I[0]&&L.push(k.length/2);for(let G=0;G<j.length;G++)k.push(j[G].x),k.push(j[G].y)}return{flattened:k,holeIndices:L}}(c);let B;this._initializeVertices(g);try{const I=function(k,j){let G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:2;const re=j&&j.length,ie=re?j[0]*G:k.length;let le=yz(k,0,ie,G,!0);const fe=[];if(!le||le.next===le.prev)return fe;let Se,Ie,st;if(re&&(le=function(Qe,ne,Ce,He){const Tt=[];for(let Wt=0,Ft=ne.length;Wt<Ft;Wt++){const Nt=yz(Qe,ne[Wt]*He,Wt<Ft-1?ne[Wt+1]*He:Qe.length,He,!1);Nt===Nt.next&&(Nt.steiner=!0),Tt.push(Iye(Nt))}Tt.sort(Tye);for(let Wt=0;Wt<Tt.length;Wt++)Ce=Eye(Tt[Wt],Ce);return Ce}(k,j,le,G)),k.length>80*G){Se=1/0,Ie=1/0;let Qe=-1/0,ne=-1/0;for(let Ce=G;Ce<ie;Ce+=G){const He=k[Ce],Tt=k[Ce+1];He<Se&&(Se=He),Tt<Ie&&(Ie=Tt),He>Qe&&(Qe=He),Tt>ne&&(ne=Tt)}st=Math.max(Qe-Se,ne-Ie),st=st!==0?32767/st:0}return h_(le,fe,G,Se,Ie,st,0),fe}(g,b),L=this._convertIndices(g,I);B=this._subdivideTrianglesScanline(L)}catch(I){console.error(I)}let T=[];return A&&(T=this._generateOutline(c)),this._ensureNoPoleVertices(),this._handlePoles(B),{verticesFlattened:this._vertexBuffer,indicesTriangles:B,indicesLineList:T}}_convertIndices(c,A){const g=[];for(let b=0;b<A.length;b++)g.push(this._vertexToIndex(c[2*A[b]],c[2*A[b]+1]));return g}_pointArrayToIndices(c){const A=[];for(let g=0;g<c.length;g++){const b=c[g];A.push(this._vertexToIndex(b.x,b.y))}return A}}function Bz(f,c,A){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return new Pye(A,c).subdividePolygonInternal(f,g)}function Td(f,c){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!f||f.length<1)return[];if(f.length<2)return[];const g=f[0],b=f[f.length-1],B=A&&(g.x!==b.x||g.y!==b.y);if(c<2)return B?[...f,f[0]]:[...f];const T=Math.floor(Ge/c),I=[];I.push(new M(f[0].x,f[0].y));const L=f.length,k=B?L:L-1;for(let j=0;j<k;j++){const G=f[j],re=j<L-1?f[j+1]:f[0],ie=G.x,le=G.y,fe=re.x,Se=re.y,Ie=ie!==fe,st=le!==Se;if(!Ie&&!st)continue;const Qe=fe-ie,ne=Se-le,Ce=Math.abs(Qe),He=Math.abs(ne);let Tt=ie,Wt=le;for(;;){const Nt=Qe>0?(Math.floor(Tt/T)+1)*T:(Math.ceil(Tt/T)-1)*T,lr=ne>0?(Math.floor(Wt/T)+1)*T:(Math.ceil(Wt/T)-1)*T,Zt=Math.abs(Tt-Nt),fr=Math.abs(Wt-lr),zt=Math.abs(Tt-fe),Ur=Math.abs(Wt-Se),Yr=Ie?Zt/Ce:Number.POSITIVE_INFINITY,qr=st?fr/He:Number.POSITIVE_INFINITY;if((zt<=Zt||!Ie)&&(Ur<=fr||!st))break;if(Yr<qr&&Ie||!st){Tt=Nt,Wt+=ne*Yr;const zr=new M(Tt,Math.round(Wt));I[I.length-1].x===zr.x&&I[I.length-1].y===zr.y||I.push(zr)}else{Tt+=Qe*qr,Wt=lr;const zr=new M(Math.round(Tt),Wt);I[I.length-1].x===zr.x&&I[I.length-1].y===zr.y||I.push(zr)}}const Ft=new M(fe,Se);I[I.length-1].x===Ft.x&&I[I.length-1].y===Ft.y||I.push(Ft)}return I}function Fye(f,c,A){if(c.length===0)throw new Error("Subdivision vertex ring is empty.");let g=0,b=f[2*c[0]];for(let L=1;L<c.length;L++){const k=f[2*c[L]];k<b&&(b=k,g=L)}const B=c.length;let T=g,I=(T+1)%B;for(;;){const L=T-1>=0?T-1:B-1,k=(I+1)%B,j=f[2*c[L]],G=f[2*c[k]],re=f[2*c[T]],ie=f[2*c[T]+1],le=f[2*c[I]+1];let fe=!1;if(j<G)fe=!0;else if(j>G)fe=!1;else{const Se=le-ie,Ie=-(f[2*c[I]]-re),st=ie<le?1:-1;((j-re)*Se+(f[2*c[L]+1]-ie)*Ie)*st>((G-re)*Se+(f[2*c[k]+1]-ie)*Ie)*st&&(fe=!0)}if(fe){const Se=c[L],Ie=c[T],st=c[I];Se!==Ie&&Se!==st&&Ie!==st&&A.push(st,Ie,Se),T--,T<0&&(T=B-1)}else{const Se=c[k],Ie=c[T],st=c[I];Se!==Ie&&Se!==st&&Ie!==st&&A.push(st,Ie,Se),I++,I>=B&&(I=0)}if(L===k)break}}function Cz(f,c,A,g,b,B,T,I,L){const k=b.length/2,j=T&&I&&L;if(k<xr.MAX_VERTEX_ARRAY_LENGTH){const G=c.prepareSegment(k,A,g),re=G.vertexLength;for(let fe=0;fe<B.length;fe+=3)g.emplaceBack(re+B[fe],re+B[fe+1],re+B[fe+2]);let ie,le;G.vertexLength+=k,G.primitiveLength+=B.length/3,j&&(le=T.prepareSegment(k,A,I),ie=le.vertexLength,le.vertexLength+=k);for(let fe=0;fe<b.length;fe+=2)f(b[fe],b[fe+1]);if(j)for(let fe=0;fe<L.length;fe++){const Se=L[fe];for(let Ie=1;Ie<Se.length;Ie+=2)I.emplaceBack(ie+Se[Ie-1],ie+Se[Ie]);le.primitiveLength+=Se.length/2}}else(function(G,re,ie,le,fe,Se){const Ie=[];for(let He=0;He<le.length/2;He++)Ie.push(-1);const st={count:0};let Qe=0,ne=G.getOrCreateLatestSegment(re,ie),Ce=ne.vertexLength;for(let He=2;He<fe.length;He+=3){const Tt=fe[He-2],Wt=fe[He-1],Ft=fe[He];let Nt=Ie[Tt]<Qe,lr=Ie[Wt]<Qe,Zt=Ie[Ft]<Qe;ne.vertexLength+((Nt?1:0)+(lr?1:0)+(Zt?1:0))>xr.MAX_VERTEX_ARRAY_LENGTH&&(ne=G.createNewSegment(re,ie),Qe=st.count,Nt=!0,lr=!0,Zt=!0,Ce=0);const fr=g_(Ie,le,Se,st,Tt,Nt,ne),zt=g_(Ie,le,Se,st,Wt,lr,ne),Ur=g_(Ie,le,Se,st,Ft,Zt,ne);ie.emplaceBack(Ce+fr-Qe,Ce+zt-Qe,Ce+Ur-Qe),ne.primitiveLength++}})(c,A,g,b,B,f),j&&function(G,re,ie,le,fe,Se){const Ie=[];for(let He=0;He<le.length/2;He++)Ie.push(-1);const st={count:0};let Qe=0,ne=G.getOrCreateLatestSegment(re,ie),Ce=ne.vertexLength;for(let He=0;He<fe.length;He++){const Tt=fe[He];for(let Wt=1;Wt<fe[He].length;Wt+=2){const Ft=Tt[Wt-1],Nt=Tt[Wt];let lr=Ie[Ft]<Qe,Zt=Ie[Nt]<Qe;ne.vertexLength+((lr?1:0)+(Zt?1:0))>xr.MAX_VERTEX_ARRAY_LENGTH&&(ne=G.createNewSegment(re,ie),Qe=st.count,lr=!0,Zt=!0,Ce=0);const fr=g_(Ie,le,Se,st,Ft,lr,ne),zt=g_(Ie,le,Se,st,Nt,Zt,ne);ie.emplaceBack(Ce+fr-Qe,Ce+zt-Qe),ne.primitiveLength++}}}(T,A,I,b,L,f),c.forceNewSegmentOnNextPrepare(),T==null||T.forceNewSegmentOnNextPrepare()}function g_(f,c,A,g,b,B,T){if(B){const I=g.count;return A(c[2*b],c[2*b+1]),f[b]=g.count,g.count++,T.vertexLength++,I}return f[b]}class Y3{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(A=>A.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ne,this.indexArray=new Lt,this.indexArray2=new dr,this.programConfigurations=new qi(c.layers,c.zoom),this.segments=new xr,this.segments2=new xr,this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(c,A,g){this.hasPattern=q3("fill",this.layers,A);const b=this.layers[0].layout.get("fill-sort-key"),B=!b.isConstant(),T=[];for(const{feature:I,id:L,index:k,sourceLayerIndex:j}of c){const G=this.layers[0]._featureFilter.needGeometry,re=lA(I,G);if(!this.layers[0]._featureFilter.filter(new _t(this.zoom),re,g))continue;const ie=B?b.evaluate(re,{},g,A.availableImages):void 0,le={id:L,properties:I.properties,type:I.type,sourceLayerIndex:j,index:k,geometry:G?re.geometry:aA(I),patterns:{},sortKey:ie};T.push(le)}B&&T.sort((I,L)=>I.sortKey-L.sortKey);for(const I of T){const{geometry:L,index:k,sourceLayerIndex:j}=I;if(this.hasPattern){const G=K3("fill",this.layers,I,this.zoom,A);this.patternFeatures.push(G)}else this.addFeature(I,L,k,g,{},A.subdivisionGranularity);A.featureIndex.insert(c[k].feature,L,k,j,this.index)}}update(c,A,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,A,this.stateDependentLayers,g)}addFeatures(c,A,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,A,g,c.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,vye),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,A,g,b,B,T){for(const I of wo(A,500)){const L=Bz(I,b,T.fill.getGranularityForZoomLevel(b.z)),k=this.layoutVertexArray;Cz((j,G)=>{k.emplaceBack(j,G)},this.segments,this.layoutVertexArray,this.indexArray,L.verticesFlattened,L.indicesTriangles,this.segments2,this.indexArray2,L.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,B,b)}}let Tz,Ez;Mr("FillBucket",Y3,{omit:["layers","patternFeatures"]});var Rye={get paint(){return Ez=Ez||new fn({"fill-antialias":new wt(Be.paint_fill["fill-antialias"]),"fill-opacity":new $t(Be.paint_fill["fill-opacity"]),"fill-color":new $t(Be.paint_fill["fill-color"]),"fill-outline-color":new $t(Be.paint_fill["fill-outline-color"]),"fill-translate":new wt(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ir(Be.paint_fill["fill-pattern"])})},get layout(){return Tz=Tz||new fn({"fill-sort-key":new $t(Be.layout_fill["fill-sort-key"])})}};class Lye extends mn{constructor(c){super(c,Rye)}recalculate(c,A){super.recalculate(c,A);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Y3(c)}queryRadius(){return Ob(this.paint.get("fill-translate"))}queryIntersectsFeature(c){let{queryGeometry:A,geometry:g,transform:b,pixelsToTileUnits:B}=c;return a_(Ub(A,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-b.bearingInRadians,B),g)}isTileClipped(){return!0}}const Oye=Gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Uye=Gr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Dye}=Oye;var Z3,Sz,J3,Iz,eS,Mz,Pz,Qb={};function Fz(){if(Sz)return Z3;Sz=1;var f=_();function c(b,B,T,I,L){this.properties={},this.extent=T,this.type=0,this._pbf=b,this._geometry=-1,this._keys=I,this._values=L,b.readFields(A,this,B)}function A(b,B,T){b==1?B.id=T.readVarint():b==2?function(I,L){for(var k=I.readVarint()+I.pos;I.pos<k;){var j=L._keys[I.readVarint()],G=L._values[I.readVarint()];L.properties[j]=G}}(T,B):b==3?B.type=T.readVarint():b==4&&(B._geometry=T.pos)}function g(b){for(var B,T,I=0,L=0,k=b.length,j=k-1;L<k;j=L++)I+=((T=b[j]).x-(B=b[L]).x)*(B.y+T.y);return I}return Z3=c,c.types=["Unknown","Point","LineString","Polygon"],c.prototype.loadGeometry=function(){var b=this._pbf;b.pos=this._geometry;for(var B,T=b.readVarint()+b.pos,I=1,L=0,k=0,j=0,G=[];b.pos<T;){if(L<=0){var re=b.readVarint();I=7&re,L=re>>3}if(L--,I===1||I===2)k+=b.readSVarint(),j+=b.readSVarint(),I===1&&(B&&G.push(B),B=[]),B.push(new f(k,j));else{if(I!==7)throw new Error("unknown command "+I);B&&B.push(B[0].clone())}}return B&&G.push(B),G},c.prototype.bbox=function(){var b=this._pbf;b.pos=this._geometry;for(var B=b.readVarint()+b.pos,T=1,I=0,L=0,k=0,j=1/0,G=-1/0,re=1/0,ie=-1/0;b.pos<B;){if(I<=0){var le=b.readVarint();T=7&le,I=le>>3}if(I--,T===1||T===2)(L+=b.readSVarint())<j&&(j=L),L>G&&(G=L),(k+=b.readSVarint())<re&&(re=k),k>ie&&(ie=k);else if(T!==7)throw new Error("unknown command "+T)}return[j,re,G,ie]},c.prototype.toGeoJSON=function(b,B,T){var I,L,k=this.extent*Math.pow(2,T),j=this.extent*b,G=this.extent*B,re=this.loadGeometry(),ie=c.types[this.type];function le(Ie){for(var st=0;st<Ie.length;st++){var Qe=Ie[st];Ie[st]=[360*(Qe.x+j)/k-180,360/Math.PI*Math.atan(Math.exp((180-360*(Qe.y+G)/k)*Math.PI/180))-90]}}switch(this.type){case 1:var fe=[];for(I=0;I<re.length;I++)fe[I]=re[I][0];le(re=fe);break;case 2:for(I=0;I<re.length;I++)le(re[I]);break;case 3:for(re=function(Ie){var st=Ie.length;if(st<=1)return[Ie];for(var Qe,ne,Ce=[],He=0;He<st;He++){var Tt=g(Ie[He]);Tt!==0&&(ne===void 0&&(ne=Tt<0),ne===Tt<0?(Qe&&Ce.push(Qe),Qe=[Ie[He]]):Qe.push(Ie[He]))}return Qe&&Ce.push(Qe),Ce}(re),I=0;I<re.length;I++)for(L=0;L<re[I].length;L++)le(re[I][L])}re.length===1?re=re[0]:ie="Multi"+ie;var Se={type:"Feature",geometry:{type:ie,coordinates:re},properties:this.properties};return"id"in this&&(Se.id=this.id),Se},Z3}function Rz(){if(Iz)return J3;Iz=1;var f=Fz();function c(g,b){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=g,this._keys=[],this._values=[],this._features=[],g.readFields(A,this,b),this.length=this._features.length}function A(g,b,B){g===15?b.version=B.readVarint():g===1?b.name=B.readString():g===5?b.extent=B.readVarint():g===2?b._features.push(B.pos):g===3?b._keys.push(B.readString()):g===4&&b._values.push(function(T){for(var I=null,L=T.readVarint()+T.pos;T.pos<L;){var k=T.readVarint()>>3;I=k===1?T.readString():k===2?T.readFloat():k===3?T.readDouble():k===4?T.readVarint64():k===5?T.readVarint():k===6?T.readSVarint():k===7?T.readBoolean():null}return I}(B))}return J3=c,c.prototype.feature=function(g){if(g<0||g>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[g];var b=this._pbf.readVarint()+this._pbf.pos;return new f(this._pbf,b,this.extent,this._keys,this._values)},J3}function Lz(){return Pz||(Pz=1,Qb.VectorTile=function(){if(Mz)return eS;Mz=1;var f=Rz();function c(A,g,b){if(A===3){var B=new f(b,b.readVarint()+b.pos);B.length&&(g[B.name]=B)}}return eS=function(A,g){this.layers=A.readFields(c,{},g)},eS}(),Qb.VectorTileFeature=Fz(),Qb.VectorTileLayer=Rz()),Qb}var m_=u(Lz());const Nye=m_.VectorTileFeature.types,tS=Math.pow(2,13);function __(f,c,A,g,b,B,T,I){f.emplaceBack(c,A,2*Math.floor(g*tS)+T,b*tS*2,B*tS*2,Math.round(I))}class rS{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(A=>A.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new $e,this.centroidVertexArray=new Me,this.indexArray=new Lt,this.programConfigurations=new qi(c.layers,c.zoom),this.segments=new xr,this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(c,A,g){this.features=[],this.hasPattern=q3("fill-extrusion",this.layers,A);for(const{feature:b,id:B,index:T,sourceLayerIndex:I}of c){const L=this.layers[0]._featureFilter.needGeometry,k=lA(b,L);if(!this.layers[0]._featureFilter.filter(new _t(this.zoom),k,g))continue;const j={id:B,sourceLayerIndex:I,index:T,geometry:L?k.geometry:aA(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(K3("fill-extrusion",this.layers,j,this.zoom,A)):this.addFeature(j,j.geometry,T,g,{},A.subdivisionGranularity),A.featureIndex.insert(b,j.geometry,T,I,this.index,!0)}}addFeatures(c,A,g){for(const b of this.features){const{geometry:B}=b;this.addFeature(b,B,b.index,A,g,c.subdivisionGranularity)}}update(c,A,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,A,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Dye),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,Uye.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,A,g,b,B,T){for(const I of wo(A,500)){const L={x:0,y:0,sampleCount:0},k=this.layoutVertexArray.length;this.processPolygon(L,b,c,I,T);const j=this.layoutVertexArray.length-k,G=Math.floor(L.x/L.sampleCount),re=Math.floor(L.y/L.sampleCount);for(let ie=0;ie<j;ie++)this.centroidVertexArray.emplaceBack(G,re)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,B,b)}processPolygon(c,A,g,b,B){if(b.length<1||Oz(b[0]))return;for(const G of b)G.length!==0&&kye(c,G);const T={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},I=B.fill.getGranularityForZoomLevel(A.z),L=Nye[g.type]==="Polygon";for(const G of b){if(G.length===0||Oz(G))continue;const re=Td(G,I,L);this._generateSideFaces(re,T)}if(!L)return;const k=Bz(b,A,I,!1),j=this.layoutVertexArray;Cz((G,re)=>{__(j,G,re,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,k.verticesFlattened,k.indicesTriangles)}_generateSideFaces(c,A){let g=0;for(let b=1;b<c.length;b++){const B=c[b],T=c[b-1];if(Qye(B,T))continue;A.segment.vertexLength+4>xr.MAX_VERTEX_ARRAY_LENGTH&&(A.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const I=B.sub(T)._perp()._unit(),L=T.dist(B);g+L>32768&&(g=0),__(this.layoutVertexArray,B.x,B.y,I.x,I.y,0,0,g),__(this.layoutVertexArray,B.x,B.y,I.x,I.y,0,1,g),g+=L,__(this.layoutVertexArray,T.x,T.y,I.x,I.y,0,0,g),__(this.layoutVertexArray,T.x,T.y,I.x,I.y,0,1,g);const k=A.segment.vertexLength;this.indexArray.emplaceBack(k,k+2,k+1),this.indexArray.emplaceBack(k+1,k+2,k+3),A.segment.vertexLength+=4,A.segment.primitiveLength+=2}}}function kye(f,c){for(let A=0;A<c.length;A++){const g=c[A];A===c.length-1&&c[0].x===g.x&&c[0].y===g.y||(f.x+=g.x,f.y+=g.y,f.sampleCount++)}}function Qye(f,c){return f.x===c.x&&(f.x<0||f.x>Ge)||f.y===c.y&&(f.y<0||f.y>Ge)}function Oz(f){return f.every(c=>c.x<0)||f.every(c=>c.x>Ge)||f.every(c=>c.y<0)||f.every(c=>c.y>Ge)}let Uz;Mr("FillExtrusionBucket",rS,{omit:["layers","features"]});var zye={get paint(){return Uz=Uz||new fn({"fill-extrusion-opacity":new wt(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ir(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $t(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Hye extends mn{constructor(c){super(c,zye)}createBucket(c){return new rS(c)}queryRadius(){return Ob(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c){let{queryGeometry:A,feature:g,featureState:b,geometry:B,transform:T,pixelsToTileUnits:I,pixelPosMatrix:L}=c;const k=Ub(A,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-T.bearingInRadians,I),j=this.paint.get("fill-extrusion-height").evaluate(g,b),G=this.paint.get("fill-extrusion-base").evaluate(g,b),re=function(le,fe,Se){const Ie=[];for(const st of le){const Qe=[st.x,st.y,0,1];oe(Qe,Qe,fe),Ie.push(new M(Qe[0]/Qe[3],Qe[1]/Qe[3]))}return Ie}(k,L),ie=function(le,fe,Se,Ie){const st=[],Qe=[],ne=Ie[8]*fe,Ce=Ie[9]*fe,He=Ie[10]*fe,Tt=Ie[11]*fe,Wt=Ie[8]*Se,Ft=Ie[9]*Se,Nt=Ie[10]*Se,lr=Ie[11]*Se;for(const Zt of le){const fr=[],zt=[];for(const Ur of Zt){const Yr=Ur.x,qr=Ur.y,zr=Ie[0]*Yr+Ie[4]*qr+Ie[12],Pn=Ie[1]*Yr+Ie[5]*qr+Ie[13],rs=Ie[2]*Yr+Ie[6]*qr+Ie[14],Ms=Ie[3]*Yr+Ie[7]*qr+Ie[15],Pa=rs+He,Xa=Ms+Tt,Ya=zr+Wt,So=Pn+Ft,us=rs+Nt,Zs=Ms+lr,Io=new M((zr+ne)/Xa,(Pn+Ce)/Xa);Io.z=Pa/Xa,fr.push(Io);const Ps=new M(Ya/Zs,So/Zs);Ps.z=us/Zs,zt.push(Ps)}st.push(fr),Qe.push(zt)}return[st,Qe]}(B,G,j,L);return function(le,fe,Se){let Ie=1/0;a_(Se,fe)&&(Ie=Dz(Se,fe[0]));for(let st=0;st<fe.length;st++){const Qe=fe[st],ne=le[st];for(let Ce=0;Ce<Qe.length-1;Ce++){const He=Qe[Ce],Tt=[He,Qe[Ce+1],ne[Ce+1],ne[Ce],He];s_(Se,Tt)&&(Ie=Math.min(Ie,Dz(Se,Tt)))}}return Ie!==1/0&&Ie}(ie[0],ie[1],re)}}function y_(f,c){return f.x*c.x+f.y*c.y}function Dz(f,c){if(f.length===1){let A=0;const g=c[A++];let b;for(;!b||g.equals(b);)if(b=c[A++],!b)return 1/0;for(;A<c.length;A++){const B=c[A],T=f[0],I=b.sub(g),L=B.sub(g),k=T.sub(g),j=y_(I,I),G=y_(I,L),re=y_(L,L),ie=y_(k,I),le=y_(k,L),fe=j*re-G*G,Se=(re*ie-G*le)/fe,Ie=(j*le-G*ie)/fe,st=g.z*(1-Se-Ie)+b.z*Se+B.z*Ie;if(isFinite(st))return st}return 1/0}{let A=1/0;for(const g of c)A=Math.min(A,g.z);return A}}const Vye=Gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:jye}=Vye,$ye=Gr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Gye}=$ye,qye=m_.VectorTileFeature.types,Kye=Math.cos(Math.PI/180*37.5),Nz=Math.pow(2,14)/.5;class nS{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(A=>A.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(A=>{this.gradients[A.id]={}}),this.layoutVertexArray=new qe,this.layoutVertexArray2=new Xe,this.indexArray=new Lt,this.programConfigurations=new qi(c.layers,c.zoom),this.segments=new xr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(c,A,g){this.hasPattern=q3("line",this.layers,A);const b=this.layers[0].layout.get("line-sort-key"),B=!b.isConstant(),T=[];for(const{feature:I,id:L,index:k,sourceLayerIndex:j}of c){const G=this.layers[0]._featureFilter.needGeometry,re=lA(I,G);if(!this.layers[0]._featureFilter.filter(new _t(this.zoom),re,g))continue;const ie=B?b.evaluate(re,{},g):void 0,le={id:L,properties:I.properties,type:I.type,sourceLayerIndex:j,index:k,geometry:G?re.geometry:aA(I),patterns:{},sortKey:ie};T.push(le)}B&&T.sort((I,L)=>I.sortKey-L.sortKey);for(const I of T){const{geometry:L,index:k,sourceLayerIndex:j}=I;if(this.hasPattern){const G=K3("line",this.layers,I,this.zoom,A);this.patternFeatures.push(G)}else this.addFeature(I,L,k,g,{},A.subdivisionGranularity);A.featureIndex.insert(c[k].feature,L,k,j,this.index)}}update(c,A,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,A,this.stateDependentLayers,g)}addFeatures(c,A,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,A,g,c.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,Gye)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,jye),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,A,g,b,B,T){const I=this.layers[0].layout,L=I.get("line-join").evaluate(c,{}),k=I.get("line-cap"),j=I.get("line-miter-limit"),G=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const re of A)this.addLine(re,c,L,k,j,G,b,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,B,b)}addLine(c,A,g,b,B,T,I,L){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,c=Td(c,I?L.line.getGranularityForZoomLevel(I.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Qe=0;Qe<c.length-1;Qe++)this.totalDistance+=c[Qe].dist(c[Qe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const k=qye[A.type]==="Polygon";let j=c.length;for(;j>=2&&c[j-1].equals(c[j-2]);)j--;let G=0;for(;G<j-1&&c[G].equals(c[G+1]);)G++;if(j<(k?3:2))return;g==="bevel"&&(B=1.05);const re=this.overscaling<=16?15*Ge/(512*this.overscaling):0,ie=this.segments.prepareSegment(10*j,this.layoutVertexArray,this.indexArray);let le,fe,Se,Ie,st;this.e1=this.e2=-1,k&&(le=c[j-2],st=c[G].sub(le)._unit()._perp());for(let Qe=G;Qe<j;Qe++){if(Se=Qe===j-1?k?c[G+1]:void 0:c[Qe+1],Se&&c[Qe].equals(Se))continue;st&&(Ie=st),le&&(fe=le),le=c[Qe],st=Se?Se.sub(le)._unit()._perp():Ie,Ie=Ie||st;let ne=Ie.add(st);ne.x===0&&ne.y===0||ne._unit();const Ce=Ie.x*st.x+Ie.y*st.y,He=ne.x*st.x+ne.y*st.y,Tt=He!==0?1/He:1/0,Wt=2*Math.sqrt(2-2*He),Ft=He<Kye&&fe&&Se,Nt=Ie.x*st.y-Ie.y*st.x>0;if(Ft&&Qe>G){const fr=le.dist(fe);if(fr>2*re){const zt=le.sub(le.sub(fe)._mult(re/fr)._round());this.updateDistance(fe,zt),this.addCurrentVertex(zt,Ie,0,0,ie),fe=zt}}const lr=fe&&Se;let Zt=lr?g:k?"butt":b;if(lr&&Zt==="round"&&(Tt<T?Zt="miter":Tt<=2&&(Zt="fakeround")),Zt==="miter"&&Tt>B&&(Zt="bevel"),Zt==="bevel"&&(Tt>2&&(Zt="flipbevel"),Tt<B&&(Zt="miter")),fe&&this.updateDistance(fe,le),Zt==="miter")ne._mult(Tt),this.addCurrentVertex(le,ne,0,0,ie);else if(Zt==="flipbevel"){if(Tt>100)ne=st.mult(-1);else{const fr=Tt*Ie.add(st).mag()/Ie.sub(st).mag();ne._perp()._mult(fr*(Nt?-1:1))}this.addCurrentVertex(le,ne,0,0,ie),this.addCurrentVertex(le,ne.mult(-1),0,0,ie)}else if(Zt==="bevel"||Zt==="fakeround"){const fr=-Math.sqrt(Tt*Tt-1),zt=Nt?fr:0,Ur=Nt?0:fr;if(fe&&this.addCurrentVertex(le,Ie,zt,Ur,ie),Zt==="fakeround"){const Yr=Math.round(180*Wt/Math.PI/20);for(let qr=1;qr<Yr;qr++){let zr=qr/Yr;if(zr!==.5){const rs=zr-.5;zr+=zr*rs*(zr-1)*((1.0904+Ce*(Ce*(3.55645-1.43519*Ce)-3.2452))*rs*rs+(.848013+Ce*(.215638*Ce-1.06021)))}const Pn=st.sub(Ie)._mult(zr)._add(Ie)._unit()._mult(Nt?-1:1);this.addHalfVertex(le,Pn.x,Pn.y,!1,Nt,0,ie)}}Se&&this.addCurrentVertex(le,st,-zt,-Ur,ie)}else if(Zt==="butt")this.addCurrentVertex(le,ne,0,0,ie);else if(Zt==="square"){const fr=fe?1:-1;this.addCurrentVertex(le,ne,fr,fr,ie)}else Zt==="round"&&(fe&&(this.addCurrentVertex(le,Ie,0,0,ie),this.addCurrentVertex(le,Ie,1,1,ie,!0)),Se&&(this.addCurrentVertex(le,st,-1,-1,ie,!0),this.addCurrentVertex(le,st,0,0,ie)));if(Ft&&Qe<j-1){const fr=le.dist(Se);if(fr>2*re){const zt=le.add(Se.sub(le)._mult(re/fr)._round());this.updateDistance(le,zt),this.addCurrentVertex(zt,st,0,0,ie),le=zt}}}}addCurrentVertex(c,A,g,b,B){let T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const I=A.y*b-A.x,L=-A.y-A.x*b;this.addHalfVertex(c,A.x+A.y*g,A.y-A.x*g,T,!1,g,B),this.addHalfVertex(c,I,L,T,!0,-b,B),this.distance>Nz/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,A,g,b,B,T))}addHalfVertex(c,A,g,b,B,T,I){let{x:L,y:k}=c;const j=.5*(this.lineClips?this.scaledDistance*(Nz-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((L<<1)+(b?1:0),(k<<1)+(B?1:0),Math.round(63*A)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&j)<<2,j>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const G=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,G,this.e2),I.primitiveLength++),B?this.e2=G:this.e1=G}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,A){this.distance+=c.dist(A),this.updateScaledDistance()}}let kz,Qz;Mr("LineBucket",nS,{omit:["layers","patternFeatures"]});var zz={get paint(){return Qz=Qz||new fn({"line-opacity":new $t(Be.paint_line["line-opacity"]),"line-color":new $t(Be.paint_line["line-color"]),"line-translate":new wt(Be.paint_line["line-translate"]),"line-translate-anchor":new wt(Be.paint_line["line-translate-anchor"]),"line-width":new $t(Be.paint_line["line-width"]),"line-gap-width":new $t(Be.paint_line["line-gap-width"]),"line-offset":new $t(Be.paint_line["line-offset"]),"line-blur":new $t(Be.paint_line["line-blur"]),"line-dasharray":new Zr(Be.paint_line["line-dasharray"]),"line-pattern":new Ir(Be.paint_line["line-pattern"]),"line-gradient":new Fr(Be.paint_line["line-gradient"])})},get layout(){return kz=kz||new fn({"line-cap":new wt(Be.layout_line["line-cap"]),"line-join":new $t(Be.layout_line["line-join"]),"line-miter-limit":new wt(Be.layout_line["line-miter-limit"]),"line-round-limit":new wt(Be.layout_line["line-round-limit"]),"line-sort-key":new $t(Be.layout_line["line-sort-key"])})}};class Wye extends $t{possiblyEvaluate(c,A){return A=new _t(Math.floor(A.zoom),{now:A.now,fadeDuration:A.fadeDuration,zoomHistory:A.zoomHistory,transition:A.transition}),super.possiblyEvaluate(c,A)}evaluate(c,A,g,b){return A=De({},A,{zoom:Math.floor(A.zoom)}),super.evaluate(c,A,g,b)}}let zb;class Xye extends mn{constructor(c){super(c,zz),this.gradientVersion=0,zb||(zb=new Wye(zz.paint.properties["line-width"].specification),zb.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const A=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(A)&&A._styleExpression.expression instanceof Ha,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,A){super.recalculate(c,A),this.paint._values["line-floorwidth"]=zb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new nS(c)}queryRadius(c){const A=c,g=Hz(c_("line-width",this,A),c_("line-gap-width",this,A)),b=c_("line-offset",this,A);return g/2+Math.abs(b)+Ob(this.paint.get("line-translate"))}queryIntersectsFeature(c){let{queryGeometry:A,feature:g,featureState:b,geometry:B,transform:T,pixelsToTileUnits:I}=c;const L=Ub(A,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-T.bearingInRadians,I),k=I/2*Hz(this.paint.get("line-width").evaluate(g,b),this.paint.get("line-gap-width").evaluate(g,b)),j=this.paint.get("line-offset").evaluate(g,b);return j&&(B=function(G,re){const ie=[];for(let le=0;le<G.length;le++){const fe=G[le],Se=[];for(let Ie=0;Ie<fe.length;Ie++){const st=fe[Ie-1],Qe=fe[Ie],ne=fe[Ie+1],Ce=Ie===0?new M(0,0):Qe.sub(st)._unit()._perp(),He=Ie===fe.length-1?new M(0,0):ne.sub(Qe)._unit()._perp(),Tt=Ce._add(He)._unit(),Wt=Tt.x*He.x+Tt.y*He.y;Wt!==0&&Tt._mult(1/Wt),Se.push(Tt._mult(re)._add(Qe))}ie.push(Se)}return ie}(B,j*I)),function(G,re,ie){for(let le=0;le<re.length;le++){const fe=re[le];if(G.length>=3){for(let Se=0;Se<fe.length;Se++)if(rg(G,fe[Se]))return!0}if(l_(G,fe,ie))return!0}return!1}(L,B,k)}isTileClipped(){return!0}}function Hz(f,c){return c>0?c+2*f:f}const Yye=Gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zye=Gr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jye=Gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Gr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vz=Gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),e0e=Gr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function t0e(f,c,A){return f.sections.forEach(g=>{g.text=function(b,B,T){const I=B.layout.get("text-transform").evaluate(T,{});return I==="uppercase"?b=b.toLocaleUpperCase():I==="lowercase"&&(b=b.toLocaleLowerCase()),ot.applyArabicShaping&&(b=ot.applyArabicShaping(b)),b}(g.text,c,A)}),f}Gr([{name:"triangle",components:3,type:"Uint16"}]),Gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gr([{type:"Float32",name:"offsetX"}]),Gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const b_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var jz,iS,$z,Ys=24,sS={};function r0e(){return jz||(jz=1,sS.read=function(f,c,A,g,b){var B,T,I=8*b-g-1,L=(1<<I)-1,k=L>>1,j=-7,G=A?b-1:0,re=A?-1:1,ie=f[c+G];for(G+=re,B=ie&(1<<-j)-1,ie>>=-j,j+=I;j>0;B=256*B+f[c+G],G+=re,j-=8);for(T=B&(1<<-j)-1,B>>=-j,j+=g;j>0;T=256*T+f[c+G],G+=re,j-=8);if(B===0)B=1-k;else{if(B===L)return T?NaN:1/0*(ie?-1:1);T+=Math.pow(2,g),B-=k}return(ie?-1:1)*T*Math.pow(2,B-g)},sS.write=function(f,c,A,g,b,B){var T,I,L,k=8*B-b-1,j=(1<<k)-1,G=j>>1,re=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,ie=g?0:B-1,le=g?1:-1,fe=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(I=isNaN(c)?1:0,T=j):(T=Math.floor(Math.log(c)/Math.LN2),c*(L=Math.pow(2,-T))<1&&(T--,L*=2),(c+=T+G>=1?re/L:re*Math.pow(2,1-G))*L>=2&&(T++,L/=2),T+G>=j?(I=0,T=j):T+G>=1?(I=(c*L-1)*Math.pow(2,b),T+=G):(I=c*Math.pow(2,G-1)*Math.pow(2,b),T=0));b>=8;f[A+ie]=255&I,ie+=le,I/=256,b-=8);for(T=T<<b|I,k+=b;k>0;f[A+ie]=255&T,ie+=le,T/=256,k-=8);f[A+ie-le]|=128*fe}),sS}function Gz(){if($z)return iS;$z=1,iS=c;var f=r0e();function c(ne){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ne)?ne:new Uint8Array(ne||0),this.pos=0,this.type=0,this.length=this.buf.length}c.Varint=0,c.Fixed64=1,c.Bytes=2,c.Fixed32=5;var A=4294967296,g=1/A,b=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function B(ne){return ne.type===c.Bytes?ne.readVarint()+ne.pos:ne.pos+1}function T(ne,Ce,He){return He?4294967296*Ce+(ne>>>0):4294967296*(Ce>>>0)+(ne>>>0)}function I(ne,Ce,He){var Tt=Ce<=16383?1:Ce<=2097151?2:Ce<=268435455?3:Math.floor(Math.log(Ce)/(7*Math.LN2));He.realloc(Tt);for(var Wt=He.pos-1;Wt>=ne;Wt--)He.buf[Wt+Tt]=He.buf[Wt]}function L(ne,Ce){for(var He=0;He<ne.length;He++)Ce.writeVarint(ne[He])}function k(ne,Ce){for(var He=0;He<ne.length;He++)Ce.writeSVarint(ne[He])}function j(ne,Ce){for(var He=0;He<ne.length;He++)Ce.writeFloat(ne[He])}function G(ne,Ce){for(var He=0;He<ne.length;He++)Ce.writeDouble(ne[He])}function re(ne,Ce){for(var He=0;He<ne.length;He++)Ce.writeBoolean(ne[He])}function ie(ne,Ce){for(var He=0;He<ne.length;He++)Ce.writeFixed32(ne[He])}function le(ne,Ce){for(var He=0;He<ne.length;He++)Ce.writeSFixed32(ne[He])}function fe(ne,Ce){for(var He=0;He<ne.length;He++)Ce.writeFixed64(ne[He])}function Se(ne,Ce){for(var He=0;He<ne.length;He++)Ce.writeSFixed64(ne[He])}function Ie(ne,Ce){return(ne[Ce]|ne[Ce+1]<<8|ne[Ce+2]<<16)+16777216*ne[Ce+3]}function st(ne,Ce,He){ne[He]=Ce,ne[He+1]=Ce>>>8,ne[He+2]=Ce>>>16,ne[He+3]=Ce>>>24}function Qe(ne,Ce){return(ne[Ce]|ne[Ce+1]<<8|ne[Ce+2]<<16)+(ne[Ce+3]<<24)}return c.prototype={destroy:function(){this.buf=null},readFields:function(ne,Ce,He){for(He=He||this.length;this.pos<He;){var Tt=this.readVarint(),Wt=Tt>>3,Ft=this.pos;this.type=7&Tt,ne(Wt,Ce,this),this.pos===Ft&&this.skip(Tt)}return Ce},readMessage:function(ne,Ce){return this.readFields(ne,Ce,this.readVarint()+this.pos)},readFixed32:function(){var ne=Ie(this.buf,this.pos);return this.pos+=4,ne},readSFixed32:function(){var ne=Qe(this.buf,this.pos);return this.pos+=4,ne},readFixed64:function(){var ne=Ie(this.buf,this.pos)+Ie(this.buf,this.pos+4)*A;return this.pos+=8,ne},readSFixed64:function(){var ne=Ie(this.buf,this.pos)+Qe(this.buf,this.pos+4)*A;return this.pos+=8,ne},readFloat:function(){var ne=f.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ne},readDouble:function(){var ne=f.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ne},readVarint:function(ne){var Ce,He,Tt=this.buf;return Ce=127&(He=Tt[this.pos++]),He<128?Ce:(Ce|=(127&(He=Tt[this.pos++]))<<7,He<128?Ce:(Ce|=(127&(He=Tt[this.pos++]))<<14,He<128?Ce:(Ce|=(127&(He=Tt[this.pos++]))<<21,He<128?Ce:function(Wt,Ft,Nt){var lr,Zt,fr=Nt.buf;if(lr=(112&(Zt=fr[Nt.pos++]))>>4,Zt<128||(lr|=(127&(Zt=fr[Nt.pos++]))<<3,Zt<128)||(lr|=(127&(Zt=fr[Nt.pos++]))<<10,Zt<128)||(lr|=(127&(Zt=fr[Nt.pos++]))<<17,Zt<128)||(lr|=(127&(Zt=fr[Nt.pos++]))<<24,Zt<128)||(lr|=(1&(Zt=fr[Nt.pos++]))<<31,Zt<128))return T(Wt,lr,Ft);throw new Error("Expected varint not more than 10 bytes")}(Ce|=(15&(He=Tt[this.pos]))<<28,ne,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ne=this.readVarint();return ne%2==1?(ne+1)/-2:ne/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ne=this.readVarint()+this.pos,Ce=this.pos;return this.pos=ne,ne-Ce>=12&&b?function(He,Tt,Wt){return b.decode(He.subarray(Tt,Wt))}(this.buf,Ce,ne):function(He,Tt,Wt){for(var Ft="",Nt=Tt;Nt<Wt;){var lr,Zt,fr,zt=He[Nt],Ur=null,Yr=zt>239?4:zt>223?3:zt>191?2:1;if(Nt+Yr>Wt)break;Yr===1?zt<128&&(Ur=zt):Yr===2?(192&(lr=He[Nt+1]))==128&&(Ur=(31&zt)<<6|63&lr)<=127&&(Ur=null):Yr===3?(Zt=He[Nt+2],(192&(lr=He[Nt+1]))==128&&(192&Zt)==128&&((Ur=(15&zt)<<12|(63&lr)<<6|63&Zt)<=2047||Ur>=55296&&Ur<=57343)&&(Ur=null)):Yr===4&&(Zt=He[Nt+2],fr=He[Nt+3],(192&(lr=He[Nt+1]))==128&&(192&Zt)==128&&(192&fr)==128&&((Ur=(15&zt)<<18|(63&lr)<<12|(63&Zt)<<6|63&fr)<=65535||Ur>=1114112)&&(Ur=null)),Ur===null?(Ur=65533,Yr=1):Ur>65535&&(Ur-=65536,Ft+=String.fromCharCode(Ur>>>10&1023|55296),Ur=56320|1023&Ur),Ft+=String.fromCharCode(Ur),Nt+=Yr}return Ft}(this.buf,Ce,ne)},readBytes:function(){var ne=this.readVarint()+this.pos,Ce=this.buf.subarray(this.pos,ne);return this.pos=ne,Ce},readPackedVarint:function(ne,Ce){if(this.type!==c.Bytes)return ne.push(this.readVarint(Ce));var He=B(this);for(ne=ne||[];this.pos<He;)ne.push(this.readVarint(Ce));return ne},readPackedSVarint:function(ne){if(this.type!==c.Bytes)return ne.push(this.readSVarint());var Ce=B(this);for(ne=ne||[];this.pos<Ce;)ne.push(this.readSVarint());return ne},readPackedBoolean:function(ne){if(this.type!==c.Bytes)return ne.push(this.readBoolean());var Ce=B(this);for(ne=ne||[];this.pos<Ce;)ne.push(this.readBoolean());return ne},readPackedFloat:function(ne){if(this.type!==c.Bytes)return ne.push(this.readFloat());var Ce=B(this);for(ne=ne||[];this.pos<Ce;)ne.push(this.readFloat());return ne},readPackedDouble:function(ne){if(this.type!==c.Bytes)return ne.push(this.readDouble());var Ce=B(this);for(ne=ne||[];this.pos<Ce;)ne.push(this.readDouble());return ne},readPackedFixed32:function(ne){if(this.type!==c.Bytes)return ne.push(this.readFixed32());var Ce=B(this);for(ne=ne||[];this.pos<Ce;)ne.push(this.readFixed32());return ne},readPackedSFixed32:function(ne){if(this.type!==c.Bytes)return ne.push(this.readSFixed32());var Ce=B(this);for(ne=ne||[];this.pos<Ce;)ne.push(this.readSFixed32());return ne},readPackedFixed64:function(ne){if(this.type!==c.Bytes)return ne.push(this.readFixed64());var Ce=B(this);for(ne=ne||[];this.pos<Ce;)ne.push(this.readFixed64());return ne},readPackedSFixed64:function(ne){if(this.type!==c.Bytes)return ne.push(this.readSFixed64());var Ce=B(this);for(ne=ne||[];this.pos<Ce;)ne.push(this.readSFixed64());return ne},skip:function(ne){var Ce=7&ne;if(Ce===c.Varint)for(;this.buf[this.pos++]>127;);else if(Ce===c.Bytes)this.pos=this.readVarint()+this.pos;else if(Ce===c.Fixed32)this.pos+=4;else{if(Ce!==c.Fixed64)throw new Error("Unimplemented type: "+Ce);this.pos+=8}},writeTag:function(ne,Ce){this.writeVarint(ne<<3|Ce)},realloc:function(ne){for(var Ce=this.length||16;Ce<this.pos+ne;)Ce*=2;if(Ce!==this.length){var He=new Uint8Array(Ce);He.set(this.buf),this.buf=He,this.length=Ce}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ne){this.realloc(4),st(this.buf,ne,this.pos),this.pos+=4},writeSFixed32:function(ne){this.realloc(4),st(this.buf,ne,this.pos),this.pos+=4},writeFixed64:function(ne){this.realloc(8),st(this.buf,-1&ne,this.pos),st(this.buf,Math.floor(ne*g),this.pos+4),this.pos+=8},writeSFixed64:function(ne){this.realloc(8),st(this.buf,-1&ne,this.pos),st(this.buf,Math.floor(ne*g),this.pos+4),this.pos+=8},writeVarint:function(ne){(ne=+ne||0)>268435455||ne<0?function(Ce,He){var Tt,Wt;if(Ce>=0?(Tt=Ce%4294967296|0,Wt=Ce/4294967296|0):(Wt=~(-Ce/4294967296),4294967295^(Tt=~(-Ce%4294967296))?Tt=Tt+1|0:(Tt=0,Wt=Wt+1|0)),Ce>=18446744073709552e3||Ce<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");He.realloc(10),function(Ft,Nt,lr){lr.buf[lr.pos++]=127&Ft|128,Ft>>>=7,lr.buf[lr.pos++]=127&Ft|128,Ft>>>=7,lr.buf[lr.pos++]=127&Ft|128,Ft>>>=7,lr.buf[lr.pos++]=127&Ft|128,lr.buf[lr.pos]=127&(Ft>>>=7)}(Tt,0,He),function(Ft,Nt){var lr=(7&Ft)<<4;Nt.buf[Nt.pos++]|=lr|((Ft>>>=3)?128:0),Ft&&(Nt.buf[Nt.pos++]=127&Ft|((Ft>>>=7)?128:0),Ft&&(Nt.buf[Nt.pos++]=127&Ft|((Ft>>>=7)?128:0),Ft&&(Nt.buf[Nt.pos++]=127&Ft|((Ft>>>=7)?128:0),Ft&&(Nt.buf[Nt.pos++]=127&Ft|((Ft>>>=7)?128:0),Ft&&(Nt.buf[Nt.pos++]=127&Ft)))))}(Wt,He)}(ne,this):(this.realloc(4),this.buf[this.pos++]=127&ne|(ne>127?128:0),ne<=127||(this.buf[this.pos++]=127&(ne>>>=7)|(ne>127?128:0),ne<=127||(this.buf[this.pos++]=127&(ne>>>=7)|(ne>127?128:0),ne<=127||(this.buf[this.pos++]=ne>>>7&127))))},writeSVarint:function(ne){this.writeVarint(ne<0?2*-ne-1:2*ne)},writeBoolean:function(ne){this.writeVarint(!!ne)},writeString:function(ne){ne=String(ne),this.realloc(4*ne.length),this.pos++;var Ce=this.pos;this.pos=function(Tt,Wt,Ft){for(var Nt,lr,Zt=0;Zt<Wt.length;Zt++){if((Nt=Wt.charCodeAt(Zt))>55295&&Nt<57344){if(!lr){Nt>56319||Zt+1===Wt.length?(Tt[Ft++]=239,Tt[Ft++]=191,Tt[Ft++]=189):lr=Nt;continue}if(Nt<56320){Tt[Ft++]=239,Tt[Ft++]=191,Tt[Ft++]=189,lr=Nt;continue}Nt=lr-55296<<10|Nt-56320|65536,lr=null}else lr&&(Tt[Ft++]=239,Tt[Ft++]=191,Tt[Ft++]=189,lr=null);Nt<128?Tt[Ft++]=Nt:(Nt<2048?Tt[Ft++]=Nt>>6|192:(Nt<65536?Tt[Ft++]=Nt>>12|224:(Tt[Ft++]=Nt>>18|240,Tt[Ft++]=Nt>>12&63|128),Tt[Ft++]=Nt>>6&63|128),Tt[Ft++]=63&Nt|128)}return Ft}(this.buf,ne,this.pos);var He=this.pos-Ce;He>=128&&I(Ce,He,this),this.pos=Ce-1,this.writeVarint(He),this.pos+=He},writeFloat:function(ne){this.realloc(4),f.write(this.buf,ne,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ne){this.realloc(8),f.write(this.buf,ne,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ne){var Ce=ne.length;this.writeVarint(Ce),this.realloc(Ce);for(var He=0;He<Ce;He++)this.buf[this.pos++]=ne[He]},writeRawMessage:function(ne,Ce){this.pos++;var He=this.pos;ne(Ce,this);var Tt=this.pos-He;Tt>=128&&I(He,Tt,this),this.pos=He-1,this.writeVarint(Tt),this.pos+=Tt},writeMessage:function(ne,Ce,He){this.writeTag(ne,c.Bytes),this.writeRawMessage(Ce,He)},writePackedVarint:function(ne,Ce){Ce.length&&this.writeMessage(ne,L,Ce)},writePackedSVarint:function(ne,Ce){Ce.length&&this.writeMessage(ne,k,Ce)},writePackedBoolean:function(ne,Ce){Ce.length&&this.writeMessage(ne,re,Ce)},writePackedFloat:function(ne,Ce){Ce.length&&this.writeMessage(ne,j,Ce)},writePackedDouble:function(ne,Ce){Ce.length&&this.writeMessage(ne,G,Ce)},writePackedFixed32:function(ne,Ce){Ce.length&&this.writeMessage(ne,ie,Ce)},writePackedSFixed32:function(ne,Ce){Ce.length&&this.writeMessage(ne,le,Ce)},writePackedFixed64:function(ne,Ce){Ce.length&&this.writeMessage(ne,fe,Ce)},writePackedSFixed64:function(ne,Ce){Ce.length&&this.writeMessage(ne,Se,Ce)},writeBytesField:function(ne,Ce){this.writeTag(ne,c.Bytes),this.writeBytes(Ce)},writeFixed32Field:function(ne,Ce){this.writeTag(ne,c.Fixed32),this.writeFixed32(Ce)},writeSFixed32Field:function(ne,Ce){this.writeTag(ne,c.Fixed32),this.writeSFixed32(Ce)},writeFixed64Field:function(ne,Ce){this.writeTag(ne,c.Fixed64),this.writeFixed64(Ce)},writeSFixed64Field:function(ne,Ce){this.writeTag(ne,c.Fixed64),this.writeSFixed64(Ce)},writeVarintField:function(ne,Ce){this.writeTag(ne,c.Varint),this.writeVarint(Ce)},writeSVarintField:function(ne,Ce){this.writeTag(ne,c.Varint),this.writeSVarint(Ce)},writeStringField:function(ne,Ce){this.writeTag(ne,c.Bytes),this.writeString(Ce)},writeFloatField:function(ne,Ce){this.writeTag(ne,c.Fixed32),this.writeFloat(Ce)},writeDoubleField:function(ne,Ce){this.writeTag(ne,c.Fixed64),this.writeDouble(Ce)},writeBooleanField:function(ne,Ce){this.writeVarintField(ne,!!Ce)}},iS}var oS=u(Gz());const aS=3;function n0e(f,c,A){f===1&&A.readMessage(i0e,c)}function i0e(f,c,A){if(f===3){const{id:g,bitmap:b,width:B,height:T,left:I,top:L,advance:k}=A.readMessage(s0e,{});c.push({id:g,bitmap:new u_({width:B+2*aS,height:T+2*aS},b),metrics:{width:B,height:T,left:I,top:L,advance:k}})}}function s0e(f,c,A){f===1?c.id=A.readVarint():f===2?c.bitmap=A.readBytes():f===3?c.width=A.readVarint():f===4?c.height=A.readVarint():f===5?c.left=A.readSVarint():f===6?c.top=A.readSVarint():f===7&&(c.advance=A.readVarint())}const o0e=aS;function qz(f){let c=0,A=0;for(const T of f)c+=T.w*T.h,A=Math.max(A,T.w);f.sort((T,I)=>I.h-T.h);const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),A),h:1/0}];let b=0,B=0;for(const T of f)for(let I=g.length-1;I>=0;I--){const L=g[I];if(!(T.w>L.w||T.h>L.h)){if(T.x=L.x,T.y=L.y,B=Math.max(B,T.y+T.h),b=Math.max(b,T.x+T.w),T.w===L.w&&T.h===L.h){const k=g.pop();I<g.length&&(g[I]=k)}else T.h===L.h?(L.x+=T.w,L.w-=T.w):T.w===L.w?(L.y+=T.h,L.h-=T.h):(g.push({x:L.x+T.w,y:L.y,w:L.w-T.w,h:T.h}),L.y+=T.h,L.h-=T.h);break}}return{w:b,h:B,fill:c/(b*B)||0}}const Wa=1;class lS{constructor(c,A){let{pixelRatio:g,version:b,stretchX:B,stretchY:T,content:I,textFitWidth:L,textFitHeight:k}=A;this.paddedRect=c,this.pixelRatio=g,this.stretchX=B,this.stretchY=T,this.content=I,this.version=b,this.textFitWidth=L,this.textFitHeight=k}get tl(){return[this.paddedRect.x+Wa,this.paddedRect.y+Wa]}get br(){return[this.paddedRect.x+this.paddedRect.w-Wa,this.paddedRect.y+this.paddedRect.h-Wa]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Wa)/this.pixelRatio,(this.paddedRect.h-2*Wa)/this.pixelRatio]}}class Kz{constructor(c,A){const g={},b={};this.haveRenderCallbacks=[];const B=[];this.addImages(c,g,B),this.addImages(A,b,B);const{w:T,h:I}=qz(B),L=new jl({width:T||1,height:I||1});for(const k in c){const j=c[k],G=g[k].paddedRect;jl.copy(j.data,L,{x:0,y:0},{x:G.x+Wa,y:G.y+Wa},j.data)}for(const k in A){const j=A[k],G=b[k].paddedRect,re=G.x+Wa,ie=G.y+Wa,le=j.data.width,fe=j.data.height;jl.copy(j.data,L,{x:0,y:0},{x:re,y:ie},j.data),jl.copy(j.data,L,{x:0,y:fe-1},{x:re,y:ie-1},{width:le,height:1}),jl.copy(j.data,L,{x:0,y:0},{x:re,y:ie+fe},{width:le,height:1}),jl.copy(j.data,L,{x:le-1,y:0},{x:re-1,y:ie},{width:1,height:fe}),jl.copy(j.data,L,{x:0,y:0},{x:re+le,y:ie},{width:1,height:fe})}this.image=L,this.iconPositions=g,this.patternPositions=b}addImages(c,A,g){for(const b in c){const B=c[b],T={x:0,y:0,w:B.data.width+2*Wa,h:B.data.height+2*Wa};g.push(T),A[b]=new lS(T,B),B.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(c,A){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const g in c.updatedImages)this.patchUpdatedImage(this.iconPositions[g],c.getImage(g),A),this.patchUpdatedImage(this.patternPositions[g],c.getImage(g),A)}patchUpdatedImage(c,A,g){if(!c||!A||c.version===A.version)return;c.version=A.version;const[b,B]=c.tl;g.update(A.data,void 0,{x:b,y:B})}}var df;Mr("ImagePosition",lS),Mr("ImageAtlas",Kz),a.af=void 0,(df=a.af||(a.af={}))[df.none=0]="none",df[df.horizontal=1]="horizontal",df[df.vertical=2]="vertical",df[df.horizontalOnly=3]="horizontalOnly";const Hb=-17;class v_{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(c,A,g){const b=new v_;return b.scale=c||1,b.fontStack=A,b.verticalAlign=g||"bottom",b}static forImage(c,A){const g=new v_;return g.imageName=c,g.verticalAlign=A||"bottom",g}}class og{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,A){const g=new og;for(let b=0;b<c.sections.length;b++){const B=c.sections[b];B.image?g.addImageSection(B):g.addTextSection(B,A)}return g}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let A="";for(let g=0;g<c.length;g++){const b=c.charCodeAt(g+1)||null,B=c.charCodeAt(g-1)||null;A+=b&&ye(b)&&!b_[c[g+1]]||B&&ye(B)&&!b_[c[g-1]]||!b_[c[g]]?c[g]:b_[c[g]]}return A}(this.text)}trim(){let c=0;for(let g=0;g<this.text.length&&jb[this.text.charCodeAt(g)];g++)c++;let A=this.text.length;for(let g=this.text.length-1;g>=0&&g>=c&&jb[this.text.charCodeAt(g)];g--)A--;this.text=this.text.substring(c,A),this.sectionIndex=this.sectionIndex.slice(c,A)}substring(c,A){const g=new og;return g.text=this.text.substring(c,A),g.sectionIndex=this.sectionIndex.slice(c,A),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,A)=>Math.max(c,this.sections[A].scale),0)}getMaxImageSize(c){let A=0,g=0;for(let b=0;b<this.length();b++){const B=this.getSection(b);if(B.imageName){const T=c[B.imageName];if(!T)continue;const I=T.displaySize;A=Math.max(A,I[0]),g=Math.max(g,I[1])}}return{maxImageWidth:A,maxImageHeight:g}}addTextSection(c,A){this.text+=c.text,this.sections.push(v_.forText(c.scale,c.fontStack||A,c.verticalAlign));const g=this.sections.length-1;for(let b=0;b<c.text.length;++b)this.sectionIndex.push(g)}addImageSection(c){const A=c.image?c.image.name:"";if(A.length===0)return void qt("Can't add FormattedSection with an empty image.");const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(v_.forImage(A,c.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vb(f,c,A,g,b,B,T,I,L,k,j,G,re,ie,le){const fe=og.fromFeature(f,b);let Se;G===a.af.vertical&&fe.verticalizePunctuation();const{processBidirectionalText:Ie,processStyledBidirectionalText:st}=ot;if(Ie&&fe.sections.length===1){Se=[];const Ce=Ie(fe.toString(),cS(fe,k,B,c,g,ie));for(const He of Ce){const Tt=new og;Tt.text=He,Tt.sections=fe.sections;for(let Wt=0;Wt<He.length;Wt++)Tt.sectionIndex.push(0);Se.push(Tt)}}else if(st){Se=[];const Ce=st(fe.text,fe.sectionIndex,cS(fe,k,B,c,g,ie));for(const He of Ce){const Tt=new og;Tt.text=He[0],Tt.sectionIndex=He[1],Tt.sections=fe.sections,Se.push(Tt)}}else Se=function(Ce,He){const Tt=[],Wt=Ce.text;let Ft=0;for(const Nt of He)Tt.push(Ce.substring(Ft,Nt)),Ft=Nt;return Ft<Wt.length&&Tt.push(Ce.substring(Ft,Wt.length)),Tt}(fe,cS(fe,k,B,c,g,ie));const Qe=[],ne={positionedLines:Qe,text:fe.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(Ce,He,Tt,Wt,Ft,Nt,lr,Zt,fr,zt,Ur,Yr){let qr=0,zr=0,Pn=0,rs=0;const Ms=Zt==="right"?1:Zt==="left"?0:.5,Pa=Ys/Yr;let Xa=0;for(const us of Ft){us.trim();const Zs=us.getMaxScale(),Io={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[Xa]=Io;const Ps=Io.positionedGlyphs;let Fa=0;if(!us.length()){zr+=Nt,++Xa;continue}const Gl=u0e(Wt,us,Pa);for(let Za=0;Za<us.length();Za++){const Js=us.getSection(Za),fo=us.getSectionIndex(Za),po=us.getCharCode(Za),Fs=h0e(fr,Ur,po);let Fi;if(Js.imageName){if(Ce.iconsInText=!0,Js.scale=Js.scale*Pa,Fi=f0e(Js,Fs,Zs,Gl,Wt),!Fi)continue;Fa=Math.max(Fa,Fi.imageOffset)}else if(Fi=A0e(Js,po,Fs,Gl,He,Tt),!Fi)continue;const{rect:ku,metrics:ug,baselineOffset:Qu}=Fi;Ps.push({glyph:po,imageName:Js.imageName,x:qr,y:zr+Qu+Hb,vertical:Fs,scale:Js.scale,fontStack:Js.fontStack,sectionIndex:fo,metrics:ug,rect:ku}),Fs?(Ce.verticalizable=!0,qr+=(Js.imageName?ug.advance:Ys)*Js.scale+zt):qr+=ug.advance*Js.scale+zt}Ps.length!==0&&(Pn=Math.max(qr-zt,Pn),d0e(Ps,0,Ps.length-1,Ms)),qr=0,Io.lineOffset=Math.max(Fa,(Zs-1)*Ys);const Ao=Nt*Zs+Fa;zr+=Ao,rs=Math.max(Ao,rs),++Xa}const{horizontalAlign:Ya,verticalAlign:So}=uS(lr);(function(us,Zs,Io,Ps,Fa,Gl,Ao,Za,Js){const fo=(Zs-Io)*Fa;let po=0;po=Gl!==Ao?-Za*Ps-Hb:-Ps*Js*Ao+.5*Ao;for(const Fs of us)for(const Fi of Fs.positionedGlyphs)Fi.x+=fo,Fi.y+=po})(Ce.positionedLines,Ms,Ya,So,Pn,rs,Nt,zr,Ft.length),Ce.top+=-So*zr,Ce.bottom=Ce.top+zr,Ce.left+=-Ya*Pn,Ce.right=Ce.left+Pn}(ne,c,A,g,Se,T,I,L,G,k,re,le),!function(Ce){for(const He of Ce)if(He.positionedGlyphs.length!==0)return!1;return!0}(Qe)&&ne}const jb={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},a0e={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},l0e={40:!0};function Wz(f,c,A,g,b,B){if(c.imageName){const T=g[c.imageName];return T?T.displaySize[0]*c.scale*Ys/B+b:0}{const T=A[c.fontStack],I=T&&T[f];return I?I.metrics.advance*c.scale+b:0}}function Xz(f,c,A,g){const b=Math.pow(f-c,2);return g?f<c?b/2:2*b:b+Math.abs(A)*A}function c0e(f,c,A){let g=0;return f===10&&(g-=1e4),A&&(g+=150),f!==40&&f!==65288||(g+=50),c!==41&&c!==65289||(g+=50),g}function Yz(f,c,A,g,b,B){let T=null,I=Xz(c,A,b,B);for(const L of g){const k=Xz(c-L.x,A,b,B)+L.badness;k<=I&&(T=L,I=k)}return{index:f,x:c,priorBreak:T,badness:I}}function Zz(f){return f?Zz(f.priorBreak).concat(f.index):[]}function cS(f,c,A,g,b,B){if(!f)return[];const T=[],I=function(G,re,ie,le,fe,Se){let Ie=0;for(let st=0;st<G.length();st++){const Qe=G.getSection(st);Ie+=Wz(G.getCharCode(st),Qe,le,fe,re,Se)}return Ie/Math.max(1,Math.ceil(Ie/ie))}(f,c,A,g,b,B),L=f.text.indexOf("​")>=0;let k=0;for(let G=0;G<f.length();G++){const re=f.getSection(G),ie=f.getCharCode(G);if(jb[ie]||(k+=Wz(ie,re,g,b,c,B)),G<f.length()-1){const le=!((j=ie)<11904)&&(!!bn["CJK Compatibility Forms"](j)||!!bn["CJK Compatibility"](j)||!!bn["CJK Strokes"](j)||!!bn["CJK Symbols and Punctuation"](j)||!!bn["Enclosed CJK Letters and Months"](j)||!!bn["Halfwidth and Fullwidth Forms"](j)||!!bn["Ideographic Description Characters"](j)||!!bn["Vertical Forms"](j)||X.test(String.fromCodePoint(j)));(a0e[ie]||le||re.imageName||G!==f.length()-2&&l0e[f.getCharCode(G+1)])&&T.push(Yz(G+1,k,I,T,c0e(ie,f.getCharCode(G+1),le&&L),!1))}}var j;return Zz(Yz(f.length(),k,I,T,0,!0))}function uS(f){let c=.5,A=.5;switch(f){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":A=1;break;case"top":case"top-right":case"top-left":A=0}return{horizontalAlign:c,verticalAlign:A}}function u0e(f,c,A){const g=c.getMaxScale()*Ys,{maxImageWidth:b,maxImageHeight:B}=c.getMaxImageSize(f),T=Math.max(g,B*A);return{verticalLineContentWidth:Math.max(g,b*A),horizontalLineContentHeight:T}}function Jz(f){switch(f){case"top":return 0;case"center":return .5;default:return 1}}function h0e(f,c,A){return!(f===a.af.horizontal||!c&&!ue(A)||c&&(jb[A]||(g=A,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(g)))));var g}function A0e(f,c,A,g,b,B){const T=B[f.fontStack],I=function(k,j,G,re){if(k&&k.rect)return k;const ie=j[G.fontStack],le=ie&&ie[re];return le?{rect:null,metrics:le.metrics}:null}(T&&T[c],b,f,c);if(I===null)return null;let L;if(A)L=g.verticalLineContentWidth-f.scale*Ys;else{const k=Jz(f.verticalAlign);L=(g.horizontalLineContentHeight-f.scale*Ys)*k}return{rect:I.rect,metrics:I.metrics,baselineOffset:L}}function f0e(f,c,A,g,b){const B=b[f.imageName];if(!B)return null;const T=B.paddedRect,I=B.displaySize,L={width:I[0],height:I[1],left:Wa,top:-3,advance:c?I[1]:I[0]};let k;if(c)k=g.verticalLineContentWidth-I[1]*f.scale;else{const j=Jz(f.verticalAlign);k=(g.horizontalLineContentHeight-I[1]*f.scale)*j}return{rect:T,metrics:L,baselineOffset:k,imageOffset:(c?I[0]:I[1])*f.scale-Ys*A}}function d0e(f,c,A,g){if(g===0)return;const b=f[A],B=(f[A].x+b.metrics.advance*b.scale)*g;for(let T=c;T<=A;T++)f[T].x-=B}function p0e(f,c,A){const{horizontalAlign:g,verticalAlign:b}=uS(A),B=c[0]-f.displaySize[0]*g,T=c[1]-f.displaySize[1]*b;return{image:f,top:T,bottom:T+f.displaySize[1],left:B,right:B+f.displaySize[0]}}function e7(f){var c,A;let g=f.left,b=f.top,B=f.right-g,T=f.bottom-b;const I=(c=f.image.textFitWidth)!==null&&c!==void 0?c:"stretchOrShrink",L=(A=f.image.textFitHeight)!==null&&A!==void 0?A:"stretchOrShrink",k=(f.image.content[2]-f.image.content[0])/(f.image.content[3]-f.image.content[1]);if(L==="proportional"){if(I==="stretchOnly"&&B/T<k||I==="proportional"){const j=Math.ceil(T*k);g*=j/B,B=j}}else if(I==="proportional"&&L==="stretchOnly"&&k!==0&&B/T>k){const j=Math.ceil(B/k);b*=j/T,T=j}return{x1:g,y1:b,x2:g+B,y2:b+T}}function t7(f,c,A,g,b,B){const T=f.image;let I;if(T.content){const Se=T.content,Ie=T.pixelRatio||1;I=[Se[0]/Ie,Se[1]/Ie,T.displaySize[0]-Se[2]/Ie,T.displaySize[1]-Se[3]/Ie]}const L=c.left*B,k=c.right*B;let j,G,re,ie;A==="width"||A==="both"?(ie=b[0]+L-g[3],G=b[0]+k+g[1]):(ie=b[0]+(L+k-T.displaySize[0])/2,G=ie+T.displaySize[0]);const le=c.top*B,fe=c.bottom*B;return A==="height"||A==="both"?(j=b[1]+le-g[0],re=b[1]+fe+g[2]):(j=b[1]+(le+fe-T.displaySize[1])/2,re=j+T.displaySize[1]),{image:T,top:j,right:G,bottom:re,left:ie,collisionPadding:I}}const w_=255,xh=128,pf=w_*xh;function r7(f,c){const{expression:A}=c;if(A.kind==="constant")return{kind:"constant",layoutSize:A.evaluate(new _t(f+1))};if(A.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:b}=A;let B=0;for(;B<g.length&&g[B]<=f;)B++;B=Math.max(0,B-1);let T=B;for(;T<g.length&&g[T]<f+1;)T++;T=Math.min(g.length-1,T);const I=g[B],L=g[T];return A.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:L,interpolationType:b}:{kind:"camera",minZoom:I,maxZoom:L,minSize:A.evaluate(new _t(I)),maxSize:A.evaluate(new _t(L)),interpolationType:b}}}function hS(f,c,A){let g="never";const b=f.get(c);return b?g=b:f.get(A)&&(g="always"),g}const g0e=m_.VectorTileFeature.types,m0e=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $b(f,c,A,g,b,B,T,I,L,k,j,G,re){const ie=I?Math.min(pf,Math.round(I[0])):0,le=I?Math.min(pf,Math.round(I[1])):0;f.emplaceBack(c,A,Math.round(32*g),Math.round(32*b),B,T,(ie<<1)+(L?1:0),le,16*k,16*j,256*G,256*re)}function AS(f,c,A){f.emplaceBack(c.x,c.y,A),f.emplaceBack(c.x,c.y,A),f.emplaceBack(c.x,c.y,A),f.emplaceBack(c.x,c.y,A)}function _0e(f){for(const c of f.sections)if(Oe(c.text))return!0;return!1}class fS{constructor(c){this.layoutVertexArray=new it,this.indexArray=new Lt,this.programConfigurations=c,this.segments=new xr,this.dynamicLayoutVertexArray=new Et,this.opacityVertexArray=new Ct,this.hasVisibleVertices=!1,this.placedSymbolArray=new R}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,A,g,b){this.isEmpty()||(g&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Yye.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,A),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,Zye.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,m0e,!0),this.opacityVertexBuffer.itemSize=1),(g||b)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Mr("SymbolBuffers",fS);class dS{constructor(c,A,g){this.layoutVertexArray=new c,this.layoutAttributes=A,this.indexArray=new g,this.segments=new xr,this.collisionVertexArray=new Ht}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Jye.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Mr("CollisionBuffers",dS);class ag{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(T=>T.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const A=this.layers[0]._unevaluatedLayout._values;this.textSizeData=r7(this.zoom,A["text-size"]),this.iconSizeData=r7(this.zoom,A["icon-size"]);const g=this.layers[0].layout,b=g.get("symbol-sort-key"),B=g.get("symbol-z-order");this.canOverlap=hS(g,"text-overlap","text-allow-overlap")!=="never"||hS(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=B!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(B==="viewport-y"||B==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(T=>a.af[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=c.sourceID}createArrays(){this.text=new fS(new qi(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new fS(new qi(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new K,this.lineVertexArray=new Z,this.symbolInstances=new Q,this.textAnchorOffsets=new Ae}calculateGlyphDependencies(c,A,g,b,B){for(let T=0;T<c.length;T++)if(A[c.charCodeAt(T)]=!0,(g||b)&&B){const I=b_[c.charAt(T)];I&&(A[I.charCodeAt(0)]=!0)}}populate(c,A,g){const b=this.layers[0],B=b.layout,T=B.get("text-font"),I=B.get("text-field"),L=B.get("icon-image"),k=(I.value.kind!=="constant"||I.value.value instanceof Ei&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),j=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,G=B.get("symbol-sort-key");if(this.features=[],!k&&!j)return;const re=A.iconDependencies,ie=A.glyphDependencies,le=A.availableImages,fe=new _t(this.zoom);for(const{feature:Se,id:Ie,index:st,sourceLayerIndex:Qe}of c){const ne=b._featureFilter.needGeometry,Ce=lA(Se,ne);if(!b._featureFilter.filter(fe,Ce,g))continue;let He,Tt;if(ne||(Ce.geometry=aA(Se)),k){const Ft=b.getValueAndResolveTokens("text-field",Ce,g,le),Nt=Ei.factory(Ft),lr=this.hasRTLText=this.hasRTLText||_0e(Nt);(!lr||ot.getRTLTextPluginStatus()==="unavailable"||lr&&ot.isParsed())&&(He=t0e(Nt,b,Ce))}if(j){const Ft=b.getValueAndResolveTokens("icon-image",Ce,g,le);Tt=Ft instanceof Si?Ft:Si.fromString(Ft)}if(!He&&!Tt)continue;const Wt=this.sortFeaturesByKey?G.evaluate(Ce,{},g):void 0;if(this.features.push({id:Ie,text:He,icon:Tt,index:st,sourceLayerIndex:Qe,geometry:Ce.geometry,properties:Se.properties,type:g0e[Se.type],sortKey:Wt}),Tt&&(re[Tt.name]=!0),He){const Ft=T.evaluate(Ce,{},g).join(","),Nt=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.af.vertical)>=0;for(const lr of He.sections)if(lr.image)re[lr.image.name]=!0;else{const Zt=vh(He.toString()),fr=lr.fontStack||Ft,zt=ie[fr]=ie[fr]||{};this.calculateGlyphDependencies(lr.text,zt,Nt,this.allowVerticalPlacement,Zt)}}}B.get("symbol-placement")==="line"&&(this.features=function(Se){const Ie={},st={},Qe=[];let ne=0;function Ce(Ft){Qe.push(Se[Ft]),ne++}function He(Ft,Nt,lr){const Zt=st[Ft];return delete st[Ft],st[Nt]=Zt,Qe[Zt].geometry[0].pop(),Qe[Zt].geometry[0]=Qe[Zt].geometry[0].concat(lr[0]),Zt}function Tt(Ft,Nt,lr){const Zt=Ie[Nt];return delete Ie[Nt],Ie[Ft]=Zt,Qe[Zt].geometry[0].shift(),Qe[Zt].geometry[0]=lr[0].concat(Qe[Zt].geometry[0]),Zt}function Wt(Ft,Nt,lr){const Zt=lr?Nt[0][Nt[0].length-1]:Nt[0][0];return`${Ft}:${Zt.x}:${Zt.y}`}for(let Ft=0;Ft<Se.length;Ft++){const Nt=Se[Ft],lr=Nt.geometry,Zt=Nt.text?Nt.text.toString():null;if(!Zt){Ce(Ft);continue}const fr=Wt(Zt,lr),zt=Wt(Zt,lr,!0);if(fr in st&&zt in Ie&&st[fr]!==Ie[zt]){const Ur=Tt(fr,zt,lr),Yr=He(fr,zt,Qe[Ur].geometry);delete Ie[fr],delete st[zt],st[Wt(Zt,Qe[Yr].geometry,!0)]=Yr,Qe[Ur].geometry=null}else fr in st?He(fr,zt,lr):zt in Ie?Tt(fr,zt,lr):(Ce(Ft),Ie[fr]=ne-1,st[zt]=ne-1)}return Qe.filter(Ft=>Ft.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Se,Ie)=>Se.sortKey-Ie.sortKey)}update(c,A,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,A,this.layers,g),this.icon.programConfigurations.updatePaintArrays(c,A,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,A){const g=this.lineVertexArray.length;if(c.segment!==void 0){let b=c.dist(A[c.segment+1]),B=c.dist(A[c.segment]);const T={};for(let I=c.segment+1;I<A.length;I++)T[I]={x:A[I].x,y:A[I].y,tileUnitDistanceFromAnchor:b},I<A.length-1&&(b+=A[I+1].dist(A[I]));for(let I=c.segment||0;I>=0;I--)T[I]={x:A[I].x,y:A[I].y,tileUnitDistanceFromAnchor:B},I>0&&(B+=A[I-1].dist(A[I]));for(let I=0;I<A.length;I++){const L=T[I];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(c,A,g,b,B,T,I,L,k,j,G,re){const ie=c.indexArray,le=c.layoutVertexArray,fe=c.segments.prepareSegment(4*A.length,le,ie,this.canOverlap?T.sortKey:void 0),Se=this.glyphOffsetArray.length,Ie=fe.vertexLength,st=this.allowVerticalPlacement&&I===a.af.vertical?Math.PI/2:0,Qe=T.text&&T.text.sections;for(let ne=0;ne<A.length;ne++){const{tl:Ce,tr:He,bl:Tt,br:Wt,tex:Ft,pixelOffsetTL:Nt,pixelOffsetBR:lr,minFontScaleX:Zt,minFontScaleY:fr,glyphOffset:zt,isSDF:Ur,sectionIndex:Yr}=A[ne],qr=fe.vertexLength,zr=zt[1];$b(le,L.x,L.y,Ce.x,zr+Ce.y,Ft.x,Ft.y,g,Ur,Nt.x,Nt.y,Zt,fr),$b(le,L.x,L.y,He.x,zr+He.y,Ft.x+Ft.w,Ft.y,g,Ur,lr.x,Nt.y,Zt,fr),$b(le,L.x,L.y,Tt.x,zr+Tt.y,Ft.x,Ft.y+Ft.h,g,Ur,Nt.x,lr.y,Zt,fr),$b(le,L.x,L.y,Wt.x,zr+Wt.y,Ft.x+Ft.w,Ft.y+Ft.h,g,Ur,lr.x,lr.y,Zt,fr),AS(c.dynamicLayoutVertexArray,L,st),ie.emplaceBack(qr,qr+2,qr+1),ie.emplaceBack(qr+1,qr+2,qr+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zt[0]),ne!==A.length-1&&Yr===A[ne+1].sectionIndex||c.programConfigurations.populatePaintArrays(le.length,T,T.index,{},re,Qe&&Qe[Yr])}c.placedSymbolArray.emplaceBack(L.x,L.y,Se,this.glyphOffsetArray.length-Se,Ie,k,j,L.segment,g?g[0]:0,g?g[1]:0,b[0],b[1],I,0,!1,0,G)}_addCollisionDebugVertex(c,A,g,b,B,T){return A.emplaceBack(0,0),c.emplaceBack(g.x,g.y,b,B,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(c,A,g,b,B,T,I){const L=B.segments.prepareSegment(4,B.layoutVertexArray,B.indexArray),k=L.vertexLength,j=B.layoutVertexArray,G=B.collisionVertexArray,re=I.anchorX,ie=I.anchorY;this._addCollisionDebugVertex(j,G,T,re,ie,new M(c,A)),this._addCollisionDebugVertex(j,G,T,re,ie,new M(g,A)),this._addCollisionDebugVertex(j,G,T,re,ie,new M(g,b)),this._addCollisionDebugVertex(j,G,T,re,ie,new M(c,b)),L.vertexLength+=4;const le=B.indexArray;le.emplaceBack(k,k+1),le.emplaceBack(k+1,k+2),le.emplaceBack(k+2,k+3),le.emplaceBack(k+3,k),L.primitiveLength+=4}addDebugCollisionBoxes(c,A,g,b){for(let B=c;B<A;B++){const T=this.collisionBoxArray.get(B);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,b?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dS(Dt,Vz.members,dr),this.iconCollisionBox=new dS(Dt,Vz.members,dr);for(let c=0;c<this.symbolInstances.length;c++){const A=this.symbolInstances.get(c);this.addDebugCollisionBoxes(A.textBoxStartIndex,A.textBoxEndIndex,A,!0),this.addDebugCollisionBoxes(A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,!0),this.addDebugCollisionBoxes(A.iconBoxStartIndex,A.iconBoxEndIndex,A,!1),this.addDebugCollisionBoxes(A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,!1)}}_deserializeCollisionBoxesForSymbol(c,A,g,b,B,T,I,L,k){const j={};for(let G=A;G<g;G++){const re=c.get(G);j.textBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},j.textFeatureIndex=re.featureIndex;break}for(let G=b;G<B;G++){const re=c.get(G);j.verticalTextBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},j.verticalTextFeatureIndex=re.featureIndex;break}for(let G=T;G<I;G++){const re=c.get(G);j.iconBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},j.iconFeatureIndex=re.featureIndex;break}for(let G=L;G<k;G++){const re=c.get(G);j.verticalIconBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},j.verticalIconFeatureIndex=re.featureIndex;break}return j}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let A=0;A<this.symbolInstances.length;A++){const g=this.symbolInstances.get(A);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,A){const g=c.placedSymbolArray.get(A),b=g.vertexStartIndex+4*g.numGlyphs;for(let B=g.vertexStartIndex;B<b;B+=4)c.indexArray.emplaceBack(B,B+2,B+1),c.indexArray.emplaceBack(B+1,B+2,B+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const A=Math.sin(c),g=Math.cos(c),b=[],B=[],T=[];for(let I=0;I<this.symbolInstances.length;++I){T.push(I);const L=this.symbolInstances.get(I);b.push(0|Math.round(A*L.anchorX+g*L.anchorY)),B.push(L.featureIndex)}return T.sort((I,L)=>b[I]-b[L]||B[L]-B[I]),T}addToSortKeyRanges(c,A){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===A?g.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:A,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const A of this.symbolInstanceIndexes){const g=this.symbolInstances.get(A);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((b,B,T)=>{b>=0&&T.indexOf(b)===B&&this.addIndicesForPlacedSymbol(this.text,b)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let n7,i7;Mr("SymbolBucket",ag,{omit:["layers","collisionBoxArray","features","compareText"]}),ag.MAX_GLYPHS=65535,ag.addDynamicAttributes=AS;var pS={get paint(){return i7=i7||new fn({"icon-opacity":new $t(Be.paint_symbol["icon-opacity"]),"icon-color":new $t(Be.paint_symbol["icon-color"]),"icon-halo-color":new $t(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new $t(Be.paint_symbol["text-opacity"]),"text-color":new $t(Be.paint_symbol["text-color"],{runtimeType:kr,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new $t(Be.paint_symbol["text-halo-color"]),"text-halo-width":new $t(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(Be.paint_symbol["text-halo-blur"]),"text-translate":new wt(Be.paint_symbol["text-translate"]),"text-translate-anchor":new wt(Be.paint_symbol["text-translate-anchor"])})},get layout(){return n7=n7||new fn({"symbol-placement":new wt(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new wt(Be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new wt(Be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new wt(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(Be.layout_symbol["icon-size"]),"icon-text-fit":new wt(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(Be.layout_symbol["icon-image"]),"icon-rotate":new $t(Be.layout_symbol["icon-rotate"]),"icon-padding":new $t(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(Be.layout_symbol["icon-offset"]),"icon-anchor":new $t(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(Be.layout_symbol["text-rotation-alignment"]),"text-field":new $t(Be.layout_symbol["text-field"]),"text-font":new $t(Be.layout_symbol["text-font"]),"text-size":new $t(Be.layout_symbol["text-size"]),"text-max-width":new $t(Be.layout_symbol["text-max-width"]),"text-line-height":new wt(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(Be.layout_symbol["text-letter-spacing"]),"text-justify":new $t(Be.layout_symbol["text-justify"]),"text-radial-offset":new $t(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(Be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new $t(Be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new $t(Be.layout_symbol["text-anchor"]),"text-max-angle":new wt(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(Be.layout_symbol["text-writing-mode"]),"text-rotate":new $t(Be.layout_symbol["text-rotate"]),"text-padding":new wt(Be.layout_symbol["text-padding"]),"text-keep-upright":new wt(Be.layout_symbol["text-keep-upright"]),"text-transform":new $t(Be.layout_symbol["text-transform"]),"text-offset":new $t(Be.layout_symbol["text-offset"]),"text-allow-overlap":new wt(Be.layout_symbol["text-allow-overlap"]),"text-overlap":new wt(Be.layout_symbol["text-overlap"]),"text-ignore-placement":new wt(Be.layout_symbol["text-ignore-placement"]),"text-optional":new wt(Be.layout_symbol["text-optional"])})}};class s7{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:Nr,this.defaultValue=c}evaluate(c){if(c.formattedSection){const A=this.defaultValue.property.overrides;if(A&&A.hasOverride(c.formattedSection))return A.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mr("FormatSectionOverride",s7,{omit:["defaultValue"]});class Gb extends mn{constructor(c){super(c,pS)}recalculate(c,A){if(super.recalculate(c,A),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const g=this.layout.get("text-writing-mode");if(g){const b=[];for(const B of g)b.indexOf(B)<0&&b.push(B);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,A,g,b){const B=this.layout.get(c).evaluate(A,{},g,b),T=this._unevaluatedLayout._values[c];return T.isDataDriven()||Ql(T.value)||!B?B:function(I,L){return L.replace(/{([^{}]+)}/g,(k,j)=>I&&j in I?String(I[j]):"")}(A.properties,B)}createBucket(c){return new ag(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of pS.paint.overridableProperties){if(!Gb.hasPaintOverride(this.layout,c))continue;const A=this.paint.get(c),g=new s7(A),b=new bc(g,A.property.specification);let B=null;B=A.value.kind==="constant"||A.value.kind==="source"?new vc("source",b):new Pu("composite",b,A.value.zoomStops),this.paint._values[c]=new Gt(A.property,B,A.parameters)}}_handleOverridablePaintPropertyUpdate(c,A,g){return!(!this.layout||A.isDataDriven()||g.isDataDriven())&&Gb.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,A){const g=c.get("text-field"),b=pS.paint.properties[A];let B=!1;const T=I=>{for(const L of I)if(b.overrides&&b.overrides.hasOverride(L))return void(B=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Ei)T(g.value.value.sections);else if(g.value.kind==="source"){const I=k=>{B||(k instanceof Zo&&_n(k.value)===Ti?T(k.value.sections):k instanceof Pl?T(k.sections):k.eachChild(I))},L=g.value;L._styleExpression&&I(L._styleExpression.expression)}return B}}let o7;var y0e={get paint(){return o7=o7||new fn({"background-color":new wt(Be.paint_background["background-color"]),"background-pattern":new Zr(Be.paint_background["background-pattern"]),"background-opacity":new wt(Be.paint_background["background-opacity"])})}};class b0e extends mn{constructor(c){super(c,y0e)}}let a7;var v0e={get paint(){return a7=a7||new fn({"raster-opacity":new wt(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new wt(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(Be.paint_raster["raster-saturation"]),"raster-contrast":new wt(Be.paint_raster["raster-contrast"]),"raster-resampling":new wt(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(Be.paint_raster["raster-fade-duration"])})}};class w0e extends mn{constructor(c){super(c,v0e)}}class x0e extends mn{constructor(c){super(c,{}),this.onAdd=A=>{this.implementation.onAdd&&this.implementation.onAdd(A,A.painter.context.gl)},this.onRemove=A=>{this.implementation.onRemove&&this.implementation.onRemove(A,A.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class B0e{constructor(c){this._methodToThrottle=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const gS=63710088e-1;class gf{constructor(c,A){if(isNaN(c)||isNaN(A))throw new Error(`Invalid LngLat object: (${c}, ${A})`);if(this.lng=+c,this.lat=+A,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new gf(Le(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const A=Math.PI/180,g=this.lat*A,b=c.lat*A,B=Math.sin(g)*Math.sin(b)+Math.cos(g)*Math.cos(b)*Math.cos((c.lng-this.lng)*A);return gS*Math.acos(Math.min(B,1))}static convert(c){if(c instanceof gf)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new gf(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new gf(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const l7=2*Math.PI*gS;function c7(f){return l7*Math.cos(f*Math.PI/180)}function u7(f){return(180+f)/360}function h7(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function A7(f,c){return f/c7(c)}function mS(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}function f7(f,c){return f*c7(mS(c))}class x_{constructor(c,A){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+c,this.y=+A,this.z=+g}static fromLngLat(c){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const g=gf.convert(c);return new x_(u7(g.lng),h7(g.lat),A7(A,g.lat))}toLngLat(){return new gf(360*this.x-180,mS(this.y))}toAltitude(){return f7(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/l7*(c=mS(this.y),1/Math.cos(c*Math.PI/180));var c}}function d7(f,c,A){var g=2*Math.PI*6378137/256/Math.pow(2,A);return[f*g-2*Math.PI*6378137/2,c*g-2*Math.PI*6378137/2]}class _S{constructor(c,A,g){if(!function(b,B,T){return!(b<0||b>25||T<0||T>=Math.pow(2,b)||B<0||B>=Math.pow(2,b))}(c,A,g))throw new Error(`x=${A}, y=${g}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=A,this.y=g,this.key=lg(0,c,c,A,g)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,A,g){const b=(T=this.y,I=this.z,L=d7(256*(B=this.x),256*(T=Math.pow(2,I)-T-1),I),k=d7(256*(B+1),256*(T+1),I),L[0]+","+L[1]+","+k[0]+","+k[1]);var B,T,I,L,k;const j=function(G,re,ie){let le,fe="";for(let Se=G;Se>0;Se--)le=1<<Se-1,fe+=(re&le?1:0)+(ie&le?2:0);return fe}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,A>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,b)}isChildOf(c){const A=this.z-c.z;return A>0&&c.x===this.x>>A&&c.y===this.y>>A}getTilePoint(c){const A=Math.pow(2,this.z);return new M((c.x*A-this.x)*Ge,(c.y*A-this.y)*Ge)}toString(){return`${this.z}/${this.x}/${this.y}`}}class p7{constructor(c,A){this.wrap=c,this.canonical=A,this.key=lg(c,A.z,A.z,A.x,A.y)}}class $l{constructor(c,A,g,b,B){if(this.terrainRttPosMatrix32f=null,c<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${g}`);this.overscaledZ=c,this.wrap=A,this.canonical=new _S(g,+b,+B),this.key=lg(A,c,g,b,B)}clone(){return new $l(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const A=this.canonical.z-c;return c>this.canonical.z?new $l(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $l(c,this.wrap,c,this.canonical.x>>A,this.canonical.y>>A)}calculateScaledKey(c,A){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-c;return c>this.canonical.z?lg(this.wrap*+A,c,this.canonical.z,this.canonical.x,this.canonical.y):lg(this.wrap*+A,c,c,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(c){if(c.wrap!==this.wrap)return!1;const A=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>A&&c.canonical.y===this.canonical.y>>A}children(c){if(this.overscaledZ>=c)return[new $l(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const A=this.canonical.z+1,g=2*this.canonical.x,b=2*this.canonical.y;return[new $l(A,this.wrap,A,g,b),new $l(A,this.wrap,A,g+1,b),new $l(A,this.wrap,A,g,b+1),new $l(A,this.wrap,A,g+1,b+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new $l(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new $l(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new p7(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new x_(c.x-this.wrap,c.y))}}function lg(f,c,A,g,b){(f*=2)<0&&(f=-1*f-1);const B=1<<A;return(B*B*f+B*b+g).toString(36)+A.toString(36)+c.toString(36)}Mr("CanonicalTileID",_S),Mr("OverscaledTileID",$l,{omit:["terrainRttPosMatrix32f"]});class g7{constructor(c,A,g){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,I=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=c,A.height!==A.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void qt(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=A.height;const L=this.dim=A.height-2;switch(this.data=new Uint32Array(A.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=B,this.blueFactor=T,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<L;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(L,k)]=this.data[this._idx(L-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,L)]=this.data[this._idx(k,L-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(L,-1)]=this.data[this._idx(L-1,0)],this.data[this._idx(-1,L)]=this.data[this._idx(0,L-1)],this.data[this._idx(L,L)]=this.data[this._idx(L-1,L-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<L;k++)for(let j=0;j<L;j++){const G=this.get(k,j);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(c,A){const g=new Uint8Array(this.data.buffer),b=4*this._idx(c,A);return this.unpack(g[b],g[b+1],g[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,A){if(c<-1||c>=this.dim+1||A<-1||A>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(A+1)*this.stride+(c+1)}unpack(c,A,g){return c*this.redFactor+A*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new jl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,A,g){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let b=A*this.dim,B=A*this.dim+this.dim,T=g*this.dim,I=g*this.dim+this.dim;switch(A){case-1:b=B-1;break;case 1:B=b+1}switch(g){case-1:T=I-1;break;case 1:I=T+1}const L=-A*this.dim,k=-g*this.dim;for(let j=T;j<I;j++)for(let G=b;G<B;G++)this.data[this._idx(G,j)]=c.data[this._idx(G+L,j+k)]}}Mr("DEMData",g7);class m7{constructor(c){this._stringToNumber={},this._numberToString=[];for(let A=0;A<c.length;A++){const g=c[A];this._stringToNumber[g]=A,this._numberToString[A]=g}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class _7{constructor(c,A,g,b,B){this.type="Feature",this._vectorTileFeature=c,c._z=A,c._x=g,c._y=b,this.properties=c.properties,this.id=B}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const A in this)A!=="_geometry"&&A!=="_vectorTileFeature"&&(c[A]=this[A]);return c}}class y7{constructor(c,A){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new Cc(Ge,16,0),this.grid3D=new Cc(Ge,16,0),this.featureIndexArray=new Fe,this.promoteId=A}insert(c,A,g,b,B,T){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,b,B);const L=T?this.grid3D:this.grid;for(let k=0;k<A.length;k++){const j=A[k],G=[1/0,1/0,-1/0,-1/0];for(let re=0;re<j.length;re++){const ie=j[re];G[0]=Math.min(G[0],ie.x),G[1]=Math.min(G[1],ie.y),G[2]=Math.max(G[2],ie.x),G[3]=Math.max(G[3],ie.y)}G[0]<Ge&&G[1]<Ge&&G[2]>=0&&G[3]>=0&&L.insert(I,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new m_.VectorTile(new oS(this.rawTileData)).layers,this.sourceLayerCoder=new m7(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,A,g,b){this.loadVTLayers();const B=c.params,T=Ge/c.tileSize/c.scale,I=Ru(B.filter),L=c.queryGeometry,k=c.queryPadding*T,j=v7(L),G=this.grid.query(j.minX-k,j.minY-k,j.maxX+k,j.maxY+k),re=v7(c.cameraQueryGeometry),ie=this.grid3D.query(re.minX-k,re.minY-k,re.maxX+k,re.maxY+k,(Se,Ie,st,Qe)=>function(ne,Ce,He,Tt,Wt){for(const Nt of ne)if(Ce<=Nt.x&&He<=Nt.y&&Tt>=Nt.x&&Wt>=Nt.y)return!0;const Ft=[new M(Ce,He),new M(Ce,Wt),new M(Tt,Wt),new M(Tt,He)];if(ne.length>2){for(const Nt of Ft)if(rg(ne,Nt))return!0}for(let Nt=0;Nt<ne.length-1;Nt++)if(fye(ne[Nt],ne[Nt+1],Ft))return!0;return!1}(c.cameraQueryGeometry,Se-k,Ie-k,st+k,Qe+k));for(const Se of ie)G.push(Se);G.sort(C0e);const le={};let fe;for(let Se=0;Se<G.length;Se++){const Ie=G[Se];if(Ie===fe)continue;fe=Ie;const st=this.featureIndexArray.get(Ie);let Qe=null;this.loadMatchingFeature(le,st.bucketIndex,st.sourceLayerIndex,st.featureIndex,I,B.layers,B.availableImages,A,g,b,(ne,Ce,He)=>(Qe||(Qe=aA(ne)),Ce.queryIntersectsFeature({queryGeometry:L,feature:ne,featureState:He,geometry:Qe,zoom:this.z,transform:c.transform,pixelsToTileUnits:T,pixelPosMatrix:c.pixelPosMatrix})))}return le}loadMatchingFeature(c,A,g,b,B,T,I,L,k,j,G){const re=this.bucketLayerIDs[A];if(T&&!re.some(Se=>T.has(Se)))return;const ie=this.sourceLayerCoder.decode(g),le=this.vtLayers[ie].feature(b);if(B.needGeometry){const Se=lA(le,!0);if(!B.filter(new _t(this.tileID.overscaledZ),Se,this.tileID.canonical))return}else if(!B.filter(new _t(this.tileID.overscaledZ),le))return;const fe=this.getId(le,ie);for(let Se=0;Se<re.length;Se++){const Ie=re[Se];if(T&&!T.has(Ie))continue;const st=L[Ie];if(!st)continue;let Qe={};fe&&j&&(Qe=j.getState(st.sourceLayer||"_geojsonTileLayer",fe));const ne=De({},k[Ie]);ne.paint=b7(ne.paint,st.paint,le,Qe,I),ne.layout=b7(ne.layout,st.layout,le,Qe,I);const Ce=!G||G(le,st,Qe);if(!Ce)continue;const He=new _7(le,this.z,this.x,this.y,fe);He.layer=ne;let Tt=c[Ie];Tt===void 0&&(Tt=c[Ie]=[]),Tt.push({featureIndex:b,feature:He,intersectionZ:Ce})}}lookupSymbolFeatures(c,A,g,b,B,T,I,L){const k={};this.loadVTLayers();const j=Ru(B);for(const G of c)this.loadMatchingFeature(k,g,b,G,j,T,I,L,A);return k}hasLayer(c){for(const A of this.bucketLayerIDs)for(const g of A)if(c===g)return!0;return!1}getId(c,A){var g;let b=c.id;return this.promoteId&&(b=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[A]],typeof b=="boolean"&&(b=Number(b)),b===void 0&&(!((g=c.properties)===null||g===void 0)&&g.cluster)&&this.promoteId&&(b=Number(c.properties.cluster_id))),b}}function b7(f,c,A,g,b){return rt(f,(B,T)=>{const I=c instanceof er?c.get(T):null;return I&&I.evaluate?I.evaluate(A,g,b):I})}function v7(f){let c=1/0,A=1/0,g=-1/0,b=-1/0;for(const B of f)c=Math.min(c,B.x),A=Math.min(A,B.y),g=Math.max(g,B.x),b=Math.max(b,B.y);return{minX:c,minY:A,maxX:g,maxY:b}}function C0e(f,c){return c-f}function w7(f,c,A,g,b){const B=[];for(let T=0;T<f.length;T++){const I=f[T];let L;for(let k=0;k<I.length-1;k++){let j=I[k],G=I[k+1];j.x<c&&G.x<c||(j.x<c?j=new M(c,j.y+(c-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<c&&(G=new M(c,j.y+(c-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<A&&G.y<A||(j.y<A?j=new M(j.x+(A-j.y)/(G.y-j.y)*(G.x-j.x),A)._round():G.y<A&&(G=new M(j.x+(A-j.y)/(G.y-j.y)*(G.x-j.x),A)._round()),j.x>=g&&G.x>=g||(j.x>=g?j=new M(g,j.y+(g-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=g&&(G=new M(g,j.y+(g-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=b&&G.y>=b||(j.y>=b?j=new M(j.x+(b-j.y)/(G.y-j.y)*(G.x-j.x),b)._round():G.y>=b&&(G=new M(j.x+(b-j.y)/(G.y-j.y)*(G.x-j.x),b)._round()),L&&j.equals(L[L.length-1])||(L=[j],B.push(L)),L.push(G)))))}}return B}Mr("FeatureIndex",y7,{omit:["rawTileData","sourceLayerCoder"]});class mf extends M{constructor(c,A,g,b){super(c,A),this.angle=g,b!==void 0&&(this.segment=b)}clone(){return new mf(this.x,this.y,this.angle,this.segment)}}function x7(f,c,A,g,b){if(c.segment===void 0||A===0)return!0;let B=c,T=c.segment+1,I=0;for(;I>-A/2;){if(T--,T<0)return!1;I-=f[T].dist(B),B=f[T]}I+=f[T].dist(f[T+1]),T++;const L=[];let k=0;for(;I<A/2;){const j=f[T],G=f[T+1];if(!G)return!1;let re=f[T-1].angleTo(j)-j.angleTo(G);for(re=Math.abs((re+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:I,angleDelta:re}),k+=re;I-L[0].distance>g;)k-=L.shift().angleDelta;if(k>b)return!1;T++,I+=j.dist(G)}return!0}function B7(f){let c=0;for(let A=0;A<f.length-1;A++)c+=f[A].dist(f[A+1]);return c}function C7(f,c,A){return f?.6*c*A:0}function T7(f,c){return Math.max(f?f.right-f.left:0,c?c.right-c.left:0)}function T0e(f,c,A,g,b,B){const T=C7(A,b,B),I=T7(A,g)*B;let L=0;const k=B7(f)/2;for(let j=0;j<f.length-1;j++){const G=f[j],re=f[j+1],ie=G.dist(re);if(L+ie>k){const le=(k-L)/ie,fe=Jo.number(G.x,re.x,le),Se=Jo.number(G.y,re.y,le),Ie=new mf(fe,Se,re.angleTo(G),j);return Ie._round(),!T||x7(f,Ie,I,T,c)?Ie:void 0}L+=ie}}function E0e(f,c,A,g,b,B,T,I,L){const k=C7(g,B,T),j=T7(g,b),G=j*T,re=f[0].x===0||f[0].x===L||f[0].y===0||f[0].y===L;return c-G<c/4&&(c=G+c/4),E7(f,re?c/2*I%c:(j/2+2*B)*T*I%c,c,k,A,G,re,!1,L)}function E7(f,c,A,g,b,B,T,I,L){const k=B/2,j=B7(f);let G=0,re=c-A,ie=[];for(let le=0;le<f.length-1;le++){const fe=f[le],Se=f[le+1],Ie=fe.dist(Se),st=Se.angleTo(fe);for(;re+A<G+Ie;){re+=A;const Qe=(re-G)/Ie,ne=Jo.number(fe.x,Se.x,Qe),Ce=Jo.number(fe.y,Se.y,Qe);if(ne>=0&&ne<L&&Ce>=0&&Ce<L&&re-k>=0&&re+k<=j){const He=new mf(ne,Ce,st,le);He._round(),g&&!x7(f,He,B,g,b)||ie.push(He)}}G+=Ie}return I||ie.length||T||(ie=E7(f,G/2,A,g,b,B,T,!0,L)),ie}Mr("Anchor",mf);const B_=Wa;function S7(f,c,A,g){const b=[],B=f.image,T=B.pixelRatio,I=B.paddedRect.w-2*B_,L=B.paddedRect.h-2*B_;let k={x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};const j=B.stretchX||[[0,I]],G=B.stretchY||[[0,L]],re=(zt,Ur)=>zt+Ur[1]-Ur[0],ie=j.reduce(re,0),le=G.reduce(re,0),fe=I-ie,Se=L-le;let Ie=0,st=ie,Qe=0,ne=le,Ce=0,He=fe,Tt=0,Wt=Se;if(B.content&&g){const zt=B.content,Ur=zt[2]-zt[0],Yr=zt[3]-zt[1];(B.textFitWidth||B.textFitHeight)&&(k=e7(f)),Ie=qb(j,0,zt[0]),Qe=qb(G,0,zt[1]),st=qb(j,zt[0],zt[2]),ne=qb(G,zt[1],zt[3]),Ce=zt[0]-Ie,Tt=zt[1]-Qe,He=Ur-st,Wt=Yr-ne}const Ft=k.x1,Nt=k.y1,lr=k.x2-Ft,Zt=k.y2-Nt,fr=(zt,Ur,Yr,qr)=>{const zr=Kb(zt.stretch-Ie,st,lr,Ft),Pn=Wb(zt.fixed-Ce,He,zt.stretch,ie),rs=Kb(Ur.stretch-Qe,ne,Zt,Nt),Ms=Wb(Ur.fixed-Tt,Wt,Ur.stretch,le),Pa=Kb(Yr.stretch-Ie,st,lr,Ft),Xa=Wb(Yr.fixed-Ce,He,Yr.stretch,ie),Ya=Kb(qr.stretch-Qe,ne,Zt,Nt),So=Wb(qr.fixed-Tt,Wt,qr.stretch,le),us=new M(zr,rs),Zs=new M(Pa,rs),Io=new M(Pa,Ya),Ps=new M(zr,Ya),Fa=new M(Pn/T,Ms/T),Gl=new M(Xa/T,So/T),Ao=c*Math.PI/180;if(Ao){const fo=Math.sin(Ao),po=Math.cos(Ao),Fs=[po,-fo,fo,po];us._matMult(Fs),Zs._matMult(Fs),Ps._matMult(Fs),Io._matMult(Fs)}const Za=zt.stretch+zt.fixed,Js=Ur.stretch+Ur.fixed;return{tl:us,tr:Zs,bl:Ps,br:Io,tex:{x:B.paddedRect.x+B_+Za,y:B.paddedRect.y+B_+Js,w:Yr.stretch+Yr.fixed-Za,h:qr.stretch+qr.fixed-Js},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fa,pixelOffsetBR:Gl,minFontScaleX:He/T/lr,minFontScaleY:Wt/T/Zt,isSDF:A}};if(g&&(B.stretchX||B.stretchY)){const zt=I7(j,fe,ie),Ur=I7(G,Se,le);for(let Yr=0;Yr<zt.length-1;Yr++){const qr=zt[Yr],zr=zt[Yr+1];for(let Pn=0;Pn<Ur.length-1;Pn++)b.push(fr(qr,Ur[Pn],zr,Ur[Pn+1]))}}else b.push(fr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:L+1}));return b}function qb(f,c,A){let g=0;for(const b of f)g+=Math.max(c,Math.min(A,b[1]))-Math.max(c,Math.min(A,b[0]));return g}function I7(f,c,A){const g=[{fixed:-1,stretch:0}];for(const[b,B]of f){const T=g[g.length-1];g.push({fixed:b-T.stretch,stretch:T.stretch}),g.push({fixed:b-T.stretch,stretch:T.stretch+(B-b)})}return g.push({fixed:c+B_,stretch:A}),g}function Kb(f,c,A,g){return f/c*A+g}function Wb(f,c,A,g){return f-c*A/g}class Xb{constructor(c,A,g,b,B,T,I,L,k,j){var G;if(this.boxStartIndex=c.length,k){let re=T.top,ie=T.bottom;const le=T.collisionPadding;le&&(re-=le[1],ie+=le[3]);let fe=ie-re;fe>0&&(fe=Math.max(10,fe),this.circleDiameter=fe)}else{const re=!((G=T.image)===null||G===void 0)&&G.content&&(T.image.textFitWidth||T.image.textFitHeight)?e7(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};re.y1=re.y1*I-L[0],re.y2=re.y2*I+L[2],re.x1=re.x1*I-L[3],re.x2=re.x2*I+L[1];const ie=T.collisionPadding;if(ie&&(re.x1-=ie[0]*I,re.y1-=ie[1]*I,re.x2+=ie[2]*I,re.y2+=ie[3]*I),j){const le=new M(re.x1,re.y1),fe=new M(re.x2,re.y1),Se=new M(re.x1,re.y2),Ie=new M(re.x2,re.y2),st=j*Math.PI/180;le._rotate(st),fe._rotate(st),Se._rotate(st),Ie._rotate(st),re.x1=Math.min(le.x,fe.x,Se.x,Ie.x),re.x2=Math.max(le.x,fe.x,Se.x,Ie.x),re.y1=Math.min(le.y,fe.y,Se.y,Ie.y),re.y2=Math.max(le.y,fe.y,Se.y,Ie.y)}c.emplaceBack(A.x,A.y,re.x1,re.y1,re.x2,re.y2,g,b,B)}this.boxEndIndex=c.length}}class S0e{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(g,b)=>g<b?-1:g>b?1:0;if(this.data=c,this.length=this.data.length,this.compare=A,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],A=this.data.pop();return--this.length>0&&(this.data[0]=A,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:A,compare:g}=this,b=A[c];for(;c>0;){const B=c-1>>1,T=A[B];if(g(b,T)>=0)break;A[c]=T,c=B}A[c]=b}_down(c){const{data:A,compare:g}=this,b=this.length>>1,B=A[c];for(;c<b;){let T=1+(c<<1);const I=T+1;if(I<this.length&&g(A[I],A[T])<0&&(T=I),g(A[T],B)>=0)break;A[c]=A[T],c=T}A[c]=B}}function I0e(f){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,g=1/0,b=1/0,B=-1/0,T=-1/0;const I=f[0];for(let ie=0;ie<I.length;ie++){const le=I[ie];(!ie||le.x<g)&&(g=le.x),(!ie||le.y<b)&&(b=le.y),(!ie||le.x>B)&&(B=le.x),(!ie||le.y>T)&&(T=le.y)}const L=Math.min(B-g,T-b);let k=L/2;const j=new S0e([],M0e);if(L===0)return new M(g,b);for(let ie=g;ie<B;ie+=L)for(let le=b;le<T;le+=L)j.push(new cg(ie+k,le+k,k,f));let G=function(ie){let le=0,fe=0,Se=0;const Ie=ie[0];for(let st=0,Qe=Ie.length,ne=Qe-1;st<Qe;ne=st++){const Ce=Ie[st],He=Ie[ne],Tt=Ce.x*He.y-He.x*Ce.y;fe+=(Ce.x+He.x)*Tt,Se+=(Ce.y+He.y)*Tt,le+=3*Tt}return new cg(fe/le,Se/le,0,ie)}(f),re=j.length;for(;j.length;){const ie=j.pop();(ie.d>G.d||!G.d)&&(G=ie,A&&console.log("found best %d after %d probes",Math.round(1e4*ie.d)/1e4,re)),ie.max-G.d<=c||(k=ie.h/2,j.push(new cg(ie.p.x-k,ie.p.y-k,k,f)),j.push(new cg(ie.p.x+k,ie.p.y-k,k,f)),j.push(new cg(ie.p.x-k,ie.p.y+k,k,f)),j.push(new cg(ie.p.x+k,ie.p.y+k,k,f)),re+=4)}return A&&(console.log(`num probes: ${re}`),console.log(`best distance: ${G.d}`)),G.p}function M0e(f,c){return c.max-f.max}function cg(f,c,A,g){this.p=new M(f,c),this.h=A,this.d=function(b,B){let T=!1,I=1/0;for(let L=0;L<B.length;L++){const k=B[L];for(let j=0,G=k.length,re=G-1;j<G;re=j++){const ie=k[j],le=k[re];ie.y>b.y!=le.y>b.y&&b.x<(le.x-ie.x)*(b.y-ie.y)/(le.y-ie.y)+ie.x&&(T=!T),I=Math.min(I,cz(b,ie,le))}}return(T?1:-1)*Math.sqrt(I)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var jo;a.aw=void 0,(jo=a.aw||(a.aw={}))[jo.center=1]="center",jo[jo.left=2]="left",jo[jo.right=3]="right",jo[jo.top=4]="top",jo[jo.bottom=5]="bottom",jo[jo["top-left"]=6]="top-left",jo[jo["top-right"]=7]="top-right",jo[jo["bottom-left"]=8]="bottom-left",jo[jo["bottom-right"]=9]="bottom-right";const _f=7,yS=Number.POSITIVE_INFINITY;function M7(f,c){return c[1]!==yS?function(A,g,b){let B=0,T=0;switch(g=Math.abs(g),b=Math.abs(b),A){case"top-right":case"top-left":case"top":T=b-_f;break;case"bottom-right":case"bottom-left":case"bottom":T=-b+_f}switch(A){case"top-right":case"bottom-right":case"right":B=-g;break;case"top-left":case"bottom-left":case"left":B=g}return[B,T]}(f,c[0],c[1]):function(A,g){let b=0,B=0;g<0&&(g=0);const T=g/Math.SQRT2;switch(A){case"top-right":case"top-left":B=T-_f;break;case"bottom-right":case"bottom-left":B=-T+_f;break;case"bottom":B=-g+_f;break;case"top":B=g-_f}switch(A){case"top-right":case"bottom-right":b=-T;break;case"top-left":case"bottom-left":b=T;break;case"left":b=g;break;case"right":b=-g}return[b,B]}(f,c[0])}function P7(f,c,A){var g;const b=f.layout,B=(g=b.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(c,{},A);if(B){const I=B.values,L=[];for(let k=0;k<I.length;k+=2){const j=L[k]=I[k],G=I[k+1].map(re=>re*Ys);j.startsWith("top")?G[1]-=_f:j.startsWith("bottom")&&(G[1]+=_f),L[k+1]=G}return new Bs(L)}const T=b.get("text-variable-anchor");if(T){let I;I=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(c,{},A)*Ys,yS]:b.get("text-offset").evaluate(c,{},A).map(k=>k*Ys);const L=[];for(const k of T)L.push(k,M7(k,I));return new Bs(L)}return null}function bS(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function P0e(f,c,A,g,b,B,T,I,L,k,j,G){let re=B.textMaxSize.evaluate(c,{});re===void 0&&(re=T);const ie=f.layers[0].layout,le=ie.get("icon-offset").evaluate(c,{},j),fe=R7(A.horizontal),Se=T/24,Ie=f.tilePixelRatio*Se,st=f.tilePixelRatio*re/24,Qe=f.tilePixelRatio*I,ne=f.tilePixelRatio*ie.get("symbol-spacing"),Ce=ie.get("text-padding")*f.tilePixelRatio,He=function(Yr,qr,zr){let Pn=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const rs=Yr.get("icon-padding").evaluate(qr,{},zr),Ms=rs&&rs.values;return[Ms[0]*Pn,Ms[1]*Pn,Ms[2]*Pn,Ms[3]*Pn]}(ie,c,j,f.tilePixelRatio),Tt=ie.get("text-max-angle")/180*Math.PI,Wt=ie.get("text-rotation-alignment")!=="viewport"&&ie.get("symbol-placement")!=="point",Ft=ie.get("icon-rotation-alignment")==="map"&&ie.get("symbol-placement")!=="point",Nt=ie.get("symbol-placement"),lr=ne/2,Zt=ie.get("icon-text-fit");let fr;g&&Zt!=="none"&&(f.allowVerticalPlacement&&A.vertical&&(fr=t7(g,A.vertical,Zt,ie.get("icon-text-fit-padding"),le,Se)),fe&&(g=t7(g,fe,Zt,ie.get("icon-text-fit-padding"),le,Se)));const zt=j?G.line.getGranularityForZoomLevel(j.z):1,Ur=(Yr,qr)=>{qr.x<0||qr.x>=Ge||qr.y<0||qr.y>=Ge||function(zr,Pn,rs,Ms,Pa,Xa,Ya,So,us,Zs,Io,Ps,Fa,Gl,Ao,Za,Js,fo,po,Fs,Fi,ku,ug,Qu,L0e){const hg=zr.addToLineVertexArray(Pn,rs);let Ed,Ag,fg,dg,D7=0,N7=0,k7=0,Q7=0,SS=-1,IS=-1;const cA={};let z7=es("");if(zr.allowVerticalPlacement&&Ms.vertical){const oa=So.layout.get("text-rotate").evaluate(Fi,{},Qu)+90;fg=new Xb(us,Pn,Zs,Io,Ps,Ms.vertical,Fa,Gl,Ao,oa),Ya&&(dg=new Xb(us,Pn,Zs,Io,Ps,Ya,Js,fo,Ao,oa))}if(Pa){const oa=So.layout.get("icon-rotate").evaluate(Fi,{}),ql=So.layout.get("icon-text-fit")!=="none",Sd=S7(Pa,oa,ug,ql),Hu=Ya?S7(Ya,oa,ug,ql):void 0;Ag=new Xb(us,Pn,Zs,Io,Ps,Pa,Js,fo,!1,oa),D7=4*Sd.length;const Id=zr.iconSizeData;let Bh=null;Id.kind==="source"?(Bh=[xh*So.layout.get("icon-size").evaluate(Fi,{})],Bh[0]>pf&&qt(`${zr.layerIds[0]}: Value for "icon-size" is >= ${w_}. Reduce your "icon-size".`)):Id.kind==="composite"&&(Bh=[xh*ku.compositeIconSizes[0].evaluate(Fi,{},Qu),xh*ku.compositeIconSizes[1].evaluate(Fi,{},Qu)],(Bh[0]>pf||Bh[1]>pf)&&qt(`${zr.layerIds[0]}: Value for "icon-size" is >= ${w_}. Reduce your "icon-size".`)),zr.addSymbols(zr.icon,Sd,Bh,Fs,po,Fi,a.af.none,Pn,hg.lineStartIndex,hg.lineLength,-1,Qu),SS=zr.icon.placedSymbolArray.length-1,Hu&&(N7=4*Hu.length,zr.addSymbols(zr.icon,Hu,Bh,Fs,po,Fi,a.af.vertical,Pn,hg.lineStartIndex,hg.lineLength,-1,Qu),IS=zr.icon.placedSymbolArray.length-1)}const H7=Object.keys(Ms.horizontal);for(const oa of H7){const ql=Ms.horizontal[oa];if(!Ed){z7=es(ql.text);const Hu=So.layout.get("text-rotate").evaluate(Fi,{},Qu);Ed=new Xb(us,Pn,Zs,Io,Ps,ql,Fa,Gl,Ao,Hu)}const Sd=ql.positionedLines.length===1;if(k7+=F7(zr,Pn,ql,Xa,So,Ao,Fi,Za,hg,Ms.vertical?a.af.horizontal:a.af.horizontalOnly,Sd?H7:[oa],cA,SS,ku,Qu),Sd)break}Ms.vertical&&(Q7+=F7(zr,Pn,Ms.vertical,Xa,So,Ao,Fi,Za,hg,a.af.vertical,["vertical"],cA,IS,ku,Qu));const O0e=Ed?Ed.boxStartIndex:zr.collisionBoxArray.length,U0e=Ed?Ed.boxEndIndex:zr.collisionBoxArray.length,D0e=fg?fg.boxStartIndex:zr.collisionBoxArray.length,N0e=fg?fg.boxEndIndex:zr.collisionBoxArray.length,k0e=Ag?Ag.boxStartIndex:zr.collisionBoxArray.length,Q0e=Ag?Ag.boxEndIndex:zr.collisionBoxArray.length,z0e=dg?dg.boxStartIndex:zr.collisionBoxArray.length,H0e=dg?dg.boxEndIndex:zr.collisionBoxArray.length;let zu=-1;const Zb=(oa,ql)=>oa&&oa.circleDiameter?Math.max(oa.circleDiameter,ql):ql;zu=Zb(Ed,zu),zu=Zb(fg,zu),zu=Zb(Ag,zu),zu=Zb(dg,zu);const V7=zu>-1?1:0;V7&&(zu*=L0e/Ys),zr.glyphOffsetArray.length>=ag.MAX_GLYPHS&&qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fi.sortKey!==void 0&&zr.addToSortKeyRanges(zr.symbolInstances.length,Fi.sortKey);const V0e=P7(So,Fi,Qu),[j0e,$0e]=function(oa,ql){const Sd=oa.length,Hu=ql==null?void 0:ql.values;if((Hu==null?void 0:Hu.length)>0)for(let Id=0;Id<Hu.length;Id+=2){const Bh=Hu[Id+1];oa.emplaceBack(a.aw[Hu[Id]],Bh[0],Bh[1])}return[Sd,oa.length]}(zr.textAnchorOffsets,V0e);zr.symbolInstances.emplaceBack(Pn.x,Pn.y,cA.right>=0?cA.right:-1,cA.center>=0?cA.center:-1,cA.left>=0?cA.left:-1,cA.vertical||-1,SS,IS,z7,O0e,U0e,D0e,N0e,k0e,Q0e,z0e,H0e,Zs,k7,Q7,D7,N7,V7,0,Fa,zu,j0e,$0e)}(f,qr,Yr,A,g,b,fr,f.layers[0],f.collisionBoxArray,c.index,c.sourceLayerIndex,f.index,Ie,[Ce,Ce,Ce,Ce],Wt,L,Qe,He,Ft,le,c,B,k,j,T)};if(Nt==="line")for(const Yr of w7(c.geometry,0,0,Ge,Ge)){const qr=Td(Yr,zt),zr=E0e(qr,ne,Tt,A.vertical||fe,g,24,st,f.overscaling,Ge);for(const Pn of zr)fe&&F0e(f,fe.text,lr,Pn)||Ur(qr,Pn)}else if(Nt==="line-center"){for(const Yr of c.geometry)if(Yr.length>1){const qr=Td(Yr,zt),zr=T0e(qr,Tt,A.vertical||fe,g,24,st);zr&&Ur(qr,zr)}}else if(c.type==="Polygon")for(const Yr of wo(c.geometry,0)){const qr=I0e(Yr,16);Ur(Td(Yr[0],zt,!0),new mf(qr.x,qr.y,0))}else if(c.type==="LineString")for(const Yr of c.geometry){const qr=Td(Yr,zt);Ur(qr,new mf(qr[0].x,qr[0].y,0))}else if(c.type==="Point")for(const Yr of c.geometry)for(const qr of Yr)Ur([qr],new mf(qr.x,qr.y,0))}function F7(f,c,A,g,b,B,T,I,L,k,j,G,re,ie,le){const fe=function(st,Qe,ne,Ce,He,Tt,Wt,Ft){const Nt=Ce.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,lr=[];for(const Zt of Qe.positionedLines)for(const fr of Zt.positionedGlyphs){if(!fr.rect)continue;const zt=fr.rect||{};let Ur=o0e+1,Yr=!0,qr=1,zr=0;const Pn=(He||Ft)&&fr.vertical,rs=fr.metrics.advance*fr.scale/2;if(Ft&&Qe.verticalizable&&(zr=Zt.lineOffset/2-(fr.imageName?-(Ys-fr.metrics.width*fr.scale)/2:(fr.scale-1)*Ys)),fr.imageName){const fo=Wt[fr.imageName];Yr=fo.sdf,qr=fo.pixelRatio,Ur=Wa/qr}const Ms=He?[fr.x+rs,fr.y]:[0,0];let Pa=He?[0,0]:[fr.x+rs+ne[0],fr.y+ne[1]-zr],Xa=[0,0];Pn&&(Xa=Pa,Pa=[0,0]);const Ya=fr.metrics.isDoubleResolution?2:1,So=(fr.metrics.left-Ur)*fr.scale-rs+Pa[0],us=(-fr.metrics.top-Ur)*fr.scale+Pa[1],Zs=So+zt.w/Ya*fr.scale/qr,Io=us+zt.h/Ya*fr.scale/qr,Ps=new M(So,us),Fa=new M(Zs,us),Gl=new M(So,Io),Ao=new M(Zs,Io);if(Pn){const fo=new M(-rs,rs-Hb),po=-Math.PI/2,Fs=Ys/2-rs,Fi=new M(5-Hb-Fs,-(fr.imageName?Fs:0)),ku=new M(...Xa);Ps._rotateAround(po,fo)._add(Fi)._add(ku),Fa._rotateAround(po,fo)._add(Fi)._add(ku),Gl._rotateAround(po,fo)._add(Fi)._add(ku),Ao._rotateAround(po,fo)._add(Fi)._add(ku)}if(Nt){const fo=Math.sin(Nt),po=Math.cos(Nt),Fs=[po,-fo,fo,po];Ps._matMult(Fs),Fa._matMult(Fs),Gl._matMult(Fs),Ao._matMult(Fs)}const Za=new M(0,0),Js=new M(0,0);lr.push({tl:Ps,tr:Fa,bl:Gl,br:Ao,tex:zt,writingMode:Qe.writingMode,glyphOffset:Ms,sectionIndex:fr.sectionIndex,isSDF:Yr,pixelOffsetTL:Za,pixelOffsetBR:Js,minFontScaleX:0,minFontScaleY:0})}return lr}(0,A,I,b,B,T,g,f.allowVerticalPlacement),Se=f.textSizeData;let Ie=null;Se.kind==="source"?(Ie=[xh*b.layout.get("text-size").evaluate(T,{})],Ie[0]>pf&&qt(`${f.layerIds[0]}: Value for "text-size" is >= ${w_}. Reduce your "text-size".`)):Se.kind==="composite"&&(Ie=[xh*ie.compositeTextSizes[0].evaluate(T,{},le),xh*ie.compositeTextSizes[1].evaluate(T,{},le)],(Ie[0]>pf||Ie[1]>pf)&&qt(`${f.layerIds[0]}: Value for "text-size" is >= ${w_}. Reduce your "text-size".`)),f.addSymbols(f.text,fe,Ie,I,B,T,k,c,L.lineStartIndex,L.lineLength,re,le);for(const st of j)G[st]=f.text.placedSymbolArray.length-1;return 4*fe.length}function R7(f){for(const c in f)return f[c];return null}function F0e(f,c,A,g){const b=f.compareText;if(c in b){const B=b[c];for(let T=B.length-1;T>=0;T--)if(g.dist(B[T])<A)return!0}else b[c]=[];return b[c].push(g),!1}const L7=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vS{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[A,g]=new Uint8Array(c,0,2);if(A!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=g>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const B=L7[15&g];if(!B)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(c,2,1),[I]=new Uint32Array(c,4,1);return new vS(I,T,B,c)}constructor(c){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,b=arguments.length>3?arguments[3]:void 0;if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+A,2),65535),this.ArrayType=g,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const B=L7.indexOf(this.ArrayType),T=2*c*this.ArrayType.BYTES_PER_ELEMENT,I=c*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-I%8)%8;if(B<0)throw new Error(`Unexpected typed array class: ${g}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+I+L,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+T+I+L),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+I+L,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+B]),new Uint16Array(this.data,2,1)[0]=A,new Uint32Array(this.data,4,1)[0]=c)}add(c,A){const g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=c,this.coords[this._pos++]=A,g}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return wS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,A,g,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:B,coords:T,nodeSize:I}=this,L=[0,B.length-1,0],k=[];for(;L.length;){const j=L.pop()||0,G=L.pop()||0,re=L.pop()||0;if(G-re<=I){for(let Se=re;Se<=G;Se++){const Ie=T[2*Se],st=T[2*Se+1];Ie>=c&&Ie<=g&&st>=A&&st<=b&&k.push(B[Se])}continue}const ie=re+G>>1,le=T[2*ie],fe=T[2*ie+1];le>=c&&le<=g&&fe>=A&&fe<=b&&k.push(B[ie]),(j===0?c<=le:A<=fe)&&(L.push(re),L.push(ie-1),L.push(1-j)),(j===0?g>=le:b>=fe)&&(L.push(ie+1),L.push(G),L.push(1-j))}return k}within(c,A,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:B,nodeSize:T}=this,I=[0,b.length-1,0],L=[],k=g*g;for(;I.length;){const j=I.pop()||0,G=I.pop()||0,re=I.pop()||0;if(G-re<=T){for(let Se=re;Se<=G;Se++)U7(B[2*Se],B[2*Se+1],c,A)<=k&&L.push(b[Se]);continue}const ie=re+G>>1,le=B[2*ie],fe=B[2*ie+1];U7(le,fe,c,A)<=k&&L.push(b[ie]),(j===0?c-g<=le:A-g<=fe)&&(I.push(re),I.push(ie-1),I.push(1-j)),(j===0?c+g>=le:A+g>=fe)&&(I.push(ie+1),I.push(G),I.push(1-j))}return L}}function wS(f,c,A,g,b,B){if(b-g<=A)return;const T=g+b>>1;O7(f,c,T,g,b,B),wS(f,c,A,g,T-1,1-B),wS(f,c,A,T+1,b,1-B)}function O7(f,c,A,g,b,B){for(;b>g;){if(b-g>600){const k=b-g+1,j=A-g+1,G=Math.log(k),re=.5*Math.exp(2*G/3),ie=.5*Math.sqrt(G*re*(k-re)/k)*(j-k/2<0?-1:1);O7(f,c,A,Math.max(g,Math.floor(A-j*re/k+ie)),Math.min(b,Math.floor(A+(k-j)*re/k+ie)),B)}const T=c[2*A+B];let I=g,L=b;for(C_(f,c,g,A),c[2*b+B]>T&&C_(f,c,g,b);I<L;){for(C_(f,c,I,L),I++,L--;c[2*I+B]<T;)I++;for(;c[2*L+B]>T;)L--}c[2*g+B]===T?C_(f,c,g,L):(L++,C_(f,c,L,b)),L<=A&&(g=L+1),A<=L&&(b=L-1)}}function C_(f,c,A,g){xS(f,A,g),xS(c,2*A,2*g),xS(c,2*A+1,2*g+1)}function xS(f,c,A){const g=f[c];f[c]=f[A],f[A]=g}function U7(f,c,A,g){const b=f-A,B=c-g;return b*b+B*B}var BS;a.cf=void 0,(BS=a.cf||(a.cf={})).create="create",BS.load="load",BS.fullLoad="fullLoad";let Yb=null,T_=[];const CS=1e3/60,TS="loadTime",ES="fullLoadTime",R0e={mark(f){performance.mark(f)},frame(f){const c=f;Yb!=null&&T_.push(c-Yb),Yb=c},clearMetrics(){Yb=null,T_=[],performance.clearMeasures(TS),performance.clearMeasures(ES);for(const f in a.cf)performance.clearMarks(a.cf[f])},getPerformanceMetrics(){performance.measure(TS,a.cf.create,a.cf.load),performance.measure(ES,a.cf.create,a.cf.fullLoad);const f=performance.getEntriesByName(TS)[0].duration,c=performance.getEntriesByName(ES)[0].duration,A=T_.length,g=1/(T_.reduce((B,T)=>B+T,0)/A/1e3),b=T_.filter(B=>B>CS).reduce((B,T)=>B+(T-CS)/CS,0);return{loadTime:f,fullLoadTime:c,fps:g,percentDroppedFrames:b/(A+b)*100,totalFrames:A}}};a.$=_S,a.A=te,a.B=_t,a.C=Bc,a.D=wt,a.E=ni,a.F=function(f){if(wr==null){const c=f.navigator?f.navigator.userAgent:null;wr=!!f.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return wr},a.G=class{constructor(f,c){this.target=f,this.mapId=c,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new B0e(()=>this.process()),this.subscription=function(A,g,b,B){return A.addEventListener(g,b,!1),{unsubscribe:()=>{A.removeEventListener(g,b,!1)}}}(this.target,"message",A=>this.receive(A)),this.globalScope=gr(self)?f:window}registerMessageHandler(f,c){this.messageHandlers[f]=c}sendAsync(f,c){return new Promise((A,g)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:A,reject:g},c&&c.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const I={id:b,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const B=[],T=Object.assign(Object.assign({},f),{id:b,sourceMapId:this.mapId,origin:location.origin,data:sA(f.data,B)});this.target.postMessage(T,{transfer:B})})}receive(f){const c=f.data,A=c.id;if(!(c.origin!=="file://"&&location.origin!=="file://"&&c.origin!=="resource://android"&&location.origin!=="resource://android"&&c.origin!==location.origin||c.targetMapId&&this.mapId!==c.targetMapId)){if(c.type==="<cancel>"){delete this.tasks[A];const g=this.abortControllers[A];return delete this.abortControllers[A],void(g&&g.abort())}if(gr(self)||c.mustQueue)return this.tasks[A]=c,this.taskQueue.push(A),void this.invoker.trigger();this.processTask(A,c)}}process(){if(this.taskQueue.length===0)return;const f=this.taskQueue.shift(),c=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),c&&this.processTask(f,c)}processTask(f,c){return o(this,void 0,void 0,function*(){if(c.type==="<response>"){const b=this.resolveRejects[f];return delete this.resolveRejects[f],b?void(c.error?b.reject(Vl(c.error)):b.resolve(Vl(c.data))):void 0}if(!this.messageHandlers[c.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${c.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const A=Vl(c.data),g=new AbortController;this.abortControllers[f]=g;try{const b=yield this.messageHandlers[c.type](c.sourceMapId,A,g);this.completeTask(f,null,b)}catch(b){this.completeTask(f,b)}})}completeTask(f,c,A){const g=[];delete this.abortControllers[f];const b={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:c?sA(c):null,data:sA(A,g)};this.target.postMessage(b,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.H=Sr,a.I=lS,a.J=function(){var f=new te(16);return te!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},a.K=function(f,c,A){var g,b,B,T,I,L,k,j,G,re,ie,le,fe=A[0],Se=A[1],Ie=A[2];return c===f?(f[12]=c[0]*fe+c[4]*Se+c[8]*Ie+c[12],f[13]=c[1]*fe+c[5]*Se+c[9]*Ie+c[13],f[14]=c[2]*fe+c[6]*Se+c[10]*Ie+c[14],f[15]=c[3]*fe+c[7]*Se+c[11]*Ie+c[15]):(b=c[1],B=c[2],T=c[3],I=c[4],L=c[5],k=c[6],j=c[7],G=c[8],re=c[9],ie=c[10],le=c[11],f[0]=g=c[0],f[1]=b,f[2]=B,f[3]=T,f[4]=I,f[5]=L,f[6]=k,f[7]=j,f[8]=G,f[9]=re,f[10]=ie,f[11]=le,f[12]=g*fe+I*Se+G*Ie+c[12],f[13]=b*fe+L*Se+re*Ie+c[13],f[14]=B*fe+k*Se+ie*Ie+c[14],f[15]=T*fe+j*Se+le*Ie+c[15]),f},a.L=function(f,c,A){var g=A[0],b=A[1],B=A[2];return f[0]=c[0]*g,f[1]=c[1]*g,f[2]=c[2]*g,f[3]=c[3]*g,f[4]=c[4]*b,f[5]=c[5]*b,f[6]=c[6]*b,f[7]=c[7]*b,f[8]=c[8]*B,f[9]=c[9]*B,f[10]=c[10]*B,f[11]=c[11]*B,f[12]=c[12],f[13]=c[13],f[14]=c[14],f[15]=c[15],f},a.M=function(f,c,A){var g=c[0],b=c[1],B=c[2],T=c[3],I=c[4],L=c[5],k=c[6],j=c[7],G=c[8],re=c[9],ie=c[10],le=c[11],fe=c[12],Se=c[13],Ie=c[14],st=c[15],Qe=A[0],ne=A[1],Ce=A[2],He=A[3];return f[0]=Qe*g+ne*I+Ce*G+He*fe,f[1]=Qe*b+ne*L+Ce*re+He*Se,f[2]=Qe*B+ne*k+Ce*ie+He*Ie,f[3]=Qe*T+ne*j+Ce*le+He*st,f[4]=(Qe=A[4])*g+(ne=A[5])*I+(Ce=A[6])*G+(He=A[7])*fe,f[5]=Qe*b+ne*L+Ce*re+He*Se,f[6]=Qe*B+ne*k+Ce*ie+He*Ie,f[7]=Qe*T+ne*j+Ce*le+He*st,f[8]=(Qe=A[8])*g+(ne=A[9])*I+(Ce=A[10])*G+(He=A[11])*fe,f[9]=Qe*b+ne*L+Ce*re+He*Se,f[10]=Qe*B+ne*k+Ce*ie+He*Ie,f[11]=Qe*T+ne*j+Ce*le+He*st,f[12]=(Qe=A[12])*g+(ne=A[13])*I+(Ce=A[14])*G+(He=A[15])*fe,f[13]=Qe*b+ne*L+Ce*re+He*Se,f[14]=Qe*B+ne*k+Ce*ie+He*Ie,f[15]=Qe*T+ne*j+Ce*le+He*st,f},a.N=function(f,c){const A={};for(let g=0;g<c.length;g++){const b=c[g];b in f&&(A[b]=f[b])}return A},a.O=gf,a.P=M,a.Q=h7,a.R=jl,a.S=u7,a.T=Yt,a.U=W,a.V=V,a.W=$r,a.X=$l,a.Y=Ge,a.Z=x_,a._=o,a.a=Ut,a.a$=function(){const f=new Float64Array(16);return me(f),f},a.a0=f=>{const c=window.document.createElement("video");return c.muted=!0,new Promise(A=>{c.onloadstart=()=>{A(c)};for(const g of f){const b=window.document.createElement("source");Hr(g)||(c.crossOrigin="Anonymous"),b.src=g,c.appendChild(b)}})},a.a1=We,a.a2=function(){return at++},a.a3=C,a.a4=ag,a.a5=Ru,a.a6=lA,a.a7=_7,a.a8=function(f){const c={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(A,g,b,B)=>{const T=b||B;return c[g]=!T||T.toLowerCase(),""}),c["max-age"]){const A=parseInt(c["max-age"],10);isNaN(A)?delete c["max-age"]:c["max-age"]=A}return c},a.a9=function(f){return Math.log(f)/Math.LN2},a.aA=vS,a.aB=Gr,a.aC=kb,a.aD=Me,a.aE=xr,a.aF=Lt,a.aG=function(f){return Math.pow(2,f)},a.aH=85.051129,a.aI=A7,a.aJ=Le,a.aK=tr,a.aL=f7,a.aM=function(f,c,A){return f[0]=c[0]*A,f[1]=c[1]*A,f[2]=c[2]*A,f},a.aN=function(f,c,A){return f[0]=c[0]+A[0],f[1]=c[1]+A[1],f[2]=c[2]+A[2],f},a.aO=function(f){var c=new te(3);return c[0]=f[0],c[1]=f[1],c[2]=f[2],c},a.aP=function(f,c,A){return f[0]=c[0]*A[0],f[1]=c[1]*A[1],f[2]=c[2]*A[2],f[3]=c[3]*A[3],f},a.aQ=function(f,c,A){return f[0]=c[0]-A[0],f[1]=c[1]-A[1],f[2]=c[2]-A[2],f},a.aR=function(f,c){var A=c[0],g=c[1],b=c[2],B=A*A+g*g+b*b;return B>0&&(B=1/Math.sqrt(B)),f[0]=c[0]*B,f[1]=c[1]*B,f[2]=c[2]*B,f},a.aS=function(f,c,A){var g=c[0],b=c[1],B=c[2],T=A[0],I=A[1],L=A[2];return f[0]=b*L-B*I,f[1]=B*T-g*L,f[2]=g*I-b*T,f},a.aT=function(f,c){return f[0]*c[0]+f[1]*c[1]+f[2]*c[2]},a.aU=p7,a.aV=lg,a.aW=function(f,c,A,g,b){var B,T=1/Math.tan(c/2);return f[0]=T/A,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=T,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,b!=null&&b!==1/0?(f[10]=(b+g)*(B=1/(g-b)),f[14]=2*b*g*B):(f[10]=-1,f[14]=-2*g),f},a.aX=function(f){var c=new te(16);return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=f[6],c[7]=f[7],c[8]=f[8],c[9]=f[9],c[10]=f[10],c[11]=f[11],c[12]=f[12],c[13]=f[13],c[14]=f[14],c[15]=f[15],c},a.aY=function(f,c,A){var g=Math.sin(A),b=Math.cos(A),B=c[0],T=c[1],I=c[2],L=c[3],k=c[4],j=c[5],G=c[6],re=c[7];return c!==f&&(f[8]=c[8],f[9]=c[9],f[10]=c[10],f[11]=c[11],f[12]=c[12],f[13]=c[13],f[14]=c[14],f[15]=c[15]),f[0]=B*b+k*g,f[1]=T*b+j*g,f[2]=I*b+G*g,f[3]=L*b+re*g,f[4]=k*b-B*g,f[5]=j*b-T*g,f[6]=G*b-I*g,f[7]=re*b-L*g,f},a.aZ=function(f,c,A){var g=Math.sin(A),b=Math.cos(A),B=c[4],T=c[5],I=c[6],L=c[7],k=c[8],j=c[9],G=c[10],re=c[11];return c!==f&&(f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f[12]=c[12],f[13]=c[13],f[14]=c[14],f[15]=c[15]),f[4]=B*b+k*g,f[5]=T*b+j*g,f[6]=I*b+G*g,f[7]=L*b+re*g,f[8]=k*b-B*g,f[9]=j*b-T*g,f[10]=G*b-I*g,f[11]=re*b-L*g,f},a.a_=function(){const f=new Float32Array(16);return me(f),f},a.aa=function(f){var c=f[0],A=f[1];return c*c+A*A},a.ab=function(f){return f*Math.PI/180},a.ac=Te,a.ad=function(f,c){const A=[];for(const g in f)g in c||A.push(g);return A},a.ae=function(f,c){let A=0,g=0;if(f.kind==="constant")g=f.layoutSize;else if(f.kind!=="source"){const{interpolationType:b,minZoom:B,maxZoom:T}=f,I=b?Te(In.interpolationFactor(b,c,B,T),0,1):0;f.kind==="camera"?g=Jo.number(f.minSize,f.maxSize,I):A=I}return{uSizeT:A,uSize:g}},a.ag=function(f,c,A){let{uSize:g,uSizeT:b}=c,{lowerSize:B,upperSize:T}=A;return f.kind==="source"?B/xh:f.kind==="composite"?Jo.number(B/xh,T/xh,b):g},a.ah=function(f,c){var A=c[0],g=c[1],b=c[2],B=c[3],T=c[4],I=c[5],L=c[6],k=c[7],j=c[8],G=c[9],re=c[10],ie=c[11],le=c[12],fe=c[13],Se=c[14],Ie=c[15],st=A*I-g*T,Qe=A*L-b*T,ne=A*k-B*T,Ce=g*L-b*I,He=g*k-B*I,Tt=b*k-B*L,Wt=j*fe-G*le,Ft=j*Se-re*le,Nt=j*Ie-ie*le,lr=G*Se-re*fe,Zt=G*Ie-ie*fe,fr=re*Ie-ie*Se,zt=st*fr-Qe*Zt+ne*lr+Ce*Nt-He*Ft+Tt*Wt;return zt?(f[0]=(I*fr-L*Zt+k*lr)*(zt=1/zt),f[1]=(b*Zt-g*fr-B*lr)*zt,f[2]=(fe*Tt-Se*He+Ie*Ce)*zt,f[3]=(re*He-G*Tt-ie*Ce)*zt,f[4]=(L*Nt-T*fr-k*Ft)*zt,f[5]=(A*fr-b*Nt+B*Ft)*zt,f[6]=(Se*ne-le*Tt-Ie*Qe)*zt,f[7]=(j*Tt-re*ne+ie*Qe)*zt,f[8]=(T*Zt-I*Nt+k*Wt)*zt,f[9]=(g*Nt-A*Zt-B*Wt)*zt,f[10]=(le*He-fe*ne+Ie*st)*zt,f[11]=(G*ne-j*He-ie*st)*zt,f[12]=(I*Ft-T*lr-L*Wt)*zt,f[13]=(A*lr-g*Ft+b*Wt)*zt,f[14]=(fe*Qe-le*Ce-Se*st)*zt,f[15]=(j*Ce-G*Qe+re*st)*zt,f):null},a.ai=ge,a.aj=function(f){return Math.hypot(f[0],f[1])},a.ak=function(f){return f[0]=0,f[1]=0,f},a.al=function(f,c,A){return f[0]=c[0]*A,f[1]=c[1]*A,f},a.am=AS,a.an=oe,a.ao=function(f,c,A,g){const b=c.y-f.y,B=c.x-f.x,T=g.y-A.y,I=g.x-A.x,L=T*B-I*b;if(L===0)return null;const k=(I*(f.y-A.y)-T*(f.x-A.x))/L;return new M(f.x+k*B,f.y+k*b)},a.ap=w7,a.aq=s_,a.ar=me,a.as=function(f){let c=1/0,A=1/0,g=-1/0,b=-1/0;for(const B of f)c=Math.min(c,B.x),A=Math.min(A,B.y),g=Math.max(g,B.x),b=Math.max(b,B.y);return[c,A,g,b]},a.at=Ys,a.au=et,a.av=function(f,c,A,g){let b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(!A[0]&&!A[1])return[0,0];const B=b?g==="map"?-f.bearingInRadians:0:g==="viewport"?f.bearingInRadians:0;if(B){const T=Math.sin(B),I=Math.cos(B);A=[A[0]*I-A[1]*T,A[0]*T+A[1]*I]}return[b?A[0]:et(c,A[0],f.zoom),b?A[1]:et(c,A[1],f.zoom)]},a.ax=hS,a.ay=bS,a.az=uS,a.b=Ot,a.b$=f=>f.type==="heatmap",a.b0=function(){return new Float64Array(16)},a.b1=function(f,c,A){const g=new Float64Array(4);return function(b,B,T,I){var L=.5*Math.PI/180;B*=L,T*=L,I*=L;var k=Math.sin(B),j=Math.cos(B),G=Math.sin(T),re=Math.cos(T),ie=Math.sin(I),le=Math.cos(I);b[0]=k*re*le-j*G*ie,b[1]=j*G*le+k*re*ie,b[2]=j*re*ie-k*G*le,b[3]=j*re*le+k*G*ie}(g,f,c-90,A),g},a.b2=function(f,c,A,g){var b,B,T,I,L,k=c[0],j=c[1],G=c[2],re=c[3],ie=A[0],le=A[1],fe=A[2],Se=A[3];return(B=k*ie+j*le+G*fe+re*Se)<0&&(B=-B,ie=-ie,le=-le,fe=-fe,Se=-Se),1-B>q?(b=Math.acos(B),T=Math.sin(b),I=Math.sin((1-g)*b)/T,L=Math.sin(g*b)/T):(I=1-g,L=g),f[0]=I*k+L*ie,f[1]=I*j+L*le,f[2]=I*G+L*fe,f[3]=I*re+L*Se,f},a.b3=function(f){const c=new Float64Array(9);var A,g,b,B,T,I,L,k,j,G,re,ie,le,fe,Se,Ie,st,Qe;G=(b=(g=f)[0])*(L=b+b),re=(B=g[1])*L,le=(T=g[2])*L,fe=T*(k=B+B),Ie=(I=g[3])*L,st=I*k,Qe=I*(j=T+T),(A=c)[0]=1-(ie=B*k)-(Se=T*j),A[3]=re-Qe,A[6]=le+st,A[1]=re+Qe,A[4]=1-G-Se,A[7]=fe-Ie,A[2]=le-st,A[5]=fe+Ie,A[8]=1-G-ie;const ne=tr(-Math.asin(Te(c[2],-1,1)));let Ce,He;return Math.hypot(c[5],c[8])<.001?(Ce=0,He=-tr(Math.atan2(c[3],c[4]))):(Ce=tr(c[5]===0&&c[8]===0?0:Math.atan2(c[5],c[8])),He=tr(c[1]===0&&c[0]===0?0:Math.atan2(c[1],c[0]))),{roll:Ce,pitch:ne+90,bearing:He}},a.b4=function(f,c){return f.roll==c.roll&&f.pitch==c.pitch&&f.bearing==c.bearing},a.b5=dn,a.b6=ho,a.b7=sg,a.b8=p_,a.b9=ig,a.bA=function f(c,A){if(Array.isArray(c)){if(!Array.isArray(A)||c.length!==A.length)return!1;for(let g=0;g<c.length;g++)if(!f(c[g],A[g]))return!1;return!0}if(typeof c=="object"&&c!==null&&A!==null){if(typeof A!="object"||Object.keys(c).length!==Object.keys(A).length)return!1;for(const g in c)if(!f(c[g],A[g]))return!1;return!0}return c===A},a.bB=rt,a.bC=xt,a.bD=class extends ts{constructor(f,c){super(f,c),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},a.bE=Tc,a.bF=class extends ts{constructor(f,c){super(f,c),this.current=Ec}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let c=1;c<16;c++)if(f[c]!==this.current[c]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},a.bG=Ia,a.bH=class extends ts{constructor(f,c){super(f,c),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},a.bI=class extends ts{constructor(f,c){super(f,c),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},a.bJ=J,a.bK=function(f,c){var A=Math.sin(c),g=Math.cos(c);return f[0]=g,f[1]=A,f[2]=0,f[3]=-A,f[4]=g,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},a.bL=function(f,c,A){var g=c[0],b=c[1],B=c[2];return f[0]=g*A[0]+b*A[3]+B*A[6],f[1]=g*A[1]+b*A[4]+B*A[7],f[2]=g*A[2]+b*A[5]+B*A[8],f},a.bM=function(f,c,A,g,b,B,T){var I=1/(c-A),L=1/(g-b),k=1/(B-T);return f[0]=-2*I,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*L,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*k,f[11]=0,f[12]=(c+A)*I,f[13]=(b+g)*L,f[14]=(T+B)*k,f[15]=1,f},a.bN=class extends Ga{},a.bO=e0e,a.bP=class extends ia{},a.bQ=G3,a.bR=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},a.bS=mz,a.bT=function(f,c,A){var g=c[0],b=c[1],B=c[2],T=A[3]*g+A[7]*b+A[11]*B+A[15];return f[0]=(A[0]*g+A[4]*b+A[8]*B+A[12])/(T=T||1),f[1]=(A[1]*g+A[5]*b+A[9]*B+A[13])/T,f[2]=(A[2]*g+A[6]*b+A[10]*B+A[14])/T,f},a.bU=class extends uo{},a.bV=class extends h{},a.bW=function(f,c){return f[0]===c[0]&&f[1]===c[1]&&f[2]===c[2]&&f[3]===c[3]&&f[4]===c[4]&&f[5]===c[5]&&f[6]===c[6]&&f[7]===c[7]&&f[8]===c[8]&&f[9]===c[9]&&f[10]===c[10]&&f[11]===c[11]&&f[12]===c[12]&&f[13]===c[13]&&f[14]===c[14]&&f[15]===c[15]},a.bX=function(f,c){var A=f[0],g=f[1],b=f[2],B=f[3],T=f[4],I=f[5],L=f[6],k=f[7],j=f[8],G=f[9],re=f[10],ie=f[11],le=f[12],fe=f[13],Se=f[14],Ie=f[15],st=c[0],Qe=c[1],ne=c[2],Ce=c[3],He=c[4],Tt=c[5],Wt=c[6],Ft=c[7],Nt=c[8],lr=c[9],Zt=c[10],fr=c[11],zt=c[12],Ur=c[13],Yr=c[14],qr=c[15];return Math.abs(A-st)<=q*Math.max(1,Math.abs(A),Math.abs(st))&&Math.abs(g-Qe)<=q*Math.max(1,Math.abs(g),Math.abs(Qe))&&Math.abs(b-ne)<=q*Math.max(1,Math.abs(b),Math.abs(ne))&&Math.abs(B-Ce)<=q*Math.max(1,Math.abs(B),Math.abs(Ce))&&Math.abs(T-He)<=q*Math.max(1,Math.abs(T),Math.abs(He))&&Math.abs(I-Tt)<=q*Math.max(1,Math.abs(I),Math.abs(Tt))&&Math.abs(L-Wt)<=q*Math.max(1,Math.abs(L),Math.abs(Wt))&&Math.abs(k-Ft)<=q*Math.max(1,Math.abs(k),Math.abs(Ft))&&Math.abs(j-Nt)<=q*Math.max(1,Math.abs(j),Math.abs(Nt))&&Math.abs(G-lr)<=q*Math.max(1,Math.abs(G),Math.abs(lr))&&Math.abs(re-Zt)<=q*Math.max(1,Math.abs(re),Math.abs(Zt))&&Math.abs(ie-fr)<=q*Math.max(1,Math.abs(ie),Math.abs(fr))&&Math.abs(le-zt)<=q*Math.max(1,Math.abs(le),Math.abs(zt))&&Math.abs(fe-Ur)<=q*Math.max(1,Math.abs(fe),Math.abs(Ur))&&Math.abs(Se-Yr)<=q*Math.max(1,Math.abs(Se),Math.abs(Yr))&&Math.abs(Ie-qr)<=q*Math.max(1,Math.abs(Ie),Math.abs(qr))},a.bY=function(f,c){return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f[4]=c[4],f[5]=c[5],f[6]=c[6],f[7]=c[7],f[8]=c[8],f[9]=c[9],f[10]=c[10],f[11]=c[11],f[12]=c[12],f[13]=c[13],f[14]=c[14],f[15]=c[15],f},a.bZ=f=>f.type==="symbol",a.b_=f=>f.type==="circle",a.ba=ct,a.bb=At,a.bc=Wi,a.bd=function(f,c,A,g,b){return ct(g,b,Te((f-c)/(A-c),0,1))},a.be=Ye,a.bf=function(){return new Float64Array(4)},a.bg=function(){return new Float64Array(3)},a.bh=function(f,c,A,g){var b=[],B=[];return b[0]=c[0]-A[0],b[1]=c[1]-A[1],b[2]=c[2]-A[2],B[0]=b[0]*Math.cos(g)-b[1]*Math.sin(g),B[1]=b[0]*Math.sin(g)+b[1]*Math.cos(g),B[2]=b[2],f[0]=B[0]+A[0],f[1]=B[1]+A[1],f[2]=B[2]+A[2],f},a.bi=function(f,c,A,g){var b=[],B=[];return b[0]=c[0]-A[0],b[1]=c[1]-A[1],b[2]=c[2]-A[2],B[0]=b[0],B[1]=b[1]*Math.cos(g)-b[2]*Math.sin(g),B[2]=b[1]*Math.sin(g)+b[2]*Math.cos(g),f[0]=B[0]+A[0],f[1]=B[1]+A[1],f[2]=B[2]+A[2],f},a.bj=function(f,c,A,g){var b=[],B=[];return b[0]=c[0]-A[0],b[1]=c[1]-A[1],b[2]=c[2]-A[2],B[0]=b[2]*Math.sin(g)+b[0]*Math.cos(g),B[1]=b[1],B[2]=b[2]*Math.cos(g)-b[0]*Math.sin(g),f[0]=B[0]+A[0],f[1]=B[1]+A[1],f[2]=B[2]+A[2],f},a.bk=function(f,c,A){var g=Math.sin(A),b=Math.cos(A),B=c[0],T=c[1],I=c[2],L=c[3],k=c[8],j=c[9],G=c[10],re=c[11];return c!==f&&(f[4]=c[4],f[5]=c[5],f[6]=c[6],f[7]=c[7],f[12]=c[12],f[13]=c[13],f[14]=c[14],f[15]=c[15]),f[0]=B*b-k*g,f[1]=T*b-j*g,f[2]=I*b-G*g,f[3]=L*b-re*g,f[8]=B*g+k*b,f[9]=T*g+j*b,f[10]=I*g+G*b,f[11]=L*g+re*b,f},a.bl=function(f,c){const A=Ye(f,360),g=Ye(c,360),b=g-A,B=g>A?b-360:b+360;return Math.abs(b)<Math.abs(B)?b:B},a.bm=function(f){return f[0]=0,f[1]=0,f[2]=0,f},a.bn=function(f,c,A,g){const b=Math.sqrt(f*f+c*c),B=Math.sqrt(A*A+g*g);f/=b,c/=b,A/=B,g/=B;const T=Math.acos(f*A+c*g);return-c*A+f*g>0?T:-T},a.bo=function(f,c){return f[0]*c[0]+f[1]*c[1]+f[2]*c[2]+f[3]},a.bp=gS,a.bq=function(f,c){const A=Ye(f,2*Math.PI),g=Ye(c,2*Math.PI);return Math.min(Math.abs(A-g),Math.abs(A-g+2*Math.PI),Math.abs(A-g-2*Math.PI))},a.br=function(f){return Math.hypot(f[0],f[1],f[2])},a.bs=function(){const f={},c=Be.$version;for(const A in Be.$root){const g=Be.$root[A];if(g.required){let b=null;b=A==="version"?c:g.type==="array"?[]:{},b!=null&&(f[A]=b)}}return f},a.bt=oA,a.bu=Dr,a.bv=function(f){f=f.slice();const c=Object.create(null);for(let A=0;A<f.length;A++)c[f[A].id]=f[A];for(let A=0;A<f.length;A++)"ref"in f[A]&&(f[A]=de(f[A],c[f[A].ref]));return f},a.bw=function(f){if(f.type==="custom")return new x0e(f);switch(f.type){case"background":return new b0e(f);case"circle":return new pye(f);case"fill":return new Lye(f);case"fill-extrusion":return new Hye(f);case"heatmap":return new mye(f);case"hillshade":return new yye(f);case"line":return new Xye(f);case"raster":return new w0e(f);case"symbol":return new Gb(f)}},a.bx=vt,a.by=function(f,c){if(!f)return[{command:"setStyle",args:[c]}];let A=[];try{if(!_e(f.version,c.version))return[{command:"setStyle",args:[c]}];_e(f.center,c.center)||A.push({command:"setCenter",args:[c.center]}),_e(f.centerAltitude,c.centerAltitude)||A.push({command:"setCenterAltitude",args:[c.centerAltitude]}),_e(f.zoom,c.zoom)||A.push({command:"setZoom",args:[c.zoom]}),_e(f.bearing,c.bearing)||A.push({command:"setBearing",args:[c.bearing]}),_e(f.pitch,c.pitch)||A.push({command:"setPitch",args:[c.pitch]}),_e(f.roll,c.roll)||A.push({command:"setRoll",args:[c.roll]}),_e(f.sprite,c.sprite)||A.push({command:"setSprite",args:[c.sprite]}),_e(f.glyphs,c.glyphs)||A.push({command:"setGlyphs",args:[c.glyphs]}),_e(f.transition,c.transition)||A.push({command:"setTransition",args:[c.transition]}),_e(f.light,c.light)||A.push({command:"setLight",args:[c.light]}),_e(f.terrain,c.terrain)||A.push({command:"setTerrain",args:[c.terrain]}),_e(f.sky,c.sky)||A.push({command:"setSky",args:[c.sky]}),_e(f.projection,c.projection)||A.push({command:"setProjection",args:[c.projection]});const g={},b=[];(function(T,I,L,k){let j;for(j in I=I||{},T=T||{})Object.prototype.hasOwnProperty.call(T,j)&&(Object.prototype.hasOwnProperty.call(I,j)||lt(j,L,k));for(j in I)Object.prototype.hasOwnProperty.call(I,j)&&(Object.prototype.hasOwnProperty.call(T,j)?_e(T[j],I[j])||(T[j].type==="geojson"&&I[j].type==="geojson"&&Ze(T,I,j)?Ue(L,{command:"setGeoJSONSourceData",args:[j,I[j].data]}):dt(j,I,L,k)):je(j,I,L))})(f.sources,c.sources,b,g);const B=[];f.layers&&f.layers.forEach(T=>{"source"in T&&g[T.source]?A.push({command:"removeLayer",args:[T.id]}):B.push(T)}),A=A.concat(b),function(T,I,L){I=I||[];const k=(T=T||[]).map(bt),j=I.map(bt),G=T.reduce(pt,{}),re=I.reduce(pt,{}),ie=k.slice(),le=Object.create(null);let fe,Se,Ie,st,Qe;for(let ne=0,Ce=0;ne<k.length;ne++)fe=k[ne],Object.prototype.hasOwnProperty.call(re,fe)?Ce++:(Ue(L,{command:"removeLayer",args:[fe]}),ie.splice(ie.indexOf(fe,Ce),1));for(let ne=0,Ce=0;ne<j.length;ne++)fe=j[j.length-1-ne],ie[ie.length-1-ne]!==fe&&(Object.prototype.hasOwnProperty.call(G,fe)?(Ue(L,{command:"removeLayer",args:[fe]}),ie.splice(ie.lastIndexOf(fe,ie.length-Ce),1)):Ce++,st=ie[ie.length-ne],Ue(L,{command:"addLayer",args:[re[fe],st]}),ie.splice(ie.length-ne,0,fe),le[fe]=!0);for(let ne=0;ne<j.length;ne++)if(fe=j[ne],Se=G[fe],Ie=re[fe],!le[fe]&&!_e(Se,Ie))if(_e(Se.source,Ie.source)&&_e(Se["source-layer"],Ie["source-layer"])&&_e(Se.type,Ie.type)){for(Qe in ht(Se.layout,Ie.layout,L,fe,null,"setLayoutProperty"),ht(Se.paint,Ie.paint,L,fe,null,"setPaintProperty"),_e(Se.filter,Ie.filter)||Ue(L,{command:"setFilter",args:[fe,Ie.filter]}),_e(Se.minzoom,Ie.minzoom)&&_e(Se.maxzoom,Ie.maxzoom)||Ue(L,{command:"setLayerZoomRange",args:[fe,Ie.minzoom,Ie.maxzoom]}),Se)Object.prototype.hasOwnProperty.call(Se,Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&(Qe.indexOf("paint.")===0?ht(Se[Qe],Ie[Qe],L,fe,Qe.slice(6),"setPaintProperty"):_e(Se[Qe],Ie[Qe])||Ue(L,{command:"setLayerProperty",args:[fe,Qe,Ie[Qe]]}));for(Qe in Ie)Object.prototype.hasOwnProperty.call(Ie,Qe)&&!Object.prototype.hasOwnProperty.call(Se,Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&(Qe.indexOf("paint.")===0?ht(Se[Qe],Ie[Qe],L,fe,Qe.slice(6),"setPaintProperty"):_e(Se[Qe],Ie[Qe])||Ue(L,{command:"setLayerProperty",args:[fe,Qe,Ie[Qe]]}))}else Ue(L,{command:"removeLayer",args:[fe]}),st=ie[ie.lastIndexOf(fe)+1],Ue(L,{command:"addLayer",args:[Ie,st]})}(B,c.layers,A)}catch(g){console.warn("Unable to compute style diff:",g),A=[{command:"setStyle",args:[c]}]}return A},a.bz=function(f){const c=[],A=f.id;return A===void 0&&c.push({message:`layers.${A}: missing required property "id"`}),f.render===void 0&&c.push({message:`layers.${A}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&c.push({message:`layers.${A}: property "renderingMode" must be either "2d" or "3d"`}),c},a.c=_r,a.c0=f=>f.type==="line",a.c1=f=>f.type==="fill",a.c2=f=>f.type==="fill-extrusion",a.c3=f=>f.type==="hillshade",a.c4=f=>f.type==="raster",a.c5=f=>f.type==="background",a.c6=f=>f.type==="custom",a.c7=kt,a.c8=function(f,c,A){const g=Je(c.x-A.x,c.y-A.y),b=Je(f.x-A.x,f.y-A.y);var B,T;return tr(Math.atan2(g[0]*b[1]-g[1]*b[0],(B=g)[0]*(T=b)[0]+B[1]*T[1]))},a.c9=ae,a.cA=Lz,a.cB=Gz,a.cC=Mu,a.cD=ot,a.ca=function(f,c,A){var g=c[0],b=c[1];return f[0]=A[0]*g+A[4]*b+A[12],f[1]=A[1]*g+A[5]*b+A[13],f},a.cb=function(f,c){const{x:A,y:g}=x_.fromLngLat(c);return!(f<0||f>25||g<0||g>=1||A<0||A>=1)},a.cc=function(f,c){return f[0]=c[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=c[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=c[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},a.cd=class extends Ii{},a.ce=R0e,a.cg=function(f){return f.message===mr},a.ch=Er,a.ci=function(f,c){Ut.REGISTERED_PROTOCOLS[f]=c},a.cj=function(f){delete Ut.REGISTERED_PROTOCOLS[f]},a.ck=function(f,c){const A={};for(let b=0;b<f.length;b++){const B=c&&c[f[b].id]||md(f[b]);c&&(c[f[b].id]=B);let T=A[B];T||(T=A[B]=[]),T.push(f[b])}const g=[];for(const b in A)g.push(A[b]);return g},a.cl=Mr,a.cm=m7,a.cn=y7,a.co=Kz,a.cp=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=Ge/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;const c=f.bucket.layers[0],A=c.layout,g=c._unevaluatedLayout._values,b={layoutIconSize:g["icon-size"].possiblyEvaluate(new _t(f.bucket.zoom+1),f.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new _t(f.bucket.zoom+1),f.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new _t(18))};if(f.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:j}=f.bucket.textSizeData;b.compositeTextSizes=[g["text-size"].possiblyEvaluate(new _t(k),f.canonical),g["text-size"].possiblyEvaluate(new _t(j),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:j}=f.bucket.iconSizeData;b.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new _t(k),f.canonical),g["icon-size"].possiblyEvaluate(new _t(j),f.canonical)]}const B=A.get("text-line-height")*Ys,T=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",I=A.get("text-keep-upright"),L=A.get("text-size");for(const k of f.bucket.features){const j=A.get("text-font").evaluate(k,{},f.canonical).join(","),G=L.evaluate(k,{},f.canonical),re=b.layoutTextSize.evaluate(k,{},f.canonical),ie=b.layoutIconSize.evaluate(k,{},f.canonical),le={horizontal:{},vertical:void 0},fe=k.text;let Se,Ie=[0,0];if(fe){const ne=fe.toString(),Ce=A.get("text-letter-spacing").evaluate(k,{},f.canonical)*Ys,He=Bd(ne)?Ce:0,Tt=A.get("text-anchor").evaluate(k,{},f.canonical),Wt=P7(c,k,f.canonical);if(!Wt){const Zt=A.get("text-radial-offset").evaluate(k,{},f.canonical);Ie=Zt?M7(Tt,[Zt*Ys,yS]):A.get("text-offset").evaluate(k,{},f.canonical).map(fr=>fr*Ys)}let Ft=T?"center":A.get("text-justify").evaluate(k,{},f.canonical);const Nt=A.get("symbol-placement")==="point"?A.get("text-max-width").evaluate(k,{},f.canonical)*Ys:1/0,lr=()=>{f.bucket.allowVerticalPlacement&&vh(ne)&&(le.vertical=Vb(fe,f.glyphMap,f.glyphPositions,f.imagePositions,j,Nt,B,Tt,"left",He,Ie,a.af.vertical,!0,re,G))};if(!T&&Wt){const Zt=new Set;if(Ft==="auto")for(let zt=0;zt<Wt.values.length;zt+=2)Zt.add(bS(Wt.values[zt]));else Zt.add(Ft);let fr=!1;for(const zt of Zt)if(!le.horizontal[zt])if(fr)le.horizontal[zt]=le.horizontal[0];else{const Ur=Vb(fe,f.glyphMap,f.glyphPositions,f.imagePositions,j,Nt,B,"center",zt,He,Ie,a.af.horizontal,!1,re,G);Ur&&(le.horizontal[zt]=Ur,fr=Ur.positionedLines.length===1)}lr()}else{Ft==="auto"&&(Ft=bS(Tt));const Zt=Vb(fe,f.glyphMap,f.glyphPositions,f.imagePositions,j,Nt,B,Tt,Ft,He,Ie,a.af.horizontal,!1,re,G);Zt&&(le.horizontal[Ft]=Zt),lr(),vh(ne)&&T&&I&&(le.vertical=Vb(fe,f.glyphMap,f.glyphPositions,f.imagePositions,j,Nt,B,Tt,Ft,He,Ie,a.af.vertical,!1,re,G))}}let st=!1;if(k.icon&&k.icon.name){const ne=f.imageMap[k.icon.name];ne&&(Se=p0e(f.imagePositions[k.icon.name],A.get("icon-offset").evaluate(k,{},f.canonical),A.get("icon-anchor").evaluate(k,{},f.canonical)),st=!!ne.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=st:f.bucket.sdfIcons!==st&&qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ne.pixelRatio!==f.bucket.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}const Qe=R7(le.horizontal)||le.vertical;f.bucket.iconsInText=!!Qe&&Qe.iconsInText,(Qe||Se)&&P0e(f.bucket,k,le,Se,f.imageMap,b,re,ie,Ie,st,f.canonical,f.subdivisionGranularity)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},a.cq=nS,a.cr=Y3,a.cs=rS,a.ct=m_,a.cu=oS,a.cv=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},a.cw=function(f,c,A,g,b){return o(this,void 0,void 0,function*(){if(V())try{return yield $r(f,c,A,g,b)}catch{}return function(B,T,I,L,k){const j=B.width,G=B.height;Rr&&Jt||(Rr=new OffscreenCanvas(j,G),Jt=Rr.getContext("2d",{willReadFrequently:!0})),Rr.width=j,Rr.height=G,Jt.drawImage(B,0,0,j,G);const re=Jt.getImageData(T,I,L,k);return Jt.clearRect(0,0,j,G),re.data}(f,c,A,g,b)})},a.cx=g7,a.cy=u,a.cz=_,a.d=f=>o(void 0,void 0,void 0,function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));const c=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(c)}catch(A){throw new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.e=De,a.f=f=>new Promise((c,A)=>{const g=new Image;g.onload=()=>{c(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=ze})},g.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(f)],{type:"image/png"});g.src=f.byteLength?URL.createObjectURL(b):ze}),a.g=ar,a.h=(f,c)=>nn(De(f,{type:"json"}),c),a.i=gr,a.j=un,a.k=Qn,a.l=(f,c)=>nn(De(f,{type:"arrayBuffer"}),c),a.m=nn,a.n=function(f){return new oS(f).readFields(n0e,[])},a.o=u_,a.p=qz,a.q=fn,a.r=Af,a.s=Hr,a.t=Zp,a.u=bn,a.v=Be,a.w=qt,a.x=yh,a.y=function(f){let[c,A,g]=f;return A+=90,A*=Math.PI/180,g*=Math.PI/180,{x:c*Math.cos(A)*Math.sin(g),y:c*Math.sin(A)*Math.sin(g),z:c*Math.cos(g)}},a.z=Jo}),i("worker",["./shared"],function(a){class o{constructor(ce){this.keyCache={},ce&&this.replace(ce)}replace(ce){this._layerConfigs={},this._layers={},this.update(ce,[])}update(ce,de){for(const Ue of ce){this._layerConfigs[Ue.id]=Ue;const je=this._layers[Ue.id]=a.bw(Ue);je._featureFilter=a.a5(je.filter),this.keyCache[Ue.id]&&delete this.keyCache[Ue.id]}for(const Ue of de)delete this.keyCache[Ue],delete this._layerConfigs[Ue],delete this._layers[Ue];this.familiesBySource={};const _e=a.ck(Object.values(this._layerConfigs),this.keyCache);for(const Ue of _e){const je=Ue.map(pt=>this._layers[pt.id]),lt=je[0];if(lt.visibility==="none")continue;const dt=lt.source||"";let Ze=this.familiesBySource[dt];Ze||(Ze=this.familiesBySource[dt]={});const ht=lt.sourceLayer||"_geojsonTileLayer";let bt=Ze[ht];bt||(bt=Ze[ht]=[]),bt.push(je)}}}class u{constructor(ce){const de={},_e=[];for(const dt in ce){const Ze=ce[dt],ht=de[dt]={};for(const bt in Ze){const pt=Ze[+bt];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const We={x:0,y:0,w:pt.bitmap.width+2,h:pt.bitmap.height+2};_e.push(We),ht[bt]={rect:We,metrics:pt.metrics}}}const{w:Ue,h:je}=a.p(_e),lt=new a.o({width:Ue||1,height:je||1});for(const dt in ce){const Ze=ce[dt];for(const ht in Ze){const bt=Ze[+ht];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;const pt=de[dt][ht].rect;a.o.copy(bt.bitmap,lt,{x:0,y:0},{x:pt.x+1,y:pt.y+1},bt.bitmap)}}this.image=lt,this.positions=de}}a.cl("GlyphAtlas",u);class d{constructor(ce){this.tileID=new a.X(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),this.uid=ce.uid,this.zoom=ce.zoom,this.pixelRatio=ce.pixelRatio,this.tileSize=ce.tileSize,this.source=ce.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ce.showCollisionBoxes,this.collectResourceTiming=!!ce.collectResourceTiming,this.returnDependencies=!!ce.returnDependencies,this.promoteId=ce.promoteId,this.inFlightDependencies=[]}parse(ce,de,_e,Ue,je){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=ce,this.collisionBoxArray=new a.a3;const lt=new a.cm(Object.keys(ce.layers).sort()),dt=new a.cn(this.tileID,this.promoteId);dt.bucketLayerIDs=[];const Ze={},ht={featureIndex:dt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:_e,subdivisionGranularity:je},bt=de.familiesBySource[this.source];for(const jr in bt){const Br=ce.layers[jr];if(!Br)continue;Br.version===1&&a.w(`Vector tile source "${this.source}" layer "${jr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Sn=lt.encode(jr),Ti=[];for(let Bn=0;Bn<Br.length;Bn++){const zn=Br.feature(Bn),Cn=dt.getId(zn,jr);Ti.push({feature:zn,id:Cn,index:Bn,sourceLayerIndex:Sn})}for(const Bn of bt[jr]){const zn=Bn[0];zn.source!==this.source&&a.w(`layer.source = ${zn.source} does not equal this.source = ${this.source}`),zn.minzoom&&this.zoom<Math.floor(zn.minzoom)||zn.maxzoom&&this.zoom>=zn.maxzoom||zn.visibility!=="none"&&(p(Bn,this.zoom,_e),(Ze[zn.id]=zn.createBucket({index:dt.bucketLayerIDs.length,layers:Bn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sn,sourceID:this.source})).populate(Ti,ht,this.tileID.canonical),dt.bucketLayerIDs.push(Bn.map(Cn=>Cn.id)))}}const pt=a.bB(ht.glyphDependencies,jr=>Object.keys(jr).map(Number));this.inFlightDependencies.forEach(jr=>jr==null?void 0:jr.abort()),this.inFlightDependencies=[];let We=Promise.resolve({});if(Object.keys(pt).length){const jr=new AbortController;this.inFlightDependencies.push(jr),We=Ue.sendAsync({type:"GG",data:{stacks:pt,source:this.source,tileID:this.tileID,type:"glyphs"}},jr)}const hr=Object.keys(ht.iconDependencies);let sr=Promise.resolve({});if(hr.length){const jr=new AbortController;this.inFlightDependencies.push(jr),sr=Ue.sendAsync({type:"GI",data:{icons:hr,source:this.source,tileID:this.tileID,type:"icons"}},jr)}const rr=Object.keys(ht.patternDependencies);let Nr=Promise.resolve({});if(rr.length){const jr=new AbortController;this.inFlightDependencies.push(jr),Nr=Ue.sendAsync({type:"GI",data:{icons:rr,source:this.source,tileID:this.tileID,type:"patterns"}},jr)}const[Rt,ir,br]=yield Promise.all([We,sr,Nr]),kr=new u(Rt),en=new a.co(ir,br);for(const jr in Ze){const Br=Ze[jr];Br instanceof a.a4?(p(Br.layers,this.zoom,_e),a.cp({bucket:Br,glyphMap:Rt,glyphPositions:kr.positions,imageMap:ir,imagePositions:en.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ht.subdivisionGranularity})):Br.hasPattern&&(Br instanceof a.cq||Br instanceof a.cr||Br instanceof a.cs)&&(p(Br.layers,this.zoom,_e),Br.addFeatures(ht,this.tileID.canonical,en.patternPositions))}return this.status="done",{buckets:Object.values(Ze).filter(jr=>!jr.isEmpty()),featureIndex:dt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:kr.image,imageAtlas:en,glyphMap:this.returnDependencies?Rt:null,iconMap:this.returnDependencies?ir:null,glyphPositions:this.returnDependencies?kr.positions:null}})}}function p(Be,ce,de){const _e=new a.B(ce);for(const Ue of Be)Ue.recalculate(_e,de)}class _{constructor(ce,de,_e){this.actor=ce,this.layerIndex=de,this.availableImages=_e,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ce,de){return a._(this,void 0,void 0,function*(){const _e=yield a.l(ce.request,de);try{return{vectorTile:new a.ct.VectorTile(new a.cu(_e.data)),rawData:_e.data,cacheControl:_e.cacheControl,expires:_e.expires}}catch(Ue){const je=new Uint8Array(_e.data);let lt=`Unable to parse the tile at ${ce.request.url}, `;throw lt+=je[0]===31&&je[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ue.message}`,new Error(lt)}})}loadTile(ce){return a._(this,void 0,void 0,function*(){const de=ce.uid,_e=!!(ce&&ce.request&&ce.request.collectResourceTiming)&&new a.cv(ce.request),Ue=new d(ce);this.loading[de]=Ue;const je=new AbortController;Ue.abort=je;try{const lt=yield this.loadVectorTile(ce,je);if(delete this.loading[de],!lt)return null;const dt=lt.rawData,Ze={};lt.expires&&(Ze.expires=lt.expires),lt.cacheControl&&(Ze.cacheControl=lt.cacheControl);const ht={};if(_e){const pt=_e.finish();pt&&(ht.resourceTiming=JSON.parse(JSON.stringify(pt)))}Ue.vectorTile=lt.vectorTile;const bt=Ue.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.actor,ce.subdivisionGranularity);this.loaded[de]=Ue,this.fetching[de]={rawTileData:dt,cacheControl:Ze,resourceTiming:ht};try{const pt=yield bt;return a.e({rawTileData:dt.slice(0)},pt,Ze,ht)}finally{delete this.fetching[de]}}catch(lt){throw delete this.loading[de],Ue.status="done",this.loaded[de]=Ue,lt}})}reloadTile(ce){return a._(this,void 0,void 0,function*(){const de=ce.uid;if(!this.loaded||!this.loaded[de])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const _e=this.loaded[de];if(_e.showCollisionBoxes=ce.showCollisionBoxes,_e.status==="parsing"){const Ue=yield _e.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor,ce.subdivisionGranularity);let je;if(this.fetching[de]){const{rawTileData:lt,cacheControl:dt,resourceTiming:Ze}=this.fetching[de];delete this.fetching[de],je=a.e({rawTileData:lt.slice(0)},Ue,dt,Ze)}else je=Ue;return je}if(_e.status==="done"&&_e.vectorTile)return _e.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor,ce.subdivisionGranularity)})}abortTile(ce){return a._(this,void 0,void 0,function*(){const de=this.loading,_e=ce.uid;de&&de[_e]&&de[_e].abort&&(de[_e].abort.abort(),delete de[_e])})}removeTile(ce){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ce.uid]&&delete this.loaded[ce.uid]})}}class w{constructor(){this.loaded={}}loadTile(ce){return a._(this,void 0,void 0,function*(){const{uid:de,encoding:_e,rawImageData:Ue,redFactor:je,greenFactor:lt,blueFactor:dt,baseShift:Ze}=ce,ht=Ue.width+2,bt=Ue.height+2,pt=a.b(Ue)?new a.R({width:ht,height:bt},yield a.cw(Ue,-1,-1,ht,bt)):Ue,We=new a.cx(de,pt,_e,je,lt,dt,Ze);return this.loaded=this.loaded||{},this.loaded[de]=We,We})}removeTile(ce){const de=this.loaded,_e=ce.uid;de&&de[_e]&&delete de[_e]}}var v,M,P=function(){if(M)return v;function Be(de,_e){if(de.length!==0){ce(de[0],_e);for(var Ue=1;Ue<de.length;Ue++)ce(de[Ue],!_e)}}function ce(de,_e){for(var Ue=0,je=0,lt=0,dt=de.length,Ze=dt-1;lt<dt;Ze=lt++){var ht=(de[lt][0]-de[Ze][0])*(de[Ze][1]+de[lt][1]),bt=Ue+ht;je+=Math.abs(Ue)>=Math.abs(ht)?Ue-bt+ht:ht-bt+Ue,Ue=bt}Ue+je>=0!=!!_e&&de.reverse()}return M=1,v=function de(_e,Ue){var je,lt=_e&&_e.type;if(lt==="FeatureCollection")for(je=0;je<_e.features.length;je++)de(_e.features[je],Ue);else if(lt==="GeometryCollection")for(je=0;je<_e.geometries.length;je++)de(_e.geometries[je],Ue);else if(lt==="Feature")de(_e.geometry,Ue);else if(lt==="Polygon")Be(_e.coordinates,Ue);else if(lt==="MultiPolygon")for(je=0;je<_e.coordinates.length;je++)Be(_e.coordinates[je],Ue);return _e}}(),D=a.cy(P);const N=a.ct.VectorTileFeature.prototype.toGeoJSON;class z{constructor(ce){this._feature=ce,this.extent=a.Y,this.type=ce.type,this.properties=ce.tags,"id"in ce&&!isNaN(ce.id)&&(this.id=parseInt(ce.id,10))}loadGeometry(){if(this._feature.type===1){const ce=[];for(const de of this._feature.geometry)ce.push([new a.P(de[0],de[1])]);return ce}{const ce=[];for(const de of this._feature.geometry){const _e=[];for(const Ue of de)_e.push(new a.P(Ue[0],Ue[1]));ce.push(_e)}return ce}}toGeoJSON(ce,de,_e){return N.call(this,ce,de,_e)}}class W{constructor(ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.Y,this.length=ce.length,this._features=ce}feature(ce){return new z(this._features[ce])}}var V,$,q,te={exports:{}},J=function(){if(q)return te.exports;q=1;var Be=a.cB(),ce=function(){if($)return V;$=1;var bt=a.cz(),pt=a.cA().VectorTileFeature;function We(sr,rr){this.options=rr||{},this.features=sr,this.length=sr.length}function hr(sr,rr){this.id=typeof sr.id=="number"?sr.id:void 0,this.type=sr.type,this.rawGeometry=sr.type===1?[sr.geometry]:sr.geometry,this.properties=sr.tags,this.extent=rr||4096}return V=We,We.prototype.feature=function(sr){return new hr(this.features[sr],this.options.extent)},hr.prototype.loadGeometry=function(){var sr=this.rawGeometry;this.geometry=[];for(var rr=0;rr<sr.length;rr++){for(var Nr=sr[rr],Rt=[],ir=0;ir<Nr.length;ir++)Rt.push(new bt(Nr[ir][0],Nr[ir][1]));this.geometry.push(Rt)}return this.geometry},hr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var sr=this.geometry,rr=1/0,Nr=-1/0,Rt=1/0,ir=-1/0,br=0;br<sr.length;br++)for(var kr=sr[br],en=0;en<kr.length;en++){var jr=kr[en];rr=Math.min(rr,jr.x),Nr=Math.max(Nr,jr.x),Rt=Math.min(Rt,jr.y),ir=Math.max(ir,jr.y)}return[rr,Rt,Nr,ir]},hr.prototype.toGeoJSON=pt.prototype.toGeoJSON,V}();function de(bt){var pt=new Be;return function(We,hr){for(var sr in We.layers)hr.writeMessage(3,_e,We.layers[sr])}(bt,pt),pt.finish()}function _e(bt,pt){var We;pt.writeVarintField(15,bt.version||1),pt.writeStringField(1,bt.name||""),pt.writeVarintField(5,bt.extent||4096);var hr={keys:[],values:[],keycache:{},valuecache:{}};for(We=0;We<bt.length;We++)hr.feature=bt.feature(We),pt.writeMessage(2,Ue,hr);var sr=hr.keys;for(We=0;We<sr.length;We++)pt.writeStringField(3,sr[We]);var rr=hr.values;for(We=0;We<rr.length;We++)pt.writeMessage(4,ht,rr[We])}function Ue(bt,pt){var We=bt.feature;We.id!==void 0&&pt.writeVarintField(1,We.id),pt.writeMessage(2,je,bt),pt.writeVarintField(3,We.type),pt.writeMessage(4,Ze,We)}function je(bt,pt){var We=bt.feature,hr=bt.keys,sr=bt.values,rr=bt.keycache,Nr=bt.valuecache;for(var Rt in We.properties){var ir=We.properties[Rt],br=rr[Rt];if(ir!==null){br===void 0&&(hr.push(Rt),rr[Rt]=br=hr.length-1),pt.writeVarint(br);var kr=typeof ir;kr!=="string"&&kr!=="boolean"&&kr!=="number"&&(ir=JSON.stringify(ir));var en=kr+":"+ir,jr=Nr[en];jr===void 0&&(sr.push(ir),Nr[en]=jr=sr.length-1),pt.writeVarint(jr)}}}function lt(bt,pt){return(pt<<3)+(7&bt)}function dt(bt){return bt<<1^bt>>31}function Ze(bt,pt){for(var We=bt.loadGeometry(),hr=bt.type,sr=0,rr=0,Nr=We.length,Rt=0;Rt<Nr;Rt++){var ir=We[Rt],br=1;hr===1&&(br=ir.length),pt.writeVarint(lt(1,br));for(var kr=hr===3?ir.length-1:ir.length,en=0;en<kr;en++){en===1&&hr!==1&&pt.writeVarint(lt(2,kr-1));var jr=ir[en].x-sr,Br=ir[en].y-rr;pt.writeVarint(dt(jr)),pt.writeVarint(dt(Br)),sr+=jr,rr+=Br}hr===3&&pt.writeVarint(lt(7,1))}}function ht(bt,pt){var We=typeof bt;We==="string"?pt.writeStringField(1,bt):We==="boolean"?pt.writeBooleanField(7,bt):We==="number"&&(bt%1!=0?pt.writeDoubleField(3,bt):bt<0?pt.writeSVarintField(6,bt):pt.writeVarintField(5,bt))}return te.exports=de,te.exports.fromVectorTileJs=de,te.exports.fromGeojsonVt=function(bt,pt){pt=pt||{};var We={};for(var hr in bt)We[hr]=new ce(bt[hr].features,pt),We[hr].name=hr,We[hr].version=pt.version,We[hr].extent=pt.extent;return de({layers:We})},te.exports.GeoJSONWrapper=ce,te.exports}(),me=a.cy(J);const xe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Be=>Be},se=Math.fround||(oe=new Float32Array(1),Be=>(oe[0]=+Be,oe[0]));var oe;const ve=3,ge=5,Je=6;class Ge{constructor(ce){this.options=Object.assign(Object.create(xe),ce),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ce){const{log:de,minZoom:_e,maxZoom:Ue}=this.options;de&&console.time("total time");const je=`prepare ${ce.length} points`;de&&console.time(je),this.points=ce;const lt=[];for(let Ze=0;Ze<ce.length;Ze++){const ht=ce[Ze];if(!ht.geometry)continue;const[bt,pt]=ht.geometry.coordinates,We=se(ct(bt)),hr=se(At(pt));lt.push(We,hr,1/0,Ze,-1,1),this.options.reduce&&lt.push(0)}let dt=this.trees[Ue+1]=this._createTree(lt);de&&console.timeEnd(je);for(let Ze=Ue;Ze>=_e;Ze--){const ht=+Date.now();dt=this.trees[Ze]=this._createTree(this._cluster(dt,Ze)),de&&console.log("z%d: %d clusters in %dms",Ze,dt.numItems,+Date.now()-ht)}return de&&console.timeEnd("total time"),this}getClusters(ce,de){let _e=((ce[0]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,ce[1]));let je=ce[2]===180?180:((ce[2]+180)%360+360)%360-180;const lt=Math.max(-90,Math.min(90,ce[3]));if(ce[2]-ce[0]>=360)_e=-180,je=180;else if(_e>je){const pt=this.getClusters([_e,Ue,180,lt],de),We=this.getClusters([-180,Ue,je,lt],de);return pt.concat(We)}const dt=this.trees[this._limitZoom(de)],Ze=dt.range(ct(_e),At(lt),ct(je),At(Ue)),ht=dt.data,bt=[];for(const pt of Ze){const We=this.stride*pt;bt.push(ht[We+ge]>1?et(ht,We,this.clusterProps):this.points[ht[We+ve]])}return bt}getChildren(ce){const de=this._getOriginId(ce),_e=this._getOriginZoom(ce),Ue="No cluster with the specified id.",je=this.trees[_e];if(!je)throw new Error(Ue);const lt=je.data;if(de*this.stride>=lt.length)throw new Error(Ue);const dt=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),Ze=je.within(lt[de*this.stride],lt[de*this.stride+1],dt),ht=[];for(const bt of Ze){const pt=bt*this.stride;lt[pt+4]===ce&&ht.push(lt[pt+ge]>1?et(lt,pt,this.clusterProps):this.points[lt[pt+ve]])}if(ht.length===0)throw new Error(Ue);return ht}getLeaves(ce,de,_e){const Ue=[];return this._appendLeaves(Ue,ce,de=de||10,_e=_e||0,0),Ue}getTile(ce,de,_e){const Ue=this.trees[this._limitZoom(ce)],je=Math.pow(2,ce),{extent:lt,radius:dt}=this.options,Ze=dt/lt,ht=(_e-Ze)/je,bt=(_e+1+Ze)/je,pt={features:[]};return this._addTileFeatures(Ue.range((de-Ze)/je,ht,(de+1+Ze)/je,bt),Ue.data,de,_e,je,pt),de===0&&this._addTileFeatures(Ue.range(1-Ze/je,ht,1,bt),Ue.data,je,_e,je,pt),de===je-1&&this._addTileFeatures(Ue.range(0,ht,Ze/je,bt),Ue.data,-1,_e,je,pt),pt.features.length?pt:null}getClusterExpansionZoom(ce){let de=this._getOriginZoom(ce)-1;for(;de<=this.options.maxZoom;){const _e=this.getChildren(ce);if(de++,_e.length!==1)break;ce=_e[0].properties.cluster_id}return de}_appendLeaves(ce,de,_e,Ue,je){const lt=this.getChildren(de);for(const dt of lt){const Ze=dt.properties;if(Ze&&Ze.cluster?je+Ze.point_count<=Ue?je+=Ze.point_count:je=this._appendLeaves(ce,Ze.cluster_id,_e,Ue,je):je<Ue?je++:ce.push(dt),ce.length===_e)break}return je}_createTree(ce){const de=new a.aA(ce.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _e=0;_e<ce.length;_e+=this.stride)de.add(ce[_e],ce[_e+1]);return de.finish(),de.data=ce,de}_addTileFeatures(ce,de,_e,Ue,je,lt){for(const dt of ce){const Ze=dt*this.stride,ht=de[Ze+ge]>1;let bt,pt,We;if(ht)bt=Ye(de,Ze,this.clusterProps),pt=de[Ze],We=de[Ze+1];else{const rr=this.points[de[Ze+ve]];bt=rr.properties;const[Nr,Rt]=rr.geometry.coordinates;pt=ct(Nr),We=At(Rt)}const hr={type:1,geometry:[[Math.round(this.options.extent*(pt*je-_e)),Math.round(this.options.extent*(We*je-Ue))]],tags:bt};let sr;sr=ht||this.options.generateId?de[Ze+ve]:this.points[de[Ze+ve]].id,sr!==void 0&&(hr.id=sr),lt.features.push(hr)}}_limitZoom(ce){return Math.max(this.options.minZoom,Math.min(Math.floor(+ce),this.options.maxZoom+1))}_cluster(ce,de){const{radius:_e,extent:Ue,reduce:je,minPoints:lt}=this.options,dt=_e/(Ue*Math.pow(2,de)),Ze=ce.data,ht=[],bt=this.stride;for(let pt=0;pt<Ze.length;pt+=bt){if(Ze[pt+2]<=de)continue;Ze[pt+2]=de;const We=Ze[pt],hr=Ze[pt+1],sr=ce.within(Ze[pt],Ze[pt+1],dt),rr=Ze[pt+ge];let Nr=rr;for(const Rt of sr){const ir=Rt*bt;Ze[ir+2]>de&&(Nr+=Ze[ir+ge])}if(Nr>rr&&Nr>=lt){let Rt,ir=We*rr,br=hr*rr,kr=-1;const en=((pt/bt|0)<<5)+(de+1)+this.points.length;for(const jr of sr){const Br=jr*bt;if(Ze[Br+2]<=de)continue;Ze[Br+2]=de;const Sn=Ze[Br+ge];ir+=Ze[Br]*Sn,br+=Ze[Br+1]*Sn,Ze[Br+4]=en,je&&(Rt||(Rt=this._map(Ze,pt,!0),kr=this.clusterProps.length,this.clusterProps.push(Rt)),je(Rt,this._map(Ze,Br)))}Ze[pt+4]=en,ht.push(ir/Nr,br/Nr,1/0,en,-1,Nr),je&&ht.push(kr)}else{for(let Rt=0;Rt<bt;Rt++)ht.push(Ze[pt+Rt]);if(Nr>1)for(const Rt of sr){const ir=Rt*bt;if(!(Ze[ir+2]<=de)){Ze[ir+2]=de;for(let br=0;br<bt;br++)ht.push(Ze[ir+br])}}}}return ht}_getOriginId(ce){return ce-this.points.length>>5}_getOriginZoom(ce){return(ce-this.points.length)%32}_map(ce,de,_e){if(ce[de+ge]>1){const lt=this.clusterProps[ce[de+Je]];return _e?Object.assign({},lt):lt}const Ue=this.points[ce[de+ve]].properties,je=this.options.map(Ue);return _e&&je===Ue?Object.assign({},je):je}}function et(Be,ce,de){return{type:"Feature",id:Be[ce+ve],properties:Ye(Be,ce,de),geometry:{type:"Point",coordinates:[(_e=Be[ce],360*(_e-.5)),kt(Be[ce+1])]}};var _e}function Ye(Be,ce,de){const _e=Be[ce+ge],Ue=_e>=1e4?`${Math.round(_e/1e3)}k`:_e>=1e3?Math.round(_e/100)/10+"k":_e,je=Be[ce+Je],lt=je===-1?{}:Object.assign({},de[je]);return Object.assign(lt,{cluster:!0,cluster_id:Be[ce+ve],point_count:_e,point_count_abbreviated:Ue})}function ct(Be){return Be/360+.5}function At(Be){const ce=Math.sin(Be*Math.PI/180),de=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return de<0?0:de>1?1:de}function kt(Be){const ce=(180-360*Be)*Math.PI/180;return 360*Math.atan(Math.exp(ce))/Math.PI-90}function ae(Be,ce,de,_e){let Ue=_e;const je=ce+(de-ce>>1);let lt,dt=de-ce;const Ze=Be[ce],ht=Be[ce+1],bt=Be[de],pt=Be[de+1];for(let We=ce+3;We<de;We+=3){const hr=Te(Be[We],Be[We+1],Ze,ht,bt,pt);if(hr>Ue)lt=We,Ue=hr;else if(hr===Ue){const sr=Math.abs(We-je);sr<dt&&(lt=We,dt=sr)}}Ue>_e&&(lt-ce>3&&ae(Be,ce,lt,_e),Be[lt+2]=Ue,de-lt>3&&ae(Be,lt,de,_e))}function Te(Be,ce,de,_e,Ue,je){let lt=Ue-de,dt=je-_e;if(lt!==0||dt!==0){const Ze=((Be-de)*lt+(ce-_e)*dt)/(lt*lt+dt*dt);Ze>1?(de=Ue,_e=je):Ze>0&&(de+=lt*Ze,_e+=dt*Ze)}return lt=Be-de,dt=ce-_e,lt*lt+dt*dt}function Le(Be,ce,de,_e){const Ue={id:Be??null,type:ce,geometry:de,tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")De(Ue,de);else if(ce==="Polygon")De(Ue,de[0]);else if(ce==="MultiLineString")for(const je of de)De(Ue,je);else if(ce==="MultiPolygon")for(const je of de)De(Ue,je[0]);return Ue}function De(Be,ce){for(let de=0;de<ce.length;de+=3)Be.minX=Math.min(Be.minX,ce[de]),Be.minY=Math.min(Be.minY,ce[de+1]),Be.maxX=Math.max(Be.maxX,ce[de]),Be.maxY=Math.max(Be.maxY,ce[de+1])}function at(Be,ce,de,_e){if(!ce.geometry)return;const Ue=ce.geometry.coordinates;if(Ue&&Ue.length===0)return;const je=ce.geometry.type,lt=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2);let dt=[],Ze=ce.id;if(de.promoteId?Ze=ce.properties[de.promoteId]:de.generateId&&(Ze=_e||0),je==="Point")rt(Ue,dt);else if(je==="MultiPoint")for(const ht of Ue)rt(ht,dt);else if(je==="LineString")xt(Ue,dt,lt,!1);else if(je==="MultiLineString"){if(de.lineMetrics){for(const ht of Ue)dt=[],xt(ht,dt,lt,!1),Be.push(Le(Ze,"LineString",dt,ce.properties));return}vt(Ue,dt,lt,!1)}else if(je==="Polygon")vt(Ue,dt,lt,!0);else{if(je!=="MultiPolygon"){if(je==="GeometryCollection"){for(const ht of ce.geometry.geometries)at(Be,{id:Ze,geometry:ht,properties:ce.properties},de,_e);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ht of Ue){const bt=[];vt(ht,bt,lt,!0),dt.push(bt)}}Be.push(Le(Ze,je,dt,ce.properties))}function rt(Be,ce){ce.push(nr(Be[0]),qt(Be[1]),0)}function xt(Be,ce,de,_e){let Ue,je,lt=0;for(let Ze=0;Ze<Be.length;Ze++){const ht=nr(Be[Ze][0]),bt=qt(Be[Ze][1]);ce.push(ht,bt,0),Ze>0&&(lt+=_e?(Ue*bt-ht*je)/2:Math.sqrt(Math.pow(ht-Ue,2)+Math.pow(bt-je,2))),Ue=ht,je=bt}const dt=ce.length-3;ce[2]=1,ae(ce,0,dt,de),ce[dt+2]=1,ce.size=Math.abs(lt),ce.start=0,ce.end=ce.size}function vt(Be,ce,de,_e){for(let Ue=0;Ue<Be.length;Ue++){const je=[];xt(Be[Ue],je,de,_e),ce.push(je)}}function nr(Be){return Be/360+.5}function qt(Be){const ce=Math.sin(Be*Math.PI/180),de=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return de<0?0:de>1?1:de}function or(Be,ce,de,_e,Ue,je,lt,dt){if(_e/=ce,je>=(de/=ce)&&lt<_e)return Be;if(lt<de||je>=_e)return null;const Ze=[];for(const ht of Be){const bt=ht.geometry;let pt=ht.type;const We=Ue===0?ht.minX:ht.minY,hr=Ue===0?ht.maxX:ht.maxY;if(We>=de&&hr<_e){Ze.push(ht);continue}if(hr<de||We>=_e)continue;let sr=[];if(pt==="Point"||pt==="MultiPoint")gr(bt,sr,de,_e,Ue);else if(pt==="LineString")wr(bt,sr,de,_e,Ue,!1,dt.lineMetrics);else if(pt==="MultiLineString")ze(bt,sr,de,_e,Ue,!1);else if(pt==="Polygon")ze(bt,sr,de,_e,Ue,!0);else if(pt==="MultiPolygon")for(const rr of bt){const Nr=[];ze(rr,Nr,de,_e,Ue,!0),Nr.length&&sr.push(Nr)}if(sr.length){if(dt.lineMetrics&&pt==="LineString"){for(const rr of sr)Ze.push(Le(ht.id,pt,rr,ht.tags));continue}pt!=="LineString"&&pt!=="MultiLineString"||(sr.length===1?(pt="LineString",sr=sr[0]):pt="MultiLineString"),pt!=="Point"&&pt!=="MultiPoint"||(pt=sr.length===3?"Point":"MultiPoint"),Ze.push(Le(ht.id,pt,sr,ht.tags))}}return Ze.length?Ze:null}function gr(Be,ce,de,_e,Ue){for(let je=0;je<Be.length;je+=3){const lt=Be[je+Ue];lt>=de&&lt<=_e&&$r(ce,Be[je],Be[je+1],Be[je+2])}}function wr(Be,ce,de,_e,Ue,je,lt){let dt=Ot(Be);const Ze=Ue===0?Rr:Jt;let ht,bt,pt=Be.start;for(let Nr=0;Nr<Be.length-3;Nr+=3){const Rt=Be[Nr],ir=Be[Nr+1],br=Be[Nr+2],kr=Be[Nr+3],en=Be[Nr+4],jr=Ue===0?Rt:ir,Br=Ue===0?kr:en;let Sn=!1;lt&&(ht=Math.sqrt(Math.pow(Rt-kr,2)+Math.pow(ir-en,2))),jr<de?Br>de&&(bt=Ze(dt,Rt,ir,kr,en,de),lt&&(dt.start=pt+ht*bt)):jr>_e?Br<_e&&(bt=Ze(dt,Rt,ir,kr,en,_e),lt&&(dt.start=pt+ht*bt)):$r(dt,Rt,ir,br),Br<de&&jr>=de&&(bt=Ze(dt,Rt,ir,kr,en,de),Sn=!0),Br>_e&&jr<=_e&&(bt=Ze(dt,Rt,ir,kr,en,_e),Sn=!0),!je&&Sn&&(lt&&(dt.end=pt+ht*bt),ce.push(dt),dt=Ot(Be)),lt&&(pt+=ht)}let We=Be.length-3;const hr=Be[We],sr=Be[We+1],rr=Ue===0?hr:sr;rr>=de&&rr<=_e&&$r(dt,hr,sr,Be[We+2]),We=dt.length-3,je&&We>=3&&(dt[We]!==dt[0]||dt[We+1]!==dt[1])&&$r(dt,dt[0],dt[1],dt[2]),dt.length&&ce.push(dt)}function Ot(Be){const ce=[];return ce.size=Be.size,ce.start=Be.start,ce.end=Be.end,ce}function ze(Be,ce,de,_e,Ue,je){for(const lt of Be)wr(lt,ce,de,_e,Ue,je,!1)}function $r(Be,ce,de,_e){Be.push(ce,de,_e)}function Rr(Be,ce,de,_e,Ue,je){const lt=(je-ce)/(_e-ce);return $r(Be,je,de+(Ue-de)*lt,1),lt}function Jt(Be,ce,de,_e,Ue,je){const lt=(je-de)/(Ue-de);return $r(Be,ce+(_e-ce)*lt,je,1),lt}function tr(Be,ce){const de=[];for(let _e=0;_e<Be.length;_e++){const Ue=Be[_e],je=Ue.type;let lt;if(je==="Point"||je==="MultiPoint"||je==="LineString")lt=mr(Ue.geometry,ce);else if(je==="MultiLineString"||je==="Polygon"){lt=[];for(const dt of Ue.geometry)lt.push(mr(dt,ce))}else if(je==="MultiPolygon"){lt=[];for(const dt of Ue.geometry){const Ze=[];for(const ht of dt)Ze.push(mr(ht,ce));lt.push(Ze)}}de.push(Le(Ue.id,je,lt,Ue.tags))}return de}function mr(Be,ce){const de=[];de.size=Be.size,Be.start!==void 0&&(de.start=Be.start,de.end=Be.end);for(let _e=0;_e<Be.length;_e+=3)de.push(Be[_e]+ce,Be[_e+1],Be[_e+2]);return de}function _r(Be,ce){if(Be.transformed)return Be;const de=1<<Be.z,_e=Be.x,Ue=Be.y;for(const je of Be.features){const lt=je.geometry,dt=je.type;if(je.geometry=[],dt===1)for(let Ze=0;Ze<lt.length;Ze+=2)je.geometry.push(Ut(lt[Ze],lt[Ze+1],ce,de,_e,Ue));else for(let Ze=0;Ze<lt.length;Ze++){const ht=[];for(let bt=0;bt<lt[Ze].length;bt+=2)ht.push(Ut(lt[Ze][bt],lt[Ze][bt+1],ce,de,_e,Ue));je.geometry.push(ht)}}return Be.transformed=!0,Be}function Ut(Be,ce,de,_e,Ue,je){return[Math.round(de*(Be*_e-Ue)),Math.round(de*(ce*_e-je))]}function ar(Be,ce,de,_e,Ue){const je=ce===Ue.maxZoom?0:Ue.tolerance/((1<<ce)*Ue.extent),lt={features:[],numPoints:0,numSimplified:0,numFeatures:Be.length,source:null,x:de,y:_e,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const dt of Be)Sr(lt,dt,je,Ue);return lt}function Sr(Be,ce,de,_e){const Ue=ce.geometry,je=ce.type,lt=[];if(Be.minX=Math.min(Be.minX,ce.minX),Be.minY=Math.min(Be.minY,ce.minY),Be.maxX=Math.max(Be.maxX,ce.maxX),Be.maxY=Math.max(Be.maxY,ce.maxY),je==="Point"||je==="MultiPoint")for(let dt=0;dt<Ue.length;dt+=3)lt.push(Ue[dt],Ue[dt+1]),Be.numPoints++,Be.numSimplified++;else if(je==="LineString")Er(lt,Ue,Be,de,!1,!1);else if(je==="MultiLineString"||je==="Polygon")for(let dt=0;dt<Ue.length;dt++)Er(lt,Ue[dt],Be,de,je==="Polygon",dt===0);else if(je==="MultiPolygon")for(let dt=0;dt<Ue.length;dt++){const Ze=Ue[dt];for(let ht=0;ht<Ze.length;ht++)Er(lt,Ze[ht],Be,de,!0,ht===0)}if(lt.length){let dt=ce.tags||null;if(je==="LineString"&&_e.lineMetrics){dt={};for(const ht in ce.tags)dt[ht]=ce.tags[ht];dt.mapbox_clip_start=Ue.start/Ue.size,dt.mapbox_clip_end=Ue.end/Ue.size}const Ze={geometry:lt,type:je==="Polygon"||je==="MultiPolygon"?3:je==="LineString"||je==="MultiLineString"?2:1,tags:dt};ce.id!==null&&(Ze.id=ce.id),Be.features.push(Ze)}}function Er(Be,ce,de,_e,Ue,je){const lt=_e*_e;if(_e>0&&ce.size<(Ue?lt:_e))return void(de.numPoints+=ce.length/3);const dt=[];for(let Ze=0;Ze<ce.length;Ze+=3)(_e===0||ce[Ze+2]>lt)&&(de.numSimplified++,dt.push(ce[Ze],ce[Ze+1])),de.numPoints++;Ue&&function(Ze,ht){let bt=0;for(let pt=0,We=Ze.length,hr=We-2;pt<We;hr=pt,pt+=2)bt+=(Ze[pt]-Ze[hr])*(Ze[pt+1]+Ze[hr+1]);if(bt>0===ht)for(let pt=0,We=Ze.length;pt<We/2;pt+=2){const hr=Ze[pt],sr=Ze[pt+1];Ze[pt]=Ze[We-2-pt],Ze[pt+1]=Ze[We-1-pt],Ze[We-2-pt]=hr,Ze[We-1-pt]=sr}}(dt,je),Be.push(dt)}const Dr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class nn{constructor(ce,de){const _e=(de=this.options=function(je,lt){for(const dt in lt)je[dt]=lt[dt];return je}(Object.create(Dr),de)).debug;if(_e&&console.time("preprocess data"),de.maxZoom<0||de.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(de.promoteId&&de.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ue=function(je,lt){const dt=[];if(je.type==="FeatureCollection")for(let Ze=0;Ze<je.features.length;Ze++)at(dt,je.features[Ze],lt,Ze);else at(dt,je.type==="Feature"?je:{geometry:je},lt);return dt}(ce,de);this.tiles={},this.tileCoords=[],_e&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",de.indexMaxZoom,de.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ue=function(je,lt){const dt=lt.buffer/lt.extent;let Ze=je;const ht=or(je,1,-1-dt,dt,0,-1,2,lt),bt=or(je,1,1-dt,2+dt,0,-1,2,lt);return(ht||bt)&&(Ze=or(je,1,-dt,1+dt,0,-1,2,lt)||[],ht&&(Ze=tr(ht,1).concat(Ze)),bt&&(Ze=Ze.concat(tr(bt,-1)))),Ze}(Ue,de),Ue.length&&this.splitTile(Ue,0,0,0),_e&&(Ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ce,de,_e,Ue,je,lt,dt){const Ze=[ce,de,_e,Ue],ht=this.options,bt=ht.debug;for(;Ze.length;){Ue=Ze.pop(),_e=Ze.pop(),de=Ze.pop(),ce=Ze.pop();const pt=1<<de,We=Hr(de,_e,Ue);let hr=this.tiles[We];if(!hr&&(bt>1&&console.time("creation"),hr=this.tiles[We]=ar(ce,de,_e,Ue,ht),this.tileCoords.push({z:de,x:_e,y:Ue}),bt)){bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",de,_e,Ue,hr.numFeatures,hr.numPoints,hr.numSimplified),console.timeEnd("creation"));const Sn=`z${de}`;this.stats[Sn]=(this.stats[Sn]||0)+1,this.total++}if(hr.source=ce,je==null){if(de===ht.indexMaxZoom||hr.numPoints<=ht.indexMaxPoints)continue}else{if(de===ht.maxZoom||de===je)continue;if(je!=null){const Sn=je-de;if(_e!==lt>>Sn||Ue!==dt>>Sn)continue}}if(hr.source=null,ce.length===0)continue;bt>1&&console.time("clipping");const sr=.5*ht.buffer/ht.extent,rr=.5-sr,Nr=.5+sr,Rt=1+sr;let ir=null,br=null,kr=null,en=null,jr=or(ce,pt,_e-sr,_e+Nr,0,hr.minX,hr.maxX,ht),Br=or(ce,pt,_e+rr,_e+Rt,0,hr.minX,hr.maxX,ht);ce=null,jr&&(ir=or(jr,pt,Ue-sr,Ue+Nr,1,hr.minY,hr.maxY,ht),br=or(jr,pt,Ue+rr,Ue+Rt,1,hr.minY,hr.maxY,ht),jr=null),Br&&(kr=or(Br,pt,Ue-sr,Ue+Nr,1,hr.minY,hr.maxY,ht),en=or(Br,pt,Ue+rr,Ue+Rt,1,hr.minY,hr.maxY,ht),Br=null),bt>1&&console.timeEnd("clipping"),Ze.push(ir||[],de+1,2*_e,2*Ue),Ze.push(br||[],de+1,2*_e,2*Ue+1),Ze.push(kr||[],de+1,2*_e+1,2*Ue),Ze.push(en||[],de+1,2*_e+1,2*Ue+1)}}getTile(ce,de,_e){ce=+ce,de=+de,_e=+_e;const Ue=this.options,{extent:je,debug:lt}=Ue;if(ce<0||ce>24)return null;const dt=1<<ce,Ze=Hr(ce,de=de+dt&dt-1,_e);if(this.tiles[Ze])return _r(this.tiles[Ze],je);lt>1&&console.log("drilling down to z%d-%d-%d",ce,de,_e);let ht,bt=ce,pt=de,We=_e;for(;!ht&&bt>0;)bt--,pt>>=1,We>>=1,ht=this.tiles[Hr(bt,pt,We)];return ht&&ht.source?(lt>1&&(console.log("found parent tile z%d-%d-%d",bt,pt,We),console.time("drilling down")),this.splitTile(ht.source,bt,pt,We,ce,de,_e),lt>1&&console.timeEnd("drilling down"),this.tiles[Ze]?_r(this.tiles[Ze],je):null):null}}function Hr(Be,ce,de){return 32*((1<<Be)*de+ce)+Be}function Wr(Be,ce){return ce?Be.properties[ce]:Be.id}function vr(Be,ce){if(Be==null)return!0;if(Be.type==="Feature")return Wr(Be,ce)!=null;if(Be.type==="FeatureCollection"){const de=new Set;for(const _e of Be.features){const Ue=Wr(_e,ce);if(Ue==null||de.has(Ue))return!1;de.add(Ue)}return!0}return!1}function Qn(Be,ce){const de=new Map;if(Be!=null)if(Be.type==="Feature")de.set(Wr(Be,ce),Be);else for(const _e of Be.features)de.set(Wr(_e,ce),_e);return de}class un extends _{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ce,de){return a._(this,void 0,void 0,function*(){const _e=ce.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Ue=this._geoJSONIndex.getTile(_e.z,_e.x,_e.y);if(!Ue)return null;const je=new W(Ue.features);let lt=me(je);return lt.byteOffset===0&&lt.byteLength===lt.buffer.byteLength||(lt=new Uint8Array(lt)),{vectorTile:je,rawData:lt.buffer}})}loadData(ce){return a._(this,void 0,void 0,function*(){var de;(de=this._pendingRequest)===null||de===void 0||de.abort();const _e=!!(ce&&ce.request&&ce.request.collectResourceTiming)&&new a.cv(ce.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ce,this._pendingRequest),this._geoJSONIndex=ce.cluster?new Ge(function(lt){let{superclusterOptions:dt,clusterProperties:Ze}=lt;if(!Ze||!dt)return dt;const ht={},bt={},pt={accumulated:null,zoom:0},We={properties:null},hr=Object.keys(Ze);for(const sr of hr){const[rr,Nr]=Ze[sr],Rt=a.cC(Nr),ir=a.cC(typeof rr=="string"?[rr,["accumulated"],["get",sr]]:rr);ht[sr]=Rt.value,bt[sr]=ir.value}return dt.map=sr=>{We.properties=sr;const rr={};for(const Nr of hr)rr[Nr]=ht[Nr].evaluate(pt,We);return rr},dt.reduce=(sr,rr)=>{We.properties=rr;for(const Nr of hr)pt.accumulated=sr[Nr],sr[Nr]=bt[Nr].evaluate(pt,We)},dt}(ce)).load((yield this._pendingData).features):(Ue=yield this._pendingData,new nn(Ue,ce.geojsonVtOptions)),this.loaded={};const je={};if(_e){const lt=_e.finish();lt&&(je.resourceTiming={},je.resourceTiming[ce.source]=JSON.parse(JSON.stringify(lt)))}return je}catch(je){if(delete this._pendingRequest,a.cg(je))return{abandoned:!0};throw je}var Ue})}getData(){return a._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(ce){const de=this.loaded;return de&&de[ce.uid]?super.reloadTile(ce):this.loadTile(ce)}loadAndProcessGeoJSON(ce,de){return a._(this,void 0,void 0,function*(){let _e=yield this.loadGeoJSON(ce,de);if(delete this._pendingRequest,typeof _e!="object")throw new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`);if(D(_e,!0),ce.filter){const Ue=a.cC(ce.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map(lt=>`${lt.key}: ${lt.message}`).join(", "));_e={type:"FeatureCollection",features:_e.features.filter(lt=>Ue.value.evaluate({zoom:0},lt))}}return _e})}loadGeoJSON(ce,de){return a._(this,void 0,void 0,function*(){const{promoteId:_e}=ce;if(ce.request){const Ue=yield a.h(ce.request,de);return this._dataUpdateable=vr(Ue.data,_e)?Qn(Ue.data,_e):void 0,Ue.data}if(typeof ce.data=="string")try{const Ue=JSON.parse(ce.data);return this._dataUpdateable=vr(Ue,_e)?Qn(Ue,_e):void 0,Ue}catch{throw new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`)}if(!ce.dataDiff)throw new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ce.source}`);return function(Ue,je,lt){var dt,Ze,ht,bt;if(je.removeAll&&Ue.clear(),je.remove)for(const pt of je.remove)Ue.delete(pt);if(je.add)for(const pt of je.add){const We=Wr(pt,lt);We!=null&&Ue.set(We,pt)}if(je.update)for(const pt of je.update){let We=Ue.get(pt.id);if(We==null)continue;const hr=!pt.removeAllProperties&&(((dt=pt.removeProperties)===null||dt===void 0?void 0:dt.length)>0||((Ze=pt.addOrUpdateProperties)===null||Ze===void 0?void 0:Ze.length)>0);if((pt.newGeometry||pt.removeAllProperties||hr)&&(We=Object.assign({},We),Ue.set(pt.id,We),hr&&(We.properties=Object.assign({},We.properties))),pt.newGeometry&&(We.geometry=pt.newGeometry),pt.removeAllProperties)We.properties={};else if(((ht=pt.removeProperties)===null||ht===void 0?void 0:ht.length)>0)for(const sr of pt.removeProperties)Object.prototype.hasOwnProperty.call(We.properties,sr)&&delete We.properties[sr];if(((bt=pt.addOrUpdateProperties)===null||bt===void 0?void 0:bt.length)>0)for(const{key:sr,value:rr}of pt.addOrUpdateProperties)We.properties[sr]=rr}}(this._dataUpdateable,ce.dataDiff,_e),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ce){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ce){return this._geoJSONIndex.getClusterExpansionZoom(ce.clusterId)}getClusterChildren(ce){return this._geoJSONIndex.getChildren(ce.clusterId)}getClusterLeaves(ce){return this._geoJSONIndex.getLeaves(ce.clusterId,ce.limit,ce.offset)}}class ni{constructor(ce){this.self=ce,this.actor=new a.G(ce),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(de,_e)=>{if(this.externalWorkerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.externalWorkerSourceTypes[de]=_e},this.self.addProtocol=a.ci,this.self.removeProtocol=a.cj,this.self.registerRTLTextPlugin=de=>{a.cD.setMethods(de)},this.actor.registerMessageHandler("LDT",(de,_e)=>this._getDEMWorkerSource(de,_e.source).loadTile(_e)),this.actor.registerMessageHandler("RDT",(de,_e)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(de,_e.source).removeTile(_e)})),this.actor.registerMessageHandler("GCEZ",(de,_e)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(de,_e.type,_e.source).getClusterExpansionZoom(_e)})),this.actor.registerMessageHandler("GCC",(de,_e)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(de,_e.type,_e.source).getClusterChildren(_e)})),this.actor.registerMessageHandler("GCL",(de,_e)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(de,_e.type,_e.source).getClusterLeaves(_e)})),this.actor.registerMessageHandler("LD",(de,_e)=>this._getWorkerSource(de,_e.type,_e.source).loadData(_e)),this.actor.registerMessageHandler("GD",(de,_e)=>this._getWorkerSource(de,_e.type,_e.source).getData()),this.actor.registerMessageHandler("LT",(de,_e)=>this._getWorkerSource(de,_e.type,_e.source).loadTile(_e)),this.actor.registerMessageHandler("RT",(de,_e)=>this._getWorkerSource(de,_e.type,_e.source).reloadTile(_e)),this.actor.registerMessageHandler("AT",(de,_e)=>this._getWorkerSource(de,_e.type,_e.source).abortTile(_e)),this.actor.registerMessageHandler("RMT",(de,_e)=>this._getWorkerSource(de,_e.type,_e.source).removeTile(_e)),this.actor.registerMessageHandler("RS",(de,_e)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[de]||!this.workerSources[de][_e.type]||!this.workerSources[de][_e.type][_e.source])return;const Ue=this.workerSources[de][_e.type][_e.source];delete this.workerSources[de][_e.type][_e.source],Ue.removeSource!==void 0&&Ue.removeSource(_e)})),this.actor.registerMessageHandler("RM",de=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[de],delete this.availableImages[de],delete this.workerSources[de],delete this.demWorkerSources[de]})),this.actor.registerMessageHandler("SR",(de,_e)=>a._(this,void 0,void 0,function*(){this.referrer=_e})),this.actor.registerMessageHandler("SRPS",(de,_e)=>this._syncRTLPluginState(de,_e)),this.actor.registerMessageHandler("IS",(de,_e)=>a._(this,void 0,void 0,function*(){this.self.importScripts(_e)})),this.actor.registerMessageHandler("SI",(de,_e)=>this._setImages(de,_e)),this.actor.registerMessageHandler("UL",(de,_e)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(de).update(_e.layers,_e.removedIds)})),this.actor.registerMessageHandler("SL",(de,_e)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(de).replace(_e)}))}_setImages(ce,de){return a._(this,void 0,void 0,function*(){this.availableImages[ce]=de;for(const _e in this.workerSources[ce]){const Ue=this.workerSources[ce][_e];for(const je in Ue)Ue[je].availableImages=de}})}_syncRTLPluginState(ce,de){return a._(this,void 0,void 0,function*(){return yield a.cD.syncState(de,this.self.importScripts)})}_getAvailableImages(ce){let de=this.availableImages[ce];return de||(de=[]),de}_getLayerIndex(ce){let de=this.layerIndexes[ce];return de||(de=this.layerIndexes[ce]=new o),de}_getWorkerSource(ce,de,_e){if(this.workerSources[ce]||(this.workerSources[ce]={}),this.workerSources[ce][de]||(this.workerSources[ce][de]={}),!this.workerSources[ce][de][_e]){const Ue={sendAsync:(je,lt)=>(je.targetMapId=ce,this.actor.sendAsync(je,lt))};switch(de){case"vector":this.workerSources[ce][de][_e]=new _(Ue,this._getLayerIndex(ce),this._getAvailableImages(ce));break;case"geojson":this.workerSources[ce][de][_e]=new un(Ue,this._getLayerIndex(ce),this._getAvailableImages(ce));break;default:this.workerSources[ce][de][_e]=new this.externalWorkerSourceTypes[de](Ue,this._getLayerIndex(ce),this._getAvailableImages(ce))}}return this.workerSources[ce][de][_e]}_getDEMWorkerSource(ce,de){return this.demWorkerSources[ce]||(this.demWorkerSources[ce]={}),this.demWorkerSources[ce][de]||(this.demWorkerSources[ce][de]=new w),this.demWorkerSources[ce][de]}}return a.i(self)&&(self.worker=new ni(self)),ni}),i("index",["exports","./shared"],function(a,o){var u="5.1.1";function d(){var x=new o.A(4);return o.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}let p,_;const w={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(x,l,h){const m=requestAnimationFrame(l);x.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),h(o.c())})},frameAsync(x){return new Promise((l,h)=>{this.frame(x,l,h)})},getImageData(x){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(x).getImageData(-l,-l,x.width+2*l,x.height+2*l)},getImageCanvasContext(x){const l=window.document.createElement("canvas"),h=l.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return l.width=x.width,l.height=x.height,h.drawImage(x,0,0,x.width,x.height),h},resolveURL:x=>(p||(p=document.createElement("a")),p.href=x,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(_==null&&(_=matchMedia("(prefers-reduced-motion: reduce)")),_.matches)}};class v{static testProp(l){if(!v.docStyle)return l[0];for(let h=0;h<l.length;h++)if(l[h]in v.docStyle)return l[h];return l[0]}static create(l,h,m){const y=window.document.createElement(l);return h!==void 0&&(y.className=h),m&&m.appendChild(y),y}static createNS(l,h){return window.document.createElementNS(l,h)}static disableDrag(){v.docStyle&&v.selectProp&&(v.userSelect=v.docStyle[v.selectProp],v.docStyle[v.selectProp]="none")}static enableDrag(){v.docStyle&&v.selectProp&&(v.docStyle[v.selectProp]=v.userSelect)}static setTransform(l,h){l.style[v.transformProp]=h}static addEventListener(l,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.addEventListener(h,m,"passive"in y?y:y.capture)}static removeEventListener(l,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.removeEventListener(h,m,"passive"in y?y:y.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",v.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",v.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",v.suppressClickInternal,!0)},0)}static getScale(l){const h=l.getBoundingClientRect();return{x:h.width/l.offsetWidth||1,y:h.height/l.offsetHeight||1,boundingClientRect:h}}static getPoint(l,h,m){const y=h.boundingClientRect;return new o.P((m.clientX-y.left)/h.x-l.clientLeft,(m.clientY-y.top)/h.y-l.clientTop)}static mousePos(l,h){const m=v.getScale(l);return v.getPoint(l,m,h)}static touchPos(l,h){const m=[],y=v.getScale(l);for(let C=0;C<h.length;C++)m.push(v.getPoint(l,y,h[C]));return m}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}static sanitize(l){const h=new DOMParser().parseFromString(l,"text/html").body||document.createElement("body"),m=h.querySelectorAll("script");for(const y of m)y.remove();return v.clean(h),h.innerHTML}static isPossiblyDangerous(l,h){const m=h.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(l)||!m.includes("javascript:")&&!m.includes("data:"))||!!l.startsWith("on")||void 0}static clean(l){const h=l.children;for(const m of h)v.removeAttributes(m),v.clean(m)}static removeAttributes(l){for(const{name:h,value:m}of l.attributes)v.isPossiblyDangerous(h,m)&&l.removeAttribute(h)}}v.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,v.selectProp=v.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),v.transformProp=v.testProp(["transform","WebkitTransform"]);const M={supported:!1,testSupport:function(x){!N&&D&&(z?W(x):P=x)}};let P,D,N=!1,z=!1;function W(x){const l=x.createTexture();x.bindTexture(x.TEXTURE_2D,l);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,D),x.isContextLost())return;M.supported=!0}catch{}x.deleteTexture(l),N=!0}var V;typeof document<"u"&&(D=document.createElement("img"),D.onload=()=>{P&&W(P),P=null,z=!0},D.onerror=()=>{N=!0,P=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(x){let l,h,m,y;x.resetRequestQueue=()=>{l=[],h=0,m=0,y={}},x.addThrottleControl=O=>{const Q=m++;return y[Q]=O,Q},x.removeThrottleControl=O=>{delete y[O],S()},x.getImage=function(O,Q){let K=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((Z,ee)=>{M.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),o.e(O,{type:"image"}),l.push({abortController:Q,requestParameters:O,supportImageRefresh:K,state:"queued",onError:Ae=>{ee(Ae)},onSuccess:Ae=>{Z(Ae)}}),S()})};const C=O=>o._(this,void 0,void 0,function*(){O.state="running";const{requestParameters:Q,supportImageRefresh:K,onError:Z,onSuccess:ee,abortController:Ae}=O,pe=K===!1&&!o.i(self)&&!o.g(Q.url)&&(!Q.headers||Object.keys(Q.headers).reduce((Re,Ne)=>Re&&Ne==="accept",!0));h++;const Fe=pe?R(Q,Ae):o.m(Q,Ae);try{const Re=yield Fe;delete O.abortController,O.state="completed",Re.data instanceof HTMLImageElement||o.b(Re.data)?ee(Re):Re.data&&ee({data:yield(Me=Re.data,typeof createImageBitmap=="function"?o.d(Me):o.f(Me)),cacheControl:Re.cacheControl,expires:Re.expires})}catch(Re){delete O.abortController,Z(Re)}finally{h--,S()}var Me}),S=()=>{const O=(()=>{for(const Q of Object.keys(y))if(y[Q]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Q=h;Q<O&&l.length>0;Q++){const K=l.shift();K.abortController.signal.aborted?Q--:C(K)}},R=(O,Q)=>new Promise((K,Z)=>{const ee=new Image,Ae=O.url,pe=O.credentials;pe&&pe==="include"?ee.crossOrigin="use-credentials":(pe&&pe==="same-origin"||!o.s(Ae))&&(ee.crossOrigin="anonymous"),Q.signal.addEventListener("abort",()=>{ee.src="",Z(o.c())}),ee.fetchPriority="high",ee.onload=()=>{ee.onerror=ee.onload=null,K({data:ee})},ee.onerror=()=>{ee.onerror=ee.onload=null,Q.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ee.src=Ae})}(V||(V={})),V.resetRequestQueue();class ${constructor(l){this._transformRequestFn=l}transformRequest(l,h){return this._transformRequestFn&&this._transformRequestFn(l,h)||{url:l}}setTransformRequest(l){this._transformRequestFn=l}}function q(x){const l=[];if(typeof x=="string")l.push({id:"default",url:x});else if(x&&x.length>0){const h=[];for(const{id:m,url:y}of x){const C=`${m}${y}`;h.indexOf(C)===-1&&(h.push(C),l.push({id:m,url:y}))}}return l}function te(x,l,h){try{const m=new URL(x);return m.pathname+=`${l}${h}`,m.toString()}catch{throw new Error(`Invalid sprite URL "${x}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class J{constructor(l,h,m,y){this.context=l,this.format=m,this.texture=l.gl.createTexture(),this.update(h,y)}update(l,h,m){const{width:y,height:C}=l,S=!(this.size&&this.size[0]===y&&this.size[1]===C||m),{context:R}=this,{gl:O}=R;if(this.useMipmap=!!(h&&h.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!h||h.premultiply!==!1)),S)this.size=[y,C],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.b(l)?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,l):O.texImage2D(O.TEXTURE_2D,0,this.format,y,C,0,this.format,O.UNSIGNED_BYTE,l.data);else{const{x:Q,y:K}=m||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.b(l)?O.texSubImage2D(O.TEXTURE_2D,0,Q,K,O.RGBA,O.UNSIGNED_BYTE,l):O.texSubImage2D(O.TEXTURE_2D,0,Q,K,y,C,O.RGBA,O.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)}bind(l,h,m){const{context:y}=this,{gl:C}=y;C.bindTexture(C.TEXTURE_2D,this.texture),m!==C.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=C.LINEAR),l!==this.filter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,l),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,m||l),this.filter=l),h!==this.wrap&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,h),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function me(x){const{userImage:l}=x;return!!(l&&l.render&&l.render())&&(x.data.replace(new Uint8Array(l.data.buffer)),!0)}class xe extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:h,promiseResolve:m}of this.requestors)m(this._getImagesForIds(h));this.requestors=[]}}getImage(l){const h=this.images[l];if(h&&!h.data&&h.spriteData){const m=h.spriteData;h.data=new o.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),h.spriteData=null}return h}addImage(l,h){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,h)&&(this.images[l]=h)}_validate(l,h){let m=!0;const y=h.data||h.spriteData;return this._validateStretch(h.stretchX,y&&y.width)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchX" value`))),m=!1),this._validateStretch(h.stretchY,y&&y.height)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchY" value`))),m=!1),this._validateContent(h.content,h)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "content" value`))),m=!1),m}_validateStretch(l,h){if(!l)return!0;let m=0;for(const y of l){if(y[0]<m||y[1]<y[0]||h<y[1])return!1;m=y[1]}return!0}_validateContent(l,h){if(!l)return!0;if(l.length!==4)return!1;const m=h.spriteData,y=m&&m.width||h.data.width,C=m&&m.height||h.data.height;return!(l[0]<0||y<l[0]||l[1]<0||C<l[1]||l[2]<0||y<l[2]||l[3]<0||C<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const y=this.getImage(l);if(m&&(y.data.width!==h.data.width||y.data.height!==h.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=y.version+1,this.images[l]=h,this.updatedImages[l]=!0}removeImage(l){const h=this.images[l];delete this.images[l],delete this.patterns[l],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((h,m)=>{let y=!0;if(!this.isLoaded())for(const C of l)this.images[C]||(y=!1);this.isLoaded()||y?h(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:h})})}_getImagesForIds(l){const h={};for(const m of l){let y=this.getImage(m);y||(this.fire(new o.k("styleimagemissing",{id:m})),y=this.getImage(m)),y?h[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:o.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:l,height:h}=this.atlasImage;return{width:l,height:h}}getPattern(l){const h=this.patterns[l],m=this.getImage(l);if(!m)return null;if(h&&h.position.version===m.version)return h.position;if(h)h.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},C=new o.I(y,m);this.patterns[l]={bin:y,position:C}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const h=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new J(l,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const C in this.patterns)l.push(this.patterns[C].bin);const{w:h,h:m}=o.p(l),y=this.atlasImage;y.resize({width:h||1,height:m||1});for(const C in this.patterns){const{bin:S}=this.patterns[C],R=S.x+1,O=S.y+1,Q=this.getImage(C).data,K=Q.width,Z=Q.height;o.R.copy(Q,y,{x:0,y:0},{x:R,y:O},{width:K,height:Z}),o.R.copy(Q,y,{x:0,y:Z-1},{x:R,y:O-1},{width:K,height:1}),o.R.copy(Q,y,{x:0,y:0},{x:R,y:O+Z},{width:K,height:1}),o.R.copy(Q,y,{x:K-1,y:0},{x:R-1,y:O},{width:1,height:Z}),o.R.copy(Q,y,{x:0,y:0},{x:R+K,y:O},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const h of l){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const m=this.getImage(h);m||o.w(`Image with ID: "${h}" was not found`),me(m)&&this.updateImage(h,m)}}}const se=1e20;function oe(x,l,h,m,y,C,S,R,O){for(let Q=l;Q<l+m;Q++)ve(x,h*C+Q,C,y,S,R,O);for(let Q=h;Q<h+y;Q++)ve(x,Q*C+l,1,m,S,R,O)}function ve(x,l,h,m,y,C,S){C[0]=0,S[0]=-1e20,S[1]=se,y[0]=x[l];for(let R=1,O=0,Q=0;R<m;R++){y[R]=x[l+R*h];const K=R*R;do{const Z=C[O];Q=(y[R]-y[Z]+K-Z*Z)/(R-Z)/2}while(Q<=S[O]&&--O>-1);O++,C[O]=R,S[O]=Q,S[O+1]=se}for(let R=0,O=0;R<m;R++){for(;S[O+1]<R;)O++;const Q=C[O],K=R-Q;x[l+R*h]=y[Q]+K*K}}class ge{constructor(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return o._(this,void 0,void 0,function*(){const h=[];for(const C in l)for(const S of l[C])h.push(this._getAndCacheGlyphsPromise(C,S));const m=yield Promise.all(h),y={};for(const{stack:C,id:S,glyph:R}of m)y[C]||(y[C]={}),y[C][S]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return y})}_getAndCacheGlyphsPromise(l,h){return o._(this,void 0,void 0,function*(){let m=this.entries[l];m||(m=this.entries[l]={glyphs:{},requests:{},ranges:{}});let y=m.glyphs[h];if(y!==void 0)return{stack:l,id:h,glyph:y};if(y=this._tinySDF(m,l,h),y)return m.glyphs[h]=y,{stack:l,id:h,glyph:y};const C=Math.floor(h/256);if(256*C>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[C])return{stack:l,id:h,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[C]){const R=ge.loadGlyphRange(l,C,this.url,this.requestManager);m.requests[C]=R}const S=yield m.requests[C];for(const R in S)this._doesCharSupportLocalGlyph(+R)||(m.glyphs[+R]=S[+R]);return m.ranges[C]=!0,{stack:l,id:h,glyph:S[h]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(l))||o.u["CJK Unified Ideographs"](l)||o.u["Hangul Syllables"](l)||o.u.Hiragana(l)||o.u.Katakana(l)||o.u["CJK Symbols and Punctuation"](l)||o.u["Halfwidth and Fullwidth Forms"](l))}_tinySDF(l,h,m){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(m))return;let C=l.tinySDF;if(!C){let R="400";/bold/i.test(h)?R="900":/medium/i.test(h)?R="500":/light/i.test(h)&&(R="200"),C=l.tinySDF=new ge.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:R})}const S=C.draw(String.fromCharCode(m));return{id:m,bitmap:new o.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}ge.loadGlyphRange=function(x,l,h,m){return o._(this,void 0,void 0,function*(){const y=256*l,C=y+255,S=m.transformRequest(h.replace("{fontstack}",x).replace("{range}",`${y}-${C}`),"Glyphs"),R=yield o.l(S,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${l}, ${y}-${C}`);const O={};for(const Q of o.n(R.data))O[Q.id]=Q;return O})},ge.TinySDF=class{constructor(){let{fontSize:x=24,buffer:l=3,radius:h=8,cutoff:m=.25,fontFamily:y="sans-serif",fontWeight:C="normal",fontStyle:S="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=l,this.cutoff=m,this.radius=h;const R=this.size=x+4*l,O=this._createCanvas(R),Q=this.ctx=O.getContext("2d",{willReadFrequently:!0});Q.font=`${S} ${C} ${x}px ${y}`,Q.textBaseline="alphabetic",Q.textAlign="left",Q.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(x){const l=document.createElement("canvas");return l.width=l.height=x,l}draw(x){const{width:l,actualBoundingBoxAscent:h,actualBoundingBoxDescent:m,actualBoundingBoxLeft:y,actualBoundingBoxRight:C}=this.ctx.measureText(x),S=Math.ceil(h),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(C-y))),O=Math.min(this.size-this.buffer,S+Math.ceil(m)),Q=R+2*this.buffer,K=O+2*this.buffer,Z=Math.max(Q*K,0),ee=new Uint8ClampedArray(Z),Ae={data:ee,width:Q,height:K,glyphWidth:R,glyphHeight:O,glyphTop:S,glyphLeft:0,glyphAdvance:l};if(R===0||O===0)return Ae;const{ctx:pe,buffer:Fe,gridInner:Me,gridOuter:Re}=this;pe.clearRect(Fe,Fe,R,O),pe.fillText(x,Fe,Fe+S);const Ne=pe.getImageData(Fe,Fe,R,O);Re.fill(se,0,Z),Me.fill(0,0,Z);for(let $e=0;$e<O;$e++)for(let qe=0;qe<R;qe++){const Xe=Ne.data[4*($e*R+qe)+3]/255;if(Xe===0)continue;const tt=($e+Fe)*Q+qe+Fe;if(Xe===1)Re[tt]=0,Me[tt]=se;else{const it=.5-Xe;Re[tt]=it>0?it*it:0,Me[tt]=it<0?it*it:0}}oe(Re,0,0,Q,K,Q,this.f,this.v,this.z),oe(Me,Fe,Fe,R,O,Q,this.f,this.v,this.z);for(let $e=0;$e<Z;$e++){const qe=Math.sqrt(Re[$e])-Math.sqrt(Me[$e]);ee[$e]=Math.round(255-255*(qe/this.radius+this.cutoff))}return Ae}};class Je{constructor(){this.specification=o.v.light.position}possiblyEvaluate(l,h){return o.y(l.expression.evaluate(h))}interpolate(l,h,m){return{x:o.z.number(l.x,h.x,m),y:o.z.number(l.y,h.y,m),z:o.z.number(l.z,h.z,m)}}}let Ge;class et extends o.E{constructor(l){super(),Ge=Ge||new o.q({anchor:new o.D(o.v.light.anchor),position:new Je,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(Ge),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.r,l,h))for(const m in l){const y=l[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,m){return(!m||m.validate!==!1)&&o.t(this,l.call(o.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Ye=new o.q({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class ct extends o.E{constructor(l){super(),this._transitionable=new o.T(Ye),this.setSky(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.B(0))}setSky(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.C,l,h)){l||(l={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in l){const y=l[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(m==null?void 0:m.validate)!==!1&&o.t(this,l.call(o.x,o.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(l){return l<60?0:l<70?(l-60)/10:1}}class At{constructor(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,h){const m=l.join(",")+String(h);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(l,h)),this.dashEntry[m]}getDashRanges(l,h,m){const y=[];let C=l.length%2==1?-l[l.length-1]*m:0,S=l[0]*m,R=!0;y.push({left:C,right:S,isDash:R,zeroLength:l[0]===0});let O=l[0];for(let Q=1;Q<l.length;Q++){R=!R;const K=l[Q];C=O*m,O+=K,S=O*m,y.push({left:C,right:S,isDash:R,zeroLength:K===0})}return y}addRoundDash(l,h,m){const y=h/2;for(let C=-m;C<=m;C++){const S=this.width*(this.nextRow+m+C);let R=0,O=l[R];for(let Q=0;Q<this.width;Q++){Q/O.right>1&&(O=l[++R]);const K=Math.abs(Q-O.left),Z=Math.abs(Q-O.right),ee=Math.min(K,Z);let Ae;const pe=C/m*(y+1);if(O.isDash){const Fe=y-Math.abs(pe);Ae=Math.sqrt(ee*ee+Fe*Fe)}else Ae=y-Math.sqrt(ee*ee+pe*pe);this.data[S+Q]=Math.max(0,Math.min(255,Ae+128))}}}addRegularDash(l){for(let R=l.length-1;R>=0;--R){const O=l[R],Q=l[R+1];O.zeroLength?l.splice(R,1):Q&&Q.isDash===O.isDash&&(Q.left=O.left,l.splice(R,1))}const h=l[0],m=l[l.length-1];h.isDash===m.isDash&&(h.left=m.left-this.width,m.right=h.right+this.width);const y=this.width*this.nextRow;let C=0,S=l[C];for(let R=0;R<this.width;R++){R/S.right>1&&(S=l[++C]);const O=Math.abs(R-S.left),Q=Math.abs(R-S.right),K=Math.min(O,Q);this.data[y+R]=Math.max(0,Math.min(255,(S.isDash?K:-K)+128))}}addDash(l,h){const m=h?7:0,y=2*m+1;if(this.nextRow+y>this.height)return o.w("LineAtlas out of space"),null;let C=0;for(let R=0;R<l.length;R++)C+=l[R];if(C!==0){const R=this.width/C,O=this.getDashRanges(l,this.width,R);h?this.addRoundDash(O,R,m):this.addRegularDash(O)}const S={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:C};return this.nextRow+=y,this.dirty=!0,S}bind(l){const h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const kt="maplibre_preloaded_worker_pool";class ae{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<ae.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kt]}numActive(){return Object.keys(this.active).length}}const Te=Math.floor(w.hardwareConcurrency/2);let Le,De;function at(){return Le||(Le=new ae),Le}ae.workerCount=o.F(globalThis)?Math.max(Math.min(Te,3),1):1;class rt{constructor(l,h){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=h;const m=this.workerPool.acquire(h);for(let y=0;y<m.length;y++){const C=new o.G(m[y],h);C.name=`Worker ${y}`,this.actors.push(C)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,h){const m=[];for(const y of this.actors)m.push(y.sendAsync({type:l,data:h}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(h=>{h.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,h){for(const m of this.actors)m.registerMessageHandler(l,h)}}function xt(){return De||(De=new rt(at(),o.H),De.registerMessageHandler("GR",(x,l,h)=>o.m(l,h))),De}function vt(x,l){const h=o.J();return o.K(h,h,[1,1,0]),o.L(h,h,[.5*x.width,.5*x.height,1]),x.calculatePosMatrix?o.M(h,h,x.calculatePosMatrix(l.toUnwrapped())):h}function nr(x,l,h,m,y,C){var S;const R=function(Z,ee,Ae){if(Z)for(const pe of Z){const Fe=ee[pe];if(Fe&&Fe.source===Ae&&Fe.type==="fill-extrusion")return!0}else for(const pe in ee){const Fe=ee[pe];if(Fe.source===Ae&&Fe.type==="fill-extrusion")return!0}return!1}((S=y==null?void 0:y.layers)!==null&&S!==void 0?S:null,l,x.id),O=C.maxPitchScaleFactor(),Q=x.tilesIn(m,O,R);Q.sort(qt);const K=[];for(const Z of Q)K.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(l,h,x._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,y,C,O,vt(x.transform,Z.tileID))});return function(Z,ee){for(const Ae in Z)for(const pe of Z[Ae])or(pe,ee);return Z}(function(Z){const ee={},Ae={};for(const pe of Z){const Fe=pe.queryResults,Me=pe.wrappedTileID,Re=Ae[Me]=Ae[Me]||{};for(const Ne in Fe){const $e=Fe[Ne],qe=Re[Ne]=Re[Ne]||{},Xe=ee[Ne]=ee[Ne]||[];for(const tt of $e)qe[tt.featureIndex]||(qe[tt.featureIndex]=!0,Xe.push(tt))}}return ee}(K),x)}function qt(x,l){const h=x.tileID,m=l.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}function or(x,l){const h=x.feature,m=l.getFeatureState(h.layer["source-layer"],h.id);h.source=h.layer.source,h.layer["source-layer"]&&(h.sourceLayer=h.layer["source-layer"]),h.state=m}function gr(x,l,h){return o._(this,void 0,void 0,function*(){let m=x;if(x.url?m=(yield o.h(l.transformRequest(x.url,"Source"),h)).data:yield w.frameAsync(h),!m)return null;const y=o.N(o.e(m,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(y.vectorLayerIds=m.vector_layers.map(C=>C.id)),y})}class wr{constructor(l,h){l&&(h?this.setSouthWest(l).setNorthEast(h):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof o.O?new o.O(l.lng,l.lat):o.O.convert(l),this}setSouthWest(l){return this._sw=l instanceof o.O?new o.O(l.lng,l.lat):o.O.convert(l),this}extend(l){const h=this._sw,m=this._ne;let y,C;if(l instanceof o.O)y=l,C=l;else{if(!(l instanceof wr))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(wr.convert(l)):this.extend(o.O.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(o.O.convert(l)):this;if(y=l._sw,C=l._ne,!y||!C)return this}return h||m?(h.lng=Math.min(y.lng,h.lng),h.lat=Math.min(y.lat,h.lat),m.lng=Math.max(C.lng,m.lng),m.lat=Math.max(C.lat,m.lat)):(this._sw=new o.O(y.lng,y.lat),this._ne=new o.O(C.lng,C.lat)),this}getCenter(){return new o.O((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.O(this.getWest(),this.getNorth())}getSouthEast(){return new o.O(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:h,lat:m}=o.O.convert(l);let y=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&y}static convert(l){return l instanceof wr?l:l&&new wr(l)}static fromLngLat(l){const m=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,y=m/Math.cos(Math.PI/180*l.lat);return new wr(new o.O(l.lng-y,l.lat-m),new o.O(l.lng+y,l.lat+m))}adjustAntiMeridian(){const l=new o.O(this._sw.lng,this._sw.lat),h=new o.O(this._ne.lng,this._ne.lat);return new wr(l,l.lng>h.lng?new o.O(h.lng+360,h.lat):h)}}class Ot{constructor(l,h,m){this.bounds=wr.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=m||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const h=Math.pow(2,l.z),m=Math.floor(o.S(this.bounds.getWest())*h),y=Math.floor(o.Q(this.bounds.getNorth())*h),C=Math.ceil(o.S(this.bounds.getEast())*h),S=Math.ceil(o.Q(this.bounds.getSouth())*h);return l.x>=m&&l.x<C&&l.y>=y&&l.y<S}}class ze extends o.E{constructor(l,h,m,y){if(super(),this.id=l,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.N(h,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(o.e(this,l),l.bounds&&(this.tileBounds=new Ot(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new o.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(l){return o._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(h,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};m.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((C,S)=>{l.reloadPromise={resolve:C,reject:S}})}else l.actor=this.dispatcher.getActor(),y="LT";l.abortController=new AbortController;try{const C=yield l.actor.sendAsync({type:y,data:m},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,C)}catch(C){if(delete l.abortController,l.aborted)return;if(C&&C.status!==404)throw C;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,h){if(h&&h.resourceTiming&&(l.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&l.setExpiryData(h),l.loadVectorData(h,this.map.painter),l.reloadPromise){const m=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(m.resolve).catch(m.reject)}}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class $r extends o.E{constructor(l,h,m,y){super(),this.id=l,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},h),o.e(this,o.N(h,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function(){var l=this;let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){l._loaded=!1,l.fire(new o.k("dataloading",{dataType:"source"})),l._tileJSONRequest=new AbortController;try{const m=yield gr(l._options,l.map._requestManager,l._tileJSONRequest);l._tileJSONRequest=null,l._loaded=!0,m&&(o.e(l,m),m.bounds&&(l.tileBounds=new Ot(m.bounds,l.minzoom,l.maxzoom)),l.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),l.fire(new o.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:h})))}catch(m){l._tileJSONRequest=null,l.fire(new o.j(m))}}()})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load(!0)}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return o.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return o._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const m=yield V.getImage(this.map._requestManager.transformRequest(h,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&l.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const y=this.map.painter.context,C=y.gl,S=m.data;l.texture=this.map.painter.getTileTexture(S.width),l.texture?l.texture.update(S,{useMipmap:!0}):(l.texture=new J(y,S,C.RGBA,{useMipmap:!0}),l.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST)),l.state="loaded"}}catch(m){if(delete l.abortController,l.aborted)l.state="unloaded";else if(m)throw l.state="errored",m}})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class Rr extends $r{constructor(l,h,m,y){super(l,h,m,y),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(l){return o._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(h,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const y=yield V.getImage(m,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(y&&y.data){const C=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&l.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const S=o.b(C)&&o.U()?C:yield this.readImageNow(C),R={type:this.type,uid:l.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const O=yield l.actor.sendAsync({type:"LDT",data:R});l.dem=O,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(y){if(delete l.abortController,l.aborted)l.state="unloaded";else if(y)throw l.state="errored",y}})}readImageNow(l){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.V()){const h=l.width+2,m=l.height+2;try{return new o.R({width:h,height:m},yield o.W(l,-1,-1,h,m))}catch{}}return w.getImageData(l,1)})}_getNeighboringTiles(l){const h=l.canonical,m=Math.pow(2,h.z),y=(h.x-1+m)%m,C=h.x===0?l.wrap-1:l.wrap,S=(h.x+1+m)%m,R=h.x+1===m?l.wrap+1:l.wrap,O={};return O[new o.X(l.overscaledZ,C,h.z,y,h.y).key]={backfilled:!1},O[new o.X(l.overscaledZ,R,h.z,S,h.y).key]={backfilled:!1},h.y>0&&(O[new o.X(l.overscaledZ,C,h.z,y,h.y-1).key]={backfilled:!1},O[new o.X(l.overscaledZ,l.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},O[new o.X(l.overscaledZ,R,h.z,S,h.y-1).key]={backfilled:!1}),h.y+1<m&&(O[new o.X(l.overscaledZ,C,h.z,y,h.y+1).key]={backfilled:!1},O[new o.X(l.overscaledZ,l.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},O[new o.X(l.overscaledZ,R,h.z,S,h.y+1).key]={backfilled:!1}),O}unloadTile(l){return o._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Jt extends o.E{constructor(l,h,m,y){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(y),this._data=h.data,this._options=o.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId,h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(h.buffer!==void 0?h.buffer:128),tolerance:this._pixelsToTileUnits(h.tolerance!==void 0?h.tolerance:.375),extent:o.Y,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:o.Y,radius:this._pixelsToTileUnits(h.clusterRadius||50),log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(l){return l*(o.Y/this.tileSize)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}getData(){return o._(this,void 0,void 0,function*(){const l=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:l})})}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(l.clusterRadius)),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,h,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:h,offset:m}})}_updateWorkerData(l){return o._(this,void 0,void 0,function*(){const h=o.e({type:this.type},this.workerOptions);l?h.dataDiff=l:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(w.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let y=null;m.resourceTiming&&m.resourceTiming[this.id]&&(y=m.resourceTiming[this.id].slice(0));const C={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&o.e(C,{resourceTiming:y}),this.fire(new o.k("data",Object.assign(Object.assign({},C),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},C),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(l){return o._(this,void 0,void 0,function*(){const h=l.actor?"RT":"LT";l.actor=this.actor;const m={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.abortController=new AbortController;const y=yield this.actor.sendAsync({type:h,data:m},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(y,this.map.painter,h==="RT")})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class tr extends o.E{constructor(l,h,m,y){super(),this.flippedWindingOrder=!1,this.id=l,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=h}load(l){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield V.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,l&&(this.coordinates=l),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new o.j(h))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const h=l.map(o.Z.fromLngLat);var m;return this.tileID=function(y){let C=1/0,S=1/0,R=-1/0,O=-1/0;for(const ee of y)C=Math.min(C,ee.x),S=Math.min(S,ee.y),R=Math.max(R,ee.x),O=Math.max(O,ee.y);const Q=Math.max(R-C,O-S),K=Math.max(0,Math.floor(-Math.log(Q)/Math.LN2)),Z=Math.pow(2,K);return new o.$(K,Math.floor((C+R)/2*Z),Math.floor((S+O)/2*Z))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=h.map(y=>this.tileID.getTilePoint(y)._round()),this.flippedWindingOrder=((m=this.tileCoords)[1].x-m[0].x)*(m[2].y-m[0].y)-(m[1].y-m[0].y)*(m[2].x-m[0].x)<0,this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,h=l.gl;this.texture||(this.texture=new J(l,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const C=this.tiles[y];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,m=!0)}m&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class mr extends tr{constructor(l,h,m,y){super(l,h,m,y),this.roundZoom=!0,this.type="video",this.options=h}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const h of l.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield o.a0(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new o.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const h=this.video.seekable;l<h.start(0)||l>h.end(0)?this.fire(new o.j(new o.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,h=l.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new J(l,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const C=this.tiles[y];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,m=!0)}m&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class _r extends tr{constructor(l,h,m,y){super(l,h,m,y),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(C=>!Array.isArray(C)||C.length!==2||C.some(S=>typeof S!="number"))||this.fire(new o.j(new o.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a1(`sources.${l}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new o.j(new o.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,m=h.gl;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new J(h,this.canvas,m.RGBA,{premultiply:!0});let y=!1;for(const C in this.tiles){const S=this.tiles[C];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,y=!0)}y&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const Ut={},ar=x=>{switch(x){case"geojson":return Jt;case"image":return tr;case"raster":return $r;case"raster-dem":return Rr;case"vector":return ze;case"video":return mr;case"canvas":return _r}return Ut[x]},Sr="RTLPluginLoaded";class Er extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=xt()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return o._(this,arguments,void 0,function(h){var m=this;let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(m.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(m.url=w.resolveURL(h),!m.url)throw new Error(`requested url ${h} is invalid`);if(m.status==="unavailable"){if(!y)return m._requestImport();m.status="deferred",m._syncState(m.status)}else if(m.status==="requested")return m._requestImport()}()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(Sr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Dr=null;function nn(){return Dr||(Dr=new Er),Dr}class Hr{constructor(l,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=o.a2(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const h=l+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,h,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(y,C){const S={};if(!C)return S;for(const R of y){const O=R.layerIds.map(Q=>C.getLayer(Q)).filter(Boolean);if(O.length!==0){R.layers=O,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(Q=>O.filter(K=>K.id===Q)[0]));for(const Q of O)S[Q.id]=R}}return S}(l.buckets,h==null?void 0:h.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const C=this.buckets[y];if(C instanceof o.a4){if(this.hasSymbolBuckets=!0,!m)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const C=this.buckets[y];if(C instanceof o.a4&&C.hasRTLText){this.hasRTLText=!0,nn().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const C=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(y).queryRadius(C))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new o.a3}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(l)}const h=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new J(l,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new J(l,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,h,m,y,C,S,R,O,Q,K){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:C,scale:S,tileSize:this.tileSize,pixelPosMatrix:K,transform:O,params:R,queryPadding:this.queryPadding*Q},l,h,m):{}}querySourceFeatures(l,h){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),C=h&&h.sourceLayer?h.sourceLayer:"",S=y._geojsonTileLayer||y[C];if(!S)return;const R=o.a5(h&&h.filter),{z:O,x:Q,y:K}=this.tileID.canonical,Z={z:O,x:Q,y:K};for(let ee=0;ee<S.length;ee++){const Ae=S.feature(ee);if(R.needGeometry){const Me=o.a6(Ae,!0);if(!R.filter(new o.B(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!R.filter(new o.B(this.tileID.overscaledZ),Ae))continue;const pe=m.getId(Ae,C),Fe=new o.a7(Ae,O,Q,K,pe);Fe.tile=Z,l.push(Fe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const h=this.expirationTime;if(l.cacheControl){const m=o.a8(l.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(h)if(this.expirationTime<h)y=!0;else{const C=this.expirationTime-h;C?this.expirationTime=m+Math.max(C,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!h.style.hasLayer(y))continue;const C=this.buckets[y],S=C.layers[0].sourceLayer||"_geojsonTileLayer",R=m[S],O=l[S];if(!R||!O||Object.keys(O).length===0)continue;C.update(O,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Q=h&&h.style&&h.style.getLayer(y);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<w.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=w.now()+l}setDependencies(l,h){const m={};for(const y of h)m[y]=!0;this.dependencies[l]=m}hasDependency(l,h){for(const m of l){const y=this.dependencies[m];if(y){for(const C of h)if(y[C])return!0}}return!1}}class Wr{constructor(l,h){this.max=l,this.onRemove=h,this.reset()}reset(){for(const l in this.data)for(const h of this.data[l])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(l,h,m){const y=l.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const C={value:h,timeout:void 0};if(m!==void 0&&(C.timeout=setTimeout(()=>{this.remove(l,C)},m)),this.data[y].push(C),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value}getByKey(l){const h=this.data[l];return h?h[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,h){if(!this.has(l))return this;const m=l.wrapped().key,y=h===void 0?0:this.data[m].indexOf(h),C=this.data[m][y];return this.data[m].splice(y,1),C.timeout&&clearTimeout(C.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(C.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(l){const h=[];for(const m in this.data)for(const y of this.data[m])l(y.value)||h.push(y);for(const m of h)this.remove(m.value.tileID,m)}}class vr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,h,m){const y=String(h);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][y]=this.stateChanges[l][y]||{},o.e(this.stateChanges[l][y],m),this.deletedStates[l]===null){this.deletedStates[l]={};for(const C in this.state[l])C!==y&&(this.deletedStates[l][C]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][y]===null){this.deletedStates[l][y]={};for(const C in this.state[l][y])m[C]||(this.deletedStates[l][y][C]=null)}else for(const C in m)this.deletedStates[l]&&this.deletedStates[l][y]&&this.deletedStates[l][y][C]===null&&delete this.deletedStates[l][y][C]}removeFeatureState(l,h,m){if(this.deletedStates[l]===null)return;const y=String(h);if(this.deletedStates[l]=this.deletedStates[l]||{},m&&h!==void 0)this.deletedStates[l][y]!==null&&(this.deletedStates[l][y]=this.deletedStates[l][y]||{},this.deletedStates[l][y][m]=null);else if(h!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][y])for(m in this.deletedStates[l][y]={},this.stateChanges[l][y])this.deletedStates[l][y][m]=null;else this.deletedStates[l][y]=null;else this.deletedStates[l]=null}getState(l,h){const m=String(h),y=o.e({},(this.state[l]||{})[m],(this.stateChanges[l]||{})[m]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const C=this.deletedStates[l][h];if(C===null)return{};for(const S in C)delete y[S]}return y}initializeTileState(l,h){l.setFeatureState(this.state,h)}coalesceChanges(l,h){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const C={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),o.e(this.state[y][S],this.stateChanges[y][S]),C[S]=this.state[y][S];m[y]=C}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const C={};if(this.deletedStates[y]===null)for(const S in this.state[y])C[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(this.deletedStates[y][S]===null)this.state[y][S]={};else for(const R of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][R];C[S]=this.state[y][S]}m[y]=m[y]||{},o.e(m[y],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const y in l)l[y].setFeatureState(m,h)}}function Qn(x,l,h){const m=l.intersectsFrustum(x);if(!h)return m;const y=l.intersectsPlane(h);return m===0||y===0?0:m===2&&y===2?2:1}function un(x,l,h,m,y){let C=x;const S=Math.atan(l/h),R=Math.hypot(l,h);return C=x+o.a9(m/R/Math.max(.5,Math.cos(o.ab(y/2)))),C+=1*o.a9(Math.cos(S))/2,C+=o.ac(x-C,-0,0),C}function ni(x,l){const h=(l.roundZoom?Math.round:Math.floor)(x.zoom+o.a9(x.tileSize/l.tileSize));return Math.max(0,h)}function Be(x,l){const h=x.getCameraFrustum(),m=x.getClippingPlane(),y=x.screenPointToMercatorCoordinate(x.getCameraPoint()),C=o.Z.fromLngLat(x.center,x.elevation);y.z=C.z+Math.cos(x.pitchInRadians)*x.cameraToCenterDistance/x.worldSize;const S=x.getCoveringTilesDetailsProvider(),R=S.allowVariableZoom(x,l),O=ni(x,l),Q=l.minzoom||0,K=l.maxzoom!==void 0?l.maxzoom:x.maxZoom,Z=Math.min(Math.max(0,O),K),ee=Math.pow(2,Z),Ae=[ee*y.x,ee*y.y,0],pe=[ee*C.x,ee*C.y,0],Fe=Math.hypot(C.x-y.x,C.y-y.y),Me=Math.abs(C.z-y.z),Re=Math.hypot(Fe,Me),Ne=Xe=>({zoom:0,x:0,y:0,wrap:Xe,fullyVisible:!1}),$e=[],qe=[];if(x.renderWorldCopies&&S.allowWorldCopies())for(let Xe=1;Xe<=3;Xe++)$e.push(Ne(-Xe)),$e.push(Ne(Xe));for($e.push(Ne(0));$e.length>0;){const Xe=$e.pop(),tt=Xe.x,it=Xe.y;let Et=Xe.fullyVisible;const Ct={x:tt,y:it,z:Xe.zoom},Dt=S.getTileAABB(Ct,Xe.wrap,x.elevation,l);if(!Et){const Ar=Qn(h,Dt,m);if(Ar===0)continue;Et=Ar===2}const Ht=S.distanceToTile2d(y.x,y.y,Ct,Dt);let Lt=O;R&&(Lt=(l.calculateTileZoom||un)(x.zoom+o.a9(x.tileSize/l.tileSize),Ht,Me,Re,x.fov)),Lt=(l.roundZoom?Math.round:Math.floor)(Lt),Lt=Math.max(0,Lt);const dr=Math.min(Lt,K);if(Xe.wrap=S.getWrap(C,Ct,Xe.wrap),Xe.zoom>=dr){if(Xe.zoom<Q)continue;const Ar=Z-Xe.zoom,Kt=Ae[0]-.5-(tt<<Ar),xr=Ae[1]-.5-(it<<Ar),sn=l.reparseOverscaled?Math.max(Xe.zoom,Lt):Xe.zoom;qe.push({tileID:new o.X(Xe.zoom===K?sn:Xe.zoom,Xe.wrap,Xe.zoom,tt,it),distanceSq:o.aa([pe[0]-.5-tt,pe[1]-.5-it]),tileDistanceToCamera:Math.sqrt(Kt*Kt+xr*xr)})}else for(let Ar=0;Ar<4;Ar++)$e.push({zoom:Xe.zoom+1,x:(tt<<1)+Ar%2,y:(it<<1)+(Ar>>1),wrap:Xe.wrap,fullyVisible:Et})}return qe.sort((Xe,tt)=>Xe.distanceSq-tt.distanceSq).map(Xe=>Xe.tileID)}class ce extends o.E{constructor(l,h,m){super(),this.id=l,this.dispatcher=m,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,C,S,R)=>{const O=new(ar(C.type))(y,C,S,R);if(O.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${O.id}`);return O})(l,h,m,this),this._tiles={},this._cache=new Wr(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new vr,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const h=this._tiles[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,h,m){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,h,m)}catch(y){l.state="errored",y.status!==404?this._source.fire(new o.j(y,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new o.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const m=this._tiles[h];m.upload(l),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(de).map(l=>l.key)}getRenderableIds(l){const h=[];for(const m in this._tiles)this._isIdRenderable(m,l)&&h.push(this._tiles[m]);return l?h.sort((m,y)=>{const C=m.tileID,S=y.tileID,R=new o.P(C.canonical.x,C.canonical.y)._rotate(-this.transform.bearingInRadians),O=new o.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians);return C.overscaledZ-S.overscaledZ||O.y-R.y||O.x-R.x}).map(m=>m.tileID.key):h.map(m=>m.tileID).sort(de).map(m=>m.key)}hasRenderableParent(l){const h=this.findLoadedParent(l,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(l,h){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(h||!this._tiles[l].holdingForFade())}reload(l){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const h in this._tiles)(l||this._tiles[h].state!=="errored")&&this._reloadTile(h,"reloading")}}_reloadTile(l,h){return o._(this,void 0,void 0,function*(){const m=this._tiles[l];m&&(m.state!=="loading"&&(m.state=h),yield this._loadTile(m,l,h))})}_tileLoaded(l,h,m){l.timeAdded=w.now(),m==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(h,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const h=this.getRenderableIds();for(let y=0;y<h.length;y++){const C=h[y];if(l.neighboringTiles&&l.neighboringTiles[C]){const S=this.getTileByID(C);m(l,S),m(S,l)}}function m(y,C){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let S=C.tileID.canonical.x-y.tileID.canonical.x;const R=C.tileID.canonical.y-y.tileID.canonical.y,O=Math.pow(2,y.tileID.canonical.z),Q=C.tileID.key;S===0&&R===0||Math.abs(R)>1||(Math.abs(S)>1&&(Math.abs(S+O)===1?S+=O:Math.abs(S-O)===1&&(S-=O)),C.dem&&y.dem&&(y.dem.backfillBorder(C.dem,S,R),y.neighboringTiles&&y.neighboringTiles[Q]&&(y.neighboringTiles[Q].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,h,m,y){for(const C in this._tiles){let S=this._tiles[C];if(y[C]||!S.hasData()||S.tileID.overscaledZ<=h||S.tileID.overscaledZ>m)continue;let R=S.tileID;for(;S&&S.tileID.overscaledZ>h+1;){const Q=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[Q.key],S&&S.hasData()&&(R=Q)}let O=R;for(;O.overscaledZ>h;)if(O=O.scaledTo(O.overscaledZ-1),l[O.key]||l[O.canonical.key]){y[R.key]=R;break}}}findLoadedParent(l,h){if(l.key in this._loadedParentTiles){const m=this._loadedParentTiles[l.key];return m&&m.tileID.overscaledZ>=h?m:null}for(let m=l.overscaledZ-1;m>=h;m--){const y=l.scaledTo(m),C=this._getLoadedTile(y);if(C)return C}}findLoadedSibling(l){return this._getLoadedTile(l)}_getLoadedTile(l){const h=this._tiles[l.key];return h&&h.hasData()?h:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const h=Math.ceil(l.width/this._source.tileSize)+1,m=Math.ceil(l.height/this._source.tileSize)+1,y=Math.floor(h*m*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(C)}handleWrapJump(l){const h=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,h){const m={};for(const y in this._tiles){const C=this._tiles[y];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),m[C.tileID.key]=C}this._tiles=m;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(l,h,m,y,C,S){const R={},O={},Q=Object.keys(l),K=w.now();for(const Z of Q){const ee=l[Z],Ae=this._tiles[Z];if(!Ae||Ae.fadeEndTime!==0&&Ae.fadeEndTime<=K)continue;const pe=this.findLoadedParent(ee,h),Fe=this.findLoadedSibling(ee),Me=pe||Fe||null;Me&&(this._addTile(Me.tileID),R[Me.tileID.key]=Me.tileID),O[Z]=ee}this._retainLoadedChildren(O,y,m,l);for(const Z in R)l[Z]||(this._coveredTiles[Z]=!0,l[Z]=R[Z]);if(S){const Z={},ee={};for(const Ae of C)this._tiles[Ae.key].hasData()?Z[Ae.key]=Ae:ee[Ae.key]=Ae;for(const Ae in ee){const pe=ee[Ae].children(this._source.maxzoom);this._tiles[pe[0].key]&&this._tiles[pe[1].key]&&this._tiles[pe[2].key]&&this._tiles[pe[3].key]&&(Z[pe[0].key]=l[pe[0].key]=pe[0],Z[pe[1].key]=l[pe[1].key]=pe[1],Z[pe[2].key]=l[pe[2].key]=pe[2],Z[pe[3].key]=l[pe[3].key]=pe[3],delete ee[Ae])}for(const Ae in ee){const pe=ee[Ae],Fe=this.findLoadedParent(pe,this._source.minzoom),Me=this.findLoadedSibling(pe),Re=Fe||Me||null;if(Re){Z[Re.tileID.key]=l[Re.tileID.key]=Re.tileID;for(const Ne in Z)Z[Ne].isChildOf(Re.tileID)&&delete Z[Ne]}}for(const Ae in this._tiles)Z[Ae]||(this._coveredTiles[Ae]=!0)}}update(l,h){if(!this._sourceLoaded||this._paused)return;let m;this.transform=l,this.terrain=h,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(K=>new o.X(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y)):(m=Be(l,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(m=m.filter(K=>this._source.hasTile(K)))):m=[];const y=ni(l,this._source),C=Math.max(y-ce.maxOverzooming,this._source.minzoom),S=Math.max(y+ce.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const K={};for(const Z of m)if(Z.canonical.z>this._source.minzoom){const ee=Z.scaledTo(Z.canonical.z-1);K[ee.key]=ee;const Ae=Z.scaledTo(Math.max(this._source.minzoom,Math.min(Z.canonical.z,5)));K[Ae.key]=Ae}m=m.concat(Object.values(K))}const R=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,R&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const O=this._updateRetainedTiles(m,y);_e(this._source.type)&&this._updateCoveredAndRetainedTiles(O,C,S,y,m,h);for(const K in O)this._tiles[K].clearFadeHold();const Q=o.ad(this._tiles,O);for(const K of Q){const Z=this._tiles[K];Z.hasSymbolBuckets&&!Z.holdingForFade()?Z.setHoldDuration(this.map._fadeDuration):Z.hasSymbolBuckets&&!Z.symbolFadeFinished()||this._removeTile(K)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,h){var m;const y={},C={},S=Math.max(h-ce.maxOverzooming,this._source.minzoom),R=Math.max(h+ce.maxUnderzooming,this._source.minzoom),O={};for(const Q of l){const K=this._addTile(Q);y[Q.key]=Q,K.hasData()||h<this._source.maxzoom&&(O[Q.key]=Q)}this._retainLoadedChildren(O,h,R,y);for(const Q of l){let K=this._tiles[Q.key];if(K.hasData())continue;if(h+1>this._source.maxzoom){const ee=Q.children(this._source.maxzoom)[0],Ae=this.getTile(ee);if(Ae&&Ae.hasData()){y[ee.key]=ee;continue}}else{const ee=Q.children(this._source.maxzoom);if(y[ee[0].key]&&y[ee[1].key]&&y[ee[2].key]&&y[ee[3].key])continue}let Z=K.wasRequested();for(let ee=Q.overscaledZ-1;ee>=S;--ee){const Ae=Q.scaledTo(ee);if(C[Ae.key])break;if(C[Ae.key]=!0,K=this.getTile(Ae),!K&&Z&&(K=this._addTile(Ae)),K){const pe=K.hasData();if((pe||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||Z)&&(y[Ae.key]=Ae),Z=K.wasRequested(),pe)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const h=[];let m,y=this._tiles[l].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){m=this._loadedParentTiles[y.key];break}h.push(y.key);const C=y.scaledTo(y.overscaledZ-1);if(m=this._getLoadedTile(C),m)break;y=C}for(const C of h)this._loadedParentTiles[C]=m}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const l in this._tiles){const h=this._tiles[l].tileID,m=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=m}}_addTile(l){let h=this._tiles[l.key];if(h)return h;h=this._cache.getAndRemove(l),h&&(this._setTileReloadTimer(l.key,h),h.tileID=l,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,h)));const m=h;return h||(h=new Hr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(h,l.key,h.state)),h.uses++,this._tiles[l.key]=h,m||this._source.fire(new o.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(l,h){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const m=h.getExpiryTimeout();m&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},m))}_removeTile(l){const h=this._tiles[l];h&&(h.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(l){const h=l.sourceDataType;l.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&h==="content"&&(this.reload(l.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,h,m){const y=[],C=this.transform;if(!C)return y;const S=m?C.getCameraQueryGeometry(l):l,R=l.map(pe=>C.screenPointToMercatorCoordinate(pe,this.terrain)),O=S.map(pe=>C.screenPointToMercatorCoordinate(pe,this.terrain)),Q=this.getIds();let K=1/0,Z=1/0,ee=-1/0,Ae=-1/0;for(const pe of O)K=Math.min(K,pe.x),Z=Math.min(Z,pe.y),ee=Math.max(ee,pe.x),Ae=Math.max(Ae,pe.y);for(let pe=0;pe<Q.length;pe++){const Fe=this._tiles[Q[pe]];if(Fe.holdingForFade())continue;const Me=Fe.tileID,Re=Math.pow(2,C.zoom-Fe.tileID.overscaledZ),Ne=h*Fe.queryPadding*o.Y/Fe.tileSize/Re,$e=[Me.getTilePoint(new o.Z(K,Z)),Me.getTilePoint(new o.Z(ee,Ae))];if($e[0].x-Ne<o.Y&&$e[0].y-Ne<o.Y&&$e[1].x+Ne>=0&&$e[1].y+Ne>=0){const qe=R.map(tt=>Me.getTilePoint(tt)),Xe=O.map(tt=>Me.getTilePoint(tt));y.push({tile:Fe,tileID:Me,queryGeometry:qe,cameraQueryGeometry:Xe,scale:Re})}}return y}getVisibleCoordinates(l){const h=this.getRenderableIds(l).map(m=>this._tiles[m].tileID);return this.transform&&this.transform.populateCache(h),h}hasTransition(){if(this._source.hasTransition())return!0;if(_e(this._source.type)){const l=w.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=l)return!0}return!1}setFeatureState(l,h,m){this._state.updateState(l=l||"_geojsonTileLayer",h,m)}removeFeatureState(l,h,m){this._state.removeFeatureState(l=l||"_geojsonTileLayer",h,m)}getFeatureState(l,h){return this._state.getState(l=l||"_geojsonTileLayer",h)}setDependencies(l,h,m){const y=this._tiles[l];y&&y.setDependencies(h,m)}reloadTilesForDependencies(l,h){for(const m in this._tiles)this._tiles[m].hasDependency(l,h)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(l,h))}}function de(x,l){const h=Math.abs(2*x.wrap)-+(x.wrap<0),m=Math.abs(2*l.wrap)-+(l.wrap<0);return x.overscaledZ-l.overscaledZ||m-h||l.canonical.y-x.canonical.y||l.canonical.x-x.canonical.x}function _e(x){return x==="raster"||x==="image"||x==="video"}ce.maxOverzooming=10,ce.maxUnderzooming=3;class Ue{constructor(l,h){this.reset(l,h)}reset(l,h){this.points=l||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=o.ac(l,0,1);let h=1,m=this._distances[h];const y=l*this.paddedLength+this.padding;for(;m<y&&h<this._distances.length;)m=this._distances[++h];const C=h-1,S=this._distances[C],R=m-S,O=R>0?(y-S)/R:0;return this.points[C].mult(1-O).add(this.points[h].mult(O))}}function je(x,l){let h=!0;return x==="always"||x!=="never"&&l!=="never"||(h=!1),h}class lt{constructor(l,h,m){const y=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(l/m),this.yCellCount=Math.ceil(h/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,h,m,y,C){this._forEachCell(h,m,y,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(C)}insertCircle(l,h,m,y){this._forEachCell(h-y,m-y,h+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(m),this.circles.push(y)}_insertBoxCell(l,h,m,y,C,S){this.boxCells[C].push(S)}_insertCircleCell(l,h,m,y,C,S){this.circleCells[C].push(S)}_query(l,h,m,y,C,S,R){if(m<0||l>this.width||y<0||h>this.height)return[];const O=[];if(l<=0&&h<=0&&this.width<=m&&this.height<=y){if(C)return[{key:null,x1:l,y1:h,x2:m,y2:y}];for(let Q=0;Q<this.boxKeys.length;Q++)O.push({key:this.boxKeys[Q],x1:this.bboxes[4*Q],y1:this.bboxes[4*Q+1],x2:this.bboxes[4*Q+2],y2:this.bboxes[4*Q+3]});for(let Q=0;Q<this.circleKeys.length;Q++){const K=this.circles[3*Q],Z=this.circles[3*Q+1],ee=this.circles[3*Q+2];O.push({key:this.circleKeys[Q],x1:K-ee,y1:Z-ee,x2:K+ee,y2:Z+ee})}}else this._forEachCell(l,h,m,y,this._queryCell,O,{hitTest:C,overlapMode:S,seenUids:{box:{},circle:{}}},R);return O}query(l,h,m,y){return this._query(l,h,m,y,!1,null)}hitTest(l,h,m,y,C,S){return this._query(l,h,m,y,!0,C,S).length>0}hitTestCircle(l,h,m,y,C){const S=l-m,R=l+m,O=h-m,Q=h+m;if(R<0||S>this.width||Q<0||O>this.height)return!1;const K=[];return this._forEachCell(S,O,R,Q,this._queryCellCircle,K,{hitTest:!0,overlapMode:y,circle:{x:l,y:h,radius:m},seenUids:{box:{},circle:{}}},C),K.length>0}_queryCell(l,h,m,y,C,S,R,O){const{seenUids:Q,hitTest:K,overlapMode:Z}=R,ee=this.boxCells[C];if(ee!==null){const pe=this.bboxes;for(const Fe of ee)if(!Q.box[Fe]){Q.box[Fe]=!0;const Me=4*Fe,Re=this.boxKeys[Fe];if(l<=pe[Me+2]&&h<=pe[Me+3]&&m>=pe[Me+0]&&y>=pe[Me+1]&&(!O||O(Re))&&(!K||!je(Z,Re.overlapMode))&&(S.push({key:Re,x1:pe[Me],y1:pe[Me+1],x2:pe[Me+2],y2:pe[Me+3]}),K))return!0}}const Ae=this.circleCells[C];if(Ae!==null){const pe=this.circles;for(const Fe of Ae)if(!Q.circle[Fe]){Q.circle[Fe]=!0;const Me=3*Fe,Re=this.circleKeys[Fe];if(this._circleAndRectCollide(pe[Me],pe[Me+1],pe[Me+2],l,h,m,y)&&(!O||O(Re))&&(!K||!je(Z,Re.overlapMode))){const Ne=pe[Me],$e=pe[Me+1],qe=pe[Me+2];if(S.push({key:Re,x1:Ne-qe,y1:$e-qe,x2:Ne+qe,y2:$e+qe}),K)return!0}}}return!1}_queryCellCircle(l,h,m,y,C,S,R,O){const{circle:Q,seenUids:K,overlapMode:Z}=R,ee=this.boxCells[C];if(ee!==null){const pe=this.bboxes;for(const Fe of ee)if(!K.box[Fe]){K.box[Fe]=!0;const Me=4*Fe,Re=this.boxKeys[Fe];if(this._circleAndRectCollide(Q.x,Q.y,Q.radius,pe[Me+0],pe[Me+1],pe[Me+2],pe[Me+3])&&(!O||O(Re))&&!je(Z,Re.overlapMode))return S.push(!0),!0}}const Ae=this.circleCells[C];if(Ae!==null){const pe=this.circles;for(const Fe of Ae)if(!K.circle[Fe]){K.circle[Fe]=!0;const Me=3*Fe,Re=this.circleKeys[Fe];if(this._circlesCollide(pe[Me],pe[Me+1],pe[Me+2],Q.x,Q.y,Q.radius)&&(!O||O(Re))&&!je(Z,Re.overlapMode))return S.push(!0),!0}}}_forEachCell(l,h,m,y,C,S,R,O){const Q=this._convertToXCellCoord(l),K=this._convertToYCellCoord(h),Z=this._convertToXCellCoord(m),ee=this._convertToYCellCoord(y);for(let Ae=Q;Ae<=Z;Ae++)for(let pe=K;pe<=ee;pe++)if(C.call(this,l,h,m,y,this.xCellCount*pe+Ae,S,R,O))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,h,m,y,C,S){const R=y-l,O=C-h,Q=m+S;return Q*Q>R*R+O*O}_circleAndRectCollide(l,h,m,y,C,S,R){const O=(S-y)/2,Q=Math.abs(l-(y+O));if(Q>O+m)return!1;const K=(R-C)/2,Z=Math.abs(h-(C+K));if(Z>K+m)return!1;if(Q<=O||Z<=K)return!0;const ee=Q-O,Ae=Z-K;return ee*ee+Ae*Ae<=m*m}}function dt(x,l,h){const m=o.J();if(!x){const{vecSouth:Z,vecEast:ee}=ht(l),Ae=d();Ae[0]=ee[0],Ae[1]=ee[1],Ae[2]=Z[0],Ae[3]=Z[1],y=Ae,(K=(S=(C=Ae)[0])*(Q=C[3])-(O=C[2])*(R=C[1]))&&(y[0]=Q*(K=1/K),y[1]=-R*K,y[2]=-O*K,y[3]=S*K),m[0]=Ae[0],m[1]=Ae[1],m[4]=Ae[2],m[5]=Ae[3]}var y,C,S,R,O,Q,K;return o.L(m,m,[1/h,1/h,1]),m}function Ze(x,l,h,m){if(x){const y=o.J();if(!l){const{vecSouth:C,vecEast:S}=ht(h);y[0]=S[0],y[1]=S[1],y[4]=C[0],y[5]=C[1]}return o.L(y,y,[m,m,1]),y}return h.pixelsToClipSpaceMatrix}function ht(x){const l=Math.cos(x.rollInRadians),h=Math.sin(x.rollInRadians),m=Math.cos(x.pitchInRadians),y=Math.cos(x.bearingInRadians),C=Math.sin(x.bearingInRadians),S=o.ai();S[0]=-y*m*h-C*l,S[1]=-C*m*h+y*l;const R=o.aj(S);R<1e-9?o.ak(S):o.al(S,S,1/R);const O=o.ai();O[0]=y*m*l-C*h,O[1]=C*m*l+y*h;const Q=o.aj(O);return Q<1e-9?o.ak(O):o.al(O,O,1/Q),{vecEast:O,vecSouth:S}}function bt(x,l,h,m){let y;m?(y=[x,l,m(x,l),1],o.an(y,y,h)):(y=[x,l,0,1],zn(y,y,h));const C=y[3];return{point:new o.P(y[0]/C,y[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}function pt(x,l){return .5+x/l*.5}function We(x,l){return x.x>=-l[0]&&x.x<=l[0]&&x.y>=-l[1]&&x.y<=l[1]}function hr(x,l,h,m,y,C,S,R,O,Q,K,Z,ee){const Ae=h?x.textSizeData:x.iconSizeData,pe=o.ae(Ae,l.transform.zoom),Fe=[256/l.width*2+1,256/l.height*2+1],Me=h?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;Me.clear();const Re=x.lineVertexArray,Ne=h?x.text.placedSymbolArray:x.icon.placedSymbolArray,$e=l.transform.width/l.transform.height;let qe=!1;for(let Xe=0;Xe<Ne.length;Xe++){const tt=Ne.get(Xe);if(tt.hidden||tt.writingMode===o.af.vertical&&!qe){Bn(tt.numGlyphs,Me);continue}qe=!1;const it=new o.P(tt.anchorX,tt.anchorY),Et={getElevation:ee,pitchedLabelPlaneMatrix:m,lineVertexArray:Re,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:l.transform,tileAnchorPoint:it,unwrappedTileID:O,width:Q,height:K,translation:Z},Ct=en(tt.anchorX,tt.anchorY,Et);if(!We(Ct.point,Fe)){Bn(tt.numGlyphs,Me);continue}const Dt=pt(l.transform.cameraToCenterDistance,Ct.signedDistanceFromCamera),Ht=o.ag(Ae,pe,tt),Lt=C?Ht*l.transform.getPitchedTextCorrection(tt.anchorX,tt.anchorY,O)/Dt:Ht*Dt,dr=Nr({projectionContext:Et,pitchedLabelPlaneMatrixInverse:y,symbol:tt,fontSize:Lt,flip:!1,keepUpright:S,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:Me,aspectRatio:$e,rotateToLine:R});qe=dr.useVertical,(dr.notEnoughRoom||qe||dr.needsFlipping&&Nr({projectionContext:Et,pitchedLabelPlaneMatrixInverse:y,symbol:tt,fontSize:Lt,flip:!0,keepUpright:S,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:Me,aspectRatio:$e,rotateToLine:R}).notEnoughRoom)&&Bn(tt.numGlyphs,Me)}h?x.text.dynamicLayoutVertexBuffer.updateData(Me):x.icon.dynamicLayoutVertexBuffer.updateData(Me)}function sr(x,l,h,m,y,C,S,R){const O=C.glyphStartIndex+C.numGlyphs,Q=C.lineStartIndex,K=C.lineStartIndex+C.lineLength,Z=l.getoffsetX(C.glyphStartIndex),ee=l.getoffsetX(O-1),Ae=Sn(x*Z,h,m,y,C.segment,Q,K,R,S);if(!Ae)return null;const pe=Sn(x*ee,h,m,y,C.segment,Q,K,R,S);return pe?R.projectionCache.anyProjectionOccluded?null:{first:Ae,last:pe}:null}function rr(x,l,h,m){return x===o.af.horizontal&&Math.abs(h.y-l.y)>Math.abs(h.x-l.x)*m?{useVertical:!0}:(x===o.af.vertical?l.y<h.y:l.x>h.x)?{needsFlipping:!0}:null}function Nr(x){const{projectionContext:l,pitchedLabelPlaneMatrixInverse:h,symbol:m,fontSize:y,flip:C,keepUpright:S,glyphOffsetArray:R,dynamicLayoutVertexArray:O,aspectRatio:Q,rotateToLine:K}=x,Z=y/24,ee=m.lineOffsetX*Z,Ae=m.lineOffsetY*Z;let pe;if(m.numGlyphs>1){const Fe=m.glyphStartIndex+m.numGlyphs,Me=m.lineStartIndex,Re=m.lineStartIndex+m.lineLength,Ne=sr(Z,R,ee,Ae,C,m,K,l);if(!Ne)return{notEnoughRoom:!0};const $e=kr(Ne.first.point.x,Ne.first.point.y,l,h),qe=kr(Ne.last.point.x,Ne.last.point.y,l,h);if(S&&!C){const Xe=rr(m.writingMode,$e,qe,Q);if(Xe)return Xe}pe=[Ne.first];for(let Xe=m.glyphStartIndex+1;Xe<Fe-1;Xe++)pe.push(Sn(Z*R.getoffsetX(Xe),ee,Ae,C,m.segment,Me,Re,l,K));pe.push(Ne.last)}else{if(S&&!C){const Me=br(l.tileAnchorPoint.x,l.tileAnchorPoint.y,l).point,Re=m.lineStartIndex+m.segment+1,Ne=new o.P(l.lineVertexArray.getx(Re),l.lineVertexArray.gety(Re)),$e=br(Ne.x,Ne.y,l),qe=$e.signedDistanceFromCamera>0?$e.point:Rt(l.tileAnchorPoint,Ne,Me,1,l),Xe=kr(Me.x,Me.y,l,h),tt=kr(qe.x,qe.y,l,h),it=rr(m.writingMode,Xe,tt,Q);if(it)return it}const Fe=Sn(Z*R.getoffsetX(m.glyphStartIndex),ee,Ae,C,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,l,K);if(!Fe||l.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};pe=[Fe]}for(const Fe of pe)o.am(O,Fe.point,Fe.angle);return{}}function Rt(x,l,h,m,y){const C=x.add(x.sub(l)._unit()),S=br(C.x,C.y,y).point,R=h.sub(S);return h.add(R._mult(m/R.mag()))}function ir(x,l,h){const m=l.projectionCache;if(m.projections[x])return m.projections[x];const y=new o.P(l.lineVertexArray.getx(x),l.lineVertexArray.gety(x)),C=br(y.x,y.y,l);if(C.signedDistanceFromCamera>0)return m.projections[x]=C.point,m.anyProjectionOccluded=m.anyProjectionOccluded||C.isOccluded,C.point;const S=x-h.direction;return Rt(h.distanceFromAnchor===0?l.tileAnchorPoint:new o.P(l.lineVertexArray.getx(S),l.lineVertexArray.gety(S)),y,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,l)}function br(x,l,h){const m=x+h.translation[0],y=l+h.translation[1];let C;return h.pitchWithMap?(C=bt(m,y,h.pitchedLabelPlaneMatrix,h.getElevation),C.isOccluded=!1):(C=h.transform.projectTileCoordinates(m,y,h.unwrappedTileID,h.getElevation),C.point.x=(.5*C.point.x+.5)*h.width,C.point.y=(.5*-C.point.y+.5)*h.height),C}function kr(x,l,h,m){if(h.pitchWithMap){const y=[x,l,0,1];return o.an(y,y,m),h.transform.projectTileCoordinates(y[0]/y[3],y[1]/y[3],h.unwrappedTileID,h.getElevation).point}return{x:x/h.width*2-1,y:l/h.height*2-1}}function en(x,l,h){return h.transform.projectTileCoordinates(x,l,h.unwrappedTileID,h.getElevation)}function jr(x,l,h){return x._unit()._perp()._mult(l*h)}function Br(x,l,h,m,y,C,S,R,O){if(R.projectionCache.offsets[x])return R.projectionCache.offsets[x];const Q=h.add(l);if(x+O.direction<m||x+O.direction>=y)return R.projectionCache.offsets[x]=Q,Q;const K=ir(x+O.direction,R,O),Z=jr(K.sub(h),S,O.direction),ee=h.add(Z),Ae=K.add(Z);return R.projectionCache.offsets[x]=o.ao(C,Q,ee,Ae)||Q,R.projectionCache.offsets[x]}function Sn(x,l,h,m,y,C,S,R,O){const Q=m?x-l:x+l;let K=Q>0?1:-1,Z=0;m&&(K*=-1,Z=Math.PI),K<0&&(Z+=Math.PI);let ee,Ae=K>0?C+y:C+y+1;R.projectionCache.cachedAnchorPoint?ee=R.projectionCache.cachedAnchorPoint:(ee=br(R.tileAnchorPoint.x,R.tileAnchorPoint.y,R).point,R.projectionCache.cachedAnchorPoint=ee);let pe,Fe,Me=ee,Re=ee,Ne=0,$e=0;const qe=Math.abs(Q),Xe=[];let tt;for(;Ne+$e<=qe;){if(Ae+=K,Ae<C||Ae>=S)return null;Ne+=$e,Re=Me,Fe=pe;const Ct={absOffsetX:qe,direction:K,distanceFromAnchor:Ne,previousVertex:Re};if(Me=ir(Ae,R,Ct),h===0)Xe.push(Re),tt=Me.sub(Re);else{let Dt;const Ht=Me.sub(Re);Dt=Ht.mag()===0?jr(ir(Ae+K,R,Ct).sub(Me),h,K):jr(Ht,h,K),Fe||(Fe=Re.add(Dt)),pe=Br(Ae,Dt,Me,C,S,Fe,h,R,Ct),Xe.push(Fe),tt=pe.sub(Fe)}$e=tt.mag()}const it=tt._mult((qe-Ne)/$e)._add(Fe||Re),Et=Z+Math.atan2(Me.y-Re.y,Me.x-Re.x);return Xe.push(it),{point:it,angle:O?Et:0,path:Xe}}const Ti=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Bn(x,l){for(let h=0;h<x;h++){const m=l.length;l.resize(m+4),l.float32.set(Ti,3*m)}}function zn(x,l,h){const m=l[0],y=l[1];return x[0]=h[0]*m+h[4]*y+h[12],x[1]=h[1]*m+h[5]*y+h[13],x[3]=h[3]*m+h[7]*y+h[15],x}const Cn=100;class yi{constructor(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new lt(l.width+200,l.height+200,25),m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new lt(l.width+200,l.height+200,25);this.transform=l,this.grid=h,this.ignoredGrid=m,this.pitchFactor=Math.cos(l.pitch*Math.PI/180)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Cn,this.screenBottomBoundary=l.height+Cn,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,h,m,y,C,S,R,O,Q,K,Z,ee){const Ae=this.projectAndGetPerspectiveRatio(l.anchorPointX+O[0],l.anchorPointY+O[1],C,K,ee),pe=m*Ae.perspectiveRatio;let Fe;if(S||R)Fe=this._projectCollisionBox(l,pe,y,C,S,R,O,Ae,K,Z,ee);else{const tt=Ae.x+(Z?Z.x*pe:0),it=Ae.y+(Z?Z.y*pe:0);Fe={allPointsOccluded:!1,box:[tt+l.x1*pe,it+l.y1*pe,tt+l.x2*pe,it+l.y2*pe]}}const[Me,Re,Ne,$e]=Fe.box,qe=S?Fe.allPointsOccluded:Ae.isOccluded;let Xe=qe;return Xe||(Xe=Ae.perspectiveRatio<this.perspectiveRatioCutoff),Xe||(Xe=!this.isInsideGrid(Me,Re,Ne,$e)),Xe||h!=="always"&&this.grid.hitTest(Me,Re,Ne,$e,h,Q)?{box:[Me,Re,Ne,$e],placeable:!1,offscreen:!1,occluded:qe}:{box:[Me,Re,Ne,$e],placeable:!0,offscreen:this.isOffscreen(Me,Re,Ne,$e),occluded:qe}}placeCollisionCircles(l,h,m,y,C,S,R,O,Q,K,Z,ee,Ae,pe){const Fe=[],Me=new o.P(h.anchorX,h.anchorY),Re=this.getPerspectiveRatio(Me.x,Me.y,S,pe),Ne=(Q?C*this.transform.getPitchedTextCorrection(h.anchorX,h.anchorY,S)/Re:C*Re)/o.at,$e={getElevation:pe,pitchedLabelPlaneMatrix:R,lineVertexArray:m,pitchWithMap:Q,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Me,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:Ae},qe=sr(Ne,y,h.lineOffsetX*Ne,h.lineOffsetY*Ne,!1,h,!1,$e);let Xe=!1,tt=!1,it=!0;if(qe){const Et=.5*Z*Re+ee,Ct=new o.P(-100,-100),Dt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ht=new Ue,Lt=qe.first,dr=qe.last;let Ar=[];for(let sn=Lt.path.length-1;sn>=1;sn--)Ar.push(Lt.path[sn]);for(let sn=1;sn<dr.path.length;sn++)Ar.push(dr.path[sn]);const Kt=2.5*Et;if(Q){const sn=this.projectPathToScreenSpace(Ar,$e);Ar=sn.some(Mn=>Mn.signedDistanceFromCamera<=0)?[]:sn.map(Mn=>Mn.point)}let xr=[];if(Ar.length>0){const sn=Ar[0].clone(),Mn=Ar[0].clone();for(let gi=1;gi<Ar.length;gi++)sn.x=Math.min(sn.x,Ar[gi].x),sn.y=Math.min(sn.y,Ar[gi].y),Mn.x=Math.max(Mn.x,Ar[gi].x),Mn.y=Math.max(Mn.y,Ar[gi].y);xr=sn.x>=Ct.x&&Mn.x<=Dt.x&&sn.y>=Ct.y&&Mn.y<=Dt.y?[Ar]:Mn.x<Ct.x||sn.x>Dt.x||Mn.y<Ct.y||sn.y>Dt.y?[]:o.ap([Ar],Ct.x,Ct.y,Dt.x,Dt.y)}for(const sn of xr){Ht.reset(sn,.25*Et);let Mn=0;Mn=Ht.length<=.5*Et?1:Math.ceil(Ht.paddedLength/Kt)+1;for(let gi=0;gi<Mn;gi++){const ei=gi/Math.max(Mn-1,1),mi=Ht.lerp(ei),Dn=mi.x+Cn,qn=mi.y+Cn;Fe.push(Dn,qn,Et,0);const Kn=Dn-Et,Xs=qn-Et,es=Dn+Et,cs=qn+Et;if(it=it&&this.isOffscreen(Kn,Xs,es,cs),tt=tt||this.isInsideGrid(Kn,Xs,es,cs),l!=="always"&&this.grid.hitTestCircle(Dn,qn,Et,l,K)&&(Xe=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Xe}}}}return{circles:!O&&Xe||!tt||Re<this.perspectiveRatioCutoff?[]:Fe,offscreen:it,collisionDetected:Xe}}projectPathToScreenSpace(l,h){const m=function(y,C){const S=o.J();return o.ah(S,C.pitchedLabelPlaneMatrix),y.map(R=>{const O=bt(R.x,R.y,S,C.getElevation),Q=C.transform.projectTileCoordinates(O.point.x,O.point.y,C.unwrappedTileID,C.getElevation);return Q.point.x=(.5*Q.point.x+.5)*C.width,Q.point.y=(.5*-Q.point.y+.5)*C.height,Q})}(l,h);return function(y){let C=0,S=0,R=0,O=0;for(let Q=0;Q<y.length;Q++)y[Q].isOccluded?(R=Q+1,O=0):(O++,O>S&&(S=O,C=R));return y.slice(C,C+S)}(m)}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let m=1/0,y=1/0,C=-1/0,S=-1/0;for(const K of l){const Z=new o.P(K.x+Cn,K.y+Cn);m=Math.min(m,Z.x),y=Math.min(y,Z.y),C=Math.max(C,Z.x),S=Math.max(S,Z.y),h.push(Z)}const R=this.grid.query(m,y,C,S).concat(this.ignoredGrid.query(m,y,C,S)),O={},Q={};for(const K of R){const Z=K.key;if(O[Z.bucketInstanceId]===void 0&&(O[Z.bucketInstanceId]={}),O[Z.bucketInstanceId][Z.featureIndex])continue;const ee=[new o.P(K.x1,K.y1),new o.P(K.x2,K.y1),new o.P(K.x2,K.y2),new o.P(K.x1,K.y2)];o.aq(h,ee)&&(O[Z.bucketInstanceId][Z.featureIndex]=!0,Q[Z.bucketInstanceId]===void 0&&(Q[Z.bucketInstanceId]=[]),Q[Z.bucketInstanceId].push(Z.featureIndex))}return Q}insertCollisionBox(l,h,m,y,C,S){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:C,collisionGroupID:S,overlapMode:h},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,h,m,y,C,S){const R=m?this.ignoredGrid:this.grid,O={bucketInstanceId:y,featureIndex:C,collisionGroupID:S,overlapMode:h};for(let Q=0;Q<l.length;Q+=4)R.insertCircle(O,l[Q],l[Q+1],l[Q+2])}projectAndGetPerspectiveRatio(l,h,m,y,C){if(C){let S;y?(S=[l,h,y(l,h),1],o.an(S,S,C)):(S=[l,h,0,1],zn(S,S,C));const R=S[3];return{x:(S[0]/R+1)/2*this.transform.width+Cn,y:(-S[1]/R+1)/2*this.transform.height+Cn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/R*.5,isOccluded:!1,signedDistanceFromCamera:R}}{const S=this.transform.projectTileCoordinates(l,h,m,y);return{x:(S.point.x+1)/2*this.transform.width+Cn,y:(1-S.point.y)/2*this.transform.height+Cn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5,isOccluded:S.isOccluded,signedDistanceFromCamera:S.signedDistanceFromCamera}}}getPerspectiveRatio(l,h,m,y){const C=this.transform.projectTileCoordinates(l,h,m,y);return .5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5}isOffscreen(l,h,m,y){return m<Cn||l>=this.screenRightBoundary||y<Cn||h>this.screenBottomBoundary}isInsideGrid(l,h,m,y){return m>=0&&l<this.gridRightBoundary&&y>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const l=o.ar([]);return o.K(l,l,[-100,-100,0]),l}_projectCollisionBox(l,h,m,y,C,S,R,O,Q,K,Z){let ee=1,Ae=0,pe=0,Fe=1;const Me=l.anchorPointX+R[0],Re=l.anchorPointY+R[1];if(S&&!C){const Ar=this.projectAndGetPerspectiveRatio(Me+1,Re,y,Q,Z),Kt=Ar.x-O.x,xr=Math.atan((Ar.y-O.y)/Kt)+(Kt<0?Math.PI:0),sn=Math.sin(xr),Mn=Math.cos(xr);ee=Mn,Ae=sn,pe=-sn,Fe=Mn}else if(!S&&C){const Ar=ht(this.transform);ee=Ar.vecEast[0],Ae=Ar.vecEast[1],pe=Ar.vecSouth[0],Fe=Ar.vecSouth[1]}let Ne=O.x,$e=O.y,qe=h;C&&(Ne=Me,$e=Re,qe=Math.pow(2,-(this.transform.zoom-m.overscaledZ)),qe*=this.transform.getPitchedTextCorrection(Me,Re,y),K||(qe*=o.ac(.5+O.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),K&&(Ne+=ee*K.x*qe+pe*K.y*qe,$e+=Ae*K.x*qe+Fe*K.y*qe);const Xe=l.x1*qe,tt=l.x2*qe,it=(Xe+tt)/2,Et=l.y1*qe,Ct=l.y2*qe,Dt=(Et+Ct)/2,Ht=[{offsetX:Xe,offsetY:Et},{offsetX:it,offsetY:Et},{offsetX:tt,offsetY:Et},{offsetX:tt,offsetY:Dt},{offsetX:tt,offsetY:Ct},{offsetX:it,offsetY:Ct},{offsetX:Xe,offsetY:Ct},{offsetX:Xe,offsetY:Dt}];let Lt=[];for(const{offsetX:Ar,offsetY:Kt}of Ht)Lt.push(new o.P(Ne+ee*Ar+pe*Kt,$e+Ae*Ar+Fe*Kt));let dr=!1;if(C){const Ar=Lt.map(Kt=>this.projectAndGetPerspectiveRatio(Kt.x,Kt.y,y,Q,Z));dr=Ar.some(Kt=>!Kt.isOccluded),Lt=Ar.map(Kt=>new o.P(Kt.x,Kt.y))}else dr=!0;return{box:o.as(Lt),allPointsOccluded:!dr}}}class Un{constructor(l,h,m,y){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class ba{constructor(l,h,m,y,C){this.text=new Un(l?l.text:null,h,m,C),this.icon=new Un(l?l.icon:null,h,y,C)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ke{constructor(l,h,m){this.text=l,this.icon=h,this.skipFade=m}}class Pr{constructor(l,h,m,y,C){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=C}}class cr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:m=>m.collisionGroupID===h}}return this.collisionGroups[l]}}function pn(x,l,h,m,y){const{horizontalAlign:C,verticalAlign:S}=o.az(x);return new o.P(-(C-.5)*l+m[0]*y,-(S-.5)*h+m[1]*y)}class di{constructor(l,h,m,y,C){this.transform=l.clone(),this.terrain=h,this.collisionIndex=new yi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new cr(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(l){const h=this.terrain;return h?(m,y)=>h.getElevation(l,m,y):null}getBucketParts(l,h,m,y){const C=m.getBucket(h),S=m.latestFeatureIndex;if(!C||!S||h.id!==C.layerIds[0])return;const R=m.collisionBoxArray,O=C.layers[0].layout,Q=C.layers[0].paint,K=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),Z=m.tileSize/o.Y,ee=m.tileID.toUnwrapped(),Ae=O.get("text-rotation-alignment")==="map",pe=o.au(m,1,this.transform.zoom),Fe=o.av(this.collisionIndex.transform,m,Q.get("text-translate"),Q.get("text-translate-anchor")),Me=o.av(this.collisionIndex.transform,m,Q.get("icon-translate"),Q.get("icon-translate-anchor")),Re=dt(Ae,this.transform,pe);this.retainedQueryData[C.bucketInstanceId]=new Pr(C.bucketInstanceId,S,C.sourceLayerIndex,C.index,m.tileID);const Ne={bucket:C,layout:O,translationText:Fe,translationIcon:Me,unwrappedTileID:ee,pitchedLabelPlaneMatrix:Re,scale:K,textPixelRatio:Z,holdingForFade:m.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.ae(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(y)for(const $e of C.sortKeyRanges){const{sortKey:qe,symbolInstanceStart:Xe,symbolInstanceEnd:tt}=$e;l.push({sortKey:qe,symbolInstanceStart:Xe,symbolInstanceEnd:tt,parameters:Ne})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(l,h,m,y,C,S,R,O,Q,K,Z,ee,Ae,pe,Fe,Me,Re,Ne,$e,qe){const Xe=o.aw[l.textAnchor],tt=[l.textOffset0,l.textOffset1],it=pn(Xe,m,y,tt,C),Et=this.collisionIndex.placeCollisionBox(h,ee,O,Q,K,R,S,Me,Z.predicate,$e,it,qe);if((!Ne||this.collisionIndex.placeCollisionBox(Ne,ee,O,Q,K,R,S,Re,Z.predicate,$e,it,qe).placeable)&&Et.placeable){let Ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]&&this.prevPlacement.placements[Ae.crossTileID]&&this.prevPlacement.placements[Ae.crossTileID].text&&(Ct=this.prevPlacement.variableOffsets[Ae.crossTileID].anchor),Ae.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Ae.crossTileID]={textOffset:tt,width:m,height:y,anchor:Xe,textBoxScale:C,prevAnchor:Ct},this.markUsedJustification(pe,Xe,Ae,Fe),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,Fe,Ae),this.placedOrientations[Ae.crossTileID]=Fe),{shift:it,placedGlyphBoxes:Et}}}placeLayerBucketPart(l,h,m){const{bucket:y,layout:C,translationText:S,translationIcon:R,unwrappedTileID:O,pitchedLabelPlaneMatrix:Q,textPixelRatio:K,holdingForFade:Z,collisionBoxArray:ee,partiallyEvaluatedTextSize:Ae,collisionGroup:pe}=l.parameters,Fe=C.get("text-optional"),Me=C.get("icon-optional"),Re=o.ax(C,"text-overlap","text-allow-overlap"),Ne=Re==="always",$e=o.ax(C,"icon-overlap","icon-allow-overlap"),qe=$e==="always",Xe=C.get("text-rotation-alignment")==="map",tt=C.get("text-pitch-alignment")==="map",it=C.get("icon-text-fit")!=="none",Et=C.get("symbol-z-order")==="viewport-y",Ct=Ne&&(qe||!y.hasIconData()||Me),Dt=qe&&(Ne||!y.hasTextData()||Fe);!y.collisionArrays&&ee&&y.deserializeCollisionBoxes(ee);const Ht=this.retainedQueryData[y.bucketInstanceId].tileID,Lt=this._getTerrainElevationFunc(Ht),dr=this.transform.getFastPathSimpleProjectionMatrix(Ht),Ar=(Kt,xr,sn)=>{var Mn,gi;if(h[Kt.crossTileID])return;if(Z)return void(this.placements[Kt.crossTileID]=new Ke(!1,!1,!1));let ei=!1,mi=!1,Dn=!0,qn=null,Kn={box:null,placeable:!1,offscreen:null,occluded:!1},Xs={placeable:!1},es=null,cs=null,ds=null,qa=0,sa=0,ts=0;xr.textFeatureIndex?qa=xr.textFeatureIndex:Kt.useRuntimeCollisionCircles&&(qa=Kt.featureIndex),xr.verticalTextFeatureIndex&&(sa=xr.verticalTextFeatureIndex);const ho=xr.textBox;if(ho){const To=ci=>{let zi=o.af.horizontal;if(y.allowVerticalPlacement&&!ci&&this.prevPlacement){const Ka=this.prevPlacement.placedOrientations[Kt.crossTileID];Ka&&(this.placedOrientations[Kt.crossTileID]=Ka,zi=Ka,this.markUsedOrientation(y,zi,Kt))}return zi},Ma=(ci,zi)=>{if(y.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&xr.verticalTextBox){for(const Ka of y.writingModes)if(Ka===o.af.vertical?(Kn=zi(),Xs=Kn):Kn=ci(),Kn&&Kn.placeable)break}else Kn=ci()},Vo=Kt.textAnchorOffsetStartIndex,Eo=Kt.textAnchorOffsetEndIndex;if(Eo===Vo){const ci=(zi,Ka)=>{const qi=this.collisionIndex.placeCollisionBox(zi,Re,K,Ht,O,tt,Xe,S,pe.predicate,Lt,void 0,dr);return qi&&qi.placeable&&(this.markUsedOrientation(y,Ka,Kt),this.placedOrientations[Kt.crossTileID]=Ka),qi};Ma(()=>ci(ho,o.af.horizontal),()=>{const zi=xr.verticalTextBox;return y.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&zi?ci(zi,o.af.vertical):{box:null,offscreen:null}}),To(Kn&&Kn.placeable)}else{let ci=o.aw[(gi=(Mn=this.prevPlacement)===null||Mn===void 0?void 0:Mn.variableOffsets[Kt.crossTileID])===null||gi===void 0?void 0:gi.anchor];const zi=(qi,z3,Fb)=>{const i_=qi.x2-qi.x1,Rb=qi.y2-qi.y1,aA=Kt.textBoxScale,lA=it&&$e==="never"?z3:null;let wh=null,Lb=Re==="never"?1:2,tg="never";ci&&Lb++;for(let s_=0;s_<Lb;s_++){for(let o_=Vo;o_<Eo;o_++){const a_=y.textAnchorOffsets.get(o_);if(ci&&a_.textAnchor!==ci)continue;const l_=this.attemptAnchorPlacement(a_,qi,i_,Rb,aA,Xe,tt,K,Ht,O,pe,tg,Kt,y,Fb,S,R,lA,Lt);if(l_&&(wh=l_.placedGlyphBoxes,wh&&wh.placeable))return ei=!0,qn=l_.shift,wh}ci?ci=null:tg=Re}return m&&!wh&&(wh={box:this.collisionIndex.placeCollisionBox(ho,"always",K,Ht,O,tt,Xe,S,pe.predicate,Lt,void 0,dr).box,offscreen:!1,placeable:!1,occluded:!1}),wh};Ma(()=>zi(ho,xr.iconBox,o.af.horizontal),()=>{const qi=xr.verticalTextBox;return y.allowVerticalPlacement&&(!Kn||!Kn.placeable)&&Kt.numVerticalGlyphVertices>0&&qi?zi(qi,xr.verticalIconBox,o.af.vertical):{box:null,occluded:!0,offscreen:null}}),Kn&&(ei=Kn.placeable,Dn=Kn.offscreen);const Ka=To(Kn&&Kn.placeable);if(!ei&&this.prevPlacement){const qi=this.prevPlacement.variableOffsets[Kt.crossTileID];qi&&(this.variableOffsets[Kt.crossTileID]=qi,this.markUsedJustification(y,qi.anchor,Kt,Ka))}}}if(es=Kn,ei=es&&es.placeable,Dn=es&&es.offscreen,Kt.useRuntimeCollisionCircles){const To=y.text.placedSymbolArray.get(Kt.centerJustifiedTextSymbolIndex),Ma=o.ag(y.textSizeData,Ae,To),Vo=C.get("text-padding");cs=this.collisionIndex.placeCollisionCircles(Re,To,y.lineVertexArray,y.glyphOffsetArray,Ma,O,Q,m,tt,pe.predicate,Kt.collisionCircleDiameter,Vo,S,Lt),cs.circles.length&&cs.collisionDetected&&!m&&o.w("Collisions detected, but collision boxes are not shown"),ei=Ne||cs.circles.length>0&&!cs.collisionDetected,Dn=Dn&&cs.offscreen}if(xr.iconFeatureIndex&&(ts=xr.iconFeatureIndex),xr.iconBox){const To=Ma=>this.collisionIndex.placeCollisionBox(Ma,$e,K,Ht,O,tt,Xe,R,pe.predicate,Lt,it&&qn?qn:void 0,dr);Xs&&Xs.placeable&&xr.verticalIconBox?(ds=To(xr.verticalIconBox),mi=ds.placeable):(ds=To(xr.iconBox),mi=ds.placeable),Dn=Dn&&ds.offscreen}const Ia=Fe||Kt.numHorizontalGlyphVertices===0&&Kt.numVerticalGlyphVertices===0,Tc=Me||Kt.numIconVertices===0;Ia||Tc?Tc?Ia||(mi=mi&&ei):ei=mi&&ei:mi=ei=mi&&ei;const Ec=mi&&ds.placeable;if(ei&&es.placeable&&this.collisionIndex.insertCollisionBox(es.box,Re,C.get("text-ignore-placement"),y.bucketInstanceId,Xs&&Xs.placeable&&sa?sa:qa,pe.ID),Ec&&this.collisionIndex.insertCollisionBox(ds.box,$e,C.get("icon-ignore-placement"),y.bucketInstanceId,ts,pe.ID),cs&&ei&&this.collisionIndex.insertCollisionCircles(cs.circles,Re,C.get("text-ignore-placement"),y.bucketInstanceId,qa,pe.ID),m&&this.storeCollisionData(y.bucketInstanceId,sn,xr,es,ds,cs),Kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Kt.crossTileID]=new Ke((ei||Ct)&&!(es!=null&&es.occluded),(mi||Dt)&&!(ds!=null&&ds.occluded),Dn||y.justReloaded),h[Kt.crossTileID]=!0};if(Et){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Kt=y.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let xr=Kt.length-1;xr>=0;--xr){const sn=Kt[xr];Ar(y.symbolInstances.get(sn),y.collisionArrays[sn],sn)}}else for(let Kt=l.symbolInstanceStart;Kt<l.symbolInstanceEnd;Kt++)Ar(y.symbolInstances.get(Kt),y.collisionArrays[Kt],Kt);y.justReloaded=!1}storeCollisionData(l,h,m,y,C,S){if(m.textBox||m.iconBox){let R,O;this.collisionBoxArrays.has(l)?R=this.collisionBoxArrays.get(l):(R=new Map,this.collisionBoxArrays.set(l,R)),R.has(h)?O=R.get(h):(O={text:null,icon:null},R.set(h,O)),m.textBox&&(O.text=y.box),m.iconBox&&(O.icon=C.box)}if(S){let R=this.collisionCircleArrays[l];R===void 0&&(R=this.collisionCircleArrays[l]=[]);for(let O=0;O<S.circles.length;O+=4)R.push(S.circles[O+0]-Cn),R.push(S.circles[O+1]-Cn),R.push(S.circles[O+2]),R.push(S.collisionDetected?1:0)}}markUsedJustification(l,h,m,y){let C;C=y===o.af.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[o.ay(h)];const S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of S)R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=C>=0&&R!==C?0:m.crossTileID)}markUsedOrientation(l,h,m){const y=h===o.af.horizontal||h===o.af.horizontalOnly?h:0,C=h===o.af.vertical?h:0,S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of S)l.text.placedSymbolArray.get(R).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let m=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const y=h?h.symbolFadeChange(l):1,C=h?h.opacities:{},S=h?h.variableOffsets:{},R=h?h.placedOrientations:{};for(const O in this.placements){const Q=this.placements[O],K=C[O];K?(this.opacities[O]=new ba(K,y,Q.text,Q.icon),m=m||Q.text!==K.text.placed||Q.icon!==K.icon.placed):(this.opacities[O]=new ba(null,y,Q.text,Q.icon,Q.skipFade),m=m||Q.text||Q.icon)}for(const O in C){const Q=C[O];if(!this.opacities[O]){const K=new ba(Q,y,!1,!1);K.isHidden()||(this.opacities[O]=K,m=m||Q.text.placed||Q.icon.placed)}}for(const O in S)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=S[O]);for(const O in R)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=R[O]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)}updateLayerOpacities(l,h){const m={};for(const y of h){const C=y.getBucket(l);C&&y.latestFeatureIndex&&l.id===C.layerIds[0]&&this.updateBucketOpacities(C,y.tileID,m,y.collisionBoxArray)}}updateBucketOpacities(l,h,m,y){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const C=l.layers[0],S=C.layout,R=new ba(null,0,!1,!1,!0),O=S.get("text-allow-overlap"),Q=S.get("icon-allow-overlap"),K=C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=S.get("text-rotation-alignment")==="map",ee=S.get("text-pitch-alignment")==="map",Ae=S.get("icon-text-fit")!=="none",pe=new ba(null,0,O&&(Q||!l.hasIconData()||S.get("icon-optional")),Q&&(O||!l.hasTextData()||S.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const Fe=(Re,Ne,$e)=>{for(let qe=0;qe<Ne/4;qe++)Re.opacityVertexArray.emplaceBack($e);Re.hasVisibleVertices=Re.hasVisibleVertices||$e!==Ml},Me=this.collisionBoxArrays.get(l.bucketInstanceId);for(let Re=0;Re<l.symbolInstances.length;Re++){const Ne=l.symbolInstances.get(Re),{numHorizontalGlyphVertices:$e,numVerticalGlyphVertices:qe,crossTileID:Xe}=Ne;let tt=this.opacities[Xe];m[Xe]?tt=R:tt||(tt=pe,this.opacities[Xe]=tt),m[Xe]=!0;const it=Ne.numIconVertices>0,Et=this.placedOrientations[Ne.crossTileID],Ct=Et===o.af.vertical,Dt=Et===o.af.horizontal||Et===o.af.horizontalOnly;if($e>0||qe>0){const Lt=lc(tt.text);Fe(l.text,$e,Ct?Ml:Lt),Fe(l.text,qe,Dt?Ml:Lt);const dr=tt.text.isHidden();[Ne.rightJustifiedTextSymbolIndex,Ne.centerJustifiedTextSymbolIndex,Ne.leftJustifiedTextSymbolIndex].forEach(xr=>{xr>=0&&(l.text.placedSymbolArray.get(xr).hidden=dr||Ct?1:0)}),Ne.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Ne.verticalPlacedTextSymbolIndex).hidden=dr||Dt?1:0);const Ar=this.variableOffsets[Ne.crossTileID];Ar&&this.markUsedJustification(l,Ar.anchor,Ne,Et);const Kt=this.placedOrientations[Ne.crossTileID];Kt&&(this.markUsedJustification(l,"left",Ne,Kt),this.markUsedOrientation(l,Kt,Ne))}if(it){const Lt=lc(tt.icon),dr=!(Ae&&Ne.verticalPlacedIconSymbolIndex&&Ct);Ne.placedIconSymbolIndex>=0&&(Fe(l.icon,Ne.numIconVertices,dr?Lt:Ml),l.icon.placedSymbolArray.get(Ne.placedIconSymbolIndex).hidden=tt.icon.isHidden()),Ne.verticalPlacedIconSymbolIndex>=0&&(Fe(l.icon,Ne.numVerticalIconVertices,dr?Ml:Lt),l.icon.placedSymbolArray.get(Ne.verticalPlacedIconSymbolIndex).hidden=tt.icon.isHidden())}const Ht=Me&&Me.has(Re)?Me.get(Re):{text:null,icon:null};if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Lt=l.collisionArrays[Re];if(Lt){let dr=new o.P(0,0);if(Lt.textBox||Lt.verticalTextBox){let Ar=!0;if(K){const Kt=this.variableOffsets[Xe];Kt?(dr=pn(Kt.anchor,Kt.width,Kt.height,Kt.textOffset,Kt.textBoxScale),Z&&dr._rotate(ee?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ar=!1}if(Lt.textBox||Lt.verticalTextBox){let Kt;Lt.textBox&&(Kt=Ct),Lt.verticalTextBox&&(Kt=Dt),As(l.textCollisionBox.collisionVertexArray,tt.text.placed,!Ar||Kt,Ht.text,dr.x,dr.y)}}if(Lt.iconBox||Lt.verticalIconBox){const Ar=!!(!Dt&&Lt.verticalIconBox);let Kt;Lt.iconBox&&(Kt=Ar),Lt.verticalIconBox&&(Kt=!Ar),As(l.iconCollisionBox.collisionVertexArray,tt.icon.placed,Kt,Ht.icon,Ae?dr.x:0,Ae?dr.y:0)}}}}if(l.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);l.bucketInstanceId in this.collisionCircleArrays&&(l.collisionCircleArray=this.collisionCircleArrays[l.bucketInstanceId],delete this.collisionCircleArrays[l.bucketInstanceId])}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,h){const m=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*m>l}setStale(){this.stale=!0}}function As(x,l,h,m,y,C){m&&m.length!==0||(m=[0,0,0,0]);const S=m[0]-Cn,R=m[1]-Cn,O=m[2]-Cn,Q=m[3]-Cn;x.emplaceBack(l?1:0,h?1:0,y||0,C||0,S,R),x.emplaceBack(l?1:0,h?1:0,y||0,C||0,O,R),x.emplaceBack(l?1:0,h?1:0,y||0,C||0,O,Q),x.emplaceBack(l?1:0,h?1:0,y||0,C||0,S,Q)}const li=Math.pow(2,25),xs=Math.pow(2,24),vo=Math.pow(2,17),ss=Math.pow(2,16),oh=Math.pow(2,9),ef=Math.pow(2,8),tf=Math.pow(2,1);function lc(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const l=x.placed?1:0,h=Math.floor(127*x.opacity);return h*li+l*xs+h*vo+l*ss+h*oh+l*ef+h*tf+l}const Ml=0;class Di{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,h,m,y,C){const S=this._bucketParts;for(;this._currentTileIndex<l.length;)if(h.getBucketParts(S,y,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((R,O)=>R.sortKey-O.sortKey));this._currentPartIndex<S.length;)if(h.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,C())return!0;return!1}}class $h{constructor(l,h,m,y,C,S,R,O){this.placement=new di(l,h,S,R,O),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(l,h,m){const y=w.now(),C=()=>!this._forceFullPlacement&&w.now()-y>2;for(;this._currentPlacementIndex>=0;){const S=h[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=R)&&(!S.maxzoom||S.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Di(S)),this._inProgressLayer.continuePlacement(m[S.source],this.placement,this._showCollisionBoxes,S,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const ll=512/o.Y/2;class ah{constructor(l,h,m){this.tileID=l,this.bucketInstanceId=m,this._symbolsByKey={};const y=new Map;for(let C=0;C<h.length;C++){const S=h.get(C),R=S.key,O=y.get(R);O?O.push(S):y.set(R,[S])}for(const[C,S]of y){const R={positions:S.map(O=>({x:Math.floor(O.anchorX*ll),y:Math.floor(O.anchorY*ll)})),crossTileIDs:S.map(O=>O.crossTileID)};if(R.positions.length>128){const O=new o.aA(R.positions.length,16,Uint16Array);for(const{x:Q,y:K}of R.positions)O.add(Q,K);O.finish(),delete R.positions,R.index=O}this._symbolsByKey[C]=R}}getScaledCoordinates(l,h){const{x:m,y,z:C}=this.tileID.canonical,{x:S,y:R,z:O}=h.canonical,Q=ll/Math.pow(2,O-C),K=(R*o.Y+l.anchorY)*Q,Z=y*o.Y*ll;return{x:Math.floor((S*o.Y+l.anchorX)*Q-m*o.Y*ll),y:Math.floor(K-Z)}}findMatches(l,h,m){const y=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let C=0;C<l.length;C++){const S=l.get(C);if(S.crossTileID)continue;const R=this._symbolsByKey[S.key];if(!R)continue;const O=this.getScaledCoordinates(S,h);if(R.index){const Q=R.index.range(O.x-y,O.y-y,O.x+y,O.y+y).sort();for(const K of Q){const Z=R.crossTileIDs[K];if(!m[Z]){m[Z]=!0,S.crossTileID=Z;break}}}else if(R.positions)for(let Q=0;Q<R.positions.length;Q++){const K=R.positions[Q],Z=R.crossTileIDs[Q];if(Math.abs(K.x-O.x)<=y&&Math.abs(K.y-O.y)<=y&&!m[Z]){m[Z]=!0,S.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(l=>{let{crossTileIDs:h}=l;return h})}}class cc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const h=Math.round((l-this.lng)/360);if(h!==0)for(const m in this.indexes){const y=this.indexes[m],C={};for(const S in y){const R=y[S];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+h),C[R.tileID.key]=R}this.indexes[m]=C}this.lng=l}addBucket(l,h,m){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const y=this.usedCrossTileIDs[l.overscaledZ];for(const C in this.indexes){const S=this.indexes[C];if(Number(C)>l.overscaledZ)for(const R in S){const O=S[R];O.tileID.isChildOf(l)&&O.findMatches(h.symbolInstances,l,y)}else{const R=S[l.scaledTo(Number(C)).key];R&&R.findMatches(h.symbolInstances,l,y)}}for(let C=0;C<h.symbolInstances.length;C++){const S=h.symbolInstances.get(C);S.crossTileID||(S.crossTileID=m.generate(),y[S.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new ah(l,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(l,h){for(const m of h.getCrossTileIDsLists())for(const y of m)delete this.usedCrossTileIDs[l][y]}removeStaleBuckets(l){let h=!1;for(const m in this.indexes){const y=this.indexes[m];for(const C in y)l[y[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[C]),delete y[C],h=!0)}return h}}class Vs{constructor(){this.layerIndexes={},this.crossTileIDs=new cc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,h,m){let y=this.layerIndexes[l.id];y===void 0&&(y=this.layerIndexes[l.id]=new rf);let C=!1;const S={};y.handleWrapJump(m);for(const R of h){const O=R.getBucket(l);O&&l.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(R.tileID,O,this.crossTileIDs)&&(C=!0),S[O.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(C=!0),C}pruneUnusedLayers(l){const h={};l.forEach(m=>{h[m]=!0});for(const m in this.layerIndexes)h[m]||delete this.layerIndexes[m]}}var uc="void main() {fragColor=vec4(1.0);}";const Ni={prelude:an(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:an("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:an("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:an(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:an(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:an(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:an(uc,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:an(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:an(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:an("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:an("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:an("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:an(uc,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:an(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:an(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:an(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:an(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:an(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:an(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:an(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:an(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:an(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:an(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:an(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:an(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:an(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:an(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:an(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:an(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:an("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:an("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:an("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:an("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:an(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:an("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function an(x,l){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=l.match(/in ([\w]+) ([\w]+)/g),y=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=C?C.concat(y):y,R={};return{fragmentSource:x=x.replace(h,(O,Q,K,Z,ee)=>(R[ee]=!0,Q==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
in ${K} ${Z} ${ee};
#else
uniform ${K} ${Z} u_${ee};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ee}
    ${K} ${Z} ${ee} = u_${ee};
#endif
`)),vertexSource:l=l.replace(h,(O,Q,K,Z,ee)=>{const Ae=Z==="float"?"vec2":"vec4",pe=ee.match(/color/)?"color":Ae;return R[ee]?Q==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
in ${K} ${Ae} a_${ee};
out ${K} ${Z} ${ee};
#else
uniform ${K} ${Z} u_${ee};
#endif
`:pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = a_${ee};
#else
    ${K} ${Z} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = unpack_mix_${pe}(a_${ee}, u_${ee}_t);
#else
    ${K} ${Z} ${ee} = u_${ee};
#endif
`:Q==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
in ${K} ${Ae} a_${ee};
#else
uniform ${K} ${Z} u_${ee};
#endif
`:pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${K} ${Z} ${ee} = a_${ee};
#else
    ${K} ${Z} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${K} ${Z} ${ee} = unpack_mix_${pe}(a_${ee}, u_${ee}_t);
#else
    ${K} ${Z} ${ee} = u_${ee};
#endif
`}),staticAttributes:m,staticUniforms:S}}class Yo{constructor(l,h,m){this.vertexBuffer=l,this.indexBuffer=h,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var dn=o.aB([{name:"a_pos",type:"Int16",components:2}]);const hu="#define PROJECTION_MERCATOR",nf="mercator";class hc{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return nf}get shaderDefine(){return hu}get shaderPreludeCode(){return Ni.projectionMercator}get vertexShaderPreludeCode(){return Ni.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aC.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(l){}getMeshFromTileID(l,h,m,y,C){if(this._cachedMesh)return this._cachedMesh;const S=new o.aD;S.emplaceBack(0,0),S.emplaceBack(o.Y,0),S.emplaceBack(0,o.Y),S.emplaceBack(o.Y,o.Y);const R=l.createVertexBuffer(S,dn.members),O=o.aE.simpleSegment(0,0,4,2),Q=new o.aF;Q.emplaceBack(1,0,2),Q.emplaceBack(1,2,3);const K=l.createIndexBuffer(Q);return this._cachedMesh=new Yo(R,K,O),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(l){}}function Ei(x,l){const h=o.ac(l.lat,-85.051129,o.aH);return new o.P(o.S(l.lng)*x,o.Q(h)*x)}function ki(x,l){return new o.Z(l.x/x,l.y/x).toLngLat()}function pi(x){return x.cameraToCenterDistance*Math.min(.85*Math.tan(o.ab(90-x.pitch)),Math.tan(o.ab(89.25-x.pitch)))}function Gh(x,l){const h=x.canonical,m=l/o.aG(h.z),y=h.x+Math.pow(2,h.z)*x.wrap,C=o.ar(new Float64Array(16));return o.K(C,C,[y*m,h.y*m,0]),o.L(C,C,[m/o.Y,m/o.Y,1]),C}function Bs(x,l,h,m,y){const C=o.Z.fromLngLat(x,l),S=y*o.aI(1,x.lat),R=S*Math.cos(o.ab(h)),O=Math.sqrt(S*S-R*R),Q=O*Math.sin(o.ab(-m)),K=O*Math.cos(o.ab(-m));return new o.Z(C.x+Q,C.y+K,C.z+R)}class Si{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(l)||l<0||isNaN(h)||h<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=m,this.right=y}interpolate(l,h,m){return h.top!=null&&l.top!=null&&(this.top=o.z.number(l.top,h.top,m)),h.bottom!=null&&l.bottom!=null&&(this.bottom=o.z.number(l.bottom,h.bottom,m)),h.left!=null&&l.left!=null&&(this.left=o.z.number(l.left,h.left,m)),h.right!=null&&l.right!=null&&(this.right=o.z.number(l.right,h.right,m)),this}getCenter(l,h){const m=o.ac((this.left+l-this.right)/2,0,l),y=o.ac((this.top+h-this.bottom)/2,0,h);return new o.P(m,y)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Si(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Wi(x,l){if(!x.renderWorldCopies||x.lngRange)return;const h=l.lng-x.center.lng;l.lng+=h>180?-360:h<-180?360:0}function Ac(x){return Math.max(0,Math.floor(x))}class cl{constructor(l,h,m,y,C,S){this._callbacks=l,this._tileSize=512,this._renderWorldCopies=S===void 0||!!S,this._minZoom=h||0,this._maxZoom=m||22,this._minPitch=y??0,this._maxPitch=C??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.O(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ac(this._zoom),this._scale=o.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Si,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(l,h,m){this._latRange=l.latRange,this._lngRange=l.lngRange,this._width=l.width,this._height=l.height,this._center=l.center,this._elevation=l.elevation,this._minElevationForCurrentTile=l.minElevationForCurrentTile,this._zoom=l.zoom,this._tileZoom=Ac(this._zoom),this._scale=o.aG(this._zoom),this._bearingInRadians=l.bearingInRadians,this._fovInRadians=l.fovInRadians,this._pitchInRadians=l.pitchInRadians,this._rollInRadians=l.rollInRadians,this._unmodified=l.unmodified,this._edgeInsets=new Si(l.padding.top,l.padding.bottom,l.padding.left,l.padding.right),this._minZoom=l.minZoom,this._maxZoom=l.maxZoom,this._minPitch=l.minPitch,this._maxPitch=l.maxPitch,this._renderWorldCopies=l.renderWorldCopies,this._cameraToCenterDistance=l.cameraToCenterDistance,this._nearZ=l.nearZ,this._farZ=l.farZ,this._autoCalculateNearFarZ=!m&&l.autoCalculateNearFarZ,h&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(l){this._minElevationForCurrentTile=l}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(l){this._minZoom!==l&&(this._minZoom=l,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(l){this._minPitch!==l&&(this._minPitch=l,this.setPitch(Math.max(this.pitch,l)))}get maxPitch(){return this._maxPitch}setMaxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.setPitch(Math.min(this.pitch,l)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(l){const h=o.aJ(l,-180,180)*Math.PI/180;var m,y,C,S,R,O,Q,K,Z;this._bearingInRadians!==h&&(this._unmodified=!1,this._bearingInRadians=h,this._calcMatrices(),this._rotationMatrix=d(),m=this._rotationMatrix,C=-this._bearingInRadians,S=(y=this._rotationMatrix)[0],R=y[1],O=y[2],Q=y[3],K=Math.sin(C),Z=Math.cos(C),m[0]=S*Z+O*K,m[1]=R*Z+Q*K,m[2]=S*-K+O*Z,m[3]=R*-K+Q*Z)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(l){const h=o.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==h&&(this._unmodified=!1,this._pitchInRadians=h,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(l){const h=l/180*Math.PI;this._rollInRadians!==h&&(this._unmodified=!1,this._rollInRadians=h,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aK(this._fovInRadians)}setFov(l){l=o.ac(l,.1,150),this.fov!==l&&(this._unmodified=!1,this._fovInRadians=o.ab(l),this._calcMatrices())}get zoom(){return this._zoom}setZoom(l){const h=this.getConstrained(this._center,l).zoom;this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this._tileZoom=Math.max(0,Math.floor(h)),this._scale=o.aG(h),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(l,h){this._autoCalculateNearFarZ=!1,this._nearZ=l,this._farZ=h,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,h,m){this._unmodified=!1,this._edgeInsets.interpolate(l,h,m),this._constrain(),this._calcMatrices()}resize(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._width=l,this._height=h,m&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new wr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(l){l?(this._lngRange=[l.getWest(),l.getEast()],this._latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,o.aH])}getConstrained(l,h){return this._callbacks.getConstrained(l,h)}getCameraQueryGeometry(l,h){if(h.length===1)return[h[0],l];{let m=l.x,y=l.y,C=l.x,S=l.y;for(const R of h)m=Math.min(m,R.x),y=Math.min(y,R.y),C=Math.max(C,R.x),S=Math.max(S,R.y);return[new o.P(m,y),new o.P(C,y),new o.P(C,S),new o.P(m,S),new o.P(m,y)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:h,zoom:m}=this.getConstrained(this.center,this.zoom);this.setCenter(h),this.setZoom(m),this._unmodified=l,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let l=o.ar(new Float64Array(16));o.L(l,l,[this._width/2,-this._height/2,1]),o.K(l,l,[1,-1,0]),this._clipSpaceToPixelsMatrix=l,l=o.ar(new Float64Array(16)),o.L(l,l,[1,-1,1]),o.K(l,l,[-1,-1,0]),o.L(l,l,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=l,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(l,h,m,y){const C=m!==void 0?m:this.bearing,S=y=y!==void 0?y:this.pitch,R=o.Z.fromLngLat(l,h),O=-Math.cos(o.ab(S)),Q=Math.sin(o.ab(S)),K=Q*Math.sin(o.ab(C)),Z=-Q*Math.cos(o.ab(C));let ee=this.elevation;const Ae=h-ee;let pe;O*Ae>=0||Math.abs(O)<.1?(pe=1e4,ee=h+pe*O):pe=-Ae/O;let Fe,Me,Re=o.aL(1,R.y),Ne=0;do{if(Ne+=1,Ne>10)break;Me=pe/Re,Fe=new o.Z(R.x+K*Me,R.y+Z*Me),Re=1/Fe.meterInMercatorCoordinateUnits()}while(Math.abs(pe-Me*Re)>1e-12);return{center:Fe.toLngLat(),elevation:ee,zoom:o.a9(this.height/2/Math.tan(this.fovInRadians/2)/Me/this.tileSize)}}recalculateZoomAndCenter(l){if(this.elevation-l==0)return;const h=o.aI(1,this.center.lat)*this.worldSize,m=this.cameraToCenterDistance/h,y=o.Z.fromLngLat(this.center,this.elevation),C=Bs(this.center,this.elevation,this.pitch,this.bearing,m);this._elevation=l;const S=this.calculateCenterFromCameraLngLatAlt(C.toLngLat(),o.aL(C.z,y.y),this.bearing,this.pitch);this._elevation=S.elevation,this._center=S.center,this.setZoom(S.zoom)}getCameraPoint(){const l=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(l*Math.sin(this.rollInRadians),l*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const l=o.aI(1,this.center.lat)*this.worldSize;return Bs(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/l).toLngLat()}getMercatorTileCoordinates(l){if(!l)return[0,0,1,1];const h=l.canonical.z>=0?1<<l.canonical.z:Math.pow(2,l.canonical.z);return[l.canonical.x/h,l.canonical.y/h,1/h/o.Y,1/h/o.Y]}}class _n{constructor(l,h){this.min=l,this.max=h,this.center=o.aM([],o.aN([],this.min,this.max),.5)}quadrant(l){const h=[l%2==0,l<2],m=o.aO(this.min),y=o.aO(this.max);for(let C=0;C<h.length;C++)m[C]=h[C]?this.min[C]:this.center[C],y[C]=h[C]?this.center[C]:this.max[C];return y[2]=this.max[2],new _n(m,y)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersectsFrustum(l){let h=!0;for(let m=0;m<l.planes.length;m++){const y=this.intersectsPlane(l.planes[m]);if(y===0)return 0;y===1&&(h=!1)}return h?2:l.aabb.min[0]>this.max[0]||l.aabb.min[1]>this.max[1]||l.aabb.min[2]>this.max[2]||l.aabb.max[0]<this.min[0]||l.aabb.max[1]<this.min[1]||l.aabb.max[2]<this.min[2]?0:1}intersectsPlane(l){let h=l[3],m=l[3];for(let y=0;y<3;y++)l[y]>0?(h+=l[y]*this.min[y],m+=l[y]*this.max[y]):(m+=l[y]*this.min[y],h+=l[y]*this.max[y]);return h>=0?2:m<0?0:1}}class Au{distanceToTile2d(l,h,m,y){const C=y.distanceX([l,h]),S=y.distanceY([l,h]);return Math.hypot(C,S)}getWrap(l,h,m){return m}getTileAABB(l,h,m,y){var C,S;let R=m,O=m;if(y.terrain){const K=new o.X(l.z,h,l.z,l.x,l.y),Z=y.terrain.getMinMaxElevation(K);R=(C=Z.minElevation)!==null&&C!==void 0?C:m,O=(S=Z.maxElevation)!==null&&S!==void 0?S:m}const Q=1<<l.z;return new _n([h+l.x/Q,l.y/Q,R],[h+(l.x+1)/Q,(l.y+1)/Q,O])}allowVariableZoom(l,h){const m=l.fov*(Math.abs(Math.cos(l.rollInRadians))*l.height+Math.abs(Math.sin(l.rollInRadians))*l.width)/l.height,y=o.ac(78.5-m/2,0,60);return!!h.terrain||l.pitch>y}allowWorldCopies(){return!0}recalculateCache(){}}class Zo{constructor(l,h,m){this.points=l,this.planes=h,this.aabb=m}static fromInvProjectionMatrix(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const y=Math.pow(2,m),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(Q=>{const K=1/(Q=o.an([],Q,l))[3]/h*y;return o.aP(Q,Q,[K,K,1/Q[3],K])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(Q=>{const K=o.aQ([],C[Q[0]],C[Q[1]]),Z=o.aQ([],C[Q[2]],C[Q[1]]),ee=o.aR([],o.aS([],K,Z)),Ae=-o.aT(ee,C[Q[1]]);return ee.concat(Ae)}),R=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],O=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const Q of C)for(let K=0;K<3;K++)R[K]=Math.min(R[K],Q[K]),O[K]=Math.max(O[K],Q[K]);return new Zo(C,S,new _n(R,O))}}class tn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,h,m){return this._helper.interpolatePadding(l,h,m)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._helper.resize(l,h,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}overrideNearFarZ(l,h){this._helper.overrideNearFarZ(l,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l,h){}constructor(l,h,m,y,C){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new cl({calcMatrices:()=>{this._calcMatrices()},getConstrained:(S,R)=>this.getConstrained(S,R)},l,h,m,y,C),this._coveringTilesDetailsProvider=new Au}clone(){const l=new tn;return l.apply(this),l}apply(l,h,m){this._helper.apply(l,h,m)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(l){const h=[new o.aU(0,l)];if(this._helper._renderWorldCopies){const m=this.screenPointToMercatorCoordinate(new o.P(0,0)),y=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),C=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),S=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),R=Math.floor(Math.min(m.x,y.x,C.x,S.x)),O=Math.floor(Math.max(m.x,y.x,C.x,S.x)),Q=1;for(let K=R-Q;K<=O+Q;K++)K!==0&&h.push(new o.aU(K,l))}return h}getCameraFrustum(){return Zo.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){const h=this.screenPointToLocation(this.centerPoint,l),m=l?l.getElevationForLngLatZoom(h,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(m)}setLocationAtPoint(l,h){const m=o.aI(this.elevation,this.center.lat),y=this.screenPointToMercatorCoordinateAtZ(h,m),C=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,m),S=o.Z.fromLngLat(l),R=new o.Z(S.x-(y.x-C.x),S.y-(y.y-C.y));this.setCenter(R==null?void 0:R.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(l,h){return h?this.coordinatePoint(o.Z.fromLngLat(l),h.getElevationForLngLatZoom(l,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.Z.fromLngLat(l))}screenPointToLocation(l,h){var m;return(m=this.screenPointToMercatorCoordinate(l,h))===null||m===void 0?void 0:m.toLngLat()}screenPointToMercatorCoordinate(l,h){if(h){const m=h.pointCoordinate(l);if(m!=null)return m}return this.screenPointToMercatorCoordinateAtZ(l)}screenPointToMercatorCoordinateAtZ(l,h){const m=h||0,y=[l.x,l.y,0,1],C=[l.x,l.y,1,1];o.an(y,y,this._pixelMatrixInverse),o.an(C,C,this._pixelMatrixInverse);const S=y[3],R=C[3],O=y[1]/S,Q=C[1]/R,K=y[2]/S,Z=C[2]/R,ee=K===Z?0:(m-K)/(Z-K);return new o.Z(o.z.number(y[0]/S,C[0]/R,ee)/this.worldSize,o.z.number(O,Q,ee)/this.worldSize,m)}coordinatePoint(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this._pixelMatrix;const y=[l.x*this.worldSize,l.y*this.worldSize,h,1];return o.an(y,y,m),new o.P(y[0]/y[3],y[1]/y[3])}getBounds(){const l=Math.max(0,this._helper._height/2-pi(this));return new wr().extend(this.screenPointToLocation(new o.P(0,l))).extend(this.screenPointToLocation(new o.P(this._helper._width,l))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(l,h){return h?h.pointCoordinate(l)!=null:l.y>this.height/2-pi(this)}calculatePosMatrix(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m=arguments.length>2?arguments[2]:void 0;var y;const C=(y=l.key)!==null&&y!==void 0?y:o.aV(l.wrap,l.canonical.z,l.canonical.z,l.canonical.x,l.canonical.y),S=h?this._alignedPosMatrixCache:this._posMatrixCache;if(S.has(C)){const Q=S.get(C);return m?Q.f32:Q.f64}const R=Gh(l,this.worldSize);o.M(R,h?this._alignedProjMatrix:this._viewProjMatrix,R);const O={f64:R,f32:new Float32Array(R)};return S.set(C,O),m?O.f32:O.f64}calculateFogMatrix(l){const h=l.key,m=this._fogMatrixCacheF32;if(m.has(h))return m.get(h);const y=Gh(l,this.worldSize);return o.M(y,this._fogMatrix,y),m.set(h,new Float32Array(y)),m.get(h)}getConstrained(l,h){h=o.ac(+h,this.minZoom,this.maxZoom);const m={center:new o.O(l.lng,l.lat),zoom:h};let y=this._helper._lngRange;this._helper._renderWorldCopies||y!==null||(y=[-179.9999999999,180-1e-10]);const C=this.tileSize*o.aG(m.zoom);let S=0,R=C,O=0,Q=C,K=0,Z=0;const{x:ee,y:Ae}=this.size;if(this._helper._latRange){const $e=this._helper._latRange;S=o.Q($e[1])*C,R=o.Q($e[0])*C,R-S<Ae&&(K=Ae/(R-S))}y&&(O=o.aJ(o.S(y[0])*C,0,C),Q=o.aJ(o.S(y[1])*C,0,C),Q<O&&(Q+=C),Q-O<ee&&(Z=ee/(Q-O)));const{x:pe,y:Fe}=Ei(C,l);let Me,Re;const Ne=Math.max(Z||0,K||0);if(Ne){const $e=new o.P(Z?(Q+O)/2:pe,K?(R+S)/2:Fe);return m.center=ki(C,$e).wrap(),m.zoom+=o.a9(Ne),m}if(this._helper._latRange){const $e=Ae/2;Fe-$e<S&&(Re=S+$e),Fe+$e>R&&(Re=R-$e)}if(y){const $e=(O+Q)/2;let qe=pe;this._helper._renderWorldCopies&&(qe=o.aJ(pe,$e-C/2,$e+C/2));const Xe=ee/2;qe-Xe<O&&(Me=O+Xe),qe+Xe>Q&&(Me=Q-Xe)}if(Me!==void 0||Re!==void 0){const $e=new o.P(Me??pe,Re??Fe);m.center=ki(C,$e).wrap()}return m}calculateCenterFromCameraLngLatAlt(l,h,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(l,h,m,y)}_calculateNearFarZIfNeeded(l,h,m){if(!this._helper.autoCalculateNearFarZ)return;const y=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),C=l-y*this._helper._pixelPerMeter/Math.cos(h),S=y<0?C:l,R=Math.PI/2+this.pitchInRadians,O=o.ab(this.fov)*(Math.abs(Math.cos(o.ab(this.roll)))*this.height+Math.abs(Math.sin(o.ab(this.roll)))*this.width)/this.height*(.5+m.y/this.height),Q=Math.sin(O)*S/Math.sin(o.ac(Math.PI-R-O,.01,Math.PI-.01)),K=pi(this),Z=Math.atan(K/this._helper.cameraToCenterDistance),ee=o.ab(.75),Ae=Z>ee?2*Z*(.5+m.y/(2*K)):ee,pe=Math.sin(Ae)*S/Math.sin(o.ac(Math.PI-R-Ae,.01,Math.PI-.01)),Fe=Math.min(Q,pe);this._helper._farZ=1.01*(Math.cos(Math.PI/2-h)*Fe+S),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const l=this.centerOffset,h=Ei(this.worldSize,this.center),m=h.x,y=h.y;this._helper._pixelPerMeter=o.aI(1,this.center.lat)*this.worldSize;const C=o.ab(Math.min(this.pitch,89.25)),S=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(C));let R;this._calculateNearFarZIfNeeded(S,C,l),R=new Float64Array(16),o.aW(R,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.ah(this._invProjMatrix,R),R[8]=2*-l.x/this._helper._width,R[9]=2*l.y/this._helper._height,this._projectionMatrix=o.aX(R),o.L(R,R,[1,-1,1]),o.K(R,R,[0,0,-this._helper.cameraToCenterDistance]),o.aY(R,R,-this.rollInRadians),o.aZ(R,R,this.pitchInRadians),o.aY(R,R,-this.bearingInRadians),o.K(R,R,[-m,-y,0]),this._mercatorMatrix=o.L([],R,[this.worldSize,this.worldSize,this.worldSize]),o.L(R,R,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.M(new Float64Array(16),this.clipSpaceToPixelsMatrix,R),o.K(R,R,[0,0,-this.elevation]),this._viewProjMatrix=R,this._invViewProjMatrix=o.ah([],R);const O=[0,0,-1,1];o.an(O,O,this._invViewProjMatrix),this._cameraPosition=[O[0]/O[3],O[1]/O[3],O[2]/O[3]],this._fogMatrix=new Float64Array(16),o.aW(this._fogMatrix,this.fovInRadians,this.width/this.height,S,this._helper._farZ),this._fogMatrix[8]=2*-l.x/this.width,this._fogMatrix[9]=2*l.y/this.height,o.L(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.K(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.aY(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.aZ(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.aY(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.K(this._fogMatrix,this._fogMatrix,[-m,-y,0]),o.L(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.K(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.M(new Float64Array(16),this.clipSpaceToPixelsMatrix,R);const Q=this._helper._width%2/2,K=this._helper._height%2/2,Z=Math.cos(this.bearingInRadians),ee=Math.sin(-this.bearingInRadians),Ae=m-Math.round(m)+Z*Q+ee*K,pe=y-Math.round(y)+Z*K+ee*Q,Fe=new Float64Array(R);if(o.K(Fe,Fe,[Ae>.5?Ae-1:Ae,pe>.5?pe-1:pe,0]),this._alignedProjMatrix=Fe,R=o.ah(new Float64Array(16),this._pixelMatrix),!R)throw new Error("failed to invert matrix");this._pixelMatrixInverse=R,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const l=this.screenPointToMercatorCoordinate(new o.P(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.an(h,h,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const l=o.aI(1,this.center.lat)*this.worldSize;return Bs(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/l).toLngLat()}lngLatToCameraDepth(l,h){const m=o.Z.fromLngLat(l),y=[m.x*this.worldSize,m.y*this.worldSize,h,1];return o.an(y,y,this._viewProjMatrix),y[2]/y[3]}getProjectionData(l){const{overscaledTileID:h,aligned:m,applyTerrainMatrix:y}=l,C=this._helper.getMercatorTileCoordinates(h),S=h?this.calculatePosMatrix(h,m,!0):null;let R;return R=h&&h.terrainRttPosMatrix32f&&y?h.terrainRttPosMatrix32f:S||o.a_(),{mainMatrix:R,tileMercatorCoords:C,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:R}}isLocationOccluded(l){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(l,h,m){return 1}transformLightDirection(l){return o.aO(l)}getRayDirectionFromPixel(l){throw new Error("Not implemented.")}projectTileCoordinates(l,h,m,y){const C=this.calculatePosMatrix(m);let S;y?(S=[l,h,y(l,h),1],o.an(S,S,C)):(S=[l,h,0,1],zn(S,S,C));const R=S[3];return{point:new o.P(S[0]/R,S[1]/R),signedDistanceFromCamera:R,isOccluded:!1}}populateCache(l){for(const h of l)this.calculatePosMatrix(h)}getMatrixForModel(l,h){const m=o.Z.fromLngLat(l,h),y=m.meterInMercatorCoordinateUnits(),C=o.a$();return o.K(C,C,[m.x,m.y,m.z]),o.aY(C,C,Math.PI),o.aZ(C,C,Math.PI/2),o.L(C,C,[-y,y,y]),C}getProjectionDataForCustomLayer(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const h=new o.X(0,0,0,0,0),m=this.getProjectionData({overscaledTileID:h,applyGlobeMatrix:l}),y=Gh(h,this.worldSize);o.M(y,this._viewProjMatrix,y),m.tileMercatorCoords=[0,0,1,1];const C=[o.Y,o.Y,this.worldSize/this._helper.pixelsPerMeter],S=o.b0();return o.L(S,y,C),m.fallbackMatrix=S,m.mainMatrix=S,m}getFastPathSimpleProjectionMatrix(l){return this.calculatePosMatrix(l)}}function Do(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function qh(x){if(x.useSlerp)if(x.k<1){const l=o.b1(x.startEulerAngles.roll,x.startEulerAngles.pitch,x.startEulerAngles.bearing),h=o.b1(x.endEulerAngles.roll,x.endEulerAngles.pitch,x.endEulerAngles.bearing),m=new Float64Array(4);o.b2(m,l,h,x.k);const y=o.b3(m);x.tr.setRoll(y.roll),x.tr.setPitch(y.pitch),x.tr.setBearing(y.bearing)}else x.tr.setRoll(x.endEulerAngles.roll),x.tr.setPitch(x.endEulerAngles.pitch),x.tr.setBearing(x.endEulerAngles.bearing);else x.tr.setRoll(o.z.number(x.startEulerAngles.roll,x.endEulerAngles.roll,x.k)),x.tr.setPitch(o.z.number(x.startEulerAngles.pitch,x.endEulerAngles.pitch,x.k)),x.tr.setBearing(o.z.number(x.startEulerAngles.bearing,x.endEulerAngles.bearing,x.k))}function Cs(x,l,h,m,y){const C=y.padding,S=Ei(y.worldSize,h.getNorthWest()),R=Ei(y.worldSize,h.getNorthEast()),O=Ei(y.worldSize,h.getSouthEast()),Q=Ei(y.worldSize,h.getSouthWest()),K=o.ab(-m),Z=S.rotate(K),ee=R.rotate(K),Ae=O.rotate(K),pe=Q.rotate(K),Fe=new o.P(Math.max(Z.x,ee.x,pe.x,Ae.x),Math.max(Z.y,ee.y,pe.y,Ae.y)),Me=new o.P(Math.min(Z.x,ee.x,pe.x,Ae.x),Math.min(Z.y,ee.y,pe.y,Ae.y)),Re=Fe.sub(Me),Ne=(y.width-(C.left+C.right+l.left+l.right))/Re.x,$e=(y.height-(C.top+C.bottom+l.top+l.bottom))/Re.y;if($e<0||Ne<0)return void Do();const qe=Math.min(o.a9(y.scale*Math.min(Ne,$e)),x.maxZoom),Xe=o.P.convert(x.offset),tt=new o.P((l.left-l.right)/2,(l.top-l.bottom)/2).rotate(o.ab(m)),it=Xe.add(tt).mult(y.scale/o.aG(qe));return{center:ki(y.worldSize,S.add(O).div(2).sub(it)),zoom:qe,bearing:m}}class fu{get useGlobeControls(){return!1}handlePanInertia(l,h){return{easingOffset:l,easingCenter:h.center}}handleMapControlsRollPitchBearingZoom(l,h){l.bearingDelta&&h.setBearing(h.bearing+l.bearingDelta),l.pitchDelta&&h.setPitch(h.pitch+l.pitchDelta),l.rollDelta&&h.setRoll(h.roll+l.rollDelta),l.zoomDelta&&h.setZoom(h.zoom+l.zoomDelta)}handleMapControlsPan(l,h,m){l.around.distSqr(h.centerPoint)<.01||h.setLocationAtPoint(m,l.around)}cameraForBoxAndBearing(l,h,m,y,C){return Cs(l,h,m,y,C)}handleJumpToCenterZoom(l,h){l.zoom!==(h.zoom!==void 0?+h.zoom:l.zoom)&&l.setZoom(+h.zoom),h.center!==void 0&&l.setCenter(o.O.convert(h.center))}handleEaseTo(l,h){const m=l.zoom,y=l.padding,C={roll:l.roll,pitch:l.pitch,bearing:l.bearing},S={roll:h.roll===void 0?l.roll:h.roll,pitch:h.pitch===void 0?l.pitch:h.pitch,bearing:h.bearing===void 0?l.bearing:h.bearing},R=h.zoom!==void 0,O=!l.isPaddingEqual(h.padding);let Q=!1;const K=R?+h.zoom:l.zoom;let Z=l.centerPoint.add(h.offsetAsPoint);const ee=l.screenPointToLocation(Z),{center:Ae,zoom:pe}=l.getConstrained(o.O.convert(h.center||ee),K??m);Wi(l,Ae);const Fe=Ei(l.worldSize,ee),Me=Ei(l.worldSize,Ae).sub(Fe),Re=o.aG(pe-m);return Q=pe!==m,{easeFunc:Ne=>{if(Q&&l.setZoom(o.z.number(m,pe,Ne)),o.b4(C,S)||qh({startEulerAngles:C,endEulerAngles:S,tr:l,k:Ne,useSlerp:C.roll!=S.roll}),O&&(l.interpolatePadding(y,h.padding,Ne),Z=l.centerPoint.add(h.offsetAsPoint)),h.around)l.setLocationAtPoint(h.around,h.aroundPoint);else{const $e=o.aG(l.zoom-m),qe=pe>m?Math.min(2,Re):Math.max(.5,Re),Xe=Math.pow(qe,1-Ne),tt=ki(l.worldSize,Fe.add(Me.mult(Ne*Xe)).mult($e));l.setLocationAtPoint(l.renderWorldCopies?tt.wrap():tt,Z)}},isZooming:Q,elevationCenter:Ae}}handleFlyTo(l,h){const m=h.zoom!==void 0,y=l.zoom,C=l.getConstrained(o.O.convert(h.center||h.locationAtOffset),m?+h.zoom:y),S=C.center,R=C.zoom;Wi(l,S);const O=Ei(l.worldSize,h.locationAtOffset),Q=Ei(l.worldSize,S).sub(O),K=Q.mag(),Z=o.aG(R-y);let ee;if(h.minZoom!==void 0){const Ae=Math.min(+h.minZoom,y,R),pe=l.getConstrained(S,Ae).zoom;ee=o.aG(pe-y)}return{easeFunc:(Ae,pe,Fe,Me)=>{l.setZoom(Ae===1?R:y+o.a9(pe));const Re=Ae===1?S:ki(l.worldSize,O.add(Q.mult(Fe)).mult(pe));l.setLocationAtPoint(l.renderWorldCopies?Re.wrap():Re,Me)},scaleOfZoom:Z,targetCenter:S,scaleOfMinZoom:ee,pixelPathLength:K}}}class Zn{constructor(l,h,m){this.blendFunction=l,this.blendColor=h,this.mask=m}}Zn.Replace=[1,0],Zn.disabled=new Zn(Zn.Replace,o.b5.transparent,[!1,!1,!1,!1]),Zn.unblended=new Zn(Zn.Replace,o.b5.transparent,[!0,!0,!0,!0]),Zn.alphaBlended=new Zn([1,771],o.b5.transparent,[!0,!0,!0,!0]);const Qa=2305;class yn{constructor(l,h,m){this.enable=l,this.mode=h,this.frontFace=m}}yn.disabled=new yn(!1,1029,Qa),yn.backCCW=new yn(!0,1029,Qa),yn.frontCCW=new yn(!0,1028,Qa);class on{constructor(l,h,m){this.func=l,this.mask=h,this.range=m}}on.ReadOnly=!1,on.ReadWrite=!0,on.disabled=new on(519,on.ReadOnly,[0,1]);const du=7680;class En{constructor(l,h,m,y,C,S){this.test=l,this.ref=h,this.mask=m,this.fail=y,this.depthFail=C,this.pass=S}}En.disabled=new En({func:519,mask:0},0,0,du,du,du);const ul=new WeakMap;function js(x){var l;if(ul.has(x))return ul.get(x);{const h=(l=x.getParameter(x.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return ul.set(x,h),h}}class va{get awaitingQuery(){return!!this._readbackQueue}constructor(l){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=l;const h=l.context,m=h.gl;this._texFormat=m.RGBA,this._texType=m.UNSIGNED_BYTE;const y=new o.aD;y.emplaceBack(-1,-1),y.emplaceBack(2,-1),y.emplaceBack(-1,2);const C=new o.aF;C.emplaceBack(0,1,2),this._fullscreenTriangle=new Yo(h.createVertexBuffer(y,dn.members),h.createIndexBuffer(C),o.aE.simpleSegment(0,0,y.length,C.length)),this._resultBuffer=new Uint8Array(4),h.activeTexture.set(m.TEXTURE1);const S=m.createTexture();m.bindTexture(m.TEXTURE_2D,S),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texImage2D(m.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=h.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(S),js(m)&&(this._pbo=m.createBuffer(),m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.bufferData(m.PIXEL_PACK_BUFFER,4,m.STREAM_READ),m.bindBuffer(m.PIXEL_PACK_BUFFER,null))}destroy(){const l=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),l.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(l,h){const m=this._updateCount;return this._readbackQueue?m>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():m>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(l,h),this._updateCount++,this._measuredError}_bindFramebuffer(){const l=this._cachedRenderContext.context,h=l.gl;l.activeTexture.set(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this._fbo.colorAttachment.get()),l.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(l,h){const m=this._cachedRenderContext.context,y=m.gl;if(this._bindFramebuffer(),m.viewport.set([0,0,this._texWidth,this._texHeight]),m.clear({color:o.b5.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(m,y.TRIANGLES,on.disabled,En.disabled,Zn.unblended,yn.disabled,((C,S)=>({u_input:C,u_output_expected:S}))(l,h),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&js(y)){y.bindBuffer(y.PIXEL_PACK_BUFFER,this._pbo),y.readBuffer(y.COLOR_ATTACHMENT0),y.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,null);const C=y.fenceSync(y.SYNC_GPU_COMMANDS_COMPLETE,0);y.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:C}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const l=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&js(l)){const h=l.clientWaitSync(this._readbackQueue.sync,0,0);if(h===l.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(h===l.TIMEOUT_EXPIRED)return;l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),l.bindBuffer(l.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),l.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=va._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(l){let h=0;return h+=l[0]/256,h+=l[1]/65536,h+=l[2]/16777216,l[3]<127&&(h=-h),h/128}}const pu=o.Y/128;function za(x,l){const h=x.granularity!==void 0?Math.max(x.granularity,1):1,m=h+(x.generateBorders?2:0),y=h+(x.extendToNorthPole||x.generateBorders?1:0)+(x.extendToSouthPole||x.generateBorders?1:0),C=m+1,S=y+1,R=x.generateBorders?-1:0,O=x.generateBorders||x.extendToNorthPole?-1:0,Q=h+(x.generateBorders?1:0),K=h+(x.generateBorders||x.extendToSouthPole?1:0),Z=C*S,ee=m*y*6,Ae=C*S>65536;if(Ae&&l==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const pe=Ae||l==="32bit",Fe=new Int16Array(2*Z);let Me=0;for(let $e=O;$e<=K;$e++)for(let qe=R;qe<=Q;qe++){let Xe=qe/h*o.Y;qe===-1&&(Xe=-64),qe===h+1&&(Xe=o.Y+pu);let tt=$e/h*o.Y;$e===-1&&(tt=x.extendToNorthPole?o.b7:-64),$e===h+1&&(tt=x.extendToSouthPole?o.b8:o.Y+pu),Fe[Me++]=Xe,Fe[Me++]=tt}const Re=pe?new Uint32Array(ee):new Uint16Array(ee);let Ne=0;for(let $e=0;$e<y;$e++)for(let qe=0;qe<m;qe++){const Xe=qe+1+$e*C,tt=qe+($e+1)*C,it=qe+1+($e+1)*C;Re[Ne++]=qe+$e*C,Re[Ne++]=tt,Re[Ne++]=Xe,Re[Ne++]=Xe,Re[Ne++]=tt,Re[Ne++]=it}return{vertices:Fe.buffer.slice(0),indices:Re.buffer.slice(0),uses32bitIndices:pe}}const Ha=new o.aC({fill:new o.b9(128,2),line:new o.b9(512,0),tile:new o.b9(128,32),stencil:new o.b9(128,1),circle:3});class gu{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ni.projectionGlobe}get vertexShaderPreludeCode(){return Ni.projectionMercator.vertexSource}get subdivisionGranularity(){return Ha}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(l){this._errorMeasurement||(this._errorMeasurement=new va(l));const h=o.Q(this._errorQueryLatitudeDegrees),m=2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI,y=this._errorMeasurement.updateErrorLoop(h,m),C=w.now();y!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=y,this._errorMeasurementLastChangeTime=C);const S=Math.min(Math.max((C-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.ba(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bb(S))}_getMeshKey(l){return`${l.granularity.toString(36)}_${l.generateBorders?"b":""}${l.extendToNorthPole?"n":""}${l.extendToSouthPole?"s":""}`}getMeshFromTileID(l,h,m,y,C){const S=(C==="stencil"?Ha.stencil:Ha.tile).getGranularityForZoomLevel(h.z);return this._getMesh(l,{granularity:S,generateBorders:m,extendToNorthPole:h.y===0&&y,extendToSouthPole:h.y===(1<<h.z)-1&&y})}_getMesh(l,h){const m=this._getMeshKey(h);if(m in this._tileMeshCache)return this._tileMeshCache[m];const y=function(C,S){const R=za(S,"16bit"),O=o.aD.deserialize({arrayBuffer:R.vertices,length:R.vertices.byteLength/2/2}),Q=o.aF.deserialize({arrayBuffer:R.indices,length:R.indices.byteLength/2/3});return new Yo(C.createVertexBuffer(O,dn.members),C.createIndexBuffer(Q),o.aE.simpleSegment(0,0,O.length,Q.length))}(l,h);return this._tileMeshCache[m]=y,y}recalculate(l){}hasTransition(){const l=w.now();let h=!1;return h=h||(l-this._errorMeasurementLastChangeTime)/1e3<.7,h=h||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,h}setErrorQueryLatitudeDegrees(l){this._errorQueryLatitudeDegrees=l}}const lh=new o.q({type:new o.D(o.v.projection.type)});class ch extends o.E{constructor(l){super(),this._transitionable=new o.T(lh),this.setProjection(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.B(0)),this._mercatorProjection=new hc,this._verticalPerspectiveProjection=new gu}get transitionState(){const l=this.properties.get("type");if(typeof l=="string"&&l==="mercator")return 0;if(typeof l=="string"&&l==="vertical-perspective")return 1;if(l instanceof o.bc){if(l.from==="vertical-perspective"&&l.to==="mercator")return 1-l.transition;if(l.from==="mercator"&&l.to==="vertical-perspective")return l.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(l){this._mercatorProjection.updateGPUdependent(l),this._verticalPerspectiveProjection.updateGPUdependent(l)}getMeshFromTileID(l,h,m,y,C){return this.currentProjection.getMeshFromTileID(l,h,m,y,C)}setProjection(l){this._transitionable.setValue("type",(l==null?void 0:l.type)||"mercator")}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}setErrorQueryLatitudeDegrees(l){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(l),this._mercatorProjection.setErrorQueryLatitudeDegrees(l)}}function Kh(x){const l=No(x.worldSize,x.center.lat);return 2*Math.PI*l}function fc(x,l,h,m,y){const C=1/(1<<y),S=l/o.Y*C+m*C,R=o.be((x/o.Y*C+h*C)*Math.PI*2+Math.PI,2*Math.PI),O=2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI,Q=Math.cos(O),K=new Float64Array(3);return K[0]=Math.sin(R)*Q,K[1]=Math.sin(O),K[2]=Math.cos(R)*Q,K}function In(x){return function(l,h){const m=Math.cos(h),y=new Float64Array(3);return y[0]=Math.sin(l)*m,y[1]=Math.sin(h),y[2]=Math.cos(l)*m,y}(x.lng*Math.PI/180,x.lat*Math.PI/180)}function No(x,l){return x/(2*Math.PI)/Math.cos(l*Math.PI/180)}function Jo(x){const l=Math.asin(x[1])/Math.PI*180,h=Math.sqrt(x[0]*x[0]+x[2]*x[2]);if(h>1e-6){const m=x[0]/h,y=Math.acos(x[2]/h),C=(m>0?y:-y)/Math.PI*180;return new o.O(o.aJ(C,-180,180),l)}return new o.O(0,l)}function ko(x){return Math.cos(x*Math.PI/180)}function Jn(x,l){const h=ko(x),m=ko(l);return o.a9(m/h)}function mu(x,l){const h=x.rotate(l.bearingInRadians),m=l.zoom+Jn(l.center.lat,0),y=o.ba(1/ko(l.center.lat),1/ko(Math.min(Math.abs(l.center.lat),60)),o.bd(m,7,3,0,1)),C=360/Kh({worldSize:l.worldSize,center:{lat:l.center.lat}});return new o.O(l.center.lng-h.x*C*y,o.ac(l.center.lat+h.y*C,-85.051129,o.aH))}function Qo(x){const l=.5*x,h=Math.sin(l),m=Math.cos(l);return Math.log(h+m)-Math.log(m-h)}function sf(x,l,h,m){const y=x.lat+h*m;if(Math.abs(h)>1){const C=(Math.sign(x.lat+h)!==Math.sign(x.lat)?-Math.abs(x.lat):Math.abs(x.lat))*Math.PI/180,S=Math.abs(x.lat+h)*Math.PI/180,R=Qo(C+m*(S-C)),O=Qo(C),Q=Qo(S);return new o.O(x.lng+l*((R-O)/(Q-O)),y)}return new o.O(x.lng+l*m,y)}class uh{constructor(l){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=l}recalculateCache(){if(!this._hadAnyChanges)return;const l=this._cachePrevious;this._cachePrevious=this._cache,this._cache=l,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(l,h,m,y){const C=`${l.z}_${l.x}_${l.y}`,S=this._cache.get(C);if(S)return S;const R=this._cachePrevious.get(C);if(R)return this._cache.set(C,R),R;const O=this._aabbFactory(l,h,m,y);return this._cache.set(C,O),this._hadAnyChanges=!0,O}}function hh(x,l,h){const m=x-l;return m<0?-m:Math.max(0,m-h)}function _u(x,l,h,m,y){const C=x-h;let S;return S=C<0?Math.min(-C,1+C-y):C>1?Math.min(Math.max(C-y,0),1-C):0,Math.max(S,hh(l,m,y))}class Wh{constructor(){this._aabbCache=new uh(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(l,h,m,y){const C=1<<m.z,S=1/C,R=m.x/C,O=m.y/C;let Q=2;return Q=Math.min(Q,_u(l,h,R,O,S)),Q=Math.min(Q,_u(l,h,R+.5,-O-S,S)),Q=Math.min(Q,_u(l,h,R+.5,2-O-S,S)),Q}getWrap(l,h,m){const y=1<<h.z,C=1/y,S=h.x/y,R=hh(l.x,S,C),O=hh(l.x,S-1,C),Q=hh(l.x,S+1,C),K=Math.min(R,O,Q);return K===Q?1:K===O?-1:0}allowVariableZoom(l,h){return ni(l,h)>4}allowWorldCopies(){return!1}getTileAABB(l,h,m,y){return this._aabbCache.getTileAABB(l,h,m,y)}_computeTileAABB(l,h,m,y){if(l.z<=0)return new _n([-1,-1,-1],[1,1,1]);if(l.z===1)return new _n([l.x===0?-1:0,l.y===0?0:-1,-1],[l.x===0?0:1,l.y===0?1:0,1]);{const C=[fc(0,0,l.x,l.y,l.z),fc(o.Y,0,l.x,l.y,l.z),fc(o.Y,o.Y,l.x,l.y,l.z),fc(0,o.Y,l.x,l.y,l.z)],S=[1,1,1],R=[-1,-1,-1];for(const O of C)for(let Q=0;Q<3;Q++)S[Q]=Math.min(S[Q],O[Q]),R[Q]=Math.max(R[Q],O[Q]);if(l.y===0||l.y===(1<<l.z)-1){const O=[0,l.y===0?1:-1,0];for(let Q=0;Q<3;Q++)S[Q]=Math.min(S[Q],O[Q]),R[Q]=Math.max(R[Q],O[Q])}return new _n(S,R)}}}class yu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,h,m){return this._helper.interpolatePadding(l,h,m)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,h){this._helper.resize(l,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}overrideNearFarZ(l,h){this._helper.overrideNearFarZ(l,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l){}constructor(){this._cachedClippingPlane=o.bf(),this._projectionMatrix=o.a$(),this._globeViewProjMatrix32f=o.a_(),this._globeViewProjMatrixNoCorrection=o.a$(),this._globeViewProjMatrixNoCorrectionInverted=o.a$(),this._globeProjMatrixInverted=o.a$(),this._cameraPosition=o.bg(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new cl({calcMatrices:()=>{this._calcMatrices()},getConstrained:(l,h)=>this.getConstrained(l,h)}),this._coveringTilesDetailsProvider=new Wh}clone(){const l=new yu;return l.apply(this),l}apply(l,h){this._globeLatitudeErrorCorrectionRadians=h||0,this._helper.apply(l)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const l=o.bg();return l[0]=this._cameraPosition[0],l[1]=this._cameraPosition[1],l[2]=this._cameraPosition[2],l}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(l){const{overscaledTileID:h,applyGlobeMatrix:m}=l,y=this._helper.getMercatorTileCoordinates(h);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:y,clippingPlane:this._cachedClippingPlane,projectionTransition:m?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(l){const h=this.pitchInRadians,m=this.cameraToCenterDistance/l,y=Math.sin(h)*m,C=Math.cos(h)*m+1,S=1/Math.sqrt(y*y+C*C)*1;let R=-y,O=C;const Q=Math.sqrt(R*R+O*O);R/=Q,O/=Q;const K=[0,R,O];return o.bh(K,K,[0,0,0],-this.bearingInRadians),o.bi(K,K,[0,0,0],-1*this.center.lat*Math.PI/180),o.bj(K,K,[0,0,0],this.center.lng*Math.PI/180),o.aM(K,K,.25),[...K,.25*-S]}isLocationOccluded(l){return!this.isSurfacePointVisible(In(l))}transformLightDirection(l){const h=this._helper._center.lng*Math.PI/180,m=this._helper._center.lat*Math.PI/180,y=Math.cos(m),C=[Math.sin(h)*y,Math.sin(m),Math.cos(h)*y],S=[C[2],0,-C[0]],R=[0,0,0];o.aS(R,S,C),o.aR(S,S),o.aR(R,R);const O=[0,0,0];return o.aR(O,[S[0]*l[0]+R[0]*l[1]+C[0]*l[2],S[1]*l[0]+R[1]*l[1]+C[1]*l[2],S[2]*l[0]+R[2]*l[1]+C[2]*l[2]]),O}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(l,h,m){const y=function(R,O,Q){const K=1/(1<<Q.z);return new o.Z(R/o.Y*K+Q.x*K,O/o.Y*K+Q.y*K)}(l,h,m.canonical),C=(S=y.y,[o.be(y.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI]);var S;return this.getCircleRadiusCorrection()/Math.cos(C[1])}projectTileCoordinates(l,h,m,y){const C=m.canonical,S=fc(l,h,C.x,C.y,C.z),R=1+(y?y(l,h):0)/o.bp,O=[S[0]*R,S[1]*R,S[2]*R,1];o.an(O,O,this._globeViewProjMatrixNoCorrection);const Q=this._cachedClippingPlane,K=Q[0]*S[0]+Q[1]*S[1]+Q[2]*S[2]+Q[3]<0;return{point:new o.P(O[0]/O[3],O[1]/O[3]),signedDistanceFromCamera:O[3],isOccluded:K}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const l=No(this.worldSize,this.center.lat),h=o.b0(),m=o.b0();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*l),o.aW(h,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const y=this.centerOffset;h[8]=2*-y.x/this._helper._width,h[9]=2*y.y/this._helper._height,this._projectionMatrix=o.aX(h),this._globeProjMatrixInverted=o.b0(),o.ah(this._globeProjMatrixInverted,h),o.K(h,h,[0,0,-this.cameraToCenterDistance]),o.aY(h,h,this.rollInRadians),o.aZ(h,h,-this.pitchInRadians),o.aY(h,h,this.bearingInRadians),o.K(h,h,[0,0,-l]);const C=o.bg();C[0]=l,C[1]=l,C[2]=l,o.aZ(m,h,this.center.lat*Math.PI/180),o.bk(m,m,-this.center.lng*Math.PI/180),o.L(m,m,C),this._globeViewProjMatrixNoCorrection=m,o.aZ(h,h,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bk(h,h,-this.center.lng*Math.PI/180),o.L(h,h,C),this._globeViewProjMatrix32f=new Float32Array(h),this._globeViewProjMatrixNoCorrectionInverted=o.b0(),o.ah(this._globeViewProjMatrixNoCorrectionInverted,m);const S=o.bg();this._cameraPosition=o.bg(),this._cameraPosition[2]=this.cameraToCenterDistance/l,o.bh(this._cameraPosition,this._cameraPosition,S,-this.rollInRadians),o.bi(this._cameraPosition,this._cameraPosition,S,this.pitchInRadians),o.bh(this._cameraPosition,this._cameraPosition,S,-this.bearingInRadians),o.aN(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bi(this._cameraPosition,this._cameraPosition,S,-this.center.lat*Math.PI/180),o.bj(this._cameraPosition,this._cameraPosition,S,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(l);const R=o.aX(this._globeViewProjMatrixNoCorrectionInverted);o.L(R,R,[1,1,-1]),this._cachedFrustum=Zo.fromInvProjectionMatrix(R)}calculateFogMatrix(l){o.w("calculateFogMatrix is not supported on globe projection.");const h=o.b0();return o.ar(h),h}getVisibleUnwrappedCoordinates(l){return[new o.aU(0,l)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){l&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,h){if(!this._globeViewProjMatrixNoCorrection)return 1;const m=In(l);o.aM(m,m,1+h/o.bp);const y=o.bf();return o.an(y,[m[0],m[1],m[2],1],this._globeViewProjMatrixNoCorrection),y[2]/y[3]}populateCache(l){}getBounds(){const l=.5*this.width,h=.5*this.height,m=[new o.P(0,0),new o.P(l,0),new o.P(this.width,0),new o.P(this.width,h),new o.P(this.width,this.height),new o.P(l,this.height),new o.P(0,this.height),new o.P(0,h)],y=[];for(const Z of m)y.push(this.unprojectScreenPoint(Z));let C=0,S=0,R=0,O=0;const Q=this.center;for(const Z of y){const ee=o.bl(Q.lng,Z.lng),Ae=o.bl(Q.lat,Z.lat);ee<S&&(S=ee),ee>C&&(C=ee),Ae<O&&(O=Ae),Ae>R&&(R=Ae)}const K=[Q.lng+S,Q.lat+O,Q.lng+C,Q.lat+R];return this.isSurfacePointOnScreen([0,1,0])&&(K[3]=90,K[0]=-180,K[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(K[1]=-90,K[0]=-180,K[2]=180),new wr(K)}getConstrained(l,h){const m=o.ac(l.lat,-85.051129,o.aH),y=o.ac(+h,this.minZoom+Jn(0,m),this.maxZoom);return{center:new o.O(l.lng,m),zoom:y}}calculateCenterFromCameraLngLatAlt(l,h,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(l,h,m,y)}setLocationAtPoint(l,h){const m=In(this.unprojectScreenPoint(h)),y=In(l),C=o.bg();o.bm(C);const S=o.bg();o.bj(S,m,C,-this.center.lng*Math.PI/180),o.bi(S,S,C,this.center.lat*Math.PI/180);const R=y[0]*y[0]+y[2]*y[2],O=S[0]*S[0];if(R<O)return;const Q=Math.sqrt(R-O),K=-Q,Z=o.bn(y[0],y[2],S[0],Q),ee=o.bn(y[0],y[2],S[0],K),Ae=o.bg();o.bj(Ae,y,C,-Z);const pe=o.bn(Ae[1],Ae[2],S[1],S[2]),Fe=o.bg();o.bj(Fe,y,C,-ee);const Me=o.bn(Fe[1],Fe[2],S[1],S[2]),Re=.5*Math.PI,Ne=pe>=-Re&&pe<=Re,$e=Me>=-Re&&Me<=Re;let qe,Xe;if(Ne&&$e){const Ct=this.center.lng*Math.PI/180,Dt=this.center.lat*Math.PI/180;o.bq(Z,Ct)+o.bq(pe,Dt)<o.bq(ee,Ct)+o.bq(Me,Dt)?(qe=Z,Xe=pe):(qe=ee,Xe=Me)}else if(Ne)qe=Z,Xe=pe;else{if(!$e)return;qe=ee,Xe=Me}const tt=qe/Math.PI*180,it=Xe/Math.PI*180,Et=this.center.lat;this.setCenter(new o.O(tt,o.ac(it,-90,90))),this.setZoom(this.zoom+Jn(Et,this.center.lat))}locationToScreenPoint(l,h){const m=In(l);if(h){const y=h.getElevationForLngLatZoom(l,this._helper._tileZoom);o.aM(m,m,1+y/o.bp)}return this._projectSurfacePointToScreen(m)}_projectSurfacePointToScreen(l){const h=o.bf();return o.an(h,[...l,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],new o.P((.5*h[0]+.5)*this.width,(.5*-h[1]+.5)*this.height)}screenPointToMercatorCoordinate(l,h){if(h){const m=h.pointCoordinate(l);if(m)return m}return o.Z.fromLngLat(this.unprojectScreenPoint(l))}screenPointToLocation(l,h){var m;return(m=this.screenPointToMercatorCoordinate(l,h))===null||m===void 0?void 0:m.toLngLat()}isPointOnMapSurface(l,h){const m=this._cameraPosition,y=this.getRayDirectionFromPixel(l);return!!this.rayPlanetIntersection(m,y)}getRayDirectionFromPixel(l){const h=o.bf();h[0]=l.x/this.width*2-1,h[1]=-1*(l.y/this.height*2-1),h[2]=1,h[3]=1,o.an(h,h,this._globeViewProjMatrixNoCorrectionInverted),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3];const m=o.bg();m[0]=h[0]-this._cameraPosition[0],m[1]=h[1]-this._cameraPosition[1],m[2]=h[2]-this._cameraPosition[2];const y=o.bg();return o.aR(y,m),y}isSurfacePointVisible(l){const h=this._cachedClippingPlane;return h[0]*l[0]+h[1]*l[1]+h[2]*l[2]+h[3]>=0}isSurfacePointOnScreen(l){if(!this.isSurfacePointVisible(l))return!1;const h=o.bf();return o.an(h,[...l,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3],h[0]>-1&&h[0]<1&&h[1]>-1&&h[1]<1&&h[2]>-1&&h[2]<1}rayPlanetIntersection(l,h){const m=o.aT(l,h),y=o.bg(),C=o.bg();o.aM(C,h,m),o.aQ(y,l,C);const S=1-o.aT(y,y);if(S<0)return null;const R=o.aT(l,l)-1,O=-m+(m<0?1:-1)*Math.sqrt(S),Q=R/O,K=O;return{tMin:Math.min(Q,K),tMax:Math.max(Q,K)}}unprojectScreenPoint(l){const h=this._cameraPosition,m=this.getRayDirectionFromPixel(l),y=this.rayPlanetIntersection(h,m);if(y){const Q=o.bg();o.aN(Q,h,[m[0]*y.tMin,m[1]*y.tMin,m[2]*y.tMin]);const K=o.bg();return o.aR(K,Q),Jo(K)}const C=this._cachedClippingPlane[0]*m[0]+this._cachedClippingPlane[1]*m[1]+this._cachedClippingPlane[2]*m[2],S=-o.bo(this._cachedClippingPlane,h)/C,R=o.bg();if(S>0)o.aN(R,h,[m[0]*S,m[1]*S,m[2]*S]);else{const Q=o.bg();o.aN(Q,h,[2*m[0],2*m[1],2*m[2]]);const K=o.bo(this._cachedClippingPlane,Q);o.aQ(R,Q,[this._cachedClippingPlane[0]*K,this._cachedClippingPlane[1]*K,this._cachedClippingPlane[2]*K])}const O=o.bg();return o.aR(O,R),Jo(O)}getMatrixForModel(l,h){const m=o.O.convert(l),y=1/o.bp,C=o.a$();return o.bk(C,C,m.lng/180*Math.PI),o.aZ(C,C,-m.lat/180*Math.PI),o.K(C,C,[0,0,1+h/o.bp]),o.aZ(C,C,.5*Math.PI),o.L(C,C,[y,y,y]),C}getProjectionDataForCustomLayer(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const h=this.getProjectionData({overscaledTileID:new o.X(0,0,0,0,0),applyGlobeMatrix:l});return h.tileMercatorCoords=[0,0,1,1],h}getFastPathSimpleProjectionMatrix(l){}}class wa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,h,m){return this._helper.interpolatePadding(l,h,m)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._helper.resize(l,h,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}overrideNearFarZ(l,h){this._helper.overrideNearFarZ(l,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(l,h){this._globeness=l,this._globeLatitudeErrorCorrectionRadians=h,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new cl({calcMatrices:()=>{this._calcMatrices()},getConstrained:(l,h)=>this.getConstrained(l,h)}),this._globeness=1,this._mercatorTransform=new tn,this._verticalPerspectiveTransform=new yu}clone(){const l=new wa;return l._globeness=this._globeness,l._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,l.apply(this),l}apply(l){this._helper.apply(l),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(l){const h=this._mercatorTransform.getProjectionData(l),m=this._verticalPerspectiveTransform.getProjectionData(l);return{mainMatrix:this.isGlobeRendering?m.mainMatrix:h.mainMatrix,clippingPlane:m.clippingPlane,tileMercatorCoords:m.tileMercatorCoords,projectionTransition:l.applyGlobeMatrix?this._globeness:0,fallbackMatrix:h.fallbackMatrix}}isLocationOccluded(l){return this.currentTransform.isLocationOccluded(l)}transformLightDirection(l){return this.currentTransform.transformLightDirection(l)}getPixelScale(){return o.ba(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.ba(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(l,h,m){const y=this._mercatorTransform.getPitchedTextCorrection(l,h,m),C=this._verticalPerspectiveTransform.getPitchedTextCorrection(l,h,m);return o.ba(y,C,this._globeness)}projectTileCoordinates(l,h,m,y){return this.currentTransform.projectTileCoordinates(l,h,m,y)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(l){return this.currentTransform.calculateFogMatrix(l)}getVisibleUnwrappedCoordinates(l){return this.currentTransform.getVisibleUnwrappedCoordinates(l)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(l){this._mercatorTransform.recalculateZoomAndCenter(l),this._verticalPerspectiveTransform.recalculateZoomAndCenter(l)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,h){return this.currentTransform.lngLatToCameraDepth(l,h)}populateCache(l){this._mercatorTransform.populateCache(l),this._verticalPerspectiveTransform.populateCache(l)}getBounds(){return this.currentTransform.getBounds()}getConstrained(l,h){return this.currentTransform.getConstrained(l,h)}calculateCenterFromCameraLngLatAlt(l,h,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(l,h,m,y)}setLocationAtPoint(l,h){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(l,h),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(l,h),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(l,h){return this.currentTransform.locationToScreenPoint(l,h)}screenPointToMercatorCoordinate(l,h){return this.currentTransform.screenPointToMercatorCoordinate(l,h)}screenPointToLocation(l,h){return this.currentTransform.screenPointToLocation(l,h)}isPointOnMapSurface(l,h){return this.currentTransform.isPointOnMapSurface(l,h)}getRayDirectionFromPixel(l){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(l)}getMatrixForModel(l,h){return this.currentTransform.getMatrixForModel(l,h)}getProjectionDataForCustomLayer(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const h=this._mercatorTransform.getProjectionDataForCustomLayer(l);if(!this.isGlobeRendering)return h;const m=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(l);return m.fallbackMatrix=h.mainMatrix,m}getFastPathSimpleProjectionMatrix(l){return this.currentTransform.getFastPathSimpleProjectionMatrix(l)}}class $s{get useGlobeControls(){return!0}handlePanInertia(l,h){const m=mu(l,h);return Math.abs(m.lng-h.center.lng)>180&&(m.lng=h.center.lng+179.5*Math.sign(m.lng-h.center.lng)),{easingCenter:m,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(l,h){const m=l.around,y=h.screenPointToLocation(m);l.bearingDelta&&h.setBearing(h.bearing+l.bearingDelta),l.pitchDelta&&h.setPitch(h.pitch+l.pitchDelta),l.rollDelta&&h.setRoll(h.roll+l.rollDelta);const C=h.zoom;l.zoomDelta&&h.setZoom(h.zoom+l.zoomDelta);const S=h.zoom-C;if(S===0)return;const R=o.bl(h.center.lng,y.lng),O=R/(Math.abs(R/180)+1),Q=o.bl(h.center.lat,y.lat),K=h.getRayDirectionFromPixel(m),Z=h.cameraPosition,ee=-1*o.aT(Z,K),Ae=o.bg();o.aN(Ae,Z,[K[0]*ee,K[1]*ee,K[2]*ee]);const pe=o.br(Ae)-1,Fe=Math.exp(.5*-Math.max(pe-.3,0)),Me=No(h.worldSize,h.center.lat)/Math.min(h.width,h.height),Re=o.bd(Me,.9,.5,1,.25),Ne=(1-o.aG(-S))*Math.min(Fe,Re),$e=h.center.lat,qe=h.zoom,Xe=new o.O(h.center.lng+O*Ne,o.ac(h.center.lat+Q*Ne,-85.051129,o.aH));h.setLocationAtPoint(y,m);const tt=h.center,it=o.bd(Math.abs(R),45,85,0,1),Et=o.bd(Me,.75,.35,0,1),Ct=Math.pow(Math.max(it,Et),.25),Dt=o.bl(tt.lng,Xe.lng),Ht=o.bl(tt.lat,Xe.lat);h.setCenter(new o.O(tt.lng+Dt*Ct,tt.lat+Ht*Ct).wrap()),h.setZoom(qe+Jn($e,h.center.lat))}handleMapControlsPan(l,h,m){if(!l.panDelta)return;const y=h.center.lat,C=h.zoom;h.setCenter(mu(l.panDelta,h).wrap()),h.setZoom(C+Jn(y,h.center.lat))}cameraForBoxAndBearing(l,h,m,y,C){const S=Cs(l,h,m,y,C),R=h.left/C.width*2-1,O=(C.width-h.right)/C.width*2-1,Q=h.top/C.height*-2+1,K=(C.height-h.bottom)/C.height*-2+1,Z=o.bl(m.getWest(),m.getEast())<0,ee=Z?m.getEast():m.getWest(),Ae=Z?m.getWest():m.getEast(),pe=Math.max(m.getNorth(),m.getSouth()),Fe=Math.min(m.getNorth(),m.getSouth()),Me=ee+.5*o.bl(ee,Ae),Re=pe+.5*o.bl(pe,Fe),Ne=C.clone();Ne.setCenter(S.center),Ne.setBearing(S.bearing),Ne.setPitch(0),Ne.setRoll(0),Ne.setZoom(S.zoom);const $e=Ne.modelViewProjectionMatrix,qe=[In(m.getNorthWest()),In(m.getNorthEast()),In(m.getSouthWest()),In(m.getSouthEast()),In(new o.O(Ae,Re)),In(new o.O(ee,Re)),In(new o.O(Me,pe)),In(new o.O(Me,Fe))],Xe=In(S.center);let tt=Number.POSITIVE_INFINITY;for(const it of qe)R<0&&(tt=$s.getLesserNonNegativeNonNull(tt,$s.solveVectorScale(it,Xe,$e,"x",R))),O>0&&(tt=$s.getLesserNonNegativeNonNull(tt,$s.solveVectorScale(it,Xe,$e,"x",O))),Q>0&&(tt=$s.getLesserNonNegativeNonNull(tt,$s.solveVectorScale(it,Xe,$e,"y",Q))),K<0&&(tt=$s.getLesserNonNegativeNonNull(tt,$s.solveVectorScale(it,Xe,$e,"y",K)));if(Number.isFinite(tt)&&tt!==0)return S.zoom=Ne.zoom+o.a9(tt),S;Do()}handleJumpToCenterZoom(l,h){const m=l.center.lat,y=l.getConstrained(h.center?o.O.convert(h.center):l.center,l.zoom).center;l.setCenter(y.wrap());const C=h.zoom!==void 0?+h.zoom:l.zoom+Jn(m,y.lat);l.zoom!==C&&l.setZoom(C)}handleEaseTo(l,h){const m=l.zoom,y=l.center,C=l.padding,S={roll:l.roll,pitch:l.pitch,bearing:l.bearing},R={roll:h.roll===void 0?l.roll:h.roll,pitch:h.pitch===void 0?l.pitch:h.pitch,bearing:h.bearing===void 0?l.bearing:h.bearing},O=h.zoom!==void 0,Q=!l.isPaddingEqual(h.padding);let K=!1;const Z=h.center?o.O.convert(h.center):y,ee=l.getConstrained(Z,m).center;Wi(l,ee);const Ae=l.clone();Ae.setCenter(ee),Ae.setZoom(O?+h.zoom:m+Jn(y.lat,Z.lat)),Ae.setBearing(h.bearing);const pe=new o.P(o.ac(l.centerPoint.x+h.offsetAsPoint.x,0,l.width),o.ac(l.centerPoint.y+h.offsetAsPoint.y,0,l.height));Ae.setLocationAtPoint(ee,pe);const Fe=(h.offset&&h.offsetAsPoint.mag())>0?Ae.center:ee,Me=O?+h.zoom:m+Jn(y.lat,Fe.lat),Re=m+Jn(y.lat,0),Ne=Me+Jn(Fe.lat,0),$e=o.bl(y.lng,Fe.lng),qe=o.bl(y.lat,Fe.lat),Xe=o.aG(Ne-Re);return K=Me!==m,{easeFunc:tt=>{if(o.b4(S,R)||qh({startEulerAngles:S,endEulerAngles:R,tr:l,k:tt,useSlerp:S.roll!=R.roll}),Q&&l.interpolatePadding(C,h.padding,tt),h.around)o.w("Easing around a point is not supported under globe projection."),l.setLocationAtPoint(h.around,h.aroundPoint);else{const it=Ne>Re?Math.min(2,Xe):Math.max(.5,Xe),Et=Math.pow(it,1-tt),Ct=sf(y,$e,qe,tt*Et);l.setCenter(Ct.wrap())}if(K){const it=o.z.number(Re,Ne,tt)+Jn(0,l.center.lat);l.setZoom(it)}},isZooming:K,elevationCenter:Fe}}handleFlyTo(l,h){const m=h.zoom!==void 0,y=l.center,C=l.zoom,S=l.padding,R=!l.isPaddingEqual(h.padding),O=l.getConstrained(o.O.convert(h.center||h.locationAtOffset),C).center,Q=m?+h.zoom:l.zoom+Jn(l.center.lat,O.lat),K=l.clone();K.setCenter(O),K.setZoom(Q),K.setBearing(h.bearing);const Z=new o.P(o.ac(l.centerPoint.x+h.offsetAsPoint.x,0,l.width),o.ac(l.centerPoint.y+h.offsetAsPoint.y,0,l.height));K.setLocationAtPoint(O,Z);const ee=K.center;Wi(l,ee);const Ae=function(qe,Xe,tt){const it=In(Xe),Et=In(tt),Ct=o.aT(it,Et),Dt=Math.acos(Ct),Ht=Kh(qe);return Dt/(2*Math.PI)*Ht}(l,y,ee),pe=C+Jn(y.lat,0),Fe=Q+Jn(ee.lat,0),Me=o.aG(Fe-pe);let Re;if(typeof h.minZoom=="number"){const qe=+h.minZoom+Jn(ee.lat,0),Xe=Math.min(qe,pe,Fe)+Jn(0,ee.lat),tt=l.getConstrained(ee,Xe).zoom+Jn(ee.lat,0);Re=o.aG(tt-pe)}const Ne=o.bl(y.lng,ee.lng),$e=o.bl(y.lat,ee.lat);return{easeFunc:(qe,Xe,tt,it)=>{const Et=sf(y,Ne,$e,tt);R&&l.interpolatePadding(S,h.padding,qe);const Ct=qe===1?ee:Et;l.setCenter(Ct.wrap());const Dt=pe+o.a9(Xe);l.setZoom(qe===1?Q:Dt+Jn(0,Ct.lat))},scaleOfZoom:Me,targetCenter:ee,scaleOfMinZoom:Re,pixelPathLength:Ae}}static solveVectorScale(l,h,m,y,C){const S=y==="x"?[m[0],m[4],m[8],m[12]]:[m[1],m[5],m[9],m[13]],R=[m[3],m[7],m[11],m[15]],O=l[0]*S[0]+l[1]*S[1]+l[2]*S[2],Q=l[0]*R[0]+l[1]*R[1]+l[2]*R[2],K=h[0]*S[0]+h[1]*S[1]+h[2]*S[2],Z=h[0]*R[0]+h[1]*R[1]+h[2]*R[2];return K+C*Q===O+C*Z||R[3]*(O-K)+S[3]*(Z-Q)+O*Z==K*Q?null:(K+S[3]-C*Z-C*R[3])/(K-O-C*Z+C*Q)}static getLesserNonNegativeNonNull(l,h){return h!==null&&h>=0&&h<l?h:l}}class Pl{constructor(l){this._globe=l,this._mercatorCameraHelper=new fu,this._verticalPerspectiveCameraHelper=new $s}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(l,h){return this.currentHelper.handlePanInertia(l,h)}handleMapControlsRollPitchBearingZoom(l,h){return this.currentHelper.handleMapControlsRollPitchBearingZoom(l,h)}handleMapControlsPan(l,h,m){this.currentHelper.handleMapControlsPan(l,h,m)}cameraForBoxAndBearing(l,h,m,y,C){return this.currentHelper.cameraForBoxAndBearing(l,h,m,y,C)}handleJumpToCenterZoom(l,h){this.currentHelper.handleJumpToCenterZoom(l,h)}handleEaseTo(l,h){return this.currentHelper.handleEaseTo(l,h)}handleFlyTo(l,h){return this.currentHelper.handleFlyTo(l,h)}}const Fl=(x,l)=>o.t(x,l&&l.filter(h=>h.identifier!=="source.canvas")),Xh=o.bs();class Gs extends o.E{constructor(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const y=this.sourceCaches[m].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[m].reload()}},this.map=l,this.dispatcher=new rt(at(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(m,y)=>this.getGlyphs(m,y)),this.dispatcher.registerMessageHandler("GI",(m,y)=>this.getImages(m,y)),this.imageManager=new xe,this.imageManager.setEventedParent(this),this.glyphManager=new ge(l._requestManager,h.localIdeographFontFamily),this.lineAtlas=new At(256,512),this.crossTileSymbolIndex=new Vs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bt,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.bu()),nn().on(Sr,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.sourceCaches[m.sourceId];if(!y)return;const C=y.getSource();if(C&&C.vectorLayerIds)for(const S in this._layers){const R=this._layers[S];R.source===C.id&&this._validateLayer(R)}})}loadURL(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const y=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController;const C=this._loadStyleRequest;o.h(y,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,h,m)}).catch(S=>{this._loadStyleRequest=null,S&&!C.signal.aborted&&this.fire(new o.j(S))})}loadJSON(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,w.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(l,h,m)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Xh,{validate:!1})}_load(l,h,m){var y,C;const S=h.transformStyle?h.transformStyle(m,l):l;if(!h.validate||!Fl(this,o.x(S))){this._loaded=!0,this.stylesheet=S;for(const R in S.sources)this.addSource(R,S.sources[R],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new et(this.stylesheet.light),this._setProjectionInternal(((y=this.stylesheet.projection)===null||y===void 0?void 0:y.type)||"mercator"),this.sky=new ct(this.stylesheet.sky),this.map.setTerrain((C=this.stylesheet.terrain)!==null&&C!==void 0?C:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const l=o.bv(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of l){const m=o.bw(h);m.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=m}}_loadSprite(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(C,S,R,O){return o._(this,void 0,void 0,function*(){const Q=q(C),K=R>1?"@2x":"",Z={},ee={};for(const{id:Ae,url:pe}of Q){const Fe=S.transformRequest(te(pe,K,".json"),"SpriteJSON");Z[Ae]=o.h(Fe,O);const Me=S.transformRequest(te(pe,K,".png"),"SpriteImage");ee[Ae]=V.getImage(Me,O)}return yield Promise.all([...Object.values(Z),...Object.values(ee)]),function(Ae,pe){return o._(this,void 0,void 0,function*(){const Fe={};for(const Me in Ae){Fe[Me]={};const Re=w.getImageCanvasContext((yield pe[Me]).data),Ne=(yield Ae[Me]).data;for(const $e in Ne){const{width:qe,height:Xe,x:tt,y:it,sdf:Et,pixelRatio:Ct,stretchX:Dt,stretchY:Ht,content:Lt,textFitWidth:dr,textFitHeight:Ar}=Ne[$e];Fe[Me][$e]={data:null,pixelRatio:Ct,sdf:Et,stretchX:Dt,stretchY:Ht,content:Lt,textFitWidth:dr,textFitHeight:Ar,spriteData:{width:qe,height:Xe,x:tt,y:it,context:Re}}}}return Fe})}(Z,ee)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(C=>{if(this._spriteRequest=null,C)for(const S in C){this._spritesImagesIds[S]=[];const R=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(O=>!(O in C)):[];for(const O of R)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in C[S]){const Q=S==="default"?O:`${S}:${O}`;this._spritesImagesIds[S].push(Q),Q in this.imageManager.images?this.imageManager.updateImage(Q,C[S][O],!1):this.imageManager.addImage(Q,C[S][O]),h&&(this._changedImages[Q]=!0)}}}).catch(C=>{this._spriteRequest=null,y=C,this.fire(new o.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),m&&m(y)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(l){const h=this.sourceCaches[l.source];if(!h)return;const m=l.sourceLayer;if(!m)return;const y=h.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.j(new Error(`Source layer "${m}" does not exist on source "${y.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const m=this._serializedAllLayers();if(!l||l.length===0)return Object.values(h?o.bx(m):m);const y=[];for(const C of l)if(m[C]){const S=h?o.bx(m[C]):m[C];y.push(S)}return y}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const h=Object.keys(this._layers);for(const m of h){const y=this._layers[m];y.type!=="custom"&&(l[m]=y.serialize())}return l}hasTransitions(){var l,h,m;if(!((l=this.light)===null||l===void 0)&&l.hasTransition()||!((h=this.sky)===null||h===void 0)&&h.hasTransition()||!((m=this.projection)===null||m===void 0)&&m.hasTransition())return!0;for(const y in this.sourceCaches)if(this.sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const h=this._changed;if(h){const y=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(y.length||C.length)&&this._updateWorkerLayers(y,C);for(const S in this._updatedSources){const R=this._updatedSources[S];if(R==="reload")this._reloadSource(S);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(l);this.light.updateTransitions(l),this.sky.updateTransitions(l),this._resetUpdates()}const m={};for(const y in this.sourceCaches){const C=this.sourceCaches[y];m[y]=C.used,C.used=!1}for(const y of this._order){const C=this._layers[y];C.recalculate(l,this._availableImages),!C.isHidden(l.zoom)&&C.source&&(this.sourceCaches[C.source].used=!0)}for(const y in m){const C=this.sourceCaches[y];!!m[y]!=!!C.used&&C.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(l),this.sky.recalculate(l),this.projection.recalculate(l),this.z=l.zoom,h&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var m;this._checkLoaded();const y=this.serialize();if(l=h.transformStyle?h.transformStyle(y,l):l,((m=h.validate)===null||m===void 0||m)&&Fl(this,o.x(l)))return!1;(l=o.bx(l)).layers=o.bv(l.layers);const C=o.by(y,l),S=this._getOperationsToPerform(C);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const R of S.operations)R();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const h=[],m=[];for(const y of l)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":h.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":h.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,y.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setSky":h.push(()=>this.setSky.apply(this,y.args));break;case"setProjection":this.setProjection.apply(this,y.args);break;case"setTransition":h.push(()=>{});break;default:m.push(y.command)}return{operations:h,unimplemented:m}}addImage(l,h){if(this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,h),this._afterImageUpdated(l)}updateImage(l,h){this.imageManager.updateImage(l,h)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(o.x.source,`sources.${l}`,h,null,m))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const y=this.sourceCaches[l]=new ce(l,h,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:l})),y.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===l)return this.fire(new o.j(new Error(`Source "${l}" cannot be removed while layer "${m}" is using it.`)));const h=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],h.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,h){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const m=this.sourceCaches[l].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(h),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const y=l.id;if(this.getLayer(y))return void this.fire(new o.j(new Error(`Layer "${y}" already exists on this map.`)));let C;if(l.type==="custom"){if(Fl(this,o.bz(l)))return;C=o.bw(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(y,l.source),l=o.bx(l),l=o.e(l,{source:y})),this._validate(o.x.layer,`layers.${y}`,l,{arrayIndex:-1},m))return;C=o.bw(l),this._validateLayer(C),C.setEventedParent(this,{layer:{id:y}})}const S=h?this._order.indexOf(h):this._order.length;if(h&&S===-1)this.fire(new o.j(new Error(`Cannot add layer "${y}" before non-existing layer "${h}".`)));else{if(this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=C,this._removedLayers[y]&&C.source&&C.type!=="custom"){const R=this._removedLayers[y];delete this._removedLayers[y],R.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}moveLayer(l,h){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new o.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===h)return;const m=this._order.indexOf(l);this._order.splice(m,1);const y=h?this._order.indexOf(h):this._order.length;h&&y===-1?this.fire(new o.j(new Error(`Cannot move layer "${l}" before non-existing layer "${h}".`))):(this._order.splice(y,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const h=this._layers[l];if(!h)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${l}".`)));h.setEventedParent(null);const m=this._order.indexOf(l);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=h,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],h.onRemove&&h.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,h,m){this._checkLoaded();const y=this.getLayer(l);y?y.minzoom===h&&y.maxzoom===m||(h!=null&&(y.minzoom=h),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const y=this.getLayer(l);if(y){if(!o.bA(y.filter,h))return h==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(o.x.filter,`layers.${y.id}.filter`,h,null,m)||(y.filter=o.bx(h),this._updateLayer(y)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return o.bx(this.getLayer(l).filter)}setLayoutProperty(l,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const C=this.getLayer(l);C?o.bA(C.getLayoutProperty(h),m)||(C.setLayoutProperty(h,m,y),this._updateLayer(C)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,h){const m=this.getLayer(l);if(m)return m.getLayoutProperty(h);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const C=this.getLayer(l);C?o.bA(C.getPaintProperty(h),m)||(C.setPaintProperty(h,m,y)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,h){return this.getLayer(l).getPaintProperty(h)}setFeatureState(l,h){this._checkLoaded();const m=l.source,y=l.sourceLayer,C=this.sourceCaches[m];if(C===void 0)return void this.fire(new o.j(new Error(`The source '${m}' does not exist in the map's style.`)));const S=C.getSource().type;S==="geojson"&&y?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||y?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),C.setFeatureState(y,l.id,h)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,h){this._checkLoaded();const m=l.source,y=this.sourceCaches[m];if(y===void 0)return void this.fire(new o.j(new Error(`The source '${m}' does not exist in the map's style.`)));const C=y.getSource().type,S=C==="vector"?l.sourceLayer:void 0;C!=="vector"||S?h&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(S,l.id,h):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const h=l.source,m=l.sourceLayer,y=this.sourceCaches[h];if(y!==void 0)return y.getSource().type!=="vector"||m?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(m,l.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=o.bB(this.sourceCaches,C=>C.serialize()),h=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,y=this.stylesheet;return o.bC({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,projection:y.projection,sources:l,layers:h,terrain:m},C=>C!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const h=S=>this._layers[S].type==="fill-extrusion",m={},y=[];for(let S=this._order.length-1;S>=0;S--){const R=this._order[S];if(h(R)){m[R]=S;for(const O of l){const Q=O[R];if(Q)for(const K of Q)y.push(K)}}}y.sort((S,R)=>R.intersectionZ-S.intersectionZ);const C=[];for(let S=this._order.length-1;S>=0;S--){const R=this._order[S];if(h(R))for(let O=y.length-1;O>=0;O--){const Q=y[O].feature;if(m[Q.layer.id]<S)break;C.push(Q),y.pop()}else for(const O of l){const Q=O[R];if(Q)for(const K of Q)C.push(K.feature)}}return C}queryRenderedFeatures(l,h,m){h&&h.filter&&this._validate(o.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const y={};if(h&&h.layers){if(!(Array.isArray(h.layers)||h.layers instanceof Set))return this.fire(new o.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const Q of h.layers){const K=this._layers[Q];if(!K)return this.fire(new o.j(new Error(`The layer '${Q}' does not exist in the map's style and cannot be queried for features.`))),[];y[K.source]=!0}}const C=[];h.availableImages=this._availableImages;const S=this._serializedAllLayers(),R=h.layers instanceof Set?h.layers:Array.isArray(h.layers)?new Set(h.layers):null,O=Object.assign(Object.assign({},h),{layers:R});for(const Q in this.sourceCaches)h.layers&&!y[Q]||C.push(nr(this.sourceCaches[Q],this._layers,S,l,O,m));return this.placement&&C.push(function(Q,K,Z,ee,Ae,pe,Fe){const Me={},Re=pe.queryRenderedSymbols(ee),Ne=[];for(const $e of Object.keys(Re).map(Number))Ne.push(Fe[$e]);Ne.sort(qt);for(const $e of Ne){const qe=$e.featureIndex.lookupSymbolFeatures(Re[$e.bucketInstanceId],K,$e.bucketIndex,$e.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,Q);for(const Xe in qe){const tt=Me[Xe]=Me[Xe]||[],it=qe[Xe];it.sort((Et,Ct)=>{const Dt=$e.featureSortOrder;if(Dt){const Ht=Dt.indexOf(Et.featureIndex);return Dt.indexOf(Ct.featureIndex)-Ht}return Ct.featureIndex-Et.featureIndex});for(const Et of it)tt.push(Et)}}return function($e,qe,Xe){for(const tt in $e)for(const it of $e[tt])or(it,Xe[qe[tt].source]);return $e}(Me,Q,Z)}(this._layers,S,this.sourceCaches,l,O,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(l,h){h&&h.filter&&this._validate(o.x.filter,"querySourceFeatures.filter",h.filter,null,h);const m=this.sourceCaches[l];return m?function(y,C){const S=y.getRenderableIds().map(Q=>y.getTileByID(Q)),R=[],O={};for(let Q=0;Q<S.length;Q++){const K=S[Q],Z=K.tileID.canonical.key;O[Z]||(O[Z]=!0,K.querySourceFeatures(R,C))}return R}(m,h):[]}getLight(){return this.light.getLight()}setLight(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const m=this.light.getLight();let y=!1;for(const S in l)if(!o.bA(l[S],m[S])){y=!0;break}if(!y)return;const C={now:w.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,h),this.light.updateTransitions(C)}getProjection(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.projection}setProjection(l){if(this._checkLoaded(),this.projection){if(this.projection.name===l.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=l,this._setProjectionInternal(l.type)}getSky(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.sky}setSky(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const m=this.getSky();let y=!1;if(!l&&!m)return;if(l&&!m)y=!0;else if(!l&&m)y=!0;else for(const S in l)if(!o.bA(l[S],m[S])){y=!0;break}if(!y)return;const C={now:w.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=l,this.sky.setSky(l,h),this.sky.updateTransitions(C)}_setProjectionInternal(l){const h=function(m){if(Array.isArray(m)){const y=new ch({type:m});return{projection:y,transform:new wa,cameraHelper:new Pl(y)}}switch(m){case"mercator":return{projection:new hc,transform:new tn,cameraHelper:new fu};case"globe":{const y=new ch({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:y,transform:new wa,cameraHelper:new Pl(y)}}case"vertical-perspective":return{projection:new gu,transform:new yu,cameraHelper:new $s};default:return o.w(`Unknown projection name: ${m}. Falling back to mercator projection.`),{projection:new hc,transform:new tn,cameraHelper:new fu}}}(l);this.projection=h.projection,this.map.migrateProjection(h.transform,h.cameraHelper);for(const m in this.sourceCaches)this.sourceCaches[m].reload()}_validate(l,h,m,y){let C=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!C||C.validate!==!1)&&Fl(this,l.call(o.x,o.e({key:h,style:this.serialize(),value:m,styleSpec:o.v},y)))}_remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),nn().off(Sr,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const m=this.sourceCaches[h];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const h in this.sourceCaches)this.sourceCaches[h].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,h,m,y){let C=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,S=!1,R=!1;const O={};for(const Q of this._order){const K=this._layers[Q];if(K.type!=="symbol")continue;if(!O[K.source]){const ee=this.sourceCaches[K.source];O[K.source]=ee.getRenderableIds(!0).map(Ae=>ee.getTileByID(Ae)).sort((Ae,pe)=>pe.tileID.overscaledZ-Ae.tileID.overscaledZ||(Ae.tileID.isLessThan(pe.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(K,O[K.source],l.center.lng);S=S||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(w.now(),l.zoom))&&(this.pauseablePlacement=new $h(l,this.map.terrain,this._order,C,h,m,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(w.now()),R=!0),S&&this.pauseablePlacement.placement.setStale()),R||S)for(const Q of this._order){const K=this._layers[Q];K.type==="symbol"&&this.placement.updateLayerOpacities(K,O[K.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(w.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,h){return o._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,h.icons),m})}getGlyphs(l,h){return o._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(h.stacks),y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),l&&this._validate(o.x.glyphs,"glyphs",l,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},y=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const C=[{id:l,url:h}],S=[...q(this.stylesheet.sprite),...C];this._validate(o.x.sprite,"sprite",S,null,m)||(this.stylesheet.sprite=S,this._loadSprite(C,!0,y))}removeSprite(l){this._checkLoaded();const h=q(this.stylesheet.sprite);if(h.find(m=>m.id===l)){if(this._spritesImagesIds[l])for(const m of this._spritesImagesIds[l])this.imageManager.removeImage(m),this._changedImages[m]=!0;h.splice(h.findIndex(m=>m.id===l),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return q(this.stylesheet.sprite)}setSprite(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),l&&this._validate(o.x.sprite,"sprite",l,null,h)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,m):(this._unloadSprite(),m&&m(null)))}}var bu=o.aB([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class vu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,h,m,y,C,S,R,O,Q){this.context=l;let K=this.boundPaintVertexBuffers.length!==y.length;for(let Z=0;!K&&Z<y.length;Z++)this.boundPaintVertexBuffers[Z]!==y[Z]&&(K=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==m||K||this.boundIndexBuffer!==C||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==Q?this.freshBind(h,m,y,C,S,R,O,Q):(l.bindVertexArray.set(this.vao),R&&R.bind(),C&&C.dynamicDraw&&C.bind(),O&&O.bind(),Q&&Q.bind())}freshBind(l,h,m,y,C,S,R,O){const Q=l.numAttributes,K=this.context,Z=K.gl;this.vao&&this.destroy(),this.vao=K.createVertexArray(),K.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=O,h.enableAttributes(Z,l);for(const ee of m)ee.enableAttributes(Z,l);S&&S.enableAttributes(Z,l),R&&R.enableAttributes(Z,l),O&&O.enableAttributes(Z,l),h.bind(),h.setVertexAttribPointers(Z,l,C);for(const ee of m)ee.bind(),ee.setVertexAttribPointers(Z,l,C);S&&(S.bind(),S.setVertexAttribPointers(Z,l,C)),y&&y.bind(),R&&(R.bind(),R.setVertexAttribPointers(Z,l,C)),O&&(O.bind(),O.setVertexAttribPointers(Z,l,C)),K.currentNumAttributes=Q}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const xa=(x,l,h,m,y)=>({u_texture:0,u_ele_delta:x,u_fog_matrix:l,u_fog_color:h?h.properties.get("fog-color"):o.b5.white,u_fog_ground_blend:h?h.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?0:h?h.calculateFogBlendOpacity(m):0,u_horizon_color:h?h.properties.get("horizon-color"):o.b5.white,u_horizon_fog_blend:h?h.properties.get("horizon-fog-blend"):1,u_is_globe_mode:y?1:0}),Rl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function U(x){const l=[];for(let h=0;h<x.length;h++){if(x[h]===null)continue;const m=x[h].split(" ");l.push(m.pop())}return l}class he{constructor(l,h,m,y,C,S,R,O){const Q=l.gl;this.program=Q.createProgram();const K=U(h.staticAttributes),Z=m?m.getBinderAttributes():[],ee=K.concat(Z),Ae=Ni.prelude.staticUniforms?U(Ni.prelude.staticUniforms):[],pe=R.staticUniforms?U(R.staticUniforms):[],Fe=h.staticUniforms?U(h.staticUniforms):[],Me=m?m.getBinderUniforms():[],Re=Ae.concat(pe).concat(Fe).concat(Me),Ne=[];for(const Ct of Re)Ne.indexOf(Ct)<0&&Ne.push(Ct);const $e=m?m.defines():[];js(Q)&&$e.unshift("#version 300 es"),C&&$e.push("#define OVERDRAW_INSPECTOR;"),S&&$e.push("#define TERRAIN3D;"),O&&$e.push(O);let qe=$e.concat(Ni.prelude.fragmentSource,R.fragmentSource,h.fragmentSource).join(`
`),Xe=$e.concat(Ni.prelude.vertexSource,R.vertexSource,h.vertexSource).join(`
`);js(Q)||(qe=function(Ct){return Ct.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(qe),Xe=function(Ct){return Ct.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Xe));const tt=Q.createShader(Q.FRAGMENT_SHADER);if(Q.isContextLost())return void(this.failedToCreate=!0);if(Q.shaderSource(tt,qe),Q.compileShader(tt),!Q.getShaderParameter(tt,Q.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${Q.getShaderInfoLog(tt)}`);Q.attachShader(this.program,tt);const it=Q.createShader(Q.VERTEX_SHADER);if(Q.isContextLost())return void(this.failedToCreate=!0);if(Q.shaderSource(it,Xe),Q.compileShader(it),!Q.getShaderParameter(it,Q.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${Q.getShaderInfoLog(it)}`);Q.attachShader(this.program,it),this.attributes={};const Et={};this.numAttributes=ee.length;for(let Ct=0;Ct<this.numAttributes;Ct++)ee[Ct]&&(Q.bindAttribLocation(this.program,Ct,ee[Ct]),this.attributes[ee[Ct]]=Ct);if(Q.linkProgram(this.program),!Q.getProgramParameter(this.program,Q.LINK_STATUS))throw new Error(`Program failed to link: ${Q.getProgramInfoLog(this.program)}`);Q.deleteShader(it),Q.deleteShader(tt);for(let Ct=0;Ct<Ne.length;Ct++){const Dt=Ne[Ct];if(Dt&&!Et[Dt]){const Ht=Q.getUniformLocation(this.program,Dt);Ht&&(Et[Dt]=Ht)}}this.fixedUniforms=y(l,Et),this.terrainUniforms=((Ct,Dt)=>({u_depth:new o.bD(Ct,Dt.u_depth),u_terrain:new o.bD(Ct,Dt.u_terrain),u_terrain_dim:new o.b6(Ct,Dt.u_terrain_dim),u_terrain_matrix:new o.bF(Ct,Dt.u_terrain_matrix),u_terrain_unpack:new o.bG(Ct,Dt.u_terrain_unpack),u_terrain_exaggeration:new o.b6(Ct,Dt.u_terrain_exaggeration)}))(l,Et),this.projectionUniforms=((Ct,Dt)=>({u_projection_matrix:new o.bF(Ct,Dt.u_projection_matrix),u_projection_tile_mercator_coords:new o.bG(Ct,Dt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bG(Ct,Dt.u_projection_clipping_plane),u_projection_transition:new o.b6(Ct,Dt.u_projection_transition),u_projection_fallback_matrix:new o.bF(Ct,Dt.u_projection_fallback_matrix)}))(l,Et),this.binderUniforms=m?m.getUniforms(l,Et):[]}draw(l,h,m,y,C,S,R,O,Q,K,Z,ee,Ae,pe,Fe,Me,Re,Ne,$e){const qe=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(m),l.setStencilMode(y),l.setColorMode(C),l.setCullFace(S),O){l.activeTexture.set(qe.TEXTURE2),qe.bindTexture(qe.TEXTURE_2D,O.depthTexture),l.activeTexture.set(qe.TEXTURE3),qe.bindTexture(qe.TEXTURE_2D,O.texture);for(const tt in this.terrainUniforms)this.terrainUniforms[tt].set(O[tt])}if(Q)for(const tt in Q)this.projectionUniforms[Rl[tt]].set(Q[tt]);if(R)for(const tt in this.fixedUniforms)this.fixedUniforms[tt].set(R[tt]);Me&&Me.setUniforms(l,this.binderUniforms,pe,{zoom:Fe});let Xe=0;switch(h){case qe.LINES:Xe=2;break;case qe.TRIANGLES:Xe=3;break;case qe.LINE_STRIP:Xe=1}for(const tt of Ae.get()){const it=tt.vaos||(tt.vaos={});(it[K]||(it[K]=new vu)).bind(l,this,Z,Me?Me.getPaintVertexBuffers():[],ee,tt.vertexOffset,Re,Ne,$e),qe.drawElements(h,tt.primitiveLength*Xe,qe.UNSIGNED_SHORT,tt.primitiveOffset*Xe*2)}}}function ke(x,l,h){const m=1/o.au(h,1,l.transform.tileZoom),y=Math.pow(2,h.tileID.overscaledZ),C=h.tileSize*Math.pow(2,l.transform.tileZoom)/y,S=C*(h.tileID.canonical.x+h.tileID.wrap*y),R=C*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[S>>16,R>>16],u_pixel_coord_lower:[65535&S,65535&R]}}const nt=(x,l,h,m)=>{const y=x.style.light,C=y.properties.get("position"),S=[C.x,C.y,C.z],R=o.bJ();y.properties.get("anchor")==="viewport"&&o.bK(R,x.transform.bearingInRadians),o.bL(S,S,R);const O=x.transform.transformLightDirection(S),Q=y.properties.get("color");return{u_lightpos:S,u_lightpos_globe:O,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+l,u_opacity:h,u_fill_translate:m}},Bt=(x,l,h,m,y,C,S)=>o.e(nt(x,l,h,m),ke(C,x,S),{u_height_factor:-Math.pow(2,y.overscaledZ)/S.tileSize/8}),Vt=(x,l,h,m)=>o.e(ke(l,x,h),{u_fill_translate:m}),ur=(x,l)=>({u_world:x,u_fill_translate:l}),Or=(x,l,h,m,y)=>o.e(Vt(x,l,h,y),{u_world:m}),Xr=(x,l,h,m,y)=>{const C=x.transform;let S,R,O=0;if(h.paint.get("circle-pitch-alignment")==="map"){const Q=o.au(l,1,C.zoom);S=!0,R=[Q,Q],O=Q/(o.Y*Math.pow(2,l.tileID.overscaledZ))*2*Math.PI*y}else S=!1,R=C.pixelsToGLUnits;return{u_camera_to_center_distance:C.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+S,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:R,u_globe_extrude_scale:O,u_translate:m}},An=x=>({u_pixel_extrude_scale:[1/x.width,1/x.height]}),hn=x=>({u_viewport_size:[x.width,x.height]}),Rn=function(x){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return{u_color:x,u_overlay:0,u_overlay_scale:l}},bi=(x,l,h,m)=>{const y=o.au(x,1,l)/(o.Y*Math.pow(2,x.tileID.overscaledZ))*2*Math.PI*m;return{u_extrude_scale:o.au(x,1,l),u_intensity:h,u_globe_extrude_scale:y}},ii=(x,l,h,m)=>{const y=o.J();o.bM(y,0,x.width,x.height,0,0,1);const C=x.context.gl;return{u_matrix:y,u_world:[C.drawingBufferWidth,C.drawingBufferHeight],u_image:h,u_color_ramp:m,u_opacity:l.paint.get("heatmap-opacity")}},Xi=(x,l,h)=>{const m=h.paint.get("hillshade-shadow-color"),y=h.paint.get("hillshade-highlight-color"),C=h.paint.get("hillshade-accent-color");let S=h.paint.get("hillshade-illumination-direction")*(Math.PI/180);return h.paint.get("hillshade-illumination-anchor")==="viewport"&&(S+=x.transform.bearingInRadians),{u_image:0,u_latrange:ji(0,l.tileID),u_light:[h.paint.get("hillshade-exaggeration"),S],u_shadow:m,u_highlight:y,u_accent:C}},qs=(x,l)=>{const h=l.stride,m=o.J();return o.bM(m,0,o.Y,-8192,0,0,1),o.K(m,m,[0,-8192,0]),{u_matrix:m,u_image:1,u_dimension:[h,h],u_zoom:x.overscaledZ,u_unpack:l.getUnpackVector()}};function ji(x,l){const h=Math.pow(2,l.canonical.z),m=l.canonical.y;return[new o.Z(0,m/h).toLngLat().lat,new o.Z(0,(m+1)/h).toLngLat().lat]}const ea=(x,l,h,m)=>{const y=x.transform;return{u_translation:xu(x,l,h),u_ratio:m/o.au(l,1,y.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},wo=(x,l,h,m,y)=>o.e(ea(x,l,h,m),{u_image:0,u_image_height:y}),hl=(x,l,h,m,y)=>{const C=x.transform,S=wu(l,C);return{u_translation:xu(x,l,h),u_texsize:l.imageAtlasTexture.size,u_ratio:m/o.au(l,1,C.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[S,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},of=(x,l,h,m,y,C)=>{const S=x.lineAtlas,R=wu(l,x.transform),O=h.layout.get("line-cap")==="round",Q=S.getDash(y.from,O),K=S.getDash(y.to,O),Z=Q.width*C.fromScale,ee=K.width*C.toScale;return o.e(ea(x,l,h,m),{u_patternscale_a:[R/Z,-Q.height/2],u_patternscale_b:[R/ee,-K.height/2],u_sdfgamma:S.width/(256*Math.min(Z,ee)*x.pixelRatio)/2,u_image:0,u_tex_y_a:Q.y,u_tex_y_b:K.y,u_mix:C.t})};function wu(x,l){return 1/o.au(x,1,l.tileZoom)}function xu(x,l,h){return o.av(x.transform,l,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Bu=(x,l,h,m,y)=>{return{u_tl_parent:x,u_scale_parent:l,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(S=m.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(C=m.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Cu(m.paint.get("raster-hue-rotate")),u_coords_top:[y[0].x,y[0].y,y[1].x,y[1].y],u_coords_bottom:[y[3].x,y[3].y,y[2].x,y[2].y]};var C,S};function Cu(x){x*=Math.PI/180;const l=Math.sin(x),h=Math.cos(x);return[(2*h+1)/3,(-Math.sqrt(3)*l-h+1)/3,(Math.sqrt(3)*l-h+1)/3]}const Tu=(x,l,h,m,y,C,S,R,O,Q,K,Z,ee)=>{const Ae=S.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Ae.cameraToCenterDistance,u_pitch:Ae.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Ae.width/Ae.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_label_plane_matrix:R,u_coord_matrix:O,u_is_text:+K,u_pitch_with_map:+m,u_is_along_line:y,u_is_variable_anchor:C,u_texsize:Z,u_texture:0,u_translation:Q,u_pitched_scale:ee}},Al=(x,l,h,m,y,C,S,R,O,Q,K,Z,ee,Ae)=>{const pe=S.transform;return o.e(Tu(x,l,h,m,y,C,S,R,O,Q,K,Z,Ae),{u_gamma_scale:m?Math.cos(pe.pitch*Math.PI/180)*pe.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:1})},vi=(x,l,h,m,y,C,S,R,O,Q,K,Z,ee)=>o.e(Al(x,l,h,m,y,C,S,R,O,Q,!0,K,0,ee),{u_texsize_icon:Z,u_texture_icon:1}),dc=(x,l)=>({u_opacity:x,u_color:l}),pc=(x,l,h,m,y)=>o.e(function(C,S,R,O){const Q=R.imageManager.getPattern(C.from.toString()),K=R.imageManager.getPattern(C.to.toString()),{width:Z,height:ee}=R.imageManager.getPixelSize(),Ae=Math.pow(2,O.tileID.overscaledZ),pe=O.tileSize*Math.pow(2,R.transform.tileZoom)/Ae,Fe=pe*(O.tileID.canonical.x+O.tileID.wrap*Ae),Me=pe*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Q.tl,u_pattern_br_a:Q.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[Z,ee],u_mix:S.t,u_pattern_size_a:Q.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/o.au(O,1,R.transform.tileZoom),u_pixel_coord_upper:[Fe>>16,Me>>16],u_pixel_coord_lower:[65535&Fe,65535&Me]}}(h,y,l,m),{u_opacity:x}),Ll=(x,l)=>{},Ah={fillExtrusion:(x,l)=>({u_lightpos:new o.bH(x,l.u_lightpos),u_lightpos_globe:new o.bH(x,l.u_lightpos_globe),u_lightintensity:new o.b6(x,l.u_lightintensity),u_lightcolor:new o.bH(x,l.u_lightcolor),u_vertical_gradient:new o.b6(x,l.u_vertical_gradient),u_opacity:new o.b6(x,l.u_opacity),u_fill_translate:new o.bI(x,l.u_fill_translate)}),fillExtrusionPattern:(x,l)=>({u_lightpos:new o.bH(x,l.u_lightpos),u_lightpos_globe:new o.bH(x,l.u_lightpos_globe),u_lightintensity:new o.b6(x,l.u_lightintensity),u_lightcolor:new o.bH(x,l.u_lightcolor),u_vertical_gradient:new o.b6(x,l.u_vertical_gradient),u_height_factor:new o.b6(x,l.u_height_factor),u_opacity:new o.b6(x,l.u_opacity),u_fill_translate:new o.bI(x,l.u_fill_translate),u_image:new o.bD(x,l.u_image),u_texsize:new o.bI(x,l.u_texsize),u_pixel_coord_upper:new o.bI(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bI(x,l.u_pixel_coord_lower),u_scale:new o.bH(x,l.u_scale),u_fade:new o.b6(x,l.u_fade)}),fill:(x,l)=>({u_fill_translate:new o.bI(x,l.u_fill_translate)}),fillPattern:(x,l)=>({u_image:new o.bD(x,l.u_image),u_texsize:new o.bI(x,l.u_texsize),u_pixel_coord_upper:new o.bI(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bI(x,l.u_pixel_coord_lower),u_scale:new o.bH(x,l.u_scale),u_fade:new o.b6(x,l.u_fade),u_fill_translate:new o.bI(x,l.u_fill_translate)}),fillOutline:(x,l)=>({u_world:new o.bI(x,l.u_world),u_fill_translate:new o.bI(x,l.u_fill_translate)}),fillOutlinePattern:(x,l)=>({u_world:new o.bI(x,l.u_world),u_image:new o.bD(x,l.u_image),u_texsize:new o.bI(x,l.u_texsize),u_pixel_coord_upper:new o.bI(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bI(x,l.u_pixel_coord_lower),u_scale:new o.bH(x,l.u_scale),u_fade:new o.b6(x,l.u_fade),u_fill_translate:new o.bI(x,l.u_fill_translate)}),circle:(x,l)=>({u_camera_to_center_distance:new o.b6(x,l.u_camera_to_center_distance),u_scale_with_map:new o.bD(x,l.u_scale_with_map),u_pitch_with_map:new o.bD(x,l.u_pitch_with_map),u_extrude_scale:new o.bI(x,l.u_extrude_scale),u_device_pixel_ratio:new o.b6(x,l.u_device_pixel_ratio),u_globe_extrude_scale:new o.b6(x,l.u_globe_extrude_scale),u_translate:new o.bI(x,l.u_translate)}),collisionBox:(x,l)=>({u_pixel_extrude_scale:new o.bI(x,l.u_pixel_extrude_scale)}),collisionCircle:(x,l)=>({u_viewport_size:new o.bI(x,l.u_viewport_size)}),debug:(x,l)=>({u_color:new o.bE(x,l.u_color),u_overlay:new o.bD(x,l.u_overlay),u_overlay_scale:new o.b6(x,l.u_overlay_scale)}),depth:Ll,clippingMask:Ll,heatmap:(x,l)=>({u_extrude_scale:new o.b6(x,l.u_extrude_scale),u_intensity:new o.b6(x,l.u_intensity),u_globe_extrude_scale:new o.b6(x,l.u_globe_extrude_scale)}),heatmapTexture:(x,l)=>({u_matrix:new o.bF(x,l.u_matrix),u_world:new o.bI(x,l.u_world),u_image:new o.bD(x,l.u_image),u_color_ramp:new o.bD(x,l.u_color_ramp),u_opacity:new o.b6(x,l.u_opacity)}),hillshade:(x,l)=>({u_image:new o.bD(x,l.u_image),u_latrange:new o.bI(x,l.u_latrange),u_light:new o.bI(x,l.u_light),u_shadow:new o.bE(x,l.u_shadow),u_highlight:new o.bE(x,l.u_highlight),u_accent:new o.bE(x,l.u_accent)}),hillshadePrepare:(x,l)=>({u_matrix:new o.bF(x,l.u_matrix),u_image:new o.bD(x,l.u_image),u_dimension:new o.bI(x,l.u_dimension),u_zoom:new o.b6(x,l.u_zoom),u_unpack:new o.bG(x,l.u_unpack)}),line:(x,l)=>({u_translation:new o.bI(x,l.u_translation),u_ratio:new o.b6(x,l.u_ratio),u_device_pixel_ratio:new o.b6(x,l.u_device_pixel_ratio),u_units_to_pixels:new o.bI(x,l.u_units_to_pixels)}),lineGradient:(x,l)=>({u_translation:new o.bI(x,l.u_translation),u_ratio:new o.b6(x,l.u_ratio),u_device_pixel_ratio:new o.b6(x,l.u_device_pixel_ratio),u_units_to_pixels:new o.bI(x,l.u_units_to_pixels),u_image:new o.bD(x,l.u_image),u_image_height:new o.b6(x,l.u_image_height)}),linePattern:(x,l)=>({u_translation:new o.bI(x,l.u_translation),u_texsize:new o.bI(x,l.u_texsize),u_ratio:new o.b6(x,l.u_ratio),u_device_pixel_ratio:new o.b6(x,l.u_device_pixel_ratio),u_image:new o.bD(x,l.u_image),u_units_to_pixels:new o.bI(x,l.u_units_to_pixels),u_scale:new o.bH(x,l.u_scale),u_fade:new o.b6(x,l.u_fade)}),lineSDF:(x,l)=>({u_translation:new o.bI(x,l.u_translation),u_ratio:new o.b6(x,l.u_ratio),u_device_pixel_ratio:new o.b6(x,l.u_device_pixel_ratio),u_units_to_pixels:new o.bI(x,l.u_units_to_pixels),u_patternscale_a:new o.bI(x,l.u_patternscale_a),u_patternscale_b:new o.bI(x,l.u_patternscale_b),u_sdfgamma:new o.b6(x,l.u_sdfgamma),u_image:new o.bD(x,l.u_image),u_tex_y_a:new o.b6(x,l.u_tex_y_a),u_tex_y_b:new o.b6(x,l.u_tex_y_b),u_mix:new o.b6(x,l.u_mix)}),raster:(x,l)=>({u_tl_parent:new o.bI(x,l.u_tl_parent),u_scale_parent:new o.b6(x,l.u_scale_parent),u_buffer_scale:new o.b6(x,l.u_buffer_scale),u_fade_t:new o.b6(x,l.u_fade_t),u_opacity:new o.b6(x,l.u_opacity),u_image0:new o.bD(x,l.u_image0),u_image1:new o.bD(x,l.u_image1),u_brightness_low:new o.b6(x,l.u_brightness_low),u_brightness_high:new o.b6(x,l.u_brightness_high),u_saturation_factor:new o.b6(x,l.u_saturation_factor),u_contrast_factor:new o.b6(x,l.u_contrast_factor),u_spin_weights:new o.bH(x,l.u_spin_weights),u_coords_top:new o.bG(x,l.u_coords_top),u_coords_bottom:new o.bG(x,l.u_coords_bottom)}),symbolIcon:(x,l)=>({u_is_size_zoom_constant:new o.bD(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bD(x,l.u_is_size_feature_constant),u_size_t:new o.b6(x,l.u_size_t),u_size:new o.b6(x,l.u_size),u_camera_to_center_distance:new o.b6(x,l.u_camera_to_center_distance),u_pitch:new o.b6(x,l.u_pitch),u_rotate_symbol:new o.bD(x,l.u_rotate_symbol),u_aspect_ratio:new o.b6(x,l.u_aspect_ratio),u_fade_change:new o.b6(x,l.u_fade_change),u_label_plane_matrix:new o.bF(x,l.u_label_plane_matrix),u_coord_matrix:new o.bF(x,l.u_coord_matrix),u_is_text:new o.bD(x,l.u_is_text),u_pitch_with_map:new o.bD(x,l.u_pitch_with_map),u_is_along_line:new o.bD(x,l.u_is_along_line),u_is_variable_anchor:new o.bD(x,l.u_is_variable_anchor),u_texsize:new o.bI(x,l.u_texsize),u_texture:new o.bD(x,l.u_texture),u_translation:new o.bI(x,l.u_translation),u_pitched_scale:new o.b6(x,l.u_pitched_scale)}),symbolSDF:(x,l)=>({u_is_size_zoom_constant:new o.bD(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bD(x,l.u_is_size_feature_constant),u_size_t:new o.b6(x,l.u_size_t),u_size:new o.b6(x,l.u_size),u_camera_to_center_distance:new o.b6(x,l.u_camera_to_center_distance),u_pitch:new o.b6(x,l.u_pitch),u_rotate_symbol:new o.bD(x,l.u_rotate_symbol),u_aspect_ratio:new o.b6(x,l.u_aspect_ratio),u_fade_change:new o.b6(x,l.u_fade_change),u_label_plane_matrix:new o.bF(x,l.u_label_plane_matrix),u_coord_matrix:new o.bF(x,l.u_coord_matrix),u_is_text:new o.bD(x,l.u_is_text),u_pitch_with_map:new o.bD(x,l.u_pitch_with_map),u_is_along_line:new o.bD(x,l.u_is_along_line),u_is_variable_anchor:new o.bD(x,l.u_is_variable_anchor),u_texsize:new o.bI(x,l.u_texsize),u_texture:new o.bD(x,l.u_texture),u_gamma_scale:new o.b6(x,l.u_gamma_scale),u_device_pixel_ratio:new o.b6(x,l.u_device_pixel_ratio),u_is_halo:new o.bD(x,l.u_is_halo),u_translation:new o.bI(x,l.u_translation),u_pitched_scale:new o.b6(x,l.u_pitched_scale)}),symbolTextAndIcon:(x,l)=>({u_is_size_zoom_constant:new o.bD(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bD(x,l.u_is_size_feature_constant),u_size_t:new o.b6(x,l.u_size_t),u_size:new o.b6(x,l.u_size),u_camera_to_center_distance:new o.b6(x,l.u_camera_to_center_distance),u_pitch:new o.b6(x,l.u_pitch),u_rotate_symbol:new o.bD(x,l.u_rotate_symbol),u_aspect_ratio:new o.b6(x,l.u_aspect_ratio),u_fade_change:new o.b6(x,l.u_fade_change),u_label_plane_matrix:new o.bF(x,l.u_label_plane_matrix),u_coord_matrix:new o.bF(x,l.u_coord_matrix),u_is_text:new o.bD(x,l.u_is_text),u_pitch_with_map:new o.bD(x,l.u_pitch_with_map),u_is_along_line:new o.bD(x,l.u_is_along_line),u_is_variable_anchor:new o.bD(x,l.u_is_variable_anchor),u_texsize:new o.bI(x,l.u_texsize),u_texsize_icon:new o.bI(x,l.u_texsize_icon),u_texture:new o.bD(x,l.u_texture),u_texture_icon:new o.bD(x,l.u_texture_icon),u_gamma_scale:new o.b6(x,l.u_gamma_scale),u_device_pixel_ratio:new o.b6(x,l.u_device_pixel_ratio),u_is_halo:new o.bD(x,l.u_is_halo),u_translation:new o.bI(x,l.u_translation),u_pitched_scale:new o.b6(x,l.u_pitched_scale)}),background:(x,l)=>({u_opacity:new o.b6(x,l.u_opacity),u_color:new o.bE(x,l.u_color)}),backgroundPattern:(x,l)=>({u_opacity:new o.b6(x,l.u_opacity),u_image:new o.bD(x,l.u_image),u_pattern_tl_a:new o.bI(x,l.u_pattern_tl_a),u_pattern_br_a:new o.bI(x,l.u_pattern_br_a),u_pattern_tl_b:new o.bI(x,l.u_pattern_tl_b),u_pattern_br_b:new o.bI(x,l.u_pattern_br_b),u_texsize:new o.bI(x,l.u_texsize),u_mix:new o.b6(x,l.u_mix),u_pattern_size_a:new o.bI(x,l.u_pattern_size_a),u_pattern_size_b:new o.bI(x,l.u_pattern_size_b),u_scale_a:new o.b6(x,l.u_scale_a),u_scale_b:new o.b6(x,l.u_scale_b),u_pixel_coord_upper:new o.bI(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bI(x,l.u_pixel_coord_lower),u_tile_units_to_pixels:new o.b6(x,l.u_tile_units_to_pixels)}),terrain:(x,l)=>({u_texture:new o.bD(x,l.u_texture),u_ele_delta:new o.b6(x,l.u_ele_delta),u_fog_matrix:new o.bF(x,l.u_fog_matrix),u_fog_color:new o.bE(x,l.u_fog_color),u_fog_ground_blend:new o.b6(x,l.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.b6(x,l.u_fog_ground_blend_opacity),u_horizon_color:new o.bE(x,l.u_horizon_color),u_horizon_fog_blend:new o.b6(x,l.u_horizon_fog_blend),u_is_globe_mode:new o.b6(x,l.u_is_globe_mode)}),terrainDepth:(x,l)=>({u_ele_delta:new o.b6(x,l.u_ele_delta)}),terrainCoords:(x,l)=>({u_texture:new o.bD(x,l.u_texture),u_terrain_coords_id:new o.b6(x,l.u_terrain_coords_id),u_ele_delta:new o.b6(x,l.u_ele_delta)}),projectionErrorMeasurement:(x,l)=>({u_input:new o.b6(x,l.u_input),u_output_expected:new o.b6(x,l.u_output_expected)}),atmosphere:(x,l)=>({u_sun_pos:new o.bH(x,l.u_sun_pos),u_atmosphere_blend:new o.b6(x,l.u_atmosphere_blend),u_globe_position:new o.bH(x,l.u_globe_position),u_globe_radius:new o.b6(x,l.u_globe_radius),u_inv_proj_matrix:new o.bF(x,l.u_inv_proj_matrix)}),sky:(x,l)=>({u_sky_color:new o.bE(x,l.u_sky_color),u_horizon_color:new o.bE(x,l.u_horizon_color),u_horizon:new o.bI(x,l.u_horizon),u_horizon_normal:new o.bI(x,l.u_horizon_normal),u_sky_horizon_blend:new o.b6(x,l.u_sky_horizon_blend),u_sky_blend:new o.b6(x,l.u_sky_blend)})};class ao{constructor(l,h,m){this.context=l;const y=l.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ol={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Eu{constructor(l,h,m,y){this.length=h.length,this.attributes=m,this.itemSize=h.bytesPerElement,this.dynamicDraw=y,this.context=l;const C=l.gl;this.buffer=C.createBuffer(),l.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,h){for(let m=0;m<this.attributes.length;m++){const y=h.attributes[this.attributes[m].name];y!==void 0&&l.enableVertexAttribArray(y)}}setVertexAttribPointers(l,h,m){for(let y=0;y<this.attributes.length;y++){const C=this.attributes[y],S=h.attributes[C.name];S!==void 0&&l.vertexAttribPointer(S,C.components,l[Ol[C.type]],!1,this.itemSize,C.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class On{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ba extends On{getDefault(){return o.b5.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class fh extends On{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class af extends On{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Yh extends On{getDefault(){return[!0,!0,!0,!0]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class gc extends On{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class mc extends On{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Ks extends On{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Ts extends On{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Va extends On{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}}class ja extends On{getDefault(){return[0,1]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class xo extends On{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}}class $a extends On{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class os extends On{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}}class $i extends On{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class dh extends On{getDefault(){return o.b5.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ws extends On{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Es extends On{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}}class Ul extends On{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Su extends On{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class Dl extends On{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class fl extends On{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class _c extends On{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class ta extends On{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Ca extends On{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Iu extends On{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Nl extends On{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class gn extends On{getDefault(){return null}set(l){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class yc extends On{getDefault(){return null}set(l){var h;if(l===this.current&&!this.dirty)return;const m=this.gl;js(m)?m.bindVertexArray(l):(h=m.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class Ta extends On{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class ra extends On{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class $n extends On{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class si extends On{constructor(l,h){super(l),this.context=l,this.parent=h}getDefault(){return null}}class Yi extends si{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class as extends si{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class kl extends si{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}const bc="Framebuffer is not complete";class Ql{constructor(l,h,m,y,C){this.context=l,this.width=h,this.height=m;const S=l.gl,R=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Yi(l,R),y)this.depthAttachment=C?new kl(l,R):new as(l,R);else if(C)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error(bc)}destroy(){const l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){const m=this.depthAttachment.get();m&&l.deleteRenderbuffer(m)}l.deleteFramebuffer(this.framebuffer)}}class Mu{constructor(l){var h,m;if(this.gl=l,this.clearColor=new Ba(this),this.clearDepth=new fh(this),this.clearStencil=new af(this),this.colorMask=new Yh(this),this.depthMask=new gc(this),this.stencilMask=new mc(this),this.stencilFunc=new Ks(this),this.stencilOp=new Ts(this),this.stencilTest=new Va(this),this.depthRange=new ja(this),this.depthTest=new xo(this),this.depthFunc=new $a(this),this.blend=new os(this),this.blendFunc=new $i(this),this.blendColor=new dh(this),this.blendEquation=new Ws(this),this.cullFace=new Es(this),this.cullFaceSide=new Ul(this),this.frontFace=new Su(this),this.program=new Dl(this),this.activeTexture=new fl(this),this.viewport=new _c(this),this.bindFramebuffer=new ta(this),this.bindRenderbuffer=new Ca(this),this.bindTexture=new Iu(this),this.bindVertexBuffer=new Nl(this),this.bindElementBuffer=new gn(this),this.bindVertexArray=new yc(this),this.pixelStoreUnpack=new Ta(this),this.pixelStoreUnpackPremultiplyAlpha=new ra(this),this.pixelStoreUnpackFlipY=new $n(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),js(l)){this.HALF_FLOAT=l.HALF_FLOAT;const y=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=l.RGBA16F)!==null&&h!==void 0?h:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(m=l.RGB16F)!==null&&m!==void 0?m:y==null?void 0:y.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const y=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,h){return new ao(this,l,h)}createVertexBuffer(l,h,m){return new Eu(this,l,h,m)}createRenderbuffer(l,h,m){const y=this.gl,C=y.createRenderbuffer();return this.bindRenderbuffer.set(C),y.renderbufferStorage(y.RENDERBUFFER,l,h,m),this.bindRenderbuffer.set(null),C}createFramebuffer(l,h,m,y){return new Ql(this,l,h,m,y)}clear(l){let{color:h,depth:m,stencil:y}=l;const C=this.gl;let S=0;h&&(S|=C.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(S|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),y!==void 0&&(S|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),C.clear(S)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){o.bA(l.blendFunction,Zn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return js(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var h;return js(this.gl)?this.gl.deleteVertexArray(l):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}let vc;function Pu(x,l,h,m,y){const C=x.context,S=x.transform,R=C.gl,O=x.useProgram("collisionBox"),Q=[];let K=0,Z=0;for(let Re=0;Re<m.length;Re++){const Ne=m[Re],$e=l.getTile(Ne).getBucket(h);if(!$e)continue;const qe=y?$e.textCollisionBox:$e.iconCollisionBox,Xe=$e.collisionCircleArray;Xe.length>0&&(Q.push({circleArray:Xe,circleOffset:Z,coord:Ne}),K+=Xe.length/4,Z=K),qe&&O.draw(C,R.LINES,on.disabled,En.disabled,x.colorModeForRenderPass(),yn.disabled,An(x.transform),x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ne),S.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,null,x.transform.zoom,null,null,qe.collisionVertexBuffer)}if(!y||!Q.length)return;const ee=x.useProgram("collisionCircle"),Ae=new o.bN;Ae.resize(4*K),Ae._trim();let pe=0;for(const Re of Q)for(let Ne=0;Ne<Re.circleArray.length/4;Ne++){const $e=4*Ne,qe=Re.circleArray[$e+0],Xe=Re.circleArray[$e+1],tt=Re.circleArray[$e+2],it=Re.circleArray[$e+3];Ae.emplace(pe++,qe,Xe,tt,it,0),Ae.emplace(pe++,qe,Xe,tt,it,1),Ae.emplace(pe++,qe,Xe,tt,it,2),Ae.emplace(pe++,qe,Xe,tt,it,3)}(!vc||vc.length<2*K)&&(vc=function(Re){const Ne=2*Re,$e=new o.bP;$e.resize(Ne),$e._trim();for(let qe=0;qe<Ne;qe++){const Xe=6*qe;$e.uint16[Xe+0]=4*qe+0,$e.uint16[Xe+1]=4*qe+1,$e.uint16[Xe+2]=4*qe+2,$e.uint16[Xe+3]=4*qe+2,$e.uint16[Xe+4]=4*qe+3,$e.uint16[Xe+5]=4*qe+0}return $e}(K));const Fe=C.createIndexBuffer(vc,!0),Me=C.createVertexBuffer(Ae,o.bO.members,!0);for(const Re of Q){const Ne=hn(x.transform);ee.draw(C,R.TRIANGLES,on.disabled,En.disabled,x.colorModeForRenderPass(),yn.disabled,Ne,x.style.map.terrain&&x.style.map.terrain.getTerrainData(Re.coord),null,h.id,Me,Fe,o.aE.simpleSegment(0,2*Re.circleOffset,Re.circleArray.length,Re.circleArray.length/2),null,x.transform.zoom,null,null,null)}Me.destroy(),Fe.destroy()}const zo=o.ar(new Float32Array(16));function Bo(x,l,h,m,y,C){const{horizontalAlign:S,verticalAlign:R}=o.az(x);return new o.P((-(S-.5)*l/y+m[0])*C,(-(R-.5)*h/y+m[1])*C)}function Fu(x,l,h,m,y,C){const S=l.tileAnchorPoint.add(new o.P(l.translation[0],l.translation[1]));if(l.pitchWithMap){let R=m.mult(C);h||(R=R.rotate(-y));const O=S.add(R);return bt(O.x,O.y,l.pitchedLabelPlaneMatrix,l.getElevation).point}if(h){const R=br(l.tileAnchorPoint.x+1,l.tileAnchorPoint.y,l).point.sub(x),O=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return x.add(m.rotate(O))}return x.add(m)}function ph(x,l,h,m,y,C,S,R,O,Q,K,Z){const ee=x.text.placedSymbolArray,Ae=x.text.dynamicLayoutVertexArray,pe=x.icon.dynamicLayoutVertexArray,Fe={};Ae.clear();for(let Me=0;Me<ee.length;Me++){const Re=ee.get(Me),Ne=Re.hidden||!Re.crossTileID||x.allowVerticalPlacement&&!Re.placedOrientation?null:m[Re.crossTileID];if(Ne){const $e=new o.P(Re.anchorX,Re.anchorY),qe={getElevation:Z,width:y.width,height:y.height,pitchedLabelPlaneMatrix:C,pitchWithMap:h,transform:y,tileAnchorPoint:$e,translation:Q,unwrappedTileID:K},Xe=h?en($e.x,$e.y,qe):br($e.x,$e.y,qe),tt=pt(y.cameraToCenterDistance,Xe.signedDistanceFromCamera);let it=o.ag(x.textSizeData,R,Re)*tt/o.at;h&&(it*=x.tilePixelRatio/S);const{width:Et,height:Ct,anchor:Dt,textOffset:Ht,textBoxScale:Lt}=Ne,dr=Bo(Dt,Et,Ct,Ht,Lt,it),Ar=y.getPitchedTextCorrection($e.x+Q[0],$e.y+Q[1],K),Kt=Fu(Xe.point,qe,l,dr,-y.bearingInRadians,Ar),xr=x.allowVerticalPlacement&&Re.placedOrientation===o.af.vertical?Math.PI/2:0;for(let sn=0;sn<Re.numGlyphs;sn++)o.am(Ae,Kt,xr);O&&Re.associatedIconIndex>=0&&(Fe[Re.associatedIconIndex]={shiftedAnchor:Kt,angle:xr})}else Bn(Re.numGlyphs,Ae)}if(O){pe.clear();const Me=x.icon.placedSymbolArray;for(let Re=0;Re<Me.length;Re++){const Ne=Me.get(Re);if(Ne.hidden)Bn(Ne.numGlyphs,pe);else{const $e=Fe[Re];if($e)for(let qe=0;qe<Ne.numGlyphs;qe++)o.am(pe,$e.shiftedAnchor,$e.angle);else Bn(Ne.numGlyphs,pe)}}x.icon.dynamicLayoutVertexBuffer.updateData(pe)}x.text.dynamicLayoutVertexBuffer.updateData(Ae)}function Wp(x,l,h){return h.iconsInText&&l?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function Ru(x,l,h,m,y,C,S,R,O,Q,K,Z,ee){const Ae=x.context,pe=Ae.gl,Fe=x.transform,Me=R==="map",Re=O==="map",Ne=R!=="viewport"&&h.layout.get("symbol-placement")!=="point",$e=Me&&!Re&&!Ne,qe=!h.layout.get("symbol-sort-key").isConstant();let Xe=!1;const tt=x.getDepthModeForSublayer(0,on.ReadOnly),it=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Et=[],Ct=Fe.getCircleRadiusCorrection();for(const Dt of m){const Ht=l.getTile(Dt),Lt=Ht.getBucket(h);if(!Lt)continue;const dr=y?Lt.text:Lt.icon;if(!dr||!dr.segments.get().length||!dr.hasVisibleVertices)continue;const Ar=dr.programConfigurations.get(h.id),Kt=y||Lt.sdfIcons,xr=y?Lt.textSizeData:Lt.iconSizeData,sn=Re||Fe.pitch!==0,Mn=x.useProgram(Wp(Kt,y,Lt),Ar),gi=o.ae(xr,Fe.zoom),ei=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Dt);let mi,Dn,qn,Kn,Xs=[0,0],es=null;if(y)Dn=Ht.glyphAtlasTexture,qn=pe.LINEAR,mi=Ht.glyphAtlasTexture.size,Lt.iconsInText&&(Xs=Ht.imageAtlasTexture.size,es=Ht.imageAtlasTexture,Kn=sn||x.options.rotating||x.options.zooming||xr.kind==="composite"||xr.kind==="camera"?pe.LINEAR:pe.NEAREST);else{const ci=h.layout.get("icon-size").constantOr(0)!==1||Lt.iconsNeedLinear;Dn=Ht.imageAtlasTexture,qn=Kt||x.options.rotating||x.options.zooming||ci||sn?pe.LINEAR:pe.NEAREST,mi=Ht.imageAtlasTexture.size}const cs=o.au(Ht,1,x.transform.zoom),ds=dt(Me,x.transform,cs),qa=o.J();o.ah(qa,ds);const sa=Ze(Re,Me,x.transform,cs),ts=o.av(Fe,Ht,C,S),ho=Fe.getProjectionData({overscaledTileID:Dt,applyGlobeMatrix:!ee,applyTerrainMatrix:!0}),Ia=it&&Lt.hasTextData(),Tc=h.layout.get("icon-text-fit")!=="none"&&Ia&&Lt.hasIconData();if(Ne){const ci=x.style.map.terrain?(Ka,qi)=>x.style.map.terrain.getElevation(Dt,Ka,qi):null,zi=h.layout.get("text-rotation-alignment")==="map";hr(Lt,x,y,ds,qa,Re,Q,zi,Dt.toUnwrapped(),Fe.width,Fe.height,ts,ci)}const Ec=y&&it||Tc,To=Ne||Ec?zo:Re?ds:x.transform.clipSpaceToPixelsMatrix,Ma=Kt&&h.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vo;Vo=Kt?Lt.iconsInText?vi(xr.kind,gi,$e,Re,Ne,Ec,x,To,sa,ts,mi,Xs,Ct):Al(xr.kind,gi,$e,Re,Ne,Ec,x,To,sa,ts,y,mi,0,Ct):Tu(xr.kind,gi,$e,Re,Ne,Ec,x,To,sa,ts,y,mi,Ct);const Eo={program:Mn,buffers:dr,uniformValues:Vo,projectionData:ho,atlasTexture:Dn,atlasTextureIcon:es,atlasInterpolation:qn,atlasInterpolationIcon:Kn,isSDF:Kt,hasHalo:Ma};if(qe&&Lt.canOverlap){Xe=!0;const ci=dr.segments.get();for(const zi of ci)Et.push({segments:new o.aE([zi]),sortKey:zi.sortKey,state:Eo,terrainData:ei})}else Et.push({segments:dr.segments,sortKey:0,state:Eo,terrainData:ei})}Xe&&Et.sort((Dt,Ht)=>Dt.sortKey-Ht.sortKey);for(const Dt of Et){const Ht=Dt.state;if(Ae.activeTexture.set(pe.TEXTURE0),Ht.atlasTexture.bind(Ht.atlasInterpolation,pe.CLAMP_TO_EDGE),Ht.atlasTextureIcon&&(Ae.activeTexture.set(pe.TEXTURE1),Ht.atlasTextureIcon&&Ht.atlasTextureIcon.bind(Ht.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),Ht.isSDF){const Lt=Ht.uniformValues;Ht.hasHalo&&(Lt.u_is_halo=1,Zh(Ht.buffers,Dt.segments,h,x,Ht.program,tt,K,Z,Lt,Ht.projectionData,Dt.terrainData)),Lt.u_is_halo=0}Zh(Ht.buffers,Dt.segments,h,x,Ht.program,tt,K,Z,Ht.uniformValues,Ht.projectionData,Dt.terrainData)}}function Zh(x,l,h,m,y,C,S,R,O,Q,K){const Z=m.context;y.draw(Z,Z.gl.TRIANGLES,C,S,R,yn.backCCW,O,K,Q,h.id,x.layoutVertexBuffer,x.indexBuffer,l,h.paint,m.transform.zoom,x.programConfigurations.get(h.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function lf(x,l,h,m,y){const C=x.context,S=C.gl,R=En.disabled,O=new Zn([S.ONE,S.ONE],o.b5.transparent,[!0,!0,!0,!0]),Q=l.getBucket(h);if(!Q)return;const K=m.key;let Z=h.heatmapFbos.get(K);Z||(Z=gh(C,l.tileSize,l.tileSize),h.heatmapFbos.set(K,Z)),C.bindFramebuffer.set(Z.framebuffer),C.viewport.set([0,0,l.tileSize,l.tileSize]),C.clear({color:o.b5.transparent});const ee=Q.programConfigurations.get(h.id),Ae=x.useProgram("heatmap",ee,!y),pe=x.transform.getProjectionData({overscaledTileID:l.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Fe=x.style.map.terrain.getTerrainData(m);Ae.draw(C,S.TRIANGLES,on.disabled,R,O,yn.disabled,bi(l,x.transform.zoom,h.paint.get("heatmap-intensity"),1),Fe,pe,h.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,h.paint,x.transform.zoom,ee)}function Jh(x,l,h,m,y){const C=x.context,S=C.gl,R=x.transform;C.setColorMode(x.colorModeForRenderPass());const O=eA(C,l),Q=h.key,K=l.heatmapFbos.get(Q);if(!K)return;C.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,K.colorAttachment.get()),C.activeTexture.set(S.TEXTURE1),O.bind(S.LINEAR,S.CLAMP_TO_EDGE);const Z=R.getProjectionData({overscaledTileID:h,applyTerrainMatrix:y,applyGlobeMatrix:!m});x.useProgram("heatmapTexture").draw(C,S.TRIANGLES,on.disabled,En.disabled,x.colorModeForRenderPass(),yn.disabled,ii(x,l,0,1),null,Z,l.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments,l.paint,R.zoom),K.destroy(),l.heatmapFbos.delete(Q)}function gh(x,l,h){var m,y;const C=x.gl,S=C.createTexture();C.bindTexture(C.TEXTURE_2D,S),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR);const R=(m=x.HALF_FLOAT)!==null&&m!==void 0?m:C.UNSIGNED_BYTE,O=(y=x.RGBA16F)!==null&&y!==void 0?y:C.RGBA;C.texImage2D(C.TEXTURE_2D,0,O,l,h,0,C.RGBA,R,null);const Q=x.createFramebuffer(l,h,!1,!1);return Q.colorAttachment.set(S),Q}function eA(x,l){return l.colorRampTexture||(l.colorRampTexture=new J(x,l.colorRamp,x.gl.RGBA)),l.colorRampTexture}function mh(x,l,h,m,y){if(!h||!m||!m.imageAtlas)return;const C=m.imageAtlas.patternPositions;let S=C[h.to.toString()],R=C[h.from.toString()];if(!S&&R&&(S=R),!R&&S&&(R=S),!S||!R){const O=y.getPaintProperty(l);S=C[O],R=C[O]}S&&R&&x.setConstantPatternPositions(S,R)}function Lu(x,l,h,m,y,C,S,R){const O=x.context.gl,Q="fill-pattern",K=h.paint.get(Q),Z=K&&K.constantOr(1),ee=h.getCrossfadeParameters();let Ae,pe,Fe,Me,Re;const Ne=x.transform,$e=h.paint.get("fill-translate"),qe=h.paint.get("fill-translate-anchor");S?(pe=Z&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ae=O.LINES):(pe=Z?"fillPattern":"fill",Ae=O.TRIANGLES);const Xe=K.constantOr(null);for(const tt of m){const it=l.getTile(tt);if(Z&&!it.patternsLoaded())continue;const Et=it.getBucket(h);if(!Et)continue;const Ct=Et.programConfigurations.get(h.id),Dt=x.useProgram(pe,Ct),Ht=x.style.map.terrain&&x.style.map.terrain.getTerrainData(tt);Z&&(x.context.activeTexture.set(O.TEXTURE0),it.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ct.updatePaintBuffers(ee)),mh(Ct,Q,Xe,it,h);const Lt=Ne.getProjectionData({overscaledTileID:tt,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),dr=o.av(Ne,it,$e,qe);if(S){Me=Et.indexBuffer2,Re=Et.segments2;const Kt=[O.drawingBufferWidth,O.drawingBufferHeight];Fe=pe==="fillOutlinePattern"&&Z?Or(x,ee,it,Kt,dr):ur(Kt,dr)}else Me=Et.indexBuffer,Re=Et.segments,Fe=Z?Vt(x,ee,it,dr):{u_fill_translate:dr};let Ar;if(x.renderPass==="translucent"&&R){const[Kt]=x.getStencilConfigForOverlapAndUpdateStencilID(m);Ar=Kt[tt.overscaledZ]}else Ar=x.stencilModeForClipping(tt);Dt.draw(x.context,Ae,y,Ar,C,yn.backCCW,Fe,Ht,Lt,h.id,Et.layoutVertexBuffer,Me,Re,h.paint,x.transform.zoom,Ct)}}function tA(x,l,h,m,y,C,S,R){const O=x.context,Q=O.gl,K="fill-extrusion-pattern",Z=h.paint.get(K),ee=Z.constantOr(1),Ae=h.getCrossfadeParameters(),pe=h.paint.get("fill-extrusion-opacity"),Fe=Z.constantOr(null),Me=x.transform;for(const Re of m){const Ne=l.getTile(Re),$e=Ne.getBucket(h);if(!$e)continue;const qe=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Re),Xe=$e.programConfigurations.get(h.id),tt=x.useProgram(ee?"fillExtrusionPattern":"fillExtrusion",Xe);ee&&(x.context.activeTexture.set(Q.TEXTURE0),Ne.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Xe.updatePaintBuffers(Ae));const it=Me.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!R,applyTerrainMatrix:!0});mh(Xe,K,Fe,Ne,h);const Et=o.av(Me,Ne,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ct=h.paint.get("fill-extrusion-vertical-gradient"),Dt=ee?Bt(x,Ct,pe,Et,Re,Ae,Ne):nt(x,Ct,pe,Et);tt.draw(O,O.gl.TRIANGLES,y,C,S,yn.backCCW,Dt,qe,it,h.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,h.paint,x.transform.zoom,Xe,x.style.map.terrain&&$e.centroidVertexBuffer)}}function md(x,l,h,m,y,C,S,R,O){var Q;const K=x.style.projection,Z=x.context,ee=x.transform,Ae=Z.gl,pe=x.useProgram("hillshade"),Fe=!x.options.moving;for(const Me of m){const Re=l.getTile(Me),Ne=Re.fbo;if(!Ne)continue;const $e=K.getMeshFromTileID(Z,Me.canonical,R,!0,"raster"),qe=(Q=x.style.map.terrain)===null||Q===void 0?void 0:Q.getTerrainData(Me);Z.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,Ne.colorAttachment.get());const Xe=ee.getProjectionData({overscaledTileID:Me,aligned:Fe,applyGlobeMatrix:!O,applyTerrainMatrix:!0});pe.draw(Z,Ae.TRIANGLES,C,y[Me.overscaledZ],S,yn.backCCW,Xi(x,Re,h),qe,Xe,h.id,$e.vertexBuffer,$e.indexBuffer,$e.segments)}}const rA=[new o.P(0,0),new o.P(o.Y,0),new o.P(o.Y,o.Y),new o.P(0,o.Y)];function wi(x,l,h,m,y,C,S,R){let O=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,Q=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1;const K=m[m.length-1].overscaledZ,Z=x.context,ee=Z.gl,Ae=x.useProgram("raster"),pe=x.transform,Fe=x.style.projection,Me=x.colorModeForRenderPass(),Re=!x.options.moving;for(const Ne of m){const $e=x.getDepthModeForSublayer(Ne.overscaledZ-K,h.paint.get("raster-opacity")===1?on.ReadWrite:on.ReadOnly,ee.LESS),qe=l.getTile(Ne);qe.registerFadeDuration(h.paint.get("raster-fade-duration"));const Xe=l.findLoadedParent(Ne,0),tt=l.findLoadedSibling(Ne),it=Ou(qe,Xe||tt||null,l,h,x.transform,x.style.map.terrain);let Et,Ct;const Dt=h.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR;Z.activeTexture.set(ee.TEXTURE0),qe.texture.bind(Dt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(ee.TEXTURE1),Xe?(Xe.texture.bind(Dt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),Et=Math.pow(2,Xe.tileID.overscaledZ-qe.tileID.overscaledZ),Ct=[qe.tileID.canonical.x*Et%1,qe.tileID.canonical.y*Et%1]):qe.texture.bind(Dt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),qe.texture.useMipmap&&Z.extTextureFilterAnisotropic&&x.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const Ht=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ne),Lt=pe.getProjectionData({overscaledTileID:Ne,aligned:Re,applyGlobeMatrix:!Q,applyTerrainMatrix:!0}),dr=Bu(Ct||[0,0],Et||1,it,h,R),Ar=Fe.getMeshFromTileID(Z,Ne.canonical,C,S,"raster");Ae.draw(Z,ee.TRIANGLES,$e,y?y[Ne.overscaledZ]:En.disabled,Me,O?yn.frontCCW:yn.backCCW,dr,Ht,Lt,h.id,Ar.vertexBuffer,Ar.indexBuffer,Ar.segments)}}function Ou(x,l,h,m,y,C){const S=m.paint.get("raster-fade-duration");if(!C&&S>0){const R=w.now(),O=(R-x.timeAdded)/S,Q=l?(R-l.timeAdded)/S:-1,K=h.getSource(),Z=ni(y,{tileSize:K.tileSize,roundZoom:K.roundZoom}),ee=!l||Math.abs(l.tileID.overscaledZ-Z)>Math.abs(x.tileID.overscaledZ-Z),Ae=ee&&x.refreshedUponExpiration?1:o.ac(ee?O:1-Q,0,1);return x.refreshedUponExpiration&&O>=1&&(x.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Ae}:{opacity:Ae,mix:0}}return{opacity:1,mix:0}}const Ea=new o.b5(1,0,0,1),_d=new o.b5(0,1,0,1),yd=new o.b5(0,0,1,1),cf=new o.b5(1,0,1,1),wc=new o.b5(0,1,1,1);function dl(x,l,h,m){nA(x,0,l+h/2,x.transform.width,h,m)}function uf(x,l,h,m){nA(x,l-h/2,0,h,x.transform.height,m)}function nA(x,l,h,m,y,C){const S=x.context,R=S.gl;R.enable(R.SCISSOR_TEST),R.scissor(l*x.pixelRatio,h*x.pixelRatio,m*x.pixelRatio,y*x.pixelRatio),S.clear({color:C}),R.disable(R.SCISSOR_TEST)}function bd(x,l,h){const m=x.context,y=m.gl,C=x.useProgram("debug"),S=on.disabled,R=En.disabled,O=x.colorModeForRenderPass(),Q="$debug",K=x.style.map.terrain&&x.style.map.terrain.getTerrainData(h);m.activeTexture.set(y.TEXTURE0);const Z=l.getTileByID(h.key).latestRawTileData,ee=Math.floor((Z&&Z.byteLength||0)/1024),Ae=l.getTile(h).tileSize,pe=512/Math.min(Ae,512)*(h.overscaledZ/x.transform.zoom)*.5;let Fe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Fe+=` => ${h.overscaledZ}`),function(Re,Ne){Re.initDebugOverlayCanvas();const $e=Re.debugOverlayCanvas,qe=Re.context.gl,Xe=Re.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,$e.width,$e.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(Ne,5,5),Xe.strokeText(Ne,5,5),Re.debugOverlayTexture.update($e),Re.debugOverlayTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)}(x,`${Fe} ${ee}kB`);const Me=x.transform.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!0,applyTerrainMatrix:!0});C.draw(m,y.TRIANGLES,S,R,Zn.alphaBlended,yn.disabled,Rn(o.b5.transparent,pe),null,Me,Q,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),C.draw(m,y.LINE_STRIP,S,R,O,yn.disabled,Rn(o.b5.red),K,Me,Q,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function vd(x,l,h,m){const{isRenderingGlobe:y}=m,C=x.context,S=C.gl,R=x.transform,O=x.colorModeForRenderPass(),Q=x.getDepthModeFor3D(),K=x.useProgram("terrain");C.bindFramebuffer.set(null),C.viewport.set([0,0,x.width,x.height]);for(const Z of h){const ee=l.getTerrainMesh(Z.tileID),Ae=x.renderToTexture.getTexture(Z),pe=l.getTerrainData(Z.tileID);C.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,Ae.texture);const Fe=l.getMeshFrameDelta(R.zoom),Me=R.calculateFogMatrix(Z.tileID.toUnwrapped()),Re=xa(Fe,Me,x.style.sky,R.pitch,y),Ne=R.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});K.draw(C,S.TRIANGLES,Q,En.disabled,O,yn.backCCW,Re,pe,Ne,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments)}}function wd(x,l){if(!l.mesh){const h=new o.aD;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1);const m=new o.aF;m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),l.mesh=new Yo(x.createVertexBuffer(h,dn.members),x.createIndexBuffer(m),o.aE.simpleSegment(0,0,h.length,m.length))}return l.mesh}class Xp{constructor(l,h){this.context=new Mu(l),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ce.maxUnderzooming+ce.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vs}resize(l,h,m){if(this.width=Math.floor(l*m),this.height=Math.floor(h*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const l=this.context,h=new o.aD;h.emplaceBack(0,0),h.emplaceBack(o.Y,0),h.emplaceBack(0,o.Y),h.emplaceBack(o.Y,o.Y),this.tileExtentBuffer=l.createVertexBuffer(h,dn.members),this.tileExtentSegments=o.aE.simpleSegment(0,0,4,2);const m=new o.aD;m.emplaceBack(0,0),m.emplaceBack(o.Y,0),m.emplaceBack(0,o.Y),m.emplaceBack(o.Y,o.Y),this.debugBuffer=l.createVertexBuffer(m,dn.members),this.debugSegments=o.aE.simpleSegment(0,0,4,5);const y=new o.bU;y.emplaceBack(0,0,0,0),y.emplaceBack(o.Y,0,o.Y,0),y.emplaceBack(0,o.Y,0,o.Y),y.emplaceBack(o.Y,o.Y,o.Y,o.Y),this.rasterBoundsBuffer=l.createVertexBuffer(y,bu.members),this.rasterBoundsSegments=o.aE.simpleSegment(0,0,4,2);const C=new o.aD;C.emplaceBack(0,0),C.emplaceBack(o.Y,0),C.emplaceBack(0,o.Y),C.emplaceBack(o.Y,o.Y),this.rasterBoundsBufferPosOnly=l.createVertexBuffer(C,dn.members),this.rasterBoundsSegmentsPosOnly=o.aE.simpleSegment(0,0,4,5);const S=new o.aD;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(S,dn.members),this.viewportSegments=o.aE.simpleSegment(0,0,4,2);const R=new o.bV;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(R);const O=new o.aF;O.emplaceBack(1,0,2),O.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(O);const Q=this.context.gl;this.stencilClearMode=new En({func:Q.ALWAYS,mask:0},0,255,Q.ZERO,Q.ZERO,Q.ZERO),this.tileExtentMesh=new Yo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=o.J();o.bM(m,0,this.width,this.height,0,0,1),o.L(m,m,[h.drawingBufferWidth,h.drawingBufferHeight,0]);const y={mainMatrix:m,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:m};this.useProgram("clippingMask",null,!0).draw(l,h.TRIANGLES,on.disabled,this.stencilClearMode,Zn.disabled,yn.disabled,null,null,y,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,h,m){if(this.currentStencilSource===l.source||!l.isTileClipped()||!h||!h.length)return;this.currentStencilSource=l.source,this.nextStencilID+h.length>256&&this.clearStencil();const y=this.context;y.setColorMode(Zn.disabled),y.setDepthMode(on.disabled);const C={};for(const S of h)C[S.key]=this.nextStencilID++;this._renderTileMasks(C,h,m,!0),this._renderTileMasks(C,h,m,!1),this._tileClippingMaskIDs=C}_renderTileMasks(l,h,m,y){const C=this.context,S=C.gl,R=this.style.projection,O=this.transform,Q=this.useProgram("clippingMask");for(const K of h){const Z=l[K.key],ee=this.style.map.terrain&&this.style.map.terrain.getTerrainData(K),Ae=R.getMeshFromTileID(this.context,K.canonical,y,!0,"stencil"),pe=O.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!0,applyTerrainMatrix:!0});Q.draw(C,S.TRIANGLES,on.disabled,new En({func:S.ALWAYS,mask:0},Z,255,S.KEEP,S.KEEP,S.REPLACE),Zn.disabled,m?yn.disabled:yn.backCCW,null,ee,pe,"$clipping",Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)}}_renderTilesDepthBuffer(){const l=this.context,h=l.gl,m=this.style.projection,y=this.transform,C=this.useProgram("depth"),S=this.getDepthModeFor3D(),R=Be(y,{tileSize:y.tileSize});for(const O of R){const Q=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),K=m.getMeshFromTileID(this.context,O.canonical,!0,!0,"raster"),Z=y.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!0,applyTerrainMatrix:!0});C.draw(l,h.TRIANGLES,S,En.disabled,Zn.disabled,yn.backCCW,null,Q,Z,"$clipping",K.vertexBuffer,K.indexBuffer,K.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,h=this.context.gl;return new En({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(l){const h=this.context.gl;return new En({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(l){const h=this.context.gl,m=l.sort((S,R)=>R.overscaledZ-S.overscaledZ),y=m[m.length-1].overscaledZ,C=m[0].overscaledZ-y+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const S={};for(let R=0;R<C;R++)S[R+y]=new En({func:h.GEQUAL,mask:255},R+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[S,m]}return[{[y]:En.disabled},m]}stencilConfigForOverlapTwoPass(l){const h=this.context.gl,m=l.sort((S,R)=>R.overscaledZ-S.overscaledZ),y=m[m.length-1].overscaledZ,C=m[0].overscaledZ-y+1;if(this.clearStencil(),C>1){const S={},R={};for(let O=0;O<C;O++)S[O+y]=new En({func:h.GREATER,mask:255},C+1+O,255,h.KEEP,h.KEEP,h.REPLACE),R[O+y]=new En({func:h.GREATER,mask:255},1+O,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID=2*C+1,[S,R,m]}return this.nextStencilID=3,[{[y]:new En({func:h.GREATER,mask:255},2,255,h.KEEP,h.KEEP,h.REPLACE)},{[y]:new En({func:h.GREATER,mask:255},1,255,h.KEEP,h.KEEP,h.REPLACE)},m]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new Zn([l.CONSTANT_COLOR,l.ONE],new o.b5(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zn.unblended:Zn.alphaBlended}getDepthModeForSublayer(l,h,m){if(!this.opaquePassEnabledForLayer())return on.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new on(m||this.context.gl.LEQUAL,h,[y,y])}getDepthModeFor3D(){return new on(this.context.gl.LEQUAL,on.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,h){var m,y;this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(w.now()),this.imageManager.beginFrame();const C=this.style._order,S=this.style.sourceCaches,R={},O={},Q={},K={isRenderingToTexture:!1,isRenderingGlobe:((m=l.projection)===null||m===void 0?void 0:m.transitionState)>0};for(const ee in S){const Ae=S[ee];Ae.used&&Ae.prepare(this.context),R[ee]=Ae.getVisibleCoordinates(!1),O[ee]=R[ee].slice().reverse(),Q[ee]=Ae.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ee=0;ee<C.length;ee++)if(this.style._layers[C[ee]].is3D()){this.opaquePassCutoff=ee;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const ee of C){const Ae=this.style._layers[ee];if(!Ae.hasOffscreenPass()||Ae.isHidden(this.transform.zoom))continue;const pe=O[Ae.source];(Ae.type==="custom"||pe.length)&&this.renderLayer(this,S[Ae.source],Ae,pe,K)}if((y=this.style.projection)===null||y===void 0||y.updateGPUdependent({context:this.context,useProgram:ee=>this.useProgram(ee)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?o.b5.black:o.b5.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(ee,Ae){const pe=ee.context,Fe=pe.gl,Me=((tt,it,Et)=>{const Ct=Math.cos(it.rollInRadians),Dt=Math.sin(it.rollInRadians),Ht=pi(it),Lt=it.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:tt.properties.get("sky-color"),u_horizon_color:tt.properties.get("horizon-color"),u_horizon:[(it.width/2-Ht*Dt)*Et,(it.height/2+Ht*Ct)*Et],u_horizon_normal:[-Dt,Ct],u_sky_horizon_blend:tt.properties.get("sky-horizon-blend")*it.height/2*Et,u_sky_blend:Lt}})(Ae,ee.style.map.transform,ee.pixelRatio),Re=new on(Fe.LEQUAL,on.ReadWrite,[0,1]),Ne=En.disabled,$e=ee.colorModeForRenderPass(),qe=ee.useProgram("sky"),Xe=wd(pe,Ae);qe.draw(pe,Fe.TRIANGLES,Re,Ne,$e,yn.disabled,Me,null,void 0,"sky",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const ee=this.style._layers[C[this.currentLayer]],Ae=S[ee.source],pe=R[ee.source];this._renderTileClippingMasks(ee,pe,!1),this.renderLayer(this,Ae,ee,pe,K)}this.renderPass="translucent";let Z=!1;for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const ee=this.style._layers[C[this.currentLayer]],Ae=S[ee.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ee,K))continue;this.opaquePassEnabledForLayer()||Z||(Z=!0,K.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const pe=(ee.type==="symbol"?Q:O)[ee.source];this._renderTileClippingMasks(ee,R[ee.source],!1),this.renderLayer(this,Ae,ee,pe,K)}if(K.isRenderingGlobe&&function(ee,Ae,pe){const Fe=ee.context,Me=Fe.gl,Re=ee.useProgram("atmosphere"),Ne=new on(Me.LEQUAL,on.ReadOnly,[0,1]),$e=ee.transform,qe=function(Lt,dr){const Ar=Lt.properties.get("position"),Kt=[-Ar.x,-Ar.y,-Ar.z],xr=o.ar(new Float64Array(16));return Lt.properties.get("anchor")==="map"&&(o.aY(xr,xr,dr.rollInRadians),o.aZ(xr,xr,-dr.pitchInRadians),o.aY(xr,xr,dr.bearingInRadians),o.aZ(xr,xr,dr.center.lat*Math.PI/180),o.bk(xr,xr,-dr.center.lng*Math.PI/180)),o.bT(Kt,Kt,xr),Kt}(pe,ee.transform),Xe=$e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),tt=Ae.properties.get("atmosphere-blend")*Xe.projectionTransition;if(tt===0)return;const it=No($e.worldSize,$e.center.lat),Et=$e.inverseProjectionMatrix,Ct=new Float64Array(4);Ct[3]=1,o.an(Ct,Ct,$e.modelViewProjectionMatrix),Ct[0]/=Ct[3],Ct[1]/=Ct[3],Ct[2]/=Ct[3],Ct[3]=1,o.an(Ct,Ct,Et),Ct[0]/=Ct[3],Ct[1]/=Ct[3],Ct[2]/=Ct[3],Ct[3]=1;const Dt=((Lt,dr,Ar,Kt,xr)=>({u_sun_pos:Lt,u_atmosphere_blend:dr,u_globe_position:Ar,u_globe_radius:Kt,u_inv_proj_matrix:xr}))(qe,tt,[Ct[0],Ct[1],Ct[2]],it,Et),Ht=wd(Fe,Ae);Re.draw(Fe,Me.TRIANGLES,Ne,En.disabled,Zn.alphaBlended,yn.disabled,Dt,null,null,"atmosphere",Ht.vertexBuffer,Ht.indexBuffer,Ht.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const ee=function(Ae,pe){let Fe=null;const Me=Object.values(Ae._layers).flatMap(qe=>qe.source&&!qe.isHidden(pe)?[Ae.sourceCaches[qe.source]]:[]),Re=Me.filter(qe=>qe.getSource().type==="vector"),Ne=Me.filter(qe=>qe.getSource().type!=="vector"),$e=qe=>{(!Fe||Fe.getSource().maxzoom<qe.getSource().maxzoom)&&(Fe=qe)};return Re.forEach(qe=>$e(qe)),Fe||Ne.forEach(qe=>$e(qe)),Fe}(this.style,this.transform.zoom);ee&&function(Ae,pe,Fe){for(let Me=0;Me<Fe.length;Me++)bd(Ae,pe,Fe[Me])}(this,ee,ee.getVisibleCoordinates())}this.options.showPadding&&function(ee){const Ae=ee.transform.padding;dl(ee,ee.transform.height-(Ae.top||0),3,Ea),dl(ee,Ae.bottom||0,3,_d),uf(ee,Ae.left||0,3,yd),uf(ee,ee.transform.width-(Ae.right||0),3,cf);const pe=ee.transform.centerPoint;(function(Fe,Me,Re,Ne){nA(Fe,Me-1,Re-10,2,20,Ne),nA(Fe,Me-10,Re-1,20,2,Ne)})(ee,pe.x,ee.transform.height-pe.y,wc)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=l?!o.bW(h,m):!o.bX(h,m)),y||(y=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),y&&(o.bY(h,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(C,S){const R=C.context,O=R.gl,Q=C.transform,K=Zn.unblended,Z=new on(O.LEQUAL,on.ReadWrite,[0,1]),ee=S.sourceCache.getRenderableTiles(),Ae=C.useProgram("terrainDepth");R.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),R.clear({color:o.b5.transparent,depth:1});for(const pe of ee){const Fe=S.getTerrainMesh(pe.tileID),Me=S.getTerrainData(pe.tileID),Re=Q.getProjectionData({overscaledTileID:pe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ne={u_ele_delta:S.getMeshFrameDelta(Q.zoom)};Ae.draw(R,O.TRIANGLES,Z,En.disabled,K,yn.backCCW,Ne,Me,Re,"terrain",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain),function(C,S){const R=C.context,O=R.gl,Q=C.transform,K=Zn.unblended,Z=new on(O.LEQUAL,on.ReadWrite,[0,1]),ee=S.getCoordsTexture(),Ae=S.sourceCache.getRenderableTiles(),pe=C.useProgram("terrainCoords");R.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),R.clear({color:o.b5.transparent,depth:1}),S.coordsIndex=[];for(const Fe of Ae){const Me=S.getTerrainMesh(Fe.tileID),Re=S.getTerrainData(Fe.tileID);R.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,ee.texture);const Ne={u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(Q.zoom)},$e=Q.getProjectionData({overscaledTileID:Fe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});pe.draw(R,O.TRIANGLES,Z,En.disabled,K,yn.backCCW,Ne,Re,$e,"terrain",Me.vertexBuffer,Me.indexBuffer,Me.segments),S.coordsIndex.push(Fe.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain))}renderLayer(l,h,m,y,C){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(y||[]).length)&&(this.id=m.id,o.bZ(m)?function(S,R,O,Q,K,Z){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=Z,Ae=En.disabled,pe=S.colorModeForRenderPass();(O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Fe,Me,Re,Ne,$e,qe,Xe,tt,it){const Et=Me.transform,Ct=Me.style.map.terrain,Dt=$e==="map",Ht=qe==="map";for(const Lt of Fe){const dr=Ne.getTile(Lt),Ar=dr.getBucket(Re);if(!Ar||!Ar.text||!Ar.text.segments.get().length)continue;const Kt=o.ae(Ar.textSizeData,Et.zoom),xr=o.au(dr,1,Me.transform.zoom),sn=dt(Dt,Me.transform,xr),Mn=Re.layout.get("icon-text-fit")!=="none"&&Ar.hasIconData();if(Kt){const gi=Math.pow(2,Et.zoom-dr.tileID.overscaledZ),ei=Ct?(mi,Dn)=>Ct.getElevation(Lt,mi,Dn):null;ph(Ar,Dt,Ht,it,Et,sn,gi,Kt,Mn,o.av(Et,dr,Xe,tt),Lt.toUnwrapped(),ei)}}}(Q,S,O,R,O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),K),O.paint.get("icon-opacity").constantOr(1)!==0&&Ru(S,R,O,Q,!1,O.paint.get("icon-translate"),O.paint.get("icon-translate-anchor"),O.layout.get("icon-rotation-alignment"),O.layout.get("icon-pitch-alignment"),O.layout.get("icon-keep-upright"),Ae,pe,ee),O.paint.get("text-opacity").constantOr(1)!==0&&Ru(S,R,O,Q,!0,O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.layout.get("text-keep-upright"),Ae,pe,ee),R.map.showCollisionBoxes&&(Pu(S,R,O,Q,!0),Pu(S,R,O,Q,!1))}(l,h,m,y,this.style.placement.variableOffsets,C):o.b_(m)?function(S,R,O,Q,K){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=K,ee=O.paint.get("circle-opacity"),Ae=O.paint.get("circle-stroke-width"),pe=O.paint.get("circle-stroke-opacity"),Fe=!O.layout.get("circle-sort-key").isConstant();if(ee.constantOr(1)===0&&(Ae.constantOr(1)===0||pe.constantOr(1)===0))return;const Me=S.context,Re=Me.gl,Ne=S.transform,$e=S.getDepthModeForSublayer(0,on.ReadOnly),qe=En.disabled,Xe=S.colorModeForRenderPass(),tt=[],it=Ne.getCircleRadiusCorrection();for(let Et=0;Et<Q.length;Et++){const Ct=Q[Et],Dt=R.getTile(Ct),Ht=Dt.getBucket(O);if(!Ht)continue;const Lt=O.paint.get("circle-translate"),dr=O.paint.get("circle-translate-anchor"),Ar=o.av(Ne,Dt,Lt,dr),Kt=Ht.programConfigurations.get(O.id),xr=S.useProgram("circle",Kt),sn=Ht.layoutVertexBuffer,Mn=Ht.indexBuffer,gi=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Ct),ei={programConfiguration:Kt,program:xr,layoutVertexBuffer:sn,indexBuffer:Mn,uniformValues:Xr(S,Dt,O,Ar,it),terrainData:gi,projectionData:Ne.getProjectionData({overscaledTileID:Ct,applyGlobeMatrix:!Z,applyTerrainMatrix:!0})};if(Fe){const mi=Ht.segments.get();for(const Dn of mi)tt.push({segments:new o.aE([Dn]),sortKey:Dn.sortKey,state:ei})}else tt.push({segments:Ht.segments,sortKey:0,state:ei})}Fe&&tt.sort((Et,Ct)=>Et.sortKey-Ct.sortKey);for(const Et of tt){const{programConfiguration:Ct,program:Dt,layoutVertexBuffer:Ht,indexBuffer:Lt,uniformValues:dr,terrainData:Ar,projectionData:Kt}=Et.state;Dt.draw(Me,Re.TRIANGLES,$e,qe,Xe,yn.backCCW,dr,Ar,Kt,O.id,Ht,Lt,Et.segments,O.paint,S.transform.zoom,Ct)}}(l,h,m,y,C):o.b$(m)?function(S,R,O,Q,K){if(O.paint.get("heatmap-opacity")===0)return;const Z=S.context,{isRenderingToTexture:ee,isRenderingGlobe:Ae}=K;if(S.style.map.terrain){for(const pe of Q){const Fe=R.getTile(pe);R.hasRenderableParent(pe)||(S.renderPass==="offscreen"?lf(S,Fe,O,pe,Ae):S.renderPass==="translucent"&&Jh(S,O,pe,ee,Ae))}Z.viewport.set([0,0,S.width,S.height])}else S.renderPass==="offscreen"?function(pe,Fe,Me,Re){const Ne=pe.context,$e=Ne.gl,qe=pe.transform,Xe=En.disabled,tt=new Zn([$e.ONE,$e.ONE],o.b5.transparent,[!0,!0,!0,!0]);(function(it,Et,Ct){const Dt=it.gl;it.activeTexture.set(Dt.TEXTURE1),it.viewport.set([0,0,Et.width/4,Et.height/4]);let Ht=Ct.heatmapFbos.get(o.bQ);Ht?(Dt.bindTexture(Dt.TEXTURE_2D,Ht.colorAttachment.get()),it.bindFramebuffer.set(Ht.framebuffer)):(Ht=gh(it,Et.width/4,Et.height/4),Ct.heatmapFbos.set(o.bQ,Ht))})(Ne,pe,Me),Ne.clear({color:o.b5.transparent});for(let it=0;it<Re.length;it++){const Et=Re[it];if(Fe.hasRenderableParent(Et))continue;const Ct=Fe.getTile(Et),Dt=Ct.getBucket(Me);if(!Dt)continue;const Ht=Dt.programConfigurations.get(Me.id),Lt=pe.useProgram("heatmap",Ht),dr=qe.getProjectionData({overscaledTileID:Et,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ar=qe.getCircleRadiusCorrection();Lt.draw(Ne,$e.TRIANGLES,on.disabled,Xe,tt,yn.backCCW,bi(Ct,qe.zoom,Me.paint.get("heatmap-intensity"),Ar),null,dr,Me.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,Me.paint,qe.zoom,Ht)}Ne.viewport.set([0,0,pe.width,pe.height])}(S,R,O,Q):S.renderPass==="translucent"&&function(pe,Fe){const Me=pe.context,Re=Me.gl;Me.setColorMode(pe.colorModeForRenderPass());const Ne=Fe.heatmapFbos.get(o.bQ);Ne&&(Me.activeTexture.set(Re.TEXTURE0),Re.bindTexture(Re.TEXTURE_2D,Ne.colorAttachment.get()),Me.activeTexture.set(Re.TEXTURE1),eA(Me,Fe).bind(Re.LINEAR,Re.CLAMP_TO_EDGE),pe.useProgram("heatmapTexture").draw(Me,Re.TRIANGLES,on.disabled,En.disabled,pe.colorModeForRenderPass(),yn.disabled,ii(pe,Fe,0,1),null,null,Fe.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments,Fe.paint,pe.transform.zoom))}(S,O)}(l,h,m,y,C):o.c0(m)?function(S,R,O,Q,K){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=K,ee=O.paint.get("line-opacity"),Ae=O.paint.get("line-width");if(ee.constantOr(1)===0||Ae.constantOr(1)===0)return;const pe=S.getDepthModeForSublayer(0,on.ReadOnly),Fe=S.colorModeForRenderPass(),Me=O.paint.get("line-dasharray"),Re=O.paint.get("line-pattern"),Ne=Re.constantOr(1),$e=O.paint.get("line-gradient"),qe=O.getCrossfadeParameters(),Xe=Ne?"linePattern":Me?"lineSDF":$e?"lineGradient":"line",tt=S.context,it=tt.gl,Et=S.transform;let Ct=!0;for(const Dt of Q){const Ht=R.getTile(Dt);if(Ne&&!Ht.patternsLoaded())continue;const Lt=Ht.getBucket(O);if(!Lt)continue;const dr=Lt.programConfigurations.get(O.id),Ar=S.context.program.get(),Kt=S.useProgram(Xe,dr),xr=Ct||Kt.program!==Ar,sn=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Dt),Mn=Re.constantOr(null);if(Mn&&Ht.imageAtlas){const qn=Ht.imageAtlas,Kn=qn.patternPositions[Mn.to.toString()],Xs=qn.patternPositions[Mn.from.toString()];Kn&&Xs&&dr.setConstantPatternPositions(Kn,Xs)}const gi=Et.getProjectionData({overscaledTileID:Dt,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),ei=Et.getPixelScale(),mi=Ne?hl(S,Ht,O,ei,qe):Me?of(S,Ht,O,ei,Me,qe):$e?wo(S,Ht,O,ei,Lt.lineClipsArray.length):ea(S,Ht,O,ei);if(Ne)tt.activeTexture.set(it.TEXTURE0),Ht.imageAtlasTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE),dr.updatePaintBuffers(qe);else if(Me&&(xr||S.lineAtlas.dirty))tt.activeTexture.set(it.TEXTURE0),S.lineAtlas.bind(tt);else if($e){const qn=Lt.gradients[O.id];let Kn=qn.texture;if(O.gradientVersion!==qn.version){let Xs=256;if(O.stepInterpolant){const es=R.getSource().maxzoom,cs=Dt.canonical.z===es?Math.ceil(1<<S.transform.maxZoom-Dt.canonical.z):1;Xs=o.ac(o.bR(Lt.maxLineLength/o.Y*1024*cs),256,tt.maxTextureSize)}qn.gradient=o.bS({expression:O.gradientExpression(),evaluationKey:"lineProgress",resolution:Xs,image:qn.gradient||void 0,clips:Lt.lineClipsArray}),qn.texture?qn.texture.update(qn.gradient):qn.texture=new J(tt,qn.gradient,it.RGBA),qn.version=O.gradientVersion,Kn=qn.texture}tt.activeTexture.set(it.TEXTURE0),Kn.bind(O.stepInterpolant?it.NEAREST:it.LINEAR,it.CLAMP_TO_EDGE)}let Dn;if(Z){const[qn]=S.getStencilConfigForOverlapAndUpdateStencilID(Q);Dn=qn[Dt.overscaledZ]}else Dn=S.stencilModeForClipping(Dt);Kt.draw(tt,it.TRIANGLES,pe,Dn,Fe,yn.disabled,mi,sn,gi,O.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,O.paint,S.transform.zoom,dr,Lt.layoutVertexBuffer2),Ct=!1}}(l,h,m,y,C):o.c1(m)?function(S,R,O,Q,K){const Z=O.paint.get("fill-color"),ee=O.paint.get("fill-opacity");if(ee.constantOr(1)===0)return;const{isRenderingToTexture:Ae}=K,pe=S.colorModeForRenderPass(),Fe=O.paint.get("fill-pattern"),Me=S.opaquePassEnabledForLayer()&&!Fe.constantOr(1)&&Z.constantOr(o.b5.transparent).a===1&&ee.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===Me){const Re=S.getDepthModeForSublayer(1,S.renderPass==="opaque"?on.ReadWrite:on.ReadOnly);Lu(S,R,O,Q,Re,pe,!1,Ae)}if(S.renderPass==="translucent"&&O.paint.get("fill-antialias")){const Re=S.getDepthModeForSublayer(O.getPaintProperty("fill-outline-color")?2:0,on.ReadOnly);Lu(S,R,O,Q,Re,pe,!0,Ae)}}(l,h,m,y,C):o.c2(m)?function(S,R,O,Q,K){const Z=O.paint.get("fill-extrusion-opacity");if(Z===0)return;const{isRenderingToTexture:ee}=K;if(S.renderPass==="translucent"){const Ae=new on(S.context.gl.LEQUAL,on.ReadWrite,S.depthRangeFor3D);if(Z!==1||O.paint.get("fill-extrusion-pattern").constantOr(1))tA(S,R,O,Q,Ae,En.disabled,Zn.disabled,ee),tA(S,R,O,Q,Ae,S.stencilModeFor3D(),S.colorModeForRenderPass(),ee);else{const pe=S.colorModeForRenderPass();tA(S,R,O,Q,Ae,En.disabled,pe,ee)}}}(l,h,m,y,C):o.c3(m)?function(S,R,O,Q,K){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=K,ee=S.context,Ae=S.style.projection.useSubdivision,pe=S.getDepthModeForSublayer(0,on.ReadOnly),Fe=S.colorModeForRenderPass();if(S.renderPass==="offscreen")(function(Me,Re,Ne,$e,qe,Xe,tt){const it=Me.context,Et=it.gl;for(const Ct of Ne){const Dt=Re.getTile(Ct),Ht=Dt.dem;if(!Ht||!Ht.data||!Dt.needsHillshadePrepare)continue;const Lt=Ht.dim,dr=Ht.stride,Ar=Ht.getPixels();if(it.activeTexture.set(Et.TEXTURE1),it.pixelStoreUnpackPremultiplyAlpha.set(!1),Dt.demTexture=Dt.demTexture||Me.getTileTexture(dr),Dt.demTexture){const xr=Dt.demTexture;xr.update(Ar,{premultiply:!1}),xr.bind(Et.NEAREST,Et.CLAMP_TO_EDGE)}else Dt.demTexture=new J(it,Ar,Et.RGBA,{premultiply:!1}),Dt.demTexture.bind(Et.NEAREST,Et.CLAMP_TO_EDGE);it.activeTexture.set(Et.TEXTURE0);let Kt=Dt.fbo;if(!Kt){const xr=new J(it,{width:Lt,height:Lt,data:null},Et.RGBA);xr.bind(Et.LINEAR,Et.CLAMP_TO_EDGE),Kt=Dt.fbo=it.createFramebuffer(Lt,Lt,!0,!1),Kt.colorAttachment.set(xr.texture)}it.bindFramebuffer.set(Kt.framebuffer),it.viewport.set([0,0,Lt,Lt]),Me.useProgram("hillshadePrepare").draw(it,Et.TRIANGLES,qe,Xe,tt,yn.disabled,qs(Dt.tileID,Ht),null,null,$e.id,Me.rasterBoundsBuffer,Me.quadTriangleIndexBuffer,Me.rasterBoundsSegments),Dt.needsHillshadePrepare=!1}})(S,R,Q,O,pe,En.disabled,Fe),ee.viewport.set([0,0,S.width,S.height]);else if(S.renderPass==="translucent")if(Ae){const[Me,Re,Ne]=S.stencilConfigForOverlapTwoPass(Q);md(S,R,O,Ne,Me,pe,Fe,!1,Z),md(S,R,O,Ne,Re,pe,Fe,!0,Z)}else{const[Me,Re]=S.getStencilConfigForOverlapAndUpdateStencilID(Q);md(S,R,O,Re,Me,pe,Fe,!1,Z)}}(l,h,m,y,C):o.c4(m)?function(S,R,O,Q,K){if(S.renderPass!=="translucent"||O.paint.get("raster-opacity")===0||!Q.length)return;const{isRenderingToTexture:Z}=K,ee=R.getSource(),Ae=S.style.projection.useSubdivision;if(ee instanceof tr)wi(S,R,O,Q,null,!1,!1,ee.tileCoords,ee.flippedWindingOrder,Z);else if(Ae){const[pe,Fe,Me]=S.stencilConfigForOverlapTwoPass(Q);wi(S,R,O,Me,pe,!1,!0,rA,!1,Z),wi(S,R,O,Me,Fe,!0,!0,rA,!1,Z)}else{const[pe,Fe]=S.getStencilConfigForOverlapAndUpdateStencilID(Q);wi(S,R,O,Fe,pe,!1,!0,rA,!1,Z)}}(l,h,m,y,C):o.c5(m)?function(S,R,O,Q,K){const Z=O.paint.get("background-color"),ee=O.paint.get("background-opacity");if(ee===0)return;const{isRenderingToTexture:Ae}=K,pe=S.context,Fe=pe.gl,Me=S.style.projection,Re=S.transform,Ne=Re.tileSize,$e=O.paint.get("background-pattern");if(S.isPatternMissing($e))return;const qe=!$e&&Z.a===1&&ee===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==qe)return;const Xe=En.disabled,tt=S.getDepthModeForSublayer(0,qe==="opaque"?on.ReadWrite:on.ReadOnly),it=S.colorModeForRenderPass(),Et=S.useProgram($e?"backgroundPattern":"background"),Ct=Q||Be(Re,{tileSize:Ne,terrain:S.style.map.terrain});$e&&(pe.activeTexture.set(Fe.TEXTURE0),S.imageManager.bind(S.context));const Dt=O.getCrossfadeParameters();for(const Ht of Ct){const Lt=Re.getProjectionData({overscaledTileID:Ht,applyGlobeMatrix:!Ae,applyTerrainMatrix:!0}),dr=$e?pc(ee,S,$e,{tileID:Ht,tileSize:Ne},Dt):dc(ee,Z),Ar=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Ht),Kt=Me.getMeshFromTileID(pe,Ht.canonical,!1,!0,"raster");Et.draw(pe,Fe.TRIANGLES,tt,Xe,it,yn.backCCW,dr,Ar,Lt,O.id,Kt.vertexBuffer,Kt.indexBuffer,Kt.segments)}}(l,0,m,y,C):o.c6(m)&&function(S,R,O,Q){const{isRenderingGlobe:K}=Q,Z=S.context,ee=O.implementation,Ae=S.style.projection,pe=S.transform,Fe=pe.getProjectionDataForCustomLayer(K),Me={farZ:pe.farZ,nearZ:pe.nearZ,fov:pe.fov*Math.PI/180,modelViewProjectionMatrix:pe.modelViewProjectionMatrix,projectionMatrix:pe.projectionMatrix,shaderData:{variantName:Ae.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Ae.shaderPreludeCode.vertexSource}`,define:Ae.shaderDefine},defaultProjectionData:Fe},Re=ee.renderingMode?ee.renderingMode:"2d";if(S.renderPass==="offscreen"){const Ne=ee.prerender;Ne&&(S.setCustomLayerDefaults(),Z.setColorMode(S.colorModeForRenderPass()),Ne.call(ee,Z.gl,Me),Z.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),Z.setColorMode(S.colorModeForRenderPass()),Z.setStencilMode(En.disabled);const Ne=Re==="3d"?S.getDepthModeFor3D():S.getDepthModeForSublayer(0,on.ReadOnly);Z.setDepthMode(Ne),ee.render(Z.gl,Me),Z.setDirty(),S.setBaseState(),Z.bindFramebuffer.set(null)}}(l,0,m,C))}saveTileTexture(l){const h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const h=this._tileTextures[l];return h&&h.length>0?h.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const h=this.imageManager.getPattern(l.from.toString()),m=this.imageManager.getPattern(l.to.toString());return!h||!m}useProgram(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.cache=this.cache||{};const y=!!this.style.map.terrain,C=this.style.projection,S=l+(h?h.cacheKey:"")+`/${m?nf:C.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"");return this.cache[S]||(this.cache[S]=new he(this.context,Ni[l],h,Ah[l],this._showOverdrawInspector,y,m?Ni.projectionMercator:C.shaderPreludeCode,m?hu:C.shaderDefine)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new J(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:h}=this.context.gl;return this.width!==l||this.height!==h}}function xc(x,l){var h=this;let m,y=!1,C=null,S=null;const R=()=>{C=null,y&&(x.apply(S,m),C=setTimeout(R,l),y=!1)};return function(){for(var O=arguments.length,Q=new Array(O),K=0;K<O;K++)Q[K]=arguments[K];return y=!0,S=h,m=Q,C||R(),C}}class pl{constructor(l){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let m;return h.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(m=y)}),(m&&m[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(!this._isValidHash(h))return!1;const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:m,pitch:+(h[4]||0)}),!0},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const m=h.join("/");let y=m;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${m}`);let C=window.location.hash.replace(y,"");C.startsWith("#&")?C=C.slice(0,1)+C.slice(2):C==="#"&&(C="");let S=window.location.href.replace(/(#.+)?$/,C);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=xc(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(l){const h=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,y),S=Math.round(h.lng*C)/C,R=Math.round(h.lat*C)/C,O=this._map.getBearing(),Q=this._map.getPitch();let K="";if(K+=l?`/${S}/${R}/${m}`:`${m}/${R}/${S}`,(O||Q)&&(K+="/"+Math.round(10*O)/10),Q&&(K+=`/${Math.round(Q)}`),this._hashName){const Z=this._hashName;let ee=!1;const Ae=window.location.hash.slice(1).split("&").map(pe=>{const Fe=pe.split("=")[0];return Fe===Z?(ee=!0,`${Fe}=${K}`):pe}).filter(pe=>pe);return ee||Ae.push(`${Z}=${K}`),`#${Ae.join("&")}`}return`#${K}`}_isValidHash(l){if(l.length<3||l.some(isNaN))return!1;try{new o.O(+l[2],+l[1])}catch{return!1}const h=+l[0],m=+(l[3]||0),y=+(l[4]||0);return h>=this._map.getMinZoom()&&h<=this._map.getMaxZoom()&&m>=-180&&m<=180&&y>=this._map.getMinPitch()&&y<=this._map.getMaxPitch()}}const lo={linearity:.3,easing:o.c7(0,0,.3,1)},gl=o.e({deceleration:2500,maxSpeed:1400},lo),Yp=o.e({deceleration:20,maxSpeed:1400},lo),xd=o.e({deceleration:1e3,maxSpeed:360},lo),zl=o.e({deceleration:1e3,maxSpeed:90},lo),na=o.e({deceleration:1e3,maxSpeed:360},lo);class hf{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:w.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,h=w.now();for(;l.length>0&&h-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,h.roll+=C.rollDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(h.pan.mag()){const C=co(h.pan.mag(),m,o.e({},gl,l||{})),S=h.pan.mult(C.amount/h.pan.mag()),R=this._map.cameraHelper.handlePanInertia(S,this._map.transform);y.center=R.easingCenter,y.offset=R.easingOffset,_h(y,C)}if(h.zoom){const C=co(h.zoom,m,Yp);y.zoom=this._map.transform.zoom+C.amount,_h(y,C)}if(h.bearing){const C=co(h.bearing,m,xd);y.bearing=this._map.transform.bearing+o.ac(C.amount,-179,179),_h(y,C)}if(h.pitch){const C=co(h.pitch,m,zl);y.pitch=this._map.transform.pitch+C.amount,_h(y,C)}if(h.roll){const C=co(h.roll,m,na);y.roll=this._map.transform.roll+o.ac(C.amount,-179,179),_h(y,C)}if(y.zoom||y.bearing){const C=h.pinchAround===void 0?h.around:h.pinchAround;y.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),o.e(y,{noMoveStart:!0})}}function _h(x,l){(!x.duration||x.duration<l.duration)&&(x.duration=l.duration,x.easing=l.easing)}function co(x,l,h){const{maxSpeed:m,linearity:y,deceleration:C}=h,S=o.ac(x*y/(l/1e3),-m,m),R=Math.abs(S)/(C*y);return{easing:h.easing,duration:1e3*R,amount:S*(R/2)}}class Qi extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const C=v.mousePos(h.getCanvas(),m),S=h.unproject(C);super(l,o.e({point:C,lngLat:S,originalEvent:m},y)),this._defaultPrevented=!1,this.target=h}}class Uu extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,m){const y=l==="touchend"?m.changedTouches:m.touches,C=v.touchPos(h.getCanvasContainer(),y),S=C.map(O=>h.unproject(O)),R=C.reduce((O,Q,K,Z)=>O.add(Q.div(Z.length)),new o.P(0,0));super(l,{points:C,point:R,lngLats:S,lngLat:h.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class Sa extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,m){super(l,{originalEvent:m}),this._defaultPrevented=!1}}class yh{constructor(l,h){this._map=l,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new Sa(l.type,this._map,l))}mousedown(l,h){return this._mousedownPos=h,this._firePreventable(new Qi(l.type,this._map,l))}mouseup(l){this._map.fire(new Qi(l.type,this._map,l))}click(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Qi(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Qi(l.type,this._map,l))}mouseover(l){this._map.fire(new Qi(l.type,this._map,l))}mouseout(l){this._map.fire(new Qi(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Uu(l.type,this._map,l))}touchmove(l){this._map.fire(new Uu(l.type,this._map,l))}touchend(l){this._map.fire(new Uu(l.type,this._map,l))}touchcancel(l){this._map.fire(new Uu(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Af{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Qi(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Qi(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bc{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.screenPointToLocation(o.P.convert(l),this._map.terrain)}}class bh{constructor(l,h){this._map=l,this._tr=new Bc(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(v.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(l,h){if(!this._active)return;const m=h;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=v.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const C=Math.min(y.x,m.x),S=Math.max(y.x,m.x),R=Math.min(y.y,m.y),O=Math.max(y.y,m.y);v.setTransform(this._box,`translate(${C}px,${R}px)`),this._box.style.width=S-C+"px",this._box.style.height=O-R+"px"}mouseupWindow(l,h){if(!this._active||l.button!==0)return;const m=this._startPos,y=h;if(this.reset(),v.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:l})),{cameraAnimation:C=>C.fitScreenCoordinates(m,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(v.remove(this._box),this._box=null),v.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,h){return this._map.fire(new o.k(l,{originalEvent:h}))}}function iA(x,l){if(x.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${l.length}`);const h={};for(let m=0;m<x.length;m++)h[x[m].identifier]=l[m];return h}class Zp{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,h,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const C=new o.P(0,0);for(const S of y)C._add(S);return C.div(y.length)}(h),this.touches=iA(m,h)))}touchmove(l,h,m){if(this.aborted||!this.centroid)return;const y=iA(m,h);for(const C in this.touches){const S=y[C];(!S||S.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(l,h,m){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Cc{constructor(l){this.singleTap=new Zp(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,h,m){this.singleTap.touchstart(l,h,m)}touchmove(l,h,m){this.singleTap.touchmove(l,h,m)}touchend(l,h,m){const y=this.singleTap.touchend(l,h,m);if(y){const C=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(C&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Hl{constructor(l){this._tr=new Bc(l),this._zoomIn=new Cc({numTouches:1,numTaps:2}),this._zoomOut=new Cc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,h,m){this._zoomIn.touchstart(l,h,m),this._zoomOut.touchstart(l,h,m)}touchmove(l,h,m){this._zoomIn.touchmove(l,h,m),this._zoomOut.touchmove(l,h,m)}touchend(l,h,m){const y=this._zoomIn.touchend(l,h,m),C=this._zoomOut.touchend(l,h,m),S=this._tr;return y?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(y)},{originalEvent:l})}):C?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(C)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mr{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(){const l=this._moveFunction(...arguments);if(l.bearingDelta||l.pitchDelta||l.rollDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(l,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=Array.isArray(h)?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,h){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const y=Array.isArray(h)?h[0]:h;return!this._moved&&y.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(m,y))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&v.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jp={0:1,2:2};class Du{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const h=v.mouseButton(l);this._eventButton=h}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(h,m){const y=Jp[m];return h.buttons===void 0||(h.buttons&y)!==y}(l,this._eventButton)}isValidEndEvent(l){return v.mouseButton(l)===this._eventButton}}class eg{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}class sA{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Du({checkCorrectEvent:()=>!0}),h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new eg;this.mouseMoveStateManager=l,this.oneFingerTouchMoveStateManager=h}_executeRelevantHandler(l,h,m){return l instanceof MouseEvent?h(l):typeof TouchEvent<"u"&&l instanceof TouchEvent?m(l):void 0}startMove(l){this._executeRelevantHandler(l,h=>this.mouseMoveStateManager.startMove(h),h=>this.oneFingerTouchMoveStateManager.startMove(h))}endMove(l){this._executeRelevantHandler(l,h=>this.mouseMoveStateManager.endMove(h),h=>this.oneFingerTouchMoveStateManager.endMove(h))}isValidStartEvent(l){return this._executeRelevantHandler(l,h=>this.mouseMoveStateManager.isValidStartEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidStartEvent(h))}isValidMoveEvent(l){return this._executeRelevantHandler(l,h=>this.mouseMoveStateManager.isValidMoveEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(h))}isValidEndEvent(l){return this._executeRelevantHandler(l,h=>this.mouseMoveStateManager.isValidEndEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidEndEvent(h))}}const Vl=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=l=>{l.preventDefault()}};class oA{constructor(l,h){this._clickTolerance=l.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(l){return l<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(l,h,m){return this._calculateTransform(l,h,m)}touchmove(l,h,m){if(this._active){if(!this._shouldBePrevented(m.length))return l.preventDefault(),this._calculateTransform(l,h,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",l)}}touchend(l,h,m){this._calculateTransform(l,h,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,h,m){m.length>0&&(this._active=!0);const y=iA(m,h),C=new o.P(0,0),S=new o.P(0,0);let R=0;for(const Q in y){const K=y[Q],Z=this._touches[Q];Z&&(C._add(K),S._add(K.sub(Z)),R++,y[Q]=K)}if(this._touches=y,this._shouldBePrevented(R)||!S.mag())return;const O=S.div(R);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(R),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,h,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([h[0],h[1]]))}touchmove(l,h,m){if(!this._firstTwoTouches)return;l.preventDefault();const[y,C]=this._firstTwoTouches,S=vh(m,h,y),R=vh(m,h,C);if(!S||!R)return;const O=this._aroundCenter?null:S.add(R).div(2);return this._move([S,R],O,l)}touchend(l,h,m){if(!this._firstTwoTouches)return;const[y,C]=this._firstTwoTouches,S=vh(m,h,y),R=vh(m,h,C);S&&R||(this._active&&v.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function vh(x,l,h){for(let m=0;m<x.length;m++)if(x[m].identifier===h)return l[m]}function Bd(x,l){return Math.log(x/l)/Math.LN2}class E extends bn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,h){const m=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Bd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bd(this._distance,m),pinchAround:h}}}function F(x,l){return 180*x.angleWith(l)/Math.PI}class H extends bn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,h,m){const y=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:F(this._vector,y),pinchAround:h}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const h=25/(Math.PI*this._minDiameter)*360,m=F(l,this._startVector);return Math.abs(m)<h}}function X(x){return Math.abs(x.y)>Math.abs(x.x)}class ue extends bn{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,h,m){super.touchstart(l,h,m),this._currentTouchCount=m.length}_start(l){this._lastPoints=l,X(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,h,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=l[0].sub(this._lastPoints[0]),C=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,C,m.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(y.y+C.y)/2*-.5}):void 0}gestureBeginsVertically(l,h,m){if(this._valid!==void 0)return this._valid;const y=l.mag()>=2,C=h.mag()>=2;if(!y&&!C)return;if(!y||!C)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=l.y>0==h.y>0;return X(l)&&X(h)&&S}}const ye={panStep:100,bearingStep:15,pitchStep:10};class be{constructor(l){this._tr=new Bc(l);const h=ye;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let h=0,m=0,y=0,C=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?m=-1:(l.preventDefault(),C=-1);break;case 39:l.shiftKey?m=1:(l.preventDefault(),C=1);break;case 38:l.shiftKey?y=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?y=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:R=>{const O=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:we,zoom:h?Math.round(O.zoom)+h*(l.shiftKey?2:1):O.zoom,bearing:O.bearing+m*this._bearingStep,pitch:O.pitch+y*this._pitchStep,offset:[-C*this._panStep,-S*this._panStep],center:O.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function we(x){return x*(2-x)}const Ee=4.000244140625;class Oe{constructor(l,h){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=l,this._tr=new Bc(l),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(l){return!!this._map.cooperativeGestures.isEnabled()&&!(l.ctrlKey||this._map.cooperativeGestures.isBypassed(l))}wheel(l){if(!this.isEnabled())return;if(this._shouldBePrevented(l))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",l);let h=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const m=w.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,h!==0&&h%Ee==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(y*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=v.mousePos(this._map.getCanvas(),l),m=this._tr;this._aroundPoint=this._aroundCenter?m.transform.locationToScreenPoint(o.O.convert(m.center)):h,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const R=l.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=R),typeof this._targetZoom=="number"&&(this._targetZoom+=R)}if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>Ee?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&O!==0&&(O=1/O);const Q=typeof this._targetZoom!="number"?l.scale:o.aG(this._targetZoom);this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,o.a9(Q*O))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom!="number"?l.zoom:this._targetZoom,m=this._startZoom,y=this._easing;let C,S=!1;if(this._type==="wheel"&&m&&y){const R=w.now()-this._lastWheelEventTime,O=Math.min((R+5)/200,1),Q=y(O);C=o.z.number(m,h,Q),O<1?this._frameId||(this._frameId=!0):S=!0}else C=h,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=C,{noInertia:!0,needsRenderFrame:!S,zoomDelta:C-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let h=o.c9;if(this._prevEase){const m=this._prevEase,y=(w.now()-m.start)/m.duration,C=m.easing(y+.01)-m.easing(y),S=.27/Math.sqrt(C*C+1e-4)*.01,R=Math.sqrt(.0729-S*S);h=o.c7(S,R,.25,1)}return this._prevEase={start:w.now(),duration:l,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ot{constructor(l,h){this._clickZoom=l,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _t{constructor(l){this._tr=new Bc(l),this.reset()}reset(){this._active=!1}dblclick(l,h){return l.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class St{constructor(){this._tap=new Cc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,h,m){if(!this._swipePoint)if(this._tapTime){const y=h[0],C=l.timeStamp-this._tapTime<500,S=this._tapPoint.dist(y)<30;C&&S?m.length>0&&(this._swipePoint=y,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(l,h,m)}touchmove(l,h,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=h[0],C=y.y-this._swipePoint.y;return this._swipePoint=y,l.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(l,h,m)}touchend(l,h,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const y=this._tap.touchend(l,h,m);y&&(this._tapTime=l.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gt{constructor(l,h,m){this._el=l,this._mousePan=h,this._touchPan=m}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yt{constructor(l,h,m,y){this._pitchWithRotate=l.pitchWithRotate,this._rollEnabled=l.rollEnabled,this._mouseRotate=h,this._mousePitch=m,this._mouseRoll=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Qt{constructor(l,h,m,y){this._el=l,this._touchZoom=h,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ut{constructor(l,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=v.create("div","maplibregl-cooperative-gesture-screen",l);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=h,this._container.appendChild(y);const C=document.createElement("div");C.className="maplibregl-mobile-message",C.textContent=m,this._container.appendChild(C),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(v.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(l){return l[this._bypassKey]}notifyGestureBlocked(l,h){this._enabled&&(this._map.fire(new o.k("cooperativegestureprevented",{gestureType:l,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ft=x=>x.zoom||x.drag||x.roll||x.pitch||x.rotate;class Gt extends o.k{}function er(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta||x.rollDelta}class wt{constructor(l,h){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,C)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=y.type==="renderFrame"?void 0:y,R={needsRenderFrame:!1},O={},Q={},K=y.touches,Z=K?this._getMapTouches(K):void 0,ee=Z?v.touchPos(this._map.getCanvas(),Z):v.mousePos(this._map.getCanvas(),y);for(const{handlerName:Fe,handler:Me,allowed:Re}of this._handlers){if(!Me.isEnabled())continue;let Ne;this._blockedByActive(Q,Re,Fe)?Me.reset():Me[C||y.type]&&(Ne=Me[C||y.type](y,ee,Z),this.mergeHandlerResult(R,O,Ne,Fe,S),Ne&&Ne.needsRenderFrame&&this._triggerRenderFrame()),(Ne||Me.isActive())&&(Q[Fe]=Me)}const Ae={};for(const Fe in this._previousActiveHandlers)Q[Fe]||(Ae[Fe]=S);this._previousActiveHandlers=Q,(Object.keys(Ae).length||er(R))&&(this._changes.push([R,O,Ae]),this._triggerRenderFrame()),(Object.keys(Q).length||er(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:pe}=R;pe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],pe(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hf(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,C,S]of this._listeners)v.addEventListener(y,C,y===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[l,h,m]of this._listeners)v.removeEventListener(l,h,l===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(l){const h=this._map,m=h.getCanvasContainer();this._add("mapEvent",new yh(h,l));const y=h.boxZoom=new bh(h,l);this._add("boxZoom",y),l.interactive&&l.boxZoom&&y.enable();const C=h.cooperativeGestures=new ut(h,l.cooperativeGestures);this._add("cooperativeGestures",C),l.cooperativeGestures&&C.enable();const S=new Hl(h),R=new _t(h);h.doubleClickZoom=new ot(R,S),this._add("tapZoom",S),this._add("clickZoom",R),l.interactive&&l.doubleClickZoom&&h.doubleClickZoom.enable();const O=new St;this._add("tapDragZoom",O);const Q=h.touchPitch=new ue(h);this._add("touchPitch",Q),l.interactive&&l.touchPitch&&h.touchPitch.enable(l.touchPitch);const K=()=>h.project(h.getCenter()),Z=function(qe,Xe){let{enable:tt,clickTolerance:it,aroundCenter:Et=!0,minPixelCenterThreshold:Ct=100,rotateDegreesPerPixelMoved:Dt=.8}=qe;const Ht=new Du({checkCorrectEvent:Lt=>v.mouseButton(Lt)===0&&Lt.ctrlKey||v.mouseButton(Lt)===2&&!Lt.ctrlKey});return new Mr({clickTolerance:it,move:(Lt,dr)=>{const Ar=Xe();if(Et&&Math.abs(Ar.y-Lt.y)>Ct)return{bearingDelta:o.c8(new o.P(Lt.x,dr.y),dr,Ar)};let Kt=(dr.x-Lt.x)*Dt;return Et&&dr.y<Ar.y&&(Kt=-Kt),{bearingDelta:Kt}},moveStateManager:Ht,enable:tt,assignEvents:Vl})}(l,K),ee=function(qe){let{enable:Xe,clickTolerance:tt,pitchDegreesPerPixelMoved:it=-.5}=qe;const Et=new Du({checkCorrectEvent:Ct=>v.mouseButton(Ct)===0&&Ct.ctrlKey||v.mouseButton(Ct)===2});return new Mr({clickTolerance:tt,move:(Ct,Dt)=>({pitchDelta:(Dt.y-Ct.y)*it}),moveStateManager:Et,enable:Xe,assignEvents:Vl})}(l),Ae=function(qe,Xe){let{enable:tt,clickTolerance:it,rollDegreesPerPixelMoved:Et=.3}=qe;const Ct=new Du({checkCorrectEvent:Dt=>v.mouseButton(Dt)===2&&Dt.ctrlKey});return new Mr({clickTolerance:it,move:(Dt,Ht)=>{const Lt=Xe();let dr=(Ht.x-Dt.x)*Et;return Ht.y<Lt.y&&(dr=-dr),{rollDelta:dr}},moveStateManager:Ct,enable:tt,assignEvents:Vl})}(l,K);h.dragRotate=new Yt(l,Z,ee,Ae),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Ae,["mousePitch"]),l.interactive&&l.dragRotate&&h.dragRotate.enable();const pe=function(qe){let{enable:Xe,clickTolerance:tt}=qe;const it=new Du({checkCorrectEvent:Et=>v.mouseButton(Et)===0&&!Et.ctrlKey});return new Mr({clickTolerance:tt,move:(Et,Ct)=>({around:Ct,panDelta:Ct.sub(Et)}),activateOnStart:!0,moveStateManager:it,enable:Xe,assignEvents:Vl})}(l),Fe=new oA(l,h);h.dragPan=new gt(m,pe,Fe),this._add("mousePan",pe),this._add("touchPan",Fe,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&h.dragPan.enable(l.dragPan);const Me=new H,Re=new E;h.touchZoomRotate=new Qt(m,Re,Me,O),this._add("touchRotate",Me,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&h.touchZoomRotate.enable(l.touchZoomRotate);const Ne=h.scrollZoom=new Oe(h,()=>this._triggerRenderFrame());this._add("scrollZoom",Ne,["mousePan"]),l.interactive&&l.scrollZoom&&h.scrollZoom.enable(l.scrollZoom);const $e=h.keyboard=new be(h);this._add("keyboard",$e),l.interactive&&l.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Af(h))}_add(l,h,m){this._handlers.push({handlerName:l,handler:h,allowed:m}),this._handlersById[l]=h}stop(l){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ft(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,h,m){for(const y in l)if(y!==m&&(!h||h.indexOf(y)<0))return!0;return!1}_getMapTouches(l){const h=[];for(const m of l)this._el.contains(m.target)&&h.push(m);return h}mergeHandlerResult(l,h,m,y,C){if(!m)return;o.e(l,m);const S={handlerName:y,originalEvent:m.originalEvent||C};m.zoomDelta!==void 0&&(h.zoom=S),m.panDelta!==void 0&&(h.drag=S),m.rollDelta!==void 0&&(h.roll=S),m.pitchDelta!==void 0&&(h.pitch=S),m.bearingDelta!==void 0&&(h.rotate=S)}_applyChanges(){const l={},h={},m={};for(const[y,C,S]of this._changes)y.panDelta&&(l.panDelta=(l.panDelta||new o.P(0,0))._add(y.panDelta)),y.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+y.pitchDelta),y.rollDelta&&(l.rollDelta=(l.rollDelta||0)+y.rollDelta),y.around!==void 0&&(l.around=y.around),y.pinchAround!==void 0&&(l.pinchAround=y.pinchAround),y.noInertia&&(l.noInertia=y.noInertia),o.e(h,C),o.e(m,S);this._updateMapTransform(l,h,m),this._changes=[]}_updateMapTransform(l,h,m){const y=this._map,C=y._getTransformForUpdate(),S=y.terrain;if(!(er(l)||S&&this._terrainMovement))return this._fireEvents(h,m,!0);y._stop(!0);let{panDelta:R,zoomDelta:O,bearingDelta:Q,pitchDelta:K,rollDelta:Z,around:ee,pinchAround:Ae}=l;Ae!==void 0&&(ee=Ae),ee=ee||y.transform.centerPoint,S&&!C.isPointOnMapSurface(ee)&&(ee=C.centerPoint);const pe={panDelta:R,zoomDelta:O,rollDelta:Z,pitchDelta:K,bearingDelta:Q,around:ee};this._map.cameraHelper.useGlobeControls&&!C.isPointOnMapSurface(ee)&&(ee=C.centerPoint);const Fe=ee.distSqr(C.centerPoint)<.01?C.center:C.screenPointToLocation(R?ee.sub(R):ee);S?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(pe,C),this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?C.setCenter(C.screenPointToLocation(C.centerPoint.sub(R))):this._map.cameraHelper.handleMapControlsPan(pe,C,Fe):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(pe,C,Fe))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(pe,C),this._map.cameraHelper.handleMapControlsPan(pe,C,Fe)),y._applyUpdatedTransform(C),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,m,!0)}_fireEvents(l,h,m){const y=ft(this._eventsInProgress),C=ft(l),S={};for(const Z in l){const{originalEvent:ee}=l[Z];this._eventsInProgress[Z]||(S[`${Z}start`]=ee),this._eventsInProgress[Z]=l[Z]}!y&&C&&this._fireEvent("movestart",C.originalEvent);for(const Z in S)this._fireEvent(Z,S[Z]);C&&this._fireEvent("move",C.originalEvent);for(const Z in l){const{originalEvent:ee}=l[Z];this._fireEvent(Z,ee)}const R={};let O;for(const Z in this._eventsInProgress){const{handlerName:ee,originalEvent:Ae}=this._eventsInProgress[Z];this._handlersById[ee].isActive()||(delete this._eventsInProgress[Z],O=h[ee]||Ae,R[`${Z}end`]=O)}for(const Z in R)this._fireEvent(Z,R[Z]);const Q=ft(this._eventsInProgress),K=(y||C)&&!Q;if(K&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Z=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&Z.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(Z)}if(m&&K){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ee=Ae=>Ae!==0&&-this._bearingSnap<Ae&&Ae<this._bearingSnap;!Z||!Z.essential&&w.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:O})),ee(this._map.getBearing())&&this._map.resetNorth()):(ee(Z.bearing||this._map.getBearing())&&(Z.bearing=0),Z.freezeElevation=!0,this._map.easeTo(Z,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(l,h){this._map.fire(new o.k(l,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new Gt("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class $t extends o.E{constructor(l,h,m){super(),this._renderFrameCallback=()=>{const y=Math.min((w.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=m.bearingSnap,this.cameraHelper=h,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(l,h){l.apply(this.transform),this.transform=l,this.cameraHelper=h}getCenter(){return new o.O(this.transform.center.lng,this.transform.center.lat)}setCenter(l,h){return this.jumpTo({center:l},h)}getCenterElevation(){return this.transform.elevation}setCenterElevation(l,h){return this.jumpTo({elevation:l},h),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(l){this._centerClampedToGround=l}panBy(l,h,m){return l=o.P.convert(l).mult(-1),this.panTo(this.transform.center,o.e({offset:l},h),m)}panTo(l,h,m){return this.easeTo(o.e({center:l},h),m)}getZoom(){return this.transform.zoom}setZoom(l,h){return this.jumpTo({zoom:l},h),this}zoomTo(l,h,m){return this.easeTo(o.e({zoom:l},h),m)}zoomIn(l,h){return this.zoomTo(this.getZoom()+1,l,h),this}zoomOut(l,h){return this.zoomTo(this.getZoom()-1,l,h),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(l,h){return l!=this.transform.fov&&(this.transform.setFov(l),this.fire(new o.k("movestart",h)).fire(new o.k("move",h)).fire(new o.k("moveend",h))),this}getBearing(){return this.transform.bearing}setBearing(l,h){return this.jumpTo({bearing:l},h),this}getPadding(){return this.transform.padding}setPadding(l,h){return this.jumpTo({padding:l},h),this}rotateTo(l,h,m){return this.easeTo(o.e({bearing:l},h),m)}resetNorth(l,h){return this.rotateTo(0,o.e({duration:1e3},l),h),this}resetNorthPitch(l,h){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},l),h),this}snapToNorth(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this}getPitch(){return this.transform.pitch}setPitch(l,h){return this.jumpTo({pitch:l},h),this}getRoll(){return this.transform.roll}setRoll(l,h){return this.jumpTo({roll:l},h),this}cameraForBounds(l,h){l=wr.convert(l).adjustAntiMeridian();const m=h&&h.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),m,h)}_cameraForBoxAndBearing(l,h,m,y){const C={top:0,bottom:0,right:0,left:0};if(typeof(y=o.e({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const Q=y.padding;y.padding={top:Q,bottom:Q,right:Q,left:Q}}const S=o.e(C,y.padding);y.padding=S;const R=this.transform,O=new wr(l,h);return this.cameraHelper.cameraForBoxAndBearing(y,S,O,m,R)}fitBounds(l,h,m){return this._fitInternal(this.cameraForBounds(l,h),h,m)}fitScreenCoordinates(l,h,m,y,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(l)),this.transform.screenPointToLocation(o.P.convert(h)),m,y),y,C)}_fitInternal(l,h,m){return l?(delete(h=o.e(l,h)).padding,h.linear?this.easeTo(h,m):this.flyTo(h,m)):this}jumpTo(l,h){this.stop();const m=this._getTransformForUpdate();let y=!1,C=!1,S=!1;const R=m.zoom;this.cameraHelper.handleJumpToCenterZoom(m,l);const O=m.zoom!==R;return"elevation"in l&&m.elevation!==+l.elevation&&m.setElevation(+l.elevation),"bearing"in l&&m.bearing!==+l.bearing&&(y=!0,m.setBearing(+l.bearing)),"pitch"in l&&m.pitch!==+l.pitch&&(C=!0,m.setPitch(+l.pitch)),"roll"in l&&m.roll!==+l.roll&&(S=!0,m.setRoll(+l.roll)),l.padding==null||m.isPaddingEqual(l.padding)||m.setPadding(l.padding),this._applyUpdatedTransform(m),this.fire(new o.k("movestart",h)).fire(new o.k("move",h)),O&&this.fire(new o.k("zoomstart",h)).fire(new o.k("zoom",h)).fire(new o.k("zoomend",h)),y&&this.fire(new o.k("rotatestart",h)).fire(new o.k("rotate",h)).fire(new o.k("rotateend",h)),C&&this.fire(new o.k("pitchstart",h)).fire(new o.k("pitch",h)).fire(new o.k("pitchend",h)),S&&this.fire(new o.k("rollstart",h)).fire(new o.k("roll",h)).fire(new o.k("rollend",h)),this.fire(new o.k("moveend",h))}calculateCameraOptionsFromTo(l,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const C=o.Z.fromLngLat(l,h),S=o.Z.fromLngLat(m,y),R=S.x-C.x,O=S.y-C.y,Q=S.z-C.z,K=Math.hypot(R,O,Q);if(K===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(R,O),ee=o.a9(this.transform.cameraToCenterDistance/K/this.transform.tileSize),Ae=180*Math.atan2(R,-O)/Math.PI;let pe=180*Math.acos(Z/K)/Math.PI;return pe=Q<0?90-pe:90+pe,{center:S.toLngLat(),elevation:y,zoom:ee,pitch:pe,bearing:Ae}}calculateCameraOptionsFromCameraLngLatAltRotation(l,h,m,y,C){const S=this.transform.calculateCenterFromCameraLngLatAlt(l,h,m,y);return{center:S.center,elevation:S.elevation,zoom:S.zoom,bearing:m,pitch:y,roll:C}}easeTo(l,h){this._stop(!1,l.easeId),((l=o.e({offset:[0,0],duration:500,easing:o.c9},l)).animate===!1||!l.essential&&w.prefersReducedMotion)&&(l.duration=0);const m=this._getTransformForUpdate(),y=this.getBearing(),C=m.pitch,S=m.roll,R="bearing"in l?this._normalizeBearing(l.bearing,y):y,O="pitch"in l?+l.pitch:C,Q="roll"in l?this._normalizeBearing(l.roll,S):S,K="padding"in l?l.padding:m.padding,Z=o.P.convert(l.offset);let ee,Ae;l.around&&(ee=o.O.convert(l.around),Ae=m.locationToScreenPoint(ee));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Fe=this.cameraHelper.handleEaseTo(m,{bearing:R,pitch:O,roll:Q,padding:K,around:ee,aroundPoint:Ae,offsetAsPoint:Z,offset:l.offset,zoom:l.zoom,center:l.center});return this._rotating=this._rotating||y!==R,this._pitching=this._pitching||O!==C,this._rolling=this._rolling||Q!==S,this._padding=!m.isPaddingEqual(K),this._zooming=this._zooming||Fe.isZooming,this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,pe),this.terrain&&this._prepareElevation(Fe.elevationCenter),this._ease(Me=>{Fe.easeFunc(Me),this.terrain&&!l.freezeElevation&&this._updateElevation(Me),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Me=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(h,Me)},l),this}_prepareEase(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,h||m.moving||this.fire(new o.k("movestart",l)),this._zooming&&!m.zooming&&this.fire(new o.k("zoomstart",l)),this._rotating&&!m.rotating&&this.fire(new o.k("rotatestart",l)),this._pitching&&!m.pitching&&this.fire(new o.k("pitchstart",l)),this._rolling&&!m.rolling&&this.fire(new o.k("rollstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&h!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(m-(h-(m*l+this._elevationStart))/(1-l)),this._elevationTarget=h}this.transform.setElevation(o.z.number(this._elevationStart,this._elevationTarget,l))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(l){if(!this.terrain&&l.elevation>=0&&l.pitch<=90)return{};const h=l.getCameraLngLat(),m=l.getCameraAltitude(),y=this.terrain?this.terrain.getElevationForLngLatZoom(h,l.zoom):0;if(m<y){const C=this.calculateCameraOptionsFromTo(h,y,l.center,l.elevation);return{pitch:C.pitch,zoom:C.zoom}}return{}}_applyUpdatedTransform(l){const h=[];if(h.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&h.push(y=>this.transformCameraUpdate(y)),!h.length)return;const m=l.clone();for(const y of h){const C=m.clone(),{center:S,zoom:R,roll:O,pitch:Q,bearing:K,elevation:Z}=y(C);S&&C.setCenter(S),Z!==void 0&&C.setElevation(Z),R!==void 0&&C.setZoom(R),O!==void 0&&C.setRoll(O),Q!==void 0&&C.setPitch(Q),K!==void 0&&C.setBearing(K),m.apply(C)}this.transform.apply(m)}_fireMoveEvents(l){this.fire(new o.k("move",l)),this._zooming&&this.fire(new o.k("zoom",l)),this._rotating&&this.fire(new o.k("rotate",l)),this._pitching&&this.fire(new o.k("pitch",l)),this._rolling&&this.fire(new o.k("roll",l))}_afterEase(l,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const m=this._zooming,y=this._rotating,C=this._pitching,S=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,m&&this.fire(new o.k("zoomend",l)),y&&this.fire(new o.k("rotateend",l)),C&&this.fire(new o.k("pitchend",l)),S&&this.fire(new o.k("rollend",l)),this.fire(new o.k("moveend",l))}flyTo(l,h){if(!l.essential&&w.prefersReducedMotion){const Lt=o.N(l,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Lt,h)}this.stop(),l=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.c9},l);const m=this._getTransformForUpdate(),y=m.bearing,C=m.pitch,S=m.roll,R=m.padding,O="bearing"in l?this._normalizeBearing(l.bearing,y):y,Q="pitch"in l?+l.pitch:C,K="roll"in l?this._normalizeBearing(l.roll,S):S,Z="padding"in l?l.padding:m.padding,ee=o.P.convert(l.offset);let Ae=m.centerPoint.add(ee);const pe=m.screenPointToLocation(Ae),Fe=this.cameraHelper.handleFlyTo(m,{bearing:O,pitch:Q,roll:K,padding:Z,locationAtOffset:pe,offsetAsPoint:ee,center:l.center,minZoom:l.minZoom,zoom:l.zoom});let Me=l.curve;const Re=Math.max(m.width,m.height),Ne=Re/Fe.scaleOfZoom,$e=Fe.pixelPathLength;typeof Fe.scaleOfMinZoom=="number"&&(Me=Math.sqrt(Re/Fe.scaleOfMinZoom/$e*2));const qe=Me*Me;function Xe(Lt){const dr=(Ne*Ne-Re*Re+(Lt?-1:1)*qe*qe*$e*$e)/(2*(Lt?Ne:Re)*qe*$e);return Math.log(Math.sqrt(dr*dr+1)-dr)}function tt(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function it(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const Et=Xe(!1);let Ct=function(Lt){return it(Et)/it(Et+Me*Lt)},Dt=function(Lt){return Re*((it(Et)*(tt(dr=Et+Me*Lt)/it(dr))-tt(Et))/qe)/$e;var dr},Ht=(Xe(!0)-Et)/Me;if(Math.abs($e)<2e-6||!isFinite(Ht)){if(Math.abs(Re-Ne)<1e-6)return this.easeTo(l,h);const Lt=Ne<Re?-1:1;Ht=Math.abs(Math.log(Ne/Re))/Me,Dt=()=>0,Ct=dr=>Math.exp(Lt*Me*dr)}return l.duration="duration"in l?+l.duration:1e3*Ht/("screenSpeed"in l?+l.screenSpeed/Me:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=y!==O,this._pitching=Q!==C,this._rolling=K!==S,this._padding=!m.isPaddingEqual(Z),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(Fe.targetCenter),this._ease(Lt=>{const dr=Lt*Ht,Ar=1/Ct(dr),Kt=Dt(dr);this._rotating&&m.setBearing(o.z.number(y,O,Lt)),this._pitching&&m.setPitch(o.z.number(C,Q,Lt)),this._rolling&&m.setRoll(o.z.number(S,K,Lt)),this._padding&&(m.interpolatePadding(R,Z,Lt),Ae=m.centerPoint.add(ee)),Fe.easeFunc(Lt,Ar,Kt,Ae),this.terrain&&!l.freezeElevation&&this._updateElevation(Lt),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,h){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}return l||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(l,h,m){m.animate===!1||m.duration===0?(l(1),h()):(this._easeStart=w.now(),this._easeOptions=m,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,h){l=o.aJ(l,-180,180);const m=Math.abs(l-h);return Math.abs(l-360-h)<m&&(l-=360),Math.abs(l+360-h)<m&&(l+=360),l}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(o.O.convert(l),this.transform.tileZoom):null}}const Ir={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Zr{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ir;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=v.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=v.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=v.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){v.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(l,h){const m=this._map._getUIString(`AttributionControl.${h}`);l.title=m,l.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const h=this._map.style.sourceCaches;for(const y in h){const C=h[y];if(C.used||C.usedForTerrain){const S=C.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l=l.filter(y=>String(y).trim()),l.sort((y,C)=>y.length-C.length),l=l.filter((y,C)=>{for(let S=C+1;S<l.length;S++)if(l[S].indexOf(y)>=0)return!1;return!0});const m=l.join(" | ");m!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=v.sanitize(m),l.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Fr{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const h=this._container.children;if(h.length){const m=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=v.create("div","maplibregl-ctrl");const h=v.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){v.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class fn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h}remove(l){const h=this._currentlyRunning,m=h?this._queue.concat(h):this._queue;for(const y of m)if(y.id===l)return void(y.cancelled=!0)}run(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const m of h)if(!m.cancelled&&(m.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Gn=o.aB([{name:"a_pos3d",type:"Int16",components:3}]);class mn extends o.E{constructor(l){super(),this._lastTilesetChange=w.now(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=l._source.tileSize*2**this.deltaZoom,l.usedForTerrain=!0,l.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,h){this.sourceCache.update(l,h),this._renderableTilesKeys=[];const m={};for(const y of Be(l,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))m[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.terrainRttPosMatrix32f=new Float64Array(16),o.bM(y.terrainRttPosMatrix32f,0,o.Y,o.Y,0,0,1),this._tiles[y.key]=new Hr(y,this.tileSize),this._lastTilesetChange=w.now());for(const y in this._tiles)m[y]||delete this._tiles[y]}freeRtt(l){for(const h in this._tiles){const m=this._tiles[h];(!l||m.tileID.equals(l)||m.tileID.isChildOf(l)||l.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const h={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID,C=l.clone(),S=o.b0();if(y.canonical.equals(l.canonical))o.bM(S,0,o.Y,o.Y,0,0,1);else if(y.canonical.isChildOf(l.canonical)){const R=y.canonical.z-l.canonical.z,O=y.canonical.x-(y.canonical.x>>R<<R),Q=y.canonical.y-(y.canonical.y>>R<<R),K=o.Y>>R;o.bM(S,0,K,K,0,0,1),o.K(S,S,[-O*K,-Q*K,0])}else{if(!l.canonical.isChildOf(y.canonical))continue;{const R=l.canonical.z-y.canonical.z,O=l.canonical.x-(l.canonical.x>>R<<R),Q=l.canonical.y-(l.canonical.y>>R<<R),K=o.Y>>R;o.bM(S,0,o.Y,o.Y,0,0,1),o.K(S,S,[O*K,Q*K,0]),o.L(S,S,[1/2**R,1/2**R,0])}}C.terrainRttPosMatrix32f=new Float32Array(S),h[m]=C}return h}getSourceTile(l,h){const m=this.sourceCache._source;let y=l.overscaledZ-this.deltaZoom;if(y>m.maxzoom&&(y=m.maxzoom),y<m.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(y).key);let C=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!C||!C.dem)&&h)for(;y>=m.minzoom&&(!C||!C.dem);)C=this.sourceCache.getTileByID(l.scaledTo(y--).key);return C}anyTilesAfterTime(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return this._lastTilesetChange>=l}}class Ln{constructor(l,h,m){this._meshCache={},this.painter=l,this.sourceCache=new mn(h),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.Y;var C;if(!(h>=0&&h<y&&m>=0&&m<y))return 0;const S=this.getTerrainData(l),R=(C=S.tile)===null||C===void 0?void 0:C.dem;if(!R)return 0;const O=o.ca([],[h/y*o.Y,m/y*o.Y],S.u_terrain_matrix),Q=[O[0]*R.dim,O[1]*R.dim],K=Math.floor(Q[0]),Z=Math.floor(Q[1]),ee=Q[0]-K,Ae=Q[1]-Z;return R.get(K,Z)*(1-ee)*(1-Ae)+R.get(K+1,Z)*ee*(1-Ae)+R.get(K,Z+1)*(1-ee)*Ae+R.get(K+1,Z+1)*ee*Ae}getElevationForLngLatZoom(l,h){if(!o.cb(h,l.wrap()))return 0;const{tileID:m,mercatorX:y,mercatorY:C}=this._getOverscaledTileIDFromLngLatZoom(l,h);return this.getElevation(m,y%o.Y,C%o.Y,o.Y)}getElevation(l,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.Y;return this.getDEMElevation(l,h,m,y)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const y=this.painter.context,C=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new J(y,C,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new J(y,new o.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ar([])}const h=this.sourceCache.getSourceTile(l,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const y=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new J(y,h.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),h.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const m=h&&h+h.tileID.key+l.key;if(m&&!this._demMatrixCache[m]){const y=this.sourceCache.sourceCache._source.maxzoom;let C=l.canonical.z-h.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=y?C=l.canonical.z-y:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=l.canonical.x-(l.canonical.x>>C<<C),R=l.canonical.y-(l.canonical.y>>C<<C),O=o.cc(new Float64Array(16),[1/(o.Y<<C),1/(o.Y<<C),0]);o.K(O,O,[S*o.Y,R*o.Y,0]),this._demMatrixCache[l.key]={matrix:O,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(l){const h=this.painter,m=h.width/devicePixelRatio,y=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new J(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new J(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(m,y,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,m,y))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let C=0,S=0;C<this._coordsTextureSize;C++)for(let R=0;R<this._coordsTextureSize;R++,S+=4)h[S+0]=255&R,h[S+1]=255&C,h[S+2]=R>>8<<4|C>>8,h[S+3]=0;const m=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),y=new J(l,m,l.gl.RGBA,{premultiply:!1});return y.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),m=this.painter.context,y=m.gl,C=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(C,R-S-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null);const O=h[0]+(h[2]>>4<<8),Q=h[1]+((15&h[2])<<8),K=this.coordsIndex[255-h[3]],Z=K&&this.sourceCache.getTileByID(K);if(!Z)return null;const ee=this._coordsTextureSize,Ae=(1<<Z.tileID.canonical.z)*ee;return new o.Z((Z.tileID.canonical.x*ee+O)/Ae+Z.tileID.wrap,(Z.tileID.canonical.y*ee+Q)/Ae,this.getElevation(Z.tileID,O,Q,ee))}depthAtPoint(l){const h=new Uint8Array(4),m=this.painter.context,y=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(l){var h;const m=((h=this.painter.style.projection)===null||h===void 0?void 0:h.transitionState)>0,y=m&&l.canonical.y===0,C=m&&l.canonical.y===(1<<l.canonical.z)-1,S=`m_${y?"n":""}_${C?"s":""}`;if(this._meshCache[S])return this._meshCache[S];const R=this.painter.context,O=new o.cd,Q=new o.aF,K=this.meshSize,Z=o.Y/K,ee=K*K;for(let it=0;it<=K;it++)for(let Et=0;Et<=K;Et++)O.emplaceBack(Et*Z,it*Z,0);for(let it=0;it<ee;it+=K+1)for(let Et=0;Et<K;Et++)Q.emplaceBack(Et+it,K+Et+it+1,K+Et+it+2),Q.emplaceBack(Et+it,K+Et+it+2,Et+it+1);const Ae=O.length,pe=Ae+(K+1),Fe=(K+1)*K,Me=y?o.b7:0,Re=y?0:1,Ne=C?o.b8:o.Y,$e=C?0:1;for(let it=0;it<=K;it++)O.emplaceBack(it*Z,Me,Re);for(let it=0;it<=K;it++)O.emplaceBack(it*Z,Ne,$e);for(let it=0;it<K;it++)Q.emplaceBack(Fe+it,pe+it,pe+it+1),Q.emplaceBack(Fe+it,pe+it+1,Fe+it+1),Q.emplaceBack(0+it,Ae+it+1,Ae+it),Q.emplaceBack(0+it,0+it+1,Ae+it+1);const qe=O.length,Xe=qe+2*(K+1);for(const it of[0,1])for(let Et=0;Et<=K;Et++)for(const Ct of[0,1])O.emplaceBack(it*o.Y,Et*Z,Ct);for(let it=0;it<2*K;it+=2)Q.emplaceBack(qe+it,qe+it+1,qe+it+3),Q.emplaceBack(qe+it,qe+it+3,qe+it+2),Q.emplaceBack(Xe+it,Xe+it+3,Xe+it+1),Q.emplaceBack(Xe+it,Xe+it+2,Xe+it+3);const tt=new Yo(R.createVertexBuffer(O,Gn.members),R.createIndexBuffer(Q),o.aE.simpleSegment(0,0,O.length,Q.length));return this._meshCache[S]=tt,tt}getMeshFrameDelta(l){return 2*Math.PI*o.bp/Math.pow(2,Math.max(l,0))/5}getMinTileElevationForLngLatZoom(l,h){var m;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(l,h);return(m=this.getMinMaxElevation(y).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(l){const h=this.getTerrainData(l).tile,m={minElevation:null,maxElevation:null};return h&&h.dem&&(m.minElevation=h.dem.min*this.exaggeration,m.maxElevation=h.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(l,h){const m=o.Z.fromLngLat(l.wrap()),y=(1<<h)*o.Y,C=m.x*y,S=m.y*y,R=Math.floor(C/o.Y),O=Math.floor(S/o.Y);return{tileID:new o.X(h,0,h,R,O),mercatorX:C,mercatorY:S}}}class Vn{constructor(l,h,m){this._context=l,this._size=h,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new J(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(m.texture),{id:l,fbo:h,texture:m,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>l.id!==h),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const Jr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Gr{constructor(l,h){this.painter=l,this.terrain=h,this.pool=new Vn(l.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(m=>!l._layers[m].isHidden(h)),this._coordsAscending={};for(const m in l.sourceCaches){this._coordsAscending[m]={};const y=l.sourceCaches[m].getVisibleCoordinates();for(const C of y){const S=this.terrain.sourceCache.getTerrainCoords(C);for(const R in S)this._coordsAscending[m][R]||(this._coordsAscending[m][R]=[]),this._coordsAscending[m][R].push(S[R])}}this._coordsAscendingStr={};for(const m of l._order){const y=l._layers[m],C=y.source;if(Jr[y.type]&&!this._coordsAscendingStr[C]){this._coordsAscendingStr[C]={};for(const S in this._coordsAscending[C])this._coordsAscendingStr[C][S]=this._coordsAscending[C][S].map(R=>R.key).sort().join()}}for(const m of this._renderableTiles)for(const y in this._coordsAscendingStr){const C=this._coordsAscendingStr[y][m.tileID.key];C&&C!==m.rttCoords[y]&&(m.rtt=[])}}renderLayer(l,h){if(l.isHidden(this.painter.transform.zoom))return!1;const m=Object.assign(Object.assign({},h),{isRenderingToTexture:!0}),y=l.type,C=this.painter,S=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(Jr[y]&&(this._prevType&&Jr[this._prevType]||this._stacks.push([]),this._prevType=y,this._stacks[this._stacks.length-1].push(l.id),!S))return!0;if(Jr[this._prevType]||Jr[y]&&S){this._prevType=y;const R=this._stacks.length-1,O=this._stacks[R]||[];for(const Q of this._renderableTiles){if(this.pool.isFull()&&(vd(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(Q),Q.rtt[R]){const Z=this.pool.getObjectForId(Q.rtt[R].id);if(Z.stamp===Q.rtt[R].stamp){this.pool.useObject(Z);continue}}const K=this.pool.getOrCreateFreeObject();this.pool.useObject(K),this.pool.stampObject(K),Q.rtt[R]={id:K.id,stamp:K.stamp},C.context.bindFramebuffer.set(K.fbo.framebuffer),C.context.clear({color:o.b5.transparent,stencil:0}),C.currentStencilSource=void 0;for(let Z=0;Z<O.length;Z++){const ee=C.style._layers[O[Z]],Ae=ee.source?this._coordsAscending[ee.source][Q.tileID.key]:[Q.tileID];C.context.viewport.set([0,0,K.fbo.width,K.fbo.height]),C._renderTileClippingMasks(ee,Ae,!0),C.renderLayer(C,C.style.sourceCaches[ee.source],ee,Ae,m),ee.source&&(Q.rttCoords[ee.source]=this._coordsAscendingStr[ee.source][Q.tileID.key])}}return vd(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects(),Jr[y]}return!1}}const Zi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ss=u,Ii={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ir,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},uo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class jn{constructor(l,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=C=>{this.startMove(C,v.mousePos(this.element,C)),v.addEventListener(window,"mousemove",this.mousemove),v.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.move(C,v.mousePos(this.element,C))},this.mouseup=C=>{this._rotatePitchHanlder.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=v.touchPos(this.element,C.targetTouches)[0],this.startMove(C,this._startPos),v.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=v.touchPos(this.element,C.targetTouches)[0],this.move(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=h;const y=new sA;this._rotatePitchHanlder=new Mr({clickTolerance:3,move:(C,S)=>{const R=h.getBoundingClientRect(),O=new o.P((R.bottom-R.top)/2,(R.right-R.left)/2);return{bearingDelta:o.c8(new o.P(C.x,S.y),S,O),pitchDelta:m?-.5*(S.y-C.y):void 0}},moveStateManager:y,enable:!0,assignEvents:()=>{}}),this.map=l,v.addEventListener(h,"mousedown",this.mousedown),v.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),v.addEventListener(h,"touchcancel",this.reset)}startMove(l,h){this._rotatePitchHanlder.dragStart(l,h),v.disableDrag()}move(l,h){const m=this.map,{bearingDelta:y,pitchDelta:C}=this._rotatePitchHanlder.dragMove(l,h)||{};y&&m.setBearing(m.getBearing()+y),C&&m.setPitch(m.getPitch()+C)}off(){const l=this.element;v.removeEventListener(l,"mousedown",this.mousedown),v.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),v.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.removeEventListener(window,"touchend",this.touchend),v.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){v.enableDrag(),v.removeEventListener(window,"mousemove",this.mousemove),v.removeEventListener(window,"mouseup",this.mouseup),v.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.removeEventListener(window,"touchend",this.touchend)}}let Ji;function Is(x,l,h){const m=new o.O(x.lng,x.lat);if(x=new o.O(x.lng,x.lat),l){const y=new o.O(x.lng-360,x.lat),C=new o.O(x.lng+360,x.lat),S=h.locationToScreenPoint(x).distSqr(l);h.locationToScreenPoint(y).distSqr(l)<S?x=y:h.locationToScreenPoint(C).distSqr(l)<S&&(x=C)}for(;Math.abs(x.lng-h.center.lng)>180;){const y=h.locationToScreenPoint(x);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;x.lng>h.center.lng?x.lng-=360:x.lng+=360}return x.lng!==m.lng&&h.isPointOnMapSurface(h.locationToScreenPoint(x))?x:m}const Gi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ls(x,l,h){const m=x.classList;for(const y in Gi)m.remove(`maplibregl-${h}-anchor-${y}`);m.add(`maplibregl-${h}-anchor-${l}`)}class fs extends o.E{constructor(l){if(super(),this._onKeyPress=h=>{const m=h.code,y=h.charCode||h.keyCode;m!=="Space"&&m!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=h=>{const m=h.originalEvent.target,y=this._element;this._popup&&(m===y||y.contains(m))&&this.togglePopup()},this._update=h=>{var m;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Is(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let C="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?C=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(C=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),v.setTransform(this._element,`${Gi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${C}`),w.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._subpixelPositioning=l&&l.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=o.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=v.create("div");const h=v.createNS("http://www.w3.org/2000/svg","svg"),m=41,y=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${m}px`),h.setAttributeNS(null,"width",`${y}px`),h.setAttributeNS(null,"viewBox",`0 0 ${y} ${m}`);const C=v.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");const S=v.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const R=v.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Re of O){const Ne=v.createNS("http://www.w3.org/2000/svg","ellipse");Ne.setAttributeNS(null,"opacity","0.04"),Ne.setAttributeNS(null,"cx","10.5"),Ne.setAttributeNS(null,"cy","5.80029008"),Ne.setAttributeNS(null,"rx",Re.rx),Ne.setAttributeNS(null,"ry",Re.ry),R.appendChild(Ne)}const Q=v.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"fill",this._color);const K=v.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Q.appendChild(K);const Z=v.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const ee=v.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(ee);const Ae=v.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");const pe=v.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Fe=v.createNS("http://www.w3.org/2000/svg","circle");Fe.setAttributeNS(null,"fill","#000000"),Fe.setAttributeNS(null,"opacity","0.25"),Fe.setAttributeNS(null,"cx","5.5"),Fe.setAttributeNS(null,"cy","5.5"),Fe.setAttributeNS(null,"r","5.4999962");const Me=v.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#FFFFFF"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962"),pe.appendChild(Fe),pe.appendChild(Me),S.appendChild(R),S.appendChild(Q),S.appendChild(Z),S.appendChild(Ae),S.appendChild(pe),h.appendChild(S),h.setAttributeNS(null,"height",m*this._scale+"px"),h.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(h),this._offset=o.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),ls(this._element,this._anchor,"marker"),l&&l.className)for(const h of l.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(l){return this.remove(),this._map=l,this._element.setAttribute("aria-label",l._getUIString("Marker.Title")),l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),l.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),v.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=o.O.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const y=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(l){return this._subpixelPositioning=l,this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var h,m;if(!(!((h=this._map)===null||h===void 0)&&h.terrain)){const Z=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Z&&(this._element.style.opacity=Z))}if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,C=y.terrain.depthAtPoint(this._pos),S=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,S)-C<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/y.transform.pixelsPerMeter,O=Math.sin(y.getPitch()*Math.PI/180)*R,Q=y.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),K=y.transform.lngLatToCameraDepth(this._lngLat,S+O)-Q>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&K&&this._popup.remove(),this._element.style.opacity=K?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=o.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,h){return(this._opacity===void 0||l===void 0&&h===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Ho={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Co=0,Mi=!1;const Ga={maxWidth:100,unit:"metric"};function ml(x,l,h){const m=h&&h.maxWidth||100,y=x._container.clientHeight/2,C=x._container.clientWidth/2,S=x.unproject([C-m/2,y]),R=x.unproject([C+m/2,y]),O=Math.round(x.project(R).x-x.project(S).x),Q=Math.min(m,O,x._container.clientWidth),K=S.distanceTo(R);if(h&&h.unit==="imperial"){const Z=3.2808*K;Z>5280?ia(l,Q,Z/5280,x._getUIString("ScaleControl.Miles")):ia(l,Q,Z,x._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?ia(l,Q,K/1852,x._getUIString("ScaleControl.NauticalMiles")):K>=1e3?ia(l,Q,K/1e3,x._getUIString("ScaleControl.Kilometers")):ia(l,Q,K,x._getUIString("ScaleControl.Meters"))}function ia(x,l,h,m){const y=function(C){const S=Math.pow(10,`${Math.floor(C)}`.length-1);let R=C/S;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(O){const Q=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*Q)/Q}(R),S*R}(h);x.style.width=l*(y/h)+"px",x.innerHTML=`${y}&nbsp;${m}`}const _l={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Pi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nu(x){if(x){if(typeof x=="number"){const l=Math.round(Math.abs(x)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,x),"top-left":new o.P(l,l),"top-right":new o.P(-l,l),bottom:new o.P(0,-x),"bottom-left":new o.P(l,-l),"bottom-right":new o.P(-l,-l),left:new o.P(x,0),right:new o.P(-x,0)}}if(x instanceof o.P||Array.isArray(x)){const l=o.P.convert(x);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:o.P.convert(x.center||[0,0]),top:o.P.convert(x.top||[0,0]),"top-left":o.P.convert(x["top-left"]||[0,0]),"top-right":o.P.convert(x["top-right"]||[0,0]),bottom:o.P.convert(x.bottom||[0,0]),"bottom-left":o.P.convert(x["bottom-left"]||[0,0]),"bottom-right":o.P.convert(x["bottom-right"]||[0,0]),left:o.P.convert(x.left||[0,0]),right:o.P.convert(x.right||[0,0])}}return Nu(new o.P(0,0))}const ff=u;a.AJAXError=o.ch,a.Event=o.k,a.Evented=o.E,a.LngLat=o.O,a.MercatorCoordinate=o.Z,a.Point=o.P,a.addProtocol=o.ci,a.config=o.a,a.removeProtocol=o.cj,a.AttributionControl=Zr,a.BoxZoomHandler=bh,a.CanvasSource=_r,a.CooperativeGesturesHandler=ut,a.DoubleClickZoomHandler=ot,a.DragPanHandler=gt,a.DragRotateHandler=Yt,a.EdgeInsets=Si,a.FullscreenControl=class extends o.E{constructor(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var l;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=h==null?void 0:h.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){v.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=v.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);v.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=Jt,a.GeolocateControl=class extends o.E{constructor(x){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const h=new o.O(l.coords.longitude,l.coords.latitude),m=l.coords.accuracy,y=this._map.getBearing(),C=o.e({bearing:y},this.options.fitBoundsOptions),S=wr.fromLngLat(h,m);this._map.fitBounds(S,C,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const h=new o.O(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Mi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=v.create("button","maplibregl-ctrl-geolocate",this._container),v.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=l=>{if(this._map){if(l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=v.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new fs({element:this._dotElement}),this._circleElement=v.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")),this.fire(new o.k("userlocationlostfocus")))})}},this.options=o.e({},Ho,x)}onAdd(x){return this._map=x,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(Ji!==void 0&&!l)return Ji;if(window.navigator.permissions===void 0)return Ji=!!window.navigator.geolocation,Ji;try{Ji=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ji=!!window.navigator.geolocation}return Ji}()})}().then(l=>this._finishSetupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),v.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Co=0,Mi=!1}_isOutOfMapMaxBounds(x){const l=this._map.getMaxBounds(),h=x.coords;return l&&(h.longitude<l.getWest()||h.longitude>l.getEast()||h.latitude<l.getSouth()||h.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const x=this._map.getBounds(),l=x.getSouthEast(),h=x.getNorthEast(),m=l.distanceTo(h),y=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Co--,Mi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart")),this.fire(new o.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Co++,Co>1?(x={maximumAge:6e5,timeout:0},Mi=!0):(x=this.options.positionOptions,Mi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.GlobeControl=class{constructor(){this._toggleProjection=()=>{var x;const l=(x=this._map.getProjection())===null||x===void 0?void 0:x.type;this._map.setProjection(l!=="mercator"&&l?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var x;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((x=this._map.getProjection())===null||x===void 0?void 0:x.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(x){return this._map=x,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=v.create("button","maplibregl-ctrl-globe",this._container),v.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){v.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},a.Hash=pl,a.ImageSource=tr,a.KeyboardHandler=be,a.LngLatBounds=wr,a.LogoControl=Fr,a.Map=class extends $t{constructor(x){var l,h;o.ce.mark(o.cf.create);const m=Object.assign(Object.assign(Object.assign({},Ii),x),{canvasContextAttributes:Object.assign(Object.assign({},Ii.canvasContextAttributes),x.canvasContextAttributes)});if(m.minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const y=new tn,C=new fu;if(m.minZoom!==void 0&&y.setMinZoom(m.minZoom),m.maxZoom!==void 0&&y.setMaxZoom(m.maxZoom),m.minPitch!==void 0&&y.setMinPitch(m.minPitch),m.maxPitch!==void 0&&y.setMaxPitch(m.maxPitch),m.renderWorldCopies!==void 0&&y.setRenderWorldCopies(m.renderWorldCopies),super(y,C,{bearingSnap:m.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new fn,this._controls=[],this._mapId=o.a2(),this._contextLost=R=>{R.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:R}))},this._contextRestored=R=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:R}))},this._onMapScroll=R=>{if(R.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},m.canvasContextAttributes),this._trackResize=m.trackResize===!0,this._bearingSnap=m.bearingSnap,this._centerClampedToGround=m.centerClampedToGround,this._refreshExpiredTiles=m.refreshExpiredTiles===!0,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions===!0,this._collectResourceTiming=m.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Zi),m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=m.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=V.addThrottleControl(()=>this.isMoving()),this._requestManager=new $(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let R=!1;const O=xc(Q=>{this._trackResize&&!this._removed&&(this.resize(Q),this.redraw())},50);this._resizeObserver=new ResizeObserver(Q=>{R?O(Q):R=!0}),this._resizeObserver.observe(this._container)}this.handlers=new wt(this,m),this._hash=m.hash&&new pl(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,roll:m.roll}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,o.e({},m.fitBoundsOptions,{duration:0}))));const S=typeof m.style=="string"||((h=(l=m.style)===null||l===void 0?void 0:l.projection)===null||h===void 0?void 0:h.type)!=="globe";this.resize(null,S),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Zr(typeof m.attributionControl=="boolean"?void 0:m.attributionControl)),m.maplibreLogo&&this.addControl(new Fr,m.logoPosition),this.on("style.load",()=>{if(S||this._resizeTransform(),this.transform.unmodified){const R=o.N(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(R)}}),this.on("data",R=>{this._update(R.dataType==="style"),this.fire(new o.k(`${R.dataType}data`,R))}),this.on("dataloading",R=>{this.fire(new o.k(`${R.dataType}dataloading`,R))}),this.on("dataabort",R=>{this.fire(new o.k("sourcedataabort",R))})}_getMapId(){return this._mapId}addControl(x,l){if(l===void 0&&(l=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=x.onAdd(this);this._controls.push(x);const m=this._controlPositions[l];return l.indexOf("bottom")!==-1?m.insertBefore(h,m.firstChild):m.appendChild(h),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(x);return l>-1&&this._controls.splice(l,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}calculateCameraOptionsFromTo(x,l,h,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,l,h,m)}resize(x){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const[h,m]=this._containerDimensions(),y=this._getClampedPixelRatio(h,m);if(this._resizeCanvas(h,m,y),this.painter.resize(h,m,y),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const R=this._getClampedPixelRatio(h,m);this._resizeCanvas(h,m,R),this.painter.resize(h,m,R)}this._resizeTransform(l);const C=!this._moving;return C&&(this.stop(),this.fire(new o.k("movestart",x)).fire(new o.k("move",x))),this.fire(new o.k("resize",x)),C&&this.fire(new o.k("moveend",x)),this}_resizeTransform(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;var l;const[h,m]=this._containerDimensions();this.transform.resize(h,m,x),(l=this._requestedCameraState)===null||l===void 0||l.resize(h,m,x)}_getClampedPixelRatio(x,l){const{0:h,1:m}=this._maxCanvasSize,y=this.getPixelRatio(),C=x*y,S=l*y;return Math.min(C>h?h/C:1,S>m?m/S:1)*y}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(wr.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.setMinZoom(x),this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.setMaxZoom(x),this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.setMinPitch(x),this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(x>=this.transform.minPitch)return this.transform.setMaxPitch(x),this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.setRenderWorldCopies(x),this._update()}project(x){return this.transform.locationToScreenPoint(o.O.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.screenPointToLocation(o.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,l,h){if(x==="mouseenter"||x==="mouseover"){let m=!1;return{layers:l,listener:h,delegates:{mousemove:C=>{const S=l.filter(O=>this.getLayer(O)),R=S.length!==0?this.queryRenderedFeatures(C.point,{layers:S}):[];R.length?m||(m=!0,h.call(this,new Qi(x,this,C.originalEvent,{features:R}))):m=!1},mouseout:()=>{m=!1}}}}if(x==="mouseleave"||x==="mouseout"){let m=!1;return{layers:l,listener:h,delegates:{mousemove:S=>{const R=l.filter(O=>this.getLayer(O));(R.length!==0?this.queryRenderedFeatures(S.point,{layers:R}):[]).length?m=!0:m&&(m=!1,h.call(this,new Qi(x,this,S.originalEvent)))},mouseout:S=>{m&&(m=!1,h.call(this,new Qi(x,this,S.originalEvent)))}}}}{const m=y=>{const C=l.filter(R=>this.getLayer(R)),S=C.length!==0?this.queryRenderedFeatures(y.point,{layers:C}):[];S.length&&(y.features=S,h.call(this,y),delete y.features)};return{layers:l,listener:h,delegates:{[x]:m}}}}_saveDelegatedListener(x,l){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(l)}_removeDelegatedListener(x,l,h){if(!this._delegatedListeners||!this._delegatedListeners[x])return;const m=this._delegatedListeners[x];for(let y=0;y<m.length;y++){const C=m[y];if(C.listener===h&&C.layers.length===l.length&&C.layers.every(S=>l.includes(S))){for(const S in C.delegates)this.off(S,C.delegates[S]);return void m.splice(y,1)}}}on(x,l,h){if(h===void 0)return super.on(x,l);const m=typeof l=="string"?[l]:l,y=this._createDelegatedListener(x,m,h);this._saveDelegatedListener(x,y);for(const C in y.delegates)this.on(C,y.delegates[C]);return{unsubscribe:()=>{this._removeDelegatedListener(x,m,h)}}}once(x,l,h){var m=this;if(h===void 0)return super.once(x,l);const y=typeof l=="string"?[l]:l,C=this._createDelegatedListener(x,y,h);for(const S in C.delegates){const R=C.delegates[S];C.delegates[S]=function(){m._removeDelegatedListener(x,y,h),R(...arguments)}}this._saveDelegatedListener(x,C);for(const S in C.delegates)this.once(S,C.delegates[S]);return this}off(x,l,h){return h===void 0?super.off(x,l):(this._removeDelegatedListener(x,typeof l=="string"?[l]:l,h),this)}queryRenderedFeatures(x,l){if(!this.style)return[];let h;const m=x instanceof o.P||Array.isArray(x),y=m?x:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(m?{}:x)||{},y instanceof o.P||typeof y[0]=="number")h=[o.P.convert(y)];else{const C=o.P.convert(y[0]),S=o.P.convert(y[1]);h=[C,new o.P(S.x,C.y),S,new o.P(C.x,S.y),C]}return this.style.queryRenderedFeatures(h,l,this.transform)}querySourceFeatures(x,l){return this.style.querySourceFeatures(x,l)}setStyle(x,l){return(l=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(x,l))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const l=this._locale[x];if(l==null)throw new Error(`Missing UI string '${x}'`);return l}_updateStyle(x,l){var h,m;if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(x,l));const y=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new Gs(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,l,y):this.style.loadJSON(x,l,y),this):((m=(h=this.style)===null||h===void 0?void 0:h.projection)===null||m===void 0||m.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,l){if(typeof x=="string"){const h=this._requestManager.transformRequest(x,"Style");o.h(h,new AbortController).then(m=>{this._updateDiff(m.data,l)}).catch(m=>{m&&this.fire(new o.j(m))})}else typeof x=="object"&&this._updateDiff(x,l)}_updateDiff(x,l){try{this.style.setState(x,l)&&this._update(!0)}catch(h){o.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(x,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(x,l){return this._lazyInitEmptyStyle(),this.style.addSource(x,l),this._update(!0)}isSourceLoaded(x){const l=this.style&&this.style.sourceCaches[x];if(l!==void 0)return l.loaded();this.fire(new o.j(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const l=this.style.sourceCaches[x.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&l.reload();for(const h in this.style._layers){const m=this.style._layers[h];m.type==="hillshade"&&m.source===x.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ln(this.painter,l,x),this.painter.renderToTexture=new Gr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==x.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.k("terrain",{terrain:x})),this}getTerrain(){var x,l;return(l=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const l in x){const h=x[l]._tiles;for(const m in h){const y=h[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}addImage(x,l){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:m=1,sdf:y=!1,stretchX:C,stretchY:S,content:R,textFitWidth:O,textFitHeight:Q}=h;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||o.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:K,height:Z,data:ee}=l,Ae=l;return this.style.addImage(x,{data:new o.R({width:K,height:Z},new Uint8Array(ee)),pixelRatio:m,stretchX:C,stretchY:S,content:R,textFitWidth:O,textFitHeight:Q,sdf:y,version:0,userImage:Ae}),Ae.onAdd&&Ae.onAdd(this,x),this}}{const{width:K,height:Z,data:ee}=w.getImageData(l);this.style.addImage(x,{data:new o.R({width:K,height:Z},ee),pixelRatio:m,stretchX:C,stretchY:S,content:R,textFitWidth:O,textFitHeight:Q,sdf:y,version:0})}}updateImage(x,l){const h=this.style.getImage(x);if(!h)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=l instanceof HTMLImageElement||o.b(l)?w.getImageData(l):l,{width:y,height:C,data:S}=m;if(y===void 0||C===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==h.data.width||C!==h.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(l instanceof HTMLImageElement||o.b(l));return h.data.replace(S,R),this.style.updateImage(x,h),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return V.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,l){return this._lazyInitEmptyStyle(),this.style.addLayer(x,l),this._update(!0)}moveLayer(x,l){return this.style.moveLayer(x,l),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,l,h){return this.style.setLayerZoomRange(x,l,h),this._update(!0)}setFilter(x,l){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(x,l,h),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,l,h){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(x,l,h,m),this._update(!0)}getPaintProperty(x,l){return this.style.getPaintProperty(x,l)}setLayoutProperty(x,l,h){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(x,l,h,m),this._update(!0)}getLayoutProperty(x,l){return this.style.getLayoutProperty(x,l)}setGlyphs(x){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,l){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(x,l,h,m=>{m||this._update(!0)}),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(x,l,h=>{h||this._update(!0)}),this}setLight(x){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(x,l),this._update(!0)}getLight(){return this.style.getLight()}setSky(x){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSky(x,l),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(x,l){return this.style.setFeatureState(x,l),this._update()}removeFeatureState(x,l){return this.style.removeFeatureState(x,l),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,l=0;return this._container&&(x=this._container.clientWidth||400,l=this._container.clientHeight||300),[x,l]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const l=this._canvasContainer=v.create("div","maplibregl-canvas-container",x);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=v.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),m=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],m);const y=this._controlContainer=v.create("div","maplibregl-control-container",x),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{C[S]=v.create("div",`maplibregl-ctrl-${S} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,l,h){this._canvas.width=Math.floor(h*x),this._canvas.height=Math.floor(h*l),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const x=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let l=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{l={requestedAttributes:x},m&&(l.statusMessage=m.statusMessage,l.type=m.type)},{once:!0});let h=null;if(h=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,x):this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x),!h){const m="Failed to initialize WebGL";throw l?(l.message=m,new Error(JSON.stringify(l))):new Error(m)}this.painter=new Xp(h,this.transform),M.testSupport(h)}migrateProjection(x,l){super.migrateProjection(x,l),this.painter.transform=x,this.fire(new o.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){var l,h,m,y,C;const S=this._idleTriggered?this._fadeDuration:0,R=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let O=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Z=this.transform.zoom,ee=w.now();this.style.zoomHistory.update(Z,ee);const Ae=new o.B(Z,{now:ee,fadeDuration:S,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=Ae.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(O=!0,this._crossFadingFactor=pe),this.style.update(Ae)}const Q=((h=this.style.projection)===null||h===void 0?void 0:h.transitionState)>0!==R;(m=this.style.projection)===null||m===void 0||m.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((y=this.style.projection)===null||y===void 0?void 0:y.transitionState,(C=this.style.projection)===null||C===void 0?void 0:C.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||Q)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,Q),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.ce.mark(o.cf.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||O)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const K=this._sourcesDirty||this._styleDirty||this._placementDirty;return K||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||K||(this._fullyLoaded=!0,o.ce.mark(o.cf.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),V.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l!=null&&l.loseContext&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),v.remove(this._canvasContainer),v.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.ce.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,w.frame(this._frameRequest,x=>{o.ce.frame(x),this._frameRequest=null;try{this._render(x)}catch(l){if(!o.cg(l)&&!function(h){return h.message===bc}(l))throw l}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return Ss}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(x){return this._lazyInitEmptyStyle(),this.style.setProjection(x),this._update(!0)}},a.MapMouseEvent=Qi,a.MapTouchEvent=Uu,a.MapWheelEvent=Sa,a.Marker=fs,a.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const l=this._map.getZoom(),h=l===this._map.getMaxZoom(),m=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(l,h)=>{const m=this._map._getUIString(`NavigationControl.${h}`);l.title=m,l.setAttribute("aria-label",m)},this.options=o.e({},uo,x),this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),v.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),v.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=v.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){v.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,l){const h=v.create("button",x,this._container);return h.type="button",h.addEventListener("click",l),h}},a.Popup=class extends o.E{constructor(x){super(),this.remove=()=>(this._content&&v.remove(this._content),this._container&&(v.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=v.create("div","maplibregl-popup",this._map.getContainer()),this._tip=v.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const R of this.options.className.split(" "))this._container.classList.add(R);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Is(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!l)return;const m=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationToScreenPoint(this._lngLat));let y=this.options.anchor;const C=Nu(this.options.offset);if(!y){const R=this._container.offsetWidth,O=this._container.offsetHeight;let Q;Q=m.y+C.bottom.y<O?["top"]:m.y>this._map.transform.height-O?["bottom"]:[],m.x<R/2?Q.push("left"):m.x>this._map.transform.width-R/2&&Q.push("right"),y=Q.length===0?"bottom":Q.join("-")}let S=m.add(C[y]);this.options.subpixelPositioning||(S=S.round()),v.setTransform(this._container,`${Gi[y]} translate(${S.x}px,${S.y}px)`),ls(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(_l),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=o.O.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const l=document.createDocumentFragment(),h=document.createElement("body");let m;for(h.innerHTML=x;m=h.firstChild,m;)l.appendChild(m);return this.setDOMContent(l)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=v.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){return this._container&&this._container.classList.add(x),this}removeClassName(x){return this._container&&this._container.classList.remove(x),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=v.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(Pi);x&&x.focus()}},a.RasterDEMTileSource=Rr,a.RasterTileSource=$r,a.ScaleControl=class{constructor(x){this._onMove=()=>{ml(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,ml(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ga),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){v.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=Oe,a.Style=Gs,a.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=v.create("button","maplibregl-ctrl-terrain",this._container),v.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){v.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=ue,a.TwoFingersTouchRotateHandler=H,a.TwoFingersTouchZoomHandler=E,a.TwoFingersTouchZoomRotateHandler=Qt,a.VectorTileSource=ze,a.VideoSource=mr,a.addSourceType=(x,l)=>o._(void 0,void 0,void 0,function*(){if(ar(x))throw new Error(`A source type called "${x}" already exists.`);((h,m)=>{Ut[h]=m})(x,l)}),a.clearPrewarmedResources=function(){const x=Le;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(kt),Le=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.createTileMesh=za,a.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return nn().getRTLTextPluginStatus()},a.getVersion=function(){return ff},a.getWorkerCount=function(){return ae.workerCount},a.getWorkerUrl=function(){return o.a.WORKER_URL},a.importScriptInWorkers=function(x){return xt().broadcast("IS",x)},a.prewarm=function(){at().acquire(kt)},a.setMaxParallelImageRequests=function(x){o.a.MAX_PARALLEL_IMAGE_REQUESTS=x},a.setRTLTextPlugin=function(x,l){return nn().setRTLTextPlugin(x,l)},a.setWorkerCount=function(x){ae.workerCount=x},a.setWorkerUrl=function(x){o.a.WORKER_URL=x}});var s=t;return s})}(Ch)),Ch.exports}var FS=eH();const Mo=Ra(FS),yf=new Uint8Array([102,103,98,3,102,103,98,0]),Th=4,pg=4,gg=4,mg=4,uA=new Int32Array(2),RS=new Float32Array(uA.buffer),LS=new Float64Array(uA.buffer),S_=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var ev;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(ev||(ev={}));class Eh{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new Eh(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return uA[0]=this.readInt32(e),RS[0]}readFloat64(e){return uA[S_?0:1]=this.readInt32(e),uA[S_?1:0]=this.readInt32(e+4),LS[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){RS[0]=t,this.writeInt32(e,uA[0])}writeFloat64(e,t){LS[0]=t,this.writeInt32(e,uA[S_?0:1]),this.writeInt32(e+4,uA[S_?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+pg+gg)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<gg;t++)e+=String.fromCharCode(this.readInt8(this.position_+pg+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=pg;const i=this.bytes_.subarray(e,e+n);return t===ev.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+pg}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=gg)throw new Error("FlatBuffers: file identifier must be length "+gg);for(let t=0;t<gg;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+pg+t))return!1;return!0}createScalarList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s)}return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s.unpack())}return n}}var oi,$o=((oi={})[oi.Byte=0]="Byte",oi[oi.UByte=1]="UByte",oi[oi.Bool=2]="Bool",oi[oi.Short=3]="Short",oi[oi.UShort=4]="UShort",oi[oi.Int=5]="Int",oi[oi.UInt=6]="UInt",oi[oi.Long=7]="Long",oi[oi.ULong=8]="ULong",oi[oi.Float=9]="Float",oi[oi.Double=10]="Double",oi[oi.String=11]="String",oi[oi.Json=12]="Json",oi[oi.DateTime=13]="DateTime",oi[oi.Binary=14]="Binary",oi);class Po{constructor(){Y(this,"bb",null);Y(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Po).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+mg),(t||new Po).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):$o.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,$o.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,n,i,s,a,o,u,d,p,_,w){return Po.startColumn(e),Po.addName(e,t),Po.addType(e,n),Po.addTitle(e,i),Po.addDescription(e,s),Po.addWidth(e,a),Po.addPrecision(e,o),Po.addScale(e,u),Po.addNullable(e,d),Po.addUnique(e,p),Po.addPrimaryKey(e,_),Po.addMetadata(e,w),Po.endColumn(e)}}var Nn,aa=((Nn={})[Nn.Unknown=0]="Unknown",Nn[Nn.Point=1]="Point",Nn[Nn.LineString=2]="LineString",Nn[Nn.Polygon=3]="Polygon",Nn[Nn.MultiPoint=4]="MultiPoint",Nn[Nn.MultiLineString=5]="MultiLineString",Nn[Nn.MultiPolygon=6]="MultiPolygon",Nn[Nn.GeometryCollection=7]="GeometryCollection",Nn[Nn.CircularString=8]="CircularString",Nn[Nn.CompoundCurve=9]="CompoundCurve",Nn[Nn.CurvePolygon=10]="CurvePolygon",Nn[Nn.MultiCurve=11]="MultiCurve",Nn[Nn.MultiSurface=12]="MultiSurface",Nn[Nn.Curve=13]="Curve",Nn[Nn.Surface=14]="Surface",Nn[Nn.PolyhedralSurface=15]="PolyhedralSurface",Nn[Nn.TIN=16]="TIN",Nn[Nn.Triangle=17]="Triangle",Nn);let tH=class yl{constructor(){Y(this,"bb",null);Y(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new yl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+mg),(t||new yl).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):aa.Unknown}parts(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new yl).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,aa.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,n,i,s,a,o,u,d){return yl.startGeometry(e),yl.addEnds(e,t),yl.addXy(e,n),yl.addZ(e,i),yl.addM(e,s),yl.addT(e,a),yl.addTm(e,o),yl.addType(e,u),yl.addParts(e,d),yl.endGeometry(e)}};class Ic{constructor(){Y(this,"bb",null);Y(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new Ic).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+mg),(t||new Ic).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new tH).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let n=this.bb.__offset(this.bb_pos,8);return n?(t||new Po).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let n=t.length-1;n>=0;n--)e.addInt8(t[n]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,n,i){return Ic.startFeature(e),Ic.addGeometry(e,t),Ic.addProperties(e,n),Ic.addColumns(e,i),Ic.endFeature(e)}}function tv(r,e){let t=[];for(let n=0;n<r.length;n+=2){let i=[r[n],r[n+1]];e&&i.push(e[n>>1]),t.push(i)}return t}new TextEncoder;let OS=new TextDecoder;function rH(r,e){let t={};if(!e||e.length===0)return t;let n=r.propertiesArray();if(!n)return t;let i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength(),a=0;for(;a<s;){let o=i.getUint16(a,!0);a+=2;let u=e[o],d=u.name;switch(u.type){case $o.Bool:t[d]=!!i.getUint8(a),a+=1;break;case $o.Byte:t[d]=i.getInt8(a),a+=1;break;case $o.UByte:t[d]=i.getUint8(a),a+=1;break;case $o.Short:t[d]=i.getInt16(a,!0),a+=2;break;case $o.UShort:t[d]=i.getUint16(a,!0),a+=2;break;case $o.Int:t[d]=i.getInt32(a,!0),a+=4;break;case $o.UInt:t[d]=i.getUint32(a,!0),a+=4;break;case $o.Long:t[d]=Number(i.getBigInt64(a,!0)),a+=8;break;case $o.ULong:t[d]=Number(i.getBigUint64(a,!0)),a+=8;break;case $o.Float:t[d]=i.getFloat32(a,!0),a+=4;break;case $o.Double:t[d]=i.getFloat64(a,!0),a+=8;break;case $o.DateTime:case $o.String:{let p=i.getUint32(a,!0);a+=4,t[d]=OS.decode(n.subarray(a,a+p)),a+=p;break}case $o.Json:{let p=i.getUint32(a,!0);a+=4;let _=OS.decode(n.subarray(a,a+p));t[d]=JSON.parse(_),a+=p;break}case $o.Binary:{let p=i.getUint32(a,!0);a+=4,t[d]=n.subarray(a,a+p),a+=p;break}default:throw Error(`Unknown type ${u.type}`)}}return t}const rv=new Uint8Array(0);function nH(){return this._source.cancel()}function iH(r,e){if(!r.length)return e;if(!e.length)return r;var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function sH(){var r=this,e=r._array.subarray(r._index);return r._source.read().then(function(t){return r._array=rv,r._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:iH(e,t.value)}})}function oH(r){if((r|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=rv,e._index=0,t>0?n.subarray(0,t):null):t+s.value.length>=r?(e._array=s.value,e._index=r-t,n.set(s.value.subarray(0,r-t),t),n):(n.set(s.value,t),t+=s.value.length,i())})}()}function aH(r){return typeof r.slice=="function"?r:new I_(typeof r.read=="function"?r:r.getReader())}function I_(r){this._source=r,this._array=rv,this._index=0}I_.prototype.read=sH,I_.prototype.slice=oH,I_.prototype.cancel=nH;class Kl{constructor(){Y(this,"bb",null);Y(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new Kl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+mg),(t||new Kl).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,n,i,s,a,o){return Kl.startCrs(e),Kl.addOrg(e,t),Kl.addCode(e,n),Kl.addName(e,i),Kl.addDescription(e,s),Kl.addWkt(e,a),Kl.addCodeString(e,o),Kl.endCrs(e)}}class M_{constructor(){Y(this,"bb",null);Y(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new M_).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+mg),(t||new M_).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):aa.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new Po).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new Kl).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,aa.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function nv(r){let e=M_.getRootAsHeader(r),t=e.featuresCount(),n=e.indexNodeSize(),i=[];for(let o=0;o<e.columnsLength();o++){let u=e.columns(o);if(!u)throw Error("Column unexpectedly missing");if(!u.name())throw Error("Column name unexpectedly missing");i.push({name:u.name(),type:u.type(),title:u.title(),description:u.description(),width:u.width(),precision:u.precision(),scale:u.scale(),nullable:u.nullable(),unique:u.unique(),primary_key:u.primaryKey()})}let s=e.crs(),a=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(t),indexNodeSize:n,crs:a,title:e.title(),description:e.description(),metadata:e.metadata()}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var iv=function(r,e){return iv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},iv(r,e)};function lH(r,e){iv(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Md(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(p){try{d(n.next(p))}catch(_){a(_)}}function u(p){try{d(n.throw(p))}catch(_){a(_)}}function d(p){p.done?s(p.value):i(p.value).then(o,u)}d((n=n.apply(r,[])).next())})}function hA(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(d){return function(p){return u([d,p])}}function u(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=d[0]&2?i.return:d[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,d[1])).done)return s;switch(i=0,s&&(d=[d[0]&2,s.value]),d[0]){case 0:case 1:s=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!s||d[1]>s[0]&&d[1]<s[3])){t.label=d[1];break}if(d[0]===6&&t.label<s[1]){t.label=s[1],s=d;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(d);break}s[2]&&t.ops.pop(),t.trys.pop();continue}d=e.call(r,t)}catch(p){d=[6,p],i=0}finally{n=s=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function Pd(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function _g(r){return this instanceof _g?(this.v=r,this):new _g(r)}function cH(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(w){n[w]&&(i[w]=function(v){return new Promise(function(M,P){s.push([w,v,M,P])>1||o(w,v)})})}function o(w,v){try{u(n[w](v))}catch(M){_(s[0][3],M)}}function u(w){w.value instanceof _g?Promise.resolve(w.value.v).then(d,p):_(s[0][2],w)}function d(w){o("next",w)}function p(w){o("throw",w)}function _(w,v){w(v),s.shift(),s.length&&o(s[0][0],s[0][1])}}var US=function(r){lH(e,r);function e(t){var n=r.call(this,t)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return e}(Error);(function(){function r(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})(),function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}(),function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}();function sv(r){r!=null&&typeof r.then=="function"&&r.then(R_,R_)}var ov=0,DS=1,bf=2,P_=3,av=4,F_=1024,R_=function(){};function Fd(r){var e=r.err,t=Promise.resolve(r.execution).then(function(n){if(e!=null)throw e;return n});return r.err=void 0,r.execution=t.then(function(){},function(){}),r.pending===void 0?t:r.pending.then(function(){return t})}function vf(r,e){var t=r.state>=P_;return Promise.resolve(e).then(function(n){return!t&&r.state>=av?Fd(r).then(function(i){return{value:i,done:!0}}):{value:n,done:t}})}function lv(r,e){var t,n;if(!(r.state>=bf))if(r.state=bf,r.onnext(),r.onstop(),r.err==null&&(r.err=e),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))yg(r);else try{for(var i=Pd(r.pushes),s=i.next();!s.done;s=i.next()){var a=s.value;a.resolve()}}catch(o){t={error:o}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function yg(r){var e,t;if(!(r.state>=P_)){r.state<bf&&lv(r),r.state=P_,r.buffer=void 0;try{for(var n=Pd(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,a=r.pending===void 0?Fd(r):r.pending.then(function(){return Fd(r)});s.resolve(vf(r,a))}}catch(o){e={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.pushes=[],r.nexts=[]}}function NS(r){r.state>=av||(r.state<P_&&yg(r),r.state=av)}function uH(r,e){if(sv(e),r.pushes.length>=F_)throw new US("No more than "+F_+" pending calls to push are allowed on a single repeater.");if(r.state>=bf)return Promise.resolve(void 0);var t=r.pending===void 0?Promise.resolve(e):r.pending.then(function(){return e});t=t.catch(function(u){r.state<bf&&(r.err=u),NS(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(vf(r,t)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):typeof r.buffer<"u"&&!r.buffer.full?n=Promise.resolve(void 0):n=new Promise(function(u){return r.onnext=u})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(t),n=Promise.resolve(void 0)):n=new Promise(function(u){return r.pushes.push({resolve:u,value:t})});var s=!0,a={},o=n.catch(function(u){if(s)throw u});return a.then=function(u,d){return s=!1,Promise.prototype.then.call(n,u,d)},a.catch=function(u){return s=!1,Promise.prototype.catch.call(n,u)},a.finally=n.finally.bind(n),r.pending=t.then(function(){return o}).catch(function(u){r.err=u,NS(r)}),a}function hH(r){var e=lv.bind(null,r),t=new Promise(function(n){return r.onstop=n});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function AH(r){if(!(r.state>=DS)){r.state=DS;var e=uH.bind(null,r),t=hH(r);r.execution=new Promise(function(n){return n(r.executor(e,t))}),r.execution.catch(function(){return lv(r)})}}var L_=new WeakMap,bg=function(){function r(e,t){L_.set(this,{executor:e,buffer:t,err:void 0,state:ov,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:R_,onstop:R_})}return r.prototype.next=function(e){sv(e);var t=L_.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=F_)throw new US("No more than "+F_+" pending calls to next are allowed on a single repeater.");if(t.state<=ov&&AH(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var n=vf(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return n}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,vf(t,s.value)}else if(t.state>=bf)return yg(t),vf(t,Fd(t));return new Promise(function(a){return t.nexts.push({resolve:a,value:e})})},r.prototype.return=function(e){sv(e);var t=L_.get(this);if(t===void 0)throw new Error("WeakMap error");return yg(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),vf(t,Fd(t))},r.prototype.throw=function(e){var t=L_.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=ov||t.state>=bf||typeof t.buffer<"u"&&!t.buffer.empty?(yg(t),t.err==null&&(t.err=e),vf(t,Fd(t))):this.next(Promise.reject(e))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=fH,r.merge=dH,r.zip=pH,r.latest=gH,r}();function O_(r,e){var t,n,i=[],s=function(d){d!=null&&typeof d[Symbol.asyncIterator]=="function"?i.push(d[Symbol.asyncIterator]()):d!=null&&typeof d[Symbol.iterator]=="function"?i.push(d[Symbol.iterator]()):i.push(function(){return cH(this,arguments,function(){return hA(this,function(w){switch(w.label){case 0:return e.yieldValues?[4,_g(d)]:[3,3];case 1:return[4,w.sent()];case 2:w.sent(),w.label=3;case 3:return e.returnValues?[4,_g(d)]:[3,5];case 4:return[2,w.sent()];case 5:return[2]}})})}())};try{for(var a=Pd(r),o=a.next();!o.done;o=a.next()){var u=o.value;s(u)}}catch(d){t={error:d}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i}function fH(r){var e=this,t=O_(r,{returnValues:!0});return new bg(function(n,i){return Md(e,void 0,void 0,function(){var s,a,o,u,d,p;return hA(this,function(_){switch(_.label){case 0:if(!t.length)return i(),[2];a=!1,i.then(function(){s(),a=!0}),_.label=1;case 1:_.trys.push([1,,5,7]),u=void 0,d=0,p=function(){var w,v,M,P,D,N;return hA(this,function(z){switch(z.label){case 0:w=d;try{for(v=(D=void 0,Pd(t)),M=v.next();!M.done;M=v.next())P=M.value,Promise.resolve(P.next()).then(function(W){W.done?(i(),o===void 0&&(o=W)):d===w&&(d++,s(W))},function(W){return i(W)})}catch(W){D={error:W}}finally{try{M&&!M.done&&(N=v.return)&&N.call(v)}finally{if(D)throw D.error}}return[4,new Promise(function(W){return s=W})];case 1:return u=z.sent(),u===void 0?[3,3]:[4,n(u.value)];case 2:z.sent(),z.label=3;case 3:return[2]}})},_.label=2;case 2:return a?[3,4]:[5,p()];case 3:return _.sent(),[3,2];case 4:return[2,o&&o.value];case 5:return i(),[4,Promise.race(t.map(function(w){return w.return&&w.return()}))];case 6:return _.sent(),[7];case 7:return[2]}})})})}function dH(r){var e=this,t=O_(r,{yieldValues:!0});return new bg(function(n,i){return Md(e,void 0,void 0,function(){var s,a,o,u=this;return hA(this,function(d){switch(d.label){case 0:if(!t.length)return i(),[2];s=[],a=!1,i.then(function(){var p,_;a=!0;try{for(var w=Pd(s),v=w.next();!v.done;v=w.next()){var M=v.value;M()}}catch(P){p={error:P}}finally{try{v&&!v.done&&(_=w.return)&&_.call(w)}finally{if(p)throw p.error}}}),d.label=1;case 1:return d.trys.push([1,,3,4]),[4,Promise.all(t.map(function(p,_){return Md(u,void 0,void 0,function(){var w,v;return hA(this,function(M){switch(M.label){case 0:M.trys.push([0,,6,9]),M.label=1;case 1:return a?[3,5]:(Promise.resolve(p.next()).then(function(P){return s[_](P)},function(P){return i(P)}),[4,new Promise(function(P){s[_]=P})]);case 2:return w=M.sent(),w===void 0?[3,4]:w.done?(o=w,[2]):[4,n(w.value)];case 3:M.sent(),M.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return v=p.return,v?[4,p.return()]:[3,8];case 7:v=M.sent(),M.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return d.sent(),[2,o&&o.value];case 3:return i(),[7];case 4:return[2]}})})})}function pH(r){var e=this,t=O_(r,{returnValues:!0});return new bg(function(n,i){return Md(e,void 0,void 0,function(){var s,a,o,u;return hA(this,function(d){switch(d.label){case 0:if(!t.length)return i(),[2,[]];a=!1,i.then(function(){s(),a=!0}),d.label=1;case 1:d.trys.push([1,,6,8]),d.label=2;case 2:return a?[3,5]:(Promise.all(t.map(function(p){return p.next()})).then(function(p){return s(p)},function(p){return i(p)}),[4,new Promise(function(p){return s=p})]);case 3:return o=d.sent(),o===void 0?[2]:(u=o.map(function(p){return p.value}),o.some(function(p){return p.done})?[2,u]:[4,n(u)]);case 4:return d.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(p){return p.return&&p.return()}))];case 7:return d.sent(),[7];case 8:return[2]}})})})}function gH(r){var e=this,t=O_(r,{yieldValues:!0,returnValues:!0});return new bg(function(n,i){return Md(e,void 0,void 0,function(){var s,a,o,u,d,p=this;return hA(this,function(_){switch(_.label){case 0:if(!t.length)return i(),[2,[]];a=[],o=!1,i.then(function(){var w,v;s();try{for(var M=Pd(a),P=M.next();!P.done;P=M.next()){var D=P.value;D()}}catch(N){w={error:N}}finally{try{P&&!P.done&&(v=M.return)&&v.call(M)}finally{if(w)throw w.error}}o=!0}),_.label=1;case 1:return _.trys.push([1,,5,7]),Promise.all(t.map(function(w){return w.next()})).then(function(w){return s(w)},function(w){return i(w)}),[4,new Promise(function(w){return s=w})];case 2:return u=_.sent(),u===void 0?[2]:(d=u.map(function(w){return w.value}),u.every(function(w){return w.done})?[2,d]:[4,n(d.slice())]);case 3:return _.sent(),[4,Promise.all(t.map(function(w,v){return Md(p,void 0,void 0,function(){var M;return hA(this,function(P){switch(P.label){case 0:if(u[v].done)return[2,u[v].value];P.label=1;case 1:return o?[3,4]:(Promise.resolve(w.next()).then(function(D){return a[v](D)},function(D){return i(D)}),[4,new Promise(function(D){return a[v]=D})]);case 2:return M=P.sent(),M===void 0?[2,u[v].value]:M.done?[2,M.value]:(d[v]=M.value,[4,n(d.slice())]);case 3:return P.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,_.sent()];case 5:return i(),[4,Promise.all(t.map(function(w){return w.return&&w.return()}))];case 6:return _.sent(),[7];case 7:return[2]}})})})}let kS=(pd=class{constructor(){Y(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}},Y(pd,"global",new pd),pd);const mH=40,_H=16;function cv(r,e){e=Math.min(Math.max(+e,2),65535);let t=r,n=t;do n+=t=Math.ceil(t/e);while(t!==1);return 40*n}function yH(r,e){if(e<2)throw Error("Node size must be at least 2");if(r===0)throw Error("Number of items must be greater than 0");let t=r,n=t,i=[t];do n+=t=Math.ceil(t/e),i.push(t);while(t!==1);let s=[];for(let o of(t=n,i))s.push(t-o),t-=o;let a=[];for(let o=0;o<i.length;o++)a.push([s[o],s[o]+i[o]]);return a}async function*bH(r,e,t,n){class i{constructor(v,M){Y(this,"_level");Y(this,"nodes");this._level=M,this.nodes=v}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(v){this.nodes[1]=v}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:a,maxX:o,maxY:u}=t,d=yH(r,e),p=d[0][0],_=[new i([0,1],d.length-1)];for(;_.length!==0;){let w=_.shift(),v=w.startNodeIdx(),M=v>=p,P=(()=>{let[,z]=d[w.level()],W=Math.min(w.endNodeIdx()+e,z);return M&&W<z?W+1:W})(),D=P-v,N=new DataView(await n(40*v,40*D));for(let z=v;z<P;z++){let W=z-v,V=40*W;if(o<N.getFloat64(V+0,!0)||u<N.getFloat64(V+8,!0)||s>N.getFloat64(V+16,!0)||a>N.getFloat64(V+24,!0))continue;let $=N.getBigUint64(V+32,!0);if(M){let me=(()=>{if(z<r-1){let se=(W+1)*40;return N.getBigUint64(se+32,!0)-$}return null})(),xe=z-p;yield[Number($),xe,Number(me)];continue}let q=kS.global.extraRequestThreshold()/40,te=_[_.length-1];if(te!==void 0&&te.level()===w.level()-1&&$<te.endNodeIdx()+q){te.extendEndNodeIdx(Number($));continue}let J=(()=>{let me=w.level()-1;return new i([Number($),Number($)+1],me)})();te!==void 0&&(te.level(),J.level()),_.push(J)}}}class uv{constructor(e,t,n,i,s){Y(this,"headerClient");Y(this,"header");Y(this,"headerLength");Y(this,"indexLength");Y(this,"nocache");this.headerClient=e,this.header=t,this.headerLength=n,this.indexLength=i,this.nocache=s}static async open(e,t){let n,i=new QS(e,t),s=2024+(()=>{let d,p=0;for(d=0;d<3;d++)p+=_H**d*mH;return p})();if(!new Uint8Array(await i.getRange(0,8,s,"header")).subarray(0,3).every((d,p)=>yf[p]===d))throw Error("Not a FlatGeobuf file");if((n=new DataView(await i.getRange(8,4,s,"header")).getUint32(0,!0))>10485760||n<8)throw Error("Invalid header size");let a=await i.getRange(12,n,s,"header"),o=nv(new Eh(new Uint8Array(a))),u=cv(o.featuresCount,o.indexNodeSize);return new uv(i,o,n,u,t)}async*selectBbox(e){let t=this.lengthBeforeTree(),n=this.headerClient,i=async(u,d)=>n.getRange(t+u,d,0,"index"),s=[],a=[];for await(let u of bH(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[d,p]=u,[,,_]=u;if(_||(_=4),a.length===0){a.push([d,_,p]);continue}let w=a[a.length-1];d-(w[0]+w[1])>kS.global.extraRequestThreshold()&&(s.push(a),a=[]),a.push([d,_,p])}this.headerClient.logUsage("header+index"),a.length>0&&s.push(a);let o=s.flatMap(u=>this.readFeatureBatch(u,this.nocache));yield*bg.merge(o)}lengthBeforeTree(){return yf.length+Th+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new QS(this.headerClient.httpClient,e)}async*readFeatureBatch(e,t){let[n]=e[0],[i,s]=e[e.length-1],a=this.buildFeatureClient(t),o=i+s-n;for(let[u,,d]of e){let p=await this.readFeature(a,u,o);yield{id:d,feature:p},o=0}a.logUsage("feature")}async readFeature(e,t,n){let i,s=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(s,4,n,"feature length")).getUint32(0,!0);let a=new Uint8Array(await e.getRange(s+4,i,n,"feature data")),o=new Uint8Array(i+Th);o.set(a,Th);let u=new Eh(o);return u.setPosition(Th),Ic.getRootAsFeature(u)}}let QS=class{constructor(e,t){Y(this,"httpClient");Y(this,"bytesEverUsed",0);Y(this,"bytesEverFetched",0);Y(this,"buffer",new ArrayBuffer(0));Y(this,"head",0);if(typeof e=="string")this.httpClient=new zS(e,t);else if(e instanceof zS)this.httpClient=e;else throw Error("Unknown source ")}async getRange(e,t,n,i){this.bytesEverUsed+=t;let s=e-this.head,a=s+t;if(s>=0&&a<=this.buffer.byteLength)return this.buffer.slice(s,a);let o=Math.max(t,n);return this.bytesEverFetched+=o,this.buffer=await this.httpClient.getRange(e,o,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}},zS=class{constructor(e,t){Y(this,"url");Y(this,"nocache");Y(this,"requestsEverMade",0);Y(this,"bytesEverRequested",0);this.url=e,this.nocache=t}async getRange(e,t,n){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i={Range:`bytes=${e}-${e+t-1}`};return this.nocache&&(i["Cache-Control"]="no-cache, no-store"),await(await fetch(this.url,{headers:i})).arrayBuffer()}};function vH(r,e,t){if(!r.subarray(0,3).every((p,_)=>yf[_]===p))throw Error("Not a FlatGeobuf file");let n=new Eh(r),i=n.readUint32(yf.length);n.setPosition(yf.length+Th);let s=nv(n),a=yf.length+Th+i,{indexNodeSize:o,featuresCount:u}=s;o>0&&(a+=cv(u,o));let d=[];for(;a<n.capacity();){let p=n.readUint32(a);n.setPosition(a+Th);let _=Ic.getRootAsFeature(n);d.push(e(d.length,_,s)),a+=Th+p}return d}async function*wH(r,e,t){let n,i=aH(r),s=async v=>await i.slice(v),a=new Uint8Array(await s(8));if(!a.subarray(0,3).every((v,M)=>yf[M]===v))throw Error("Not a FlatGeobuf file");a=new Uint8Array(await s(4));let o=new Eh(a),u=o.readUint32(0);a=new Uint8Array(await s(u));let d=nv(o=new Eh(a)),{indexNodeSize:p,featuresCount:_}=d;if(p>0){let v=cv(_,p);await s(v)}let w=0;for(;n=await BH(s,d,e,w++);)yield n}function xH(r,e,t,n){try{let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){let s=await uv.open(r,i);for await(let a of(n&&n(s.header),s.selectBbox(e)))yield t(a.id,a.feature,s.header)}()}catch(i){return Promise.reject(i)}}async function BH(r,e,t,n){let i=new Uint8Array(await r(4,"feature length"));if(i.byteLength===0)return;let s=new Eh(i),a=s.readUint32(0);i=new Uint8Array(await r(a,"feature data"));let o=new Uint8Array(a+4);return o.set(i,4),(s=new Eh(o)).setPosition(Th),t(n,Ic.getRootAsFeature(s),e)}function hv(r,e){let t=e;if(t===aa.Unknown&&(t=r.type()),t===aa.GeometryCollection){let i=[];for(let s=0;s<r.partsLength();s++){let a=r.parts(s),o=a.type();i.push(hv(a,o))}return{type:aa[t],geometries:i}}if(t===aa.MultiPolygon){let i=[];for(let s=0;s<r.partsLength();s++)i.push(hv(r.parts(s),aa.Polygon));return{type:aa[t],coordinates:i.map(s=>s.coordinates)}}let n=function(i,s){let a=i.xyArray(),o=i.zArray();switch(s){case aa.Point:{let u=Array.from(a);return o&&u.push(o[0]),u}case aa.MultiPoint:case aa.LineString:return tv(a,o);case aa.MultiLineString:case aa.Polygon:return function(u,d,p){let _;if(!p||p.length===0)return[tv(u,d)];let w=0,v=Array.from(p).map(M=>u.slice(w,w=M<<1));return d&&(w=0,_=Array.from(p).map(M=>d.slice(w,w=M))),v.map((M,P)=>tv(M,_?_[P]:void 0))}(a,o,i.endsArray())}}(r,t);return{type:aa[t],coordinates:n}}function Av(r,e,t){let n=t.columns;return{type:"Feature",id:r,geometry:hv(e.geometry(),t.geometryType),properties:rH(e,n)}}function CH(r,e){return{type:"FeatureCollection",features:vH(r,Av)}}function TH(r,e){return wH(r,Av)}function EH(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return xH(r,e,Av,t,n)}function HS(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return r instanceof Uint8Array?CH(r):r instanceof ReadableStream?TH(r):EH(r,e,t,n)}class SH{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(e){this._map=e;let t=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(t._btn.className.indexOf("3d")!=-1){let d={pitch:t._pitch,bearing:t._bearing};t._minpitchzoom&&e.getZoom()>t._minpitchzoom&&(d.zoom=t._minpitchzoom);var n=0,i=38.5,s=6,a=62.33,{longitude:o,latitude:u}=e.getCenter();e.getZoom()<10?e.setTerrain({source:"terrainICGC",exaggeration:1.5}):o>=n&&o<=s&&u>=i&&u<=a?e.setTerrain({source:"terrainICGC",exaggeration:1.2}):e.setTerrain({source:"terrainICGC",exaggeration:1.5}),e.easeTo(d),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else e.setTerrain(null),e.easeTo({pitch:0,bearing:0}),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}async function vg(r,e,t,n){return n._parse(r,e,t,n)}function Ri(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const U_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),VS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);VS&&parseFloat(VS[1]);const D_=globalThis,Rd=globalThis.process||{},IH=globalThis.navigator||{};function jS(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function wf(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||jS()}function MH(r){return wf()?jS()?"Electron":(IH.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const $S="4.1.0";function PH(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class FH{constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=PH(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function RH(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function LH(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var N_;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(N_||(N_={}));const OH=10;function GS(r){return typeof r!="string"?r:(r=r.toUpperCase(),N_[r]||N_.WHITE)}function UH(r,e,t){return!wf&&typeof r=="string"&&(e&&(r=`\x1B[${GS(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${GS(t)+OH}m${r}\x1B[49m`)),r}function DH(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const s of n){const a=i[s];typeof a=="function"&&(e.find(o=>s===o)||(i[s]=a.bind(r)))}}function fv(r,e){if(!r)throw new Error("Assertion failed")}function Ld(){var e,t,n;let r;if(wf()&&D_.performance)r=(t=(e=D_==null?void 0:D_.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Rd){const i=(n=Rd==null?void 0:Rd.hrtime)==null?void 0:n.call(Rd);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const Od={debug:wf()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},NH={enabled:!0,level:0};function Ud(){}const qS={},KS={once:!0};class Dd{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.VERSION=$S,this._startTs=Ld(),this._deltaTs=Ld(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new FH(`__probe-${this.id}__`,NH),this.timeStamp(`${this.id} started`),DH(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ld()-this._startTs).toPrecision(10))}getDelta(){return Number((Ld()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Od.warn,arguments,KS)}error(e){return this._getLogFunction(0,e,Od.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Od.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Od.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Od.debug||Od.info,arguments,KS)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||Ud,n&&[n],{tag:QH(t)}):Ud}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Ud)}group(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=XS({logLevel:e,message:t,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ud)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=WS(e)}_getLogFunction(e,t,n,i,s){if(this._shouldLog(e)){s=XS({logLevel:e,message:t,args:i,opts:s}),n=n||s.method,fv(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Ld();const a=s.tag||s.message;if(s.once&&a)if(!qS[a])qS[a]=Ld();else return Ud;return t=kH(this.id,s.message,s),n.bind(console,t,...s.args)}return Ud}}Dd.VERSION=$S;function WS(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return fv(Number.isFinite(e)&&e>=0),e}function XS(r){const{logLevel:e,message:t}=r;r.logLevel=WS(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return fv(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function kH(r,e,t){if(typeof e=="string"){const n=t.time?LH(RH(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=UH(e,t.color,t.background)}return e}function QH(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}globalThis.probe={};const YS=new Dd({id:"@probe.gl/log"}),dv="4.3.2",zH=dv[0]>="0"&&dv[0]<="9"?`v${dv}`:"";function HH(){const r=new Dd({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=r,globalThis.loaders.version=zH,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=r,r}const VH=HH();function jH(r,e){return ZS(r||{},e)}function ZS(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(t>3)return e;const n={...r};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?n[i]=ZS(n[i]||{},e[i],t+1):n[i]=e[i];return n}function $H(r){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,r)}function GH(r){var t,n;return((n=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:n[r])||null}const qH="latest";function KH(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const JS=KH();function Sh(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const Wl=typeof process!="object"||String(process)!=="[object process]"||process.browser,pv=typeof importScripts=="function",WH=typeof window<"u"&&typeof window.orientation<"u",eI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);eI&&parseFloat(eI[1]);class XH{constructor(e,t){Y(this,"name");Y(this,"workerThread");Y(this,"isRunning",!0);Y(this,"result");Y(this,"_resolve",()=>{});Y(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Sh(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Sh(this.isRunning),this.isRunning=!1,this._reject(e)}}class gv{terminate(){}}const mv=new Map;function YH(r){Sh(r.source&&!r.url||!r.source&&r.url);let e=mv.get(r.source||r.url);return e||(r.url&&(e=ZH(r.url),mv.set(r.url,e)),r.source&&(e=tI(r.source),mv.set(r.source,e))),Sh(e),e}function ZH(r){if(!r.startsWith("http"))return r;const e=JH(r);return tI(e)}function tI(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function JH(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function rI(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const n=t||new Set;if(r){if(nI(r))n.add(r);else if(nI(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const i in r)rI(r[i],e,n)}}return t===void 0?Array.from(n):[]}function nI(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const _v=()=>{};class yv{constructor(e){Y(this,"name");Y(this,"source");Y(this,"url");Y(this,"terminated",!1);Y(this,"worker");Y(this,"onMessage");Y(this,"onError");Y(this,"_loadableURL","");const{name:t,source:n,url:i}=e;Sh(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=_v,this.onError=s=>console.log(s),this.worker=Wl?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Wl||typeof gv<"u"&&!Wl}destroy(){this.onMessage=_v,this.onError=_v,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||rI(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=YH({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new gv(n,{eval:!1})}else if(this.source)e=new gv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class eV{constructor(e){Y(this,"name","unnamed");Y(this,"source");Y(this,"url");Y(this,"maxConcurrency",1);Y(this,"maxMobileConcurrency",1);Y(this,"onDebug",()=>{});Y(this,"reuseWorkers",!0);Y(this,"props",{});Y(this,"jobQueue",[]);Y(this,"idleQueue",[]);Y(this,"count",0);Y(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return yv.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,a,o)=>s.done(o),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,a)=>s.error(a);const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new XH(t.name,e);e.onMessage=i=>t.onMessage(n,i.type,i.payload),e.onError=i=>t.onError(n,i),t.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Wl||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new yv({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return WH?this.maxMobileConcurrency:this.maxConcurrency}}const tV={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},ZA=class ZA{constructor(e){Y(this,"props");Y(this,"workerPools",new Map);this.props={...tV},this.setProps(e),this.workerPools=new Map}static isSupported(){return yv.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ZA._workerFarm=ZA._workerFarm||new ZA({}),ZA._workerFarm.setProps(e),ZA._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let s=this.workerPools.get(t);return s||(s=new eV({name:t,source:n,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};Y(ZA,"_workerFarm");let k_=ZA;function rV(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[r.id]||{},n=Wl?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let i=t.workerUrl;if(!i&&r.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Wl?i=`modules/${r.module}/dist/${n}`:i=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!i){let s=r.version;s==="latest"&&(s=qH);const a=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${r.module}${a}/dist/${n}`}return Sh(i),i}function nV(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:JS;Sh(r,"no worker provided");const t=r.version;return!(!e||!t)}const bv={};async function xf(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return e&&(r=iV(r,e,t,n)),bv[r]=bv[r]||sV(r),await bv[r]}function iV(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:Wl?t.CDN?(Sh(t.CDN.startsWith("http")),`${t.CDN}/${e}@${JS}/dist/libs/${n}`):pv?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function sV(r){if(r.endsWith("wasm"))return await aV(r);if(!Wl)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(r))}catch(t){return console.error(t),null}if(pv)return importScripts(r);const e=await lV(r);return oV(e,r)}function oV(r,e){if(!Wl){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(r,e)}if(pv)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function aV(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Wl||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function lV(r){const{readFileAsText:e}=globalThis.loaders||{};return Wl||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}function cV(r,e){return!k_.isSupported()||!Wl&&!(e!=null&&e._nodeWorkers)?!1:r.worker&&(e==null?void 0:e.worker)}async function uV(r,e,t,n,i){const s=r.id,a=rV(r,t),u=k_.getWorkerFarm(t).getWorkerPool({name:s,url:a});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const d=await u.startJob("process-on-worker",hV.bind(null,i));return d.postMessage("process",{input:e,options:t,context:n}),await(await d.result).result}async function hV(r,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:s,options:a}=n;try{const o=await r(s,a);e.postMessage("done",{id:i,result:o})}catch(o){const u=o instanceof Error?o.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function AV(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?iI(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?iI(r,0,e):""}function iI(r,e,t){if(r.byteLength<=e+t)return"";const n=new DataView(r);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(n.getUint8(e+s));return i}function fV(r){try{return JSON.parse(r)}catch{throw new Error(`Failed to parse JSON from data starting with "${AV(r)}"`)}}function dV(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(r),i=new Uint8Array(e);for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}function pV(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return gV(e)}function gV(r){const e=r.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,a)=>s+a.byteLength,0),n=new Uint8Array(t);let i=0;for(const s of e)n.set(s,i),i+=s.byteLength;return n.buffer}function vv(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function wg(r,e){return Ri(r>=0),Ri(e>0),r+(e-1)&-4}function mV(r,e,t){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,s=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,s)}return e.set(n,t),t+wg(n.byteLength,4)}async function _V(r){const e=[];for await(const t of r)e.push(t);return pV(...e)}function sI(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class oI{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=sI(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(sI()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Nd{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof oI?i=e:i=new oI(t,n),this.stats[t]=i),i}}const yV="Queued Requests",bV="Active Requests",vV="Cancelled Requests",wV="Queued Requests Ever",xV="Active Requests Ever",BV={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class CV{constructor(){Y(this,"props");Y(this,"stats");Y(this,"activeRequestCount",0);Y(this,"requestQueue",[]);Y(this,"requestMap",new Map);Y(this,"updateTimer",null);let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.props={...BV,...e},this.stats=new Nd({id:this.props.id}),this.stats.get(yV),this.stats.get(bV),this.stats.get(vV),this.stats.get(wV),this.stats.get(xV)}scheduleRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},i=new Promise(s=>(n.resolve=s,n));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:n}=e;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort((t,n)=>t.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let TV="";const aI={};function EV(r){for(const e in aI)if(r.startsWith(e)){const t=aI[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${TV}${r}`),r}function K0e(r){return r}function SV(r){return r&&typeof r=="object"&&r.isBuffer}function lI(r){if(SV(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function IV(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const r=(e=window.location)==null?void 0:e.pathname;return(r==null?void 0:r.slice(0,r.lastIndexOf("/")+1))||""}function cI(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function wv(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}function MV(){const r=[];for(let i=0;i<arguments.length;i++)r[i]=i<0||arguments.length<=i?void 0:arguments[i];let e="",t=!1,n;for(let i=r.length-1;i>=-1&&!t;i--){let s;i>=0?s=r[i]:(n===void 0&&(n=IV()),s=n),s.length!==0&&(e=`${s}/${e}`,t=s.charCodeAt(0)===xg)}return e=PV(e,!t),t?`/${e}`:e.length>0?e:"."}const xg=47,xv=46;function PV(r,e){let t="",n=-1,i=0,s,a=!1;for(let o=0;o<=r.length;++o){if(o<r.length)s=r.charCodeAt(o);else{if(s===xg)break;s=xg}if(s===xg){if(!(n===o-1||i===1))if(n!==o-1&&i===2){if(t.length<2||!a||t.charCodeAt(t.length-1)!==xv||t.charCodeAt(t.length-2)!==xv){if(t.length>2){const u=t.length-1;let d=u;for(;d>=0&&t.charCodeAt(d)!==xg;--d);if(d!==u){t=d===-1?"":t.slice(0,d),n=o,i=0,a=!1;continue}}else if(t.length===2||t.length===1){t="",n=o,i=0,a=!1;continue}}e&&(t.length>0?t+="/..":t="..",a=!0)}else{const u=r.slice(n+1,o);t.length>0?t+=`/${u}`:t=u,a=!1}n=o,i=0}else s===xv&&i!==-1?++i:i=-1}return t}const FV=r=>typeof r=="boolean",Bg=r=>typeof r=="function",Cg=r=>r!==null&&typeof r=="object",uI=r=>Cg(r)&&r.constructor==={}.constructor,RV=r=>!!r&&typeof r[Symbol.iterator]=="function",LV=r=>r&&typeof r[Symbol.asyncIterator]=="function",Bf=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,Cf=r=>typeof Blob<"u"&&r instanceof Blob,OV=r=>r&&typeof r=="object"&&r.isBuffer,UV=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||Cg(r)&&Bg(r.tee)&&Bg(r.cancel)&&Bg(r.getReader),DV=r=>Cg(r)&&Bg(r.read)&&Bg(r.pipe)&&FV(r.readable),hI=r=>UV(r)||DV(r);class NV extends Error{constructor(t,n){super(t);Y(this,"reason");Y(this,"url");Y(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const kV=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,QV=/^([-\w.]+\/[-\w.+]+)/;function AI(r,e){return r.toLowerCase()===e.toLowerCase()}function zV(r){const e=QV.exec(r);return e?e[1]:r}function fI(r){const e=kV.exec(r);return e?e[1]:""}const dI=/\?.*/;function HV(r){const e=r.match(dI);return e&&e[0]}function Bv(r){return r.replace(dI,"")}function VV(r){if(r.length<50)return r;const e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function Q_(r){return Bf(r)?r.url:Cf(r)?r.name||"":typeof r=="string"?r:""}function Cv(r){if(Bf(r)){const e=r,t=e.headers.get("content-type")||"",n=Bv(e.url);return zV(t)||fI(n)}return Cf(r)?r.type||"":typeof r=="string"?fI(r):""}function jV(r){return Bf(r)?r.headers["content-length"]||-1:Cf(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function pI(r){if(Bf(r))return r;const e={},t=jV(r);t>=0&&(e["content-length"]=String(t));const n=Q_(r),i=Cv(r);i&&(e["content-type"]=i);const s=await qV(r);s&&(e["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r));const a=new Response(r,{headers:e});return Object.defineProperty(a,"url",{value:n}),a}async function $V(r){if(!r.ok)throw await GV(r)}async function GV(r){const e=VV(r.url);let t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const n={reason:r.statusText,url:r.url,response:r};try{const i=r.headers.get("Content-Type");n.reason=!r.bodyUsed&&(i!=null&&i.includes("application/json"))?await r.json():await r.text()}catch{}return new NV(t,n)}async function qV(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=s=>{var a;return n((a=s==null?void 0:s.target)==null?void 0:a.result)},i.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5);return`data:base64,${KV(t)}`}return null}function KV(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function WV(r){return!XV(r)&&!YV(r)}function XV(r){return r.startsWith("http:")||r.startsWith("https:")}function YV(r){return r.startsWith("data:")}async function gI(r,e){var t,n;if(typeof r=="string"){const i=EV(r);return WV(i)&&(t=globalThis.loaders)!=null&&t.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(i,e):await fetch(i,e)}return await pI(r)}const mI=new Dd({id:"loaders.gl"});class ZV{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class JV{constructor(){Y(this,"console");this.console=console}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.error.bind(this.console,...t)}}const _I={fetch:null,mimeType:void 0,nothrow:!1,log:new JV,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:U_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},e9={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function yI(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function bI(){const r=yI();return r.globalOptions=r.globalOptions||{..._I},r.globalOptions}function t9(r,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],r9(r,t),i9(e,r,n)}function r9(r,e){vI(r,null,_I,e9,e);for(const t of e){const n=r&&r[t.id]||{},i=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};vI(n,t.id,i,s,e)}}function vI(r,e,t,n,i){const s=e||"Top level",a=e?`${e}.`:"";for(const o in r){const u=!e&&Cg(r[o]),d=o==="baseUri"&&!e,p=o==="workerUrl"&&e;if(!(o in t)&&!d&&!p){if(o in n)mI.warn(`${s} loader option '${a}${o}' no longer supported, use '${n[o]}'`)();else if(!u){const _=n9(o,i);mI.warn(`${s} loader option '${a}${o}' not recognized. ${_}`)()}}}}function n9(r,e){const t=r.toLowerCase();let n="";for(const i of e)for(const s in i.options){if(r===s)return`Did you mean '${i.id}.${s}'?`;const a=s.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(n=n||`Did you mean '${i.id}.${s}'?`)}return n}function i9(r,e,t){const i={...r.options||{}};return s9(i,t),i.log===null&&(i.log=new ZV),wI(i,bI()),wI(i,e),i}function wI(r,e){for(const t in e)if(t in e){const n=e[t];uI(n)&&uI(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function s9(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function Tv(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r==null?void 0:r.extensions)):!1}function Ev(r){Ri(r,"null loader"),Ri(Tv(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r!=null&&r.parseTextSync||r!=null&&r.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const xI=()=>{const r=yI();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function o9(r){const e=xI();r=Array.isArray(r)?r:[r];for(const t of r){const n=Ev(t);e.find(i=>n===i)||e.unshift(n)}}function a9(){return xI()}const l9=/\.([^.]+)$/;async function c9(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!CI(r))return null;let i=BI(r,e,{...t,nothrow:!0},n);if(i)return i;if(Cf(r)&&(r=await r.slice(0,10).arrayBuffer(),i=BI(r,e,t,n)),!i&&!(t!=null&&t.nothrow))throw new Error(TI(r));return i}function BI(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!CI(r))return null;if(e&&!Array.isArray(e))return Ev(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...a9()),h9(i);const s=u9(r,i,t,n);if(!s&&!(t!=null&&t.nothrow))throw new Error(TI(r));return s}function u9(r,e,t,n){const i=Q_(r),s=Cv(r),a=Bv(i)||(n==null?void 0:n.url);let o=null,u="";return t!=null&&t.mimeType&&(o=Sv(e,t==null?void 0:t.mimeType),u=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),o=o||A9(e,a),u=u||(o?`matched url ${a}`:""),o=o||Sv(e,s),u=u||(o?`matched MIME type ${s}`:""),o=o||d9(e,r),u=u||(o?`matched initial data ${SI(r)}`:""),t!=null&&t.fallbackMimeType&&(o=o||Sv(e,t==null?void 0:t.fallbackMimeType),u=u||(o?`matched fallback MIME type ${s}`:"")),u&&VH.log(1,`selectLoader selected ${o==null?void 0:o.name}: ${u}.`),o}function CI(r){return!(r instanceof Response&&r.status===204)}function TI(r){const e=Q_(r),t=Cv(r);let n="No valid loader found (";n+=e?`${cI(e)}, `:"no url provided, ",n+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=r?SI(r):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function h9(r){for(const e of r)Ev(e)}function A9(r,e){const t=e&&l9.exec(e),n=t&&t[1];return n?f9(r,n):null}function f9(r,e){e=e.toLowerCase();for(const t of r)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function Sv(r,e){var t;for(const n of r)if((t=n.mimeTypes)!=null&&t.some(i=>AI(e,i))||AI(e,`application/x.${n.id}`))return n;return null}function d9(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(p9(e,t))return t}else if(ArrayBuffer.isView(e)){if(EI(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&EI(e,0,t))return t;return null}function p9(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>r.startsWith(n))}function EI(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>g9(r,e,t,i))}function g9(r,e,t,n){if(n instanceof ArrayBuffer)return dV(n,r,n.byteLength);switch(typeof n){case"function":return n(r);case"string":const i=Iv(r,e,n.length);return n===i;default:return!1}}function SI(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?Iv(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?Iv(r,0,e):""}function Iv(r,e,t){if(r.byteLength<e+t)return"";const n=new DataView(r);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(n.getUint8(e+s));return i}const m9=256*1024;function*_9(r,e){const t=(e==null?void 0:e.chunkSize)||m9;let n=0;const i=new TextEncoder;for(;n<r.length;){const s=Math.min(r.length-n,t),a=r.slice(n,n+s);n+=s,yield i.encode(a)}}const y9=256*1024;function b9(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=y9}=e;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,t),s=new ArrayBuffer(i),a=new Uint8Array(r,n,i);new Uint8Array(s).set(a),n+=i,yield s}}()}const v9=1024*1024;async function*w9(r,e){const t=(e==null?void 0:e.chunkSize)||v9;let n=0;for(;n<r.size;){const i=n+t,s=await r.slice(n,i).arrayBuffer();n=i,yield s}}function II(r,e){return U_?x9(r,e):B9(r)}async function*x9(r,e){const t=r.getReader();let n;try{for(;;){const i=n||t.read();e!=null&&e._streamReadAhead&&(n=t.read());const{done:s,value:a}=await i;if(s)return;yield lI(a)}}catch{t.releaseLock()}}async function*B9(r,e){for await(const t of r)yield lI(t)}function C9(r,e){if(typeof r=="string")return _9(r,e);if(r instanceof ArrayBuffer)return b9(r,e);if(Cf(r))return w9(r,e);if(hI(r))return II(r,e);if(Bf(r))return II(r.body,e);throw new Error("makeIterator")}const MI="Cannot convert supplied data type";function T9(r,e,t){if(e.text&&typeof r=="string")return r;if(OV(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(MI)}async function E9(r,e,t){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return T9(r,e);if(Cf(r)&&(r=await pI(r)),Bf(r)){const i=r;return await $V(i),e.binary?await i.arrayBuffer():await i.text()}if(hI(r)&&(r=C9(r,t)),RV(r)||LV(r))return _V(r);throw new Error(MI)}function PI(r,e){const t=bI(),n=r||t;return typeof n.fetch=="function"?n.fetch:Cg(n.fetch)?i=>gI(i,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:gI}function S9(r,e,t){if(t)return t;const n={fetch:PI(e,r),...r};if(n.url){const i=Bv(n.url);n.baseUrl=i,n.queryString=HV(n.url),n.filename=cI(i),n.baseUrl=wv(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function I9(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:void 0}async function z_(r,e,t,n){e&&!Array.isArray(e)&&!Tv(e)&&(n=void 0,t=e,e=void 0),r=await r,t=t||{};const i=Q_(r),a=I9(e,n),o=await c9(r,a,t);return o?(t=t9(t,o,a,i),n=S9({url:i,_parse:z_,loaders:a},t,n||null),await M9(o,r,t,n)):null}async function M9(r,e,t,n){if(nV(r),t=jH(r.options,t),Bf(e)){const s=e,{ok:a,redirected:o,status:u,statusText:d,type:p,url:_}=s,w=Object.fromEntries(s.headers.entries());n.response={headers:w,ok:a,redirected:o,status:u,statusText:d,type:p,url:_}}e=await E9(e,r,t);const i=r;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,n);if(cV(r,t))return await uV(r,e,t,n,z_);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,n);if(i.parse)return await i.parse(e,t,n);throw Sh(!i.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}function P9(r){switch(r.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function FI(r){let e=1/0,t=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],u=o&&o.length;for(let d=0;d<u;d+=3){const p=o[d],_=o[d+1],w=o[d+2];e=p<e?p:e,t=_<t?_:t,n=w<n?w:n,i=p>i?p:i,s=_>s?_:s,a=w>a?w:a}return[[e,t,n],[i,s,a]]}function F9(r,e,t){const n=P9(e.value),i=t||R9(e);return{name:r,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function R9(r){const e={};return"byteOffset"in r&&(e.byteOffset=r.byteOffset.toString(10)),"byteStride"in r&&(e.byteStride=r.byteStride.toString(10)),"normalized"in r&&(e.normalized=r.normalized.toString()),e}async function AA(r,e,t,n){let i,s;!Array.isArray(e)&&!Tv(e)?(i=[],s=e):(i=e,s=t);const a=PI(s);let o=r;return typeof r=="string"&&(o=await a(r)),Cf(r)&&(o=await a(r)),Array.isArray(i)?await z_(o,i,s):await z_(o,i,s)}const L9="4.3.2",O9=(lz=globalThis.loaders)==null?void 0:lz.parseImageNode,Mv=typeof Image<"u",Pv=typeof ImageBitmap<"u",Fv=U_?!0:!!O9;function U9(r){switch(r){case"auto":return Pv||Mv||Fv;case"imagebitmap":return Pv;case"image":return Mv;case"data":return Fv;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function D9(){if(Pv)return"imagebitmap";if(Mv)return"image";if(Fv)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function N9(r){const e=k9(r);if(!e)throw new Error("Not an image");return e}function RI(r){switch(N9(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function k9(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const Q9=/^data:image\/svg\+xml/,z9=/\.svg((\?|#).*)?$/;function Rv(r){return r&&(Q9.test(r)||z9.test(r))}function H9(r,e){if(Rv(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return LI(r,e)}function LI(r,e){if(Rv(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function OI(r,e,t){const n=H9(r,t),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await V9(s||n,e)}finally{s&&i.revokeObjectURL(s)}}async function V9(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=s=>{const a=s instanceof Error?s.message:"error";i(new Error(a))}}catch(s){i(s)}})}const j9={};let UI=!0;async function $9(r,e,t){let n;Rv(t)?n=await OI(r,e,t):n=LI(r,t);const i=e&&e.imagebitmap;return await G9(n,i)}async function G9(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((q9(e)||!UI)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),UI=!1}return await createImageBitmap(r)}function q9(r){for(const e in r||j9)return!1;return!0}function K9(r){return!Z9(r,"ftyp",4)||(r[8]&96)===0?null:W9(r)}function W9(r){switch(X9(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function X9(r,e,t){return String.fromCharCode(...r.slice(e,t))}function Y9(r){return[...r].map(e=>e.charCodeAt(0))}function Z9(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=Y9(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Vu=!1,Tg=!0;function Lv(r){const e=Eg(r);return ej(e)||nj(e)||tj(e)||rj(e)||J9(e)}function J9(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=K9(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function ej(r){const e=Eg(r);return e.byteLength>=24&&e.getUint32(0,Vu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Vu),height:e.getUint32(20,Vu)}:null}function tj(r){const e=Eg(r);return e.byteLength>=10&&e.getUint32(0,Vu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Tg),height:e.getUint16(8,Tg)}:null}function rj(r){const e=Eg(r);return e.byteLength>=14&&e.getUint16(0,Vu)===16973&&e.getUint32(2,Tg)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Tg),height:e.getUint32(22,Tg)}:null}function nj(r){const e=Eg(r);if(!(e.byteLength>=3&&e.getUint16(0,Vu)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=ij();let s=2;for(;s+9<e.byteLength;){const a=e.getUint16(s,Vu);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Vu),width:e.getUint16(s+7,Vu)};if(!n.has(a))return null;s+=2,s+=e.getUint16(s,Vu)}return null}function ij(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Eg(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function sj(r,e){var i;const{mimeType:t}=Lv(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Ri(n),await n(r,t)}async function oj(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},a=aj(i);let o;switch(a){case"imagebitmap":o=await $9(r,e,s);break;case"image":o=await OI(r,e,s);break;case"data":o=await sj(r);break;default:Ri(!1)}return i==="data"&&(o=RI(o)),o}function aj(r){switch(r){case"auto":case"data":return D9();default:return U9(r),r}}const DI={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:L9,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:oj,tests:[r=>!!Lv(new DataView(r))],options:{image:{type:"auto",decode:!0}}},Ov={};function lj(r){if(Ov[r]===void 0){const e=U_?uj(r):cj(r);Ov[r]=e}return Ov[r]}function cj(r){var i,s;const e=["image/png","image/jpeg","image/gif"],t=((i=globalThis.loaders)==null?void 0:i.imageFormatsNode)||e;return!!((s=globalThis.loaders)==null?void 0:s.parseImageNode)&&t.includes(r)}function uj(r){switch(r){case"image/avif":case"image/webp":return hj(r);default:return!0}}function hj(r){try{return document.createElement("canvas").toDataURL(r).indexOf(`data:${r}`)===0}catch{return!1}}const Wn=new Dd({id:"deck"}),fA={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},Uv=1,Sg=2,Dv=3,Nv=4,Aj=2,fj=r=>({"layer.changeFlag":(e,t,n)=>{r.log(Dv,`${e.id} ${t}: `,n[t])()},"layer.initialize":e=>{r.log(Uv,`Initializing ${e}`)()},"layer.update":(e,t)=>{if(t){const n=e.getChangeFlags();r.log(Sg,`Updating ${e} because: ${Object.keys(n).filter(i=>n[i]).join(", ")}`)()}else r.log(Nv,`${e} does not need update`)()},"layer.matched":(e,t)=>{t&&r.log(Nv,`Matched ${e}, state transfered`)()},"layer.finalize":e=>{r.log(Uv,`Finalizing ${e}`)()},"compositeLayer.renderLayers":(e,t,n)=>{t?r.log(Sg,`Composite layer rendered new subLayers ${e}`,n)():r.log(Nv,`Composite layer reused subLayers ${e}`,n)()},"layerManager.setLayers":(e,t,n)=>{t&&r.log(Sg,`Updating ${n.length} deck layers`)()},"layerManager.activateViewport":(e,t)=>{r.log(Dv,"Viewport changed",t)()},"attributeManager.invalidate":(e,t,n)=>{r.log(Uv,n?`invalidated attributes ${n} (${t}) for ${e.id}`:`invalidated all attributes for ${e.id}`)()},"attributeManager.updateStart":e=>{fA.attributeUpdateMessages.length=0,fA.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(e,t)=>{const n=Math.round(Date.now()-fA.attributeManagerUpdateStart);r.groupCollapsed(Sg,`Updated attributes for ${t} instances in ${e.id} in ${n}ms`)();for(const i of fA.attributeUpdateMessages)r.log(Dv,i)();r.groupEnd(Sg)()},"attribute.updateStart":e=>{fA.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const n=`${e.id} allocated ${t}`;fA.attributeUpdateMessages.push(n)},"attribute.updateEnd":(e,t)=>{const n=Math.round(Date.now()-fA.attributeUpdateStart),i=`${e.id} updated ${t} in ${n}ms`;fA.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":(e,t,n)=>{const{pass:i,redrawReason:s,stats:a}=n;for(const o of t){const{totalCount:u,visibleCount:d,compositeCount:p,pickableCount:_}=o,v=u-p-d;r.log(Aj,`RENDER #${e.renderCount}   ${d} (of ${u} layers) to ${i} because ${s}   (${v} hidden, ${p} composite ${_} pickable)`)(),a&&a.get("Redraw Layers").add(d)}}});var dj={};let H_={};dj.NODE_ENV!=="production"&&(H_=fj(Wn));function pj(r){H_=r}function la(r,e,t,n){Wn.level>0&&H_[r]&&H_[r].call(null,e,t,n)}function gj(r){const e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const mj={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:gj,parseTextSync:JSON.parse};function _j(){const r="9.1.4",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${r}`);return e||(Wn.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:Wn,_registerLoggers:pj},o9([mj,[DI,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const yj=_j();function kv(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const Qv={number:{type:"number",validate(r,e){return Number.isFinite(r)&&typeof e=="object"&&(e.max===void 0||r<=e.max)&&(e.min===void 0||r>=e.min)}},array:{type:"array",validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function bj(r){const e={};for(const[t,n]of Object.entries(r))e[t]=vj(n);return e}function vj(r){let e=NI(r);if(e!=="object")return{value:r,...Qv[e],type:e};if(typeof r=="object")return r?r.type!==void 0?{...r,...Qv[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(e=NI(r.value),{...r,...Qv[e],type:e}):{type:"object",value:null};throw new Error("props")}function NI(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const wj={vertex:`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`},kI=/void\s+main\s*\([^)]*\)\s*\{\n?/,QI=/}\n?[^{}]*$/,zv=[],V_="__LUMA_INJECT_DECLARATIONS__";function xj(r){const e={vertex:{},fragment:{}};for(const t in r){let n=r[t];const i=Bj(t);typeof n=="string"&&(n={order:0,injection:n}),e[i][t]=n}return e}function Bj(r){const e=r.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function j_(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=e==="vertex";for(const s in t){const a=t[s];a.sort((u,d)=>u.order-d.order),zv.length=a.length;for(let u=0,d=a.length;u<d;++u)zv[u]=a[u].injection;const o=`${zv.join(`
`)}
`;switch(s){case"vs:#decl":i&&(r=r.replace(V_,o));break;case"vs:#main-start":i&&(r=r.replace(kI,u=>u+o));break;case"vs:#main-end":i&&(r=r.replace(QI,u=>o+u));break;case"fs:#decl":i||(r=r.replace(V_,o));break;case"fs:#main-start":i||(r=r.replace(kI,u=>u+o));break;case"fs:#main-end":i||(r=r.replace(QI,u=>o+u));break;default:r=r.replace(s,u=>u+o)}}return r=r.replace(V_,""),n&&(r=r.replace(/\}\s*$/,s=>s+wj[e])),r}function $_(r){r.map(e=>Cj(e))}function Cj(r){if(r.instance)return;$_(r.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:n={}}=r,i={normalizedInjections:xj(n),parsedDeprecations:Tj(t)};e&&(i.propValidators=bj(e)),r.instance=i;let s={};e&&(s=Object.entries(e).reduce((a,o)=>{let[u,d]=o;const p=d==null?void 0:d.value;return p&&(a[u]=p),a},{})),r.defaultUniforms={...r.defaultUniforms,...s}}function zI(r,e,t){var n;(n=r.deprecations)==null||n.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function Tj(r){return r.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),r}function Hv(r){$_(r);const e={},t={};HI({modules:r,level:0,moduleMap:e,moduleDepth:t});const n=Object.keys(t).sort((i,s)=>t[s]-t[i]).map(i=>e[i]);return $_(n),n}function HI(r){const{modules:e,level:t,moduleMap:n,moduleDepth:i}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)n[s.name]=s,(i[s.name]===void 0||i[s.name]<t)&&(i[s.name]=t);for(const s of e)s.dependencies&&HI({modules:s.dependencies,level:t+1,moduleMap:n,moduleDepth:i})}function Ej(r){switch(r==null?void 0:r.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function Sj(r,e){var n;if(Number(((n=r.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return r=jI(r,Ij),r;case"fragment":return r=jI(r,Mj),r;default:throw new Error(e)}}const VI=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Ij=[...VI,[Vv("attribute"),"in $1"],[Vv("varying"),"out $1"]],Mj=[...VI,[Vv("varying"),"in $1"]];function jI(r,e){for(const[t,n]of e)r=r.replace(t,n);return r}function Vv(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function $I(r,e){let t="";for(const n in r){const i=r[n];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[n]){const s=e[n];s.sort((a,o)=>a.order-o.order);for(const a of s)t+=`  ${a.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function GI(r){const e={vertex:{},fragment:{}};for(const t of r){let n,i;typeof t!="string"?(n=t,i=n.hook):(n={},i=t),i=i.trim();const[s,a]=i.split(":"),o=i.replace(/\(.+/,""),u=Object.assign(n,{signature:a});switch(s){case"vs":e.vertex[o]=u;break;case"fs":e.fragment[o]=u;break;default:throw new Error(s)}}return e}function Pj(r,e){return{name:Fj(r,e),language:"glsl",version:Rj(r)}}function Fj(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return n?n[1]:e}function Rj(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const qI=`

${V_}
`,Lj=`precision highp float;
`;function Oj(r){const e=Hv(r.modules||[]);return{source:Dj(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:e}),getUniforms:WI(e)}}function Uj(r){const{vs:e,fs:t}=r,n=Hv(r.modules||[]);return{vs:KI(r.platformInfo,{...r,source:e,stage:"vertex",modules:n}),fs:KI(r.platformInfo,{...r,source:t,stage:"fragment",modules:n}),getUniforms:WI(n)}}function Dj(r,e){var P;const{source:t,stage:n,modules:i,hookFunctions:s=[],inject:a={},log:o}=e;kv(typeof t=="string","shader source must be a string");const u=t;let d="";const p=GI(s),_={},w={},v={};for(const D in a){const N=typeof a[D]=="string"?{injection:a[D],order:0}:a[D],z=/^(v|f)s:(#)?([\w-]+)$/.exec(D);if(z){const W=z[2],V=z[3];W?V==="decl"?w[D]=[N]:v[D]=[N]:_[D]=[N]}else v[D]=[N]}const M=i;for(const D of M){o&&zI(D,u,o);const N=XI(D,"wgsl");d+=N;const z=((P=D.injections)==null?void 0:P[n])||{};for(const W in z){const V=/^(v|f)s:#([\w-]+)$/.exec(W);if(V){const q=V[2]==="decl"?w:v;q[W]=q[W]||[],q[W].push(z[W])}else _[W]=_[W]||[],_[W].push(z[W])}}return d+=qI,d=j_(d,n,w),d+=$I(p[n],_),d+=u,d=j_(d,n,v),d}function KI(r,e){var te;const{id:t,source:n,stage:i,language:s="glsl",modules:a,defines:o={},hookFunctions:u=[],inject:d={},prologue:p=!0,log:_}=e;kv(typeof n=="string","shader source must be a string");const w=s==="glsl"?Pj(n).version:-1,v=r.shaderLanguageVersion,M=w===100?"#version 100":"#version 300 es",D=n.split(`
`).slice(1).join(`
`),N={};a.forEach(J=>{Object.assign(N,J.defines)}),Object.assign(N,o);let z="";switch(s){case"wgsl":break;case"glsl":z=p?`${M}

// ----- PROLOGUE -------------------------
${Nj({id:t,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${Ej(r)}
${i==="fragment"?Lj:""}

// ----- APPLICATION DEFINES -------------------------

${kj(N)}

`:`${M}
`;break}const W=GI(u),V={},$={},q={};for(const J in d){const me=typeof d[J]=="string"?{injection:d[J],order:0}:d[J],xe=/^(v|f)s:(#)?([\w-]+)$/.exec(J);if(xe){const se=xe[2],oe=xe[3];se?oe==="decl"?$[J]=[me]:q[J]=[me]:V[J]=[me]}else q[J]=[me]}for(const J of a){_&&zI(J,D,_);const me=XI(J,i);z+=me;const xe=((te=J.instance)==null?void 0:te.normalizedInjections[i])||{};for(const se in xe){const oe=/^(v|f)s:#([\w-]+)$/.exec(se);if(oe){const ge=oe[2]==="decl"?$:q;ge[se]=ge[se]||[],ge[se].push(xe[se])}else V[se]=V[se]||[],V[se].push(xe[se])}}return z+="// ----- MAIN SHADER SOURCE -------------------------",z+=qI,z=j_(z,i,$),z+=$I(W[i],V),z+=D,z=j_(z,i,q),s==="glsl"&&w!==v&&(z=Sj(z,i)),z.trim()}function WI(r){return function(t){var i;const n={};for(const s of r){const a=(i=s.getUniforms)==null?void 0:i.call(s,t,n);Object.assign(n,a)}return n}}function Nj(r){const{id:e,source:t,stage:n}=r;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function kj(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e="";for(const t in r){const n=r[t];(n||Number.isFinite(n))&&(e+=`#define ${t.toUpperCase()} ${r[t]}
`)}return e}function XI(r,e){let t;switch(e){case"vertex":t=r.vs||"";break;case"fragment":t=r.fs||"";break;case"wgsl":t=r.source||"";break;default:kv(!1)}if(!r.name)throw new Error("Shader module must have a name");const n=r.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${r.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${t}
`,i}const Qj=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,zj=/^\s*\#\s*endif\s*$/;function Hj(r,e){var a;const t=r.split(`
`),n=[];let i=!0,s=null;for(const o of t){const u=o.match(Qj),d=o.match(zj);u?(s=u[1],i=!!((a=e==null?void 0:e.defines)!=null&&a[s])):d?i=!0:i&&n.push(o)}return n.join(`
`)}const gd=class gd{constructor(){Y(this,"_hookFunctions",[]);Y(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return gd.defaultShaderAssembler=gd.defaultShaderAssembler||new gd,gd.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:s}=Oj({...e,source:e.source,modules:t,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?Hj(i):i,getUniforms:s,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions;return{...Uj({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n}),modules:t}}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let s=0,a=this._defaultModules.length;s<a;++s){const o=this._defaultModules[s],u=o.name;t[i++]=o,n[u]=!0}for(let s=0,a=e.length;s<a;++s){const o=e[s],u=o.name;n[u]||(t[i++]=o,n[u]=!0)}return t.length=i,$_(t),t}};Y(gd,"defaultShaderAssembler");let G_=gd;const Vj=`#version 300 es
out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`;function jj(r){const{input:e,inputChannels:t,output:n}={};if(!e)return Vj;if(!t)throw new Error("inputChannels");const i=$j(t),s=Gj(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${s};
}`}function $j(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function Gj(r,e){switch(e){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${e}`)}}class qj{constructor(){Y(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Nd({id:e})),this.stats.get(e)}}const YI=new qj,yr=new Dd({id:"luma.gl"}),jv={};function q_(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";jv[r]=jv[r]||1;const e=jv[r]++;return`${r}-${e}`}let xi=(Q3=class{constructor(e,t,n){Y(this,"id");Y(this,"props");Y(this,"userData",{});Y(this,"_device");Y(this,"destroyed",!1);Y(this,"allocatedBytes",0);Y(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=Kj(t,n);const i=this.props.id!=="undefined"?this.props.id:q_(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},Y(Q3,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Q3);function Kj(r,e){const t={...e};for(const n in r)r[n]!==void 0&&(t[n]=r[n]);return t}let Rs=(oo=class extends xi{constructor(t,n){const i={...n};(n.usage||0)&oo.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?i.indexType="uint32":n.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(t,i,oo.defaultProps);Y(this,"usage");Y(this,"indexType");Y(this,"updateTimestamp");Y(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,n){throw new Error("not implemented")}_setDebugData(t,n,i){const s=ArrayBuffer.isView(t)?t.buffer:t,a=Math.min(t?t.byteLength:i,oo.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(a):n===0&&i===s.byteLength?this.debugData=s.slice(0,a):this.debugData=s.slice(n,n+a)}},Y(oo,"defaultProps",{...xi.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),Y(oo,"MAP_READ",1),Y(oo,"MAP_WRITE",2),Y(oo,"COPY_SRC",4),Y(oo,"COPY_DST",8),Y(oo,"INDEX",16),Y(oo,"VERTEX",32),Y(oo,"UNIFORM",64),Y(oo,"STORAGE",128),Y(oo,"INDIRECT",256),Y(oo,"QUERY_RESOLVE",512),Y(oo,"DEBUG_DATA_MAX_LENGTH",32),oo);function ZI(r){const e=JI[r],t=Wj(e),n=r.includes("norm"),i=!n&&!r.startsWith("float"),s=r.startsWith("s");return{dataType:JI[r],byteLength:t,integer:i,signed:s,normalized:n}}function Wj(r){return Xj[r]}const JI={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Xj={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},ca="texture-compression-bc",Bi="texture-compression-astc",ju="texture-compression-etc2",Yj="texture-compression-etc1-webgl",K_="texture-compression-pvrtc-webgl",$v="texture-compression-atc-webgl",W_="float32-renderable-webgl",Gv="float16-renderable-webgl",Zj="rgb9e5ufloat-renderable-webgl",qv="snorm8-renderable-webgl",Ig="norm16-renderable-webgl",Kv="snorm16-renderable-webgl",X_="float32-filterable",e5="float16-filterable-webgl";function t5(r){const e=Jj[r];if(!e)throw new Error(`Unsupported texture format ${r}`);return e}const Jj={r8unorm:{},r8snorm:{render:qv},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:qv},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Gv,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Ig},"r16snorm-webgl":{f:Kv},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:qv},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Gv,filter:e5},"rg16unorm-webgl":{render:Ig},"rg16snorm-webgl":{render:Kv},r32uint:{},r32sint:{},r32float:{render:W_,filter:X_},rgb9e5ufloat:{channels:"rgb",packed:!0,render:Zj},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:W_},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Ig},"rgb16snorm-webgl":{f:Ig},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:X_},rgba16uint:{},rgba16sint:{},rgba16float:{render:Gv,filter:e5},"rgba16unorm-webgl":{render:Ig},"rgba16snorm-webgl":{render:Kv},"rgb32float-webgl":{render:W_,filter:X_},rgba32uint:{},rgba32sint:{},rgba32float:{render:W_,filter:X_},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:ca},"bc1-rgb-unorm-srgb-webgl":{f:ca},"bc1-rgba-unorm":{f:ca},"bc1-rgba-unorm-srgb":{f:ca},"bc2-rgba-unorm":{f:ca},"bc2-rgba-unorm-srgb":{f:ca},"bc3-rgba-unorm":{f:ca},"bc3-rgba-unorm-srgb":{f:ca},"bc4-r-unorm":{f:ca},"bc4-r-snorm":{f:ca},"bc5-rg-unorm":{f:ca},"bc5-rg-snorm":{f:ca},"bc6h-rgb-ufloat":{f:ca},"bc6h-rgb-float":{f:ca},"bc7-rgba-unorm":{f:ca},"bc7-rgba-unorm-srgb":{f:ca},"etc2-rgb8unorm":{f:ju},"etc2-rgb8unorm-srgb":{f:ju},"etc2-rgb8a1unorm":{f:ju},"etc2-rgb8a1unorm-srgb":{f:ju},"etc2-rgba8unorm":{f:ju},"etc2-rgba8unorm-srgb":{f:ju},"eac-r11unorm":{f:ju},"eac-r11snorm":{f:ju},"eac-rg11unorm":{f:ju},"eac-rg11snorm":{f:ju},"astc-4x4-unorm":{f:Bi},"astc-4x4-unorm-srgb":{f:Bi},"astc-5x4-unorm":{f:Bi},"astc-5x4-unorm-srgb":{f:Bi},"astc-5x5-unorm":{f:Bi},"astc-5x5-unorm-srgb":{f:Bi},"astc-6x5-unorm":{f:Bi},"astc-6x5-unorm-srgb":{f:Bi},"astc-6x6-unorm":{f:Bi},"astc-6x6-unorm-srgb":{f:Bi},"astc-8x5-unorm":{f:Bi},"astc-8x5-unorm-srgb":{f:Bi},"astc-8x6-unorm":{f:Bi},"astc-8x6-unorm-srgb":{f:Bi},"astc-8x8-unorm":{f:Bi},"astc-8x8-unorm-srgb":{f:Bi},"astc-10x5-unorm":{f:Bi},"astc-10x5-unorm-srgb":{f:Bi},"astc-10x6-unorm":{f:Bi},"astc-10x6-unorm-srgb":{f:Bi},"astc-10x8-unorm":{f:Bi},"astc-10x8-unorm-srgb":{f:Bi},"astc-10x10-unorm":{f:Bi},"astc-10x10-unorm-srgb":{f:Bi},"astc-12x10-unorm":{f:Bi},"astc-12x10-unorm-srgb":{f:Bi},"astc-12x12-unorm":{f:Bi},"astc-12x12-unorm-srgb":{f:Bi},"pvrtc-rgb4unorm-webgl":{f:K_},"pvrtc-rgba4unorm-webgl":{f:K_},"pvrtc-rbg2unorm-webgl":{f:K_},"pvrtc-rgba2unorm-webgl":{f:K_},"etc1-rbg-unorm-webgl":{f:Yj},"atc-rgb-unorm-webgl":{f:$v},"atc-rgba-unorm-webgl":{f:$v},"atc-rgbai-unorm-webgl":{f:$v}},e$=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],t$=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function r5(r){return e$.some(e=>r.startsWith(e))}function Wv(r){let e=r$(r);if(r5(r)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=n$(r);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const t=t$.exec(r);if(t){const[,n,i,s,a,o]=t,u=`${s}${i}`,d=ZI(u),p=d.byteLength*8,_=n.length,w=[p,_>=2?p:0,_>=3?p:0,_>=4?p:0];e={format:r,attachment:e.attachment,dataType:d.dataType,components:_,channels:n,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:w,bytesPerPixel:d.byteLength*n.length,packed:e.packed,srgb:e.srgb},o==="-webgl"&&(e.webgl=!0),a==="-srgb"&&(e.srgb=!0)}return r.endsWith("-webgl")&&(e.webgl=!0),r.endsWith("-srgb")&&(e.srgb=!0),e}function r$(r){var s;const e=t5(r),t=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:r,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:t,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function n$(r){const t=/.*-(\d+)x(\d+)-.*/.exec(r);if(t){const[,n,i]=t;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}function i$(r){const e=t5(r),t={format:r,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=Wv(r),i=r.startsWith("depth")||r.startsWith("stencil"),s=n==null?void 0:n.signed,a=n==null?void 0:n.integer,o=n==null?void 0:n.webgl;return t.render&&(t.render=!s),t.filter&&(t.filter=!i&&!s&&!a&&!o),t}class s${}class o${constructor(){Y(this,"features");Y(this,"disabledFeatures");let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const mb=class mb{constructor(e){Y(this,"id");Y(this,"props");Y(this,"userData",{});Y(this,"statsManager",YI);Y(this,"timestamp",0);Y(this,"_reused",!1);Y(this,"_lumaData",{});this.props={...mb.defaultProps,...e},this.id=this.props.id||q_(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=i$(e),n=a=>(typeof a=="string"?this.features.has(a):a)??!0,i=n(t.create),s={format:e,create:i,render:i&&n(t.render),filter:i&&n(t.filter),blend:i&&n(t.blend),store:i&&n(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return r5(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Rs.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":yr.warn("indices buffer content must be of integer type")()),t}};Y(mb,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>yr.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:yr.get("debug")||void 0,debugShaders:yr.get("debug-shaders")||void 0,debugFramebuffers:!!yr.get("debug-framebuffers"),debugWebGL:!!yr.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let dA=mb;const a$=wf()&&typeof document<"u",l$=()=>a$&&document.readyState==="complete",c$="set luma.log.level=1 (or higher) to trace rendering",n5="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",JA=class JA{constructor(){Y(this,"stats",YI);Y(this,"log",yr);Y(this,"VERSION","9.1.4");Y(this,"spector");Y(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw yr.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),yr.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");yr.error("This version of luma.gl has already been initialized")()}yr.log(1,`${this.VERSION} - ${c$}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.getAdapterMap(e);return Array.from(t).map(n=>{let[,i]=n;return i}).filter(n=>{var i;return(i=n.isSupported)==null?void 0:i.call(n)}).map(n=>n.type)}getBestAvailableAdapter(){var n,i,s,a;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.getAdapterMap(e);return(i=(n=t.get("webgpu"))==null?void 0:n.isSupported)!=null&&i.call(n)?"webgpu":(a=(s=t.get("webgl"))==null?void 0:s.isSupported)!=null&&a.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(JA.defaultProps,e)}async createDevice(){var o;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e={...JA.defaultProps,...e},e.waitForPageLoad&&await JA.pageLoaded;const t=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const s=(this.getAdapterMap(e.adapters)||t).get(n),a=await((o=s==null?void 0:s.create)==null?void 0:o.call(s,e));if(a)return a;throw new Error(n5)}async attachDevice(e){var a;const t=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await JA.pageLoaded,e.handle===null&&(n="unknown");const i=t.get(n),s=await((a=i==null?void 0:i.attach)==null?void 0:a.call(i,null));if(s)return s;throw new Error(n5)}enforceWebGL2(){var s;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=this.getAdapterMap(t).get("webgl");i||yr.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}registerDevices(e){yr.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const n=t.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}};Y(JA,"defaultProps",{...dA.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),Y(JA,"pageLoaded",u$().then(()=>{yr.probe(2,"DOM is loaded")()}));let Xv=JA;const Yv=new Xv;function u$(){return l$()||typeof window>"u"?Promise.resolve():new Promise(r=>{window.addEventListener("load",()=>r())})}class h${}const _b=class _b{constructor(e){Y(this,"id");Y(this,"props");Y(this,"canvas");Y(this,"htmlCanvas");Y(this,"offscreenCanvas");Y(this,"type");Y(this,"width",1);Y(this,"height",1);Y(this,"resizeObserver");Y(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={..._b.defaultProps,...e},e=this.props,!wf()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=f$(e.canvas):this.canvas=e.canvas;else{const t=d$(e),n=A$((e==null?void 0:e.container)||null);n.insertBefore(t,n.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const n of t)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return n?t/n:1}catch{return 1}}cssToDevicePixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const n=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return p$(e,n,i,s,t)}setDevicePixelRatio(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!n||!i)&&(yr.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==i||s.devicePixelRatio!==e){let a=e;const o=Math.floor(n*a),u=Math.floor(i*a);if(this.htmlCanvas.width=o,this.htmlCanvas.height=u,this.device.gl){const[p,_]=this.getDrawingBufferSize();(p!==o||_!==u)&&(a=Math.min(p/n,_/i),this.htmlCanvas.width=Math.floor(n*a),this.htmlCanvas.height=Math.floor(i*a),yr.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};Y(_b,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Zv=_b;function A$(r){if(typeof r=="string"){const e=document.getElementById(r);if(!e)throw new Error(`${r} is not an HTML element`);return e}else if(r)return r;return document.body}function f$(r){const e=document.getElementById(r);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function d$(r){const{width:e,height:t}=r,n=document.createElement("canvas");return n.id=q_("lumagl-auto-created-canvas"),n.width=e||1,n.height=t||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(t)?`${t}px`:"100%",n}function p$(r,e,t,n,i){const s=r,a=i5(s[0],e,t);let o=s5(s[1],e,n,i),u=i5(s[0]+1,e,t);const d=u===t-1?u:u-1;u=s5(s[1]+1,e,n,i);let p;return i?(u=u===0?u:u+1,p=o,o=u):p=u===n-1?u:u-1,{x:a,y:o,width:Math.max(d-a+1,1),height:Math.max(p-o+1,1)}}function i5(r,e,t){return Math.min(Math.round(r*e),t-1)}function s5(r,e,t,n){return n?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}const Xo=class Xo extends xi{constructor(t,n){n=Xo.normalizeProps(t,n);super(t,n,Xo.defaultProps);Y(this,"dimension");Y(this,"format");Y(this,"width");Y(this,"height");Y(this,"depth");Y(this,"mipLevels");Y(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=Xo.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Xo.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const n=t==null?void 0:t.data;return ArrayBuffer.isView(n)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Xo.getTextureDataSize(t[0]);if(Xo.isExternalImage(t))return Xo.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const i=Object.values(t)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,n){let i;return ArrayBuffer.isView(t)?i=[{data:t,width:n.width,height:n.height}]:Array.isArray(t)?i=t:i=[t],i}static getMipLevelCount(t,n){return Math.floor(Math.log2(Math.max(t,n)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,n){var u,d;const i={...n},s=((d=(u=t==null?void 0:t.props)==null?void 0:u._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(i,s);const{width:a,height:o}=i;return typeof a=="number"&&(i.width=Math.max(1,Math.ceil(a))),typeof o=="number"&&(i.height=Math.max(1,Math.ceil(o))),i}};Y(Xo,"COPY_SRC",1),Y(Xo,"COPY_DST",2),Y(Xo,"TEXTURE",4),Y(Xo,"STORAGE",8),Y(Xo,"RENDER_ATTACHMENT",16),Y(Xo,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),Y(Xo,"defaultProps",{...xi.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),Y(Xo,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let hs=Xo;const yb=class yb extends xi{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,yb.defaultProps)}};Y(yb,"defaultProps",{...xi.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Y_=yb;function g$(r,e,t){let n="";const i=e.split(/\r?\n/),s=r.slice().sort((a,o)=>a.lineNum-o.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let a=0;for(let o=1;o<=i.length;o++)for(n+=a5(i[o-1],o,t);s.length>a&&s[a].lineNum===o;){const u=s[a++];n+=o5(u,i,u.lineNum,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const o of r)n+=o5(o,i,o.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return n}}function o5(r,e,t,n){if(n!=null&&n.inlineSource){const s=m$(e,t),a=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${s}${a}${r.type.toUpperCase()}: ${r.message}

`}const i=r.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function m$(r,e,t){let n="";for(let i=e-2;i<=e;i++){const s=r[i-1];s!==void 0&&(n+=a5(s,e,t))}return n}function a5(r,e,t){const n=t!=null&&t.html?y$(r):r;return`${_$(String(e),4)}: ${n}${t!=null&&t.html?"<br/>":`
`}`}function _$(r,e){let t="";for(let n=r.length;n<e;++n)t+=" ";return t+r}function y$(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const bb=class bb extends xi{constructor(t,n){n={...n,debugShaders:n.debugShaders||t.props.debugShaders||"errors"};super(t,{id:b$(n),...n},bb.defaultProps);Y(this,"stage");Y(this,"source");Y(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();t==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(t){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=l5(this.source),i=`${this.stage} ${n}`;let s=g$(t,this.source,{showSourceCode:"all",html:!0});const a=this.getTranslatedSource();a&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${a}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),o.onclick=()=>{const p=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(p)}}};Y(bb,"defaultProps",{...xi.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Z_=bb;function b$(r){return l5(r.source)||r.id||q_(`unnamed ${r.stage}-shader`)}function l5(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return n?n[1]:e}const r_=class r_ extends xi{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=r_.normalizeProps(e,t),super(e,t,r_.defaultProps)}static normalizeProps(e,t){var s,a;const n=((a=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:a.sampler)||{};return{...t,...n}}};Y(r_,"defaultProps",{...xi.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let J_=r_;const vb=class vb extends xi{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,n,vb.defaultProps);Y(this,"width");Y(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const n=this.colorAttachments.map(s=>s.texture.clone(t)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:i})}resize(t){let n=!t;if(t){const[i,s]=Array.isArray(t)?t:[t.width,t.height];n=n||s!==this.height||i!==this.width,this.width=i,this.height=s}n&&(yr.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,i)=>{if(typeof n=="string"){const s=this.createColorTexture(n,i);return this.attachResource(s),s.view}return n instanceof hs?n.view:n});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const n=this.createDepthStencilTexture(t);this.attachResource(n),this.depthStencilAttachment=n.view}else t instanceof hs?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:hs.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:hs.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,n){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:t,height:n});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:t,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};Y(vb,"defaultProps",{...xi.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let ey=vb;const wb=class wb extends xi{constructor(t,n){super(t,n,wb.defaultProps);Y(this,"shaderLayout");Y(this,"bufferLayout");Y(this,"linkStatus","pending");Y(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};Y(wb,"defaultProps",{...xi.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let kd=wb;const uu=class uu extends xi{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=uu.normalizeProps(e,t),super(e,t,uu.defaultProps)}static normalizeProps(e,t){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...t}}};Y(uu,"defaultClearColor",[0,0,0,1]),Y(uu,"defaultClearDepth",1),Y(uu,"defaultClearStencil",0),Y(uu,"defaultProps",{...xi.defaultProps,framebuffer:null,parameters:void 0,clearColor:uu.defaultClearColor,clearColors:void 0,clearDepth:uu.defaultClearDepth,clearStencil:uu.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Jv=uu;const xb=class xb extends xi{constructor(t,n){super(t,n,xb.defaultProps);Y(this,"hash","");Y(this,"shaderLayout");this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};Y(xb,"defaultProps",{...xi.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let ty=xb;const Bb=class Bb extends xi{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Bb.defaultProps)}};Y(Bb,"defaultProps",{...xi.defaultProps,measureExecutionTime:void 0});let ew=Bb;const Cb=class Cb extends xi{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Cb.defaultProps)}};Y(Cb,"defaultProps",{...xi.defaultProps});let tw=Cb;function v$(r){const[e,t]=x$[r],n=e==="i32"||e==="u32",i=e!=="u32",s=B$[e]*t,a=w$(e,t);return{dataType:e,components:t,defaultVertexFormat:a,byteLength:s,integer:n,signed:i}}function w$(r,e){let t;switch(r){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const x$={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},B$={f32:4,f16:2,i32:4,u32:4};function c5(r){let e;r.endsWith("-webgl")&&(r.replace("-webgl",""),e=!0);const[t,n]=r.split("x"),i=t,s=n?parseInt(n):1,a=ZI(i),o={type:i,components:s,byteLength:a.byteLength*s,integer:a.integer,signed:a.signed,normalized:a.normalized};return e&&(o.webglOnly=!0),o}function u5(r,e){const t={};for(const n of r.attributes){const i=T$(r,e,n.name);i&&(t[n.name]=i)}return t}function C$(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:16;const n=u5(r,e),i=new Array(t).fill(null);for(const s of Object.values(n))i[s.location]=s;return i}function T$(r,e,t){const n=E$(r,t),i=S$(e,t);if(!n)return null;const s=v$(n.type),a=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,o=c5(a);return{attributeName:(i==null?void 0:i.attributeName)||n.name,bufferName:(i==null?void 0:i.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:a,bufferDataType:o.type,bufferComponents:o.components,normalized:o.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||n.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function E$(r,e){const t=r.attributes.find(n=>n.name===e);return t||yr.warn(`shader layout attribute "${e}" not present in shader`),t||null}function S$(r,e){I$(r);let t=M$(r,e);return t||(t=P$(r,e),t)?t:(yr.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function I$(r){for(const e of r)(e.attributes&&e.format||!e.attributes&&!e.format)&&yr.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function M$(r,e){for(const t of r)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function P$(r,e){var t;for(const n of r){let i=n.byteStride;if(typeof n.byteStride!="number")for(const a of n.attributes||[]){const o=c5(a.format);i+=o.byteLength}const s=(t=n.attributes)==null?void 0:t.find(a=>a.attribute===e);if(s)return{attributeName:s.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const Tb=class Tb extends xi{constructor(t,n){super(t,n,Tb.defaultProps);Y(this,"maxVertexAttributes");Y(this,"attributeInfos");Y(this,"indexBuffer",null);Y(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=n.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=C$(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,n){this.device.reportError(new Error("constant attributes not supported"))}};Y(Tb,"defaultProps",{...xi.defaultProps,renderPipeline:null});let rw=Tb;const Eb=class Eb extends xi{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Eb.defaultProps)}};Y(Eb,"defaultProps",{...xi.defaultProps,layout:void 0,buffers:{}});let nw=Eb;const Sb=class Sb extends xi{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Sb.defaultProps)}};Y(Sb,"defaultProps",{...xi.defaultProps,type:void 0,count:void 0});let iw=Sb;const F$={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function R$(r){return F$[r]}function L$(r,e){switch(e){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}let ry;function h5(r){return(!ry||ry.byteLength<r)&&(ry=new ArrayBuffer(r)),ry}function O$(r,e){const t=h5(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function U$(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function ny(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":U$(r)}const A5=1024;class D${constructor(e){Y(this,"layout",{});Y(this,"byteLength");let t=0;for(const[i,s]of Object.entries(e)){const a=R$(s),{type:o,components:u}=a;t=L$(t,u);const d=t;t+=u,this.layout[i]={type:o,size:u,offset:d}}t+=(4-t%4)%4;const n=t*4;this.byteLength=Math.max(n,A5)}getData(e){const t=Math.max(this.byteLength,A5),n=h5(t),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[s,a]of Object.entries(e)){const o=this.layout[s];if(!o){yr.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:d,offset:p}=o,_=i[u];if(d===1){if(typeof a!="number"&&typeof a!="boolean"){yr.warn(`Supplied value for single component uniform ${s} is not a number: ${a}`)();continue}_[p]=Number(a)}else{if(!ny(a)){yr.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${a}`)();continue}_.set(a,p)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function N$(r,e){if(r!==e)return!1;const t=r,n=e;if(!ny(t))return!1;if(ny(n)&&t.length===n.length){for(let i=0;i<t.length;++i)if(n[i]!==t[i])return!1}return!0}function k$(r){return ny(r)?r.slice():r}class Q${constructor(e){Y(this,"name");Y(this,"uniforms",{});Y(this,"modifiedUniforms",{});Y(this,"modified",!0);Y(this,"bindingLayout",{});Y(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const i=n;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){N$(this.uniforms[e],t)||(this.uniforms[e]=k$(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class z${constructor(e){Y(this,"uniformBlocks",new Map);Y(this,"uniformBufferLayouts",new Map);Y(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const i=t,s=new D$(n.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const a=new Q$({name:t});a.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,a)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,i]of Object.entries(e))(t=this.uniformBlocks.get(n))==null||t.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var n,i;const t=((n=this.uniformBlocks.get(e))==null?void 0:n.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Rs.UNIFORM|Rs.COPY_DST,byteLength:i}),a=this.getUniformBufferData(t);return s.write(a),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Rs.UNIFORM|Rs.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&yr.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&(t!=null&&t.needsRedraw)){i||(i=t.needsRedraw);const a=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n==null||n.write(a);const o=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();yr.log(4,`Writing to uniform buffer ${String(e)}`,a,o)()}return i}}function f5(r){const e=ArrayBuffer.isView(r)?r.constructor:r;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function d5(r){switch(r){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(r)}}function H$(r,e,t){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let i=f5(r);if(i==="uint8"&&t&&n===1)return"unorm8-webgl";if(i==="uint8"&&t&&n===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}class sw{constructor(e){Y(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const i of t){const s=n.findIndex(a=>a.name===i.name);s<0?n.push(i):n[s]=i}return n}}class Mc{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class p5{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class pA extends Mc{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Tf extends Mc{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class gA extends Mc{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}}var mA,Qd,Mg,It,mt;(r=>{r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(mA||(mA={}));class iy{constructor(e,t,n,i,s,a,o){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=s,this.resourceType=a,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class V${constructor(e,t){this.name=e,this.type=t}}class j${constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class g5{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}let $$=class{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}};class G${constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}let q$=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}};class K${constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}let W$=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}};class Xl{constructor(){this.id=Xl._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}search(e){}searchBlock(e,t){if(e){t(sy.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(oy.instance)}}}Xl._id=0;class sy extends Xl{}sy.instance=new sy;class oy extends Xl{}oy.instance=new oy;let ns=class extends Xl{constructor(){super()}};class ay extends ns{constructor(e,t,n,i,s,a){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=s,this.endLine=a}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}let X$=class extends ns{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}},m5=class extends ns{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},ow=class extends ns{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}},_5=class extends ns{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}};class _A extends ns{constructor(e,t,n,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}let aw=class extends ns{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}};class ly extends ns{constructor(e,t,n,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}let lw=class extends ns{constructor(e,t,n,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}};(r=>{r.increment="++",r.decrement="--"})(Qd||(Qd={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return r[t]}})(Qd||(Qd={}));let y5=class extends ns{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}};(r=>{r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(Mg||(Mg={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Mg||(Mg={}));let b5=class extends ns{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}},cw=class extends ns{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}search(e){for(const t of this.args)t.search(e);e(this)}},v5=class extends ns{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}},w5=class extends ns{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}},x5=class extends ns{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}},B5=class extends ns{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}},Y$=class extends ns{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}};class Z$ extends ns{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}let C5=class extends ns{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}},uw=class extends ns{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}},J$=class extends ns{constructor(){super()}get astNodeType(){return"discard"}};class T5 extends ns{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}let E5=class extends ns{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},Cr=class Jb extends ns{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const i=Jb._priority.get(t.name);Jb._priority.get(e[n].name)<i&&(t=e[n])}return t.name==="x32"?Jb.i32:t}};Cr.x32=new Cr("x32"),Cr.f32=new Cr("f32"),Cr.i32=new Cr("i32"),Cr.u32=new Cr("u32"),Cr.f16=new Cr("f16"),Cr.bool=new Cr("bool"),Cr._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);let yA=class extends Cr{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}},Xt=class extends Cr{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}};Xt.vec2f=new Xt("vec2",Cr.f32,null),Xt.vec3f=new Xt("vec3",Cr.f32,null),Xt.vec4f=new Xt("vec4",Cr.f32,null),Xt.vec2i=new Xt("vec2",Cr.i32,null),Xt.vec3i=new Xt("vec3",Cr.i32,null),Xt.vec4i=new Xt("vec4",Cr.i32,null),Xt.vec2u=new Xt("vec2",Cr.u32,null),Xt.vec3u=new Xt("vec3",Cr.u32,null),Xt.vec4u=new Xt("vec4",Cr.u32,null),Xt.vec2h=new Xt("vec2",Cr.f16,null),Xt.vec3h=new Xt("vec3",Cr.f16,null),Xt.vec4h=new Xt("vec4",Cr.f16,null),Xt.vec2b=new Xt("vec2",Cr.bool,null),Xt.vec3b=new Xt("vec3",Cr.bool,null),Xt.vec4b=new Xt("vec4",Cr.bool,null),Xt.mat2x2f=new Xt("mat2x2",Cr.f32,null),Xt.mat2x3f=new Xt("mat2x3",Cr.f32,null),Xt.mat2x4f=new Xt("mat2x4",Cr.f32,null),Xt.mat3x2f=new Xt("mat3x2",Cr.f32,null),Xt.mat3x3f=new Xt("mat3x3",Cr.f32,null),Xt.mat3x4f=new Xt("mat3x4",Cr.f32,null),Xt.mat4x2f=new Xt("mat4x2",Cr.f32,null),Xt.mat4x3f=new Xt("mat4x3",Cr.f32,null),Xt.mat4x4f=new Xt("mat4x4",Cr.f32,null),Xt.mat2x2h=new Xt("mat2x2",Cr.f16,null),Xt.mat2x3h=new Xt("mat2x3",Cr.f16,null),Xt.mat2x4h=new Xt("mat2x4",Cr.f16,null),Xt.mat3x2h=new Xt("mat3x2",Cr.f16,null),Xt.mat3x3h=new Xt("mat3x3",Cr.f16,null),Xt.mat3x4h=new Xt("mat3x4",Cr.f16,null),Xt.mat4x2h=new Xt("mat4x2",Cr.f16,null),Xt.mat4x3h=new Xt("mat4x3",Cr.f16,null),Xt.mat4x4h=new Xt("mat4x4",Cr.f16,null);class eG extends Cr{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}let S5=class extends Cr{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}},Pg=class extends Cr{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}};class Pc extends Xl{constructor(){super(),this.postfix=null}}let Ef=class extends Pc{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}},Sf=class extends Pc{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}},cy=class $7 extends Pc{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return $7.builtinFunctionNames.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}};cy.builtinFunctionNames=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);let bA=class extends Pc{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}},I5=class extends Pc{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getDataValue(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}},gs=class extends Pc{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Pt}get isVector(){return this.value instanceof Ve||this.value instanceof ui}get scalarValue(){return this.value instanceof Pt?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Ve||this.value instanceof ui?this.value.value:(console.error("Value is not a vector or matrix."),[])}},M5=class extends Pc{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}},uy=class extends Pc{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}constEvaluate(e,t){return this.contents[0].constEvaluate(e,t)}search(e){this.searchBlock(this.contents,e)}},zd=class extends Pc{constructor(e){super(),this.index=e}search(e){this.index.search(e)}},P5=class extends Pc{constructor(){super()}},bl=class extends P5{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}},Fc=class extends P5{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Cr.f32:e.name==="u32"||t.name==="u32"?Cr.u32:Cr.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}},F5=class extends Xl{constructor(e){super(),this.body=e}},hy=class extends Pc{constructor(){super()}get astNodeType(){return"default"}},R5=class extends F5{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}},L5=class extends F5{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}},tG=class extends Xl{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}},rG=class extends Xl{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},nG=class extends Xl{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}},iG=class extends Xl{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}},If=class{constructor(e){this.typeInfo=e}setDataValue(e,t,n,i){console.error("SetDataValue: Not implemented",t,n)}getDataValue(e,t,n){return console.error("GetDataValue: Not implemented",t),null}toString(){return`<${this.typeInfo.name}>`}},hw=class extends If{constructor(){super(new Mc("void",null))}toString(){return"void"}};hw.void=new hw;let Pt=class G7 extends If{constructor(e,t){super(t),this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?e=Math.floor(e):this.typeInfo.name==="bool"&&(e=e?1:0),this.value=e}setDataValue(e,t,n,i){n?console.error("SetDataValue: Scalar data does not support postfix",n):t instanceof G7?(t.value,this.typeInfo.name==="i32"||this.typeInfo.name==="u32"||this.typeInfo.name,this.value=t.value):console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,n){return t?(console.error("GetDataValue: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}};function O5(r,e,t){const n=e.length;return n===2?t==="f32"?new Ve(e,r.getTypeInfo("vec2f")):t==="i32"?new Ve(e,r.getTypeInfo("vec2i")):t==="u32"?new Ve(e,r.getTypeInfo("vec2u")):t==="f16"?new Ve(e,r.getTypeInfo("vec2h")):(console.error(`GetDataValue: Unknown format ${t}`),null):n===3?t==="f32"?new Ve(e,r.getTypeInfo("vec3f")):t==="i32"?new Ve(e,r.getTypeInfo("vec3i")):t==="u32"?new Ve(e,r.getTypeInfo("vec3u")):t==="f16"?new Ve(e,r.getTypeInfo("vec3h")):(console.error(`GetDataValue: Unknown format ${t}`),null):n===4?t==="f32"?new Ve(e,r.getTypeInfo("vec4f")):t==="i32"?new Ve(e,r.getTypeInfo("vec4i")):t==="u32"?new Ve(e,r.getTypeInfo("vec4u")):t==="f16"?new Ve(e,r.getTypeInfo("vec4h")):(console.error(`GetDataValue: Unknown format ${t}`),null):(console.error(`GetDataValue: Invalid vector size ${e.length}`),null)}let Ve=class q7 extends If{constructor(e,t){super(t),Array.isArray(e)?this.value=e:this.value=Array.from(e)}setDataValue(e,t,n,i){n instanceof Ef?console.error("TODO: Set vector postfix"):t instanceof q7?this.value=t.value:console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,n){let i=e.getTypeInfo("f32");if(this.typeInfo instanceof gA)i=this.typeInfo.format;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?i=e.getTypeInfo("f32"):s==="vec2i"||s==="vec3i"||s==="vec4i"?i=e.getTypeInfo("i32"):s==="vec2u"||s==="vec3u"||s==="vec4u"?i=e.getTypeInfo("u32"):s==="vec2h"||s==="vec3h"||s==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetDataValue: Unknown type ${s}`)}if(t instanceof zd){const s=t.index;let a=-1;if(s instanceof gs){if(!(s.value instanceof Pt))return console.error(`GetValueData: Invalid array index ${s.value}`),null;a=s.value.value}else{const o=e.evalExpression(s,n);if(!(o instanceof Pt))return console.error("GetDataValue: Unknown index type",s),null;a=o.value}return a<0||a>=this.value.length?(console.error("GetDataValue: Index out of range",a),null):new Pt(this.value[a],i)}if(t instanceof Ef){const s=t.value,a=[];for(const o of s)o==="x"||o==="r"?a.push(this.value[0]):o==="y"||o==="g"?a.push(this.value[1]):o==="z"||o==="b"?a.push(this.value[2]):o==="w"||o==="a"?a.push(this.value[3]):console.error(`GetDataValue: Unknown member ${o}`);return a.length===1?new Pt(a[0],i):O5(e,a,i.name)}return this}toString(){let e=`${this.value[0]}`;for(let t=1;t<this.value.length;++t)e+=`, ${this.value[t]}`;return e}},ui=class K7 extends If{constructor(e,t){super(t),this.value=e}setDataValue(e,t,n,i){n instanceof Ef?console.error("TODO: Set matrix postfix"):t instanceof K7?this.value=t.value:console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,n){const i=this.typeInfo.name;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof gA)s=this.typeInfo.format;else if(i.endsWith("f"))s=e.getTypeInfo("f32");else if(i.endsWith("i"))s=e.getTypeInfo("i32");else if(i.endsWith("u"))s=e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;s=e.getTypeInfo("f16")}if(t instanceof zd){const a=t.index;let o,u=-1;if(a instanceof gs){if(!(a.value instanceof Pt))return console.error(`GetDataValue: Invalid array index ${a.value}`),null;u=a.value.value}else{const p=e.evalExpression(a,n);if(!(p instanceof Pt))return console.error("GetDataValue: Unknown index type",a),null;u=p.value}if(u<0||u>=this.value.length)return console.error("GetDataValue: Index out of range",u),null;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h")o=this.value.slice(2*u,2*u+2);else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h")o=this.value.slice(3*u,3*u+3);else if(i==="mat2x4"||i==="mat2x4f"||i==="mat2x4h")o=this.value.slice(4*u,4*u+4);else if(i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h")o=this.value.slice(2*u,2*u+2);else if(i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h")o=this.value.slice(3*u,3*u+3);else if(i==="mat3x4"||i==="mat3x4f"||i==="mat3x4h")o=this.value.slice(4*u,4*u+4);else if(i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")o=this.value.slice(2*u,2*u+2);else if(i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")o=this.value.slice(3*u,3*u+3);else{if(i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;o=this.value.slice(4*u,4*u+4)}const d=O5(e,o,s.name);if(t.postfix)return d.getDataValue(e,t.postfix,n)}return this}toString(){let e=`${this.value[0]}`;for(let t=1;t<this.value.length;++t)e+=`, ${this.value[t]}`;return e}},go=class MS extends If{constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;super(t),this.textureSize=[0,0,0],this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n,i!==void 0&&(this.textureSize=i)}setDataValue(e,t,n,i){if(t===null)return void console.log("setDataValue: NULL data.");let s=this.offset,a=this.typeInfo;for(;n;){if(n instanceof zd)if(a instanceof Tf){const o=n.index;if(o instanceof gs){if(!(o.value instanceof Pt))return void console.error(`SetDataValue: Invalid index type ${o.value}`);s+=o.value.value*a.stride}else{const u=e.evalExpression(o,i);if(!(u instanceof Pt))return void console.error("SetDataValue: Unknown index type",o);s+=u.value*a.stride}a=a.format}else console.error(`SetDataValue: Type ${e.getTypeName(a)} is not an array`);else{if(!(n instanceof Ef))return void console.error("SetDataValue: Unknown postfix type",n);{const o=n.value;if(a instanceof pA){let u=!1;for(const d of a.members)if(d.name===o){s+=d.offset,a=d.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${o} not found`)}else if(a instanceof Mc){const u=e.getTypeName(a);let d=0;if(o==="x"||o==="r")d=0;else if(o==="y"||o==="g")d=1;else if(o==="z"||o==="b")d=2;else{if(o!=="w"&&o!=="a")return void console.error(`SetDataValue: Unknown member ${o}`);d=3}if(!(t instanceof Pt))return void console.error("SetDataValue: Invalid value",t);const p=t.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[d]=p):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[d]=p):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[d]=p):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[d]=p):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[d]=p):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[d]=p):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[d]=p):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[d]=p):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[d]=p):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}n=n.postfix}this.setData(e,t,a,s,i)}setData(e,t,n,i,s){const a=e.getTypeName(n);if(a!=="f32"&&a!=="f16")if(a!=="i32"&&a!=="atomic<i32>"&&a!=="x32")if(a!=="u32"&&a!=="atomic<u32>")if(a!=="bool")if(a!=="vec2f"&&a!=="vec2h")if(a!=="vec3f"&&a!=="vec3h")if(a!=="vec4f"&&a!=="vec4h")if(a!=="vec2i")if(a!=="vec3i")if(a!=="vec4i")if(a!=="vec2u")if(a!=="vec3u")if(a!=="vec4u")if(a!=="vec2b")if(a!=="vec3b")if(a!=="vec4b")if(a!=="mat2x2f"&&a!=="mat2x2h")if(a!=="mat2x3f"&&a!=="mat2x3h")if(a!=="mat2x4f"&&a!=="mat2x4h")if(a!=="mat3x2f"&&a!=="mat3x2h")if(a!=="mat3x3f"&&a!=="mat3x3h")if(a!=="mat3x4f"&&a!=="mat3x4h")if(a!=="mat4x2f"&&a!=="mat4x2h")if(a!=="mat4x3f"&&a!=="mat4x3h")if(a!=="mat4x4f"&&a!=="mat4x4h")if(t instanceof MS){if(n===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",a,e.getTypeName(t.typeInfo))}else console.error(`SetData: Unknown type ${a}`);else{const o=new Float32Array(this.buffer,i,16);t instanceof ui?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7],o[8]=t.value[8],o[9]=t.value[9],o[10]=t.value[10],o[11]=t.value[11],o[12]=t.value[12],o[13]=t.value[13],o[14]=t.value[14],o[15]=t.value[15]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15])}else{const o=new Float32Array(this.buffer,i,12);t instanceof ui?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7],o[8]=t.value[8],o[9]=t.value[9],o[10]=t.value[10],o[11]=t.value[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11])}else{const o=new Float32Array(this.buffer,i,8);t instanceof ui?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7])}else{const o=new Float32Array(this.buffer,i,12);t instanceof ui?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7],o[8]=t.value[8],o[9]=t.value[9],o[10]=t.value[10],o[11]=t.value[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11])}else{const o=new Float32Array(this.buffer,i,9);t instanceof ui?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7],o[8]=t.value[8]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8])}else{const o=new Float32Array(this.buffer,i,6);t instanceof ui?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5])}else{const o=new Float32Array(this.buffer,i,8);t instanceof ui?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5],o[6]=t.value[6],o[7]=t.value[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7])}else{const o=new Float32Array(this.buffer,i,6);t instanceof ui?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3],o[4]=t.value[4],o[5]=t.value[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5])}else{const o=new Float32Array(this.buffer,i,4);t instanceof ui?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Uint32Array(this.buffer,i,4);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Uint32Array(this.buffer,i,3);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Uint32Array(this.buffer,i,2);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1]):(o[0]=t[0],o[1]=t[1])}else{const o=new Uint32Array(this.buffer,i,4);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Uint32Array(this.buffer,i,3);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Uint32Array(this.buffer,i,2);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1]):(o[0]=t[0],o[1]=t[1])}else{const o=new Int32Array(this.buffer,i,4);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Int32Array(this.buffer,i,3);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Int32Array(this.buffer,i,2);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1]):(o[0]=t[0],o[1]=t[1])}else{const o=new Float32Array(this.buffer,i,4);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2],o[3]=t.value[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Float32Array(this.buffer,i,3);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1],o[2]=t.value[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Float32Array(this.buffer,i,2);t instanceof Ve?(o[0]=t.value[0],o[1]=t.value[1]):(o[0]=t[0],o[1]=t[1])}else t instanceof Pt&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Pt&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof Pt&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Pt&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getDataValue(e,t,n){let i=this.offset,s=this.typeInfo;for(;t;){if(t instanceof zd){const o=t.index,u=e.evalExpression(o,n);let d=0;if(u instanceof Pt?d=u.value:console.error("GetDataValue: Invalid index type",o),s instanceof Tf)i+=d*s.stride,s=s.format;else{const p=e.getTypeName(s);p==="mat4x4"||p==="mat4x4f"||p==="mat4x4h"?(i+=16*d,s=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${e.getTypeName(s)} is not an array`)}}else{if(!(t instanceof Ef))return console.error("GetDataValue: Unknown postfix type",t),null;{const o=t.value;if(s instanceof pA){let u=!1;for(const d of s.members)if(d.name===o){i+=d.offset,s=d.type,u=!0;break}if(!u)return console.error(`GetDataValue: Member ${o} not found`),null}else if(s instanceof Mc){const u=e.getTypeName(s);if(u==="vec2f"||u==="vec3f"||u==="vec4f"||u==="vec2i"||u==="vec3i"||u==="vec4i"||u==="vec2u"||u==="vec3u"||u==="vec4u"||u==="vec2b"||u==="vec3b"||u==="vec4b"||u==="vec2h"||u==="vec3h"||u==="vec4h"||u==="vec2"||u==="vec3"||u==="vec4"){if(o.length>0&&o.length<5){let d="f32",p="f";const _=[];for(let w=0;w<o.length;++w){const v=o[w].toLocaleLowerCase();let M=0;if(v==="x"||v==="r")M=0;else if(v==="y"||v==="g")M=1;else if(v==="z"||v==="b")M=2;else{if(v!=="w"&&v!=="a")return console.error(`Unknown member ${o}`),null;M=3}if(u==="vec2f")_.push(new Float32Array(this.buffer,i,2)[M]);else if(u==="vec3f"){if(i+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const P=new Float32Array(this.buffer,i,3);_.push(P[M])}else if(u==="vec4f")_.push(new Float32Array(this.buffer,i,4)[M]);else if(u==="vec2i")d="i32",p="i",_.push(new Int32Array(this.buffer,i,2)[M]);else if(u==="vec3i")d="i32",p="i",_.push(new Int32Array(this.buffer,i,3)[M]);else if(u==="vec4i")d="i32",p="i",_.push(new Int32Array(this.buffer,i,4)[M]);else if(u==="vec2u"){d="u32",p="u";const P=new Uint32Array(this.buffer,i,2);_.push(P[M])}else u==="vec3u"?(d="u32",p="u",_.push(new Uint32Array(this.buffer,i,3)[M])):u==="vec4u"&&(d="u32",p="u",_.push(new Uint32Array(this.buffer,i,4)[M]))}return _.length===1?new Pt(_[0],e.getTypeInfo(d)):(_.length===2?s=e.getTypeInfo(`vec2${p}`):_.length===3?s=e.getTypeInfo(`vec3${p}`):_.length===4?s=e.getTypeInfo(`vec4${p}`):console.error(`GetDataValue: Invalid vector length ${_.length}`),new Ve(_,s))}return console.error(`GetDataValue: Unknown member ${o}`),null}return console.error(`GetDataValue: Type ${u} is not a struct`),null}}}t=t.postfix}const a=e.getTypeName(s);return a==="f32"?new Pt(new Float32Array(this.buffer,i,1)[0],s):a==="i32"?new Pt(new Int32Array(this.buffer,i,1)[0],s):a==="u32"?new Pt(new Uint32Array(this.buffer,i,1)[0],s):a==="vec2f"?new Ve(new Float32Array(this.buffer,i,2),s):a==="vec3f"?new Ve(new Float32Array(this.buffer,i,3),s):a==="vec4f"?new Ve(new Float32Array(this.buffer,i,4),s):a==="vec2i"?new Ve(new Int32Array(this.buffer,i,2),s):a==="vec3i"?new Ve(new Int32Array(this.buffer,i,3),s):a==="vec4i"?new Ve(new Int32Array(this.buffer,i,4),s):a==="vec2u"?new Ve(new Uint32Array(this.buffer,i,2),s):a==="vec3u"?new Ve(new Uint32Array(this.buffer,i,3),s):a==="vec4u"?new Ve(new Uint32Array(this.buffer,i,4),s):s instanceof gA&&s.name==="atomic"?s.format.name==="u32"?new Pt(new Uint32Array(this.buffer,i,1)[0],s.format):s.format.name==="i32"?new Pt(new Int32Array(this.buffer,i,1)[0],s.format):(console.error(`GetDataValue: Invalid atomic format ${s.format.name}`),null):new MS(this.buffer,s,i)}toString(){let e="";if(this.typeInfo instanceof Tf)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof pA?e+="{...}":e="[...]";return e}};(r=>{r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(mt||(mt={}));let yt=class{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}},Pe=class{};It=Pe,Pe.none=new yt("",mt.reserved,""),Pe.eof=new yt("EOF",mt.token,""),Pe.reserved={asm:new yt("asm",mt.reserved,"asm"),bf16:new yt("bf16",mt.reserved,"bf16"),do:new yt("do",mt.reserved,"do"),enum:new yt("enum",mt.reserved,"enum"),f16:new yt("f16",mt.reserved,"f16"),f64:new yt("f64",mt.reserved,"f64"),handle:new yt("handle",mt.reserved,"handle"),i8:new yt("i8",mt.reserved,"i8"),i16:new yt("i16",mt.reserved,"i16"),i64:new yt("i64",mt.reserved,"i64"),mat:new yt("mat",mt.reserved,"mat"),premerge:new yt("premerge",mt.reserved,"premerge"),regardless:new yt("regardless",mt.reserved,"regardless"),typedef:new yt("typedef",mt.reserved,"typedef"),u8:new yt("u8",mt.reserved,"u8"),u16:new yt("u16",mt.reserved,"u16"),u64:new yt("u64",mt.reserved,"u64"),unless:new yt("unless",mt.reserved,"unless"),using:new yt("using",mt.reserved,"using"),vec:new yt("vec",mt.reserved,"vec"),void:new yt("void",mt.reserved,"void")},Pe.keywords={array:new yt("array",mt.keyword,"array"),atomic:new yt("atomic",mt.keyword,"atomic"),bool:new yt("bool",mt.keyword,"bool"),f32:new yt("f32",mt.keyword,"f32"),i32:new yt("i32",mt.keyword,"i32"),mat2x2:new yt("mat2x2",mt.keyword,"mat2x2"),mat2x3:new yt("mat2x3",mt.keyword,"mat2x3"),mat2x4:new yt("mat2x4",mt.keyword,"mat2x4"),mat3x2:new yt("mat3x2",mt.keyword,"mat3x2"),mat3x3:new yt("mat3x3",mt.keyword,"mat3x3"),mat3x4:new yt("mat3x4",mt.keyword,"mat3x4"),mat4x2:new yt("mat4x2",mt.keyword,"mat4x2"),mat4x3:new yt("mat4x3",mt.keyword,"mat4x3"),mat4x4:new yt("mat4x4",mt.keyword,"mat4x4"),ptr:new yt("ptr",mt.keyword,"ptr"),sampler:new yt("sampler",mt.keyword,"sampler"),sampler_comparison:new yt("sampler_comparison",mt.keyword,"sampler_comparison"),struct:new yt("struct",mt.keyword,"struct"),texture_1d:new yt("texture_1d",mt.keyword,"texture_1d"),texture_2d:new yt("texture_2d",mt.keyword,"texture_2d"),texture_2d_array:new yt("texture_2d_array",mt.keyword,"texture_2d_array"),texture_3d:new yt("texture_3d",mt.keyword,"texture_3d"),texture_cube:new yt("texture_cube",mt.keyword,"texture_cube"),texture_cube_array:new yt("texture_cube_array",mt.keyword,"texture_cube_array"),texture_multisampled_2d:new yt("texture_multisampled_2d",mt.keyword,"texture_multisampled_2d"),texture_storage_1d:new yt("texture_storage_1d",mt.keyword,"texture_storage_1d"),texture_storage_2d:new yt("texture_storage_2d",mt.keyword,"texture_storage_2d"),texture_storage_2d_array:new yt("texture_storage_2d_array",mt.keyword,"texture_storage_2d_array"),texture_storage_3d:new yt("texture_storage_3d",mt.keyword,"texture_storage_3d"),texture_depth_2d:new yt("texture_depth_2d",mt.keyword,"texture_depth_2d"),texture_depth_2d_array:new yt("texture_depth_2d_array",mt.keyword,"texture_depth_2d_array"),texture_depth_cube:new yt("texture_depth_cube",mt.keyword,"texture_depth_cube"),texture_depth_cube_array:new yt("texture_depth_cube_array",mt.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new yt("texture_depth_multisampled_2d",mt.keyword,"texture_depth_multisampled_2d"),texture_external:new yt("texture_external",mt.keyword,"texture_external"),u32:new yt("u32",mt.keyword,"u32"),vec2:new yt("vec2",mt.keyword,"vec2"),vec3:new yt("vec3",mt.keyword,"vec3"),vec4:new yt("vec4",mt.keyword,"vec4"),bitcast:new yt("bitcast",mt.keyword,"bitcast"),block:new yt("block",mt.keyword,"block"),break:new yt("break",mt.keyword,"break"),case:new yt("case",mt.keyword,"case"),continue:new yt("continue",mt.keyword,"continue"),continuing:new yt("continuing",mt.keyword,"continuing"),default:new yt("default",mt.keyword,"default"),diagnostic:new yt("diagnostic",mt.keyword,"diagnostic"),discard:new yt("discard",mt.keyword,"discard"),else:new yt("else",mt.keyword,"else"),enable:new yt("enable",mt.keyword,"enable"),fallthrough:new yt("fallthrough",mt.keyword,"fallthrough"),false:new yt("false",mt.keyword,"false"),fn:new yt("fn",mt.keyword,"fn"),for:new yt("for",mt.keyword,"for"),function:new yt("function",mt.keyword,"function"),if:new yt("if",mt.keyword,"if"),let:new yt("let",mt.keyword,"let"),const:new yt("const",mt.keyword,"const"),loop:new yt("loop",mt.keyword,"loop"),while:new yt("while",mt.keyword,"while"),private:new yt("private",mt.keyword,"private"),read:new yt("read",mt.keyword,"read"),read_write:new yt("read_write",mt.keyword,"read_write"),return:new yt("return",mt.keyword,"return"),requires:new yt("requires",mt.keyword,"requires"),storage:new yt("storage",mt.keyword,"storage"),switch:new yt("switch",mt.keyword,"switch"),true:new yt("true",mt.keyword,"true"),alias:new yt("alias",mt.keyword,"alias"),type:new yt("type",mt.keyword,"type"),uniform:new yt("uniform",mt.keyword,"uniform"),var:new yt("var",mt.keyword,"var"),override:new yt("override",mt.keyword,"override"),workgroup:new yt("workgroup",mt.keyword,"workgroup"),write:new yt("write",mt.keyword,"write"),r8unorm:new yt("r8unorm",mt.keyword,"r8unorm"),r8snorm:new yt("r8snorm",mt.keyword,"r8snorm"),r8uint:new yt("r8uint",mt.keyword,"r8uint"),r8sint:new yt("r8sint",mt.keyword,"r8sint"),r16uint:new yt("r16uint",mt.keyword,"r16uint"),r16sint:new yt("r16sint",mt.keyword,"r16sint"),r16float:new yt("r16float",mt.keyword,"r16float"),rg8unorm:new yt("rg8unorm",mt.keyword,"rg8unorm"),rg8snorm:new yt("rg8snorm",mt.keyword,"rg8snorm"),rg8uint:new yt("rg8uint",mt.keyword,"rg8uint"),rg8sint:new yt("rg8sint",mt.keyword,"rg8sint"),r32uint:new yt("r32uint",mt.keyword,"r32uint"),r32sint:new yt("r32sint",mt.keyword,"r32sint"),r32float:new yt("r32float",mt.keyword,"r32float"),rg16uint:new yt("rg16uint",mt.keyword,"rg16uint"),rg16sint:new yt("rg16sint",mt.keyword,"rg16sint"),rg16float:new yt("rg16float",mt.keyword,"rg16float"),rgba8unorm:new yt("rgba8unorm",mt.keyword,"rgba8unorm"),rgba8unorm_srgb:new yt("rgba8unorm_srgb",mt.keyword,"rgba8unorm_srgb"),rgba8snorm:new yt("rgba8snorm",mt.keyword,"rgba8snorm"),rgba8uint:new yt("rgba8uint",mt.keyword,"rgba8uint"),rgba8sint:new yt("rgba8sint",mt.keyword,"rgba8sint"),bgra8unorm:new yt("bgra8unorm",mt.keyword,"bgra8unorm"),bgra8unorm_srgb:new yt("bgra8unorm_srgb",mt.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new yt("rgb10a2unorm",mt.keyword,"rgb10a2unorm"),rg11b10float:new yt("rg11b10float",mt.keyword,"rg11b10float"),rg32uint:new yt("rg32uint",mt.keyword,"rg32uint"),rg32sint:new yt("rg32sint",mt.keyword,"rg32sint"),rg32float:new yt("rg32float",mt.keyword,"rg32float"),rgba16uint:new yt("rgba16uint",mt.keyword,"rgba16uint"),rgba16sint:new yt("rgba16sint",mt.keyword,"rgba16sint"),rgba16float:new yt("rgba16float",mt.keyword,"rgba16float"),rgba32uint:new yt("rgba32uint",mt.keyword,"rgba32uint"),rgba32sint:new yt("rgba32sint",mt.keyword,"rgba32sint"),rgba32float:new yt("rgba32float",mt.keyword,"rgba32float"),static_assert:new yt("static_assert",mt.keyword,"static_assert")},Pe.tokens={decimal_float_literal:new yt("decimal_float_literal",mt.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new yt("hex_float_literal",mt.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new yt("int_literal",mt.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new yt("uint_literal",mt.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new yt("name",mt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),ident:new yt("ident",mt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new yt("and",mt.token,"&"),and_and:new yt("and_and",mt.token,"&&"),arrow:new yt("arrow ",mt.token,"->"),attr:new yt("attr",mt.token,"@"),forward_slash:new yt("forward_slash",mt.token,"/"),bang:new yt("bang",mt.token,"!"),bracket_left:new yt("bracket_left",mt.token,"["),bracket_right:new yt("bracket_right",mt.token,"]"),brace_left:new yt("brace_left",mt.token,"{"),brace_right:new yt("brace_right",mt.token,"}"),colon:new yt("colon",mt.token,":"),comma:new yt("comma",mt.token,","),equal:new yt("equal",mt.token,"="),equal_equal:new yt("equal_equal",mt.token,"=="),not_equal:new yt("not_equal",mt.token,"!="),greater_than:new yt("greater_than",mt.token,">"),greater_than_equal:new yt("greater_than_equal",mt.token,">="),shift_right:new yt("shift_right",mt.token,">>"),less_than:new yt("less_than",mt.token,"<"),less_than_equal:new yt("less_than_equal",mt.token,"<="),shift_left:new yt("shift_left",mt.token,"<<"),modulo:new yt("modulo",mt.token,"%"),minus:new yt("minus",mt.token,"-"),minus_minus:new yt("minus_minus",mt.token,"--"),period:new yt("period",mt.token,"."),plus:new yt("plus",mt.token,"+"),plus_plus:new yt("plus_plus",mt.token,"++"),or:new yt("or",mt.token,"|"),or_or:new yt("or_or",mt.token,"||"),paren_left:new yt("paren_left",mt.token,"("),paren_right:new yt("paren_right",mt.token,")"),semicolon:new yt("semicolon",mt.token,";"),star:new yt("star",mt.token,"*"),tilde:new yt("tilde",mt.token,"~"),underscore:new yt("underscore",mt.token,"_"),xor:new yt("xor",mt.token,"^"),plus_equal:new yt("plus_equal",mt.token,"+="),minus_equal:new yt("minus_equal",mt.token,"-="),times_equal:new yt("times_equal",mt.token,"*="),division_equal:new yt("division_equal",mt.token,"/="),modulo_equal:new yt("modulo_equal",mt.token,"%="),and_equal:new yt("and_equal",mt.token,"&="),or_equal:new yt("or_equal",mt.token,"|="),xor_equal:new yt("xor_equal",mt.token,"^="),shift_right_equal:new yt("shift_right_equal",mt.token,">>="),shift_left_equal:new yt("shift_left_equal",mt.token,"<<=")},Pe.simpleTokens={"@":It.tokens.attr,"{":It.tokens.brace_left,"}":It.tokens.brace_right,":":It.tokens.colon,",":It.tokens.comma,"(":It.tokens.paren_left,")":It.tokens.paren_right,";":It.tokens.semicolon},Pe.literalTokens={"&":It.tokens.and,"&&":It.tokens.and_and,"->":It.tokens.arrow,"/":It.tokens.forward_slash,"!":It.tokens.bang,"[":It.tokens.bracket_left,"]":It.tokens.bracket_right,"=":It.tokens.equal,"==":It.tokens.equal_equal,"!=":It.tokens.not_equal,">":It.tokens.greater_than,">=":It.tokens.greater_than_equal,">>":It.tokens.shift_right,"<":It.tokens.less_than,"<=":It.tokens.less_than_equal,"<<":It.tokens.shift_left,"%":It.tokens.modulo,"-":It.tokens.minus,"--":It.tokens.minus_minus,".":It.tokens.period,"+":It.tokens.plus,"++":It.tokens.plus_plus,"|":It.tokens.or,"||":It.tokens.or_or,"*":It.tokens.star,"~":It.tokens.tilde,_:It.tokens.underscore,"^":It.tokens.xor,"+=":It.tokens.plus_equal,"-=":It.tokens.minus_equal,"*=":It.tokens.times_equal,"/=":It.tokens.division_equal,"%=":It.tokens.modulo_equal,"&=":It.tokens.and_equal,"|=":It.tokens.or_equal,"^=":It.tokens.xor_equal,">>=":It.tokens.shift_right_equal,"<<=":It.tokens.shift_left_equal},Pe.regexTokens={decimal_float_literal:It.tokens.decimal_float_literal,hex_float_literal:It.tokens.hex_float_literal,int_literal:It.tokens.int_literal,uint_literal:It.tokens.uint_literal,ident:It.tokens.ident},Pe.storage_class=[It.keywords.function,It.keywords.private,It.keywords.workgroup,It.keywords.uniform,It.keywords.storage],Pe.access_mode=[It.keywords.read,It.keywords.write,It.keywords.read_write],Pe.sampler_type=[It.keywords.sampler,It.keywords.sampler_comparison],Pe.sampled_texture_type=[It.keywords.texture_1d,It.keywords.texture_2d,It.keywords.texture_2d_array,It.keywords.texture_3d,It.keywords.texture_cube,It.keywords.texture_cube_array],Pe.multisampled_texture_type=[It.keywords.texture_multisampled_2d],Pe.storage_texture_type=[It.keywords.texture_storage_1d,It.keywords.texture_storage_2d,It.keywords.texture_storage_2d_array,It.keywords.texture_storage_3d],Pe.depth_texture_type=[It.keywords.texture_depth_2d,It.keywords.texture_depth_2d_array,It.keywords.texture_depth_cube,It.keywords.texture_depth_cube_array,It.keywords.texture_depth_multisampled_2d],Pe.texture_external_type=[It.keywords.texture_external],Pe.any_texture_type=[...It.sampled_texture_type,...It.multisampled_texture_type,...It.storage_texture_type,...It.depth_texture_type,...It.texture_external_type],Pe.texel_format=[It.keywords.r8unorm,It.keywords.r8snorm,It.keywords.r8uint,It.keywords.r8sint,It.keywords.r16uint,It.keywords.r16sint,It.keywords.r16float,It.keywords.rg8unorm,It.keywords.rg8snorm,It.keywords.rg8uint,It.keywords.rg8sint,It.keywords.r32uint,It.keywords.r32sint,It.keywords.r32float,It.keywords.rg16uint,It.keywords.rg16sint,It.keywords.rg16float,It.keywords.rgba8unorm,It.keywords.rgba8unorm_srgb,It.keywords.rgba8snorm,It.keywords.rgba8uint,It.keywords.rgba8sint,It.keywords.bgra8unorm,It.keywords.bgra8unorm_srgb,It.keywords.rgb10a2unorm,It.keywords.rg11b10float,It.keywords.rg32uint,It.keywords.rg32sint,It.keywords.rg32float,It.keywords.rgba16uint,It.keywords.rgba16sint,It.keywords.rgba16float,It.keywords.rgba32uint,It.keywords.rgba32sint,It.keywords.rgba32float],Pe.const_literal=[It.tokens.int_literal,It.tokens.uint_literal,It.tokens.decimal_float_literal,It.tokens.hex_float_literal,It.keywords.true,It.keywords.false],Pe.literal_or_ident=[It.tokens.ident,It.tokens.int_literal,It.tokens.uint_literal,It.tokens.decimal_float_literal,It.tokens.hex_float_literal,It.tokens.name],Pe.element_count_expression=[It.tokens.int_literal,It.tokens.uint_literal,It.tokens.ident],Pe.template_types=[It.keywords.vec2,It.keywords.vec3,It.keywords.vec4,It.keywords.mat2x2,It.keywords.mat2x3,It.keywords.mat2x4,It.keywords.mat3x2,It.keywords.mat3x3,It.keywords.mat3x4,It.keywords.mat4x2,It.keywords.mat4x3,It.keywords.mat4x4,It.keywords.atomic,It.keywords.bitcast,...It.any_texture_type],Pe.attribute_name=[It.tokens.ident,It.keywords.block,It.keywords.diagnostic],Pe.assignment_operators=[It.tokens.equal,It.tokens.plus_equal,It.tokens.minus_equal,It.tokens.times_equal,It.tokens.division_equal,It.tokens.modulo_equal,It.tokens.and_equal,It.tokens.or_equal,It.tokens.xor_equal,It.tokens.shift_right_equal,It.tokens.shift_left_equal],Pe.increment_operators=[It.tokens.plus_plus,It.tokens.minus_minus];let U5=class{constructor(e,t,n){this.type=e,this.lexeme=t,this.line=n}toString(){return this.lexeme}isTemplateType(){return Pe.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Pe.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},sG=class{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new U5(Pe.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let a=1;for(;a>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),a--,a==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),a++)}return!0}}const t=Pe.simpleTokens[e];if(t)return this._addToken(t),!0;let n=Pe.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let a=this._peekAhead();for(;this._isAlphaNumeric(a);)e+=this._advance(),a=this._peekAhead()}if(i){const a=Pe.keywords[e];if(a)return this._addToken(a),!0}if(i||s)return this._addToken(Pe.tokens.ident),!0;for(;;){let a=this._findType(e);const o=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(o=="=")return this._current++,e+=o,this._addToken(Pe.tokens.minus_equal),!0;if(o=="-")return this._current++,e+=o,this._addToken(Pe.tokens.minus_minus),!0;const u=this._tokens.length-1;if((Pe.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==Pe.tokens.paren_right)&&o!=">")return this._addToken(a),!0}if(e==">"&&(o==">"||o=="=")){let u=!1,d=this._tokens.length-1;for(let p=0;p<5&&d>=0&&Pe.assignment_operators.indexOf(this._tokens[d].type)===-1;++p,--d)if(this._tokens[d].type===Pe.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(a),!0}if(a===Pe.none){let u=e,d=0;const p=2;for(let _=0;_<p;++_)if(u+=this._peekAhead(_),a=this._findType(u),a!==Pe.none){d=_;break}if(a===Pe.none)return n!==Pe.none&&(this._current--,this._addToken(n),!0);e=u,this._current+=d+1}if(n=a,this._isAtEnd())break;e+=this._advance()}return n!==Pe.none&&(this._addToken(n),!0)}_findType(e){for(const n in Pe.regexTokens){const i=Pe.regexTokens[n];if(this._match(e,i.rule))return i}return Pe.literalTokens[e]||Pe.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new U5(e,t,this._line))}},oG=class{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}},Ay=class{constructor(e,t){this.align=e,this.size=t}},Fg=class E_{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new K$,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof ay&&this._functions.set(t.name,new oG(t));for(const t of e)if(t instanceof yA){const n=this.getTypeInfo(t,null);n instanceof pA&&this.structs.push(n)}for(const t of e)if(t instanceof uw)this.aliases.push(this._getAliasInfo(t));else if(t instanceof aw){const n=t,i=this._getAttributeNum(n.attributes,"id",0),s=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new $$(n.name,s,n.attributes,i))}else if(this._isUniformVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=new iy(n.name,a,i,s,n.attributes,mA.Uniform,n.access);this.uniforms.push(o)}else if(this._isStorageVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=this._isStorageTexture(a),u=new iy(n.name,a,i,s,n.attributes,o?mA.StorageTexture:mA.Storage,n.access);this.storage.push(u)}else if(this._isTextureVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=this._isStorageTexture(a),u=new iy(n.name,a,i,s,n.attributes,o?mA.StorageTexture:mA.Texture,n.access);o?this.storage.push(u):this.textures.push(u)}else if(this._isSamplerVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=new iy(n.name,a,i,s,n.attributes,mA.Sampler,n.access);this.samplers.push(o)}else if(t instanceof ay){const n=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),s=this._getAttribute(t,"compute"),a=n||i||s,o=new q$(t.name,a==null?void 0:a.name,t.attributes);o.attributes=t.attributes,o.startLine=t.startLine,o.endLine=t.endLine,this.functions.push(o),this._functions.get(t.name).info=o,a&&(this._functions.get(t.name).inUse=!0,o.inUse=!0,o.resources=this._findResources(t,!!a),o.inputs=this._getInputs(t.args),o.outputs=this._getOutputs(t.returnType),this.entry[a.name].push(o)),o.arguments=t.args.map(u=>new G$(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),o.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(n=>{var i;if(n.astNodeType==="varExpr"){const s=n;for(const a of this.overrides)s.name==a.name&&((i=t.info)===null||i===void 0||i.overrides.push(a))}});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const s=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;s&&t.add(s)}}findResource(e,t){for(const n of this.uniforms)if(n.group==e&&n.binding==t)return n;for(const n of this.storage)if(n.group==e&&n.binding==t)return n;for(const n of this.textures)if(n.group==e&&n.binding==t)return n;for(const n of this.samplers)if(n.group==e&&n.binding==t)return n;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,s=[];return e.search(a=>{if(a instanceof sy)s.push({});else if(a instanceof oy)s.pop();else if(a instanceof _A){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type),s.length>0&&(s[s.length-1][o.name]=o)}else if(a instanceof Sf){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type)}else if(a instanceof ly){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type),s.length>0&&(s[s.length-1][o.name]=o)}else if(a instanceof bA){const o=a;if(s.length>0&&s[s.length-1][o.name])return;const u=i._findResource(o.name);u&&n.push(u)}else if(a instanceof cy){const o=a,u=i._functions.get(o.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),n.push(...u.resources))}else if(a instanceof cw){const o=a,u=i._functions.get(o.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),n.push(...u.resources))}}),[...new Map(n.map(a=>[a.name,a])).values()]}getBindGroups(){const e=[];function t(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;if(t===void 0&&(t=[]),e instanceof yA)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof yA)this._getStructOutputs(n.type,t);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const s=this.getTypeInfo(n.type,n.type.attributes),a=this._parseInt(i.value),o=new g5(n.name,s,i.name,a);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new g5("",n,t.name,i)}return null}_getInputs(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;t===void 0&&(t=[]);for(const n of e)if(n.type instanceof yA)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof yA)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),a=new j$(e.name,i,t.name,s);return n!==null&&(a.interpolation=this._parseString(n.value)),a}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new V$(e.name,this.getTypeInfo(e.type,null))}getTypeInfo(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this._types.has(e))return this._types.get(e);if(e instanceof S5){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,a=new Tf(i.name,t);return a.format=s,a.count=i.count,this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof yA){const i=e,s=new pA(i.name,t);s.startLine=i.startLine,s.endLine=i.endLine;for(const a of i.members){const o=this.getTypeInfo(a.type,a.attributes);s.members.push(new p5(a.name,o,a.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Pg){const i=e,s=i.format instanceof Cr,a=i.format?s?this.getTypeInfo(i.format,null):new Mc(i.format,null):null,o=new gA(i.name,a,t,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Xt){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,a=new gA(i.name,s,t,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}const n=new Mc(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,i;const s=this._getTypeSize(e);if(e.size=(t=s==null?void 0:s.size)!==null&&t!==void 0?t:0,e instanceof Tf&&e.format){const a=this._getTypeSize(e.format);e.stride=Math.max((n=a==null?void 0:a.size)!==null&&n!==void 0?n:0,(i=a==null?void 0:a.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof pA&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,s=0,a=0;for(let o=0,u=e.members.length;o<u;++o){const d=e.members[o],p=this._getTypeSize(d);if(!p)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const _=p.align,w=p.size;n=this._roundUp(_,n+i),i=w,s=n,a=Math.max(a,_),d.offset=n,d.size=w,this._updateTypeInfo(d.type)}e.size=this._roundUp(a,s+i),e.align=a}_getTypeSize(e){var t,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof p5&&(e=e.type),e instanceof Mc){const a=this._getAlias(e.name);a!==null&&(e=a)}{const a=E_._typeInfo[e.name];if(a!==void 0){const o=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Ay(Math.max(s,a.align/o),Math.max(i,a.size/o))}}{const a=E_._typeInfo[e.name.substring(0,e.name.length-1)];if(a){const o=e.name[e.name.length-1]==="h"?2:1;return new Ay(Math.max(s,a.align/o),Math.max(i,a.size/o))}}if(e instanceof Tf){let a=e,o=8,u=8;const d=this._getTypeSize(a.format);return d!==null&&(u=d.size,o=d.align),u=a.count*this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,u)),i&&(u=i),new Ay(Math.max(s,o),Math.max(i,u))}if(e instanceof pA){let a=0,o=0,u=0,d=0,p=0;for(const _ of e.members){const w=this._getTypeSize(_.type);w!==null&&(a=Math.max(w.align,a),u=this._roundUp(w.align,u+d),d=w.size,p=u)}return o=this._roundUp(a,p+d),new Ay(Math.max(s,a),Math.max(i,o))}return null}_isUniformVar(e){return e instanceof _A&&e.storage=="uniform"}_isStorageVar(e){return e instanceof _A&&e.storage=="storage"}_isTextureVar(e){return e instanceof _A&&e.type!==null&&E_._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof _A&&e.type!==null&&E_._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let s of i)if(s.name==t)return s;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let i of e)if(i.name==t){let s=i!==null&&i.value!==null?i.value:n;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}};Fg._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Fg._textureTypes=Pe.any_texture_type.map(r=>r.name),Fg._samplerTypes=Pe.sampler_type.map(r=>r.name);let aG=class W7{constructor(e,t,n){this.name=e,this.value=t,this.node=n}clone(){return new W7(this.name,this.value,this.node)}},lG=class X7{constructor(e){this.name=e.name,this.node=e}clone(){return new X7(this.node)}},cG=class Y7{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new aG(e,t,n??null))}setVariable(e,t,n){const i=this.getVariable(e);i!==null?i.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return(t=n==null?void 0:n.value)!==null&&t!==void 0?t:null}clone(){return new Y7(this)}},uG=class{evalExpression(e,t){return null}getTypeName(e){return""}getTypeInfo(e){return null}getVariableName(e,t){return""}},hG=class{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let i=!0;if(n instanceof Ve)return n.value.forEach(s=>{s||(i=!1)}),new Pt(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve){const i=n.value.some(s=>s);return new Pt(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof Pt))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.evalExpression(n,t);if(i instanceof go&&i.typeInfo.size===0){const s=i.typeInfo,a=i.buffer.byteLength/s.stride;return new Pt(a,this.getTypeInfo("u32"))}return new Pt(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.abs(s)),n.typeInfo);const i=n;return new Pt(Math.abs(i.value),i.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.acos(s)),n.typeInfo);const i=n;return new Pt(Math.acos(i.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.acosh(s)),n.typeInfo);const i=n;return new Pt(Math.acosh(i.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.asin(s)),n.typeInfo);const i=n;return new Pt(Math.asin(i.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.asinh(s)),n.typeInfo);const i=n;return new Pt(Math.asinh(i.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.atan(s)),n.typeInfo);const i=n;return new Pt(Math.atan(i.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.atanh(s)),n.typeInfo);const i=n;return new Pt(Math.atanh(i.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ve&&i instanceof Ve)return new Ve(n.value.map((o,u)=>Math.atan2(o,i.value[u])),n.typeInfo);const s=n,a=i;return new Pt(Math.atan2(s.value,a.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.ceil(s)),n.typeInfo);const i=n;return new Pt(Math.ceil(i.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Ve&&i instanceof Ve&&s instanceof Ve)return new Ve(n.value.map((d,p)=>this._clamp(d,i.value[p],s.value[p])),n.typeInfo);const a=n,o=i,u=s;return new Pt(this._clamp(a.value,o.value,u.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.cos(s)),n.typeInfo);const i=n;return new Pt(Math.cos(i.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.cosh(s)),n.typeInfo);const i=n;return new Pt(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.clz32(s)),n.typeInfo);const i=n;return new Pt(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>this._countOneBits(s)),n.typeInfo);const i=n;return new Pt(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>this._countTrailingZeros(s)),n.typeInfo);const i=n;return new Pt(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ve&&i instanceof Ve){if(n.value.length!==3||i.value.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=n.value,a=i.value;return new Ve([s[1]*a[2]-a[1]*s[2],s[2]*a[0]-a[2]*s[0],s[0]*a[1]-a[0]*s[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return n instanceof Ve?new Ve(n.value.map(s=>s*i),n.typeInfo):new Pt(n.value*i,n.typeInfo)}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ui){const i=n.value,s=this.exec.getTypeName(n.typeInfo),a=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new Pt(i[0]*i[3]-i[1]*i[2],a);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new Pt(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),a);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new Pt(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),a);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ve&&i instanceof Ve){let o=0;for(let u=0;u<n.value.length;++u)o+=(n.value[u]-i.value[u])*(n.value[u]-i.value[u]);return new Pt(Math.sqrt(o),this.getTypeInfo("f32"))}const s=n,a=i;return new Pt(Math.abs(s.value-a.value),n.typeInfo)}_dot(e,t){let n=0;for(let i=0;i<e.length;++i)n+=t[i]*e[i];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return n instanceof Ve&&i instanceof Ve?new Pt(this._dot(n.value,i.value),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.exp(s)),n.typeInfo);const i=n;return new Pt(Math.exp(i.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.pow(2,s)),n.typeInfo);const i=n;return new Pt(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const a=i.value,o=s.value;if(n instanceof Ve)return new Ve(n.value.map(d=>d>>a&(1<<o)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=n.value;return new Pt(u>>a&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Ve&&i instanceof Ve&&s instanceof Ve){const a=this._dot(i.value,s.value);return new Ve(a<0?n.value:n.value.map(o=>-o),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>this._firstLeadingBit(s)),n.typeInfo);const i=n;return new Pt(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>this._firstTrailingBit(s)),n.typeInfo);const i=n;return new Pt(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.floor(s)),n.typeInfo);const i=n;return new Pt(Math.floor(i.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Ve&&i instanceof Ve&&s instanceof Ve)return n.value.length!==i.value.length||n.value.length!==s.value.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Ve(n.value.map((d,p)=>d*i.value[p]+s.value[p]),n.typeInfo);const a=n,o=i,u=s;return new Pt(a.value*o.value+u.value,a.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>s-Math.floor(s)),n.typeInfo);const i=n;return new Pt(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),a=this.exec.evalExpression(e.args[3],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const o=s.value,u=(1<<a.value)-1<<o,d=~u;if(n instanceof Ve&&i instanceof Ve)return new Ve(n.value.map((w,v)=>w&d|i.value[v]<<o&u),n.typeInfo);const p=n.value,_=i.value;return new Pt(p&d|_<<o&u,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>1/Math.sqrt(s)),n.typeInfo);const i=n;return new Pt(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve){let s=0;return n.value.forEach(a=>{s+=a*a}),new Pt(Math.sqrt(s),this.getTypeInfo("f32"))}const i=n;return new Pt(Math.abs(i.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.log(s)),n.typeInfo);const i=n;return new Pt(Math.log(i.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.log2(s)),n.typeInfo);const i=n;return new Pt(Math.log2(i.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ve&&i instanceof Ve)return new Ve(n.value.map((o,u)=>Math.max(o,i.value[u])),n.typeInfo);const s=n,a=i;return new Pt(Math.max(s.value,a.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ve&&i instanceof Ve)return new Ve(n.value.map((o,u)=>Math.min(o,i.value[u])),n.typeInfo);const s=n,a=i;return new Pt(Math.min(s.value,a.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Ve&&i instanceof Ve&&s instanceof Ve)return new Ve(n.value.map((u,d)=>n.value[d]*(1-s.value[d])+i.value[d]*s.value[d]),n.typeInfo);const a=i,o=s;return new Pt(n.value*(1-o.value)+a.value*o.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ve&&i instanceof Ve)return new Ve(n.value.map((a,o)=>a%i.value[o]),n.typeInfo);const s=i;return new Pt(n.value%s.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve){const i=this.Length(e,t).value;return new Ve(n.value.map(s=>s/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ve&&i instanceof Ve)return new Ve(n.value.map((o,u)=>Math.pow(o,i.value[u])),n.typeInfo);const s=n,a=i;return new Pt(Math.pow(s.value,a.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Ve?new Ve(n.value.map(i=>i),n.typeInfo):new Pt(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Ve?new Ve(n.value.map(i=>i*Math.PI/180),n.typeInfo):new Pt(n.value*Math.PI/180,n.typeInfo)}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ve&&i instanceof Ve){const s=this._dot(n.value,i.value);return new Ve(n.value.map((a,o)=>a-2*s*i.value[o]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Ve&&i instanceof Ve&&s instanceof Pt){const a=this._dot(i.value,n.value);return new Ve(n.value.map((o,u)=>{const d=1-s.value*s.value*(1-a*a);if(d<0)return 0;const p=Math.sqrt(d);return s.value*o-(s.value*a+p)*i.value[u]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.round(s)),n.typeInfo);const i=n;return new Pt(Math.round(i.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.min(Math.max(s,0),1)),n.typeInfo);const i=n;return new Pt(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.sign(s)),n.typeInfo);const i=n;return new Pt(Math.sign(i.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.sin(s)),n.typeInfo);const i=n;return new Pt(Math.sin(i.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.sinh(s)),n.typeInfo);const i=n;return new Pt(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,t,n){const i=Math.min(Math.max((n-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof Ve&&n instanceof Ve&&i instanceof Ve)return new Ve(s.value.map((d,p)=>this._smoothstep(n.value[p],i.value[p],d)),s.typeInfo);const a=n,o=i,u=s;return new Pt(this._smoothstep(a.value,o.value,u.value),s.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.sqrt(s)),n.typeInfo);const i=n;return new Pt(Math.sqrt(i.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof Ve&&n instanceof Ve)return new Ve(i.value.map((a,o)=>a<n.value[o]?0:1),i.typeInfo);const s=n;return new Pt(i.value<s.value?0:1,s.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.tan(s)),n.typeInfo);const i=n;return new Pt(Math.tan(i.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.tanh(s)),n.typeInfo);const i=n;return new Pt(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const t=this.exec.getTypeName(e);return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof ui))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const s=n.value;return new ui([s[0],s[2],s[1],s[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const s=n.value;return new ui([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const s=n.value;return new ui([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const s=n.value;return new ui([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const s=n.value;return new ui([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const s=n.value;return new ui([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const s=n.value;return new ui([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const s=n.value;return new ui([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const s=n.value;return new ui([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ve)return new Ve(n.value.map(s=>Math.trunc(s)),n.typeInfo);const i=n;return new Pt(Math.trunc(i.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0];if((e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0)>0)return console.error(`TODO: Mip levels. Line ${e.line}`),null;if(n instanceof bA){const i=n.name,s=t.getVariableValue(i);return s instanceof go?new Ve(s.textureSize,this.getTypeInfo("vec2u")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t);if((e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0)>0)return console.error(`TODO: Mip levels. Line ${e.line}`),null;if(!(i instanceof Ve)||i.value.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof bA){const s=n.name,a=t.getVariableValue(s);if(a instanceof go){const o=a.textureSize,u=Math.floor(i.value[0]),d=Math.floor(i.value[1]);if(u<0||u>=o[0]||d<0||d>=o[1])return console.error(`Texture ${s} out of bounds. Line ${e.line}`),null;const p=4*(d*o[0]+u),_=new Uint8Array(a.buffer,p,4);return new Ve([_[0]/255,_[1]/255,_[2]/255,_[3]/255],this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){return console.error("TODO: textureNumLayers"),null}TextureNumLevels(e,t){return console.error("TODO: textureNumLevels"),null}TextureNumSamples(e,t){return console.error("TODO: textureNumSamples"),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t).value;if(s.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof Ve)||i.value.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof bA){const a=n.name,o=t.getVariableValue(a);if(o instanceof go){const u=o.textureSize,d=Math.floor(i.value[0]),p=Math.floor(i.value[1]);if(d<0||d>=u[0]||p<0||p>=u[1])return console.error(`Texture ${a} out of bounds. Line ${e.line}`),null;const _=4*(p*u[0]+d),w=new Uint8Array(o.buffer,_,4);return w[0]=255*s[0],w[1]=255*s[1],w[2]=255*s[2],w[3]=255*s[3],null}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t);return t.getVariable(i).value.getDataValue(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getDataValue(this.exec,n.postfix,t);return u instanceof Pt&&o instanceof Pt&&(u.value=o.value),s.value instanceof go&&s.value.setDataValue(this.exec,u,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getDataValue(this.exec,n.postfix,t);return u instanceof Pt&&o instanceof Pt&&(u.value+=o.value),s.value instanceof go&&s.value.setDataValue(this.exec,u,n.postfix,t),null}AtomicSub(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getDataValue(this.exec,n.postfix,t);return u instanceof Pt&&o instanceof Pt&&(u.value-=o.value),s.value instanceof go&&s.value.setDataValue(this.exec,u,n.postfix,t),null}AtomicMax(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getDataValue(this.exec,n.postfix,t),d=new Pt(u.value,u.typeInfo);return u instanceof Pt&&o instanceof Pt&&(u.value=Math.max(u.value,o.value)),s.value instanceof go&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicMin(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getDataValue(this.exec,n.postfix,t),d=new Pt(u.value,u.typeInfo);return u instanceof Pt&&o instanceof Pt&&(u.value=Math.min(u.value,o.value)),s.value instanceof go&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicAnd(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getDataValue(this.exec,n.postfix,t),d=new Pt(u.value,u.typeInfo);return u instanceof Pt&&o instanceof Pt&&(u.value=u.value&o.value),s.value instanceof go&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicOr(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getDataValue(this.exec,n.postfix,t),d=new Pt(u.value,u.typeInfo);return u instanceof Pt&&o instanceof Pt&&(u.value=u.value|o.value),s.value instanceof go&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicXor(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getDataValue(this.exec,n.postfix,t),d=new Pt(u.value,u.typeInfo);return u instanceof Pt&&o instanceof Pt&&(u.value=u.value^o.value),s.value instanceof go&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicExchange(e,t){let n=e.args[0];n instanceof bl&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getDataValue(this.exec,n.postfix,t),d=new Pt(u.value,u.typeInfo);return u instanceof Pt&&o instanceof Pt&&(u.value=o.value),s.value instanceof go&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}};function Lr(r){return Array.isArray(r)||(r==null?void 0:r.buffer)instanceof ArrayBuffer}const fy=new Float32Array(1),AG=new Uint32Array(fy.buffer),fG=new Uint32Array(fy.buffer),dy=new Int32Array(1),dG=new Float32Array(dy.buffer),pG=new Uint32Array(dy.buffer),py=new Uint32Array(1),gG=new Float32Array(py.buffer),mG=new Int32Array(py.buffer);function D5(r,e,t){if(e===t)return r;if(e==="f32"){if(t==="i32"||t==="x32")return fy[0]=r,AG[0];if(t==="u32")return fy[0]=r,fG[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return dy[0]=r,dG[0];if(t==="u32")return dy[0]=r,pG[0]}else if(e==="u32"){if(t==="f32")return py[0]=r,gG[0];if(t==="i32"||t==="x32")return py[0]=r,mG[0]}return console.error(`Unsupported cast from ${e} to ${t}`),r}let gy=class Sc extends uG{constructor(e,t){var n;super(),this.ast=e??[],this.reflection=new Fg,this.reflection.updateAST(this.ast),this.context=(n=t==null?void 0:t.clone())!==null&&n!==void 0?n:new cG,this.builtins=new hG(this),this.typeInfo={bool:this.getTypeInfo(Cr.bool),i32:this.getTypeInfo(Cr.i32),u32:this.getTypeInfo(Cr.u32),f32:this.getTypeInfo(Cr.f32),f16:this.getTypeInfo(Cr.f16),vec2f:this.getTypeInfo(Xt.vec2f),vec2u:this.getTypeInfo(Xt.vec2u),vec2i:this.getTypeInfo(Xt.vec2i),vec2h:this.getTypeInfo(Xt.vec2h),vec3f:this.getTypeInfo(Xt.vec3f),vec3u:this.getTypeInfo(Xt.vec3u),vec3i:this.getTypeInfo(Xt.vec3i),vec3h:this.getTypeInfo(Xt.vec3h),vec4f:this.getTypeInfo(Xt.vec4f),vec4u:this.getTypeInfo(Xt.vec4u),vec4i:this.getTypeInfo(Xt.vec4i),vec4h:this.getTypeInfo(Xt.vec4h),mat2x2f:this.getTypeInfo(Xt.mat2x2f),mat2x3f:this.getTypeInfo(Xt.mat2x3f),mat2x4f:this.getTypeInfo(Xt.mat2x4f),mat3x2f:this.getTypeInfo(Xt.mat3x2f),mat3x3f:this.getTypeInfo(Xt.mat3x3f),mat3x4f:this.getTypeInfo(Xt.mat3x4f),mat4x2f:this.getTypeInfo(Xt.mat4x2f),mat4x3f:this.getTypeInfo(Xt.mat4x3f),mat4x4f:this.getTypeInfo(Xt.mat4x4f)}}getVariableValue(e){var t,n;const i=(n=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:null;return i===null?null:i instanceof Pt||i instanceof Ve||i instanceof ui?i.value:(console.error(`Unsupported return variable type ${i.typeInfo.name}`),null)}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const a=s.getFunction(e);if(!a)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],u=t[1],d=t[2],p=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new Ve(t,p));for(const _ in n)for(const w in n[_]){const v=n[_][w];s.variables.forEach(M=>{const P=M.node;if(P!=null&&P.attributes){let D=null,N=null;for(const z of P.attributes)z.name==="binding"?D=z.value:z.name==="group"&&(N=z.value);w==D&&_==N&&(v.texture!==void 0&&v.size!==void 0?M.value=new go(v.texture,this.getTypeInfo(P.type),0,v.size):v.uniform!==void 0?M.value=new go(v.uniform,this.getTypeInfo(P.type)):M.value=new go(v,this.getTypeInfo(P.type)))}})}for(let _=0;_<d;++_)for(let w=0;w<u;++w)for(let v=0;v<o;++v)s.setVariable("@workgroup_id",new Ve([v,w,_],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(a,[v,w,_],s)}execStatement(e,t){if(e instanceof B5)return this.evalExpression(e.value,t);if(e instanceof T5){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof Pt))throw new Error("Invalid break-if condition");if(!n.value)return null}return Sc._breakObj}if(e instanceof E5)return Sc._continueObj;if(e instanceof ly)this._let(e,t);else if(e instanceof _A)this._var(e,t);else if(e instanceof lw)this._const(e,t);else if(e instanceof ay)this._function(e,t);else{if(e instanceof x5)return this._if(e,t);if(e instanceof w5)return this._switch(e,t);if(e instanceof _5)return this._for(e,t);if(e instanceof m5)return this._while(e,t);if(e instanceof v5)return this._loop(e,t);if(e instanceof ow){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof b5)this._assign(e,t);else if(e instanceof y5)this._increment(e,t);else{if(e instanceof yA)return null;if(e instanceof aw){const n=e.name;t.getVariable(n)===null&&t.setVariable(n,new Pt(0,this.getTypeInfo("u32")))}else if(e instanceof cw)this._call(e,t);else{if(e instanceof C5||e instanceof uw)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){for(;e instanceof uy;)e=e.contents[0];return e instanceof Fc?this._evalBinaryOp(e,t):e instanceof gs?this._evalLiteral(e,t):e instanceof bA?this._evalVariable(e,t):e instanceof cy?this._evalCall(e,t):e instanceof Sf?this._evalCreate(e,t):e instanceof I5?this._evalConst(e,t):e instanceof M5?this._evalBitcast(e,t):e instanceof bl?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Cr){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}const n=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return n!==null?n:null}getTypeName(e){if(e===null)return console.error("Type is null."),"unknown";let t=e.name;if(e instanceof gA||e instanceof Xt){if(e.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(e.format.name==="f32")return t+="f",t;if(e.format.name==="i32")return t+="i",t;if(e.format.name==="u32")return t+="u",t;if(e.format.name==="bool")return t+="b",t;if(e.format.name==="f16")return t+="h",t}t+=`<${e.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t}return t}_setOverrides(e,t){for(const n in e){const i=e[n],s=this.reflection.getOverrideInfo(n);s!==null?s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?t.setVariable(n,new Pt(i,s.type)):s.type.name==="bool"?t.setVariable(n,new Pt(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?t.setVariable(n,new Ve(i,s.type)):console.error(`Invalid constant type for ${n}`):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const i=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const _=n.getVariableValue(p.value[0]);i[0]=_ instanceof Pt?_.value:parseInt(p.value[0])}if(p.value.length>1){const _=n.getVariableValue(p.value[1]);i[1]=_ instanceof Pt?_.value:parseInt(p.value[1])}if(p.value.length>2){const _=n.getVariableValue(p.value[2]);i[2]=_ instanceof Pt?_.value:parseInt(p.value[2])}}const s=this.getTypeInfo("vec3u"),a=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Ve(i,s));const o=i[0],u=i[1],d=i[2];for(let p=0,_=0;p<d;++p)for(let w=0;w<u;++w)for(let v=0;v<o;++v,++_){const M=[v,w,p],P=[v+t[0]*i[0],w+t[1]*i[1],p+t[2]*i[2]];n.setVariable("@local_invocation_id",new Ve(M,s)),n.setVariable("@global_invocation_id",new Ve(P,s)),n.setVariable("@local_invocation_index",new Pt(_,a)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const i of n.attributes)if(i.name==="builtin"){const s=`@${i.value}`,a=t.getVariable(s);a!==void 0&&t.variables.set(n.name,a)}this._execStatements(e.node.body,t)}getVariableName(e,t){return e instanceof bA?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const s=t.clone(),a=this._execStatements(n,s);if(a)return a;continue}const i=this.execStatement(n,t);if(i)return i}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const a=i.node.args[s],o=this.evalExpression(e.args[s],n);n.setVariable(a.name,o,a)}this._execStatements(i.node.body,n)}else this._callBuiltinFunction(e,n)}_increment(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);i?e.operator==="++"?i.value instanceof Pt?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof Pt?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_assign(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);if(i===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);const s=this.evalExpression(e.value,t),a=e.operator;if(a==="=")if(i.value instanceof go)i.value.setDataValue(this,s,e.variable.postfix,t);else if(e.variable.postfix){if(!(i.value instanceof Ve||i.value instanceof ui))return void console.error(`Variable ${i.name} is not a vector or matrix. Line ${e.line}`);if(e.variable.postfix instanceof zd){const o=this.evalExpression(e.variable.postfix.index,t).value;if(i.value instanceof Ve){if(!(s instanceof Pt))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[o]=s.value}else{if(!(i.value instanceof ui))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);{const u=this.evalExpression(e.variable.postfix.index,t).value;if(u<0)return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);if(!(s instanceof Ve))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);{const d=this.getTypeName(i.value.typeInfo);if(d==="mat2x2"||d==="mat2x2f"||d==="mat2x2h"){if(!(u<2&&s.value.length===2))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[2*u]=s.value[0],i.value.value[2*u+1]=s.value[1]}else if(d==="mat2x3"||d==="mat2x3f"||d==="mat2x3h"){if(!(u<2&&s.value.length===3))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[3*u]=s.value[0],i.value.value[3*u+1]=s.value[1],i.value.value[3*u+2]=s.value[2]}else if(d==="mat2x4"||d==="mat2x4f"||d==="mat2x4h"){if(!(u<2&&s.value.length===4))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[4*u]=s.value[0],i.value.value[4*u+1]=s.value[1],i.value.value[4*u+2]=s.value[2],i.value.value[4*u+3]=s.value[3]}else if(d==="mat3x2"||d==="mat3x2f"||d==="mat3x2h"){if(!(u<3&&s.value.length===2))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[2*u]=s.value[0],i.value.value[2*u+1]=s.value[1]}else if(d==="mat3x3"||d==="mat3x3f"||d==="mat3x3h"){if(!(u<3&&s.value.length===3))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[3*u]=s.value[0],i.value.value[3*u+1]=s.value[1],i.value.value[3*u+2]=s.value[2]}else if(d==="mat3x4"||d==="mat3x4f"||d==="mat3x4h"){if(!(u<3&&s.value.length===4))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[4*u]=s.value[0],i.value.value[4*u+1]=s.value[1],i.value.value[4*u+2]=s.value[2],i.value.value[4*u+3]=s.value[3]}else if(d==="mat4x2"||d==="mat4x2f"||d==="mat4x2h"){if(!(u<4&&s.value.length===2))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[2*u]=s.value[0],i.value.value[2*u+1]=s.value[1]}else if(d==="mat4x3"||d==="mat4x3f"||d==="mat4x3h"){if(!(u<4&&s.value.length===3))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[3*u]=s.value[0],i.value.value[3*u+1]=s.value[1],i.value.value[3*u+2]=s.value[2]}else{if(d!=="mat4x4"&&d!=="mat4x4f"&&d!=="mat4x4h")return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);if(!(u<4&&s.value.length===4))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);i.value.value[4*u]=s.value[0],i.value.value[4*u+1]=s.value[1],i.value.value[4*u+2]=s.value[2],i.value.value[4*u+3]=s.value[3]}}}}}else if(e.variable.postfix instanceof Ef){const o=e.variable.postfix.value;if(!(i.value instanceof Ve))return void console.error(`Invalid assignment to ${o}. Variable ${i.name} is not a vector. Line ${e.line}`);if(s instanceof Pt){if(o.length>1)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);if(o==="x")i.value.value[0]=s.value;else if(o==="y"){if(i.value.value.length<2)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);i.value.value[1]=s.value}else if(o==="z"){if(i.value.value.length<3)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);i.value.value[2]=s.value}else if(o==="w"){if(i.value.value.length<4)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);i.value.value[3]=s.value}}else{if(!(s instanceof Ve))return void console.error(`Invalid assignment to ${i.name}. Line ${e.line}`);if(o.length!==s.value.length)return void console.error(`Invalid assignment to ${o} for variable ${i.name}. Line ${e.line}`);for(let u=0;u<o.length;++u){const d=o[u];if(d==="x"||d==="r")i.value.value[0]=s.value[u];else if(d==="y"||d==="g"){if(s.value.length<2)return void console.error(`Invalid assignment to ${d} for variable ${i.name}. Line ${e.line}`);i.value.value[1]=s.value[u]}else if(d==="z"||d==="b"){if(s.value.length<3)return void console.error(`Invalid assignment to ${d} for variable ${i.name}. Line ${e.line}`);i.value.value[2]=s.value[u]}else{if(d!=="w"&&d!=="a")return void console.error(`Invalid assignment to ${d} for variable ${i.name}. Line ${e.line}`);if(s.value.length<4)return void console.error(`Invalid assignment to ${d} for variable ${i.name}. Line ${e.line}`);i.value.value[3]=s.value[u]}}}}}else i.value=s;else{const o=i.value.getDataValue(this,e.variable.postfix,t);if(o instanceof Ve&&s instanceof Pt){const u=o.value,d=s.value;if(a==="+=")for(let p=0;p<u.length;++p)u[p]+=d;else if(a==="-=")for(let p=0;p<u.length;++p)u[p]-=d;else if(a==="*=")for(let p=0;p<u.length;++p)u[p]*=d;else if(a==="/=")for(let p=0;p<u.length;++p)u[p]/=d;else if(a==="%=")for(let p=0;p<u.length;++p)u[p]%=d;else if(a==="&=")for(let p=0;p<u.length;++p)u[p]&=d;else if(a==="|=")for(let p=0;p<u.length;++p)u[p]|=d;else if(a==="^=")for(let p=0;p<u.length;++p)u[p]^=d;else if(a==="<<=")for(let p=0;p<u.length;++p)u[p]<<=d;else if(a===">>=")for(let p=0;p<u.length;++p)u[p]>>=d;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(o instanceof Ve&&s instanceof Ve){const u=o.value,d=s.value;if(u.length!==d.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let p=0;p<u.length;++p)u[p]+=d[p];else if(a==="-=")for(let p=0;p<u.length;++p)u[p]-=d[p];else if(a==="*=")for(let p=0;p<u.length;++p)u[p]*=d[p];else if(a==="/=")for(let p=0;p<u.length;++p)u[p]/=d[p];else if(a==="%=")for(let p=0;p<u.length;++p)u[p]%=d[p];else if(a==="&=")for(let p=0;p<u.length;++p)u[p]&=d[p];else if(a==="|=")for(let p=0;p<u.length;++p)u[p]|=d[p];else if(a==="^=")for(let p=0;p<u.length;++p)u[p]^=d[p];else if(a==="<<=")for(let p=0;p<u.length;++p)u[p]<<=d[p];else if(a===">>=")for(let p=0;p<u.length;++p)u[p]>>=d[p];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(o instanceof Pt&&s instanceof Pt))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?o.value+=s.value:a==="-="?o.value-=s.value:a==="*="?o.value*=s.value:a==="/="?o.value/=s.value:a==="%="?o.value%=s.value:a==="&="?o.value&=s.value:a==="|="?o.value|=s.value:a==="^="?o.value^=s.value:a==="<<="?o.value<<=s.value:a===">>="?o.value>>=s.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}i.value instanceof go&&i.value.setDataValue(this,o,e.variable.postfix,t)}}_function(e,t){const n=new lG(e);t.functions.set(e.name,n)}_const(e,t){let n=null;e.value!=null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;e.value!=null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(e.value!==null)n=this.evalExpression(e.value,t);else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);if(e.type.name==="f32"||e.type.name==="i32"||e.type.name==="u32"||e.type.name==="bool"||e.type.name==="f16"||e.type.name==="vec2"||e.type.name==="vec3"||e.type.name==="vec4"||e.type.name==="vec2f"||e.type.name==="vec3f"||e.type.name==="vec4f"||e.type.name==="vec2i"||e.type.name==="vec3i"||e.type.name==="vec4i"||e.type.name==="vec2u"||e.type.name==="vec3u"||e.type.name==="vec4u"||e.type.name==="vec2h"||e.type.name==="vec3h"||e.type.name==="vec4h"||e.type.name==="mat2x2"||e.type.name==="mat2x3"||e.type.name==="mat2x4"||e.type.name==="mat3x2"||e.type.name==="mat3x3"||e.type.name==="mat3x4"||e.type.name==="mat4x2"||e.type.name==="mat4x3"||e.type.name==="mat4x4"||e.type.name==="mat2x2f"||e.type.name==="mat2x3f"||e.type.name==="mat2x4f"||e.type.name==="mat3x2f"||e.type.name==="mat3x3f"||e.type.name==="mat3x4f"||e.type.name==="mat4x2f"||e.type.name==="mat4x3f"||e.type.name==="mat4x4f"||e.type.name==="mat2x2h"||e.type.name==="mat2x3h"||e.type.name==="mat2x4h"||e.type.name==="mat3x2h"||e.type.name==="mat3x3h"||e.type.name==="mat3x4h"||e.type.name==="mat4x2h"||e.type.name==="mat4x3h"||e.type.name==="mat4x4h"){const i=new Sf(e.type,[]);n=this._evalCreate(i,t)}if(e.type.name==="array"){const i=new Sf(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Pt))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof R5)for(const a of s.selectors){if(a instanceof hy){i=s;continue}const o=this.evalExpression(a,t);if(!(o instanceof Pt))return console.error(`Invalid case selector. Line ${e.line}`),null;if(o.value===n.value)return this._execStatements(s.body,t)}else s instanceof L5&&(i=s);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Pt))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const i of e.elseif){const s=this.evalExpression(i.condition,t);if(!(s instanceof Pt))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Pt?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Sc._breakObj)break;if(n!==null&&n!==Sc._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===Sc._breakObj)break;if(n===Sc._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Sc._breakObj)break}else if(n!==null)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Sc._breakObj)break;if(n!==Sc._continueObj&&n!==null)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),i=e.type;if(n instanceof Pt){const s=D5(n.value,n.typeInfo.name,i.name);return new Pt(s,this.getTypeInfo(i))}if(n instanceof Ve){const s=this.getTypeName(n.typeInfo);let a="";if(s.endsWith("f"))a="f32";else if(s.endsWith("i"))a="i32";else if(s.endsWith("u"))a="u32";else if(s.endsWith("b"))a="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;a="f16"}const o=this.getTypeName(i);let u="";if(o.endsWith("f"))u="f32";else if(o.endsWith("i"))u="i32";else if(o.endsWith("u"))u="u32";else if(o.endsWith("b"))u="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const d=function(p,_,w){if(_===w)return p;const v=new Array(p.length);for(let M=0;M<p.length;M++)v[M]=D5(p[M],_,w);return v}(n.value,a,u);return new Ve(d,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){const n=t.getVariableValue(e.name);return e.postfix?n.getDataValue(this,e.postfix,t):n}_evalCreate(e,t){var n;if(e.type===null)return hw.void;const i=this.getTypeName(e.type);switch(i){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}const s=this.getTypeInfo(e.type);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const a=new go(new ArrayBuffer(s.size),s,0);if(s instanceof pA){if(e.args)for(let o=0;o<e.args.length;++o){const u=s.members[o],d=e.args[o],p=this.evalExpression(d,t);a.setData(this,p,u.type,u.offset,t)}}else if(s instanceof Tf){let o=0;if(e.args)for(let u=0;u<e.args.length;++u){const d=e.args[u],p=this.evalExpression(d,t);s.format===null&&(((n=p.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=p.typeInfo),a.setData(this,p,s.format,o,t),o+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return a}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new Pt(e.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,t):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return n===null?n:e!=null&&e.postfix?n.getDataValue(this,e.postfix,t):n}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const i=Sc._priority.get(t.name);Sc._priority.get(e[n].name)<i&&(t=e[n])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t),i=n instanceof Pt||n instanceof Ve?n.value:null;switch(e.operator){case"+":{if(Lr(i)){const o=i.map((u,d)=>+u);return new Ve(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Pt(+s,a)}case"-":{if(Lr(i)){const o=i.map((u,d)=>-u);return new Ve(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Pt(-s,a)}case"!":{if(Lr(i)){const o=i.map((u,d)=>u?0:1);return new Ve(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Pt(s?0:1,a)}case"~":{if(Lr(i)){const o=i.map((u,d)=>~u);return new Ve(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Pt(~s,a)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),s=n instanceof Pt||n instanceof Ve||n instanceof ui?n.value:null,a=i instanceof Pt||i instanceof Ve||i instanceof ui?i.value:null;switch(e.operator){case"+":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v+_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w+p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p+w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o+u,d)}case"-":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v-_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w-p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p-w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o-u,d)}case"*":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v*_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w*p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p*w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o*u,d)}case"%":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v%_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w%p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p%w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o%u,d)}case"/":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v/_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w/p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p/w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o/u,d)}case"&":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v&_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w&p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p&w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o&u,d)}case"|":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v|_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w|p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p|w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o|u,d)}case"^":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v^_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w^p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p^w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o^u,d)}case"<<":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v<<_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w<<p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p<<w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o<<u,d)}case">>":{if(Lr(s)&&Lr(a)){const p=s,_=a;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=p.map((v,M)=>v>>_[M]);return new Ve(w,n.typeInfo)}if(Lr(s)){const p=a,_=s.map((w,v)=>w>>p);return new Ve(_,n.typeInfo)}if(Lr(a)){const p=s,_=a.map((w,v)=>p>>w);return new Ve(_,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Pt(o>>u,d)}case">":if(Lr(s)&&Lr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,_)=>p>u[_]?1:0);return new Ve(d,n.typeInfo)}if(Lr(s)){const o=a,u=s.map((d,p)=>d>o?1:0);return new Ve(u,n.typeInfo)}if(Lr(a)){const o=s,u=a.map((d,p)=>o>d?1:0);return new Ve(u,i.typeInfo)}return new Pt(s>a?1:0,this.getTypeInfo("bool"));case"<":if(Lr(s)&&Lr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,_)=>p<u[_]?1:0);return new Ve(d,n.typeInfo)}if(Lr(s)){const o=a,u=s.map((d,p)=>d<o?1:0);return new Ve(u,n.typeInfo)}if(Lr(a)){const o=s,u=a.map((d,p)=>o<d?1:0);return new Ve(u,i.typeInfo)}return new Pt(s<a?1:0,this.getTypeInfo("bool"));case"==":if(Lr(s)&&Lr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,_)=>p===u[_]?1:0);return new Ve(d,n.typeInfo)}if(Lr(s)){const o=a,u=s.map((d,p)=>d==o?1:0);return new Ve(u,n.typeInfo)}if(Lr(a)){const o=s,u=a.map((d,p)=>o==d?1:0);return new Ve(u,i.typeInfo)}return new Pt(s===a?1:0,this.getTypeInfo("bool"));case"!=":if(Lr(s)&&Lr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,_)=>p!==u[_]?1:0);return new Ve(d,n.typeInfo)}if(Lr(s)){const o=a,u=s.map((d,p)=>d!==o?1:0);return new Ve(u,n.typeInfo)}if(Lr(a)){const o=s,u=a.map((d,p)=>o!==d?1:0);return new Ve(u,i.typeInfo)}return new Pt(s!==a?1:0,this.getTypeInfo("bool"));case">=":if(Lr(s)&&Lr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,_)=>p>=u[_]?1:0);return new Ve(d,n.typeInfo)}if(Lr(s)){const o=a,u=s.map((d,p)=>d>=o?1:0);return new Ve(u,n.typeInfo)}if(Lr(a)){const o=s,u=a.map((d,p)=>o>=d?1:0);return new Ve(u,i.typeInfo)}return new Pt(s>=a?1:0,this.getTypeInfo("bool"));case"<=":if(Lr(s)&&Lr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,_)=>p<=u[_]?1:0);return new Ve(d,n.typeInfo)}if(Lr(s)){const o=a,u=s.map((d,p)=>d<=o?1:0);return new Ve(u,n.typeInfo)}if(Lr(a)){const o=s,u=a.map((d,p)=>o<=d?1:0);return new Ve(u,i.typeInfo)}return new Pt(s<=a?1:0,this.getTypeInfo("bool"));case"&&":if(Lr(s)&&Lr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,_)=>p&&u[_]?1:0);return new Ve(d,n.typeInfo)}if(Lr(s)){const o=a,u=s.map((d,p)=>d&&o?1:0);return new Ve(u,n.typeInfo)}if(Lr(a)){const o=s,u=a.map((d,p)=>o&&d?1:0);return new Ve(u,i.typeInfo)}return new Pt(s&&a?1:0,this.getTypeInfo("bool"));case"||":if(Lr(s)&&Lr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,_)=>p||u[_]?1:0);return new Ve(d,n.typeInfo)}if(Lr(s)){const o=a,u=s.map((d,p)=>d||o?1:0);return new Ve(u,n.typeInfo)}if(Lr(a)){const o=s,u=a.map((d,p)=>o||d?1:0);return new Ve(u,i.typeInfo)}return new Pt(s||a?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return this._callBuiltinFunction(e,n);for(let s=0;s<i.node.args.length;++s){const a=i.node.args[s],o=this.evalExpression(e.args[s],n);n.createVariable(a.name,o,a)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const i=t.clone();for(let s=0;s<n.node.args.length;++s){const a=n.node.args[s],o=this.evalExpression(e.args[s],i);i.setVariable(a.name,o,a)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new Pt(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),i=this.getTypeName(e.type),s={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4}[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const a=i.endsWith("i")||i.endsWith("u"),o=[];if(e instanceof gs)if(e.isVector){const u=e.vectorValue;for(const d of u)o.push(d)}else o.push(e.scalarValue);else if(e.args)for(const u of e.args){const d=this.evalExpression(u,t);if(d instanceof Ve){const p=d.value;for(let _=0;_<p.length;++_){let w=p[_];a&&(w=Math.floor(w)),o.push(w)}}else if(d instanceof Pt){let p=d.value;a&&(p=Math.floor(p)),o.push(p)}}if(e.type instanceof Xt&&e.type.format===null&&(e.type.format=Xt.f32),o.length===0){const u=new Array(s).fill(0);return new Ve(u,n)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Ve(o.length>s?o.slice(0,s):o,n)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),i=this.getTypeName(e.type),s={mat2x2:4,mat2x2f:4,mat2x2h:4,mat2x3:6,mat2x3f:6,mat2x3h:6,mat2x4:8,mat2x4f:8,mat2x4h:8,mat3x2:6,mat3x2f:6,mat3x2h:6,mat3x3:9,mat3x3f:9,mat3x3h:9,mat3x4:12,mat3x4f:12,mat3x4h:12,mat4x2:8,mat4x2f:8,mat4x2h:8,mat4x3:12,mat4x3f:12,mat4x3h:12,mat4x4:16,mat4x4f:16,mat4x4h:16}[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const a=[];if(e instanceof gs)if(e.isVector){const o=e.vectorValue;for(const u of o)a.push(u)}else a.push(e.scalarValue);else if(e.args)for(const o of e.args){const u=this.evalExpression(o,t);if(u instanceof Ve){const d=u.value;for(let p=0;p<d.length;++p)a.push(d[p])}else u instanceof Pt?a.push(u.value):u instanceof ui&&a.push(...u.value)}if(n instanceof gA&&n.format===null&&(n.format=this.getTypeInfo("f32")),a.length===0){const o=new Array(s).fill(0);return new ui(o,n)}return a.length!==s?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new ui(a,n)}};gy._breakObj=new If(new Mc("BREAK",null)),gy._continueObj=new If(new Mc("CONTINUE",null)),gy._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);let _G=class{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new W$,this._exec=new gy}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,s=n.countNode;if(s instanceof bA){const a=s.name,o=this._context.constants.get(a);if(o)try{const u=o.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}return t}_initialize(e){if(e)if(typeof e=="string"){const t=new sG(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Pe.eof}_match(e){if(e instanceof yt)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let i=!1;for(const s of e){if(n===s)return!0;s===Pe.tokens.name&&(i=!0)}if(i){const s=Pe.tokens.name.rule.exec(t.lexeme);if(s&&s.index==0&&s[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Pe.tokens.name){const n=Pe.tokens.name.rule.exec(t.lexeme);return n&&n.index==0&&n[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Pe.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Pe.keywords.alias)){const t=this._type_alias();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Pe.keywords.diagnostic)){const t=this._diagnostic();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Pe.keywords.requires)){const t=this._requires_directive();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Pe.keywords.enable)){const t=this._enable_directive();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(Pe.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Pe.keywords.fn))return null;const e=this._currentLine,t=this._consume(Pe.tokens.ident,"Expected function name.").toString();this._consume(Pe.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Pe.tokens.paren_right))do{if(this._check(Pe.tokens.paren_right))break;const o=this._attribute(),u=this._consume(Pe.tokens.name,"Expected argument name.").toString();this._consume(Pe.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d,n.push(this._updateNode(new tG(u,p,o))))}while(this._match(Pe.tokens.comma));this._consume(Pe.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(Pe.tokens.arrow)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}const s=this._compound_statement(),a=this._currentLine;return this._updateNode(new ay(t,n,i,s,e,a),e)}_compound_statement(){const e=[];for(this._consume(Pe.tokens.brace_left,"Expected '{' for block.");!this._check(Pe.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(Pe.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Pe.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Pe.tokens.attr)&&this._attribute(),this._check(Pe.keywords.if))return this._if_statement();if(this._check(Pe.keywords.switch))return this._switch_statement();if(this._check(Pe.keywords.loop))return this._loop_statement();if(this._check(Pe.keywords.for))return this._for_statement();if(this._check(Pe.keywords.while))return this._while_statement();if(this._check(Pe.keywords.continuing))return this._continuing_statement();if(this._check(Pe.keywords.static_assert))return this._static_assert_statement();if(this._check(Pe.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Pe.keywords.return))e=this._return_statement();else if(this._check([Pe.keywords.var,Pe.keywords.let,Pe.keywords.const]))e=this._variable_statement();else if(this._match(Pe.keywords.discard))e=this._updateNode(new J$);else if(this._match(Pe.keywords.break)){const t=this._updateNode(new T5);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t,this._check(Pe.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression(),t.condition instanceof uy&&t.condition.contents.length===1&&(t.condition=t.condition.contents[0]))}else if(this._match(Pe.keywords.continue)){const t=this._updateNode(new E5);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(Pe.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Pe.keywords.static_assert))return null;const e=this._optional_paren_expression();return this._updateNode(new X$(e))}_while_statement(){if(!this._match(Pe.keywords.while))return null;const e=this._updateNode(new m5(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){if(!this._match(Pe.keywords.continuing))return null;const e=this._compound_statement();return this._updateNode(new ow(e))}_for_statement(){if(!this._match(Pe.keywords.for))return null;this._consume(Pe.tokens.paren_left,"Expected '('.");const e=this._updateNode(new _5(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Pe.tokens.semicolon)?null:this._for_init(),this._consume(Pe.tokens.semicolon,"Expected ';'."),e.condition=this._check(Pe.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Pe.tokens.semicolon,"Expected ';'."),e.increment=this._check(Pe.tokens.paren_right)?null:this._for_increment(),this._consume(Pe.tokens.paren_right,"Expected ')'."),this._check(Pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Pe.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Pe.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new _A(e.name,e.type,e.storage,e.access,t))}if(this._match(Pe.keywords.let)){const e=this._consume(Pe.tokens.name,"Expected name for let.").toString();let t=null;if(this._match(Pe.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}this._consume(Pe.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return this._updateNode(new ly(e,t,null,null,n))}if(this._match(Pe.keywords.const)){const e=this._consume(Pe.tokens.name,"Expected name for const.").toString();let t=null;if(this._match(Pe.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}this._consume(Pe.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return t===null&&n instanceof gs&&(t=n.type),this._updateNode(new lw(e,t,null,null,n))}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(Pe.increment_operators))return this._current=e,null;const n=this._consume(Pe.increment_operators,"Expected increment operator");return this._updateNode(new y5(n.type===Pe.tokens.plus_plus?Qd.increment:Qd.decrement,t))}_assignment_statement(){let e=null;if(this._check(Pe.tokens.brace_right))return null;let t=this._match(Pe.tokens.underscore);if(t||(e=this._unary_expression()),!t&&e==null)return null;const n=this._consume(Pe.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return this._updateNode(new b5(Mg.parse(n.lexeme),e,i))}_func_call_statement(){if(!this._check(Pe.tokens.ident))return null;const e=this._current,t=this._consume(Pe.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):this._updateNode(new cw(t.lexeme,n))}_loop_statement(){if(!this._match(Pe.keywords.loop))return null;this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new v5([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof ow){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Pe.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Pe.keywords.switch))return null;const e=this._updateNode(new w5(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Pe.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Pe.keywords.default,Pe.keywords.case]);){if(this._match(Pe.keywords.case)){const n=this._case_selectors();for(const s of n)if(s instanceof hy){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Pe.tokens.colon),this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(Pe.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new R5(n,i)))}if(this._match(Pe.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Pe.tokens.colon),this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Pe.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new L5(n)))}}return e}_case_selectors(){const e=[];for(this._match(Pe.keywords.default)?e.push(this._updateNode(new hy)):e.push(this._shift_expression());this._match(Pe.tokens.comma);)this._match(Pe.keywords.default)?e.push(this._updateNode(new hy)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Pe.keywords.fallthrough))return this._consume(Pe.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(Pe.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Pe.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(Pe.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(Pe.keywords.else)&&(this._check(Pe.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new x5(t,n,i,s),e)}_match_elseif(){return this._tokens[this._current].type===Pe.keywords.else&&this._tokens[this._current+1].type===Pe.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new rG(t,n))),this._match_elseif()&&(this._check(Pe.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Pe.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new B5(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Pe.tokens.or_or);)e=this._updateNode(new Fc(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Pe.tokens.and_and);)e=this._updateNode(new Fc(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Pe.tokens.or);)e=this._updateNode(new Fc(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Pe.tokens.xor);)e=this._updateNode(new Fc(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Pe.tokens.and);)e=this._updateNode(new Fc(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Pe.tokens.equal_equal,Pe.tokens.not_equal])?this._updateNode(new Fc(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Pe.tokens.less_than,Pe.tokens.greater_than,Pe.tokens.less_than_equal,Pe.tokens.greater_than_equal]);)e=this._updateNode(new Fc(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Pe.tokens.shift_left,Pe.tokens.shift_right]);)e=this._updateNode(new Fc(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Pe.tokens.plus,Pe.tokens.minus]);)e=this._updateNode(new Fc(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Pe.tokens.star,Pe.tokens.forward_slash,Pe.tokens.modulo]);)e=this._updateNode(new Fc(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Pe.tokens.minus,Pe.tokens.bang,Pe.tokens.tilde,Pe.tokens.star,Pe.tokens.and])?this._updateNode(new bl(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Pe.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Pe.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new zd(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(Pe.tokens.period)){const e=this._consume(Pe.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new Ef(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"bool":return Cr.bool;case"i32":return Cr.i32;case"u32":return Cr.u32;case"f32":return Cr.f32;case"f16":return Cr.f16;case"vec2f":return Xt.vec2f;case"vec3f":return Xt.vec3f;case"vec4f":return Xt.vec4f;case"vec2i":return Xt.vec2i;case"vec3i":return Xt.vec3i;case"vec4i":return Xt.vec4i;case"vec2u":return Xt.vec2u;case"vec3u":return Xt.vec3u;case"vec4u":return Xt.vec4u;case"vec2h":return Xt.vec2h;case"vec3h":return Xt.vec3h;case"vec4h":return Xt.vec4h;case"mat2x2f":return Xt.mat2x2f;case"mat2x3f":return Xt.mat2x3f;case"mat2x4f":return Xt.mat2x4f;case"mat3x2f":return Xt.mat3x2f;case"mat3x3f":return Xt.mat3x3f;case"mat3x4f":return Xt.mat3x4f;case"mat4x2f":return Xt.mat4x2f;case"mat4x3f":return Xt.mat4x3f;case"mat4x4f":return Xt.mat4x4f;case"mat2x2h":return Xt.mat2x2h;case"mat2x3h":return Xt.mat2x3h;case"mat2x4h":return Xt.mat2x4h;case"mat3x2h":return Xt.mat3x2h;case"mat3x3h":return Xt.mat3x3h;case"mat3x4h":return Xt.mat3x4h;case"mat4x2h":return Xt.mat4x2h;case"mat4x3h":return Xt.mat4x3h;case"mat4x4h":return Xt.mat4x4h}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Pe.tokens.ident)){const n=this._previous().toString();if(this._check(Pe.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(n);return s!==null?this._updateNode(new Sf(s,i)):this._updateNode(new cy(n,i))}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return this._updateNode(new I5(n,i.value))}return this._updateNode(new bA(n))}if(this._match(Pe.tokens.int_literal)){const n=this._previous().toString();let i=n.endsWith("i")||n.endsWith("i")?Cr.i32:n.endsWith("u")||n.endsWith("U")?Cr.u32:Cr.x32;const s=parseInt(n);return this._validateTypeRange(s,i),this._updateNode(new gs(new Pt(s,this._exec.getTypeInfo(i)),i))}if(this._match(Pe.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Cr.u32),this._updateNode(new gs(new Pt(n,this._exec.getTypeInfo(Cr.u32)),Cr.u32))}if(this._match([Pe.tokens.decimal_float_literal,Pe.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));const s=parseFloat(n);this._validateTypeRange(s,i?Cr.f16:Cr.f32);const a=i?Cr.f16:Cr.f32;return this._updateNode(new gs(new Pt(s,this._exec.getTypeInfo(a)),a))}if(this._match([Pe.keywords.true,Pe.keywords.false])){let n=this._previous().toString()===Pe.keywords.true.rule;return this._updateNode(new gs(new Pt(n?1:0,this._exec.getTypeInfo(Cr.bool)),Cr.bool))}if(this._check(Pe.tokens.paren_left))return this._paren_expression();if(this._match(Pe.keywords.bitcast)){this._consume(Pe.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(Pe.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new M5(n,i))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Sf(e,t))}_argument_expression_list(){if(!this._match(Pe.tokens.paren_left))return null;const e=[];do{if(this._check(Pe.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Pe.tokens.comma));return this._consume(Pe.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Pe.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Pe.tokens.paren_right),this._updateNode(new uy([e]))}_paren_expression(){this._consume(Pe.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Pe.tokens.paren_right,"Expected ')'."),this._updateNode(new uy([e]))}_struct_decl(){if(!this._match(Pe.keywords.struct))return null;const e=this._currentLine,t=this._consume(Pe.tokens.ident,"Expected name for struct.").toString();this._consume(Pe.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Pe.tokens.brace_right);){const a=this._attribute(),o=this._consume(Pe.tokens.name,"Expected variable name.").toString();this._consume(Pe.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=u),this._check(Pe.tokens.brace_right)?this._match(Pe.tokens.comma):this._consume(Pe.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new nG(o,d,a)))}this._consume(Pe.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new yA(t,n,e,i),e);return this._context.structs.set(t,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Pe.tokens.equal)){const t=this._const_expression(),n=[Cr.f32];try{const i=t.constEvaluate(this._exec,n);e.value=new gs(i,n[0]),this._exec.context.setVariable(e.name,i)}catch{e.value=t}}else{const t=new Sf(e.type,null),n=this._exec.evalExpression(t,this._exec.context);n!==null&&(e.value=new gs(n,e.type),this._exec.context.setVariable(e.name,n))}if(e.type!==null&&e.value instanceof gs){if(e.value.type.name!=="x32"&&this._exec.getTypeName(e.type)!==this._exec.getTypeName(e.value.type))throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof gs&&(e.type=e.value.type.name==="x32"?Cr.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Pe.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Pe.keywords.const))return null;const t=this._consume(Pe.tokens.name,"Expected variable name");let n=null;if(this._match(Pe.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}let i=null;this._consume(Pe.tokens.equal,"const declarations require an assignment");const s=this._short_circuit_or_expression();try{let o=[Cr.f32];const u=s.constEvaluate(this._exec,o);u instanceof Pt&&this._validateTypeRange(u.value,o[0]),o[0]instanceof Xt&&o[0].format===null&&u.typeInfo instanceof gA&&u.typeInfo.format!==null&&(u.typeInfo.format.name==="f16"?o[0].format=Cr.f16:u.typeInfo.format.name==="f32"?o[0].format=Cr.f32:u.typeInfo.format.name==="i32"?o[0].format=Cr.i32:u.typeInfo.format.name==="u32"?o[0].format=Cr.u32:u.typeInfo.format.name==="bool"?o[0].format=Cr.bool:console.error(`TODO: impelement template format type ${u.typeInfo.format.name}`)),i=this._updateNode(new gs(u,o[0])),this._exec.context.setVariable(t.toString(),u)}catch{i=s}if(n!==null&&i instanceof gs){if(i.type.name!=="x32"&&this._exec.getTypeName(n)!==this._exec.getTypeName(i.type))throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n,i.isScalar&&this._validateTypeRange(i.scalarValue,i.type)}else n===null&&i instanceof gs&&(n=(e=i==null?void 0:i.type)!==null&&e!==void 0?e:Cr.f32,n===Cr.x32&&(n=Cr.i32));const a=this._updateNode(new lw(t.toString(),n,"","",i));return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(Pe.keywords.let))return null;const e=this._consume(Pe.tokens.name,"Expected variable name");let t=null;if(this._match(Pe.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}let n=null;if(this._match(Pe.tokens.equal)){n=this._const_expression();const i=[Cr.f32];try{const s=n.constEvaluate(this._exec,i);s!==null&&(n=new gs(s,i[0]))}catch{}}if(t!==null&&n instanceof gs){if(n.type.name!=="x32"&&this._exec.getTypeName(t)!==this._exec.getTypeName(n.type))throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${t.name}. Line:${this._currentLine}`);n.type=t}else t===null&&n instanceof gs&&(t=n.type.name==="x32"?Cr.i32:n.type);return n instanceof gs&&n.isScalar&&this._validateTypeRange(n.scalarValue,t),this._updateNode(new ly(e.toString(),t,"","",n))}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Pe.keywords.var))return null;let e="",t="";this._match(Pe.tokens.less_than)&&(e=this._consume(Pe.storage_class,"Expected storage_class.").toString(),this._match(Pe.tokens.comma)&&(t=this._consume(Pe.access_mode,"Expected access_mode.").toString()),this._consume(Pe.tokens.greater_than,"Expected '>'."));const n=this._consume(Pe.tokens.name,"Expected variable name");let i=null;if(this._match(Pe.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}return this._updateNode(new _A(n.toString(),i,e,t,null))}_override_decl(){if(!this._match(Pe.keywords.override))return null;const e=this._consume(Pe.tokens.name,"Expected variable name");let t=null;if(this._match(Pe.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return this._updateNode(new aw(e.toString(),t,null))}_diagnostic(){this._consume(Pe.tokens.paren_left,"Expected '('");const e=this._consume(Pe.tokens.ident,"Expected severity control name.");this._consume(Pe.tokens.comma,"Expected ','");let t=this._consume(Pe.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Pe.tokens.period)&&(t+=`.${this._consume(Pe.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Pe.tokens.paren_right,"Expected ')'"),this._updateNode(new C5(e.toString(),t))}_enable_directive(){const e=this._consume(Pe.tokens.ident,"identity expected.");return this._updateNode(new Y$(e.toString()))}_requires_directive(){const e=[this._consume(Pe.tokens.ident,"identity expected.").toString()];for(;this._match(Pe.tokens.comma);){const t=this._consume(Pe.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new Z$(e))}_type_alias(){const e=this._consume(Pe.tokens.ident,"identity expected.");this._consume(Pe.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new uw(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Pe.tokens.ident,...Pe.texel_format,Pe.keywords.bool,Pe.keywords.f32,Pe.keywords.i32,Pe.keywords.u32])){const n=this._advance(),i=n.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:this._updateNode(new Cr(n.toString()))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Pe.template_types)){let n=this._advance().toString(),i=null,s=null;return this._match(Pe.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(Pe.tokens.comma)&&(s=this._consume(Pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(Pe.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Xt(n,i,s))}if(this._match(Pe.keywords.ptr)){let n=this._previous().toString();this._consume(Pe.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(Pe.storage_class,"Expected storage_class for pointer");this._consume(Pe.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let a=null;return this._match(Pe.tokens.comma)&&(a=this._consume(Pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(Pe.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new eG(n,i.toString(),s,a))}const t=this._attribute();if(this._match(Pe.keywords.array)){let n=null,i=-1;const s=this._previous();let a=null;if(this._match(Pe.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let u="";if(this._match(Pe.tokens.comma)){a=this._shift_expression();try{u=a.constEvaluate(this._exec).toString(),a=null}catch{u="1"}}this._consume(Pe.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const o=this._updateNode(new S5(s.toString(),t,n,i));return a&&this._deferArrayCountEval.push({arrayType:o,countNode:a}),o}return null}_texture_sampler_types(){if(this._match(Pe.sampler_type))return this._updateNode(new Pg(this._previous().toString(),null,null));if(this._match(Pe.depth_texture_type))return this._updateNode(new Pg(this._previous().toString(),null,null));if(this._match(Pe.sampled_texture_type)||this._match(Pe.multisampled_texture_type)){const e=this._previous();this._consume(Pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Pg(e.toString(),t,null))}if(this._match(Pe.storage_texture_type)){const e=this._previous();this._consume(Pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Pe.texel_format,"Invalid texel format.").toString();this._consume(Pe.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Pe.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Pg(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(Pe.tokens.attr);){const t=this._consume(Pe.attribute_name,"Expected attribute name"),n=this._updateNode(new iG(t.toString(),null));if(this._match(Pe.tokens.paren_left)){if(n.value=this._consume(Pe.literal_or_ident,"Expected attribute value").toString(),this._check(Pe.tokens.comma)){this._advance();do{const i=this._consume(Pe.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(Pe.tokens.comma))}this._consume(Pe.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}},yG=class extends Fg{constructor(e){super(),e&&this.update(e)}update(e){const t=new _G().parse(e);this.updateAST(t)}};function bG(r){var s;const e={attributes:[],bindings:[]};let t;try{t=vG(r)}catch(a){return yr.error(a.message)(),e}for(const a of t.uniforms){const o=[];for(const u of((s=a.type)==null?void 0:s.members)||[])o.push({name:u.name,type:N5(u.type)});e.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:o})}for(const a of t.textures)e.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of t.samplers)e.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const n=t.entry.vertex[0],i=(n==null?void 0:n.inputs.length)||0;for(let a=0;a<i;a++){const o=n.inputs[a];if(o.locationType==="location"){const u=N5(o.type);e.attributes.push({name:o.name,location:Number(o.location),type:u})}}return e}function N5(r){return r.format?`${r.name}<${r.format.name}>`:r.name}function vG(r){try{return new yG(r)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const wG=1/Math.PI*180,xG=1/180*Math.PI,BG={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...BG}};const mo=globalThis.mathgl.config;function CG(r){let{precision:e=mo.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=IG(r),`${parseFloat(r.toPrecision(e))}`}function vA(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function TG(r){return SG(r)}function EG(r){return Rc(r)}function SG(r,e){return Aw(r,t=>t*xG,e)}function Rc(r,e){return Aw(r,t=>t*wG,e)}function Lc(r,e,t){return Aw(r,n=>Math.max(e,Math.min(t,n)))}function my(r,e,t){return vA(r)?r.map((n,i)=>my(n,e[i],t)):t*e+(1-t)*r}function Oc(r,e,t){const n=mo.EPSILON;t&&(mo.EPSILON=t);try{if(r===e)return!0;if(vA(r)&&vA(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!Oc(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=mo.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{mo.EPSILON=n}}function IG(r){return Math.round(r/mo.EPSILON)*mo.EPSILON}function MG(r){return r.clone?r.clone():new Array(r.length)}function Aw(r,e,t){if(vA(r)){const n=r;t=t||MG(n);for(let i=0;i<t.length&&i<n.length;++i){const s=typeof r=="number"?r:r[i];t[i]=e(s,i,t)}return t}return e(r)}class fw extends Array{clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:vA(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(mo)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+CG(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Oc(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],a=typeof t=="number"?t:t[i];this[i]=s+n*(a-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(mo.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function PG(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function ai(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function Rg(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(mo.debug&&!PG(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function Uc(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}class dw extends fw{get x(){return this[0]}set x(e){this[0]=ai(e)}get y(){return this[1]}set y(e){this[1]=ai(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return ai(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return ai(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const i of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Uc(e>=0&&e<this.ELEMENTS,"index is out of range"),ai(this[e])}setComponent(e,t){return Uc(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Lg=1e-6;let Dc=typeof Float32Array<"u"?Float32Array:Array;function FG(){const r=new Dc(2);return Dc!=Float32Array&&(r[0]=0,r[1]=0),r}function k5(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function RG(r,e){return r[0]=-e[0],r[1]=-e[1],r}function Q5(r,e,t,n){const i=e[0],s=e[1];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r}function LG(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r}function OG(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i+t[4],r[1]=t[1]*n+t[3]*i+t[5],r}function z5(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[3]*i+t[6],r[1]=t[1]*n+t[4]*i+t[7],r}function H5(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){const r=FG();return function(e,t,n,i,s,a){let o,u;for(t||(t=2),n||(n=0),i?u=Math.min(i*t+n,e.length):u=e.length,o=n;o<u;o+=t)r[0]=e[o],r[1]=e[o+1],s(r,r,a),e[o]=r[0],e[o+1]=r[1];return e}})();function V5(r,e,t){const n=e[0],i=e[1],s=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/s,r[1]=(t[1]*n+t[5]*i)/s,r}function j5(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s||1;return r[0]=(t[0]*n+t[4]*i+t[8]*s)/a,r[1]=(t[1]*n+t[5]*i+t[9]*s)/a,r[2]=(t[2]*n+t[6]*i+t[10]*s)/a,r}function UG(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function DG(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r[3]=e[3],r}function $5(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n+t[3]*i+t[6]*s,r[1]=t[1]*n+t[4]*i+t[7]*s,r[2]=t[2]*n+t[5]*i+t[8]*s,r[3]=e[3],r}class pw extends dw{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),vA(e)&&arguments.length===1?this.copy(e):(mo.debug&&(ai(e),ai(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return mo.debug&&(ai(e.x),ai(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return H5(this,this,e),this.check()}transformAsVector(e){return V5(this,this,e),this.check()}transformByMatrix3(e){return z5(this,this,e),this.check()}transformByMatrix2x3(e){return OG(this,this,e),this.check()}transformByMatrix2(e){return LG(this,this,e),this.check()}}function G5(){const r=new Dc(3);return Dc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function q5(r){const e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)}function K5(r,e,t){const n=new Dc(3);return n[0]=r,n[1]=e,n[2]=t,n}function NG(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function kG(r){const e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n}function QG(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function zG(r,e){const t=e[0],n=e[1],i=e[2];let s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function gw(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function _y(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],u=t[2];return r[0]=i*u-s*o,r[1]=s*a-n*u,r[2]=n*o-i*a,r}function HG(r,e,t,n){const i=e[0],s=e[1],a=e[2];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r[2]=a+n*(t[2]-a),r}function mw(r,e,t){const n=e[0],i=e[1],s=e[2];let a=t[3]*n+t[7]*i+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/a,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}function W5(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=n*t[0]+i*t[3]+s*t[6],r[1]=n*t[1]+i*t[4]+s*t[7],r[2]=n*t[2]+i*t[5]+s*t[8],r}function X5(r,e,t){const n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],u=e[1],d=e[2];let p=i*d-s*u,_=s*o-n*d,w=n*u-i*o,v=i*w-s*_,M=s*p-n*w,P=n*_-i*p;const D=a*2;return p*=D,_*=D,w*=D,v*=2,M*=2,P*=2,r[0]=o+p+v,r[1]=u+_+M,r[2]=d+w+P,r}function VG(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function jG(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function $G(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function GG(r,e){const t=r[0],n=r[1],i=r[2],s=e[0],a=e[1],o=e[2],u=Math.sqrt((t*t+n*n+i*i)*(s*s+a*a+o*o)),d=u&&gw(r,e)/u;return Math.acos(Math.min(Math.max(d,-1),1))}const Y5=NG,Z5=q5,_w=kG;(function(){const r=G5();return function(e,t,n,i,s,a){let o,u;for(t||(t=3),n||(n=0),i?u=Math.min(i*t+n,e.length):u=e.length,o=n;o<u;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();const yw=[0,0,0];let yy;class Mt extends dw{static get ZERO(){return yy||(yy=new Mt(0,0,0),Object.freeze(yy)),yy}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&vA(e)?this.copy(e):(mo.debug&&(ai(e),ai(t),ai(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return mo.debug&&(ai(e.x),ai(e.y),ai(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ai(e)}angle(e){return GG(this,e)}cross(e){return _y(this,this,e),this.check()}rotateX(e){let{radians:t,origin:n=yw}=e;return VG(this,this,n,t),this.check()}rotateY(e){let{radians:t,origin:n=yw}=e;return jG(this,this,n,t),this.check()}rotateZ(e){let{radians:t,origin:n=yw}=e;return $G(this,this,n,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return mw(this,this,e),this.check()}transformAsVector(e){return j5(this,this,e),this.check()}transformByMatrix3(e){return W5(this,this,e),this.check()}transformByMatrix2(e){return UG(this,this,e),this.check()}transformByQuaternion(e){return X5(this,this,e),this.check()}}let by;class bw extends dw{static get ZERO(){return by||(by=new bw(0,0,0,0),Object.freeze(by)),by}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),vA(e)&&arguments.length===1?this.copy(e):(mo.debug&&(ai(e),ai(t),ai(n),ai(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return mo.debug&&(ai(e.x),ai(e.y),ai(e.z),ai(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ai(e)}get w(){return this[3]}set w(e){this[3]=ai(e)}transform(e){return mw(this,this,e),this.check()}transformByMatrix3(e){return $5(this,this,e),this.check()}transformByMatrix2(e){return DG(this,this,e),this.check()}transformByQuaternion(e){return X5(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class J5 extends fw{toString(){let e="[";if(mo.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=ai(n),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}function qG(){const r=new Dc(9);return Dc!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function KG(r,e){if(r===e){const t=e[1],n=e[2],i=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=n,r[7]=i}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function WG(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],d=e[7],p=e[8],_=p*a-o*d,w=-p*s+o*u,v=d*s-a*u;let M=t*_+n*w+i*v;return M?(M=1/M,r[0]=_*M,r[1]=(-p*n+i*d)*M,r[2]=(o*n-i*a)*M,r[3]=w*M,r[4]=(p*t-i*u)*M,r[5]=(-o*t+i*s)*M,r[6]=v*M,r[7]=(-d*t+n*u)*M,r[8]=(a*t-n*s)*M,r):null}function XG(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],u=r[7],d=r[8];return e*(d*s-a*u)+t*(-d*i+a*o)+n*(u*i-s*o)}function eM(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],d=e[6],p=e[7],_=e[8],w=t[0],v=t[1],M=t[2],P=t[3],D=t[4],N=t[5],z=t[6],W=t[7],V=t[8];return r[0]=w*n+v*a+M*d,r[1]=w*i+v*o+M*p,r[2]=w*s+v*u+M*_,r[3]=P*n+D*a+N*d,r[4]=P*i+D*o+N*p,r[5]=P*s+D*u+N*_,r[6]=z*n+W*a+V*d,r[7]=z*i+W*o+V*p,r[8]=z*s+W*u+V*_,r}function YG(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],d=e[6],p=e[7],_=e[8],w=t[0],v=t[1];return r[0]=n,r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=u,r[6]=w*n+v*a+d,r[7]=w*i+v*o+p,r[8]=w*s+v*u+_,r}function ZG(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],d=e[6],p=e[7],_=e[8],w=Math.sin(t),v=Math.cos(t);return r[0]=v*n+w*a,r[1]=v*i+w*o,r[2]=v*s+w*u,r[3]=v*a-w*n,r[4]=v*o-w*i,r[5]=v*u-w*s,r[6]=d,r[7]=p,r[8]=_,r}function tM(r,e,t){const n=t[0],i=t[1];return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function JG(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,u=i+i,d=t*a,p=n*a,_=n*o,w=i*a,v=i*o,M=i*u,P=s*a,D=s*o,N=s*u;return r[0]=1-_-M,r[3]=p-N,r[6]=w+D,r[1]=p+N,r[4]=1-d-M,r[7]=v-P,r[2]=w-D,r[5]=v+P,r[8]=1-d-_,r}var vw;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(vw||(vw={}));const eq=Object.freeze([1,0,0,0,1,0,0,0,1]);class ms extends J5{static get IDENTITY(){return rq()}static get ZERO(){return tq()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return vw}constructor(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(eq)}fromObject(e){return this.check()}fromQuaternion(e){return JG(this,e),this.check()}set(e,t,n,i,s,a,o,u,d){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=u,this[8]=d,this.check()}setRowMajor(e,t,n,i,s,a,o,u,d){return this[0]=e,this[1]=i,this[2]=o,this[3]=t,this[4]=s,this[5]=u,this[6]=n,this[7]=a,this[8]=d,this.check()}determinant(){return XG(this)}transpose(){return KG(this,this),this.check()}invert(){return WG(this,this),this.check()}multiplyLeft(e){return eM(this,e,this),this.check()}multiplyRight(e){return eM(this,this,e),this.check()}rotate(e){return ZG(this,this,e),this.check()}scale(e){return Array.isArray(e)?tM(this,this,e):tM(this,this,[e,e]),this.check()}translate(e){return YG(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=z5(t||[-0,-0],e,this);break;case 3:n=W5(t||[-0,-0,-0],e,this);break;case 4:n=$5(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Rg(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let vy,wy=null;function tq(){return vy||(vy=new ms([0,0,0,0,0,0,0,0,0]),Object.freeze(vy)),vy}function rq(){return wy||(wy=new ms,Object.freeze(wy)),wy}function nq(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function iq(r,e){if(r===e){const t=e[1],n=e[2],i=e[3],s=e[6],a=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=s,r[11]=e[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function ww(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],d=e[7],p=e[8],_=e[9],w=e[10],v=e[11],M=e[12],P=e[13],D=e[14],N=e[15],z=t*o-n*a,W=t*u-i*a,V=t*d-s*a,$=n*u-i*o,q=n*d-s*o,te=i*d-s*u,J=p*P-_*M,me=p*D-w*M,xe=p*N-v*M,se=_*D-w*P,oe=_*N-v*P,ve=w*N-v*D;let ge=z*ve-W*oe+V*se+$*xe-q*me+te*J;return ge?(ge=1/ge,r[0]=(o*ve-u*oe+d*se)*ge,r[1]=(i*oe-n*ve-s*se)*ge,r[2]=(P*te-D*q+N*$)*ge,r[3]=(w*q-_*te-v*$)*ge,r[4]=(u*xe-a*ve-d*me)*ge,r[5]=(t*ve-i*xe+s*me)*ge,r[6]=(D*V-M*te-N*W)*ge,r[7]=(p*te-w*V+v*W)*ge,r[8]=(a*oe-o*xe+d*J)*ge,r[9]=(n*xe-t*oe-s*J)*ge,r[10]=(M*q-P*V+N*z)*ge,r[11]=(_*V-p*q-v*z)*ge,r[12]=(o*me-a*se-u*J)*ge,r[13]=(t*se-n*me+i*J)*ge,r[14]=(P*W-M*$-D*z)*ge,r[15]=(p*$-_*W+w*z)*ge,r):null}function sq(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],u=r[7],d=r[8],p=r[9],_=r[10],w=r[11],v=r[12],M=r[13],P=r[14],D=r[15],N=e*a-t*s,z=e*o-n*s,W=t*o-n*a,V=d*M-p*v,$=d*P-_*v,q=p*P-_*M,te=e*q-t*$+n*V,J=s*q-a*$+o*V,me=d*W-p*z+_*N,xe=v*W-M*z+P*N;return u*te-i*J+D*me-w*xe}function Mf(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],d=e[6],p=e[7],_=e[8],w=e[9],v=e[10],M=e[11],P=e[12],D=e[13],N=e[14],z=e[15];let W=t[0],V=t[1],$=t[2],q=t[3];return r[0]=W*n+V*o+$*_+q*P,r[1]=W*i+V*u+$*w+q*D,r[2]=W*s+V*d+$*v+q*N,r[3]=W*a+V*p+$*M+q*z,W=t[4],V=t[5],$=t[6],q=t[7],r[4]=W*n+V*o+$*_+q*P,r[5]=W*i+V*u+$*w+q*D,r[6]=W*s+V*d+$*v+q*N,r[7]=W*a+V*p+$*M+q*z,W=t[8],V=t[9],$=t[10],q=t[11],r[8]=W*n+V*o+$*_+q*P,r[9]=W*i+V*u+$*w+q*D,r[10]=W*s+V*d+$*v+q*N,r[11]=W*a+V*p+$*M+q*z,W=t[12],V=t[13],$=t[14],q=t[15],r[12]=W*n+V*o+$*_+q*P,r[13]=W*i+V*u+$*w+q*D,r[14]=W*s+V*d+$*v+q*N,r[15]=W*a+V*p+$*M+q*z,r}function xy(r,e,t){const n=t[0],i=t[1],s=t[2];let a,o,u,d,p,_,w,v,M,P,D,N;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*s+e[12],r[13]=e[1]*n+e[5]*i+e[9]*s+e[13],r[14]=e[2]*n+e[6]*i+e[10]*s+e[14],r[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(a=e[0],o=e[1],u=e[2],d=e[3],p=e[4],_=e[5],w=e[6],v=e[7],M=e[8],P=e[9],D=e[10],N=e[11],r[0]=a,r[1]=o,r[2]=u,r[3]=d,r[4]=p,r[5]=_,r[6]=w,r[7]=v,r[8]=M,r[9]=P,r[10]=D,r[11]=N,r[12]=a*n+p*i+M*s+e[12],r[13]=o*n+_*i+P*s+e[13],r[14]=u*n+w*i+D*s+e[14],r[15]=d*n+v*i+N*s+e[15]),r}function xw(r,e,t){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function oq(r,e,t,n){let i=n[0],s=n[1],a=n[2],o=Math.sqrt(i*i+s*s+a*a),u,d,p,_,w,v,M,P,D,N,z,W,V,$,q,te,J,me,xe,se,oe,ve,ge,Je;return o<Lg?null:(o=1/o,i*=o,s*=o,a*=o,d=Math.sin(t),u=Math.cos(t),p=1-u,_=e[0],w=e[1],v=e[2],M=e[3],P=e[4],D=e[5],N=e[6],z=e[7],W=e[8],V=e[9],$=e[10],q=e[11],te=i*i*p+u,J=s*i*p+a*d,me=a*i*p-s*d,xe=i*s*p-a*d,se=s*s*p+u,oe=a*s*p+i*d,ve=i*a*p+s*d,ge=s*a*p-i*d,Je=a*a*p+u,r[0]=_*te+P*J+W*me,r[1]=w*te+D*J+V*me,r[2]=v*te+N*J+$*me,r[3]=M*te+z*J+q*me,r[4]=_*xe+P*se+W*oe,r[5]=w*xe+D*se+V*oe,r[6]=v*xe+N*se+$*oe,r[7]=M*xe+z*se+q*oe,r[8]=_*ve+P*ge+W*Je,r[9]=w*ve+D*ge+V*Je,r[10]=v*ve+N*ge+$*Je,r[11]=M*ve+z*ge+q*Je,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function rM(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[4],a=e[5],o=e[6],u=e[7],d=e[8],p=e[9],_=e[10],w=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+d*n,r[5]=a*i+p*n,r[6]=o*i+_*n,r[7]=u*i+w*n,r[8]=d*i-s*n,r[9]=p*i-a*n,r[10]=_*i-o*n,r[11]=w*i-u*n,r}function aq(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],u=e[3],d=e[8],p=e[9],_=e[10],w=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-d*n,r[1]=a*i-p*n,r[2]=o*i-_*n,r[3]=u*i-w*n,r[8]=s*n+d*i,r[9]=a*n+p*i,r[10]=o*n+_*i,r[11]=u*n+w*i,r}function nM(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],u=e[3],d=e[4],p=e[5],_=e[6],w=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+d*n,r[1]=a*i+p*n,r[2]=o*i+_*n,r[3]=u*i+w*n,r[4]=d*i-s*n,r[5]=p*i-a*n,r[6]=_*i-o*n,r[7]=w*i-u*n,r}function lq(r,e){const t=e[0],n=e[1],i=e[2],s=e[4],a=e[5],o=e[6],u=e[8],d=e[9],p=e[10];return r[0]=Math.sqrt(t*t+n*n+i*i),r[1]=Math.sqrt(s*s+a*a+o*o),r[2]=Math.sqrt(u*u+d*d+p*p),r}function cq(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,u=i+i,d=t*a,p=n*a,_=n*o,w=i*a,v=i*o,M=i*u,P=s*a,D=s*o,N=s*u;return r[0]=1-_-M,r[1]=p+N,r[2]=w-D,r[3]=0,r[4]=p-N,r[5]=1-d-M,r[6]=v+P,r[7]=0,r[8]=w+D,r[9]=v-P,r[10]=1-d-_,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function uq(r,e,t,n,i,s,a){const o=1/(t-e),u=1/(i-n),d=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*u,r[6]=0,r[7]=0,r[8]=(t+e)*o,r[9]=(i+n)*u,r[10]=(a+s)*d,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*d,r[15]=0,r}function hq(r,e,t,n,i){const s=1/Math.tan(e/2);if(r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){const a=1/(n-i);r[10]=(i+n)*a,r[14]=2*i*n*a}else r[10]=-1,r[14]=-2*n;return r}const Aq=hq;function fq(r,e,t,n,i,s,a){const o=1/(e-t),u=1/(n-i),d=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*u,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*d,r[11]=0,r[12]=(e+t)*o,r[13]=(i+n)*u,r[14]=(a+s)*d,r[15]=1,r}const dq=fq;function pq(r,e,t,n){let i,s,a,o,u,d,p,_,w,v;const M=e[0],P=e[1],D=e[2],N=n[0],z=n[1],W=n[2],V=t[0],$=t[1],q=t[2];return Math.abs(M-V)<Lg&&Math.abs(P-$)<Lg&&Math.abs(D-q)<Lg?nq(r):(_=M-V,w=P-$,v=D-q,i=1/Math.sqrt(_*_+w*w+v*v),_*=i,w*=i,v*=i,s=z*v-W*w,a=W*_-N*v,o=N*w-z*_,i=Math.sqrt(s*s+a*a+o*o),i?(i=1/i,s*=i,a*=i,o*=i):(s=0,a=0,o=0),u=w*o-v*a,d=v*s-_*o,p=_*a-w*s,i=Math.sqrt(u*u+d*d+p*p),i?(i=1/i,u*=i,d*=i,p*=i):(u=0,d=0,p=0),r[0]=s,r[1]=u,r[2]=_,r[3]=0,r[4]=a,r[5]=d,r[6]=w,r[7]=0,r[8]=o,r[9]=p,r[10]=v,r[11]=0,r[12]=-(s*M+a*P+o*D),r[13]=-(u*M+d*P+p*D),r[14]=-(_*M+w*P+v*D),r[15]=1,r)}function gq(){const r=new Dc(4);return Dc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function mq(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function Bw(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function _q(r){const e=r[0],t=r[1],n=r[2],i=r[3];return Math.sqrt(e*e+t*t+n*n+i*i)}function yq(r){const e=r[0],t=r[1],n=r[2],i=r[3];return e*e+t*t+n*n+i*i}function bq(r,e){const t=e[0],n=e[1],i=e[2],s=e[3];let a=t*t+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=t*a,r[1]=n*a,r[2]=i*a,r[3]=s*a,r}function vq(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function wq(r,e,t,n){const i=e[0],s=e[1],a=e[2],o=e[3];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r[2]=a+n*(t[2]-a),r[3]=o+n*(t[3]-o),r}function Hd(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*a,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*a,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*a,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*a,r}function xq(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],u=t[2],d=t[3],p=d*n+o*s-u*i,_=d*i+u*n-a*s,w=d*s+a*i-o*n,v=-a*n-o*i-u*s;return r[0]=p*d+v*-a+_*-u-w*-o,r[1]=_*d+v*-o+w*-a-p*-u,r[2]=w*d+v*-u+p*-o-_*-a,r[3]=e[3],r}(function(){const r=gq();return function(e,t,n,i,s,a){let o,u;for(t||(t=4),n||(n=0),i?u=Math.min(i*t+n,e.length):u=e.length,o=n;o<u;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();var Cw;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(Cw||(Cw={}));const Bq=45*Math.PI/180,Cq=1,Tw=.1,Ew=500,Tq=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class kn extends J5{static get IDENTITY(){return Sq()}static get ZERO(){return Eq()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Cw}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,s,a,o,u,d,p,_,w,v,M,P,D){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=u,this[8]=d,this[9]=p,this[10]=_,this[11]=w,this[12]=v,this[13]=M,this[14]=P,this[15]=D,this.check()}setRowMajor(e,t,n,i,s,a,o,u,d,p,_,w,v,M,P,D){return this[0]=e,this[1]=s,this[2]=d,this[3]=v,this[4]=t,this[5]=a,this[6]=p,this[7]=M,this[8]=n,this[9]=o,this[10]=_,this[11]=P,this[12]=i,this[13]=u,this[14]=w,this[15]=D,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Tq)}fromObject(e){return this.check()}fromQuaternion(e){return cq(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:s,near:a=Tw,far:o=Ew}=e;return o===1/0?Iq(this,t,n,i,s,a):uq(this,t,n,i,s,a,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return pq(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:s,near:a=Tw,far:o=Ew}=e;return dq(this,t,n,i,s,a,o),this.check()}orthographic(e){const{fovy:t=Bq,aspect:n=Cq,focalDistance:i=1,near:s=Tw,far:a=Ew}=e;iM(t);const o=t/2,u=i*Math.tan(o),d=u*n;return this.ortho({left:-d,right:d,bottom:-u,top:u,near:s,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=e;return iM(t),Aq(this,t,n,i,s),this.check()}determinant(){return sq(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return iq(this,this),this.check()}invert(){return ww(this,this),this.check()}multiplyLeft(e){return Mf(this,e,this),this.check()}multiplyRight(e){return Mf(this,this,e),this.check()}rotateX(e){return rM(this,this,e),this.check()}rotateY(e){return aq(this,this,e),this.check()}rotateZ(e){return nM(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return oq(this,this,e,t),this.check()}scale(e){return xw(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return xy(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Hd(t||[-0,-0,-0,-0],e,this),Rg(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=H5(t||[-0,-0],e,this);break;case 3:i=mw(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Rg(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=V5(t||[-0,-0],e,this);break;case 3:n=j5(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Rg(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let By,Cy;function Eq(){return By||(By=new kn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(By)),By}function Sq(){return Cy||(Cy=new kn,Object.freeze(Cy)),Cy}function iM(r){if(r>Math.PI*2)throw Error("expected radians")}function Iq(r,e,t,n,i,s){const a=2*s/(t-e),o=2*s/(i-n),u=(t+e)/(t-e),d=(i+n)/(i-n),p=-1,_=-1,w=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=u,r[9]=d,r[10]=p,r[11]=_,r[12]=0,r[13]=0,r[14]=w,r[15]=0,r}function sM(){const r=new Dc(4);return Dc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Mq(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function oM(r,e,t){t=t*.5;const n=Math.sin(t);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r}function aM(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=t[0],u=t[1],d=t[2],p=t[3];return r[0]=n*p+a*o+i*d-s*u,r[1]=i*p+a*u+s*o-n*d,r[2]=s*p+a*d+n*u-i*o,r[3]=a*p-n*o-i*u-s*d,r}function Pq(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),u=Math.cos(t);return r[0]=n*u+a*o,r[1]=i*u+s*o,r[2]=s*u-i*o,r[3]=a*u-n*o,r}function Fq(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),u=Math.cos(t);return r[0]=n*u-s*o,r[1]=i*u+a*o,r[2]=s*u+n*o,r[3]=a*u-i*o,r}function Rq(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),u=Math.cos(t);return r[0]=n*u+i*o,r[1]=i*u-n*o,r[2]=s*u+a*o,r[3]=a*u-s*o,r}function Lq(r,e){const t=e[0],n=e[1],i=e[2];return r[0]=t,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-t*t-n*n-i*i)),r}function Ty(r,e,t,n){const i=e[0],s=e[1],a=e[2],o=e[3];let u=t[0],d=t[1],p=t[2],_=t[3],w,v,M,P,D;return w=i*u+s*d+a*p+o*_,w<0&&(w=-w,u=-u,d=-d,p=-p,_=-_),1-w>Lg?(v=Math.acos(w),D=Math.sin(v),M=Math.sin((1-n)*v)/D,P=Math.sin(n*v)/D):(M=1-n,P=n),r[0]=M*i+P*u,r[1]=M*s+P*d,r[2]=M*a+P*p,r[3]=M*o+P*_,r}function Oq(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t*t+n*n+i*i+s*s,o=a?1/a:0;return r[0]=-t*o,r[1]=-n*o,r[2]=-i*o,r[3]=s*o,r}function Uq(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function lM(r,e){const t=e[0]+e[4]+e[8];let n;if(t>0)n=Math.sqrt(t+1),r[3]=.5*n,n=.5/n,r[0]=(e[5]-e[7])*n,r[1]=(e[6]-e[2])*n,r[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[s*3+s]-e[a*3+a]+1),r[i]=.5*n,n=.5/n,r[3]=(e[s*3+a]-e[a*3+s])*n,r[s]=(e[s*3+i]+e[i*3+s])*n,r[a]=(e[a*3+i]+e[i*3+a])*n}return r}const Dq=mq,Nq=Bw,kq=vq,Qq=wq,zq=_q,Hq=yq,cM=bq,Vq=function(){const r=G5(),e=K5(1,0,0),t=K5(0,1,0);return function(n,i,s){const a=gw(i,s);return a<-.999999?(_y(r,e,i),Z5(r)<1e-6&&_y(r,t,i),zG(r,r),oM(n,r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(_y(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+a,cM(n,n))}}();(function(){const r=sM(),e=sM();return function(t,n,i,s,a,o){return Ty(r,n,a,o),Ty(e,i,s,o),Ty(t,r,e,2*o*(1-o)),t}})(),function(){const r=qG();return function(e,t,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],cM(e,lM(e,r))}}();const jq=[0,0,0,1];class Og extends fw{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return lM(this,e),this.check()}fromAxisRotation(e,t){return oM(this,e,t),this.check()}identity(){return Mq(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ai(e)}get y(){return this[1]}set y(e){this[1]=ai(e)}get z(){return this[2]}set z(e){this[2]=ai(e)}get w(){return this[3]}set w(e){this[3]=ai(e)}len(){return zq(this)}lengthSquared(){return Hq(this)}dot(e){return kq(this,e)}rotationTo(e,t){return Vq(this,e,t),this.check()}add(e){return Dq(this,this,e),this.check()}calculateW(){return Lq(this,this),this.check()}conjugate(){return Uq(this,this),this.check()}invert(){return Oq(this,this),this.check()}lerp(e,t,n){return n===void 0?this.lerp(this,e,t):(Qq(this,e,t,n),this.check())}multiplyRight(e){return aM(this,this,e),this.check()}multiplyLeft(e){return aM(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return Pq(this,this,e),this.check()}rotateY(e){return Fq(this,this,e),this.check()}rotateZ(e){return Rq(this,this,e),this.check()}scale(e){return Nq(this,this,e),this.check()}slerp(e,t,n){let i,s,a;switch(arguments.length){case 1:({start:i=jq,target:s,ratio:a}=e);break;case 2:i=this,s=e,a=t;break;default:i=e,s=t,a=n}return Ty(this,i,s,a),this.check()}transformVector4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new bw;return xq(t,e,this),Rg(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const $q=.1,Gq=1e-12,uM=1e-15,qq=1e-20;function hM(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=Math.fround(r),i=r-n;return e[t]=n,e[t+1]=i,e}function Kq(r){return r-Math.fround(r)}function Wq(r){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let n=0;n<4;++n){const i=t*4+n;hM(r[n*4+t],e,i*2)}return e}const Xq={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`},Yq={name:"fp64arithmetic",vs:`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:hM,fp64LowPart:Kq,fp64ifyMatrix4:Wq},AM={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,getUniforms:Zq};function Zq(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)e.isHighlightActive=!1;else{e.isHighlightActive=!0;const t=r.highlightedObjectColor.slice(0,3);e.highlightedObjectColor=t}if(r.highlightColor){const t=Array.from(r.highlightColor,n=>n/255);Number.isFinite(t[3])||(t[3]=1),e.highlightColor=t}return r.isActive!==void 0&&(e.isActive=!!r.isActive,e.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(e.useFloatColors=!!r.useFloatColors),e}const fM=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,Jq=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,dM=3,eK=255;var Ug;(function(r){r[r.POINT=0]="POINT",r[r.DIRECTIONAL=1]="DIRECTIONAL"})(Ug||(Ug={}));const Vd={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:dM},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Ug.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:Jq,vs:fM,fs:fM,getUniforms:tK};function tK(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r=r&&{...r},!r)return{...Vd.defaultUniforms};r.lights&&(r={...r,...nK(r.lights),lights:void 0});const{ambientLight:t,pointLights:n,directionalLights:i}=r||{};if(!(t||n&&n.length>0||i&&i.length>0))return{...Vd.defaultUniforms,enabled:0};const a={...Vd.defaultUniforms,...e,...rK({ambientLight:t,pointLights:n,directionalLights:i})};return r.enabled!==void 0&&(a.enabled=r.enabled?1:0),a}function rK(r){let{ambientLight:e,pointLights:t=[],directionalLights:n=[]}=r;const i={};i.ambientLightColor=Sw(e);let s=0;for(const a of t){i.lightType=Ug.POINT;const o=s;i[`lightColor${o}`]=Sw(a),i[`lightPosition${o}`]=a.position,i[`lightAttenuation${o}`]=a.attenuation||[1,0,0],s++}for(const a of n){i.lightType=Ug.DIRECTIONAL;const o=s;i[`lightColor${o}`]=Sw(a),i[`lightDirection${o}`]=a.direction,s++}return s>dM&&yr.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=n.length,i.pointLightCount=t.length,i}function nK(r){var t,n;const e={pointLights:[],directionalLights:[]};for(const i of r||[])switch(i.type){case"ambient":e.ambientLight=i;break;case"directional":(t=e.directionalLights)==null||t.push(i);break;case"point":(n=e.pointLights)==null||n.push(i);break}return e}function Sw(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e=[0,0,0],intensity:t=1}=r;return e.map(n=>n*t/eK)}const pM=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,gM=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,mM={props:{},name:"gouraudMaterial",vs:gM.replace("phongMaterial","gouraudMaterial"),fs:pM.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Vd],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){const e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...mM.defaultUniforms,...e}}},_M={name:"phongMaterial",dependencies:[Vd],source:`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,vs:pM,fs:gM,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){const e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{..._M.defaultUniforms,...e}}},iK=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,sK=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,yM=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,Iw={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Vd,{name:"pbrProjection",vs:yM,fs:yM,getUniforms:r=>r,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}}],vs:iK,fs:sK,defines:{LIGHTING_FRAGMENT:1},getUniforms:r=>r,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},bM=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,oK={name:"layer",vs:bM,fs:bM,getUniforms:r=>({opacity:Math.pow(r.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},vM="#define SMOOTH_EDGE_RADIUS 0.5",aK=`
${vM}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,lK=`
${vM}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,wM={name:"geometry",vs:aK,fs:lK},cK=25;var eo;(function(r){r[r.Start=1]="Start",r[r.Move=2]="Move",r[r.End=4]="End",r[r.Cancel=8]="Cancel"})(eo||(eo={}));var _o;(function(r){r[r.None=0]="None",r[r.Left=1]="Left",r[r.Right=2]="Right",r[r.Up=4]="Up",r[r.Down=8]="Down",r[r.Horizontal=3]="Horizontal",r[r.Vertical=12]="Vertical",r[r.All=15]="All"})(_o||(_o={}));var wn;(function(r){r[r.Possible=1]="Possible",r[r.Began=2]="Began",r[r.Changed=4]="Changed",r[r.Ended=8]="Ended",r[r.Recognized=8]="Recognized",r[r.Cancelled=16]="Cancelled",r[r.Failed=32]="Failed"})(wn||(wn={}));const uK="compute",hK="auto",Mw="manipulation",Ey="none",Pw="pan-x",Fw="pan-y";function AK(r){if(r.includes(Ey))return Ey;const e=r.includes(Pw),t=r.includes(Fw);return e&&t?Ey:e||t?e?Pw:Fw:r.includes(Mw)?Mw:hK}class fK{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===uK&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return AK(e.join(" "))}}function Sy(r){return r.trim().split(/\s+/g)}function Rw(r,e,t){if(r)for(const n of Sy(e))r.addEventListener(n,t,!1)}function Lw(r,e,t){if(r)for(const n of Sy(e))r.removeEventListener(n,t,!1)}function xM(r){return(r.ownerDocument||r).defaultView}function dK(r,e){let t=r;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function BM(r){const e=r.length;if(e===1)return{x:Math.round(r[0].clientX),y:Math.round(r[0].clientY)};let t=0,n=0,i=0;for(;i<e;)t+=r[i].clientX,n+=r[i].clientY,i++;return{x:Math.round(t/e),y:Math.round(n/e)}}function CM(r){const e=[];let t=0;for(;t<r.pointers.length;)e[t]={clientX:Math.round(r.pointers[t].clientX),clientY:Math.round(r.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:BM(e),deltaX:r.deltaX,deltaY:r.deltaY}}function TM(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.sqrt(t*t+n*n)}function EM(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.sqrt(t*t+n*n)}function pK(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.atan2(n,t)*180/Math.PI}function SM(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.atan2(n,t)*180/Math.PI}function IM(r,e){return r===e?_o.None:Math.abs(r)>=Math.abs(e)?r<0?_o.Left:_o.Right:e<0?_o.Up:_o.Down}function gK(r,e){const t=e.center;let n=r.offsetDelta,i=r.prevDelta;const s=r.prevInput;return(e.eventType===eo.Start||(s==null?void 0:s.eventType)===eo.End)&&(i=r.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},n=r.offsetDelta={x:t.x,y:t.y}),{deltaX:i.x+(t.x-n.x),deltaY:i.y+(t.y-n.y)}}function MM(r,e,t){return{x:e/r||0,y:t/r||0}}function mK(r,e){return EM(e[0],e[1])/EM(r[0],r[1])}function _K(r,e){return SM(e[1],e[0])-SM(r[1],r[0])}function yK(r,e){const t=r.lastInterval||e,n=e.timeStamp-t.timeStamp;let i,s,a,o;if(e.eventType!==eo.Cancel&&(n>cK||t.velocity===void 0)){const u=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,p=MM(n,u,d);s=p.x,a=p.y,i=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,o=IM(u,d),r.lastInterval=e}else i=t.velocity,s=t.velocityX,a=t.velocityY,o=t.direction;e.velocity=i,e.velocityX=s,e.velocityY=a,e.direction=o}function bK(r,e){const{session:t}=r,{pointers:n}=e,{length:i}=n;t.firstInput||(t.firstInput=CM(e)),i>1&&!t.firstMultiple?t.firstMultiple=CM(e):i===1&&(t.firstMultiple=!1);const{firstInput:s,firstMultiple:a}=t,o=a?a.center:s.center,u=e.center=BM(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=pK(o,u),e.distance=TM(o,u);const{deltaX:d,deltaY:p}=gK(t,e);e.deltaX=d,e.deltaY=p,e.offsetDirection=IM(e.deltaX,e.deltaY);const _=MM(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=a?mK(a.pointers,n):1,e.rotation=a?_K(a.pointers,n):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let w=r.element;return dK(e.srcEvent.target,w)&&(w=e.srcEvent.target),e.target=w,yK(t,e),e}function vK(r,e,t){const n=t.pointers.length,i=t.changedPointers.length,s=e&eo.Start&&n-i===0,a=e&(eo.End|eo.Cancel)&&n-i===0;t.isFirst=!!s,t.isFinal=!!a,s&&(r.session={}),t.eventType=e;const o=bK(r,t);r.emit("hammer.input",o),r.recognize(o),r.session.prevInput=o}let wK=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){vK(this.manager,e,t)}init(){Rw(this.element,this.evEl,this.domHandler),Rw(this.target,this.evTarget,this.domHandler),Rw(xM(this.element),this.evWin,this.domHandler)}destroy(){Lw(this.element,this.evEl,this.domHandler),Lw(this.target,this.evTarget,this.domHandler),Lw(xM(this.element),this.evWin,this.domHandler)}};const xK={pointerdown:eo.Start,pointermove:eo.Move,pointerup:eo.End,pointercancel:eo.Cancel,pointerout:eo.Cancel},BK="pointerdown",CK="pointermove pointerup pointercancel";class TK extends wK{constructor(e){super(e),this.evEl=BK,this.evWin=CK,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const i=xK[e.type],s=e.pointerType,a=s==="touch";let o=t.findIndex(u=>u.pointerId===e.pointerId);i&eo.Start&&(e.buttons||a)?o<0&&(t.push(e),o=t.length-1):i&(eo.End|eo.Cancel)&&(n=!0),!(o<0)&&(t[o]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),n&&t.splice(o,1))}}const EK=["","webkit","Moz","MS","ms","o"];function SK(r,e){const t=e[0].toUpperCase()+e.slice(1);for(const n of EK){const i=n?n+t:e;if(i in r)return i}}const IK=1,PM=2,FM={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class MK{constructor(e,t){this.options={...FM,...t,cssProps:{...FM.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new TK(this),this.touchAction=new fK(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?PM:IK}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:i}=this;let{curRecognizer:s}=t;(!s||s&&s.state&wn.Recognized)&&(s=t.curRecognizer=null);let a=0;for(;a<i.length;)n=i[a],t.stopped!==PM&&(!s||n===s||n.canRecognizeWith(s))?n.recognize(e):n.reset(),!s&&n.state&(wn.Began|wn.Changed|wn.Ended)&&(s=t.curRecognizer=n),a++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:n}=this,i=n.indexOf(t);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const i of Sy(e))n[i]=n[i]||[],n[i].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const i of Sy(e))t?n[i]&&n[i].splice(n[i].indexOf(t),1):delete n[i]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<n.length;)n[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,i]of Object.entries(this.options.cssProps)){const s=SK(t.style,n);e?(this.oldCssProps[s]=t.style[s],t.style[s]=i):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let PK=1;function FK(){return PK++}function RM(r){return r&wn.Cancelled?"cancel":r&wn.Ended?"end":r&wn.Changed?"move":r&wn.Began?"start":""}class LM{constructor(e){this.options=e,this.id=FK(),this.state=wn.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return n.indexOf(t)===-1&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const n=this.requireFail.indexOf(t);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<wn.Ended&&this.manager.emit(this.options.event+RM(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=wn.Ended&&this.manager.emit(this.options.event+RM(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=wn.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(wn.Failed|wn.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=wn.Failed;return}this.state&(wn.Recognized|wn.Cancelled|wn.Failed)&&(this.state=wn.Possible),this.state=this.process(t),this.state&(wn.Began|wn.Changed|wn.Ended|wn.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class OM extends LM{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,i=t&(wn.Began|wn.Changed),s=this.attrTest(e);return i&&(n&eo.Cancel||!s)?t|wn.Cancelled:i||s?n&eo.End?t|wn.Ended:t&wn.Began?t|wn.Changed:wn.Began:wn.Failed}}class UM extends LM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Mw]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&eo.Start&&this.count===0)return this.failTimeout();if(i&&s&&n){if(e.eventType!==eo.End)return this.failTimeout();const a=this.pTime?e.timeStamp-this.pTime<t.interval:!0,o=!this.pCenter||TM(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!o||!a?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=wn.Recognized,this.tryEmit(this._input)},t.interval),wn.Began):wn.Recognized}return wn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=wn.Failed},this.options.interval),wn.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===wn.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const RK=["","start","move","end","cancel","up","down","left","right"];class DM extends OM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({enable:!0,pointers:1,event:"pan",threshold:10,direction:_o.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&_o.Horizontal&&t.push(Fw),e&_o.Vertical&&t.push(Pw),t}getEventNames(){return RK.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:i}=e,{direction:s}=e;const a=e.deltaX,o=e.deltaY;return s&t.direction||(t.direction&_o.Horizontal?(s=a===0?_o.None:a<0?_o.Left:_o.Right,n=a!==this.pX,i=Math.abs(e.deltaX)):(s=o===0?_o.None:o<0?_o.Up:_o.Down,n=o!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,n&&i>t.threshold&&!!(s&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&wn.Began)||!(this.state&wn.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=_o[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const LK=["","start","move","end","cancel","in","out"];class OK extends OM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Ey]}getEventNames(){return LK.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&wn.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Iy{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const UK=(typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("firefox")!==-1,NM=4.000244140625,DK=40,NK=.25;class kK extends Iy{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(UK&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=DK)),s!==0&&s%NM===0&&(s=Math.floor(s/NM)),i.shiftKey&&s&&(s=s*NK),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const kM=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class QK extends Iy{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,kM.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){kM.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const QM=["keydown","keyup"];class zK extends Iy{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",QM.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){QM.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class HK extends Iy{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const zM=1,Ow=2,HM=4,VK={pointerdown:zM,pointermove:Ow,pointerup:HM,mousedown:zM,mousemove:Ow,mouseup:HM},jK=0,$K=1,GK=2,qK=1,KK=2,WK=4;function XK(r){const e=VK[r.srcEvent.type];if(!e)return null;const{buttons:t,button:n}=r.srcEvent;let i=!1,s=!1,a=!1;return e===Ow?(i=!!(t&qK),s=!!(t&WK),a=!!(t&KK)):(i=n===jK,s=n===$K,a=n===GK),{leftButton:i,middleButton:s,rightButton:a}}function YK(r,e){const t=r.center;if(!t)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,s=n.height/e.offsetHeight||1,a={x:(t.x-n.left-e.clientLeft)/i,y:(t.y-n.top-e.clientTop)/s};return{center:t,offsetCenter:a}}const ZK={srcElement:"root",priority:0};class JK{constructor(e,t){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let s=n.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:a,handlersByElement:o}=this,u={...ZK,...n};let d=o.get(u.srcElement);d||(d=[],o.set(u.srcElement,d));const p={type:e,handler:t,srcElement:u.srcElement,priority:u.priority};i&&(p.once=!0),s&&(p.passive=!0),a.push(p),this._active=this._active||!p.passive;let _=d.length-1;for(;_>=0&&!(d[_].priority>=p.priority);)_--;d.splice(_+1,0,p)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let s=n.length-1;s>=0;s--){const a=n[s];if(a.type===e&&a.handler===t){n.splice(s,1);const o=i.get(a.srcElement);o.splice(o.indexOf(a),1),o.length===0&&i.delete(a.srcElement)}}this._active=n.some(s=>!s.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let i=!1;const s=()=>{e.handled=!0},a=()=>{e.handled=!0,i=!0},o=[];for(let u=0;u<n.length;u++){const{type:d,handler:p,once:_}=n[u];if(p({...e,type:d,stopPropagation:s,stopImmediatePropagation:a}),_&&o.push(n[u]),i)break}for(let u=0;u<o.length;u++){const{type:d,handler:p}=o[u];this.remove(d,p)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...XK(e),...YK(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function eW(r){if("recognizer"in r)return r;let e;const t=Array.isArray(r)?[...r]:[r];if(typeof t[0]=="function"){const n=t.shift(),i=t.shift()||{};e=new n(i)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class tW{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new MK(e,this.options);for(const n of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:a}=eW(n);this.manager.add(i),s&&i.recognizeWith(s),a&&i.requireFailure(a)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new kK(e,this._onOtherEvent,{enable:!1}),this.moveInput=new QK(e,this._onOtherEvent,{enable:!1}),this.keyInput=new zK(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new HK(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var s,a,o,u;const{manager:n}=this;if(!n)return;const i=n.get(e);i&&(i.set({enable:t}),n.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,t),(a=this.moveInput)==null||a.enableEventType(e,t),(o=this.keyInput)==null||o.enableEventType(e,t),(u=this.contextmenuInput)==null||u.enableEventType(e,t)}_addEventHandler(e,t,n,i,s){if(typeof e!="string"){n=t;for(const[d,p]of Object.entries(e))this._addEventHandler(d,p,n,i,s);return}const{manager:a,events:o}=this;if(!a)return;let u=o.get(e);if(!u){const d=this._getRecognizerName(e)||e;u=new JK(this,d),o.set(e,u),a&&a.on(e,u.handleEvent)}u.add(e,t,n,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[s,a]of Object.entries(e))this._removeEventHandler(s,a);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:s}=i;let a=!1;for(const o of n.values())if(o.recognizerName===s&&!o.isEmpty()){a=!0;break}a||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(n=>n.getEventNames().includes(e)))==null?void 0:t.options.event}}const Hn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Hn,"IDENTITY",{get:()=>(Wn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Nc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Uw={common:0,meters:1,pixels:2},Dw={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},VM={multipan:[DM,{threshold:10,direction:_o.Vertical,pointers:2}],pinch:[OK,{},null,["multipan"]],pan:[DM,{threshold:1},["pinch"],["multipan"]],dblclick:[UM,{event:"dblclick",taps:2}],click:[UM,{event:"click"},null,["dblclick"]]},rW=Object.keys(Hn).map(r=>`const int COORDINATE_SYSTEM_${r} = ${Hn[r]};`).join(""),nW=Object.keys(Nc).map(r=>`const int PROJECTION_MODE_${r} = ${Nc[r]};`).join(""),iW=Object.keys(Uw).map(r=>`const int UNIT_${r.toUpperCase()} = ${Uw[r]};`).join(""),sW=`${rW}
${nW}
${iW}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;function oW(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}return!1}function Dg(r){let e={},t;return n=>{for(const i in n)if(!oW(n[i],e[i])){t=r(n),e=n;break}return t}}const jM=[0,0,0,0],aW=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],$M=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],lW=[0,0,0],GM=[0,0,0],cW=Dg(AW);function qM(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:GM;t.length<3&&(t=[t[0],t[1],0]);let n=t,i,s=!0;switch(e===Hn.LNGLAT_OFFSETS||e===Hn.METER_OFFSETS?i=t:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case Nc.WEB_MERCATOR:(e===Hn.LNGLAT||e===Hn.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Nc.WEB_MERCATOR_AUTO_OFFSET:e===Hn.LNGLAT?n=i:e===Hn.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]);break;case Nc.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case Nc.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:s}}function uW(r,e,t){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:s,viewProjectionMatrix:a}=r,o=jM,u=jM,d=r.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:_,offsetMode:w}=qM(r,e,t);return w&&(u=r.projectPosition(p||_),d=[d[0]-u[0],d[1]-u[1],d[2]-u[2]],u[3]=1,o=Hd([],u,a),s=n||s,a=Mf([],i,s),a=Mf([],a,aW)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:u,cameraPosCommon:d,shaderCoordinateOrigin:_,geospatialOrigin:p}}function hW(r){let{viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:i=Hn.DEFAULT,coordinateOrigin:s=GM,autoWrapLongitude:a=!1}=r;i===Hn.DEFAULT&&(i=e.isGeospatial?Hn.LNGLAT:Hn.CARTESIAN);const o=cW({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:s});return o.wrapLongitude=a,o.modelMatrix=n||$M,o}function AW(r){let{viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i}=r;const{projectionCenter:s,viewProjectionMatrix:a,originCommon:o,cameraPosCommon:u,shaderCoordinateOrigin:d,geospatialOrigin:p}=uW(e,n,i),_=e.getDistanceScales(),w=[e.width*t,e.height*t],v=Hd([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,M={coordinateSystem:n,projectionMode:e.projectionMode,coordinateOrigin:d,commonOrigin:o.slice(0,3),center:s,pseudoMeters:!!e._pseudoMeters,viewportSize:w,devicePixelRatio:t,focalDistance:v,commonUnitsPerMeter:_.unitsPerMeter,commonUnitsPerWorldUnit:_.unitsPerMeter,commonUnitsPerWorldUnit2:lW,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:$M,cameraPosition:u};if(p){const P=e.getDistanceScales(p);switch(n){case Hn.METER_OFFSETS:M.commonUnitsPerWorldUnit=P.unitsPerMeter,M.commonUnitsPerWorldUnit2=P.unitsPerMeter2;break;case Hn.LNGLAT:case Hn.LNGLAT_OFFSETS:e._pseudoMeters||(M.commonUnitsPerMeter=P.unitsPerMeter),M.commonUnitsPerWorldUnit=P.unitsPerDegree,M.commonUnitsPerWorldUnit2=P.unitsPerDegree2;break;case Hn.CARTESIAN:M.commonUnitsPerWorldUnit=[1,1,P.unitsPerMeter[2]],M.commonUnitsPerWorldUnit2=[0,0,P.unitsPerMeter2[2]];break}}return M}const fW={};function dW(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:fW;return"viewport"in r?hW(r):{}}const Nw={name:"project",dependencies:[Xq,wM],vs:sW,getUniforms:dW,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},kw={name:"project32",dependencies:[Nw],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`};function pW(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jd(r,e){const t=Hd([],e,r);return Bw(t,t,1/t[3]),t}function KM(r,e){const t=r%e;return t<0?e+t:t}function Qw(r,e,t){return r<e?e:r>t?t:r}function gW(r){return Math.log(r)*Math.LOG2E}const zw=Math.log2||gW;function Ih(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const kc=Math.PI,WM=kc/4,Yl=kc/180,Hw=180/kc,$d=512,My=4003e4,Py=85.051129,mW=1.5;function _W(r){return zw(r)}function Ng(r){const[e,t]=r;Ih(Number.isFinite(e)),Ih(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*Yl,i=t*Yl,s=$d*(n+kc)/(2*kc),a=$d*(kc+Math.log(Math.tan(WM+i*.5)))/(2*kc);return[s,a]}function Gd(r){const[e,t]=r,n=e/$d*(2*kc)-kc,i=2*(Math.atan(Math.exp(t/$d*(2*kc)-kc))-WM);return[n*Hw,i*Hw]}function yW(r){const{latitude:e}=r;Ih(Number.isFinite(e));const t=Math.cos(e*Yl);return _W(My*t)-9}function Fy(r){const e=Math.cos(r*Yl);return $d/My/e}function Vw(r){const{latitude:e,longitude:t,highPrecision:n=!1}=r;Ih(Number.isFinite(e)&&Number.isFinite(t));const i=$d,s=Math.cos(e*Yl),a=i/360,o=a/s,u=i/My/s,d={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[a,o,u],degreesPerUnit:[1/a,1/o,1/u]};if(n){const p=Yl*Math.tan(e*Yl)/s,_=a*p/2,w=i/My*p,v=w/o*u;d.unitsPerDegree2=[0,_,w],d.unitsPerMeter2=[v,0,v]}return d}function XM(r,e){const[t,n,i]=r,[s,a,o]=e,{unitsPerMeter:u,unitsPerMeter2:d}=Vw({longitude:t,latitude:n,highPrecision:!0}),p=Ng(r);p[0]+=s*(u[0]+d[0]*a),p[1]+=a*(u[1]+d[1]*a);const _=Gd(p),w=(i||0)+(o||0);return Number.isFinite(i)||Number.isFinite(o)?[_[0],_[1],w]:_}function bW(r){const{height:e,pitch:t,bearing:n,altitude:i,scale:s,center:a}=r,o=pW();xy(o,o,[0,0,-i]),rM(o,o,-t*Yl),nM(o,o,n*Yl);const u=s/e;return xw(o,o,[u,u,u]),a&&xy(o,o,QG([],a)),o}function vW(r){const{width:e,height:t,altitude:n,pitch:i=0,offset:s,center:a,scale:o,nearZMultiplier:u=1,farZMultiplier:d=1}=r;let{fovy:p=kg(mW)}=r;n!==void 0&&(p=kg(n));const _=p*Yl,w=i*Yl,v=jw(p);let M=v;a&&(M+=a[2]*o/Math.cos(w)/t);const P=_*(.5+(s?s[1]:0)/t),D=Math.sin(P)*M/Math.sin(Qw(Math.PI/2-w-P,.01,Math.PI-.01)),N=Math.sin(w)*D+M,z=M*10,W=Math.min(N*d,z);return{fov:_,aspect:e/t,focalDistance:v,near:u,far:W}}function kg(r){return 2*Math.atan(.5/r)*Hw}function jw(r){return .5/Math.tan(.5*r*Yl)}function YM(r,e){const[t,n,i=0]=r;return Ih(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i)),jd(e,[t,n,i,1])}function $w(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[n,i,s]=r;if(Ih(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return jd(e,[n,i,s,1]);const a=jd(e,[n,i,0,1]),o=jd(e,[n,i,1,1]),u=a[2],d=o[2],p=u===d?0:((t||0)-u)/(d-u);return Q5([],a,o,p)}function wW(r){const{width:e,height:t,bounds:n,minExtent:i=0,maxZoom:s=24,offset:a=[0,0]}=r,[[o,u],[d,p]]=n,_=xW(r.padding),w=Ng([o,Qw(p,-85.051129,Py)]),v=Ng([d,Qw(u,-85.051129,Py)]),M=[Math.max(Math.abs(v[0]-w[0]),i),Math.max(Math.abs(v[1]-w[1]),i)],P=[e-_.left-_.right-Math.abs(a[0])*2,t-_.top-_.bottom-Math.abs(a[1])*2];Ih(P[0]>0&&P[1]>0);const D=P[0]/M[0],N=P[1]/M[1],z=(_.right-_.left)/2/D,W=(_.top-_.bottom)/2/N,V=[(v[0]+w[0])/2+z,(v[1]+w[1])/2+W],$=Gd(V),q=Math.min(s,zw(Math.abs(Math.min(D,N))));return Ih(Number.isFinite(q)),{longitude:$[0],latitude:$[1],zoom:q}}function xW(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(Ih(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const ZM=Math.PI/180;function BW(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:t,height:n,unproject:i}=r,s={targetZ:e},a=i([0,n],s),o=i([t,n],s);let u,d;const p=r.fovy?.5*r.fovy*ZM:Math.atan(.5/r.altitude),_=(90-r.pitch)*ZM;return p>_-.01?(u=JM(r,0,e),d=JM(r,t,e)):(u=i([0,0],s),d=i([t,0],s)),[a,o,d,u]}function JM(r,e,t){const{pixelUnprojectionMatrix:n}=r,i=jd(n,[e,0,1,1]),s=jd(n,[e,r.height,1,1]),o=(t*r.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=Q5([],i,s,o),d=Gd(u);return d.push(t),d}const eP=512;function CW(r){const{width:e,height:t,pitch:n=0}=r;let{longitude:i,latitude:s,zoom:a,bearing:o=0}=r;(i<-180||i>180)&&(i=KM(i+180,360)-180),(o<-180||o>180)&&(o=KM(o+180,360)-180);const u=zw(t/eP);if(a<=u)a=u,s=0;else{const d=t/2/Math.pow(2,a),p=Gd([0,d])[1];if(s<p)s=p;else{const _=Gd([0,eP-d])[1];s>_&&(s=_)}}return{width:e,height:t,longitude:i,latitude:s,zoom:a,pitch:n,bearing:o}}const tP=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,TW=`
${tP}

const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}

`,EW=`
${tP}

const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}

`,SW=Dg(RW),IW=Dg(LW),MW=[0,0,0,1],PW=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function FW(r,e){const[t,n,i]=r,s=$w([t,n,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function RW(r){let{viewport:e,center:t}=r;return new kn(e.viewProjectionMatrix).invert().transform(t)}function LW(r){let{viewport:e,shadowMatrices:t}=r;const n=[],i=e.pixelUnprojectionMatrix,s=e.isGeospatial?void 0:1,a=[[0,0,s],[e.width,0,s],[0,e.height,s],[e.width,e.height,s],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(o=>FW(o,i));for(const o of t){const u=o.clone().translate(new Mt(e.center).negate()),d=a.map(_=>u.transform(_)),p=new kn().ortho({left:Math.min(...d.map(_=>_[0])),right:Math.max(...d.map(_=>_[0])),bottom:Math.min(...d.map(_=>_[1])),top:Math.max(...d.map(_=>_[1])),near:Math.min(...d.map(_=>-_[2])),far:Math.max(...d.map(_=>-_[2]))});n.push(p.multiplyRight(o))}return n}function OW(r){const{shadowEnabled:e=!0,project:t}=r;if(!e||!t||!r.shadowMatrices||!r.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};const n=Nw.getUniforms(t),i=SW({viewport:t.viewport,center:n.center}),s=[],a=IW({shadowMatrices:r.shadowMatrices,viewport:t.viewport}).slice();for(let u=0;u<r.shadowMatrices.length;u++){const d=a[u],p=d.clone().translate(new Mt(t.viewport.center).negate());n.coordinateSystem===Hn.LNGLAT&&n.projectionMode===Nc.WEB_MERCATOR?(a[u]=p,s[u]=i):(a[u]=d.clone().multiplyRight(PW),s[u]=p.transform(i))}const o={drawShadowMap:!!r.drawToShadowMap,useShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,color:r.shadowColor||MW,lightId:r.shadowLightId||0,lightCount:r.shadowMatrices.length,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};for(let u=0;u<a.length;u++)o[`viewProjectionMatrix${u}`]=a[u],o[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)o[`shadow_uShadowMap${u}`]=r.shadowMaps&&r.shadowMaps[u]||r.dummyShadowMap;return o}const rP={name:"shadow",dependencies:[Nw],vs:TW,fs:EW,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:OW,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Gw={...AM,defaultUniforms:{...AM.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},UW=[wM],DW=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function NW(){const r=G_.getDefaultShaderAssembler();for(const e of UW)r.addDefaultModule(e);for(const e of DW)r.addShaderHook(e);return r}const kW=[255,255,255],QW=1;let zW=0;class nP{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.type="ambient";const{color:t=kW}=e,{intensity:n=QW}=e;this.id=e.id||`ambient-${zW++}`,this.color=t,this.intensity=n}}const HW=[255,255,255],VW=1,jW=[0,0,-1];let $W=0;class iP{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.type="directional";const{color:t=HW}=e,{intensity:n=VW}=e,{direction:i=jW}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${$W++}`,this.color=t,this.intensity=n,this.type="directional",this.direction=new Mt(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class GW{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class qw extends GW{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),a=i?1:!1,o=i?0:!1,u=e.colorMask??15,d={viewport:[0,0,t,n]};e.colorMask&&(d.colorMask=u),e.scissorRect&&(d.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:s,clearDepth:a,clearStencil:o});try{return this._drawLayers(p,e)}finally{p.end()}}_drawLayers(e,t){const{target:n,shaderModuleProps:i,viewports:s,views:a,onViewportActive:o,clearStack:u=!0}=t;t.pass=t.pass||"unknown",u&&(this._lastRenderIndex=-1);const d=[];for(const p of s){const _=a&&a[p.id];o==null||o(p);const w=this._getDrawLayerParams(p,t),v=p.subViewports||[p];for(const M of v){const P=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:M,view:_,pass:t.pass,layers:t.layers},w);d.push(P)}}return d}_getDrawLayerParams(e,t){var P;let{layers:n,pass:i,isPicking:s=!1,layerFilter:a,cullRect:o,effects:u,shaderModuleProps:d}=t,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const _=[],w=sP(this._lastRenderIndex+1),v={layer:n[0],viewport:e,isPicking:s,renderPass:i,cullRect:o},M={};for(let D=0;D<n.length;D++){const N=n[D],z=this._shouldDrawLayer(N,v,a,M),W={shouldDrawLayer:z};z&&!p&&(W.shouldDrawLayer=!0,W.layerRenderIndex=w(N,z),W.shaderModuleProps=this._getShaderModuleProps(N,u,i,d),W.layerParameters={...(P=N.context.deck)==null?void 0:P.props.parameters,...this.getLayerParameters(N,D,e)}),_[D]=W}return _}_drawLayersInViewport(e,t,n){let{layers:i,shaderModuleProps:s,pass:a,target:o,viewport:u,view:d}=t;const p=qW(this.device,{shaderModuleProps:s,target:o,viewport:u});if(d&&d.props.clear){const w=d.props.clear===!0?{color:!0,depth:!0}:d.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:p,scissorRect:p},clearColor:w.color?[0,0,0,0]:!1,clearDepth:w.depth?1:!1}).end()}const _={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:p});for(let w=0;w<i.length;w++){const v=i[w],M=n[w],{shouldDrawLayer:P}=M;if(P&&v.props.pickable&&_.pickableCount++,v.isComposite&&_.compositeCount++,v.isDrawable&&M.shouldDrawLayer){const{layerRenderIndex:D,shaderModuleProps:N,layerParameters:z}=M;_.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,D),N.project&&(N.project.viewport=u),v.context.renderPass=e;try{v._drawLayer({renderPass:e,shaderModuleProps:N,uniforms:{layerIndex:D},parameters:z})}catch(W){v.raiseError(W,`drawing ${v} to ${a}`)}}}return _}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(t))return!1;t.layer=a,a=a.parent}if(n){const o=t.layer.id;if(o in i||(i[o]=n(t)),!i[o])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,i){var u,d;const s=this.device.canvasContext.cssToDeviceRatio(),a=((u=e.internalState)==null?void 0:u.propsInTransition)||e.props,o={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const p of t)oP(o,(d=p.getShaderModuleProps)==null?void 0:d.call(p,e,o));return oP(o,this.getShaderModuleProps(e,t,o),i)}}function sP(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t={},n=(i,s)=>{const a=i.props._offset,o=i.id,u=i.parent&&i.parent.id;let d;if(u&&!(u in e)&&n(i.parent,!1),u in t){const p=t[u]=t[u]||sP(e[u],e);d=p(i,s),t[o]=p}else Number.isFinite(a)?(d=a+(e[u]||0),t[o]=null):d=r;return s&&d>=r&&(r=d+1),e[o]=d,d};return n}function qW(r,e){var d;let{shaderModuleProps:t,target:n,viewport:i}=e;const s=((d=t==null?void 0:t.project)==null?void 0:d.devicePixelRatio)??r.canvasContext.cssToDeviceRatio(),[,a]=r.canvasContext.getDrawingBufferSize(),o=n?n.height:a,u=i;return[u.x*s,o-(u.y+u.height)*s,u.width*s,u.height*s]}function oP(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];for(const i of t)if(i)for(const s in i)r[s]?Object.assign(r[s],i[s]):r[s]=i[s];return r}class KW extends qw{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*n,a=i.height*n,o=[1,1,1,1];(s!==t.width||a!==t.height)&&t.resize({width:s,height:a}),super.render({...e,clearColor:o,target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const WW={color:[255,255,255],intensity:1},aP=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],XW=[0,0,0,200/255];class Kw{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.id="lighting-effect",this.shadowColor=XW,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(rP),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender(e){let{layers:t,layerFilter:n,viewports:i,onViewportActive:s,views:a}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:t,layerFilter:n,viewports:i,onViewportActive:s,views:a,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(a=>a.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(a=>a.getProjectedLight({layer:e})),pointLights:this.pointLights.map(a=>a.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:n,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(rP))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=new kn().lookAt({eye:new Mt(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new KW(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;!e&&t.length===0&&n.length===0&&(this.ambientLight=new nP(WW),this.directionalLights.push(new iP(aP[0]),new iP(aP[1])))}}class YW{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,n){let{size:i=1,type:s,padding:a=0,copy:o=!1,initialize:u=!1,maxCount:d}=n;const p=s||e&&e.constructor||Float32Array,_=t*i+a;if(ArrayBuffer.isView(e)){if(_<=e.length)return e;if(_*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new p(e.buffer,0,_)}let w=1/0;d&&(w=d*i+a);const v=this._allocate(p,_,u,w);return e&&o?v.set(e):u||v.fill(0,0,4),this._release(e),v}release(e){this._release(e)}_allocate(e,t,n,i){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>i&&(s=i);const a=this._pool,o=e.BYTES_PER_ELEMENT*s,u=a.findIndex(d=>d.byteLength>=o);if(u>=0){const d=new e(a.splice(u,1)[0],0,s);return n&&d.fill(0),d}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,s=t.findIndex(a=>a.byteLength>=i);s<0?t.push(n):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,n),t.length>this.opts.poolSize&&t.shift()}}const Qg=new YW;function zg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ZW(r,e){const t=r%e;return t<0?e+t:t}function JW(r){return[r[12],r[13],r[14]]}function eX(r){return{left:qd(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:qd(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:qd(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:qd(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:qd(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:qd(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const lP=new Mt;function qd(r,e,t,n){lP.set(r,e,t);const i=lP.len();return{distance:n/i,normal:new Mt(-r/i,-e/i,-t/i)}}function tX(r){return r-Math.fround(r)}let Hg;function Ww(r,e){const{size:t=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:r.length,s=(i-n)/t;Hg=Qg.allocate(Hg,s,{type:Float32Array,size:t*2});let a=n,o=0;for(;a<i;){for(let u=0;u<t;u++){const d=r[a++];Hg[o+u]=d,Hg[o+u+t]=tX(d)}o+=t*2}return Hg.subarray(0,s*t*2)}function rX(r){let e=null,t=!1;for(const n of r)n&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const nX=Math.PI/180,iX=zg(),cP=[0,0,0],sX={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function oX(r){let{width:e,height:t,orthographic:n,fovyRadians:i,focalDistance:s,padding:a,near:o,far:u}=r;const d=e/t,p=n?new kn().orthographic({fovy:i,aspect:d,focalDistance:s,near:o,far:u}):new kn().perspective({fovy:i,aspect:d,near:o,far:u});if(a){const{left:_=0,right:w=0,top:v=0,bottom:M=0}=a,P=Lc((_+e-w)/2,0,e)-e/2,D=Lc((v+t-M)/2,0,t)-t/2;p[8]-=P*2/e,p[9]+=D*2/t}return p}class Kd{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||sX,this.focalDistance=e.focalDistance||1,this.position=e.position||cP,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Nc.WEB_MERCATOR:Nc.WEB_MERCATOR_AUTO_OFFSET:Nc.IDENTITY}equals(e){return e instanceof Kd?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Oc(e.projectionMatrix,this.projectionMatrix)&&Oc(e.viewMatrix,this.viewMatrix):!1}project(e){let{topLeft:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=this.projectPosition(e),i=YM(n,this.pixelProjectionMatrix),[s,a]=i,o=t?a:this.height-a;return e.length===2?[s,o]:[s,o,i[2]]}unproject(e){let{topLeft:t=!0,targetZ:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[i,s,a]=e,o=t?s:this.height-s,u=n&&n*this.distanceScales.unitsPerMeter[2],d=$w([i,o,a],this.pixelUnprojectionMatrix,u),[p,_,w]=this.unprojectPosition(d);return Number.isFinite(a)?[p,_,w]:Number.isFinite(n)?[p,_,n]:[p,_]}projectPosition(e){const[t,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,n,i]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,n,i]}projectFlat(e){if(this.isGeospatial){const t=Ng(e);return t[1]=Lc(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Gd(e):e}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],s[0],a[0]),Math.min(n[1],i[1],s[1],a[1]),Math.max(n[0],i[0],s[0],a[0]),Math.max(n[1],i[1],s[1],a[1])]}getDistanceScales(e){return e&&this.isGeospatial?Vw({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:n,width:i=1,height:s=1}=e;return t<this.x+this.width&&this.x<t+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,eX(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=yW({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Vw({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:a}=e;let o=cP;if(s&&(o=a?new kn(a).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([t,n,0]);this.center=new Mt(o).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:t=iX,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:u=1e3,padding:d=null,focalDistance:p=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new kn().multiplyRight(t).translate(new Mt(this.center).negate()),this.projectionMatrix=n||oX({width:this.width,height:this.height,orthographic:i,fovyRadians:s||a*nX,focalDistance:p,padding:d,near:o,far:u});const _=zg();Mf(_,_,this.projectionMatrix),Mf(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=ww([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=JW(this.viewMatrixInverse);const w=zg(),v=zg();xw(w,w,[this.width/2,-this.height/2,1]),xy(w,w,[1,-1,0]),Mf(v,w,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=ww(zg(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Wn.warn("Pixel project matrix not invertible")()}}Kd.displayName="Viewport";class Pf extends Kd{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:u=1.01,nearZ:d,farZ:p,orthographic:_=!1,projectionMatrix:w,repeat:v=!1,worldOffset:M=0,position:P,padding:D,legacyMeterSizes:N=!1}=e;let{width:z,height:W,altitude:V=1.5}=e;const $=Math.pow(2,i);z=z||1,W=W||1;let q,te=null;if(w)V=w[5]/2,q=kg(V);else{e.fovy?(q=e.fovy,V=jw(q)):q=kg(V);let me;if(D){const{top:xe=0,bottom:se=0}=D;me=[0,Lc((xe+W-se)/2,0,W)-W/2]}te=vW({width:z,height:W,scale:$,center:P&&[0,0,P[2]*Fy(t)],offset:me,pitch:s,fovy:q,nearZMultiplier:o,farZMultiplier:u}),Number.isFinite(d)&&(te.near=d),Number.isFinite(p)&&(te.far=p)}let J=bW({height:W,pitch:s,bearing:a,scale:$,altitude:V});M&&(J=new kn().translate([512*M,0,0]).multiplyLeft(J)),super({...e,width:z,height:W,viewMatrix:J,longitude:n,latitude:t,zoom:i,...te,fovy:q,focalDistance:V}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=s,this.bearing=a,this.altitude=V,this.fovy=q,this.orthographic=_,this._subViewports=v?[]:null,this._pseudoMeters=N,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=t;i<=n;i++){const s=i?new Pf({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e),i=(e[2]||0)*Fy(e[1]);return[t,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e),i=(e[2]||0)/Fy(n);return[t,n,i]}addMetersToLngLat(e,t){return XM(e,t)}panByPosition(e,t){const n=$w(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=k5([],i,RG([],n)),a=k5([],this.center,s),[o,u]=this.unprojectFlat(a);return{longitude:o,latitude:u}}getBounds(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=BW(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:n,height:i}=this,{longitude:s,latitude:a,zoom:o}=wW({width:n,height:i,bounds:e,...t});return new Pf({width:n,height:i,longitude:s,latitude:a,zoom:o})}}Pf.displayName="WebMercatorViewport";const uP=[0,0,0];function Xw(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=e.projectPosition(r);if(t&&e instanceof Pf){const[i,s,a=0]=r,o=e.getDistanceScales([i,s]);n[2]=a*o.unitsPerMeter[2]}return n}function aX(r){const{viewport:e,modelMatrix:t,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:a}=r;return i===Hn.DEFAULT&&(i=e.isGeospatial?Hn.LNGLAT:Hn.CARTESIAN),s===void 0&&(s=i),a===void 0&&(a=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:t,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function hP(r,e){let{viewport:t,modelMatrix:n,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}=e,[o,u,d=0]=r;switch(n&&([o,u,d]=Hd([],[o,u,d,1],n)),i){case Hn.LNGLAT:return Xw([o,u,d],t,a);case Hn.LNGLAT_OFFSETS:return Xw([o+s[0],u+s[1],d+(s[2]||0)],t,a);case Hn.METER_OFFSETS:return Xw(XM(s,[o,u,d]),t,a);case Hn.CARTESIAN:default:return t.isGeospatial?[o+s[0],u+s[1],d+s[2]]:t.projectPosition([o,u,d])}}function lX(r,e){const{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=aX(e),{autoOffset:u=!0}=e,{geospatialOrigin:d=uP,shaderCoordinateOrigin:p=uP,offsetMode:_=!1}=u?qM(t,n,i):{},w=hP(r,{viewport:t,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:_});if(_){const v=t.projectPosition(d||p);Y5(w,w,v)}return w}let cX=1,uX=1;class AP{constructor(){Y(this,"time",0);Y(this,"channels",new Map);Y(this,"animations",new Map);Y(this,"playing",!1);Y(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,a=cX++,o={time:0,delay:t,duration:n,rate:i,repeat:s};return this._setChannelTime(o,this.time),this.channels.set(a,o),a}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:s,channel:a}=i;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=uX++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function hX(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function AX(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}let fX=0;const dX={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:r=>console.error(r),stats:Yv.stats.get(`animation-loop-${fX++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class pX{constructor(e){Y(this,"device",null);Y(this,"canvas",null);Y(this,"props");Y(this,"animationProps",null);Y(this,"timeline",null);Y(this,"stats");Y(this,"cpuTime");Y(this,"gpuTime");Y(this,"frameRate");Y(this,"display");Y(this,"needsRedraw","initialized");Y(this,"_initialized",!1);Y(this,"_running",!1);Y(this,"_animationFrameId",null);Y(this,"_nextFramePromise",null);Y(this,"_resolveNextFrame",null);Y(this,"_cpuStartTime",0);Y(this,"_error",null);if(this.props={...dX,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Nd({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var n,i;if(this.props.onError(e),this._error=Error(),((i=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=hX(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(AX(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,n;const e=(n=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:n.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var s,a,o,u;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((a=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:a.getPixelSize())||[1,1];let n=1;const i=(u=(o=this.device)==null?void 0:o.canvasContext)==null?void 0:u.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Yw={};function Vg(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Yw[r]=Yw[r]||1;const e=Yw[r]++;return`${r}-${e}`}class fP{constructor(e){Y(this,"id");Y(this,"userData",{});Y(this,"topology");Y(this,"bufferLayout",[]);Y(this,"vertexCount");Y(this,"indices");Y(this,"attributes");if(this.id=e.id||Vg("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Rs.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function gX(r,e){if(e instanceof fP)return e;const t=mX(r,e),{attributes:n,bufferLayout:i}=_X(r,e);return new fP({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:n})}function mX(r,e){if(!e.indices)return;const t=e.indices.value;return r.createBuffer({usage:Rs.INDEX,data:t})}function _X(r,e){const t=[],n={};for(const[s,a]of Object.entries(e.attributes)){let o=s;switch(s){case"POSITION":o="positions";break;case"NORMAL":o="normals";break;case"TEXCOORD_0":o="texCoords";break;case"COLOR_0":o="colors";break}if(a){n[o]=r.createBuffer({data:a.value,id:`${s}-buffer`});const{value:u,size:d,normalized:p}=a;t.push({name:o,format:H$(u,d,p)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:t,vertexCount:i}}const Ib=class Ib{constructor(e){Y(this,"device");Y(this,"destroyPolicy");Y(this,"_hashCounter",0);Y(this,"_hashes",{});Y(this,"_renderPipelineCache",{});Y(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Ib(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...kd.defaultProps,...e},n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t={...ty.defaultProps,...e},n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof ty?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,n[t].useCount===0&&this.destroyPolicy==="unused"&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${n}V${i}BL${s}`;default:const a=this._getHash(JSON.stringify(e.parameters));return`${t}/${n}V${i}T${e.topology}P${a}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};Y(Ib,"defaultProps",{...kd.defaultProps});let Zw=Ib;const Mb=class Mb{constructor(e){Y(this,"device");Y(this,"destroyPolicy");Y(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new Mb(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};Y(Mb,"defaultProps",{...Z_.defaultProps});let Jw=Mb;function yX(r,e){var i;const t={},n="Values";if(r.attributes.length===0&&!((i=r.varyings)!=null&&i.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const s of r.attributes)if(s){const a=`${s.location} ${s.name}: ${s.type}`;t[`in ${a}`]={[n]:s.stepMode||"vertex"}}for(const s of r.varyings||[]){const a=`${s.location} ${s.name}`;t[`out ${a}`]={[n]:JSON.stringify(s)}}return t}let Fo=null,Ff=null;function bX(r,e){let{id:t,opaque:n,top:i="0",left:s="0",rgbaScale:a=1}=e;Fo||(Fo=document.createElement("canvas"),Fo.id=t,Fo.title=t,Fo.style.zIndex="100",Fo.style.position="absolute",Fo.style.top=i,Fo.style.left=s,Fo.style.border="blue 5px solid",Fo.style.transform="scaleY(-1)",document.body.appendChild(Fo),Ff=Fo.getContext("2d")),(Fo.width!==r.width||Fo.height!==r.height)&&(Fo.width=r.width/2,Fo.height=r.height/2,Fo.style.width="400px",Fo.style.height="400px");const o=r.device.readPixelsToArrayWebGL(r),u=Ff==null?void 0:Ff.createImageData(r.width,r.height);if(u){for(let p=0;p<o.length;p+=4)u.data[0+p+0]=o[p+0]*a,u.data[0+p+1]=o[p+1]*a,u.data[0+p+2]=o[p+2]*a,u.data[0+p+3]=n?255:o[p+3]*a;Ff==null||Ff.putImageData(u,0,0)}}function e2(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!e2(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!e2(r[s],e[s],t-1))return!1;return!0}return!1}function vX(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function wX(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function dP(r){return vX(r)||wX(r)}function xX(r){return dP(r)||typeof r=="number"||typeof r=="boolean"}function pP(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];xX(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}class BX{constructor(e,t){Y(this,"options",{disableWarnings:!1});Y(this,"modules");Y(this,"moduleUniforms");Y(this,"moduleBindings");Object.assign(this.options,t);const n=Hv(Object.values(e).filter(i=>i.dependencies));for(const i of n)e[i.name]=i;yr.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&yr.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const i=n,s=e[i]||{},a=this.modules[i];if(!a){this.options.disableWarnings||yr.warn(`Module ${n} not found`)();continue}const o=this.moduleUniforms[i],u=this.moduleBindings[i],d=((t=a.getUniforms)==null?void 0:t.call(a,s,o))||s,{uniforms:p,bindings:_}=pP(d);this.moduleUniforms[i]={...o,...p},this.moduleBindings[i]={...u,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[s,a]of Object.entries(i))e[`${n}.${s}`]={type:(t=this.modules[n].uniformTypes)==null?void 0:t[s],value:String(a)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let CX="";async function TX(r,e){const t=new Image;return t.crossOrigin="anonymous",t.src=r.startsWith("http")?r:CX+r,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class t2{constructor(e,t){Y(this,"device");Y(this,"id");Y(this,"texture");Y(this,"sampler");Y(this,"view");Y(this,"ready");Y(this,"isReady",!1);Y(this,"destroyed",!1);Y(this,"resolveReady",()=>{});Y(this,"rejectReady",()=>{});this.device=e,this.id=t.id||Vg("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:TX(t.data)}),this.ready=new Promise((n,i)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=i}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let t,n;const i=e.data,s=await gP(i).then(t,n);if(this.destroyed)return;const a={...e,data:s};this.texture=this.device.createTexture(a),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function gP(r){if(r=await r,Array.isArray(r))return await Promise.all(r.map(gP));if(r&&typeof r=="object"&&r.constructor===Object){const e=r,t=await Promise.all(Object.values(e)),n=Object.keys(e),i={};for(let s=0;s<n.length;s++)i[n[s]]=t[s];return i}return r}const Rf=2,EX=1e4,Pb=class Pb{constructor(e,t){Y(this,"device");Y(this,"id");Y(this,"source");Y(this,"vs");Y(this,"fs");Y(this,"pipelineFactory");Y(this,"shaderFactory");Y(this,"userData",{});Y(this,"parameters");Y(this,"topology");Y(this,"bufferLayout");Y(this,"isInstanced",void 0);Y(this,"instanceCount",0);Y(this,"vertexCount");Y(this,"indexBuffer",null);Y(this,"bufferAttributes",{});Y(this,"constantAttributes",{});Y(this,"bindings",{});Y(this,"uniforms",{});Y(this,"vertexArray");Y(this,"transformFeedback",null);Y(this,"pipeline");Y(this,"shaderInputs");Y(this,"_uniformStore");Y(this,"_attributeInfos",{});Y(this,"_gpuGeometry",null);Y(this,"_getModuleUniforms");Y(this,"props");Y(this,"_pipelineNeedsUpdate","newly created");Y(this,"_needsRedraw","initializing");Y(this,"_destroyed",!1);Y(this,"_lastDrawTimestamp",-1);Y(this,"_lastLogTime",0);Y(this,"_logOpen",!1);Y(this,"_drawCount",0);var u,d,p,_;this.props={...Pb.defaultProps,...t},t=this.props,this.id=t.id||Vg("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(((u=this.props.modules)==null?void 0:u.map(w=>[w.name,w]))||[]),i=t.shaderInputs||new BX(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=IX(e),a=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(p=this.shaderInputs)==null?void 0:p.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(_=this.props).shaderLayout||(_.shaderLayout=bG(this.props.source));const{source:w,getUniforms:v}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:a});this.source=w,this._getModuleUniforms=v}else{const{vs:w,fs:v,getUniforms:M}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:a});this.vs=w,this.fs=v,this._getModuleUniforms=M}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Zw.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Jw.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return yr.info(Rf,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),r2(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,a=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:a,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const t=e&&gX(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new sw(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new sw(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){e2(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new z$(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(SX(n)){const i=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&yr.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const i=new sw(this.bufferLayout);for(const[s,a]of Object.entries(e)){const o=i.getBufferLayout(s);if(!o){n||yr.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(o);let d=!1;for(const p of u){const _=this._attributeInfos[p];_&&(this.vertexArray.setBuffer(_.location,a),d=!0)}!d&&!n&&yr.warn(`Model(${this.id}): Ignoring buffer "${a.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const s=this._attributeInfos[n];s?this.vertexArray.setConstantWebGL(s.location,i):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||yr.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){r2(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:n}=pP(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof t2&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof t2?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Y_?e=Math.max(e,t.texture.updateTimestamp):t instanceof Rs||t instanceof hs?e=Math.max(e,t.updateTimestamp):t instanceof t2?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof J_||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(yr.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=u5(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=yr.level>3?0:EX;yr.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,yr.group(Rf,`>>> DRAWING MODEL ${this.id}`,{collapsed:yr.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=yX(this.pipeline.shaderLayout,this.id);yr.table(Rf,e)();const t=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))t[i]={value:s};yr.table(Rf,t)();const n=this._getAttributeDebugTable();yr.table(Rf,this._attributeInfos)(),yr.table(Rf,n)(),yr.groupEnd(Rf)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&bX(n,{id:n.id})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=d5(t);return(e instanceof Rs?new n(e.debugData):e).toString()}};Y(Pb,"defaultProps",{...kd.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:G_.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let wA=Pb;function SX(r){return!!(r.uniformTypes&&!r2(r.uniformTypes))}function IX(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function r2(r){for(const e in r)return!1;return!0}const n_=class n_{constructor(e){Y(this,"device");Y(this,"model");Y(this,"transformFeedback");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:n_.defaultProps;if(!n_.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new wA(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||jj(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Rs)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:s=n.byteLength}=t;return n.readAsync(i,s)}};Y(n_,"defaultProps",{...wA.defaultProps,outputs:void 0,feedbackBuffers:void 0});let jg=n_;class Wd{constructor(e){Y(this,"id");Y(this,"topology");Y(this,"vertexCount");Y(this,"indices");Y(this,"attributes");Y(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||Vg("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[s,a]of Object.entries(t)){const o=ArrayBuffer.isView(a)?{value:a}:a;if(!ArrayBuffer.isView(o.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!o.size&&(o.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=o}else this.attributes[s]=o}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:s,size:a,constant:o}=i;!o&&s&&a!==void 0&&a>=1&&(n=Math.min(n,s.length/a))}return n}}class Ry{constructor(){Y(this,"id");Y(this,"matrix",new kn);Y(this,"display",!0);Y(this,"position",new Mt);Y(this,"rotation",new Mt);Y(this,"scale",new Mt(1,1,1));Y(this,"userData",{});Y(this,"props",{});let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t}=e;this.id=t||Vg(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:n,scale:i,update:s=!0}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:t,rotation:n,scale:i}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;const n=new kn(e).multiplyRight(t),i=n.invert(),s=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Xd extends Ry{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:n=[]}=t;yr.assert(n.every(i=>i instanceof Ry),"every child must an instance of ScenegraphNode");super(t);Y(this,"children");this.children=n}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,i)=>{let{worldMatrix:s}=i;const a=n.getBounds();if(!a)return;const[o,u]=a,d=new Mt(o).add(u).divide([2,2,2]);s.transformAsPoint(d,d);const p=new Mt(u).subtract(o).divide([2,2,2]);s.transformAsVector(p,p);for(let _=0;_<8;_++){const w=new Mt(_&1?-1:1,_&2?-1:1,_&4?-1:1).multiply(p).add(d);for(let v=0;v<3;v++)t[0][v]=Math.min(t[0][v],w[v]),t[1][v]=Math.max(t[1][v],w[v])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)Array.isArray(s)?this.add(...s):this.children.push(s);return this}remove(t){const n=this.children,i=n.indexOf(t);return i>-1&&n.splice(i,1),this}removeAll(){return this.children=[],this}traverse(t){let{worldMatrix:n=new kn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new kn(n).multiplyRight(this.matrix);for(const s of this.children)s instanceof Xd?s.traverse(t,{worldMatrix:i}):t(s,{worldMatrix:i})}}class n2 extends Ry{constructor(t){super(t);Y(this,"model");Y(this,"bounds",null);Y(this,"managedResources");this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}const MX={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class mP extends qw{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:n,views:i,viewports:s,onViewportActive:a,pickingFBO:o,deviceRect:{x:u,y:d,width:p,height:_},cullRect:w,effects:v,pass:M="picking",pickZ:P,shaderModuleProps:D}=e;this.pickZ=P;const N=this._resetColorEncoder(P),z=[u,d,p,_],W=super.render({target:o,layers:t,layerFilter:n,views:i,viewports:s,onViewportActive:a,cullRect:w,effects:v==null?void 0:v.filter($=>$.useInPicking),pass:M,isPicking:!0,shaderModuleProps:D,clearColor:[0,0,0,0],colorMask:15,scissorRect:z});return this._colorEncoderState=null,{decodePickingColor:N&&FX.bind(null,N),stats:W}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const i={...e.props.parameters},{pickable:s,operation:a}=e.props;return!this._colorEncoderState||a.includes("terrain")?i.blend=!1:s&&a.includes("draw")&&(Object.assign(i,MX),i.blend=!0,i.blendColor=PX(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function PX(r,e,t){const{byLayer:n,byAlpha:i}=r;let s,a=n.get(e);return a?(a.viewports.push(t),s=a.a):(s=n.size+1,s<=255?(a={a:s,layer:e,viewports:[t]},n.set(e,a),i[s]=a):(Wn.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function FX(r,e){const t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Yd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Ly=Symbol.for("component"),xA=Symbol.for("propTypes"),i2=Symbol.for("deprecatedProps"),Zd=Symbol.for("asyncPropDefaults"),Lf=Symbol.for("asyncPropOriginal"),BA=Symbol.for("asyncPropResolved");function Jd(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(r)?_P(r,e,[]):e(r)?[r]:[]}function _P(r,e,t){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?_P(i,e,t):e(i)&&t.push(i)}return t}function RX(r){let{target:e,source:t,start:n=0,count:i=1}=r;const s=t.length,a=i*s;let o=0;for(let u=n;o<s;o++)e[u++]=t[o];for(;o<a;)o<a-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+a-o),o=a);return e}class LX{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=AA(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class OX{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add(e){let{resourceId:t,data:n,forceUpdate:i=!1,persistent:s=!0}=e,a=this._resources[t];a?a.setData(n,i):(a=new LX(t,n,this._context),this._resources[t]=a),a.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const n=this._consumers[t];if(n){for(const i in n){const s=n[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:n,consumerId:i,requestId:s="default"}=e;const{_resources:a,protocol:o}=this;t.startsWith(o)&&(t=t.replace(o,""),a[t]||this.add({resourceId:t,data:null,persistent:!1}));const u=a[t];if(this._track(i,s,u,n),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const s=this._consumers,a=s[e]=s[e]||{};let o=a[t];const u=o&&o.resourceId&&this._resources[o.resourceId];u&&(u.unsubscribe(o),this.prune()),n&&(o?(o.onChange=i,o.resourceId=n.id):o={onChange:i,resourceId:n.id},a[t]=o,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const UX="layerManager.setLayers",DX="layerManager.activateViewport";class NX{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=o=>{la(DX,this,o),o&&(this.context.viewport=o)};const{deck:n,stats:i,viewport:s,timeline:a}=t||{};this.layers=[],this.resourceManager=new OX({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:NW(),defaultShaderModules:[oK],renderPass:void 0,stats:i||new Nd({id:"deck.gl"}),viewport:s||new Kd({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new AP,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e?this.layers.filter(t=>e.find(n=>t.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){la(UX,this,t,e),this._lastRenderedLayers=e;const n=Jd(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(n=>n.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(i=>i.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const a of e)n[a.id]?Wn.warn(`Multiple old layers with same id ${a.id}`)():n[a.id]=a;if(this._defaultShaderModulesChanged){for(const a of e)a.setNeedsUpdate(),a.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let s=!1;for(const a of i)if(a.hasUniformTransition()){s=`Uniform transition in ${a}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const s=t[i.id];s===null&&Wn.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let a=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),a=i.isComposite?i.getSubLayers():null}catch(o){this._handleError("matching",o,i)}a&&this._updateSublayersRecursively(a,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Yd.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Yd.MATCHED,t!==e&&(e.lifecycle=Yd.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Yd.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Yd.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Qc(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!Qc(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!Qc(r[s],e[s],t-1))return!1;return!0}return!1}class kX{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let s=n.length-1;s>=0;--s){const a=n[s];if(a.containsPixel(i)){const o=e.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Jd(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Qc(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Wn.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=t.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var a;return(a=this.getView(e.id))==null?void 0:a.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,t,n,i){const s=e.controller;if(s&&n){const a={...t,...s,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const s=e[i],a=this.getViewState(s),o=s.makeViewport({viewState:a,width:this.width,height:this.height});let u=t[s.id];const d=!!s.controller;d&&!u&&(n=!0),(n||!d)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,a,o,u),o&&this._viewports.unshift(o)}for(const i in t){const s=t[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((n,i)=>!e[i].equals(t[i]))}}const QX=/([0-9]+\.?[0-9]*)(%|px)/;function CA(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=QX.exec(r);if(e&&e.length>=3){const t=e[2]==="%",n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error(`Could not parse position string ${r}`)}}function TA(r,e){return r.relative?Math.round(r.position*e):r.position}class yP{constructor(e){const{id:t,x:n=0,y:i=0,width:s="100%",height:a="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=CA(n),this._y=CA(i),this._width=CA(s),this._height=CA(a),this._padding=o&&{left:CA(o.left||0),right:CA(o.right||0),top:CA(o.top||0),bottom:CA(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Qc(this.props,e.props,2)}makeViewport(e){let{width:t,height:n,viewState:i}=e;i=this.filterViewState(i);const s=this.getDimensions({width:t,height:n});if(!s.height||!s.width)return null;const a=this.getViewportType(i);return new a({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const n in this.props.viewState)n!=="id"&&(t[n]=this.props.viewState[n]);return t}return e}getDimensions(e){let{width:t,height:n}=e;const i={x:TA(this._x,t),y:TA(this._y,n),width:TA(this._width,t),height:TA(this._height,n)};return this._padding&&(i.padding={left:TA(this._padding.left,t),top:TA(this._padding.top,n),right:TA(this._padding.right,t),bottom:TA(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Oy{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(t=this.settings).onStart)==null||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const bP=()=>{},s2={BREAK:1,SNAP_TO_END:2,IGNORE:3},zX=r=>r,HX=s2.BREAK;class VX{constructor(e){this._onTransitionUpdate=t=>{const{time:n,settings:{interpolator:i,startProps:s,endProps:a,duration:o,easing:u}}=t,d=u(n/o),p=i.interpolateProps(s,a,d);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Oy(e.timeline),this.onViewStateChange=e.onViewStateChange||bP,this.onStateChange=e.onStateChange||bP}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:s,endProps:a}=this.transition.settings;i={...n,...s===s2.SNAP_TO_END?a:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||t==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===s2.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),s=t.transitionInterpolator,a=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(a===0)return;const o=s.initializeProps(e,i);this.propsInTransition={};const u={duration:a,easing:t.transitionEasing||zX,interpolator:s,interruption:t.transitionInterruption||HX,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function yo(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}class jX{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Oc(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const s of this._propsToExtract)(s in e||s in t)&&(n[s]=e[s],i[s]=t[s]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];yo(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const $X=["longitude","latitude","zoom","bearing","pitch"],GX=["longitude","latitude","zoom"];class o2 extends jX{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:$X,required:GX},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:s}=this.opts;if(i&&s){const a=i(e),o=i(t),u=a.unproject(s);n.start.around=s,Object.assign(n.end,{around:o.project(u),aroundPosition:u,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const s of this._propsToExtract)i[s]=my(e[s]||0,t[s]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...i});Object.assign(i,s.panByPosition(t.aroundPosition,my(e.around,t.around,n)))}return i}}const EA={transitionDuration:0},qX=300,Uy=r=>1-(1-r)*(1-r),ep={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Of={};class vP{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new VX({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const s=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?qX:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:o=!0,touchRotate:u=!1,keyboard:d=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(ep.WHEEL,p&&n),this.toggleEvents(ep.PAN,p),this.toggleEvents(ep.PINCH,p&&(o||u)),this.toggleEvents(ep.MULTI_PAN,p&&u),this.toggleEvents(ep.DOUBLE_CLICK,p&&a),this.toggleEvents(ep.KEYBOARD,p&&d),this.scrollZoom=n,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=o,this.touchRotate=u,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(n=>{this._events[n]!==t&&(this._events[n]=t,t?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),s){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,EA,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,EA,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Uy},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,EA,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Uy},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let a=2/(1+Math.exp(-Math.abs(s*n)));s<0&&a!==0&&(a=1/a);const o=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(o,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,EA,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,EA,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Uy},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Of._startPinchRotation=e.rotation,Of._lastPinchEvent=e,this.updateViewport(n,EA,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:Of._startPinchRotation-n})}return this.updateViewport(t,EA,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Of._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=Of;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const a=Math.log2(e.scale),o=(a-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),u=Math.pow(2,a+o*t/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:Uy},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Of._startPinchRotation=null,Of._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let u;const d={};switch(e.srcEvent.code){case"Minus":u=t?o.zoomOut(n).zoomOut(n):o.zoomOut(n),d.isZooming=!0;break;case"Equal":u=t?o.zoomIn(n).zoomIn(n):o.zoomIn(n),d.isZooming=!0;break;case"ArrowLeft":t?(u=o.rotateLeft(s),d.isRotating=!0):(u=o.moveLeft(i),d.isPanning=!0);break;case"ArrowRight":t?(u=o.rotateRight(s),d.isRotating=!0):(u=o.moveRight(i),d.isPanning=!0);break;case"ArrowUp":t?(u=o.rotateUp(a),d.isRotating=!0):(u=o.moveUp(i),d.isPanning=!0);break;case"ArrowDown":t?(u=o.rotateDown(a),d.isRotating=!0):(u=o.moveDown(i),d.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?EA:e?{...t,transitionInterpolator:new o2({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class KX{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const wP=5,WX=1.2;class xP extends KX{constructor(e){const{width:t,height:n,latitude:i,longitude:s,zoom:a,bearing:o=0,pitch:u=0,altitude:d=1.5,position:p=[0,0,0],maxZoom:_=20,minZoom:w=0,maxPitch:v=60,minPitch:M=0,startPanLngLat:P,startZoomLngLat:D,startRotatePos:N,startBearing:z,startPitch:W,startZoom:V,normalize:$=!0}=e;yo(Number.isFinite(s)),yo(Number.isFinite(i)),yo(Number.isFinite(a)),super({width:t,height:n,latitude:i,longitude:s,zoom:a,bearing:o,pitch:u,altitude:d,maxZoom:_,minZoom:w,maxPitch:v,minPitch:M,normalize:$,position:p},{startPanLngLat:P,startZoomLngLat:D,startRotatePos:N,startBearing:z,startPitch:W,startZoom:V}),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:n}=e;const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:n=0,deltaAngleY:i=0}=e;const{startRotatePos:s,startBearing:a,startPitch:o}=this.getState();if(!s||a===void 0||o===void 0)return this;let u;return t?u=this._getNewRotation(t,s,o,a):u={bearing:a+n,pitch:o+i},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:n,scale:i}=e,{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(n)||this._unproject(t)),!a)return this;const{maxZoom:o,minZoom:u}=this.getViewportProps();let d=s+Math.log2(i);d=Lc(d,u,o);const p=this.makeViewport({...this.getViewportProps(),zoom:d});return this._getUpdatedState({zoom:d,...p.panByPosition(a,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:s}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(s-t.longitude)>180&&(n.longitude=s<0?s+360:s-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Lc(i,n,t);const{maxPitch:s,minPitch:a,pitch:o}=e;e.pitch=Lc(o,a,s);const{normalize:u=!0}=e;return u&&Object.assign(e,CW(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const s=e[0]-t[0],a=e[1]-t[1],o=e[1],u=t[1],{width:d,height:p}=this.getViewportProps(),_=s/d;let w=0;a>0?Math.abs(p-u)>wP&&(w=a/(u-p)*WX):a<0&&u>wP&&(w=1-o/u),w=Lc(w,-1,1);const{minPitch:v,maxPitch:M}=this.getViewportProps(),P=i+180*_;let D=n;return w>0?D=n+w*(M-n):w<0&&(D=n-w*(v-n)),{pitch:D,bearing:P}}}class XX extends vP{constructor(){super(...arguments),this.ControllerState=xP,this.transition={transitionDuration:300,transitionInterpolator:new o2({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class a2 extends yP{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e)}getViewportType(){return Pf}get ControllerType(){return XX}}a2.displayName="MapView";const YX=new Kw;function ZX(r,e){const t=r.order??1/0,n=e.order??1/0;return t-n}class JX{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(n=>n.id===e.id)){const n=t.findIndex(i=>ZX(i,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Qc(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const n=[];for(const i of e){const s=t[i.id];let a=i;s&&s!==i?s.setProps?(s.setProps(i.props),a=s):s.cleanup(this._context):s||i.setup(this._context),n.push(a),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof Kw)||this._resolvedEffects.push(YX),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class eY extends qw{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const tY="deckRenderer.renderLayers";class rY{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new eY(e),this.pickLayersPass=new mP(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const s=t.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,la(tY,this,s,e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?t.target:void 0;const a=s.postRender(i);i.inputBuffer=a,i.swapBuffer=a===n[0]?n[1]:n[0]}}}const nY={pickedColor:null,pickedObjectIndex:-1};function iY(r){let{pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:i,deviceRadius:s,deviceRect:a}=r;const{x:o,y:u,width:d,height:p}=a;let _=s*s,w=-1,v=0;for(let M=0;M<p;M++){const P=M+u-i,D=P*P;if(D>_)v+=4*d;else for(let N=0;N<d;N++){if(e[v+3]-1>=0){const W=N+o-n,V=W*W+D;V<=_&&(_=V,w=v)}v+=4}}if(w>=0){const M=e.slice(w,w+4),P=t(M);if(P){const D=Math.floor(w/4/d),N=w/4-D*d;return{...P,pickedColor:M,pickedX:o+N,pickedY:u+D}}Wn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return nY}function sY(r){let{pickedColors:e,decodePickingColor:t}=r;const n=new Map;if(e){for(let i=0;i<e.length;i+=4)if(e[i+3]-1>=0){const a=e.slice(i,i+4),o=a.join(",");if(!n.has(o)){const u=t(a);u?n.set(o,{...u,color:a}):Wn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function BP(r){let{pickInfo:e,viewports:t,pixelRatio:n,x:i,y:s,z:a}=r,o=t[0];t.length>1&&(o=aY((e==null?void 0:e.pickedViewports)||t,{x:i,y:s}));let u;if(o){const d=[i-o.x,s-o.y];a!==void 0&&(d[2]=a),u=o.unproject(d)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:u,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:n}}function oY(r){const{pickInfo:e,lastPickedInfo:t,mode:n,layers:i}=r,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=e,u=a?[a]:[];if(n==="hover"){const _=t.index,w=t.layerId,v=a?a.props.id:null;if(v!==w||o!==_){if(v!==w){const M=i.find(P=>P.props.id===w);M&&u.unshift(M)}t.layerId=v,t.index=o,t.info=null}}const d=BP(r),p=new Map;return p.set(null,d),u.forEach(_=>{let w={...d};_===a&&(w.color=s,w.index=o,w.picked=!0),w=CP({layer:_,info:w,mode:n});const v=w.layer;_===a&&n==="hover"&&(t.info=w),p.set(v.id,w),n==="hover"&&v.updateAutoHighlight(w)}),p}function CP(r){let{layer:e,info:t,mode:n}=r;for(;e&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:i}),e=e.parent}return t}function aY(r,e){for(let t=r.length-1;t>=0;t--){const n=r[t];if(n.containsPixel(e))return n}return r[0]}class lY{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new mP(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:t,y:n,layers:i,viewports:s}=e,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const o=a&&a.layer&&a.layer.id,u=a&&a.viewport&&a.viewport.id,d=o?i.find(v=>v.id===o):null,p=u&&s.find(v=>v.id===u)||s[0],_=p&&p.unproject([t-p.x,n-p.y]);return{...a,...{x:t,y:n,viewport:p,coordinate:_,layer:d}}}_resizeBuffer(){var t,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return t.length?t:null}_pickClosestObject(e){let{layers:t,views:n,viewports:i,x:s,y:a,radius:o=0,depth:u=1,mode:d="query",unproject3D:p,onViewportActive:_,effects:w}=e;const v=this.device.canvasContext.cssToDeviceRatio(),M=this._getPickable(t);if(!M||i.length===0)return{result:[],emptyInfo:BP({viewports:i,x:s,y:a,pixelRatio:v})};this._resizeBuffer();const P=this.device.canvasContext.cssToDevicePixels([s,a],!0),D=[P.x+Math.floor(P.width/2),P.y+Math.floor(P.height/2)],N=Math.round(o*v),{width:z,height:W}=this.pickingFBO,V=this._getPickingRect({deviceX:D[0],deviceY:D[1],deviceRadius:N,deviceWidth:z,deviceHeight:W}),$={x:s-o,y:a-o,width:o*2+1,height:o*2+1};let q;const te=[],J=new Set;for(let me=0;me<u;me++){let xe;if(V){const oe=this._drawAndSample({layers:M,views:n,viewports:i,onViewportActive:_,deviceRect:V,cullRect:$,effects:w,pass:`picking:${d}`});xe=iY({...oe,deviceX:D[0],deviceY:D[1],deviceRadius:N,deviceRect:V})}else xe={pickedColor:null,pickedObjectIndex:-1};let se;if(xe.pickedLayer&&p&&this.depthFBO){const{pickedColors:oe}=this._drawAndSample({layers:[xe.pickedLayer],views:n,viewports:i,onViewportActive:_,deviceRect:{x:xe.pickedX,y:xe.pickedY,width:1,height:1},cullRect:$,effects:w,pass:`picking:${d}:z`},!0);oe[3]&&(se=oe[0])}xe.pickedLayer&&me+1<u&&(J.add(xe.pickedLayer),xe.pickedLayer.disablePickingIndex(xe.pickedObjectIndex)),q=oY({pickInfo:xe,lastPickedInfo:this.lastPickedInfo,mode:d,layers:M,viewports:i,x:s,y:a,z:se,pixelRatio:v});for(const oe of q.values())oe.layer&&te.push(oe);if(!xe.pickedColor)break}for(const me of J)me.restorePickingColors();return{result:te,emptyInfo:q.get(null)}}_pickVisibleObjects(e){let{layers:t,views:n,viewports:i,x:s,y:a,width:o=1,height:u=1,mode:d="query",maxObjects:p=null,onViewportActive:_,effects:w}=e;const v=this._getPickable(t);if(!v||i.length===0)return[];this._resizeBuffer();const M=this.device.canvasContext.cssToDeviceRatio(),P=this.device.canvasContext.cssToDevicePixels([s,a],!0),D=P.x,N=P.y+P.height,z=this.device.canvasContext.cssToDevicePixels([s+o,a+u],!0),W=z.x+z.width,V=z.y,$={x:D,y:V,width:W-D,height:N-V},q=this._drawAndSample({layers:v,views:n,viewports:i,onViewportActive:_,deviceRect:$,cullRect:{x:s,y:a,width:o,height:u},effects:w,pass:`picking:${d}`}),te=sY(q),J=new Map,me=[],xe=Number.isFinite(p);for(let se=0;se<te.length&&!(xe&&me.length>=p);se++){const oe=te[se];let ve={color:oe.pickedColor,layer:null,index:oe.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:M};ve=CP({layer:oe.pickedLayer,info:ve,mode:d});const ge=ve.layer.id;J.has(ge)||J.set(ge,new Set);const Je=J.get(ge),Ge=ve.object??ve.index;Je.has(Ge)||(Je.add(Ge),me.push(ve))}return me}_drawAndSample(e){let{layers:t,views:n,viewports:i,onViewportActive:s,deviceRect:a,cullRect:o,effects:u,pass:d}=e,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const _=p?this.depthFBO:this.pickingFBO,w={layers:t,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:s,pickingFBO:_,deviceRect:a,cullRect:o,effects:u,pass:d,pickZ:p,preRenderStats:{},isPicking:!0};for(const W of u)W.useInPicking&&(w.preRenderStats[W.id]=W.preRender(w));const{decodePickingColor:v}=this.pickLayersPass.render(w),{x:M,y:P,width:D,height:N}=a,z=new(p?Float32Array:Uint8Array)(D*N*4);return this.device.readPixelsToArrayWebGL(_,{sourceX:M,sourceY:P,sourceWidth:D,sourceHeight:N,target:z}),{pickedColors:z,decodePickingColor:v}}_getPickingRect(e){let{deviceX:t,deviceY:n,deviceRadius:i,deviceWidth:s,deviceHeight:a}=e;const o=Math.max(0,t-i),u=Math.max(0,n-i),d=Math.min(s,t+i+1)-o,p=Math.min(a,n+i+1)-u;return d<=0||p<=0?null:{x:o,y:u,width:d,height:p}}}const cY={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},uY="top-left",TP="__root";class hY{constructor(e){let{deck:t,parentElement:n}=e;this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Qc(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=t[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const i=t[n];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=uY}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,n).append(i),e._element=i}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var a;const n=e||TP;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(a=this.parentElement)==null||a.append(i),this.containers[n]=i);let s=i.querySelector(`.${t}`);return s||(s=document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,cY[t]),i.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,s=n===TP||i,a=this.containers[n];s?(a.style.display="block",a.style.left=`${i?i.x:0}px`,a.style.top=`${i?i.y:0}px`,a.style.width=`${i?i.width:e}px`,a.style.height=`${i?i.height:t}px`):a.style.display="none"}}onRedraw(e){var s,a;let{viewports:t,layers:n}=e;const i=t.reduce((o,u)=>(o[u.id]=u,o),{});for(const o of this.getWidgets()){const{viewId:u}=o;if(u){const d=i[u];d&&(o.onViewportChange&&o.onViewportChange(d),(s=o.onRedraw)==null||s.call(o,{viewports:[d],layers:n}))}else{if(o.onViewportChange)for(const d of t)o.onViewportChange(d);(a=o.onRedraw)==null||a.call(o,{viewports:t,layers:n})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){var n,i;for(const s of this.getWidgets()){const{viewId:a}=s;(!a||a===((n=e.viewport)==null?void 0:n.id))&&((i=s.onHover)==null||i.call(s,e,t))}}onEvent(e,t){var i,s;const n=Dw[t.type];if(n)for(const a of this.getWidgets()){const{viewId:o}=a;(!o||o===((i=e.viewport)==null?void 0:i.id))&&((s=a[n])==null||s.call(a,e,t))}}}const AY={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class fY{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd(e){let{deck:t}=e;const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,AY),this.deck=t,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var tp;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(tp||(tp={}));const l2={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},to=(r,e,t)=>e?r.enable(t):r.disable(t),EP=(r,e,t)=>r.hint(t,e),vl=(r,e,t)=>r.pixelStorei(t,e),SP=(r,e,t)=>{const n=t===36006?36009:36008;return r.bindFramebuffer(n,e)},$g=(r,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];r.bindBuffer(i,e)};function c2(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}const dY={3042:to,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:to,2885:(r,e)=>r.cullFace(e),2929:to,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:to,35723:EP,35725:(r,e)=>r.useProgram(e),36007:(r,e)=>r.bindRenderbuffer(36161,e),36389:(r,e)=>{var t;return(t=r.bindTransformFeedback)==null?void 0:t.call(r,36386,e)},34229:(r,e)=>r.bindVertexArray(e),36006:SP,36010:SP,34964:$g,36662:$g,36663:$g,35053:$g,35055:$g,2886:(r,e)=>r.frontFace(e),33170:EP,2849:(r,e)=>r.lineWidth(e),32823:to,32824:"polygonOffset",10752:"polygonOffset",35977:to,32926:to,32928:to,32938:"sampleCoverage",32939:"sampleCoverage",3089:to,3088:(r,e)=>r.scissor(...e),2960:to,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),34383:to,10754:to,12288:to,12289:to,12290:to,12291:to,12292:to,12293:to,12294:to,12295:to,3333:vl,3317:vl,37440:vl,37441:vl,37443:vl,3330:vl,3332:vl,3331:vl,3314:vl,32878:vl,3316:vl,3315:vl,32877:vl,framebuffer:(r,e)=>{const t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{const t=typeof e=="number"?[e,e]:e;r.blendEquationSeparate(...t)},blendFunc:(r,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;r.blendFuncSeparate(...t)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(e[0],e[1]||!1),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=c2(e)?e:[e,e];const[t,n]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,e)=>{e=c2(e)&&e.length===3?[...e,...e]:e;const[t,n,i,s,a,o]=e;r.stencilFuncSeparate(1028,t,n,i),r.stencilFuncSeparate(1029,s,a,o)},stencilOp:(r,e)=>{e=c2(e)&&e.length===3?[...e,...e]:e;const[t,n,i,s,a,o]=e;r.stencilOpSeparate(1028,t,n,i),r.stencilOpSeparate(1029,s,a,o)},viewport:(r,e)=>r.viewport(...e)};function _s(r,e,t){return e[r]!==void 0?e[r]:t[r]}const pY={blendEquation:(r,e,t)=>r.blendEquationSeparate(_s(32777,e,t),_s(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(_s(32969,e,t),_s(32968,e,t),_s(32971,e,t),_s(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(_s(32824,e,t),_s(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(_s(32938,e,t),_s(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,_s(2962,e,t),_s(2967,e,t),_s(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,_s(34816,e,t),_s(36003,e,t),_s(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,_s(2964,e,t),_s(2965,e,t),_s(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,_s(34817,e,t),_s(34818,e,t),_s(34819,e,t))},IP={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),useProgram:(r,e)=>r({35725:e}),bindRenderbuffer:(r,e,t)=>r({36007:t}),bindTransformFeedback:(r,e,t)=>r({36389:t}),bindVertexArray:(r,e)=>r({34229:e}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},bindBuffer:(r,e,t)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?r({[n]:t}):{valueChanged:!0}},blendColor:(r,e,t,n,i)=>r({32773:new Float32Array([e,t,n,i])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,n,i)=>r({32969:e,32968:t,32971:n,32970:i}),clearColor:(r,e,t,n,i)=>r({3106:new Float32Array([e,t,n,i])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,n,i)=>r({3107:[e,t,n,i]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,n,i)=>r({3088:new Int32Array([e,t,n,i])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,n)=>r({2962:e,2967:t,2963:n,34816:e,36003:t,36004:n}),stencilFuncSeparate:(r,e,t,n,i)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(r,e,t,n)=>r({2964:e,2965:t,2966:n,34817:e,34818:t,34819:n}),stencilOpSeparate:(r,e,t,n,i)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(r,e,t,n,i)=>r({2978:[e,t,n,i]})},$u=(r,e)=>r.isEnabled(e),MP={3042:$u,2884:$u,2929:$u,3024:$u,32823:$u,32926:$u,32928:$u,3089:$u,2960:$u,35977:$u},gY=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function rp(r,e){if(_Y(e))return;const t={};for(const i in e){const s=Number(i),a=dY[i];a&&(typeof a=="string"?t[a]=!0:a(r,e[i],s))}const n=r.state&&r.state.cache;if(n)for(const i in t){const s=pY[i];s(r,e,n)}}function PP(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l2;if(typeof e=="number"){const i=e,s=MP[i];return s?s(r,i):r.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),n={};for(const i of t){const s=MP[i];n[i]=s?s(r,Number(i)):r.getParameter(Number(i))}return n}function mY(r){rp(r,l2)}function _Y(r){for(const e in r)return!1;return!0}function yY(r,e){if(r===e)return!0;const t=Array.isArray(r)||ArrayBuffer.isView(r),n=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&n&&r.length===e.length){for(let i=0;i<r.length;++i)if(r[i]!==e[i])return!1;return!0}return!1}class Uf{constructor(e,t){Y(this,"gl");Y(this,"program",null);Y(this,"stateStack",[]);Y(this,"enable",!0);Y(this,"cache",null);Y(this,"log");Y(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];rp(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?PP(e):Object.assign({},l2),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,vY(e);for(const n in IP){const i=IP[n];bY(e,n,i)}FP(e,"getParameter"),FP(e,"isEnabled")}_updateCache(e){let t=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const a=e[s],o=this.cache[s];yY(a,o)||(t=!0,n=o,i&&!(s in i)&&(i[s]=o),this.cache[s]=a)}return{valueChanged:t,oldValue:n}}}function FP(r,e){const t=r[e].bind(r);r[e]=function(i){if(i===void 0||gY.has(i))return t(i);const s=Uf.get(r);return i in s.cache||(s.cache[i]=t(i)),s.enable?s.cache[i]:t(i)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function bY(r,e,t){if(!r[e])return;const n=r[e].bind(r);r[e]=function(){const s=Uf.get(r);for(var a=arguments.length,o=new Array(a),u=0;u<a;u++)o[u]=arguments[u];const{valueChanged:d,oldValue:p}=t(s._updateCache,...o);return d&&n(...o),p},Object.defineProperty(r[e],"name",{value:`${e}-to-cache`,configurable:!1})}function vY(r){const e=r.useProgram.bind(r);r.useProgram=function(n){const i=Uf.get(r);i.program!==n&&(e(n),i.program=n)}}function wY(r,e,t){let n="";const i={preserveDrawingBuffer:!0,...t};let s=null;if(s||(s=r.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(n||(n="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!t.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=r.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=r.getContext("webgl",{}),s&&(s=null,n||(n="Your browser only supports WebGL1"))),!s)throw n||(n="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:a,onContextRestored:o}=e;return r.addEventListener("webglcontextlost",u=>a(u),!1),r.addEventListener("webglcontextrestored",u=>o(u),!1),s.luma||(s.luma={}),s}function np(r,e,t){return t[e]===void 0&&(t[e]=r.getExtension(e)||null),t[e]}function xY(r,e){const t=r.getParameter(7936),n=r.getParameter(7937);np(r,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=r.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),a=r.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),o=s||t,u=a||n,d=r.getParameter(7938),p=RP(o,u),_=BY(o,u),w=CY(o,u);return{type:"webgl",gpu:p,gpuType:w,gpuBackend:_,vendor:o,renderer:u,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function RP(r,e){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(r)||/Apple/i.exec(e)?"apple":/AMD/i.exec(r)||/AMD/i.exec(e)||/ATI/i.exec(r)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e)?"software":"unknown"}function BY(r,e){return/Metal/i.exec(r)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(e)?"opengl":"unknown"}function CY(r,e){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e))return"cpu";switch(RP(r,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function LP(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}const Gg="WEBGL_compressed_texture_s3tc",qg="WEBGL_compressed_texture_s3tc_srgb",ip="EXT_texture_compression_rgtc",sp="EXT_texture_compression_bptc",TY="WEBGL_compressed_texture_etc",EY="WEBGL_compressed_texture_astc",SY="WEBGL_compressed_texture_etc1",IY="WEBGL_compressed_texture_pvrtc",MY="WEBGL_compressed_texture_atc",OP="EXT_texture_norm16",UP="EXT_render_snorm",PY="EXT_color_buffer_float",u2={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[UP],"norm16-renderable-webgl":[OP],"snorm16-renderable-webgl":[OP,UP],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Gg,qg,ip,sp],"texture-compression-bc5-webgl":[ip],"texture-compression-bc7-webgl":[sp],"texture-compression-etc2":[TY],"texture-compression-astc":[EY],"texture-compression-etc1-webgl":[SY],"texture-compression-pvrtc-webgl":[IY],"texture-compression-atc-webgl":[MY]};function FY(r){return r in u2}function RY(r,e,t){return(u2[e]||[]).every(i=>np(r,i,t))}const h2={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:PY,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Gg},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:qg},"bc1-rgba-unorm":{gl:33777,x:Gg},"bc1-rgba-unorm-srgb":{gl:35916,x:qg},"bc2-rgba-unorm":{gl:33778,x:Gg},"bc2-rgba-unorm-srgb":{gl:35918,x:qg},"bc3-rgba-unorm":{gl:33779,x:Gg},"bc3-rgba-unorm-srgb":{gl:35919,x:qg},"bc4-r-unorm":{gl:36283,x:ip},"bc4-r-snorm":{gl:36284,x:ip},"bc5-rg-unorm":{gl:36285,x:ip},"bc5-rg-snorm":{gl:36286,x:ip},"bc6h-rgb-ufloat":{gl:36495,x:sp},"bc6h-rgb-float":{gl:36494,x:sp},"bc7-rgba-unorm":{gl:36492,x:sp},"bc7-rgba-unorm-srgb":{gl:36493,x:sp},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function LY(r,e,t){let n=e.create;const i=h2[e.format];return(i==null?void 0:i.gl)===void 0&&(n=!1),i!=null&&i.x&&(n=n&&!!np(r,i.x,t)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function DP(r){var i;const e=h2[r],t=DY(r),n=Wv(r);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||UY(n.channels,n.integer,n.normalized,t),type:n.dataType?LP(n.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:n.compressed||!1}}function OY(r){switch(Wv(r).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${r}`)}}function UY(r,e,t,n){if(n===6408||n===6407)return n;switch(r){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function DY(r){const e=h2[r],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${r}`);return t}const NP={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class NY extends o${constructor(t,n,i){super([],i);Y(this,"gl");Y(this,"extensions");Y(this,"testedFeatures",new Set);this.gl=t,this.extensions=n,np(t,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const t=this.getFeatures();for(const n of t)this.has(n)&&(yield n);return[]}has(t){var n;return(n=this.disabledFeatures)!=null&&n[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),FY(t)&&RY(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of t)this.has(n)}getFeatures(){return[...Object.keys(NP),...Object.keys(u2)]}getWebGLFeature(t){const n=NP[t];return typeof n=="string"?!!np(this.gl,n,this.extensions):!!n}}class kY extends s${constructor(t){super();Y(this,"gl");Y(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class Kg extends ey{constructor(t,n){super(t,n);Y(this,"device");Y(this,"gl");Y(this,"handle");Y(this,"colorAttachments",[]);Y(this,"depthStencilAttachment",null);const i=n.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const i=this.colorAttachments[n];if(i){const s=36064+n;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const n=OY(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${zY(n)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,n){const{gl:i}=this.device,{texture:s}=n,a=n.props.baseMipLevel,o=n.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,t,s.handle,a,o);break;case 34067:const u=QY(o);i.framebufferTexture2D(36160,t,u,s.handle,a);break;case 3553:i.framebufferTexture2D(36160,t,3553,s.handle,a);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function QY(r){return r<34069?r+34069:r}function zY(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}class HY extends Zv{constructor(t,n){super(n);Y(this,"device");Y(this,"format","rgba8unorm");Y(this,"depthStencilFormat","depth24plus");Y(this,"presentationSize");Y(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Kg(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(n,t);return}}commit(){}}async function kP(r,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",r),new Promise((i,s)=>{n.onload=i,n.onerror=a=>s(new Error(`Unable to load script '${r}': ${a}`)),t.appendChild(n)})}const VY=1;let Li=null,QP=!1;const A2={debugSpectorJS:yr.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function jY(r){if(!globalThis.SPECTOR)try{await kP(r.debugSpectorJSUrl||A2.debugSpectorJSUrl)}catch(e){yr.warn(String(e))}}function $Y(r){var e;if(r={...A2,...r},!r.debugSpectorJS)return null;if(!Li&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){yr.probe(VY,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;Li=new t,globalThis.luma&&(globalThis.luma.spector=Li)}if(!Li)return null;if(QP||(QP=!0,Li.spyCanvases(),Li==null||Li.onCaptureStarted.add(t=>yr.info("Spector capture started:",t)()),Li==null||Li.onCapture.add(t=>{yr.info("Spector capture complete:",t)(),Li==null||Li.getResultUI(),Li==null||Li.resultView.display(),Li==null||Li.resultView.addCapture(t)})),r.gl){const t=r.gl,n=t.device;Li==null||Li.startCapture(r.gl,500),t.device=n,new Promise(i=>setTimeout(i,2e3)).then(i=>{yr.info("Spector capture stopped after 2 seconds")(),Li==null||Li.stopCapture()})}return Li}const GY="https://unpkg.com/webgl-debug@2.0.1/index.js";function zP(r){return r.luma=r.luma||{},r.luma}async function qY(){wf()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await kP(GY))}function KY(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.debugWebGL||e.traceWebGL?XY(r,e):WY(r)}function WY(r){const e=zP(r);return e.realContext?e.realContext:r}function XY(r,e){if(!globalThis.WebGLDebugUtils)return yr.warn("webgl-debug not loaded")(),r;const t=zP(r);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...tp,...r});const n=globalThis.WebGLDebugUtils.makeDebugContext(r,YY.bind(null,e),ZY.bind(null,e));for(const a in tp)!(a in n)&&typeof tp[a]=="number"&&(n[a]=tp[a]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(r)),Object.setPrototypeOf(i,n);const s=Object.create(i);return t.realContext=r,t.debugContext=s,s.debug=!0,s}function HP(r,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${r}(${t})`}function YY(r,e,t,n){n=Array.from(n).map(o=>o===void 0?"undefined":o);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,n),a=`${i} in gl.${t}(${s})`;yr.error(a)();debugger}function ZY(r,e,t){let n="";yr.level>=1&&(n=HP(e,t),r.traceWebGL&&yr.log(1,n)());for(const i of t)if(i===void 0){n=n||HP(e,t);debugger}}const f2={};function JY(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";f2[r]=f2[r]||1;const e=f2[r]++;return`${r}-${e}`}class Wg extends Rs{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,n);Y(this,"device");Y(this,"gl");Y(this,"handle");Y(this,"glTarget");Y(this,"glUsage");Y(this,"glIndexType",5123);Y(this,"byteLength");Y(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const i=typeof n=="object"?n.handle:void 0;this.handle=i||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=eZ(this.props.usage),this.glUsage=tZ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.byteLength+n;const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,n,t),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(t,n,i),this.trackAllocatedMemory(i)}_initWithByteLength(t){let n=t;t===0&&(n=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=36663;this.gl.bindBuffer(i,this.handle),this.gl.bufferSubData(i,n,t),this.gl.bindBuffer(i,null),this._setDebugData(t,n,t.byteLength)}async readAsync(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;return this.readSyncWebGL(t,n)}readSyncWebGL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;n=n??this.byteLength-t;const i=new Uint8Array(n),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,s,n),this.gl.bindBuffer(36662,null),this._setDebugData(i,t,n),i}}function eZ(r){return r&Rs.INDEX?34963:r&Rs.VERTEX?34962:r&Rs.UNIFORM?35345:34962}function tZ(r){return r&Rs.INDEX||r&Rs.VERTEX?35044:r&Rs.UNIFORM?35048:35044}function rZ(r){const e=r.split(/\r?\n/),t=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[_,w]=i;t.push({message:w.trim(),type:VP(_),lineNum:0,linePos:0});continue}const[s,a,o,...u]=i;let d=parseInt(o,10);isNaN(d)&&(d=0);let p=parseInt(a,10);isNaN(p)&&(p=0),t.push({message:u.join(":").trim(),type:VP(s),lineNum:d,linePos:p})}return t}function VP(r){const e=["warning","error","info"],t=r.toLowerCase();return e.includes(t)?t:"info"}class nZ extends Z_{constructor(t,n){super(t,n);Y(this,"device");Y(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?rZ(t):[]}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(n==null?void 0:n.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,t),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}yr.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),yr.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async s=>await new Promise(a=>setTimeout(a,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function iZ(r,e,t,n){if(lZ(e))return n(r);const i=r;i.pushState();try{return sZ(r,e),rp(i.gl,t),n(r)}finally{i.popState()}}function sZ(r,e){const t=r,{gl:n}=t;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(Df("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&r.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&r.features.has("provoking-vertex-webgl")){const s=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,a=Df("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(a)}if((e.polygonMode||e.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,a=Df("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,a),s==null||s.polygonModeWEBGL(1029,a)}e.polygonOffsetLine&&n.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(aZ("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(d2("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&yr.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=d2("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,s,0,i),n.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=p2("stencilPassOperation",e.stencilPassOperation),s=p2("stencilFailOperation",e.stencilFailOperation),a=p2("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,s,a,i),n.stencilOpSeparate(1029,s,a,i)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=jP("blendColorOperation",e.blendColorOperation||"add"),s=jP("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,s);const a=Dy("blendColorSrcFactor",e.blendColorSrcFactor||"one"),o=Dy("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=Dy("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=Dy("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(a,o,u,d)}}function d2(r,e){return Df(r,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function p2(r,e){return Df(r,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function jP(r,e){return Df(r,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Dy(r,e){return Df(r,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function oZ(r,e){return`Illegal parameter ${e} for ${r}`}function Df(r,e,t){if(!(e in t))throw new Error(oZ(r,e));return t[e]}function aZ(r,e){return e}function lZ(r){let e=!0;for(const t in r){e=!1;break}return e}function $P(r){const e={};return r.addressModeU&&(e[10242]=g2(r.addressModeU)),r.addressModeV&&(e[10243]=g2(r.addressModeV)),r.addressModeW&&(e[32882]=g2(r.addressModeW)),r.magFilter&&(e[10240]=m2(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(e[10241]=cZ(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(e[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(e[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(e[34892]=34894),r.compare&&(e[34893]=d2("compare",r.compare)),r.maxAnisotropy&&(e[34046]=r.maxAnisotropy),e}function g2(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function m2(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function cZ(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none";if(!e)return m2(r);switch(e){case"none":return m2(r);case"nearest":return r==="nearest"?9984:9986;case"linear":return r==="nearest"?9985:9987}}class _2 extends J_{constructor(t,n){super(t,n);Y(this,"device");Y(this,"handle");Y(this,"parameters");this.device=t,this.parameters=$P(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[n,i]of Object.entries(t)){const s=Number(n);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class op extends Y_{constructor(t,n){super(t,{...hs.defaultProps,...n});Y(this,"device");Y(this,"gl");Y(this,"handle");Y(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const uZ="Failed to deduce GL constant from typed array";function hZ(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(uZ)}}function AZ(r,e){const{clamped:t=!0}=e||{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function GP(r){switch(r){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function fZ(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Ny(r,e,t){if(dZ(e))return t(r);const{nocatch:n=!0}=e,i=Uf.get(r);i.push(),rp(r,e);let s;if(n)s=t(r),i.pop();else try{s=t(r)}finally{i.pop()}return s}function dZ(r){for(const e in r)return!1;return!0}function pZ(r,e,t){const{dimension:n,width:i,height:s,depth:a=0}=t,{glInternalFormat:o}=t,u=t.glTarget;switch(n){case"2d-array":case"3d":r.texStorage3D(u,e,o,i,s,a);break;default:r.texStorage2D(u,e,o,i,s)}}function qP(r,e,t,n){const{width:i,height:s}=n,{dimension:a,depth:o=0,mipLevel:u=0}=n,{x:d=0,y:p=0,z:_=0}=n,{glFormat:w,glType:v}=n,M=WP(n.glTarget,a,o),P=n.flipY?{37440:!0}:{};Ny(r,P,()=>{switch(a){case"2d-array":case"3d":r.bindTexture(M,e),r.texSubImage3D(M,u,d,p,_,i,s,o,w,v,t),r.bindTexture(M,null);break;case"2d":case"cube":r.bindTexture(M,e),r.texSubImage2D(M,u,d,p,i,s,w,v,t),r.bindTexture(M,null);break;default:throw new Error(a)}})}function KP(r,e,t){const{dimension:n,width:i,height:s,depth:a=0,mipLevel:o=0,byteOffset:u=0}=t,{x:d=0,y:p=0,z:_=0}=t,{glFormat:w,glType:v,compressed:M}=t,P=WP(t.glTarget,n,a);switch(n){case"2d-array":case"3d":M?r.compressedTexSubImage3D(P,o,d,p,_,i,s,a,w,e,u):r.texSubImage3D(P,o,d,p,_,i,s,a,w,v,e,u);break;case"2d":case"cube":M?r.compressedTexSubImage2D(P,o,d,p,i,s,w,e,u):r.texSubImage2D(P,o,d,p,i,s,w,v,e,u);break;default:throw new Error(n)}}function gZ(r){switch(r){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(r)}function WP(r,e,t){return e==="cube"?34069+t:r}function mZ(r,e){var N;const{sourceX:t=0,sourceY:n=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:a,sourceHeight:o,sourceDepth:u,sourceFormat:d,sourceType:p}=e||{};const{framebuffer:_,deleteFramebuffer:w}=XP(r),{gl:v,handle:M}=_;a||(a=_.width),o||(o=_.height);const P=(N=_.colorAttachments[i])==null?void 0:N.texture;if(!P)throw new Error(`Invalid framebuffer attachment ${i}`);u=(P==null?void 0:P.depth)||1,d||(d=(P==null?void 0:P.glFormat)||6408),p||(p=(P==null?void 0:P.glType)||5121),s=bZ(s,p,d,a,o),p=p||hZ(s);const D=v.bindFramebuffer(36160,M);return v.readBuffer(36064+i),v.readPixels(t,n,a,o,d,p,s),v.readBuffer(36064),v.bindFramebuffer(36160,D||null),w&&_.destroy(),s}function _Z(r,e){const{target:t,sourceX:n=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:a=0}=e||{};let{sourceWidth:o,sourceHeight:u,sourceType:d}=e||{};const{framebuffer:p,deleteFramebuffer:_}=XP(r);o=o||p.width,u=u||p.height;const w=p;d=d||5121;let v=t;if(!v){const P=GP(s),D=fZ(d),N=a+o*u*P*D;v=w.device.createBuffer({byteLength:N})}const M=r.device.createCommandEncoder();return M.copyTextureToBuffer({sourceTexture:r,width:o,height:u,origin:[n,i],destinationBuffer:v,byteOffset:a}),M.destroy(),_&&p.destroy(),v}function XP(r){return r instanceof ey?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:yZ(r),deleteFramebuffer:!0}}function yZ(r,e){const{device:t,width:n,height:i,id:s}=r;return t.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:n,height:i,colorAttachments:[r]})}function bZ(r,e,t,n,i,s){if(r)return r;e||(e=5121);const a=AZ(e,{clamped:!1}),o=GP(t);return new a(n*i*o)}class Xg extends hs{constructor(t,n){super(t,n);Y(this,"device");Y(this,"gl");Y(this,"handle");Y(this,"sampler",void 0);Y(this,"view",void 0);Y(this,"mipmaps");Y(this,"compressed");Y(this,"glTarget");Y(this,"glFormat");Y(this,"glType");Y(this,"glInternalFormat");Y(this,"textureUnit",0);const i={...this.props};i.data=n.data,this.device=t,this.gl=this.device.gl,this.glTarget=gZ(this.props.dimension);const s=DP(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:n,height:i}=t;if(!n||!i){const s=hs.getTextureDataSize(t.data);n=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=n,this.height=i,this.depth=t.depth,this.setSampler(t.sampler),this.view=new op(this.device,{...this.props,texture:this}),this.bind(),pZ(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new op(this.device,{...t,texture:this})}setSampler(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n;t instanceof _2?(this.sampler=t,n=t.props):(this.sampler=new _2(this.device,t),n=t);const i=$P(n);this._setSamplerParameters(i)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(yr.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){yr.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const n=hs.getExternalImageSize(t.image),i={...hs.defaultCopyExternalImageOptions,...n,...t},{image:s,depth:a,mipLevel:o,x:u,y:d,z:p,flipY:_}=i;let{width:w,height:v}=i;const{dimension:M,glTarget:P,glFormat:D,glInternalFormat:N,glType:z}=this;if(w=Math.min(w,this.width-u),v=Math.min(v,this.height-d),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return qP(this.device.gl,this.handle,s,{dimension:M,mipLevel:o,x:u,y:d,z:p,width:w,height:v,depth:a,glFormat:D,glType:z,glTarget:P,flipY:_}),{width:i.width,height:i.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.bind();const i=hs.normalizeTextureData(t,this);i.length>1&&this.props.mipmaps!==!1&&yr.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const a=i[s];this._setMipLevel(n,s,a)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),KP(this.device.gl,t,this),this.unbind())}setTextureCubeData(t){if(this.props.dimension!=="cube")throw new Error(this.id);for(const n of hs.CubeFaces)this.setTextureCubeFaceData(t[n],n)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,n){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&yr.warn(`${this.id} has mipmap and multiple LODs.`)();const i=hs.CubeFaces.indexOf(n);this.setTexture2DData(t,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:n,width:i,height:s,pixels:a,data:o,format:u=6408,type:d=5121}=t,{gl:p}=this,_=a||o;this.bind(),_ instanceof Promise?_.then(w=>this.setImageDataForFace(Object.assign({},t,{face:n,data:w,pixels:w}))):this.width||this.height?p.texImage2D(n,0,u,i,s,0,u,d,_):p.texImage2D(n,0,u,u,d,_)}_getImageDataMap(t){for(let n=0;n<hs.CubeFaces.length;++n){const i=hs.CubeFaces[n];t[i]&&(t[34069+n]=t[i],delete t[i])}return t}_setSamplerParameters(t){yr.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,i]of Object.entries(t)){const s=Number(n),a=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,a);break;case 10241:this.gl.texParameteri(this.glTarget,s,a);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,a);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,a);break;default:this.gl.texParameteri(this.glTarget,s,a);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,n,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.glTarget;if(hs.isExternalImage(i)){qP(this.device.gl,this.handle,i,{...this,depth:t,mipLevel:n,glTarget:s,flipY:this.props.flipY});return}if(hs.isTextureLevelData(i)){KP(this.device.gl,i.data,{...this,depth:t,mipLevel:n,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.glTarget,null),t}}const vZ=[1,2,4,8];class wZ extends Jv{constructor(t,n){var a;super(t,n);Y(this,"device");Y(this,"glParameters");this.device=t;let i;if(!((a=n==null?void 0:n.parameters)!=null&&a.viewport))if(n!=null&&n.framebuffer){const{width:o,height:u}=n.framebuffer;i=[0,0,o,u]}else{const[o,u]=t.getCanvasContext().getDrawingBufferSize();i=[0,0,o,u]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const o=this.props.framebuffer.colorAttachments.map((u,d)=>36064+d);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(n.viewport=t.viewport.slice(0,4),n.depthRange=[t.viewport[4],t.viewport[5]]):n.viewport=t.viewport),t.scissorRect&&(n.scissorTest=!0,n.scissor=t.scissorRect),t.blendConstant&&(n.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(n.colorMask=vZ.map(i=>!!(i&t.colorMask))),this.glParameters=n,rp(this.device.gl,n)}beginOcclusionQuery(t){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,t.clearStencil=this.props.clearStencil),n!==0&&Ny(this.device.gl,t,()=>{this.device.gl.clear(n)})}clearColorBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0];Ny(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function xZ(r){return BZ.includes(r)}const BZ=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],YP={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function ZP(r){const e=YP[r];if(!e)throw new Error("uniform");const[t,n,,i]=e;return{format:i,components:n,glType:t}}function CZ(r){const e=YP[r];if(!e)throw new Error("attribute");const[,t,,n,i]=e;return{attributeType:n,vertexFormat:i,components:t}}function TZ(r,e){const t={attributes:[],bindings:[]};t.attributes=EZ(r,e);const n=MZ(r,e);for(const o of n){const u=o.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:o.name,group:0,location:o.location,visibility:(o.vertex?1:0)&(o.fragment?2:0),minBindingSize:o.byteLength,uniforms:u})}const i=IZ(r,e);let s=0;for(const o of i)if(xZ(o.type)){const{viewDimension:u,sampleType:d}=FZ(o.type);t.bindings.push({type:"texture",name:o.name,group:0,location:s,viewDimension:u,sampleType:d}),o.textureUnit=s,s+=1}i.length&&(t.uniforms=i);const a=SZ(r,e);return a!=null&&a.length&&(t.varyings=a),t}function EZ(r,e){const t=[],n=r.getProgramParameter(e,35721);for(let i=0;i<n;i++){const s=r.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:a,type:o}=s,u=r.getAttribLocation(e,a);if(u>=0){const{attributeType:d}=CZ(o),p=/instance/i.test(a)?"instance":"vertex";t.push({name:a,location:u,stepMode:p,type:d})}}return t.sort((i,s)=>i.location-s.location),t}function SZ(r,e){const t=[],n=r.getProgramParameter(e,35971);for(let i=0;i<n;i++){const s=r.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:a,type:o,size:u}=s,{glType:d,components:p}=ZP(o),_={location:i,name:a,type:d,size:u*p};t.push(_)}return t.sort((i,s)=>i.location-s.location),t}function IZ(r,e){const t=[],n=r.getProgramParameter(e,35718);for(let i=0;i<n;i++){const s=r.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:a,size:o,type:u}=s,{name:d,isArray:p}=RZ(a);let _=r.getUniformLocation(e,d);const w={location:_,name:d,size:o,type:u,isArray:p};if(t.push(w),w.size>1)for(let v=0;v<w.size;v++){const M=`${d}[${v}]`;_=r.getUniformLocation(e,M);const P={...w,name:M,location:_};t.push(P)}}return t}function MZ(r,e){const t=(s,a)=>r.getActiveUniformBlockParameter(e,s,a),n=[],i=r.getProgramParameter(e,35382);for(let s=0;s<i;s++){const a={name:r.getActiveUniformBlockName(e,s)||"",location:t(s,35391),byteLength:t(s,35392),vertex:t(s,35396),fragment:t(s,35398),uniformCount:t(s,35394),uniforms:[]},o=t(s,35395)||[],u=r.getActiveUniforms(e,o,35383),d=r.getActiveUniforms(e,o,35384),p=r.getActiveUniforms(e,o,35387),_=r.getActiveUniforms(e,o,35388);for(let w=0;w<a.uniformCount;++w){const v=r.getActiveUniform(e,o[w]);if(!v)throw new Error("activeInfo");a.uniforms.push({name:v.name,format:ZP(u[w]).format,type:u[w],arrayLength:d[w],byteOffset:p[w],byteStride:_[w]})}n.push(a)}return n.sort((s,a)=>s.location-a.location),n}const PZ={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function FZ(r){const e=PZ[r];if(!e)throw new Error("sampler");const[t,n]=e;return{viewDimension:t,sampleType:n}}function RZ(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function LZ(r,e,t,n){const i=r;let s=n;s===!0&&(s=1),s===!1&&(s=0);const a=typeof s=="number"?[s]:s;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return r.uniform1i(e,n);case 5126:return r.uniform1fv(e,a);case 35664:return r.uniform2fv(e,a);case 35665:return r.uniform3fv(e,a);case 35666:return r.uniform4fv(e,a);case 5124:return r.uniform1iv(e,a);case 35667:return r.uniform2iv(e,a);case 35668:return r.uniform3iv(e,a);case 35669:return r.uniform4iv(e,a);case 35670:return r.uniform1iv(e,a);case 35671:return r.uniform2iv(e,a);case 35672:return r.uniform3iv(e,a);case 35673:return r.uniform4iv(e,a);case 5125:return i.uniform1uiv(e,a,1);case 36294:return i.uniform2uiv(e,a,2);case 36295:return i.uniform3uiv(e,a,3);case 36296:return i.uniform4uiv(e,a,4);case 35674:return r.uniformMatrix2fv(e,!1,a);case 35675:return r.uniformMatrix3fv(e,!1,a);case 35676:return r.uniformMatrix4fv(e,!1,a);case 35685:return i.uniformMatrix2x3fv(e,!1,a);case 35686:return i.uniformMatrix2x4fv(e,!1,a);case 35687:return i.uniformMatrix3x2fv(e,!1,a);case 35688:return i.uniformMatrix3x4fv(e,!1,a);case 35689:return i.uniformMatrix4x2fv(e,!1,a);case 35690:return i.uniformMatrix4x3fv(e,!1,a)}throw new Error("Illegal uniform")}function OZ(r){return dP(r)!==null||typeof r=="number"||typeof r=="boolean"}function UZ(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];OZ(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}function DZ(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(r)}}function NZ(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(r)}}const JP=4;class kZ extends kd{constructor(t,n){super(t,n);Y(this,"device");Y(this,"handle");Y(this,"vs");Y(this,"fs");Y(this,"introspectedLayout");Y(this,"uniforms",{});Y(this,"bindings",{});Y(this,"varyings",null);Y(this,"_uniformCount",0);Y(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:i,bufferMode:s=35981}=n;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),yr.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=TZ(this.device.gl,this.handle),yr.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=QZ(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,n){for(const[i,s]of Object.entries(t)){const a=this.shaderLayout.bindings.find(o=>o.name===i)||this.shaderLayout.bindings.find(o=>o.name===`${i}Uniforms`);if(!a){const o=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");n!=null&&n.disableWarnings||yr.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${o}`,s)();continue}switch(s||yr.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),a.type){case"uniform":if(!(s instanceof Wg)&&!(s.buffer instanceof Wg))throw new Error("buffer value");break;case"texture":if(!(s instanceof op||s instanceof Xg||s instanceof Kg))throw new Error("texture value");break;case"sampler":yr.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(a.type)}this.bindings[i]=s}}draw(t){var D;const{renderPass:n,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:a,vertexCount:o,instanceCount:u,isInstanced:d=!1,firstVertex:p=0,transformFeedback:_}=t,w=DZ(s),v=!!a.indexBuffer,M=(D=a.indexBuffer)==null?void 0:D.glIndexType;if(this.linkStatus!=="success")return yr.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return yr.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),a.bindBeforeRender(n),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const P=n;return iZ(this.device,i,P.glParameters,()=>{v&&d?this.device.gl.drawElementsInstanced(w,o||0,M,p,u||0):v?this.device.gl.drawElements(w,o||0,M,p):d?this.device.gl.drawArraysInstanced(w,p,o||0,u||0):this.device.gl.drawArrays(w,p,o||0),_&&_.end()}),a.unbindAfterRender(n),!0}setUniformsWebGL(t){const{bindings:n}=UZ(t);Object.keys(n).forEach(i=>{yr.warn(`Unsupported value "${JSON.stringify(n[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),yr.time(JP,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),yr.timeEnd(JP,`linkProgram for ${this.id}`)(),yr.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}yr.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),yr.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(t){var n;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((n=this.fs)==null?void 0:n.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${i}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async s=>await new Promise(a=>setTimeout(a,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(yr.warn(`Binding ${n.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let n=0,i=0;for(const s of this.shaderLayout.bindings){const a=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!a)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:o}=s,u=t.getUniformBlockIndex(this.handle,o);if(u===4294967295)throw new Error(`Invalid uniform block name ${o}`);t.uniformBlockBinding(this.handle,i,u),a instanceof Wg?t.bindBufferBase(35345,i,a.handle):t.bindBufferRange(35345,i,a.buffer.handle,a.offset||0,a.size||a.buffer.byteLength-a.offset),i+=1;break;case"texture":if(!(a instanceof op||a instanceof Xg||a instanceof Kg))throw new Error("texture");let d;if(a instanceof op)d=a.texture;else if(a instanceof Xg)d=a;else if(a instanceof Kg&&a.colorAttachments[0]instanceof op)yr.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=a.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+n),t.bindTexture(d.glTarget,d.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:n,location:i,type:s,textureUnit:a}=t,o=this.uniforms[n]??a;o!==void 0&&LZ(this.device.gl,i,s,o)}}}function QZ(r,e){const t={...r,attributes:r.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const i=t.attributes.find(s=>s.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):yr.warn(`shader layout attribute ${n.name} not present in shader`)}return t}class zZ extends tw{constructor(t){super(t,{});Y(this,"device");Y(this,"commands",[]);this.device=t}submitCommands(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.commands;for(const n of t)switch(n.name){case"copy-buffer-to-buffer":HZ(this.device,n.options);break;case"copy-buffer-to-texture":VZ(this.device,n.options);break;case"copy-texture-to-buffer":jZ(this.device,n.options);break;case"copy-texture-to-texture":$Z(this.device,n.options);break;default:throw new Error(n.name)}}}function HZ(r,e){const t=e.sourceBuffer,n=e.destinationBuffer;r.gl.bindBuffer(36662,t.handle),r.gl.bindBuffer(36663,n.handle),r.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function VZ(r,e){throw new Error("Not implemented")}function jZ(r,e){const{sourceTexture:t,mipLevel:n=0,aspect:i="all",width:s=e.sourceTexture.width,height:a=e.sourceTexture.height,depthOrArrayLayers:o=0,origin:u=[0,0],destinationBuffer:d,byteOffset:p=0,bytesPerRow:_,rowsPerImage:w}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||o!==0||_||w)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:M}=eF(t);let P;try{const D=d,N=s||v.width,z=a||v.height,W=DP(v.colorAttachments[0].texture.props.format),V=W.format,$=W.type;r.gl.bindBuffer(35051,D.handle),P=r.gl.bindFramebuffer(36160,v.handle),r.gl.readPixels(u[0],u[1],N,z,V,$,p)}finally{r.gl.bindBuffer(35051,null),P!==void 0&&r.gl.bindFramebuffer(36160,P),M&&v.destroy()}}function $Z(r,e){const{sourceTexture:t,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:a}=e;let{width:o=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:p}=eF(t),[_,w]=i,[v,M,P]=s,D=r.gl.bindFramebuffer(36160,d.handle);let N=null,z;if(a instanceof Xg)N=a,o=Number.isFinite(o)?o:N.width,u=Number.isFinite(u)?u:N.height,N.bind(0),z=N.glTarget;else throw new Error("invalid destination");switch(z){case 3553:case 34067:r.gl.copyTexSubImage2D(z,n,v,M,_,w,o,u);break;case 35866:case 32879:r.gl.copyTexSubImage3D(z,n,v,M,P,_,w,o,u);break}N&&N.unbind(),r.gl.bindFramebuffer(36160,D),p&&d.destroy()}function eF(r){if(r instanceof hs){const{width:e,height:t,id:n}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:t,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}class GZ extends ew{constructor(t,n){super(t,n);Y(this,"device");Y(this,"commandBuffer");this.device=t,this.commandBuffer=new zZ(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,n,i){}}function qZ(r){const{target:e,source:t,start:n=0,count:i=1}=r,s=t.length,a=i*s;let o=0;for(let u=n;o<s;o++)e[u++]=t[o];for(;o<a;)o<a-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+a-o),o=a);return r.target}class y2 extends rw{constructor(t,n){super(t,n);Y(this,"device");Y(this,"handle");Y(this,"buffer",null);Y(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return MH()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const n=t;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(t,n){const i=n;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:a,stride:o,offset:u,normalized:d,integer:p,divisor:_}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),p?this.device.gl.vertexAttribIPointer(t,s,a,o,u):this.device.gl.vertexAttribPointer(t,s,a,d,o,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,_||0),this.attributes[t]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,n){this._enable(t,!1),this.attributes[t]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const n=this.attributes[t];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(t,n)}}_getAccessor(t){const n=this.attributeInfos[t];if(!n)throw new Error(`Unknown attribute location ${t}`);const i=LP(n.bufferDataType);return{size:n.bufferComponents,type:i,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const s=y2.isConstantAttributeZeroSupported(this.device)||t!==0;(n||s)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,n){const i=KZ(n),s=i.byteLength*t,a=i.length*t;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),o=o||!WZ(i,this.bufferValue),o){const u=O$(n.constructor,a);qZ({target:u,source:i,start:0,count:a}),this.buffer.write(u),this.bufferValue=n}return this.buffer}}function KZ(r){return Array.isArray(r)?new Float32Array(r):r}function WZ(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}class XZ extends nw{constructor(t,n){super(t,n);Y(this,"device");Y(this,"gl");Y(this,"handle");Y(this,"layout");Y(this,"buffers",{});Y(this,"unusedBuffers",{});Y(this,"bindOnUse",!0);Y(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"point-list";this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(NZ(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in t)this.setBuffer(n,t[n])})}setBuffer(t,n){const i=this._getVaryingIndex(t),{buffer:s,byteLength:a,byteOffset:o}=this._getBufferRange(n);if(i<0){this.unusedBuffers[t]=s,yr.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[i]={buffer:s,byteLength:a,byteOffset:o},this.bindOnUse||this._bindBuffer(i,s,o,a)}getBuffer(t){if(tF(t))return this.buffers[t]||null;const n=this._getVaryingIndex(t);return n>=0?this.buffers[n]:null}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let n;return this._bound?n=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof Wg)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:n,byteOffset:i=0,byteLength:s=t.buffer.byteLength}=t;return{buffer:n,byteOffset:i,byteLength:s}}_getVaryingIndex(t){if(tF(t))return Number(t);for(const n of this.layout.varyings)if(t===n.name)return n.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:n,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),n,s,i)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;const a=n&&n.handle;!a||s===void 0?this.gl.bindBufferBase(35982,t,a):this.gl.bindBufferRange(35982,t,a,i,s)}}function tF(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}class YZ extends iw{constructor(t,n){super(t,n);Y(this,"device");Y(this,"handle");Y(this,"target",null);Y(this,"_queryPending",!1);Y(this,"_pollingPromise",null);if(this.device=t,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,s)=>{const a=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}}class SA extends dA{constructor(t){var _,w;super({...t,id:t.id||JY("webgl-device")});Y(this,"type","webgl");Y(this,"handle");Y(this,"features");Y(this,"limits");Y(this,"info");Y(this,"canvasContext");Y(this,"lost");Y(this,"_resolveContextLost");Y(this,"gl");Y(this,"debug",!1);Y(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});Y(this,"_extensions",{});Y(this,"_polyfilled",!1);Y(this,"spectorJS");Y(this,"renderPass",null);Y(this,"_constants");const n=dA._getCanvasContextProps(t);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(w=(_=n.canvas)==null?void 0:_.gl)==null?void 0:w.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new HY(this,n),this.lost=new Promise(v=>{this._resolveContextLost=v});const s={...t.webgl};n.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),t.powerPreference!==void 0&&(s.powerPreference=t.powerPreference);const o=this.props._handle||wY(this.canvasContext.canvas,{onContextLost:v=>{var M;return(M=this._resolveContextLost)==null?void 0:M.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:v=>console.log("WebGL context restored")},s);if(!o)throw new Error("WebGL context creation failed");if(i=o.device,i){if(t._reuseDevices)return yr.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=o,this.gl=o,this.spectorJS=$Y({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=xY(this.gl,this._extensions),this.limits=new kY(this.gl),this.features=new NY(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new Uf(this.gl,{log:function(){for(var v=arguments.length,M=new Array(v),P=0;P<v;P++)M[P]=arguments[P];return yr.log(1,...M)()}}).trackState(this.gl,{copyState:!1});const d=t.debugWebGL||t.debug,p=t.debugWebGL;d&&(this.gl=KY(this.gl,{debugWebGL:d,traceWebGL:p}),yr.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(yr.level=Math.max(yr.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const n=this._normalizeBufferProps(t);return new Wg(this,n)}createTexture(t){return new Xg(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new _2(this,t)}createShader(t){return new nZ(this,t)}createFramebuffer(t){return new Kg(this,t)}createVertexArray(t){return new y2(this,t)}createTransformFeedback(t){return new XZ(this,t)}createQuerySet(t){return new YZ(this,t)}createRenderPipeline(t){return new kZ(this,t)}beginRenderPass(t){return new wZ(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new GZ(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,n){return mZ(t,n)}readPixelsToBufferWebGL(t,n){return _Z(t,n)}setParametersWebGL(t){rp(this.gl,t)}getParametersWebGL(t){return PP(this.gl,t)}withParametersWebGL(t,n){return Ny(this.gl,t,n)}resetWebGL(){yr.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),mY(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return LY(this.gl,t,this._extensions)}loseDevice(){var s;let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Uf.get(this.gl).push()}popState(){Uf.get(this.gl).pop()}setSpectorMetadata(t,n){t.__SPECTOR_Metadata=n}getGLKey(t,n){const i=Number(t);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return n!=null&&n.emptyIfUnknown?"":String(t)}getGLKeys(t){const n={emptyIfUnknown:!0};return Object.entries(t).reduce((i,s)=>{let[a,o]=s;return i[`${a}:${this.getGLKey(a,n)}`]=`${o}:${this.getGLKey(o,n)}`,i},{})}setConstantAttributeWebGL(t,n){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[t];switch(s&&tJ(s,n)&&yr.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=n,n.constructor){case Float32Array:ZZ(this,t,n);break;case Int32Array:JZ(this,t,n);break;case Uint32Array:eJ(this,t,n);break;default:throw new Error("constant")}}getExtension(t){return np(this.gl,t,this._extensions),this._extensions}}function ZZ(r,e,t){switch(t.length){case 1:r.gl.vertexAttrib1fv(e,t);break;case 2:r.gl.vertexAttrib2fv(e,t);break;case 3:r.gl.vertexAttrib3fv(e,t);break;case 4:r.gl.vertexAttrib4fv(e,t);break}}function JZ(r,e,t){r.gl.vertexAttribI4iv(e,t)}function eJ(r,e,t){r.gl.vertexAttribI4uiv(e,t)}function tJ(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}const rJ={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},nJ=r=>({drawBuffersWEBGL(e){return r.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),iJ=r=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return r.createVertexArray()},deleteVertexArrayOES(e){return r.deleteVertexArray(e)},isVertexArrayOES(e){return r.isVertexArray(e)},bindVertexArrayOES(e){return r.bindVertexArray(e)}}),sJ=r=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(){return r.drawArraysInstanced(...arguments)},drawElementsInstancedANGLE(){return r.drawElementsInstanced(...arguments)},vertexAttribDivisorANGLE(){return r.vertexAttribDivisor(...arguments)}});function oJ(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=HTMLCanvasElement.prototype;if(!r&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,n){if(t==="webgl"||t==="experimental-webgl"){const i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&aJ(i),i}return this.originalGetContext(t,n)}}function aJ(r){r.getExtension("EXT_color_buffer_float");const e={...rJ,WEBGL_disjoint_timer_query:r.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:nJ(r),OES_vertex_array_object:iJ(r),ANGLE_instanced_arrays:sJ(r)},t=r.getExtension;r.getExtension=function(i){const s=t.call(r,i);return s||(i in e?e[i]:null)};const n=r.getSupportedExtensions;r.getSupportedExtensions=function(){const i=n.apply(r)||[];return i==null?void 0:i.concat(Object.keys(e))}}const ky=1;class lJ extends h${constructor(){super();Y(this,"type","webgl");dA.defaultProps={...dA.defaultProps,...A2},SA.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){oJ(t)}async attach(t){if(t instanceof SA)return t;if((t==null?void 0:t.device)instanceof dA)return t.device;if(!cJ(t))throw new Error("Invalid WebGL2RenderingContext");return new SA({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};yr.groupCollapsed(ky,"WebGLDevice created")();const n=[];(t.debugWebGL||t.debug)&&n.push(qY()),t.debugSpectorJS&&n.push(jY(t));const i=await Promise.allSettled(n);for(const o of i)o.status==="rejected"&&yr.error(`Failed to initialize debug libraries ${o.reason}`)();const s=new SA(t),a=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return yr.probe(ky,a)(),yr.table(ky,s.info)(),yr.groupEnd(ky)(),s}}function cJ(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}const rF=new lJ;function IA(){}const nF={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:IA,onWebGLInitialized:IA,onResize:IA,onViewStateChange:IA,onInteractionStateChange:IA,onBeforeRender:IA,onAfterRender:IA,onLoad:IA,onError:r=>Wn.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:r=>{let{isDragging:e}=r;return e?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class Yg{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Nd({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const s=n.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=Dw[n.type],s=n.offsetCenter;if(!i||!s||!this.layerManager)return;const a=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:a,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=o,d=u&&(u[i]||u.props[i]),p=this.props[i];let _=!1;d&&(_=d.call(u,o,n)),_||(p==null||p(o,n),this.widgetManager.onEvent(o,n))},this._onPointerDown=n=>{const i=n.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...nF,...e},e=this.props,e.viewState&&e.initialViewState&&Wn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Wn.error("WebGL1 context not supported.")(),t=rF.attach(e.gl)),t||(t=Yv.createDevice({type:"best-available",_reuseDevices:!0,adapters:[rF],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Qg.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,i,s,a,o,u,d,p;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(a=this.deckRenderer)==null||a.finalize(),this.deckRenderer=null,(o=this.deckPicker)==null||o.finalize(),this.deckPicker=null,(u=this.eventManager)==null||u.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((p=this.canvas.parentElement)==null||p.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Wn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Wn.removed("onLayerClick","onClick")(),e.initialViewState&&!Qc(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t=t||n||i||s||a,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return yo(this.viewManager),this.viewManager.views}getViewports(e){return yo(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,n){yo(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),yo(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:t,height:n}=e;if(t||t===0){const s=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=s}if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,(i=this.viewManager)==null||i.setProps({width:t,height:n}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:i,useDevicePixels:s}=t;return new pX({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new a2({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,n,i;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let o=a,u=!1;for(const d of s)o=d,u=((t=d.layer)==null?void 0:t.onHover(d,e.event))||u;u||((i=(n=this.props).onHover)==null||i.call(n,o,e.event),this.widgetManager.onHover(o,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device instanceof SA&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof SA&&this.props.onWebGLInitialized(this.device.gl);const t=new AP;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new tW(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(VM).map(a=>{var v;const[o,u,d,p]=VM[a],_=(v=this.props.eventRecognizerOptions)==null?void 0:v[a],w={...u,..._,event:a};return{recognizer:new o(w),recognizeWith:d,requestFailure:p}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const a in Dw)this.eventManager.on(a,this._onEvent);this.viewManager=new kX({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new NX(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new JX({deck:this,device:this.device}),this.deckRenderer=new rY(this.device),this.deckPicker=new lY(this.device),this.widgetManager=new hY({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new fY),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var a;const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(a=this.deckRenderer)==null||a.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Wn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=Yv.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Yg.defaultProps=nF,Yg.VERSION=yj;function uJ(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return d5(r)}}const hJ=f5;function Qy(r,e){return{attribute:r,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Nf(r){return r.stride||r.size*r.bytesPerElement}function AJ(r,e){return r.type===e.type&&r.size===e.size&&Nf(r)===Nf(e)&&(r.offset||0)===(e.offset||0)}function b2(r,e){e.offset&&Wn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Nf(r),n=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,i=e.elementOffset||0,s=n*t+i*r.bytesPerElement+(r.offset||0);return{...e,offset:s,stride:t}}function fJ(r,e){const t=b2(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}class dJ{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,s=i==="float64";let{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let o;s?o="float32":!i&&t.isIndexed?o="uint32":o=i||"float32";let u=uJ(i||o);this.doublePrecision=s,s&&t.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...t,defaultType:u,defaultValue:a,logicalType:i,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Nf(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Qg.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const n={};if(this.state.constant){const i=this.value;if(t){const s=b2(this.getAccessor(),t),a=s.offset/i.BYTES_PER_ELEMENT,o=s.size||this.size;n[e]=i.subarray(a,a+o)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const n=this.getAccessor(),i=[],s={name:this.id,byteStride:Nf(n),attributes:i};if(this.doublePrecision){const a=fJ(n,t||{});i.push(Qy(e,{...n,...a.high}),Qy(`${e}64Low`,{...n,...a.low}))}else if(t){const a=b2(n,t);i.push(Qy(e,{...n,...a}))}else i.push(Qy(e,n));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,s=n*i;if(t&&s&&t.length>=s){const a=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let d=0;d<i;d++){const p=t[u++];p<a[d]&&(a[d]=p),p>o[d]&&(o[d]=p)}e=[a,o]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Rs?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const a=hJ(n.value);i.type=i.normalized?a.replace("int","norm"):a}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Nf(i)}if(t.bounds=null,n.constant){let s=n.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!t.constant||!this._areValuesEqual(s,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(n.buffer){const s=n.buffer;t.externalBuffer=s,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let s=n.value;t.externalBuffer=null,t.constant=!1,this.value=s;let{buffer:a}=this;const o=Nf(i),u=(i.vertexOffset||0)*o;if(this.doublePrecision&&s instanceof Float64Array&&(s=Ww(s,i)),this.settings.isIndexed){const p=this.settings.defaultType;s.constructor!==p&&(s=new p(s))}const d=s.byteLength+u+o*2;(!a||a.byteLength<d)&&(a=this._createBuffer(d)),a.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Ww(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:n}=this,i=n.allocatedValue,s=Qg.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;const{byteOffset:a}=this;let{buffer:o}=this;return(!o||o.byteLength<s.byteLength+a)&&(o=this._createBuffer(s.byteLength+a),t&&i&&o.write(i instanceof Float64Array?Ww(i,this):i,a)),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Wn.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let a=s;for(;--a>=0;)t[n+a]=i[a];return t}switch(s){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let a=s;for(;--a>=0;)t[n+a]=Number.isFinite(e[a])?e[a]:i[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:t?Rs.INDEX:Rs.VERTEX,indexType:t?n:void 0,byteLength:e}),this._buffer}}const iF=[],sF=[];function oF(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=iF;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(sF.length=r.length,n=sF):n=iF,(e>0||Number.isFinite(t))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,t),i.index=e-1),{iterable:n,objectInfo:i}}function aF(r){return r&&r[Symbol.asyncIterator]}function pJ(r,e){const{size:t,stride:n,offset:i,startIndices:s,nested:a}=e,o=r.BYTES_PER_ELEMENT,u=n?n/o:t,d=i?i/o:0,p=Math.floor((r.length-d)/u);return(_,w)=>{let{index:v,target:M}=w;if(!s){const z=v*u+d;for(let W=0;W<t;W++)M[W]=r[z+W];return M}const P=s[v],D=s[v+1]||p;let N;if(a){N=new Array(D-P);for(let z=P;z<D;z++){const W=z*u+d;M=new Array(t);for(let V=0;V<t;V++)M[V]=r[W+V];N[z-P]=M}}else if(u===t)N=r.subarray(P*t+d,D*t+d);else{N=new r.constructor((D-P)*t);let z=0;for(let W=P;W<D;W++){const V=W*u+d;for(let $=0;$<t;$++)N[z++]=r[V+$]}}return N}}const gJ=[],zy=[[0,1/0]];function mJ(r,e){if(r===zy||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const t=[],n=r.length;let i=0;for(let s=0;s<n;s++){const a=r[s];a[1]<e[0]?(t.push(a),i=s+1):a[0]>e[1]?t.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return t.splice(i,0,e),t}const _J={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function lF(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const t=r.type||"interpolation";return{..._J[t],...e,...r,type:t}}class cF extends dJ{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:zy}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!AJ(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,i=Array.isArray(t)?e[t.find(s=>e[s])]:e[t];return lF(i,n)}setNeedsUpdate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:n=0,endRow:i=1/0}=t;this.state.updateRanges=mJ(this.state.updateRanges,[n,i])}else this.state.updateRanges=zy}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=gJ}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,t.updateRanges!==zy),!0):!1}updateBuffer(e){let{numInstances:t,data:n,props:i,context:s}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:o,noAlloc:u}}=this;let d=!0;if(o){for(const[p,_]of a)o.call(s,this,{data:n,startRow:p,endRow:_,props:i,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[p,_]of a){const w=Number.isFinite(p)?this.getVertexOffset(p):0,v=Number.isFinite(_)?this.getVertexOffset(_):u||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:w,endOffset:v})}this._checkAttributeArray()}else d=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),d}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const a=e;yo(ArrayBuffer.isView(a.value),`invalid ${i.accessor}`);const o=!!a.size&&a.size!==this.size;return n.binaryAccessor=pJ(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:t,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!t)return n;for(const s in t){const a=super._getBufferLayout(s,t[s]);n.attributes.push(...a.attributes)}return n}_autoUpdater(e,t){let{data:n,startRow:i,endRow:s,props:a,numInstances:o}=t;if(e.constant)return;const{settings:u,state:d,value:p,size:_,startIndices:w}=e,{accessor:v,transform:M}=u,P=d.binaryAccessor||(typeof v=="function"?v:a[v]);yo(typeof P=="function",`accessor "${v}" is not a function`);let D=e.getVertexOffset(i);const{iterable:N,objectInfo:z}=oF(n,i,s);for(const W of N){z.index++;let V=P(W,z);if(M&&(V=M.call(this,V)),w){const $=(z.index<w.length-1?w[z.index+1]:o)-w[z.index];if(V&&Array.isArray(V[0])){let q=D;for(const te of V)e._normalizeValue(te,p,q),q+=_}else V&&V.length>_?p.set(V,D):(e._normalizeValue(V,z.target,0),RX({target:p,source:z.target,start:D,count:$}));D+=$*_}else e._normalizeValue(V,p,D),D+=_}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function v2(r){const{source:e,target:t,start:n=0,size:i,getData:s}=r,a=r.end||t.length,o=e.length,u=a-n;if(o>u){t.set(e.subarray(0,u),n);return}if(t.set(e,n),!s)return;let d=o;for(;d<u;){const p=s(d,e);for(let _=0;_<i;_++)t[n+d]=p[_]||0,d++}}function yJ(r){let{source:e,target:t,size:n,getData:i,sourceStartIndices:s,targetStartIndices:a}=r;if(!s||!a)return v2({source:e,target:t,size:n,getData:i}),t;let o=0,u=0;const d=i&&((_,w)=>i(_+u,w)),p=Math.min(s.length,a.length);for(let _=1;_<p;_++){const w=s[_]*n,v=a[_]*n;v2({source:e.subarray(o,w),target:t,start:u,end:v,size:n,getData:d}),o=w,u=v}return u<t.length&&v2({source:[],target:t,start:u,size:n,getData:d}),t}function bJ(r){const{device:e,settings:t,value:n}=r,i=new cF(e,t);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function uF(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function hF(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function AF(r){r.push(r.shift())}function vJ(r,e){const{doublePrecision:t,settings:n,value:i,size:s}=r,a=t&&i instanceof Float64Array?2:1;let o=0;const{shaderAttributes:u}=r.settings;if(u)for(const d of Object.values(u))o=Math.max(o,d.vertexOffset??0);return(n.noAlloc?i.length:(e+o)*s)*a}function fF(r){let{device:e,source:t,target:n}=r;return(!n||n.byteLength<t.byteLength)&&(n==null||n.destroy(),n=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),n}function dF(r){let{device:e,buffer:t,attribute:n,fromLength:i,toLength:s,fromStartIndices:a,getData:o=V=>V}=r;const u=n.doublePrecision&&n.value instanceof Float64Array?2:1,d=n.size*u,p=n.byteOffset,_=n.settings.bytesPerElement<4?p/n.settings.bytesPerElement*4:p,w=n.startIndices,v=a&&w,M=n.isConstant;if(!v&&t&&i>=s)return t;const P=n.value instanceof Float64Array?Float32Array:n.value.constructor,D=M?n.value:new P(n.getBuffer().readSyncWebGL(p,s*P.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!M){const V=o;o=($,q)=>n.normalizeConstant(V($,q))}const N=M?(V,$)=>o(D,$):(V,$)=>o(D.subarray(V+p,V+p+d),$),z=t?new Float32Array(t.readSyncWebGL(_,i*4).buffer):new Float32Array(0),W=new Float32Array(s);return yJ({source:z,target:W,sourceStartIndices:a,targetStartIndices:w,size:d,getData:N}),(!t||t.byteLength<W.byteLength+_)&&(t==null||t.destroy(),t=e.createBuffer({byteLength:W.byteLength+_,usage:35050})),t.write(W,_),t}class pF{constructor(e){let{device:t,attribute:n,timeline:i}=e;this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Oy(i),this.attribute=n,this.attributeInTransition=bJ(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0;this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=vJ(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class wJ extends pF{constructor(e){let{device:t,attribute:n,timeline:i}=e;super({device:t,attribute:n,timeline:i}),this.type="interpolation",this.transform=CJ(t,n)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:a}=this;AF(s),s[0]=dF({device:this.device,buffer:s[0],attribute:a,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=fF({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:o}=this,u=o.model;let d=Math.floor(this.currentLength/a.size);mF(a)&&(d/=2),u.setVertexCount(d),a.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:a.value})):u.setAttributes({aFrom:s[0],aTo:a.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:s}=this.transform,a={time:i};s.shaderInputs.setProps({interpolation:a}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const gF={name:"interpolation",vs:`uniform interpolationUniforms {
  float time;
} interpolation;
`,uniformTypes:{time:"f32"}},xJ=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,BJ=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function mF(r){return r.doublePrecision&&r.value instanceof Float64Array}function CJ(r,e){const t=e.size,n=uF(t),i=hF(t),s=e.getBufferLayout();return mF(e)?new jg(r,{vs:BJ,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[Yq,gF],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new jg(r,{vs:xJ,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[gF],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class TJ extends pF{constructor(e){let{device:t,attribute:n,timeline:i}=e;super({device:t,attribute:n,timeline:i}),this.type="spring",this.texture=PJ(t),this.framebuffer=FJ(t,this.texture),this.transform=MJ(t,n)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:s,attribute:a}=this;for(let u=0;u<2;u++)s[u]=dF({device:this.device,buffer:s[u],attribute:a,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=fF({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/a.size)),a.isConstant?o.setConstantAttributes({aTo:a.value}):o.setAttributes({aTo:a.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const a={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:a}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),AF(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const EJ={name:"spring",vs:`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,uniformTypes:{damping:"f32",stiffness:"f32"}},SJ=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,IJ=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function MJ(r,e){const t=uF(e.size),n=hF(e.size);return new jg(r,{vs:SJ,fs:IJ,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[EJ],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function PJ(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function FJ(r,e){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const RJ={interpolation:wJ,spring:TJ};class LJ{constructor(e,t){let{id:n,timeline:i}=t;if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:n,numInstances:i}=e;this.numInstances=i||1;for(const s in t){const a=t[s],o=a.getTransitionSetting(n);o&&this._updateAttribute(s,a,o)}for(const s in this.transitions){const a=t[s];(!a||!a.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let s=!i||i.type!==n.type;if(s){i&&this._removeTransition(e);const a=RJ[n.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,device:this.device}):(Wn.error(`unsupported transition type '${n.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const _F="attributeManager.invalidate",OJ="attributeManager.updateStart",UJ="attributeManager.updateEnd",DJ="attribute.updateStart",NJ="attribute.allocate",kJ="attribute.updateEnd";class QJ{constructor(e){let{id:t="attribute-manager",stats:n,timeline:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.mergeBoundsMemoized=Dg(rX),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new LJ(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);la(_F,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);la(_F,this,"all")}update(e){let{data:t,numInstances:n,startIndices:i=null,transitions:s,props:a={},buffers:o={},context:u={}}=e,d=!1;la(OJ,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const p in this.attributes){const _=this.attributes[p],w=_.settings.accessor;_.startIndices=i,_.numInstances=n,a[p]&&Wn.removed(`props.${p}`,`data.attributes.${p}`)(),_.setExternalBuffer(o[p])||_.setBinaryValue(typeof w=="string"?o[w]:void 0,t.startIndices)||typeof w=="string"&&!o[w]&&_.setConstantValue(a[w])||_.needsUpdate()&&(d=!0,this._updateAttribute({attribute:_,numInstances:n,data:t,props:a,context:u})),this.needsRedraw=this.needsRedraw||_.needsRedraw()}d&&la(UJ,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(n=>{var i;return(i=this.attributes[n])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const s in t){const a=t[s];a.needsRedraw(e)&&!n.hasAttribute(s)&&(i[s]=a)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const i=e[n],s={...i,id:n,size:i.isIndexed&&1||i.size||1,...t};this.attributes[n]=new cF(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,s=i[e];return s&&s.forEach(a=>{const o=n[a];o&&o.setNeedsUpdate(o.id,t)}),s}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(la(DJ,t),t.constant){t.setConstantValue(t.value);return}t.allocate(n)&&la(NJ,t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,la(kJ,t,n))}}class zJ extends Oy{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:s}}=this,a=s(e/i);this._value=my(t,n,a)}}const yF=1e-5;function bF(r,e,t,n,i){const s=e-r,o=(t-e)*i,u=-s*n;return o+u+s+e}function HJ(r,e,t,n,i){if(Array.isArray(t)){const s=[];for(let a=0;a<t.length;a++)s[a]=bF(r[a],e[a],t[a],n,i);return s}return bF(r,e,t,n,i)}function vF(r,e){if(Array.isArray(r)){let t=0;for(let n=0;n<r.length;n++){const i=r[n]-e[n];t+=i*i}return Math.sqrt(t)}return Math.abs(r-e)}class VJ extends Oy{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:a=e}=this;let o=HJ(s,a,t,n,i);const u=vF(o,t),d=vF(o,a);u<yF&&d<yF&&(o=t,this.end()),this._prevValue=a,this._currValue=o}}const jJ={interpolation:zJ,spring:VJ};class $J{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:d=u.settings.fromValue}=u;t=d,this.remove(e)}if(i=lF(i),!i)return;const a=jJ[i.type];if(!a){Wn.error(`unsupported transition type '${i.type}'`)();return}const o=new a(this.timeline);o.start({...i,fromValue:t,toValue:n}),s.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function GJ(r){const e=r[xA];for(const t in e){const n=e[t],{validate:i}=n;if(i&&!i(r[t],n))throw new Error(`Invalid prop ${t}: ${r[t]}`)}}function qJ(r,e){const t=wF({newProps:r,oldProps:e,propTypes:r[xA],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=WJ(r,e);let i=!1;return n||(i=XJ(r,e)),{dataChanged:n,propsChanged:t,updateTriggersChanged:i,extensionsChanged:YJ(r,e),transitionsChanged:KJ(r,e)}}function KJ(r,e){if(!r.transitions)return!1;const t={},n=r[xA];let i=!1;for(const s in r.transitions){const a=n[s],o=a&&a.type;(o==="number"||o==="color"||o==="array")&&w2(r[s],e[s],a)&&(t[s]=!0,i=!0)}return i?t:!1}function wF(r){let{newProps:e,oldProps:t,ignoreProps:n={},propTypes:i={},triggerName:s="props"}=r;if(t===e)return!1;if(typeof e!="object"||e===null)return`${s} changed shallowly`;if(typeof t!="object"||t===null)return`${s} changed shallowly`;for(const a of Object.keys(e))if(!(a in n)){if(!(a in t))return`${s}.${a} added`;const o=w2(e[a],t[a],i[a]);if(o)return`${s}.${a} ${o}`}for(const a of Object.keys(t))if(!(a in n)){if(!(a in e))return`${s}.${a} dropped`;if(!Object.hasOwnProperty.call(e,a)){const o=w2(e[a],t[a],i[a]);if(o)return`${s}.${a} ${o}`}}return!1}function w2(r,e,t){let n=t&&t.equal;return n&&!n(r,e,t)||!n&&(n=r&&e&&r.equals,n&&!n.call(r,e))?"changed deeply":!n&&e!==r?"changed shallowly":null}function WJ(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(r.data,e.data)||t),t}function XJ(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&xF(r,e,"all"))return{all:!0};const t={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&xF(r,e,i)&&(t[i]=!0,n=!0);return n?t:!1}function YJ(r,e){if(e===null)return!0;const t=e.extensions,{extensions:n}=r;if(n===t)return!1;if(!t||!n||n.length!==t.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(t[i]))return!0;return!1}function xF(r,e,t){let n=r.updateTriggers[t];n=n??{};let i=e.updateTriggers[t];return i=i??{},wF({oldProps:i,newProps:n,triggerName:t})}const ZJ="count(): argument not an object",JJ="count(): argument not a container";function eee(r){if(!ree(r))throw new Error(ZJ);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(tee(r))return Object.keys(r).length;throw new Error(JJ)}function tee(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function ree(r){return r!==null&&typeof r=="object"}function BF(r,e){if(!e)return r;const t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=t.modules.findIndex(i=>i.name==="project32");n>=0&&t.modules.splice(n,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{const n={...r.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];t.inject=n}return t}const nee={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},x2={};function iee(r,e,t,n){if(t instanceof hs)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const s=e.createTexture({...t,sampler:{...nee,...i,...n},mipmaps:!0});return x2[s.id]=r,s}function see(r,e){!e||!(e instanceof hs)||x2[e.id]===r&&(e.delete(),delete x2[e.id])}const oee={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||B2(r)&&(r.length===3||r.length===4)},equal(r,e,t){return Qc(r,e,1)}},accessor:{validate(r,e){const t=Hy(r);return t==="function"||t===Hy(e.value)},equal(r,e,t){return typeof e=="function"?!0:Qc(r,e,1)}},array:{validate(r,e){return e.optional&&!r||B2(r)},equal(r,e,t){const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?Qc(r,e,i):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?Qc(r,e,i):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{if(!r)return r;const{dataTransform:n}=t.props;return n?n(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,e,t)=>{const n=t.context;return!n||!n.device?null:iee(t.id,n.device,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{see(t.id,r)}}};function aee(r){const e={},t={},n={};for(const[i,s]of Object.entries(r)){const a=s==null?void 0:s.deprecatedFor;if(a)n[i]=Array.isArray(a)?a:[a];else{const o=lee(i,s);e[i]=o,t[i]=o.value}}return{propTypes:e,defaultProps:t,deprecatedProps:n}}function lee(r,e){switch(Hy(e)){case"object":return Zg(r,e);case"array":return Zg(r,{type:"array",value:e,compare:!1});case"boolean":return Zg(r,{type:"boolean",value:e});case"number":return Zg(r,{type:"number",value:e});case"function":return Zg(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function Zg(r,e){return"type"in e?{name:r,...oee[e.type],...e}:"value"in e?{name:r,type:Hy(e.value),...e}:{name:r,type:"object",value:e}}function B2(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function Hy(r){return B2(r)?"array":r===null?"null":typeof r}function cee(r,e){let t;for(let s=e.length-1;s>=0;s--){const a=e[s];"extensions"in a&&(t=a.extensions)}const n=C2(r.constructor,t),i=Object.create(n);i[Ly]=r,i[Lf]={},i[BA]={};for(let s=0;s<e.length;++s){const a=e[s];for(const o in a)i[o]=a[o]}return Object.freeze(i),i}const uee="_mergedDefaultProps";function C2(r,e){if(!(r instanceof Vy.constructor))return{};let t=uee;if(e)for(const i of e){const s=i.constructor;s&&(t+=`:${s.extensionName||s.name}`)}const n=CF(r,t);return n||(r[t]=hee(r,e||[]))}function hee(r,e){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=C2(n),s=CF(r,"defaultProps")||{},a=aee(s),o=Object.assign(Object.create(null),i,a.defaultProps),u=Object.assign(Object.create(null),i==null?void 0:i[xA],a.propTypes),d=Object.assign(Object.create(null),i==null?void 0:i[i2],a.deprecatedProps);for(const p of e){const _=C2(p.constructor);_&&(Object.assign(o,_),Object.assign(u,_[xA]),Object.assign(d,_[i2]))}return Aee(o,r),dee(o,u),fee(o,d),o[xA]=u,o[i2]=d,e.length===0&&!T2(r,"_propTypes")&&(r._propTypes=u),o}function Aee(r,e){const t=gee(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function fee(r,e){for(const t in e)Object.defineProperty(r,t,{enumerable:!1,set(n){const i=`${this.id}: ${t}`;for(const s of e[t])T2(this,s)||(this[s]=n);Wn.deprecated(i,e[t].join("/"))()}})}function dee(r,e){const t={},n={};for(const i in e){const s=e[i],{name:a,value:o}=s;s.async&&(t[a]=o,n[a]=pee(a))}r[Zd]=t,r[Lf]={},Object.defineProperties(r,n)}function pee(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||aF(e)?this[Lf][r]=e:this[BA][r]=e},get(){if(this[BA]){if(r in this[BA])return this[BA][r]||this[Zd][r];if(r in this[Lf]){const e=this[Ly]&&this[Ly].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[Zd][r]}}return this[Zd][r]}}}function T2(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function CF(r,e){return T2(r,e)&&r[e]}function gee(r){const e=r.componentName;return e||Wn.warn(`${r.name}.componentName not specified`)(),e||r.name}let mee=0;class Vy{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.props=cee(this,t),this.id=this.props.id,this.count=mee++}clone(e){const{props:t}=this,n={};for(const i in t[Zd])i in t[BA]?n[i]=t[BA][i]:i in t[Lf]&&(n[i]=t[Lf][i]);return new this.constructor({...t,...n,...e})}}Vy.componentName="Component",Vy.defaultProps={};const _ee=Object.freeze({});class yee{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||_ee}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Ly]||this.component;const t=e[BA]||{},n=e[Lf]||e,i=e[Zd]||{};for(const s in t){const a=t[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a),t[s]=this.getAsyncProp(s)}for(const s in n){const a=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(aF(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t===n.resolvedValue||t===n.lastValue?!1:(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(s=>{this.component&&(s=this._postProcessValue(n,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let s=[],a=0;for await(const o of t){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(o,s):s=s.concat(o),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[xA];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class bee extends yee{constructor(e){let{attributeManager:t,layer:n}=e;super(n),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const vee="layer.changeFlag",wee="layer.initialize",xee="layer.update",Bee="layer.finalize",Cee="layer.matched",TF=2**24-1,Tee=Object.freeze([]),Eee=Dg(r=>{let{oldViewport:e,viewport:t}=r;return e.equals(t)});let zc=new Uint8ClampedArray(0);const See={data:{type:"data",value:Tee,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,e)=>{let{propName:t,layer:n,loaders:i,loadOptions:s,signal:a}=e;const{resourceManager:o}=n.context;s=s||n.getLoadOptions(),i=i||n.props.loaders,a&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:a}});let u=o.contains(r);return!u&&!s&&(o.add({resourceId:r,data:AA(r,i),persistent:!1}),u=!0),u?o.subscribe({resourceId:r,onChange:d=>{var p;return(p=n.internalState)==null?void 0:p.reloadAsyncProp(t,d)},consumerId:n.id,requestId:t}):AA(r,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Hn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:r=>{let{layerIndex:e}=r;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class ap extends Vy{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Yd.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){yo(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=hP(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,a]=YM(n,t.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,a]}unproject(e){return yo(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){yo(this.internalState);const n=this.internalState.viewport||this.context.viewport;return lX(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(){for(const e of this.getModels())e.shaderInputs.setProps(...arguments)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Hn.DEFAULT||e===Hn.LNGLAT||e===Hn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){yo(e instanceof Uint8Array);const[t,n,i]=e;return t+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:eee(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=BF(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=BF(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const i of n)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,s=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(s!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:o,instancePickingColors:u}=t.attributes,d=o||u;d&&(a&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!a&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo(e){let{info:t,mode:n,sourceLayer:i}=e;const{index:s}=t;return s>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[s]),t}raiseError(e,t){var n,i,s,a;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(i=(n=this.props).onError)!=null&&i.call(n,e)||(a=(s=this.context)==null?void 0:s.onError)==null||a.call(s,e,this)}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!Eee({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const i in t)Object.defineProperty(n,i,{value:t[i]});return n}return this.props}calculateInstancePickingColors(e,t){let{numInstances:n}=t;if(e.constant)return;const i=Math.floor(zc.length/4);if(this.internalState.usesPickingColorCache=!0,i<n){n>TF&&Wn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),zc=Qg.allocate(zc,n,{size:4,copy:!0,maxCount:Math.max(n,TF)});const s=Math.floor(zc.length/4),a=[0,0,0];for(let o=i;o<s;o++)this.encodePickingColor(o,a),zc[o*4+0]=a[0],zc[o*4+1]=a[1],zc[o*4+2]=a[2],zc[o*4+3]=0}e.value=zc.subarray(0,n*4)}_setModelAttributes(e,t){var o;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!Object.keys(t).length)return;if(n){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),t=u.getAttributes()}const i=((o=e.userData)==null?void 0:o.excludeAttributes)||{},s={},a={};for(const u in t){if(i[u])continue;const d=t[u].getValue();for(const p in d){const _=d[p];_ instanceof Rs?t[u].settings.isIndexed?e.setIndexBuffer(_):s[p]=_:_&&(a[p]=_)}}e.setAttributes(s),e.setConstantAttributes(a)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i,a=s&&t.attributes&&t.attributes[s.id];if(a&&a.value){const o=a.value,u=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const p=s.getVertexOffset(d);o[p]===u[0]&&o[p+1]===u[1]&&o[p+2]===u[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const s=i.getVertexOffset(e),a=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(a-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==zc.buffer&&(n.value=zc.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){yo(!this.internalState),yo(Number.isFinite(this.props.coordinateSystem)),la(wee,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new bee({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Wn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new $J(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){la(Cee,this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(la(xee,this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,s=n.viewport,a=this._updateUniformTransition();i.propsInTransition=a,n.viewport=i.viewport||s,this.props=a;try{const o=this._getUpdateParams(),u=this.getModels();if(n.device)this.updateState(o);else try{this.updateState(o)}catch{}for(const p of this.props.extensions)p.updateState.call(this,o,p);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==u[0];this._postUpdate(o,d)}finally{n.viewport=s,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){la(Bee,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{renderPass:t,shaderModuleProps:n=null,uniforms:i={},parameters:s={}}=e;this._updateAttributeTransition();const a=this.props,o=this.context;this.props=this.internalState.propsInTransition||a;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:u}=this.props,d=u&&u(i)||[0,0];o.device instanceof SA&&o.device.setParametersWebGL({polygonOffset:d});for(const p of this.getModels())p.setParameters(s);if(o.device instanceof SA)o.device.withParametersWebGL(s,()=>{const p={renderPass:t,shaderModuleProps:n,uniforms:i,parameters:s,context:o};for(const _ of this.props.extensions)_.draw.call(this,p,_);this.draw(p)});else{const p={renderPass:t,shaderModuleProps:n,uniforms:i,parameters:s,context:o};for(const _ of this.props.extensions)_.draw.call(this,p,_);this.draw(p)}}finally{this.props=a}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const a=e[i],o=t[i];a&&Array.isArray(o)&&(t.dataChanged=Array.isArray(a)?o.concat(a):a,s=!0);default:t[i]||(t[i]=e[i],s=!0)}s&&la(vee,this,i,e)}const n=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var i;const n=qJ(e,t);if(n.updateTriggersChanged)for(const s in n.updateTriggersChanged)n.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(n.transitionsChanged)for(const s in n.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(n)}validateProps(){GJ(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new QJ(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:o,highlightColor:u}=n;if(t||i.autoHighlight!==a||i.highlightedObjectIndex!==o||i.highlightColor!==u){const d={};Array.isArray(u)&&(d.highlightColor=u),(t||i.autoHighlight!==a||o!==i.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(t=t||i,t)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ap.defaultProps=See,ap.layerName="Layer";const Iee="compositeLayer.renderLayers";class EF extends ap{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:t}=e;const{object:n}=t;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(t.object=n.__source.object,t.index=n.__source.index),t}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(){var te;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{opacity:t,pickable:n,visible:i,parameters:s,getPolygonOffset:a,highlightedObjectIndex:o,autoHighlight:u,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:w,positionFormat:v,modelMatrix:M,extensions:P,fetch:D,operation:N,_subLayerProps:z}=this.props,W={id:"",updateTriggers:{},opacity:t,pickable:n,visible:i,parameters:s,getPolygonOffset:a,highlightedObjectIndex:o,autoHighlight:u,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:w,positionFormat:v,modelMatrix:M,extensions:P,fetch:D,operation:N},V=z&&e.id&&z[e.id],$=V&&V.updateTriggers,q=e.id||"sublayer";if(V){const J=this.props[xA],me=e.type?e.type._propTypes:{};for(const xe in V){const se=me[xe]||J[xe];se&&se.type==="accessor"&&(V[xe]=this.getSubLayerAccessor(V[xe]))}}Object.assign(W,e,V),W.id=`${this.props.id}-${q}`,W.updateTriggers={all:(te=this.props.updateTriggers)==null?void 0:te.all,...e.updateTriggers,...$};for(const J of P){const me=J.getSubLayerProps.call(this,J);me&&Object.assign(W,me,{updateTriggers:Object.assign(W.updateTriggers,me.updateTriggers)})}return W}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const s=this.renderLayers();n=Jd(s,Boolean),this.internalState.subLayers=n}la(Iee,this,i,n);for(const s of n)s.parent=this}}EF.layerName="CompositeLayer";const jy=Math.PI/180,SF=180/Math.PI,$y=6370972,lp=256;function Mee(){const r=lp/$y,e=Math.PI/180*lp;return{unitsPerMeter:[r,r,r],unitsPerMeter2:[0,0,0],metersPerUnit:[1/r,1/r,1/r],unitsPerDegree:[e,e,r],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/r]}}class Pee extends Kd{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{longitude:t=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:s=1,resolution:a=10}=e;let{latitude:o=0,height:u,altitude:d=1.5,fovy:p}=e;o=Math.max(Math.min(o,Py),-85.051129),u=u||1,p?d=jw(p):p=kg(d);const _=1/Math.PI/Math.cos(o*Math.PI/180),w=Math.pow(2,n)*_,v=e.nearZ??i,M=e.farZ??(d+lp*2*w/u)*s,P=new kn().lookAt({eye:[0,-d,0],up:[0,0,1]});P.rotateX(o*jy),P.rotateZ(-t*jy),P.scale(w/u),super({...e,height:u,viewMatrix:P,longitude:t,latitude:o,zoom:n,distanceScales:Mee(),fovy:p,focalDistance:d,near:v,far:M}),this.scale=w,this.latitude=o,this.longitude=t,this.resolution=a}get projectionMode(){return Nc.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},n=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),s=this.unproject([this.width,this.height/2],t),a=this.unproject([this.width/2,this.height],t);return s[0]<this.longitude&&(s[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],s[0],i[0],a[0]),Math.min(n[1],s[1],i[1],a[1]),Math.max(n[0],s[0],i[0],a[0]),Math.max(n[1],s[1],i[1],a[1])]}unproject(e){let{topLeft:t=!0,targetZ:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[i,s,a]=e,o=t?s:this.height-s,{pixelUnprojectionMatrix:u}=this;let d;if(Number.isFinite(a))d=E2(u,[i,o,a,1]);else{const v=E2(u,[i,o,-1,1]),M=E2(u,[i,o,1,1]),P=((n||0)/$y+1)*lp,D=_w(Y5([],v,M)),N=_w(v),z=_w(M),V=4*((4*N*z-(D-N-z)**2)/16)/D,$=Math.sqrt(N-V),q=Math.sqrt(Math.max(0,P*P-V)),te=($-q)/Math.sqrt(D);d=HG([],v,M,te)}const[p,_,w]=this.unprojectPosition(d);return Number.isFinite(a)?[p,_,w]:Number.isFinite(n)?[p,_,n]:[p,_]}projectPosition(e){const[t,n,i=0]=e,s=t*jy,a=n*jy,o=Math.cos(a),u=(i/$y+1)*lp;return[Math.sin(s)*o*u,-Math.cos(s)*o*u,Math.sin(a)*u]}unprojectPosition(e){const[t,n,i]=e,s=Z5(e),a=Math.asin(i/s),u=Math.atan2(t,-n)*SF,d=a*SF,p=(s/lp-1)*$y;return[u,d,p]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function E2(r,e){const t=Hd([],e,r);return Bw(t,t,1/t[3]),t}class Fee extends xP{applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Lc(i,n,t);const{longitude:s,latitude:a}=e;return(s<-180||s>180)&&(e.longitude=ZW(s+180,360)-180),e.latitude=Lc(a,-85.051129,Py),e}}class Ree extends vP{constructor(){super(...arguments),this.ControllerState=Fee,this.transition={transitionDuration:300,transitionInterpolator:new o2(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class IF extends yP{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e)}getViewportType(e){return e.zoom>12?Pf:Pee}get ControllerType(){return Ree}}IF.displayName="GlobeView";const S2=512,Lee=Math.PI/180;function MF(r){let{map:e,gl:t,deck:n}=r;if(e.__deck)return e.__deck;const i=n==null?void 0:n.props._customRender,s=n==null?void 0:n.props.onLoad,a={...n==null?void 0:n.props,_customRender:()=>{e.triggerRepaint(),i==null||i("")}};a.parameters={...I2(e,!0),...a.parameters},a.views||(a.views=Gy(e));let o;return(!n||n.props.gl===t)&&(Object.assign(a,{gl:t,width:null,height:null,touchAction:"unset",viewState:Jg(e)}),n!=null&&n.isInitialized?PF(n,e):a.onLoad=()=>{s==null||s(),PF(o,e)}),n?(o=n,n.setProps(a),n.userData.isExternal=!0):(o=new Yg(a),e.on("remove",()=>{FF(e)})),o.userData.mapboxLayers=new Set,e.__deck=o,e.on("render",()=>{o.isInitialized&&Qee(o,e)}),o}function PF(r,e){const t=()=>{r.isInitialized?zee(r,e):e.off("move",t)};e.on("move",t)}function FF(r){var e;(e=r.__deck)==null||e.finalize(),r.__deck=null}function I2(r,e){const t=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return RF(r)==="globe"&&(t.cullMode="back"),t}function Oee(r,e){r.userData.mapboxLayers.add(e),M2(r)}function Uee(r,e){r.userData.mapboxLayers.delete(e),M2(r)}function Dee(r,e){M2(r)}function Nee(r,e,t,n){let{currentViewport:i}=r.userData,s=!1;i||(i=LF(r,e,n),r.userData.currentViewport=i,s=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:a=>{let{layer:o}=a;return t.id===o.id||o.props.operation.includes("terrain")},clearStack:s,clearCanvas:!1})}function RF(r){var n;const e=(n=r.getProjection)==null?void 0:n.call(r),t=(e==null?void 0:e.type)||(e==null?void 0:e.name);if(t==="globe")return"globe";if(t&&t!=="mercator")throw new Error("Unsupported projection");return"mercator"}function Gy(r){return RF(r)==="globe"?new IF({id:"mapbox"}):new a2({id:"mapbox"})}function Jg(r){var i;const{lng:e,lat:t}=r.getCenter(),n={longitude:(e+540)%360-180,latitude:t,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(i=r.getTerrain)!=null&&i.call(r)&&kee(r,n),n}function kee(r,e){if(r.getFreeCameraOptions){const{position:t}=r.getFreeCameraOptions();if(!t||t.z===void 0)return;const n=r.transform.height,{longitude:i,latitude:s,pitch:a}=e,o=t.x*S2,u=(1-t.y)*S2,d=t.z*S2,p=Ng([i,s]),_=o-p[0],w=u-p[1],v=Math.sqrt(_*_+w*w),M=a*Lee,P=1.5*n,D=M<.001?P*Math.cos(M)/d:P*Math.sin(M)/v;e.zoom=Math.log2(D);const N=P*Math.cos(M)/D,z=d-N;e.position=[0,0,z/Fy(s)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function LF(r,e,t){const n=Jg(e),i=Gy(e);t&&(i.props.nearZMultiplier=.2);const s=(t==null?void 0:t.nearZ)??e.transform._nearZ,a=(t==null?void 0:t.farZ)??e.transform._farZ;return Number.isFinite(s)&&(n.nearZ=s/e.transform.height,n.farZ=a/e.transform.height),i.makeViewport({width:r.width,height:r.height,viewState:n})}function Qee(r,e){const{mapboxLayers:t,isExternal:n}=r.userData;if(n){const i=Array.from(t,p=>p.id),a=Jd(r.props.layers,Boolean).some(p=>p&&!i.includes(p.id));let o=r.getViewports();const u=o.findIndex(p=>p.id==="mapbox"),d=o.length>1||u<0;(a||d)&&(u>=0&&(o=o.slice(),o[u]=LF(r,e)),r._drawLayers("mapbox-repaint",{viewports:o,layerFilter:p=>(!r.props.layerFilter||r.props.layerFilter(p))&&(p.viewport.id!=="mapbox"||!i.includes(p.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function zee(r,e){r.setProps({viewState:Jg(e)}),r.needsRedraw({clearRedrawFlags:!0})}function M2(r){if(r.userData.isExternal)return;const e=[];r.userData.mapboxLayers.forEach(t=>{const n=t.props.type,i=new n(t.props);e.push(i)}),r.setProps({layers:e})}class Hee{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=MF({map:e,gl:t,deck:this.props.deck}),Oee(this.deck,this)}onRemove(){this.deck&&Uee(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&Dee(this.deck)}render(e,t){Nee(this.deck,this.map,this,t)}}const P2="__UNDEFINED__";function qy(r,e,t,n){if(!r||!e||!r.style||!r.style._loaded)return;const i=Jd(n,Boolean);if(t!==n){const o=Jd(t,Boolean),u=new Set(o.map(d=>d.id));for(const d of i)u.delete(d.id);for(const d of u)r.getLayer(d)&&r.removeLayer(d)}for(const o of i){const u=r.getLayer(o.id);u?(u.implementation||u).setProps(o.props):r.addLayer(new Hee({id:o.id,deck:e,slot:o.props.slot}),o.props.beforeId)}const s=r.style._order,a={};for(const o of i){let{beforeId:u}=o.props;(!u||!s.includes(u))&&(u=P2),a[u]=a[u]||[],a[u].push(o.id)}for(const o in a){const u=a[o];let d=o===P2?s.length:s.indexOf(o),p=o===P2?void 0:o;for(let _=u.length-1;_>=0;_--){const w=u[_],v=s.indexOf(w);v!==d-1&&(r.moveLayer(w,p),v>d&&d++),d--,p=w}}}class Vee{constructor(e){this._handleStyleChange=()=>{qy(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:i,clientHeight:s}=this._map.getContainer();Object.assign(this._container.style,{width:`${i}px`,height:`${s}px`})}},this._updateViewState=()=>{const i=this._deck,s=this._map;i&&s&&(i.setProps({views:this._props.views||Gy(s),viewState:Jg(s)}),i.isInitialized&&i.redraw())},this._handleMouseEvent=i=>{const s=this._deck;if(!s||!s.isInitialized)return;const a={type:i.type,offsetCenter:i.point,srcEvent:i},o=this._lastMouseDownPoint;switch(!i.point&&o&&(a.deltaX=i.originalEvent.clientX-o.clientX,a.deltaY=i.originalEvent.clientY-o.clientY,a.offsetCenter={x:o.x+a.deltaX,y:o.y+a.deltaY}),a.type){case"mousedown":s._onPointerDown(a),this._lastMouseDownPoint={...i.point,clientX:i.originalEvent.clientX,clientY:i.originalEvent.clientY};break;case"dragstart":a.type="panstart",s._onEvent(a);break;case"drag":a.type="panmove",s._onEvent(a);break;case"dragend":a.type="panend",s._onEvent(a);break;case"click":a.tapCount=1,s._onEvent(a);break;case"dblclick":a.type="click",a.tapCount=2,s._onEvent(a);break;case"mousemove":a.type="pointermove",s._onPointerMove(a);break;case"mouseout":a.type="pointerleave",s._onPointerMove(a);break;default:return}};const{interleaved:t=!1,...n}=e;this._interleaved=t,this._props=n}setProps(e){this._interleaved&&e.layers&&qy(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...I2(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new Yg({...this._props,parent:t,parameters:{...I2(e,!1),...this._props.parameters},views:this._props.views||Gy(e),viewState:Jg(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&Wn.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=MF({map:e,gl:t,deck:new Yg({...this._props,gl:t})}),e.on("styledata",this._handleStyleChange),qy(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var t;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(t=this._deck)==null||t.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),qy(e,this._deck,this._props.layers,[]),FF(e)}getDefaultPosition(){return"top-left"}pickObject(e){return yo(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return yo(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return yo(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const OF=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,jee={name:"pointCloud",vs:OF,fs:OF,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},$ee=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Gee=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,UF=[0,0,0,255],DF=[0,0,1],qee={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:DF},getColor:{type:"accessor",value:UF},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Kee(r){const{header:e,attributes:t}=r;if(!(!e||!t)&&(r.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){const{size:n,value:i}=t.COLOR_0;t.instanceColors={size:n,type:"unorm8",value:i}}}class F2 extends ap{getShaders(){return super.getShaders({vs:$ee,fs:Gee,modules:[kw,mM,Gw,jee]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:DF},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:UF}})}updateState(e){var i;const{changeFlags:t,props:n}=e;super.updateState(e),t.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&Kee(n.data)}draw(e){let{uniforms:t}=e;const{pointSize:n,sizeUnits:i}=this.props,s=this.state.model,a={sizeUnits:Uw[i],radiusPixels:n};s.shaderInputs.setProps({pointCloud:a}),s.draw(this.context.renderPass)}_getModel(){const e=[];for(let t=0;t<3;t++){const n=t/3*Math.PI*2;e.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new wA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Wd({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}F2.layerName="PointCloudLayer",F2.defaultProps=qee;const wl={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Mt,new Mt;const em=new Mt,NF=new Mt;class tm{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.radius=-0,this.center=new Mt,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=em.from(t),this.center=new Mt().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new tm(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,s=e.radius,a=em.copy(i).subtract(t),o=a.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return e.clone();const u=(n+o+s)*.5;return NF.copy(a).scale((-n+u)/o).add(t),this.center.copy(NF),this.radius=u,this}expand(e){const n=em.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const t=lq(em,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const n=em.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,s=e.normal.dot(t)+e.distance;return s<-n?wl.OUTSIDE:s<n?wl.INTERSECTING:wl.INSIDE}}const Wee=new Mt,Xee=new Mt,Ky=new Mt,Wy=new Mt,Xy=new Mt,Yee=new Mt,Zee=new Mt,Mh={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class rm{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];this.center=new Mt().from(e),this.halfAxes=new ms(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new Mt(e).len(),new Mt(t).len(),new Mt(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new Mt(e).normalize(),s=new Mt(t).normalize(),a=new Mt(n).normalize();return new Og().fromMatrix3(new ms([...i,...s,...a]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new Og(n),s=new ms().fromQuaternion(i);return s[0]=s[0]*t[0],s[1]=s[1]*t[0],s[2]=s[2]*t[0],s[3]=s[3]*t[1],s[4]=s[4]*t[1],s[5]=s[5]*t[1],s[6]=s[6]*t[2],s[7]=s[7]*t[2],s[8]=s[8]*t[2],this.center=new Mt().from(e),this.halfAxes=s,this}clone(){return new rm(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new tm;const t=this.halfAxes,n=t.getColumn(0,Ky),i=t.getColumn(1,Wy),s=t.getColumn(2,Xy),a=Wee.copy(n).add(i).add(s);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,s=n.x,a=n.y,o=n.z,u=Math.abs(s*i[Mh.COLUMN0ROW0]+a*i[Mh.COLUMN0ROW1]+o*i[Mh.COLUMN0ROW2])+Math.abs(s*i[Mh.COLUMN1ROW0]+a*i[Mh.COLUMN1ROW1]+o*i[Mh.COLUMN1ROW2])+Math.abs(s*i[Mh.COLUMN2ROW0]+a*i[Mh.COLUMN2ROW1]+o*i[Mh.COLUMN2ROW2]),d=n.dot(t)+e.distance;return d<=-u?wl.OUTSIDE:d>=u?wl.INSIDE:wl.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Xee.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,Ky),s=n.getColumn(1,Wy),a=n.getColumn(2,Xy),o=i.magnitude(),u=s.magnitude(),d=a.magnitude();i.normalize(),s.normalize(),a.normalize();let p=0,_;return _=Math.abs(t.dot(i))-o,_>0&&(p+=_*_),_=Math.abs(t.dot(s))-u,_>0&&(p+=_*_),_=Math.abs(t.dot(a))-d,_>0&&(p+=_*_),p}computePlaneDistances(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=this.center,o=this.halfAxes,u=o.getColumn(0,Ky),d=o.getColumn(1,Wy),p=o.getColumn(2,Xy),_=Yee.copy(u).add(d).add(p).add(a),w=Zee.copy(_).subtract(e);let v=t.dot(w);return i=Math.min(v,i),s=Math.max(v,s),_.copy(a).add(u).add(d).subtract(p),w.copy(_).subtract(e),v=t.dot(w),i=Math.min(v,i),s=Math.max(v,s),_.copy(a).add(u).subtract(d).add(p),w.copy(_).subtract(e),v=t.dot(w),i=Math.min(v,i),s=Math.max(v,s),_.copy(a).add(u).subtract(d).subtract(p),w.copy(_).subtract(e),v=t.dot(w),i=Math.min(v,i),s=Math.max(v,s),a.copy(_).subtract(u).add(d).add(p),w.copy(_).subtract(e),v=t.dot(w),i=Math.min(v,i),s=Math.max(v,s),a.copy(_).subtract(u).add(d).subtract(p),w.copy(_).subtract(e),v=t.dot(w),i=Math.min(v,i),s=Math.max(v,s),a.copy(_).subtract(u).subtract(d).add(p),w.copy(_).subtract(e),v=t.dot(w),i=Math.min(v,i),s=Math.max(v,s),a.copy(_).subtract(u).subtract(d).subtract(p),w.copy(_).subtract(e),v=t.dot(w),i=Math.min(v,i),s=Math.max(v,s),n[0]=i,n[1]=s,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,Ky);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,Wy);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,Xy);return i.transformAsPoint(e),this.halfAxes=new ms([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const kF=new Mt,QF=new Mt;class Gu{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.normal=new Mt,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Uc(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=kF.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),Uc(Oc(this.normal.len(),1)),this.distance=i,this}clone(){return new Gu(this.normal,this.distance)}equals(e){return Oc(this.distance,e.distance)&&Oc(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=QF.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=kF.from(e),i=this.getPointDistance(n),s=QF.copy(this.normal).scale(i);return n.subtract(s).to(t)}}const zF=[new Mt([1,0,0]),new Mt([0,1,0]),new Mt([0,0,1])],HF=new Mt,Jee=new Mt;class Zl{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.planes=e}fromBoundingSphere(e){this.planes.length=2*zF.length;const t=e.center,n=e.radius;let i=0;for(const s of zF){let a=this.planes[i],o=this.planes[i+1];a||(a=this.planes[i]=new Gu),o||(o=this.planes[i+1]=new Gu);const u=HF.copy(s).scale(-n).add(t);a.fromPointNormal(u,s);const d=HF.copy(s).scale(n).add(t),p=Jee.copy(s).negate();o.fromPointNormal(d,p),i+=2}return this}computeVisibility(e){let t=wl.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case wl.OUTSIDE:return wl.OUTSIDE;case wl.INTERSECTING:t=wl.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(Uc(Number.isFinite(t),"parentPlaneMask is required."),t===Zl.MASK_OUTSIDE||t===Zl.MASK_INSIDE)return t;let n=Zl.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const a=s<31?1<<s:0;if(s<31&&(t&a)===0)continue;const o=i[s],u=e.intersectPlane(o);if(u===wl.OUTSIDE)return Zl.MASK_OUTSIDE;u===wl.INTERSECTING&&(n|=a)}return n}}Zl.MASK_OUTSIDE=4294967295,Zl.MASK_INSIDE=0,Zl.MASK_INDETERMINATE=2147483647,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt;const qu=new ms,ete=new ms,tte=new ms,Yy=new ms,VF=new ms;function rte(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=qq,n=10;let i=0,s=0;const a=ete,o=tte;a.identity(),o.copy(r);const u=t*nte(o);for(;s<n&&ite(o)>u;)ste(o,Yy),VF.copy(Yy).transpose(),o.multiplyRight(Yy),o.multiplyLeft(VF),a.multiplyRight(Yy),++i>2&&(++s,i=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}function nte(r){let e=0;for(let t=0;t<9;++t){const n=r[t];e+=n*n}return Math.sqrt(e)}const R2=[1,0,0],L2=[2,2,1];function ite(r){let e=0;for(let t=0;t<3;++t){const n=r[qu.getElementIndex(L2[t],R2[t])];e+=2*n*n}return Math.sqrt(e)}function ste(r,e){const t=uM;let n=0,i=1;for(let d=0;d<3;++d){const p=Math.abs(r[qu.getElementIndex(L2[d],R2[d])]);p>n&&(i=d,n=p)}const s=R2[i],a=L2[i];let o=1,u=0;if(Math.abs(r[qu.getElementIndex(a,s)])>t){const d=r[qu.getElementIndex(a,a)],p=r[qu.getElementIndex(s,s)],_=r[qu.getElementIndex(a,s)],w=(d-p)/2/_;let v;w<0?v=-1/(-w+Math.sqrt(1+w*w)):v=1/(w+Math.sqrt(1+w*w)),o=1/Math.sqrt(1+v*v),u=v*o}return ms.IDENTITY.to(e),e[qu.getElementIndex(s,s)]=e[qu.getElementIndex(a,a)]=o,e[qu.getElementIndex(a,s)]=u,e[qu.getElementIndex(s,a)]=-u,e}const MA=new Mt,ote=new Mt,ate=new Mt,lte=new Mt,cte=new Mt,ute=new ms,hte={diagonal:new ms,unitary:new ms};function Ate(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new rm;if(!r||r.length===0)return e.halfAxes=new ms([0,0,0,0,0,0,0,0,0]),e.center=new Mt,e;const t=r.length,n=new Mt(0,0,0);for(const me of r)n.add(me);const i=1/t;n.multiplyByScalar(i);let s=0,a=0,o=0,u=0,d=0,p=0;for(const me of r){const xe=MA.copy(me).subtract(n);s+=xe.x*xe.x,a+=xe.x*xe.y,o+=xe.x*xe.z,u+=xe.y*xe.y,d+=xe.y*xe.z,p+=xe.z*xe.z}s*=i,a*=i,o*=i,u*=i,d*=i,p*=i;const _=ute;_[0]=s,_[1]=a,_[2]=o,_[3]=a,_[4]=u,_[5]=d,_[6]=o,_[7]=d,_[8]=p;const{unitary:w}=rte(_,hte),v=e.halfAxes.copy(w);let M=v.getColumn(0,ate),P=v.getColumn(1,lte),D=v.getColumn(2,cte),N=-Number.MAX_VALUE,z=-Number.MAX_VALUE,W=-Number.MAX_VALUE,V=Number.MAX_VALUE,$=Number.MAX_VALUE,q=Number.MAX_VALUE;for(const me of r)MA.copy(me),N=Math.max(MA.dot(M),N),z=Math.max(MA.dot(P),z),W=Math.max(MA.dot(D),W),V=Math.min(MA.dot(M),V),$=Math.min(MA.dot(P),$),q=Math.min(MA.dot(D),q);M=M.multiplyByScalar(.5*(V+N)),P=P.multiplyByScalar(.5*($+z)),D=D.multiplyByScalar(.5*(q+W)),e.center.copy(M).add(P).add(D);const te=ote.set(N-V,z-$,W-q).multiplyByScalar(.5),J=new ms([te[0],0,0,0,te[1],0,0,0,te[2]]);return e.halfAxes.multiplyRight(J),e}const O2=Math.PI/180,Zy=new Float32Array(16),jF=new Float32Array(12);function $F(r,e,t){const n=e[0]*O2,i=e[1]*O2,s=e[2]*O2,a=Math.sin(s),o=Math.sin(n),u=Math.sin(i),d=Math.cos(s),p=Math.cos(n),_=Math.cos(i),w=t[0],v=t[1],M=t[2];r[0]=w*_*p,r[1]=w*u*p,r[2]=w*-o,r[3]=v*(-u*d+_*o*a),r[4]=v*(_*d+u*o*a),r[5]=v*p*a,r[6]=M*(u*a+_*o*d),r[7]=M*(-_*a+u*o*d),r[8]=M*p*d}function GF(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const qF={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,e){let{startRow:t,endRow:n}=e;const{data:i,getOrientation:s,getScale:a,getTranslation:o,getTransformMatrix:u}=this.props,d=Array.isArray(u),p=d&&u.length===16,_=Array.isArray(a),w=Array.isArray(s),v=Array.isArray(o),M=p||!d&&!!u(i[0]);M?r.constant=p:r.constant=w&&_&&v;const P=r.value;if(r.constant){let D;M?(Zy.set(u),D=GF(Zy)):(D=jF,$F(D,s,a),D.set(o,9)),r.value=new Float32Array(D)}else{let D=t*r.size;const{iterable:N,objectInfo:z}=oF(i,t,n);for(const W of N){z.index++;let V;if(M)Zy.set(p?u:u(W,z)),V=GF(Zy);else{V=jF;const $=w?s:s(W,z),q=_?a:a(W,z);$F(V,$,q),V.set(v?o:o(W,z),9)}P[D++]=V[0],P[D++]=V[1],P[D++]=V[2],P[D++]=V[3],P[D++]=V[4],P[D++]=V[5],P[D++]=V[6],P[D++]=V[7],P[D++]=V[8],P[D++]=V[9],P[D++]=V[10],P[D++]=V[11]}}}};function KF(r,e){return e===Hn.CARTESIAN||e===Hn.METER_OFFSETS||e===Hn.DEFAULT&&!r.isGeospatial}const WF=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,fte={name:"simpleMesh",vs:WF,fs:WF,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},dte=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,pte=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function U2(r){const e=r.positions||r.POSITION;Wn.assert(e,'no "postions" or "POSITION" attribute in mesh');const t=e.value.length/e.size;let n=r.COLOR_0||r.colors;n||(n={size:3,value:new Float32Array(t*3).fill(1)});let i=r.NORMAL||r.normals;i||(i={size:3,value:new Float32Array(t*3).fill(0)});let s=r.TEXCOORD_0||r.texCoords;return s||(s={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:n,normals:i,texCoords:s}}function XF(r){return r instanceof Wd?(r.attributes=U2(r.attributes),r):r.attributes?new Wd({...r,topology:"triangle-list",attributes:U2(r.attributes)}):new Wd({topology:"triangle-list",attributes:U2(r)})}const gte={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class D2 extends ap{getShaders(){return super.getShaders({vs:dte,fs:pte,modules:[kw,_M,Gw,fte]})}getBounds(){var n;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=(n=t.header)==null?void 0:n.boundingBox,!e){const{attributes:i}=XF(t);i.POSITION=i.POSITION||i.positions,e=FI(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:qF}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var s;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e;if(t.mesh!==n.mesh||i.extensionsChanged){if(this.state.positionBounds=null,(s=this.state.model)==null||s.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const a=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==n.texture&&t.texture instanceof hs&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw(e){let{uniforms:t}=e;const{model:n}=this.state;if(!n)return;const{viewport:i,renderPass:s}=this.context,{sizeScale:a,coordinateSystem:o,_instanced:u}=this.props,d={sizeScale:a,composeModelMatrix:!u||KF(i,o),flatShading:!this.state.hasNormals};n.shaderInputs.setProps({simpleMesh:d}),n.draw(s)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const t=new wA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:XF(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state,s={sampler:n||i,hasTexture:!!n};return t.shaderInputs.setProps({simpleMesh:s}),t}setTexture(e){const{emptyTexture:t,model:n}=this.state;if(n){const i={sampler:e||t,hasTexture:!!e};n.shaderInputs.setProps({simpleMesh:i})}}}D2.defaultProps=gte,D2.layerName="SimpleMeshLayer";var Hc;(function(r){r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.ONE=1]="ONE",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.LINEAR=9729]="LINEAR",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Hc||(Hc={}));function YF(r,e,t,n){const i={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};i.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:s}=n;return s&&(i.bindings.pbr_diffuseEnvSampler=s.diffuseEnvSampler.texture,i.bindings.pbr_specularEnvSampler=s.specularEnvSampler.texture,i.bindings.pbr_BrdfLUT=s.brdfLutTexture.texture,i.uniforms.scaleIBLAmbient=[1,1]),n!=null&&n.pbrDebug&&(i.defines.PBR_DEBUG=1,i.uniforms.scaleDiffBaseMR=[0,0,0,0],i.uniforms.scaleFGDSpec=[0,0,0,0]),t.NORMAL&&(i.defines.HAS_NORMALS=1),t.TANGENT&&(n!=null&&n.useTangents)&&(i.defines.HAS_TANGENTS=1),t.TEXCOORD_0&&(i.defines.HAS_UV=1),n!=null&&n.imageBasedLightingEnvironment&&(i.defines.USE_IBL=1),n!=null&&n.lights&&(i.defines.USE_LIGHTS=1),e&&mte(r,e,i),i}function mte(r,e,t){if(t.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&_te(r,e.pbrMetallicRoughness,t),e.normalTexture){nm(r,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",t);const{scale:n=1}=e.normalTexture;t.uniforms.normalScale=n}if(e.occlusionTexture){nm(r,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",t);const{strength:n=1}=e.occlusionTexture;t.uniforms.occlusionStrength=n}switch(e.emissiveTexture&&(nm(r,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:n=.5}=e;t.defines.ALPHA_CUTOFF=1,t.uniforms.alphaCutoff=n;break;case"BLEND":yr.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=Hc.FUNC_ADD,t.glParameters.blendFunc=[Hc.SRC_ALPHA,Hc.ONE_MINUS_SRC_ALPHA,Hc.ONE,Hc.ONE_MINUS_SRC_ALPHA];break}}function _te(r,e,t){e.baseColorTexture&&nm(r,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&nm(r,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);const{metallicFactor:n=1,roughnessFactor:i=1}=e;t.uniforms.metallicRoughnessValues=[n,i]}function nm(r,e,t){var p,_;let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4?arguments[4]:void 0;const s=((_=(p=e==null?void 0:e.texture)==null?void 0:p.sampler)==null?void 0:_.parameters)||{},a=e.texture.source.image;let o,u={};a.compressed?(o=a,u={[Hc.TEXTURE_MIN_FILTER]:a.data.length>1?Hc.LINEAR_MIPMAP_NEAREST:Hc.LINEAR}):o={data:a};const d=r.createTexture({id:e.uniformName||e.id,parameters:{...s,...u},pixelStore:{[Hc.UNPACK_FLIP_Y_WEBGL]:!1},...o});i.bindings[t]=d,n&&(i.defines[n]=1),i.generatedTextures.push(d)}const yte="4.3.2",Jy={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let ZF;async function JF(r){$H(r.modules);const e=GH("basis");return e||(ZF||(ZF=bte(r)),await ZF)}async function bte(r){let e=null,t=null;return[e,t]=await Promise.all([await xf(Jy.TRANSCODER,"textures",r),await xf(Jy.TRANSCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await vte(e,t)}function vte(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,initializeBasis:a}=i;a(),n({BasisFile:s})})})}let N2;async function e4(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(N2=N2||wte(r),await N2)}async function wte(r){let e=null,t=null;return[e,t]=await Promise.all([await xf(Jy.ENCODER,"textures",r),await xf(Jy.ENCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await xte(e,t)}function xte(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:u}=i;o(),n({BasisFile:s,KTX2File:a,BasisEncoder:u})})})}const cp={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},Bte=["","WEBKIT_","MOZ_"],t4={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let e0=null;function Cte(r){if(!e0){r=r||Tte()||void 0,e0=new Set;for(const e of Bte)for(const t in t4)if(r&&r.getExtension(`${e}${t}`)){const n=t4[t];e0.add(n)}}return e0}function Tte(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const xl=[171,75,84,88,32,50,48,187,13,10,26,10];function Ete(r){const e=new Uint8Array(r);return!(e.byteLength<xl.length||e[0]!==xl[0]||e[1]!==xl[1]||e[2]!==xl[2]||e[3]!==xl[3]||e[4]!==xl[4]||e[5]!==xl[5]||e[6]!==xl[6]||e[7]!==xl[7]||e[8]!==xl[8]||e[9]!==xl[9]||e[10]!==xl[10]||e[11]!==xl[11])}const Ste={etc1:{basisFormat:0,compressed:!0,format:cp.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:cp.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:cp.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:cp.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:cp.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:cp.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Ite(r,e){if(e.basis.containerFormat==="auto"){if(Ete(r)){const n=await e4(e);return r4(n.KTX2File,r,e)}const{BasisFile:t}=await JF(e);return k2(t,r,e)}switch(e.basis.module){case"encoder":const t=await e4(e);switch(e.basis.containerFormat){case"ktx2":return r4(t.KTX2File,r,e);case"basis":default:return k2(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:n}=await JF(e);return k2(n,r,e)}}function k2(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),s=[];for(let a=0;a<i;a++){const o=n.getNumLevels(a),u=[];for(let d=0;d<o;d++)u.push(Mte(n,a,d,t));s.push(u)}return s}finally{n.close(),n.delete()}}function Mte(r,e,t,n){const i=r.getImageWidth(e,t),s=r.getImageHeight(e,t),a=r.getHasAlpha(),{compressed:o,format:u,basisFormat:d}=n4(n,a),p=r.getImageTranscodedSizeInBytes(e,t,d),_=new Uint8Array(p);if(!r.transcodeImage(_,e,t,d,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:_,compressed:o,format:u,hasAlpha:a}}function r4(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),s=[];for(let a=0;a<i;a++)s.push(Pte(n,a,t));return[s]}finally{n.close(),n.delete()}}function Pte(r,e,t){const{alphaFlag:n,height:i,width:s}=r.getImageLevelInfo(e,0,0),{compressed:a,format:o,basisFormat:u}=n4(t,n),d=r.getImageTranscodedSizeInBytes(e,0,0,u),p=new Uint8Array(d);if(!r.transcodeImage(p,e,0,0,u,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:p,compressed:a,levelSize:d,hasAlpha:n,format:o}}function n4(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=i4()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),Ste[t]}function i4(){const r=Cte();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const Fte={...{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:yte,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:Ite},Rte={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Lte={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class Ote{constructor(e){Y(this,"name");Y(this,"startTime",0);Y(this,"playing",!0);Y(this,"speed",1);Y(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const n=(e/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:s,target:a,path:o}=i;Hte(n,s,a,o),Nte(a,a._node)})}}class Ute{constructor(e){Y(this,"animations");this.animations=e.animations.map((t,n)=>{const i=t.name||`Animation-${n}`,s=t.samplers.map(o=>{let{input:u,interpolation:d="LINEAR",output:p}=o;return{input:s4(e.accessors[u]),interpolation:d,output:s4(e.accessors[p])}}),a=t.channels.map(o=>{let{sampler:u,target:d}=o;return{sampler:s[u],target:e.nodes[d.node],path:d.path}});return new Ote({name:i,channels:a})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}function s4(r){if(!r._animation){const e=Lte[r.componentType],t=Rte[r.type],n=t*r.count,{buffer:i,byteOffset:s}=r.bufferView.data,a=new e(i,s+(r.byteOffset||0),n);if(t===1)r._animation=Array.from(a);else{const o=[];for(let u=0;u<a.length;u+=t)o.push(Array.from(a.slice(u,u+t)));r._animation=o}}return r._animation}const Dte=new kn;function Nte(r,e){if(e.matrix.identity(),r.translation&&e.matrix.translate(r.translation),r.rotation){const t=Dte.fromQuaternion(r.rotation);e.matrix.multiplyRight(t)}r.scale&&e.matrix.scale(r.scale)}const Q2=new Og;function kte(r,e,t,n,i){if(e==="rotation"){Q2.slerp({start:t,target:n,ratio:i});for(let s=0;s<Q2.length;s++)r[e][s]=Q2[s]}else for(let s=0;s<t.length;s++)r[e][s]=i*n[s]+(1-i)*t[s]}function Qte(r,e,t){let{p0:n,outTangent0:i,inTangent1:s,p1:a,tDiff:o,ratio:u}=t;for(let d=0;d<r[e].length;d++){const p=i[d]*o,_=s[d]*o;r[e][d]=(2*Math.pow(u,3)-3*Math.pow(u,2)+1)*n[d]+(Math.pow(u,3)-2*Math.pow(u,2)+u)*p+(-2*Math.pow(u,3)+3*Math.pow(u,2))*a[d]+(Math.pow(u,3)-Math.pow(u,2))*_}}function zte(r,e,t){for(let n=0;n<t.length;n++)r[e][n]=t[n]}function Hte(r,e,t,n){let{input:i,interpolation:s,output:a}=e;const o=i[i.length-1],u=r%o,d=i.findIndex(v=>v>=u),p=Math.max(0,d-1);if(!Array.isArray(t[n]))switch(n){case"translation":t[n]=[0,0,0];break;case"rotation":t[n]=[0,0,0,1];break;case"scale":t[n]=[1,1,1];break;default:yr.warn(`Bad animation path ${n}`)()}const _=i[p],w=i[d];switch(s){case"STEP":zte(t,n,a[p]);break;case"LINEAR":if(w>_){const v=(u-_)/(w-_);kte(t,n,a[p],a[d],v)}break;case"CUBICSPLINE":if(w>_){const v=(u-_)/(w-_),M=w-_,P=a[3*p+1],D=a[3*p+2],N=a[3*d+0],z=a[3*d+1];Qte(t,n,{p0:P,outTangent0:D,inTangent1:N,p1:z,tDiff:M,ratio:v})}break;default:yr.warn(`Interpolation ${s} not supported`)();break}}const Vte=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,jte=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,$te=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function Gte(r,e){const{id:t,geometry:n,material:i,vertexCount:s,materialOptions:a,modelOptions:o}=e,u=YF(r,i,n.attributes,a);yr.info(4,"createGLTFModel defines: ",u.defines)();const d=[],p={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},_={id:t,source:Vte,vs:jte,fs:$te,geometry:n,topology:n.topology,vertexCount:s,modules:[Iw],...o,defines:{...u.defines,...o.defines},parameters:{...p,...u.parameters,...o.parameters}},w=new wA(r,_),{camera:v,...M}={...u.uniforms,...o.uniforms,...u.bindings,...o.bindings};return w.shaderInputs.setProps({pbrMaterial:M,pbrProjection:{camera:v}}),new n2({managedResources:d,model:w})}var kf;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(kf||(kf={}));function qte(r){switch(r){case kf.POINTS:return"point-list";case kf.LINES:return"line-list";case kf.LINE_STRIP:return"line-strip";case kf.TRIANGLES:return"triangle-list";case kf.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(r))}}const Kte={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Wte{constructor(e){Y(this,"device");Y(this,"options");Y(this,"gltf");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.device=e,this.options={...Kte,...t}}instantiate(e){return this.gltf=z2(e),(this.gltf.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new Ute(this.gltf):null}createScene(e){const n=(e.nodes||[]).map(s=>this.createNode(s));return new Xd({id:e.name||e.id,children:n})}createNode(e){if(!e._node){const i=(e.children||[]).map(a=>this.createNode(a));e.mesh&&i.push(this.createMesh(e.mesh));const s=new Xd({id:e.name||e.id,children:i});if(e.matrix)s.setMatrix(e.matrix);else{if(s.matrix.identity(),e.translation&&s.matrix.translate(e.translation),e.rotation){const a=new kn().fromQuaternion(e.rotation);s.matrix.multiplyRight(a)}e.scale&&s.matrix.scale(e.scale)}e._node=s}const t=this.gltf.nodes.find(n=>n.id===e.id);return t._node=e._node,e._node}createMesh(e){if(!e._mesh){const n=(e.primitives||[]).map((s,a)=>this.createPrimitive(s,a,e)),i=new Xd({id:e.name||e.id,children:n});e._mesh=i}return e._mesh}createPrimitive(e,t,n){const i=e.name||`${n.name||n.id}-primitive-${t}`,s=qte(e.mode||4),a=e.indices?e.indices.count:this.getVertexCount(e.attributes),o=Gte(this.device,{id:i,geometry:this.createGeometry(i,e,s),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:a});return o.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],o}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,n){const i={};for(const[s,a]of Object.entries(t.attributes)){const{components:o,size:u,value:d}=a;i[s]={size:u??o,value:d}}return new Wd({id:e,topology:n,indices:t.indices.value,attributes:i})}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:n}=e;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[t]||(n.lumaBuffers[t]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||e.value})),n.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}function z2(r){if(ArrayBuffer.isView(r)||r instanceof ArrayBuffer||r instanceof ImageBitmap)return r;if(Array.isArray(r))return r.map(z2);if(r&&typeof r=="object"){const e={};for(const t in r)e[t]=z2(r[t]);return e}return r}function Xte(r,e,t){const n=new Wte(r,t),i=n.instantiate(e),s=n.createAnimator();return{scenes:i,animator:s}}function Bl(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const o4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},a4={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Yte=1.33,l4=["SCALAR","VEC2","VEC3","VEC4"],Zte=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Jte=new Map(Zte),ere={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tre={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},rre={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function c4(r){return l4[r-1]||l4[0]}function t0(r){const e=Jte.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function H2(r,e){const t=rre[r.componentType],n=ere[r.type],i=tre[r.componentType],s=r.count*n,a=r.count*n*i;Bl(a>=0&&a<=e.byteLength);const o=a4[r.componentType],u=o4[r.type];return{ArrayType:t,length:s,byteLength:a,componentByteSize:o,numberOfComponentsInElement:u}}function u4(r){let{images:e,bufferViews:t}=r;e=e||[],t=t||[];const n=e.map(a=>a.bufferView);t=t.filter(a=>!n.includes(a));const i=t.reduce((a,o)=>a+o.byteLength,0),s=e.reduce((a,o)=>{const{width:u,height:d}=o.image;return a+u*d},0);return i+Math.ceil(4*s*Yte)}function nre(r,e,t){const n=r.bufferViews[t];Bl(n);const i=n.buffer,s=e[i];Bl(s);const a=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,n.byteLength)}function ire(r,e,t){var P,D;const n=typeof t=="number"?(P=r.accessors)==null?void 0:P[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(D=r.bufferViews)==null?void 0:D[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:s,byteOffset:a}=e[i.buffer],o=(a||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:u,length:d,componentByteSize:p,numberOfComponentsInElement:_}=H2(n,i),w=p*_,v=i.byteStride||w;if(typeof i.byteStride>"u"||i.byteStride===w)return new u(s,o,d);const M=new u(d);for(let N=0;N<n.count;N++){const z=new u(s,o+N*v,_);M.set(z,N*_)}return M}function sre(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Ro{constructor(e){Y(this,"gltf");Y(this,"sourceBuffers");Y(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||sre(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Bl(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return ire(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,s=t.byteOffset||0;return new Uint8Array(i,s,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Bl(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Bl(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:s=4}=e,o={primitives:[{attributes:this._addAttributes(t),mode:s}]};if(n){const u=this._addIndices(n);o.primitives[0].indices=u}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=Lv(e),i=t||(n==null?void 0:n.mimeType),a={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.byteLength;const i=e.byteLength;Bl(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const s={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=wg(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:c4(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const s={size:t.size,componentType:t0(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(s,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var s,a;const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const o of this.sourceBuffers||[])i=mV(o,n,i);(a=(s=this.json)==null?void 0:s.buffers)!=null&&a[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const n in e){const i=e[n],s=this._getGltfAttributeName(n),a=this.addBinaryBuffer(i.value,i);t[s]=a}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const s of i)n.min.push(s),n.max.push(s);for(let s=t;s<e.length;s+=t)for(let a=0;a<t;a++)n.min[0+a]=Math.min(n.min[0+a],e[s+a]),n.max[0+a]=Math.max(n.max[0+a],e[s+a]);return n}}function h4(r){return(r%1+1)%1}const A4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},ore={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},f4={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function V2(r,e){return f4[e]*A4[r]}function r0(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),s=n0(i,"SCALAR",t,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function n0(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const i=A4[e],s=ore[t],a=f4[t],o=n*i,u=o*a;let d=r.buffer,p=r.byteOffset;return p%a!==0&&(d=new Uint8Array(d).slice(p,p+u).buffer,p=0),new s(d,p,o)}function j2(r,e,t){var d,p,_,w,v;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],s=r.getTypedArrayForAccessor(i),a=r.gltf.json,o=e.index,u=(p=(d=a.textures)==null?void 0:d[o])==null?void 0:p.source;if(typeof u<"u"){const M=(w=(_=a.images)==null?void 0:_[u])==null?void 0:w.mimeType,P=(v=r.gltf.images)==null?void 0:v[u];if(P&&typeof P.width<"u"){const D=[];for(let N=0;N<s.length;N+=2){const z=are(P,M,s,N,e.channels);D.push(z)}return D}}return[]}function d4(r,e,t,n,i){if(!(t!=null&&t.length))return;const s=[];for(const p of t){let _=n.findIndex(w=>w===p);_===-1&&(_=n.push(p)-1),s.push(_)}const a=new Uint32Array(s),o=r.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength})-1,u=r.addBufferView(a,o,0),d=r.addAccessor(u,{size:1,componentType:t0(a),count:a.length});i.attributes[e]=d}function are(r,e,t,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0];const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},a=t[n],o=t[n+1];let u=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(u=4);const d=lre(a,o,r,u);let p=0;for(const _ of i){const w=typeof _=="number"?Object.values(s)[_]:s[_],v=d+w.offset,M=RI(r);if(M.data.length<=v)throw new Error(`${M.data.length} <= ${v}`);const P=M.data[v];p|=P<<w.shift}return p}function lre(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const i=t.width,s=h4(r)*(i-1),a=Math.round(s),o=t.height,u=h4(e)*(o-1),d=Math.round(u),p=t.components?t.components:n;return(d*i+a)*p}function p4(r,e,t,n,i){const s=[];for(let a=0;a<e;a++){const o=t[a],u=t[a+1]-t[a];if(u+o>n)break;const d=o/i,p=u/i;s.push(r.slice(d,d+p))}return s}function g4(r,e,t){const n=[];for(let i=0;i<e;i++){const s=i*t;n.push(r.slice(s,s+t))}return n}function m4(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],s=new TextDecoder("utf8");let a=0;for(let o=0;o<r;o++){const u=n[o+1]-n[o];if(u+a<=e.length){const d=e.subarray(a,u+a),p=s.decode(d);i.push(p),a+=u}}return i}return[]}const up="EXT_mesh_features",cre=up;async function ure(r,e){const t=new Ro(r);Are(t,e)}function hre(r,e){const t=new Ro(r);return dre(t),t.createBinaryChunk(),t.gltf}function Are(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)fre(r,i,e)}function fre(r,e,t){var s,a,o;if(!((s=t==null?void 0:t.gltf)!=null&&s.loadBuffers))return;const n=(a=e.extensions)==null?void 0:a[up],i=n==null?void 0:n.featureIds;if(i)for(const u of i){let d;if(typeof u.attribute<"u"){const p=`_FEATURE_ID_${u.attribute}`,_=e.attributes[p];d=r.getTypedArrayForAccessor(_)}else typeof u.texture<"u"&&((o=t==null?void 0:t.gltf)!=null&&o.loadImages)?d=j2(r,u.texture,e):d=[];u.data=d}}function dre(r,e){const t=r.gltf.json.meshes;if(t)for(const n of t)for(const i of n.primitives)gre(r,i)}function pre(r,e,t,n){e.extensions||(e.extensions={});let i=e.extensions[up];i||(i={featureIds:[]},e.extensions[up]=i);const{featureIds:s}=i,a={featureCount:t.length,propertyTable:n,data:t};s.push(a),r.addObjectExtension(e,up,i)}function gre(r,e){var i;const t=(i=e.extensions)==null?void 0:i[up];if(!t)return;const n=t.featureIds;n.forEach((s,a)=>{if(s.data){const{accessorKey:o,index:u}=mre(e.attributes),d=new Uint32Array(s.data);n[a]={featureCount:d.length,propertyTable:s.propertyTable,attribute:u},r.gltf.buffers.push({arrayBuffer:d.buffer,byteOffset:d.byteOffset,byteLength:d.byteLength});const p=r.addBufferView(d),_=r.addAccessor(p,{size:1,componentType:t0(d),count:d.length});e.attributes[o]=_}})}function mre(r){const e="_FEATURE_ID_",t=Object.keys(r).filter(s=>s.indexOf(e)===0);let n=-1;for(const s of t){const a=Number(s.substring(e.length));a>n&&(n=a)}return n++,{accessorKey:`${e}${n}`,index:n}}const _re=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:pre,decode:ure,encode:hre,name:cre},Symbol.toStringTag,{value:"Module"})),hp="EXT_structural_metadata",yre=hp;async function bre(r,e){const t=new Ro(r);wre(t,e)}function vre(r,e){const t=new Ro(r);return Nre(t),t.createBinaryChunk(),t.gltf}function wre(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(hp);t&&((i=e.gltf)!=null&&i.loadImages&&xre(r,t),Bre(r,t))}function xre(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const s of i.primitives)Tre(r,t,s,e)}function Bre(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const s in n){const a=Cre(i,s);a&&Sre(r,t,a)}}function Cre(r,e){for(const t of r)if(t.class===e)return t;return null}function Tre(r,e,t,n){var a;if(!e)return;const i=(a=t.extensions)==null?void 0:a[hp],s=i==null?void 0:i.propertyTextures;if(s)for(const o of s){const u=e[o];Ere(r,u,t,n)}}function Ere(r,e,t,n){var s;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const a in e.properties){const o=`${i}_${a}`,u=(s=e.properties)==null?void 0:s[a];if(!u)continue;u.data||(u.data=[]);const d=u.data,p=j2(r,u,t);p!==null&&(d4(r,o,p,d,t),u.data=d,n.dataAttributeNames.push(o))}}function Sre(r,e,t){var s,a;const n=(s=e.classes)==null?void 0:s[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const o in n.properties){const u=n.properties[o],d=(a=t.properties)==null?void 0:a[o];if(d){const p=Ire(r,e,u,i,d);d.data=p}}}function Ire(r,e,t,n,i){let s=[];const a=i.values,o=r.getTypedArrayForBufferView(a),u=Mre(r,t,i,n),d=Pre(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=Fre(t,n,o,u);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{s=m4(n,o,u,d);break}case"ENUM":{s=Rre(e,t,n,o,u);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return s}function Mre(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?r0(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function Pre(r,e,t){return typeof e.stringOffsets<"u"?r0(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function Fre(r,e,t,n){const i=r.array,s=r.count,a=V2(r.type,r.componentType),o=t.byteLength/a;let u;return r.componentType?u=n0(t,r.type,r.componentType,o):u=t,i?n?p4(u,e,n,t.length,a):s?g4(u,e,s):[]:u}function Rre(r,e,t,n,i){var _;const s=e.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=(_=r.enums)==null?void 0:_[s];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);const o=a.valueType||"UINT16",u=V2(e.type,o),d=n.byteLength/u;let p=n0(n,e.type,o,d);if(p||(p=n),e.array){if(i)return Lre({valuesData:p,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:u,enumEntry:a});const w=e.count;return w?Ore(p,t,w,a):[]}return $2(p,0,t,a)}function Lre(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:s,enumEntry:a}=r,o=[];for(let u=0;u<t;u++){const d=n[u],p=n[u+1]-n[u];if(p+d>i)break;const _=d/s,w=p/s,v=$2(e,_,w,a);o.push(v)}return o}function Ore(r,e,t,n){const i=[];for(let s=0;s<e;s++){const a=t*s,o=$2(r,a,t,n);i.push(o)}return i}function $2(r,e,t,n){const i=[];for(let s=0;s<t;s++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const a=r[e+s],o=Ure(n,a);o?i.push(o.name):i.push("")}return i}function Ure(r,e){for(const t of r.values)if(t.value===e)return t;return null}const Dre="schemaClassId";function Nre(r,e){var n,i;const t=r.getExtension(hp);if(t&&t.propertyTables)for(const s of t.propertyTables){const a=s.class,o=(i=(n=t.schema)==null?void 0:n.classes)==null?void 0:i[a];s.properties&&o&&kre(s,o,r)}}function kre(r,e,t){for(const n in r.properties){const i=r.properties[n].data;if(i){const s=e.properties[n];if(s){const a=Vre(i,s,t);r.properties[n]=a}}}}function Qre(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Dre,n=r.getExtension(hp);n||(n=r.addExtension(hp)),n.schema=zre(e,t,n.schema);const i=Hre(e,t,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function zre(r,e,t){const n=t??{id:"schema_id"},i={properties:{}};for(const s of r){const a={type:s.elementType,componentType:s.componentType};i.properties[s.name]=a}return n.classes={},n.classes[e]=i,n}function Hre(r,e,t){var a;const n={class:e,count:0};let i=0;const s=(a=t.classes)==null?void 0:a[e];for(const o of r){if(i===0&&(i=o.values.length),i!==o.values.length&&o.values.length)throw new Error("Illegal values in attributes");(s==null?void 0:s.properties[o.name])&&(n.properties||(n.properties={}),n.properties[o.name]={values:0,data:o.values})}return n.count=i,n}function Vre(r,e,t){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:s}=Gre(r);n.stringOffsets=G2(s,t),n.values=G2(i,t)}else if(e.type==="SCALAR"&&e.componentType){const i=$re(r,e.componentType);n.values=G2(i,t)}return n}const jre={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function $re(r,e){const t=[];for(const i of r)t.push(Number(i));const n=jre[e];if(!n)throw new Error("Illegal component type");return new n(t)}function Gre(r){const e=new TextEncoder,t=[];let n=0;for(const u of r){const d=e.encode(u);n+=d.length,t.push(d)}const i=new Uint8Array(n),s=[];let a=0;for(const u of t)i.set(u,a),s.push(a),a+=u.length;s.push(a);const o=new Uint32Array(s);return{stringData:i,stringOffsets:o}}function G2(r,e){return e.gltf.buffers.push({arrayBuffer:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}),e.addBufferView(r)}const qre=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:Qre,decode:bre,encode:vre,name:yre},Symbol.toStringTag,{value:"Module"})),_4="EXT_feature_metadata",Kre=_4;async function Wre(r,e){const t=new Ro(r);Xre(t,e)}function Xre(r,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=r.getExtension(_4);t&&((i=e.gltf)!=null&&i.loadImages&&Yre(r,t),Zre(r,t))}function Yre(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const s in n){const a=n[s],o=ene(i,s);o&&rne(r,o,a)}}function Zre(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const s in n){const a=Jre(i,s);a&&tne(r,t,a)}}function Jre(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function ene(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function tne(r,e,t){var s,a;if(!t.class)return;const n=(s=e.classes)==null?void 0:s[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const o in n.properties){const u=n.properties[o],d=(a=t.properties)==null?void 0:a[o];if(d){const p=nne(r,e,u,i,d);d.data=p}}}function rne(r,e,t){var i;const n=e.class;for(const s in t.properties){const a=(i=e==null?void 0:e.properties)==null?void 0:i[s];if(a){const o=lne(r,a,n);a.data=o}}}function nne(r,e,t,n,i){let s=[];const a=i.bufferView,o=r.getTypedArrayForBufferView(a),u=ine(r,t,i,n),d=sne(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?s=m4(n,o,u,d):one(t)&&(s=ane(t,n,o,u)),s}function ine(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?r0(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function sne(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?r0(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function one(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function ane(r,e,t,n){const i=r.type==="ARRAY",s=r.componentCount,a="SCALAR",o=r.componentType||r.type,u=V2(a,o),d=t.byteLength/u,p=n0(t,a,o,d);return i?n?p4(p,e,n,t.length,u):s?g4(p,e,s):[]:p}function lne(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const s of n.meshes)for(const a of s.primitives)cne(r,t,e,i,a);return i}function cne(r,e,t,n,i){const s={channels:t.channels,...t.texture},a=j2(r,s,i);a&&d4(r,e,a,n,i)}const une=Object.freeze(Object.defineProperty({__proto__:null,decode:Wre,name:Kre},Symbol.toStringTag,{value:"Module"})),hne="4.3.2",Ap=!0,y4=1735152710,q2=12,i0=8,Ane=1313821514,fne=5130562,dne=0,pne=0,gne=1;function mne(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function _ne(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new DataView(r),{magic:i=y4}=t,s=n.getUint32(e,!1);return s===i||s===y4}function yne(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(e),i=mne(n,t+0),s=n.getUint32(t+4,Ap),a=n.getUint32(t+8,Ap);switch(Object.assign(r,{header:{byteOffset:t,byteLength:a,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),t+=q2,r.version){case 1:return bne(r,n,t);case 2:return vne(r,n,t,{});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function bne(r,e,t){Ri(r.header.byteLength>q2+i0);const n=e.getUint32(t+0,Ap),i=e.getUint32(t+4,Ap);return t+=i0,Ri(i===dne),K2(r,e,t,n),t+=n,t+=W2(r,e,t,r.header.byteLength),t}function vne(r,e,t,n){return Ri(r.header.byteLength>q2+i0),wne(r,e,t,n),t+r.header.byteLength}function wne(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,Ap),s=e.getUint32(t+4,Ap);switch(t+=i0,s){case Ane:K2(r,e,t,i);break;case fne:W2(r,e,t,i);break;case pne:n.strict||K2(r,e,t,i);break;case gne:n.strict||W2(r,e,t,i);break}t+=wg(i,4)}return t}function K2(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),a=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(a),wg(n,4)}function W2(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),wg(n,4)}function b4(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const xne="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Bne="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Cne=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Tne=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Ene={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Sne={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Ine(r,e,t,n,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await Mne();Rne(a,a.exports[Sne[i]],r,e,t,n,a.exports[Ene[s||"NONE"]])}let X2;async function Mne(){return X2||(X2=Pne()),X2}async function Pne(){let r=xne;WebAssembly.validate(Cne)&&(r=Bne,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(Fne(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Fne(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?Tne[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function Rne(r,e,t,n,i,s,a){const o=r.exports.sbrk,u=n+3&-4,d=o(u*i),p=o(s.length),_=new Uint8Array(r.exports.memory.buffer);_.set(s,p);const w=e(d,n,i,p,s.length);if(w===0&&a&&a(d,u,i),t.set(_.subarray(d,d+n*i)),o(d-o(0)),w!==0)throw new Error(`Malformed buffer data: ${w}`)}const s0="EXT_meshopt_compression",Lne=s0;async function One(r,e){var i,s;const t=new Ro(r);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((s=e.gltf)!=null&&s.loadBuffers))return;const n=[];for(const a of r.json.bufferViews||[])n.push(Une(t,a));await Promise.all(n),t.removeExtension(s0)}async function Une(r,e){const t=r.getObjectExtension(e,s0);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:s,count:a,mode:o,filter:u="NONE",buffer:d}=t,p=r.gltf.buffers[d],_=new Uint8Array(p.arrayBuffer,p.byteOffset+n,i),w=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Ine(w,a,s,_,o,u),r.removeObjectExtension(e,s0)}}const Dne=Object.freeze(Object.defineProperty({__proto__:null,decode:One,name:Lne},Symbol.toStringTag,{value:"Module"})),fp="EXT_texture_webp",Nne=fp;function kne(r,e){const t=new Ro(r);if(!lj("image/webp")){if(t.getRequiredExtensions().includes(fp))throw new Error(`gltf: Required extension ${fp} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,fp);s&&(i.source=s.source),t.removeObjectExtension(i,fp)}t.removeExtension(fp)}const Qne=Object.freeze(Object.defineProperty({__proto__:null,name:Nne,preprocess:kne},Symbol.toStringTag,{value:"Module"})),o0="KHR_texture_basisu",zne=o0;function Hne(r,e){const t=new Ro(r),{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,o0);s&&(i.source=s.source,t.removeObjectExtension(i,o0))}t.removeExtension(o0)}const Vne=Object.freeze(Object.defineProperty({__proto__:null,name:zne,preprocess:Hne},Symbol.toStringTag,{value:"Module"})),jne={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.2",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function $ne(r,e,t){const n=w4(e.metadata),i=[],s=Gne(e.attributes);for(const a in r){const o=r[a],u=v4(a,o,s[a]);i.push(u)}if(t){const a=v4("indices",t);i.push(a)}return{fields:i,metadata:n}}function Gne(r){const e={};for(const t in r){const n=r[t];e[n.name||"undefined"]=n}return e}function v4(r,e,t){const n=t?w4(t.metadata):void 0;return F9(r,e,n)}function w4(r){Object.entries(r);const e={};for(const t in r)e[`${t}.string`]=JSON.stringify(r[t]);return e}const x4={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},qne={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Kne=4;class Wne{constructor(e){Y(this,"draco");Y(this,"decoder");Y(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const w=`DRACO decompression failed: ${a.error_msg()}`;throw new Error(w)}const o=this._getDracoLoaderData(s,i,t),u=this._getMeshData(s,o,t),d=FI(u.attributes),p=$ne(u.attributes,o,u.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:d},...u,schema:p}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const s=this.decoder.GetAttribute(e,i),a=this._getAttributeMetadata(e,i);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:a};const o=this._getQuantizationTransform(s,t);o&&(n[s.unique_id()].quantization_transform=o);const u=this._getOctahedronTransform(s,t);u&&(n[s.unique_id()].octahedron_transform=u)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const s of Object.values(e.attributes)){const a=this._deduceAttributeName(s,n);s.name=a;const o=this._getAttributeValues(t,s);if(o){const{value:u,size:d}=o;i[a]={value:u,size:d,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*Kne,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,n).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),Zne(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=qne[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,a=e.num_points()*i,o=a*n.BYTES_PER_ELEMENT,u=Xne(this.draco,n);let d;const p=this.draco._malloc(o);try{const _=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,_,u,o,p),d=new n(this.draco.HEAPF32.buffer,p,a).slice()}finally{this.draco._free(p)}return{value:d,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[a,o]of Object.entries(t.extraAttributes||{}))if(o===n)return a;const i=e.attribute_type;for(const a in x4)if(this.draco[a]===i)return x4[a];const s=t.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const s=this.metadataQuerier.GetEntryName(e,i);t[s]=this._getDracoMetadataField(e,s)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=Yne(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(o=>a.min_value(o))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}function Xne(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function Yne(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function Zne(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}const Jne="1.5.6",eie="1.4.1",Y2=`https://www.gstatic.com/draco/versioned/decoders/${Jne}`,el={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Z2={[el.DECODER]:`${Y2}/${el.DECODER}`,[el.DECODER_WASM]:`${Y2}/${el.DECODER_WASM}`,[el.FALLBACK_DECODER]:`${Y2}/${el.FALLBACK_DECODER}`,[el.ENCODER]:`https://raw.githubusercontent.com/google/draco/${eie}/javascript/${el.ENCODER}`};let J2;async function tie(r){const e=r.modules||{};return e.draco3d?J2||(J2=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):J2||(J2=rie(r)),await J2}async function rie(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await xf(Z2[el.FALLBACK_DECODER],"draco",r,el.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await xf(Z2[el.DECODER],"draco",r,el.DECODER),await xf(Z2[el.DECODER_WASM],"draco",r,el.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await nie(e,t)}function nie(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r({...t,onModuleLoaded:i=>n({draco:i})})})}const B4={...jne,parse:iie};async function iie(r,e){const{draco:t}=await tie(e),n=new Wne(t);try{return n.parseSync(r,e==null?void 0:e.draco)}finally{n.destroy()}}function sie(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=C4(n);e[t]=i}}return e}function C4(r){const{buffer:e,size:t,count:n}=oie(r);return{value:e,size:t,byteOffset:0,count:n,type:c4(t),componentType:t0(e)}}function oie(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=aie(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function aie(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const PA="KHR_draco_mesh_compression",lie=PA;function cie(r,e,t){const n=new Ro(r);for(const i of T4(n))n.getObjectExtension(i,PA)}async function uie(r,e,t){var s;if(!((s=e==null?void 0:e.gltf)!=null&&s.decompressMeshes))return;const n=new Ro(r),i=[];for(const a of T4(n))n.getObjectExtension(a,PA)&&i.push(Aie(n,a,e,t));await Promise.all(i),n.removeExtension(PA)}function hie(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new Ro(r);for(const n of t.json.meshes||[])fie(n,e),t.addRequiredExtension(PA)}async function Aie(r,e,t,n){const i=r.getObjectExtension(e,PA);if(!i)return;const s=r.getTypedArrayForBufferView(i.bufferView),a=vv(s.buffer,s.byteOffset),o={...t};delete o["3d-tiles"];const u=await vg(a,B4,o,n),d=sie(u.attributes);for(const[p,_]of Object.entries(d))if(p in e.attributes){const w=e.attributes[p],v=r.getAccessor(w);v!=null&&v.min&&(v!=null&&v.max)&&(_.min=v.min,_.max=v.max)}e.attributes=d,u.indices&&(e.indices=C4(u.indices)),r.removeObjectExtension(e,PA),die(e)}function fie(r,e){var p;let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const s=n.DracoWriter.encodeSync({attributes:r}),a=(p=i==null?void 0:i.parseSync)==null?void 0:p.call(i,{attributes:r}),o=n._addFauxAttributes(a.attributes),u=n.addBufferView(s);return{primitives:[{attributes:o,mode:t,extensions:{[PA]:{bufferView:u,attributes:o}}}]}}function die(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*T4(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const pie=Object.freeze(Object.defineProperty({__proto__:null,decode:uie,encode:hie,name:lie,preprocess:cie},Symbol.toStringTag,{value:"Module"})),a0="KHR_texture_transform",gie=a0,l0=new Mt,mie=new ms,_ie=new ms;async function yie(r,e){var s;if(!new Ro(r).hasExtension(a0)||!((s=e.gltf)!=null&&s.loadBuffers))return;const i=r.json.materials||[];for(let a=0;a<i.length;a++)bie(a,r)}function bie(r,e){var s,a,o,u;const t=(s=e.json.materials)==null?void 0:s[r],n=[(a=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:a.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(o=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:o.metallicRoughnessTexture],i=[];for(const d of n)d&&((u=d==null?void 0:d.extensions)!=null&&u[a0])&&vie(e,r,d,i)}function vie(r,e,t,n){const i=wie(t,n);if(!i)return;const s=r.json.meshes||[];for(const a of s)for(const o of a.primitives){const u=o.material;Number.isFinite(u)&&e===u&&xie(r,o,i)}}function wie(r,e){var a;const t=(a=r.extensions)==null?void 0:a[a0],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(o=>{let[u,d]=o;return u===n&&d===i})!==-1)){const o=Tie(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:o}}return null}function xie(r,e,t){var o,u;const{originalTexCoord:n,texCoord:i,matrix:s}=t,a=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(a)){const d=(o=r.json.accessors)==null?void 0:o[a];if(d&&d.bufferView){const p=(u=r.json.bufferViews)==null?void 0:u[d.bufferView];if(p){const{arrayBuffer:_,byteOffset:w}=r.buffers[p.buffer],v=(w||0)+(d.byteOffset||0)+(p.byteOffset||0),{ArrayType:M,length:P}=H2(d,p),D=a4[d.componentType],N=o4[d.type],z=p.byteStride||D*N,W=new Float32Array(P);for(let V=0;V<d.count;V++){const $=new M(_,v+V*z,2);l0.set($[0],$[1],1),l0.transformByMatrix3(s),W.set([l0[0],l0[1]],V*N)}n===i?Bie(d,p,r.buffers,W):Cie(i,d,e,r,W)}}}}function Bie(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Cie(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=n.json.accessors;a&&(a.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=a.length-1)}function Tie(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new ms().set(1,0,0,0,1,0,e[0],e[1],1),s=mie.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),a=_ie.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(a)}const Eie=Object.freeze(Object.defineProperty({__proto__:null,decode:yie,name:gie},Symbol.toStringTag,{value:"Module"})),Qf="KHR_lights_punctual",Sie=Qf;async function Iie(r){const e=new Ro(r),{json:t}=e,n=e.getExtension(Qf);n&&(e.json.lights=n.lights,e.removeExtension(Qf));for(const i of t.nodes||[]){const s=e.getObjectExtension(i,Qf);s&&(i.light=s.light),e.removeObjectExtension(i,Qf)}}async function Mie(r){const e=new Ro(r),{json:t}=e;if(t.lights){const n=e.addExtension(Qf);Bl(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,Qf,n)}delete e.json.lights}}const Pie=Object.freeze(Object.defineProperty({__proto__:null,decode:Iie,encode:Mie,name:Sie},Symbol.toStringTag,{value:"Module"})),im="KHR_materials_unlit",Fie=im;async function Rie(r){const e=new Ro(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,im);e.removeExtension(im)}function Lie(r){const e=new Ro(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,im,{}),e.addExtension(im))}const Oie=Object.freeze(Object.defineProperty({__proto__:null,decode:Rie,encode:Lie,name:Fie},Symbol.toStringTag,{value:"Module"})),sm="KHR_techniques_webgl",Uie=sm;async function Die(r){const e=new Ro(r),{json:t}=e,n=e.getExtension(sm);if(n){const i=kie(n,e);for(const s of t.materials||[]){const a=e.getObjectExtension(s,sm);a&&(s.technique=Object.assign({},a,i[a.technique]),s.technique.values=Qie(s.technique,e)),e.removeObjectExtension(s,sm)}e.removeExtension(sm)}}async function Nie(r,e){}function kie(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,s=new TextDecoder;return n.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(a=>{a.fragmentShader=n[a.fragmentShader],a.vertexShader=n[a.vertexShader]}),i.forEach(a=>{a.program=t[a.program]}),i}function Qie(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const E4=[qre,_re,Dne,Qne,Vne,pie,Pie,Oie,Object.freeze(Object.defineProperty({__proto__:null,decode:Die,encode:Nie,name:Uie},Symbol.toStringTag,{value:"Module"})),Eie,une];function zie(r){var i;let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=E4.filter(s=>S4(s.name,e));for(const s of n)(i=s.preprocess)==null||i.call(s,r,e,t)}async function Hie(r){var i;let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=E4.filter(s=>S4(s.name,e));for(const s of n)await((i=s.decode)==null?void 0:i.call(s,r,e,t))}function S4(r,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(r in t&&!t[r])}const ex="KHR_binary_glTF";function Vie(r){const e=new Ro(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,ex);i&&Object.assign(n,i),e.removeObjectExtension(n,ex)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(ex)}const I4={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},jie={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class $ie{constructor(){Y(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});Y(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),Vie(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in I4)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const s=n[i];s.id=s.id||i;const a=e[t].length;e[t].push(s),this.idToIndexMap[t][i]=a}}}_convertObjectIdsToArrayIndices(e){for(const t in I4)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:s}=t;for(const a in n)n[a]=this._convertIdToIndex(n[a],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),s&&(t.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const s=n[i],a=this._convertIdToIndex(s,i);n[i]=a}}_convertIdToIndex(e,t){const n=jie[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const s of e.materials){s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((t=s.values)==null?void 0:t.tex)||((n=s.values)==null?void 0:n.texture2d_0)||((i=s.values)==null?void 0:i.diffuseTex),o=e.textures.findIndex(u=>u.id===a);o!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}}function Gie(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new $ie().normalize(r,e)}async function qie(r,e){var s,a,o;let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return Kie(r,e,t,n),Gie(r,{normalize:(s=n==null?void 0:n.gltf)==null?void 0:s.normalize}),zie(r,n,i),(a=n==null?void 0:n.gltf)!=null&&a.loadBuffers&&r.json.buffers&&await Wie(r,n,i),(o=n==null?void 0:n.gltf)!=null&&o.loadImages&&await Xie(r,n,i),await Hie(r,n,i),r}function Kie(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!_ne(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=fV(e);else if(e instanceof ArrayBuffer){const a={};t=yne(a,e,t,n.glb),Bl(a.type==="glTF",`Invalid GLB magic string ${a.type}`),r._glb=a,r.json=a.json}else Bl(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=r.json.images||[];r.images=new Array(s.length).fill({})}async function Wie(r,e,t){var i,s;const n=r.json.buffers||[];for(let a=0;a<n.length;++a){const o=n[a];if(o.uri){const{fetch:u}=t;Bl(u);const d=b4(o.uri,e),p=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,d)),_=await((s=p==null?void 0:p.arrayBuffer)==null?void 0:s.call(p));r.buffers[a]={arrayBuffer:_,byteOffset:0,byteLength:_.byteLength},delete o.uri}else r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function Xie(r,e,t){const n=Yie(r),i=r.json.images||[],s=[];for(const a of n)s.push(Zie(r,i[a],a,e,t));return await Promise.all(s)}function Yie(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function Zie(r,e,t,n,i){let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const o=b4(e.uri,n),{fetch:u}=i;s=await(await u(o)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const o=nre(r.json,r.buffers,e.bufferView);s=vv(o.buffer,o.byteOffset,o.byteLength)}Bl(s,"glTF image has no data");let a=await vg(s,[DI,Fte],{...n,mimeType:e.mimeType,basis:n.basis||{format:i4()}},i);a&&a[0]&&(a={compressed:!0,mipmaps:!1,width:a[0].width,height:a[0].height,data:a[0]}),r.images=r.images||[],r.images[t]=a}const om={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:hne,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Jie,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Jie(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...om.options,...e},e.gltf={...om.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await qie({},r,n,e,t)}const ese={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tse={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Jl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},rse={magFilter:Jl.TEXTURE_MAG_FILTER,minFilter:Jl.TEXTURE_MIN_FILTER,wrapS:Jl.TEXTURE_WRAP_S,wrapT:Jl.TEXTURE_WRAP_T},nse={[Jl.TEXTURE_MAG_FILTER]:Jl.LINEAR,[Jl.TEXTURE_MIN_FILTER]:Jl.NEAREST_MIPMAP_LINEAR,[Jl.TEXTURE_WRAP_S]:Jl.REPEAT,[Jl.TEXTURE_WRAP_T]:Jl.REPEAT};function ise(){return{id:"default-sampler",parameters:nse}}function sse(r){return tse[r]}function ose(r){return ese[r]}class ase{constructor(){Y(this,"baseUri","");Y(this,"jsonUnprocessed");Y(this,"json");Y(this,"buffers",[]);Y(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:n,buffers:i=[],images:s=[]}=e,{baseUri:a=""}=e;return Bl(n),this.baseUri=a,this.buffers=i,this.images=s,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e){const t={...e};return this.json=t,e.bufferViews&&(t.bufferViews=e.bufferViews.map((n,i)=>this._resolveBufferView(n,i))),e.images&&(t.images=e.images.map((n,i)=>this._resolveImage(n,i))),e.samplers&&(t.samplers=e.samplers.map((n,i)=>this._resolveSampler(n,i))),e.textures&&(t.textures=e.textures.map((n,i)=>this._resolveTexture(n,i))),e.accessors&&(t.accessors=e.accessors.map((n,i)=>this._resolveAccessor(n,i))),e.materials&&(t.materials=e.materials.map((n,i)=>this._resolveMaterial(n,i))),e.meshes&&(t.meshes=e.meshes.map((n,i)=>this._resolveMesh(n,i))),e.nodes&&(t.nodes=e.nodes.map((n,i)=>this._resolveNode(n,i)),t.nodes=t.nodes.map((n,i)=>this._resolveNodeChildren(n))),e.skins&&(t.skins=e.skins.map((n,i)=>this._resolveSkin(n,i))),e.scenes&&(t.scenes=e.scenes.map((n,i)=>this._resolveScene(n,i))),typeof this.json.scene=="number"&&t.scenes&&(t.scene=t.scenes[this.json.scene]),t}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,s)=>{const a=this.getMesh(s);return i.id=a.id,i.primitives=i.primitives.concat(a.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const s={...i,attributes:{},indices:void 0,material:void 0},a=i.attributes;for(const o in a)s.attributes[o]=this.getAccessor(a[o]);return i.indices!==void 0&&(s.indices=this.getAccessor(i.indices)),i.material!==void 0&&(s.material=this.getMaterial(i.material)),s})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=sse(e.componentType),i=ose(e.type),s=n*i,a={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(a.bufferView=this.getBufferView(e.bufferView)),a.bufferView){const o=a.bufferView.buffer,{ArrayType:u,byteLength:d}=H2(a,a.bufferView),p=(a.bufferView.byteOffset||0)+(a.byteOffset||0)+o.byteOffset;let _=o.arrayBuffer.slice(p,p+d);a.bufferView.byteStride&&(_=this._getValueFromInterleavedBuffer(o,p,a.bufferView.byteStride,a.bytesPerElement,a.count)),a.value=new u(_)}return a}_getValueFromInterleavedBuffer(e,t,n,i,s){const a=new Uint8Array(s*i);for(let o=0;o<s;o++){const u=t+o*n;a.set(new Uint8Array(e.arrayBuffer.slice(u,u+i)),o*i)}return a.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):ise(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const s=this._enumSamplerParameter(i);s!==void 0&&(n.parameters[s]=n[i])}return n}_enumSamplerParameter(e){return rse[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let s=this.buffers[n].byteOffset||0;return e.byteOffset&&(s+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,s,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}}function tx(r,e){return new ase().postProcess(r,e)}async function lse(r){const e=[];return r.scenes.forEach(t=>{t.traverse(n=>{Object.values(n.model.uniforms).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await cse(()=>e.some(t=>!t.loaded))}async function cse(r){for(;r();)await new Promise(e=>requestAnimationFrame(e))}const M4=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,use={name:"scenegraph",vs:M4,fs:M4,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},hse=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ase=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,P4=[255,255,255,255],fse={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:P4},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[om]};class rx extends ap{getShaders(){const e={};let t;this.props._lighting==="pbr"?(t=Iw,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};const n=[kw,Gw,use,t];return super.getShaders({defines:e,vs:hse,fs:Ase,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:P4,transition:!0},instanceModelMatrix:qF})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.scenegraph!==n.scenegraph?this._updateScenegraph():t._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.scenegraph)==null||t.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var o;const e=this.props,{device:t}=this.context;let n=null;if(e.scenegraph instanceof Ry)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const u=e.scenegraph,d=u.json?tx(u):u,p=Xte(t,d,this._getModelOptions());n={gltf:d,...p},lse(p).then(()=>{this.setNeedsRedraw()}).catch(_=>{this.raiseError(_,"loading glTF")})}const i={layer:this,device:this.context.device},s=e.getScene(n,i),a=e.getAnimator(n,i);if(s instanceof Xd){(o=this.state.scenegraph)==null||o.destroy(),this._applyAnimationsProp(a,e._animations);const u=[];s.traverse(d=>{d instanceof n2&&u.push(d.model)}),this.setState({scenegraph:s,animator:a,models:u}),this.getAttributeManager().invalidateAll()}else s!==null&&Wn.warn("invalid scenegraph:",s)()}_applyAnimationsProp(e,t){if(!e||!t)return;const n=e.getAnimations();Object.keys(t).sort().forEach(i=>{const s=t[i];if(i==="*")n.forEach(a=>{Object.assign(a,s)});else if(Number.isFinite(Number(i))){const a=Number(i);a>=0&&a<n.length?Object.assign(n[a],s):Wn.warn(`animation ${i} not found`)()}else{const a=n.find(o=>{let{name:u}=o;return u===i});a?Object.assign(a,s):Wn.warn(`animation ${i} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw(e){let{context:t}=e;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(t.timeline.getTime()),this.setNeedsRedraw());const{viewport:n,renderPass:i}=this.context,{sizeScale:s,sizeMinPixels:a,sizeMaxPixels:o,coordinateSystem:u}=this.props,d=this.getNumInstances();this.state.scenegraph.traverse((p,_)=>{let{worldMatrix:w}=_;if(p instanceof n2){const{model:v}=p;v.setInstanceCount(d);const M={camera:v.uniforms.cameraPosition},P={sizeScale:s,sizeMinPixels:a,sizeMaxPixels:o,composeModelMatrix:KF(n,u),sceneModelMatrix:w};v.shaderInputs.setProps({pbrProjection:M,scenegraph:P}),v.draw(i)}})}}rx.defaultProps=fse,rx.layerName="ScenegraphLayer";const F4=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,dse={name:"mesh",vs:F4,fs:F4,uniformTypes:{pickFeatureIds:"f32"}},pse=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,gse=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function mse(r){const e=r.positions||r.POSITION,t=e.value.length/e.size;r.COLOR_0||r.colors||(r.colors={size:4,value:new Uint8Array(t*4).fill(255),normalized:!0})}const _se={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class nx extends D2{getShaders(){const e=super.getShaders();return e.modules.push(Iw,dse),{...e,vs:pse,fs:gse}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props,{model:n}=this.state;if(!n)return;const i={pickFeatureIds:!!t},s={camera:n.uniforms.cameraPosition};n.shaderInputs.setProps({pbrProjection:s,mesh:i}),super.draw(e)}getModel(e){const{id:t}=this.props,n=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:n});const i=this.getShaders();return mse(e.attributes),new wA(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:n}=this.props,i=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:i});const{pbr_baseColorSampler:s}=i.bindings,{emptyTexture:a}=this.state,o={sampler:s||a,hasTexture:!!s},{camera:u,...d}={...i.bindings,...i.uniforms};t.shaderInputs.setProps({simpleMesh:o,pbrMaterial:d})}}parseMaterial(e,t){const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return YF(this.context.device,{unlit:n,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,n=new Uint8ClampedArray(t.length*e.size),i=[];for(let s=0;s<t.length;s++)this.encodePickingColor(t[s],i),n[s*3]=i[0],n[s*3+1]=i[1],n[s*3+2]=i[2];e.value=n}finalizeState(e){var t;super.finalizeState(e),(t=this.state.parsedPBRMaterial)==null||t.generatedTextures.forEach(n=>n.destroy()),this.setState({parsedPBRMaterial:null})}}nx.layerName="MeshLayer",nx.defaultProps=_se;const yse=6378137,bse=6378137,vse=6356752314245179e-9;function c0(r){return r}new Mt;function wse(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c0;return"longitude"in r?(e[0]=t(r.longitude),e[1]=t(r.latitude),e[2]=r.height):"x"in r?(e[0]=t(r.x),e[1]=t(r.y),e[2]=r.z):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function xse(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return wse(r,e,mo._cartographicRadians?c0:TG)}function Bse(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c0;return"longitude"in e?(e.longitude=t(r[0]),e.latitude=t(r[1]),e.height=r[2]):"x"in e?(e.x=t(r[0]),e.y=t(r[1]),e.z=r[2]):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function Cse(r,e){return Bse(r,e,mo._cartographicRadians?c0:EG)}const R4=1e-14,Tse=new Mt,L4={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},ix={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},am={east:new Mt,north:new Mt,up:new Mt,west:new Mt,south:new Mt,down:new Mt},Ese=new Mt,Sse=new Mt,Ise=new Mt;function O4(r,e,t,n,i,s){const a=L4[e]&&L4[e][t];Uc(a&&(!n||n===a));let o,u,d;const p=Tse.copy(i);if(Oc(p.x,0,R4)&&Oc(p.y,0,R4)){const w=Math.sign(p.z);o=Ese.fromArray(ix[e]),e!=="east"&&e!=="west"&&o.scale(w),u=Sse.fromArray(ix[t]),t!=="east"&&t!=="west"&&u.scale(w),d=Ise.fromArray(ix[n]),n!=="east"&&n!=="west"&&d.scale(w)}else{const{up:w,east:v,north:M}=am;v.set(-p.y,p.x,0).normalize(),r.geodeticSurfaceNormal(p,w),M.copy(w).cross(v);const{down:P,west:D,south:N}=am;P.copy(w).scale(-1),D.copy(v).scale(-1),N.copy(M).scale(-1),o=am[e],u=am[t],d=am[n]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=u.x,s[5]=u.y,s[6]=u.z,s[7]=0,s[8]=d.x,s[9]=d.y,s[10]=d.z,s[11]=0,s[12]=p.x,s[13]=p.y,s[14]=p.z,s[15]=1,s}const dp=new Mt,Mse=new Mt,Pse=new Mt;function Fse(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:s}=e;dp.from(r);const a=dp.x,o=dp.y,u=dp.z,d=n.x,p=n.y,_=n.z,w=a*a*d*d,v=o*o*p*p,M=u*u*_*_,P=w+v+M,D=Math.sqrt(1/P);if(!Number.isFinite(D))return;const N=Mse;if(N.copy(r).scale(D),P<s)return N.to(t);const z=i.x,W=i.y,V=i.z,$=Pse;$.set(N.x*z*2,N.y*W*2,N.z*V*2);let q=(1-D)*dp.len()/(.5*$.len()),te=0,J,me,xe,se;do{q-=te,J=1/(1+q*z),me=1/(1+q*W),xe=1/(1+q*V);const oe=J*J,ve=me*me,ge=xe*xe,Je=oe*J,Ge=ve*me,et=ge*xe;se=w*oe+v*ve+M*ge-1;const ct=-2*(w*Je*z+v*Ge*W+M*et*V);te=se/ct}while(Math.abs(se)>Gq);return dp.scale([J,me,xe]).to(t)}const u0=new Mt,U4=new Mt,Rse=new Mt,Vc=new Mt,Lse=new Mt,h0=new Mt;class Oi{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.centerToleranceSquared=$q,Uc(e>=0),Uc(t>=0),Uc(n>=0),this.radii=new Mt(e,t,n),this.radiiSquared=new Mt(e*e,t*t,n*n),this.radiiToTheFourth=new Mt(e*e*e*e,t*t*t*t,n*n*n*n),this.oneOverRadii=new Mt(e===0?0:1/e,t===0?0:1/t,n===0?0:1/n),this.oneOverRadiiSquared=new Mt(e===0?0:1/(e*e),t===0?0:1/(t*t),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,t,n),this.maximumRadius=Math.max(e,t,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=U4,i=Rse,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(i));return i.scale(1/a),n.scale(s),i.add(n),i.to(t)}cartesianToCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];h0.from(e);const n=this.scaleToGeodeticSurface(h0,Vc);if(!n)return;const i=this.geodeticSurfaceNormal(n,U4),s=Lse;s.copy(h0).subtract(n);const a=Math.atan2(i.y,i.x),o=Math.asin(i.z),u=Math.sign(gw(s,h0))*q5(s);return Cse([a,o,u],t)}eastNorthUpToFixedFrame(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new kn;return O4(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new kn;return O4(this,e,t,n,i,s)}geocentricSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return u0.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=xse(e),i=n[0],s=n[1],a=Math.cos(s);return u0.set(a*Math.cos(i),a*Math.sin(i),Math.sin(s)).normalize(),u0.to(t)}geodeticSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return u0.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return Fse(e,this,t)}scaleToGeocentricSurface(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];Vc.from(e);const n=Vc.x,i=Vc.y,s=Vc.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+i*i*a.y+s*s*a.z);return Vc.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Vc.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Vc.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];Uc(Oc(this.radii.x,this.radii.y,uM)),Uc(this.radii.z>0),Vc.from(e);const i=Vc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return Vc.set(0,0,i).to(n)}}Oi.WGS84=new Oi(yse,bse,vse);class Ose{constructor(e,t,n){Y(this,"item");Y(this,"previous");Y(this,"next");this.item=e,this.previous=t,this.next=n}}class Use{constructor(){Y(this,"head",null);Y(this,"tail",null);Y(this,"_length",0)}get length(){return this._length}add(e){const t=new Ose(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length}}class Dse{constructor(){Y(this,"_list");Y(this,"_sentinel");Y(this,"_trimTiles");this._list=new Use,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,n){t._cacheNode||(t._cacheNode=this._list.add(t),n&&n(e,t))}unloadTile(e,t,n){const i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,n&&n(e,t))}unloadTiles(e,t){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,s=e.maximumMemoryUsage*1024*1024,a=this._sentinel;let o=i.head;for(;o!==a&&(e.gpuMemoryUsageInBytes>s||n);){const u=o.item;o=o.next,this.unloadTile(e,u,t)}}trim(){this._trimTiles=!0}}function Nse(r,e){Ri(r),Ri(e);const{rtcCenter:t,gltfUpAxis:n}=e,{computedTransform:i,boundingVolume:{center:s}}=r;let a=new kn(i);switch(t&&a.translate(t),n){case"Z":break;case"Y":const _=new kn().rotateX(Math.PI/2);a=a.multiplyRight(_);break;case"X":const w=new kn().rotateY(-Math.PI/2);a=a.multiplyRight(w);break}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const o=new Mt(s);e.cartesianModelMatrix=a,e.cartesianOrigin=o;const u=Oi.WGS84.cartesianToCartographic(o,new Mt),p=Oi.WGS84.eastNorthUpToFixedFrame(o).invert();e.cartographicModelMatrix=p.multiplyRight(a),e.cartographicOrigin=u,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const D4=new Mt,sx=new Mt,ox=new Zl([new Gu,new Gu,new Gu,new Gu,new Gu,new Gu]);function kse(r,e){const{cameraDirection:t,cameraUp:n,height:i}=r,{metersPerUnit:s}=r.distanceScales,a=A0(r,r.center),o=Oi.WGS84.eastNorthUpToFixedFrame(a),u=r.unprojectPosition(r.cameraPosition),d=Oi.WGS84.cartographicToCartesian(u,new Mt),p=new Mt(o.transformAsVector(new Mt(t).scale(s))).normalize(),_=new Mt(o.transformAsVector(new Mt(n).scale(s))).normalize();zse(r);const w=r.constructor,{longitude:v,latitude:M,width:P,bearing:D,zoom:N}=r,z=new w({longitude:v,latitude:M,height:i,width:P,bearing:D,zoom:N,pitch:0});return{camera:{position:d,direction:p,up:_},viewport:r,topDownViewport:z,height:i,cullingVolume:ox,frameNumber:e,sseDenominator:1.15}}function Qse(r,e,t){if(t===0||r.length<=t)return[r,[]];const n=[],{longitude:i,latitude:s}=e.viewport;for(const[d,p]of r.entries()){const[_,w]=p.header.mbs,v=Math.abs(i-_),M=Math.abs(s-w),P=Math.sqrt(M*M+v*v);n.push([d,P])}const a=n.sort((d,p)=>d[1]-p[1]),o=[];for(let d=0;d<t;d++)o.push(r[a[d][0]]);const u=[];for(let d=t;d<a.length;d++)u.push(r[a[d][0]]);return[o,u]}function zse(r){const e=r.getFrustumPlanes(),t=N4(e.near,r.cameraPosition),n=A0(r,t),i=A0(r,r.cameraPosition,sx);let s=0;ox.planes[s++].fromPointNormal(n,D4.copy(n).subtract(i));for(const a in e){if(a==="near")continue;const o=e[a],u=N4(o,t,sx),d=A0(r,u,sx);ox.planes[s++].fromPointNormal(d,D4.copy(n).subtract(d))}}function N4(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Mt;const n=r.normal.dot(e);return t.copy(r.normal).scale(r.distance-n).add(e),t}function A0(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Mt;const n=r.unprojectPosition(e);return Oi.WGS84.cartographicToCartesian(n,t)}const Hse=6378137,Vse=6378137,ax=6356752314245179e-9,pp=new Mt;function jse(r,e){if(r instanceof rm){const{halfAxes:t}=r,n=Gse(t);return Math.log2(ax/(n+e[2]))}else if(r instanceof tm){const{radius:t}=r;return Math.log2(ax/(t+e[2]))}else if(r.width&&r.height){const{width:t,height:n}=r,i=Math.log2(Hse/t),s=Math.log2(Vse/n);return(i+s)/2}return 1}function k4(r,e,t){Oi.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],pp);const n=Math.sqrt(Math.pow(pp[0]-t[0],2)+Math.pow(pp[1]-t[1],2)+Math.pow(pp[2]-t[2],2));return Math.log2(ax/(n+e[2]))}function $se(r,e,t){const[n,i,s,a]=r;return k4({xmax:s,ymax:a,zmax:0},e,t)}function Gse(r){r.getColumn(0,pp);const e=r.getColumn(1),t=r.getColumn(2);return pp.add(e).add(t).len()}const Cl={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var jc;(function(r){r[r.ADD=1]="ADD",r[r.REPLACE=2]="REPLACE"})(jc||(jc={}));var Ph;(function(r){r.EMPTY="empty",r.SCENEGRAPH="scenegraph",r.POINTCLOUD="pointcloud",r.MESH="mesh"})(Ph||(Ph={}));var tl;(function(r){r.I3S="I3S",r.TILES3D="TILES3D"})(tl||(tl={}));var gp;(function(r){r.GEOMETRIC_ERROR="geometricError",r.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(gp||(gp={}));const qse={USE_OPTIMIZATION:1};function Q4(r){return r!=null}const ua=new Mt,f0=new Mt,Kse=new Mt,Wse=new Mt,zf=new Mt,z4=new Mt,H4=new Mt,V4=new Mt;function lx(r,e,t){if(Ri(r,"3D Tile: boundingVolume must be defined"),r.box)return j4(r.box,e,t);if(r.region)return Zse(r.region);if(r.sphere)return Yse(r.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Xse(r,e){if(r.box)return Jse(e);if(r.region){const[t,n,i,s,a,o]=r.region;return[[Rc(t),Rc(n),a],[Rc(i),Rc(s),o]]}if(r.sphere)return eoe(e);throw new Error("Unkown boundingVolume type")}function j4(r,e,t){const n=new Mt(r[0],r[1],r[2]);e.transform(n,n);let i=[];if(r.length===10){const d=r.slice(3,6),p=new Og;p.fromArray(r,6);const _=new Mt([1,0,0]),w=new Mt([0,1,0]),v=new Mt([0,0,1]);_.transformByQuaternion(p),_.scale(d[0]),w.transformByQuaternion(p),w.scale(d[1]),v.transformByQuaternion(p),v.scale(d[2]),i=[..._.toArray(),...w.toArray(),...v.toArray()]}else i=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const s=e.transformAsVector(i.slice(0,3)),a=e.transformAsVector(i.slice(3,6)),o=e.transformAsVector(i.slice(6,9)),u=new ms([s[0],s[1],s[2],a[0],a[1],a[2],o[0],o[1],o[2]]);return Q4(t)?(t.center=n,t.halfAxes=u,t):new rm(n,u)}function Yse(r,e,t){const n=new Mt(r[0],r[1],r[2]);e.transform(n,n);const i=e.getScale(f0),s=Math.max(Math.max(i[0],i[1]),i[2]),a=r[3]*s;return Q4(t)?(t.center=n,t.radius=a,t):new tm(n,a)}function Zse(r){const[e,t,n,i,s,a]=r,o=Oi.WGS84.cartographicToCartesian([Rc(e),Rc(i),s],Kse),u=Oi.WGS84.cartographicToCartesian([Rc(n),Rc(t),a],Wse),d=new Mt().addVectors(o,u).multiplyByScalar(.5);return Oi.WGS84.cartesianToCartographic(d,zf),Oi.WGS84.cartographicToCartesian([Rc(n),zf[1],zf[2]],z4),Oi.WGS84.cartographicToCartesian([zf[0],Rc(i),zf[2]],H4),Oi.WGS84.cartographicToCartesian([zf[0],zf[1],a],V4),j4([...d,...z4.subtract(d),...H4.subtract(d),...V4.subtract(d)],new kn)}function Jse(r){const e=$4(),{halfAxes:t}=r,n=new Mt(t.getColumn(0)),i=new Mt(t.getColumn(1)),s=new Mt(t.getColumn(2));for(let a=0;a<2;a++){for(let o=0;o<2;o++){for(let u=0;u<2;u++)ua.copy(r.center),ua.add(n),ua.add(i),ua.add(s),G4(e,ua),s.negate();i.negate()}n.negate()}return e}function eoe(r){const e=$4(),{center:t,radius:n}=r,i=Oi.WGS84.scaleToGeodeticSurface(t,ua);let s;i?s=Oi.WGS84.geodeticSurfaceNormal(i):s=new Mt(0,0,1);let a=new Mt(s[2],-s[1],0);a.len()>0?a.normalize():a=new Mt(0,1,0);const o=a.clone().cross(s);for(const u of[a,o,s]){f0.copy(u).scale(n);for(let d=0;d<2;d++)ua.copy(t),ua.add(f0),G4(e,ua),f0.negate()}return e}function $4(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function G4(r,e){Oi.WGS84.cartesianToCartographic(e,ua),r[0][0]=Math.min(r[0][0],ua[0]),r[0][1]=Math.min(r[0][1],ua[1]),r[0][2]=Math.min(r[0][2],ua[2]),r[1][0]=Math.max(r[1][0],ua[0]),r[1][1]=Math.max(r[1][1],ua[1]),r[1][2]=Math.max(r[1][2],ua[2])}new Mt,new Mt,new kn,new Mt,new Mt,new Mt;function toe(r,e){const t=r*e;return 1-Math.exp(-(t*t))}function roe(r,e){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const t=r.dynamicScreenSpaceErrorComputedDensity,n=r.dynamicScreenSpaceErrorFactor;return toe(e,t)*n}return 0}function noe(r,e,t){const n=r.tileset,i=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,s=t?i:r.lodMetricValue;if(s===0)return 0;const a=Math.max(r._distanceToCamera,1e-7),{height:o,sseDenominator:u}=e,{viewDistanceScale:d}=n.options;let p=s*o*(d||1)/(a*u);return p-=roe(n,a),p}const cx=new Mt,q4=new Mt,FA=new Mt,K4=new Mt,ioe=new Mt,ux=new kn,W4=new kn;function soe(r,e){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const t=2*X4(r,e);return t<2?"OUT":!r.header.children||t<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function X4(r,e){const{topDownViewport:t}=e,n=r.header.mbs[1],i=r.header.mbs[0],s=r.header.mbs[2],a=r.header.mbs[3],o=[...r.boundingVolume.center],u=t.unprojectPosition(t.cameraPosition);Oi.WGS84.cartographicToCartesian(u,cx),q4.copy(cx).subtract(o).normalize(),Oi.WGS84.eastNorthUpToFixedFrame(o,ux),W4.copy(ux).invert(),FA.copy(cx).transform(W4);const d=Math.sqrt(FA[0]*FA[0]+FA[1]*FA[1]),p=d*d/FA[2];K4.copy([FA[0],FA[1],p]);const w=K4.transform(ux).subtract(o).normalize(),M=q4.cross(w).normalize().scale(a).add(o),P=Oi.WGS84.cartesianToCartographic(M),D=t.project([i,n,s]),N=t.project(P);return ioe.copy(D).subtract(N).magnitude()}function ooe(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class Y4{constructor(){Y(this,"_map",new Map);Y(this,"_array");Y(this,"_length");let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ri(e<this._array.length),this._array[e]}set(e,t){Ri(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ri(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ri(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const aoe={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class d0{constructor(e){Y(this,"options");Y(this,"root",null);Y(this,"selectedTiles",{});Y(this,"requestedTiles",{});Y(this,"emptyTiles",{});Y(this,"lastUpdate",new Date().getTime());Y(this,"updateDebounceTime",1e3);Y(this,"_traversalStack",new Y4);Y(this,"_emptyTraversalStack",new Y4);Y(this,"_frameNumber",null);this.options={...aoe,...e}}traversalFinished(e){return!0}traverse(e,t,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const s=n.pop();let a=!1;this.canTraverse(s,t)&&(this.updateChildTiles(s,t),a=this.updateAndPushChildren(s,t,n,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const o=s.parent,u=!!(!o||o._shouldRefine),d=!a;s.hasRenderContent?s.refine===jc.ADD?(this.loadTile(s,t),this.selectTile(s,t)):s.refine===jc.REPLACE&&(this.loadTile(s,t),d&&this.selectTile(s,t)):(this.emptyTiles[s.id]=s,this.loadTile(s,t),d&&this.selectTile(s,t)),this.touchTile(s,t),s._shouldRefine=a&&u}const i=new Date().getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const n=e.children;for(const i of n)this.updateTile(i,t)}updateAndPushChildren(e,t,n,i){const{loadSiblings:s,skipLevelOfDetail:a}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));const u=e.refine===jc.REPLACE&&e.hasRenderContent&&!a;let d=!1,p=!0;for(const _ of o)if(_._selectionDepth=i,_.isVisibleAndInRequestVolume?(n.find(_)&&n.delete(_),n.push(_),d=!0):(u||s)&&(this.loadTile(_,t),this.touchTile(_,t)),u){let w;if(_._inRequestVolume?_.hasRenderContent?w=_.contentAvailable:w=this.executeEmptyTraversal(_,t):w=!1,p=p&&w,!p)return!1}return d||(p=!1),p}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=e._screenSpaceError;return n&&(i=e.getScreenSpaceError(t,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===t.viewport.id&&n.push(i);else n.push(t.viewport.id);e.updateVisibility(t,n)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let n=!1;for(const i of e.children)i.updateVisibility(t),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,t){let n=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const s=i.pop(),a=!s.hasRenderContent&&this.canTraverse(s,t),o=!s.hasRenderContent&&s.children.length===0;if(!a&&!s.contentAvailable&&!o&&(n=!1),this.updateTile(s,t),s.isVisibleAndInRequestVolume||(this.loadTile(s,t),this.touchTile(s,t)),a){const u=s.children;for(const d of u)i.push(d)}}return n}}const Z4=new Mt;function loe(r){return r!=null}class hx{constructor(e,t,n){Y(this,"tileset");Y(this,"header");Y(this,"id");Y(this,"url");Y(this,"parent");Y(this,"refine");Y(this,"type");Y(this,"contentUrl");Y(this,"lodMetricType","geometricError");Y(this,"lodMetricValue",0);Y(this,"boundingVolume",null);Y(this,"content",null);Y(this,"contentState",Cl.UNLOADED);Y(this,"gpuMemoryUsageInBytes",0);Y(this,"children",[]);Y(this,"depth",0);Y(this,"viewportIds",[]);Y(this,"transform",new kn);Y(this,"extensions",null);Y(this,"implicitTiling",null);Y(this,"userData",{});Y(this,"computedTransform");Y(this,"hasEmptyContent",!1);Y(this,"hasTilesetContent",!1);Y(this,"traverser",new d0({}));Y(this,"_cacheNode",null);Y(this,"_frameNumber",null);Y(this,"_expireDate",null);Y(this,"_expiredContent",null);Y(this,"_boundingBox",void 0);Y(this,"_distanceToCamera",0);Y(this,"_screenSpaceError",0);Y(this,"_visibilityPlaneMask");Y(this,"_visible",void 0);Y(this,"_contentBoundingVolume");Y(this,"_viewerRequestVolume");Y(this,"_initialTransform",new kn);Y(this,"_priority",0);Y(this,"_selectedFrame",0);Y(this,"_requestedFrame",0);Y(this,"_selectionDepth",0);Y(this,"_touchedFrame",0);Y(this,"_centerZDepth",0);Y(this,"_shouldRefine",!1);Y(this,"_stackLength",0);Y(this,"_visitedFrame",0);Y(this,"_inRequestVolume",!1);Y(this,"_lodJudge",null);let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";this.header=t,this.tileset=e,this.id=i||t.id,this.url=t.url,this.parent=n,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Cl.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Cl.UNLOADED}get contentExpired(){return this.contentState===Cl.EXPIRED}get contentFailed(){return this.contentState===Cl.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Xse(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case tl.I3S:return X4(this,e);case tl.TILES3D:return noe(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,n=this.refine===jc.ADD||t;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Cl.UNLOADED)return-1;const i=this.parent,a=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,o=e.root?e.root._screenSpaceError:0;return Math.max(o-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Cl.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Cl.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await AA(n,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Cl.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Cl.FAILED,n}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Cl.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:Zl.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==Zl.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:n}=e,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const n=this.boundingVolume;return Z4.subVectors(n.center,t.position),t.direction.dot(Z4)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(loe(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Cl.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new kn(e.transform):new kn;const t=this.parent,n=this.tileset,i=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new kn(i).multiplyRight(this.transform);const s=t&&t._initialTransform?t._initialTransform.clone():new kn;this._initialTransform=new kn(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Cl.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Zl.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||jc.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=lx(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=lx(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=lx(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new kn).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return ooe(this.tileset.tileset)}}}class coe extends d0{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const a=e.children[0];this.updateTileVisibility(a,t),e._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const i=e.refine===jc.REPLACE,s=e._optimChildrenWithinParent===qse.USE_OPTIMIZATION;if(i&&s&&n&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:n}=e;return!n||n.hasTilesetContent||n.refine!==jc.ADD?!1:!this.shouldRefine(e,t,!0)}}class uoe{constructor(){Y(this,"frameNumberMap",new Map)}register(e,t){const n=this.frameNumberMap.get(e)||new Map,i=n.get(t)||0;n.set(t,i+1),this.frameNumberMap.set(e,n)}deregister(e,t){const n=this.frameNumberMap.get(e);if(!n)return;const i=n.get(t)||1;n.set(t,i-1)}isZero(e,t){var i;return(((i=this.frameNumberMap.get(e))==null?void 0:i.get(t))||0)===0}}const Ax={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class hoe{constructor(){Y(this,"_statusMap");Y(this,"pendingTilesRegister",new uoe);this._statusMap={}}add(e,t,n,i){if(!this._statusMap[t]){const{frameNumber:s,viewport:{id:a}}=i;this._statusMap[t]={request:e,callback:n,key:t,frameState:i,status:Ax.REQUESTED},this.pendingTilesRegister.register(a,s),e().then(o=>{this._statusMap[t].status=Ax.COMPLETED;const{frameNumber:u,viewport:{id:d}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(d,u),this._statusMap[t].callback(o,i)}).catch(o=>{this._statusMap[t].status=Ax.ERROR;const{frameNumber:u,viewport:{id:d}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(d,u),n(o)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:s,viewport:{id:a}}=t;this.pendingTilesRegister.register(a,s),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class Aoe extends d0{constructor(t){super(t);Y(this,"_tileManager");this._tileManager=new hoe}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,n){return t._lodJudge=soe(t,n),t._lodJudge==="DIG"}updateChildTiles(t,n){const i=t.header.children||[],s=t.children,a=t.tileset;for(const o of i){const u=`${o.id}-${n.viewport.id}`,d=s&&s.find(p=>p.id===u);if(d)d&&this.updateTile(d,n);else{let p=()=>this._loadTile(o.id,a);this._tileManager.find(u)?this._tileManager.update(u,n):(a.tileset.nodePages&&(p=()=>a.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(p,u,w=>this._onTileLoad(w,t,u),n))}}return!1}async _loadTile(t,n){const{loader:i}=n,s=n.getTileUrl(`${n.url}/nodes/${t}`),a={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await AA(s,i,a)}_onTileLoad(t,n,i){const s=new hx(n.tileset,t,n,i);n.children.push(s);const a=this._tileManager.find(s.id).frameState;this.updateTile(s,a),this._frameNumber===a.frameNumber&&(this.traversalFinished(a)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,a)}}const foe={description:"",ellipsoid:Oi.WGS84,modelMatrix:new kn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},p0="Tiles In Tileset(s)",fx="Tiles In Memory",J4="Tiles In View",eR="Tiles To Render",tR="Tiles Loaded",dx="Tiles Loading",rR="Tiles Unloaded",nR="Failed Tile Loads",iR="Points/Vertices",px="Tile Memory Use",sR="Maximum Screen Space Error";class doe{constructor(e,t){Y(this,"options");Y(this,"loadOptions");Y(this,"type");Y(this,"tileset");Y(this,"loader");Y(this,"url");Y(this,"basePath");Y(this,"modelMatrix");Y(this,"ellipsoid");Y(this,"lodMetricType");Y(this,"lodMetricValue");Y(this,"refine");Y(this,"root",null);Y(this,"roots",{});Y(this,"asset",{});Y(this,"description","");Y(this,"properties");Y(this,"extras",null);Y(this,"attributions",{});Y(this,"credits",{});Y(this,"stats");Y(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});Y(this,"cartographicCenter",null);Y(this,"cartesianCenter",null);Y(this,"zoom",1);Y(this,"boundingVolume",null);Y(this,"dynamicScreenSpaceErrorComputedDensity",0);Y(this,"maximumMemoryUsage",32);Y(this,"gpuMemoryUsageInBytes",0);Y(this,"memoryAdjustedScreenSpaceError",0);Y(this,"_cacheBytes",0);Y(this,"_cacheOverflowBytes",0);Y(this,"_frameNumber",0);Y(this,"_queryParams",{});Y(this,"_extensionsUsed",[]);Y(this,"_tiles",{});Y(this,"_pendingCount",0);Y(this,"selectedTiles",[]);Y(this,"traverseCounter",0);Y(this,"geometricError",0);Y(this,"lastUpdatedVieports",null);Y(this,"_requestedTiles",[]);Y(this,"_emptyTiles",[]);Y(this,"frameStateData",{});Y(this,"_traverser");Y(this,"_cache",new Dse);Y(this,"_requestScheduler");Y(this,"updatePromise",null);Y(this,"tilesetInitializationPromise");this.options={...foe,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||wv(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new CV({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Nd({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let n=e;return this.queryParams.length&&(n=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const n=[];for(const i of t){const s=i.id;this._needTraverse(s)?n.push(s):this.traverseCounter--}for(const i of t){const s=i.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!n.includes(s))continue;const a=kse(i,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[t],i=Object.values(this._traverser.selectedTiles),[s,a]=Qse(i,e,this.options.maximumTilesSelected);n.selectedTiles=s;for(const o of a)o.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const n=new Set(e.map(a=>a.id)),i=new Set(t.map(a=>a.id));let s=e.filter(a=>!i.has(a.id)).length>0;return s=s||t.filter(a=>!n.has(a.id)).length>0,s}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?t+=n.content.pointCount:t+=n.content.vertexCount);this.stats.get(J4).count=this.selectedTiles.length,this.stats.get(eR).count=e,this.stats.get(iR).count=t,this.stats.get(sR).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===tl.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===tl.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===tl.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var n;const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:s,ymin:a,ymax:o,zmin:u,zmax:d}=e;this.cartographicCenter=new Mt(i+(s-i)/2,a+(o-a)/2,u+(d-u)/2),this.cartesianCenter=new Mt,Oi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=k4(e,this.cartographicCenter,this.cartesianCenter);return}const t=(n=this.tileset.store)==null?void 0:n.extent;if(t){const[i,s,a,o]=t;this.cartographicCenter=new Mt(i+(a-i)/2,s+(o-s)/2,0),this.cartesianCenter=new Mt,Oi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=$se(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Mt,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Mt,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?(this.cartographicCenter=new Mt,Oi.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new Mt(0,0,-Oi.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=jse(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(p0),this.stats.get(dx),this.stats.get(fx),this.stats.get(J4),this.stats.get(eR),this.stats.get(tR),this.stats.get(rR),this.stats.get(nR),this.stats.get(iR),this.stats.get(px,"memory"),this.stats.get(sR)}_initializeTileHeaders(e,t){var i;const n=new hx(this,e.root,t);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===tl.TILES3D){const s=[];for(s.push(n);s.length>0;){const a=s.pop();this.stats.get(p0).incrementCount();const o=a.header.children||[];for(const u of o){const d=new hx(this,u,a);if((i=d.contentUrl)!=null&&i.includes("?session=")){const _=new URL(d.contentUrl).searchParams.get("session");_&&(this._queryParams.session=_)}a.children.push(d),d.depth=a.depth+1,s.push(d)}}}return n}_initializeTraverser(){let e;switch(this.type){case tl.TILES3D:e=coe;break;case tl.I3S:e=Aoe;break;default:e=d0}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(nR).incrementCount();const n=t.message||t.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${n}`),this.options.onTileError(e,n,i)}_onTileLoad(e,t){var n,i;if(t){if(this.type===tl.I3S){const s=((i=(n=this.tileset)==null?void 0:n.nodePagesTile)==null?void 0:i.nodesInNodePages)||0;this.stats.get(p0).reset(),this.stats.get(p0).addCount(s)}e&&e.content&&Nse(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var t;if(this.type===tl.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===tl.TILES3D){const{extensionsRemoved:n=[]}=((t=e.content)==null?void 0:t.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(dx).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(dx).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(tR).incrementCount(),this.stats.get(fx).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(px).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(fx).decrementCount(),this.stats.get(rR).incrementCount(),this.stats.get(px).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const n of t.children)e.push(n);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,n=[];for(n.push(t);n.length>0;){e=n.pop();for(const i of e.children)n.push(i);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),n=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const oR="4.3.2",lm={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function aR(r,e,t){Ri(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,e,t);return n.decode(i)}function poe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(r);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}const goe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ro={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Xn={...goe,...ro},gx={[ro.DOUBLE]:Float64Array,[ro.FLOAT]:Float32Array,[ro.UNSIGNED_SHORT]:Uint16Array,[ro.UNSIGNED_INT]:Uint32Array,[ro.UNSIGNED_BYTE]:Uint8Array,[ro.BYTE]:Int8Array,[ro.SHORT]:Int16Array,[ro.INT]:Int32Array},moe={DOUBLE:ro.DOUBLE,FLOAT:ro.FLOAT,UNSIGNED_SHORT:ro.UNSIGNED_SHORT,UNSIGNED_INT:ro.UNSIGNED_INT,UNSIGNED_BYTE:ro.UNSIGNED_BYTE,BYTE:ro.BYTE,SHORT:ro.SHORT,INT:ro.INT},mx="Failed to convert GL type";class Ku{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in gx)if(gx[t]===e)return t;throw new Error(mx)}static fromName(e){const t=moe[e];if(!t)throw new Error(mx);return t}static getArrayType(e){switch(e){case ro.UNSIGNED_SHORT_5_6_5:case ro.UNSIGNED_SHORT_4_4_4_4:case ro.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=gx[e];if(!t)throw new Error(mx);return t}}static getByteSize(e){return Ku.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Ku.getArrayType(e)}static createTypedArray(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(t.byteLength-n)/Ku.getByteSize(e));const s=Ku.getArrayType(e);return new s(t,n,i)}}function _oe(r,e){if(!r)throw new Error(`math.gl assertion failed. ${e}`)}function yoe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=r>>11&31,n=r>>5&63,i=r&31;return e[0]=t<<3,e[1]=n<<2,e[2]=i<<3,e}new pw,new Mt,new pw,new pw;function lR(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return Lc(r,0,e)/e*2-1}function cR(r){return r<0?-1:1}function boe(r,e,t,n){if(_oe(n),r<0||r>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(n.x=lR(r,t),n.y=lR(e,t),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*cR(i),n.y=(1-Math.abs(i))*cR(n.y)}return n.normalize()}function voe(r,e,t){return boe(r,e,255,t)}class _x{constructor(e,t){Y(this,"json");Y(this,"buffer");Y(this,"featuresLength",0);Y(this,"_cachedTypedArrays",{});this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xn.UNSIGNED_INT,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,i.byteOffset):i}getPropertyArray(e,t,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=Ku.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,n,i,s){const a=this.json[e];if(!a)return a;const o=this.getPropertyArray(e,t,n);if(n===1)return o[i];for(let u=0;u<n;++u)s[u]=o[n*i+u];return s}_getTypedArrayFromBinary(e,t,n,i,s){const a=this._cachedTypedArrays;let o=a[e];return o||(o=Ku.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+s,i*n),a[e]=o),o}_getTypedArrayFromArray(e,t,n){const i=this._cachedTypedArrays;let s=i[e];return s||(s=Ku.createTypedArray(t,n),i[e]=s),s}}const woe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xoe={SCALAR:(r,e)=>r[e],VEC2:(r,e)=>[r[2*e+0],r[2*e+1]],VEC3:(r,e)=>[r[3*e+0],r[3*e+1],r[3*e+2]],VEC4:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT2:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT3:(r,e)=>[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]],MAT4:(r,e)=>[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]},Boe={SCALAR:(r,e,t)=>{e[t]=r},VEC2:(r,e,t)=>{e[2*t+0]=r[0],e[2*t+1]=r[1]},VEC3:(r,e,t)=>{e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},VEC4:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT2:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT3:(r,e,t)=>{e[9*t+0]=r[0],e[9*t+1]=r[1],e[9*t+2]=r[2],e[9*t+3]=r[3],e[9*t+4]=r[4],e[9*t+5]=r[5],e[9*t+6]=r[6],e[9*t+7]=r[7],e[9*t+8]=r[8],e[9*t+9]=r[9]},MAT4:(r,e,t)=>{e[16*t+0]=r[0],e[16*t+1]=r[1],e[16*t+2]=r[2],e[16*t+3]=r[3],e[16*t+4]=r[4],e[16*t+5]=r[5],e[16*t+6]=r[6],e[16*t+7]=r[7],e[16*t+8]=r[8],e[16*t+9]=r[9],e[16*t+10]=r[10],e[16*t+11]=r[11],e[16*t+12]=r[12],e[16*t+13]=r[13],e[16*t+14]=r[14],e[16*t+15]=r[15]}};function Coe(r,e,t,n){const{componentType:i}=r;Ri(r.componentType);const s=typeof i=="string"?Ku.fromName(i):i,a=woe[r.type],o=xoe[r.type],u=Boe[r.type];return t+=r.byteOffset,{values:Ku.createTypedArray(s,e,t,a*n),type:s,size:a,unpacker:o,packer:u}}const Wu=r=>r!==void 0;function Toe(r,e,t){if(!e)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?Eoe(n,t):null}function Eoe(r,e){let t,n,i;const s=r.instancesLength,a=r.classes;let o=r.classIds,u=r.parentCounts,d=r.parentIds,p=s;Wu(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,i=getBinaryAccessor(o),o=i.createArrayBufferView(e.buffer,e.byteOffset+o.byteOffset,s));let _;if(Wu(u))for(Wu(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,s)),_=new Uint16Array(s),p=0,t=0;t<s;++t)_[t]=p,p+=u[t];Wu(d)&&Wu(d.byteOffset)&&(d.componentType=defaultValue(d.componentType,GL.UNSIGNED_SHORT),d.type=AttributeType.SCALAR,i=getBinaryAccessor(d),d=i.createArrayBufferView(e.buffer,e.byteOffset+d.byteOffset,p));const w=a.length;for(t=0;t<w;++t){const D=a[t].length,N=a[t].instances,z=getBinaryProperties(D,N,e);a[t].instances=combine(z,N)}const v=new Array(w).fill(0),M=new Uint16Array(s);for(t=0;t<s;++t)n=o[t],M[t]=v[n],++v[n];const P={classes:a,classIds:o,classIndexes:M,parentCounts:u,parentIndexes:_,parentIds:d};return Moe(P),P}function cm(r,e,t){if(!r)return;const n=r.parentCounts;return r.parentIds?t(r,e):n>0?Soe(r,e,t):Ioe(r,e,t)}function Soe(r,e,t){const n=r.classIds,i=r.parentCounts,s=r.parentIds,a=r.parentIndexes,o=n.length,u=scratchVisited;u.length=Math.max(u.length,o);const d=++marker,p=scratchStack;for(p.length=0,p.push(e);p.length>0;){if(e=p.pop(),u[e]===d)continue;u[e]=d;const _=t(r,e);if(Wu(_))return _;const w=i[e],v=a[e];for(let M=0;M<w;++M){const P=s[v+M];P!==e&&p.push(P)}}return null}function Ioe(r,e,t){let n=!0;for(;n;){const i=t(r,e);if(Wu(i))return i;const s=r.parentIds[e];n=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function Moe(r){const t=r.classIds.length;for(let n=0;n<t;++n)uR(r,n,stack)}function uR(r,e,t){const n=r.parentCounts,i=r.parentIds,s=r.parentIndexes,o=r.classIds.length;if(!Wu(i))return;assert(e<o,`Parent index ${e} exceeds the total number of instances: ${o}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const u=Wu(n)?n[e]:1,d=Wu(n)?s[e]:e;for(let p=0;p<u;++p){const _=i[d+p];_!==e&&uR(r,_,t)}t.pop(e)}function rl(r){return r!=null}const g0=(r,e)=>r,Poe={HIERARCHY:!0,extensions:!0,extras:!0};class hR{constructor(e,t,n){Y(this,"json");Y(this,"binary");Y(this,"featureCount");Y(this,"_extensions");Y(this,"_properties");Y(this,"_binaryProperties");Y(this,"_hierarchy");var s;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};Ri(n>=0),this.json=e||{},this.binary=t,this.featureCount=n,this._extensions=((s=this.json)==null?void 0:s.extensions)||{},this._properties={};for(const a in this.json)Poe[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Toe(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Ri(typeof t=="string",t),this._hierarchy){const n=cm(this._hierarchy,e,(i,s)=>{const a=i.classIds[s];return i.classes[a].name===t});return rl(n)}return!1}isExactClass(e,t){return Ri(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Ri(typeof t=="string",t),rl(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=rl(t)?t:[],t.length=0;const n=Object.keys(this._properties);return t.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Ri(typeof t=="string",t),this._binaryProperties){const i=this._binaryProperties[t];if(rl(i))return this._getBinaryProperty(i,e)}const n=this._properties[t];if(rl(n))return g0(n[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(rl(i))return i}}setProperty(e,t,n){const i=this.featureCount;if(this._checkBatchId(e),Ri(typeof t=="string",t),this._binaryProperties){const a=this._binaryProperties[t];if(a){this._setBinaryProperty(a,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,n))return;let s=this._properties[t];rl(s)||(this._properties[t]=new Array(i),s=this._properties[t]),s[e]=g0(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,n){e.pack(n,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const n=this._properties[t],i=this._initializeBinaryProperty(t,n);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const n=t;Ri(this.binary,`Property ${e} requires a batch table binary.`),Ri(n.type,`Property ${e} requires a type.`);const i=Coe(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const n=cm(this._hierarchy,e,(i,s)=>{const a=i.classIds[s],o=i.classes[a].instances;return rl(o[t])});return rl(n)}_getPropertyNamesInHierarchy(e,t){cm(this._hierarchy,e,(n,i)=>{const s=n.classIds[i],a=n.classes[s].instances;for(const o in a)a.hasOwnProperty(o)&&t.indexOf(o)===-1&&t.push(o)})}_getHierarchyProperty(e,t){return cm(this._hierarchy,e,(n,i)=>{const s=n.classIds[i],a=n.classes[s],o=n.classIndexes[i],u=a.instances[t];return rl(u)?rl(u.typedArray)?this._getBinaryProperty(u,o):g0(u[o]):null})}_setHierarchyProperty(e,t,n,i){const s=cm(this._hierarchy,t,(a,o)=>{const u=a.classIds[o],d=a.classes[u],p=a.classIndexes[o],_=d.instances[n];return rl(_)?(Ri(o===t,`Inherited property "${n}" is read-only.`),rl(_.typedArray)?this._setBinaryProperty(_,p,i):_[p]=g0(i),!0):!1});return rl(s)}}const yx=4;function m0(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(e);if(r.magic=n.getUint32(t,!0),t+=yx,r.version=n.getUint32(t,!0),t+=yx,r.byteLength=n.getUint32(t,!0),t+=yx,r.version!==1)throw new Error(`3D Tile Version ${r.version} not supported`);return t}const mp=4,AR="b3dm tile in legacy format.";function bx(r,e,t){const n=new DataView(e);let i;r.header=r.header||{};let s=n.getUint32(t,!0);t+=mp;let a=n.getUint32(t,!0);t+=mp;let o=n.getUint32(t,!0);t+=mp;let u=n.getUint32(t,!0);return t+=mp,o>=570425344?(t-=mp*2,i=s,o=a,u=0,s=0,a=0,console.warn(AR)):u>=570425344&&(t-=mp,i=o,o=s,u=a,s=0,a=0,console.warn(AR)),r.header.featureTableJsonByteLength=s,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=o,r.header.batchTableBinaryByteLength=u,r.header.batchLength=i,t}function vx(r,e,t,n){return t=Foe(r,e,t),t=Roe(r,e,t),t}function Foe(r,e,t,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:a}=r.header||{};if(r.featureTableJson={BATCH_LENGTH:a||0},i&&i>0){const o=aR(e,t,i);r.featureTableJson=JSON.parse(o)}return t+=i||0,r.featureTableBinary=new Uint8Array(e,t,s),t+=s||0,t}function Roe(r,e,t,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=r.header||{};if(i&&i>0){const a=aR(e,t,i);r.batchTableJson=JSON.parse(a),t+=i,s&&s>0&&(r.batchTableBinary=new Uint8Array(e,t,s),r.batchTableBinary=new Uint8Array(r.batchTableBinary),t+=s)}return t}function fR(r,e,t){if(!e&&(!r||!r.batchIds||!t))return null;const{batchIds:n,isRGB565:i,pointCount:s=0}=r;if(n&&t){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const u=n[o],p=t.getProperty(u,"dimensions").map(_=>_*255);a[o*3]=p[0],a[o*3+1]=p[1],a[o*3+2]=p[2]}return{type:Xn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(e&&i){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const u=yoe(e[o]);a[o*3]=u[0],a[o*3+1]=u[1],a[o*3+2]=u[2]}return{type:Xn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return e&&e.length===s*3?{type:Xn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Xn.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const dR=new Mt;function Loe(r,e){if(!e)return null;if(r.isOctEncoded16P){const t=new Float32Array((r.pointsLength||0)*3);for(let n=0;n<(r.pointsLength||0);n++)voe(e[n*2],e[n*2+1],dR),dR.toArray(t,n*3);return{type:Xn.FLOAT,size:2,value:t}}return{type:Xn.FLOAT,size:2,value:e}}function Ooe(r,e,t){return r.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,Uoe(r,e)):{type:Xn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Uoe(r,e){const t=new Mt,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)t.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function Doe(r,e,t,n,i){t=m0(r,e,t),t=bx(r,e,t),t=vx(r,e,t),Noe(r);const{featureTable:s,batchTable:a}=koe(r);return await joe(r,s,a,n,i),Qoe(r,s,n),zoe(r,s,a),Hoe(r,s),t}function Noe(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function koe(r){const e=new _x(r.featureTableJson,r.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,r.featuresLength=t,r.pointsLength=t,r.pointCount=t,r.rtcCenter=e.getGlobalProperty("RTC_CENTER",Xn.FLOAT,3);const n=Voe(r,e);return{featureTable:e,batchTable:n}}function Qoe(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.positions){if(e.hasProperty("POSITION"))r.attributes.positions=e.getPropertyArray("POSITION",Xn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",Xn.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Xn.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Xn.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=Ooe(r,n,t)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function zoe(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",Xn.UNSIGNED_BYTE,4),r.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",Xn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",Xn.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=fR(r,n,t)}e.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Xn.UNSIGNED_BYTE,4))}function Hoe(r,e){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Xn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Xn.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=Loe(r,t)}}function Voe(r,e){let t=null;if(!r.batchIds&&e.hasProperty("BATCH_ID")&&(r.batchIds=e.getPropertyArray("BATCH_ID",Xn.UNSIGNED_SHORT,1),r.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=r;t=new hR(i,s,n)}return t}async function joe(r,e,t,n,i){let s,a,o;const u=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];u&&(o=u.properties);const d=e.getExtension("3DTILES_draco_point_compression");if(d){a=d.properties;const _=d.byteOffset,w=d.byteLength;if(!a||!Number.isFinite(_)||!w)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(r.featureTableBinary||[]).slice(_,_+w),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;const p={buffer:s,properties:{...a,...o},batchTableProperties:o};return await $oe(r,p,n,i)}async function $oe(r,e,t,n){if(!n)return;const i={...t,draco:{...t==null?void 0:t.draco,extraAttributes:e.batchTableProperties||{}}};delete i["3d-tiles"];const s=await vg(e.buffer,B4,i,n),a=s.attributes.POSITION&&s.attributes.POSITION.value,o=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,u=s.attributes.NORMAL&&s.attributes.NORMAL.value,d=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,p=a&&s.attributes.POSITION.value.quantization,_=u&&s.attributes.NORMAL.value.quantization;if(p){const v=s.POSITION.data.quantization,M=v.range;r.quantizedVolumeScale=new Mt(M,M,M),r.quantizedVolumeOffset=new Mt(v.minValues),r.quantizedRange=(1<<v.quantizationBits)-1,r.isQuantizedDraco=!0}_&&(r.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const w={};if(e.batchTableProperties)for(const v of Object.keys(e.batchTableProperties))s.attributes[v]&&s.attributes[v].value&&(w[v.toLowerCase()]=s.attributes[v].value);r.attributes={positions:a,colors:fR(r,o,void 0),normals:u,batchIds:d,...w}}const wx={URI:0,EMBEDDED:1};function pR(r,e,t,n){r.rotateYtoZ=!0;const i=(r.byteOffset||0)+(r.byteLength||0)-t;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n!=null&&n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=vv(e,t,i),r.gltfByteOffset=0,r.gltfByteLength=i,t%4===0||console.warn(`${r.type}: embedded glb is not aligned to a 4-byte boundary.`),(r.byteOffset||0)+(r.byteLength||0)}async function gR(r,e,t,n){const i=(t==null?void 0:t["3d-tiles"])||{};if(Goe(r,e),i.loadGLTF){if(!n)return;if(r.gltfUrl){const{fetch:s}=n,a=await s(r.gltfUrl,t);r.gltfArrayBuffer=await a.arrayBuffer(),r.gltfByteOffset=0}if(r.gltfArrayBuffer){const s=await vg(r.gltfArrayBuffer,om,t,n);r.gltf=tx(s),r.gpuMemoryUsageInBytes=u4(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength}}}function Goe(r,e,t){switch(e){case wx.URI:if(r.gltfArrayBuffer){const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),s=new TextDecoder().decode(n);r.gltfUrl=s.replace(/[\s\0]+$/,"")}delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case wx.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function qoe(r,e,t,n,i){var a;t=Koe(r,e,t,n),await gR(r,wx.EMBEDDED,n,i);const s=(a=r==null?void 0:r.gltf)==null?void 0:a.extensions;return s&&s.CESIUM_RTC&&(r.rtcCenter=s.CESIUM_RTC.center),t}function Koe(r,e,t,n,i){t=m0(r,e,t),t=bx(r,e,t),t=vx(r,e,t),t=pR(r,e,t,n);const s=new _x(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=s.getGlobalProperty("RTC_CENTER",Xn.FLOAT,3),t}async function Woe(r,e,t,n,i){return t=Xoe(r,e,t,n),await gR(r,r.gltfFormat||0,n,i),t}function Xoe(r,e,t,n,i){var d;if(t=m0(r,e,t),r.version!==1)throw new Error(`Instanced 3D Model version ${r.version} is not supported`);t=bx(r,e,t);const s=new DataView(e);if(r.gltfFormat=s.getUint32(t,!0),t+=4,t=vx(r,e,t),t=pR(r,e,t,n),!((d=r==null?void 0:r.header)!=null&&d.featureTableJsonByteLength)||r.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new _x(r.featureTableJson,r.featureTableBinary),o=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",Xn.FLOAT,3);const u=new hR(r.batchTableJson,r.batchTableBinary,o);return Yoe(r,a,u,o),t}function Yoe(r,e,t,n){const i=new Array(n),s=new Mt;new Mt,new Mt,new Mt;const a=new ms,o=new Og,u=new Mt,d={},p=new kn,_=[],w=[],v=[],M=[];for(let P=0;P<n;P++){let D;if(e.hasProperty("POSITION"))D=e.getProperty("POSITION",Xn.FLOAT,3,P,s);else if(e.hasProperty("POSITION_QUANTIZED")){D=e.getProperty("POSITION_QUANTIZED",Xn.UNSIGNED_SHORT,3,P,s);const q=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Xn.FLOAT,3);if(!q)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const te=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Xn.FLOAT,3);if(!te)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const J=65535;for(let me=0;me<3;me++)D[me]=D[me]/J*te[me]+q[me]}if(!D)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(D),d.translation=s,r.normalUp=e.getProperty("NORMAL_UP",Xn.FLOAT,3,P,_),r.normalRight=e.getProperty("NORMAL_RIGHT",Xn.FLOAT,3,P,w),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Xn.UNSIGNED_SHORT,2,P,_),r.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Xn.UNSIGNED_SHORT,2,P,w),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(Oi.WGS84.eastNorthUpToFixedFrame(s,p),p.getRotationMatrix3(a)):a.identity()}o.fromMatrix3(a),d.rotation=o,u.set(1,1,1);const N=e.getProperty("SCALE",Xn.FLOAT,1,P,v);Number.isFinite(N)&&u.multiplyByScalar(N);const z=e.getProperty("SCALE_NON_UNIFORM",Xn.FLOAT,3,P,_);z&&u.scale(z),d.scale=u;let W=e.getProperty("BATCH_ID",Xn.UNSIGNED_SHORT,1,P,M);W===void 0&&(W=P);const V=new kn().fromQuaternion(d.rotation);p.identity(),p.translate(d.translation),p.multiplyRight(V),p.scale(d.scale);const $=p.clone();i[P]={modelMatrix:$,batchId:W}}r.instances=i}async function Zoe(r,e,t,n,i,s){t=m0(r,e,t);const a=new DataView(e);for(r.tilesLength=a.getUint32(t,!0),t+=4,r.tiles=[];r.tiles.length<r.tilesLength&&(r.byteLength||0)-t>12;){const o={shape:"tile3d"};r.tiles.push(o),t=await s(e,t,n,i,o)}return t}async function Joe(r,e,t,n){var i,s;if(r.rotateYtoZ=!0,r.gltfUpAxis=(i=t==null?void 0:t["3d-tiles"])!=null&&i.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",(s=t==null?void 0:t["3d-tiles"])!=null&&s.loadGLTF){if(!n)return e.byteLength;const a=await vg(e,om,t,n);r.gltf=tx(a),r.gpuMemoryUsageInBytes=u4(r.gltf)}else r.gltfArrayBuffer=e;return e.byteLength}async function mR(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{shape:"tile3d"};switch(i.byteOffset=e,i.type=poe(r,e),i.type){case lm.COMPOSITE:return await Zoe(i,r,e,t,n,mR);case lm.BATCHED_3D_MODEL:return await qoe(i,r,e,t,n);case lm.GLTF:return await Joe(i,r,t,n);case lm.INSTANCED_3D_MODEL:return await Woe(i,r,e,t,n);case lm.POINT_CLOUD:return await Doe(i,r,e,t,n);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}const eae=1952609651,tae=1;async function rae(r,e,t){if(new Uint32Array(r.slice(0,4))[0]!==eae)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==tae)throw new Error("Wrong subtree file verson, must be 1");const s=_R(r.slice(8,16)),a=new Uint8Array(r,24,s),u=new TextDecoder("utf8").decode(a),d=JSON.parse(u),p=_R(r.slice(16,24));let _=new ArrayBuffer(0);if(p&&(_=r.slice(24+s)),await _0(d,d.tileAvailability,_,t),Array.isArray(d.contentAvailability))for(const w of d.contentAvailability)await _0(d,w,_,t);else await _0(d,d.contentAvailability,_,t);return await _0(d,d.childSubtreeAvailability,_,t),d}async function _0(r,e,t,n){const i=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof i!="number")return;const s=r.bufferViews[i],a=r.buffers[s.buffer];if(!(n!=null&&n.baseUrl))throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(a.uri){const u=`${(n==null?void 0:n.baseUrl)||""}/${a.uri}`,p=await(await n.fetch(u)).arrayBuffer();e.explicitBitstream=new Uint8Array(p,s.byteOffset,s.byteLength);return}const o=r.buffers.slice(0,s.buffer).reduce((u,d)=>u+d.byteLength,0);e.explicitBitstream=new Uint8Array(t.slice(o,o+a.byteLength),s.byteOffset,s.byteLength)}function _R(r){const e=new DataView(r),t=e.getUint32(0,!0),n=e.getUint32(4,!0);return t+2**32*n}const yR={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:oR,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:rae,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var ec=null;try{ec=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function _i(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}_i.prototype.__isLong__,Object.defineProperty(_i.prototype,"__isLong__",{value:!0});function ha(r){return(r&&r.__isLong__)===!0}function bR(r){var e=Math.clz32(r&-r);return r?31-e:e}_i.isLong=ha;var vR={},wR={};function Hf(r,e){var t,n,i;return e?(r>>>=0,(i=0<=r&&r<256)&&(n=wR[r],n)?n:(t=ti(r,0,!0),i&&(wR[r]=t),t)):(r|=0,(i=-128<=r&&r<128)&&(n=vR[r],n)?n:(t=ti(r,r<0?-1:0,!1),i&&(vR[r]=t),t))}_i.fromInt=Hf;function tc(r,e){if(isNaN(r))return e?Fh:Gc;if(e){if(r<0)return Fh;if(r>=BR)return SR}else{if(r<=-9223372036854776e3)return nl;if(r+1>=iae)return ER}return r<0?tc(-r,e).neg():ti(r%_p|0,r/_p|0,e)}_i.fromNumber=tc;function ti(r,e,t){return new _i(r,e,t)}_i.fromBits=ti;var y0=Math.pow;function xx(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?Fh:Gc;if(t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return xx(r.substring(1),e,t).neg();for(var i=tc(y0(t,8)),s=Gc,a=0;a<r.length;a+=8){var o=Math.min(8,r.length-a),u=parseInt(r.substring(a,a+o),t);if(o<8){var d=tc(y0(t,o));s=s.mul(d).add(tc(u))}else s=s.mul(i),s=s.add(tc(u))}return s.unsigned=e,s}_i.fromString=xx;function $c(r,e){return typeof r=="number"?tc(r,e):typeof r=="string"?xx(r,e):ti(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}_i.fromValue=$c;var xR=65536,nae=1<<24,_p=xR*xR,BR=_p*_p,iae=BR/2,CR=Hf(nae),Gc=Hf(0);_i.ZERO=Gc;var Fh=Hf(0,!0);_i.UZERO=Fh;var yp=Hf(1);_i.ONE=yp;var TR=Hf(1,!0);_i.UONE=TR;var Bx=Hf(-1);_i.NEG_ONE=Bx;var ER=ti(-1,2147483647,!1);_i.MAX_VALUE=ER;var SR=ti(-1,-1,!0);_i.MAX_UNSIGNED_VALUE=SR;var nl=ti(0,-2147483648,!1);_i.MIN_VALUE=nl;var Tr=_i.prototype;Tr.toInt=function(){return this.unsigned?this.low>>>0:this.low},Tr.toNumber=function(){return this.unsigned?(this.high>>>0)*_p+(this.low>>>0):this.high*_p+(this.low>>>0)},Tr.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(nl)){var t=tc(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=tc(y0(e,6),this.unsigned),a=this,o="";;){var u=a.div(s),d=a.sub(u.mul(s)).toInt()>>>0,p=d.toString(e);if(a=u,a.isZero())return p+o;for(;p.length<6;)p="0"+p;o=""+p+o}},Tr.getHighBits=function(){return this.high},Tr.getHighBitsUnsigned=function(){return this.high>>>0},Tr.getLowBits=function(){return this.low},Tr.getLowBitsUnsigned=function(){return this.low>>>0},Tr.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nl)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1},Tr.isZero=function(){return this.high===0&&this.low===0},Tr.eqz=Tr.isZero,Tr.isNegative=function(){return!this.unsigned&&this.high<0},Tr.isPositive=function(){return this.unsigned||this.high>=0},Tr.isOdd=function(){return(this.low&1)===1},Tr.isEven=function(){return(this.low&1)===0},Tr.equals=function(e){return ha(e)||(e=$c(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},Tr.eq=Tr.equals,Tr.notEquals=function(e){return!this.eq(e)},Tr.neq=Tr.notEquals,Tr.ne=Tr.notEquals,Tr.lessThan=function(e){return this.comp(e)<0},Tr.lt=Tr.lessThan,Tr.lessThanOrEqual=function(e){return this.comp(e)<=0},Tr.lte=Tr.lessThanOrEqual,Tr.le=Tr.lessThanOrEqual,Tr.greaterThan=function(e){return this.comp(e)>0},Tr.gt=Tr.greaterThan,Tr.greaterThanOrEqual=function(e){return this.comp(e)>=0},Tr.gte=Tr.greaterThanOrEqual,Tr.ge=Tr.greaterThanOrEqual,Tr.compare=function(e){if(ha(e)||(e=$c(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Tr.comp=Tr.compare,Tr.negate=function(){return!this.unsigned&&this.eq(nl)?nl:this.not().add(yp)},Tr.neg=Tr.negate,Tr.add=function(e){ha(e)||(e=$c(e));var t=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,a=e.high>>>16,o=e.high&65535,u=e.low>>>16,d=e.low&65535,p=0,_=0,w=0,v=0;return v+=s+d,w+=v>>>16,v&=65535,w+=i+u,_+=w>>>16,w&=65535,_+=n+o,p+=_>>>16,_&=65535,p+=t+a,p&=65535,ti(w<<16|v,p<<16|_,this.unsigned)},Tr.subtract=function(e){return ha(e)||(e=$c(e)),this.add(e.neg())},Tr.sub=Tr.subtract,Tr.multiply=function(e){if(this.isZero())return this;if(ha(e)||(e=$c(e)),ec){var t=ec.mul(this.low,this.high,e.low,e.high);return ti(t,ec.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Fh:Gc;if(this.eq(nl))return e.isOdd()?nl:Gc;if(e.eq(nl))return this.isOdd()?nl:Gc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(CR)&&e.lt(CR))return tc(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,a=this.low&65535,o=e.high>>>16,u=e.high&65535,d=e.low>>>16,p=e.low&65535,_=0,w=0,v=0,M=0;return M+=a*p,v+=M>>>16,M&=65535,v+=s*p,w+=v>>>16,v&=65535,v+=a*d,w+=v>>>16,v&=65535,w+=i*p,_+=w>>>16,w&=65535,w+=s*d,_+=w>>>16,w&=65535,w+=a*u,_+=w>>>16,w&=65535,_+=n*p+i*d+s*u+a*o,_&=65535,ti(v<<16|M,_<<16|w,this.unsigned)},Tr.mul=Tr.multiply,Tr.divide=function(e){if(ha(e)||(e=$c(e)),e.isZero())throw Error("division by zero");if(ec){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?ec.div_u:ec.div_s)(this.low,this.high,e.low,e.high);return ti(t,ec.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Fh:Gc;var n,i,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Fh;if(e.gt(this.shru(1)))return TR;s=Fh}else{if(this.eq(nl)){if(e.eq(yp)||e.eq(Bx))return nl;if(e.eq(nl))return yp;var a=this.shr(1);return n=a.div(e).shl(1),n.eq(Gc)?e.isNegative()?yp:Bx:(i=this.sub(e.mul(n)),s=n.add(i.div(e)),s)}else if(e.eq(nl))return this.unsigned?Fh:Gc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=Gc}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),u=o<=48?1:y0(2,o-48),d=tc(n),p=d.mul(e);p.isNegative()||p.gt(i);)n-=u,d=tc(n,this.unsigned),p=d.mul(e);d.isZero()&&(d=yp),s=s.add(d),i=i.sub(p)}return s},Tr.div=Tr.divide,Tr.modulo=function(e){if(ha(e)||(e=$c(e)),ec){var t=(this.unsigned?ec.rem_u:ec.rem_s)(this.low,this.high,e.low,e.high);return ti(t,ec.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},Tr.mod=Tr.modulo,Tr.rem=Tr.modulo,Tr.not=function(){return ti(~this.low,~this.high,this.unsigned)},Tr.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Tr.clz=Tr.countLeadingZeros,Tr.countTrailingZeros=function(){return this.low?bR(this.low):bR(this.high)+32},Tr.ctz=Tr.countTrailingZeros,Tr.and=function(e){return ha(e)||(e=$c(e)),ti(this.low&e.low,this.high&e.high,this.unsigned)},Tr.or=function(e){return ha(e)||(e=$c(e)),ti(this.low|e.low,this.high|e.high,this.unsigned)},Tr.xor=function(e){return ha(e)||(e=$c(e)),ti(this.low^e.low,this.high^e.high,this.unsigned)},Tr.shiftLeft=function(e){return ha(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ti(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ti(0,this.low<<e-32,this.unsigned)},Tr.shl=Tr.shiftLeft,Tr.shiftRight=function(e){return ha(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ti(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ti(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Tr.shr=Tr.shiftRight,Tr.shiftRightUnsigned=function(e){return ha(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ti(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?ti(this.high,0,this.unsigned):ti(this.high>>>e-32,0,this.unsigned)},Tr.shru=Tr.shiftRightUnsigned,Tr.shr_u=Tr.shiftRightUnsigned,Tr.rotateLeft=function(e){var t;return ha(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ti(this.high,this.low,this.unsigned):e<32?(t=32-e,ti(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,ti(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},Tr.rotl=Tr.rotateLeft,Tr.rotateRight=function(e){var t;return ha(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ti(this.high,this.low,this.unsigned):e<32?(t=32-e,ti(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,ti(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},Tr.rotr=Tr.rotateRight,Tr.toSigned=function(){return this.unsigned?ti(this.low,this.high,!1):this},Tr.toUnsigned=function(){return this.unsigned?this:ti(this.low,this.high,!0)},Tr.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Tr.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},Tr.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},_i.fromBytes=function(e,t,n){return n?_i.fromBytesLE(e,t):_i.fromBytesBE(e,t)},_i.fromBytesLE=function(e,t){return new _i(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},_i.fromBytesBE=function(e,t){return new _i(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const sae=16;function IR(r){r==="X"&&(r="");const e=r.padEnd(sae,"0");return _i.fromString(e,!0,16)}function oae(r){if(r.isZero())return"X";let e=r.countTrailingZeros();const t=e%4;e=(e-t)/4;const n=e;e*=4;const s=r.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-s.length).join("0")+s}function aae(r,e){const t=lae(r).shiftRightUnsigned(2);return r.add(_i.fromNumber(2*e+1-4).multiply(t))}function lae(r){return r.and(r.not().add(1))}const cae=3,uae=2*30+1,MR=180/Math.PI;function hae(r){if(r.length===0)throw new Error(`Invalid Hilbert quad key ${r}`);const e=r.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length;let s=0;const a=[0,0];for(let o=i-1;o>=0;o--){s=i-o;const u=n[o];let d=0,p=0;u==="1"?p=1:u==="2"?(d=1,p=1):u==="3"&&(d=1);const _=Math.pow(2,s-1);fae(_,a,d,p),a[0]+=_*d,a[1]+=_*p}if(t%2===1){const o=a[0];a[0]=a[1],a[1]=o}return{face:t,ij:a,level:s}}function Aae(r){if(r.isZero())return"";let e=r.toString(2);for(;e.length<cae+uae;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),s=i.length/2,a=_i.fromString(n,!0,2).toString(10);let o="";if(s!==0)for(o=_i.fromString(i,!0,2).toString(4);o.length<s;)o="0"+o;return`${a}/${o}`}function PR(r,e,t){const n=1<<e;return[(r[0]+t[0])/n,(r[1]+t[1])/n]}function FR(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function RR(r){return[FR(r[0]),FR(r[1])]}function LR(r,e){let[t,n]=e;switch(r){case 0:return[1,t,n];case 1:return[-t,1,n];case 2:return[-t,-n,1];case 3:return[-1,-n,-t];case 4:return[n,-1,-t];case 5:return[n,t,-1];default:throw new Error("Invalid face")}}function OR(r){let[e,t,n]=r;const i=Math.atan2(n,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*MR,i*MR]}function fae(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function dae(r){const e=PR(r.ij,r.level,[.5,.5]),t=RR(e),n=LR(r.face,t);return OR(n)}const pae=100;function UR(r){const{face:e,ij:t,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(pae*Math.pow(2,-n))),a=new Float64Array(4*s*2+2);let o=0,u=0;for(let d=0;d<4;d++){const p=i[d].slice(0),_=i[d+1],w=(_[0]-p[0])/s,v=(_[1]-p[1])/s;for(let M=0;M<s;M++){p[0]+=w,p[1]+=v;const P=PR(t,n,p),D=RR(P),N=LR(e,D),z=OR(N);Math.abs(z[1])>89.999&&(z[0]=u);const W=z[0]-u;z[0]+=W>180?-360:W<-180?360:0,a[o++]=z[0],a[o++]=z[1],u=z[0]}}return a[o++]=a[0],a[o++]=a[1],a}function Cx(r){const e=gae(r);return hae(e)}function gae(r){if(r.indexOf("/")>0)return r;const e=IR(r);return Aae(e)}function mae(r){const e=Cx(r);return dae(e)}function _ae(r){let e;if(r.face===2||r.face===5){let t=null,n=0;for(let i=0;i<4;i++){const s=`${r.face}/${i}`,a=Cx(s),o=UR(a);(typeof t>"u"||t===null)&&(t=new Float64Array(4*o.length)),t.set(o,n),n+=o.length}e=DR(t)}else{const t=UR(r);e=DR(t)}return e}function DR(r){if(r.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let n=0;n<r.length;n+=2)e.push(r[n]),t.push(r[n+1]);return e.sort((n,i)=>n-i),t.sort((n,i)=>n-i),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function yae(r,e){const t=(e==null?void 0:e.minimumHeight)||0,n=(e==null?void 0:e.maximumHeight)||0,i=Cx(r),s=_ae(i),a=s.west,o=s.south,u=s.east,d=s.north,p=[];return p.push(new Mt(a,d,t)),p.push(new Mt(u,d,t)),p.push(new Mt(u,o,t)),p.push(new Mt(a,o,t)),p.push(new Mt(a,d,n)),p.push(new Mt(u,d,n)),p.push(new Mt(u,o,n)),p.push(new Mt(a,o,n)),p}function NR(r){const e=r.token,t={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=yae(e,t),i=mae(e),s=i[0],a=i[1],o=Oi.WGS84.cartographicToCartesian([s,a,t.maximumHeight]),u=new Mt(o[0],o[1],o[2]);n.push(u);const d=Ate(n);return[...d.center,...d.halfAxes]}const bae={QUADTREE:4,OCTREE:8};function vae(r,e,t){if(r!=null&&r.box){const n=IR(r.s2VolumeInfo.token),i=aae(n,e),s=oae(i),a={...r.s2VolumeInfo};switch(a.token=s,t){case"OCTREE":const d=r.s2VolumeInfo,p=d.maximumHeight-d.minimumHeight,_=p/2,w=d.minimumHeight+p/2;d.minimumHeight=w-_,d.maximumHeight=w+_;break}return{box:NR(a),s2VolumeInfo:a}}}async function kR(r){const{subtree:e,subtreeData:t={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:i=0,implicitOptions:s,loaderOptions:a,s2VolumeBox:o}=r,{subdivisionScheme:u,subtreeLevels:d,maximumLevel:p,contentUrlTemplate:_,subtreesUriTemplate:w,basePath:v}=s,M={children:[],lodMetricValue:0,contentUrl:""};if(!p)return YS.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${_} won't be loaded...`),M;const P=n.localLevel+1,D=t.level+P;if(D>p)return M;const N=bae[u],z=Math.log2(N),W=i&1,V=i>>1&1,$=i>>2&1,q=Vf(n.localX,W,1),te=Vf(n.localY,V,1),J=Vf(n.localZ,$,1),me=Vf(t.x,q,P),xe=Vf(t.y,te,P),se=Vf(t.z,J,P),oe=Vf(n.mortonIndex,i,z),ve=P===d&&Tx(e.childSubtreeAvailability,oe);let ge,Je,Ge,et;if(ve){const At=`${v}/${w}`,kt=Ex(At,D,me,xe,se);ge=await AA(kt,yR,a),et=0,Je={level:D,x:me,y:xe,z:se},Ge={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else ge=e,et=(N**P-1)/(N-1)+oe,Je=t,Ge={mortonIndex:oe,localLevel:P,localX:q,localY:te,localZ:J};if(!Tx(ge.tileAvailability,et))return M;Tx(ge.contentAvailability,et)&&(M.contentUrl=Ex(_,D,me,xe,se));for(let At=0;At<N;At++){const kt=vae(o,At,u),ae=await kR({subtree:ge,subtreeData:Je,parentData:Ge,childIndex:At,implicitOptions:s,loaderOptions:a,s2VolumeBox:kt});(ae.contentUrl||ae.children.length)&&M.children.push(ae)}return M.contentUrl||M.children.length?wae(M,{level:D,x:me,y:xe,z:se},s,o):M}function Tx(r,e){let t;return Array.isArray(r)?(t=r[0],r.length>1&&YS.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=r,"constant"in t?!!t.constant:t.explicitBitstream?Cae(e,t.explicitBitstream):!1}function wae(r,e,t,n){const{basePath:i,refine:s,getRefine:a,lodMetricType:o,getTileType:u,rootLodMetricValue:d,rootBoundingVolume:p}=t,_=r.contentUrl&&r.contentUrl.replace(`${i}/`,""),w=d/2**e.level,v=n!=null&&n.box?{box:n.box}:p,M=xae(v,e,t.subdivisionScheme);return{children:r.children,contentUrl:r.contentUrl,content:{uri:_},id:r.contentUrl,refine:a(s),type:u(r),lodMetricType:o,lodMetricValue:w,geometricError:w,transform:r.transform,boundingVolume:M}}function xae(r,e,t){if(r.region){const{level:n,x:i,y:s,z:a}=e,[o,u,d,p,_,w]=r.region,v=2**n,M=(d-o)/v,[P,D]=[o+M*i,o+M*(i+1)],N=(p-u)/v,[z,W]=[u+N*s,u+N*(s+1)];let V,$;if(t==="OCTREE"){const q=(w-_)/v;[V,$]=[_+q*a,_+q*(a+1)]}else[V,$]=[_,w];return{region:[P,z,D,W,V,$]}}if(r.box)return r;throw new Error(`Unsupported bounding volume type ${JSON.stringify(r)}`)}function Vf(r,e,t){return(r<<t)+e}function Ex(r,e,t,n,i){const s=Bae({level:e,x:t,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function Bae(r){const e={};for(const t in r)e[`{${t}}`]=r[t];return e}function Cae(r,e){const t=Math.floor(r/8),n=r%8;return(e[t]>>n&1)===1}function Sx(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(!e)return Ph.EMPTY;const n=e.split("?")[0].split(".").pop();switch(n){case"pnts":return Ph.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ph.SCENEGRAPH;default:return n||Ph.EMPTY}}function Ix(r){switch(r){case"REPLACE":case"replace":return jc.REPLACE;case"ADD":case"add":return jc.ADD;default:return r}}function Mx(r,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(r,`${e}/`);return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return MV(e,r)}function QR(r,e){var i;if(!r)return null;let t;if(r.content){const s=r.content.uri||((i=r.content)==null?void 0:i.url);typeof s<"u"&&(t=Mx(s,e))}return{...r,id:t,contentUrl:t,lodMetricType:gp.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:Sx(r,t),refine:Ix(r.refine)}}async function Tae(r,e,t){let n=null;const i=HR(r.root);i&&r.root?n=await zR(r.root,r,e,i,t):n=QR(r.root,e);const s=[];for(s.push(n);s.length>0;){const a=s.pop()||{},o=a.children||[],u=[];for(const d of o){const p=HR(d);let _;p?_=await zR(d,r,e,p,t):_=QR(d,e),_&&(u.push(_),s.push(_))}a.children=u}return n}async function zR(r,e,t,n,i){var V,$,q;const{subdivisionScheme:s,maximumLevel:a,availableLevels:o,subtreeLevels:u,subtrees:{uri:d}}=n,p=Ex(d,0,0,0,0),_=Mx(p,t),w=await AA(_,yR,i),v=(V=r.content)==null?void 0:V.uri,M=v?Mx(v,t):"",P=($=e==null?void 0:e.root)==null?void 0:$.refine,D=r.geometricError,N=(q=r.boundingVolume.extensions)==null?void 0:q["3DTILES_bounding_volume_S2"];if(N){const J={box:NR(N),s2VolumeInfo:N};r.boundingVolume=J}const z=r.boundingVolume,W={contentUrlTemplate:M,subtreesUriTemplate:d,subdivisionScheme:s,subtreeLevels:u,maximumLevel:Number.isFinite(o)?o-1:a,refine:P,basePath:t,lodMetricType:gp.GEOMETRIC_ERROR,rootLodMetricValue:D,rootBoundingVolume:z,getTileType:Sx,getRefine:Ix};return await Eae(r,t,w,W,i)}async function Eae(r,e,t,n,i){if(!r)return null;const{children:s,contentUrl:a}=await kR({subtree:t,implicitOptions:n,loaderOptions:i});let o,u=null;return a&&(o=a,u={uri:a.replace(`${e}/`,"")}),{...r,id:o,contentUrl:o,lodMetricType:gp.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:Sx(r,o),refine:Ix(r.refine),content:u||r.content,children:s}}function HR(r){var e;return((e=r==null?void 0:r.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const Px={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:oR,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Sae,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Sae(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const n=e["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=(t==null?void 0:t.url)&&t.url.indexOf(".json")!==-1:i=n.isTileset,i?Iae(r,e,t):Mae(r,e,t)}async function Iae(r,e,t){var u;const n=JSON.parse(new TextDecoder().decode(r)),i=(t==null?void 0:t.url)||"",s=Pae(i),a=await Tae(n,s,e||{});return{...n,shape:"tileset3d",loader:Px,url:i,queryString:(t==null?void 0:t.queryString)||"",basePath:s,root:a||n.root,type:tl.TILES3D,lodMetricType:gp.GEOMETRIC_ERROR,lodMetricValue:((u=n.root)==null?void 0:u.geometricError)||0}}async function Mae(r,e,t){const n={content:{shape:"tile3d",featureIds:null}};return await mR(r,0,e,t,n.content),n.content}function Pae(r){return wv(r)}const VR=[0],Fae={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Px,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,e,t)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class Fx extends EF{initializeState(){"onTileLoadFail"in this.props&&Wn.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!((t=(e=this.state)==null?void 0:e.tileset3d)!=null&&t.isLoaded()&&super.isLoaded)}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){let{props:t,oldProps:n,changeFlags:i}=e;if(t.data&&t.data!==n.data&&this._loadTileset(t.data),i.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:s}=this.state;for(const a in s)s[a].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,t[e.id]=e;const i=n==null?void 0:n[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(e){let{info:t,sourceLayer:n}=e;const i=n&&n.props.tile;return t.picked&&(t.object=i),t.sourceTile=i,t}filterSubLayer(e){let{layer:t,viewport:n}=e;const{tile:i}=t.props,{id:s}=n;return i.selected&&i.viewportIds.includes(s)}_updateAutoHighlight(e){const t=e.sourceTile,n=this.state.layerMap[t==null?void 0:t.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props,n=this.props.loader||this.props.loaders,i=Array.isArray(n)?n[0]:n,s={loadOptions:{...t}};let a=e;if(i.preload){const d=await i.preload(e,t);d.url&&(a=d.url),d.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:d.headers}),Object.assign(s,d)}const o=await AA(a,i,s.loadOptions),u=new doe(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:u,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(u)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:n}=this.context,i=Object.keys(e).length;!n||!i||!t||t.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case Ph.POINTCLOUD:return this._makePointCloudLayer(e,t);case Ph.SCENEGRAPH:return this._make3DModelLayer(e);case Ph.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){const{attributes:n,pointCount:i,constantRGBA:s,cartographicOrigin:a,modelMatrix:o}=e.content,{positions:u,normals:d,colors:p}=n;if(!u)return null;const _=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:u,NORMAL:d,COLOR_0:p}},{pointSize:w,getPointColor:v}=this.props,M=this.getSubLayerClass("pointcloud",F2);return new M({pointSize:w},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:_,coordinateSystem:Hn.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:s||v,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:n,cartographicOrigin:i,modelMatrix:s}=e.content,a=this.getSubLayerClass("scenegraph",rx);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||VR,scenegraph:t,coordinateSystem:Hn.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:o=>o.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const n=e.content,{attributes:i,indices:s,modelMatrix:a,cartographicOrigin:o,coordinateSystem:u=Hn.METER_OFFSETS,material:d,featureIds:p}=n,{_getMeshColor:_}=this.props,w=t&&t.props.mesh||new Wd({topology:"triangle-list",attributes:Rae(i),indices:s}),v=this.getSubLayerClass("mesh",nx);return new v(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:w,data:VR,getColor:_(e),pbrMaterial:d,modelMatrix:a,coordinateOrigin:o,coordinateSystem:u,featureIds:p,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(n=>{const i=t[n.id]=t[n.id]||{tile:n};let{layer:s}=i;return n.selected&&(s?i.needsUpdate&&(s=this._getSubLayer(n,s),i.needsUpdate=!1):s=this._getSubLayer(n)),i.layer=s,s}).filter(Boolean):null}}Fx.defaultProps=Fae,Fx.layerName="Tile3DLayer";function Rae(r){const e={};return e.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(e.normals=r.normals),r.texCoords&&(e.texCoords=r.texCoords),r.colors&&(e.colors=r.colors),r.uvRegions&&(e.uvRegions=r.uvRegions),e}var Lae=Object.defineProperty,Oae=(r,e,t)=>e in r?Lae(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yn=(r,e,t)=>Oae(r,typeof e!="symbol"?e+"":e,t);let Uae=class{constructor(e){Yn(this,"map"),Yn(this,"width"),Yn(this,"height"),Yn(this,"svgCanvas"),Yn(this,"xLine"),Yn(this,"yLine"),Yn(this,"color","#535353"),this.map=e,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var e,t;this.width=(e=this.map)==null?void 0:e.getCanvas().clientWidth,this.height=(t=this.map)==null?void 0:t.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const e=this.width/2,t=this.height/2;this.yLine.setAttribute("x1",`${e}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${e}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${t}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${t}px`)}else console.error("element value is null")}createCanvas(e){if(this.width!==void 0&&this.height!==void 0){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="relative",t.setAttribute("width",`${this.width}px`),t.setAttribute("height",`${this.height}px`);const n=this.width/2,i=this.height/2;this.yLine=t.appendChild(this.createLine(n,0,n,this.height,this.color,"2px")),this.xLine=t.appendChild(this.createLine(0,i,this.width,i,this.color,"2px")),e==null||e.appendChild(t),this.svgCanvas=t}}createLine(e,t,n,i,s,a){const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1",e),o.setAttribute("y1",t),o.setAttribute("x2",n),o.setAttribute("y2",i),o.setAttribute("stroke-dasharray","5,5"),o.setAttribute("stroke",s),o.setAttribute("stroke-width",a),o}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};const Rx={72:72,96:96,200:200,300:300,400:400},Rh={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},um={Landscape:"landscape",Portrait:"portrait"},jf={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},bp={mm:"mm"};let Dae=class{constructor(e){Yn(this,"map"),Yn(this,"width"),Yn(this,"height"),Yn(this,"unit"),Yn(this,"svgCanvas"),Yn(this,"svgPath");var t,n,i;if(this.map=e,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const s=(t=this.map)==null?void 0:t.getCanvas().clientWidth,a=(n=this.map)==null?void 0:n.getCanvas().clientHeight,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.setAttribute("width",`${s}px`),o.setAttribute("height",`${a}px`);const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("style","fill:#888888;stroke-width:0"),u.setAttribute("fill-opacity","0.5"),o.append(u),(i=this.map)==null||i.getCanvasContainer().appendChild(o),this.svgCanvas=o,this.svgPath=u}mapResize(){this.generateCutOut()}updateArea(e,t){this.width=e,this.height=t,this.unit=bp.mm,this.generateCutOut()}generateCutOut(){var e,t;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const n=this.toPixels(this.width),i=this.toPixels(this.height),s=(e=this.map)==null?void 0:e.getCanvas().clientWidth,a=(t=this.map)==null?void 0:t.getCanvas().clientHeight,o=s/2-n/2,u=o+n,d=a/2-i/2,p=d+i;this.svgCanvas.setAttribute("width",`${s}px`),this.svgCanvas.setAttribute("height",`${a}px`),this.svgPath.setAttribute("d",`M 0 0 L ${s} 0 L ${s} ${a} L 0 ${a} M ${o} ${d} L ${o} ${p} L ${u} ${p} L ${u} ${d}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===bp.mm&&(t/=25.4),t*e}};const jR={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},Nae={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer",LanguageName:"Français",LanguageCode:"fr"},kae={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},Qae={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},zae={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},Hae={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Española",LanguageCode:"es"},Vae={PageSize:"Mida",PageOrientation:"Orientació",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},jae={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo",LanguageName:"Tiếng Việt",LanguageCode:"vi"},$ae={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати",LanguageName:"українська",LanguageCode:"uk"},Gae={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出",LanguageName:"简体字",LanguageCode:"zhHans"},qae={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出",LanguageName:"繁体字",LanguageCode:"zhHant"},Kae={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力",LanguageName:"日本語",LanguageCode:"ja"},Wae={PageSize:"Tamanho da página",PageOrientation:"Orientação da página",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Português",LanguageCode:"pt"},Xae=[jR,Nae,kae,Qae,zae,Hae,Vae,jae,$ae,Gae,qae,Kae,Wae],Yae=r=>Xae.find(e=>e.LanguageCode===r)??jR;function ri(r){"@babel/helpers - typeof";return ri=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ri(r)}var Aa=Uint8Array,Tl=Uint16Array,Lx=Int32Array,b0=new Aa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),v0=new Aa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ox=new Aa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$R=function(r,e){for(var t=new Tl(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Lx(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return{b:t,r:i}},GR=$R(b0,2),qR=GR.b,Ux=GR.r;qR[28]=258,Ux[258]=28;for(var KR=$R(v0,0),Zae=KR.b,WR=KR.r,Dx=new Tl(32768),Ki=0;Ki<32768;++Ki){var RA=(Ki&43690)>>1|(Ki&21845)<<1;RA=(RA&52428)>>2|(RA&13107)<<2,RA=(RA&61680)>>4|(RA&3855)<<4,Dx[Ki]=((RA&65280)>>8|(RA&255)<<8)>>1}for(var Xu=function(r,e,t){for(var n=r.length,i=0,s=new Tl(e);i<n;++i)r[i]&&++s[r[i]-1];var a=new Tl(e);for(i=1;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(t){o=new Tl(1<<e);var u=15-e;for(i=0;i<n;++i)if(r[i])for(var d=i<<4|r[i],p=e-r[i],_=a[r[i]-1]++<<p,w=_|(1<<p)-1;_<=w;++_)o[Dx[_]>>u]=d}else for(o=new Tl(n),i=0;i<n;++i)r[i]&&(o[i]=Dx[a[r[i]-1]++]>>15-r[i]);return o},LA=new Aa(288),Ki=0;Ki<144;++Ki)LA[Ki]=8;for(var Ki=144;Ki<256;++Ki)LA[Ki]=9;for(var Ki=256;Ki<280;++Ki)LA[Ki]=7;for(var Ki=280;Ki<288;++Ki)LA[Ki]=8;for(var hm=new Aa(32),Ki=0;Ki<32;++Ki)hm[Ki]=5;var Jae=Xu(LA,9,0),ele=Xu(LA,9,1),tle=Xu(hm,5,0),rle=Xu(hm,5,1),Nx=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},qc=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},kx=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Qx=function(r){return(r+7)/8|0},XR=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new Aa(r.subarray(e,t))},nle=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Kc=function(r,e,t){var n=new Error(e||nle[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Kc),!t)throw n;return n},ile=function(r,e,t,n){var i=r.length,s=0;if(!i||e.f&&!e.l)return t||new Aa(0);var a=!t,o=a||e.i!=2,u=e.i;a&&(t=new Aa(i*3));var d=function(qt){var or=t.length;if(qt>or){var gr=new Aa(Math.max(or*2,qt));gr.set(t),t=gr}},p=e.f||0,_=e.p||0,w=e.b||0,v=e.l,M=e.d,P=e.m,D=e.n,N=i*8;do{if(!v){p=qc(r,_,1);var z=qc(r,_+1,3);if(_+=3,z)if(z==1)v=ele,M=rle,P=9,D=5;else if(z==2){var W=qc(r,_,31)+257,V=qc(r,_+10,15)+4,$=W+qc(r,_+5,31)+1;_+=14;for(var q=new Aa($),te=new Aa(19),J=0;J<V;++J)te[Ox[J]]=qc(r,_+J*3,7);_+=V*3;for(var me=Nx(te),xe=(1<<me)-1,se=Xu(te,me,1),J=0;J<$;){var oe=se[qc(r,_,xe)];_+=oe&15;var ve=oe>>4;if(ve<16)q[J++]=ve;else{var ge=0,Je=0;for(ve==16?(Je=3+qc(r,_,3),_+=2,ge=q[J-1]):ve==17?(Je=3+qc(r,_,7),_+=3):ve==18&&(Je=11+qc(r,_,127),_+=7);Je--;)q[J++]=ge}}var Ge=q.subarray(0,W),et=q.subarray(W);P=Nx(Ge),D=Nx(et),v=Xu(Ge,P,1),M=Xu(et,D,1)}else Kc(1);else{var ve=Qx(_)+4,Ye=r[ve-4]|r[ve-3]<<8,ct=ve+Ye;if(ct>i){u&&Kc(0);break}o&&d(w+Ye),t.set(r.subarray(ve,ct),w),e.b=w+=Ye,e.p=_=ct*8,e.f=p;continue}if(_>N){u&&Kc(0);break}}o&&d(w+131072);for(var At=(1<<P)-1,kt=(1<<D)-1,ae=_;;ae=_){var ge=v[kx(r,_)&At],Te=ge>>4;if(_+=ge&15,_>N){u&&Kc(0);break}if(ge||Kc(2),Te<256)t[w++]=Te;else if(Te==256){ae=_,v=null;break}else{var Le=Te-254;if(Te>264){var J=Te-257,De=b0[J];Le=qc(r,_,(1<<De)-1)+qR[J],_+=De}var at=M[kx(r,_)&kt],rt=at>>4;at||Kc(3),_+=at&15;var et=Zae[rt];if(rt>3){var De=v0[rt];et+=kx(r,_)&(1<<De)-1,_+=De}if(_>N){u&&Kc(0);break}o&&d(w+131072);var xt=w+Le;if(w<et){var vt=s-et,nr=Math.min(et,xt);for(vt+w<0&&Kc(3);w<nr;++w)t[w]=n[vt+w]}for(;w<xt;++w)t[w]=t[w-et]}}e.l=v,e.p=ae,e.b=w,e.f=p,v&&(p=1,e.m=P,e.d=M,e.n=D)}while(!p);return w!=t.length&&a?XR(t,0,w):t.subarray(0,w)},Lh=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8},Am=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8,r[n+2]|=t>>16},zx=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var i=t.length,s=t.slice();if(!i)return{t:eL,l:0};if(i==1){var a=new Aa(t[0].s+1);return a[t[0].s]=1,{t:a,l:1}}t.sort(function($,q){return $.f-q.f}),t.push({s:-1,f:25001});var o=t[0],u=t[1],d=0,p=1,_=2;for(t[0]={s:-1,f:o.f+u.f,l:o,r:u};p!=i-1;)o=t[t[d].f<t[_].f?d++:_++],u=t[d!=p&&t[d].f<t[_].f?d++:_++],t[p++]={s:-1,f:o.f+u.f,l:o,r:u};for(var w=s[0].s,n=1;n<i;++n)s[n].s>w&&(w=s[n].s);var v=new Tl(w+1),M=Hx(t[p-1],v,0);if(M>e){var n=0,P=0,D=M-e,N=1<<D;for(s.sort(function(q,te){return v[te.s]-v[q.s]||q.f-te.f});n<i;++n){var z=s[n].s;if(v[z]>e)P+=N-(1<<M-v[z]),v[z]=e;else break}for(P>>=D;P>0;){var W=s[n].s;v[W]<e?P-=1<<e-v[W]++-1:++n}for(;n>=0&&P;--n){var V=s[n].s;v[V]==e&&(--v[V],++P)}M=e}return{t:new Aa(v),l:M}},Hx=function(r,e,t){return r.s==-1?Math.max(Hx(r.l,e,t+1),Hx(r.r,e,t+1)):e[r.s]=t},YR=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new Tl(++e),n=0,i=r[0],s=1,a=function(u){t[n++]=u},o=1;o<=e;++o)if(r[o]==i&&o!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=r[o]}return{c:t.subarray(0,n),n:e}},fm=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},ZR=function(r,e,t){var n=t.length,i=Qx(e+2);r[i]=n&255,r[i+1]=n>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var s=0;s<n;++s)r[i+s+4]=t[s];return(i+4+n)*8},JR=function(r,e,t,n,i,s,a,o,u,d,p){Lh(e,p++,t),++i[256];for(var _=zx(i,15),w=_.t,v=_.l,M=zx(s,15),P=M.t,D=M.l,N=YR(w),z=N.c,W=N.n,V=YR(P),$=V.c,q=V.n,te=new Tl(19),J=0;J<z.length;++J)++te[z[J]&31];for(var J=0;J<$.length;++J)++te[$[J]&31];for(var me=zx(te,7),xe=me.t,se=me.l,oe=19;oe>4&&!xe[Ox[oe-1]];--oe);var ve=d+5<<3,ge=fm(i,LA)+fm(s,hm)+a,Je=fm(i,w)+fm(s,P)+a+14+3*oe+fm(te,xe)+2*te[16]+3*te[17]+7*te[18];if(u>=0&&ve<=ge&&ve<=Je)return ZR(e,p,r.subarray(u,u+d));var Ge,et,Ye,ct;if(Lh(e,p,1+(Je<ge)),p+=2,Je<ge){Ge=Xu(w,v,0),et=w,Ye=Xu(P,D,0),ct=P;var At=Xu(xe,se,0);Lh(e,p,W-257),Lh(e,p+5,q-1),Lh(e,p+10,oe-4),p+=14;for(var J=0;J<oe;++J)Lh(e,p+3*J,xe[Ox[J]]);p+=3*oe;for(var kt=[z,$],ae=0;ae<2;++ae)for(var Te=kt[ae],J=0;J<Te.length;++J){var Le=Te[J]&31;Lh(e,p,At[Le]),p+=xe[Le],Le>15&&(Lh(e,p,Te[J]>>5&127),p+=Te[J]>>12)}}else Ge=Jae,et=LA,Ye=tle,ct=hm;for(var J=0;J<o;++J){var De=n[J];if(De>255){var Le=De>>18&31;Am(e,p,Ge[Le+257]),p+=et[Le+257],Le>7&&(Lh(e,p,De>>23&31),p+=b0[Le]);var at=De&31;Am(e,p,Ye[at]),p+=ct[at],at>3&&(Am(e,p,De>>5&8191),p+=v0[at])}else Am(e,p,Ge[De]),p+=et[De]}return Am(e,p,Ge[256]),p+et[256]},sle=new Lx([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),eL=new Aa(0),ole=function(r,e,t,n,i,s){var a=s.z||r.length,o=new Aa(n+a+5*(1+Math.ceil(a/7e3))+i),u=o.subarray(n,o.length-i),d=s.l,p=(s.r||0)&7;if(e){p&&(u[0]=s.r>>3);for(var _=sle[e-1],w=_>>13,v=_&8191,M=(1<<t)-1,P=s.p||new Tl(32768),D=s.h||new Tl(M+1),N=Math.ceil(t/3),z=2*N,W=function(wr){return(r[wr]^r[wr+1]<<N^r[wr+2]<<z)&M},V=new Lx(25e3),$=new Tl(288),q=new Tl(32),te=0,J=0,me=s.i||0,xe=0,se=s.w||0,oe=0;me+2<a;++me){var ve=W(me),ge=me&32767,Je=D[ve];if(P[ge]=Je,D[ve]=ge,se<=me){var Ge=a-me;if((te>7e3||xe>24576)&&(Ge>423||!d)){p=JR(r,u,0,V,$,q,J,xe,oe,me-oe,p),xe=te=J=0,oe=me;for(var et=0;et<286;++et)$[et]=0;for(var et=0;et<30;++et)q[et]=0}var Ye=2,ct=0,At=v,kt=ge-Je&32767;if(Ge>2&&ve==W(me-kt))for(var ae=Math.min(w,Ge)-1,Te=Math.min(32767,me),Le=Math.min(258,Ge);kt<=Te&&--At&&ge!=Je;){if(r[me+Ye]==r[me+Ye-kt]){for(var De=0;De<Le&&r[me+De]==r[me+De-kt];++De);if(De>Ye){if(Ye=De,ct=kt,De>ae)break;for(var at=Math.min(kt,De-2),rt=0,et=0;et<at;++et){var xt=me-kt+et&32767,vt=P[xt],nr=xt-vt&32767;nr>rt&&(rt=nr,Je=xt)}}}ge=Je,Je=P[ge],kt+=ge-Je&32767}if(ct){V[xe++]=268435456|Ux[Ye]<<18|WR[ct];var qt=Ux[Ye]&31,or=WR[ct]&31;J+=b0[qt]+v0[or],++$[257+qt],++q[or],se=me+Ye,++te}else V[xe++]=r[me],++$[r[me]]}}for(me=Math.max(me,se);me<a;++me)V[xe++]=r[me],++$[r[me]];p=JR(r,u,d,V,$,q,J,xe,oe,me-oe,p),d||(s.r=p&7|u[p/8|0]<<3,p-=7,s.h=D,s.p=P,s.i=me,s.w=se)}else{for(var me=s.w||0;me<a+d;me+=65535){var gr=me+65535;gr>=a&&(u[p/8|0]=d,gr=a),p=ZR(u,p+1,r.subarray(me,gr))}s.i=a}return XR(o,0,n+Qx(p)+i)},tL=function(){var r=1,e=0;return{p:function(t){for(var n=r,i=e,s=t.length|0,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)i+=n+=t[a];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}r=n,e=i},d:function(){return r%=65521,e%=65521,(r&255)<<24|(r&65280)<<8|(e&255)<<8|e>>8}}},ale=function(r,e,t,n,i){if(!i&&(i={l:1},e.dictionary)){var s=e.dictionary.subarray(-32768),a=new Aa(s.length+r.length);a.set(s),a.set(r,s.length),r=a,i.w=s.length}return ole(r,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,t,n,i)},rL=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},lle=function(r,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;if(r[0]=120,r[1]=n<<6|(e.dictionary&&32),r[1]|=31-(r[0]<<8|r[1])%31,e.dictionary){var i=tL();i.p(e.dictionary),rL(r,2,i.d())}},cle=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Kc(6,"invalid zlib data"),(r[1]>>5&1)==1&&Kc(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Vx(r,e){e||(e={});var t=tL();t.p(r);var n=ale(r,e,e.dictionary?6:2,4);return lle(n,e),rL(n,n.length-4,t.d()),n}function ule(r,e){return ile(r.subarray(cle(r),-4),{i:2},e,e)}var hle=typeof TextDecoder<"u"&&new TextDecoder,Ale=0;try{hle.decode(eL,{stream:!0}),Ale=1}catch{}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.2 Built on 2024-09-17T13:29:57.859Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var ln=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function jx(){ln.console&&typeof ln.console.log=="function"&&ln.console.log.apply(ln.console,arguments)}var Ui={log:jx,warn:function(r){ln.console&&(typeof ln.console.warn=="function"?ln.console.warn.apply(ln.console,arguments):jx.call(null,arguments))},error:function(r){ln.console&&(typeof ln.console.error=="function"?ln.console.error.apply(ln.console,arguments):jx(r))}};function $x(r,e,t){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){$f(n.response,e,t)},n.onerror=function(){Ui.error("could not download file")},n.send()}function nL(r){var e=new XMLHttpRequest;e.open("HEAD",r,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function w0(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(e)}}var dm,Gx,$f=ln.saveAs||((typeof window>"u"?"undefined":ri(window))!=="object"||window!==ln?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,e,t){var n=ln.URL||ln.webkitURL,i=document.createElement("a");e=e||r.name||"download",i.download=e,i.rel="noopener",typeof r=="string"?(i.href=r,i.origin!==location.origin?nL(i.href)?$x(r,e,t):w0(i,i.target="_blank"):w0(i)):(i.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){w0(i)},0))}:"msSaveOrOpenBlob"in navigator?function(r,e,t){if(e=e||r.name||"download",typeof r=="string")if(nL(r))$x(r,e,t);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){w0(n)})}else navigator.msSaveOrOpenBlob(function(i,s){return s===void 0?s={autoBom:!1}:ri(s)!=="object"&&(Ui.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}(r,t),e)}:function(r,e,t,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return $x(r,e,t);var i=r.type==="application/octet-stream",s=/constructor/i.test(ln.HTMLElement)||ln.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||i&&s)&&(typeof FileReader>"u"?"undefined":ri(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var p=o.result;p=a?p:p.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=p:location=p,n=null},o.readAsDataURL(r)}else{var u=ln.URL||ln.webkitURL,d=u.createObjectURL(r);n?n.location=d:location.href=d,n=null,setTimeout(function(){u.revokeObjectURL(d)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function iL(r){var e;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],n=0;n<t.length;n++){var i=t[n].re,s=t[n].process,a=i.exec(r);a&&(e=s(a),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),u=this.g.toString(16),d=this.b.toString(16);return o.length==1&&(o="0"+o),u.length==1&&(u="0"+u),d.length==1&&(d="0"+d),"#"+o+u+d}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function qx(r,e){var t=r[0],n=r[1],i=r[2],s=r[3];t=fa(t,n,i,s,e[0],7,-680876936),s=fa(s,t,n,i,e[1],12,-389564586),i=fa(i,s,t,n,e[2],17,606105819),n=fa(n,i,s,t,e[3],22,-1044525330),t=fa(t,n,i,s,e[4],7,-176418897),s=fa(s,t,n,i,e[5],12,1200080426),i=fa(i,s,t,n,e[6],17,-1473231341),n=fa(n,i,s,t,e[7],22,-45705983),t=fa(t,n,i,s,e[8],7,1770035416),s=fa(s,t,n,i,e[9],12,-1958414417),i=fa(i,s,t,n,e[10],17,-42063),n=fa(n,i,s,t,e[11],22,-1990404162),t=fa(t,n,i,s,e[12],7,1804603682),s=fa(s,t,n,i,e[13],12,-40341101),i=fa(i,s,t,n,e[14],17,-1502002290),t=da(t,n=fa(n,i,s,t,e[15],22,1236535329),i,s,e[1],5,-165796510),s=da(s,t,n,i,e[6],9,-1069501632),i=da(i,s,t,n,e[11],14,643717713),n=da(n,i,s,t,e[0],20,-373897302),t=da(t,n,i,s,e[5],5,-701558691),s=da(s,t,n,i,e[10],9,38016083),i=da(i,s,t,n,e[15],14,-660478335),n=da(n,i,s,t,e[4],20,-405537848),t=da(t,n,i,s,e[9],5,568446438),s=da(s,t,n,i,e[14],9,-1019803690),i=da(i,s,t,n,e[3],14,-187363961),n=da(n,i,s,t,e[8],20,1163531501),t=da(t,n,i,s,e[13],5,-1444681467),s=da(s,t,n,i,e[2],9,-51403784),i=da(i,s,t,n,e[7],14,1735328473),t=pa(t,n=da(n,i,s,t,e[12],20,-1926607734),i,s,e[5],4,-378558),s=pa(s,t,n,i,e[8],11,-2022574463),i=pa(i,s,t,n,e[11],16,1839030562),n=pa(n,i,s,t,e[14],23,-35309556),t=pa(t,n,i,s,e[1],4,-1530992060),s=pa(s,t,n,i,e[4],11,1272893353),i=pa(i,s,t,n,e[7],16,-155497632),n=pa(n,i,s,t,e[10],23,-1094730640),t=pa(t,n,i,s,e[13],4,681279174),s=pa(s,t,n,i,e[0],11,-358537222),i=pa(i,s,t,n,e[3],16,-722521979),n=pa(n,i,s,t,e[6],23,76029189),t=pa(t,n,i,s,e[9],4,-640364487),s=pa(s,t,n,i,e[12],11,-421815835),i=pa(i,s,t,n,e[15],16,530742520),t=ga(t,n=pa(n,i,s,t,e[2],23,-995338651),i,s,e[0],6,-198630844),s=ga(s,t,n,i,e[7],10,1126891415),i=ga(i,s,t,n,e[14],15,-1416354905),n=ga(n,i,s,t,e[5],21,-57434055),t=ga(t,n,i,s,e[12],6,1700485571),s=ga(s,t,n,i,e[3],10,-1894986606),i=ga(i,s,t,n,e[10],15,-1051523),n=ga(n,i,s,t,e[1],21,-2054922799),t=ga(t,n,i,s,e[8],6,1873313359),s=ga(s,t,n,i,e[15],10,-30611744),i=ga(i,s,t,n,e[6],15,-1560198380),n=ga(n,i,s,t,e[13],21,1309151649),t=ga(t,n,i,s,e[4],6,-145523070),s=ga(s,t,n,i,e[11],10,-1120210379),i=ga(i,s,t,n,e[2],15,718787259),n=ga(n,i,s,t,e[9],21,-343485551),r[0]=OA(t,r[0]),r[1]=OA(n,r[1]),r[2]=OA(i,r[2]),r[3]=OA(s,r[3])}function x0(r,e,t,n,i,s){return e=OA(OA(e,r),OA(n,s)),OA(e<<i|e>>>32-i,t)}function fa(r,e,t,n,i,s,a){return x0(e&t|~e&n,r,e,i,s,a)}function da(r,e,t,n,i,s,a){return x0(e&n|t&~n,r,e,i,s,a)}function pa(r,e,t,n,i,s,a){return x0(e^t^n,r,e,i,s,a)}function ga(r,e,t,n,i,s,a){return x0(t^(e|~n),r,e,i,s,a)}function sL(r){var e,t=r.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=r.length;e+=64)qx(n,fle(r.substring(e-64,e)));r=r.substring(e-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r.length;e++)i[e>>2]|=r.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(qx(n,i),e=0;e<16;e++)i[e]=0;return i[14]=8*t,qx(n,i),n}function fle(r){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=r.charCodeAt(e)+(r.charCodeAt(e+1)<<8)+(r.charCodeAt(e+2)<<16)+(r.charCodeAt(e+3)<<24);return t}dm=ln.atob.bind(ln),Gx=ln.btoa.bind(ln);var oL="0123456789abcdef".split("");function dle(r){for(var e="",t=0;t<4;t++)e+=oL[r>>8*t+4&15]+oL[r>>8*t&15];return e}function ple(r){return String.fromCharCode((255&r)>>0,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function Kx(r){return sL(r).map(ple).join("")}var gle=function(r){for(var e=0;e<r.length;e++)r[e]=dle(r[e]);return r.join("")}(sL("hello"))!="5d41402abc4b2a76b9719d911017c592";function OA(r,e){if(gle){var t=(65535&r)+(65535&e);return(r>>16)+(e>>16)+(t>>16)<<16|65535&t}return r+e&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function Wx(r,e){var t,n,i,s;if(r!==t){for(var a=(i=r,s=1+(256/r.length>>0),new Array(s+1).join(i)),o=[],u=0;u<256;u++)o[u]=u;var d=0;for(u=0;u<256;u++){var p=o[u];d=(d+p+a.charCodeAt(u))%256,o[u]=o[d],o[d]=p}t=r,n=o}else o=n;var _=e.length,w=0,v=0,M="";for(u=0;u<_;u++)v=(v+(p=o[w=(w+1)%256]))%256,o[w]=o[v],o[v]=p,a=o[(o[w]+o[v])%256],M+=String.fromCharCode(e.charCodeAt(u)^a);return M}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var aL={print:4,modify:8,copy:16,"annot-forms":32};function vp(r,e,t,n){this.v=1,this.r=2;var i=192;r.forEach(function(o){if(aL.perm!==void 0)throw new Error("Invalid permission: "+o);i+=aL[o]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var s=(e+this.padding).substr(0,32),a=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^i)),this.encryptionKey=Kx(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=Wx(this.encryptionKey,this.padding)}function wp(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var e="",t=r.length,n=0;n<t;n++){var i=r.charCodeAt(n);i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?e+="#"+("0"+i.toString(16)).slice(-2):e+=r[n]}return e}function lL(r){if(ri(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,n,i){if(i=i||!1,typeof t!="string"||typeof n!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var s=Math.random().toString(35);return e[t][s]=[n,!!i],s},this.unsubscribe=function(t){for(var n in e)if(e[n][t])return delete e[n][t],Object.keys(e[n]).length===0&&delete e[n],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var n=Array.prototype.slice.call(arguments,1),i=[];for(var s in e[t]){var a=e[t][s];try{a[0].apply(r,n)}catch(o){ln.console&&Ui.error("jsPDF PubSub Error",o.message,o)}a[1]&&i.push(s)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function B0(r){if(!(this instanceof B0))return new B0(r);var e="opacity,stroke-opacity".split(",");for(var t in r)r.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=r[t]);this.id="",this.objectNumber=-1}function cL(r,e){this.gState=r,this.matrix=e,this.id="",this.objectNumber=-1}function Gf(r,e,t,n,i){if(!(this instanceof Gf))return new Gf(r,e,t,n,i);this.type=r==="axial"?2:3,this.coords=e,this.colors=t,cL.call(this,n,i)}function xp(r,e,t,n,i){if(!(this instanceof xp))return new xp(r,e,t,n,i);this.boundingBox=r,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,cL.call(this,n,i)}function cn(r){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],i=arguments[2],s=arguments[3],a=[],o=1,u=16,d="S",p=null;ri(r=r||{})==="object"&&(t=r.orientation,n=r.unit||n,i=r.format||i,s=r.compress||r.compressPdf||s,(p=r.encryption||null)!==null&&(p.userPassword=p.userPassword||"",p.ownerPassword=p.ownerPassword||"",p.userPermissions=p.userPermissions||[]),o=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(e=r.precision),r.floatPrecision!==void 0&&(u=r.floatPrecision),d=r.defaultPathOperation||"S"),a=r.filters||(s===!0?["FlateEncode"]:a),n=n||"mm",t=(""+(t||"P")).toLowerCase();var _=r.putOnlyUsedFonts||!1,w={},v={internal:{},__private__:{}};v.__private__.PubSub=lL;var M="1.3",P=v.__private__.getPdfVersion=function(){return M};v.__private__.setPdfVersion=function(U){M=U};var D={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};v.__private__.getPageFormats=function(){return D};var N=v.__private__.getPageFormat=function(U){return D[U]};i=i||"a4";var z={COMPAT:"compat",ADVANCED:"advanced"},W=z.COMPAT;function V(){this.saveGraphicsState(),ze(new rr(vr,0,0,-vr,0,xa()*vr).toString()+" cm"),this.setFontSize(this.getFontSize()/vr),d="n",W=z.ADVANCED}function $(){this.restoreGraphicsState(),d="S",W=z.COMPAT}var q=v.__private__.combineFontStyleAndFontWeight=function(U,he){if(U=="bold"&&he=="normal"||U=="bold"&&he==400||U=="normal"&&he=="italic"||U=="bold"&&he=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return he&&(U=he==400||he==="normal"?U==="italic"?"italic":"normal":he!=700&&he!=="bold"||U!=="normal"?(he==700?"bold":he)+""+U:"bold"),U};v.advancedAPI=function(U){var he=W===z.COMPAT;return he&&V.call(this),typeof U!="function"||(U(this),he&&$.call(this)),this},v.compatAPI=function(U){var he=W===z.ADVANCED;return he&&$.call(this),typeof U!="function"||(U(this),he&&V.call(this)),this},v.isAdvancedAPI=function(){return W===z.ADVANCED};var te,J=function(U){if(W!==z.ADVANCED)throw new Error(U+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},me=v.roundToPrecision=v.__private__.roundToPrecision=function(U,he){var ke=e||he;if(isNaN(U)||isNaN(ke))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return U.toFixed(ke).replace(/0+$/,"")};te=v.hpf=v.__private__.hpf=typeof u=="number"?function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.hpf");return me(U,u)}:u==="smart"?function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.hpf");return me(U,U>-1&&U<1?16:5)}:function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.hpf");return me(U,16)};var xe=v.f2=v.__private__.f2=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.f2");return me(U,2)},se=v.__private__.f3=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.f3");return me(U,3)},oe=v.scale=v.__private__.scale=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.scale");return W===z.COMPAT?U*vr:W===z.ADVANCED?U:void 0},ve=function(U){return W===z.COMPAT?xa()-U:W===z.ADVANCED?U:void 0},ge=function(U){return oe(ve(U))};v.__private__.setPrecision=v.setPrecision=function(U){typeof parseInt(U,10)=="number"&&(e=parseInt(U,10))};var Je,Ge="00000000000000000000000000000000",et=v.__private__.getFileId=function(){return Ge},Ye=v.__private__.setFileId=function(U){return Ge=U!==void 0&&/^[a-fA-F0-9]{32}$/.test(U)?U.toUpperCase():Ge.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),p!==null&&(_n=new vp(p.userPermissions,p.userPassword,p.ownerPassword,Ge)),Ge};v.setFileId=function(U){return Ye(U),this},v.getFileId=function(){return et()};var ct=v.__private__.convertDateToPDFDate=function(U){var he=U.getTimezoneOffset(),ke=he<0?"+":"-",nt=Math.floor(Math.abs(he/60)),Bt=Math.abs(he%60),Vt=[ke,Le(nt),"'",Le(Bt),"'"].join("");return["D:",U.getFullYear(),Le(U.getMonth()+1),Le(U.getDate()),Le(U.getHours()),Le(U.getMinutes()),Le(U.getSeconds()),Vt].join("")},At=v.__private__.convertPDFDateToDate=function(U){var he=parseInt(U.substr(2,4),10),ke=parseInt(U.substr(6,2),10)-1,nt=parseInt(U.substr(8,2),10),Bt=parseInt(U.substr(10,2),10),Vt=parseInt(U.substr(12,2),10),ur=parseInt(U.substr(14,2),10);return new Date(he,ke,nt,Bt,Vt,ur,0)},kt=v.__private__.setCreationDate=function(U){var he;if(U===void 0&&(U=new Date),U instanceof Date)he=ct(U);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(U))throw new Error("Invalid argument passed to jsPDF.setCreationDate");he=U}return Je=he},ae=v.__private__.getCreationDate=function(U){var he=Je;return U==="jsDate"&&(he=At(Je)),he};v.setCreationDate=function(U){return kt(U),this},v.getCreationDate=function(U){return ae(U)};var Te,Le=v.__private__.padd2=function(U){return("0"+parseInt(U)).slice(-2)},De=v.__private__.padd2Hex=function(U){return("00"+(U=U.toString())).substr(U.length)},at=0,rt=[],xt=[],vt=0,nr=[],qt=[],or=!1,gr=xt,wr=function(){at=0,vt=0,xt=[],rt=[],nr=[],Br=kr(),Sn=kr()};v.__private__.setCustomOutputDestination=function(U){or=!0,gr=U};var Ot=function(U){or||(gr=U)};v.__private__.resetCustomOutputDestination=function(){or=!1,gr=xt};var ze=v.__private__.out=function(U){return U=U.toString(),vt+=U.length+1,gr.push(U),gr},$r=v.__private__.write=function(U){return ze(arguments.length===1?U.toString():Array.prototype.join.call(arguments," "))},Rr=v.__private__.getArrayBuffer=function(U){for(var he=U.length,ke=new ArrayBuffer(he),nt=new Uint8Array(ke);he--;)nt[he]=U.charCodeAt(he);return ke},Jt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];v.__private__.getStandardFonts=function(){return Jt};var tr=r.fontSize||16;v.__private__.setFontSize=v.setFontSize=function(U){return tr=W===z.ADVANCED?U/vr:U,this};var mr,_r=v.__private__.getFontSize=v.getFontSize=function(){return W===z.COMPAT?tr:tr*vr},Ut=r.R2L||!1;v.__private__.setR2L=v.setR2L=function(U){return Ut=U,this},v.__private__.getR2L=v.getR2L=function(){return Ut};var ar,Sr=v.__private__.setZoomMode=function(U){var he=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(U))mr=U;else if(isNaN(U)){if(he.indexOf(U)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+U+'" is not recognized.');mr=U}else mr=parseInt(U,10)};v.__private__.getZoomMode=function(){return mr};var Er,Dr=v.__private__.setPageMode=function(U){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(U)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+U+'" is not recognized.');ar=U};v.__private__.getPageMode=function(){return ar};var nn=v.__private__.setLayoutMode=function(U){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(U)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+U+'" is not recognized.');Er=U};v.__private__.getLayoutMode=function(){return Er},v.__private__.setDisplayMode=v.setDisplayMode=function(U,he,ke){return Sr(U),nn(he),Dr(ke),this};var Hr={title:"",subject:"",author:"",keywords:"",creator:""};v.__private__.getDocumentProperty=function(U){if(Object.keys(Hr).indexOf(U)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Hr[U]},v.__private__.getDocumentProperties=function(){return Hr},v.__private__.setDocumentProperties=v.setProperties=v.setDocumentProperties=function(U){for(var he in Hr)Hr.hasOwnProperty(he)&&U[he]&&(Hr[he]=U[he]);return this},v.__private__.setDocumentProperty=function(U,he){if(Object.keys(Hr).indexOf(U)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Hr[U]=he};var Wr,vr,Qn,un,ni,Be={},ce={},de=[],_e={},Ue={},je={},lt={},dt=null,Ze=0,ht=[],bt=new lL(v),pt=r.hotfixes||[],We={},hr={},sr=[],rr=function U(he,ke,nt,Bt,Vt,ur){if(!(this instanceof U))return new U(he,ke,nt,Bt,Vt,ur);isNaN(he)&&(he=1),isNaN(ke)&&(ke=0),isNaN(nt)&&(nt=0),isNaN(Bt)&&(Bt=1),isNaN(Vt)&&(Vt=0),isNaN(ur)&&(ur=0),this._matrix=[he,ke,nt,Bt,Vt,ur]};Object.defineProperty(rr.prototype,"sx",{get:function(){return this._matrix[0]},set:function(U){this._matrix[0]=U}}),Object.defineProperty(rr.prototype,"shy",{get:function(){return this._matrix[1]},set:function(U){this._matrix[1]=U}}),Object.defineProperty(rr.prototype,"shx",{get:function(){return this._matrix[2]},set:function(U){this._matrix[2]=U}}),Object.defineProperty(rr.prototype,"sy",{get:function(){return this._matrix[3]},set:function(U){this._matrix[3]=U}}),Object.defineProperty(rr.prototype,"tx",{get:function(){return this._matrix[4]},set:function(U){this._matrix[4]=U}}),Object.defineProperty(rr.prototype,"ty",{get:function(){return this._matrix[5]},set:function(U){this._matrix[5]=U}}),Object.defineProperty(rr.prototype,"a",{get:function(){return this._matrix[0]},set:function(U){this._matrix[0]=U}}),Object.defineProperty(rr.prototype,"b",{get:function(){return this._matrix[1]},set:function(U){this._matrix[1]=U}}),Object.defineProperty(rr.prototype,"c",{get:function(){return this._matrix[2]},set:function(U){this._matrix[2]=U}}),Object.defineProperty(rr.prototype,"d",{get:function(){return this._matrix[3]},set:function(U){this._matrix[3]=U}}),Object.defineProperty(rr.prototype,"e",{get:function(){return this._matrix[4]},set:function(U){this._matrix[4]=U}}),Object.defineProperty(rr.prototype,"f",{get:function(){return this._matrix[5]},set:function(U){this._matrix[5]=U}}),Object.defineProperty(rr.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(rr.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(rr.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(rr.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),rr.prototype.join=function(U){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(te).join(U)},rr.prototype.multiply=function(U){var he=U.sx*this.sx+U.shy*this.shx,ke=U.sx*this.shy+U.shy*this.sy,nt=U.shx*this.sx+U.sy*this.shx,Bt=U.shx*this.shy+U.sy*this.sy,Vt=U.tx*this.sx+U.ty*this.shx+this.tx,ur=U.tx*this.shy+U.ty*this.sy+this.ty;return new rr(he,ke,nt,Bt,Vt,ur)},rr.prototype.decompose=function(){var U=this.sx,he=this.shy,ke=this.shx,nt=this.sy,Bt=this.tx,Vt=this.ty,ur=Math.sqrt(U*U+he*he),Or=(U/=ur)*ke+(he/=ur)*nt;ke-=U*Or,nt-=he*Or;var Xr=Math.sqrt(ke*ke+nt*nt);return Or/=Xr,U*(nt/=Xr)<he*(ke/=Xr)&&(U=-U,he=-he,Or=-Or,ur=-ur),{scale:new rr(ur,0,0,Xr,0,0),translate:new rr(1,0,0,1,Bt,Vt),rotate:new rr(U,he,-he,U,0,0),skew:new rr(1,0,Or,1,0,0)}},rr.prototype.toString=function(U){return this.join(" ")},rr.prototype.inversed=function(){var U=this.sx,he=this.shy,ke=this.shx,nt=this.sy,Bt=this.tx,Vt=this.ty,ur=1/(U*nt-he*ke),Or=nt*ur,Xr=-he*ur,An=-ke*ur,hn=U*ur;return new rr(Or,Xr,An,hn,-Or*Bt-An*Vt,-Xr*Bt-hn*Vt)},rr.prototype.applyToPoint=function(U){var he=U.x*this.sx+U.y*this.shx+this.tx,ke=U.x*this.shy+U.y*this.sy+this.ty;return new wa(he,ke)},rr.prototype.applyToRectangle=function(U){var he=this.applyToPoint(U),ke=this.applyToPoint(new wa(U.x+U.w,U.y+U.h));return new $s(he.x,he.y,ke.x-he.x,ke.y-he.y)},rr.prototype.clone=function(){var U=this.sx,he=this.shy,ke=this.shx,nt=this.sy,Bt=this.tx,Vt=this.ty;return new rr(U,he,ke,nt,Bt,Vt)},v.Matrix=rr;var Nr=v.matrixMult=function(U,he){return he.multiply(U)},Rt=new rr(1,0,0,1,0,0);v.unitMatrix=v.identityMatrix=Rt;var ir=function(U,he){if(!Ue[U]){var ke=(he instanceof Gf?"Sh":"P")+(Object.keys(_e).length+1).toString(10);he.id=ke,Ue[U]=ke,_e[ke]=he,bt.publish("addPattern",he)}};v.ShadingPattern=Gf,v.TilingPattern=xp,v.addShadingPattern=function(U,he){return J("addShadingPattern()"),ir(U,he),this},v.beginTilingPattern=function(U){J("beginTilingPattern()"),Fl(U.boundingBox[0],U.boundingBox[1],U.boundingBox[2]-U.boundingBox[0],U.boundingBox[3]-U.boundingBox[1],U.matrix)},v.endTilingPattern=function(U,he){J("endTilingPattern()"),he.stream=qt[Te].join(`
`),ir(U,he),bt.publish("endTilingPattern",he),sr.pop().restore()};var br=v.__private__.newObject=function(){var U=kr();return en(U,!0),U},kr=v.__private__.newObjectDeferred=function(){return at++,rt[at]=function(){return vt},at},en=function(U,he){return he=typeof he=="boolean"&&he,rt[U]=vt,he&&ze(U+" 0 obj"),U},jr=v.__private__.newAdditionalObject=function(){var U={objId:kr(),content:""};return nr.push(U),U},Br=kr(),Sn=kr(),Ti=v.__private__.decodeColorString=function(U){var he=U.split(" ");if(he.length!==2||he[1]!=="g"&&he[1]!=="G")he.length===5&&(he[4]==="k"||he[4]==="K")&&(he=[(1-he[0])*(1-he[3]),(1-he[1])*(1-he[3]),(1-he[2])*(1-he[3]),"r"]);else{var ke=parseFloat(he[0]);he=[ke,ke,ke,"r"]}for(var nt="#",Bt=0;Bt<3;Bt++)nt+=("0"+Math.floor(255*parseFloat(he[Bt])).toString(16)).slice(-2);return nt},Bn=v.__private__.encodeColorString=function(U){var he;typeof U=="string"&&(U={ch1:U});var ke=U.ch1,nt=U.ch2,Bt=U.ch3,Vt=U.ch4,ur=U.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof ke=="string"&&ke.charAt(0)!=="#"){var Or=new iL(ke);if(Or.ok)ke=Or.toHex();else if(!/^\d*\.?\d*$/.test(ke))throw new Error('Invalid color "'+ke+'" passed to jsPDF.encodeColorString.')}if(typeof ke=="string"&&/^#[0-9A-Fa-f]{3}$/.test(ke)&&(ke="#"+ke[1]+ke[1]+ke[2]+ke[2]+ke[3]+ke[3]),typeof ke=="string"&&/^#[0-9A-Fa-f]{6}$/.test(ke)){var Xr=parseInt(ke.substr(1),16);ke=Xr>>16&255,nt=Xr>>8&255,Bt=255&Xr}if(nt===void 0||Vt===void 0&&ke===nt&&nt===Bt)if(typeof ke=="string")he=ke+" "+ur[0];else switch(U.precision){case 2:he=xe(ke/255)+" "+ur[0];break;case 3:default:he=se(ke/255)+" "+ur[0]}else if(Vt===void 0||ri(Vt)==="object"){if(Vt&&!isNaN(Vt.a)&&Vt.a===0)return he=["1.","1.","1.",ur[1]].join(" ");if(typeof ke=="string")he=[ke,nt,Bt,ur[1]].join(" ");else switch(U.precision){case 2:he=[xe(ke/255),xe(nt/255),xe(Bt/255),ur[1]].join(" ");break;default:case 3:he=[se(ke/255),se(nt/255),se(Bt/255),ur[1]].join(" ")}}else if(typeof ke=="string")he=[ke,nt,Bt,Vt,ur[2]].join(" ");else switch(U.precision){case 2:he=[xe(ke),xe(nt),xe(Bt),xe(Vt),ur[2]].join(" ");break;case 3:default:he=[se(ke),se(nt),se(Bt),se(Vt),ur[2]].join(" ")}return he},zn=v.__private__.getFilters=function(){return a},Cn=v.__private__.putStream=function(U){var he=(U=U||{}).data||"",ke=U.filters||zn(),nt=U.alreadyAppliedFilters||[],Bt=U.addLength1||!1,Vt=he.length,ur=U.objectId,Or=function(qs){return qs};if(p!==null&&ur===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");p!==null&&(Or=_n.encryptor(ur,0));var Xr={};ke===!0&&(ke=["FlateEncode"]);var An=U.additionalKeyValues||[],hn=(Xr=cn.API.processDataByFilters!==void 0?cn.API.processDataByFilters(he,ke):{data:he,reverseChain:[]}).reverseChain+(Array.isArray(nt)?nt.join(" "):nt.toString());if(Xr.data.length!==0&&(An.push({key:"Length",value:Xr.data.length}),Bt===!0&&An.push({key:"Length1",value:Vt})),hn.length!=0)if(hn.split("/").length-1==1)An.push({key:"Filter",value:hn});else{An.push({key:"Filter",value:"["+hn+"]"});for(var Rn=0;Rn<An.length;Rn+=1)if(An[Rn].key==="DecodeParms"){for(var bi=[],ii=0;ii<Xr.reverseChain.split("/").length-1;ii+=1)bi.push("null");bi.push(An[Rn].value),An[Rn].value="["+bi.join(" ")+"]"}}ze("<<");for(var Xi=0;Xi<An.length;Xi++)ze("/"+An[Xi].key+" "+An[Xi].value);ze(">>"),Xr.data.length!==0&&(ze("stream"),ze(Or(Xr.data)),ze("endstream"))},yi=v.__private__.putPage=function(U){var he=U.number,ke=U.data,nt=U.objId,Bt=U.contentsObjId;en(nt,!0),ze("<</Type /Page"),ze("/Parent "+U.rootDictionaryObjId+" 0 R"),ze("/Resources "+U.resourceDictionaryObjId+" 0 R"),ze("/MediaBox ["+parseFloat(te(U.mediaBox.bottomLeftX))+" "+parseFloat(te(U.mediaBox.bottomLeftY))+" "+te(U.mediaBox.topRightX)+" "+te(U.mediaBox.topRightY)+"]"),U.cropBox!==null&&ze("/CropBox ["+te(U.cropBox.bottomLeftX)+" "+te(U.cropBox.bottomLeftY)+" "+te(U.cropBox.topRightX)+" "+te(U.cropBox.topRightY)+"]"),U.bleedBox!==null&&ze("/BleedBox ["+te(U.bleedBox.bottomLeftX)+" "+te(U.bleedBox.bottomLeftY)+" "+te(U.bleedBox.topRightX)+" "+te(U.bleedBox.topRightY)+"]"),U.trimBox!==null&&ze("/TrimBox ["+te(U.trimBox.bottomLeftX)+" "+te(U.trimBox.bottomLeftY)+" "+te(U.trimBox.topRightX)+" "+te(U.trimBox.topRightY)+"]"),U.artBox!==null&&ze("/ArtBox ["+te(U.artBox.bottomLeftX)+" "+te(U.artBox.bottomLeftY)+" "+te(U.artBox.topRightX)+" "+te(U.artBox.topRightY)+"]"),typeof U.userUnit=="number"&&U.userUnit!==1&&ze("/UserUnit "+U.userUnit),bt.publish("putPage",{objId:nt,pageContext:ht[he],pageNumber:he,page:ke}),ze("/Contents "+Bt+" 0 R"),ze(">>"),ze("endobj");var Vt=ke.join(`
`);return W===z.ADVANCED&&(Vt+=`
Q`),en(Bt,!0),Cn({data:Vt,filters:zn(),objectId:Bt}),ze("endobj"),nt},Un=v.__private__.putPages=function(){var U,he,ke=[];for(U=1;U<=Ze;U++)ht[U].objId=kr(),ht[U].contentsObjId=kr();for(U=1;U<=Ze;U++)ke.push(yi({number:U,data:qt[U],objId:ht[U].objId,contentsObjId:ht[U].contentsObjId,mediaBox:ht[U].mediaBox,cropBox:ht[U].cropBox,bleedBox:ht[U].bleedBox,trimBox:ht[U].trimBox,artBox:ht[U].artBox,userUnit:ht[U].userUnit,rootDictionaryObjId:Br,resourceDictionaryObjId:Sn}));en(Br,!0),ze("<</Type /Pages");var nt="/Kids [";for(he=0;he<Ze;he++)nt+=ke[he]+" 0 R ";ze(nt+"]"),ze("/Count "+Ze),ze(">>"),ze("endobj"),bt.publish("postPutPages")},ba=function(U){bt.publish("putFont",{font:U,out:ze,newObject:br,putStream:Cn}),U.isAlreadyPutted!==!0&&(U.objectNumber=br(),ze("<<"),ze("/Type /Font"),ze("/BaseFont /"+wp(U.postScriptName)),ze("/Subtype /Type1"),typeof U.encoding=="string"&&ze("/Encoding /"+U.encoding),ze("/FirstChar 32"),ze("/LastChar 255"),ze(">>"),ze("endobj"))},Ke=function(){for(var U in Be)Be.hasOwnProperty(U)&&(_===!1||_===!0&&w.hasOwnProperty(U))&&ba(Be[U])},Pr=function(U){U.objectNumber=br();var he=[];he.push({key:"Type",value:"/XObject"}),he.push({key:"Subtype",value:"/Form"}),he.push({key:"BBox",value:"["+[te(U.x),te(U.y),te(U.x+U.width),te(U.y+U.height)].join(" ")+"]"}),he.push({key:"Matrix",value:"["+U.matrix.toString()+"]"});var ke=U.pages[1].join(`
`);Cn({data:ke,additionalKeyValues:he,objectId:U.objectNumber}),ze("endobj")},cr=function(){for(var U in We)We.hasOwnProperty(U)&&Pr(We[U])},pn=function(U,he){var ke,nt=[],Bt=1/(he-1);for(ke=0;ke<1;ke+=Bt)nt.push(ke);if(nt.push(1),U[0].offset!=0){var Vt={offset:0,color:U[0].color};U.unshift(Vt)}if(U[U.length-1].offset!=1){var ur={offset:1,color:U[U.length-1].color};U.push(ur)}for(var Or="",Xr=0,An=0;An<nt.length;An++){for(ke=nt[An];ke>U[Xr+1].offset;)Xr++;var hn=U[Xr].offset,Rn=(ke-hn)/(U[Xr+1].offset-hn),bi=U[Xr].color,ii=U[Xr+1].color;Or+=De(Math.round((1-Rn)*bi[0]+Rn*ii[0]).toString(16))+De(Math.round((1-Rn)*bi[1]+Rn*ii[1]).toString(16))+De(Math.round((1-Rn)*bi[2]+Rn*ii[2]).toString(16))}return Or.trim()},di=function(U,he){he||(he=21);var ke=br(),nt=pn(U.colors,he),Bt=[];Bt.push({key:"FunctionType",value:"0"}),Bt.push({key:"Domain",value:"[0.0 1.0]"}),Bt.push({key:"Size",value:"["+he+"]"}),Bt.push({key:"BitsPerSample",value:"8"}),Bt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Bt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Cn({data:nt,additionalKeyValues:Bt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:ke}),ze("endobj"),U.objectNumber=br(),ze("<< /ShadingType "+U.type),ze("/ColorSpace /DeviceRGB");var Vt="/Coords ["+te(parseFloat(U.coords[0]))+" "+te(parseFloat(U.coords[1]))+" ";U.type===2?Vt+=te(parseFloat(U.coords[2]))+" "+te(parseFloat(U.coords[3])):Vt+=te(parseFloat(U.coords[2]))+" "+te(parseFloat(U.coords[3]))+" "+te(parseFloat(U.coords[4]))+" "+te(parseFloat(U.coords[5])),ze(Vt+="]"),U.matrix&&ze("/Matrix ["+U.matrix.toString()+"]"),ze("/Function "+ke+" 0 R"),ze("/Extend [true true]"),ze(">>"),ze("endobj")},As=function(U,he){var ke=kr(),nt=br();he.push({resourcesOid:ke,objectOid:nt}),U.objectNumber=nt;var Bt=[];Bt.push({key:"Type",value:"/Pattern"}),Bt.push({key:"PatternType",value:"1"}),Bt.push({key:"PaintType",value:"1"}),Bt.push({key:"TilingType",value:"1"}),Bt.push({key:"BBox",value:"["+U.boundingBox.map(te).join(" ")+"]"}),Bt.push({key:"XStep",value:te(U.xStep)}),Bt.push({key:"YStep",value:te(U.yStep)}),Bt.push({key:"Resources",value:ke+" 0 R"}),U.matrix&&Bt.push({key:"Matrix",value:"["+U.matrix.toString()+"]"}),Cn({data:U.stream,additionalKeyValues:Bt,objectId:U.objectNumber}),ze("endobj")},li=function(U){var he;for(he in _e)_e.hasOwnProperty(he)&&(_e[he]instanceof Gf?di(_e[he]):_e[he]instanceof xp&&As(_e[he],U))},xs=function(U){for(var he in U.objectNumber=br(),ze("<<"),U)switch(he){case"opacity":ze("/ca "+xe(U[he]));break;case"stroke-opacity":ze("/CA "+xe(U[he]))}ze(">>"),ze("endobj")},vo=function(){var U;for(U in je)je.hasOwnProperty(U)&&xs(je[U])},ss=function(){for(var U in ze("/XObject <<"),We)We.hasOwnProperty(U)&&We[U].objectNumber>=0&&ze("/"+U+" "+We[U].objectNumber+" 0 R");bt.publish("putXobjectDict"),ze(">>")},oh=function(){_n.oid=br(),ze("<<"),ze("/Filter /Standard"),ze("/V "+_n.v),ze("/R "+_n.r),ze("/U <"+_n.toHexString(_n.U)+">"),ze("/O <"+_n.toHexString(_n.O)+">"),ze("/P "+_n.P),ze(">>"),ze("endobj")},ef=function(){for(var U in ze("/Font <<"),Be)Be.hasOwnProperty(U)&&(_===!1||_===!0&&w.hasOwnProperty(U))&&ze("/"+U+" "+Be[U].objectNumber+" 0 R");ze(">>")},tf=function(){if(Object.keys(_e).length>0){for(var U in ze("/Shading <<"),_e)_e.hasOwnProperty(U)&&_e[U]instanceof Gf&&_e[U].objectNumber>=0&&ze("/"+U+" "+_e[U].objectNumber+" 0 R");bt.publish("putShadingPatternDict"),ze(">>")}},lc=function(U){if(Object.keys(_e).length>0){for(var he in ze("/Pattern <<"),_e)_e.hasOwnProperty(he)&&_e[he]instanceof v.TilingPattern&&_e[he].objectNumber>=0&&_e[he].objectNumber<U&&ze("/"+he+" "+_e[he].objectNumber+" 0 R");bt.publish("putTilingPatternDict"),ze(">>")}},Ml=function(){if(Object.keys(je).length>0){var U;for(U in ze("/ExtGState <<"),je)je.hasOwnProperty(U)&&je[U].objectNumber>=0&&ze("/"+U+" "+je[U].objectNumber+" 0 R");bt.publish("putGStateDict"),ze(">>")}},Di=function(U){en(U.resourcesOid,!0),ze("<<"),ze("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),ef(),tf(),lc(U.objectOid),Ml(),ss(),ze(">>"),ze("endobj")},$h=function(){var U=[];Ke(),vo(),cr(),li(U),bt.publish("putResources"),U.forEach(Di),Di({resourcesOid:Sn,objectOid:Number.MAX_SAFE_INTEGER}),bt.publish("postPutResources")},ll=function(){bt.publish("putAdditionalObjects");for(var U=0;U<nr.length;U++){var he=nr[U];en(he.objId,!0),ze(he.content),ze("endobj")}bt.publish("postPutAdditionalObjects")},ah=function(U){ce[U.fontName]=ce[U.fontName]||{},ce[U.fontName][U.fontStyle]=U.id},cc=function(U,he,ke,nt,Bt){var Vt={id:"F"+(Object.keys(Be).length+1).toString(10),postScriptName:U,fontName:he,fontStyle:ke,encoding:nt,isStandardFont:Bt||!1,metadata:{}};return bt.publish("addFont",{font:Vt,instance:this}),Be[Vt.id]=Vt,ah(Vt),Vt.id},rf=function(U){for(var he=0,ke=Jt.length;he<ke;he++){var nt=cc.call(this,U[he][0],U[he][1],U[he][2],Jt[he][3],!0);_===!1&&(w[nt]=!0);var Bt=U[he][0].split("-");ah({id:nt,fontName:Bt[0],fontStyle:Bt[1]||""})}bt.publish("addFonts",{fonts:Be,dictionary:ce})},Vs=function(U){return U.foo=function(){try{return U.apply(this,arguments)}catch(nt){var he=nt.stack||"";~he.indexOf(" at ")&&(he=he.split(" at ")[1]);var ke="Error in function "+he.split(`
`)[0].split("<")[0]+": "+nt.message;if(!ln.console)throw new Error(ke);ln.console.error(ke,nt),ln.alert&&alert(ke)}},U.foo.bar=U,U.foo},uc=function(U,he){var ke,nt,Bt,Vt,ur,Or,Xr,An,hn;if(Bt=(he=he||{}).sourceEncoding||"Unicode",ur=he.outputEncoding,(he.autoencode||ur)&&Be[Wr].metadata&&Be[Wr].metadata[Bt]&&Be[Wr].metadata[Bt].encoding&&(Vt=Be[Wr].metadata[Bt].encoding,!ur&&Be[Wr].encoding&&(ur=Be[Wr].encoding),!ur&&Vt.codePages&&(ur=Vt.codePages[0]),typeof ur=="string"&&(ur=Vt[ur]),ur)){for(Xr=!1,Or=[],ke=0,nt=U.length;ke<nt;ke++)(An=ur[U.charCodeAt(ke)])?Or.push(String.fromCharCode(An)):Or.push(U[ke]),Or[ke].charCodeAt(0)>>8&&(Xr=!0);U=Or.join("")}for(ke=U.length;Xr===void 0&&ke!==0;)U.charCodeAt(ke-1)>>8&&(Xr=!0),ke--;if(!Xr)return U;for(Or=he.noBOM?[]:[254,255],ke=0,nt=U.length;ke<nt;ke++){if((hn=(An=U.charCodeAt(ke))>>8)>>8)throw new Error("Character at position "+ke+" of string '"+U+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Or.push(hn),Or.push(An-(hn<<8))}return String.fromCharCode.apply(void 0,Or)},Ni=v.__private__.pdfEscape=v.pdfEscape=function(U,he){return uc(U,he).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},an=v.__private__.beginPage=function(U){qt[++Ze]=[],ht[Ze]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(U[0]),topRightY:Number(U[1])}},hu(Ze),Ot(qt[Te])},Yo=function(U,he){var ke,nt,Bt;switch(t=he||t,typeof U=="string"&&(ke=N(U.toLowerCase()),Array.isArray(ke)&&(nt=ke[0],Bt=ke[1])),Array.isArray(U)&&(nt=U[0]*vr,Bt=U[1]*vr),isNaN(nt)&&(nt=i[0],Bt=i[1]),(nt>14400||Bt>14400)&&(Ui.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),nt=Math.min(14400,nt),Bt=Math.min(14400,Bt)),i=[nt,Bt],t.substr(0,1)){case"l":Bt>nt&&(i=[Bt,nt]);break;case"p":nt>Bt&&(i=[Bt,nt])}an(i),lh(Ha),ze(Jn),_u!==0&&ze(_u+" J"),Wh!==0&&ze(Wh+" j"),bt.publish("addPage",{pageNumber:Ze})},dn=function(U){U>0&&U<=Ze&&(qt.splice(U,1),ht.splice(U,1),Ze--,Te>Ze&&(Te=Ze),this.setPage(Te))},hu=function(U){U>0&&U<=Ze&&(Te=U)},nf=v.__private__.getNumberOfPages=v.getNumberOfPages=function(){return qt.length-1},hc=function(U,he,ke){var nt,Bt=void 0;return ke=ke||{},U=U!==void 0?U:Be[Wr].fontName,he=he!==void 0?he:Be[Wr].fontStyle,nt=U.toLowerCase(),ce[nt]!==void 0&&ce[nt][he]!==void 0?Bt=ce[nt][he]:ce[U]!==void 0&&ce[U][he]!==void 0?Bt=ce[U][he]:ke.disableWarning===!1&&Ui.warn("Unable to look up font label for font '"+U+"', '"+he+"'. Refer to getFontList() for available fonts."),Bt||ke.noFallback||(Bt=ce.times[he])==null&&(Bt=ce.times.normal),Bt},Ei=v.__private__.putInfo=function(){var U=br(),he=function(nt){return nt};for(var ke in p!==null&&(he=_n.encryptor(U,0)),ze("<<"),ze("/Producer ("+Ni(he("jsPDF "+cn.version))+")"),Hr)Hr.hasOwnProperty(ke)&&Hr[ke]&&ze("/"+ke.substr(0,1).toUpperCase()+ke.substr(1)+" ("+Ni(he(Hr[ke]))+")");ze("/CreationDate ("+Ni(he(Je))+")"),ze(">>"),ze("endobj")},ki=v.__private__.putCatalog=function(U){var he=(U=U||{}).rootDictionaryObjId||Br;switch(br(),ze("<<"),ze("/Type /Catalog"),ze("/Pages "+he+" 0 R"),mr||(mr="fullwidth"),mr){case"fullwidth":ze("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ze("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ze("/OpenAction [3 0 R /Fit]");break;case"original":ze("/OpenAction [3 0 R /XYZ null null 1]");break;default:var ke=""+mr;ke.substr(ke.length-1)==="%"&&(mr=parseInt(mr)/100),typeof mr=="number"&&ze("/OpenAction [3 0 R /XYZ null null "+xe(mr)+"]")}switch(Er||(Er="continuous"),Er){case"continuous":ze("/PageLayout /OneColumn");break;case"single":ze("/PageLayout /SinglePage");break;case"two":case"twoleft":ze("/PageLayout /TwoColumnLeft");break;case"tworight":ze("/PageLayout /TwoColumnRight")}ar&&ze("/PageMode /"+ar),bt.publish("putCatalog"),ze(">>"),ze("endobj")},pi=v.__private__.putTrailer=function(){ze("trailer"),ze("<<"),ze("/Size "+(at+1)),ze("/Root "+at+" 0 R"),ze("/Info "+(at-1)+" 0 R"),p!==null&&ze("/Encrypt "+_n.oid+" 0 R"),ze("/ID [ <"+Ge+"> <"+Ge+"> ]"),ze(">>")},Gh=v.__private__.putHeader=function(){ze("%PDF-"+M),ze("%ºß¬à")},Bs=v.__private__.putXRef=function(){var U="0000000000";ze("xref"),ze("0 "+(at+1)),ze("0000000000 65535 f ");for(var he=1;he<=at;he++)typeof rt[he]=="function"?ze((U+rt[he]()).slice(-10)+" 00000 n "):rt[he]!==void 0?ze((U+rt[he]).slice(-10)+" 00000 n "):ze("0000000000 00000 n ")},Si=v.__private__.buildDocument=function(){wr(),Ot(xt),bt.publish("buildDocument"),Gh(),Un(),ll(),$h(),p!==null&&oh(),Ei(),ki();var U=vt;return Bs(),pi(),ze("startxref"),ze(""+U),ze("%%EOF"),Ot(qt[Te]),xt.join(`
`)},Wi=v.__private__.getBlob=function(U){return new Blob([Rr(U)],{type:"application/pdf"})},Ac=v.output=v.__private__.output=Vs(function(U,he){switch(typeof(he=he||{})=="string"?he={filename:he}:he.filename=he.filename||"generated.pdf",U){case void 0:return Si();case"save":v.save(he.filename);break;case"arraybuffer":return Rr(Si());case"blob":return Wi(Si());case"bloburi":case"bloburl":if(ln.URL!==void 0&&typeof ln.URL.createObjectURL=="function")return ln.URL&&ln.URL.createObjectURL(Wi(Si()))||void 0;Ui.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var ke="",nt=Si();try{ke=Gx(nt)}catch{ke=Gx(unescape(encodeURIComponent(nt)))}return"data:application/pdf;filename="+he.filename+";base64,"+ke;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ln)==="[object Window]"){var Bt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Vt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';he.pdfObjectUrl&&(Bt=he.pdfObjectUrl,Vt="");var ur='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Bt+'"'+Vt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(he)+");<\/script></body></html>",Or=ln.open();return Or!==null&&Or.document.write(ur),Or}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ln)==="[object Window]"){var Xr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(he.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+he.filename+'" width="500px" height="400px" /></body></html>',An=ln.open();if(An!==null){An.document.write(Xr);var hn=this;An.document.documentElement.querySelector("#pdfViewer").onload=function(){An.document.title=he.filename,An.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(hn.output("bloburl"))}}return An}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ln)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Rn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",he)+'"></iframe></body></html>',bi=ln.open();if(bi!==null&&(bi.document.write(Rn),bi.document.title=he.filename),bi||typeof safari>"u")return bi;break;case"datauri":case"dataurl":return ln.document.location.href=this.output("datauristring",he);default:return null}}),cl=function(U){return Array.isArray(pt)===!0&&pt.indexOf(U)>-1};switch(n){case"pt":vr=1;break;case"mm":vr=72/25.4;break;case"cm":vr=72/2.54;break;case"in":vr=72;break;case"px":vr=cl("px_scaling")==1?.75:96/72;break;case"pc":case"em":vr=12;break;case"ex":vr=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);vr=n}var _n=null;kt(),Ye();var Au=function(U){return p!==null?_n.encryptor(U,0):function(he){return he}},Zo=v.__private__.getPageInfo=v.getPageInfo=function(U){if(isNaN(U)||U%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ht[U].objId,pageNumber:U,pageContext:ht[U]}},tn=v.__private__.getPageInfoByObjId=function(U){if(isNaN(U)||U%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var he in ht)if(ht[he].objId===U)break;return Zo(he)},Do=v.__private__.getCurrentPageInfo=v.getCurrentPageInfo=function(){return{objId:ht[Te].objId,pageNumber:Te,pageContext:ht[Te]}};v.addPage=function(){return Yo.apply(this,arguments),this},v.setPage=function(){return hu.apply(this,arguments),Ot.call(this,qt[Te]),this},v.insertPage=function(U){return this.addPage(),this.movePage(Te,U),this},v.movePage=function(U,he){var ke,nt;if(U>he){ke=qt[U],nt=ht[U];for(var Bt=U;Bt>he;Bt--)qt[Bt]=qt[Bt-1],ht[Bt]=ht[Bt-1];qt[he]=ke,ht[he]=nt,this.setPage(he)}else if(U<he){ke=qt[U],nt=ht[U];for(var Vt=U;Vt<he;Vt++)qt[Vt]=qt[Vt+1],ht[Vt]=ht[Vt+1];qt[he]=ke,ht[he]=nt,this.setPage(he)}return this},v.deletePage=function(){return dn.apply(this,arguments),this},v.__private__.text=v.text=function(U,he,ke,nt,Bt){var Vt,ur,Or,Xr,An,hn,Rn,bi,ii,Xi=(nt=nt||{}).scope||this;if(typeof U=="number"&&typeof he=="number"&&(typeof ke=="string"||Array.isArray(ke))){var qs=ke;ke=he,he=U,U=qs}if(arguments[3]instanceof rr?(J("The transform parameter of text() with a Matrix value"),ii=Bt):(Or=arguments[4],Xr=arguments[5],ri(Rn=arguments[3])==="object"&&Rn!==null||(typeof Or=="string"&&(Xr=Or,Or=null),typeof Rn=="string"&&(Xr=Rn,Rn=null),typeof Rn=="number"&&(Or=Rn,Rn=null),nt={flags:Rn,angle:Or,align:Xr})),isNaN(he)||isNaN(ke)||U==null)throw new Error("Invalid arguments passed to jsPDF.text");if(U.length===0)return Xi;var ji="",ea=!1,wo=typeof nt.lineHeightFactor=="number"?nt.lineHeightFactor:za,hl=Xi.internal.scaleFactor;function of($n){return $n=$n.split("	").join(Array(nt.TabLen||9).join(" ")),Ni($n,Rn)}function wu($n){for(var si,Yi=$n.concat(),as=[],kl=Yi.length;kl--;)typeof(si=Yi.shift())=="string"?as.push(si):Array.isArray($n)&&(si.length===1||si[1]===void 0&&si[2]===void 0)?as.push(si[0]):as.push([si[0],si[1],si[2]]);return as}function xu($n,si){var Yi;if(typeof $n=="string")Yi=si($n)[0];else if(Array.isArray($n)){for(var as,kl,bc=$n.concat(),Ql=[],Mu=bc.length;Mu--;)typeof(as=bc.shift())=="string"?Ql.push(si(as)[0]):Array.isArray(as)&&typeof as[0]=="string"&&(kl=si(as[0],as[1],as[2]),Ql.push([kl[0],kl[1],kl[2]]));Yi=Ql}return Yi}var Bu=!1,Cu=!0;if(typeof U=="string")Bu=!0;else if(Array.isArray(U)){var Tu=U.concat();ur=[];for(var Al,vi=Tu.length;vi--;)(typeof(Al=Tu.shift())!="string"||Array.isArray(Al)&&typeof Al[0]!="string")&&(Cu=!1);Bu=Cu}if(Bu===!1)throw new Error('Type of text must be string or Array. "'+U+'" is not recognized.');typeof U=="string"&&(U=U.match(/[\r?\n]/)?U.split(/\r\n|\r|\n/g):[U]);var dc=tr/Xi.internal.scaleFactor,pc=dc*(wo-1);switch(nt.baseline){case"bottom":ke-=pc;break;case"top":ke+=dc-pc;break;case"hanging":ke+=dc-2*pc;break;case"middle":ke+=dc/2-pc}if((hn=nt.maxWidth||0)>0&&(typeof U=="string"?U=Xi.splitTextToSize(U,hn):Object.prototype.toString.call(U)==="[object Array]"&&(U=U.reduce(function($n,si){return $n.concat(Xi.splitTextToSize(si,hn))},[]))),Vt={text:U,x:he,y:ke,options:nt,mutex:{pdfEscape:Ni,activeFontKey:Wr,fonts:Be,activeFontSize:tr}},bt.publish("preProcessText",Vt),U=Vt.text,Or=(nt=Vt.options).angle,!(ii instanceof rr)&&Or&&typeof Or=="number"){Or*=Math.PI/180,nt.rotationDirection===0&&(Or=-Or),W===z.ADVANCED&&(Or=-Or);var Ll=Math.cos(Or),Ah=Math.sin(Or);ii=new rr(Ll,Ah,-Ah,Ll,0,0)}else Or&&Or instanceof rr&&(ii=Or);W!==z.ADVANCED||ii||(ii=Rt),(An=nt.charSpace||uh)!==void 0&&(ji+=te(oe(An))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(bi=nt.horizontalScale)!==void 0&&(ji+=te(100*bi)+` Tz
`),nt.lang;var ao=-1,Ol=nt.renderingMode!==void 0?nt.renderingMode:nt.stroke,Eu=Xi.internal.getCurrentPageInfo().pageContext;switch(Ol){case 0:case!1:case"fill":ao=0;break;case 1:case!0:case"stroke":ao=1;break;case 2:case"fillThenStroke":ao=2;break;case 3:case"invisible":ao=3;break;case 4:case"fillAndAddForClipping":ao=4;break;case 5:case"strokeAndAddPathForClipping":ao=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ao=6;break;case 7:case"addToPathForClipping":ao=7}var On=Eu.usedRenderingMode!==void 0?Eu.usedRenderingMode:-1;ao!==-1?ji+=ao+` Tr
`:On!==-1&&(ji+=`0 Tr
`),ao!==-1&&(Eu.usedRenderingMode=ao),Xr=nt.align||"left";var Ba,fh=tr*wo,af=Xi.internal.pageSize.getWidth(),Yh=Be[Wr];An=nt.charSpace||uh,hn=nt.maxWidth||0,Rn=Object.assign({autoencode:!0,noBOM:!0},nt.flags);var gc=[],mc=function($n){return Xi.getStringUnitWidth($n,{font:Yh,charSpace:An,fontSize:tr,doKerning:!1})*tr/hl};if(Object.prototype.toString.call(U)==="[object Array]"){var Ks;ur=wu(U),Xr!=="left"&&(Ba=ur.map(mc));var Ts,Va=0;if(Xr==="right"){he-=Ba[0],U=[],vi=ur.length;for(var ja=0;ja<vi;ja++)ja===0?(Ts=In(he),Ks=No(ke)):(Ts=oe(Va-Ba[ja]),Ks=-fh),U.push([ur[ja],Ts,Ks]),Va=Ba[ja]}else if(Xr==="center"){he-=Ba[0]/2,U=[],vi=ur.length;for(var xo=0;xo<vi;xo++)xo===0?(Ts=In(he),Ks=No(ke)):(Ts=oe((Va-Ba[xo])/2),Ks=-fh),U.push([ur[xo],Ts,Ks]),Va=Ba[xo]}else if(Xr==="left"){U=[],vi=ur.length;for(var $a=0;$a<vi;$a++)U.push(ur[$a])}else if(Xr==="justify"&&Yh.encoding==="Identity-H"){U=[],vi=ur.length,hn=hn!==0?hn:af;for(var os=0,$i=0;$i<vi;$i++)if(Ks=$i===0?No(ke):-fh,Ts=$i===0?In(he):os,$i<vi-1){var dh=oe((hn-Ba[$i])/(ur[$i].split(" ").length-1)),Ws=ur[$i].split(" ");U.push([Ws[0]+" ",Ts,Ks]),os=0;for(var Es=1;Es<Ws.length;Es++){var Ul=(mc(Ws[Es-1]+" "+Ws[Es])-mc(Ws[Es]))*hl+dh;Es==Ws.length-1?U.push([Ws[Es],Ul,0]):U.push([Ws[Es]+" ",Ul,0]),os-=Ul}}else U.push([ur[$i],Ts,Ks]);U.push(["",os,0])}else{if(Xr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(U=[],vi=ur.length,hn=hn!==0?hn:af,$i=0;$i<vi;$i++)Ks=$i===0?No(ke):-fh,Ts=$i===0?In(he):0,$i<vi-1?gc.push(te(oe((hn-Ba[$i])/(ur[$i].split(" ").length-1)))):gc.push(0),U.push([ur[$i],Ts,Ks])}}var Su=typeof nt.R2L=="boolean"?nt.R2L:Ut;Su===!0&&(U=xu(U,function($n,si,Yi){return[$n.split("").reverse().join(""),si,Yi]})),Vt={text:U,x:he,y:ke,options:nt,mutex:{pdfEscape:Ni,activeFontKey:Wr,fonts:Be,activeFontSize:tr}},bt.publish("postProcessText",Vt),U=Vt.text,ea=Vt.mutex.isHex||!1;var Dl=Be[Wr].encoding;Dl!=="WinAnsiEncoding"&&Dl!=="StandardEncoding"||(U=xu(U,function($n,si,Yi){return[of($n),si,Yi]})),ur=wu(U),U=[];for(var fl,_c,ta,Ca=0,Iu=1,Nl=Array.isArray(ur[0])?Iu:Ca,gn="",yc=function($n,si,Yi){var as="";return Yi instanceof rr?(Yi=typeof nt.angle=="number"?Nr(Yi,new rr(1,0,0,1,$n,si)):Nr(new rr(1,0,0,1,$n,si),Yi),W===z.ADVANCED&&(Yi=Nr(new rr(1,0,0,-1,0,0),Yi)),as=Yi.join(" ")+` Tm
`):as=te($n)+" "+te(si)+` Td
`,as},Ta=0;Ta<ur.length;Ta++){switch(gn="",Nl){case Iu:ta=(ea?"<":"(")+ur[Ta][0]+(ea?">":")"),fl=parseFloat(ur[Ta][1]),_c=parseFloat(ur[Ta][2]);break;case Ca:ta=(ea?"<":"(")+ur[Ta]+(ea?">":")"),fl=In(he),_c=No(ke)}gc!==void 0&&gc[Ta]!==void 0&&(gn=gc[Ta]+` Tw
`),Ta===0?U.push(gn+yc(fl,_c,ii)+ta):Nl===Ca?U.push(gn+ta):Nl===Iu&&U.push(gn+yc(fl,_c,ii)+ta)}U=Nl===Ca?U.join(` Tj
T* `):U.join(` Tj
`),U+=` Tj
`;var ra=`BT
/`;return ra+=Wr+" "+tr+` Tf
`,ra+=te(tr*wo)+` TL
`,ra+=Qo+`
`,ra+=ji,ra+=U,ze(ra+="ET"),w[Wr]=!0,Xi};var qh=v.__private__.clip=v.clip=function(U){return ze(U==="evenodd"?"W*":"W"),this};v.clipEvenOdd=function(){return qh("evenodd")},v.__private__.discardPath=v.discardPath=function(){return ze("n"),this};var Cs=v.__private__.isValidStyle=function(U){var he=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(U)!==-1&&(he=!0),he};v.__private__.setDefaultPathOperation=v.setDefaultPathOperation=function(U){return Cs(U)&&(d=U),this};var fu=v.__private__.getStyle=v.getStyle=function(U){var he=d;switch(U){case"D":case"S":he="S";break;case"F":he="f";break;case"FD":case"DF":he="B";break;case"f":case"f*":case"B":case"B*":he=U}return he},Zn=v.close=function(){return ze("h"),this};v.stroke=function(){return ze("S"),this},v.fill=function(U){return Qa("f",U),this},v.fillEvenOdd=function(U){return Qa("f*",U),this},v.fillStroke=function(U){return Qa("B",U),this},v.fillStrokeEvenOdd=function(U){return Qa("B*",U),this};var Qa=function(U,he){ri(he)==="object"?du(he,U):ze(U)},yn=function(U){U===null||W===z.ADVANCED&&U===void 0||(U=fu(U),ze(U))};function on(U,he,ke,nt,Bt){var Vt=new xp(he||this.boundingBox,ke||this.xStep,nt||this.yStep,this.gState,Bt||this.matrix);Vt.stream=this.stream;var ur=U+"$$"+this.cloneIndex+++"$$";return ir(ur,Vt),Vt}var du=function(U,he){var ke=Ue[U.key],nt=_e[ke];if(nt instanceof Gf)ze("q"),ze(En(he)),nt.gState&&v.setGState(nt.gState),ze(U.matrix.toString()+" cm"),ze("/"+ke+" sh"),ze("Q");else if(nt instanceof xp){var Bt=new rr(1,0,0,-1,0,xa());U.matrix&&(Bt=Bt.multiply(U.matrix||Rt),ke=on.call(nt,U.key,U.boundingBox,U.xStep,U.yStep,Bt).id),ze("q"),ze("/Pattern cs"),ze("/"+ke+" scn"),nt.gState&&v.setGState(nt.gState),ze(he),ze("Q")}},En=function(U){switch(U){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},ul=v.moveTo=function(U,he){return ze(te(oe(U))+" "+te(ge(he))+" m"),this},js=v.lineTo=function(U,he){return ze(te(oe(U))+" "+te(ge(he))+" l"),this},va=v.curveTo=function(U,he,ke,nt,Bt,Vt){return ze([te(oe(U)),te(ge(he)),te(oe(ke)),te(ge(nt)),te(oe(Bt)),te(ge(Vt)),"c"].join(" ")),this};v.__private__.line=v.line=function(U,he,ke,nt,Bt){if(isNaN(U)||isNaN(he)||isNaN(ke)||isNaN(nt)||!Cs(Bt))throw new Error("Invalid arguments passed to jsPDF.line");return W===z.COMPAT?this.lines([[ke-U,nt-he]],U,he,[1,1],Bt||"S"):this.lines([[ke-U,nt-he]],U,he,[1,1]).stroke()},v.__private__.lines=v.lines=function(U,he,ke,nt,Bt,Vt){var ur,Or,Xr,An,hn,Rn,bi,ii,Xi,qs,ji,ea;if(typeof U=="number"&&(ea=ke,ke=he,he=U,U=ea),nt=nt||[1,1],Vt=Vt||!1,isNaN(he)||isNaN(ke)||!Array.isArray(U)||!Array.isArray(nt)||!Cs(Bt)||typeof Vt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(ul(he,ke),ur=nt[0],Or=nt[1],An=U.length,qs=he,ji=ke,Xr=0;Xr<An;Xr++)(hn=U[Xr]).length===2?(qs=hn[0]*ur+qs,ji=hn[1]*Or+ji,js(qs,ji)):(Rn=hn[0]*ur+qs,bi=hn[1]*Or+ji,ii=hn[2]*ur+qs,Xi=hn[3]*Or+ji,qs=hn[4]*ur+qs,ji=hn[5]*Or+ji,va(Rn,bi,ii,Xi,qs,ji));return Vt&&Zn(),yn(Bt),this},v.path=function(U){for(var he=0;he<U.length;he++){var ke=U[he],nt=ke.c;switch(ke.op){case"m":ul(nt[0],nt[1]);break;case"l":js(nt[0],nt[1]);break;case"c":va.apply(this,nt);break;case"h":Zn()}}return this},v.__private__.rect=v.rect=function(U,he,ke,nt,Bt){if(isNaN(U)||isNaN(he)||isNaN(ke)||isNaN(nt)||!Cs(Bt))throw new Error("Invalid arguments passed to jsPDF.rect");return W===z.COMPAT&&(nt=-nt),ze([te(oe(U)),te(ge(he)),te(oe(ke)),te(oe(nt)),"re"].join(" ")),yn(Bt),this},v.__private__.triangle=v.triangle=function(U,he,ke,nt,Bt,Vt,ur){if(isNaN(U)||isNaN(he)||isNaN(ke)||isNaN(nt)||isNaN(Bt)||isNaN(Vt)||!Cs(ur))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[ke-U,nt-he],[Bt-ke,Vt-nt],[U-Bt,he-Vt]],U,he,[1,1],ur,!0),this},v.__private__.roundedRect=v.roundedRect=function(U,he,ke,nt,Bt,Vt,ur){if(isNaN(U)||isNaN(he)||isNaN(ke)||isNaN(nt)||isNaN(Bt)||isNaN(Vt)||!Cs(ur))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Or=4/3*(Math.SQRT2-1);return Bt=Math.min(Bt,.5*ke),Vt=Math.min(Vt,.5*nt),this.lines([[ke-2*Bt,0],[Bt*Or,0,Bt,Vt-Vt*Or,Bt,Vt],[0,nt-2*Vt],[0,Vt*Or,-Bt*Or,Vt,-Bt,Vt],[2*Bt-ke,0],[-Bt*Or,0,-Bt,-Vt*Or,-Bt,-Vt],[0,2*Vt-nt],[0,-Vt*Or,Bt*Or,-Vt,Bt,-Vt]],U+Bt,he,[1,1],ur,!0),this},v.__private__.ellipse=v.ellipse=function(U,he,ke,nt,Bt){if(isNaN(U)||isNaN(he)||isNaN(ke)||isNaN(nt)||!Cs(Bt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Vt=4/3*(Math.SQRT2-1)*ke,ur=4/3*(Math.SQRT2-1)*nt;return ul(U+ke,he),va(U+ke,he-ur,U+Vt,he-nt,U,he-nt),va(U-Vt,he-nt,U-ke,he-ur,U-ke,he),va(U-ke,he+ur,U-Vt,he+nt,U,he+nt),va(U+Vt,he+nt,U+ke,he+ur,U+ke,he),yn(Bt),this},v.__private__.circle=v.circle=function(U,he,ke,nt){if(isNaN(U)||isNaN(he)||isNaN(ke)||!Cs(nt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(U,he,ke,ke,nt)},v.setFont=function(U,he,ke){return ke&&(he=q(he,ke)),Wr=hc(U,he,{disableWarning:!1}),this};var pu=v.__private__.getFont=v.getFont=function(){return Be[hc.apply(v,arguments)]};v.__private__.getFontList=v.getFontList=function(){var U,he,ke={};for(U in ce)if(ce.hasOwnProperty(U))for(he in ke[U]=[],ce[U])ce[U].hasOwnProperty(he)&&ke[U].push(he);return ke},v.addFont=function(U,he,ke,nt,Bt){var Vt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Vt.indexOf(arguments[3])!==-1?Bt=arguments[3]:arguments[3]&&Vt.indexOf(arguments[3])==-1&&(ke=q(ke,nt)),Bt=Bt||"Identity-H",cc.call(this,U,he,ke,Bt)};var za,Ha=r.lineWidth||.200025,gu=v.__private__.getLineWidth=v.getLineWidth=function(){return Ha},lh=v.__private__.setLineWidth=v.setLineWidth=function(U){return Ha=U,ze(te(oe(U))+" w"),this};v.__private__.setLineDash=cn.API.setLineDash=cn.API.setLineDashPattern=function(U,he){if(U=U||[],he=he||0,isNaN(he)||!Array.isArray(U))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return U=U.map(function(ke){return te(oe(ke))}).join(" "),he=te(oe(he)),ze("["+U+"] "+he+" d"),this};var ch=v.__private__.getLineHeight=v.getLineHeight=function(){return tr*za};v.__private__.getLineHeight=v.getLineHeight=function(){return tr*za};var Kh=v.__private__.setLineHeightFactor=v.setLineHeightFactor=function(U){return typeof(U=U||1.15)=="number"&&(za=U),this},fc=v.__private__.getLineHeightFactor=v.getLineHeightFactor=function(){return za};Kh(r.lineHeight);var In=v.__private__.getHorizontalCoordinate=function(U){return oe(U)},No=v.__private__.getVerticalCoordinate=function(U){return W===z.ADVANCED?U:ht[Te].mediaBox.topRightY-ht[Te].mediaBox.bottomLeftY-oe(U)},Jo=v.__private__.getHorizontalCoordinateString=v.getHorizontalCoordinateString=function(U){return te(In(U))},ko=v.__private__.getVerticalCoordinateString=v.getVerticalCoordinateString=function(U){return te(No(U))},Jn=r.strokeColor||"0 G";v.__private__.getStrokeColor=v.getDrawColor=function(){return Ti(Jn)},v.__private__.setStrokeColor=v.setDrawColor=function(U,he,ke,nt){return Jn=Bn({ch1:U,ch2:he,ch3:ke,ch4:nt,pdfColorType:"draw",precision:2}),ze(Jn),this};var mu=r.fillColor||"0 g";v.__private__.getFillColor=v.getFillColor=function(){return Ti(mu)},v.__private__.setFillColor=v.setFillColor=function(U,he,ke,nt){return mu=Bn({ch1:U,ch2:he,ch3:ke,ch4:nt,pdfColorType:"fill",precision:2}),ze(mu),this};var Qo=r.textColor||"0 g",sf=v.__private__.getTextColor=v.getTextColor=function(){return Ti(Qo)};v.__private__.setTextColor=v.setTextColor=function(U,he,ke,nt){return Qo=Bn({ch1:U,ch2:he,ch3:ke,ch4:nt,pdfColorType:"text",precision:3}),this};var uh=r.charSpace,hh=v.__private__.getCharSpace=v.getCharSpace=function(){return parseFloat(uh||0)};v.__private__.setCharSpace=v.setCharSpace=function(U){if(isNaN(U))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return uh=U,this};var _u=0;v.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},v.__private__.setLineCap=v.setLineCap=function(U){var he=v.CapJoinStyles[U];if(he===void 0)throw new Error("Line cap style of '"+U+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return _u=he,ze(he+" J"),this};var Wh=0;v.__private__.setLineJoin=v.setLineJoin=function(U){var he=v.CapJoinStyles[U];if(he===void 0)throw new Error("Line join style of '"+U+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Wh=he,ze(he+" j"),this},v.__private__.setLineMiterLimit=v.__private__.setMiterLimit=v.setLineMiterLimit=v.setMiterLimit=function(U){if(U=U||0,isNaN(U))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ze(te(oe(U))+" M"),this},v.GState=B0,v.setGState=function(U){(U=typeof U=="string"?je[lt[U]]:yu(null,U)).equals(dt)||(ze("/"+U.id+" gs"),dt=U)};var yu=function(U,he){if(!U||!lt[U]){var ke=!1;for(var nt in je)if(je.hasOwnProperty(nt)&&je[nt].equals(he)){ke=!0;break}if(ke)he=je[nt];else{var Bt="GS"+(Object.keys(je).length+1).toString(10);je[Bt]=he,he.id=Bt}return U&&(lt[U]=he.id),bt.publish("addGState",he),he}};v.addGState=function(U,he){return yu(U,he),this},v.saveGraphicsState=function(){return ze("q"),de.push({key:Wr,size:tr,color:Qo}),this},v.restoreGraphicsState=function(){ze("Q");var U=de.pop();return Wr=U.key,tr=U.size,Qo=U.color,dt=null,this},v.setCurrentTransformationMatrix=function(U){return ze(U.toString()+" cm"),this},v.comment=function(U){return ze("#"+U),this};var wa=function(U,he){var ke=U||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return ke},set:function(Vt){isNaN(Vt)||(ke=parseFloat(Vt))}});var nt=he||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return nt},set:function(Vt){isNaN(Vt)||(nt=parseFloat(Vt))}});var Bt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Bt},set:function(Vt){Bt=Vt.toString()}}),this},$s=function(U,he,ke,nt){wa.call(this,U,he),this.type="rect";var Bt=ke||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Bt},set:function(ur){isNaN(ur)||(Bt=parseFloat(ur))}});var Vt=nt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Vt},set:function(ur){isNaN(ur)||(Vt=parseFloat(ur))}}),this},Pl=function(){this.page=Ze,this.currentPage=Te,this.pages=qt.slice(0),this.pagesContext=ht.slice(0),this.x=Qn,this.y=un,this.matrix=ni,this.width=bu(Te),this.height=xa(Te),this.outputDestination=gr,this.id="",this.objectNumber=-1};Pl.prototype.restore=function(){Ze=this.page,Te=this.currentPage,ht=this.pagesContext,qt=this.pages,Qn=this.x,un=this.y,ni=this.matrix,vu(Te,this.width),Rl(Te,this.height),gr=this.outputDestination};var Fl=function(U,he,ke,nt,Bt){sr.push(new Pl),Ze=Te=0,qt=[],Qn=U,un=he,ni=Bt,an([ke,nt])},Xh=function(U){if(hr[U])sr.pop().restore();else{var he=new Pl,ke="Xo"+(Object.keys(We).length+1).toString(10);he.id=ke,hr[U]=ke,We[ke]=he,bt.publish("addFormObject",he),sr.pop().restore()}};for(var Gs in v.beginFormObject=function(U,he,ke,nt,Bt){return Fl(U,he,ke,nt,Bt),this},v.endFormObject=function(U){return Xh(U),this},v.doFormObject=function(U,he){var ke=We[hr[U]];return ze("q"),ze(he.toString()+" cm"),ze("/"+ke.id+" Do"),ze("Q"),this},v.getFormObject=function(U){var he=We[hr[U]];return{x:he.x,y:he.y,width:he.width,height:he.height,matrix:he.matrix}},v.save=function(U,he){return U=U||"generated.pdf",(he=he||{}).returnPromise=he.returnPromise||!1,he.returnPromise===!1?($f(Wi(Si()),U),typeof $f.unload=="function"&&ln.setTimeout&&setTimeout($f.unload,911),this):new Promise(function(ke,nt){try{var Bt=$f(Wi(Si()),U);typeof $f.unload=="function"&&ln.setTimeout&&setTimeout($f.unload,911),ke(Bt)}catch(Vt){nt(Vt.message)}})},cn.API)cn.API.hasOwnProperty(Gs)&&(Gs==="events"&&cn.API.events.length?function(U,he){var ke,nt,Bt;for(Bt=he.length-1;Bt!==-1;Bt--)ke=he[Bt][0],nt=he[Bt][1],U.subscribe.apply(U,[ke].concat(typeof nt=="function"?[nt]:nt))}(bt,cn.API.events):v[Gs]=cn.API[Gs]);var bu=v.getPageWidth=function(U){return(ht[U=U||Te].mediaBox.topRightX-ht[U].mediaBox.bottomLeftX)/vr},vu=v.setPageWidth=function(U,he){ht[U].mediaBox.topRightX=he*vr+ht[U].mediaBox.bottomLeftX},xa=v.getPageHeight=function(U){return(ht[U=U||Te].mediaBox.topRightY-ht[U].mediaBox.bottomLeftY)/vr},Rl=v.setPageHeight=function(U,he){ht[U].mediaBox.topRightY=he*vr+ht[U].mediaBox.bottomLeftY};return v.internal={pdfEscape:Ni,getStyle:fu,getFont:pu,getFontSize:_r,getCharSpace:hh,getTextColor:sf,getLineHeight:ch,getLineHeightFactor:fc,getLineWidth:gu,write:$r,getHorizontalCoordinate:In,getVerticalCoordinate:No,getCoordinateString:Jo,getVerticalCoordinateString:ko,collections:{},newObject:br,newAdditionalObject:jr,newObjectDeferred:kr,newObjectDeferredBegin:en,getFilters:zn,putStream:Cn,events:bt,scaleFactor:vr,pageSize:{getWidth:function(){return bu(Te)},setWidth:function(U){vu(Te,U)},getHeight:function(){return xa(Te)},setHeight:function(U){Rl(Te,U)}},encryptionOptions:p,encryption:_n,getEncryptor:Au,output:Ac,getNumberOfPages:nf,pages:qt,out:ze,f2:xe,f3:se,getPageInfo:Zo,getPageInfoByObjId:tn,getCurrentPageInfo:Do,getPDFVersion:P,Point:wa,Rectangle:$s,Matrix:rr,hasHotfix:cl},Object.defineProperty(v.internal.pageSize,"width",{get:function(){return bu(Te)},set:function(U){vu(Te,U)},enumerable:!0,configurable:!0}),Object.defineProperty(v.internal.pageSize,"height",{get:function(){return xa(Te)},set:function(U){Rl(Te,U)},enumerable:!0,configurable:!0}),rf.call(v,Jt),Wr="F1",Yo(i,t),bt.publish("initialized"),v}vp.prototype.lsbFirstWord=function(r){return String.fromCharCode(r>>0&255,r>>8&255,r>>16&255,r>>24&255)},vp.prototype.toHexString=function(r){return r.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},vp.prototype.hexToBytes=function(r){for(var e=[],t=0;t<r.length;t+=2)e.push(String.fromCharCode(parseInt(r.substr(t,2),16)));return e.join("")},vp.prototype.processOwnerPassword=function(r,e){return Wx(Kx(e).substr(0,5),r)},vp.prototype.encryptor=function(r,e){var t=Kx(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&e,e>>8&255)).substr(0,10);return function(n){return Wx(t,n)}},B0.prototype.equals=function(r){var e,t="id,objectNumber,equals";if(!r||ri(r)!==ri(this))return!1;var n=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!r.hasOwnProperty(e)||this[e]!==r[e])return!1;n++}for(e in r)r.hasOwnProperty(e)&&t.indexOf(e)<0&&n--;return n===0},cn.API={events:[]},cn.version="2.5.2";var ys=cn.API,Xx=1,qf=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Bp=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},vn=function(r){return r.toFixed(2)},UA=function(r){return r.toFixed(5)};ys.__acroform__={};var il=function(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r},uL=function(r){return r*Xx},Yu=function(r){var e=new AL,t=Kr.internal.getHeight(r)||0,n=Kr.internal.getWidth(r)||0;return e.BBox=[0,0,Number(vn(n)),Number(vn(t))],e},mle=ys.__acroform__.setBit=function(r,e){if(r=r||0,e=e||0,isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|=1<<e},_le=ys.__acroform__.clearBit=function(r,e){if(r=r||0,e=e||0,isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&=~(1<<e)},yle=ys.__acroform__.getBit=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<e?1:0},Ls=ys.__acroform__.getBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return yle(r,e-1)},Os=ys.__acroform__.setBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return mle(r,e-1)},Us=ys.__acroform__.clearBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return _le(r,e-1)},ble=ys.__acroform__.calculateCoordinates=function(r,e){var t=e.internal.getHorizontalCoordinate,n=e.internal.getVerticalCoordinate,i=r[0],s=r[1],a=r[2],o=r[3],u={};return u.lowerLeft_X=t(i)||0,u.lowerLeft_Y=n(s+o)||0,u.upperRight_X=t(i+a)||0,u.upperRight_Y=n(s)||0,[Number(vn(u.lowerLeft_X)),Number(vn(u.lowerLeft_Y)),Number(vn(u.upperRight_X)),Number(vn(u.upperRight_Y))]},vle=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var e=[],t=r._V||r.DV,n=Yx(r,t),i=r.scope.internal.getFont(r.fontName,r.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(r.scope.__private__.encodeColorString(r.color)),e.push("/"+i+" "+vn(n.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC");var s=Yu(r);return s.scope=r.scope,s.stream=e.join(`
`),s}},Yx=function(r,e){var t=r.fontSize===0?r.maxFontSize:r.fontSize,n={text:"",fontSize:""},i=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");i=r.multiline?i.map(function(se){return se.split(`
`)}):i.map(function(se){return[se]});var s=t,a=Kr.internal.getHeight(r)||0;a=a<0?-a:a;var o=Kr.internal.getWidth(r)||0;o=o<0?-o:o;var u=function(se,oe,ve){if(se+1<i.length){var ge=oe+" "+i[se+1][0];return C0(ge,r,ve).width<=o-4}return!1};s++;e:for(;s>0;){e="",s--;var d,p,_=C0("3",r,s).height,w=r.multiline?a-s:(a-_)/2,v=w+=2,M=0,P=0,D=0;if(s<=0){e=`(...) Tj
`,e+="% Width of Text: "+C0(e,r,s=12).width+", FieldWidth:"+o+`
`;break}for(var N="",z=0,W=0;W<i.length;W++)if(i.hasOwnProperty(W)){var V=!1;if(i[W].length!==1&&D!==i[W].length-1){if((_+2)*(z+2)+2>a)continue e;N+=i[W][D],V=!0,P=W,W--}else{N=(N+=i[W][D]+" ").substr(N.length-1)==" "?N.substr(0,N.length-1):N;var $=parseInt(W),q=u($,N,s),te=W>=i.length-1;if(q&&!te){N+=" ",D=0;continue}if(q||te){if(te)P=$;else if(r.multiline&&(_+2)*(z+2)+2>a)continue e}else{if(!r.multiline||(_+2)*(z+2)+2>a)continue e;P=$}}for(var J="",me=M;me<=P;me++){var xe=i[me];if(r.multiline){if(me===P){J+=xe[D]+" ",D=(D+1)%xe.length;continue}if(me===M){J+=xe[xe.length-1]+" ";continue}}J+=xe[0]+" "}switch(J=J.substr(J.length-1)==" "?J.substr(0,J.length-1):J,p=C0(J,r,s).width,r.textAlign){case"right":d=o-p-2;break;case"center":d=(o-p)/2;break;case"left":default:d=2}e+=vn(d)+" "+vn(v)+` Td
`,e+="("+qf(J)+`) Tj
`,e+=-vn(d)+` 0 Td
`,v=-(s+2),p=0,M=V?P:P+1,z++,N=""}break}return n.text=e,n.fontSize=s,n},C0=function(r,e,t){var n=e.scope.internal.getFont(e.fontName,e.fontStyle),i=e.scope.getStringUnitWidth(r,{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:i}},wle={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},xle=function(r,e){var t={type:"reference",object:r};e.internal.getPageInfo(r.page).pageContext.annotations.find(function(n){return n.type===t.type&&n.object===t.object})===void 0&&e.internal.getPageInfo(r.page).pageContext.annotations.push(t)},Ble=function(r,e){for(var t in r)if(r.hasOwnProperty(t)){var n=t,i=r[t];e.internal.newObjectDeferredBegin(i.objId,!0),ri(i)==="object"&&typeof i.putStream=="function"&&i.putStream(),delete r[n]}},Cle=function(r,e){if(e.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(Wc.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(wle)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Xx=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new fL,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s.objId=void 0,s.hasAnnotation&&xle(s,t)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(t){(function(n,i){var s=!n;for(var a in n||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(a)){var o=n[a],u=[],d=o.Rect;if(o.Rect&&(o.Rect=ble(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=Kr.createDefaultAppearanceStream(o),ri(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(u=o.getKeyValueListForStream()),o.Rect=d,o.hasAppearanceStream&&!o.appearanceStreamContent){var p=vle(o);u.push({key:"AP",value:"<</N "+p+">>"}),i.internal.acroformPlugin.xForms.push(p)}if(o.appearanceStreamContent){var _="";for(var w in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(w)){var v=o.appearanceStreamContent[w];if(_+="/"+w+" ",_+="<<",Object.keys(v).length>=1||Array.isArray(v)){for(var a in v)if(v.hasOwnProperty(a)){var M=v[a];typeof M=="function"&&(M=M.call(i,o)),_+="/"+a+" "+M+" ",i.internal.acroformPlugin.xForms.indexOf(M)>=0||i.internal.acroformPlugin.xForms.push(M)}}else typeof(M=v)=="function"&&(M=M.call(i,o)),_+="/"+a+" "+M,i.internal.acroformPlugin.xForms.indexOf(M)>=0||i.internal.acroformPlugin.xForms.push(M);_+=">>"}u.push({key:"AP",value:`<<
`+_+">>"})}i.internal.putStream({additionalKeyValues:u,objectId:o.objId}),i.internal.out("endobj")}s&&Ble(i.internal.acroformPlugin.xForms,i)})(t,r)}),r.internal.acroformPlugin.isInitialized=!0}},hL=ys.__acroform__.arrayToPdfArray=function(r,e,t){var n=function(a){return a};if(Array.isArray(r)){for(var i="[",s=0;s<r.length;s++)switch(s!==0&&(i+=" "),ri(r[s])){case"boolean":case"number":case"object":i+=r[s].toString();break;case"string":r[s].substr(0,1)!=="/"?(e!==void 0&&t&&(n=t.internal.getEncryptor(e)),i+="("+qf(n(r[s].toString()))+")"):i+=r[s].toString()}return i+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Zx=function(r,e,t){var n=function(i){return i};return e!==void 0&&t&&(n=t.internal.getEncryptor(e)),(r=r||"").toString(),r="("+qf(n(r))+")"},Zu=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Zu.prototype.toString=function(){return this.objId+" 0 R"},Zu.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},Zu.prototype.getKeyValueListForStream=function(){var r=[],e=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var n=e[t],i=this[n];i&&(Array.isArray(i)?r.push({key:n,value:hL(i,this.objId,this.scope)}):i instanceof Zu?(i.scope=this.scope,r.push({key:n,value:i.objId+" 0 R"})):typeof i!="function"&&r.push({key:n,value:i}))}return r};var AL=function(){Zu.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){r=t.trim()},get:function(){return r||null}})};il(AL,Zu);var fL=function(){Zu.call(this);var r,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var t=function(n){return n};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+qf(t(r))+")"}},set:function(t){r=t}})};il(fL,Zu);var Wc=function r(){Zu.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(N){if(isNaN(N))throw new Error('Invalid value "'+N+'" for attribute F supplied.');e=N}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Ls(e,3)},set:function(N){N?this.F=Os(e,3):this.F=Us(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(N){if(isNaN(N))throw new Error('Invalid value "'+N+'" for attribute Ff supplied.');t=N}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(N){n=N!==void 0?N:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(N){n[0]=N}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(N){n[1]=N}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(N){n[2]=N}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(N){n[3]=N}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(N){switch(N){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=N;break;default:throw new Error('Invalid value "'+N+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof S0)return;s="FieldObject"+r.FieldNum++}var N=function(z){return z};return this.scope&&(N=this.scope.internal.getEncryptor(this.objId)),"("+qf(N(s))+")"},set:function(N){s=N.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(N){s=N}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(N){a=N}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(N){o=N}});var u=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return u},set:function(N){u=N}});var d=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return d===void 0?50/Xx:d},set:function(N){d=N}});var p="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return p},set:function(N){p=N}});var _="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!_||this instanceof S0||this instanceof Kf))return Zx(_,this.objId,this.scope)},set:function(N){N=N.toString(),_=N}});var w=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(w)return this instanceof Lo?w:Zx(w,this.objId,this.scope)},set:function(N){N=N.toString(),w=this instanceof Lo?N:N.substr(0,1)==="("?Bp(N.substr(1,N.length-2)):Bp(N)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Lo?Bp(w.substr(1,w.length-1)):w},set:function(N){N=N.toString(),w=this instanceof Lo?"/"+N:N}});var v=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(v)return v},set:function(N){this.V=N}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(v)return this instanceof Lo?v:Zx(v,this.objId,this.scope)},set:function(N){N=N.toString(),v=this instanceof Lo?N:N.substr(0,1)==="("?Bp(N.substr(1,N.length-2)):Bp(N)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Lo?Bp(v.substr(1,v.length-1)):v},set:function(N){N=N.toString(),v=this instanceof Lo?"/"+N:N}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var M,P=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return P},set:function(N){N=!!N,P=N}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(M)return M},set:function(N){M=N}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,1)},set:function(N){N?this.Ff=Os(this.Ff,1):this.Ff=Us(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,2)},set:function(N){N?this.Ff=Os(this.Ff,2):this.Ff=Us(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,3)},set:function(N){N?this.Ff=Os(this.Ff,3):this.Ff=Us(this.Ff,3)}});var D=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(D!==null)return D},set:function(N){if([0,1,2].indexOf(N)===-1)throw new Error('Invalid value "'+N+'" for attribute Q supplied.');D=N}}),Object.defineProperty(this,"textAlign",{get:function(){var N;switch(D){case 0:default:N="left";break;case 1:N="center";break;case 2:N="right"}return N},configurable:!0,enumerable:!0,set:function(N){switch(N){case"right":case 2:D=2;break;case"center":case 1:D=1;break;case"left":case 0:default:D=0}}})};il(Wc,Zu);var Cp=function(){Wc.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){r=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return hL(e,this.objId,this.scope)},set:function(t){var n,i;i=[],typeof(n=t)=="string"&&(i=function(s,a,o){o||(o=1);for(var u,d=[];u=a.exec(s);)d.push(u[o]);return d}(n,/\((.*?)\)/g)),e=i}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,n){for(n=n||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,18)},set:function(t){t?this.Ff=Os(this.Ff,18):this.Ff=Us(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Os(this.Ff,19):this.Ff=Us(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,20)},set:function(t){t?(this.Ff=Os(this.Ff,20),e.sort()):this.Ff=Us(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,22)},set:function(t){t?this.Ff=Os(this.Ff,22):this.Ff=Us(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,23)},set:function(t){t?this.Ff=Os(this.Ff,23):this.Ff=Us(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,27)},set:function(t){t?this.Ff=Os(this.Ff,27):this.Ff=Us(this.Ff,27)}}),this.hasAppearanceStream=!1};il(Cp,Wc);var Tp=function(){Cp.call(this),this.fontName="helvetica",this.combo=!1};il(Tp,Cp);var Ep=function(){Tp.call(this),this.combo=!0};il(Ep,Tp);var T0=function(){Ep.call(this),this.edit=!0};il(T0,Ep);var Lo=function(){Wc.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,15)},set:function(t){t?this.Ff=Os(this.Ff,15):this.Ff=Us(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,16)},set:function(t){t?this.Ff=Os(this.Ff,16):this.Ff=Us(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,17)},set:function(t){t?this.Ff=Os(this.Ff,17):this.Ff=Us(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,26)},set:function(t){t?this.Ff=Os(this.Ff,26):this.Ff=Us(this.Ff,26)}});var r,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(s){return s};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var n,i=[];for(n in i.push("<<"),e)i.push("/"+n+" ("+qf(t(e[n]))+")");return i.push(">>"),i.join(`
`)}},set:function(t){ri(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(t){r="/"+t}})};il(Lo,Wc);var E0=function(){Lo.call(this),this.pushButton=!0};il(E0,Lo);var Sp=function(){Lo.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e!==void 0?e:[]}})};il(Sp,Lo);var S0=function(){var r,e;Wc.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(i){r=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(i){e=i}});var t,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),n)a.push("/"+s+" ("+qf(i(n[s]))+")");return a.push(">>"),a.join(`
`)},set:function(i){ri(i)==="object"&&(n=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(i){typeof i=="string"&&(n.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(i){t=i}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(i){t="/"+i}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Kr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};il(S0,Wc),Sp.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=r.createAppearanceStream(t.optionName),t.caption=r.getCA()}},Sp.prototype.createOption=function(r){var e=new S0;return e.Parent=this,e.optionName=r,this.Kids.push(e),Tle.call(this.scope,e),e};var I0=function(){Lo.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Kr.CheckBox.createAppearanceStream()};il(I0,Lo);var Kf=function(){Wc.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,13)},set:function(e){e?this.Ff=Os(this.Ff,13):this.Ff=Us(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,21)},set:function(e){e?this.Ff=Os(this.Ff,21):this.Ff=Us(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,23)},set:function(e){e?this.Ff=Os(this.Ff,23):this.Ff=Us(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,24)},set:function(e){e?this.Ff=Os(this.Ff,24):this.Ff=Us(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,25)},set:function(e){e?this.Ff=Os(this.Ff,25):this.Ff=Us(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,26)},set:function(e){e?this.Ff=Os(this.Ff,26):this.Ff=Us(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){Number.isInteger(e)&&(r=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};il(Kf,Wc);var M0=function(){Kf.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,14)},set:function(r){r?this.Ff=Os(this.Ff,14):this.Ff=Us(this.Ff,14)}}),this.password=!0};il(M0,Kf);var Kr={CheckBox:{createAppearanceStream:function(){return{N:{On:Kr.CheckBox.YesNormal},D:{On:Kr.CheckBox.YesPushDown,Off:Kr.CheckBox.OffPushDown}}},YesPushDown:function(r){var e=Yu(r);e.scope=r.scope;var t=[],n=r.scope.internal.getFont(r.fontName,r.fontStyle).id,i=r.scope.__private__.encodeColorString(r.color),s=Yx(r,r.caption);return t.push("0.749023 g"),t.push("0 0 "+vn(Kr.internal.getWidth(r))+" "+vn(Kr.internal.getHeight(r))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+n+" "+vn(s.fontSize)+" Tf "+i),t.push("BT"),t.push(s.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(r){var e=Yu(r);e.scope=r.scope;var t=r.scope.internal.getFont(r.fontName,r.fontStyle).id,n=r.scope.__private__.encodeColorString(r.color),i=[],s=Kr.internal.getHeight(r),a=Kr.internal.getWidth(r),o=Yx(r,r.caption);return i.push("1 g"),i.push("0 0 "+vn(a)+" "+vn(s)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+vn(a-1)+" "+vn(s-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+t+" "+vn(o.fontSize)+" Tf "+n),i.push(o.text),i.push("ET"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(r){var e=Yu(r);e.scope=r.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+vn(Kr.internal.getWidth(r))+" "+vn(Kr.internal.getHeight(r))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(r){var e={D:{Off:Kr.RadioButton.Circle.OffPushDown},N:{}};return e.N[r]=Kr.RadioButton.Circle.YesNormal,e.D[r]=Kr.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(r){var e=Yu(r);e.scope=r.scope;var t=[],n=Kr.internal.getWidth(r)<=Kr.internal.getHeight(r)?Kr.internal.getWidth(r)/4:Kr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Kr.internal.Bezier_C,s=Number((n*i).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+UA(Kr.internal.getWidth(r)/2)+" "+UA(Kr.internal.getHeight(r)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),t.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),t.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),t.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(r){var e=Yu(r);e.scope=r.scope;var t=[],n=Kr.internal.getWidth(r)<=Kr.internal.getHeight(r)?Kr.internal.getWidth(r)/4:Kr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Kr.internal.Bezier_C).toFixed(5)),a=Number((n*Kr.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+UA(Kr.internal.getWidth(r)/2)+" "+UA(Kr.internal.getHeight(r)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),t.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),t.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),t.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+UA(Kr.internal.getWidth(r)/2)+" "+UA(Kr.internal.getHeight(r)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+a+" "+a+" "+n+" 0 "+n+" c"),t.push("-"+a+" "+n+" -"+n+" "+a+" -"+n+" 0 c"),t.push("-"+n+" -"+a+" -"+a+" -"+n+" 0 -"+n+" c"),t.push(a+" -"+n+" "+n+" -"+a+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(r){var e=Yu(r);e.scope=r.scope;var t=[],n=Kr.internal.getWidth(r)<=Kr.internal.getHeight(r)?Kr.internal.getWidth(r)/4:Kr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Kr.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+UA(Kr.internal.getWidth(r)/2)+" "+UA(Kr.internal.getHeight(r)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),t.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),t.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),t.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(r){var e={D:{Off:Kr.RadioButton.Cross.OffPushDown},N:{}};return e.N[r]=Kr.RadioButton.Cross.YesNormal,e.D[r]=Kr.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(r){var e=Yu(r);e.scope=r.scope;var t=[],n=Kr.internal.calculateCross(r);return t.push("q"),t.push("1 1 "+vn(Kr.internal.getWidth(r)-2)+" "+vn(Kr.internal.getHeight(r)-2)+" re"),t.push("W"),t.push("n"),t.push(vn(n.x1.x)+" "+vn(n.x1.y)+" m"),t.push(vn(n.x2.x)+" "+vn(n.x2.y)+" l"),t.push(vn(n.x4.x)+" "+vn(n.x4.y)+" m"),t.push(vn(n.x3.x)+" "+vn(n.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(r){var e=Yu(r);e.scope=r.scope;var t=Kr.internal.calculateCross(r),n=[];return n.push("0.749023 g"),n.push("0 0 "+vn(Kr.internal.getWidth(r))+" "+vn(Kr.internal.getHeight(r))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+vn(Kr.internal.getWidth(r)-2)+" "+vn(Kr.internal.getHeight(r)-2)+" re"),n.push("W"),n.push("n"),n.push(vn(t.x1.x)+" "+vn(t.x1.y)+" m"),n.push(vn(t.x2.x)+" "+vn(t.x2.y)+" l"),n.push(vn(t.x4.x)+" "+vn(t.x4.y)+" m"),n.push(vn(t.x3.x)+" "+vn(t.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(r){var e=Yu(r);e.scope=r.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+vn(Kr.internal.getWidth(r))+" "+vn(Kr.internal.getHeight(r))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(r){var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,t=r.scope.__private__.encodeColorString(r.color);return"/"+e+" "+r.fontSize+" Tf "+t}};Kr.internal={Bezier_C:.551915024494,calculateCross:function(r){var e=Kr.internal.getWidth(r),t=Kr.internal.getHeight(r),n=Math.min(e,t);return{x1:{x:(e-n)/2,y:(t-n)/2+n},x2:{x:(e-n)/2+n,y:(t-n)/2},x3:{x:(e-n)/2,y:(t-n)/2},x4:{x:(e-n)/2+n,y:(t-n)/2+n}}}},Kr.internal.getWidth=function(r){var e=0;return ri(r)==="object"&&(e=uL(r.Rect[2])),e},Kr.internal.getHeight=function(r){var e=0;return ri(r)==="object"&&(e=uL(r.Rect[3])),e};var Tle=ys.addField=function(r){if(Cle(this,r),!(r instanceof Wc))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=r).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};ys.AcroFormChoiceField=Cp,ys.AcroFormListBox=Tp,ys.AcroFormComboBox=Ep,ys.AcroFormEditBox=T0,ys.AcroFormButton=Lo,ys.AcroFormPushButton=E0,ys.AcroFormRadioButton=Sp,ys.AcroFormCheckBox=I0,ys.AcroFormTextField=Kf,ys.AcroFormPasswordField=M0,ys.AcroFormAppearance=Kr,ys.AcroForm={ChoiceField:Cp,ListBox:Tp,ComboBox:Ep,EditBox:T0,Button:Lo,PushButton:E0,RadioButton:Sp,CheckBox:I0,TextField:Kf,PasswordField:M0,Appearance:Kr},cn.AcroForm={ChoiceField:Cp,ListBox:Tp,ComboBox:Ep,EditBox:T0,Button:Lo,PushButton:E0,RadioButton:Sp,CheckBox:I0,TextField:Kf,PasswordField:M0,Appearance:Kr};function dL(r){return r.reduce(function(e,t,n){return e[t]=n,e},{})}(function(r){r.__addimage__={};var e="UNKNOWN",t={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=r.__addimage__.getImageFileTypeByImageData=function(se,oe){var ve,ge,Je,Ge,et,Ye=e;if((oe=oe||e)==="RGBA"||se.data!==void 0&&se.data instanceof Uint8ClampedArray&&"height"in se&&"width"in se)return"RGBA";if(q(se))for(et in t)for(Je=t[et],ve=0;ve<Je.length;ve+=1){for(Ge=!0,ge=0;ge<Je[ve].length;ge+=1)if(Je[ve][ge]!==void 0&&Je[ve][ge]!==se[ge]){Ge=!1;break}if(Ge===!0){Ye=et;break}}else for(et in t)for(Je=t[et],ve=0;ve<Je.length;ve+=1){for(Ge=!0,ge=0;ge<Je[ve].length;ge+=1)if(Je[ve][ge]!==void 0&&Je[ve][ge]!==se.charCodeAt(ge)){Ge=!1;break}if(Ge===!0){Ye=et;break}}return Ye===e&&oe!==e&&(Ye=oe),Ye},i=function se(oe){for(var ve=this.internal.write,ge=this.internal.putStream,Je=(0,this.internal.getFilters)();Je.indexOf("FlateEncode")!==-1;)Je.splice(Je.indexOf("FlateEncode"),1);oe.objectId=this.internal.newObject();var Ge=[];if(Ge.push({key:"Type",value:"/XObject"}),Ge.push({key:"Subtype",value:"/Image"}),Ge.push({key:"Width",value:oe.width}),Ge.push({key:"Height",value:oe.height}),oe.colorSpace===D.INDEXED?Ge.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(oe.palette.length/3-1)+" "+("sMask"in oe&&oe.sMask!==void 0?oe.objectId+2:oe.objectId+1)+" 0 R]"}):(Ge.push({key:"ColorSpace",value:"/"+oe.colorSpace}),oe.colorSpace===D.DEVICE_CMYK&&Ge.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Ge.push({key:"BitsPerComponent",value:oe.bitsPerComponent}),"decodeParameters"in oe&&oe.decodeParameters!==void 0&&Ge.push({key:"DecodeParms",value:"<<"+oe.decodeParameters+">>"}),"transparency"in oe&&Array.isArray(oe.transparency)){for(var et="",Ye=0,ct=oe.transparency.length;Ye<ct;Ye++)et+=oe.transparency[Ye]+" "+oe.transparency[Ye]+" ";Ge.push({key:"Mask",value:"["+et+"]"})}oe.sMask!==void 0&&Ge.push({key:"SMask",value:oe.objectId+1+" 0 R"});var At=oe.filter!==void 0?["/"+oe.filter]:void 0;if(ge({data:oe.data,additionalKeyValues:Ge,alreadyAppliedFilters:At,objectId:oe.objectId}),ve("endobj"),"sMask"in oe&&oe.sMask!==void 0){var kt="/Predictor "+oe.predictor+" /Colors 1 /BitsPerComponent "+oe.bitsPerComponent+" /Columns "+oe.width,ae={width:oe.width,height:oe.height,colorSpace:"DeviceGray",bitsPerComponent:oe.bitsPerComponent,decodeParameters:kt,data:oe.sMask};"filter"in oe&&(ae.filter=oe.filter),se.call(this,ae)}if(oe.colorSpace===D.INDEXED){var Te=this.internal.newObject();ge({data:J(new Uint8Array(oe.palette)),objectId:Te}),ve("endobj")}},s=function(){var se=this.internal.collections.addImage_images;for(var oe in se)i.call(this,se[oe])},a=function(){var se,oe=this.internal.collections.addImage_images,ve=this.internal.write;for(var ge in oe)ve("/I"+(se=oe[ge]).index,se.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",a))},u=function(){var se=this.internal.collections.addImage_images;return o.call(this),se},d=function(){return Object.keys(this.internal.collections.addImage_images).length},p=function(se){return typeof r["process"+se.toUpperCase()]=="function"},_=function(se){return ri(se)==="object"&&se.nodeType===1},w=function(se,oe){if(se.nodeName==="IMG"&&se.hasAttribute("src")){var ve=""+se.getAttribute("src");if(ve.indexOf("data:image/")===0)return dm(unescape(ve).split("base64,").pop());var ge=r.loadFile(ve,!0);if(ge!==void 0)return ge}if(se.nodeName==="CANVAS"){if(se.width===0||se.height===0)throw new Error("Given canvas must have data. Canvas width: "+se.width+", height: "+se.height);var Je;switch(oe){case"PNG":Je="image/png";break;case"WEBP":Je="image/webp";break;case"JPEG":case"JPG":default:Je="image/jpeg"}return dm(se.toDataURL(Je,1).split("base64,").pop())}},v=function(se){var oe=this.internal.collections.addImage_images;if(oe){for(var ve in oe)if(se===oe[ve].alias)return oe[ve]}},M=function(se,oe,ve){return se||oe||(se=-96,oe=-96),se<0&&(se=-1*ve.width*72/se/this.internal.scaleFactor),oe<0&&(oe=-1*ve.height*72/oe/this.internal.scaleFactor),se===0&&(se=oe*ve.width/ve.height),oe===0&&(oe=se*ve.height/ve.width),[se,oe]},P=function(se,oe,ve,ge,Je,Ge){var et=M.call(this,ve,ge,Je),Ye=this.internal.getCoordinateString,ct=this.internal.getVerticalCoordinateString,At=u.call(this);if(ve=et[0],ge=et[1],At[Je.index]=Je,Ge){Ge*=Math.PI/180;var kt=Math.cos(Ge),ae=Math.sin(Ge),Te=function(De){return De.toFixed(4)},Le=[Te(kt),Te(ae),Te(-1*ae),Te(kt),0,0,"cm"]}this.internal.write("q"),Ge?(this.internal.write([1,"0","0",1,Ye(se),ct(oe+ge),"cm"].join(" ")),this.internal.write(Le.join(" ")),this.internal.write([Ye(ve),"0","0",Ye(ge),"0","0","cm"].join(" "))):this.internal.write([Ye(ve),"0","0",Ye(ge),Ye(se),ct(oe+ge),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Je.index+" Do"),this.internal.write("Q")},D=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var N=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},z=r.__addimage__.sHashCode=function(se){var oe,ve,ge=0;if(typeof se=="string")for(ve=se.length,oe=0;oe<ve;oe++)ge=(ge<<5)-ge+se.charCodeAt(oe),ge|=0;else if(q(se))for(ve=se.byteLength/2,oe=0;oe<ve;oe++)ge=(ge<<5)-ge+se[oe],ge|=0;return ge},W=r.__addimage__.validateStringAsBase64=function(se){(se=se||"").toString().trim();var oe=!0;return se.length===0&&(oe=!1),se.length%4!=0&&(oe=!1),/^[A-Za-z0-9+/]+$/.test(se.substr(0,se.length-2))===!1&&(oe=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(se.substr(-2))===!1&&(oe=!1),oe},V=r.__addimage__.extractImageFromDataUrl=function(se){var oe=(se=se||"").split("base64,"),ve=null;if(oe.length===2){var ge=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(oe[0]);Array.isArray(ge)&&(ve={mimeType:ge[1],charset:ge[2],data:oe[1]})}return ve},$=r.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};r.__addimage__.isArrayBuffer=function(se){return $()&&se instanceof ArrayBuffer};var q=r.__addimage__.isArrayBufferView=function(se){return $()&&typeof Uint32Array<"u"&&(se instanceof Int8Array||se instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&se instanceof Uint8ClampedArray||se instanceof Int16Array||se instanceof Uint16Array||se instanceof Int32Array||se instanceof Uint32Array||se instanceof Float32Array||se instanceof Float64Array)},te=r.__addimage__.binaryStringToUint8Array=function(se){for(var oe=se.length,ve=new Uint8Array(oe),ge=0;ge<oe;ge++)ve[ge]=se.charCodeAt(ge);return ve},J=r.__addimage__.arrayBufferToBinaryString=function(se){for(var oe="",ve=q(se)?se:new Uint8Array(se),ge=0;ge<ve.length;ge+=8192)oe+=String.fromCharCode.apply(null,ve.subarray(ge,ge+8192));return oe};r.addImage=function(){var se,oe,ve,ge,Je,Ge,et,Ye,ct;if(typeof arguments[1]=="number"?(oe=e,ve=arguments[1],ge=arguments[2],Je=arguments[3],Ge=arguments[4],et=arguments[5],Ye=arguments[6],ct=arguments[7]):(oe=arguments[1],ve=arguments[2],ge=arguments[3],Je=arguments[4],Ge=arguments[5],et=arguments[6],Ye=arguments[7],ct=arguments[8]),ri(se=arguments[0])==="object"&&!_(se)&&"imageData"in se){var At=se;se=At.imageData,oe=At.format||oe||e,ve=At.x||ve||0,ge=At.y||ge||0,Je=At.w||At.width||Je,Ge=At.h||At.height||Ge,et=At.alias||et,Ye=At.compression||Ye,ct=At.rotation||At.angle||ct}var kt=this.internal.getFilters();if(Ye===void 0&&kt.indexOf("FlateEncode")!==-1&&(Ye="SLOW"),isNaN(ve)||isNaN(ge))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var ae=me.call(this,se,oe,et,Ye);return P.call(this,ve,ge,Je,Ge,ae,ct),this};var me=function(se,oe,ve,ge){var Je,Ge,et;if(typeof se=="string"&&n(se)===e){se=unescape(se);var Ye=xe(se,!1);(Ye!==""||(Ye=r.loadFile(se,!0))!==void 0)&&(se=Ye)}if(_(se)&&(se=w(se,oe)),oe=n(se,oe),!p(oe))throw new Error("addImage does not support files of type '"+oe+"', please ensure that a plugin for '"+oe+"' support is added.");if(((et=ve)==null||et.length===0)&&(ve=function(ct){return typeof ct=="string"||q(ct)?z(ct):q(ct.data)?z(ct.data):null}(se)),(Je=v.call(this,ve))||($()&&(se instanceof Uint8Array||oe==="RGBA"||(Ge=se,se=te(se))),Je=this["process"+oe.toUpperCase()](se,d.call(this),ve,function(ct){return ct&&typeof ct=="string"&&(ct=ct.toUpperCase()),ct in r.image_compression?ct:N.NONE}(ge),Ge)),!Je)throw new Error("An unknown error occurred whilst processing the image.");return Je},xe=r.__addimage__.convertBase64ToBinaryString=function(se,oe){var ve;oe=typeof oe!="boolean"||oe;var ge,Je="";if(typeof se=="string"){ge=(ve=V(se))!==null?ve.data:se;try{Je=dm(ge)}catch(Ge){if(oe)throw W(ge)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Ge.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Je};r.getImageProperties=function(se){var oe,ve,ge="";if(_(se)&&(se=w(se)),typeof se=="string"&&n(se)===e&&((ge=xe(se,!1))===""&&(ge=r.loadFile(se)||""),se=ge),ve=n(se),!p(ve))throw new Error("addImage does not support files of type '"+ve+"', please ensure that a plugin for '"+ve+"' support is added.");if(!$()||se instanceof Uint8Array||(se=te(se)),!(oe=this["process"+ve.toUpperCase()](se)))throw new Error("An unknown error occurred whilst processing the image");return oe.fileType=ve,oe}})(cn.API),function(r){var e=function(t){if(t!==void 0&&t!="")return!0};cn.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(t){for(var n,i,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,u=this.internal.getPageInfoByObjId(t.objId),d=t.pageContext.annotations,p=!1,_=0;_<d.length&&!p;_++)switch((n=d[_]).type){case"link":(e(n.options.url)||e(n.options.pageNumber))&&(p=!0);break;case"reference":case"text":case"freetext":p=!0}if(p!=0){this.internal.write("/Annots [");for(var w=0;w<d.length;w++){n=d[w];var v=this.internal.pdfEscape,M=this.internal.getEncryptor(t.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var P=this.internal.newAdditionalObject(),D=this.internal.newAdditionalObject(),N=this.internal.getEncryptor(P.objId),z=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+v(N(n.contents))+")",s+=" /Popup "+D.objId+" 0 R",s+=" /P "+u.objId+" 0 R",s+=" /T ("+v(N(z))+") >>",P.content=s;var W=P.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+a(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+W,n.open&&(s+=" /Open true"),s+=" >>",D.content=s,this.internal.write(P.objId,"0 R",D.objId,"0 R");break;case"freetext":i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var V=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+v(M(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+V+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var $=this.annotations._nameMap[n.options.name];n.options.pageNumber=$.page,n.options.top=$.y}else n.options.top||(n.options.top=0);if(i="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+v(M(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var q=o(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+q+" "+n.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),r.createAnnotation=function(t){var n=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":n.pageContext.annotations.push(t)}},r.link=function(t,n,i,s,a){var o=this.internal.getCurrentPageInfo(),u=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:u(t),y:d(n),w:u(t+i),h:d(n+s)},options:a,type:"link"})},r.textWithLink=function(t,n,i,s){var a,o,u=this.getTextWidth(t),d=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var p=this.splitTextToSize(t,o).length;a=Math.ceil(d*p)}else o=u,a=d;return this.text(t,n,i,s),i+=.2*d,s.align==="center"&&(n-=u/2),s.align==="right"&&(n-=u),this.link(n,i-d,o,a,s),u},r.getTextWidth=function(t){var n=this.internal.getFontSize();return this.getStringUnitWidth(t)*n/this.internal.scaleFactor}}(cn.API),function(r){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];r.__arabicParser__={};var s=r.__arabicParser__.isInArabicSubstitutionA=function(P){return e[P.charCodeAt(0)]!==void 0},a=r.__arabicParser__.isArabicLetter=function(P){return typeof P=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(P)},o=r.__arabicParser__.isArabicEndLetter=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length<=2},u=r.__arabicParser__.isArabicAlfLetter=function(P){return a(P)&&i.indexOf(P.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length>=1};var d=r.__arabicParser__.arabicLetterHasFinalForm=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length>=3};var p=r.__arabicParser__.arabicLetterHasMedialForm=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length==4},_=r.__arabicParser__.resolveLigatures=function(P){var D=0,N=t,z="",W=0;for(D=0;D<P.length;D+=1)N[P.charCodeAt(D)]!==void 0?(W++,typeof(N=N[P.charCodeAt(D)])=="number"&&(z+=String.fromCharCode(N),N=t,W=0),D===P.length-1&&(N=t,z+=P.charAt(D-(W-1)),D-=W-1,W=0)):(N=t,z+=P.charAt(D-W),D-=W,W=0);return z};r.__arabicParser__.isArabicDiacritic=function(P){return P!==void 0&&n[P.charCodeAt(0)]!==void 0};var w=r.__arabicParser__.getCorrectForm=function(P,D,N){return a(P)?s(P)===!1?-1:!d(P)||!a(D)&&!a(N)||!a(N)&&o(D)||o(P)&&!a(D)||o(P)&&u(D)||o(P)&&o(D)?0:p(P)&&a(D)&&!o(D)&&a(N)&&d(N)?3:o(P)||!a(N)?1:2:-1},v=function(P){var D=0,N=0,z=0,W="",V="",$="",q=(P=P||"").split("\\s+"),te=[];for(D=0;D<q.length;D+=1){for(te.push(""),N=0;N<q[D].length;N+=1)W=q[D][N],V=q[D][N-1],$=q[D][N+1],a(W)?(z=w(W,V,$),te[D]+=z!==-1?String.fromCharCode(e[W.charCodeAt(0)][z]):W):te[D]+=W;te[D]=_(te[D])}return te.join(" ")},M=r.__arabicParser__.processArabic=r.processArabic=function(){var P,D=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,N=[];if(Array.isArray(D)){var z=0;for(N=[],z=0;z<D.length;z+=1)Array.isArray(D[z])?N.push([v(D[z][0]),D[z][1],D[z][2]]):N.push([v(D[z])]);P=N}else P=v(D);return typeof arguments[0]=="string"?P:(arguments[0].text=P,arguments[0])};r.events.push(["preProcessText",M])}(cn.API),cn.API.autoPrint=function(r){var e;switch((r=r||{}).variant=r.variant||"non-conform",r.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(r){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(o){t=o}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(o){n=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,n){var i;if((t=t||"2d")!=="2d")return null;for(i in n)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=n[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(cn.API),function(r){var e={left:0,top:0,bottom:0,right:0},t=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var u=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return u},set:function(P){u=P}});var d=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return d},set:function(P){d=P}});var p=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return p},set:function(P){p=P}});var _=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return _},set:function(P){_=P}});var w=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return w},set:function(P){w=P}});var v=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return v},set:function(P){v=P}});var M=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return M},set:function(P){M=P}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(u){return n.call(this),this.internal.__cell__.headerFunction=typeof u=="function"?u:void 0,this},r.getTextDimensions=function(u,d){n.call(this);var p=(d=d||{}).fontSize||this.getFontSize(),_=d.font||this.getFont(),w=d.scaleFactor||this.internal.scaleFactor,v=0,M=0,P=0,D=this;if(!Array.isArray(u)&&typeof u!="string"){if(typeof u!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");u=String(u)}var N=d.maxWidth;N>0?typeof u=="string"?u=this.splitTextToSize(u,N):Object.prototype.toString.call(u)==="[object Array]"&&(u=u.reduce(function(W,V){return W.concat(D.splitTextToSize(V,N))},[])):u=Array.isArray(u)?u:[u];for(var z=0;z<u.length;z++)v<(P=this.getStringUnitWidth(u[z],{font:_})*p)&&(v=P);return v!==0&&(M=u.length),{w:v/=w,h:Math.max((M*p*this.getLineHeightFactor()-p*(this.getLineHeightFactor()-1))/w,0)}},r.cellAddPage=function(){n.call(this),this.addPage();var u=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new s(u.left,u.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=r.cell=function(){var u;u=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var d=this.internal.__cell__.lastCell,p=this.internal.__cell__.padding,_=this.internal.__cell__.margins||e,w=this.internal.__cell__.tableHeaderRow,v=this.internal.__cell__.printHeaders;return d.lineNumber!==void 0&&(d.lineNumber===u.lineNumber?(u.x=(d.x||0)+(d.width||0),u.y=d.y||0):d.y+d.height+u.height+_.bottom>this.getPageHeight()?(this.cellAddPage(),u.y=_.top,v&&w&&(this.printHeaderRow(u.lineNumber,!0),u.y+=w[0].height)):u.y=d.y+d.height||u.y),u.text[0]!==void 0&&(this.rect(u.x,u.y,u.width,u.height,t===!0?"FD":void 0),u.align==="right"?this.text(u.text,u.x+u.width-p,u.y+p,{align:"right",baseline:"top"}):u.align==="center"?this.text(u.text,u.x+u.width/2,u.y+p,{align:"center",baseline:"top",maxWidth:u.width-p-p}):this.text(u.text,u.x+p,u.y+p,{align:"left",baseline:"top",maxWidth:u.width-p-p})),this.internal.__cell__.lastCell=u,this};r.table=function(u,d,p,_,w){if(n.call(this),!p)throw new Error("No data for PDF table.");var v,M,P,D,N=[],z=[],W=[],V={},$={},q=[],te=[],J=(w=w||{}).autoSize||!1,me=w.printHeaders!==!1,xe=w.css&&w.css["font-size"]!==void 0?16*w.css["font-size"]:w.fontSize||12,se=w.margins||Object.assign({width:this.getPageWidth()},e),oe=typeof w.padding=="number"?w.padding:3,ve=w.headerBackgroundColor||"#c8c8c8",ge=w.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=me,this.internal.__cell__.margins=se,this.internal.__cell__.table_font_size=xe,this.internal.__cell__.padding=oe,this.internal.__cell__.headerBackgroundColor=ve,this.internal.__cell__.headerTextColor=ge,this.setFontSize(xe),_==null)z=N=Object.keys(p[0]),W=N.map(function(){return"left"});else if(Array.isArray(_)&&ri(_[0])==="object")for(N=_.map(function(At){return At.name}),z=_.map(function(At){return At.prompt||At.name||""}),W=_.map(function(At){return At.align||"left"}),v=0;v<_.length;v+=1)$[_[v].name]=_[v].width*(19.049976/25.4);else Array.isArray(_)&&typeof _[0]=="string"&&(z=N=_,W=N.map(function(){return"left"}));if(J||Array.isArray(_)&&typeof _[0]=="string")for(v=0;v<N.length;v+=1){for(V[D=N[v]]=p.map(function(At){return At[D]}),this.setFont(void 0,"bold"),q.push(this.getTextDimensions(z[v],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),M=V[D],this.setFont(void 0,"normal"),P=0;P<M.length;P+=1)q.push(this.getTextDimensions(M[P],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);$[D]=Math.max.apply(null,q)+oe+oe,q=[]}if(me){var Je={};for(v=0;v<N.length;v+=1)Je[N[v]]={},Je[N[v]].text=z[v],Je[N[v]].align=W[v];var Ge=o.call(this,Je,$);te=N.map(function(At){return new s(u,d,$[At],Ge,Je[At].text,void 0,Je[At].align)}),this.setTableHeaderRow(te),this.printHeaderRow(1,!1)}var et=_.reduce(function(At,kt){return At[kt.name]=kt.align,At},{});for(v=0;v<p.length;v+=1){"rowStart"in w&&w.rowStart instanceof Function&&w.rowStart({row:v,data:p[v]},this);var Ye=o.call(this,p[v],$);for(P=0;P<N.length;P+=1){var ct=p[v][N[P]];"cellStart"in w&&w.cellStart instanceof Function&&w.cellStart({row:v,col:P,data:ct},this),a.call(this,new s(u,d,$[N[P]],Ye,ct,v+2,et[N[P]]))}}return this.internal.__cell__.table_x=u,this.internal.__cell__.table_y=d,this};var o=function(u,d){var p=this.internal.__cell__.padding,_=this.internal.__cell__.table_font_size,w=this.internal.scaleFactor;return Object.keys(u).map(function(v){var M=u[v];return this.splitTextToSize(M.hasOwnProperty("text")?M.text:M,d[v]-p-p)},this).map(function(v){return this.getLineHeightFactor()*v.length*_/w+p+p},this).reduce(function(v,M){return Math.max(v,M)},0)};r.setTableHeaderRow=function(u){n.call(this),this.internal.__cell__.tableHeaderRow=u},r.printHeaderRow=function(u,d){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var p;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var _=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(_[0],_[1],_[2],_[3],void 0,-1)}this.setFont(void 0,"bold");for(var w=[],v=0;v<this.internal.__cell__.tableHeaderRow.length;v+=1){p=this.internal.__cell__.tableHeaderRow[v].clone(),d&&(p.y=this.internal.__cell__.margins.top||0,w.push(p)),p.lineNumber=u;var M=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,p),this.setTextColor(M)}w.length>0&&this.setTableHeaderRow(w),this.setFont(void 0,"normal"),t=!1}}(cn.API);var pL={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},gL=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Jx=dL(gL),mL=[100,200,300,400,500,600,700,800,900],Ele=dL(mL);function eB(r){var e=r.family.replace(/"|'/g,"").toLowerCase(),t=function(s){return pL[s=s||"normal"]?s:"normal"}(r.style),n=function(s){if(!s)return 400;if(typeof s=="number")return s>=100&&s<=900&&s%100==0?s:400;if(/^\d00$/.test(s))return parseInt(s);switch(s){case"bold":return 700;case"normal":default:return 400}}(r.weight),i=function(s){return typeof Jx[s=s||"normal"]=="number"?s:"normal"}(r.stretch);return{family:e,style:t,weight:n,stretch:i,src:r.src||[],ref:r.ref||{name:e,style:[i,t,n].join(" ")}}}function _L(r,e,t,n){var i;for(i=t;i>=0&&i<e.length;i+=n)if(r[e[i]])return r[e[i]];for(i=t;i>=0&&i<e.length;i-=n)if(r[e[i]])return r[e[i]]}var Sle={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},yL={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function bL(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function Ile(r,e,t){for(var n=(t=t||{}).defaultFontFamily||"times",i=Object.assign({},Sle,t.genericFontFamilies||{}),s=null,a=null,o=0;o<e.length;++o)if(i[(s=eB(e[o])).family]&&(s.family=i[s.family]),r.hasOwnProperty(s.family)){a=r[s.family];break}if(!(a=a||r[n]))throw new Error("Could not find a font-family for the rule '"+bL(s)+"' and default family '"+n+"'.");if(a=function(u,d){if(d[u])return d[u];var p=Jx[u],_=p<=Jx.normal?-1:1,w=_L(d,gL,p,_);if(!w)throw new Error("Could not find a matching font-stretch value for "+u);return w}(s.stretch,a),a=function(u,d){if(d[u])return d[u];for(var p=pL[u],_=0;_<p.length;++_)if(d[p[_]])return d[p[_]];throw new Error("Could not find a matching font-style for "+u)}(s.style,a),!(a=function(u,d){if(d[u])return d[u];if(u===400&&d[500])return d[500];if(u===500&&d[400])return d[400];var p=Ele[u],_=_L(d,mL,p,u<400?-1:1);if(!_)throw new Error("Could not find a matching font-weight for value "+u);return _}(s.weight,a)))throw new Error("Failed to resolve a font for the rule '"+bL(s)+"'.");return a}function vL(r){return r.trimLeft()}function Mle(r,e){for(var t=0;t<r.length;){if(r.charAt(t)===e)return[r.substring(0,t),r.substring(t+1)];t+=1}return null}function Ple(r){var e=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],r.substring(e[0].length)]}var P0,wL,xL,BL=["times"];(function(r){var e,t,n,i,s,a,o,u,d,p=function(ae){return ae=ae||{},this.isStrokeTransparent=ae.isStrokeTransparent||!1,this.strokeOpacity=ae.strokeOpacity||1,this.strokeStyle=ae.strokeStyle||"#000000",this.fillStyle=ae.fillStyle||"#000000",this.isFillTransparent=ae.isFillTransparent||!1,this.fillOpacity=ae.fillOpacity||1,this.font=ae.font||"10px sans-serif",this.textBaseline=ae.textBaseline||"alphabetic",this.textAlign=ae.textAlign||"left",this.lineWidth=ae.lineWidth||1,this.lineJoin=ae.lineJoin||"miter",this.lineCap=ae.lineCap||"butt",this.path=ae.path||[],this.transform=ae.transform!==void 0?ae.transform.clone():new u,this.globalCompositeOperation=ae.globalCompositeOperation||"normal",this.globalAlpha=ae.globalAlpha||1,this.clip_path=ae.clip_path||[],this.currentPoint=ae.currentPoint||new a,this.miterLimit=ae.miterLimit||10,this.lastPoint=ae.lastPoint||new a,this.lineDashOffset=ae.lineDashOffset||0,this.lineDash=ae.lineDash||[],this.margin=ae.margin||[0,0,0,0],this.prevPageLastElemOffset=ae.prevPageLastElemOffset||0,this.ignoreClearRect=typeof ae.ignoreClearRect!="boolean"||ae.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new _(this),e=this.internal.f2,t=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,u=this.internal.Matrix,d=new p}]);var _=function(ae){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Te=ae;Object.defineProperty(this,"pdf",{get:function(){return Te}});var Le=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Le},set:function(Ot){Le=!!Ot}});var De=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return De},set:function(Ot){De=!!Ot}});var at=0;Object.defineProperty(this,"posX",{get:function(){return at},set:function(Ot){isNaN(Ot)||(at=Ot)}});var rt=0;Object.defineProperty(this,"posY",{get:function(){return rt},set:function(Ot){isNaN(Ot)||(rt=Ot)}}),Object.defineProperty(this,"margin",{get:function(){return d.margin},set:function(Ot){var ze;typeof Ot=="number"?ze=[Ot,Ot,Ot,Ot]:((ze=new Array(4))[0]=Ot[0],ze[1]=Ot.length>=2?Ot[1]:ze[0],ze[2]=Ot.length>=3?Ot[2]:ze[0],ze[3]=Ot.length>=4?Ot[3]:ze[1]),d.margin=ze}});var xt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return xt},set:function(Ot){xt=Ot}});var vt=0;Object.defineProperty(this,"lastBreak",{get:function(){return vt},set:function(Ot){vt=Ot}});var nr=[];Object.defineProperty(this,"pageBreaks",{get:function(){return nr},set:function(Ot){nr=Ot}}),Object.defineProperty(this,"ctx",{get:function(){return d},set:function(Ot){Ot instanceof p&&(d=Ot)}}),Object.defineProperty(this,"path",{get:function(){return d.path},set:function(Ot){d.path=Ot}});var qt=[];Object.defineProperty(this,"ctxStack",{get:function(){return qt},set:function(Ot){qt=Ot}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Ot){var ze;ze=w(Ot),this.ctx.fillStyle=ze.style,this.ctx.isFillTransparent=ze.a===0,this.ctx.fillOpacity=ze.a,this.pdf.setFillColor(ze.r,ze.g,ze.b,{a:ze.a}),this.pdf.setTextColor(ze.r,ze.g,ze.b,{a:ze.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Ot){var ze=w(Ot);this.ctx.strokeStyle=ze.style,this.ctx.isStrokeTransparent=ze.a===0,this.ctx.strokeOpacity=ze.a,ze.a===0?this.pdf.setDrawColor(255,255,255):(ze.a,this.pdf.setDrawColor(ze.r,ze.g,ze.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Ot){["butt","round","square"].indexOf(Ot)!==-1&&(this.ctx.lineCap=Ot,this.pdf.setLineCap(Ot))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Ot){isNaN(Ot)||(this.ctx.lineWidth=Ot,this.pdf.setLineWidth(Ot))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Ot){["bevel","round","miter"].indexOf(Ot)!==-1&&(this.ctx.lineJoin=Ot,this.pdf.setLineJoin(Ot))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Ot){isNaN(Ot)||(this.ctx.miterLimit=Ot,this.pdf.setMiterLimit(Ot))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Ot){this.ctx.textBaseline=Ot}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Ot){["right","end","center","left","start"].indexOf(Ot)!==-1&&(this.ctx.textAlign=Ot)}});var or=null;function gr(Ot,ze){if(or===null){var $r=function(Rr){var Jt=[];return Object.keys(Rr).forEach(function(tr){Rr[tr].forEach(function(mr){var _r=null;switch(mr){case"bold":_r={family:tr,weight:"bold"};break;case"italic":_r={family:tr,style:"italic"};break;case"bolditalic":_r={family:tr,weight:"bold",style:"italic"};break;case"":case"normal":_r={family:tr}}_r!==null&&(_r.ref={name:tr,style:mr},Jt.push(_r))})}),Jt}(Ot.getFontList());or=function(Rr){for(var Jt={},tr=0;tr<Rr.length;++tr){var mr=eB(Rr[tr]),_r=mr.family,Ut=mr.stretch,ar=mr.style,Sr=mr.weight;Jt[_r]=Jt[_r]||{},Jt[_r][Ut]=Jt[_r][Ut]||{},Jt[_r][Ut][ar]=Jt[_r][Ut][ar]||{},Jt[_r][Ut][ar][Sr]=mr}return Jt}($r.concat(ze))}return or}var wr=null;Object.defineProperty(this,"fontFaces",{get:function(){return wr},set:function(Ot){or=null,wr=Ot}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Ot){var ze;if(this.ctx.font=Ot,(ze=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Ot))!==null){var $r=ze[1],Rr=(ze[2],ze[3]),Jt=ze[4],tr=(ze[5],ze[6]),mr=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Jt)[2];Jt=Math.floor(mr==="px"?parseFloat(Jt)*this.pdf.internal.scaleFactor:mr==="em"?parseFloat(Jt)*this.pdf.getFontSize():parseFloat(Jt)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Jt);var _r=function(Hr){var Wr,vr,Qn=[],un=Hr.trim();if(un==="")return BL;if(un in yL)return[yL[un]];for(;un!=="";){switch(vr=null,Wr=(un=vL(un)).charAt(0)){case'"':case"'":vr=Mle(un.substring(1),Wr);break;default:vr=Ple(un)}if(vr===null||(Qn.push(vr[0]),(un=vL(vr[1]))!==""&&un.charAt(0)!==","))return BL;un=un.replace(/^,/,"")}return Qn}(tr);if(this.fontFaces){var Ut=Ile(gr(this.pdf,this.fontFaces),_r.map(function(Hr){return{family:Hr,stretch:"normal",weight:Rr,style:$r}}));this.pdf.setFont(Ut.ref.name,Ut.ref.style)}else{var ar="";(Rr==="bold"||parseInt(Rr,10)>=700||$r==="bold")&&(ar="bold"),$r==="italic"&&(ar+="italic"),ar.length===0&&(ar="normal");for(var Sr="",Er={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Dr=0;Dr<_r.length;Dr++){if(this.pdf.internal.getFont(_r[Dr],ar,{noFallback:!0,disableWarning:!0})!==void 0){Sr=_r[Dr];break}if(ar==="bolditalic"&&this.pdf.internal.getFont(_r[Dr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Sr=_r[Dr],ar="bold";else if(this.pdf.internal.getFont(_r[Dr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Sr=_r[Dr],ar="normal";break}}if(Sr===""){for(var nn=0;nn<_r.length;nn++)if(Er[_r[nn]]){Sr=Er[_r[nn]];break}}Sr=Sr===""?"Times":Sr,this.pdf.setFont(Sr,ar)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Ot){this.ctx.globalCompositeOperation=Ot}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Ot){this.ctx.globalAlpha=Ot}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Ot){this.ctx.lineDashOffset=Ot,kt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Ot){this.ctx.lineDash=Ot,kt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Ot){this.ctx.ignoreClearRect=!!Ot}})};_.prototype.setLineDash=function(ae){this.lineDash=ae},_.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},_.prototype.fill=function(){V.call(this,"fill",!1)},_.prototype.stroke=function(){V.call(this,"stroke",!1)},_.prototype.beginPath=function(){this.path=[{type:"begin"}]},_.prototype.moveTo=function(ae,Te){if(isNaN(ae)||isNaN(Te))throw Ui.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Le=this.ctx.transform.applyToPoint(new a(ae,Te));this.path.push({type:"mt",x:Le.x,y:Le.y}),this.ctx.lastPoint=new a(ae,Te)},_.prototype.closePath=function(){var ae=new a(0,0),Te=0;for(Te=this.path.length-1;Te!==-1;Te--)if(this.path[Te].type==="begin"&&ri(this.path[Te+1])==="object"&&typeof this.path[Te+1].x=="number"){ae=new a(this.path[Te+1].x,this.path[Te+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(ae.x,ae.y)},_.prototype.lineTo=function(ae,Te){if(isNaN(ae)||isNaN(Te))throw Ui.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Le=this.ctx.transform.applyToPoint(new a(ae,Te));this.path.push({type:"lt",x:Le.x,y:Le.y}),this.ctx.lastPoint=new a(Le.x,Le.y)},_.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),V.call(this,null,!0)},_.prototype.quadraticCurveTo=function(ae,Te,Le,De){if(isNaN(Le)||isNaN(De)||isNaN(ae)||isNaN(Te))throw Ui.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var at=this.ctx.transform.applyToPoint(new a(Le,De)),rt=this.ctx.transform.applyToPoint(new a(ae,Te));this.path.push({type:"qct",x1:rt.x,y1:rt.y,x:at.x,y:at.y}),this.ctx.lastPoint=new a(at.x,at.y)},_.prototype.bezierCurveTo=function(ae,Te,Le,De,at,rt){if(isNaN(at)||isNaN(rt)||isNaN(ae)||isNaN(Te)||isNaN(Le)||isNaN(De))throw Ui.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var xt=this.ctx.transform.applyToPoint(new a(at,rt)),vt=this.ctx.transform.applyToPoint(new a(ae,Te)),nr=this.ctx.transform.applyToPoint(new a(Le,De));this.path.push({type:"bct",x1:vt.x,y1:vt.y,x2:nr.x,y2:nr.y,x:xt.x,y:xt.y}),this.ctx.lastPoint=new a(xt.x,xt.y)},_.prototype.arc=function(ae,Te,Le,De,at,rt){if(isNaN(ae)||isNaN(Te)||isNaN(Le)||isNaN(De)||isNaN(at))throw Ui.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(rt=!!rt,!this.ctx.transform.isIdentity){var xt=this.ctx.transform.applyToPoint(new a(ae,Te));ae=xt.x,Te=xt.y;var vt=this.ctx.transform.applyToPoint(new a(0,Le)),nr=this.ctx.transform.applyToPoint(new a(0,0));Le=Math.sqrt(Math.pow(vt.x-nr.x,2)+Math.pow(vt.y-nr.y,2))}Math.abs(at-De)>=2*Math.PI&&(De=0,at=2*Math.PI),this.path.push({type:"arc",x:ae,y:Te,radius:Le,startAngle:De,endAngle:at,counterclockwise:rt})},_.prototype.arcTo=function(ae,Te,Le,De,at){throw new Error("arcTo not implemented.")},_.prototype.rect=function(ae,Te,Le,De){if(isNaN(ae)||isNaN(Te)||isNaN(Le)||isNaN(De))throw Ui.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(ae,Te),this.lineTo(ae+Le,Te),this.lineTo(ae+Le,Te+De),this.lineTo(ae,Te+De),this.lineTo(ae,Te),this.lineTo(ae+Le,Te),this.lineTo(ae,Te)},_.prototype.fillRect=function(ae,Te,Le,De){if(isNaN(ae)||isNaN(Te)||isNaN(Le)||isNaN(De))throw Ui.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!v.call(this)){var at={};this.lineCap!=="butt"&&(at.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(at.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(ae,Te,Le,De),this.fill(),at.hasOwnProperty("lineCap")&&(this.lineCap=at.lineCap),at.hasOwnProperty("lineJoin")&&(this.lineJoin=at.lineJoin)}},_.prototype.strokeRect=function(ae,Te,Le,De){if(isNaN(ae)||isNaN(Te)||isNaN(Le)||isNaN(De))throw Ui.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");M.call(this)||(this.beginPath(),this.rect(ae,Te,Le,De),this.stroke())},_.prototype.clearRect=function(ae,Te,Le,De){if(isNaN(ae)||isNaN(Te)||isNaN(Le)||isNaN(De))throw Ui.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(ae,Te,Le,De))},_.prototype.save=function(ae){ae=typeof ae!="boolean"||ae;for(var Te=this.pdf.internal.getCurrentPageInfo().pageNumber,Le=0;Le<this.pdf.internal.getNumberOfPages();Le++)this.pdf.setPage(Le+1),this.pdf.internal.out("q");if(this.pdf.setPage(Te),ae){this.ctx.fontSize=this.pdf.internal.getFontSize();var De=new p(this.ctx);this.ctxStack.push(this.ctx),this.ctx=De}},_.prototype.restore=function(ae){ae=typeof ae!="boolean"||ae;for(var Te=this.pdf.internal.getCurrentPageInfo().pageNumber,Le=0;Le<this.pdf.internal.getNumberOfPages();Le++)this.pdf.setPage(Le+1),this.pdf.internal.out("Q");this.pdf.setPage(Te),ae&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},_.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var w=function(ae){var Te,Le,De,at;if(ae.isCanvasGradient===!0&&(ae=ae.getColor()),!ae)return{r:0,g:0,b:0,a:0,style:ae};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(ae))Te=0,Le=0,De=0,at=0;else{var rt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(ae);if(rt!==null)Te=parseInt(rt[1]),Le=parseInt(rt[2]),De=parseInt(rt[3]),at=1;else if((rt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(ae))!==null)Te=parseInt(rt[1]),Le=parseInt(rt[2]),De=parseInt(rt[3]),at=parseFloat(rt[4]);else{if(at=1,typeof ae=="string"&&ae.charAt(0)!=="#"){var xt=new iL(ae);ae=xt.ok?xt.toHex():"#000000"}ae.length===4?(Te=ae.substring(1,2),Te+=Te,Le=ae.substring(2,3),Le+=Le,De=ae.substring(3,4),De+=De):(Te=ae.substring(1,3),Le=ae.substring(3,5),De=ae.substring(5,7)),Te=parseInt(Te,16),Le=parseInt(Le,16),De=parseInt(De,16)}}return{r:Te,g:Le,b:De,a:at,style:ae}},v=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},M=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};_.prototype.fillText=function(ae,Te,Le,De){if(isNaN(Te)||isNaN(Le)||typeof ae!="string")throw Ui.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(De=isNaN(De)?void 0:De,!v.call(this)){var at=Ye(this.ctx.transform.rotation),rt=this.ctx.transform.scaleX;oe.call(this,{text:ae,x:Te,y:Le,scale:rt,angle:at,align:this.textAlign,maxWidth:De})}},_.prototype.strokeText=function(ae,Te,Le,De){if(isNaN(Te)||isNaN(Le)||typeof ae!="string")throw Ui.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!M.call(this)){De=isNaN(De)?void 0:De;var at=Ye(this.ctx.transform.rotation),rt=this.ctx.transform.scaleX;oe.call(this,{text:ae,x:Te,y:Le,scale:rt,renderingMode:"stroke",angle:at,align:this.textAlign,maxWidth:De})}},_.prototype.measureText=function(ae){if(typeof ae!="string")throw Ui.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Te=this.pdf,Le=this.pdf.internal.scaleFactor,De=Te.internal.getFontSize(),at=Te.getStringUnitWidth(ae)*De/Te.internal.scaleFactor,rt=function(xt){var vt=(xt=xt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return vt}}),this};return new rt({width:at*=Math.round(96*Le/72*1e4)/1e4})},_.prototype.scale=function(ae,Te){if(isNaN(ae)||isNaN(Te))throw Ui.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Le=new u(ae,0,0,Te,0,0);this.ctx.transform=this.ctx.transform.multiply(Le)},_.prototype.rotate=function(ae){if(isNaN(ae))throw Ui.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Te=new u(Math.cos(ae),Math.sin(ae),-Math.sin(ae),Math.cos(ae),0,0);this.ctx.transform=this.ctx.transform.multiply(Te)},_.prototype.translate=function(ae,Te){if(isNaN(ae)||isNaN(Te))throw Ui.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Le=new u(1,0,0,1,ae,Te);this.ctx.transform=this.ctx.transform.multiply(Le)},_.prototype.transform=function(ae,Te,Le,De,at,rt){if(isNaN(ae)||isNaN(Te)||isNaN(Le)||isNaN(De)||isNaN(at)||isNaN(rt))throw Ui.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var xt=new u(ae,Te,Le,De,at,rt);this.ctx.transform=this.ctx.transform.multiply(xt)},_.prototype.setTransform=function(ae,Te,Le,De,at,rt){ae=isNaN(ae)?1:ae,Te=isNaN(Te)?0:Te,Le=isNaN(Le)?0:Le,De=isNaN(De)?1:De,at=isNaN(at)?0:at,rt=isNaN(rt)?0:rt,this.ctx.transform=new u(ae,Te,Le,De,at,rt)};var P=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};_.prototype.drawImage=function(ae,Te,Le,De,at,rt,xt,vt,nr){var qt=this.pdf.getImageProperties(ae),or=1,gr=1,wr=1,Ot=1;De!==void 0&&vt!==void 0&&(wr=vt/De,Ot=nr/at,or=qt.width/De*vt/De,gr=qt.height/at*nr/at),rt===void 0&&(rt=Te,xt=Le,Te=0,Le=0),De!==void 0&&vt===void 0&&(vt=De,nr=at),De===void 0&&vt===void 0&&(vt=qt.width,nr=qt.height);for(var ze,$r=this.ctx.transform.decompose(),Rr=Ye($r.rotate.shx),Jt=new u,tr=(Jt=(Jt=(Jt=Jt.multiply($r.translate)).multiply($r.skew)).multiply($r.scale)).applyToRectangle(new o(rt-Te*wr,xt-Le*Ot,De*or,at*gr)),mr=D.call(this,tr),_r=[],Ut=0;Ut<mr.length;Ut+=1)_r.indexOf(mr[Ut])===-1&&_r.push(mr[Ut]);if(W(_r),this.autoPaging)for(var ar=_r[0],Sr=_r[_r.length-1],Er=ar;Er<Sr+1;Er++){this.pdf.setPage(Er);var Dr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],nn=Er===1?this.posY+this.margin[0]:this.margin[0],Hr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Wr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],vr=Er===1?0:Hr+(Er-2)*Wr;if(this.ctx.clip_path.length!==0){var Qn=this.path;ze=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(ze,this.posX+this.margin[3],-vr+nn+this.ctx.prevPageLastElemOffset),$.call(this,"fill",!0),this.path=Qn}var un=JSON.parse(JSON.stringify(tr));un=z([un],this.posX+this.margin[3],-vr+nn+this.ctx.prevPageLastElemOffset)[0];var ni=(Er>ar||Er<Sr)&&P.call(this);ni&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Dr,Wr,null).clip().discardPath()),this.pdf.addImage(ae,"JPEG",un.x,un.y,un.w,un.h,null,null,Rr),ni&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(ae,"JPEG",tr.x,tr.y,tr.w,tr.h,null,null,Rr)};var D=function(ae,Te,Le){var De=[];Te=Te||this.pdf.internal.pageSize.width,Le=Le||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var at=this.posY+this.ctx.prevPageLastElemOffset;switch(ae.type){default:case"mt":case"lt":De.push(Math.floor((ae.y+at)/Le)+1);break;case"arc":De.push(Math.floor((ae.y+at-ae.radius)/Le)+1),De.push(Math.floor((ae.y+at+ae.radius)/Le)+1);break;case"qct":var rt=ct(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ae.x1,ae.y1,ae.x,ae.y);De.push(Math.floor((rt.y+at)/Le)+1),De.push(Math.floor((rt.y+rt.h+at)/Le)+1);break;case"bct":var xt=At(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ae.x1,ae.y1,ae.x2,ae.y2,ae.x,ae.y);De.push(Math.floor((xt.y+at)/Le)+1),De.push(Math.floor((xt.y+xt.h+at)/Le)+1);break;case"rect":De.push(Math.floor((ae.y+at)/Le)+1),De.push(Math.floor((ae.y+ae.h+at)/Le)+1)}for(var vt=0;vt<De.length;vt+=1)for(;this.pdf.internal.getNumberOfPages()<De[vt];)N.call(this);return De},N=function(){var ae=this.fillStyle,Te=this.strokeStyle,Le=this.font,De=this.lineCap,at=this.lineWidth,rt=this.lineJoin;this.pdf.addPage(),this.fillStyle=ae,this.strokeStyle=Te,this.font=Le,this.lineCap=De,this.lineWidth=at,this.lineJoin=rt},z=function(ae,Te,Le){for(var De=0;De<ae.length;De++)switch(ae[De].type){case"bct":ae[De].x2+=Te,ae[De].y2+=Le;case"qct":ae[De].x1+=Te,ae[De].y1+=Le;case"mt":case"lt":case"arc":default:ae[De].x+=Te,ae[De].y+=Le}return ae},W=function(ae){return ae.sort(function(Te,Le){return Te-Le})},V=function(ae,Te){for(var Le,De,at=this.fillStyle,rt=this.strokeStyle,xt=this.lineCap,vt=this.lineWidth,nr=Math.abs(vt*this.ctx.transform.scaleX),qt=this.lineJoin,or=JSON.parse(JSON.stringify(this.path)),gr=JSON.parse(JSON.stringify(this.path)),wr=[],Ot=0;Ot<gr.length;Ot++)if(gr[Ot].x!==void 0)for(var ze=D.call(this,gr[Ot]),$r=0;$r<ze.length;$r+=1)wr.indexOf(ze[$r])===-1&&wr.push(ze[$r]);for(var Rr=0;Rr<wr.length;Rr++)for(;this.pdf.internal.getNumberOfPages()<wr[Rr];)N.call(this);if(W(wr),this.autoPaging)for(var Jt=wr[0],tr=wr[wr.length-1],mr=Jt;mr<tr+1;mr++){this.pdf.setPage(mr),this.fillStyle=at,this.strokeStyle=rt,this.lineCap=xt,this.lineWidth=nr,this.lineJoin=qt;var _r=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ut=mr===1?this.posY+this.margin[0]:this.margin[0],ar=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Sr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Er=mr===1?0:ar+(mr-2)*Sr;if(this.ctx.clip_path.length!==0){var Dr=this.path;Le=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(Le,this.posX+this.margin[3],-Er+Ut+this.ctx.prevPageLastElemOffset),$.call(this,ae,!0),this.path=Dr}if(De=JSON.parse(JSON.stringify(or)),this.path=z(De,this.posX+this.margin[3],-Er+Ut+this.ctx.prevPageLastElemOffset),Te===!1||mr===0){var nn=(mr>Jt||mr<tr)&&P.call(this);nn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],_r,Sr,null).clip().discardPath()),$.call(this,ae,Te),nn&&this.pdf.restoreGraphicsState()}this.lineWidth=vt}else this.lineWidth=nr,$.call(this,ae,Te),this.lineWidth=vt;this.path=or},$=function(ae,Te){if((ae!=="stroke"||Te||!M.call(this))&&(ae==="stroke"||Te||!v.call(this))){for(var Le,De,at=[],rt=this.path,xt=0;xt<rt.length;xt++){var vt=rt[xt];switch(vt.type){case"begin":at.push({begin:!0});break;case"close":at.push({close:!0});break;case"mt":at.push({start:vt,deltas:[],abs:[]});break;case"lt":var nr=at.length;if(rt[xt-1]&&!isNaN(rt[xt-1].x)&&(Le=[vt.x-rt[xt-1].x,vt.y-rt[xt-1].y],nr>0)){for(;nr>=0;nr--)if(at[nr-1].close!==!0&&at[nr-1].begin!==!0){at[nr-1].deltas.push(Le),at[nr-1].abs.push(vt);break}}break;case"bct":Le=[vt.x1-rt[xt-1].x,vt.y1-rt[xt-1].y,vt.x2-rt[xt-1].x,vt.y2-rt[xt-1].y,vt.x-rt[xt-1].x,vt.y-rt[xt-1].y],at[at.length-1].deltas.push(Le);break;case"qct":var qt=rt[xt-1].x+2/3*(vt.x1-rt[xt-1].x),or=rt[xt-1].y+2/3*(vt.y1-rt[xt-1].y),gr=vt.x+2/3*(vt.x1-vt.x),wr=vt.y+2/3*(vt.y1-vt.y),Ot=vt.x,ze=vt.y;Le=[qt-rt[xt-1].x,or-rt[xt-1].y,gr-rt[xt-1].x,wr-rt[xt-1].y,Ot-rt[xt-1].x,ze-rt[xt-1].y],at[at.length-1].deltas.push(Le);break;case"arc":at.push({deltas:[],abs:[],arc:!0}),Array.isArray(at[at.length-1].abs)&&at[at.length-1].abs.push(vt)}}De=Te?null:ae==="stroke"?"stroke":"fill";for(var $r=!1,Rr=0;Rr<at.length;Rr++)if(at[Rr].arc)for(var Jt=at[Rr].abs,tr=0;tr<Jt.length;tr++){var mr=Jt[tr];mr.type==="arc"?J.call(this,mr.x,mr.y,mr.radius,mr.startAngle,mr.endAngle,mr.counterclockwise,void 0,Te,!$r):ve.call(this,mr.x,mr.y),$r=!0}else if(at[Rr].close===!0)this.pdf.internal.out("h"),$r=!1;else if(at[Rr].begin!==!0){var _r=at[Rr].start.x,Ut=at[Rr].start.y;ge.call(this,at[Rr].deltas,_r,Ut),$r=!0}De&&me.call(this,De),Te&&xe.call(this)}},q=function(ae){var Te=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Le=Te*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return ae-Le;case"top":return ae+Te-Le;case"hanging":return ae+Te-2*Le;case"middle":return ae+Te/2-Le;case"ideographic":return ae;case"alphabetic":default:return ae}},te=function(ae){return ae+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};_.prototype.createLinearGradient=function(){var ae=function(){};return ae.colorStops=[],ae.addColorStop=function(Te,Le){this.colorStops.push([Te,Le])},ae.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},ae.isCanvasGradient=!0,ae},_.prototype.createPattern=function(){return this.createLinearGradient()},_.prototype.createRadialGradient=function(){return this.createLinearGradient()};var J=function(ae,Te,Le,De,at,rt,xt,vt,nr){for(var qt=Ge.call(this,Le,De,at,rt),or=0;or<qt.length;or++){var gr=qt[or];or===0&&(nr?se.call(this,gr.x1+ae,gr.y1+Te):ve.call(this,gr.x1+ae,gr.y1+Te)),Je.call(this,ae,Te,gr.x2,gr.y2,gr.x3,gr.y3,gr.x4,gr.y4)}vt?xe.call(this):me.call(this,xt)},me=function(ae){switch(ae){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},xe=function(){this.pdf.clip(),this.pdf.discardPath()},se=function(ae,Te){this.pdf.internal.out(t(ae)+" "+n(Te)+" m")},oe=function(ae){var Te;switch(ae.align){case"right":case"end":Te="right";break;case"center":Te="center";break;case"left":case"start":default:Te="left"}var Le=this.pdf.getTextDimensions(ae.text),De=q.call(this,ae.y),at=te.call(this,De)-Le.h,rt=this.ctx.transform.applyToPoint(new a(ae.x,De)),xt=this.ctx.transform.decompose(),vt=new u;vt=(vt=(vt=vt.multiply(xt.translate)).multiply(xt.skew)).multiply(xt.scale);for(var nr,qt,or,gr=this.ctx.transform.applyToRectangle(new o(ae.x,De,Le.w,Le.h)),wr=vt.applyToRectangle(new o(ae.x,at,Le.w,Le.h)),Ot=D.call(this,wr),ze=[],$r=0;$r<Ot.length;$r+=1)ze.indexOf(Ot[$r])===-1&&ze.push(Ot[$r]);if(W(ze),this.autoPaging)for(var Rr=ze[0],Jt=ze[ze.length-1],tr=Rr;tr<Jt+1;tr++){this.pdf.setPage(tr);var mr=tr===1?this.posY+this.margin[0]:this.margin[0],_r=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ut=this.pdf.internal.pageSize.height-this.margin[2],ar=Ut-this.margin[0],Sr=this.pdf.internal.pageSize.width-this.margin[1],Er=Sr-this.margin[3],Dr=tr===1?0:_r+(tr-2)*ar;if(this.ctx.clip_path.length!==0){var nn=this.path;nr=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(nr,this.posX+this.margin[3],-1*Dr+mr),$.call(this,"fill",!0),this.path=nn}var Hr=z([JSON.parse(JSON.stringify(wr))],this.posX+this.margin[3],-Dr+mr+this.ctx.prevPageLastElemOffset)[0];ae.scale>=.01&&(qt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(qt*ae.scale),or=this.lineWidth,this.lineWidth=or*ae.scale);var Wr=this.autoPaging!=="text";if(Wr||Hr.y+Hr.h<=Ut){if(Wr||Hr.y>=mr&&Hr.x<=Sr){var vr=Wr?ae.text:this.pdf.splitTextToSize(ae.text,ae.maxWidth||Sr-Hr.x)[0],Qn=z([JSON.parse(JSON.stringify(gr))],this.posX+this.margin[3],-Dr+mr+this.ctx.prevPageLastElemOffset)[0],un=Wr&&(tr>Rr||tr<Jt)&&P.call(this);un&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Er,ar,null).clip().discardPath()),this.pdf.text(vr,Qn.x,Qn.y,{angle:ae.angle,align:Te,renderingMode:ae.renderingMode}),un&&this.pdf.restoreGraphicsState()}}else Hr.y<Ut&&(this.ctx.prevPageLastElemOffset+=Ut-Hr.y);ae.scale>=.01&&(this.pdf.setFontSize(qt),this.lineWidth=or)}else ae.scale>=.01&&(qt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(qt*ae.scale),or=this.lineWidth,this.lineWidth=or*ae.scale),this.pdf.text(ae.text,rt.x+this.posX,rt.y+this.posY,{angle:ae.angle,align:Te,renderingMode:ae.renderingMode,maxWidth:ae.maxWidth}),ae.scale>=.01&&(this.pdf.setFontSize(qt),this.lineWidth=or)},ve=function(ae,Te,Le,De){Le=Le||0,De=De||0,this.pdf.internal.out(t(ae+Le)+" "+n(Te+De)+" l")},ge=function(ae,Te,Le){return this.pdf.lines(ae,Te,Le,null,null)},Je=function(ae,Te,Le,De,at,rt,xt,vt){this.pdf.internal.out([e(i(Le+ae)),e(s(De+Te)),e(i(at+ae)),e(s(rt+Te)),e(i(xt+ae)),e(s(vt+Te)),"c"].join(" "))},Ge=function(ae,Te,Le,De){for(var at=2*Math.PI,rt=Math.PI/2;Te>Le;)Te-=at;var xt=Math.abs(Le-Te);xt<at&&De&&(xt=at-xt);for(var vt=[],nr=De?-1:1,qt=Te;xt>1e-5;){var or=qt+nr*Math.min(xt,rt);vt.push(et.call(this,ae,qt,or)),xt-=Math.abs(or-qt),qt=or}return vt},et=function(ae,Te,Le){var De=(Le-Te)/2,at=ae*Math.cos(De),rt=ae*Math.sin(De),xt=at,vt=-rt,nr=xt*xt+vt*vt,qt=nr+xt*at+vt*rt,or=4/3*(Math.sqrt(2*nr*qt)-qt)/(xt*rt-vt*at),gr=xt-or*vt,wr=vt+or*xt,Ot=gr,ze=-wr,$r=De+Te,Rr=Math.cos($r),Jt=Math.sin($r);return{x1:ae*Math.cos(Te),y1:ae*Math.sin(Te),x2:gr*Rr-wr*Jt,y2:gr*Jt+wr*Rr,x3:Ot*Rr-ze*Jt,y3:Ot*Jt+ze*Rr,x4:ae*Math.cos(Le),y4:ae*Math.sin(Le)}},Ye=function(ae){return 180*ae/Math.PI},ct=function(ae,Te,Le,De,at,rt){var xt=ae+.5*(Le-ae),vt=Te+.5*(De-Te),nr=at+.5*(Le-at),qt=rt+.5*(De-rt),or=Math.min(ae,at,xt,nr),gr=Math.max(ae,at,xt,nr),wr=Math.min(Te,rt,vt,qt),Ot=Math.max(Te,rt,vt,qt);return new o(or,wr,gr-or,Ot-wr)},At=function(ae,Te,Le,De,at,rt,xt,vt){var nr,qt,or,gr,wr,Ot,ze,$r,Rr,Jt,tr,mr,_r,Ut,ar=Le-ae,Sr=De-Te,Er=at-Le,Dr=rt-De,nn=xt-at,Hr=vt-rt;for(qt=0;qt<41;qt++)Rr=(ze=(or=ae+(nr=qt/40)*ar)+nr*((wr=Le+nr*Er)-or))+nr*(wr+nr*(at+nr*nn-wr)-ze),Jt=($r=(gr=Te+nr*Sr)+nr*((Ot=De+nr*Dr)-gr))+nr*(Ot+nr*(rt+nr*Hr-Ot)-$r),qt==0?(tr=Rr,mr=Jt,_r=Rr,Ut=Jt):(tr=Math.min(tr,Rr),mr=Math.min(mr,Jt),_r=Math.max(_r,Rr),Ut=Math.max(Ut,Jt));return new o(Math.round(tr),Math.round(mr),Math.round(_r-tr),Math.round(Ut-mr))},kt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var ae,Te,Le=(ae=this.ctx.lineDash,Te=this.ctx.lineDashOffset,JSON.stringify({lineDash:ae,lineDashOffset:Te}));this.prevLineDash!==Le&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Le)}}})(cn.API),function(r){var e=function(s){var a,o,u,d,p,_,w,v,M,P;for(o=[],u=0,d=(s+=a="\0\0\0\0".slice(s.length%4||4)).length;d>u;u+=4)(p=(s.charCodeAt(u)<<24)+(s.charCodeAt(u+1)<<16)+(s.charCodeAt(u+2)<<8)+s.charCodeAt(u+3))!==0?(_=(p=((p=((p=((p=(p-(P=p%85))/85)-(M=p%85))/85)-(v=p%85))/85)-(w=p%85))/85)%85,o.push(_+33,w+33,v+33,M+33,P+33)):o.push(122);return function(D,N){for(var z=N;z>0;z--)D.pop()}(o,a.length),String.fromCharCode.apply(String,o)+"~>"},t=function(s){var a,o,u,d,p,_=String,w="length",v=255,M="charCodeAt",P="slice",D="replace";for(s[P](-2),s=s[P](0,-2)[D](/\s/g,"")[D]("z","!!!!!"),u=[],d=0,p=(s+=a="uuuuu"[P](s[w]%5||5))[w];p>d;d+=5)o=52200625*(s[M](d)-33)+614125*(s[M](d+1)-33)+7225*(s[M](d+2)-33)+85*(s[M](d+3)-33)+(s[M](d+4)-33),u.push(v&o>>24,v&o>>16,v&o>>8,v&o);return function(N,z){for(var W=z;W>0;W--)N.pop()}(u,a[w]),_.fromCharCode.apply(_,u)},n=function(s){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((s=s.replace(/\s/g,"")).indexOf(">")!==-1&&(s=s.substr(0,s.indexOf(">"))),s.length%2&&(s+="0"),a.test(s)===!1)return"";for(var o="",u=0;u<s.length;u+=2)o+=String.fromCharCode("0x"+(s[u]+s[u+1]));return o},i=function(s){for(var a=new Uint8Array(s.length),o=s.length;o--;)a[o]=s.charCodeAt(o);return s=(a=Vx(a)).reduce(function(u,d){return u+String.fromCharCode(d)},"")};r.processDataByFilters=function(s,a){var o=0,u=s||"",d=[];for(typeof(a=a||[])=="string"&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":u=t(u),d.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":u=e(u),d.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":u=n(u),d.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":u=u.split("").map(function(p){return("0"+p.charCodeAt().toString(16)).slice(-2)}).join("")+">",d.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":u=i(u),d.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:u,reverseChain:d.reverse().join(" ")}}}(cn.API),function(r){r.loadFile=function(e,t,n){return function(i,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=function(u,d,p){var _=new XMLHttpRequest,w=0,v=function(M){var P=M.length,D=[],N=String.fromCharCode;for(w=0;w<P;w+=1)D.push(N(255&M.charCodeAt(w)));return D.join("")};if(_.open("GET",u,!d),_.overrideMimeType("text/plain; charset=x-user-defined"),d===!1&&(_.onload=function(){_.status===200?p(v(this.responseText)):p(void 0)}),_.send(null),d&&_.status===200)return v(_.responseText)}(i,s,a)}catch{}return o}(e,t,n)},r.loadImageFile=r.loadFile}(cn.API),function(r){function e(){return(ln.html2canvas?Promise.resolve(ln.html2canvas):Promise.resolve().then(()=>Sge)).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function t(){return(ln.DOMPurify?Promise.resolve(ln.DOMPurify):Promise.resolve().then(()=>ime)).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var n=function(a){var o=ri(a);return o==="undefined"?"undefined":o==="string"||a instanceof String?"string":o==="number"||a instanceof Number?"number":o==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":o==="object"?"object":"unknown"},i=function(a,o){var u=document.createElement(a);for(var d in o.className&&(u.className=o.className),o.innerHTML&&o.dompurify&&(u.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)u.style[d]=o.style[d];return u},s=function a(o){var u=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),d=a.convert(Promise.resolve(),u);return d=(d=d.setProgress(1,a,1,[a])).set(o)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(a,o){return a.__proto__=o||s.prototype,a},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(a,o){return this.then(function(){switch(o=o||function(u){switch(n(u)){case"string":return"string";case"element":return u.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a)){case"string":return this.then(t).then(function(u){return this.set({src:i("div",{innerHTML:a,dompurify:u})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},s.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=function u(d,p){for(var _=d.nodeType===3?document.createTextNode(d.nodeValue):d.cloneNode(!1),w=d.firstChild;w;w=w.nextSibling)p!==!0&&w.nodeType===1&&w.nodeName==="SCRIPT"||_.appendChild(u(w,p));return d.nodeType===1&&(d.nodeName==="CANVAS"?(_.width=d.width,_.height=d.height,_.getContext("2d").drawImage(d,0,0)):d.nodeName!=="TEXTAREA"&&d.nodeName!=="SELECT"||(_.value=d.value),_.addEventListener("load",function(){_.scrollTop=d.scrollTop,_.scrollLeft=d.scrollLeft},!0)),_}(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(e).then(function(o){var u=Object.assign({},this.opt.html2canvas);return delete u.onrendered,o(this.prop.container,u)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(e).then(function(o){var u=this.opt.jsPDF,d=this.opt.fontFaces,p=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,_=Object.assign({async:!0,allowTaint:!0,scale:p,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete _.onrendered,u.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,u.context2d.posX=this.opt.x,u.context2d.posY=this.opt.y,u.context2d.margin=this.opt.margin,u.context2d.fontFaces=d,d)for(var w=0;w<d.length;++w){var v=d[w],M=v.src.find(function(P){return P.format==="truetype"});M&&u.addFont(M.url,v.ref.name,v.ref.style)}return _.windowHeight=_.windowHeight||0,_.windowHeight=_.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):_.windowHeight,u.context2d.save(!0),o(this.prop.container,_)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(a,o,u){return(u=u||"pdf").toLowerCase()==="img"||u.toLowerCase()==="image"?this.outputImg(a,o):this.outputPdf(a,o)},s.prototype.outputPdf=function(a,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,o)})},s.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},s.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(a){if(n(a)!=="object")return this;var o=Object.keys(a||{}).map(function(u){if(u in s.template.prop)return function(){this.prop[u]=a[u]};switch(u){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[u]=a[u]}}},this);return this.then(function(){return this.thenList(o)})},s.prototype.get=function(a,o){return this.then(function(){var u=a in s.template.prop?this.prop[a]:this.opt[a];return o?o(u):u})},s.prototype.setMargin=function(a){return this.then(function(){switch(n(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},s.prototype.setPageSize=function(a){function o(u,d){return Math.floor(u*d/72*96)}return this.then(function(){(a=a||cn.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:o(a.inner.width,a.k),height:o(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},s.prototype.setProgress=function(a,o,u,d){return a!=null&&(this.progress.val=a),o!=null&&(this.progress.state=o),u!=null&&(this.progress.n=u),d!=null&&(this.progress.stack=d),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(a,o,u,d){return this.setProgress(a?this.progress.val+a:null,o||null,u?this.progress.n+u:null,d?this.progress.stack.concat(d):null)},s.prototype.then=function(a,o){var u=this;return this.thenCore(a,o,function(d,p){return u.updateProgress(null,null,1,[d]),Promise.prototype.then.call(this,function(_){return u.updateProgress(null,d),_}).then(d,p).then(function(_){return u.updateProgress(1),_})})},s.prototype.thenCore=function(a,o,u){u=u||Promise.prototype.then,a&&(a=a.bind(this)),o&&(o=o.bind(this));var d=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:s.convert(Object.assign({},this),Promise.prototype),p=u.call(d,a,o);return s.convert(p,this.__proto__)},s.prototype.thenExternal=function(a,o){return Promise.prototype.then.call(this,a,o)},s.prototype.thenList=function(a){var o=this;return a.forEach(function(u){o=o.thenCore(u)}),o},s.prototype.catch=function(a){a&&(a=a.bind(this));var o=Promise.prototype.catch.call(this,a);return s.convert(o,this)},s.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},s.prototype.error=function(a){return this.then(function(){throw new Error(a)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,cn.getPageSize=function(a,o,u){if(ri(a)==="object"){var d=a;a=d.orientation,o=d.unit||o,u=d.format||u}o=o||"mm",u=u||"a4",a=(""+(a||"P")).toLowerCase();var p,_=(""+u).toLowerCase(),w={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":p=1;break;case"mm":p=72/25.4;break;case"cm":p=72/2.54;break;case"in":p=72;break;case"px":p=.75;break;case"pc":case"em":p=12;break;case"ex":p=6;break;default:throw"Invalid unit: "+o}var v,M=0,P=0;if(w.hasOwnProperty(_))M=w[_][1]/p,P=w[_][0]/p;else try{M=u[1],P=u[0]}catch{throw new Error("Invalid format: "+u)}if(a==="p"||a==="portrait")a="p",P>M&&(v=P,P=M,M=v);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",M>P&&(v=P,P=M,M=v)}return{width:P,height:M,unit:o,k:p,orientation:a}},r.html=function(a,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(eB):null;var u=new s(o);return o.worker?u:u.from(a).doCallback()}}(cn.API),cn.API.addJS=function(r){return xL=r,this.internal.events.subscribe("postPutResources",function(){P0=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(P0+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),wL=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+xL+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){P0!==void 0&&wL!==void 0&&this.internal.out("/Names <</JavaScript "+P0+" 0 R>>")}),this},function(r){var e;r.events.push(["postPutResources",function(){var t=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=t.outline.render().split(/\r\n/),s=0;s<i.length;s++){var a=i[s],o=n.exec(a);if(o!=null){var u=o[1];t.internal.newObjectDeferredBegin(u,!1)}t.internal.write(a)}if(this.outline.createNamedDestinations){var d=this.internal.pages.length,p=[];for(s=0;s<d;s++){var _=t.internal.newObject();p.push(_);var w=t.internal.getPageInfo(s+1);t.internal.write("<< /D["+w.objId+" 0 R /XYZ null null null]>> endobj")}var v=t.internal.newObject();for(t.internal.write("<< /Names [ "),s=0;s<p.length;s++)t.internal.write("(page_"+(s+1)+")"+p[s]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+v+" 0 R"),t.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),r.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(n,i,s){var a={title:i,options:s,children:[]};return n==null&&(n=this.root),n.children.push(a),a},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(n){n.id=t.internal.newObjectDeferred();for(var i=0;i<n.children.length;i++)this.genIds_r(n.children[i])},t.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},t.outline.renderItems=function(n){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<n.children.length;s++){var a=n.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(n)),s>0&&this.line("/Prev "+this.makeRef(n.children[s-1])),s<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var u=t.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+u.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var d=0;d<n.children.length;d++)this.renderItems(n.children[d])},t.outline.line=function(n){this.ctx.val+=n+`\r
`},t.outline.makeRef=function(n){return n.id+" 0 R"},t.outline.makeString=function(n){return"("+t.internal.pdfEscape(n)+")"},t.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(n,i){for(var s=0;s<i.children.length;s++)n.count++,this.count_r(n,i.children[s]);return n.count}}])}(cn.API),function(r){var e=[192,193,194,195,196,197,198,199];r.processJPEG=function(t,n,i,s,a,o){var u,d=this.decode.DCT_DECODE,p=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=a||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,(u=function(_){for(var w,v=256*_.charCodeAt(4)+_.charCodeAt(5),M=_.length,P={width:0,height:0,numcomponents:1},D=4;D<M;D+=2){if(D+=v,e.indexOf(_.charCodeAt(D+1))!==-1){w=256*_.charCodeAt(D+5)+_.charCodeAt(D+6),P={width:256*_.charCodeAt(D+7)+_.charCodeAt(D+8),height:w,numcomponents:_.charCodeAt(D+9)};break}v=256*_.charCodeAt(D+2)+_.charCodeAt(D+3)}return P}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}p={data:t,width:u.width,height:u.height,colorSpace:o,bitsPerComponent:8,filter:d,index:n,alias:i}}return p}}(cn.API);var Ip,F0,CL,TL,EL,Fle=function(){var r,e,t;function n(s){var a,o,u,d,p,_,w,v,M,P,D,N,z,W;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},_=null;;){switch(a=this.readUInt32(),M=(function(){var V,$;for($=[],V=0;V<4;++V)$.push(String.fromCharCode(this.data[this.pos++]));return $}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":_&&this.animation.frames.push(_),this.pos+=4,_={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},p=this.readUInt16(),d=this.readUInt16()||100,_.delay=1e3*p/d,_.disposeOp=this.data[this.pos++],_.blendOp=this.data[this.pos++],_.data=[];break;case"IDAT":case"fdAT":for(M==="fdAT"&&(this.pos+=4,a-=4),s=(_!=null?_.data:void 0)||this.imgData,N=0;0<=a?N<a:N>a;0<=a?++N:--N)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(u=this.palette.length/3,this.transparency.indexed=this.read(a),this.transparency.indexed.length>u)throw new Error("More transparent colors than palette size");if((P=u-this.transparency.indexed.length)>0)for(z=0;0<=P?z<P:z>P;0<=P?++z:--z)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":w=(D=this.read(a)).indexOf(0),v=String.fromCharCode.apply(String,D.slice(0,w)),this.text[v]=String.fromCharCode.apply(String,D.slice(w+1));break;case"IEND":return _&&this.animation.frames.push(_),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(W=this.colorType)===4||W===6,o=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*o,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(s){var a,o;for(o=[],a=0;0<=s?a<s:a>s;0<=s?++a:--a)o.push(this.data[this.pos++]);return o},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(s){var a=this.pixelBitlength/8,o=new Uint8Array(this.width*this.height*a),u=0,d=this;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);function p(_,w,v,M){var P,D,N,z,W,V,$,q,te,J,me,xe,se,oe,ve,ge,Je,Ge,et,Ye,ct,At=Math.ceil((d.width-_)/v),kt=Math.ceil((d.height-w)/M),ae=d.width==At&&d.height==kt;for(oe=a*At,xe=ae?o:new Uint8Array(oe*kt),V=s.length,se=0,D=0;se<kt&&u<V;){switch(s[u++]){case 0:for(z=Je=0;Je<oe;z=Je+=1)xe[D++]=s[u++];break;case 1:for(z=Ge=0;Ge<oe;z=Ge+=1)P=s[u++],W=z<a?0:xe[D-a],xe[D++]=(P+W)%256;break;case 2:for(z=et=0;et<oe;z=et+=1)P=s[u++],N=(z-z%a)/a,ve=se&&xe[(se-1)*oe+N*a+z%a],xe[D++]=(ve+P)%256;break;case 3:for(z=Ye=0;Ye<oe;z=Ye+=1)P=s[u++],N=(z-z%a)/a,W=z<a?0:xe[D-a],ve=se&&xe[(se-1)*oe+N*a+z%a],xe[D++]=(P+Math.floor((W+ve)/2))%256;break;case 4:for(z=ct=0;ct<oe;z=ct+=1)P=s[u++],N=(z-z%a)/a,W=z<a?0:xe[D-a],se===0?ve=ge=0:(ve=xe[(se-1)*oe+N*a+z%a],ge=N&&xe[(se-1)*oe+(N-1)*a+z%a]),$=W+ve-ge,q=Math.abs($-W),J=Math.abs($-ve),me=Math.abs($-ge),te=q<=J&&q<=me?W:J<=me?ve:ge,xe[D++]=(P+te)%256;break;default:throw new Error("Invalid filter algorithm: "+s[u-1])}if(!ae){var Te=((w+se*M)*d.width+_)*a,Le=se*oe;for(z=0;z<At;z+=1){for(var De=0;De<a;De+=1)o[Te++]=xe[Le++];Te+=(v-1)*a}}se++}}return s=ule(s),d.interlaceMethod==1?(p(0,0,8,8),p(4,0,8,8),p(0,4,4,8),p(2,0,4,4),p(0,2,2,4),p(1,0,2,2),p(0,1,1,2)):p(0,0,1,1),o},n.prototype.decodePalette=function(){var s,a,o,u,d,p,_,w,v;for(o=this.palette,p=this.transparency.indexed||[],d=new Uint8Array((p.length||0)+o.length),u=0,s=0,a=_=0,w=o.length;_<w;a=_+=3)d[u++]=o[a],d[u++]=o[a+1],d[u++]=o[a+2],d[u++]=(v=p[s++])!=null?v:255;return d},n.prototype.copyToImageData=function(s,a){var o,u,d,p,_,w,v,M,P,D,N;if(u=this.colors,P=null,o=this.hasAlphaChannel,this.palette.length&&(P=(N=this._decodedPalette)!=null?N:this._decodedPalette=this.decodePalette(),u=4,o=!0),M=(d=s.data||s).length,_=P||a,p=w=0,u===1)for(;p<M;)v=P?4*a[p/4]:w,D=_[v++],d[p++]=D,d[p++]=D,d[p++]=D,d[p++]=o?_[v++]:255,w=v;else for(;p<M;)v=P?4*a[p/4]:w,d[p++]=_[v++],d[p++]=_[v++],d[p++]=_[v++],d[p++]=o?_[v++]:255,w=v},n.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s};var i=function(){if(Object.prototype.toString.call(ln)==="[object Window]"){try{e=ln.document.createElement("canvas"),t=e.getContext("2d")}catch{return!1}return!0}return!1};return i(),r=function(s){var a;if(i()===!0)return t.width=s.width,t.height=s.height,t.clearRect(0,0,s.width,s.height),t.putImageData(s,0,0),(a=new Image).src=e.toDataURL(),a;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(s){var a,o,u,d,p,_,w,v;if(this.animation){for(v=[],o=p=0,_=(w=this.animation.frames).length;p<_;o=++p)a=w[o],u=s.createImageData(a.width,a.height),d=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(u,d),a.imageData=u,v.push(a.image=r(u));return v}},n.prototype.renderFrame=function(s,a){var o,u,d;return o=(u=this.animation.frames)[a],d=u[a-1],a===0&&s.clearRect(0,0,this.width,this.height),(d!=null?d.disposeOp:void 0)===1?s.clearRect(d.xOffset,d.yOffset,d.width,d.height):(d!=null?d.disposeOp:void 0)===2&&s.putImageData(d.imageData,d.xOffset,d.yOffset),o.blendOp===0&&s.clearRect(o.xOffset,o.yOffset,o.width,o.height),s.drawImage(o.image,o.xOffset,o.yOffset)},n.prototype.animate=function(s){var a,o,u,d,p,_,w=this;return o=0,_=this.animation,d=_.numFrames,u=_.frames,p=_.numPlays,(a=function(){var v,M;if(v=o++%d,M=u[v],w.renderFrame(s,v),d>1&&o/d<p)return w.animation._timeout=setTimeout(a,M.delay)})()},n.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},n.prototype.render=function(s){var a,o;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,a=s.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(o=a.createImageData(this.width,this.height),this.copyToImageData(o,this.decodePixels()),a.putImageData(o,0,0))},n}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function Rle(r){var e=0;if(r[e++]!==71||r[e++]!==73||r[e++]!==70||r[e++]!==56||(r[e++]+1&253)!=56||r[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=r[e++]|r[e++]<<8,n=r[e++]|r[e++]<<8,i=r[e++],s=i>>7,a=1<<(7&i)+1;r[e++],r[e++];var o=null,u=null;s&&(o=e,u=a,e+=3*a);var d=!0,p=[],_=0,w=null,v=0,M=null;for(this.width=t,this.height=n;d&&e<r.length;)switch(r[e++]){case 33:switch(r[e++]){case 255:if(r[e]!==11||r[e+1]==78&&r[e+2]==69&&r[e+3]==84&&r[e+4]==83&&r[e+5]==67&&r[e+6]==65&&r[e+7]==80&&r[e+8]==69&&r[e+9]==50&&r[e+10]==46&&r[e+11]==48&&r[e+12]==3&&r[e+13]==1&&r[e+16]==0)e+=14,M=r[e++]|r[e++]<<8,e++;else for(e+=12;;){if(!((se=r[e++])>=0))throw Error("Invalid block size");if(se===0)break;e+=se}break;case 249:if(r[e++]!==4||r[e+4]!==0)throw new Error("Invalid graphics extension block.");var P=r[e++];_=r[e++]|r[e++]<<8,w=r[e++],!(1&P)&&(w=null),v=P>>2&7,e++;break;case 254:for(;;){if(!((se=r[e++])>=0))throw Error("Invalid block size");if(se===0)break;e+=se}break;default:throw new Error("Unknown graphic control label: 0x"+r[e-1].toString(16))}break;case 44:var D=r[e++]|r[e++]<<8,N=r[e++]|r[e++]<<8,z=r[e++]|r[e++]<<8,W=r[e++]|r[e++]<<8,V=r[e++],$=V>>6&1,q=1<<(7&V)+1,te=o,J=u,me=!1;V>>7&&(me=!0,te=e,J=q,e+=3*q);var xe=e;for(e++;;){var se;if(!((se=r[e++])>=0))throw Error("Invalid block size");if(se===0)break;e+=se}p.push({x:D,y:N,width:z,height:W,has_local_palette:me,palette_offset:te,palette_size:J,data_offset:xe,data_length:e-xe,transparent_index:w,interlaced:!!$,delay:_,disposal:v});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+r[e-1].toString(16))}this.numFrames=function(){return p.length},this.loopCount=function(){return M},this.frameInfo=function(oe){if(oe<0||oe>=p.length)throw new Error("Frame index out of range.");return p[oe]},this.decodeAndBlitFrameBGRA=function(oe,ve){var ge=this.frameInfo(oe),Je=ge.width*ge.height,Ge=new Uint8Array(Je);SL(r,ge.data_offset,Ge,Je);var et=ge.palette_offset,Ye=ge.transparent_index;Ye===null&&(Ye=256);var ct=ge.width,At=t-ct,kt=ct,ae=4*(ge.y*t+ge.x),Te=4*((ge.y+ge.height)*t+ge.x),Le=ae,De=4*At;ge.interlaced===!0&&(De+=4*t*7);for(var at=8,rt=0,xt=Ge.length;rt<xt;++rt){var vt=Ge[rt];if(kt===0&&(kt=ct,(Le+=De)>=Te&&(De=4*At+4*t*(at-1),Le=ae+(ct+At)*(at<<1),at>>=1)),vt===Ye)Le+=4;else{var nr=r[et+3*vt],qt=r[et+3*vt+1],or=r[et+3*vt+2];ve[Le++]=or,ve[Le++]=qt,ve[Le++]=nr,ve[Le++]=255}--kt}},this.decodeAndBlitFrameRGBA=function(oe,ve){var ge=this.frameInfo(oe),Je=ge.width*ge.height,Ge=new Uint8Array(Je);SL(r,ge.data_offset,Ge,Je);var et=ge.palette_offset,Ye=ge.transparent_index;Ye===null&&(Ye=256);var ct=ge.width,At=t-ct,kt=ct,ae=4*(ge.y*t+ge.x),Te=4*((ge.y+ge.height)*t+ge.x),Le=ae,De=4*At;ge.interlaced===!0&&(De+=4*t*7);for(var at=8,rt=0,xt=Ge.length;rt<xt;++rt){var vt=Ge[rt];if(kt===0&&(kt=ct,(Le+=De)>=Te&&(De=4*At+4*t*(at-1),Le=ae+(ct+At)*(at<<1),at>>=1)),vt===Ye)Le+=4;else{var nr=r[et+3*vt],qt=r[et+3*vt+1],or=r[et+3*vt+2];ve[Le++]=nr,ve[Le++]=qt,ve[Le++]=or,ve[Le++]=255}--kt}}}function SL(r,e,t,n){for(var i=r[e++],s=1<<i,a=s+1,o=a+1,u=i+1,d=(1<<u)-1,p=0,_=0,w=0,v=r[e++],M=new Int32Array(4096),P=null;;){for(;p<16&&v!==0;)_|=r[e++]<<p,p+=8,v===1?v=r[e++]:--v;if(p<u)break;var D=_&d;if(_>>=u,p-=u,D!==s){if(D===a)break;for(var N=D<o?D:P,z=0,W=N;W>s;)W=M[W]>>8,++z;var V=W;if(w+z+(N!==D?1:0)>n)return void Ui.log("Warning, gif stream longer than expected.");t[w++]=V;var $=w+=z;for(N!==D&&(t[w++]=V),W=N;z--;)W=M[W],t[--$]=255&W,W>>=8;P!==null&&o<4096&&(M[o++]=P<<8|V,o>=d+1&&u<12&&(++u,d=d<<1|1)),P=D}else o=a+1,d=(1<<(u=i+1))-1,P=null}return w!==n&&Ui.log("Warning, gif stream shorter than expected."),t}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function tB(r){var e,t,n,i,s,a=Math.floor,o=new Array(64),u=new Array(64),d=new Array(64),p=new Array(64),_=new Array(65535),w=new Array(65535),v=new Array(64),M=new Array(64),P=[],D=0,N=7,z=new Array(64),W=new Array(64),V=new Array(64),$=new Array(256),q=new Array(2048),te=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],J=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],me=[0,1,2,3,4,5,6,7,8,9,10,11],xe=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],se=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],oe=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],ve=[0,1,2,3,4,5,6,7,8,9,10,11],ge=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Je=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Ge(ae,Te){for(var Le=0,De=0,at=new Array,rt=1;rt<=16;rt++){for(var xt=1;xt<=ae[rt];xt++)at[Te[De]]=[],at[Te[De]][0]=Le,at[Te[De]][1]=rt,De++,Le++;Le*=2}return at}function et(ae){for(var Te=ae[0],Le=ae[1]-1;Le>=0;)Te&1<<Le&&(D|=1<<N),Le--,--N<0&&(D==255?(Ye(255),Ye(0)):Ye(D),N=7,D=0)}function Ye(ae){P.push(ae)}function ct(ae){Ye(ae>>8&255),Ye(255&ae)}function At(ae,Te,Le,De,at){for(var rt,xt=at[0],vt=at[240],nr=function(Jt,tr){var mr,_r,Ut,ar,Sr,Er,Dr,nn,Hr,Wr,vr=0;for(Hr=0;Hr<8;++Hr){mr=Jt[vr],_r=Jt[vr+1],Ut=Jt[vr+2],ar=Jt[vr+3],Sr=Jt[vr+4],Er=Jt[vr+5],Dr=Jt[vr+6];var Qn=mr+(nn=Jt[vr+7]),un=mr-nn,ni=_r+Dr,Be=_r-Dr,ce=Ut+Er,de=Ut-Er,_e=ar+Sr,Ue=ar-Sr,je=Qn+_e,lt=Qn-_e,dt=ni+ce,Ze=ni-ce;Jt[vr]=je+dt,Jt[vr+4]=je-dt;var ht=.707106781*(Ze+lt);Jt[vr+2]=lt+ht,Jt[vr+6]=lt-ht;var bt=.382683433*((je=Ue+de)-(Ze=Be+un)),pt=.5411961*je+bt,We=1.306562965*Ze+bt,hr=.707106781*(dt=de+Be),sr=un+hr,rr=un-hr;Jt[vr+5]=rr+pt,Jt[vr+3]=rr-pt,Jt[vr+1]=sr+We,Jt[vr+7]=sr-We,vr+=8}for(vr=0,Hr=0;Hr<8;++Hr){mr=Jt[vr],_r=Jt[vr+8],Ut=Jt[vr+16],ar=Jt[vr+24],Sr=Jt[vr+32],Er=Jt[vr+40],Dr=Jt[vr+48];var Nr=mr+(nn=Jt[vr+56]),Rt=mr-nn,ir=_r+Dr,br=_r-Dr,kr=Ut+Er,en=Ut-Er,jr=ar+Sr,Br=ar-Sr,Sn=Nr+jr,Ti=Nr-jr,Bn=ir+kr,zn=ir-kr;Jt[vr]=Sn+Bn,Jt[vr+32]=Sn-Bn;var Cn=.707106781*(zn+Ti);Jt[vr+16]=Ti+Cn,Jt[vr+48]=Ti-Cn;var yi=.382683433*((Sn=Br+en)-(zn=br+Rt)),Un=.5411961*Sn+yi,ba=1.306562965*zn+yi,Ke=.707106781*(Bn=en+br),Pr=Rt+Ke,cr=Rt-Ke;Jt[vr+40]=cr+Un,Jt[vr+24]=cr-Un,Jt[vr+8]=Pr+ba,Jt[vr+56]=Pr-ba,vr++}for(Hr=0;Hr<64;++Hr)Wr=Jt[Hr]*tr[Hr],v[Hr]=Wr>0?Wr+.5|0:Wr-.5|0;return v}(ae,Te),qt=0;qt<64;++qt)M[te[qt]]=nr[qt];var or=M[0]-Le;Le=M[0],or==0?et(De[0]):(et(De[w[rt=32767+or]]),et(_[rt]));for(var gr=63;gr>0&&M[gr]==0;)gr--;if(gr==0)return et(xt),Le;for(var wr,Ot=1;Ot<=gr;){for(var ze=Ot;M[Ot]==0&&Ot<=gr;)++Ot;var $r=Ot-ze;if($r>=16){wr=$r>>4;for(var Rr=1;Rr<=wr;++Rr)et(vt);$r&=15}rt=32767+M[Ot],et(at[($r<<4)+w[rt]]),et(_[rt]),Ot++}return gr!=63&&et(xt),Le}function kt(ae){ae=Math.min(Math.max(ae,1),100),s!=ae&&(function(Te){for(var Le=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],De=0;De<64;De++){var at=a((Le[De]*Te+50)/100);at=Math.min(Math.max(at,1),255),o[te[De]]=at}for(var rt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],xt=0;xt<64;xt++){var vt=a((rt[xt]*Te+50)/100);vt=Math.min(Math.max(vt,1),255),u[te[xt]]=vt}for(var nr=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],qt=0,or=0;or<8;or++)for(var gr=0;gr<8;gr++)d[qt]=1/(o[te[qt]]*nr[or]*nr[gr]*8),p[qt]=1/(u[te[qt]]*nr[or]*nr[gr]*8),qt++}(ae<50?Math.floor(5e3/ae):Math.floor(200-2*ae)),s=ae)}this.encode=function(ae,Te){Te&&kt(Te),P=new Array,D=0,N=7,ct(65496),ct(65504),ct(16),Ye(74),Ye(70),Ye(73),Ye(70),Ye(0),Ye(1),Ye(1),Ye(0),ct(1),ct(1),Ye(0),Ye(0),function(){ct(65499),ct(132),Ye(0);for(var _r=0;_r<64;_r++)Ye(o[_r]);Ye(1);for(var Ut=0;Ut<64;Ut++)Ye(u[Ut])}(),function(_r,Ut){ct(65472),ct(17),Ye(8),ct(Ut),ct(_r),Ye(3),Ye(1),Ye(17),Ye(0),Ye(2),Ye(17),Ye(1),Ye(3),Ye(17),Ye(1)}(ae.width,ae.height),function(){ct(65476),ct(418),Ye(0);for(var _r=0;_r<16;_r++)Ye(J[_r+1]);for(var Ut=0;Ut<=11;Ut++)Ye(me[Ut]);Ye(16);for(var ar=0;ar<16;ar++)Ye(xe[ar+1]);for(var Sr=0;Sr<=161;Sr++)Ye(se[Sr]);Ye(1);for(var Er=0;Er<16;Er++)Ye(oe[Er+1]);for(var Dr=0;Dr<=11;Dr++)Ye(ve[Dr]);Ye(17);for(var nn=0;nn<16;nn++)Ye(ge[nn+1]);for(var Hr=0;Hr<=161;Hr++)Ye(Je[Hr])}(),ct(65498),ct(12),Ye(3),Ye(1),Ye(0),Ye(2),Ye(17),Ye(3),Ye(17),Ye(0),Ye(63),Ye(0);var Le=0,De=0,at=0;D=0,N=7,this.encode.displayName="_encode_";for(var rt,xt,vt,nr,qt,or,gr,wr,Ot,ze=ae.data,$r=ae.width,Rr=ae.height,Jt=4*$r,tr=0;tr<Rr;){for(rt=0;rt<Jt;){for(qt=Jt*tr+rt,gr=-1,wr=0,Ot=0;Ot<64;Ot++)or=qt+(wr=Ot>>3)*Jt+(gr=4*(7&Ot)),tr+wr>=Rr&&(or-=Jt*(tr+1+wr-Rr)),rt+gr>=Jt&&(or-=rt+gr-Jt+4),xt=ze[or++],vt=ze[or++],nr=ze[or++],z[Ot]=(q[xt]+q[vt+256>>0]+q[nr+512>>0]>>16)-128,W[Ot]=(q[xt+768>>0]+q[vt+1024>>0]+q[nr+1280>>0]>>16)-128,V[Ot]=(q[xt+1280>>0]+q[vt+1536>>0]+q[nr+1792>>0]>>16)-128;Le=At(z,d,Le,e,n),De=At(W,p,De,t,i),at=At(V,p,at,t,i),rt+=32}tr+=8}if(N>=0){var mr=[];mr[1]=N+1,mr[0]=(1<<N+1)-1,et(mr)}return ct(65497),new Uint8Array(P)},r=r||50,function(){for(var ae=String.fromCharCode,Te=0;Te<256;Te++)$[Te]=ae(Te)}(),e=Ge(J,me),t=Ge(oe,ve),n=Ge(xe,se),i=Ge(ge,Je),function(){for(var ae=1,Te=2,Le=1;Le<=15;Le++){for(var De=ae;De<Te;De++)w[32767+De]=Le,_[32767+De]=[],_[32767+De][1]=Le,_[32767+De][0]=De;for(var at=-(Te-1);at<=-ae;at++)w[32767+at]=Le,_[32767+at]=[],_[32767+at][1]=Le,_[32767+at][0]=Te-1+at;ae<<=1,Te<<=1}}(),function(){for(var ae=0;ae<256;ae++)q[ae]=19595*ae,q[ae+256>>0]=38470*ae,q[ae+512>>0]=7471*ae+32768,q[ae+768>>0]=-11059*ae,q[ae+1024>>0]=-21709*ae,q[ae+1280>>0]=32768*ae+8421375,q[ae+1536>>0]=-27439*ae,q[ae+1792>>0]=-5329*ae}(),kt(r)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function Xc(r,e){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function IL(r){function e(J){if(!J)throw Error("assert :P")}function t(J,me,xe){for(var se=0;4>se;se++)if(J[me+se]!=xe.charCodeAt(se))return!0;return!1}function n(J,me,xe,se,oe){for(var ve=0;ve<oe;ve++)J[me+ve]=xe[se+ve]}function i(J,me,xe,se){for(var oe=0;oe<se;oe++)J[me+oe]=xe}function s(J){return new Int32Array(J)}function a(J,me){for(var xe=[],se=0;se<J;se++)xe.push(new me);return xe}function o(J,me){var xe=[];return function se(oe,ve,ge){for(var Je=ge[ve],Ge=0;Ge<Je&&(oe.push(ge.length>ve+1?[]:new me),!(ge.length<ve+1));Ge++)se(oe[Ge],ve+1,ge)}(xe,0,J),xe}var u=function(){var J=this;function me(E,F){for(var H=1<<F-1>>>0;E&H;)H>>>=1;return H?(E&H-1)+H:E}function xe(E,F,H,X,ue){e(!(X%H));do E[F+(X-=H)]=ue;while(0<X)}function se(E,F,H,X,ue){if(e(2328>=ue),512>=ue)var ye=s(512);else if((ye=s(ue))==null)return 0;return function(be,we,Ee,Oe,ot,_t){var St,gt,Yt=we,Qt=1<<Ee,ut=s(16),ft=s(16);for(e(ot!=0),e(Oe!=null),e(be!=null),e(0<Ee),gt=0;gt<ot;++gt){if(15<Oe[gt])return 0;++ut[Oe[gt]]}if(ut[0]==ot)return 0;for(ft[1]=0,St=1;15>St;++St){if(ut[St]>1<<St)return 0;ft[St+1]=ft[St]+ut[St]}for(gt=0;gt<ot;++gt)St=Oe[gt],0<Oe[gt]&&(_t[ft[St]++]=gt);if(ft[15]==1)return(Oe=new oe).g=0,Oe.value=_t[0],xe(be,Yt,1,Qt,Oe),Qt;var Gt,er=-1,wt=Qt-1,$t=0,Ir=1,Zr=1,Fr=1<<Ee;for(gt=0,St=1,ot=2;St<=Ee;++St,ot<<=1){if(Ir+=Zr<<=1,0>(Zr-=ut[St]))return 0;for(;0<ut[St];--ut[St])(Oe=new oe).g=St,Oe.value=_t[gt++],xe(be,Yt+$t,ot,Fr,Oe),$t=me($t,St)}for(St=Ee+1,ot=2;15>=St;++St,ot<<=1){if(Ir+=Zr<<=1,0>(Zr-=ut[St]))return 0;for(;0<ut[St];--ut[St]){if(Oe=new oe,($t&wt)!=er){for(Yt+=Fr,Gt=1<<(er=St)-Ee;15>er&&!(0>=(Gt-=ut[er]));)++er,Gt<<=1;Qt+=Fr=1<<(Gt=er-Ee),be[we+(er=$t&wt)].g=Gt+Ee,be[we+er].value=Yt-we-er}Oe.g=St-Ee,Oe.value=_t[gt++],xe(be,Yt+($t>>Ee),ot,Fr,Oe),$t=me($t,St)}}return Ir!=2*ft[15]-1?0:Qt}(E,F,H,X,ue,ye)}function oe(){this.value=this.g=0}function ve(){this.value=this.g=0}function ge(){this.G=a(5,oe),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(vi,ve)}function Je(E,F,H,X){e(E!=null),e(F!=null),e(2147483648>X),E.Ca=254,E.I=0,E.b=-8,E.Ka=0,E.oa=F,E.pa=H,E.Jd=F,E.Yc=H+X,E.Zc=4<=X?H+X-4+1:H,rt(E)}function Ge(E,F){for(var H=0;0<F--;)H|=vt(E,128)<<F;return H}function et(E,F){var H=Ge(E,F);return xt(E)?-H:H}function Ye(E,F,H,X){var ue,ye=0;for(e(E!=null),e(F!=null),e(4294967288>X),E.Sb=X,E.Ra=0,E.u=0,E.h=0,4<X&&(X=4),ue=0;ue<X;++ue)ye+=F[H+ue]<<8*ue;E.Ra=ye,E.bb=X,E.oa=F,E.pa=H}function ct(E){for(;8<=E.u&&E.bb<E.Sb;)E.Ra>>>=8,E.Ra+=E.oa[E.pa+E.bb]<<Ll-8>>>0,++E.bb,E.u-=8;Le(E)&&(E.h=1,E.u=0)}function At(E,F){if(e(0<=F),!E.h&&F<=pc){var H=Te(E)&dc[F];return E.u+=F,ct(E),H}return E.h=1,E.u=0}function kt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function ae(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Te(E){return E.Ra>>>(E.u&Ll-1)>>>0}function Le(E){return e(E.bb<=E.Sb),E.h||E.bb==E.Sb&&E.u>Ll}function De(E,F){E.u=F,E.h=Le(E)}function at(E){E.u>=Ah&&(e(E.u>=Ah),ct(E))}function rt(E){e(E!=null&&E.oa!=null),E.pa<E.Zc?(E.I=(E.oa[E.pa++]|E.I<<8)>>>0,E.b+=8):(e(E!=null&&E.oa!=null),E.pa<E.Yc?(E.b+=8,E.I=E.oa[E.pa++]|E.I<<8):E.Ka?E.b=0:(E.I<<=8,E.b+=8,E.Ka=1))}function xt(E){return Ge(E,1)}function vt(E,F){var H=E.Ca;0>E.b&&rt(E);var X=E.b,ue=H*F>>>8,ye=(E.I>>>X>ue)+0;for(ye?(H-=ue,E.I-=ue+1<<X>>>0):H=ue+1,X=H,ue=0;256<=X;)ue+=8,X>>=8;return X=7^ue+ao[X],E.b-=X,E.Ca=(H<<X)-1,ye}function nr(E,F,H){E[F+0]=H>>24&255,E[F+1]=H>>16&255,E[F+2]=H>>8&255,E[F+3]=H>>0&255}function qt(E,F){return E[F+0]<<0|E[F+1]<<8}function or(E,F){return qt(E,F)|E[F+2]<<16}function gr(E,F){return qt(E,F)|qt(E,F+2)<<16}function wr(E,F){var H=1<<F;return e(E!=null),e(0<F),E.X=s(H),E.X==null?0:(E.Mb=32-F,E.Xa=F,1)}function Ot(E,F){e(E!=null),e(F!=null),e(E.Xa==F.Xa),n(F.X,0,E.X,0,1<<F.Xa)}function ze(){this.X=[],this.Xa=this.Mb=0}function $r(E,F,H,X){e(H!=null),e(X!=null);var ue=H[0],ye=X[0];return ue==0&&(ue=(E*ye+F/2)/F),ye==0&&(ye=(F*ue+E/2)/E),0>=ue||0>=ye?0:(H[0]=ue,X[0]=ye,1)}function Rr(E,F){return E+(1<<F)-1>>>F}function Jt(E,F){return((4278255360&E)+(4278255360&F)>>>0&4278255360)+((16711935&E)+(16711935&F)>>>0&16711935)>>>0}function tr(E,F){J[F]=function(H,X,ue,ye,be,we,Ee){var Oe;for(Oe=0;Oe<be;++Oe){var ot=J[E](we[Ee+Oe-1],ue,ye+Oe);we[Ee+Oe]=Jt(H[X+Oe],ot)}}}function mr(){this.ud=this.hd=this.jd=0}function _r(E,F){return((4278124286&(E^F))>>>1)+(E&F)>>>0}function Ut(E){return 0<=E&&256>E?E:0>E?0:255<E?255:void 0}function ar(E,F){return Ut(E+(E-F+.5>>1))}function Sr(E,F,H){return Math.abs(F-H)-Math.abs(E-H)}function Er(E,F,H,X,ue,ye,be){for(X=ye[be-1],H=0;H<ue;++H)ye[be+H]=X=Jt(E[F+H],X)}function Dr(E,F,H,X,ue){var ye;for(ye=0;ye<H;++ye){var be=E[F+ye],we=be>>8&255,Ee=16711935&(Ee=(Ee=16711935&be)+((we<<16)+we));X[ue+ye]=(4278255360&be)+Ee>>>0}}function nn(E,F){F.jd=E>>0&255,F.hd=E>>8&255,F.ud=E>>16&255}function Hr(E,F,H,X,ue,ye){var be;for(be=0;be<X;++be){var we=F[H+be],Ee=we>>>8,Oe=we,ot=255&(ot=(ot=we>>>16)+((E.jd<<24>>24)*(Ee<<24>>24)>>>5));Oe=255&(Oe=(Oe=Oe+((E.hd<<24>>24)*(Ee<<24>>24)>>>5))+((E.ud<<24>>24)*(ot<<24>>24)>>>5)),ue[ye+be]=(4278255360&we)+(ot<<16)+Oe}}function Wr(E,F,H,X,ue){J[F]=function(ye,be,we,Ee,Oe,ot,_t,St,gt){for(Ee=_t;Ee<St;++Ee)for(_t=0;_t<gt;++_t)Oe[ot++]=ue(we[X(ye[be++])])},J[E]=function(ye,be,we,Ee,Oe,ot,_t){var St=8>>ye.b,gt=ye.Ea,Yt=ye.K[0],Qt=ye.w;if(8>St)for(ye=(1<<ye.b)-1,Qt=(1<<St)-1;be<we;++be){var ut,ft=0;for(ut=0;ut<gt;++ut)ut&ye||(ft=X(Ee[Oe++])),ot[_t++]=ue(Yt[ft&Qt]),ft>>=St}else J["VP8LMapColor"+H](Ee,Oe,Yt,Qt,ot,_t,be,we,gt)}}function vr(E,F,H,X,ue){for(H=F+H;F<H;){var ye=E[F++];X[ue++]=ye>>16&255,X[ue++]=ye>>8&255,X[ue++]=ye>>0&255}}function Qn(E,F,H,X,ue){for(H=F+H;F<H;){var ye=E[F++];X[ue++]=ye>>16&255,X[ue++]=ye>>8&255,X[ue++]=ye>>0&255,X[ue++]=ye>>24&255}}function un(E,F,H,X,ue){for(H=F+H;F<H;){var ye=(be=E[F++])>>16&240|be>>12&15,be=be>>0&240|be>>28&15;X[ue++]=ye,X[ue++]=be}}function ni(E,F,H,X,ue){for(H=F+H;F<H;){var ye=(be=E[F++])>>16&248|be>>13&7,be=be>>5&224|be>>3&31;X[ue++]=ye,X[ue++]=be}}function Be(E,F,H,X,ue){for(H=F+H;F<H;){var ye=E[F++];X[ue++]=ye>>0&255,X[ue++]=ye>>8&255,X[ue++]=ye>>16&255}}function ce(E,F,H,X,ue,ye){if(ye==0)for(H=F+H;F<H;)nr(X,((ye=E[F++])[0]>>24|ye[1]>>8&65280|ye[2]<<8&16711680|ye[3]<<24)>>>0),ue+=32;else n(X,ue,E,F,H)}function de(E,F){J[F][0]=J[E+"0"],J[F][1]=J[E+"1"],J[F][2]=J[E+"2"],J[F][3]=J[E+"3"],J[F][4]=J[E+"4"],J[F][5]=J[E+"5"],J[F][6]=J[E+"6"],J[F][7]=J[E+"7"],J[F][8]=J[E+"8"],J[F][9]=J[E+"9"],J[F][10]=J[E+"10"],J[F][11]=J[E+"11"],J[F][12]=J[E+"12"],J[F][13]=J[E+"13"],J[F][14]=J[E+"0"],J[F][15]=J[E+"0"]}function _e(E){return E==gh||E==eA||E==mh||E==Lu}function Ue(){this.eb=[],this.size=this.A=this.fb=0}function je(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function lt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Ue,this.f.kb=new je,this.sd=null}function dt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ze(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ht(E){return alert("todo:WebPSamplerProcessPlane"),E.T}function bt(E,F){var H=E.T,X=F.ba.f.RGBA,ue=X.eb,ye=X.fb+E.ka*X.A,be=na[F.ba.S],we=E.y,Ee=E.O,Oe=E.f,ot=E.N,_t=E.ea,St=E.W,gt=F.cc,Yt=F.dc,Qt=F.Mc,ut=F.Nc,ft=E.ka,Gt=E.ka+E.T,er=E.U,wt=er+1>>1;for(ft==0?be(we,Ee,null,null,Oe,ot,_t,St,Oe,ot,_t,St,ue,ye,null,null,er):(be(F.ec,F.fc,we,Ee,gt,Yt,Qt,ut,Oe,ot,_t,St,ue,ye-X.A,ue,ye,er),++H);ft+2<Gt;ft+=2)gt=Oe,Yt=ot,Qt=_t,ut=St,ot+=E.Rc,St+=E.Rc,ye+=2*X.A,be(we,(Ee+=2*E.fa)-E.fa,we,Ee,gt,Yt,Qt,ut,Oe,ot,_t,St,ue,ye-X.A,ue,ye,er);return Ee+=E.fa,E.j+Gt<E.o?(n(F.ec,F.fc,we,Ee,er),n(F.cc,F.dc,Oe,ot,wt),n(F.Mc,F.Nc,_t,St,wt),H--):1&Gt||be(we,Ee,null,null,Oe,ot,_t,St,Oe,ot,_t,St,ue,ye+X.A,null,null,er),H}function pt(E,F,H){var X=E.F,ue=[E.J];if(X!=null){var ye=E.U,be=F.ba.S,we=be==Zh||be==mh;F=F.ba.f.RGBA;var Ee=[0],Oe=E.ka;Ee[0]=E.T,E.Kb&&(Oe==0?--Ee[0]:(--Oe,ue[0]-=E.width),E.j+E.ka+E.T==E.o&&(Ee[0]=E.o-E.j-Oe));var ot=F.eb;Oe=F.fb+Oe*F.A,E=si(X,ue[0],E.width,ye,Ee,ot,Oe+(we?0:3),F.A),e(H==Ee),E&&_e(be)&&ra(ot,Oe,we,ye,Ee,F.A)}return 0}function We(E){var F=E.ma,H=F.ba.S,X=11>H,ue=H==ph||H==Ru||H==Zh||H==lf||H==12||_e(H);if(F.memory=null,F.Ib=null,F.Jb=null,F.Nd=null,!Cu(F.Oa,E,ue?11:12))return 0;if(ue&&_e(H)&&ur(),E.da)alert("todo:use_scaling");else{if(X){if(F.Ib=ht,E.Kb){if(H=E.U+1>>1,F.memory=s(E.U+2*H),F.memory==null)return 0;F.ec=F.memory,F.fc=0,F.cc=F.ec,F.dc=F.fc+E.U,F.Mc=F.cc,F.Nc=F.dc+H,F.Ib=bt,ur()}}else alert("todo:EmitYUV");ue&&(F.Jb=pt,X&&Bt())}if(X&&!Cc){for(E=0;256>E;++E)Hl[E]=89858*(E-128)+Bc>>Af,Du[E]=-22014*(E-128)+Bc,Jp[E]=-45773*(E-128),Mr[E]=113618*(E-128)+Bc>>Af;for(E=bh;E<iA;++E)F=76283*(E-16)+Bc>>Af,eg[E-bh]=wo(F,255),sA[E-bh]=wo(F+8>>4,15);Cc=1}return 1}function hr(E){var F=E.ma,H=E.U,X=E.T;return e(!(1&E.ka)),0>=H||0>=X?0:(H=F.Ib(E,F),F.Jb!=null&&F.Jb(E,F,H),F.Dc+=H,1)}function sr(E){E.ma.memory=null}function rr(E,F,H,X){return At(E,8)!=47?0:(F[0]=At(E,14)+1,H[0]=At(E,14)+1,X[0]=At(E,1),At(E,3)!=0?0:!E.h)}function Nr(E,F){if(4>E)return E+1;var H=E-2>>1;return(2+(1&E)<<H)+At(F,H)+1}function Rt(E,F){return 120<F?F-120:1<=(H=((H=Ea[F-1])>>4)*E+(8-(15&H)))?H:1;var H}function ir(E,F,H){var X=Te(H),ue=E[F+=255&X].g-8;return 0<ue&&(De(H,H.u+8),X=Te(H),F+=E[F].value,F+=X&(1<<ue)-1),De(H,H.u+E[F].g),E[F].value}function br(E,F,H){return H.g+=E.g,H.value+=E.value<<F>>>0,e(8>=H.g),E.g}function kr(E,F,H){var X=E.xc;return e((F=X==0?0:E.vc[E.md*(H>>X)+(F>>X)])<E.Wb),E.Ya[F]}function en(E,F,H,X){var ue=E.ab,ye=E.c*F,be=E.C;F=be+F;var we=H,Ee=X;for(X=E.Ta,H=E.Ua;0<ue--;){var Oe=E.gc[ue],ot=be,_t=F,St=we,gt=Ee,Yt=(Ee=X,we=H,Oe.Ea);switch(e(ot<_t),e(_t<=Oe.nc),Oe.hc){case 2:On(St,gt,(_t-ot)*Yt,Ee,we);break;case 0:var Qt=ot,ut=_t,ft=Ee,Gt=we,er=(Fr=Oe).Ea;Qt==0&&(Ol(St,gt,null,null,1,ft,Gt),Er(St,gt+1,0,0,er-1,ft,Gt+1),gt+=er,Gt+=er,++Qt);for(var wt=1<<Fr.b,$t=wt-1,Ir=Rr(er,Fr.b),Zr=Fr.K,Fr=Fr.w+(Qt>>Fr.b)*Ir;Qt<ut;){var fn=Zr,Gn=Fr,mn=1;for(Eu(St,gt,ft,Gt-er,1,ft,Gt);mn<er;){var Ln=(mn&~$t)+wt;Ln>er&&(Ln=er),(0,gc[fn[Gn++]>>8&15])(St,gt+ +mn,ft,Gt+mn-er,Ln-mn,ft,Gt+mn),mn=Ln}gt+=er,Gt+=er,++Qt&$t||(Fr+=Ir)}_t!=Oe.nc&&n(Ee,we-Yt,Ee,we+(_t-ot-1)*Yt,Yt);break;case 1:for(Yt=St,ut=gt,er=(St=Oe.Ea)-(Gt=St&~(ft=(gt=1<<Oe.b)-1)),Qt=Rr(St,Oe.b),wt=Oe.K,Oe=Oe.w+(ot>>Oe.b)*Qt;ot<_t;){for($t=wt,Ir=Oe,Zr=new mr,Fr=ut+Gt,fn=ut+St;ut<Fr;)nn($t[Ir++],Zr),mc(Zr,Yt,ut,gt,Ee,we),ut+=gt,we+=gt;ut<fn&&(nn($t[Ir++],Zr),mc(Zr,Yt,ut,er,Ee,we),ut+=er,we+=er),++ot&ft||(Oe+=Qt)}break;case 3:if(St==Ee&&gt==we&&0<Oe.b){for(ut=Ee,St=Yt=we+(_t-ot)*Yt-(Gt=(_t-ot)*Rr(Oe.Ea,Oe.b)),gt=Ee,ft=we,Qt=[],Gt=(er=Gt)-1;0<=Gt;--Gt)Qt[Gt]=gt[ft+Gt];for(Gt=er-1;0<=Gt;--Gt)ut[St+Gt]=Qt[Gt];Ba(Oe,ot,_t,Ee,Yt,Ee,we)}else Ba(Oe,ot,_t,St,gt,Ee,we)}we=X,Ee=H}Ee!=H&&n(X,H,we,Ee,ye)}function jr(E,F){var H=E.V,X=E.Ba+E.c*E.C,ue=F-E.C;if(e(F<=E.l.o),e(16>=ue),0<ue){var ye=E.l,be=E.Ta,we=E.Ua,Ee=ye.width;if(en(E,ue,H,X),ue=we=[we],e((H=E.C)<(X=F)),e(ye.v<ye.va),X>ye.o&&(X=ye.o),H<ye.j){var Oe=ye.j-H;H=ye.j,ue[0]+=Oe*Ee}if(H>=X?H=0:(ue[0]+=4*ye.v,ye.ka=H-ye.j,ye.U=ye.va-ye.v,ye.T=X-H,H=1),H){if(we=we[0],11>(H=E.ca).S){var ot=H.f.RGBA,_t=(X=H.S,ue=ye.U,ye=ye.T,Oe=ot.eb,ot.A),St=ye;for(ot=ot.fb+E.Ma*ot.A;0<St--;){var gt=be,Yt=we,Qt=ue,ut=Oe,ft=ot;switch(X){case Fu:Ks(gt,Yt,Qt,ut,ft);break;case ph:Ts(gt,Yt,Qt,ut,ft);break;case gh:Ts(gt,Yt,Qt,ut,ft),ra(ut,ft,0,Qt,1,0);break;case Wp:xo(gt,Yt,Qt,ut,ft);break;case Ru:ce(gt,Yt,Qt,ut,ft,1);break;case eA:ce(gt,Yt,Qt,ut,ft,1),ra(ut,ft,0,Qt,1,0);break;case Zh:ce(gt,Yt,Qt,ut,ft,0);break;case mh:ce(gt,Yt,Qt,ut,ft,0),ra(ut,ft,1,Qt,1,0);break;case lf:Va(gt,Yt,Qt,ut,ft);break;case Lu:Va(gt,Yt,Qt,ut,ft),$n(ut,ft,Qt,1,0);break;case Jh:ja(gt,Yt,Qt,ut,ft);break;default:e(0)}we+=Ee,ot+=_t}E.Ma+=ye}else alert("todo:EmitRescaledRowsYUVA");e(E.Ma<=H.height)}}E.C=F,e(E.C<=E.i)}function Br(E){var F;if(0<E.ua)return 0;for(F=0;F<E.Wb;++F){var H=E.Ya[F].G,X=E.Ya[F].H;if(0<H[1][X[1]+0].g||0<H[2][X[2]+0].g||0<H[3][X[3]+0].g)return 0}return 1}function Sn(E,F,H,X,ue,ye){if(E.Z!=0){var be=E.qd,we=E.rd;for(e(zl[E.Z]!=null);F<H;++F)zl[E.Z](be,we,X,ue,X,ue,ye),be=X,we=ue,ue+=ye;E.qd=be,E.rd=we}}function Ti(E,F){var H=E.l.ma,X=H.Z==0||H.Z==1?E.l.j:E.C;if(X=E.C<X?X:E.C,e(F<=E.l.o),F>X){var ue=E.l.width,ye=H.ca,be=H.tb+ue*X,we=E.V,Ee=E.Ba+E.c*X,Oe=E.gc;e(E.ab==1),e(Oe[0].hc==3),af(Oe[0],X,F,we,Ee,ye,be),Sn(H,X,F,ye,be,ue)}E.C=E.Ma=F}function Bn(E,F,H,X,ue,ye,be){var we=E.$/X,Ee=E.$%X,Oe=E.m,ot=E.s,_t=H+E.$,St=_t;ue=H+X*ue;var gt=H+X*ye,Yt=280+ot.ua,Qt=E.Pb?we:16777216,ut=0<ot.ua?ot.Wa:null,ft=ot.wc,Gt=_t<gt?kr(ot,Ee,we):null;e(E.C<ye),e(gt<=ue);var er=!1;e:for(;;){for(;er||_t<gt;){var wt=0;if(we>=Qt){var $t=_t-H;e((Qt=E).Pb),Qt.wd=Qt.m,Qt.xd=$t,0<Qt.s.ua&&Ot(Qt.s.Wa,Qt.s.vb),Qt=we+yd}if(Ee&ft||(Gt=kr(ot,Ee,we)),e(Gt!=null),Gt.Qb&&(F[_t]=Gt.qb,er=!0),!er)if(at(Oe),Gt.jc){wt=Oe,$t=F;var Ir=_t,Zr=Gt.pd[Te(wt)&vi-1];e(Gt.jc),256>Zr.g?(De(wt,wt.u+Zr.g),$t[Ir]=Zr.value,wt=0):(De(wt,wt.u+Zr.g-256),e(256<=Zr.value),wt=Zr.value),wt==0&&(er=!0)}else wt=ir(Gt.G[0],Gt.H[0],Oe);if(Oe.h)break;if(er||256>wt){if(!er)if(Gt.nd)F[_t]=(Gt.qb|wt<<8)>>>0;else{if(at(Oe),er=ir(Gt.G[1],Gt.H[1],Oe),at(Oe),$t=ir(Gt.G[2],Gt.H[2],Oe),Ir=ir(Gt.G[3],Gt.H[3],Oe),Oe.h)break;F[_t]=(Ir<<24|er<<16|wt<<8|$t)>>>0}if(er=!1,++_t,++Ee>=X&&(Ee=0,++we,be!=null&&we<=ye&&!(we%16)&&be(E,we),ut!=null))for(;St<_t;)wt=F[St++],ut.X[(506832829*wt&4294967295)>>>ut.Mb]=wt}else if(280>wt){if(wt=Nr(wt-256,Oe),$t=ir(Gt.G[4],Gt.H[4],Oe),at(Oe),$t=Rt(X,$t=Nr($t,Oe)),Oe.h)break;if(_t-H<$t||ue-_t<wt)break e;for(Ir=0;Ir<wt;++Ir)F[_t+Ir]=F[_t+Ir-$t];for(_t+=wt,Ee+=wt;Ee>=X;)Ee-=X,++we,be!=null&&we<=ye&&!(we%16)&&be(E,we);if(e(_t<=ue),Ee&ft&&(Gt=kr(ot,Ee,we)),ut!=null)for(;St<_t;)wt=F[St++],ut.X[(506832829*wt&4294967295)>>>ut.Mb]=wt}else{if(!(wt<Yt))break e;for(er=wt-280,e(ut!=null);St<_t;)wt=F[St++],ut.X[(506832829*wt&4294967295)>>>ut.Mb]=wt;wt=_t,e(!(er>>>($t=ut).Xa)),F[wt]=$t.X[er],er=!0}er||e(Oe.h==Le(Oe))}if(E.Pb&&Oe.h&&_t<ue)e(E.m.h),E.a=5,E.m=E.wd,E.$=E.xd,0<E.s.ua&&Ot(E.s.vb,E.s.Wa);else{if(Oe.h)break e;be!=null&&be(E,we>ye?ye:we),E.a=0,E.$=_t-H}return 1}return E.a=3,0}function zn(E){e(E!=null),E.vc=null,E.yc=null,E.Ya=null;var F=E.Wa;F!=null&&(F.X=null),E.vb=null,e(E!=null)}function Cn(){var E=new Xh;return E==null?null:(E.a=0,E.xb=xd,de("Predictor","VP8LPredictors"),de("Predictor","VP8LPredictors_C"),de("PredictorAdd","VP8LPredictorsAdd"),de("PredictorAdd","VP8LPredictorsAdd_C"),On=Dr,mc=Hr,Ks=vr,Ts=Qn,Va=un,ja=ni,xo=Be,J.VP8LMapColor32b=fh,J.VP8LMapColor8b=Yh,E)}function yi(E,F,H,X,ue){var ye=1,be=[E],we=[F],Ee=X.m,Oe=X.s,ot=null,_t=0;e:for(;;){if(H)for(;ye&&At(Ee,1);){var St=be,gt=we,Yt=X,Qt=1,ut=Yt.m,ft=Yt.gc[Yt.ab],Gt=At(ut,2);if(Yt.Oc&1<<Gt)ye=0;else{switch(Yt.Oc|=1<<Gt,ft.hc=Gt,ft.Ea=St[0],ft.nc=gt[0],ft.K=[null],++Yt.ab,e(4>=Yt.ab),Gt){case 0:case 1:ft.b=At(ut,3)+2,Qt=yi(Rr(ft.Ea,ft.b),Rr(ft.nc,ft.b),0,Yt,ft.K),ft.K=ft.K[0];break;case 3:var er,wt=At(ut,8)+1,$t=16<wt?0:4<wt?1:2<wt?2:3;if(St[0]=Rr(ft.Ea,$t),ft.b=$t,er=Qt=yi(wt,1,0,Yt,ft.K)){var Ir,Zr=wt,Fr=ft,fn=1<<(8>>Fr.b),Gn=s(fn);if(Gn==null)er=0;else{var mn=Fr.K[0],Ln=Fr.w;for(Gn[0]=Fr.K[0][0],Ir=1;Ir<1*Zr;++Ir)Gn[Ir]=Jt(mn[Ln+Ir],Gn[Ir-1]);for(;Ir<4*fn;++Ir)Gn[Ir]=0;Fr.K[0]=null,Fr.K[0]=Gn,er=1}}Qt=er;break;case 2:break;default:e(0)}ye=Qt}}if(be=be[0],we=we[0],ye&&At(Ee,1)&&!(ye=1<=(_t=At(Ee,4))&&11>=_t)){X.a=3;break e}var Vn;if(Vn=ye)t:{var Jr,Gr,Zi,Ss=X,Ii=be,uo=we,jn=_t,Ji=H,Is=Ss.m,Gi=Ss.s,ls=[null],fs=1,Ho=0,Co=_d[jn];r:for(;;){if(Ji&&At(Is,1)){var Mi=At(Is,3)+2,Ga=Rr(Ii,Mi),ml=Rr(uo,Mi),ia=Ga*ml;if(!yi(Ga,ml,0,Ss,ls))break r;for(ls=ls[0],Gi.xc=Mi,Jr=0;Jr<ia;++Jr){var _l=ls[Jr]>>8&65535;ls[Jr]=_l,_l>=fs&&(fs=_l+1)}}if(Is.h)break r;for(Gr=0;5>Gr;++Gr){var Pi=rA[Gr];!Gr&&0<jn&&(Pi+=1<<jn),Ho<Pi&&(Ho=Pi)}var Nu=a(fs*Co,oe),ff=fs,x=a(ff,ge);if(x==null)var l=null;else e(65536>=ff),l=x;var h=s(Ho);if(l==null||h==null||Nu==null){Ss.a=1;break r}var m=Nu;for(Jr=Zi=0;Jr<fs;++Jr){var y=l[Jr],C=y.G,S=y.H,R=0,O=1,Q=0;for(Gr=0;5>Gr;++Gr){Pi=rA[Gr],C[Gr]=m,S[Gr]=Zi,!Gr&&0<jn&&(Pi+=1<<jn);i:{var K,Z=Pi,ee=Ss,Ae=h,pe=m,Fe=Zi,Me=0,Re=ee.m,Ne=At(Re,1);if(i(Ae,0,0,Z),Ne){var $e=At(Re,1)+1,qe=At(Re,1),Xe=At(Re,qe==0?1:8);Ae[Xe]=1,$e==2&&(Ae[Xe=At(Re,8)]=1);var tt=1}else{var it=s(19),Et=At(Re,4)+4;if(19<Et){ee.a=3;var Ct=0;break i}for(K=0;K<Et;++K)it[Ou[K]]=At(Re,3);var Dt=void 0,Ht=void 0,Lt=ee,dr=it,Ar=Z,Kt=Ae,xr=0,sn=Lt.m,Mn=8,gi=a(128,oe);n:for(;se(gi,0,7,dr,19);){if(At(sn,1)){var ei=2+2*At(sn,3);if((Dt=2+At(sn,ei))>Ar)break n}else Dt=Ar;for(Ht=0;Ht<Ar&&Dt--;){at(sn);var mi=gi[0+(127&Te(sn))];De(sn,sn.u+mi.g);var Dn=mi.value;if(16>Dn)Kt[Ht++]=Dn,Dn!=0&&(Mn=Dn);else{var qn=Dn==16,Kn=Dn-16,Xs=md[Kn],es=At(sn,tA[Kn])+Xs;if(Ht+es>Ar)break n;for(var cs=qn?Mn:0;0<es--;)Kt[Ht++]=cs}}xr=1;break n}xr||(Lt.a=3),tt=xr}(tt=tt&&!Re.h)&&(Me=se(pe,Fe,8,Ae,Z)),tt&&Me!=0?Ct=Me:(ee.a=3,Ct=0)}if(Ct==0)break r;if(O&&wi[Gr]==1&&(O=m[Zi].g==0),R+=m[Zi].g,Zi+=Ct,3>=Gr){var ds,qa=h[0];for(ds=1;ds<Pi;++ds)h[ds]>qa&&(qa=h[ds]);Q+=qa}}if(y.nd=O,y.Qb=0,O&&(y.qb=(C[3][S[3]+0].value<<24|C[1][S[1]+0].value<<16|C[2][S[2]+0].value)>>>0,R==0&&256>C[0][S[0]+0].value&&(y.Qb=1,y.qb+=C[0][S[0]+0].value<<8)),y.jc=!y.Qb&&6>Q,y.jc){var sa,ts=y;for(sa=0;sa<vi;++sa){var ho=sa,Ia=ts.pd[ho],Tc=ts.G[0][ts.H[0]+ho];256<=Tc.value?(Ia.g=Tc.g+256,Ia.value=Tc.value):(Ia.g=0,Ia.value=0,ho>>=br(Tc,8,Ia),ho>>=br(ts.G[1][ts.H[1]+ho],16,Ia),ho>>=br(ts.G[2][ts.H[2]+ho],0,Ia),br(ts.G[3][ts.H[3]+ho],24,Ia))}}}Gi.vc=ls,Gi.Wb=fs,Gi.Ya=l,Gi.yc=Nu,Vn=1;break t}Vn=0}if(!(ye=Vn)){X.a=3;break e}if(0<_t){if(Oe.ua=1<<_t,!wr(Oe.Wa,_t)){X.a=1,ye=0;break e}}else Oe.ua=0;var Ec=X,To=be,Ma=we,Vo=Ec.s,Eo=Vo.xc;if(Ec.c=To,Ec.i=Ma,Vo.md=Rr(To,Eo),Vo.wc=Eo==0?-1:(1<<Eo)-1,H){X.xb=Yp;break e}if((ot=s(be*we))==null){X.a=1,ye=0;break e}ye=(ye=Bn(X,ot,0,be,we,we,null))&&!Ee.h;break e}return ye?(ue!=null?ue[0]=ot:(e(ot==null),e(H)),X.$=0,H||zn(Oe)):zn(Oe),ye}function Un(E,F){var H=E.c*E.i,X=H+F+16*F;return e(E.c<=F),E.V=s(X),E.V==null?(E.Ta=null,E.Ua=0,E.a=1,0):(E.Ta=E.V,E.Ua=E.Ba+H+F,1)}function ba(E,F){var H=E.C,X=F-H,ue=E.V,ye=E.Ba+E.c*H;for(e(F<=E.l.o);0<X;){var be=16<X?16:X,we=E.l.ma,Ee=E.l.width,Oe=Ee*be,ot=we.ca,_t=we.tb+Ee*H,St=E.Ta,gt=E.Ua;en(E,be,ue,ye),Yi(St,gt,ot,_t,Oe),Sn(we,H,H+be,ot,_t,Ee),X-=be,ue+=be*E.c,H+=be}e(H==F),E.C=E.Ma=F}function Ke(){this.ub=this.yd=this.td=this.Rb=0}function Pr(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function cr(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function pn(){this.Yb=function(){var E=[];return function F(H,X,ue){for(var ye=ue[X],be=0;be<ye&&(H.push(ue.length>X+1?[]:0),!(ue.length<X+1));be++)F(H[be],X+1,ue)}(E,0,[3,11]),E}()}function di(){this.jb=s(3),this.Wc=o([4,8],pn),this.Xc=o([4,17],pn)}function As(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function li(){this.ld=this.La=this.dd=this.tc=0}function xs(){this.Na=this.la=0}function vo(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function ss(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function oh(){this.uc=this.M=this.Nb=0,this.wa=Array(new li),this.Y=0,this.ya=Array(new ss),this.aa=0,this.l=new lc}function ef(){this.y=s(16),this.f=s(8),this.ea=s(8)}function tf(){this.cb=this.a=0,this.sc="",this.m=new kt,this.Od=new Ke,this.Kc=new Pr,this.ed=new As,this.Qa=new cr,this.Ic=this.$c=this.Aa=0,this.D=new oh,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,kt),this.ia=0,this.pb=a(4,vo),this.Pa=new di,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ef),this.Hd=0,this.rb=Array(new xs),this.sb=0,this.wa=Array(new li),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new ss),this.L=this.aa=0,this.gd=o([4,2],li),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function lc(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ml(){var E=new tf;return E!=null&&(E.a=0,E.sc="OK",E.cb=0,E.Xb=0,dl||(dl=ah)),E}function Di(E,F,H){return E.a==0&&(E.a=F,E.sc=H,E.cb=0),0}function $h(E,F,H){return 3<=H&&E[F+0]==157&&E[F+1]==1&&E[F+2]==42}function ll(E,F){if(E==null)return 0;if(E.a=0,E.sc="OK",F==null)return Di(E,2,"null VP8Io passed to VP8GetHeaders()");var H=F.data,X=F.w,ue=F.ha;if(4>ue)return Di(E,7,"Truncated header.");var ye=H[X+0]|H[X+1]<<8|H[X+2]<<16,be=E.Od;if(be.Rb=!(1&ye),be.td=ye>>1&7,be.yd=ye>>4&1,be.ub=ye>>5,3<be.td)return Di(E,3,"Incorrect keyframe parameters.");if(!be.yd)return Di(E,4,"Frame not displayable.");X+=3,ue-=3;var we=E.Kc;if(be.Rb){if(7>ue)return Di(E,7,"cannot parse picture header");if(!$h(H,X,ue))return Di(E,3,"Bad code word");we.c=16383&(H[X+4]<<8|H[X+3]),we.Td=H[X+4]>>6,we.i=16383&(H[X+6]<<8|H[X+5]),we.Ud=H[X+6]>>6,X+=7,ue-=7,E.za=we.c+15>>4,E.Ub=we.i+15>>4,F.width=we.c,F.height=we.i,F.Da=0,F.j=0,F.v=0,F.va=F.width,F.o=F.height,F.da=0,F.ib=F.width,F.hb=F.height,F.U=F.width,F.T=F.height,i((ye=E.Pa).jb,0,255,ye.jb.length),e((ye=E.Qa)!=null),ye.Cb=0,ye.Bb=0,ye.Fb=1,i(ye.Zb,0,0,ye.Zb.length),i(ye.Lb,0,0,ye.Lb)}if(be.ub>ue)return Di(E,7,"bad partition length");Je(ye=E.m,H,X,be.ub),X+=be.ub,ue-=be.ub,be.Rb&&(we.Ld=xt(ye),we.Kd=xt(ye)),we=E.Qa;var Ee,Oe=E.Pa;if(e(ye!=null),e(we!=null),we.Cb=xt(ye),we.Cb){if(we.Bb=xt(ye),xt(ye)){for(we.Fb=xt(ye),Ee=0;4>Ee;++Ee)we.Zb[Ee]=xt(ye)?et(ye,7):0;for(Ee=0;4>Ee;++Ee)we.Lb[Ee]=xt(ye)?et(ye,6):0}if(we.Bb)for(Ee=0;3>Ee;++Ee)Oe.jb[Ee]=xt(ye)?Ge(ye,8):255}else we.Bb=0;if(ye.Ka)return Di(E,3,"cannot parse segment header");if((we=E.ed).zd=xt(ye),we.Tb=Ge(ye,6),we.wb=Ge(ye,3),we.Pc=xt(ye),we.Pc&&xt(ye)){for(Oe=0;4>Oe;++Oe)xt(ye)&&(we.vd[Oe]=et(ye,6));for(Oe=0;4>Oe;++Oe)xt(ye)&&(we.od[Oe]=et(ye,6))}if(E.L=we.Tb==0?0:we.zd?1:2,ye.Ka)return Di(E,3,"cannot parse filter header");var ot=ue;if(ue=Ee=X,X=Ee+ot,we=ot,E.Xb=(1<<Ge(E.m,2))-1,ot<3*(Oe=E.Xb))H=7;else{for(Ee+=3*Oe,we-=3*Oe,ot=0;ot<Oe;++ot){var _t=H[ue+0]|H[ue+1]<<8|H[ue+2]<<16;_t>we&&(_t=we),Je(E.Jc[+ot],H,Ee,_t),Ee+=_t,we-=_t,ue+=3}Je(E.Jc[+Oe],H,Ee,we),H=Ee<X?0:5}if(H!=0)return Di(E,H,"cannot parse partitions");for(H=Ge(Ee=E.m,7),ue=xt(Ee)?et(Ee,4):0,X=xt(Ee)?et(Ee,4):0,we=xt(Ee)?et(Ee,4):0,Oe=xt(Ee)?et(Ee,4):0,Ee=xt(Ee)?et(Ee,4):0,ot=E.Qa,_t=0;4>_t;++_t){if(ot.Cb){var St=ot.Zb[_t];ot.Fb||(St+=H)}else{if(0<_t){E.pb[_t]=E.pb[0];continue}St=H}var gt=E.pb[_t];gt.Sc[0]=cf[wo(St+ue,127)],gt.Sc[1]=wc[wo(St+0,127)],gt.Eb[0]=2*cf[wo(St+X,127)],gt.Eb[1]=101581*wc[wo(St+we,127)]>>16,8>gt.Eb[1]&&(gt.Eb[1]=8),gt.Qc[0]=cf[wo(St+Oe,117)],gt.Qc[1]=wc[wo(St+Ee,127)],gt.lc=St+Ee}if(!be.Rb)return Di(E,4,"Not a key frame.");for(xt(ye),be=E.Pa,H=0;4>H;++H){for(ue=0;8>ue;++ue)for(X=0;3>X;++X)for(we=0;11>we;++we)Oe=vt(ye,Xp[H][ue][X][we])?Ge(ye,8):vd[H][ue][X][we],be.Wc[H][ue].Yb[X][we]=Oe;for(ue=0;17>ue;++ue)be.Xc[H][ue]=be.Wc[H][xc[ue]]}return E.kc=xt(ye),E.kc&&(E.Bd=Ge(ye,8)),E.cb=1}function ah(E,F,H,X,ue,ye,be){var we=F[ue].Yb[H];for(H=0;16>ue;++ue){if(!vt(E,we[H+0]))return ue;for(;!vt(E,we[H+1]);)if(we=F[++ue].Yb[0],H=0,ue==16)return 16;var Ee=F[ue+1].Yb;if(vt(E,we[H+2])){var Oe=E,ot=0;if(vt(Oe,(St=we)[(_t=H)+3]))if(vt(Oe,St[_t+6])){for(we=0,_t=2*(ot=vt(Oe,St[_t+8]))+(St=vt(Oe,St[_t+9+ot])),ot=0,St=uf[_t];St[we];++we)ot+=ot+vt(Oe,St[we]);ot+=3+(8<<_t)}else vt(Oe,St[_t+7])?(ot=7+2*vt(Oe,165),ot+=vt(Oe,145)):ot=5+vt(Oe,159);else ot=vt(Oe,St[_t+4])?3+vt(Oe,St[_t+5]):2;we=Ee[2]}else ot=1,we=Ee[1];Ee=be+nA[ue],0>(Oe=E).b&&rt(Oe);var _t,St=Oe.b,gt=(_t=Oe.Ca>>1)-(Oe.I>>St)>>31;--Oe.b,Oe.Ca+=gt,Oe.Ca|=1,Oe.I-=(_t+1&gt)<<St,ye[Ee]=((ot^gt)-gt)*X[(0<ue)+0]}return 16}function cc(E){var F=E.rb[E.sb-1];F.la=0,F.Na=0,i(E.zc,0,0,E.zc.length),E.ja=0}function rf(E,F){if(E==null)return 0;if(F==null)return Di(E,2,"NULL VP8Io parameter in VP8Decode().");if(!E.cb&&!ll(E,F))return 0;if(e(E.cb),F.ac==null||F.ac(F)){F.ob&&(E.L=0);var H=oA[E.L];if(E.L==2?(E.yb=0,E.zb=0):(E.yb=F.v-H>>4,E.zb=F.j-H>>4,0>E.yb&&(E.yb=0),0>E.zb&&(E.zb=0)),E.Va=F.o+15+H>>4,E.Hb=F.va+15+H>>4,E.Hb>E.za&&(E.Hb=E.za),E.Va>E.Ub&&(E.Va=E.Ub),0<E.L){var X=E.ed;for(H=0;4>H;++H){var ue;if(E.Qa.Cb){var ye=E.Qa.Lb[H];E.Qa.Fb||(ye+=X.Tb)}else ye=X.Tb;for(ue=0;1>=ue;++ue){var be=E.gd[H][ue],we=ye;if(X.Pc&&(we+=X.vd[0],ue&&(we+=X.od[0])),0<(we=0>we?0:63<we?63:we)){var Ee=we;0<X.wb&&(Ee=4<X.wb?Ee>>2:Ee>>1)>9-X.wb&&(Ee=9-X.wb),1>Ee&&(Ee=1),be.dd=Ee,be.tc=2*we+Ee,be.ld=40<=we?2:15<=we?1:0}else be.tc=0;be.La=ue}}}H=0}else Di(E,6,"Frame setup failed"),H=E.a;if(H=H==0){if(H){E.$c=0,0<E.Aa||(E.Ic=vh);e:{H=E.Ic,X=4*(Ee=E.za);var Oe=32*Ee,ot=Ee+1,_t=0<E.L?Ee*(0<E.Aa?2:1):0,St=(E.Aa==2?2:1)*Ee;if((be=X+832+(ue=3*(16*H+oA[E.L])/2*Oe)+(ye=E.Fa!=null&&0<E.Fa.length?E.Kc.c*E.Kc.i:0))!=be)H=0;else{if(be>E.Vb){if(E.Vb=0,E.Ec=s(be),E.Fc=0,E.Ec==null){H=Di(E,1,"no memory during frame initialization.");break e}E.Vb=be}be=E.Ec,we=E.Fc,E.Ac=be,E.Bc=we,we+=X,E.Gd=a(Oe,ef),E.Hd=0,E.rb=a(ot+1,xs),E.sb=1,E.wa=_t?a(_t,li):null,E.Y=0,E.D.Nb=0,E.D.wa=E.wa,E.D.Y=E.Y,0<E.Aa&&(E.D.Y+=Ee),e(!0),E.oc=be,E.pc=we,we+=832,E.ya=a(St,ss),E.aa=0,E.D.ya=E.ya,E.D.aa=E.aa,E.Aa==2&&(E.D.aa+=Ee),E.R=16*Ee,E.B=8*Ee,Ee=(Oe=oA[E.L])*E.R,Oe=Oe/2*E.B,E.sa=be,E.ta=we+Ee,E.qa=E.sa,E.ra=E.ta+16*H*E.R+Oe,E.Ha=E.qa,E.Ia=E.ra+8*H*E.B+Oe,E.$c=0,we+=ue,E.mb=ye?be:null,E.nb=ye?we:null,e(we+ye<=E.Fc+E.Vb),cc(E),i(E.Ac,E.Bc,0,X),H=1}}if(H){if(F.ka=0,F.y=E.sa,F.O=E.ta,F.f=E.qa,F.N=E.ra,F.ea=E.Ha,F.Vd=E.Ia,F.fa=E.R,F.Rc=E.B,F.F=null,F.J=0,!Mu){for(H=-255;255>=H;++H)as[255+H]=0>H?-H:H;for(H=-1020;1020>=H;++H)kl[1020+H]=-128>H?-128:127<H?127:H;for(H=-112;112>=H;++H)bc[112+H]=-16>H?-16:15<H?15:H;for(H=-255;510>=H;++H)Ql[255+H]=0>H?0:255<H?255:H;Mu=1}$a=Ei,os=dn,dh=hu,Ws=nf,Es=hc,$i=Yo,Ul=mu,Su=Qo,Dl=hh,fl=_u,_c=sf,ta=uh,Ca=Wh,Iu=yu,Nl=fc,gn=In,yc=No,Ta=Jo,lo[0]=Cs,lo[1]=pi,lo[2]=Do,lo[3]=qh,lo[4]=fu,lo[5]=Qa,lo[6]=Zn,lo[7]=yn,lo[8]=du,lo[9]=on,pl[0]=cl,pl[1]=Bs,pl[2]=Si,pl[3]=Wi,pl[4]=_n,pl[5]=Au,pl[6]=Zo,gl[0]=va,gl[1]=Gh,gl[2]=En,gl[3]=ul,gl[4]=za,gl[5]=pu,gl[6]=Ha,H=1}else H=0}H&&(H=function(gt,Yt){for(gt.M=0;gt.M<gt.Va;++gt.M){var Qt,ut=gt.Jc[gt.M&gt.Xb],ft=gt.m,Gt=gt;for(Qt=0;Qt<Gt.za;++Qt){var er=ft,wt=Gt,$t=wt.Ac,Ir=wt.Bc+4*Qt,Zr=wt.zc,Fr=wt.ya[wt.aa+Qt];if(wt.Qa.Bb?Fr.$b=vt(er,wt.Pa.jb[0])?2+vt(er,wt.Pa.jb[2]):vt(er,wt.Pa.jb[1]):Fr.$b=0,wt.kc&&(Fr.Ad=vt(er,wt.Bd)),Fr.Za=!vt(er,145)+0,Fr.Za){var fn=Fr.Ob,Gn=0;for(wt=0;4>wt;++wt){var mn,Ln=Zr[0+wt];for(mn=0;4>mn;++mn){Ln=wd[$t[Ir+mn]][Ln];for(var Vn=bd[vt(er,Ln[0])];0<Vn;)Vn=bd[2*Vn+vt(er,Ln[Vn])];Ln=-Vn,$t[Ir+mn]=Ln}n(fn,Gn,$t,Ir,4),Gn+=4,Zr[0+wt]=Ln}}else Ln=vt(er,156)?vt(er,128)?1:3:vt(er,163)?2:0,Fr.Ob[0]=Ln,i($t,Ir,Ln,4),i(Zr,0,Ln,4);Fr.Dd=vt(er,142)?vt(er,114)?vt(er,183)?1:3:2:0}if(Gt.m.Ka)return Di(gt,7,"Premature end-of-partition0 encountered.");for(;gt.ja<gt.za;++gt.ja){if(Gt=ut,er=(ft=gt).rb[ft.sb-1],$t=ft.rb[ft.sb+ft.ja],Qt=ft.ya[ft.aa+ft.ja],Ir=ft.kc?Qt.Ad:0)er.la=$t.la=0,Qt.Za||(er.Na=$t.Na=0),Qt.Hc=0,Qt.Gc=0,Qt.ia=0;else{var Jr,Gr;if(er=$t,$t=Gt,Ir=ft.Pa.Xc,Zr=ft.ya[ft.aa+ft.ja],Fr=ft.pb[Zr.$b],wt=Zr.ad,fn=0,Gn=ft.rb[ft.sb-1],Ln=mn=0,i(wt,fn,0,384),Zr.Za)var Zi=0,Ss=Ir[3];else{Vn=s(16);var Ii=er.Na+Gn.Na;if(Ii=dl($t,Ir[1],Ii,Fr.Eb,0,Vn,0),er.Na=Gn.Na=(0<Ii)+0,1<Ii)$a(Vn,0,wt,fn);else{var uo=Vn[0]+3>>3;for(Vn=0;256>Vn;Vn+=16)wt[fn+Vn]=uo}Zi=1,Ss=Ir[0]}var jn=15&er.la,Ji=15&Gn.la;for(Vn=0;4>Vn;++Vn){var Is=1&Ji;for(uo=Gr=0;4>uo;++uo)jn=jn>>1|(Is=(Ii=dl($t,Ss,Ii=Is+(1&jn),Fr.Sc,Zi,wt,fn))>Zi)<<7,Gr=Gr<<2|(3<Ii?3:1<Ii?2:wt[fn+0]!=0),fn+=16;jn>>=4,Ji=Ji>>1|Is<<7,mn=(mn<<8|Gr)>>>0}for(Ss=jn,Zi=Ji>>4,Jr=0;4>Jr;Jr+=2){for(Gr=0,jn=er.la>>4+Jr,Ji=Gn.la>>4+Jr,Vn=0;2>Vn;++Vn){for(Is=1&Ji,uo=0;2>uo;++uo)Ii=Is+(1&jn),jn=jn>>1|(Is=0<(Ii=dl($t,Ir[2],Ii,Fr.Qc,0,wt,fn)))<<3,Gr=Gr<<2|(3<Ii?3:1<Ii?2:wt[fn+0]!=0),fn+=16;jn>>=2,Ji=Ji>>1|Is<<5}Ln|=Gr<<4*Jr,Ss|=jn<<4<<Jr,Zi|=(240&Ji)<<Jr}er.la=Ss,Gn.la=Zi,Zr.Hc=mn,Zr.Gc=Ln,Zr.ia=43690&Ln?0:Fr.ia,Ir=!(mn|Ln)}if(0<ft.L&&(ft.wa[ft.Y+ft.ja]=ft.gd[Qt.$b][Qt.Za],ft.wa[ft.Y+ft.ja].La|=!Ir),Gt.Ka)return Di(gt,7,"Premature end-of-file encountered.")}if(cc(gt),ft=Yt,Gt=1,Qt=(ut=gt).D,er=0<ut.L&&ut.M>=ut.zb&&ut.M<=ut.Va,ut.Aa==0)e:{if(Qt.M=ut.M,Qt.uc=er,xu(ut,Qt),Gt=1,Qt=(Gr=ut.D).Nb,er=(Ln=oA[ut.L])*ut.R,$t=Ln/2*ut.B,Vn=16*Qt*ut.R,uo=8*Qt*ut.B,Ir=ut.sa,Zr=ut.ta-er+Vn,Fr=ut.qa,wt=ut.ra-$t+uo,fn=ut.Ha,Gn=ut.Ia-$t+uo,Ji=(jn=Gr.M)==0,mn=jn>=ut.Va-1,ut.Aa==2&&xu(ut,Gr),Gr.uc)for(Is=(Ii=ut).D.M,e(Ii.D.uc),Gr=Ii.yb;Gr<Ii.Hb;++Gr){Zi=Gr,Ss=Is;var Gi=(ls=(Pi=Ii).D).Nb;Jr=Pi.R;var ls=ls.wa[ls.Y+Zi],fs=Pi.sa,Ho=Pi.ta+16*Gi*Jr+16*Zi,Co=ls.dd,Mi=ls.tc;if(Mi!=0)if(e(3<=Mi),Pi.L==1)0<Zi&&gn(fs,Ho,Jr,Mi+4),ls.La&&Ta(fs,Ho,Jr,Mi),0<Ss&&Nl(fs,Ho,Jr,Mi+4),ls.La&&yc(fs,Ho,Jr,Mi);else{var Ga=Pi.B,ml=Pi.qa,ia=Pi.ra+8*Gi*Ga+8*Zi,_l=Pi.Ha,Pi=Pi.Ia+8*Gi*Ga+8*Zi;Gi=ls.ld,0<Zi&&(Su(fs,Ho,Jr,Mi+4,Co,Gi),fl(ml,ia,_l,Pi,Ga,Mi+4,Co,Gi)),ls.La&&(ta(fs,Ho,Jr,Mi,Co,Gi),Iu(ml,ia,_l,Pi,Ga,Mi,Co,Gi)),0<Ss&&(Ul(fs,Ho,Jr,Mi+4,Co,Gi),Dl(ml,ia,_l,Pi,Ga,Mi+4,Co,Gi)),ls.La&&(_c(fs,Ho,Jr,Mi,Co,Gi),Ca(ml,ia,_l,Pi,Ga,Mi,Co,Gi))}}if(ut.ia&&alert("todo:DitherRow"),ft.put!=null){if(Gr=16*jn,jn=16*(jn+1),Ji?(ft.y=ut.sa,ft.O=ut.ta+Vn,ft.f=ut.qa,ft.N=ut.ra+uo,ft.ea=ut.Ha,ft.W=ut.Ia+uo):(Gr-=Ln,ft.y=Ir,ft.O=Zr,ft.f=Fr,ft.N=wt,ft.ea=fn,ft.W=Gn),mn||(jn-=Ln),jn>ft.o&&(jn=ft.o),ft.F=null,ft.J=null,ut.Fa!=null&&0<ut.Fa.length&&Gr<jn&&(ft.J=Rl(ut,ft,Gr,jn-Gr),ft.F=ut.mb,ft.F==null&&ft.F.length==0)){Gt=Di(ut,3,"Could not decode alpha data.");break e}Gr<ft.j&&(Ln=ft.j-Gr,Gr=ft.j,e(!(1&Ln)),ft.O+=ut.R*Ln,ft.N+=ut.B*(Ln>>1),ft.W+=ut.B*(Ln>>1),ft.F!=null&&(ft.J+=ft.width*Ln)),Gr<jn&&(ft.O+=ft.v,ft.N+=ft.v>>1,ft.W+=ft.v>>1,ft.F!=null&&(ft.J+=ft.v),ft.ka=Gr-ft.j,ft.U=ft.va-ft.v,ft.T=jn-Gr,Gt=ft.put(ft))}Qt+1!=ut.Ic||mn||(n(ut.sa,ut.ta-er,Ir,Zr+16*ut.R,er),n(ut.qa,ut.ra-$t,Fr,wt+8*ut.B,$t),n(ut.Ha,ut.Ia-$t,fn,Gn+8*ut.B,$t))}if(!Gt)return Di(gt,6,"Output aborted.")}return 1}(E,F)),F.bc!=null&&F.bc(F),H&=1}return H?(E.cb=0,H):0}function Vs(E,F,H,X,ue){ue=E[F+H+32*X]+(ue>>3),E[F+H+32*X]=-256&ue?0>ue?0:255:ue}function uc(E,F,H,X,ue,ye){Vs(E,F,0,H,X+ue),Vs(E,F,1,H,X+ye),Vs(E,F,2,H,X-ye),Vs(E,F,3,H,X-ue)}function Ni(E){return(20091*E>>16)+E}function an(E,F,H,X){var ue,ye=0,be=s(16);for(ue=0;4>ue;++ue){var we=E[F+0]+E[F+8],Ee=E[F+0]-E[F+8],Oe=(35468*E[F+4]>>16)-Ni(E[F+12]),ot=Ni(E[F+4])+(35468*E[F+12]>>16);be[ye+0]=we+ot,be[ye+1]=Ee+Oe,be[ye+2]=Ee-Oe,be[ye+3]=we-ot,ye+=4,F++}for(ue=ye=0;4>ue;++ue)we=(E=be[ye+0]+4)+be[ye+8],Ee=E-be[ye+8],Oe=(35468*be[ye+4]>>16)-Ni(be[ye+12]),Vs(H,X,0,0,we+(ot=Ni(be[ye+4])+(35468*be[ye+12]>>16))),Vs(H,X,1,0,Ee+Oe),Vs(H,X,2,0,Ee-Oe),Vs(H,X,3,0,we-ot),ye++,X+=32}function Yo(E,F,H,X){var ue=E[F+0]+4,ye=35468*E[F+4]>>16,be=Ni(E[F+4]),we=35468*E[F+1]>>16;uc(H,X,0,ue+be,E=Ni(E[F+1]),we),uc(H,X,1,ue+ye,E,we),uc(H,X,2,ue-ye,E,we),uc(H,X,3,ue-be,E,we)}function dn(E,F,H,X,ue){an(E,F,H,X),ue&&an(E,F+16,H,X+4)}function hu(E,F,H,X){os(E,F+0,H,X,1),os(E,F+32,H,X+128,1)}function nf(E,F,H,X){var ue;for(E=E[F+0]+4,ue=0;4>ue;++ue)for(F=0;4>F;++F)Vs(H,X,F,ue,E)}function hc(E,F,H,X){E[F+0]&&Ws(E,F+0,H,X),E[F+16]&&Ws(E,F+16,H,X+4),E[F+32]&&Ws(E,F+32,H,X+128),E[F+48]&&Ws(E,F+48,H,X+128+4)}function Ei(E,F,H,X){var ue,ye=s(16);for(ue=0;4>ue;++ue){var be=E[F+0+ue]+E[F+12+ue],we=E[F+4+ue]+E[F+8+ue],Ee=E[F+4+ue]-E[F+8+ue],Oe=E[F+0+ue]-E[F+12+ue];ye[0+ue]=be+we,ye[8+ue]=be-we,ye[4+ue]=Oe+Ee,ye[12+ue]=Oe-Ee}for(ue=0;4>ue;++ue)be=(E=ye[0+4*ue]+3)+ye[3+4*ue],we=ye[1+4*ue]+ye[2+4*ue],Ee=ye[1+4*ue]-ye[2+4*ue],Oe=E-ye[3+4*ue],H[X+0]=be+we>>3,H[X+16]=Oe+Ee>>3,H[X+32]=be-we>>3,H[X+48]=Oe-Ee>>3,X+=64}function ki(E,F,H){var X,ue=F-32,ye=zo,be=255-E[ue-1];for(X=0;X<H;++X){var we,Ee=ye,Oe=be+E[F-1];for(we=0;we<H;++we)E[F+we]=Ee[Oe+E[ue+we]];F+=32}}function pi(E,F){ki(E,F,4)}function Gh(E,F){ki(E,F,8)}function Bs(E,F){ki(E,F,16)}function Si(E,F){var H;for(H=0;16>H;++H)n(E,F+32*H,E,F-32,16)}function Wi(E,F){var H;for(H=16;0<H;--H)i(E,F,E[F-1],16),F+=32}function Ac(E,F,H){var X;for(X=0;16>X;++X)i(F,H+32*X,E,16)}function cl(E,F){var H,X=16;for(H=0;16>H;++H)X+=E[F-1+32*H]+E[F+H-32];Ac(X>>5,E,F)}function _n(E,F){var H,X=8;for(H=0;16>H;++H)X+=E[F-1+32*H];Ac(X>>4,E,F)}function Au(E,F){var H,X=8;for(H=0;16>H;++H)X+=E[F+H-32];Ac(X>>4,E,F)}function Zo(E,F){Ac(128,E,F)}function tn(E,F,H){return E+2*F+H+2>>2}function Do(E,F){var H,X=F-32;for(X=new Uint8Array([tn(E[X-1],E[X+0],E[X+1]),tn(E[X+0],E[X+1],E[X+2]),tn(E[X+1],E[X+2],E[X+3]),tn(E[X+2],E[X+3],E[X+4])]),H=0;4>H;++H)n(E,F+32*H,X,0,X.length)}function qh(E,F){var H=E[F-1],X=E[F-1+32],ue=E[F-1+64],ye=E[F-1+96];nr(E,F+0,16843009*tn(E[F-1-32],H,X)),nr(E,F+32,16843009*tn(H,X,ue)),nr(E,F+64,16843009*tn(X,ue,ye)),nr(E,F+96,16843009*tn(ue,ye,ye))}function Cs(E,F){var H,X=4;for(H=0;4>H;++H)X+=E[F+H-32]+E[F-1+32*H];for(X>>=3,H=0;4>H;++H)i(E,F+32*H,X,4)}function fu(E,F){var H=E[F-1+0],X=E[F-1+32],ue=E[F-1+64],ye=E[F-1-32],be=E[F+0-32],we=E[F+1-32],Ee=E[F+2-32],Oe=E[F+3-32];E[F+0+96]=tn(X,ue,E[F-1+96]),E[F+1+96]=E[F+0+64]=tn(H,X,ue),E[F+2+96]=E[F+1+64]=E[F+0+32]=tn(ye,H,X),E[F+3+96]=E[F+2+64]=E[F+1+32]=E[F+0+0]=tn(be,ye,H),E[F+3+64]=E[F+2+32]=E[F+1+0]=tn(we,be,ye),E[F+3+32]=E[F+2+0]=tn(Ee,we,be),E[F+3+0]=tn(Oe,Ee,we)}function Zn(E,F){var H=E[F+1-32],X=E[F+2-32],ue=E[F+3-32],ye=E[F+4-32],be=E[F+5-32],we=E[F+6-32],Ee=E[F+7-32];E[F+0+0]=tn(E[F+0-32],H,X),E[F+1+0]=E[F+0+32]=tn(H,X,ue),E[F+2+0]=E[F+1+32]=E[F+0+64]=tn(X,ue,ye),E[F+3+0]=E[F+2+32]=E[F+1+64]=E[F+0+96]=tn(ue,ye,be),E[F+3+32]=E[F+2+64]=E[F+1+96]=tn(ye,be,we),E[F+3+64]=E[F+2+96]=tn(be,we,Ee),E[F+3+96]=tn(we,Ee,Ee)}function Qa(E,F){var H=E[F-1+0],X=E[F-1+32],ue=E[F-1+64],ye=E[F-1-32],be=E[F+0-32],we=E[F+1-32],Ee=E[F+2-32],Oe=E[F+3-32];E[F+0+0]=E[F+1+64]=ye+be+1>>1,E[F+1+0]=E[F+2+64]=be+we+1>>1,E[F+2+0]=E[F+3+64]=we+Ee+1>>1,E[F+3+0]=Ee+Oe+1>>1,E[F+0+96]=tn(ue,X,H),E[F+0+64]=tn(X,H,ye),E[F+0+32]=E[F+1+96]=tn(H,ye,be),E[F+1+32]=E[F+2+96]=tn(ye,be,we),E[F+2+32]=E[F+3+96]=tn(be,we,Ee),E[F+3+32]=tn(we,Ee,Oe)}function yn(E,F){var H=E[F+0-32],X=E[F+1-32],ue=E[F+2-32],ye=E[F+3-32],be=E[F+4-32],we=E[F+5-32],Ee=E[F+6-32],Oe=E[F+7-32];E[F+0+0]=H+X+1>>1,E[F+1+0]=E[F+0+64]=X+ue+1>>1,E[F+2+0]=E[F+1+64]=ue+ye+1>>1,E[F+3+0]=E[F+2+64]=ye+be+1>>1,E[F+0+32]=tn(H,X,ue),E[F+1+32]=E[F+0+96]=tn(X,ue,ye),E[F+2+32]=E[F+1+96]=tn(ue,ye,be),E[F+3+32]=E[F+2+96]=tn(ye,be,we),E[F+3+64]=tn(be,we,Ee),E[F+3+96]=tn(we,Ee,Oe)}function on(E,F){var H=E[F-1+0],X=E[F-1+32],ue=E[F-1+64],ye=E[F-1+96];E[F+0+0]=H+X+1>>1,E[F+2+0]=E[F+0+32]=X+ue+1>>1,E[F+2+32]=E[F+0+64]=ue+ye+1>>1,E[F+1+0]=tn(H,X,ue),E[F+3+0]=E[F+1+32]=tn(X,ue,ye),E[F+3+32]=E[F+1+64]=tn(ue,ye,ye),E[F+3+64]=E[F+2+64]=E[F+0+96]=E[F+1+96]=E[F+2+96]=E[F+3+96]=ye}function du(E,F){var H=E[F-1+0],X=E[F-1+32],ue=E[F-1+64],ye=E[F-1+96],be=E[F-1-32],we=E[F+0-32],Ee=E[F+1-32],Oe=E[F+2-32];E[F+0+0]=E[F+2+32]=H+be+1>>1,E[F+0+32]=E[F+2+64]=X+H+1>>1,E[F+0+64]=E[F+2+96]=ue+X+1>>1,E[F+0+96]=ye+ue+1>>1,E[F+3+0]=tn(we,Ee,Oe),E[F+2+0]=tn(be,we,Ee),E[F+1+0]=E[F+3+32]=tn(H,be,we),E[F+1+32]=E[F+3+64]=tn(X,H,be),E[F+1+64]=E[F+3+96]=tn(ue,X,H),E[F+1+96]=tn(ye,ue,X)}function En(E,F){var H;for(H=0;8>H;++H)n(E,F+32*H,E,F-32,8)}function ul(E,F){var H;for(H=0;8>H;++H)i(E,F,E[F-1],8),F+=32}function js(E,F,H){var X;for(X=0;8>X;++X)i(F,H+32*X,E,8)}function va(E,F){var H,X=8;for(H=0;8>H;++H)X+=E[F+H-32]+E[F-1+32*H];js(X>>4,E,F)}function pu(E,F){var H,X=4;for(H=0;8>H;++H)X+=E[F+H-32];js(X>>3,E,F)}function za(E,F){var H,X=4;for(H=0;8>H;++H)X+=E[F-1+32*H];js(X>>3,E,F)}function Ha(E,F){js(128,E,F)}function gu(E,F,H){var X=E[F-H],ue=E[F+0],ye=3*(ue-X)+vc[1020+E[F-2*H]-E[F+H]],be=Pu[112+(ye+4>>3)];E[F-H]=zo[255+X+Pu[112+(ye+3>>3)]],E[F+0]=zo[255+ue-be]}function lh(E,F,H,X){var ue=E[F+0],ye=E[F+H];return Bo[255+E[F-2*H]-E[F-H]]>X||Bo[255+ye-ue]>X}function ch(E,F,H,X){return 4*Bo[255+E[F-H]-E[F+0]]+Bo[255+E[F-2*H]-E[F+H]]<=X}function Kh(E,F,H,X,ue){var ye=E[F-3*H],be=E[F-2*H],we=E[F-H],Ee=E[F+0],Oe=E[F+H],ot=E[F+2*H],_t=E[F+3*H];return 4*Bo[255+we-Ee]+Bo[255+be-Oe]>X?0:Bo[255+E[F-4*H]-ye]<=ue&&Bo[255+ye-be]<=ue&&Bo[255+be-we]<=ue&&Bo[255+_t-ot]<=ue&&Bo[255+ot-Oe]<=ue&&Bo[255+Oe-Ee]<=ue}function fc(E,F,H,X){var ue=2*X+1;for(X=0;16>X;++X)ch(E,F+X,H,ue)&&gu(E,F+X,H)}function In(E,F,H,X){var ue=2*X+1;for(X=0;16>X;++X)ch(E,F+X*H,1,ue)&&gu(E,F+X*H,1)}function No(E,F,H,X){var ue;for(ue=3;0<ue;--ue)fc(E,F+=4*H,H,X)}function Jo(E,F,H,X){var ue;for(ue=3;0<ue;--ue)In(E,F+=4,H,X)}function ko(E,F,H,X,ue,ye,be,we){for(ye=2*ye+1;0<ue--;){if(Kh(E,F,H,ye,be))if(lh(E,F,H,we))gu(E,F,H);else{var Ee=E,Oe=F,ot=H,_t=Ee[Oe-2*ot],St=Ee[Oe-ot],gt=Ee[Oe+0],Yt=Ee[Oe+ot],Qt=Ee[Oe+2*ot],ut=27*(Gt=vc[1020+3*(gt-St)+vc[1020+_t-Yt]])+63>>7,ft=18*Gt+63>>7,Gt=9*Gt+63>>7;Ee[Oe-3*ot]=zo[255+Ee[Oe-3*ot]+Gt],Ee[Oe-2*ot]=zo[255+_t+ft],Ee[Oe-ot]=zo[255+St+ut],Ee[Oe+0]=zo[255+gt-ut],Ee[Oe+ot]=zo[255+Yt-ft],Ee[Oe+2*ot]=zo[255+Qt-Gt]}F+=X}}function Jn(E,F,H,X,ue,ye,be,we){for(ye=2*ye+1;0<ue--;){if(Kh(E,F,H,ye,be))if(lh(E,F,H,we))gu(E,F,H);else{var Ee=E,Oe=F,ot=H,_t=Ee[Oe-ot],St=Ee[Oe+0],gt=Ee[Oe+ot],Yt=Pu[112+((Qt=3*(St-_t))+4>>3)],Qt=Pu[112+(Qt+3>>3)],ut=Yt+1>>1;Ee[Oe-2*ot]=zo[255+Ee[Oe-2*ot]+ut],Ee[Oe-ot]=zo[255+_t+Qt],Ee[Oe+0]=zo[255+St-Yt],Ee[Oe+ot]=zo[255+gt-ut]}F+=X}}function mu(E,F,H,X,ue,ye){ko(E,F,H,1,16,X,ue,ye)}function Qo(E,F,H,X,ue,ye){ko(E,F,1,H,16,X,ue,ye)}function sf(E,F,H,X,ue,ye){var be;for(be=3;0<be;--be)Jn(E,F+=4*H,H,1,16,X,ue,ye)}function uh(E,F,H,X,ue,ye){var be;for(be=3;0<be;--be)Jn(E,F+=4,1,H,16,X,ue,ye)}function hh(E,F,H,X,ue,ye,be,we){ko(E,F,ue,1,8,ye,be,we),ko(H,X,ue,1,8,ye,be,we)}function _u(E,F,H,X,ue,ye,be,we){ko(E,F,1,ue,8,ye,be,we),ko(H,X,1,ue,8,ye,be,we)}function Wh(E,F,H,X,ue,ye,be,we){Jn(E,F+4*ue,ue,1,8,ye,be,we),Jn(H,X+4*ue,ue,1,8,ye,be,we)}function yu(E,F,H,X,ue,ye,be,we){Jn(E,F+4,1,ue,8,ye,be,we),Jn(H,X+4,1,ue,8,ye,be,we)}function wa(){this.ba=new lt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ze,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function $s(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Pl(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Fl(){this.ua=0,this.Wa=new ze,this.vb=new ze,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new ge,this.yc=new oe}function Xh(){this.xb=this.a=0,this.l=new lc,this.ca=new lt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new ae,this.Pb=0,this.wd=new ae,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Fl,this.ab=0,this.gc=a(4,Pl),this.Oc=0}function Gs(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new lc,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function bu(E,F,H,X,ue,ye,be){for(E=E==null?0:E[F+0],F=0;F<be;++F)ue[ye+F]=E+H[X+F]&255,E=ue[ye+F]}function vu(E,F,H,X,ue,ye,be){var we;if(E==null)bu(null,null,H,X,ue,ye,be);else for(we=0;we<be;++we)ue[ye+we]=E[F+we]+H[X+we]&255}function xa(E,F,H,X,ue,ye,be){if(E==null)bu(null,null,H,X,ue,ye,be);else{var we,Ee=E[F+0],Oe=Ee,ot=Ee;for(we=0;we<be;++we)Oe=ot+(Ee=E[F+we])-Oe,ot=H[X+we]+(-256&Oe?0>Oe?0:255:Oe)&255,Oe=Ee,ue[ye+we]=ot}}function Rl(E,F,H,X){var ue=F.width,ye=F.o;if(e(E!=null&&F!=null),0>H||0>=X||H+X>ye)return null;if(!E.Cc){if(E.ga==null){var be;if(E.ga=new Gs,(be=E.ga==null)||(be=F.width*F.o,e(E.Gb.length==0),E.Gb=s(be),E.Uc=0,E.Gb==null?be=0:(E.mb=E.Gb,E.nb=E.Uc,E.rc=null,be=1),be=!be),!be){be=E.ga;var we=E.Fa,Ee=E.P,Oe=E.qc,ot=E.mb,_t=E.nb,St=Ee+1,gt=Oe-1,Yt=be.l;if(e(we!=null&&ot!=null&&F!=null),zl[0]=null,zl[1]=bu,zl[2]=vu,zl[3]=xa,be.ca=ot,be.tb=_t,be.c=F.width,be.i=F.height,e(0<be.c&&0<be.i),1>=Oe)F=0;else if(be.$a=we[Ee+0]>>0&3,be.Z=we[Ee+0]>>2&3,be.Lc=we[Ee+0]>>4&3,Ee=we[Ee+0]>>6&3,0>be.$a||1<be.$a||4<=be.Z||1<be.Lc||Ee)F=0;else if(Yt.put=hr,Yt.ac=We,Yt.bc=sr,Yt.ma=be,Yt.width=F.width,Yt.height=F.height,Yt.Da=F.Da,Yt.v=F.v,Yt.va=F.va,Yt.j=F.j,Yt.o=F.o,be.$a)e:{e(be.$a==1),F=Cn();t:for(;;){if(F==null){F=0;break e}if(e(be!=null),be.mc=F,F.c=be.c,F.i=be.i,F.l=be.l,F.l.ma=be,F.l.width=be.c,F.l.height=be.i,F.a=0,Ye(F.m,we,St,gt),!yi(be.c,be.i,1,F,null)||(F.ab==1&&F.gc[0].hc==3&&Br(F.s)?(be.ic=1,we=F.c*F.i,F.Ta=null,F.Ua=0,F.V=s(we),F.Ba=0,F.V==null?(F.a=1,F=0):F=1):(be.ic=0,F=Un(F,be.c)),!F))break t;F=1;break e}be.mc=null,F=0}else F=gt>=be.c*be.i;be=!F}if(be)return null;E.ga.Lc!=1?E.Ga=0:X=ye-H}e(E.ga!=null),e(H+X<=ye);e:{if(F=(we=E.ga).c,ye=we.l.o,we.$a==0){if(St=E.rc,gt=E.Vc,Yt=E.Fa,Ee=E.P+1+H*F,Oe=E.mb,ot=E.nb+H*F,e(Ee<=E.P+E.qc),we.Z!=0)for(e(zl[we.Z]!=null),be=0;be<X;++be)zl[we.Z](St,gt,Yt,Ee,Oe,ot,F),St=Oe,gt=ot,ot+=F,Ee+=F;else for(be=0;be<X;++be)n(Oe,ot,Yt,Ee,F),St=Oe,gt=ot,ot+=F,Ee+=F;E.rc=St,E.Vc=gt}else{if(e(we.mc!=null),F=H+X,e((be=we.mc)!=null),e(F<=be.i),be.C>=F)F=1;else if(we.ic||Bt(),we.ic){we=be.V,St=be.Ba,gt=be.c;var Qt=be.i,ut=(Yt=1,Ee=be.$/gt,Oe=be.$%gt,ot=be.m,_t=be.s,be.$),ft=gt*Qt,Gt=gt*F,er=_t.wc,wt=ut<Gt?kr(_t,Oe,Ee):null;e(ut<=ft),e(F<=Qt),e(Br(_t));t:for(;;){for(;!ot.h&&ut<Gt;){if(Oe&er||(wt=kr(_t,Oe,Ee)),e(wt!=null),at(ot),256>(Qt=ir(wt.G[0],wt.H[0],ot)))we[St+ut]=Qt,++ut,++Oe>=gt&&(Oe=0,++Ee<=F&&!(Ee%16)&&Ti(be,Ee));else{if(!(280>Qt)){Yt=0;break t}Qt=Nr(Qt-256,ot);var $t,Ir=ir(wt.G[4],wt.H[4],ot);if(at(ot),!(ut>=(Ir=Rt(gt,Ir=Nr(Ir,ot)))&&ft-ut>=Qt)){Yt=0;break t}for($t=0;$t<Qt;++$t)we[St+ut+$t]=we[St+ut+$t-Ir];for(ut+=Qt,Oe+=Qt;Oe>=gt;)Oe-=gt,++Ee<=F&&!(Ee%16)&&Ti(be,Ee);ut<Gt&&Oe&er&&(wt=kr(_t,Oe,Ee))}e(ot.h==Le(ot))}Ti(be,Ee>F?F:Ee);break t}!Yt||ot.h&&ut<ft?(Yt=0,be.a=ot.h?5:3):be.$=ut,F=Yt}else F=Bn(be,be.V,be.Ba,be.c,be.i,F,ba);if(!F){X=0;break e}}H+X>=ye&&(E.Cc=1),X=1}if(!X)return null;if(E.Cc&&((X=E.ga)!=null&&(X.mc=null),E.ga=null,0<E.Ga))return alert("todo:WebPDequantizeLevels"),null}return E.nb+H*ue}function U(E,F,H,X,ue,ye){for(;0<ue--;){var be,we=E,Ee=F+(H?1:0),Oe=E,ot=F+(H?0:3);for(be=0;be<X;++be){var _t=Oe[ot+4*be];_t!=255&&(_t*=32897,we[Ee+4*be+0]=we[Ee+4*be+0]*_t>>23,we[Ee+4*be+1]=we[Ee+4*be+1]*_t>>23,we[Ee+4*be+2]=we[Ee+4*be+2]*_t>>23)}F+=ye}}function he(E,F,H,X,ue){for(;0<X--;){var ye;for(ye=0;ye<H;++ye){var be=E[F+2*ye+0],we=15&(Oe=E[F+2*ye+1]),Ee=4369*we,Oe=(240&Oe|Oe>>4)*Ee>>16;E[F+2*ye+0]=(240&be|be>>4)*Ee>>16&240|(15&be|be<<4)*Ee>>16>>4&15,E[F+2*ye+1]=240&Oe|we}F+=ue}}function ke(E,F,H,X,ue,ye,be,we){var Ee,Oe,ot=255;for(Oe=0;Oe<ue;++Oe){for(Ee=0;Ee<X;++Ee){var _t=E[F+Ee];ye[be+4*Ee]=_t,ot&=_t}F+=H,be+=we}return ot!=255}function nt(E,F,H,X,ue){var ye;for(ye=0;ye<ue;++ye)H[X+ye]=E[F+ye]>>8}function Bt(){ra=U,$n=he,si=ke,Yi=nt}function Vt(E,F,H){J[E]=function(X,ue,ye,be,we,Ee,Oe,ot,_t,St,gt,Yt,Qt,ut,ft,Gt,er){var wt,$t=er-1>>1,Ir=we[Ee+0]|Oe[ot+0]<<16,Zr=_t[St+0]|gt[Yt+0]<<16;e(X!=null);var Fr=3*Ir+Zr+131074>>2;for(F(X[ue+0],255&Fr,Fr>>16,Qt,ut),ye!=null&&(Fr=3*Zr+Ir+131074>>2,F(ye[be+0],255&Fr,Fr>>16,ft,Gt)),wt=1;wt<=$t;++wt){var fn=we[Ee+wt]|Oe[ot+wt]<<16,Gn=_t[St+wt]|gt[Yt+wt]<<16,mn=Ir+fn+Zr+Gn+524296,Ln=mn+2*(fn+Zr)>>3;Fr=Ln+Ir>>1,Ir=(mn=mn+2*(Ir+Gn)>>3)+fn>>1,F(X[ue+2*wt-1],255&Fr,Fr>>16,Qt,ut+(2*wt-1)*H),F(X[ue+2*wt-0],255&Ir,Ir>>16,Qt,ut+(2*wt-0)*H),ye!=null&&(Fr=mn+Zr>>1,Ir=Ln+Gn>>1,F(ye[be+2*wt-1],255&Fr,Fr>>16,ft,Gt+(2*wt-1)*H),F(ye[be+2*wt+0],255&Ir,Ir>>16,ft,Gt+(2*wt+0)*H)),Ir=fn,Zr=Gn}1&er||(Fr=3*Ir+Zr+131074>>2,F(X[ue+er-1],255&Fr,Fr>>16,Qt,ut+(er-1)*H),ye!=null&&(Fr=3*Zr+Ir+131074>>2,F(ye[be+er-1],255&Fr,Fr>>16,ft,Gt+(er-1)*H)))}}function ur(){na[Fu]=hf,na[ph]=co,na[Wp]=_h,na[Ru]=Qi,na[Zh]=Uu,na[lf]=Sa,na[Jh]=yh,na[gh]=co,na[eA]=Qi,na[mh]=Uu,na[Lu]=Sa}function Or(E){return E&-16384?0>E?0:255:E>>Zp}function Xr(E,F){return Or((19077*E>>8)+(26149*F>>8)-14234)}function An(E,F,H){return Or((19077*E>>8)-(6419*F>>8)-(13320*H>>8)+8708)}function hn(E,F){return Or((19077*E>>8)+(33050*F>>8)-17685)}function Rn(E,F,H,X,ue){X[ue+0]=Xr(E,H),X[ue+1]=An(E,F,H),X[ue+2]=hn(E,F)}function bi(E,F,H,X,ue){X[ue+0]=hn(E,F),X[ue+1]=An(E,F,H),X[ue+2]=Xr(E,H)}function ii(E,F,H,X,ue){var ye=An(E,F,H);F=ye<<3&224|hn(E,F)>>3,X[ue+0]=248&Xr(E,H)|ye>>5,X[ue+1]=F}function Xi(E,F,H,X,ue){var ye=240&hn(E,F)|15;X[ue+0]=240&Xr(E,H)|An(E,F,H)>>4,X[ue+1]=ye}function qs(E,F,H,X,ue){X[ue+0]=255,Rn(E,F,H,X,ue+1)}function ji(E,F,H,X,ue){bi(E,F,H,X,ue),X[ue+3]=255}function ea(E,F,H,X,ue){Rn(E,F,H,X,ue),X[ue+3]=255}function wo(E,F){return 0>E?0:E>F?F:E}function hl(E,F,H){J[E]=function(X,ue,ye,be,we,Ee,Oe,ot,_t){for(var St=ot+(-2&_t)*H;ot!=St;)F(X[ue+0],ye[be+0],we[Ee+0],Oe,ot),F(X[ue+1],ye[be+0],we[Ee+0],Oe,ot+H),ue+=2,++be,++Ee,ot+=2*H;1&_t&&F(X[ue+0],ye[be+0],we[Ee+0],Oe,ot)}}function of(E,F,H){return H==0?E==0?F==0?6:5:F==0?4:0:H}function wu(E,F,H,X,ue){switch(E>>>30){case 3:os(F,H,X,ue,0);break;case 2:$i(F,H,X,ue);break;case 1:Ws(F,H,X,ue)}}function xu(E,F){var H,X,ue=F.M,ye=F.Nb,be=E.oc,we=E.pc+40,Ee=E.oc,Oe=E.pc+584,ot=E.oc,_t=E.pc+600;for(H=0;16>H;++H)be[we+32*H-1]=129;for(H=0;8>H;++H)Ee[Oe+32*H-1]=129,ot[_t+32*H-1]=129;for(0<ue?be[we-1-32]=Ee[Oe-1-32]=ot[_t-1-32]=129:(i(be,we-32-1,127,21),i(Ee,Oe-32-1,127,9),i(ot,_t-32-1,127,9)),X=0;X<E.za;++X){var St=F.ya[F.aa+X];if(0<X){for(H=-1;16>H;++H)n(be,we+32*H-4,be,we+32*H+12,4);for(H=-1;8>H;++H)n(Ee,Oe+32*H-4,Ee,Oe+32*H+4,4),n(ot,_t+32*H-4,ot,_t+32*H+4,4)}var gt=E.Gd,Yt=E.Hd+X,Qt=St.ad,ut=St.Hc;if(0<ue&&(n(be,we-32,gt[Yt].y,0,16),n(Ee,Oe-32,gt[Yt].f,0,8),n(ot,_t-32,gt[Yt].ea,0,8)),St.Za){var ft=be,Gt=we-32+16;for(0<ue&&(X>=E.za-1?i(ft,Gt,gt[Yt].y[15],4):n(ft,Gt,gt[Yt+1].y,0,4)),H=0;4>H;H++)ft[Gt+128+H]=ft[Gt+256+H]=ft[Gt+384+H]=ft[Gt+0+H];for(H=0;16>H;++H,ut<<=2)ft=be,Gt=we+Vl[H],lo[St.Ob[H]](ft,Gt),wu(ut,Qt,16*+H,ft,Gt)}else if(ft=of(X,ue,St.Ob[0]),pl[ft](be,we),ut!=0)for(H=0;16>H;++H,ut<<=2)wu(ut,Qt,16*+H,be,we+Vl[H]);for(H=St.Gc,ft=of(X,ue,St.Dd),gl[ft](Ee,Oe),gl[ft](ot,_t),ut=Qt,ft=Ee,Gt=Oe,255&(St=H>>0)&&(170&St?dh(ut,256,ft,Gt):Es(ut,256,ft,Gt)),St=ot,ut=_t,255&(H>>=8)&&(170&H?dh(Qt,320,St,ut):Es(Qt,320,St,ut)),ue<E.Ub-1&&(n(gt[Yt].y,0,be,we+480,16),n(gt[Yt].f,0,Ee,Oe+224,8),n(gt[Yt].ea,0,ot,_t+224,8)),H=8*ye*E.B,gt=E.sa,Yt=E.ta+16*X+16*ye*E.R,Qt=E.qa,St=E.ra+8*X+H,ut=E.Ha,ft=E.Ia+8*X+H,H=0;16>H;++H)n(gt,Yt+H*E.R,be,we+32*H,16);for(H=0;8>H;++H)n(Qt,St+H*E.B,Ee,Oe+32*H,8),n(ut,ft+H*E.B,ot,_t+32*H,8)}}function Bu(E,F,H,X,ue,ye,be,we,Ee){var Oe=[0],ot=[0],_t=0,St=Ee!=null?Ee.kd:0,gt=Ee??new $s;if(E==null||12>H)return 7;gt.data=E,gt.w=F,gt.ha=H,F=[F],H=[H],gt.gb=[gt.gb];e:{var Yt=F,Qt=H,ut=gt.gb;if(e(E!=null),e(Qt!=null),e(ut!=null),ut[0]=0,12<=Qt[0]&&!t(E,Yt[0],"RIFF")){if(t(E,Yt[0]+8,"WEBP")){ut=3;break e}var ft=gr(E,Yt[0]+4);if(12>ft||4294967286<ft){ut=3;break e}if(St&&ft>Qt[0]-8){ut=7;break e}ut[0]=ft,Yt[0]+=12,Qt[0]-=12}ut=0}if(ut!=0)return ut;for(ft=0<gt.gb[0],H=H[0];;){e:{var Gt=E;Qt=F,ut=H;var er=Oe,wt=ot,$t=Yt=[0];if((Fr=_t=[_t])[0]=0,8>ut[0])ut=7;else{if(!t(Gt,Qt[0],"VP8X")){if(gr(Gt,Qt[0]+4)!=10){ut=3;break e}if(18>ut[0]){ut=7;break e}var Ir=gr(Gt,Qt[0]+8),Zr=1+or(Gt,Qt[0]+12);if(2147483648<=Zr*(Gt=1+or(Gt,Qt[0]+15))){ut=3;break e}$t!=null&&($t[0]=Ir),er!=null&&(er[0]=Zr),wt!=null&&(wt[0]=Gt),Qt[0]+=18,ut[0]-=18,Fr[0]=1}ut=0}}if(_t=_t[0],Yt=Yt[0],ut!=0)return ut;if(Qt=!!(2&Yt),!ft&&_t)return 3;if(ye!=null&&(ye[0]=!!(16&Yt)),be!=null&&(be[0]=Qt),we!=null&&(we[0]=0),be=Oe[0],Yt=ot[0],_t&&Qt&&Ee==null){ut=0;break}if(4>H){ut=7;break}if(ft&&_t||!ft&&!_t&&!t(E,F[0],"ALPH")){H=[H],gt.na=[gt.na],gt.P=[gt.P],gt.Sa=[gt.Sa];e:{Ir=E,ut=F,ft=H;var Fr=gt.gb;er=gt.na,wt=gt.P,$t=gt.Sa,Zr=22,e(Ir!=null),e(ft!=null),Gt=ut[0];var fn=ft[0];for(e(er!=null),e($t!=null),er[0]=null,wt[0]=null,$t[0]=0;;){if(ut[0]=Gt,ft[0]=fn,8>fn){ut=7;break e}var Gn=gr(Ir,Gt+4);if(4294967286<Gn){ut=3;break e}var mn=8+Gn+1&-2;if(Zr+=mn,0<Fr&&Zr>Fr){ut=3;break e}if(!t(Ir,Gt,"VP8 ")||!t(Ir,Gt,"VP8L")){ut=0;break e}if(fn[0]<mn){ut=7;break e}t(Ir,Gt,"ALPH")||(er[0]=Ir,wt[0]=Gt+8,$t[0]=Gn),Gt+=mn,fn-=mn}}if(H=H[0],gt.na=gt.na[0],gt.P=gt.P[0],gt.Sa=gt.Sa[0],ut!=0)break}H=[H],gt.Ja=[gt.Ja],gt.xa=[gt.xa];e:if(Fr=E,ut=F,ft=H,er=gt.gb[0],wt=gt.Ja,$t=gt.xa,Ir=ut[0],Gt=!t(Fr,Ir,"VP8 "),Zr=!t(Fr,Ir,"VP8L"),e(Fr!=null),e(ft!=null),e(wt!=null),e($t!=null),8>ft[0])ut=7;else{if(Gt||Zr){if(Fr=gr(Fr,Ir+4),12<=er&&Fr>er-12){ut=3;break e}if(St&&Fr>ft[0]-8){ut=7;break e}wt[0]=Fr,ut[0]+=8,ft[0]-=8,$t[0]=Zr}else $t[0]=5<=ft[0]&&Fr[Ir+0]==47&&!(Fr[Ir+4]>>5),wt[0]=ft[0];ut=0}if(H=H[0],gt.Ja=gt.Ja[0],gt.xa=gt.xa[0],F=F[0],ut!=0)break;if(4294967286<gt.Ja)return 3;if(we==null||Qt||(we[0]=gt.xa?2:1),be=[be],Yt=[Yt],gt.xa){if(5>H){ut=7;break}we=be,St=Yt,Qt=ye,E==null||5>H?E=0:5<=H&&E[F+0]==47&&!(E[F+4]>>5)?(ft=[0],Fr=[0],er=[0],Ye(wt=new ae,E,F,H),rr(wt,ft,Fr,er)?(we!=null&&(we[0]=ft[0]),St!=null&&(St[0]=Fr[0]),Qt!=null&&(Qt[0]=er[0]),E=1):E=0):E=0}else{if(10>H){ut=7;break}we=Yt,E==null||10>H||!$h(E,F+3,H-3)?E=0:(St=E[F+0]|E[F+1]<<8|E[F+2]<<16,Qt=16383&(E[F+7]<<8|E[F+6]),E=16383&(E[F+9]<<8|E[F+8]),1&St||3<(St>>1&7)||!(St>>4&1)||St>>5>=gt.Ja||!Qt||!E?E=0:(be&&(be[0]=Qt),we&&(we[0]=E),E=1))}if(!E||(be=be[0],Yt=Yt[0],_t&&(Oe[0]!=be||ot[0]!=Yt)))return 3;Ee!=null&&(Ee[0]=gt,Ee.offset=F-Ee.w,e(4294967286>F-Ee.w),e(Ee.offset==Ee.ha-H));break}return ut==0||ut==7&&_t&&Ee==null?(ye!=null&&(ye[0]|=gt.na!=null&&0<gt.na.length),X!=null&&(X[0]=be),ue!=null&&(ue[0]=Yt),0):ut}function Cu(E,F,H){var X=F.width,ue=F.height,ye=0,be=0,we=X,Ee=ue;if(F.Da=E!=null&&0<E.Da,F.Da&&(we=E.cd,Ee=E.bd,ye=E.v,be=E.j,11>H||(ye&=-2,be&=-2),0>ye||0>be||0>=we||0>=Ee||ye+we>X||be+Ee>ue))return 0;if(F.v=ye,F.j=be,F.va=ye+we,F.o=be+Ee,F.U=we,F.T=Ee,F.da=E!=null&&0<E.da,F.da){if(!$r(we,Ee,H=[E.ib],ye=[E.hb]))return 0;F.ib=H[0],F.hb=ye[0]}return F.ob=E!=null&&E.ob,F.Kb=E==null||!E.Sd,F.da&&(F.ob=F.ib<3*X/4&&F.hb<3*ue/4,F.Kb=0),1}function Tu(E){if(E==null)return 2;if(11>E.S){var F=E.f.RGBA;F.fb+=(E.height-1)*F.A,F.A=-F.A}else F=E.f.kb,E=E.height,F.O+=(E-1)*F.fa,F.fa=-F.fa,F.N+=(E-1>>1)*F.Ab,F.Ab=-F.Ab,F.W+=(E-1>>1)*F.Db,F.Db=-F.Db,F.F!=null&&(F.J+=(E-1)*F.lb,F.lb=-F.lb);return 0}function Al(E,F,H,X){if(X==null||0>=E||0>=F)return 2;if(H!=null){if(H.Da){var ue=H.cd,ye=H.bd,be=-2&H.v,we=-2&H.j;if(0>be||0>we||0>=ue||0>=ye||be+ue>E||we+ye>F)return 2;E=ue,F=ye}if(H.da){if(!$r(E,F,ue=[H.ib],ye=[H.hb]))return 2;E=ue[0],F=ye[0]}}X.width=E,X.height=F;e:{var Ee=X.width,Oe=X.height;if(E=X.S,0>=Ee||0>=Oe||!(E>=Fu&&13>E))E=2;else{if(0>=X.Rd&&X.sd==null){be=ye=ue=F=0;var ot=(we=Ee*Bd[E])*Oe;if(11>E||(ye=(Oe+1)/2*(F=(Ee+1)/2),E==12&&(be=(ue=Ee)*Oe)),(Oe=s(ot+2*ye+be))==null){E=1;break e}X.sd=Oe,11>E?((Ee=X.f.RGBA).eb=Oe,Ee.fb=0,Ee.A=we,Ee.size=ot):((Ee=X.f.kb).y=Oe,Ee.O=0,Ee.fa=we,Ee.Fd=ot,Ee.f=Oe,Ee.N=0+ot,Ee.Ab=F,Ee.Cd=ye,Ee.ea=Oe,Ee.W=0+ot+ye,Ee.Db=F,Ee.Ed=ye,E==12&&(Ee.F=Oe,Ee.J=0+ot+2*ye),Ee.Tc=be,Ee.lb=ue)}if(F=1,ue=X.S,ye=X.width,be=X.height,ue>=Fu&&13>ue)if(11>ue)E=X.f.RGBA,F&=(we=Math.abs(E.A))*(be-1)+ye<=E.size,F&=we>=ye*Bd[ue],F&=E.eb!=null;else{E=X.f.kb,we=(ye+1)/2,ot=(be+1)/2,Ee=Math.abs(E.fa),Oe=Math.abs(E.Ab);var _t=Math.abs(E.Db),St=Math.abs(E.lb),gt=St*(be-1)+ye;F&=Ee*(be-1)+ye<=E.Fd,F&=Oe*(ot-1)+we<=E.Cd,F=(F&=_t*(ot-1)+we<=E.Ed)&Ee>=ye&Oe>=we&_t>=we,F&=E.y!=null,F&=E.f!=null,F&=E.ea!=null,ue==12&&(F&=St>=ye,F&=gt<=E.Tc,F&=E.F!=null)}else F=0;E=F?0:2}}return E!=0||H!=null&&H.fd&&(E=Tu(X)),E}var vi=64,dc=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],pc=24,Ll=32,Ah=8,ao=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];tr("Predictor0","PredictorAdd0"),J.Predictor0=function(){return 4278190080},J.Predictor1=function(E){return E},J.Predictor2=function(E,F,H){return F[H+0]},J.Predictor3=function(E,F,H){return F[H+1]},J.Predictor4=function(E,F,H){return F[H-1]},J.Predictor5=function(E,F,H){return _r(_r(E,F[H+1]),F[H+0])},J.Predictor6=function(E,F,H){return _r(E,F[H-1])},J.Predictor7=function(E,F,H){return _r(E,F[H+0])},J.Predictor8=function(E,F,H){return _r(F[H-1],F[H+0])},J.Predictor9=function(E,F,H){return _r(F[H+0],F[H+1])},J.Predictor10=function(E,F,H){return _r(_r(E,F[H-1]),_r(F[H+0],F[H+1]))},J.Predictor11=function(E,F,H){var X=F[H+0];return 0>=Sr(X>>24&255,E>>24&255,(F=F[H-1])>>24&255)+Sr(X>>16&255,E>>16&255,F>>16&255)+Sr(X>>8&255,E>>8&255,F>>8&255)+Sr(255&X,255&E,255&F)?X:E},J.Predictor12=function(E,F,H){var X=F[H+0];return(Ut((E>>24&255)+(X>>24&255)-((F=F[H-1])>>24&255))<<24|Ut((E>>16&255)+(X>>16&255)-(F>>16&255))<<16|Ut((E>>8&255)+(X>>8&255)-(F>>8&255))<<8|Ut((255&E)+(255&X)-(255&F)))>>>0},J.Predictor13=function(E,F,H){var X=F[H-1];return(ar((E=_r(E,F[H+0]))>>24&255,X>>24&255)<<24|ar(E>>16&255,X>>16&255)<<16|ar(E>>8&255,X>>8&255)<<8|ar(E>>0&255,X>>0&255))>>>0};var Ol=J.PredictorAdd0;J.PredictorAdd1=Er,tr("Predictor2","PredictorAdd2"),tr("Predictor3","PredictorAdd3"),tr("Predictor4","PredictorAdd4"),tr("Predictor5","PredictorAdd5"),tr("Predictor6","PredictorAdd6"),tr("Predictor7","PredictorAdd7"),tr("Predictor8","PredictorAdd8"),tr("Predictor9","PredictorAdd9"),tr("Predictor10","PredictorAdd10"),tr("Predictor11","PredictorAdd11"),tr("Predictor12","PredictorAdd12"),tr("Predictor13","PredictorAdd13");var Eu=J.PredictorAdd2;Wr("ColorIndexInverseTransform","MapARGB","32b",function(E){return E>>8&255},function(E){return E}),Wr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(E){return E},function(E){return E>>8&255});var On,Ba=J.ColorIndexInverseTransform,fh=J.MapARGB,af=J.VP8LColorIndexInverseTransformAlpha,Yh=J.MapAlpha,gc=J.VP8LPredictorsAdd=[];gc.length=16,(J.VP8LPredictors=[]).length=16,(J.VP8LPredictorsAdd_C=[]).length=16,(J.VP8LPredictors_C=[]).length=16;var mc,Ks,Ts,Va,ja,xo,$a,os,$i,dh,Ws,Es,Ul,Su,Dl,fl,_c,ta,Ca,Iu,Nl,gn,yc,Ta,ra,$n,si,Yi,as=s(511),kl=s(2041),bc=s(225),Ql=s(767),Mu=0,vc=kl,Pu=bc,zo=Ql,Bo=as,Fu=0,ph=1,Wp=2,Ru=3,Zh=4,lf=5,Jh=6,gh=7,eA=8,mh=9,Lu=10,tA=[2,3,7],md=[3,3,11],rA=[280,256,256,256,40],wi=[0,1,1,1,0],Ou=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Ea=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],_d=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],yd=8,cf=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],wc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],dl=null,uf=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],nA=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],bd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],vd=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],wd=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Xp=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],xc=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],pl=[],lo=[],gl=[],Yp=1,xd=2,zl=[],na=[];Vt("UpsampleRgbLinePair",Rn,3),Vt("UpsampleBgrLinePair",bi,3),Vt("UpsampleRgbaLinePair",ea,4),Vt("UpsampleBgraLinePair",ji,4),Vt("UpsampleArgbLinePair",qs,4),Vt("UpsampleRgba4444LinePair",Xi,2),Vt("UpsampleRgb565LinePair",ii,2);var hf=J.UpsampleRgbLinePair,_h=J.UpsampleBgrLinePair,co=J.UpsampleRgbaLinePair,Qi=J.UpsampleBgraLinePair,Uu=J.UpsampleArgbLinePair,Sa=J.UpsampleRgba4444LinePair,yh=J.UpsampleRgb565LinePair,Af=16,Bc=1<<Af-1,bh=-227,iA=482,Zp=6,Cc=0,Hl=s(256),Mr=s(256),Jp=s(256),Du=s(256),eg=s(iA-bh),sA=s(iA-bh);hl("YuvToRgbRow",Rn,3),hl("YuvToBgrRow",bi,3),hl("YuvToRgbaRow",ea,4),hl("YuvToBgraRow",ji,4),hl("YuvToArgbRow",qs,4),hl("YuvToRgba4444Row",Xi,2),hl("YuvToRgb565Row",ii,2);var Vl=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],oA=[0,2,8],bn=[8,7,6,4,4,2,2,2,1,1,1,1],vh=1;this.WebPDecodeRGBA=function(E,F,H,X,ue){var ye=ph,be=new wa,we=new lt;be.ba=we,we.S=ye,we.width=[we.width],we.height=[we.height];var Ee=we.width,Oe=we.height,ot=new dt;if(ot==null||E==null)var _t=2;else e(ot!=null),_t=Bu(E,F,H,ot.width,ot.height,ot.Pd,ot.Qd,ot.format,null);if(_t!=0?Ee=0:(Ee!=null&&(Ee[0]=ot.width[0]),Oe!=null&&(Oe[0]=ot.height[0]),Ee=1),Ee){we.width=we.width[0],we.height=we.height[0],X!=null&&(X[0]=we.width),ue!=null&&(ue[0]=we.height);e:{if(X=new lc,(ue=new $s).data=E,ue.w=F,ue.ha=H,ue.kd=1,F=[0],e(ue!=null),((E=Bu(ue.data,ue.w,ue.ha,null,null,null,F,null,ue))==0||E==7)&&F[0]&&(E=4),(F=E)==0){if(e(be!=null),X.data=ue.data,X.w=ue.w+ue.offset,X.ha=ue.ha-ue.offset,X.put=hr,X.ac=We,X.bc=sr,X.ma=be,ue.xa){if((E=Cn())==null){be=1;break e}if(function(St,gt){var Yt=[0],Qt=[0],ut=[0];t:for(;;){if(St==null)return 0;if(gt==null)return St.a=2,0;if(St.l=gt,St.a=0,Ye(St.m,gt.data,gt.w,gt.ha),!rr(St.m,Yt,Qt,ut)){St.a=3;break t}if(St.xb=xd,gt.width=Yt[0],gt.height=Qt[0],!yi(Yt[0],Qt[0],1,St,null))break t;return 1}return e(St.a!=0),0}(E,X)){if(X=(F=Al(X.width,X.height,be.Oa,be.ba))==0){t:{X=E;r:for(;;){if(X==null){X=0;break t}if(e(X.s.yc!=null),e(X.s.Ya!=null),e(0<X.s.Wb),e((H=X.l)!=null),e((ue=H.ma)!=null),X.xb!=0){if(X.ca=ue.ba,X.tb=ue.tb,e(X.ca!=null),!Cu(ue.Oa,H,Ru)){X.a=2;break r}if(!Un(X,H.width)||H.da)break r;if((H.da||_e(X.ca.S))&&Bt(),11>X.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),X.ca.f.kb.F!=null&&Bt()),X.Pb&&0<X.s.ua&&X.s.vb.X==null&&!wr(X.s.vb,X.s.Wa.Xa)){X.a=1;break r}X.xb=0}if(!Bn(X,X.V,X.Ba,X.c,X.i,H.o,jr))break r;ue.Dc=X.Ma,X=1;break t}e(X.a!=0),X=0}X=!X}X&&(F=E.a)}else F=E.a}else{if((E=new Ml)==null){be=1;break e}if(E.Fa=ue.na,E.P=ue.P,E.qc=ue.Sa,ll(E,X)){if((F=Al(X.width,X.height,be.Oa,be.ba))==0){if(E.Aa=0,H=be.Oa,e((ue=E)!=null),H!=null){if(0<(Ee=0>(Ee=H.Md)?0:100<Ee?255:255*Ee/100)){for(Oe=ot=0;4>Oe;++Oe)12>(_t=ue.pb[Oe]).lc&&(_t.ia=Ee*bn[0>_t.lc?0:_t.lc]>>3),ot|=_t.ia;ot&&(alert("todo:VP8InitRandom"),ue.ia=1)}ue.Ga=H.Id,100<ue.Ga?ue.Ga=100:0>ue.Ga&&(ue.Ga=0)}rf(E,X)||(F=E.a)}}else F=E.a}F==0&&be.Oa!=null&&be.Oa.fd&&(F=Tu(be.ba))}be=F}ye=be!=0?null:11>ye?we.f.RGBA.eb:we.f.kb.y}else ye=null;return ye};var Bd=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function d(J,me){for(var xe="",se=0;se<4;se++)xe+=String.fromCharCode(J[me++]);return xe}function p(J,me){return(J[me+0]<<0|J[me+1]<<8|J[me+2]<<16)>>>0}function _(J,me){return(J[me+0]<<0|J[me+1]<<8|J[me+2]<<16|J[me+3]<<24)>>>0}new u;var w=[0],v=[0],M=[],P=new u,D=r,N=function(J,me){var xe={},se=0,oe=!1,ve=0,ge=0;if(xe.frames=[],!function(Te,Le,De,at){for(var rt=0;rt<at;rt++)if(Te[Le+rt]!=De.charCodeAt(rt))return!0;return!1}(J,me,"RIFF",4)){var Je,Ge;for(_(J,me+=4),me+=8;me<J.length;){var et=d(J,me),Ye=_(J,me+=4);me+=4;var ct=Ye+(1&Ye);switch(et){case"VP8 ":case"VP8L":xe.frames[se]===void 0&&(xe.frames[se]={}),(ae=xe.frames[se]).src_off=oe?ge:me-8,ae.src_size=ve+Ye+8,se++,oe&&(oe=!1,ve=0,ge=0);break;case"VP8X":(ae=xe.header={}).feature_flags=J[me];var At=me+4;ae.canvas_width=1+p(J,At),At+=3,ae.canvas_height=1+p(J,At),At+=3;break;case"ALPH":oe=!0,ve=ct+8,ge=me-8;break;case"ANIM":(ae=xe.header).bgcolor=_(J,me),At=me+4,ae.loop_count=(Je=J)[(Ge=At)+0]<<0|Je[Ge+1]<<8,At+=2;break;case"ANMF":var kt,ae;(ae=xe.frames[se]={}).offset_x=2*p(J,me),me+=3,ae.offset_y=2*p(J,me),me+=3,ae.width=1+p(J,me),me+=3,ae.height=1+p(J,me),me+=3,ae.duration=p(J,me),me+=3,kt=J[me++],ae.dispose=1&kt,ae.blend=kt>>1&1}et!="ANMF"&&(me+=ct)}return xe}}(D,0);N.response=D,N.rgbaoutput=!0,N.dataurl=!1;var z=N.header?N.header:null,W=N.frames?N.frames:null;if(z){z.loop_counter=z.loop_count,w=[z.canvas_height],v=[z.canvas_width];for(var V=0;V<W.length&&W[V].blend!=0;V++);}var $=W[0],q=P.WebPDecodeRGBA(D,$.src_off,$.src_size,v,w);$.rgba=q,$.imgwidth=v[0],$.imgheight=w[0];for(var te=0;te<v[0]*w[0]*4;te++)M[te]=q[te];return this.width=v,this.height=w,this.data=M,this}(function(r){var e=function(){return typeof Vx=="function"},t=function(w,v,M,P){var D=4,N=a;switch(P){case r.image_compression.FAST:D=1,N=s;break;case r.image_compression.MEDIUM:D=6,N=o;break;case r.image_compression.SLOW:D=9,N=u}w=n(w,v,M,N);var z=Vx(w,{level:D});return r.__addimage__.arrayBufferToBinaryString(z)},n=function(w,v,M,P){for(var D,N,z,W=w.length/v,V=new Uint8Array(w.length+W),$=p(),q=0;q<W;q+=1){if(z=q*v,D=w.subarray(z,z+v),P)V.set(P(D,M,N),z+q);else{for(var te,J=$.length,me=[];te<J;te+=1)me[te]=$[te](D,M,N);var xe=_(me.concat());V.set(me[xe],z+q)}N=D}return V},i=function(w){var v=Array.apply([],w);return v.unshift(0),v},s=function(w,v){var M,P=[],D=w.length;P[0]=1;for(var N=0;N<D;N+=1)M=w[N-v]||0,P[N+1]=w[N]-M+256&255;return P},a=function(w,v,M){var P,D=[],N=w.length;D[0]=2;for(var z=0;z<N;z+=1)P=M&&M[z]||0,D[z+1]=w[z]-P+256&255;return D},o=function(w,v,M){var P,D,N=[],z=w.length;N[0]=3;for(var W=0;W<z;W+=1)P=w[W-v]||0,D=M&&M[W]||0,N[W+1]=w[W]+256-(P+D>>>1)&255;return N},u=function(w,v,M){var P,D,N,z,W=[],V=w.length;W[0]=4;for(var $=0;$<V;$+=1)P=w[$-v]||0,D=M&&M[$]||0,N=M&&M[$-v]||0,z=d(P,D,N),W[$+1]=w[$]-z+256&255;return W},d=function(w,v,M){if(w===v&&v===M)return w;var P=Math.abs(v-M),D=Math.abs(w-M),N=Math.abs(w+v-M-M);return P<=D&&P<=N?w:D<=N?v:M},p=function(){return[i,s,a,o,u]},_=function(w){var v=w.map(function(M){return M.reduce(function(P,D){return P+Math.abs(D)},0)});return v.indexOf(Math.min.apply(null,v))};r.processPNG=function(w,v,M,P){var D,N,z,W,V,$,q,te,J,me,xe,se,oe,ve,ge,Je=this.decode.FLATE_DECODE,Ge="";if(this.__addimage__.isArrayBuffer(w)&&(w=new Uint8Array(w)),this.__addimage__.isArrayBufferView(w)){if(w=(z=new Fle(w)).imgData,N=z.bits,D=z.colorSpace,V=z.colors,[4,6].indexOf(z.colorType)!==-1){if(z.bits===8){J=(te=z.pixelBitlength==32?new Uint32Array(z.decodePixels().buffer):z.pixelBitlength==16?new Uint16Array(z.decodePixels().buffer):new Uint8Array(z.decodePixels().buffer)).length,xe=new Uint8Array(J*z.colors),me=new Uint8Array(J);var et,Ye=z.pixelBitlength-z.bits;for(ve=0,ge=0;ve<J;ve++){for(oe=te[ve],et=0;et<Ye;)xe[ge++]=oe>>>et&255,et+=z.bits;me[ve]=oe>>>et&255}}if(z.bits===16){J=(te=new Uint32Array(z.decodePixels().buffer)).length,xe=new Uint8Array(J*(32/z.pixelBitlength)*z.colors),me=new Uint8Array(J*(32/z.pixelBitlength)),se=z.colors>1,ve=0,ge=0;for(var ct=0;ve<J;)oe=te[ve++],xe[ge++]=oe>>>0&255,se&&(xe[ge++]=oe>>>16&255,oe=te[ve++],xe[ge++]=oe>>>0&255),me[ct++]=oe>>>16&255;N=8}P!==r.image_compression.NONE&&e()?(w=t(xe,z.width*z.colors,z.colors,P),q=t(me,z.width,1,P)):(w=xe,q=me,Je=void 0)}if(z.colorType===3&&(D=this.color_spaces.INDEXED,$=z.palette,z.transparency.indexed)){var At=z.transparency.indexed,kt=0;for(ve=0,J=At.length;ve<J;++ve)kt+=At[ve];if((kt/=255)===J-1&&At.indexOf(0)!==-1)W=[At.indexOf(0)];else if(kt!==J){for(te=z.decodePixels(),me=new Uint8Array(te.length),ve=0,J=te.length;ve<J;ve++)me[ve]=At[te[ve]];q=t(me,z.width,1)}}var ae=function(Te){var Le;switch(Te){case r.image_compression.FAST:Le=11;break;case r.image_compression.MEDIUM:Le=13;break;case r.image_compression.SLOW:Le=14;break;default:Le=12}return Le}(P);return Je===this.decode.FLATE_DECODE&&(Ge="/Predictor "+ae+" "),Ge+="/Colors "+V+" /BitsPerComponent "+N+" /Columns "+z.width,(this.__addimage__.isArrayBuffer(w)||this.__addimage__.isArrayBufferView(w))&&(w=this.__addimage__.arrayBufferToBinaryString(w)),(q&&this.__addimage__.isArrayBuffer(q)||this.__addimage__.isArrayBufferView(q))&&(q=this.__addimage__.arrayBufferToBinaryString(q)),{alias:M,data:w,index:v,filter:Je,decodeParameters:Ge,transparency:W,palette:$,sMask:q,predictor:ae,width:z.width,height:z.height,bitsPerComponent:N,colorSpace:D}}}})(cn.API),function(r){r.processGIF89A=function(e,t,n,i){var s=new Rle(e),a=s.width,o=s.height,u=[];s.decodeAndBlitFrameRGBA(0,u);var d={data:u,width:a,height:o},p=new tB(100).encode(d,100);return r.processJPEG.call(this,p,t,n,i)},r.processGIF87A=r.processGIF89A}(cn.API),Xc.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var e=0;e<r;e++){var t=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:i,green:n,blue:t,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Xc.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[r]()}catch(t){Ui.log("bit decode error:"+t)}},Xc.prototype.bit1=function(){var r,e=Math.ceil(this.width/8),t=e%4;for(r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<e;i++)for(var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var u=this.palette[s>>7-o&1];this.data[a+4*o]=u.blue,this.data[a+4*o+1]=u.green,this.data[a+4*o+2]=u.red,this.data[a+4*o+3]=255}t!==0&&(this.pos+=4-t)}},Xc.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),e=r%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,i=0;i<r;i++){var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+2*i*4,o=s>>4,u=15&s,d=this.palette[o];if(this.data[a]=d.blue,this.data[a+1]=d.green,this.data[a+2]=d.red,this.data[a+3]=255,2*i+1>=this.width)break;d=this.palette[u],this.data[a+4]=d.blue,this.data[a+4+1]=d.green,this.data[a+4+2]=d.red,this.data[a+4+3]=255}e!==0&&(this.pos+=4-e)}},Xc.prototype.bit8=function(){for(var r=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*n;if(i<this.palette.length){var a=this.palette[i];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}r!==0&&(this.pos+=4-r)}},Xc.prototype.bit15=function(){for(var r=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&e)/e*255|0,o=(s>>5&e)/e*255|0,u=(s>>10&e)/e*255|0,d=s>>15?255:0,p=n*this.width*4+4*i;this.data[p]=u,this.data[p+1]=o,this.data[p+2]=a,this.data[p+3]=d}this.pos+=r}},Xc.prototype.bit16=function(){for(var r=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&e)/e*255|0,u=(a>>5&t)/t*255|0,d=(a>>11)/e*255|0,p=i*this.width*4+4*s;this.data[p]=d,this.data[p+1]=u,this.data[p+2]=o,this.data[p+3]=255}this.pos+=r}},Xc.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var e=this.bottom_up?r:this.height-1-r,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=e*this.width*4+4*t;this.data[a]=s,this.data[a+1]=i,this.data[a+2]=n,this.data[a+3]=255}this.pos+=this.width%4}},Xc.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var e=this.bottom_up?r:this.height-1-r,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*t;this.data[o]=s,this.data[o+1]=i,this.data[o+2]=n,this.data[o+3]=a}},Xc.prototype.getData=function(){return this.data},function(r){r.processBMP=function(e,t,n,i){var s=new Xc(e,!1),a=s.width,o=s.height,u={data:s.getData(),width:a,height:o},d=new tB(100).encode(u,100);return r.processJPEG.call(this,d,t,n,i)}}(cn.API),IL.prototype.getData=function(){return this.data},function(r){r.processWEBP=function(e,t,n,i){var s=new IL(e),a=s.width,o=s.height,u={data:s.getData(),width:a,height:o},d=new tB(100).encode(u,100);return r.processJPEG.call(this,d,t,n,i)}}(cn.API),cn.API.processRGBA=function(r,e,t){for(var n=r.data,i=n.length,s=new Uint8Array(i/4*3),a=new Uint8Array(i/4),o=0,u=0,d=0;d<i;d+=4){var p=n[d],_=n[d+1],w=n[d+2],v=n[d+3];s[o++]=p,s[o++]=_,s[o++]=w,a[u++]=v}var M=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:M,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},cn.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Ip=cn.API,F0=Ip.getCharWidthsArray=function(r,e){var t,n,i=(e=e||{}).font||this.internal.getFont(),s=e.fontSize||this.internal.getFontSize(),a=e.charSpace||this.internal.getCharSpace(),o=e.widths?e.widths:i.metadata.Unicode.widths,u=o.fof?o.fof:1,d=e.kerning?e.kerning:i.metadata.Unicode.kerning,p=d.fof?d.fof:1,_=e.doKerning!==!1,w=0,v=r.length,M=0,P=o[0]||u,D=[];for(t=0;t<v;t++)n=r.charCodeAt(t),typeof i.metadata.widthOfString=="function"?D.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(n))+a*(1e3/s)||0)/1e3):(w=_&&ri(d[n])==="object"&&!isNaN(parseInt(d[n][M],10))?d[n][M]/p:0,D.push((o[n]||P)/u+w)),M=n;return D},CL=Ip.getStringUnitWidth=function(r,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),n=e.font||this.internal.getFont(),i=e.charSpace||this.internal.getCharSpace();return Ip.processArabic&&(r=Ip.processArabic(r)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(r,t,i)/t:F0.apply(this,arguments).reduce(function(s,a){return s+a},0)},TL=function(r,e,t,n){for(var i=[],s=0,a=r.length,o=0;s!==a&&o+e[s]<t;)o+=e[s],s++;i.push(r.slice(0,s));var u=s;for(o=0;s!==a;)o+e[s]>n&&(i.push(r.slice(u,s)),o=0,u=s),o+=e[s],s++;return u!==s&&i.push(r.slice(u,s)),i},EL=function(r,e,t){t||(t={});var n,i,s,a,o,u,d,p=[],_=[p],w=t.textIndent||0,v=0,M=0,P=r.split(" "),D=F0.apply(this,[" ",t])[0];if(u=t.lineIndent===-1?P[0].length+2:t.lineIndent||0){var N=Array(u).join(" "),z=[];P.map(function(V){(V=V.split(/\s*\n/)).length>1?z=z.concat(V.map(function($,q){return(q&&$.length?`
`:"")+$})):z.push(V[0])}),P=z,u=CL.apply(this,[N,t])}for(s=0,a=P.length;s<a;s++){var W=0;if(n=P[s],u&&n[0]==`
`&&(n=n.substr(1),W=1),w+v+(M=(i=F0.apply(this,[n,t])).reduce(function(V,$){return V+$},0))>e||W){if(M>e){for(o=TL.apply(this,[n,i,e-(w+v),e]),p.push(o.shift()),p=[o.pop()];o.length;)_.push([o.shift()]);M=i.slice(n.length-(p[0]?p[0].length:0)).reduce(function(V,$){return V+$},0)}else p=[n];_.push(p),w=M+u,v=D}else p.push(n),w+=v+M,v=D}return d=u?function(V,$){return($?N:"")+V.join(" ")}:function(V){return V.join(" ")},_.map(d)},Ip.splitTextToSize=function(r,e,t){var n,i=(t=t||{}).fontSize||this.internal.getFontSize(),s=(function(p){if(p.widths&&p.kerning)return{widths:p.widths,kerning:p.kerning};var _=this.internal.getFont(p.fontName,p.fontStyle);return _.metadata.Unicode?{widths:_.metadata.Unicode.widths||{0:1},kerning:_.metadata.Unicode.kerning||{}}:{font:_.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);n=Array.isArray(r)?r:String(r).split(/\r?\n/);var a=1*this.internal.scaleFactor*e/i;s.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/i:0,s.lineIndent=t.lineIndent;var o,u,d=[];for(o=0,u=n.length;o<u;o++)d=d.concat(EL.apply(this,[n[o],a,s]));return d},function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",t={},n={},i=0;i<e.length;i++)t[e[i]]="0123456789abcdef"[i],n["0123456789abcdef"[i]]=e[i];var s=function(_){return"0x"+parseInt(_,10).toString(16)},a=r.__fontmetrics__.compress=function(_){var w,v,M,P,D=["{"];for(var N in _){if(w=_[N],isNaN(parseInt(N,10))?v="'"+N+"'":(N=parseInt(N,10),v=(v=s(N).slice(2)).slice(0,-1)+n[v.slice(-1)]),typeof w=="number")w<0?(M=s(w).slice(3),P="-"):(M=s(w).slice(2),P=""),M=P+M.slice(0,-1)+n[M.slice(-1)];else{if(ri(w)!=="object")throw new Error("Don't know what to do with value type "+ri(w)+".");M=a(w)}D.push(v+M)}return D.push("}"),D.join("")},o=r.__fontmetrics__.uncompress=function(_){if(typeof _!="string")throw new Error("Invalid argument passed to uncompress.");for(var w,v,M,P,D={},N=1,z=D,W=[],V="",$="",q=_.length-1,te=1;te<q;te+=1)(P=_[te])=="'"?w?(M=w.join(""),w=void 0):w=[]:w?w.push(P):P=="{"?(W.push([z,M]),z={},M=void 0):P=="}"?((v=W.pop())[0][v[1]]=z,M=void 0,z=v[0]):P=="-"?N=-1:M===void 0?t.hasOwnProperty(P)?(V+=t[P],M=parseInt(V,16)*N,N=1,V=""):V+=P:t.hasOwnProperty(P)?($+=t[P],z[M]=parseInt($,16)*N,N=1,M=void 0,$=""):$+=P;return D},u={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},d={Unicode:{Courier:u,"Courier-Bold":u,"Courier-BoldOblique":u,"Courier-Oblique":u,Helvetica:u,"Helvetica-Bold":u,"Helvetica-BoldOblique":u,"Helvetica-Oblique":u,"Times-Roman":u,"Times-Bold":u,"Times-BoldItalic":u,"Times-Italic":u}},p={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(_){var w=_.font,v=p.Unicode[w.postScriptName];v&&(w.metadata.Unicode={},w.metadata.Unicode.widths=v.widths,w.metadata.Unicode.kerning=v.kerning);var M=d.Unicode[w.postScriptName];M&&(w.metadata.Unicode.encoding=M,w.encoding=M.codePages[0])}])}(cn.API),function(r){var e=function(t){for(var n=t.length,i=new Uint8Array(n),s=0;s<n;s++)i[s]=t.charCodeAt(s);return i};r.API.events.push(["addFont",function(t){var n=void 0,i=t.font,s=t.instance;if(!i.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(n=s.existsFileInVFS(i.postScriptName)===!1?s.loadFile(i.postScriptName):s.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?e(o):e(dm(o)),a.metadata=r.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(i,n)}}])}(cn),function(r){function e(){return(ln.canvg?Promise.resolve(ln.canvg):Promise.resolve().then(()=>hye)).catch(function(t){return Promise.reject(new Error("Could not load canvg: "+t))}).then(function(t){return t.default?t.default:t})}cn.API.addSvgAsImage=function(t,n,i,s,a,o,u,d){if(isNaN(n)||isNaN(i))throw Ui.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(a))throw Ui.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var p=document.createElement("canvas");p.width=s,p.height=a;var _=p.getContext("2d");_.fillStyle="#fff",_.fillRect(0,0,p.width,p.height);var w={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},v=this;return e().then(function(M){return M.fromString(_,t,w)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(M){return M.render(w)}).then(function(){v.addImage(p.toDataURL("image/jpeg",1),n,i,s,a,u,d)})}}(),cn.API.putTotalPages=function(r){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(r,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var i=0;i<this.internal.pages[n].length;i++)this.internal.pages[n][i]=this.internal.pages[n][i].replace(e,t);return this},cn.API.viewerPreferences=function(r,e){var t;r=r||{},e=e||!1;var n,i,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),u=[],d=0,p=0,_=0;function w(M,P){var D,N=!1;for(D=0;D<M.length;D+=1)M[D]===P&&(N=!0);return N}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,r==="reset"||e===!0){var v=o.length;for(_=0;_<v;_+=1)t[o[_]].value=t[o[_]].defaultValue,t[o[_]].explicitSet=!1}if(ri(r)==="object"){for(i in r)if(s=r[i],w(o,i)&&s!==void 0){if(t[i].type==="boolean"&&typeof s=="boolean")t[i].value=s;else if(t[i].type==="name"&&w(t[i].valueSet,s))t[i].value=s;else if(t[i].type==="integer"&&Number.isInteger(s))t[i].value=s;else if(t[i].type==="array"){for(d=0;d<s.length;d+=1)if(n=!0,s[d].length===1&&typeof s[d][0]=="number")u.push(String(s[d]-1));else if(s[d].length>1){for(p=0;p<s[d].length;p+=1)typeof s[d][p]!="number"&&(n=!1);n===!0&&u.push([s[d][0]-1,s[d][1]-1].join(" "))}t[i].value="["+u.join(" ")+"]"}else t[i].value=t[i].defaultValue;t[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var M,P=[];for(M in t)t[M].explicitSet===!0&&(t[M].type==="name"?P.push("/"+M+" /"+t[M].value):P.push("/"+M+" "+t[M].value));P.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+P.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},function(r){var e=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',i=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(n)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),u=unescape(encodeURIComponent("</x:xmpmeta>")),d=s.length+a.length+o.length+i.length+u.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+d+" >>"),this.internal.write("stream"),this.internal.write(i+s+a+o+u),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(n,i){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}}(cn.API),function(r){var e=r.API,t=e.pdfEscape16=function(s,a){for(var o,u=a.metadata.Unicode.widths,d=["","0","00","000","0000"],p=[""],_=0,w=s.length;_<w;++_){if(o=a.metadata.characterToGlyph(s.charCodeAt(_)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(_),u.indexOf(o)==-1&&(u.push(o),u.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return p.join("");o=o.toString(16),p.push(d[4-o.length],o)}return p.join("")},n=function(s){var a,o,u,d,p,_,w;for(p=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,u=[],_=0,w=(o=Object.keys(s).sort(function(v,M){return v-M})).length;_<w;_++)a=o[_],u.length>=100&&(p+=`
`+u.length+` beginbfchar
`+u.join(`
`)+`
endbfchar`,u=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(d=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),u.push("<"+a+"><"+d+">"));return u.length&&(p+=`
`+u.length+` beginbfchar
`+u.join(`
`)+`
endbfchar
`),p+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(s){(function(a){var o=a.font,u=a.out,d=a.newObject,p=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="Identity-H"){for(var _=o.metadata.Unicode.widths,w=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),v="",M=0;M<w.length;M++)v+=String.fromCharCode(w[M]);var P=d();p({data:v,addLength1:!0,objectId:P}),u("endobj");var D=d();p({data:n(o.metadata.toUnicode),addLength1:!0,objectId:D}),u("endobj");var N=d();u("<<"),u("/Type /FontDescriptor"),u("/FontName /"+wp(o.fontName)),u("/FontFile2 "+P+" 0 R"),u("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),u("/Flags "+o.metadata.flags),u("/StemV "+o.metadata.stemV),u("/ItalicAngle "+o.metadata.italicAngle),u("/Ascent "+o.metadata.ascender),u("/Descent "+o.metadata.decender),u("/CapHeight "+o.metadata.capHeight),u(">>"),u("endobj");var z=d();u("<<"),u("/Type /Font"),u("/BaseFont /"+wp(o.fontName)),u("/FontDescriptor "+N+" 0 R"),u("/W "+r.API.PDFObject.convert(_)),u("/CIDToGIDMap /Identity"),u("/DW 1000"),u("/Subtype /CIDFontType2"),u("/CIDSystemInfo"),u("<<"),u("/Supplement 0"),u("/Registry (Adobe)"),u("/Ordering ("+o.encoding+")"),u(">>"),u(">>"),u("endobj"),o.objectNumber=d(),u("<<"),u("/Type /Font"),u("/Subtype /Type0"),u("/ToUnicode "+D+" 0 R"),u("/BaseFont /"+wp(o.fontName)),u("/Encoding /"+o.encoding),u("/DescendantFonts ["+z+" 0 R]"),u(">>"),u("endobj"),o.isAlreadyPutted=!0}})(s)}]),e.events.push(["putFont",function(s){(function(a){var o=a.font,u=a.out,d=a.newObject,p=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var _=o.metadata.rawData,w="",v=0;v<_.length;v++)w+=String.fromCharCode(_[v]);var M=d();p({data:w,addLength1:!0,objectId:M}),u("endobj");var P=d();p({data:n(o.metadata.toUnicode),addLength1:!0,objectId:P}),u("endobj");var D=d();u("<<"),u("/Descent "+o.metadata.decender),u("/CapHeight "+o.metadata.capHeight),u("/StemV "+o.metadata.stemV),u("/Type /FontDescriptor"),u("/FontFile2 "+M+" 0 R"),u("/Flags 96"),u("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),u("/FontName /"+wp(o.fontName)),u("/ItalicAngle "+o.metadata.italicAngle),u("/Ascent "+o.metadata.ascender),u(">>"),u("endobj"),o.objectNumber=d();for(var N=0;N<o.metadata.hmtx.widths.length;N++)o.metadata.hmtx.widths[N]=parseInt(o.metadata.hmtx.widths[N]*(1e3/o.metadata.head.unitsPerEm));u("<</Subtype/TrueType/Type/Font/ToUnicode "+P+" 0 R/BaseFont/"+wp(o.fontName)+"/FontDescriptor "+D+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),u("endobj"),o.isAlreadyPutted=!0}})(s)}]);var i=function(s){var a,o=s.text||"",u=s.x,d=s.y,p=s.options||{},_=s.mutex||{},w=_.pdfEscape,v=_.activeFontKey,M=_.fonts,P=v,D="",N=0,z="",W=M[P].encoding;if(M[P].encoding!=="Identity-H")return{text:o,x:u,y:d,options:p,mutex:_};for(z=o,P=v,Array.isArray(o)&&(z=o[0]),N=0;N<z.length;N+=1)M[P].metadata.hasOwnProperty("cmap")&&(a=M[P].metadata.cmap.unicode.codeMap[z[N].charCodeAt(0)]),a||z[N].charCodeAt(0)<256&&M[P].metadata.hasOwnProperty("Unicode")?D+=z[N]:D+="";var V="";return parseInt(P.slice(1))<14||W==="WinAnsiEncoding"?V=w(D,P).split("").map(function($){return $.charCodeAt(0).toString(16)}).join(""):W==="Identity-H"&&(V=t(D,M[P])),_.isHex=!0,{text:V,x:u,y:d,options:p,mutex:_}};e.events.push(["postProcessText",function(s){var a=s.text||"",o=[],u={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var d=0;for(d=0;d<a.length;d+=1)Array.isArray(a[d])&&a[d].length===3?o.push([i(Object.assign({},u,{text:a[d][0]})).text,a[d][1],a[d][2]]):o.push(i(Object.assign({},u,{text:a[d]})).text);s.text=o}else s.text=i(Object.assign({},u,{text:a})).text}])}(cn),function(r){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},r.addFileToVFS=function(t,n){return e.call(this),this.internal.vFS[t]=n,this},r.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}}(cn.API),function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(n){var i,s,a,o,u,d,p,_=e,w=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],v=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],M={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},P={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},D=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],N=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),z=!1,W=0;this.__bidiEngine__={};var V=function(se){var oe=se.charCodeAt(),ve=oe>>8,ge=P[ve];return ge!==void 0?_[256*ge+(255&oe)]:ve===252||ve===253?"AL":N.test(ve)?"L":ve===8?"R":"N"},$=function(se){for(var oe,ve=0;ve<se.length;ve++){if((oe=V(se.charAt(ve)))==="L")return!1;if(oe==="R")return!0}return!1},q=function(se,oe,ve,ge){var Je,Ge,et,Ye,ct=oe[ge];switch(ct){case"L":case"R":z=!1;break;case"N":case"AN":break;case"EN":z&&(ct="AN");break;case"AL":z=!0,ct="R";break;case"WS":ct="N";break;case"CS":ge<1||ge+1>=oe.length||(Je=ve[ge-1])!=="EN"&&Je!=="AN"||(Ge=oe[ge+1])!=="EN"&&Ge!=="AN"?ct="N":z&&(Ge="AN"),ct=Ge===Je?Ge:"N";break;case"ES":ct=(Je=ge>0?ve[ge-1]:"B")==="EN"&&ge+1<oe.length&&oe[ge+1]==="EN"?"EN":"N";break;case"ET":if(ge>0&&ve[ge-1]==="EN"){ct="EN";break}if(z){ct="N";break}for(et=ge+1,Ye=oe.length;et<Ye&&oe[et]==="ET";)et++;ct=et<Ye&&oe[et]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(Ye=oe.length,et=ge+1;et<Ye&&oe[et]==="NSM";)et++;if(et<Ye){var At=se[ge],kt=At>=1425&&At<=2303||At===64286;if(Je=oe[et],kt&&(Je==="R"||Je==="AL")){ct="R";break}}}ct=ge<1||(Je=oe[ge-1])==="B"?"N":ve[ge-1];break;case"B":z=!1,i=!0,ct=W;break;case"S":s=!0,ct="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":z=!1;break;case"BN":ct="N"}return ct},te=function(se,oe,ve){var ge=se.split("");return ve&&J(ge,ve,{hiLevel:W}),ge.reverse(),oe&&oe.reverse(),ge.join("")},J=function(se,oe,ve){var ge,Je,Ge,et,Ye,ct=-1,At=se.length,kt=0,ae=[],Te=W?v:w,Le=[];for(z=!1,i=!1,s=!1,Je=0;Je<At;Je++)Le[Je]=V(se[Je]);for(Ge=0;Ge<At;Ge++){if(Ye=kt,ae[Ge]=q(se,Le,ae,Ge),ge=240&(kt=Te[Ye][M[ae[Ge]]]),kt&=15,oe[Ge]=et=Te[kt][5],ge>0)if(ge===16){for(Je=ct;Je<Ge;Je++)oe[Je]=1;ct=-1}else ct=-1;if(Te[kt][6])ct===-1&&(ct=Ge);else if(ct>-1){for(Je=ct;Je<Ge;Je++)oe[Je]=et;ct=-1}Le[Ge]==="B"&&(oe[Ge]=0),ve.hiLevel|=et}s&&function(De,at,rt){for(var xt=0;xt<rt;xt++)if(De[xt]==="S"){at[xt]=W;for(var vt=xt-1;vt>=0&&De[vt]==="WS";vt--)at[vt]=W}}(Le,oe,At)},me=function(se,oe,ve,ge,Je){if(!(Je.hiLevel<se)){if(se===1&&W===1&&!i)return oe.reverse(),void(ve&&ve.reverse());for(var Ge,et,Ye,ct,At=oe.length,kt=0;kt<At;){if(ge[kt]>=se){for(Ye=kt+1;Ye<At&&ge[Ye]>=se;)Ye++;for(ct=kt,et=Ye-1;ct<et;ct++,et--)Ge=oe[ct],oe[ct]=oe[et],oe[et]=Ge,ve&&(Ge=ve[ct],ve[ct]=ve[et],ve[et]=Ge);kt=Ye}kt++}}},xe=function(se,oe,ve){var ge=se.split(""),Je={hiLevel:W};return ve||(ve=[]),J(ge,ve,Je),function(Ge,et,Ye){if(Ye.hiLevel!==0&&p)for(var ct,At=0;At<Ge.length;At++)et[At]===1&&(ct=D.indexOf(Ge[At]))>=0&&(Ge[At]=D[ct+1])}(ge,ve,Je),me(2,ge,oe,ve,Je),me(1,ge,oe,ve,Je),ge.join("")};return this.__bidiEngine__.doBidiReorder=function(se,oe,ve){if(function(Je,Ge){if(Ge)for(var et=0;et<Je.length;et++)Ge[et]=et;o===void 0&&(o=$(Je)),d===void 0&&(d=$(Je))}(se,oe),a||!u||d)if(a&&u&&o^d)W=o?1:0,se=te(se,oe,ve);else if(!a&&u&&d)W=o?1:0,se=xe(se,oe,ve),se=te(se,oe);else if(!a||o||u||d){if(a&&!u&&o^d)se=te(se,oe),o?(W=0,se=xe(se,oe,ve)):(W=1,se=xe(se,oe,ve),se=te(se,oe));else if(a&&o&&!u&&d)W=1,se=xe(se,oe,ve),se=te(se,oe);else if(!a&&!u&&o^d){var ge=p;o?(W=1,se=xe(se,oe,ve),W=0,p=!1,se=xe(se,oe,ve),p=ge):(W=0,se=xe(se,oe,ve),se=te(se,oe),W=1,p=!1,se=xe(se,oe,ve),p=ge,se=te(se,oe))}}else W=0,se=xe(se,oe,ve);else W=o?1:0,se=xe(se,oe,ve);return se},this.__bidiEngine__.setOptions=function(se){se&&(a=se.isInputVisual,u=se.isOutputVisual,o=se.isInputRtl,d=se.isOutputRtl,p=se.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(n){var i=n.text,s=(n.x,n.y,n.options||{}),a=(n.mutex,s.lang,[]);if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,t.setOptions(s),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(a=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?a.push([t.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):a.push([t.doBidiReorder(i[o])]);n.text=a}else n.text=t.doBidiReorder(i);t.setOptions({isInputVisual:!0})}])}(cn),cn.API.TTFFont=function(){function r(e){var t;if(this.rawData=e,t=this.contents=new DA(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Kle(this),this.registerTTF()}return r.open=function(e){return new r(e)},r.prototype.parse=function(){return this.directory=new Lle(this.contents),this.head=new Ule(this),this.name=new zle(this),this.cmap=new PL(this),this.toUnicode={},this.hhea=new Dle(this),this.maxp=new Hle(this),this.hmtx=new Vle(this),this.post=new kle(this),this.os2=new Nle(this),this.loca=new qle(this),this.glyf=new jle(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var e,t,n,i,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,u,d;for(d=[],a=0,o=(u=this.bbox).length;a<o;a++)e=u[a],d.push(Math.round(e*this.scaleFactor));return d}).call(this),this.stemV=0,this.post.exists?(n=255&(i=this.post.italic_angle),32768&(t=i>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},r.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},r.prototype.widthOfString=function(e,t,n){var i,s,a,o;for(a=0,s=0,o=(e=""+e).length;0<=o?s<o:s>o;s=0<=o?++s:--s)i=e.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(i))+n*(1e3/t)||0;return a*(t/1e3)},r.prototype.lineHeight=function(e,t){var n;return t==null&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},r}();var Yc,DA=function(){function r(e){this.data=e??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(e){return this.data[this.pos++]=e},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},r.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},r.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},r.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},r.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},r.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},r.prototype.writeString=function(e){var t,n,i;for(i=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)i.push(this.writeByte(e.charCodeAt(t)));return i},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(e){return this.writeInt16(e)},r.prototype.readLongLong=function(){var e,t,n,i,s,a,o,u;return e=this.readByte(),t=this.readByte(),n=this.readByte(),i=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),u=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^i)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^u)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*i+16777216*s+65536*a+256*o+u},r.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(e){return this.writeInt32(e)},r.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},r.prototype.write=function(e){var t,n,i,s;for(s=[],n=0,i=e.length;n<i;n++)t=e[n],s.push(this.writeByte(t));return s},r}(),Lle=function(){var r;function e(t){var n,i,s;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},i=0,s=this.tableCount;0<=s?i<s:i>s;i=0<=s?++i:--i)n={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[n.tag]=n}return e.prototype.encode=function(t){var n,i,s,a,o,u,d,p,_,w,v,M,P;for(P in v=Object.keys(t).length,u=Math.log(2),_=16*Math.floor(Math.log(v)/u),a=Math.floor(_/u),p=16*v-_,(i=new DA).writeInt(this.scalarType),i.writeShort(v),i.writeShort(_),i.writeShort(a),i.writeShort(p),s=16*v,d=i.pos+s,o=null,M=[],t)for(w=t[P],i.writeString(P),i.writeInt(r(w)),i.writeInt(d),i.writeInt(w.length),M=M.concat(w),P==="head"&&(o=d),d+=w.length;d%4;)M.push(0),d++;return i.write(M),n=2981146554-r(i.data),i.pos=o+8,i.writeUInt32(n),i.data},r=function(t){var n,i,s,a;for(t=FL.call(t);t.length%4;)t.push(0);for(s=new DA(t),i=0,n=0,a=t.length;n<a;n=n+=4)i+=s.readUInt32();return 4294967295&i},e}(),Ole={}.hasOwnProperty,Ju=function(r,e){for(var t in e)Ole.call(e,t)&&(r[t]=e[t]);function n(){this.constructor=r}return n.prototype=e.prototype,r.prototype=new n,r.__super__=e.prototype,r};Yc=function(){function r(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r}();var Ule=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var n;return(n=new DA).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(t),n.writeShort(this.glyphDataFormat),n.data},e}(),ML=function(){function r(e,t){var n,i,s,a,o,u,d,p,_,w,v,M,P,D,N,z,W;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),_=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(u=0;u<256;++u)this.codeMap[u]=e.readByte();break;case 4:for(v=e.readUInt16(),w=v/2,e.pos+=6,s=function(){var V,$;for($=[],u=V=0;0<=w?V<w:V>w;u=0<=w?++V:--V)$.push(e.readUInt16());return $}(),e.pos+=2,P=function(){var V,$;for($=[],u=V=0;0<=w?V<w:V>w;u=0<=w?++V:--V)$.push(e.readUInt16());return $}(),d=function(){var V,$;for($=[],u=V=0;0<=w?V<w:V>w;u=0<=w?++V:--V)$.push(e.readUInt16());return $}(),p=function(){var V,$;for($=[],u=V=0;0<=w?V<w:V>w;u=0<=w?++V:--V)$.push(e.readUInt16());return $}(),i=(this.length-e.pos+this.offset)/2,o=function(){var V,$;for($=[],u=V=0;0<=i?V<i:V>i;u=0<=i?++V:--V)$.push(e.readUInt16());return $}(),u=N=0,W=s.length;N<W;u=++N)for(D=s[u],n=z=M=P[u];M<=D?z<=D:z>=D;n=M<=D?++z:--z)p[u]===0?a=n+d[u]:(a=o[p[u]/2+(n-M)-(w-u)]||0)!==0&&(a+=d[u]),this.codeMap[n]=65535&a}e.pos=_}return r.encode=function(e,t){var n,i,s,a,o,u,d,p,_,w,v,M,P,D,N,z,W,V,$,q,te,J,me,xe,se,oe,ve,ge,Je,Ge,et,Ye,ct,At,kt,ae,Te,Le,De,at,rt,xt,vt,nr,qt,or;switch(ge=new DA,a=Object.keys(e).sort(function(gr,wr){return gr-wr}),t){case"macroman":for(P=0,D=function(){var gr=[];for(M=0;M<256;++M)gr.push(0);return gr}(),z={0:0},s={},Je=0,ct=a.length;Je<ct;Je++)z[vt=e[i=a[Je]]]==null&&(z[vt]=++P),s[i]={old:e[i],new:z[e[i]]},D[i]=z[e[i]];return ge.writeUInt16(1),ge.writeUInt16(0),ge.writeUInt32(12),ge.writeUInt16(0),ge.writeUInt16(262),ge.writeUInt16(0),ge.write(D),{charMap:s,subtable:ge.data,maxGlyphID:P+1};case"unicode":for(oe=[],_=[],W=0,z={},n={},N=d=null,Ge=0,At=a.length;Ge<At;Ge++)z[$=e[i=a[Ge]]]==null&&(z[$]=++W),n[i]={old:$,new:z[$]},o=z[$]-i,N!=null&&o===d||(N&&_.push(N),oe.push(i),d=o),N=i;for(N&&_.push(N),_.push(65535),oe.push(65535),xe=2*(me=oe.length),J=2*Math.pow(Math.log(me)/Math.LN2,2),w=Math.log(J/2)/Math.LN2,te=2*me-J,u=[],q=[],v=[],M=et=0,kt=oe.length;et<kt;M=++et){if(se=oe[M],p=_[M],se===65535){u.push(0),q.push(0);break}if(se-(ve=n[se].new)>=32768)for(u.push(0),q.push(2*(v.length+me-M)),i=Ye=se;se<=p?Ye<=p:Ye>=p;i=se<=p?++Ye:--Ye)v.push(n[i].new);else u.push(ve-se),q.push(0)}for(ge.writeUInt16(3),ge.writeUInt16(1),ge.writeUInt32(12),ge.writeUInt16(4),ge.writeUInt16(16+8*me+2*v.length),ge.writeUInt16(0),ge.writeUInt16(xe),ge.writeUInt16(J),ge.writeUInt16(w),ge.writeUInt16(te),rt=0,ae=_.length;rt<ae;rt++)i=_[rt],ge.writeUInt16(i);for(ge.writeUInt16(0),xt=0,Te=oe.length;xt<Te;xt++)i=oe[xt],ge.writeUInt16(i);for(nr=0,Le=u.length;nr<Le;nr++)o=u[nr],ge.writeUInt16(o);for(qt=0,De=q.length;qt<De;qt++)V=q[qt],ge.writeUInt16(V);for(or=0,at=v.length;or<at;or++)P=v[or],ge.writeUInt16(P);return{charMap:n,subtable:ge.data,maxGlyphID:W+1}}},r}(),PL=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="cmap",e.prototype.parse=function(t){var n,i,s;for(t.pos=this.offset,this.version=t.readUInt16(),s=t.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=s?i<s:i>s;i=0<=s?++i:--i)n=new ML(t,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},e.encode=function(t,n){var i,s;return n==null&&(n="macroman"),i=ML.encode(t,n),(s=new DA).writeUInt16(0),s.writeUInt16(1),i.table=s.data.concat(i.subtable),i},e}(),Dle=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),Nle=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var n,i;for(i=[],n=0;n<10;++n)i.push(t.readByte());return i}(),this.charRange=function(){var n,i;for(i=[],n=0;n<4;++n)i.push(t.readInt());return i}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var n,i;for(i=[],n=0;n<2;n=++n)i.push(t.readInt());return i}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),kle=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="post",e.prototype.parse=function(t){var n,i,s;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:break;case 131072:var a;for(i=t.readUInt16(),this.glyphNameIndex=[],a=0;0<=i?a<i:a>i;a=0<=i?++a:--a)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],s=[];t.pos<this.offset+this.length;)n=t.readByte(),s.push(this.names.push(t.readString(n)));return s;case 151552:return i=t.readUInt16(),this.offsets=t.read(i);case 196608:break;case 262144:return this.map=(function(){var o,u,d;for(d=[],a=o=0,u=this.file.maxp.numGlyphs;0<=u?o<u:o>u;a=0<=u?++o:--o)d.push(t.readUInt32());return d}).call(this)}},e}(),Qle=function(r,e){this.raw=r,this.length=r.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},zle=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="name",e.prototype.parse=function(t){var n,i,s,a,o,u,d,p,_,w,v;for(t.pos=this.offset,t.readShort(),n=t.readShort(),u=t.readShort(),i=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)i.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+u+t.readShort()});for(d={},a=_=0,w=i.length;_<w;a=++_)s=i[a],t.pos=s.offset,p=t.readString(s.length),o=new Qle(p,s),d[v=s.nameID]==null&&(d[v]=[]),d[s.nameID].push(o);this.strings=d,this.copyright=d[0],this.fontFamily=d[1],this.fontSubfamily=d[2],this.uniqueSubfamily=d[3],this.fontName=d[4],this.version=d[5];try{this.postscriptName=d[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=d[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=d[7],this.manufacturer=d[8],this.designer=d[9],this.description=d[10],this.vendorUrl=d[11],this.designerUrl=d[12],this.license=d[13],this.licenseUrl=d[14],this.preferredFamily=d[15],this.preferredSubfamily=d[17],this.compatibleFull=d[18],this.sampleText=d[19]},e}(),Hle=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),Vle=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="hmtx",e.prototype.parse=function(t){var n,i,s,a,o,u,d;for(t.pos=this.offset,this.metrics=[],n=0,u=this.file.hhea.numberOfMetrics;0<=u?n<u:n>u;n=0<=u?++n:--n)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var p,_;for(_=[],n=p=0;0<=s?p<s:p>s;n=0<=s?++p:--p)_.push(t.readInt16());return _}(),this.widths=(function(){var p,_,w,v;for(v=[],p=0,_=(w=this.metrics).length;p<_;p++)a=w[p],v.push(a.advance);return v}).call(this),i=this.widths[this.widths.length-1],d=[],n=o=0;0<=s?o<s:o>s;n=0<=s?++o:--o)d.push(this.widths.push(i));return d},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),FL=[].slice,jle=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var n,i,s,a,o,u,d,p,_,w;return t in this.cache?this.cache[t]:(a=this.file.loca,n=this.file.contents,i=a.indexOf(t),(s=a.lengthOf(t))===0?this.cache[t]=null:(n.pos=this.offset+i,o=(u=new DA(n.read(s))).readShort(),p=u.readShort(),w=u.readShort(),d=u.readShort(),_=u.readShort(),this.cache[t]=o===-1?new Gle(u,p,w,d,_):new $le(u,o,p,w,d,_),this.cache[t]))},e.prototype.encode=function(t,n,i){var s,a,o,u,d;for(o=[],a=[],u=0,d=n.length;u<d;u++)s=t[n[u]],a.push(o.length),s&&(o=o.concat(s.encode(i)));return a.push(o.length),{table:o,offsets:a}},e}(),$le=function(){function r(e,t,n,i,s,a){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=i,this.xMax=s,this.yMax=a,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r}(),Gle=function(){function r(e,t,n,i,s){var a,o;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=i,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return r.prototype.encode=function(){var e,t,n;for(t=new DA(FL.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},r}(),qle=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Ju(e,Yc),e.prototype.tag="loca",e.prototype.parse=function(t){var n,i;return t.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=2)a.push(2*t.readUInt16());return a}).call(this):(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=4)a.push(t.readUInt32());return a}).call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,n){for(var i=new Uint32Array(this.offsets.length),s=0,a=0,o=0;o<i.length;++o)if(i[o]=s,a<n.length&&n[a]==o){++a,i[o]=s;var u=this.offsets[o],d=this.offsets[o+1]-u;d>0&&(s+=d)}for(var p=new Array(4*i.length),_=0;_<i.length;++_)p[4*_+3]=255&i[_],p[4*_+2]=(65280&i[_])>>8,p[4*_+1]=(16711680&i[_])>>16,p[4*_]=(4278190080&i[_])>>24;return p},e}(),Kle=function(){function r(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var e,t,n,i,s;for(t in i=this.font.cmap.tables[0].codeMap,e={},s=this.subset)n=s[t],e[t]=i[n];return e},r.prototype.glyphsFor=function(e){var t,n,i,s,a,o,u;for(i={},a=0,o=e.length;a<o;a++)i[s=e[a]]=this.font.glyf.glyphFor(s);for(s in t=[],i)(n=i[s])!=null&&n.compound&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(s in u=this.glyphsFor(t))n=u[s],i[s]=n;return i},r.prototype.encode=function(e,t){var n,i,s,a,o,u,d,p,_,w,v,M,P,D,N;for(i in n=PL.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(e),v={0:0},N=n.charMap)v[(u=N[i]).old]=u.new;for(M in w=n.maxGlyphID,a)M in v||(v[M]=w++);return p=function(z){var W,V;for(W in V={},z)V[z[W]]=W;return V}(v),_=Object.keys(p).sort(function(z,W){return z-W}),P=function(){var z,W,V;for(V=[],z=0,W=_.length;z<W;z++)o=_[z],V.push(p[o]);return V}(),s=this.font.glyf.encode(a,P,v),d=this.font.loca.encode(s.offsets,P),D={cmap:this.font.cmap.raw(),glyf:s.table,loca:d,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(D["OS/2"]=this.font.os2.raw()),this.font.directory.encode(D)},r}();cn.API.PDFObject=function(){var r;function e(){}return r=function(t,n){return(Array(n+1).join("0")+t).slice(-n)},e.convert=function(t){var n,i,s,a;if(Array.isArray(t))return"["+function(){var o,u,d;for(d=[],o=0,u=t.length;o<u;o++)n=t[o],d.push(e.convert(n));return d}().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t!=null&&t.isString)return"("+t+")";if(t instanceof Date)return"(D:"+r(t.getUTCFullYear(),4)+r(t.getUTCMonth(),2)+r(t.getUTCDate(),2)+r(t.getUTCHours(),2)+r(t.getUTCMinutes(),2)+r(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(i in s=["<<"],t)a=t[i],s.push("/"+i+" "+e.convert(a));return s.push(">>"),s.join(`
`)}return""+t},e}();const rB={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},R0={style:{textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]},visibility:"visible",position:"bottom-right"},L0={image:'<svg width="800px" height="800px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--gis" preserveAspectRatio="xMidYMid meet"><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="none" stroke="white" stroke-width="1.5"/><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="#000000" fill-rule="evenodd"></path></svg>',imageName:"gl-export-north-icon",imageSizeFraction:.05,visibility:"visible",position:"top-right"};class Wle{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jf.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Rh.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:bp.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:rB,d=arguments.length>8&&arguments[8]!==void 0?arguments[8]:"maplibregl-ctrl-attrib-inner",p=arguments.length>9&&arguments[9]!==void 0?arguments[9]:R0,_=arguments.length>10&&arguments[10]!==void 0?arguments[10]:L0;Yn(this,"map"),Yn(this,"width"),Yn(this,"height"),Yn(this,"dpi"),Yn(this,"format"),Yn(this,"unit"),Yn(this,"fileName"),Yn(this,"markerClassName"),Yn(this,"markerCirclePaint"),Yn(this,"attributionClassName"),Yn(this,"attributionOptions"),Yn(this,"northIconOptions"),this.map=e,this.width=t[0],this.height=t[1],this.dpi=n,this.format=i,this.unit=s,this.fileName=a,this.markerClassName=o,this.markerCirclePaint=u,this.attributionClassName=d,this.attributionOptions=p,this.northIconOptions=_}renderMapPost(e){return e}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(e){const t=this.getMarkers();for(let n=0;n<t.length;n++){const i=t.item(n);if(!i)continue;const s=i.getAttribute("style");if(!s)continue;const a=/translate\(([^,]+)px,\s*([^,]+)px\)/,o=s.match(a);if(!o)continue;const u=parseInt(o[1]),d=parseInt(o[2]),p=this.map.unproject([u,d]),_=`point${n}`;e.addSource(_,{type:"geojson",data:{type:"Point",coordinates:[p.lng,p.lat]}}),e.addLayer({id:_,source:_,type:"circle",paint:this.markerCirclePaint})}return e}generate(){const e=this;this.addLoader(),this.showLoader();const t=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return e.dpi/96}});const n=document.createElement("div");n.className="hidden-map",document.body.appendChild(n);const i=document.createElement("div");i.style.width=this.toPixels(this.width),i.style.height=this.toPixels(this.height),n.appendChild(i);const s=this.map.getStyle();if(s&&s.sources){const o=s.sources;Object.keys(o).forEach(u=>{const d=o[u];Object.keys(d).forEach(p=>{d[p]||delete d[p]})})}let a=this.getRenderedMap(i,s);a.on("load",()=>{this.addNorthIconToMap(a).then(()=>{a.once("idle",()=>{this.addAttributions(a)?a.once("idle",()=>{a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,t):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,t)}))}):(a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,t):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,t)})))})})})}stripHtml(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}getIconWidth(e,t){const n=e.getContainer(),i=parseInt(n.style.width.replace("px",""));return parseInt(`${i*t}`)}getElementPosition(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=e.getContainer();let s=0,a=0;switch(t){case"top-left":s=0+n,a=0+n;break;case"top-right":s=parseInt(i.style.width.replace("px",""))-n,a=0+n;break;case"bottom-left":s=0+n,a=parseInt(i.style.height.replace("px",""))-n;break;case"bottom-right":s=parseInt(i.style.width.replace("px",""))-n,a=parseInt(i.style.height.replace("px",""))-n;break}return[s,a]}addNorthIconImage(e){const t=this.getIconWidth(e,this.northIconOptions.imageSizeFraction??.08);return new Promise(n=>{const i=new Image(t,t);i.onload=()=>{this.northIconOptions.imageName&&e.addImage(this.northIconOptions.imageName,i),n()};function s(a){return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a)}this.northIconOptions.image&&(i.src=s(this.northIconOptions.image))})}addNorthIconToMap(e){let t=this.northIconOptions.visibility??"visible";return e.getZoom()<2&&this.width>this.height&&(t="none"),new Promise(n=>{this.addNorthIconImage(e).then(()=>{const i=this.getIconWidth(e,this.northIconOptions.imageSizeFraction??.08)*.8,s=this.getElementPosition(e,this.northIconOptions.position??"top-right",i),a=e.unproject(s),o=this.northIconOptions.imageName??"gl-export-north-icon";e.addSource(o,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[a.lng,a.lat]},properties:{}}}),e.addLayer({id:o,source:o,type:"symbol",layout:{"icon-image":o,"icon-size":1,"icon-rotate":e.getBearing()*-1,"icon-allow-overlap":!0,"icon-ignore-placement":!0,visibility:t},paint:{}}),n()})})}addAttributions(e){var t;if(!this.map.getStyle().glyphs)return!1;const n=e.getContainer(),i=this.attributionOptions.position??"bottom-right",s=this.getElementPosition(e,i,5),a=s[0],o=e.unproject(s),u=n.getElementsByClassName(this.attributionClassName),d=[];if((u==null?void 0:u.length)>0){const D=u.item(0);if(D)for(let N=0;N<D.children.length;N++){const z=D.children.item(N);z&&d.push(this.stripHtml(z.outerHTML))}}else{const D=this.map.getStyle().sources;Object.keys(D).forEach(N=>{const z=D[N];if("attribution"in z){const W=z.attribution;d.push(this.stripHtml(W))}})}if(d.length===0)return!1;const p=d.join(" | "),_="attribution";e.addSource(_,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[o.lng,o.lat]},properties:{attribution:p}}});const w=this.map.getStyle().layers.filter(D=>D.type==="symbol"&&D.layout&&"text-font"in D.layout),v=w.length>0&&w[0].layout?w[0].layout["text-font"]:(t=this.attributionOptions.style)==null?void 0:t.fallbackTextFont;let M=this.attributionOptions.visibility??"visible";e.getZoom()<2&&this.width>this.height&&(M="none");const P=this.attributionOptions.style;return e.addLayer({id:_,source:_,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":v,"text-max-width":parseInt(`${a/P.textSize}`),"text-anchor":i,"text-justify":["top-right","bottom-right"].includes(i)?"right":"left","text-size":P.textSize,"text-allow-overlap":!0,visibility:M},paint:{"text-halo-color":P.textHaloColor,"text-halo-width":P.textHaloWidth,"text-color":P.textColor}}),!0}exportImage(e,t,n){var i;const s=e.getCanvas(),a=`${this.fileName}.${this.format}`;switch(this.format){case Rh.PNG:this.toPNG(s,a);break;case Rh.JPEG:this.toJPEG(s,a);break;case Rh.PDF:this.toPDF(e,a);break;case Rh.SVG:this.toSVG(s,a);break;default:console.error(`Invalid file format: ${this.format}`);break}e.remove(),(i=t.parentNode)==null||i.removeChild(t),Object.defineProperty(window,"devicePixelRatio",{get(){return n}}),t.remove(),this.hideLoader()}toPNG(e,t){const n=document.createElement("a");n.href=e.toDataURL(),n.download=t,n.click(),n.remove()}toJPEG(e,t){const n=e.toDataURL("image/jpeg",.85),i=document.createElement("a");i.href=n,i.download=t,i.click(),i.remove()}toPDF(e,t){const n=e.getCanvas(),i=new cn({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});i.addImage(n.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:s,lat:a}=e.getCenter();i.setProperties({title:e.getStyle().name,subject:`center: [${s}, ${a}], zoom: ${e.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),i.save(t)}toSVG(e,t){const n=e.toDataURL("image/png"),i=Number(this.toPixels(this.width,this.dpi).replace("px","")),s=Number(this.toPixels(this.height,this.dpi).replace("px","")),a=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${i}" 
      height="${s}" 
      viewBox="0 0 ${i} ${s}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${n}" width="${i}" height="${s}"></image>
    </svg>`,o=document.createElement("a");o.href=`data:application/xml,${encodeURIComponent(a)}`,o.download=t,o.click(),o.remove()}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===bp.mm&&(t/=25.4),`${t*e}px`}addLoader(){var e;const t=(e=this.map.getCanvas().parentElement)==null?void 0:e.parentElement;if(!t||t.getElementsByClassName("map-export-loader").length>0)return;const n=document.createElement("span");n.classList.add("map-export-loader"),n.classList.add("loader-default"),t.appendChild(n)}showLoader(){var e,t;const n=(e=this.map.getCanvas().parentElement)==null?void 0:e.parentElement;if(!n)return;const i=n.getElementsByClassName("map-export-loader");i&&i.length>0&&((t=i.item(0))==null||t.classList.add("is-active"))}hideLoader(){var e,t;const n=(e=this.map.getCanvas().parentElement)==null?void 0:e.parentElement;if(!n)return;const i=n.getElementsByClassName("map-export-loader");i&&i.length>0&&((t=i.item(0))==null||t.classList.remove("is-active"))}}class Xle extends Wle{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jf.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Rh.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:bp.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:rB,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:R0,d=arguments.length>8&&arguments[8]!==void 0?arguments[8]:L0;super(e,t,n,i,s,a,"maplibregl-marker",o,"maplibregl-ctrl-attrib-inner",u,d)}getRenderedMap(e,t){const n=new FS.Map({container:e,style:t,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,canvasContextAttributes:{preserveDrawingBuffer:!0},fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(n.setMaxPitch(85),n.setPitch(this.map.getPitch()));const i=(this.map.style.imageManager||{}).images||[];return Object.keys(i).forEach(s=>{i[s].data&&n.addImage(s,i[s].data)}),n}renderMapPost(e){const t=this.map.getTerrain();return t&&e.setTerrain({source:t.source,exaggeration:t.exaggeration}),e}}let Yle=class{constructor(e){Yn(this,"controlContainer"),Yn(this,"exportContainer"),Yn(this,"crosshair"),Yn(this,"printableArea"),Yn(this,"map"),Yn(this,"exportButton"),Yn(this,"options",{PageSize:jf.A4,PageOrientation:um.Landscape,Format:Rh.PDF,DPI:Rx[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(jf),Filename:"map",markerCirclePaint:rB,attributionOptions:R0,northIconOptions:L0}),Yn(this,"MAPLIB_CSS_PREFIX","maplibregl"),e&&(e.attributionOptions=Object.assign(R0,e.attributionOptions),e.northIconOptions=Object.assign(L0,e.northIconOptions),this.options=Object.assign(this.options,e)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const e=this.options.Local??"en";return Yae(e)}onAdd(e){var t;this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const n=document.createElement("TABLE");n.className="print-table";const i={};(t=this.options.AllowedSizes)==null||t.forEach(p=>{jf[p]&&(i[p]=jf[p])});const s=this.createSelection(i,this.getTranslation().PageSize,"page-size",this.options.PageSize,(p,_)=>JSON.stringify(p[_]));n.appendChild(s);const a=this.createSelection(um,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(p,_)=>p[_]);n.appendChild(a);const o=this.createSelection(Rh,this.getTranslation().Format,"format-type",this.options.Format,(p,_)=>p[_]);n.appendChild(o);const u=this.createSelection(Rx,this.getTranslation().DPI,"dpi-type",this.options.DPI,(p,_)=>p[_]);n.appendChild(u),this.exportContainer.appendChild(n);const d=document.createElement("button");return d.type="button",d.textContent=this.getTranslation().Generate,d.classList.add("generate-button"),d.addEventListener("click",()=>{const p=document.getElementById("mapbox-gl-export-page-size"),_=document.getElementById("mapbox-gl-export-page-orientation"),w=document.getElementById("mapbox-gl-export-format-type"),v=document.getElementById("mapbox-gl-export-dpi-type"),M=_.value;let P=JSON.parse(p.value);M===um.Portrait&&(P=P.reverse()),this.generateMap(e,P,Number(v.value),w.value,bp.mm,this.options.Filename)}),this.exportContainer.appendChild(d),this.controlContainer}generateMap(e,t,n,i,s,a){new Xle(e,t,n,i,s,a,this.options.markerCirclePaint,this.options.attributionOptions,this.options.northIconOptions).generate()}createSelection(e,t,n,i,s){const a=document.createElement("label");a.textContent=t;const o=document.createElement("select");o.setAttribute("id",`mapbox-gl-export-${n}`),o.style.width="100%",Object.keys(e).forEach(_=>{const w=document.createElement("option");w.setAttribute("value",s(e,_)),w.appendChild(document.createTextNode(_)),w.setAttribute("name",n),i===e[_]&&(w.selected=!0),o.appendChild(w)}),o.addEventListener("change",()=>{this.updatePrintableArea()});const u=document.createElement("TR"),d=document.createElement("TD"),p=document.createElement("TD");return d.appendChild(a),p.appendChild(o),u.appendChild(d),u.appendChild(p),u}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(e){this.controlContainer&&!this.controlContainer.contains(e.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(e){this.options.Crosshair===!0&&(e===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new Uae(this.map),this.crosshair.create()))}togglePrintableArea(e){this.options.PrintableArea===!0&&(e===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new Dae(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const e=document.getElementById("mapbox-gl-export-page-size"),t=document.getElementById("mapbox-gl-export-page-orientation").value;let n=JSON.parse(e.value);t===um.Portrait&&(n=n.reverse()),this.printableArea.updateArea(n[0],n[1])}};function nB(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(p){try{d(n.next(p))}catch(_){a(_)}}function u(p){try{d(n.throw(p))}catch(_){a(_)}}function d(p){p.done?s(p.value):i(p.value).then(o,u)}d((n=n.apply(r,e||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;var O0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function U0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var iB,RL;function LL(){if(RL)return iB;RL=1,iB=e;var r=Object.prototype.hasOwnProperty;function e(){for(var t={},n=0;n<arguments.length;n++){var i=arguments[n];for(var s in i)r.call(i,s)&&(t[s]=i[s])}return t}return iB}var sB={exports:{}},OL;function Zle(){return OL||(OL=1,function(r,e){(function(){var t={};r.exports=t,t.simpleFilter=function(n,i){return i.filter(function(s){return t.test(n,s)})},t.test=function(n,i){return t.match(n,i)!==null},t.match=function(n,i,s){s=s||{};var a=0,o=[],u=i.length,d=0,p=0,_=s.pre||"",w=s.post||"",v=s.caseSensitive&&i||i.toLowerCase(),M;n=s.caseSensitive&&n||n.toLowerCase();for(var P=0;P<u;P++)M=i[P],v[P]===n[a]?(M=_+M+w,a+=1,p+=1+p):p=0,d+=p,o[o.length]=M;return a===n.length?(d=v===n?1/0:d,{rendered:o.join(""),score:d}):null},t.filter=function(n,i,s){return!i||i.length===0?[]:typeof n!="string"?i:(s=s||{},i.reduce(function(a,o,u,d){var p=o;s.extract&&(p=s.extract(o));var _=t.match(n,p,s);return _!=null&&(a[a.length]={string:_.rendered,score:_.score,index:u,original:o}),a},[]).sort(function(a,o){var u=o.score-a.score;return u||a.index-o.index}))}})()}(sB)),sB.exports}var oB,UL;function Jle(){if(UL)return oB;UL=1;var r=function(e){return this.component=e,this.items=[],this.active=e.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};return r.prototype.show=function(){this.element.style.display="block"},r.prototype.hide=function(){this.element.style.display="none"},r.prototype.add=function(e){this.items.push(e)},r.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},r.prototype.isEmpty=function(){return!this.items.length},r.prototype.isVisible=function(){return this.element.style.display==="block"},r.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()},r.prototype.drawItem=function(e,t){var n=document.createElement("li"),i=document.createElement("a");t&&(n.className+=" active"),i.innerHTML=e.string,n.appendChild(i),this.element.appendChild(n),n.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),n.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,e)}).bind(this))},r.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()},r.prototype.move=function(e){this.active=e,this.draw()},r.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},r.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},r.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()},oB=r,oB}var aB,DL;function ece(){if(DL)return aB;DL=1;var r=LL(),e=Zle(),t=Jle(),n=function(i,s,a){return a=a||{},this.options=r({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},a),this.el=i,this.data=s||[],this.list=new t(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(o){this.handleKeyUp(o.keyCode,o)}).bind(this),!1),this.el.addEventListener("keydown",(function(o){this.handleKeyDown(o)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(o){this.handlePaste(o)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return n.prototype.handleKeyUp=function(i,s){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),s.stopPropagation());return}this.handleInputChange(this.el.value)}},n.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},n.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},n.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(i.target.value)},100)}},n.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(s){for(var a=0;a<s.length&&(this.list.add(s[a]),a!==this.options.limit-1);a++);this.list.draw()}).bind(this))},n.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},n.prototype.update=function(i){this.data=i,this.handleKeyUp()},n.prototype.clear=function(){this.data=[],this.list.clear()},n.prototype.normalize=function(i){return i=i.toLowerCase(),i},n.prototype.match=function(i,s){return i.indexOf(s)>-1},n.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")},n.prototype.getCandidates=function(i){var s={pre:"<strong>",post:"</strong>",extract:(function(o){return this.getItemValue(o)}).bind(this)},a;this.options.filter?(a=e.filter(this.query,this.data,s),a=a.map((function(o){return{original:o.original,string:this.render(o.original,o.string)}}).bind(this))):a=this.data.map((function(o){var u=this.render(o);return{original:o,string:u}}).bind(this)),i(a)},n.prototype.getItemValue=function(i){return i},n.prototype.render=function(i,s){if(s)return s;for(var a=i.original?this.getItemValue(i.original):this.getItemValue(i),o=this.normalize(a),u=o.lastIndexOf(this.query);u>-1;){var d=u+this.query.length;a=a.slice(0,u)+"<strong>"+a.slice(u,d)+"</strong>"+a.slice(d),u=o.slice(0,u).lastIndexOf(this.query)}return a},n.prototype.renderError=function(i){this.list.drawError(i)},aB=n,aB}var lB,NL;function tce(){if(NL)return lB;NL=1;var r=ece();return lB=r,typeof window<"u"&&(window.Suggestions=r),lB}var rce=tce(),nce=U0(rce),D0={exports:{}},ice=D0.exports,kL;function sce(){return kL||(kL=1,function(r){(function(e,t,n){r.exports?r.exports=n():e[t]=n()})(ice,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(u){return u.match(t)||[]}function i(u){return n(u).filter(function(d,p){return d&&p})}function s(u){return u=n(u),{language:u[1]||e,extlang:u[2]||e,script:u[3]||e,region:u[4]||e}}function a(u,d,p){Object.defineProperty(u,d,{value:p,enumerable:!0})}function o(u,d,p){function _(w){return n(w)[u]||e}a(_,"pattern",d),a(s,p,_)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(s,"split",i),s})}(D0)),D0.exports}var oce=sce(),ace=U0(oce),cB,QL;function lce(){if(QL)return cB;QL=1;var r="Expected a function",e=NaN,t="[object Symbol]",n=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,u=typeof O0=="object"&&O0&&O0.Object===Object&&O0,d=typeof self=="object"&&self&&self.Object===Object&&self,p=u||d||Function("return this")(),_=Object.prototype,w=_.toString,v=Math.max,M=Math.min,P=function(){return p.Date.now()};function D($,q,te){var J,me,xe,se,oe,ve,ge=0,Je=!1,Ge=!1,et=!0;if(typeof $!="function")throw new TypeError(r);q=V(q)||0,N(te)&&(Je=!!te.leading,Ge="maxWait"in te,xe=Ge?v(V(te.maxWait)||0,q):xe,et="trailing"in te?!!te.trailing:et);function Ye(rt){var xt=J,vt=me;return J=me=void 0,ge=rt,se=$.apply(vt,xt),se}function ct(rt){return ge=rt,oe=setTimeout(ae,q),Je?Ye(rt):se}function At(rt){var xt=rt-ve,vt=rt-ge,nr=q-xt;return Ge?M(nr,xe-vt):nr}function kt(rt){var xt=rt-ve,vt=rt-ge;return ve===void 0||xt>=q||xt<0||Ge&&vt>=xe}function ae(){var rt=P();if(kt(rt))return Te(rt);oe=setTimeout(ae,At(rt))}function Te(rt){return oe=void 0,et&&J?Ye(rt):(J=me=void 0,se)}function Le(){oe!==void 0&&clearTimeout(oe),ge=0,J=ve=me=oe=void 0}function De(){return oe===void 0?se:Te(P())}function at(){var rt=P(),xt=kt(rt);if(J=arguments,me=this,ve=rt,xt){if(oe===void 0)return ct(ve);if(Ge)return oe=setTimeout(ae,q),Ye(ve)}return oe===void 0&&(oe=setTimeout(ae,q)),se}return at.cancel=Le,at.flush=De,at}function N($){var q=typeof $;return!!$&&(q=="object"||q=="function")}function z($){return!!$&&typeof $=="object"}function W($){return typeof $=="symbol"||z($)&&w.call($)==t}function V($){if(typeof $=="number")return $;if(W($))return e;if(N($)){var q=typeof $.valueOf=="function"?$.valueOf():$;$=N(q)?q+"":q}if(typeof $!="string")return $===0?$:+$;$=$.replace(n,"");var te=s.test($);return te||a.test($)?o($.slice(2),te?2:8):i.test($)?e:+$}return cB=D,cB}var cce=lce(),uce=U0(cce),hce=LL(),Zc=U0(hce),N0={exports:{}},zL;function Ace(){if(zL)return N0.exports;zL=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function($,q,te){return Function.prototype.apply.call($,q,te)},t;r&&typeof r.ownKeys=="function"?t=r.ownKeys:Object.getOwnPropertySymbols?t=function($){return Object.getOwnPropertyNames($).concat(Object.getOwnPropertySymbols($))}:t=function($){return Object.getOwnPropertyNames($)};function n(V){console&&console.warn&&console.warn(V)}var i=Number.isNaN||function($){return $!==$};function s(){s.init.call(this)}N0.exports=s,N0.exports.once=N,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(V){if(typeof V!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof V)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(V){if(typeof V!="number"||V<0||i(V))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+V+".");a=V}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function($){if(typeof $!="number"||$<0||i($))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+$+".");return this._maxListeners=$,this};function u(V){return V._maxListeners===void 0?s.defaultMaxListeners:V._maxListeners}s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function($){for(var q=[],te=1;te<arguments.length;te++)q.push(arguments[te]);var J=$==="error",me=this._events;if(me!==void 0)J=J&&me.error===void 0;else if(!J)return!1;if(J){var xe;if(q.length>0&&(xe=q[0]),xe instanceof Error)throw xe;var se=new Error("Unhandled error."+(xe?" ("+xe.message+")":""));throw se.context=xe,se}var oe=me[$];if(oe===void 0)return!1;if(typeof oe=="function")e(oe,this,q);else for(var ve=oe.length,ge=M(oe,ve),te=0;te<ve;++te)e(ge[te],this,q);return!0};function d(V,$,q,te){var J,me,xe;if(o(q),me=V._events,me===void 0?(me=V._events=Object.create(null),V._eventsCount=0):(me.newListener!==void 0&&(V.emit("newListener",$,q.listener?q.listener:q),me=V._events),xe=me[$]),xe===void 0)xe=me[$]=q,++V._eventsCount;else if(typeof xe=="function"?xe=me[$]=te?[q,xe]:[xe,q]:te?xe.unshift(q):xe.push(q),J=u(V),J>0&&xe.length>J&&!xe.warned){xe.warned=!0;var se=new Error("Possible EventEmitter memory leak detected. "+xe.length+" "+String($)+" listeners added. Use emitter.setMaxListeners() to increase limit");se.name="MaxListenersExceededWarning",se.emitter=V,se.type=$,se.count=xe.length,n(se)}return V}s.prototype.addListener=function($,q){return d(this,$,q,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function($,q){return d(this,$,q,!0)};function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(V,$,q){var te={fired:!1,wrapFn:void 0,target:V,type:$,listener:q},J=p.bind(te);return J.listener=q,te.wrapFn=J,J}s.prototype.once=function($,q){return o(q),this.on($,_(this,$,q)),this},s.prototype.prependOnceListener=function($,q){return o(q),this.prependListener($,_(this,$,q)),this},s.prototype.removeListener=function($,q){var te,J,me,xe,se;if(o(q),J=this._events,J===void 0)return this;if(te=J[$],te===void 0)return this;if(te===q||te.listener===q)--this._eventsCount===0?this._events=Object.create(null):(delete J[$],J.removeListener&&this.emit("removeListener",$,te.listener||q));else if(typeof te!="function"){for(me=-1,xe=te.length-1;xe>=0;xe--)if(te[xe]===q||te[xe].listener===q){se=te[xe].listener,me=xe;break}if(me<0)return this;me===0?te.shift():P(te,me),te.length===1&&(J[$]=te[0]),J.removeListener!==void 0&&this.emit("removeListener",$,se||q)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function($){var q,te,J;if(te=this._events,te===void 0)return this;if(te.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):te[$]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete te[$]),this;if(arguments.length===0){var me=Object.keys(te),xe;for(J=0;J<me.length;++J)xe=me[J],xe!=="removeListener"&&this.removeAllListeners(xe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(q=te[$],typeof q=="function")this.removeListener($,q);else if(q!==void 0)for(J=q.length-1;J>=0;J--)this.removeListener($,q[J]);return this};function w(V,$,q){var te=V._events;if(te===void 0)return[];var J=te[$];return J===void 0?[]:typeof J=="function"?q?[J.listener||J]:[J]:q?D(J):M(J,J.length)}s.prototype.listeners=function($){return w(this,$,!0)},s.prototype.rawListeners=function($){return w(this,$,!1)},s.listenerCount=function(V,$){return typeof V.listenerCount=="function"?V.listenerCount($):v.call(V,$)},s.prototype.listenerCount=v;function v(V){var $=this._events;if($!==void 0){var q=$[V];if(typeof q=="function")return 1;if(q!==void 0)return q.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function M(V,$){for(var q=new Array($),te=0;te<$;++te)q[te]=V[te];return q}function P(V,$){for(;$+1<V.length;$++)V[$]=V[$+1];V.pop()}function D(V){for(var $=new Array(V.length),q=0;q<$.length;++q)$[q]=V[q].listener||V[q];return $}function N(V,$){return new Promise(function(q,te){function J(xe){V.removeListener($,me),te(xe)}function me(){typeof V.removeListener=="function"&&V.removeListener("error",J),q([].slice.call(arguments))}W(V,$,me,{once:!0}),$!=="error"&&z(V,J,{once:!0})})}function z(V,$,q){typeof V.on=="function"&&W(V,"error",$,q)}function W(V,$,q,te){if(typeof V.on=="function")te.once?V.once($,q):V.on($,q);else if(typeof V.addEventListener=="function")V.addEventListener($,function J(me){te.once&&V.removeEventListener($,J),q(me)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof V)}return N0.exports}var fce=Ace();const HL={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};var pm={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},errorNoResults:{en:"No results found",de:"Keine Ergebnisse gefunden"},errorConnectionFailed:{en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen"}};const dce=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;class pce{constructor(e,t){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:n=>n.text!==void 0?n.text:n.place_name,render:function(n){if(!n.geometry){const s=n.text,a=s.toLowerCase().indexOf(this.query.toLowerCase()),o=this.query.length,u=s.substring(0,a),d=s.substring(a,a+o),p=s.substring(a+o);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+u+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+d+"</span>"+p+"</div></div></div>"}const i=n.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+i[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+i.splice(1,i.length).join(",")+"</div></div></div>"},popupRender:n=>{const i=n.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+i[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+i.splice(1,i.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new fce.EventEmitter,this.options=Zc({},this.options,t),this.fresh=!0,this.lastSelected=null,this.geocoderApi=e}addTo(e){function t(n,i){if(!document.body.contains(i))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const s=n.onAdd();i.appendChild(s)}if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const n=document.querySelectorAll(e);if(n.length===0)throw new Error("Element "+e+"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,n[0])}else if("addControl"in e)e.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);const t=this.container=document.createElement("div");t.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";const n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",uce(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);const i=document.createElement("div");i.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";const s=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(s),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),i.appendChild(this._clearEl),i.appendChild(this._loadingEl),t.appendChild(n),t.appendChild(this._inputEl),t.appendChild(i),this._typeahead=new nce(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t}createIcon(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");if(n.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+e),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width","18"),n.setAttribute("height","18"),"innerHTML"in n)n.innerHTML=t;else{const i=document.createElement("div");i.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";const s=i.firstChild,a=s.firstChild;n.appendChild(a)}return n}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(e){const t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)}_onKeyDown(e){if(e.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();const s=this._inputEl.value;if(!s)return this.fresh=!0,e.keyCode!==9&&this.clear(e),this._clearEl.style.display="none";if(!(e.metaKey||[9,27,37,39,38,40].indexOf(e.keyCode)!==-1)){if(e.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(s);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(s,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}s.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(s)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()}_onChange(){const e=this._typeahead.selected;if(e&&!e.geometry)e.placeId?this._geocode(e.placeId,!0,!0):this._geocode(e.text,!0);else if(e&&JSON.stringify(e)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let t;if(this._removeResultMarkers(),e.properties&&HL[e.properties.short_code])t=Zc({},this.options.flyTo),this._map&&this._map.fitBounds(HL[e.properties.short_code].bbox,t);else if(e.bbox){const n=e.bbox;t=Zc({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],t)}else{const n={zoom:this.options.zoom};t=Zc({},n,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:e})}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((n,i)=>(this.options[i]&&(["countries","types","language"].indexOf(i)>-1?n[i]=this.options[i].split(/[\s,]+/):n[i]=this.options[i],i==="proximity"&&this.options[i]&&typeof this.options[i].longitude=="number"&&typeof this.options[i].latitude=="number"&&(n[i]=[this.options[i].longitude,this.options[i].latitude])),n),{})}_geocode(e){return nB(this,arguments,void 0,function(t){var n=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){n._loadingEl.style.display="block",n._eventEmitter.emit("loading",{query:t});const a=n._getConfigForRequest(),o=n._createGeocodeRequest(a,t,i,s),u=n.options.localGeocoder?n.options.localGeocoder(t)||[]:[];try{const d=yield o;yield n._handleGeocodeResponse(d,a,t,i,u)}catch(d){n._handleGeocodeErrorResponse(d,u)}return o}()})}_createGeocodeRequest(e,t,n,i){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&dce.test(t)?this._createReverseGeocodeRequest(t,e):(e.query=t,this.geocoderApi.getSuggestions?n?this.geocoderApi.searchByPlaceId&&i?this.geocoderApi.searchByPlaceId(e):this.geocoderApi.forwardGeocode(e):this.geocoderApi.getSuggestions(e):this.geocoderApi.forwardGeocode(e))}_createReverseGeocodeRequest(e,t){const n=e.split(/[\s(,)?]+/).map(i=>parseFloat(i)).reverse();return t.query=n,t.limit=1,"proximity"in t&&delete t.proximity,this.geocoderApi.reverseGeocode(t)}_handleGeocodeResponse(e,t,n,i,s){return nB(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let a={};e?a=e:a={type:"FeatureCollection",features:[]},a.config=t,this.fresh&&(this.fresh=!1),a.features=a.features?s.concat(a.features):s;const o=this.options.externalGeocoder?this.options.externalGeocoder(n,a.features,t)||Promise.resolve([]):Promise.resolve([]);try{const d=yield o;a.features=a.features?d.concat(a.features):d}catch{}this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter));let u=[];"suggestions"in a?u=a.suggestions:"place"in a?u=[a.place]:u=a.features,u.length?(this._clearEl.style.display="block",this._typeahead.update(u),(!this.options.showResultsWhileTyping||i)&&this.options.showResultMarkers&&(a.features.length>0||"place"in a)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",a)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))})}_handleGeocodeErrorResponse(e,t){this._loadingEl.style.display="none",t.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(t)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:t}),this._eventEmitter.emit("error",{error:e})}_clear(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(e){this._clear(e),this._inputEl.focus()}_clearOnBlur(e){e.relatedTarget&&this._clear(e)}_onQueryResult(e){if(!("features"in e)||!e.features.length)return;const t=e.features[0];this._typeahead.selected=t,this._inputEl.value=t.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){const e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(e){return nB(this,void 0,void 0,function*(){const t=yield this._geocode(e);this._onQueryResult(t)})}_renderError(){const e=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(e)}_renderNoResults(){const e=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(e)}_renderMessage(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)}_localize(e){const t=ace.language(this.options.language.split(",")[0]);return this.options.language&&(pm!=null&&pm[e][t])?pm[e][t]:pm[e].en}_fitBoundsForMarkers(){if(this._typeahead.data.length<1)return;const e=this._typeahead.data.filter(t=>typeof t!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){const n=Zc({},{padding:100},this.options.flyTo),i=new this._maplibregl.LngLatBounds;for(const s of e)i.extend(s.geometry.coordinates);this._map.fitBounds(i,n)}return e.length>0&&this._maplibregl&&this._handleResultMarkers(e),this}setInput(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e),this}setProximity(e){return this.options.proximity=e,this}getProximity(){return this.options.proximity}setRenderFunction(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this}getRenderFunction(){return this._typeahead.render}setLanguage(e){return this.options.language=e||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(e){return this.options.zoom=e,this}getFlyTo(){return this.options.flyTo}setFlyTo(e){return this.options.flyTo=e,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(e){return this.placeholder=e||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this}getBbox(){return this.options.bbox}setBbox(e){return this.options.bbox=e,this}getCountries(){return this.options.countries}setCountries(e){return this.options.countries=e,this}getTypes(){return this.options.types}setTypes(e){return this.options.types=e,this}getMinLength(){return this.options.minLength}setMinLength(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this}getLimit(){return this.options.limit}setLimit(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this}getFilter(){return this.options.filter}setFilter(e){return this.options.filter=e,this}setGeocoderApi(e){return this.geocoderApi=e,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(e){if(!this._map)return;this._removeMarker();const n=Zc({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(n);let i;if(this.options.popup){const a=Zc({},{},this.options.popup);i=new this._maplibregl.Popup(a).setHTML(this.options.popupRender(e))}return e.center?(this.mapMarker.setLngLat(e.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(e){if(!this._map)return;this._removeResultMarkers();let n=Zc({},{color:"#4668F2"},this.options.showResultMarkers);for(const i of e){let s;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(s=this.options.showResultMarkers.element.cloneNode(!0),n=Zc(n,{element:s}));const a=new this._maplibregl.Marker(Zc({},n,{element:s}));let o;if(this.options.popup){const d=Zc({},{},this.options.popup);o=new this._maplibregl.Popup(d).setHTML(this.options.popupRender(i))}i.center?(a.setLngLat(i.center).addTo(this._map),this.options.popup&&a.setPopup(o)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(a.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&a.setPopup(o)),this.resultMarkers.push(a)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(e){e.remove()}),this.resultMarkers=[])}on(e,t){return this._eventEmitter.on(e,t),this}once(e){return new Promise(t=>{this._eventEmitter.once(e,t)})}off(e,t){return this._eventEmitter.removeListener(e,t),this}}const Wf={defaultOptions:JSON.parse('{"limitsUrl":"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json","geocoder":{"peliasUrl1":"https://eines.icgc.cat/geocodificador/autocompletar?text=","peliasUrl2":"&layers=topo1%2Ctopo2%2Caddress&size=5"},"mapOptions":{"container":"map","center":{"0":1.537786,"1":41.837539},"zoom":7.5,"bearing":0,"pitch":0,"hash":false,"style":"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json.json","maxZoom":18,"maxPitch":85},"logoIcgcOptions":{"logoUrlColor":"https://eines.icgc.cat/recursos/logos/icgc_logo_color.png","logoUrlWhite":"https://eines.icgc.cat/recursos/logos/icgc_logo_blanc.svg","logoLink":"https://www.icgc.cat","logoTitle":"Institut Cartogràfic i Geològic de Catalunya","logoWidth":100,"logoOpacity":0.6},"logoGencatOptions":{"logoUrlColor":"https://eines.icgc.cat/recursos/logos/gencat_logo_color.png","logoUrlWhite":"https://eines.icgc.cat/recursos/logos/gencat_logo_blanc.png","logoLink":"https://web.gencat.cat/","logoTitle":"Generalitat de Catalunya","logoWidth":100,"logoOpacity":0.6},"map3dOptions":{"spaceErrorFactor":2,"exaggeration":1,"zfactor":48,"minZoomRange":15.5,"maxZoomRange":22,"urlTilesetCities":"https://geoserveis.icgc.cat/servei/catalunya/ciutats/3dtiles/v1/tilesetV1.0.json","layerIdOrder":"place-isolated","sourceLayerFilterId":"place","minZoomFilter":14,"layerId3d":"edificisMapboxLayer","terrainSource":"ICGC5M","style3dName":"orto3d","imageIcon":"https://eines.icgc.cat/recursos//images/stick.png"},"baseStyles":[{"key":"TOPO","url":"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{"key":"ORTO","url":"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{"key":"ORTO3D","url":"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{"key":"ORTOHYBRID","url":"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{"key":"ADMIN","url":"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{"key":"DARK","url":"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{"key":"LIGHT","url":"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{"key":"GEOLOGY","url":"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"},{"key":"RASTER","substyles":{"TOPO":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo.jpg"},"ADMIN":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_administratiu.jpg"},"LIGHT":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo_gris.jpg"},"STANDARD":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_estandard_0.jpg"},"Simplified":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_simplificat.jpg"},"ORTO":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto.jpg"},"ORTOGREY":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_gris.jpg"},"ORTOHYBRID":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_hibida.jpg"}}}],"urlTerrainICGC":[{"name":"ICGC5M","url":"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{"name":"WORLD30M","url":"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png","encoding":"terrarium"}],"ortoLayersICGC":[{"name":"ortofotoColorProvisional","key":"ortofoto_color_provisional","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{"name":"ortofotoColor2023","key":"ortofoto_color_2023","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023"},{"name":"ortofotoColor2022","key":"ortofoto_color_2022","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{"name":"ortofotoColor2021","key":"ortofoto_color_2021","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{"name":"ortofotoColor2020","key":"ortofoto_color_2020","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{"name":"ortofotoColor2019","key":"ortofoto_color_2019","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{"name":"ortofotoColor2018","key":"ortofoto_color_2018","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{"name":"ortofotoColor2017","key":"ortofoto_color_2017","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{"name":"ortofotoColor2016","key":"ortofoto_color_2016","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{"name":"ortofotoColor2015","key":"ortofoto_color_2015","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{"name":"ortofotoColor2014","key":"ortofoto_color_2014","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{"name":"ortofotoColor2013","key":"ortofoto_color_2013","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{"name":"ortofotoColor2012","key":"ortofoto_color_2012","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{"name":"ortofotoColor2011","key":"ortofoto_color_2011","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{"name":"ortofotoColor2010","key":"ortofoto_color_2010","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{"name":"ortofotoColor2009","key":"ortofoto_color_2009","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{"name":"ortofotoColor2008","key":"ortofoto_color_2008","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{"name":"ortofotoColor20062007","key":"ortofoto_color_2006-2007","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{"name":"ortofotoColor20042005","key":"ortofoto_color_2004-2005","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{"name":"ortofotoColor20002003","key":"ortofoto_color_2000-2003","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{"name":"ortofotoBlancINegre1998","key":"ortofoto_blanc_i_negre_1998","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{"name":"ortofotoBlancINegre19941997","key":"ortofoto_blanc_i_negre_1994-1997","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{"name":"ortofotoColor1993","key":"ortofoto_color_1993","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{"name":"ortofotoBlancINegre19831992","key":"ortofoto_blanc_i_negre_1983-1992","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{"name":"ortofotoBlancINegre19701977","key":"ortofoto_blanc_i_negre_1970-1977","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{"name":"ortofotoBlancINegre1956","key":"ortofoto_blanc_i_negre_1956","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{"name":"ortofotoBlancINegre1945","key":"ortofoto_blanc_i_negre_1945","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{"name":"ortofotoColorSerieAnual","key":"ortofoto_color_serie_anual","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{"name":"ortofotoInfraroigProvisional","key":"ortofoto_infraroig_provisional","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{"name":"ortofotoInfraroig2023","key":"ortofoto_infraroig_2023","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023"},{"name":"ortofotoInfraroig2022","key":"ortofoto_infraroig_2022","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{"name":"ortofotoInfraroig2021","key":"ortofoto_infraroig_2021","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{"name":"ortofotoInfraroig2020","key":"ortofoto_infraroig_2020","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{"name":"ortofotoInfraroig2019","key":"ortofoto_infraroig_2019","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{"name":"ortofotoInfraroig2018","key":"ortofoto_infraroig_2018","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{"name":"ortofotoInfraroig2017","key":"ortofoto_infraroig_2017","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{"name":"ortofotoInfraroig2016","key":"ortofoto_infraroig_2016","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{"name":"ortofotoInfraroig2015","key":"ortofoto_infraroig_2015","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{"name":"ortofotoInfraroig2014","key":"ortofoto_infraroig_2014","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{"name":"ortofotoInfraroig2013","key":"ortofoto_infraroig_2013","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{"name":"ortofotoInfraroig2012","key":"ortofoto_infraroig_2012","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{"name":"ortofotoInfraroig2011","key":"ortofoto_infraroig_2011","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{"name":"ortofotoInfraroig2010","key":"ortofoto_infraroig_2010","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{"name":"ortofotoInfraroig2009","key":"ortofoto_infraroig_2009","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{"name":"ortofotoInfraroig2008","key":"ortofoto_infraroig_2008","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{"name":"ortofotoInfraroig20062007","key":"ortofoto_infraroig_2006-2007","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{"name":"ortofotoInfraroig19961997","key":"ortofoto_infraroig_1996-1997","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{"name":"ortofotoInfraroigSerieAnual","key":"ortofoto_infraroig_serie_anual","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],"vectorLayersICGC":[{"name":"agrupacionsCensals2015","key":"agrupacions_censals_2015"},{"name":"agrupacionsCensals2016","key":"agrupacions_censals_2016"},{"name":"agrupacionsCensals2017","key":"agrupacions_censals_2017"},{"name":"agrupacionsCensals2018","key":"agrupacions_censals_2018"},{"name":"agrupacionsCensals2019","key":"agrupacions_censals_2019"},{"name":"agrupacionsCensals2020","key":"agrupacions_censals_2020"},{"name":"agrupacionsCensals2021","key":"agrupacions_censals_2021"},{"name":"agrupacionsCensalsVigent","key":"agrupacions_censals_vigent"},{"name":"agrupacionsCensalsVigentText","key":"agrupacions_censals_vigent_text"},{"name":"areesBasiquesPolicials2019","key":"arees_basiques_policials_2019"},{"name":"areesBasiquesPolicials2020","key":"arees_basiques_policials_2020"},{"name":"areesBasiquesPolicials2022","key":"arees_basiques_policials_2022"},{"name":"areesBasiquesPolicialsVigent","key":"arees_basiques_policials_vigent"},{"name":"areesBasiquesPolicialsVigentText","key":"arees_basiques_policials_vigent_text"},{"name":"areesBasiquesSalutVigent","key":"arees_basiques_salut_vigent"},{"name":"areesBasiquesServeisSocialsVigent","key":"arees_basiques_serveis_socials_vigent"},{"name":"areesBasiquesServeisSocialsVigentText","key":"arees_basiques_serveis_socials_vigent_text"},{"name":"areesGestioAssistencialVigent","key":"arees_gestio_assistencial_vigent"},{"name":"areesHidrogeologiquesAquifersVigent","key":"arees_hidrogeologiques_aquifers_vigent"},{"name":"catalunyaVigent","key":"catalunya_vigent"},{"name":"catalunyaVigentText","key":"catalunya_vigent_text"},{"name":"comarques2022","key":"comarques_2022"},{"name":"comarquesVigent","key":"comarques_vigent"},{"name":"comarquesVigentText","key":"comarques_vigent_text"},{"name":"districtesCensals2015","key":"districtes_censals_2015"},{"name":"districtesCensals2016","key":"districtes_censals_2016"},{"name":"districtesCensals2017","key":"districtes_censals_2017"},{"name":"districtesCensals2018","key":"districtes_censals_2018"},{"name":"districtesCensals2019","key":"districtes_censals_2019"},{"name":"districtesCensals2020","key":"districtes_censals_2020"},{"name":"districtesCensals2021","key":"districtes_censals_2021"},{"name":"districtesCensals2022","key":"districtes_censals_2022"},{"name":"districtesCensals2023","key":"districtes_censals_2023"},{"name":"districtesCensalsVigent","key":"districtes_censals_vigent"},{"name":"districtesCensalsVigentText","key":"districtes_censals_vigent_text"},{"name":"incendisForestalsVigent","key":"incendis_forestals_vigent"},{"name":"incendisForestalsVigentText","key":"incendis_forestals_vigent_text"},{"name":"municipis2022","key":"municipis_2022"},{"name":"municipis2022Text","key":"municipis_2022_text"},{"name":"municipisVigent","key":"municipis_vigent"},{"name":"municipisVigentText","key":"municipis_vigent_text"},{"name":"partitsJudicialsVigent","key":"partits_judicials_vigent"},{"name":"partitsJudicialsVigentText","key":"partits_judicials_vigent_text"},{"name":"plaTerritorial2015","key":"pla_territorial_2015"},{"name":"plaTerritorialVigent","key":"pla_territorial_vigent"},{"name":"plaTerritorialVigentText","key":"pla_territorial_vigent_text"},{"name":"provinciesVigent","key":"provincies_vigent"},{"name":"provinciesVigentText","key":"provincies_vigent_text"},{"name":"regionsPolicialsVigent","key":"regions_policials_vigent"},{"name":"regionsPolicialsVigentText","key":"regions_policials_vigent_text"},{"name":"regionsSanitariesVigent","key":"regions_sanitaries_vigent"},{"name":"regionsSanitariesVigentText","key":"regions_sanitaries_vigent_text"},{"name":"seccionsCensals2015","key":"seccions_censals_2015"},{"name":"seccionsCensals2016","key":"seccions_censals_2016"},{"name":"seccionsCensals2017","key":"seccions_censals_2017"},{"name":"seccionsCensals2018","key":"seccions_censals_2018"},{"name":"seccionsCensals2019","key":"seccions_censals_2019"},{"name":"seccionsCensals2020","key":"seccions_censals_2020"},{"name":"seccionsCensals2021","key":"seccions_censals_2021"},{"name":"seccionsCensals2022","key":"seccions_censals_2022"},{"name":"seccionsCensals2023","key":"seccions_censals_2023"},{"name":"seccionsCensalsVigent","key":"seccions_censals_vigent"},{"name":"seccionsCensalsVigentText","key":"seccions_censals_vigent_text"},{"name":"sectorsSanitarisVigent","key":"sectors_sanitaris_vigent"},{"name":"vegueriesVigent","key":"vegueries_vigent"},{"name":"vegueriesVigentText","key":"vegueries_vigent_text"}],"vectorLayers":[{"key":"cobertes2018","url":"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json","legend":"https://eines.icgc.cat/recursos//images/llegendaCobertesSol2018.jpg"}],"wmsLayers":[{"key":"espaisInteresGeologic","layer":"","url":"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{"key":"gravimetriaBouguer500000","layer":"","url":"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{"key":"cobertesSol2018","layer":"","url":"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{"key":"administratiu","layer":"","url":"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{"key":"simplificat","layer":"","url":"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{"key":"cims","layer":"","url":"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{"key":"cobertesSol","layer":"","url":"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],"fgbLayers":[{"name":"agrupacionsCensalsVigent","key":"agrupacions_censals_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{"name":"agrupacionsCensalsVigentText","key":"agrupacions_censals_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{"name":"areesBasiquesPolicialsVigent","key":"arees_basiques_policials_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{"name":"areesBasiquesPolicialsVigentText","key":"arees_basiques_policials_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{"name":"areesBasiquesSalutVigent","key":"arees_basiques_salut_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{"name":"areesBasiquesServeisSocialsVigent","key":"arees_basiques_serveis_socials_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{"name":"areesBasiquesServeisSocialsVigentText","key":"arees_basiques_serveis_socials_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{"name":"areesGestioAssistencialVigent","key":"arees_gestio_assistencial_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{"name":"areesHidrogeologiquesAquifersVigent","key":"arees_hidrogeologiques_aquifers_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{"name":"catalunyaVigent","key":"catalunya_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{"name":"catalunyaVigentText","key":"catalunya_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{"name":"comarquesVigent","key":"comarques_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{"name":"comarquesVigentText","key":"comarques_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{"name":"districtesCensalsVigent","key":"districtes_censals_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{"name":"districtesCensalsVigentText","key":"districtes_censals_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{"name":"incendisForestalsVigent","key":"incendis_forestals_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{"name":"incendisForestalsVigentText","key":"incendis_forestals_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{"name":"municipisVigent","key":"municipis_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{"name":"municipisVigentText","key":"municipis_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{"name":"partitsJudicialsVigent","key":"partits_judicials_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{"name":"partitsJudicialsVigentText","key":"partits_judicials_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{"name":"plaTerritorialVigent","key":"pla_territorial_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{"name":"plaTerritorialVigentText","key":"pla_territorial_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{"name":"provinciesVigent","key":"provincies_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{"name":"provinciesVigentText","key":"provincies_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{"name":"regionsPolicialsVigent","key":"regions_policials_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{"name":"regionsPolicialsVigentText","key":"regions_policials_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{"name":"regionsSanitariesVigent","key":"regions_sanitaries_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{"name":"regionsSanitariesVigentText","key":"regions_sanitaries_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{"name":"seccionsCensalsVigent","key":"seccions_censals_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{"name":"seccionsCensalsVigentText","key":"seccions_censals_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{"name":"sectorsSanitarisVigent","key":"sectors_sanitaris_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{"name":"vegueriesVigent","key":"vegueries_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{"name":"vegueriesVigentText","key":"vegueries_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]}'),Styles:{TOPO:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",ORTO:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",ORTO3D:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",ORTOHYBRID:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",ADMIN:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",DARK:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",RASTER:{TOPO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",ADMIN:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",LIGHT:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",STANDARD:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",SIMPLIFIED:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",ORTO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",ORTOGREY:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",ORTOHYBRID:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png"}},Terrains:{ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Layers:JSON.parse('{"Orto":{"ortofotoColorProvisional":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional","ortofotoColor2023":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023","ortofotoColor2022":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022","ortofotoColor2021":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021","ortofotoColor2020":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020","ortofotoColor2019":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019","ortofotoColor2018":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018","ortofotoColor2017":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017","ortofotoColor2016":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016","ortofotoColor2015":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015","ortofotoColor2014":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014","ortofotoColor2013":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013","ortofotoColor2012":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012","ortofotoColor2011":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011","ortofotoColor2010":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010","ortofotoColor2009":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009","ortofotoColor2008":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008","ortofotoColor20062007":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007","ortofotoColor20042005":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005","ortofotoColor20002003":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003","ortofotoBlancINegre1998":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998","ortofotoBlancINegre19941997":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997","ortofotoColor1993":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993","ortofotoBlancINegre19831992":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992","ortofotoBlancINegre19701977":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977","ortofotoBlancINegre1956":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956","ortofotoBlancINegre1945":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945","ortofotoColorSerieAnual":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual","ortofotoInfraroigProvisional":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional","ortofotoInfraroig2023":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023","ortofotoInfraroig2022":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022","ortofotoInfraroig2021":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021","ortofotoInfraroig2020":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020","ortofotoInfraroig2019":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019","ortofotoInfraroig2018":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018","ortofotoInfraroig2017":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017","ortofotoInfraroig2016":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016","ortofotoInfraroig2015":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015","ortofotoInfraroig2014":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014","ortofotoInfraroig2013":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013","ortofotoInfraroig2012":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012","ortofotoInfraroig2011":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011","ortofotoInfraroig2010":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010","ortofotoInfraroig2009":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009","ortofotoInfraroig2008":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008","ortofotoInfraroig20062007":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007","ortofotoInfraroig19961997":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997","ortofotoInfraroigSerieAnual":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},"VectorAdmin":{"agrupacionsCensals2015":"agrupacions_censals_2015","agrupacionsCensals2016":"agrupacions_censals_2016","agrupacionsCensals2017":"agrupacions_censals_2017","agrupacionsCensals2018":"agrupacions_censals_2018","agrupacionsCensals2019":"agrupacions_censals_2019","agrupacionsCensals2020":"agrupacions_censals_2020","agrupacionsCensals2021":"agrupacions_censals_2021","agrupacionsCensalsVigent":"agrupacions_censals_vigent","agrupacionsCensalsVigentText":"agrupacions_censals_vigent_text","areesBasiquesPolicials2019":"arees_basiques_policials_2019","areesBasiquesPolicials2020":"arees_basiques_policials_2020","areesBasiquesPolicials2022":"arees_basiques_policials_2022","areesBasiquesPolicialsVigent":"arees_basiques_policials_vigent","areesBasiquesPolicialsVigentText":"arees_basiques_policials_vigent_text","areesBasiquesSalutVigent":"arees_basiques_salut_vigent","areesBasiquesServeisSocialsVigent":"arees_basiques_serveis_socials_vigent","areesBasiquesServeisSocialsVigentText":"arees_basiques_serveis_socials_vigent_text","areesGestioAssistencialVigent":"arees_gestio_assistencial_vigent","areesHidrogeologiquesAquifersVigent":"arees_hidrogeologiques_aquifers_vigent","catalunyaVigent":"catalunya_vigent","catalunyaVigentText":"catalunya_vigent_text","comarques2022":"comarques_2022","comarquesVigent":"comarques_vigent","comarquesVigentText":"comarques_vigent_text","districtesCensals2015":"districtes_censals_2015","districtesCensals2016":"districtes_censals_2016","districtesCensals2017":"districtes_censals_2017","districtesCensals2018":"districtes_censals_2018","districtesCensals2019":"districtes_censals_2019","districtesCensals2020":"districtes_censals_2020","districtesCensals2021":"districtes_censals_2021","districtesCensals2022":"districtes_censals_2022","districtesCensals2023":"districtes_censals_2023","districtesCensalsVigent":"districtes_censals_vigent","districtesCensalsVigentText":"districtes_censals_vigent_text","incendisForestalsVigent":"incendis_forestals_vigent","incendisForestalsVigentText":"incendis_forestals_vigent_text","municipis2022":"municipis_2022","municipis2022Text":"municipis_2022_text","municipisVigent":"municipis_vigent","municipisVigentText":"municipis_vigent_text","partitsJudicialsVigent":"partits_judicials_vigent","partitsJudicialsVigentText":"partits_judicials_vigent_text","plaTerritorial2015":"pla_territorial_2015","plaTerritorialVigent":"pla_territorial_vigent","plaTerritorialVigentText":"pla_territorial_vigent_text","provinciesVigent":"provincies_vigent","provinciesVigentText":"provincies_vigent_text","regionsPolicialsVigent":"regions_policials_vigent","regionsPolicialsVigentText":"regions_policials_vigent_text","regionsSanitariesVigent":"regions_sanitaries_vigent","regionsSanitariesVigentText":"regions_sanitaries_vigent_text","seccionsCensals2015":"seccions_censals_2015","seccionsCensals2016":"seccions_censals_2016","seccionsCensals2017":"seccions_censals_2017","seccionsCensals2018":"seccions_censals_2018","seccionsCensals2019":"seccions_censals_2019","seccionsCensals2020":"seccions_censals_2020","seccionsCensals2021":"seccions_censals_2021","seccionsCensals2022":"seccions_censals_2022","seccionsCensals2023":"seccions_censals_2023","seccionsCensalsVigent":"seccions_censals_vigent","seccionsCensalsVigentText":"seccions_censals_vigent_text","sectorsSanitarisVigent":"sectors_sanitaris_vigent","vegueriesVigent":"vegueries_vigent","vegueriesVigentText":"vegueries_vigent_text"},"FGBAdmin":{"agrupacionsCensalsVigent":"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb","agrupacionsCensalsVigentText":"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb","areesBasiquesPolicialsVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb","areesBasiquesPolicialsVigentText":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb","areesBasiquesSalutVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb","areesBasiquesServeisSocialsVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb","areesBasiquesServeisSocialsVigentText":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb","areesGestioAssistencialVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb","areesHidrogeologiquesAquifersVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb","catalunyaVigent":"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb","catalunyaVigentText":"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb","comarquesVigent":"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb","comarquesVigentText":"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb","districtesCensalsVigent":"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb","districtesCensalsVigentText":"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb","incendisForestalsVigent":"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb","incendisForestalsVigentText":"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb","municipisVigent":"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb","municipisVigentText":"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb","partitsJudicialsVigent":"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb","partitsJudicialsVigentText":"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb","plaTerritorialVigent":"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb","plaTerritorialVigentText":"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb","provinciesVigent":"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb","provinciesVigentText":"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb","regionsPolicialsVigent":"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb","regionsPolicialsVigentText":"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb","regionsSanitariesVigent":"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb","regionsSanitariesVigentText":"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb","seccionsCensalsVigent":"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb","seccionsCensalsVigentText":"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb","sectorsSanitarisVigent":"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb","vegueriesVigent":"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb","vegueriesVigentText":"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},"Vector":{"cobertes2018":"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},"WMS":{"espaisInteresGeologic":"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}","gravimetriaBouguer500000":"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}","cobertesSol2018":"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}","administratiu":"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png","simplificat":"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png","cims":"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455","cobertesSol":"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}}')};class gce{constructor(e){this.options=e||{}}onAdd(e){let t=Wf.defaultOptions;return this._map=e,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?t.logoIcgcOptions.logoUrlColor:t.logoIcgcOptions.logoUrlWhite,this._img1.width=t.logoIcgcOptions.logoWidth,this._img1.title=t.logoIcgcOptions.logoTitle,this._img1.style.opacity=t.logoIcgcOptions.logoOpacity,this.link1=document.createElement("a"),this.link1.href=t.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${t.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?t.logoGencatOptions.logoUrlColor:t.logoGencatOptions.logoUrlWhite,this._img2.width=t.logoGencatOptions.logoWidth,this._img2.title=t.logoGencatOptions.logoTitle,this._img2.style.opacity=t.logoGencatOptions.logoOpacity,this.link2=document.createElement("a"),this.link2.href=t.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${t.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class mce{constructor(e){this.options=e||{}}onAdd(e){this._map=e,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const t=document.createElement("label");return t.classList.add("maplibregl-legend-title-label"),t.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(t),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var uB,VL;function _ce(){if(VL)return uB;VL=1;var r=t.prototype,e="WGS 84";function t(i){i!==void 0&&(e=i),this.setEllipsoid(e)}r.convertLatLngToUtm=function(i,s,a){var o;if(this.status)return"No ecclipsoid data associated with unknown datum: "+e;if(!Number.isInteger(a))return"Precision is not integer number.";i=parseFloat(i),s=parseFloat(s);var u=s,d=this.toRadians(i),p=this.toRadians(u);u>=8&&u<=13&&i>54.5&&i<58||i>=56&&i<64&&u>=3&&u<12?o=32:(o=(u+180)/6+1,i>=72&&i<84&&(u>=0&&u<9?o=31:u>=9&&u<21?o=33:u>=21&&u<33?o=35:u>=33&&u<42&&(o=37))),o=parseInt(o);var _=(o-1)*6-180+3,w=this.toRadians(_),v=this.getUtmLetterDesignator(i),M=this.eccSquared/(1-this.eccSquared),P=this.a/Math.sqrt(1-this.eccSquared*Math.sin(d)*Math.sin(d)),D=Math.tan(d)*Math.tan(d),N=M*Math.cos(d)*Math.cos(d),z=Math.cos(d)*(p-w),W=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*d-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*d)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*d)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*d)),V=parseFloat(.9996*P*(z+(1-D+N)*z*z*z/6+(5-18*D+D*D+72*N-58*M)*z*z*z*z*z/120)+5e5),$=parseFloat(.9996*(W+P*Math.tan(d)*(z*z/2+(5-D+9*N+4*N*N)*z*z*z*z/24+(61-58*D+D*D+600*N-330*M)*z*z*z*z*z*z/720)));return i<0&&($+=1e7),$=n($,a),V=n(V,a),{Easting:V,Northing:$,ZoneNumber:parseInt(o),ZoneLetter:v}},r.convertUtmToLatLng=function(i,s,a,o){var u=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),d=i-5e5,p=s,_=a,w=o;if(i===void 0)return"Please pass the UTMEasting!";if(s===void 0)return"Please pass the UTMNorthing!";if(a===void 0)return"Please pass the UTMZoneNumber!";if(o===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(w)!==-1||(p-=1e7);var v=(_-1)*6-180+3,M=this.eccSquared/(1-this.eccSquared),P=p/.9996,D=P/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),N=D+(3*u/2-27*u*u*u/32)*Math.sin(2*D)+(21*u*u/16-55*u*u*u*u/32)*Math.sin(4*D)+151*u*u*u/96*Math.sin(6*D);this.toDegrees(N);var z=this.a/Math.sqrt(1-this.eccSquared*Math.sin(N)*Math.sin(N)),W=Math.tan(N)*Math.tan(N),V=M*Math.cos(N)*Math.cos(N),$=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(N)*Math.sin(N),1.5),q=d/(z*.9996),te=N-z*Math.tan(N)/$*(q*q/2-(5+3*W+10*V-4*V*V-9*M)*q*q*q*q/24+(61+90*W+298*V+45*W*W-252*M-3*V*V)*q*q*q*q*q*q/720);te=this.toDegrees(te);var J=(q-(1+2*W+V)*q*q*q/6+(5-2*V+28*W-3*V*V+8*M+24*W*W)*q*q*q*q*q/120)/Math.cos(N);return J=v+this.toDegrees(J),{lat:te,lng:J}},r.getUtmLetterDesignator=function(i){return i=parseFloat(i),84>=i&&i>=72?"X":72>i&&i>=64?"W":64>i&&i>=56?"V":56>i&&i>=48?"U":48>i&&i>=40?"T":40>i&&i>=32?"S":32>i&&i>=24?"R":24>i&&i>=16?"Q":16>i&&i>=8?"P":8>i&&i>=0?"N":0>i&&i>=-8?"M":-8>i&&i>=-16?"L":-16>i&&i>=-24?"K":-24>i&&i>=-32?"J":-32>i&&i>=-40?"H":-40>i&&i>=-48?"G":-48>i&&i>=-56?"F":-56>i&&i>=-64?"E":-64>i&&i>=-72?"D":-72>i&&i>=-80?"C":"Z"},r.setEllipsoid=function(i){switch(i){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}},r.toDegrees=function(i){return i/Math.PI*180},r.toRadians=function(i){return i*Math.PI/180};function n(i,s){var a=Math.pow(10,s);return Math.round(i*a)/a}return uB=t,uB}var yce=_ce();const bce=Ra(yce);class vce{constructor(e){this.options=e||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(e){const t=new bce;return this._map=e,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",n=>{const i=n.lngLat.lat,s=n.lngLat.lng;let a="",o="";const u=t.convertLatLngToUtm(i,s,2),d=i>0?"N":"S";this.options.utm&&(a=`ETRS89 UTM ${u.ZoneNumber}${d} X:<b> ${u.Easting}</b> Y:<b> ${u.Northing}</b> <br>`),this.options.lonlat&&(o=`WGS 84 Lon:<b> ${s.toFixed(5)}</b>  Lat:<b> ${i.toFixed(5)}</b>`);const p=`${a}${o}`;this._container.innerHTML=p}),this._container}_lookUTM31(e,t){var n=0,i=0,s=6,a=84;return e>=n&&e<=s&&t>=i&&t<=a}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function jL(r,e){return function(){return r.apply(e,arguments)}}const{toString:wce}=Object.prototype,{getPrototypeOf:hB}=Object,k0=(r=>e=>{const t=wce.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Jc=r=>(r=r.toLowerCase(),e=>k0(e)===r),Q0=r=>e=>typeof e===r,{isArray:Mp}=Array,gm=Q0("undefined");function xce(r){return r!==null&&!gm(r)&&r.constructor!==null&&!gm(r.constructor)&&El(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const $L=Jc("ArrayBuffer");function Bce(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&$L(r.buffer),e}const Cce=Q0("string"),El=Q0("function"),qL=Q0("number"),z0=r=>r!==null&&typeof r=="object",Tce=r=>r===!0||r===!1,H0=r=>{if(k0(r)!=="object")return!1;const e=hB(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Ece=Jc("Date"),Sce=Jc("File"),Ice=Jc("Blob"),Mce=Jc("FileList"),Pce=r=>z0(r)&&El(r.pipe),Fce=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||El(r.append)&&((e=k0(r))==="formdata"||e==="object"&&El(r.toString)&&r.toString()==="[object FormData]"))},Rce=Jc("URLSearchParams"),[Lce,Oce,Uce,Dce]=["ReadableStream","Request","Response","Headers"].map(Jc),Nce=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function mm(r,e){let{allOwnKeys:t=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),Mp(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{const s=t?Object.getOwnPropertyNames(r):Object.keys(r),a=s.length;let o;for(n=0;n<a;n++)o=s[n],e.call(null,r[o],o,r)}}function KL(r,e){e=e.toLowerCase();const t=Object.keys(r);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const Xf=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,WL=r=>!gm(r)&&r!==Xf;function AB(){const{caseless:r}=WL(this)&&this||{},e={},t=(n,i)=>{const s=r&&KL(e,i)||i;H0(e[s])&&H0(n)?e[s]=AB(e[s],n):H0(n)?e[s]=AB({},n):Mp(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&mm(arguments[n],t);return e}const kce=function(r,e,t){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return mm(e,(i,s)=>{t&&El(i)?r[s]=jL(i,t):r[s]=i},{allOwnKeys:n}),r},Qce=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),zce=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},Hce=(r,e,t,n)=>{let i,s,a;const o={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)a=i[s],(!n||n(a,r,e))&&!o[a]&&(e[a]=r[a],o[a]=!0);r=t!==!1&&hB(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},Vce=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},jce=r=>{if(!r)return null;if(Mp(r))return r;let e=r.length;if(!qL(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},$ce=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&hB(Uint8Array)),Gce=(r,e)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},qce=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},Kce=Jc("HTMLFormElement"),Wce=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),XL=(r=>{let{hasOwnProperty:e}=r;return(t,n)=>e.call(t,n)})(Object.prototype),Xce=Jc("RegExp"),YL=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};mm(t,(i,s)=>{let a;(a=e(i,s,r))!==!1&&(n[s]=a||i)}),Object.defineProperties(r,n)},Yce=r=>{YL(r,(e,t)=>{if(El(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(El(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Zce=(r,e)=>{const t={},n=i=>{i.forEach(s=>{t[s]=!0})};return Mp(r)?n(r):n(String(r).split(e)),t},Jce=()=>{},eue=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e,fB="abcdefghijklmnopqrstuvwxyz",ZL="0123456789",JL={DIGIT:ZL,ALPHA:fB,ALPHA_DIGIT:fB+fB.toUpperCase()+ZL},tue=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:JL.ALPHA_DIGIT,t="";const{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function rue(r){return!!(r&&El(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const nue=r=>{const e=new Array(10),t=(n,i)=>{if(z0(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const s=Mp(n)?[]:{};return mm(n,(a,o)=>{const u=t(a,i+1);!gm(u)&&(s[o]=u)}),e[i]=void 0,s}}return n};return t(r,0)},iue=Jc("AsyncFunction"),sue=r=>r&&(z0(r)||El(r))&&El(r.then)&&El(r.catch),eO=((r,e)=>r?setImmediate:e?((t,n)=>(Xf.addEventListener("message",i=>{let{source:s,data:a}=i;s===Xf&&a===t&&n.length&&n.shift()()},!1),i=>{n.push(i),Xf.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",El(Xf.postMessage)),oue=typeof queueMicrotask<"u"?queueMicrotask.bind(Xf):typeof process<"u"&&process.nextTick||eO,jt={isArray:Mp,isArrayBuffer:$L,isBuffer:xce,isFormData:Fce,isArrayBufferView:Bce,isString:Cce,isNumber:qL,isBoolean:Tce,isObject:z0,isPlainObject:H0,isReadableStream:Lce,isRequest:Oce,isResponse:Uce,isHeaders:Dce,isUndefined:gm,isDate:Ece,isFile:Sce,isBlob:Ice,isRegExp:Xce,isFunction:El,isStream:Pce,isURLSearchParams:Rce,isTypedArray:$ce,isFileList:Mce,forEach:mm,merge:AB,extend:kce,trim:Nce,stripBOM:Qce,inherits:zce,toFlatObject:Hce,kindOf:k0,kindOfTest:Jc,endsWith:Vce,toArray:jce,forEachEntry:Gce,matchAll:qce,isHTMLForm:Kce,hasOwnProperty:XL,hasOwnProp:XL,reduceDescriptors:YL,freezeMethods:Yce,toObjectSet:Zce,toCamelCase:Wce,noop:Jce,toFiniteNumber:eue,findKey:KL,global:Xf,isContextDefined:WL,ALPHABET:JL,generateString:tue,isSpecCompliantForm:rue,toJSONObject:nue,isAsyncFn:iue,isThenable:sue,setImmediate:eO,asap:oue};function Tn(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}jt.inherits(Tn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:jt.toJSONObject(this.config),code:this.code,status:this.status}}});const tO=Tn.prototype,rO={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{rO[r]={value:r}}),Object.defineProperties(Tn,rO),Object.defineProperty(tO,"isAxiosError",{value:!0}),Tn.from=(r,e,t,n,i,s)=>{const a=Object.create(tO);return jt.toFlatObject(r,a,function(u){return u!==Error.prototype},o=>o!=="isAxiosError"),Tn.call(a,r.message,e,t,n,i),a.cause=r,a.name=r.name,s&&Object.assign(a,s),a};const aue=null;function dB(r){return jt.isPlainObject(r)||jt.isArray(r)}function nO(r){return jt.endsWith(r,"[]")?r.slice(0,-2):r}function iO(r,e,t){return r?r.concat(e).map(function(i,s){return i=nO(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function lue(r){return jt.isArray(r)&&!r.some(dB)}const cue=jt.toFlatObject(jt,{},null,function(e){return/^is[A-Z]/.test(e)});function V0(r,e,t){if(!jt.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=jt.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,D){return!jt.isUndefined(D[P])});const n=t.metaTokens,i=t.visitor||p,s=t.dots,a=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&jt.isSpecCompliantForm(e);if(!jt.isFunction(i))throw new TypeError("visitor must be a function");function d(M){if(M===null)return"";if(jt.isDate(M))return M.toISOString();if(!u&&jt.isBlob(M))throw new Tn("Blob is not supported. Use a Buffer instead.");return jt.isArrayBuffer(M)||jt.isTypedArray(M)?u&&typeof Blob=="function"?new Blob([M]):Buffer.from(M):M}function p(M,P,D){let N=M;if(M&&!D&&typeof M=="object"){if(jt.endsWith(P,"{}"))P=n?P:P.slice(0,-2),M=JSON.stringify(M);else if(jt.isArray(M)&&lue(M)||(jt.isFileList(M)||jt.endsWith(P,"[]"))&&(N=jt.toArray(M)))return P=nO(P),N.forEach(function(W,V){!(jt.isUndefined(W)||W===null)&&e.append(a===!0?iO([P],V,s):a===null?P:P+"[]",d(W))}),!1}return dB(M)?!0:(e.append(iO(D,P,s),d(M)),!1)}const _=[],w=Object.assign(cue,{defaultVisitor:p,convertValue:d,isVisitable:dB});function v(M,P){if(!jt.isUndefined(M)){if(_.indexOf(M)!==-1)throw Error("Circular reference detected in "+P.join("."));_.push(M),jt.forEach(M,function(N,z){(!(jt.isUndefined(N)||N===null)&&i.call(e,N,jt.isString(z)?z.trim():z,P,w))===!0&&v(N,P?P.concat(z):[z])}),_.pop()}}if(!jt.isObject(r))throw new TypeError("data must be an object");return v(r),e}function sO(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function pB(r,e){this._pairs=[],r&&V0(r,this,e)}const oO=pB.prototype;oO.append=function(e,t){this._pairs.push([e,t])},oO.toString=function(e){const t=e?function(n){return e.call(this,n,sO)}:sO;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function uue(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function aO(r,e,t){if(!e)return r;const n=t&&t.encode||uue;jt.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let s;if(i?s=i(e,t):s=jt.isURLSearchParams(e)?e.toString():new pB(e,t).toString(n),s){const a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class lO{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){jt.forEach(this.handlers,function(n){n!==null&&e(n)})}}const cO={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},hue={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:pB,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},gB=typeof window<"u"&&typeof document<"u",mB=typeof navigator=="object"&&navigator||void 0,Aue=gB&&(!mB||["ReactNative","NativeScript","NS"].indexOf(mB.product)<0),fue=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",due=gB&&window.location.href||"http://localhost",ma={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:gB,hasStandardBrowserEnv:Aue,hasStandardBrowserWebWorkerEnv:fue,navigator:mB,origin:due},Symbol.toStringTag,{value:"Module"})),...hue};function pue(r,e){return V0(r,new ma.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,s){return ma.isNode&&jt.isBuffer(t)?(this.append(n,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function gue(r){return jt.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function mue(r){const e={},t=Object.keys(r);let n;const i=t.length;let s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function uO(r){function e(t,n,i,s){let a=t[s++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),u=s>=t.length;return a=!a&&jt.isArray(i)?i.length:a,u?(jt.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o):((!i[a]||!jt.isObject(i[a]))&&(i[a]=[]),e(t,n,i[a],s)&&jt.isArray(i[a])&&(i[a]=mue(i[a])),!o)}if(jt.isFormData(r)&&jt.isFunction(r.entries)){const t={};return jt.forEachEntry(r,(n,i)=>{e(gue(n),i,t,0)}),t}return null}function _ue(r,e,t){if(jt.isString(r))try{return(e||JSON.parse)(r),jt.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}const _m={transitional:cO,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=jt.isObject(e);if(s&&jt.isHTMLForm(e)&&(e=new FormData(e)),jt.isFormData(e))return i?JSON.stringify(uO(e)):e;if(jt.isArrayBuffer(e)||jt.isBuffer(e)||jt.isStream(e)||jt.isFile(e)||jt.isBlob(e)||jt.isReadableStream(e))return e;if(jt.isArrayBufferView(e))return e.buffer;if(jt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return pue(e,this.formSerializer).toString();if((o=jt.isFileList(e))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return V0(o?{"files[]":e}:e,u&&new u,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),_ue(e)):e}],transformResponse:[function(e){const t=this.transitional||_m.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(jt.isResponse(e)||jt.isReadableStream(e))return e;if(e&&jt.isString(e)&&(n&&!this.responseType||i)){const a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?Tn.from(o,Tn.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ma.classes.FormData,Blob:ma.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};jt.forEach(["delete","get","head","post","put","patch"],r=>{_m.headers[r]={}});const yue=jt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bue=r=>{const e={};let t,n,i;return r&&r.split(`
`).forEach(function(a){i=a.indexOf(":"),t=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!t||e[t]&&yue[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},hO=Symbol("internals");function ym(r){return r&&String(r).trim().toLowerCase()}function j0(r){return r===!1||r==null?r:jt.isArray(r)?r.map(j0):String(r)}function vue(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const wue=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function _B(r,e,t,n,i){if(jt.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!jt.isString(e)){if(jt.isString(n))return e.indexOf(n)!==-1;if(jt.isRegExp(n))return n.test(e)}}function xue(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Bue(r,e){const t=jt.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,s,a){return this[n].call(this,e,i,s,a)},configurable:!0})})}let sl=class{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(o,u,d){const p=ym(u);if(!p)throw new Error("header name must be a non-empty string");const _=jt.findKey(i,p);(!_||i[_]===void 0||d===!0||d===void 0&&i[_]!==!1)&&(i[_||u]=j0(o))}const a=(o,u)=>jt.forEach(o,(d,p)=>s(d,p,u));if(jt.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(jt.isString(e)&&(e=e.trim())&&!wue(e))a(bue(e),t);else if(jt.isHeaders(e))for(const[o,u]of e.entries())s(u,o,n);else e!=null&&s(t,e,n);return this}get(e,t){if(e=ym(e),e){const n=jt.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return vue(i);if(jt.isFunction(t))return t.call(this,i,n);if(jt.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ym(e),e){const n=jt.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||_B(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function s(a){if(a=ym(a),a){const o=jt.findKey(n,a);o&&(!t||_B(n,n[o],o,t))&&(delete n[o],i=!0)}}return jt.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];(!e||_B(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return jt.forEach(this,(i,s)=>{const a=jt.findKey(n,s);if(a){t[a]=j0(i),delete t[s];return}const o=e?xue(s):String(s).trim();o!==s&&delete t[s],t[o]=j0(i),n[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return jt.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&jt.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i.forEach(a=>t.set(a)),t}static accessor(e){const n=(this[hO]=this[hO]={accessors:{}}).accessors,i=this.prototype;function s(a){const o=ym(a);n[o]||(Bue(i,a),n[o]=!0)}return jt.isArray(e)?e.forEach(s):s(e),this}};sl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),jt.reduceDescriptors(sl.prototype,(r,e)=>{let{value:t}=r,n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(i){this[n]=i}}}),jt.freezeMethods(sl);function yB(r,e){const t=this||_m,n=e||t,i=sl.from(n.headers);let s=n.data;return jt.forEach(r,function(o){s=o.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function AO(r){return!!(r&&r.__CANCEL__)}function Pp(r,e,t){Tn.call(this,r??"canceled",Tn.ERR_CANCELED,e,t),this.name="CanceledError"}jt.inherits(Pp,Tn,{__CANCEL__:!0});function fO(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new Tn("Request failed with status code "+t.status,[Tn.ERR_BAD_REQUEST,Tn.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Cue(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Tue(r,e){r=r||10;const t=new Array(r),n=new Array(r);let i=0,s=0,a;return e=e!==void 0?e:1e3,function(u){const d=Date.now(),p=n[s];a||(a=d),t[i]=u,n[i]=d;let _=s,w=0;for(;_!==i;)w+=t[_++],_=_%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),d-a<e)return;const v=p&&d-p;return v?Math.round(w*1e3/v):void 0}}function Eue(r,e){let t=0,n=1e3/e,i,s;const a=function(d){t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),i=null,s&&(clearTimeout(s),s=null),r.apply(null,d)};return[function(){const d=Date.now(),p=d-t;for(var _=arguments.length,w=new Array(_),v=0;v<_;v++)w[v]=arguments[v];p>=n?a(w,d):(i=w,s||(s=setTimeout(()=>{s=null,a(i)},n-p)))},()=>i&&a(i)]}const $0=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=0;const i=Tue(50,250);return Eue(s=>{const a=s.loaded,o=s.lengthComputable?s.total:void 0,u=a-n,d=i(u),p=a<=o;n=a;const _={loaded:a,total:o,progress:o?a/o:void 0,bytes:u,rate:d||void 0,estimated:d&&o&&p?(o-a)/d:void 0,event:s,lengthComputable:o!=null,[e?"download":"upload"]:!0};r(_)},t)},dO=(r,e)=>{const t=r!=null;return[n=>e[0]({lengthComputable:t,total:r,loaded:n}),e[1]]},pO=r=>function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return jt.asap(()=>r(...t))},Sue=ma.hasStandardBrowserEnv?((r,e)=>t=>(t=new URL(t,ma.origin),r.protocol===t.protocol&&r.host===t.host&&(e||r.port===t.port)))(new URL(ma.origin),ma.navigator&&/(msie|trident)/i.test(ma.navigator.userAgent)):()=>!0,Iue=ma.hasStandardBrowserEnv?{write(r,e,t,n,i,s){const a=[r+"="+encodeURIComponent(e)];jt.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),jt.isString(n)&&a.push("path="+n),jt.isString(i)&&a.push("domain="+i),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Mue(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Pue(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function gO(r,e){return r&&!Mue(e)?Pue(r,e):e}const mO=r=>r instanceof sl?{...r}:r;function Yf(r,e){e=e||{};const t={};function n(d,p,_,w){return jt.isPlainObject(d)&&jt.isPlainObject(p)?jt.merge.call({caseless:w},d,p):jt.isPlainObject(p)?jt.merge({},p):jt.isArray(p)?p.slice():p}function i(d,p,_,w){if(jt.isUndefined(p)){if(!jt.isUndefined(d))return n(void 0,d,_,w)}else return n(d,p,_,w)}function s(d,p){if(!jt.isUndefined(p))return n(void 0,p)}function a(d,p){if(jt.isUndefined(p)){if(!jt.isUndefined(d))return n(void 0,d)}else return n(void 0,p)}function o(d,p,_){if(_ in e)return n(d,p);if(_ in r)return n(void 0,d)}const u={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(d,p,_)=>i(mO(d),mO(p),_,!0)};return jt.forEach(Object.keys(Object.assign({},r,e)),function(p){const _=u[p]||i,w=_(r[p],e[p],p);jt.isUndefined(w)&&_!==o||(t[p]=w)}),t}const _O=r=>{const e=Yf({},r);let{data:t,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:s,headers:a,auth:o}=e;e.headers=a=sl.from(a),e.url=aO(gO(e.baseURL,e.url),r.params,r.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let u;if(jt.isFormData(t)){if(ma.hasStandardBrowserEnv||ma.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((u=a.getContentType())!==!1){const[d,...p]=u?u.split(";").map(_=>_.trim()).filter(Boolean):[];a.setContentType([d||"multipart/form-data",...p].join("; "))}}if(ma.hasStandardBrowserEnv&&(n&&jt.isFunction(n)&&(n=n(e)),n||n!==!1&&Sue(e.url))){const d=i&&s&&Iue.read(s);d&&a.set(i,d)}return e},Fue=typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(t,n){const i=_O(r);let s=i.data;const a=sl.from(i.headers).normalize();let{responseType:o,onUploadProgress:u,onDownloadProgress:d}=i,p,_,w,v,M;function P(){v&&v(),M&&M(),i.cancelToken&&i.cancelToken.unsubscribe(p),i.signal&&i.signal.removeEventListener("abort",p)}let D=new XMLHttpRequest;D.open(i.method.toUpperCase(),i.url,!0),D.timeout=i.timeout;function N(){if(!D)return;const W=sl.from("getAllResponseHeaders"in D&&D.getAllResponseHeaders()),$={data:!o||o==="text"||o==="json"?D.responseText:D.response,status:D.status,statusText:D.statusText,headers:W,config:r,request:D};fO(function(te){t(te),P()},function(te){n(te),P()},$),D=null}"onloadend"in D?D.onloadend=N:D.onreadystatechange=function(){!D||D.readyState!==4||D.status===0&&!(D.responseURL&&D.responseURL.indexOf("file:")===0)||setTimeout(N)},D.onabort=function(){D&&(n(new Tn("Request aborted",Tn.ECONNABORTED,r,D)),D=null)},D.onerror=function(){n(new Tn("Network Error",Tn.ERR_NETWORK,r,D)),D=null},D.ontimeout=function(){let V=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const $=i.transitional||cO;i.timeoutErrorMessage&&(V=i.timeoutErrorMessage),n(new Tn(V,$.clarifyTimeoutError?Tn.ETIMEDOUT:Tn.ECONNABORTED,r,D)),D=null},s===void 0&&a.setContentType(null),"setRequestHeader"in D&&jt.forEach(a.toJSON(),function(V,$){D.setRequestHeader($,V)}),jt.isUndefined(i.withCredentials)||(D.withCredentials=!!i.withCredentials),o&&o!=="json"&&(D.responseType=i.responseType),d&&([w,M]=$0(d,!0),D.addEventListener("progress",w)),u&&D.upload&&([_,v]=$0(u),D.upload.addEventListener("progress",_),D.upload.addEventListener("loadend",v)),(i.cancelToken||i.signal)&&(p=W=>{D&&(n(!W||W.type?new Pp(null,r,D):W),D.abort(),D=null)},i.cancelToken&&i.cancelToken.subscribe(p),i.signal&&(i.signal.aborted?p():i.signal.addEventListener("abort",p)));const z=Cue(i.url);if(z&&ma.protocols.indexOf(z)===-1){n(new Tn("Unsupported protocol "+z+":",Tn.ERR_BAD_REQUEST,r));return}D.send(s||null)})},Rue=(r,e)=>{const{length:t}=r=r?r.filter(Boolean):[];if(e||t){let n=new AbortController,i;const s=function(d){if(!i){i=!0,o();const p=d instanceof Error?d:this.reason;n.abort(p instanceof Tn?p:new Pp(p instanceof Error?p.message:p))}};let a=e&&setTimeout(()=>{a=null,s(new Tn(`timeout ${e} of ms exceeded`,Tn.ETIMEDOUT))},e);const o=()=>{r&&(a&&clearTimeout(a),a=null,r.forEach(d=>{d.unsubscribe?d.unsubscribe(s):d.removeEventListener("abort",s)}),r=null)};r.forEach(d=>d.addEventListener("abort",s));const{signal:u}=n;return u.unsubscribe=()=>jt.asap(o),u}},Lue=function*(r,e){let t=r.byteLength;if(t<e){yield r;return}let n=0,i;for(;n<t;)i=n+e,yield r.slice(n,i),n=i},Oue=async function*(r,e){for await(const t of Uue(r))yield*Lue(t,e)},Uue=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{await e.cancel()}},yO=(r,e,t,n)=>{const i=Oue(r,e);let s=0,a,o=u=>{a||(a=!0,n&&n(u))};return new ReadableStream({async pull(u){try{const{done:d,value:p}=await i.next();if(d){o(),u.close();return}let _=p.byteLength;if(t){let w=s+=_;t(w)}u.enqueue(new Uint8Array(p))}catch(d){throw o(d),d}},cancel(u){return o(u),i.return()}},{highWaterMark:2})},G0=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",bO=G0&&typeof ReadableStream=="function",Due=G0&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),vO=function(r){try{for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return!!r(...t)}catch{return!1}},Nue=bO&&vO(()=>{let r=!1;const e=new Request(ma.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),wO=64*1024,bB=bO&&vO(()=>jt.isReadableStream(new Response("").body)),q0={stream:bB&&(r=>r.body)};G0&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!q0[e]&&(q0[e]=jt.isFunction(r[e])?t=>t[e]():(t,n)=>{throw new Tn(`Response type '${e}' is not supported`,Tn.ERR_NOT_SUPPORT,n)})})})(new Response);const kue=async r=>{if(r==null)return 0;if(jt.isBlob(r))return r.size;if(jt.isSpecCompliantForm(r))return(await new Request(ma.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(jt.isArrayBufferView(r)||jt.isArrayBuffer(r))return r.byteLength;if(jt.isURLSearchParams(r)&&(r=r+""),jt.isString(r))return(await Due(r)).byteLength},Que=async(r,e)=>{const t=jt.toFiniteNumber(r.getContentLength());return t??kue(e)},vB={http:aue,xhr:Fue,fetch:G0&&(async r=>{let{url:e,method:t,data:n,signal:i,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:u,responseType:d,headers:p,withCredentials:_="same-origin",fetchOptions:w}=_O(r);d=d?(d+"").toLowerCase():"text";let v=Rue([i,s&&s.toAbortSignal()],a),M;const P=v&&v.unsubscribe&&(()=>{v.unsubscribe()});let D;try{if(u&&Nue&&t!=="get"&&t!=="head"&&(D=await Que(p,n))!==0){let $=new Request(e,{method:"POST",body:n,duplex:"half"}),q;if(jt.isFormData(n)&&(q=$.headers.get("content-type"))&&p.setContentType(q),$.body){const[te,J]=dO(D,$0(pO(u)));n=yO($.body,wO,te,J)}}jt.isString(_)||(_=_?"include":"omit");const N="credentials"in Request.prototype;M=new Request(e,{...w,signal:v,method:t.toUpperCase(),headers:p.normalize().toJSON(),body:n,duplex:"half",credentials:N?_:void 0});let z=await fetch(M);const W=bB&&(d==="stream"||d==="response");if(bB&&(o||W&&P)){const $={};["status","statusText","headers"].forEach(me=>{$[me]=z[me]});const q=jt.toFiniteNumber(z.headers.get("content-length")),[te,J]=o&&dO(q,$0(pO(o),!0))||[];z=new Response(yO(z.body,wO,te,()=>{J&&J(),P&&P()}),$)}d=d||"text";let V=await q0[jt.findKey(q0,d)||"text"](z,r);return!W&&P&&P(),await new Promise(($,q)=>{fO($,q,{data:V,headers:sl.from(z.headers),status:z.status,statusText:z.statusText,config:r,request:M})})}catch(N){throw P&&P(),N&&N.name==="TypeError"&&/fetch/i.test(N.message)?Object.assign(new Tn("Network Error",Tn.ERR_NETWORK,r,M),{cause:N.cause||N}):Tn.from(N,N&&N.code,r,M)}})};jt.forEach(vB,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const xO=r=>`- ${r}`,zue=r=>jt.isFunction(r)||r===null||r===!1,BO={getAdapter:r=>{r=jt.isArray(r)?r:[r];const{length:e}=r;let t,n;const i={};for(let s=0;s<e;s++){t=r[s];let a;if(n=t,!zue(t)&&(n=vB[(a=String(t)).toLowerCase()],n===void 0))throw new Tn(`Unknown adapter '${a}'`);if(n)break;i[a||"#"+s]=n}if(!n){const s=Object.entries(i).map(o=>{let[u,d]=o;return`adapter ${u} `+(d===!1?"is not supported by the environment":"is not available in the build")});let a=e?s.length>1?`since :
`+s.map(xO).join(`
`):" "+xO(s[0]):"as no adapter specified";throw new Tn("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:vB};function wB(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Pp(null,r)}function CO(r){return wB(r),r.headers=sl.from(r.headers),r.data=yB.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),BO.getAdapter(r.adapter||_m.adapter)(r).then(function(n){return wB(r),n.data=yB.call(r,r.transformResponse,n),n.headers=sl.from(n.headers),n},function(n){return AO(n)||(wB(r),n&&n.response&&(n.response.data=yB.call(r,r.transformResponse,n.response),n.response.headers=sl.from(n.response.headers))),Promise.reject(n)})}const TO="1.7.9",K0={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{K0[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const EO={};K0.transitional=function(e,t,n){function i(s,a){return"[Axios v"+TO+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,o)=>{if(e===!1)throw new Tn(i(a," has been removed"+(t?" in "+t:"")),Tn.ERR_DEPRECATED);return t&&!EO[a]&&(EO[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,a,o):!0}},K0.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function Hue(r,e,t){if(typeof r!="object")throw new Tn("options must be an object",Tn.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],a=e[s];if(a){const o=r[s],u=o===void 0||a(o,s,r);if(u!==!0)throw new Tn("option "+s+" must be "+u,Tn.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Tn("Unknown option "+s,Tn.ERR_BAD_OPTION)}}const W0={assertOptions:Hue,validators:K0},eh=W0.validators;let Zf=class{constructor(e){this.defaults=e,this.interceptors={request:new lO,response:new lO}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Yf(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&W0.assertOptions(n,{silentJSONParsing:eh.transitional(eh.boolean),forcedJSONParsing:eh.transitional(eh.boolean),clarifyTimeoutError:eh.transitional(eh.boolean)},!1),i!=null&&(jt.isFunction(i)?t.paramsSerializer={serialize:i}:W0.assertOptions(i,{encode:eh.function,serialize:eh.function},!0)),W0.assertOptions(t,{baseUrl:eh.spelling("baseURL"),withXsrfToken:eh.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=s&&jt.merge(s.common,s[t.method]);s&&jt.forEach(["delete","get","head","post","put","patch","common"],M=>{delete s[M]}),t.headers=sl.concat(a,s);const o=[];let u=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(t)===!1||(u=u&&P.synchronous,o.unshift(P.fulfilled,P.rejected))});const d=[];this.interceptors.response.forEach(function(P){d.push(P.fulfilled,P.rejected)});let p,_=0,w;if(!u){const M=[CO.bind(this),void 0];for(M.unshift.apply(M,o),M.push.apply(M,d),w=M.length,p=Promise.resolve(t);_<w;)p=p.then(M[_++],M[_++]);return p}w=o.length;let v=t;for(_=0;_<w;){const M=o[_++],P=o[_++];try{v=M(v)}catch(D){P.call(this,D);break}}try{p=CO.call(this,v)}catch(M){return Promise.reject(M)}for(_=0,w=d.length;_<w;)p=p.then(d[_++],d[_++]);return p}getUri(e){e=Yf(this.defaults,e);const t=gO(e.baseURL,e.url);return aO(t,e.params,e.paramsSerializer)}};jt.forEach(["delete","get","head","options"],function(e){Zf.prototype[e]=function(t,n){return this.request(Yf(n||{},{method:e,url:t,data:(n||{}).data}))}}),jt.forEach(["post","put","patch"],function(e){function t(n){return function(s,a,o){return this.request(Yf(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}Zf.prototype[e]=t(),Zf.prototype[e+"Form"]=t(!0)});let Vue=class Z7{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const a=new Promise(o=>{n.subscribe(o),s=o}).then(i);return a.cancel=function(){n.unsubscribe(s)},a},e(function(s,a,o){n.reason||(n.reason=new Pp(s,a,o),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Z7(function(i){e=i}),cancel:e}}};function jue(r){return function(t){return r.apply(null,t)}}function $ue(r){return jt.isObject(r)&&r.isAxiosError===!0}const xB={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xB).forEach(r=>{let[e,t]=r;xB[t]=e});function SO(r){const e=new Zf(r),t=jL(Zf.prototype.request,e);return jt.extend(t,Zf.prototype,e,{allOwnKeys:!0}),jt.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return SO(Yf(r,i))},t}const Ds=SO(_m);Ds.Axios=Zf,Ds.CanceledError=Pp,Ds.CancelToken=Vue,Ds.isCancel=AO,Ds.VERSION=TO,Ds.toFormData=V0,Ds.AxiosError=Tn,Ds.Cancel=Ds.CanceledError,Ds.all=function(e){return Promise.all(e)},Ds.spread=jue,Ds.isAxiosError=$ue,Ds.mergeConfig=Yf,Ds.AxiosHeaders=sl,Ds.formToJSON=r=>uO(jt.isHTMLForm(r)?new FormData(r):r),Ds.getAdapter=BO.getAdapter,Ds.HttpStatusCode=xB,Ds.default=Ds;const{Axios:D1e,AxiosError:N1e,CanceledError:k1e,isCancel:Q1e,CancelToken:z1e,VERSION:H1e,all:V1e,Cancel:j1e,isAxiosError:$1e,spread:G1e,toFormData:q1e,AxiosHeaders:K1e,HttpStatusCode:W1e,formToJSON:X1e,getAdapter:Y1e,mergeConfig:Z1e}=Ds,Gue="https://eines.icgc.cat/recursos/mapicgc-gl-js/mapicgc-config.json",que=5e3;class IO{static async getConfigICGC(){try{const e=await Ds.get(Gue,{timeout:que});return e.data?e.data:(console.log("Resposta sense dades:",e),Wf)}catch(e){return e.response?(console.error("Error de resposta:",e.response.data),console.error("Codi d'estat:",e.response.status)):e.request?console.error("No s'ha rebut resposta del servidor:",e.request):console.error("Error:",e.message),Wf}}}const Kue={cobertesSol:{"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]}},Wue="lines",X0="labels";let Sl,Jf,bm,bs,hi,Xue=class{constructor(e){IO.getConfigICGC().then(t=>{Jf={...t.Styles},bs={...t.Layers},bm={...t.Terrains},hi={...t.defaultOptions},this.initTheMap(e)}).catch(t=>{console.info("Configuracio per defecte",t),Jf={...Wf.Styles},bs={...Wf.Layers},bm={...Wf.Terrains},hi={...Wf.defaultOptions},this.initTheMap(e)})}initTheMap(e){if(!e)e=hi.mapOptions;else for(const n in hi.mapOptions){let i=[hi.mapOptions.center[0],hi.mapOptions.center[1]];hi.mapOptions.center=i,e.hasOwnProperty(n)||(e[n]=hi.mapOptions[n])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1;const t=e.style.includes("https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/");t?(this.map=new Mo.Map({container:e.container,center:e.center,zoom:e.zoom,pitch:e.pitch||0,hash:e.hash||!1,style:{version:8,sources:{},layers:[]}}),this.map.on("load",()=>{this.map.addSource("raster-source",{type:"raster",tiles:[e.style],tileSize:256}),this.map.addLayer({id:"raster-layer",type:"raster",source:"raster-source"})})):this.map=new Mo.Map(e),this.map.on("load",()=>{if(!t){const n=this.map.getStyle().name,i=e.style;this.map.addControl(new gce({color:i.indexOf("orto")===-1,defaultOptions:hi}),"bottom-left"),this._dealOrto3dStyle(n)}})}addGeocoderICGC(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"top-right";try{e={...{collapsed:!0,marker:!0,zoom:16,popup:!0,showResultMarkers:!0,maplibregl:Mo,showResultsWhileTyping:!0,minLength:2},...e};const i={forwardGeocode:async a=>{const o=[];try{const u=hi.geocoder.peliasUrl1+encodeURIComponent(a.query)+hi.geocoder.peliasUrl2,p=await(await fetch(u)).json();for(const _ of p.features){const w=_.geometry.coordinates,v={type:"Feature",geometry:{type:"Point",coordinates:w},place_name:_.properties.etiqueta,properties:_.properties,text:_.properties.etiqueta,place_type:["place"],center:w};o.push(v)}}catch(u){console.error(`Failed to forwardGeocode with error: ${u}`)}return{features:o}}};this.map.addControl(new pce(i,e),t);let s=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");s[0].attributes[2].nodeValue="Cerca...",s[0].addEventListener("input",function(a){a.target.value.length>3})}catch(n){console.error(`Error adding ICGC geocoder: ${n.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}getConfigStyles(){try{let e=[];for(const t of Jf)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in bs.WMS)bs.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in bs.Orto)bs.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in bs.Vector)bs.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in bs.VectorAdmin)bs.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}getConfigFGBAdminLayers(){try{let e=[];for(const t in bs.FGBAdmin)bs.FGBAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving FGBAdmin layers: ${e.message}`)}}async fetchData(e,t,n){try{(!n||n===void 0)&&(n={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let i=n.layerPosition;if(e.includes(".fgb"))this.addFGBLayerICGC(e,t,n);else{const a=await(await fetch(e)).json();let o=t,u=this._dealOrderLayer(i),d=a.features[0].geometry.type;d.includes("ine")&&(n!==void 0?this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:n.layout||{},paint:n.paint||{}},u):this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},u)),d.includes("olygon")&&(n!==void 0?this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},u):this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},u)),d.includes("oint")&&(n!==void 0?this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},u):this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},u))}}catch(i){console.error(`Error fetching data: ${i.message}`)}}async fetchDataAndMenu(e,t,n,i){try{let s;i!==null?s=i.layerPosition:s=X0;let a,o=document.getElementById("map");if(document.getElementById("menu-group")?a=document.getElementById("menu-group"):(a=document.createElement("nav"),a.id="menu-group",a.classList.add="filter-group",o.appendChild(a)),a!==null){let u="visible",d=this._dealOrderLayer(s),p;if(e.includes(".fgb")){let w=this._getKeyByUrlFGB(e);w===null&&(w="userFGB");const v=await fetch(e),M={type:"FeatureCollection",features:[]};for await(const D of HS(v.body))M.features.push(D);p=M;let P=t;if(this.map.addSource(P,{type:"geojson",data:M}),e.includes("text"))i!==void 0?this.map.addLayer({id:t,type:"symbol",source:P,layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"symbol",source:P,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:u,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},d);else{let D=t+"Text";this.map.addLayer({id:D,type:"symbol",source:P,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:u,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},d)}}else p=await(await fetch(e)).json();if(n!=="all"){const w=document.createElement("div");w.id="titleDivMenu",w.textContent=t,a.appendChild(w);const v=document.createElement("div");v.id="titleDivMenuSub",v.textContent=`📂 ${n}`,a.appendChild(v)}let _;if(i.type?_=i.type:_=p.features[0].geometry.type,n==="all")_.includes("ine")&&(i!==void 0?this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:p},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},d)),_.includes("olygon")&&(i!==void 0?this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:p},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},d)),_.includes("oint")&&(i!==void 0?this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:p},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},d)),_.includes("ymbol")&&(i!==void 0?this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:p},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},d)),this.addMenuItem(t);else{let w=n;const v={};p.features.forEach(M=>{const P=M.properties[w],D=P+"-userFieldFilter-"+t;P!==null&&(v[D]||(_.includes("ine")&&(i!==void 0?this.map.addLayer({id:D,type:"line",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint,filter:["==",`${w}`,P]},d):this.map.addLayer({id:D,type:"line",source:{type:"geojson",data:p},layout:{visibility:"visible"},filter:["==",`${w}`,P],paint:{"line-color":"black","line-width":2,"line-opacity":1}},d)),_.includes("olygon")&&(i!==void 0?this.map.addLayer({id:D,type:"fill",source:{type:"geojson",data:p},filter:["==",`${w}`,P],layout:i.layout,paint:i.paint},d):this.map.addLayer({id:D,type:"fill",source:{type:"geojson",data:p},layout:{visibility:"visible"},filter:["==",`${w}`,P],paint:{"fill-color":"blue","fill-opacity":.6}},d)),_.includes("oint")&&(i!==void 0?this.map.addLayer({id:D,type:"circle",source:{type:"geojson",data:p},filter:["==",`${w}`,P],layout:i.layout,paint:i.paint},d):this.map.addLayer({id:D,type:"circle",source:{type:"geojson",data:p},layout:{visibility:"visible"},filter:["==",`${w}`,P],paint:{"circle-color":"red","circle-opacity":.85}},d)),v[D]=!0,this.addMenuItem(D)))})}}}catch(s){console.error(`Error fetching data: ${s.message}`)}}on(e,t){setTimeout(()=>{try{return this.map.on(e,t)}catch(n){console.error(`Error adding event ON listener: ${n.message}`)}},100)}setStyle(e,t){try{t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var n=window.document.querySelector(".maplibregl-compact-show");n.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(n){console.error(`Error setting style: ${n.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(n){console.error(`Error adding control: ${n.message}`)}}setSky(e){try{e===void 0&&(this.map.style.stylesheet.id.includes("orto")?e={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("mapa_estandard_general")?e={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("icgc_mapa_vissir")?e={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("fosc")?e={"sky-color":"#232423","sky-horizon-blend":.3,"horizon-color":"#969996","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#383838"}:e={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}),this.map.setSky(e)}catch(t){console.error(`Error setting sky properties: ${t.message}`)}}addMouseCoordControl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new vce(e),t)}catch(n){console.error(`Error adding mouse coordinate control: ${n.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Mo.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new Mo.GeolocateControl(e),t)}catch(n){console.error(`Error adding geolocate control: ${n.message}`)}}addFullscreenControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Mo.FullscreenControl({container:HTMLElement}),t):this.map.addControl(new Mo.FullscreenControl(e),t)}catch(n){console.error(`Error adding fullscreen control: ${n.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(n){console.error(`Error adding layer: ${n.message}`)}}addImage(e,t,n){try{this.map.addImage(e,t,n)}catch(i){console.error(`Error adding image: ${i.message}`)}return this}addSource(e,t){try{this.map.addSource(e,t)}catch(n){console.error(`Error adding source: ${n.message}`)}return this}addSprite(e,t,n){try{this.map.addSprite(e,t,n)}catch(i){console.error(`Error adding sprite: ${i.message}`)}return this}areTilesLoaded(){return this.map.areTilesLoaded()}cameraForBounds(e,t){return this.map.cameraForBounds(e,t)}easeTo(e,t){return this.map.easeTo(e,t),this}fitBounds(e,t,n){return this.map.fitBounds(e,t,n),this}fitScreenCoordinates(e,t,n,i,s){return this.map.fitScreenCoordinates(e,t,n,i,s),this}flyTo(e,t){return this.map.flyTo(e,t),this}getBearing(){return this.map.getBearing()}getBounds(){return this.map.getBounds()}getCameraTargetElevation(){return this.map.getCameraTargetElevation()}getCanvas(){return this.map.getCanvas()}getCanvasContainer(){return this.map.getCanvasContainer()}getCenter(){return this.map.getCenter()}getContainer(){return this.map.getContainer()}getFeatureState(e){return this.map.getFeatureState(e)}getFilter(e){return this.map.getFilter(e)}getGlyphs(){return this.map.getGlyphs()}getImage(e){return this.map.getImage(e)}getLayer(e){return this.map.getLayer(e)}getLayersOrder(){return this.map.getLayersOrder()}getLayoutProperty(e,t){return this.map.getLayoutProperty(e,t)}getLight(){return this.map.getLight()}getMaxBounds(){return this.map.getMaxBounds()}getMaxPitch(){return this.map.getMaxPitch()}getMaxZoom(){return this.map.getMaxZoom()}getMinPitch(){return this.map.getMinPitch()}getMinZoom(){return this.map.getMinZoom()}getPadding(){return this.map.getPadding()}getPaintProperty(e,t){return this.map.getPaintProperty(e,t)}getPitch(){return this.map.getPitch()}getPixelRatio(){return this.map.getPixelRatio()}getRenderWorldCopies(){return this.map.getRenderWorldCopies()}getSource(e){return this.map.getSource(e)}getSprite(){return this.map.getSprite()}getStyle(){return this.map.getStyle()}getTerrain(){return this.map.getTerrain()}getZoom(){return this.map.getZoom()}hasControl(e){return this.map.hasControl(e)}hasImage(e){return this.map.hasImage(e)}isMoving(){return this.map.isMoving()}isRotating(){return this.map.isRotating()}isSourceLoaded(e){return this.map.isSourceLoaded(e)}isStyleLoaded(){return this.map.isStyleLoaded()}isZooming(){return this.map.isZooming()}jumpTo(e,t){return this.map.jumpTo(e,t)}listImages(){return this.map.listImages()}listens(e){return this.map.listens(e)}loadImage(e){return this.map.loadImage(e)}loaded(){return this.map.loaded()}LngLatBounds(e,t){return new Mo.LngLatBounds(e,t)}addProtocol(e,t){return this.map.addProtocol(e,t)}moveLayer(e,t){return this.map.moveLayer(e,t)}panBy(e,t,n){return this.map.panBy(e,t,n)}panTo(e,t,n){return this.map.panTo(e,t,n)}project(e){return this.map.project(e)}queryRenderedFeatures(e,t){return this.map.queryRenderedFeatures(e,t)}querySourceFeatures(e,t){return this.map.querySourceFeatures(e,t)}queryTerrainElevation(e){return this.map.queryTerrainElevation(e)}redraw(){return this.map.redraw()}remove(){return this.map.remove()}removeControl(e){return this.map.removeControl(e)}removeFeatureState(e,t){return this.map.removeFeatureState(e,t)}removeImage(e){return this.map.removeImage(e)}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}removeSprite(e){return this.map.removeSprite(e)}resetNorth(e,t){return this.map.resetNorth(e,t)}resetNorthPitch(e,t){return this.map.resetNorthPitch(e,t)}resize(e){return this.map.resize(e)}rotateTo(e,t,n){return this.map.rotateTo(e,t,n)}setBearing(e,t){return this.map.setBearing(e,t)}setCenter(e,t){return this.map.setCenter(e,t)}setEventedParent(e,t){return this.map.setEventedParent(e,t)}setFeatureState(e,t){return this.map.setFeatureState(e,t)}setFilter(e,t,n){return this.map.setFilter(e,t,n)}setGlyphs(e,t){return this.map.setGlyphs(e,t)}setLayerZoomRange(e,t,n){return this.map.setLayerZoomRange(e,t,n)}setLayoutProperty(e,t,n,i){return this.map.setLayoutProperty(e,t,n,i)}setLight(e,t){return this.map.setLight(e,t)}setMaxBounds(e){return this.map.setMaxBounds(e)}setMaxPitch(e){return this.map.setMaxPitch(e)}setMaxZoom(e){return this.map.setMaxZoom(e)}setMinPitch(e){return this.map.setMinPitch(e)}setMinZoom(e){return this.map.setMinZoom(e)}setPadding(e,t){return this.map.setPadding(e,t)}setPaintProperty(e,t,n,i){return this.map.setPaintProperty(e,t,n,i)}setPitch(e,t){return this.map.setPitch(e,t)}setPixelRatio(e){return this.map.setPixelRatio(e)}setRenderWorldCopies(e){return this.map.setRenderWorldCopies(e)}setSprite(e,t){return this.map.setSprite(e,t)}setTerrain(e){return this.map.setTerrain(e)}setTransformRequest(e){return this.map.setTransformRequest(e)}setZoom(e,t){return this.map.setZoom(e,t)}snapToNorth(e,t){return this.map.snapToNorth(e,t)}stop(){return this.map.stop()}triggerRepaint(){return this.map.triggerRepaint()}unproject(e){return this.map.unproject(e)}updateImage(e,t){return this.map.updateImage(e,t)}zoomIn(e,t){return this.map.zoomIn(e,t)}zoomOut(e,t){return this.map.zoomOut(e,t)}zoomTo(e,t,n){return this.map.zoomTo(e,t,n)}addLayerGeoJSON(e,t){try{let n=this._dealOrderLayer(t);this.map.addSource(`${e.id}`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.type,source:`${e.id}`,layout:e.layout,paint:e.paint},n)}catch(n){console.error(`Error adding GeoJSON layer: ${n.message}`)}}addLayerWMS(e,t,n){try{let i=this._dealOrderLayer(n.layerPosition);n?(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,layout:n.layout,paint:n.paint},i)):(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,paint:{}},i))}catch(i){console.error(`Error adding WMS layer: ${i.message}`)}}addLogo(e){try{let t=document.getElementById("map"),n;n=document.createElement("div"),n.id="logos",t.appendChild(n);const i=document.createElement("img");i.src=e.url,i.style.height=e.height;const s=document.getElementById("logos"),a=document.createElement("a");a.id=e.id,a.href=e.href,a.target="_blank",a.style.position="relative",a.style.bottom="1px",a.appendChild(i),s.appendChild(a)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(e){try{const t=a=>{this.map.setStyle(a)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="filter-group",n.appendChild(i);const s=document.getElementById("basemap-group");for(const a of e)for(const o of Object.keys(hi.baseStyles)){const u=hi.baseStyles[o];if(a===u.url){const d=document.createElement("div");d.className="basemap-item",d.title=u.key,d.style.backgroundImage=`url('${u.image}')`,s.appendChild(d),d.addEventListener("click",()=>t(u.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=a=>{map.setStyle(a.url)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="basemap-group",n.appendChild(i);const s=document.getElementById("basemap-group");e.forEach(a=>{const o=document.createElement("div");o.className="basemap-item",o.title=a.label,o.style.backgroundImage=`url('${a.image}')`,s.appendChild(o),o.addEventListener("click",()=>t(a))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t,n){try{let i;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",s=>{let a=this.map.queryRenderedFeatures(s.point);if(a&&a[0].source.includes(e)){let o=[s.lngLat.lng,s.lngLat.lat];if(t!==void 0&&t.length>0&&t!=="all"){if(t!==null){let u="";t.forEach(d=>{let p=a[0].properties[d];u=u+`<h4>${p}</h4>`}),i=u,this.addPopup(o,i,n)}}else{let u="";for(const d in a[0].properties)u+="<b>"+d+"</b>:"+a[0].properties[d]+"<br>";i=u,this.addPopup(o,i,n)}}})}catch(i){console.error(`Error adding feature query: ${i.message}`)}}addScaleControl(e,t){try{var n=new Mo.ScaleControl(e);this.map.addControl(n,t)}catch(i){console.error(`Error adding scale: ${i.message}`)}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:jf.A4,PageOrientation:um.Landscape,Format:Rh.PNG,DPI:Rx[300],Crosshair:!0,PrintableArea:!0,Local:"ca"},t="top-right"),this.map.addControl(new Yle(e),t)}catch(n){console.error(`Error adding export control: ${n.message}`)}}addMarker(e){try{let t,n;return e.text===void 0?t=new Mo.Marker(e.options).setLngLat(e.coord).addTo(this.map):(n=new Mo.Popup({offset:e.textOffset}).setHTML(e.text),t=new Mo.Marker(e.options).setLngLat(e.coord).setPopup(n).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t,n){try{return n.image===void 0?new Mo.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${t}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new Mo.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${t}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${n.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(i){return console.error(`Error adding popup: ${i.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new Mo.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{let t;if(e.includes("-userFieldFilter-")?t=e.split("-userFieldFilter-")[0]:t=e,e.length>0){const n=document.getElementById("menu-group"),i=document.createElement("input");i.type="checkbox",i.id=e,i.checked=!0,n.appendChild(i);const s=document.createElement("label");s.setAttribute("for",e),s.textContent=t,n.appendChild(s),i.addEventListener("change",a=>{this.map.setLayoutProperty(e,"visibility",a.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features,n=document.getElementById("map"),i=document.createElement("nav");i.id="filter-group",n.appendChild(i);const s=document.getElementById("filter-group");this.map.addSource(`${e.id}`,{type:e.type,data:t}),t.features.forEach(a=>{const o=a.properties.icon,u=`poi-${o}`;if(!this.map.getLayer(u)){this.map.addLayer({id:u,type:"circle",source:`${e.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",o]},this._firstSymbolLayer());const d=document.createElement("input");d.type="checkbox",d.id=u,d.checked=!0,s.appendChild(d);const p=document.createElement("label");p.setAttribute("for",u),p.textContent=o,s.appendChild(p),d.addEventListener("change",_=>{this.map.setLayoutProperty(u,"visibility",_.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Mo.NavigationControl(e),t)}catch(n){return console.error(`Error creating navigation control: ${n.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Mo.NavigationControl(e),t)}catch(n){console.error(`Error adding navigation control: ${n.message}`)}}addAttributionControl(e,t){try{this.map.addControl(new Mo.AttributionControl(e),t)}catch(n){console.error(`Error adding attribution control: ${n.message}`)}}addImageLayerICGC(e,t,n){try{let i=null,s,a;n?(a=n,s=n.layerPosition):a={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:X0},i=this._findImageType(e,bs.Orto,bs.VectorAdmin,bs.WMS,bs.Vector),i||console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let o={id:t,tiles:e};this.addLayerWMS(e,t,a)}catch(i){console.error(`Error adding ICGC image layer: ${i.message}`)}}async addVectorLayerICGC(e,t,n){try{let{type:i="line",layerPosition:s=X0,layoutOptions:a={visibility:"visible"},paintOption:o}=n||{},u=this._dealOrderLayer(s);if(!e){console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");return}if(e.includes("https")){let d=this._getKeyByUrlVector(e);this.map.addSource(d,{type:"vector",url:e});let p={id:d,type:"fill",source:d,"source-layer":"cobertes",maxzoom:18,layout:n.layout,paint:Kue.cobertesSol};if(d==="cobertes2018"&&this.map.addLayer(p,u),a.visibility==="visible"){let _=this._getLegendByName(d);this.addLegend(_,d)}}else{let d=t;this.map.addSource(d,{type:"vector",url:hi.limitsUrl});let p={id:t,type:i,source:d,"source-layer":e,layout:n.layout,paint:n.paint||{}};i==="fill"||i==="polygon"?p.paint=o||{"fill-color":"#0000FF","fill-opacity":0}:i==="line"&&(p.paint=o||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(p,u)}}catch(i){console.error(`Error adding ICGC vector layer: ${i.message}`)}}async addFGBLayerICGC(e,t,n){try{n||(n.layout={visibility:!0},n.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},n.type="lines",n.layerPosition="labels");let i=this._dealOrderLayer(n.layerPosition);const s=await fetch(e),a={type:"FeatureCollection",features:[]};for await(const u of HS(s.body))a.features.push(u);let o=t;this.map.addSource(o,{type:"geojson",data:a}),e.includes("text")?this.map.addLayer({id:t,type:"symbol",source:o,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},i):this.map.addLayer({id:t,type:n.type,source:o,layout:n.layout,paint:n.paint},i)}catch(i){console.error(`Error adding ICGC FGB layer: ${i.message}`)}}addTerrainICGC(e,t){try{let n;for(const s in bm)if(bm.hasOwnProperty(s)){const a=bm[s];a===e&&(n=a)}let i=n;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(a=>{a.source==="terrainICGC"&&this.removeLayer(a.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(e.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:256,maxzoom:14,minzoom:7})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t==null||this.map.addControl(new SH({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(n){console.error(`Error adding 3D terrain: ${n.message}`)}}addLegend(e,t){try{this.map.addControl(new mce({url:e,idLayer:t}))}catch(n){console.error(`Error adding legend: ${n.message}`)}}_findImageType(e,t,n,i,s){const a=[t,n,i,s];for(const o of a)for(const[u,d]of Object.entries(o))if(d===e)return u;return null}_getKeyByUrlFGB(e){for(const t in bs.FGBAdmin)if(bs.FGBAdmin.hasOwnProperty(t)&&bs.FGBAdmin[t]===e)return t;return null}_getLegendByName(e){for(const t in hi.vectorLayers){const n=hi.vectorLayers[t];if(n.key===e)return n.legend}return null}_getKeyByUrlVector(e){for(const t in bs.Vector)if(bs.Vector.hasOwnProperty(t)&&bs.Vector[t]===e)return t;return null}async _raiseText3DStyle(){try{const e=await this.map.loadImage(hi.map3dOptions.imageIcon);this.map.hasImage("stick")||this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===hi.map3dOptions.sourceLayerFilterId&&t.minzoom>=hi.map3dOptions.minZoomFilter&&e){const n=t.id;this.map.setLayoutProperty(n,"icon-image","stick"),this.map.setLayoutProperty(n,"text-offset",[0,-9]),this.map.setLayoutProperty(n,"symbol-placement","point"),this.map.setLayoutProperty(n,"symbol-avoid-edges",!1),this.map.setLayoutProperty(n,"text-allow-overlap",!0),this.map.setLayoutProperty(n,"text-ignore-placement",!1),this.map.setLayoutProperty(n,"text-pitch-alignment","auto"),this.map.setLayoutProperty(n,"text-rotation-alignment","auto"),this.map.setLayoutProperty(n,"text-justify","center"),this.map.setLayoutProperty(n,"text-anchor","bottom"),this.map.setLayoutProperty(n,"icon-anchor","bottom"),this.map.setPaintProperty(n,"text-color","#ffffff"),this.map.setPaintProperty(n,"text-halo-color","#000000"),this.map.setPaintProperty(n,"text-halo-width",2)}})}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in Jf)if(Jf.hasOwnProperty(t)){const n=Jf[t];if(t===e)return n}return Jf[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}_dealOrto3dStyle(e){try{if(e=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new nP({intensity:4}),n=new Kw({ambientLight:t});this.map.setTerrain({source:hi.map3dOptions.terrainSource,exaggeration:hi.map3dOptions.exaggeration}),Sl=new Vee({interleaved:!0,layers:[this._createCitiesMapboxLayer(!1)],effects:[n],onAfterRender:()=>{try{const s=this.map.getZoom()>=hi.map3dOptions.minZoomRange;Sl.setProps({layers:[this._createCitiesMapboxLayer(s)]})}catch{console.log("No render 3D Mesh")}}}),this.map.hasControl(Sl)||(this.map.addControl(Sl),this._raiseText3DStyle()),this.map.setSky({"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}),this.map.on("zoomend",()=>{!this.map.getStyle().name=="orto3d"&&this.map.hasControl(Sl)&&(this.map.removeControl(Sl),Sl.setProps({layers:[]}),this.map.setTerrain(null))})}else Sl==null||Sl.setProps({layers:[]}),this.map.hasControl(Sl)&&(this.map.removeControl(Sl),Sl.setProps({layers:[]}),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealOrderLayer(e){return e===X0?this._firstSymbolLayer():e===Wue?this._firstLineLayer():""}_firstSymbolLayer(){try{const e=this.map.getStyle().layers;let t;for(let n=0;n<e.length;n++)if(e[n].type==="symbol"&&e[n].id.indexOf("contour")===-1&&e[n].id.indexOf("water")===-1){t=e[n].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_firstLineLayer(){try{const e=this.map.getStyle().layers;let t;for(let n=0;n<e.length;n++)if(e[n].type==="line"){t=e[n].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_createCitiesMapboxLayer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;try{return new Fx({id:hi.map3dOptions.layerId3d,data:hi.map3dOptions.urlTilesetCities,loader:Px,beforeId:hi.map3dOptions.layerIdOrder,visible:e,loadOptions:{tileset:{viewDistanceScale:1,memoryAdjustedScreenSpaceError:hi.map3dOptions.spaceErrorFactor,updateTransforms:!0,adjustScreenSpaceError:hi.map3dOptions.spaceErrorFactor}},onTilesetLoad:t=>{t.adjustScreenSpaceError=hi.map3dOptions.spaceErrorFactor,t.memoryAdjustedScreenSpaceError=hi.map3dOptions.spaceErrorFactor},onTileLoad:t=>{t.content.cartographicOrigin.z-=hi.map3dOptions.zfactor},operation:"terrain+draw",pickable:!1})}catch(t){return console.error(`Error adding MapboxOverlay: ${t.message}`),null}}};var BB={exports:{}},CB,MO;function Yue(){if(MO)return CB;MO=1;function r(t,n){var i=t.getCenter(),s=t.getZoom(),a=t.getBearing(),o=t.getPitch();n.forEach(function(u){u.jumpTo({center:i,zoom:s,bearing:a,pitch:o})})}function e(){var t,n=arguments.length;if(n===1)t=arguments[0];else{t=[];for(var i=0;i<n;i++)t.push(arguments[i])}var s=[];t.forEach(function(d,p){s[p]=u.bind(null,d,t.filter(function(_,w){return w!==p}))});function a(){t.forEach(function(d,p){d.on("move",s[p])})}function o(){t.forEach(function(d,p){d.off("move",s[p])})}function u(d,p){o(),r(d,p),a()}return a(),function(){o(),s=[],t=[]}}return CB=e,CB}var Y0={exports:{}},PO;function Zue(){if(PO)return Y0.exports;PO=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function($,q,te){return Function.prototype.apply.call($,q,te)},t;r&&typeof r.ownKeys=="function"?t=r.ownKeys:Object.getOwnPropertySymbols?t=function($){return Object.getOwnPropertyNames($).concat(Object.getOwnPropertySymbols($))}:t=function($){return Object.getOwnPropertyNames($)};function n(V){console&&console.warn&&console.warn(V)}var i=Number.isNaN||function($){return $!==$};function s(){s.init.call(this)}Y0.exports=s,Y0.exports.once=N,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(V){if(typeof V!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof V)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(V){if(typeof V!="number"||V<0||i(V))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+V+".");a=V}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function($){if(typeof $!="number"||$<0||i($))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+$+".");return this._maxListeners=$,this};function u(V){return V._maxListeners===void 0?s.defaultMaxListeners:V._maxListeners}s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function($){for(var q=[],te=1;te<arguments.length;te++)q.push(arguments[te]);var J=$==="error",me=this._events;if(me!==void 0)J=J&&me.error===void 0;else if(!J)return!1;if(J){var xe;if(q.length>0&&(xe=q[0]),xe instanceof Error)throw xe;var se=new Error("Unhandled error."+(xe?" ("+xe.message+")":""));throw se.context=xe,se}var oe=me[$];if(oe===void 0)return!1;if(typeof oe=="function")e(oe,this,q);else for(var ve=oe.length,ge=M(oe,ve),te=0;te<ve;++te)e(ge[te],this,q);return!0};function d(V,$,q,te){var J,me,xe;if(o(q),me=V._events,me===void 0?(me=V._events=Object.create(null),V._eventsCount=0):(me.newListener!==void 0&&(V.emit("newListener",$,q.listener?q.listener:q),me=V._events),xe=me[$]),xe===void 0)xe=me[$]=q,++V._eventsCount;else if(typeof xe=="function"?xe=me[$]=te?[q,xe]:[xe,q]:te?xe.unshift(q):xe.push(q),J=u(V),J>0&&xe.length>J&&!xe.warned){xe.warned=!0;var se=new Error("Possible EventEmitter memory leak detected. "+xe.length+" "+String($)+" listeners added. Use emitter.setMaxListeners() to increase limit");se.name="MaxListenersExceededWarning",se.emitter=V,se.type=$,se.count=xe.length,n(se)}return V}s.prototype.addListener=function($,q){return d(this,$,q,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function($,q){return d(this,$,q,!0)};function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(V,$,q){var te={fired:!1,wrapFn:void 0,target:V,type:$,listener:q},J=p.bind(te);return J.listener=q,te.wrapFn=J,J}s.prototype.once=function($,q){return o(q),this.on($,_(this,$,q)),this},s.prototype.prependOnceListener=function($,q){return o(q),this.prependListener($,_(this,$,q)),this},s.prototype.removeListener=function($,q){var te,J,me,xe,se;if(o(q),J=this._events,J===void 0)return this;if(te=J[$],te===void 0)return this;if(te===q||te.listener===q)--this._eventsCount===0?this._events=Object.create(null):(delete J[$],J.removeListener&&this.emit("removeListener",$,te.listener||q));else if(typeof te!="function"){for(me=-1,xe=te.length-1;xe>=0;xe--)if(te[xe]===q||te[xe].listener===q){se=te[xe].listener,me=xe;break}if(me<0)return this;me===0?te.shift():P(te,me),te.length===1&&(J[$]=te[0]),J.removeListener!==void 0&&this.emit("removeListener",$,se||q)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function($){var q,te,J;if(te=this._events,te===void 0)return this;if(te.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):te[$]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete te[$]),this;if(arguments.length===0){var me=Object.keys(te),xe;for(J=0;J<me.length;++J)xe=me[J],xe!=="removeListener"&&this.removeAllListeners(xe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(q=te[$],typeof q=="function")this.removeListener($,q);else if(q!==void 0)for(J=q.length-1;J>=0;J--)this.removeListener($,q[J]);return this};function w(V,$,q){var te=V._events;if(te===void 0)return[];var J=te[$];return J===void 0?[]:typeof J=="function"?q?[J.listener||J]:[J]:q?D(J):M(J,J.length)}s.prototype.listeners=function($){return w(this,$,!0)},s.prototype.rawListeners=function($){return w(this,$,!1)},s.listenerCount=function(V,$){return typeof V.listenerCount=="function"?V.listenerCount($):v.call(V,$)},s.prototype.listenerCount=v;function v(V){var $=this._events;if($!==void 0){var q=$[V];if(typeof q=="function")return 1;if(q!==void 0)return q.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function M(V,$){for(var q=new Array($),te=0;te<$;++te)q[te]=V[te];return q}function P(V,$){for(;$+1<V.length;$++)V[$]=V[$+1];V.pop()}function D(V){for(var $=new Array(V.length),q=0;q<$.length;++q)$[q]=V[q].listener||V[q];return $}function N(V,$){return new Promise(function(q,te){function J(xe){V.removeListener($,me),te(xe)}function me(){typeof V.removeListener=="function"&&V.removeListener("error",J),q([].slice.call(arguments))}W(V,$,me,{once:!0}),$!=="error"&&z(V,J,{once:!0})})}function z(V,$,q){typeof V.on=="function"&&W(V,"error",$,q)}function W(V,$,q,te){if(typeof V.on=="function")te.once?V.once($,q):V.on($,q);else if(typeof V.addEventListener=="function")V.addEventListener($,function J(me){te.once&&V.removeEventListener($,J),q(me)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof V)}return Y0.exports}var FO;function Jue(){return FO||(FO=1,function(r){var e=Yue(),t=Zue().EventEmitter;function n(i,s,a,o){if(this.options=o||{},this._mapA=i,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new t,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof a=="string"&&document.body.querySelectorAll){var u=document.body.querySelectorAll(a)[0];if(!u)throw new Error("Cannot find element with specified container selector.");u.appendChild(this._controlContainer)}else if(a instanceof Element&&a.appendChild)a.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();var d=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(d),this._clearSync=e(i,s),this._onResize=(function(){this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),s.on("resize",this._onResize),this.options&&this.options.mousemove&&(i.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}n.prototype={_setPointerEvents:function(i){this._controlContainer.style.pointerEvents=i,this._swiper.style.pointerEvents=i},_onDown:function(i){i.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(i){i=Math.min(i,this._horizontal?this._bounds.height:this._bounds.width);var s=this._horizontal?"translate(0, "+i+"px)":"translate("+i+"px, 0)";this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;var a=this._horizontal?"rect(0, 999em, "+i+"px, 0)":"rect(0, "+i+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+i+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+i+"px)";this._mapA.getContainer().style.clip=a,this._mapB.getContainer().style.clip=o,this.currentPosition=i},_onMove:function(i){this.options&&this.options.mousemove&&this._setPointerEvents(i.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(i)):this._setPosition(this._getX(i))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(i){i=i.touches?i.touches[0]:i;var s=i.clientX-this._bounds.left;return s<0&&(s=0),s>this._bounds.width&&(s=this._bounds.width),s},_getY:function(i){i=i.touches?i.touches[0]:i;var s=i.clientY-this._bounds.top;return s<0&&(s=0),s>this._bounds.height&&(s=this._bounds.height),s},setSlider:function(i){this._setPosition(i)},on:function(i,s){return this._ev.on(i,s),this},fire:function(i,s){return this._ev.emit(i,s),this},off:function(i,s){return this._ev.removeListener(i,s),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var i=this._mapA.getContainer();i&&(i.style.clip=null,i.removeEventListener("mousemove",this._onMove));var s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=n:r.exports=n}(BB)),BB.exports}var ehe=Jue();const the=Ra(ehe);class rhe{constructor(e,t,n,i){const s=this;setTimeout(function(){s.mapCompare=new the(e.map,t.map,n,{})},1e3)}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var TB=function(r,e){return TB=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},TB(r,e)};function eu(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");TB(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var EB=function(){return EB=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},EB.apply(this,arguments)};function La(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(p){try{d(n.next(p))}catch(_){a(_)}}function u(p){try{d(n.throw(p))}catch(_){a(_)}}function d(p){p.done?s(p.value):i(p.value).then(o,u)}d((n=n.apply(r,[])).next())})}function _a(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(d){return function(p){return u([d,p])}}function u(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=d[0]&2?i.return:d[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,d[1])).done)return s;switch(i=0,s&&(d=[d[0]&2,s.value]),d[0]){case 0:case 1:s=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!s||d[1]>s[0]&&d[1]<s[3])){t.label=d[1];break}if(d[0]===6&&t.label<s[1]){t.label=s[1],s=d;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(d);break}s[2]&&t.ops.pop(),t.trys.pop();continue}d=e.call(r,t)}catch(p){d=[6,p],i=0}finally{n=s=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function Z0(r,e,t){if(arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||e)}for(var Oh=function(){function r(e,t,n,i){this.left=e,this.top=t,this.width=n,this.height=i}return r.prototype.add=function(e,t,n,i){return new r(this.left+e,this.top+t,this.width+n,this.height+i)},r.fromClientRect=function(e,t){return new r(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)},r.fromDOMRectList=function(e,t){var n=Array.from(t).find(function(i){return i.width!==0});return n?new r(n.left+e.windowBounds.left,n.top+e.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),J0=function(r,e){return Oh.fromClientRect(r,e.getBoundingClientRect())},nhe=function(r){var e=r.body,t=r.documentElement;if(!e||!t)throw new Error("Unable to get document size");var n=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),i=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new Oh(0,0,n,i)},e1=function(r){for(var e=[],t=0,n=r.length;t<n;){var i=r.charCodeAt(t++);if(i>=55296&&i<=56319&&t<n){var s=r.charCodeAt(t++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),t--)}else e.push(i)}return e},Ns=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var n=[],i=-1,s="";++i<t;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===t||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},RO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ihe=typeof Uint8Array>"u"?[]:new Uint8Array(256),t1=0;t1<RO.length;t1++)ihe[RO.charCodeAt(t1)]=t1;for(var LO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vm=typeof Uint8Array>"u"?[]:new Uint8Array(256),r1=0;r1<LO.length;r1++)vm[LO.charCodeAt(r1)]=r1;for(var she=function(r){var e=r.length*.75,t=r.length,n,i=0,s,a,o,u;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var d=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),p=Array.isArray(d)?d:new Uint8Array(d);for(n=0;n<t;n+=4)s=vm[r.charCodeAt(n)],a=vm[r.charCodeAt(n+1)],o=vm[r.charCodeAt(n+2)],u=vm[r.charCodeAt(n+3)],p[i++]=s<<2|a>>4,p[i++]=(a&15)<<4|o>>2,p[i++]=(o&3)<<6|u&63;return d},ohe=function(r){for(var e=r.length,t=[],n=0;n<e;n+=2)t.push(r[n+1]<<8|r[n]);return t},ahe=function(r){for(var e=r.length,t=[],n=0;n<e;n+=4)t.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return t},ed=5,SB=11,IB=2,lhe=SB-ed,OO=65536>>ed,che=1<<ed,MB=che-1,uhe=1024>>ed,hhe=OO+uhe,Ahe=hhe,fhe=32,dhe=Ahe+fhe,phe=65536>>SB,ghe=1<<lhe,mhe=ghe-1,UO=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},_he=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},yhe=function(r,e){var t=she(r),n=Array.isArray(t)?ahe(t):new Uint32Array(t),i=Array.isArray(t)?ohe(t):new Uint16Array(t),s=24,a=UO(i,s/2,n[4]/2),o=n[5]===2?UO(i,(s+n[4])/2):_he(n,Math.ceil((s+n[4])/4));return new bhe(n[0],n[1],n[2],n[3],a,o)},bhe=function(){function r(e,t,n,i,s,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>ed],t=(t<<IB)+(e&MB),this.data[t];if(e<=65535)return t=this.index[OO+(e-55296>>ed)],t=(t<<IB)+(e&MB),this.data[t];if(e<this.highStart)return t=dhe-phe+(e>>SB),t=this.index[t],t+=e>>ed&mhe,t=this.index[t],t=(t<<IB)+(e&MB),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),DO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vhe=typeof Uint8Array>"u"?[]:new Uint8Array(256),n1=0;n1<DO.length;n1++)vhe[DO.charCodeAt(n1)]=n1;var whe="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",NO=50,xhe=1,kO=2,QO=3,Bhe=4,Che=5,zO=7,HO=8,VO=9,NA=10,PB=11,jO=12,FB=13,The=14,wm=15,RB=16,i1=17,xm=18,Ehe=19,$O=20,LB=21,Bm=22,OB=23,Fp=24,Il=25,Cm=26,Tm=27,Rp=28,She=29,Lp=30,Ihe=31,s1=32,o1=33,UB=34,DB=35,NB=36,Em=37,kB=38,a1=39,l1=40,QB=41,GO=42,Mhe=43,Phe=[9001,65288],qO="!",Oa="×",c1="÷",zB=yhe(whe),Uh=[Lp,NB],HB=[xhe,kO,QO,Che],KO=[NA,HO],WO=[Tm,Cm],Fhe=HB.concat(KO),XO=[kB,a1,l1,UB,DB],Rhe=[wm,FB],Lhe=function(r,e){e===void 0&&(e="strict");var t=[],n=[],i=[];return r.forEach(function(s,a){var o=zB.get(s);if(o>NO?(i.push(!0),o-=NO):i.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return n.push(a),t.push(RB);if(o===Bhe||o===PB){if(a===0)return n.push(a),t.push(Lp);var u=t[a-1];return Fhe.indexOf(u)===-1?(n.push(n[a-1]),t.push(u)):(n.push(a),t.push(Lp))}if(n.push(a),o===Ihe)return t.push(e==="strict"?LB:Em);if(o===GO||o===She)return t.push(Lp);if(o===Mhe)return s>=131072&&s<=196605||s>=196608&&s<=262141?t.push(Em):t.push(Lp);t.push(o)}),[n,t,i]},VB=function(r,e,t,n){var i=n[t];if(Array.isArray(r)?r.indexOf(i)!==-1:r===i)for(var s=t;s<=n.length;){s++;var a=n[s];if(a===e)return!0;if(a!==NA)break}if(i===NA)for(var s=t;s>0;){s--;var o=n[s];if(Array.isArray(r)?r.indexOf(o)!==-1:r===o)for(var u=t;u<=n.length;){u++;var a=n[u];if(a===e)return!0;if(a!==NA)break}if(o!==NA)break}return!1},YO=function(r,e){for(var t=r;t>=0;){var n=e[t];if(n===NA)t--;else return n}return 0},Ohe=function(r,e,t,n,i){if(t[n]===0)return Oa;var s=n-1;if(Array.isArray(i)&&i[s]===!0)return Oa;var a=s-1,o=s+1,u=e[s],d=a>=0?e[a]:0,p=e[o];if(u===kO&&p===QO)return Oa;if(HB.indexOf(u)!==-1)return qO;if(HB.indexOf(p)!==-1||KO.indexOf(p)!==-1)return Oa;if(YO(s,e)===HO)return c1;if(zB.get(r[s])===PB||(u===s1||u===o1)&&zB.get(r[o])===PB||u===zO||p===zO||u===VO||[NA,FB,wm].indexOf(u)===-1&&p===VO||[i1,xm,Ehe,Fp,Rp].indexOf(p)!==-1||YO(s,e)===Bm||VB(OB,Bm,s,e)||VB([i1,xm],LB,s,e)||VB(jO,jO,s,e))return Oa;if(u===NA)return c1;if(u===OB||p===OB)return Oa;if(p===RB||u===RB)return c1;if([FB,wm,LB].indexOf(p)!==-1||u===The||d===NB&&Rhe.indexOf(u)!==-1||u===Rp&&p===NB||p===$O||Uh.indexOf(p)!==-1&&u===Il||Uh.indexOf(u)!==-1&&p===Il||u===Tm&&[Em,s1,o1].indexOf(p)!==-1||[Em,s1,o1].indexOf(u)!==-1&&p===Cm||Uh.indexOf(u)!==-1&&WO.indexOf(p)!==-1||WO.indexOf(u)!==-1&&Uh.indexOf(p)!==-1||[Tm,Cm].indexOf(u)!==-1&&(p===Il||[Bm,wm].indexOf(p)!==-1&&e[o+1]===Il)||[Bm,wm].indexOf(u)!==-1&&p===Il||u===Il&&[Il,Rp,Fp].indexOf(p)!==-1)return Oa;if([Il,Rp,Fp,i1,xm].indexOf(p)!==-1)for(var _=s;_>=0;){var w=e[_];if(w===Il)return Oa;if([Rp,Fp].indexOf(w)!==-1)_--;else break}if([Tm,Cm].indexOf(p)!==-1)for(var _=[i1,xm].indexOf(u)!==-1?a:s;_>=0;){var w=e[_];if(w===Il)return Oa;if([Rp,Fp].indexOf(w)!==-1)_--;else break}if(kB===u&&[kB,a1,UB,DB].indexOf(p)!==-1||[a1,UB].indexOf(u)!==-1&&[a1,l1].indexOf(p)!==-1||[l1,DB].indexOf(u)!==-1&&p===l1||XO.indexOf(u)!==-1&&[$O,Cm].indexOf(p)!==-1||XO.indexOf(p)!==-1&&u===Tm||Uh.indexOf(u)!==-1&&Uh.indexOf(p)!==-1||u===Fp&&Uh.indexOf(p)!==-1||Uh.concat(Il).indexOf(u)!==-1&&p===Bm&&Phe.indexOf(r[o])===-1||Uh.concat(Il).indexOf(p)!==-1&&u===xm)return Oa;if(u===QB&&p===QB){for(var v=t[s],M=1;v>0&&(v--,e[v]===QB);)M++;if(M%2!==0)return Oa}return u===s1&&p===o1?Oa:c1},Uhe=function(r,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var t=Lhe(r,e.lineBreak),n=t[0],i=t[1],s=t[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(i=i.map(function(o){return[Il,Lp,GO].indexOf(o)!==-1?Em:o}));var a=e.wordBreak==="keep-all"?s.map(function(o,u){return o&&r[u]>=19968&&r[u]<=40959}):void 0;return[n,i,a]},Dhe=function(){function r(e,t,n,i){this.codePoints=e,this.required=t===qO,this.start=n,this.end=i}return r.prototype.slice=function(){return Ns.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),Nhe=function(r,e){var t=e1(r),n=Uhe(t,e),i=n[0],s=n[1],a=n[2],o=t.length,u=0,d=0;return{next:function(){if(d>=o)return{done:!0,value:null};for(var p=Oa;d<o&&(p=Ohe(t,s,i,++d,a))===Oa;);if(p!==Oa||d===o){var _=new Dhe(t,p,u,d);return u=d,{value:_,done:!1}}return{done:!0,value:null}}}},khe=1,Qhe=2,Sm=4,ZO=8,u1=10,JO=47,Im=92,zhe=9,Hhe=32,h1=34,Mm=61,Vhe=35,jhe=36,$he=37,A1=39,f1=40,Pm=41,Ghe=95,ol=45,qhe=33,Khe=60,Whe=62,Xhe=64,Yhe=91,Zhe=93,Jhe=61,eAe=123,d1=63,tAe=125,eU=124,rAe=126,nAe=128,tU=65533,jB=42,td=43,iAe=44,sAe=58,oAe=59,Fm=46,aAe=0,lAe=8,cAe=11,uAe=14,hAe=31,AAe=127,th=-1,rU=48,nU=97,iU=101,fAe=102,dAe=117,pAe=122,sU=65,oU=69,aU=70,gAe=85,mAe=90,Ua=function(r){return r>=rU&&r<=57},_Ae=function(r){return r>=55296&&r<=57343},Op=function(r){return Ua(r)||r>=sU&&r<=aU||r>=nU&&r<=fAe},yAe=function(r){return r>=nU&&r<=pAe},bAe=function(r){return r>=sU&&r<=mAe},vAe=function(r){return yAe(r)||bAe(r)},wAe=function(r){return r>=nAe},p1=function(r){return r===u1||r===zhe||r===Hhe},g1=function(r){return vAe(r)||wAe(r)||r===Ghe},lU=function(r){return g1(r)||Ua(r)||r===ol},xAe=function(r){return r>=aAe&&r<=lAe||r===cAe||r>=uAe&&r<=hAe||r===AAe},kA=function(r,e){return r!==Im?!1:e!==u1},m1=function(r,e,t){return r===ol?g1(e)||kA(e,t):g1(r)?!0:!!(r===Im&&kA(r,e))},$B=function(r,e,t){return r===td||r===ol?Ua(e)?!0:e===Fm&&Ua(t):Ua(r===Fm?e:r)},BAe=function(r){var e=0,t=1;(r[e]===td||r[e]===ol)&&(r[e]===ol&&(t=-1),e++);for(var n=[];Ua(r[e]);)n.push(r[e++]);var i=n.length?parseInt(Ns.apply(void 0,n),10):0;r[e]===Fm&&e++;for(var s=[];Ua(r[e]);)s.push(r[e++]);var a=s.length,o=a?parseInt(Ns.apply(void 0,s),10):0;(r[e]===oU||r[e]===iU)&&e++;var u=1;(r[e]===td||r[e]===ol)&&(r[e]===ol&&(u=-1),e++);for(var d=[];Ua(r[e]);)d.push(r[e++]);var p=d.length?parseInt(Ns.apply(void 0,d),10):0;return t*(i+o*Math.pow(10,-a))*Math.pow(10,u*p)},CAe={type:2},TAe={type:3},EAe={type:4},SAe={type:13},IAe={type:8},MAe={type:21},PAe={type:9},FAe={type:10},RAe={type:11},LAe={type:12},OAe={type:14},_1={type:23},UAe={type:1},DAe={type:25},NAe={type:24},kAe={type:26},QAe={type:27},zAe={type:28},HAe={type:29},VAe={type:31},GB={type:32},cU=function(){function r(){this._value=[]}return r.prototype.write=function(e){this._value=this._value.concat(e1(e))},r.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==GB;)e.push(t),t=this.consumeToken();return e},r.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case h1:return this.consumeStringToken(h1);case Vhe:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),i=this.peekCodePoint(2);if(lU(t)||kA(n,i)){var s=m1(t,n,i)?Qhe:khe,a=this.consumeName();return{type:5,value:a,flags:s}}break;case jhe:if(this.peekCodePoint(0)===Mm)return this.consumeCodePoint(),SAe;break;case A1:return this.consumeStringToken(A1);case f1:return CAe;case Pm:return TAe;case jB:if(this.peekCodePoint(0)===Mm)return this.consumeCodePoint(),OAe;break;case td:if($B(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case iAe:return EAe;case ol:var o=e,u=this.peekCodePoint(0),d=this.peekCodePoint(1);if($B(o,u,d))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(m1(o,u,d))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(u===ol&&d===Whe)return this.consumeCodePoint(),this.consumeCodePoint(),NAe;break;case Fm:if($B(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case JO:if(this.peekCodePoint(0)===jB)for(this.consumeCodePoint();;){var p=this.consumeCodePoint();if(p===jB&&(p=this.consumeCodePoint(),p===JO))return this.consumeToken();if(p===th)return this.consumeToken()}break;case sAe:return kAe;case oAe:return QAe;case Khe:if(this.peekCodePoint(0)===qhe&&this.peekCodePoint(1)===ol&&this.peekCodePoint(2)===ol)return this.consumeCodePoint(),this.consumeCodePoint(),DAe;break;case Xhe:var _=this.peekCodePoint(0),w=this.peekCodePoint(1),v=this.peekCodePoint(2);if(m1(_,w,v)){var a=this.consumeName();return{type:7,value:a}}break;case Yhe:return zAe;case Im:if(kA(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case Zhe:return HAe;case Jhe:if(this.peekCodePoint(0)===Mm)return this.consumeCodePoint(),IAe;break;case eAe:return RAe;case tAe:return LAe;case dAe:case gAe:var M=this.peekCodePoint(0),P=this.peekCodePoint(1);return M===td&&(Op(P)||P===d1)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case eU:if(this.peekCodePoint(0)===Mm)return this.consumeCodePoint(),PAe;if(this.peekCodePoint(0)===eU)return this.consumeCodePoint(),MAe;break;case rAe:if(this.peekCodePoint(0)===Mm)return this.consumeCodePoint(),FAe;break;case th:return GB}return p1(e)?(this.consumeWhiteSpace(),VAe):Ua(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):g1(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:Ns(e)}},r.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},r.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},r.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},r.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();Op(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;t===d1&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n){var i=parseInt(Ns.apply(void 0,e.map(function(u){return u===d1?rU:u})),16),s=parseInt(Ns.apply(void 0,e.map(function(u){return u===d1?aU:u})),16);return{type:30,start:i,end:s}}var a=parseInt(Ns.apply(void 0,e),16);if(this.peekCodePoint(0)===ol&&Op(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var o=[];Op(t)&&o.length<6;)o.push(t),t=this.consumeCodePoint();var s=parseInt(Ns.apply(void 0,o),16);return{type:30,start:a,end:s}}else return{type:30,start:a,end:a}},r.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===f1?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===f1?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},r.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===th)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===A1||t===h1){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===th||this.peekCodePoint(0)===Pm)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),_1)}for(;;){var i=this.consumeCodePoint();if(i===th||i===Pm)return{type:22,value:Ns.apply(void 0,e)};if(p1(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===th||this.peekCodePoint(0)===Pm?(this.consumeCodePoint(),{type:22,value:Ns.apply(void 0,e)}):(this.consumeBadUrlRemnants(),_1);if(i===h1||i===A1||i===f1||xAe(i))return this.consumeBadUrlRemnants(),_1;if(i===Im)if(kA(i,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),_1;else e.push(i)}},r.prototype.consumeWhiteSpace=function(){for(;p1(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===Pm||e===th)return;kA(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(e){for(var t=5e4,n="";e>0;){var i=Math.min(t,e);n+=Ns.apply(void 0,this._value.splice(0,i)),e-=i}return this._value.shift(),n},r.prototype.consumeStringToken=function(e){var t="",n=0;do{var i=this._value[n];if(i===th||i===void 0||i===e)return t+=this.consumeStringSlice(n),{type:0,value:t};if(i===u1)return this._value.splice(0,n),UAe;if(i===Im){var s=this._value[n+1];s!==th&&s!==void 0&&(s===u1?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):kA(i,s)&&(t+=this.consumeStringSlice(n),t+=Ns(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var e=[],t=Sm,n=this.peekCodePoint(0);for((n===td||n===ol)&&e.push(this.consumeCodePoint());Ua(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(n===Fm&&Ua(i))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=ZO;Ua(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((n===oU||n===iU)&&((i===td||i===ol)&&Ua(s)||Ua(i)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=ZO;Ua(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[BAe(e),t]},r.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),a=this.peekCodePoint(2);if(m1(i,s,a)){var o=this.consumeName();return{type:15,number:t,flags:n,unit:o}}return i===$he?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Op(e)){for(var t=Ns(e);Op(this.peekCodePoint(0))&&t.length<6;)t+=Ns(this.consumeCodePoint());p1(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return n===0||_Ae(n)||n>1114111?tU:n}return e===th?tU:e},r.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(lU(t))e+=Ns(t);else if(kA(t,this.peekCodePoint(0)))e+=Ns(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(t),e}},r}(),uU=function(){function r(e){this._tokens=e}return r.create=function(e){var t=new cU;return t.write(e),new r(t.read())},r.parseValue=function(e){return r.create(e).parseComponentValue()},r.parseValues=function(e){return r.create(e).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t),e.push()}},r.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},r.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(n.type===32||$Ae(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?GB:e},r.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},r}(),Rm=function(r){return r.type===15},Up=function(r){return r.type===17},Ci=function(r){return r.type===20},jAe=function(r){return r.type===0},qB=function(r,e){return Ci(r)&&r.value===e},hU=function(r){return r.type!==31},Dp=function(r){return r.type!==31&&r.type!==4},rh=function(r){var e=[],t=[];return r.forEach(function(n){if(n.type===4){if(t.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(t),t=[];return}n.type!==31&&t.push(n)}),t.length&&e.push(t),e},$Ae=function(r,e){return e===11&&r.type===12||e===28&&r.type===29?!0:e===2&&r.type===3},QA=function(r){return r.type===17||r.type===15},no=function(r){return r.type===16||QA(r)},AU=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},Go={type:17,number:0,flags:Sm},KB={type:16,number:50,flags:Sm},zA={type:16,number:100,flags:Sm},Lm=function(r,e,t){var n=r[0],i=r[1];return[Hi(n,e),Hi(typeof i<"u"?i:n,t)]},Hi=function(r,e){if(r.type===16)return r.number/100*e;if(Rm(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},fU="deg",dU="grad",pU="rad",gU="turn",y1={name:"angle",parse:function(r,e){if(e.type===15)switch(e.unit){case fU:return Math.PI*e.number/180;case dU:return Math.PI/200*e.number;case pU:return e.number;case gU:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},mU=function(r){return r.type===15&&(r.unit===fU||r.unit===dU||r.unit===pU||r.unit===gU)},_U=function(r){var e=r.filter(Ci).map(function(t){return t.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Go,Go];case"to top":case"bottom":return rc(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Go,zA];case"to right":case"left":return rc(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[zA,zA];case"to bottom":case"top":return rc(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[zA,Go];case"to left":case"right":return rc(270)}return 0},rc=function(r){return Math.PI*r/180},HA={name:"color",parse:function(r,e){if(e.type===18){var t=GAe[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(r,e.values)}if(e.type===5){if(e.value.length===3){var n=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3);return jA(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(e.value.length===4){var n=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3),a=e.value.substring(3,4);return jA(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(a+a,16)/255)}if(e.value.length===6){var n=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6);return jA(parseInt(n,16),parseInt(i,16),parseInt(s,16),1)}if(e.value.length===8){var n=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6),a=e.value.substring(6,8);return jA(parseInt(n,16),parseInt(i,16),parseInt(s,16),parseInt(a,16)/255)}}if(e.type===20){var o=Dh[e.value.toUpperCase()];if(typeof o<"u")return o}return Dh.TRANSPARENT}},VA=function(r){return(255&r)===0},Oo=function(r){var e=255&r,t=255&r>>8,n=255&r>>16,i=255&r>>24;return e<255?"rgba("+i+","+n+","+t+","+e/255+")":"rgb("+i+","+n+","+t+")"},jA=function(r,e,t,n){return(r<<24|e<<16|t<<8|Math.round(n*255)<<0)>>>0},yU=function(r,e){if(r.type===17)return r.number;if(r.type===16){var t=e===3?1:255;return e===3?r.number/100*t:Math.round(r.number/100*t)}return 0},bU=function(r,e){var t=e.filter(Dp);if(t.length===3){var n=t.map(yU),i=n[0],s=n[1],a=n[2];return jA(i,s,a,1)}if(t.length===4){var o=t.map(yU),i=o[0],s=o[1],a=o[2],u=o[3];return jA(i,s,a,u)}return 0};function WB(r,e,t){return t<0&&(t+=1),t>=1&&(t-=1),t<1/6?(e-r)*t*6+r:t<1/2?e:t<2/3?(e-r)*6*(2/3-t)+r:r}var vU=function(r,e){var t=e.filter(Dp),n=t[0],i=t[1],s=t[2],a=t[3],o=(n.type===17?rc(n.number):y1.parse(r,n))/(Math.PI*2),u=no(i)?i.number/100:0,d=no(s)?s.number/100:0,p=typeof a<"u"&&no(a)?Hi(a,1):1;if(u===0)return jA(d*255,d*255,d*255,1);var _=d<=.5?d*(u+1):d+u-d*u,w=d*2-_,v=WB(w,_,o+1/3),M=WB(w,_,o),P=WB(w,_,o-1/3);return jA(v*255,M*255,P*255,p)},GAe={hsl:vU,hsla:vU,rgb:bU,rgba:bU},Om=function(r,e){return HA.parse(r,uU.create(e).parseComponentValue())},Dh={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},qAe={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(Ci(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},KAe={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},b1=function(r,e){var t=HA.parse(r,e[0]),n=e[1];return n&&no(n)?{color:t,stop:n}:{color:t,stop:null}},wU=function(r,e){var t=r[0],n=r[r.length-1];t.stop===null&&(t.stop=Go),n.stop===null&&(n.stop=zA);for(var i=[],s=0,a=0;a<r.length;a++){var o=r[a].stop;if(o!==null){var u=Hi(o,e);u>s?i.push(u):i.push(s),s=u}else i.push(null)}for(var d=null,a=0;a<i.length;a++){var p=i[a];if(p===null)d===null&&(d=a);else if(d!==null){for(var _=a-d,w=i[d-1],v=(p-w)/(_+1),M=1;M<=_;M++)i[d+M-1]=v*M;d=null}}return r.map(function(P,D){var N=P.color;return{color:N,stop:Math.max(Math.min(1,i[D]/e),0)}})},WAe=function(r,e,t){var n=e/2,i=t/2,s=Hi(r[0],e)-n,a=i-Hi(r[1],t);return(Math.atan2(a,s)+Math.PI*2)%(Math.PI*2)},XAe=function(r,e,t){var n=typeof r=="number"?r:WAe(r,e,t),i=Math.abs(e*Math.sin(n))+Math.abs(t*Math.cos(n)),s=e/2,a=t/2,o=i/2,u=Math.sin(n-Math.PI/2)*o,d=Math.cos(n-Math.PI/2)*o;return[i,s-d,s+d,a-u,a+u]},tu=function(r,e){return Math.sqrt(r*r+e*e)},xU=function(r,e,t,n,i){var s=[[0,0],[0,e],[r,0],[r,e]];return s.reduce(function(a,o){var u=o[0],d=o[1],p=tu(t-u,n-d);return(i?p<a.optimumDistance:p>a.optimumDistance)?{optimumCorner:o,optimumDistance:p}:a},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},YAe=function(r,e,t,n,i){var s=0,a=0;switch(r.size){case 0:r.shape===0?s=a=Math.min(Math.abs(e),Math.abs(e-n),Math.abs(t),Math.abs(t-i)):r.shape===1&&(s=Math.min(Math.abs(e),Math.abs(e-n)),a=Math.min(Math.abs(t),Math.abs(t-i)));break;case 2:if(r.shape===0)s=a=Math.min(tu(e,t),tu(e,t-i),tu(e-n,t),tu(e-n,t-i));else if(r.shape===1){var o=Math.min(Math.abs(t),Math.abs(t-i))/Math.min(Math.abs(e),Math.abs(e-n)),u=xU(n,i,e,t,!0),d=u[0],p=u[1];s=tu(d-e,(p-t)/o),a=o*s}break;case 1:r.shape===0?s=a=Math.max(Math.abs(e),Math.abs(e-n),Math.abs(t),Math.abs(t-i)):r.shape===1&&(s=Math.max(Math.abs(e),Math.abs(e-n)),a=Math.max(Math.abs(t),Math.abs(t-i)));break;case 3:if(r.shape===0)s=a=Math.max(tu(e,t),tu(e,t-i),tu(e-n,t),tu(e-n,t-i));else if(r.shape===1){var o=Math.max(Math.abs(t),Math.abs(t-i))/Math.max(Math.abs(e),Math.abs(e-n)),_=xU(n,i,e,t,!1),d=_[0],p=_[1];s=tu(d-e,(p-t)/o),a=o*s}break}return Array.isArray(r.size)&&(s=Hi(r.size[0],n),a=r.size.length===2?Hi(r.size[1],i):s),[s,a]},ZAe=function(r,e){var t=rc(180),n=[];return rh(e).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&a.value==="to"){t=_U(i);return}else if(mU(a)){t=y1.parse(r,a);return}}var o=b1(r,i);n.push(o)}),{angle:t,stops:n,type:1}},v1=function(r,e){var t=rc(180),n=[];return rh(e).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){t=_U(i);return}else if(mU(a)){t=(y1.parse(r,a)+rc(270))%rc(360);return}}var o=b1(r,i);n.push(o)}),{angle:t,stops:n,type:1}},JAe=function(r,e){var t=rc(180),n=[],i=1,s=0,a=3,o=[];return rh(e).forEach(function(u,d){var p=u[0];if(d===0){if(Ci(p)&&p.value==="linear"){i=1;return}else if(Ci(p)&&p.value==="radial"){i=2;return}}if(p.type===18){if(p.name==="from"){var _=HA.parse(r,p.values[0]);n.push({stop:Go,color:_})}else if(p.name==="to"){var _=HA.parse(r,p.values[0]);n.push({stop:zA,color:_})}else if(p.name==="color-stop"){var w=p.values.filter(Dp);if(w.length===2){var _=HA.parse(r,w[1]),v=w[0];Up(v)&&n.push({stop:{type:16,number:v.number*100,flags:v.flags},color:_})}}}}),i===1?{angle:(t+rc(180))%rc(360),stops:n,type:i}:{size:a,shape:s,stops:n,position:o,type:i}},BU="closest-side",CU="farthest-side",TU="closest-corner",EU="farthest-corner",SU="circle",IU="ellipse",MU="cover",PU="contain",efe=function(r,e){var t=0,n=3,i=[],s=[];return rh(e).forEach(function(a,o){var u=!0;if(o===0){var d=!1;u=a.reduce(function(_,w){if(d)if(Ci(w))switch(w.value){case"center":return s.push(KB),_;case"top":case"left":return s.push(Go),_;case"right":case"bottom":return s.push(zA),_}else(no(w)||QA(w))&&s.push(w);else if(Ci(w))switch(w.value){case SU:return t=0,!1;case IU:return t=1,!1;case"at":return d=!0,!1;case BU:return n=0,!1;case MU:case CU:return n=1,!1;case PU:case TU:return n=2,!1;case EU:return n=3,!1}else if(QA(w)||no(w))return Array.isArray(n)||(n=[]),n.push(w),!1;return _},u)}if(u){var p=b1(r,a);i.push(p)}}),{size:n,shape:t,stops:i,position:s,type:2}},w1=function(r,e){var t=0,n=3,i=[],s=[];return rh(e).forEach(function(a,o){var u=!0;if(o===0?u=a.reduce(function(p,_){if(Ci(_))switch(_.value){case"center":return s.push(KB),!1;case"top":case"left":return s.push(Go),!1;case"right":case"bottom":return s.push(zA),!1}else if(no(_)||QA(_))return s.push(_),!1;return p},u):o===1&&(u=a.reduce(function(p,_){if(Ci(_))switch(_.value){case SU:return t=0,!1;case IU:return t=1,!1;case PU:case BU:return n=0,!1;case CU:return n=1,!1;case TU:return n=2,!1;case MU:case EU:return n=3,!1}else if(QA(_)||no(_))return Array.isArray(n)||(n=[]),n.push(_),!1;return p},u)),u){var d=b1(r,a);i.push(d)}}),{size:n,shape:t,stops:i,position:s,type:2}},tfe=function(r){return r.type===1},rfe=function(r){return r.type===2},XB={name:"image",parse:function(r,e){if(e.type===22){var t={url:e.value,type:0};return r.cache.addImage(e.value),t}if(e.type===18){var n=FU[e.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return n(r,e.values)}throw new Error("Unsupported image type "+e.type)}};function nfe(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!FU[r.name])}var FU={"linear-gradient":ZAe,"-moz-linear-gradient":v1,"-ms-linear-gradient":v1,"-o-linear-gradient":v1,"-webkit-linear-gradient":v1,"radial-gradient":efe,"-moz-radial-gradient":w1,"-ms-radial-gradient":w1,"-o-radial-gradient":w1,"-webkit-radial-gradient":w1,"-webkit-gradient":JAe},ife={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e.filter(function(n){return Dp(n)&&nfe(n)}).map(function(n){return XB.parse(r,n)})}},sfe={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(Ci(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},ofe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,e){return rh(e).map(function(t){return t.filter(no)}).map(AU)}},afe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,e){return rh(e).map(function(t){return t.filter(Ci).map(function(n){return n.value}).join(" ")}).map(lfe)}},lfe=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Np;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(Np||(Np={}));var cfe={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,e){return rh(e).map(function(t){return t.filter(ufe)})}},ufe=function(r){return Ci(r)||no(r)},x1=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},hfe=x1("top"),Afe=x1("right"),ffe=x1("bottom"),dfe=x1("left"),B1=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return AU(t.filter(no))}}},pfe=B1("top-left"),gfe=B1("top-right"),mfe=B1("bottom-right"),_fe=B1("bottom-left"),C1=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},yfe=C1("top"),bfe=C1("right"),vfe=C1("bottom"),wfe=C1("left"),T1=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Rm(t)?t.number:0}}},xfe=T1("top"),Bfe=T1("right"),Cfe=T1("bottom"),Tfe=T1("left"),Efe={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Sfe={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},Ife={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,e){return e.filter(Ci).reduce(function(t,n){return t|Mfe(n.value)},0)}},Mfe=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},Pfe={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Ffe={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},E1;(function(r){r.NORMAL="normal",r.STRICT="strict"})(E1||(E1={}));var Rfe={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"strict":return E1.STRICT;case"normal":default:return E1.NORMAL}}},Lfe={name:"line-height",initialValue:"normal",prefix:!1,type:4},RU=function(r,e){return Ci(r)&&r.value==="normal"?1.2*e:r.type===17?e*r.number:no(r)?Hi(r,e):e},Ofe={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,e){return e.type===20&&e.value==="none"?null:XB.parse(r,e)}},Ufe={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},YB={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},S1=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},Dfe=S1("top"),Nfe=S1("right"),kfe=S1("bottom"),Qfe=S1("left"),zfe={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,e){return e.filter(Ci).map(function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Hfe={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},I1=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Vfe=I1("top"),jfe=I1("right"),$fe=I1("bottom"),Gfe=I1("left"),qfe={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Kfe={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Wfe={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&qB(e[0],"none")?[]:rh(e).map(function(t){for(var n={color:Dh.TRANSPARENT,offsetX:Go,offsetY:Go,blur:Go},i=0,s=0;s<t.length;s++){var a=t[s];QA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:n.blur=a,i++):n.color=HA.parse(r,a)}return n})}},Xfe={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Yfe={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var t=ede[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},Zfe=function(r){var e=r.filter(function(t){return t.type===17}).map(function(t){return t.number});return e.length===6?e:null},Jfe=function(r){var e=r.filter(function(u){return u.type===17}).map(function(u){return u.number}),t=e[0],n=e[1];e[2],e[3];var i=e[4],s=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var a=e[12],o=e[13];return e[14],e[15],e.length===16?[t,n,i,s,a,o]:null},ede={matrix:Zfe,matrix3d:Jfe},LU={type:16,number:50,flags:Sm},tde=[LU,LU],rde={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,e){var t=e.filter(no);return t.length!==2?tde:[t[0],t[1]]}},nde={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Um;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(Um||(Um={}));for(var ide={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-all":return Um.BREAK_ALL;case"keep-all":return Um.KEEP_ALL;case"normal":default:return Um.NORMAL}}},sde={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,e){if(e.type===20)return{auto:!0,order:0};if(Up(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},OU={name:"time",parse:function(r,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},ode={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,e){return Up(e)?e.number:1}},ade={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},lde={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,e){return e.filter(Ci).map(function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(t){return t!==0})}},cde={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,e){var t=[],n=[];return e.forEach(function(i){switch(i.type){case 20:case 0:t.push(i.value);break;case 17:t.push(i.number.toString());break;case 4:n.push(t.join(" ")),t.length=0;break}}),t.length&&n.push(t.join(" ")),n.map(function(i){return i.indexOf(" ")===-1?i:"'"+i+"'"})}},ude={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},hde={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,e){if(Up(e))return e.number;if(Ci(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},Ade={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.filter(Ci).map(function(t){return t.value})}},fde={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},bo=function(r,e){return(r&e)!==0},dde={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e}},pde={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;for(var n=[],i=e.filter(hU),s=0;s<i.length;s++){var a=i[s],o=i[s+1];if(a.type===20){var u=o&&Up(o)?o.number:1;n.push({counter:a.value,increment:u})}}return n}},gde={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return[];for(var t=[],n=e.filter(hU),i=0;i<n.length;i++){var s=n[i],a=n[i+1];if(Ci(s)&&s.value!=="none"){var o=a&&Up(a)?a.number:0;t.push({counter:s.value,reset:o})}}return t}},mde={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,e){return e.filter(Rm).map(function(t){return OU.parse(r,t)})}},_de={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;var n=[],i=e.filter(jAe);if(i.length%2!==0)return null;for(var s=0;s<i.length;s+=2){var a=i[s].value,o=i[s+1].value;n.push({open:a,close:o})}return n}},UU=function(r,e,t){if(!r)return"";var n=r[Math.min(e,r.length-1)];return n?t?n.open:n.close:""},yde={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&qB(e[0],"none")?[]:rh(e).map(function(t){for(var n={color:255,offsetX:Go,offsetY:Go,blur:Go,spread:Go,inset:!1},i=0,s=0;s<t.length;s++){var a=t[s];qB(a,"inset")?n.inset=!0:QA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:i===2?n.blur=a:n.spread=a,i++):n.color=HA.parse(r,a)}return n})}},bde={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,e){var t=[0,1,2],n=[];return e.filter(Ci).forEach(function(i){switch(i.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),t.forEach(function(i){n.indexOf(i)===-1&&n.push(i)}),n}},vde={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},wde={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,e){return Rm(e)?e.number:0}},xde=function(){function r(e,t){var n,i;this.animationDuration=Vr(e,mde,t.animationDuration),this.backgroundClip=Vr(e,qAe,t.backgroundClip),this.backgroundColor=Vr(e,KAe,t.backgroundColor),this.backgroundImage=Vr(e,ife,t.backgroundImage),this.backgroundOrigin=Vr(e,sfe,t.backgroundOrigin),this.backgroundPosition=Vr(e,ofe,t.backgroundPosition),this.backgroundRepeat=Vr(e,afe,t.backgroundRepeat),this.backgroundSize=Vr(e,cfe,t.backgroundSize),this.borderTopColor=Vr(e,hfe,t.borderTopColor),this.borderRightColor=Vr(e,Afe,t.borderRightColor),this.borderBottomColor=Vr(e,ffe,t.borderBottomColor),this.borderLeftColor=Vr(e,dfe,t.borderLeftColor),this.borderTopLeftRadius=Vr(e,pfe,t.borderTopLeftRadius),this.borderTopRightRadius=Vr(e,gfe,t.borderTopRightRadius),this.borderBottomRightRadius=Vr(e,mfe,t.borderBottomRightRadius),this.borderBottomLeftRadius=Vr(e,_fe,t.borderBottomLeftRadius),this.borderTopStyle=Vr(e,yfe,t.borderTopStyle),this.borderRightStyle=Vr(e,bfe,t.borderRightStyle),this.borderBottomStyle=Vr(e,vfe,t.borderBottomStyle),this.borderLeftStyle=Vr(e,wfe,t.borderLeftStyle),this.borderTopWidth=Vr(e,xfe,t.borderTopWidth),this.borderRightWidth=Vr(e,Bfe,t.borderRightWidth),this.borderBottomWidth=Vr(e,Cfe,t.borderBottomWidth),this.borderLeftWidth=Vr(e,Tfe,t.borderLeftWidth),this.boxShadow=Vr(e,yde,t.boxShadow),this.color=Vr(e,Efe,t.color),this.direction=Vr(e,Sfe,t.direction),this.display=Vr(e,Ife,t.display),this.float=Vr(e,Pfe,t.cssFloat),this.fontFamily=Vr(e,cde,t.fontFamily),this.fontSize=Vr(e,ude,t.fontSize),this.fontStyle=Vr(e,fde,t.fontStyle),this.fontVariant=Vr(e,Ade,t.fontVariant),this.fontWeight=Vr(e,hde,t.fontWeight),this.letterSpacing=Vr(e,Ffe,t.letterSpacing),this.lineBreak=Vr(e,Rfe,t.lineBreak),this.lineHeight=Vr(e,Lfe,t.lineHeight),this.listStyleImage=Vr(e,Ofe,t.listStyleImage),this.listStylePosition=Vr(e,Ufe,t.listStylePosition),this.listStyleType=Vr(e,YB,t.listStyleType),this.marginTop=Vr(e,Dfe,t.marginTop),this.marginRight=Vr(e,Nfe,t.marginRight),this.marginBottom=Vr(e,kfe,t.marginBottom),this.marginLeft=Vr(e,Qfe,t.marginLeft),this.opacity=Vr(e,ode,t.opacity);var s=Vr(e,zfe,t.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=Vr(e,Hfe,t.overflowWrap),this.paddingTop=Vr(e,Vfe,t.paddingTop),this.paddingRight=Vr(e,jfe,t.paddingRight),this.paddingBottom=Vr(e,$fe,t.paddingBottom),this.paddingLeft=Vr(e,Gfe,t.paddingLeft),this.paintOrder=Vr(e,bde,t.paintOrder),this.position=Vr(e,Kfe,t.position),this.textAlign=Vr(e,qfe,t.textAlign),this.textDecorationColor=Vr(e,ade,(n=t.textDecorationColor)!==null&&n!==void 0?n:t.color),this.textDecorationLine=Vr(e,lde,(i=t.textDecorationLine)!==null&&i!==void 0?i:t.textDecoration),this.textShadow=Vr(e,Wfe,t.textShadow),this.textTransform=Vr(e,Xfe,t.textTransform),this.transform=Vr(e,Yfe,t.transform),this.transformOrigin=Vr(e,rde,t.transformOrigin),this.visibility=Vr(e,nde,t.visibility),this.webkitTextStrokeColor=Vr(e,vde,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=Vr(e,wde,t.webkitTextStrokeWidth),this.wordBreak=Vr(e,ide,t.wordBreak),this.zIndex=Vr(e,sde,t.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return VA(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return bo(this.display,4)||bo(this.display,33554432)||bo(this.display,268435456)||bo(this.display,536870912)||bo(this.display,67108864)||bo(this.display,134217728)},r}(),Bde=function(){function r(e,t){this.content=Vr(e,dde,t.content),this.quotes=Vr(e,_de,t.quotes)}return r}(),DU=function(){function r(e,t){this.counterIncrement=Vr(e,pde,t.counterIncrement),this.counterReset=Vr(e,gde,t.counterReset)}return r}(),Vr=function(r,e,t){var n=new cU,i=t!==null&&typeof t<"u"?t.toString():e.initialValue;n.write(i);var s=new uU(n.read());switch(e.type){case 2:var a=s.parseComponentValue();return e.parse(r,Ci(a)?a.value:e.initialValue);case 0:return e.parse(r,s.parseComponentValue());case 1:return e.parse(r,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(e.format){case"angle":return y1.parse(r,s.parseComponentValue());case"color":return HA.parse(r,s.parseComponentValue());case"image":return XB.parse(r,s.parseComponentValue());case"length":var o=s.parseComponentValue();return QA(o)?o:Go;case"length-percentage":var u=s.parseComponentValue();return no(u)?u:Go;case"time":return OU.parse(r,s.parseComponentValue())}break}},Cde="data-html2canvas-debug",Tde=function(r){var e=r.getAttribute(Cde);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},ZB=function(r,e){var t=Tde(r);return t===1||e===t},nh=function(){function r(e,t){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,ZB(t,3))debugger;this.styles=new xde(e,window.getComputedStyle(t,null)),hC(t)&&(this.styles.animationDuration.some(function(n){return n>0})&&(t.style.animationDuration="0s"),this.styles.transform!==null&&(t.style.transform="none")),this.bounds=J0(this.context,t),ZB(t,4)&&(this.flags|=16)}return r}(),Ede="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",NU="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Dm=typeof Uint8Array>"u"?[]:new Uint8Array(256),M1=0;M1<NU.length;M1++)Dm[NU.charCodeAt(M1)]=M1;for(var Sde=function(r){var e=r.length*.75,t=r.length,n,i=0,s,a,o,u;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var d=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),p=Array.isArray(d)?d:new Uint8Array(d);for(n=0;n<t;n+=4)s=Dm[r.charCodeAt(n)],a=Dm[r.charCodeAt(n+1)],o=Dm[r.charCodeAt(n+2)],u=Dm[r.charCodeAt(n+3)],p[i++]=s<<2|a>>4,p[i++]=(a&15)<<4|o>>2,p[i++]=(o&3)<<6|u&63;return d},Ide=function(r){for(var e=r.length,t=[],n=0;n<e;n+=2)t.push(r[n+1]<<8|r[n]);return t},Mde=function(r){for(var e=r.length,t=[],n=0;n<e;n+=4)t.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return t},rd=5,JB=11,eC=2,Pde=JB-rd,kU=65536>>rd,Fde=1<<rd,tC=Fde-1,Rde=1024>>rd,Lde=kU+Rde,Ode=Lde,Ude=32,Dde=Ode+Ude,Nde=65536>>JB,kde=1<<Pde,Qde=kde-1,QU=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},zde=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},Hde=function(r,e){var t=Sde(r),n=Array.isArray(t)?Mde(t):new Uint32Array(t),i=Array.isArray(t)?Ide(t):new Uint16Array(t),s=24,a=QU(i,s/2,n[4]/2),o=n[5]===2?QU(i,(s+n[4])/2):zde(n,Math.ceil((s+n[4])/4));return new Vde(n[0],n[1],n[2],n[3],a,o)},Vde=function(){function r(e,t,n,i,s,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>rd],t=(t<<eC)+(e&tC),this.data[t];if(e<=65535)return t=this.index[kU+(e-55296>>rd)],t=(t<<eC)+(e&tC),this.data[t];if(e<this.highStart)return t=Dde-Nde+(e>>JB),t=this.index[t],t+=e>>rd&Qde,t=this.index[t],t=(t<<eC)+(e&tC),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),zU="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jde=typeof Uint8Array>"u"?[]:new Uint8Array(256),P1=0;P1<zU.length;P1++)jde[zU.charCodeAt(P1)]=P1;var $de=1,rC=2,nC=3,HU=4,VU=5,Gde=7,jU=8,iC=9,sC=10,$U=11,GU=12,qU=13,KU=14,oC=15,qde=function(r){for(var e=[],t=0,n=r.length;t<n;){var i=r.charCodeAt(t++);if(i>=55296&&i<=56319&&t<n){var s=r.charCodeAt(t++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),t--)}else e.push(i)}return e},Kde=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var n=[],i=-1,s="";++i<t;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===t||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},Wde=Hde(Ede),nd="×",WU="÷",Xde=function(r){return Wde.get(r)},Yde=function(r,e,t){var n=t-2,i=e[n],s=e[t-1],a=e[t];if(s===rC&&a===nC)return nd;if(s===rC||s===nC||s===HU||a===rC||a===nC||a===HU)return WU;if(s===jU&&[jU,iC,$U,GU].indexOf(a)!==-1||(s===$U||s===iC)&&(a===iC||a===sC)||(s===GU||s===sC)&&a===sC||a===qU||a===VU||a===Gde||s===$de)return nd;if(s===qU&&a===KU){for(;i===VU;)i=e[--n];if(i===KU)return nd}if(s===oC&&a===oC){for(var o=0;i===oC;)o++,i=e[--n];if(o%2===0)return nd}return WU},Zde=function(r){var e=qde(r),t=e.length,n=0,i=0,s=e.map(Xde);return{next:function(){if(n>=t)return{done:!0,value:null};for(var a=nd;n<t&&(a=Yde(e,s,++n))===nd;);if(a!==nd||n===t){var o=Kde.apply(null,e.slice(i,n));return i=n,{value:o,done:!1}}return{done:!0,value:null}}}},Jde=function(r){for(var e=Zde(r),t=[],n;!(n=e.next()).done;)n.value&&t.push(n.value.slice());return t},epe=function(r){var e=123;if(r.createRange){var t=r.createRange();if(t.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=e+"px",n.style.display="block",r.body.appendChild(n),t.selectNode(n);var i=t.getBoundingClientRect(),s=Math.round(i.height);if(r.body.removeChild(n),s===e)return!0}}return!1},tpe=function(r){var e=r.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",r.body.appendChild(e);var t=r.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=e.firstChild,i=e1(n.data).map(function(u){return Ns(u)}),s=0,a={},o=i.every(function(u,d){t.setStart(n,s),t.setEnd(n,s+u.length);var p=t.getBoundingClientRect();s+=u.length;var _=p.x>a.x||p.y>a.y;return a=p,d===0?!0:_});return r.body.removeChild(e),o},rpe=function(){return typeof new Image().crossOrigin<"u"},npe=function(){return typeof new XMLHttpRequest().responseType=="string"},ipe=function(r){var e=new Image,t=r.createElement("canvas"),n=t.getContext("2d");if(!n)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(e,0,0),t.toDataURL()}catch{return!1}return!0},XU=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},spe=function(r){var e=r.createElement("canvas"),t=100;e.width=t,e.height=t;var n=e.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,t,t);var i=new Image,s=e.toDataURL();i.src=s;var a=aC(t,t,0,0,i);return n.fillStyle="red",n.fillRect(0,0,t,t),YU(a).then(function(o){n.drawImage(o,0,0);var u=n.getImageData(0,0,t,t).data;n.fillStyle="red",n.fillRect(0,0,t,t);var d=r.createElement("div");return d.style.backgroundImage="url("+s+")",d.style.height=t+"px",XU(u)?YU(aC(t,t,0,0,d)):Promise.reject(!1)}).then(function(o){return n.drawImage(o,0,0),XU(n.getImageData(0,0,t,t).data)}).catch(function(){return!1})},aC=function(r,e,t,n,i){var s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),o=document.createElementNS(s,"foreignObject");return a.setAttributeNS(null,"width",r.toString()),a.setAttributeNS(null,"height",e.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",t.toString()),o.setAttributeNS(null,"y",n.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(o),o.appendChild(i),a},YU=function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){return e(n)},n.onerror=t,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},qo={get SUPPORT_RANGE_BOUNDS(){var r=epe(document);return Object.defineProperty(qo,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=qo.SUPPORT_RANGE_BOUNDS&&tpe(document);return Object.defineProperty(qo,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=ipe(document);return Object.defineProperty(qo,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?spe(document):Promise.resolve(!1);return Object.defineProperty(qo,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=rpe();return Object.defineProperty(qo,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=npe();return Object.defineProperty(qo,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(qo,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(qo,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},Nm=function(){function r(e,t){this.text=e,this.bounds=t}return r}(),ope=function(r,e,t,n){var i=cpe(e,t),s=[],a=0;return i.forEach(function(o){if(t.textDecorationLine.length||o.trim().length>0)if(qo.SUPPORT_RANGE_BOUNDS){var u=ZU(n,a,o.length).getClientRects();if(u.length>1){var d=lC(o),p=0;d.forEach(function(w){s.push(new Nm(w,Oh.fromDOMRectList(r,ZU(n,p+a,w.length).getClientRects()))),p+=w.length})}else s.push(new Nm(o,Oh.fromDOMRectList(r,u)))}else{var _=n.splitText(o.length);s.push(new Nm(o,ape(r,n))),n=_}else qo.SUPPORT_RANGE_BOUNDS||(n=n.splitText(o.length));a+=o.length}),s},ape=function(r,e){var t=e.ownerDocument;if(t){var n=t.createElement("html2canvaswrapper");n.appendChild(e.cloneNode(!0));var i=e.parentNode;if(i){i.replaceChild(n,e);var s=J0(r,n);return n.firstChild&&i.replaceChild(n.firstChild,n),s}}return Oh.EMPTY},ZU=function(r,e,t){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var i=n.createRange();return i.setStart(r,e),i.setEnd(r,e+t),i},lC=function(r){if(qo.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(r)).map(function(t){return t.segment})}return Jde(r)},lpe=function(r,e){if(qo.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(r)).map(function(n){return n.segment})}return hpe(r,e)},cpe=function(r,e){return e.letterSpacing!==0?lC(r):lpe(r,e)},upe=[32,160,4961,65792,65793,4153,4241],hpe=function(r,e){for(var t=Nhe(r,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),n=[],i,s=function(){if(i.value){var a=i.value.slice(),o=e1(a),u="";o.forEach(function(d){upe.indexOf(d)===-1?u+=Ns(d):(u.length&&n.push(u),n.push(Ns(d)),u="")}),u.length&&n.push(u)}};!(i=t.next()).done;)s();return n},Ape=function(){function r(e,t,n){this.text=fpe(t.data,n.textTransform),this.textBounds=ope(e,this.text,n,t)}return r}(),fpe=function(r,e){switch(e){case 1:return r.toLowerCase();case 3:return r.replace(dpe,ppe);case 2:return r.toUpperCase();default:return r}},dpe=/(^|\s|:|-|\(|\))([a-z])/g,ppe=function(r,e,t){return r.length>0?e+t.toUpperCase():r},JU=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.src=n.currentSrc||n.src,i.intrinsicWidth=n.naturalWidth,i.intrinsicHeight=n.naturalHeight,i.context.cache.addImage(i.src),i}return e}(nh),eD=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.canvas=n,i.intrinsicWidth=n.width,i.intrinsicHeight=n.height,i}return e}(nh),tD=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this,s=new XMLSerializer,a=J0(t,n);return n.setAttribute("width",a.width+"px"),n.setAttribute("height",a.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(n)),i.intrinsicWidth=n.width.baseVal.value,i.intrinsicHeight=n.height.baseVal.value,i.context.cache.addImage(i.svg),i}return e}(nh),rD=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.value=n.value,i}return e}(nh),cC=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.start=n.start,i.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,i}return e}(nh),gpe=[{type:15,flags:0,unit:"px",number:3}],mpe=[{type:16,flags:0,number:50}],_pe=function(r){return r.width>r.height?new Oh(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new Oh(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},ype=function(r){var e=r.type===bpe?new Array(r.value.length+1).join("•"):r.value;return e.length===0?r.placeholder||"":e},F1="checkbox",R1="radio",bpe="password",nD=707406591,uC=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this;switch(i.type=n.type.toLowerCase(),i.checked=n.checked,i.value=ype(n),(i.type===F1||i.type===R1)&&(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=_pe(i.bounds)),i.type){case F1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=gpe;break;case R1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=mpe;break}return i}return e}(nh),iD=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this,s=n.options[n.selectedIndex||0];return i.value=s&&s.text||"",i}return e}(nh),sD=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.value=n.value,i}return e}(nh),oD=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this;i.src=n.src,i.width=parseInt(n.width,10)||0,i.height=parseInt(n.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){i.tree=lD(t,n.contentWindow.document.documentElement);var s=n.contentWindow.document.documentElement?Om(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):Dh.TRANSPARENT,a=n.contentWindow.document.body?Om(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):Dh.TRANSPARENT;i.backgroundColor=VA(s)?VA(a)?i.styles.backgroundColor:a:s}}catch{}return i}return e}(nh),vpe=["OL","UL","MENU"],L1=function(r,e,t,n){for(var i=e.firstChild,s=void 0;i;i=s)if(s=i.nextSibling,cD(i)&&i.data.trim().length>0)t.textNodes.push(new Ape(r,i,t.styles));else if(kp(i))if(pD(i)&&i.assignedNodes)i.assignedNodes().forEach(function(o){return L1(r,o,t,n)});else{var a=aD(r,i);a.styles.isVisible()&&(wpe(i,a,n)?a.flags|=4:xpe(a.styles)&&(a.flags|=2),vpe.indexOf(i.tagName)!==-1&&(a.flags|=8),t.elements.push(a),i.slot,i.shadowRoot?L1(r,i.shadowRoot,a,n):!U1(i)&&!uD(i)&&!D1(i)&&L1(r,i,a,n))}},aD=function(r,e){return fC(e)?new JU(r,e):hD(e)?new eD(r,e):uD(e)?new tD(r,e):Bpe(e)?new rD(r,e):Cpe(e)?new cC(r,e):Tpe(e)?new uC(r,e):D1(e)?new iD(r,e):U1(e)?new sD(r,e):fD(e)?new oD(r,e):new nh(r,e)},lD=function(r,e){var t=aD(r,e);return t.flags|=4,L1(r,e,t,t),t},wpe=function(r,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||AC(r)&&t.styles.isTransparent()},xpe=function(r){return r.isPositioned()||r.isFloating()},cD=function(r){return r.nodeType===Node.TEXT_NODE},kp=function(r){return r.nodeType===Node.ELEMENT_NODE},hC=function(r){return kp(r)&&typeof r.style<"u"&&!O1(r)},O1=function(r){return typeof r.className=="object"},Bpe=function(r){return r.tagName==="LI"},Cpe=function(r){return r.tagName==="OL"},Tpe=function(r){return r.tagName==="INPUT"},Epe=function(r){return r.tagName==="HTML"},uD=function(r){return r.tagName==="svg"},AC=function(r){return r.tagName==="BODY"},hD=function(r){return r.tagName==="CANVAS"},AD=function(r){return r.tagName==="VIDEO"},fC=function(r){return r.tagName==="IMG"},fD=function(r){return r.tagName==="IFRAME"},dD=function(r){return r.tagName==="STYLE"},Spe=function(r){return r.tagName==="SCRIPT"},U1=function(r){return r.tagName==="TEXTAREA"},D1=function(r){return r.tagName==="SELECT"},pD=function(r){return r.tagName==="SLOT"},gD=function(r){return r.tagName.indexOf("-")>0},Ipe=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},r.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},r.prototype.pop=function(e){var t=this;e.forEach(function(n){return t.counters[n].pop()})},r.prototype.parse=function(e){var t=this,n=e.counterIncrement,i=e.counterReset,s=!0;n!==null&&n.forEach(function(o){var u=t.counters[o.counter];u&&o.increment!==0&&(s=!1,u.length||u.push(1),u[Math.max(0,u.length-1)]+=o.increment)});var a=[];return s&&i.forEach(function(o){var u=t.counters[o.counter];a.push(o.counter),u||(u=t.counters[o.counter]=[]),u.push(o.reset)}),a},r}(),mD={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},_D={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},Mpe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},Ppe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},Qp=function(r,e,t,n,i,s){return r<e||r>t?Qm(r,i,s.length>0):n.integers.reduce(function(a,o,u){for(;r>=o;)r-=o,a+=n.values[u];return a},"")+s},yD=function(r,e,t,n){var i="";do t||r--,i=n(r)+i,r/=e;while(r*e>=e);return i},ks=function(r,e,t,n,i){var s=t-e+1;return(r<0?"-":"")+(yD(Math.abs(r),s,n,function(a){return Ns(Math.floor(a%s)+e)})+i)},id=function(r,e,t){t===void 0&&(t=". ");var n=e.length;return yD(Math.abs(r),n,!1,function(i){return e[Math.floor(i%n)]})+t},zp=1,$A=2,GA=4,km=8,Nh=function(r,e,t,n,i,s){if(r<-9999||r>9999)return Qm(r,4,i.length>0);var a=Math.abs(r),o=i;if(a===0)return e[0]+o;for(var u=0;a>0&&u<=4;u++){var d=a%10;d===0&&bo(s,zp)&&o!==""?o=e[d]+o:d>1||d===1&&u===0||d===1&&u===1&&bo(s,$A)||d===1&&u===1&&bo(s,GA)&&r>100||d===1&&u>1&&bo(s,km)?o=e[d]+(u>0?t[u-1]:"")+o:d===1&&u>0&&(o=t[u-1]+o),a=Math.floor(a/10)}return(r<0?n:"")+o},bD="十百千萬",vD="拾佰仟萬",wD="マイナス",dC="마이너스",Qm=function(r,e,t){var n=t?". ":"",i=t?"、":"",s=t?", ":"",a=t?" ":"";switch(e){case 0:return"•"+a;case 1:return"◦"+a;case 2:return"◾"+a;case 5:var o=ks(r,48,57,!0,n);return o.length<4?"0"+o:o;case 4:return id(r,"〇一二三四五六七八九",i);case 6:return Qp(r,1,3999,mD,3,n).toLowerCase();case 7:return Qp(r,1,3999,mD,3,n);case 8:return ks(r,945,969,!1,n);case 9:return ks(r,97,122,!1,n);case 10:return ks(r,65,90,!1,n);case 11:return ks(r,1632,1641,!0,n);case 12:case 49:return Qp(r,1,9999,_D,3,n);case 35:return Qp(r,1,9999,_D,3,n).toLowerCase();case 13:return ks(r,2534,2543,!0,n);case 14:case 30:return ks(r,6112,6121,!0,n);case 15:return id(r,"子丑寅卯辰巳午未申酉戌亥",i);case 16:return id(r,"甲乙丙丁戊己庚辛壬癸",i);case 17:case 48:return Nh(r,"零一二三四五六七八九",bD,"負",i,$A|GA|km);case 47:return Nh(r,"零壹貳參肆伍陸柒捌玖",vD,"負",i,zp|$A|GA|km);case 42:return Nh(r,"零一二三四五六七八九",bD,"负",i,$A|GA|km);case 41:return Nh(r,"零壹贰叁肆伍陆柒捌玖",vD,"负",i,zp|$A|GA|km);case 26:return Nh(r,"〇一二三四五六七八九","十百千万",wD,i,0);case 25:return Nh(r,"零壱弐参四伍六七八九","拾百千万",wD,i,zp|$A|GA);case 31:return Nh(r,"영일이삼사오육칠팔구","십백천만",dC,s,zp|$A|GA);case 33:return Nh(r,"零一二三四五六七八九","十百千萬",dC,s,0);case 32:return Nh(r,"零壹貳參四五六七八九","拾百千",dC,s,zp|$A|GA);case 18:return ks(r,2406,2415,!0,n);case 20:return Qp(r,1,19999,Ppe,3,n);case 21:return ks(r,2790,2799,!0,n);case 22:return ks(r,2662,2671,!0,n);case 22:return Qp(r,1,10999,Mpe,3,n);case 23:return id(r,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return id(r,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return ks(r,3302,3311,!0,n);case 28:return id(r,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",i);case 29:return id(r,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",i);case 34:return ks(r,3792,3801,!0,n);case 37:return ks(r,6160,6169,!0,n);case 38:return ks(r,4160,4169,!0,n);case 39:return ks(r,2918,2927,!0,n);case 40:return ks(r,1776,1785,!0,n);case 43:return ks(r,3046,3055,!0,n);case 44:return ks(r,3174,3183,!0,n);case 45:return ks(r,3664,3673,!0,n);case 46:return ks(r,3872,3881,!0,n);case 3:default:return ks(r,48,57,!0,n)}},xD="data-html2canvas-ignore",BD=function(){function r(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new Ipe,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(e,t){var n=this,i=Fpe(e,t);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,a=e.defaultView.pageYOffset,o=i.contentWindow,u=o.document,d=Ope(i).then(function(){return La(n,void 0,void 0,function(){var p,_;return _a(this,function(w){switch(w.label){case 0:return this.scrolledElements.forEach(kpe),o&&(o.scrollTo(t.left,t.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==t.top||o.scrollX!==t.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-t.left,o.scrollY-t.top,0,0))),p=this.options.onclone,_=this.clonedReferenceElement,typeof _>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:u.fonts&&u.fonts.ready?[4,u.fonts.ready]:[3,2];case 1:w.sent(),w.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Lpe(u)]:[3,4];case 3:w.sent(),w.label=4;case 4:return typeof p=="function"?[2,Promise.resolve().then(function(){return p(u,_)}).then(function(){return i})]:[2,i]}})})});return u.open(),u.write(Dpe(document.doctype)+"<html></html>"),Npe(this.referenceElement.ownerDocument,s,a),u.replaceChild(u.adoptNode(this.documentElement),u.documentElement),u.close(),d},r.prototype.createElementClone=function(e){if(ZB(e,2))debugger;if(hD(e))return this.createCanvasClone(e);if(AD(e))return this.createVideoClone(e);if(dD(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return fC(t)&&(fC(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager")),gD(t)?this.createCustomElementClone(t):t},r.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return pC(e.style,t),t},r.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce(function(s,a){return a&&typeof a.cssText=="string"?s+a.cssText:s},""),i=e.cloneNode(!1);return i.textContent=n,i}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return e.cloneNode(!1)},r.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var i=e.cloneNode(!1);try{i.width=e.width,i.height=e.height;var s=e.getContext("2d"),a=i.getContext("2d");if(a)if(!this.options.allowTaint&&s)a.putImageData(s.getImageData(0,0,e.width,e.height),0,0);else{var o=(t=e.getContext("webgl2"))!==null&&t!==void 0?t:e.getContext("webgl");if(o){var u=o.getContextAttributes();(u==null?void 0:u.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}a.drawImage(e,0,0)}return i}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return i},r.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var n=t.getContext("2d");try{return n&&(n.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||n.getImageData(0,0,t.width,t.height)),t}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var i=e.ownerDocument.createElement("canvas");return i.width=e.offsetWidth,i.height=e.offsetHeight,i},r.prototype.appendChildNode=function(e,t,n){(!kp(t)||!Spe(t)&&!t.hasAttribute(xD)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(t)))&&(!this.options.copyStyles||!kp(t)||!dD(t))&&e.appendChild(this.cloneNode(t,n))},r.prototype.cloneChildNodes=function(e,t,n){for(var i=this,s=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;s;s=s.nextSibling)if(kp(s)&&pD(s)&&typeof s.assignedNodes=="function"){var a=s.assignedNodes();a.length&&a.forEach(function(o){return i.appendChildNode(t,o,n)})}else this.appendChildNode(t,s,n)},r.prototype.cloneNode=function(e,t){if(cD(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&kp(e)&&(hC(e)||O1(e))){var i=this.createElementClone(e);i.style.transitionProperty="none";var s=n.getComputedStyle(e),a=n.getComputedStyle(e,":before"),o=n.getComputedStyle(e,":after");this.referenceElement===e&&hC(i)&&(this.clonedReferenceElement=i),AC(i)&&Hpe(i);var u=this.counters.parse(new DU(this.context,s)),d=this.resolvePseudoContent(e,i,a,zm.BEFORE);gD(e)&&(t=!0),AD(e)||this.cloneChildNodes(e,i,t),d&&i.insertBefore(d,i.firstChild);var p=this.resolvePseudoContent(e,i,o,zm.AFTER);return p&&i.appendChild(p),this.counters.pop(u),(s&&(this.options.copyStyles||O1(e))&&!fD(e)||t)&&pC(s,i),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([i,e.scrollLeft,e.scrollTop]),(U1(e)||D1(e))&&(U1(i)||D1(i))&&(i.value=e.value),i}return e.cloneNode(!1)},r.prototype.resolvePseudoContent=function(e,t,n,i){var s=this;if(n){var a=n.content,o=t.ownerDocument;if(!(!o||!a||a==="none"||a==="-moz-alt-content"||n.display==="none")){this.counters.parse(new DU(this.context,n));var u=new Bde(this.context,n),d=o.createElement("html2canvaspseudoelement");pC(n,d),u.content.forEach(function(_){if(_.type===0)d.appendChild(o.createTextNode(_.value));else if(_.type===22){var w=o.createElement("img");w.src=_.value,w.style.opacity="1",d.appendChild(w)}else if(_.type===18){if(_.name==="attr"){var v=_.values.filter(Ci);v.length&&d.appendChild(o.createTextNode(e.getAttribute(v[0].value)||""))}else if(_.name==="counter"){var M=_.values.filter(Dp),P=M[0],D=M[1];if(P&&Ci(P)){var N=s.counters.getCounterValue(P.value),z=D&&Ci(D)?YB.parse(s.context,D.value):3;d.appendChild(o.createTextNode(Qm(N,z,!1)))}}else if(_.name==="counters"){var W=_.values.filter(Dp),P=W[0],V=W[1],D=W[2];if(P&&Ci(P)){var $=s.counters.getCounterValues(P.value),q=D&&Ci(D)?YB.parse(s.context,D.value):3,te=V&&V.type===0?V.value:"",J=$.map(function(se){return Qm(se,q,!1)}).join(te);d.appendChild(o.createTextNode(J))}}}else if(_.type===20)switch(_.value){case"open-quote":d.appendChild(o.createTextNode(UU(u.quotes,s.quoteDepth++,!0)));break;case"close-quote":d.appendChild(o.createTextNode(UU(u.quotes,--s.quoteDepth,!1)));break;default:d.appendChild(o.createTextNode(_.value))}}),d.className=gC+" "+mC;var p=i===zm.BEFORE?" "+gC:" "+mC;return O1(t)?t.className.baseValue+=p:t.className+=p,d}}},r.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},r}(),zm;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(zm||(zm={}));var Fpe=function(r,e){var t=r.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(xD,"true"),r.body.appendChild(t),t},Rpe=function(r){return new Promise(function(e){if(r.complete){e();return}if(!r.src){e();return}r.onload=e,r.onerror=e})},Lpe=function(r){return Promise.all([].slice.call(r.images,0).map(Rpe))},Ope=function(r){return new Promise(function(e,t){var n=r.contentWindow;if(!n)return t("No window assigned for iframe");var i=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var s=setInterval(function(){i.body.childNodes.length>0&&i.readyState==="complete"&&(clearInterval(s),e(r))},50)}})},Upe=["all","d","content"],pC=function(r,e){for(var t=r.length-1;t>=0;t--){var n=r.item(t);Upe.indexOf(n)===-1&&e.style.setProperty(n,r.getPropertyValue(n))}return e},Dpe=function(r){var e="";return r&&(e+="<!DOCTYPE ",r.name&&(e+=r.name),r.internalSubset&&(e+=r.internalSubset),r.publicId&&(e+='"'+r.publicId+'"'),r.systemId&&(e+='"'+r.systemId+'"'),e+=">"),e},Npe=function(r,e,t){r&&r.defaultView&&(e!==r.defaultView.pageXOffset||t!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(e,t)},kpe=function(r){var e=r[0],t=r[1],n=r[2];e.scrollLeft=t,e.scrollTop=n},Qpe=":before",zpe=":after",gC="___html2canvas___pseudoelement_before",mC="___html2canvas___pseudoelement_after",CD=`{
    content: "" !important;
    display: none !important;
}`,Hpe=function(r){Vpe(r,"."+gC+Qpe+CD+`
         .`+mC+zpe+CD)},Vpe=function(r,e){var t=r.ownerDocument;if(t){var n=t.createElement("style");n.textContent=e,r.appendChild(n)}},TD=function(){function r(){}return r.getOrigin=function(e){var t=r._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},r.isSameOrigin=function(e){return r.getOrigin(e)===r._origin},r.setContext=function(e){r._link=e.document.createElement("a"),r._origin=r.getOrigin(e.location.href)},r._origin="about:blank",r}(),jpe=function(){function r(e,t){this.context=e,this._options=t,this._cache={}}return r.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(yC(e)||Kpe(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),t},r.prototype.match=function(e){return this._cache[e]},r.prototype.loadImage=function(e){return La(this,void 0,void 0,function(){var t,n,i,s,a=this;return _a(this,function(o){switch(o.label){case 0:return t=TD.isSameOrigin(e),n=!_C(e)&&this._options.useCORS===!0&&qo.SUPPORT_CORS_IMAGES&&!t,i=!_C(e)&&!t&&!yC(e)&&typeof this._options.proxy=="string"&&qo.SUPPORT_CORS_XHR&&!n,!t&&this._options.allowTaint===!1&&!_C(e)&&!yC(e)&&!i&&!n?[2]:(s=e,i?[4,this.proxy(s)]:[3,2]);case 1:s=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(u,d){var p=new Image;p.onload=function(){return u(p)},p.onerror=d,(Wpe(s)||n)&&(p.crossOrigin="anonymous"),p.src=s,p.complete===!0&&setTimeout(function(){return u(p)},500),a._options.imageTimeout>0&&setTimeout(function(){return d("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},r.prototype.has=function(e){return typeof this._cache[e]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var i=e.substring(0,256);return new Promise(function(s,a){var o=qo.SUPPORT_RESPONSE_TYPE?"blob":"text",u=new XMLHttpRequest;u.onload=function(){if(u.status===200)if(o==="text")s(u.response);else{var _=new FileReader;_.addEventListener("load",function(){return s(_.result)},!1),_.addEventListener("error",function(w){return a(w)},!1),_.readAsDataURL(u.response)}else a("Failed to proxy resource "+i+" with status code "+u.status)},u.onerror=a;var d=n.indexOf("?")>-1?"&":"?";if(u.open("GET",""+n+d+"url="+encodeURIComponent(e)+"&responseType="+o),o!=="text"&&u instanceof XMLHttpRequest&&(u.responseType=o),t._options.imageTimeout){var p=t._options.imageTimeout;u.timeout=p,u.ontimeout=function(){return a("Timed out ("+p+"ms) proxying "+i)}}u.send()})},r}(),$pe=/^data:image\/svg\+xml/i,Gpe=/^data:image\/.*;base64,/i,qpe=/^data:image\/.*/i,Kpe=function(r){return qo.SUPPORT_SVG_DRAWING||!Xpe(r)},_C=function(r){return qpe.test(r)},Wpe=function(r){return Gpe.test(r)},yC=function(r){return r.substr(0,4)==="blob"},Xpe=function(r){return r.substr(-3).toLowerCase()==="svg"||$pe.test(r)},Qr=function(){function r(e,t){this.type=0,this.x=e,this.y=t}return r.prototype.add=function(e,t){return new r(this.x+e,this.y+t)},r}(),Hp=function(r,e,t){return new Qr(r.x+(e.x-r.x)*t,r.y+(e.y-r.y)*t)},N1=function(){function r(e,t,n,i){this.type=1,this.start=e,this.startControl=t,this.endControl=n,this.end=i}return r.prototype.subdivide=function(e,t){var n=Hp(this.start,this.startControl,e),i=Hp(this.startControl,this.endControl,e),s=Hp(this.endControl,this.end,e),a=Hp(n,i,e),o=Hp(i,s,e),u=Hp(a,o,e);return t?new r(this.start,n,a,u):new r(u,o,s,this.end)},r.prototype.add=function(e,t){return new r(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),nc=function(r){return r.type===1},Ype=function(){function r(e){var t=e.styles,n=e.bounds,i=Lm(t.borderTopLeftRadius,n.width,n.height),s=i[0],a=i[1],o=Lm(t.borderTopRightRadius,n.width,n.height),u=o[0],d=o[1],p=Lm(t.borderBottomRightRadius,n.width,n.height),_=p[0],w=p[1],v=Lm(t.borderBottomLeftRadius,n.width,n.height),M=v[0],P=v[1],D=[];D.push((s+u)/n.width),D.push((M+_)/n.width),D.push((a+P)/n.height),D.push((d+w)/n.height);var N=Math.max.apply(Math,D);N>1&&(s/=N,a/=N,u/=N,d/=N,_/=N,w/=N,M/=N,P/=N);var z=n.width-u,W=n.height-w,V=n.width-_,$=n.height-P,q=t.borderTopWidth,te=t.borderRightWidth,J=t.borderBottomWidth,me=t.borderLeftWidth,xe=Hi(t.paddingTop,e.bounds.width),se=Hi(t.paddingRight,e.bounds.width),oe=Hi(t.paddingBottom,e.bounds.width),ve=Hi(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||a>0?is(n.left+me/3,n.top+q/3,s-me/3,a-q/3,Ai.TOP_LEFT):new Qr(n.left+me/3,n.top+q/3),this.topRightBorderDoubleOuterBox=s>0||a>0?is(n.left+z,n.top+q/3,u-te/3,d-q/3,Ai.TOP_RIGHT):new Qr(n.left+n.width-te/3,n.top+q/3),this.bottomRightBorderDoubleOuterBox=_>0||w>0?is(n.left+V,n.top+W,_-te/3,w-J/3,Ai.BOTTOM_RIGHT):new Qr(n.left+n.width-te/3,n.top+n.height-J/3),this.bottomLeftBorderDoubleOuterBox=M>0||P>0?is(n.left+me/3,n.top+$,M-me/3,P-J/3,Ai.BOTTOM_LEFT):new Qr(n.left+me/3,n.top+n.height-J/3),this.topLeftBorderDoubleInnerBox=s>0||a>0?is(n.left+me*2/3,n.top+q*2/3,s-me*2/3,a-q*2/3,Ai.TOP_LEFT):new Qr(n.left+me*2/3,n.top+q*2/3),this.topRightBorderDoubleInnerBox=s>0||a>0?is(n.left+z,n.top+q*2/3,u-te*2/3,d-q*2/3,Ai.TOP_RIGHT):new Qr(n.left+n.width-te*2/3,n.top+q*2/3),this.bottomRightBorderDoubleInnerBox=_>0||w>0?is(n.left+V,n.top+W,_-te*2/3,w-J*2/3,Ai.BOTTOM_RIGHT):new Qr(n.left+n.width-te*2/3,n.top+n.height-J*2/3),this.bottomLeftBorderDoubleInnerBox=M>0||P>0?is(n.left+me*2/3,n.top+$,M-me*2/3,P-J*2/3,Ai.BOTTOM_LEFT):new Qr(n.left+me*2/3,n.top+n.height-J*2/3),this.topLeftBorderStroke=s>0||a>0?is(n.left+me/2,n.top+q/2,s-me/2,a-q/2,Ai.TOP_LEFT):new Qr(n.left+me/2,n.top+q/2),this.topRightBorderStroke=s>0||a>0?is(n.left+z,n.top+q/2,u-te/2,d-q/2,Ai.TOP_RIGHT):new Qr(n.left+n.width-te/2,n.top+q/2),this.bottomRightBorderStroke=_>0||w>0?is(n.left+V,n.top+W,_-te/2,w-J/2,Ai.BOTTOM_RIGHT):new Qr(n.left+n.width-te/2,n.top+n.height-J/2),this.bottomLeftBorderStroke=M>0||P>0?is(n.left+me/2,n.top+$,M-me/2,P-J/2,Ai.BOTTOM_LEFT):new Qr(n.left+me/2,n.top+n.height-J/2),this.topLeftBorderBox=s>0||a>0?is(n.left,n.top,s,a,Ai.TOP_LEFT):new Qr(n.left,n.top),this.topRightBorderBox=u>0||d>0?is(n.left+z,n.top,u,d,Ai.TOP_RIGHT):new Qr(n.left+n.width,n.top),this.bottomRightBorderBox=_>0||w>0?is(n.left+V,n.top+W,_,w,Ai.BOTTOM_RIGHT):new Qr(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=M>0||P>0?is(n.left,n.top+$,M,P,Ai.BOTTOM_LEFT):new Qr(n.left,n.top+n.height),this.topLeftPaddingBox=s>0||a>0?is(n.left+me,n.top+q,Math.max(0,s-me),Math.max(0,a-q),Ai.TOP_LEFT):new Qr(n.left+me,n.top+q),this.topRightPaddingBox=u>0||d>0?is(n.left+Math.min(z,n.width-te),n.top+q,z>n.width+te?0:Math.max(0,u-te),Math.max(0,d-q),Ai.TOP_RIGHT):new Qr(n.left+n.width-te,n.top+q),this.bottomRightPaddingBox=_>0||w>0?is(n.left+Math.min(V,n.width-me),n.top+Math.min(W,n.height-J),Math.max(0,_-te),Math.max(0,w-J),Ai.BOTTOM_RIGHT):new Qr(n.left+n.width-te,n.top+n.height-J),this.bottomLeftPaddingBox=M>0||P>0?is(n.left+me,n.top+Math.min($,n.height-J),Math.max(0,M-me),Math.max(0,P-J),Ai.BOTTOM_LEFT):new Qr(n.left+me,n.top+n.height-J),this.topLeftContentBox=s>0||a>0?is(n.left+me+ve,n.top+q+xe,Math.max(0,s-(me+ve)),Math.max(0,a-(q+xe)),Ai.TOP_LEFT):new Qr(n.left+me+ve,n.top+q+xe),this.topRightContentBox=u>0||d>0?is(n.left+Math.min(z,n.width+me+ve),n.top+q+xe,z>n.width+me+ve?0:u-me+ve,d-(q+xe),Ai.TOP_RIGHT):new Qr(n.left+n.width-(te+se),n.top+q+xe),this.bottomRightContentBox=_>0||w>0?is(n.left+Math.min(V,n.width-(me+ve)),n.top+Math.min(W,n.height+q+xe),Math.max(0,_-(te+se)),w-(J+oe),Ai.BOTTOM_RIGHT):new Qr(n.left+n.width-(te+se),n.top+n.height-(J+oe)),this.bottomLeftContentBox=M>0||P>0?is(n.left+me+ve,n.top+$,Math.max(0,M-(me+ve)),P-(J+oe),Ai.BOTTOM_LEFT):new Qr(n.left+me+ve,n.top+n.height-(J+oe))}return r}(),Ai;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Ai||(Ai={}));var is=function(r,e,t,n,i){var s=4*((Math.sqrt(2)-1)/3),a=t*s,o=n*s,u=r+t,d=e+n;switch(i){case Ai.TOP_LEFT:return new N1(new Qr(r,d),new Qr(r,d-o),new Qr(u-a,e),new Qr(u,e));case Ai.TOP_RIGHT:return new N1(new Qr(r,e),new Qr(r+a,e),new Qr(u,d-o),new Qr(u,d));case Ai.BOTTOM_RIGHT:return new N1(new Qr(u,e),new Qr(u,e+o),new Qr(r+a,d),new Qr(r,d));case Ai.BOTTOM_LEFT:default:return new N1(new Qr(u,d),new Qr(u-a,d),new Qr(r,e+o),new Qr(r,e))}},k1=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},Zpe=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},Q1=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},Jpe=function(){function r(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6}return r}(),z1=function(){function r(e,t){this.path=e,this.target=t,this.type=1}return r}(),ege=function(){function r(e){this.opacity=e,this.type=2,this.target=6}return r}(),tge=function(r){return r.type===0},ED=function(r){return r.type===1},rge=function(r){return r.type===2},SD=function(r,e){return r.length===e.length?r.some(function(t,n){return t===e[n]}):!1},nge=function(r,e,t,n,i){return r.map(function(s,a){switch(a){case 0:return s.add(e,t);case 1:return s.add(e+n,t);case 2:return s.add(e+n,t+i);case 3:return s.add(e,t+i)}return s})},ID=function(){function r(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),MD=function(){function r(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new Ype(this.container),this.container.styles.opacity<1&&this.effects.push(new ege(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new Jpe(n,i,s))}if(this.container.styles.overflowX!==0){var a=k1(this.curves),o=Q1(this.curves);SD(a,o)?this.effects.push(new z1(a,6)):(this.effects.push(new z1(a,2)),this.effects.push(new z1(o,4)))}}return r.prototype.getEffects=function(e){for(var t=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,i=this.effects.slice(0);n;){var s=n.effects.filter(function(u){return!ED(u)});if(t||n.container.styles.position!==0||!n.parent){if(i.unshift.apply(i,s),t=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var a=k1(n.curves),o=Q1(n.curves);SD(a,o)||i.unshift(new z1(o,6))}}else i.unshift.apply(i,s);n=n.parent}return i.filter(function(u){return bo(u.target,e)})},r}(),bC=function(r,e,t,n){r.container.elements.forEach(function(i){var s=bo(i.flags,4),a=bo(i.flags,2),o=new MD(i,r);bo(i.styles.display,2048)&&n.push(o);var u=bo(i.flags,8)?[]:n;if(s||a){var d=s||i.styles.isPositioned()?t:e,p=new ID(o);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var _=i.styles.zIndex.order;if(_<0){var w=0;d.negativeZIndex.some(function(M,P){return _>M.element.container.styles.zIndex.order?(w=P,!1):w>0}),d.negativeZIndex.splice(w,0,p)}else if(_>0){var v=0;d.positiveZIndex.some(function(M,P){return _>=M.element.container.styles.zIndex.order?(v=P+1,!1):v>0}),d.positiveZIndex.splice(v,0,p)}else d.zeroOrAutoZIndexOrTransformedOrOpacity.push(p)}else i.styles.isFloating()?d.nonPositionedFloats.push(p):d.nonPositionedInlineLevel.push(p);bC(o,p,s?p:t,u)}else i.styles.isInlineLevel()?e.inlineLevel.push(o):e.nonInlineLevel.push(o),bC(o,e,t,u);bo(i.flags,8)&&PD(i,u)})},PD=function(r,e){for(var t=r instanceof cC?r.start:1,n=r instanceof cC?r.reversed:!1,i=0;i<e.length;i++){var s=e[i];s.container instanceof rD&&typeof s.container.value=="number"&&s.container.value!==0&&(t=s.container.value),s.listValue=Qm(t,s.container.styles.listStyleType,!0),t+=n?-1:1}},ige=function(r){var e=new MD(r,null),t=new ID(e),n=[];return bC(e,t,t,n),PD(e.container,n),t},FD=function(r,e){switch(e){case 0:return ic(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return ic(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return ic(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return ic(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},sge=function(r,e){switch(e){case 0:return ic(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return ic(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return ic(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return ic(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},oge=function(r,e){switch(e){case 0:return ic(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return ic(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return ic(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return ic(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},age=function(r,e){switch(e){case 0:return H1(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return H1(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return H1(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return H1(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},H1=function(r,e){var t=[];return nc(r)?t.push(r.subdivide(.5,!1)):t.push(r),nc(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},ic=function(r,e,t,n){var i=[];return nc(r)?i.push(r.subdivide(.5,!1)):i.push(r),nc(t)?i.push(t.subdivide(.5,!0)):i.push(t),nc(n)?i.push(n.subdivide(.5,!0).reverse()):i.push(n),nc(e)?i.push(e.subdivide(.5,!1).reverse()):i.push(e),i},RD=function(r){var e=r.bounds,t=r.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))},V1=function(r){var e=r.styles,t=r.bounds,n=Hi(e.paddingLeft,t.width),i=Hi(e.paddingRight,t.width),s=Hi(e.paddingTop,t.width),a=Hi(e.paddingBottom,t.width);return t.add(n+e.borderLeftWidth,s+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+n+i),-(e.borderTopWidth+e.borderBottomWidth+s+a))},lge=function(r,e){return r===0?e.bounds:r===2?V1(e):RD(e)},cge=function(r,e){return r===0?e.bounds:r===2?V1(e):RD(e)},vC=function(r,e,t){var n=lge(jp(r.styles.backgroundOrigin,e),r),i=cge(jp(r.styles.backgroundClip,e),r),s=uge(jp(r.styles.backgroundSize,e),t,n),a=s[0],o=s[1],u=Lm(jp(r.styles.backgroundPosition,e),n.width-a,n.height-o),d=hge(jp(r.styles.backgroundRepeat,e),u,s,n,i),p=Math.round(n.left+u[0]),_=Math.round(n.top+u[1]);return[d,p,_,a,o]},Vp=function(r){return Ci(r)&&r.value===Np.AUTO},j1=function(r){return typeof r=="number"},uge=function(r,e,t){var n=e[0],i=e[1],s=e[2],a=r[0],o=r[1];if(!a)return[0,0];if(no(a)&&o&&no(o))return[Hi(a,t.width),Hi(o,t.height)];var u=j1(s);if(Ci(a)&&(a.value===Np.CONTAIN||a.value===Np.COVER)){if(j1(s)){var d=t.width/t.height;return d<s!=(a.value===Np.COVER)?[t.width,t.width/s]:[t.height*s,t.height]}return[t.width,t.height]}var p=j1(n),_=j1(i),w=p||_;if(Vp(a)&&(!o||Vp(o))){if(p&&_)return[n,i];if(!u&&!w)return[t.width,t.height];if(w&&u){var v=p?n:i*s,M=_?i:n/s;return[v,M]}var P=p?n:t.width,D=_?i:t.height;return[P,D]}if(u){var N=0,z=0;return no(a)?N=Hi(a,t.width):no(o)&&(z=Hi(o,t.height)),Vp(a)?N=z*s:(!o||Vp(o))&&(z=N/s),[N,z]}var W=null,V=null;if(no(a)?W=Hi(a,t.width):o&&no(o)&&(V=Hi(o,t.height)),W!==null&&(!o||Vp(o))&&(V=p&&_?W/n*i:t.height),V!==null&&Vp(a)&&(W=p&&_?V/i*n:t.width),W!==null&&V!==null)return[W,V];throw new Error("Unable to calculate background-size for element")},jp=function(r,e){var t=r[e];return typeof t>"u"?r[0]:t},hge=function(r,e,t,n,i){var s=e[0],a=e[1],o=t[0],u=t[1];switch(r){case 2:return[new Qr(Math.round(n.left),Math.round(n.top+a)),new Qr(Math.round(n.left+n.width),Math.round(n.top+a)),new Qr(Math.round(n.left+n.width),Math.round(u+n.top+a)),new Qr(Math.round(n.left),Math.round(u+n.top+a))];case 3:return[new Qr(Math.round(n.left+s),Math.round(n.top)),new Qr(Math.round(n.left+s+o),Math.round(n.top)),new Qr(Math.round(n.left+s+o),Math.round(n.height+n.top)),new Qr(Math.round(n.left+s),Math.round(n.height+n.top))];case 1:return[new Qr(Math.round(n.left+s),Math.round(n.top+a)),new Qr(Math.round(n.left+s+o),Math.round(n.top+a)),new Qr(Math.round(n.left+s+o),Math.round(n.top+a+u)),new Qr(Math.round(n.left+s),Math.round(n.top+a+u))];default:return[new Qr(Math.round(i.left),Math.round(i.top)),new Qr(Math.round(i.left+i.width),Math.round(i.top)),new Qr(Math.round(i.left+i.width),Math.round(i.height+i.top)),new Qr(Math.round(i.left),Math.round(i.height+i.top))]}},Age="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",LD="Hidden Text",fge=function(){function r(e){this._data={},this._document=e}return r.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),a=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",a.appendChild(n),i.src=Age,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=t,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(LD)),n.appendChild(s),n.appendChild(i);var o=i.offsetTop-s.offsetTop+2;n.removeChild(s),n.appendChild(this._document.createTextNode(LD)),n.style.lineHeight="normal",i.style.verticalAlign="super";var u=i.offsetTop-n.offsetTop+2;return a.removeChild(n),{baseline:o,middle:u}},r.prototype.getMetrics=function(e,t){var n=e+" "+t;return typeof this._data[n]>"u"&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},r}(),OD=function(){function r(e,t){this.context=e,this.options=t}return r}(),dge=1e4,pge=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i._activeEffects=[],i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),n.canvas||(i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px"),i.fontMetrics=new fge(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),i}return e.prototype.applyEffects=function(t){for(var n=this;this._activeEffects.length;)this.popEffect();t.forEach(function(i){return n.applyEffect(i)})},e.prototype.applyEffect=function(t){this.ctx.save(),rge(t)&&(this.ctx.globalAlpha=t.opacity),tge(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),ED(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(t){return La(this,void 0,void 0,function(){var n;return _a(this,function(i){switch(i.label){case 0:return n=t.element.container.styles,n.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(t){return La(this,void 0,void 0,function(){return _a(this,function(n){switch(n.label){case 0:if(bo(t.container.flags,16))debugger;return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(t,n,i){var s=this;if(n===0)this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+i);else{var a=lC(t.text);a.reduce(function(o,u){return s.ctx.fillText(u,o,t.bounds.top+i),o+s.ctx.measureText(u).width},t.bounds.left)}},e.prototype.createFontStyle=function(t){var n=t.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),i=bge(t.fontFamily).join(", "),s=Rm(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,n,t.fontWeight,s,i].join(" "),i,s]},e.prototype.renderTextNode=function(t,n){return La(this,void 0,void 0,function(){var i,s,a,o,u,d,p,_,w=this;return _a(this,function(v){return i=this.createFontStyle(n),s=i[0],a=i[1],o=i[2],this.ctx.font=s,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",u=this.fontMetrics.getMetrics(a,o),d=u.baseline,p=u.middle,_=n.paintOrder,t.textBounds.forEach(function(M){_.forEach(function(P){switch(P){case 0:w.ctx.fillStyle=Oo(n.color),w.renderTextWithLetterSpacing(M,n.letterSpacing,d);var D=n.textShadow;D.length&&M.text.trim().length&&(D.slice(0).reverse().forEach(function(N){w.ctx.shadowColor=Oo(N.color),w.ctx.shadowOffsetX=N.offsetX.number*w.options.scale,w.ctx.shadowOffsetY=N.offsetY.number*w.options.scale,w.ctx.shadowBlur=N.blur.number,w.renderTextWithLetterSpacing(M,n.letterSpacing,d)}),w.ctx.shadowColor="",w.ctx.shadowOffsetX=0,w.ctx.shadowOffsetY=0,w.ctx.shadowBlur=0),n.textDecorationLine.length&&(w.ctx.fillStyle=Oo(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(N){switch(N){case 1:w.ctx.fillRect(M.bounds.left,Math.round(M.bounds.top+d),M.bounds.width,1);break;case 2:w.ctx.fillRect(M.bounds.left,Math.round(M.bounds.top),M.bounds.width,1);break;case 3:w.ctx.fillRect(M.bounds.left,Math.ceil(M.bounds.top+p),M.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&M.text.trim().length&&(w.ctx.strokeStyle=Oo(n.webkitTextStrokeColor),w.ctx.lineWidth=n.webkitTextStrokeWidth,w.ctx.lineJoin=window.chrome?"miter":"round",w.ctx.strokeText(M.text,M.bounds.left,M.bounds.top+d)),w.ctx.strokeStyle="",w.ctx.lineWidth=0,w.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(t,n,i){if(i&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var s=V1(t),a=Q1(n);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,t.intrinsicWidth,t.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return La(this,void 0,void 0,function(){var n,i,s,a,o,u,z,z,d,p,_,w,V,v,M,$,P,D,N,z,W,V,$;return _a(this,function(q){switch(q.label){case 0:this.applyEffects(t.getEffects(4)),n=t.container,i=t.curves,s=n.styles,a=0,o=n.textNodes,q.label=1;case 1:return a<o.length?(u=o[a],[4,this.renderTextNode(u,s)]):[3,4];case 2:q.sent(),q.label=3;case 3:return a++,[3,1];case 4:if(!(n instanceof JU))return[3,8];q.label=5;case 5:return q.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return z=q.sent(),this.renderReplacedElement(n,i,z),[3,8];case 7:return q.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof eD&&this.renderReplacedElement(n,i,n.canvas),!(n instanceof tD))return[3,12];q.label=9;case 9:return q.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return z=q.sent(),this.renderReplacedElement(n,i,z),[3,12];case 11:return q.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof oD&&n.tree?(d=new e(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,d.render(n.tree)]):[3,14];case 13:p=q.sent(),n.width&&n.height&&this.ctx.drawImage(p,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),q.label=14;case 14:if(n instanceof uC&&(_=Math.min(n.bounds.width,n.bounds.height),n.type===F1?n.checked&&(this.ctx.save(),this.path([new Qr(n.bounds.left+_*.39363,n.bounds.top+_*.79),new Qr(n.bounds.left+_*.16,n.bounds.top+_*.5549),new Qr(n.bounds.left+_*.27347,n.bounds.top+_*.44071),new Qr(n.bounds.left+_*.39694,n.bounds.top+_*.5649),new Qr(n.bounds.left+_*.72983,n.bounds.top+_*.23),new Qr(n.bounds.left+_*.84,n.bounds.top+_*.34085),new Qr(n.bounds.left+_*.39363,n.bounds.top+_*.79)]),this.ctx.fillStyle=Oo(nD),this.ctx.fill(),this.ctx.restore()):n.type===R1&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+_/2,n.bounds.top+_/2,_/4,0,Math.PI*2,!0),this.ctx.fillStyle=Oo(nD),this.ctx.fill(),this.ctx.restore())),gge(n)&&n.value.length){switch(w=this.createFontStyle(s),V=w[0],v=w[1],M=this.fontMetrics.getMetrics(V,v).baseline,this.ctx.font=V,this.ctx.fillStyle=Oo(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=_ge(n.styles.textAlign),$=V1(n),P=0,n.styles.textAlign){case 1:P+=$.width/2;break;case 2:P+=$.width;break}D=$.add(P,0,0,-$.height/2+1),this.ctx.save(),this.path([new Qr($.left,$.top),new Qr($.left+$.width,$.top),new Qr($.left+$.width,$.top+$.height),new Qr($.left,$.top+$.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Nm(n.value,D),s.letterSpacing,M),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!bo(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(N=n.styles.listStyleImage,N.type!==0)return[3,18];z=void 0,W=N.url,q.label=15;case 15:return q.trys.push([15,17,,18]),[4,this.context.cache.match(W)];case 16:return z=q.sent(),this.ctx.drawImage(z,n.bounds.left-(z.width+10),n.bounds.top),[3,18];case 17:return q.sent(),this.context.logger.error("Error loading list-style-image "+W),[3,18];case 18:return[3,20];case 19:t.listValue&&n.styles.listStyleType!==-1&&(V=this.createFontStyle(s)[0],this.ctx.font=V,this.ctx.fillStyle=Oo(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",$=new Oh(n.bounds.left,n.bounds.top+Hi(n.styles.paddingTop,n.bounds.width),n.bounds.width,RU(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Nm(t.listValue,$),s.letterSpacing,RU(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),q.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(t){return La(this,void 0,void 0,function(){var n,i,N,s,a,N,o,u,N,d,p,N,_,w,N,v,M,N,P,D,N;return _a(this,function(z){switch(z.label){case 0:if(bo(t.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:z.sent(),n=0,i=t.negativeZIndex,z.label=2;case 2:return n<i.length?(N=i[n],[4,this.renderStack(N)]):[3,5];case 3:z.sent(),z.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:z.sent(),s=0,a=t.nonInlineLevel,z.label=7;case 7:return s<a.length?(N=a[s],[4,this.renderNode(N)]):[3,10];case 8:z.sent(),z.label=9;case 9:return s++,[3,7];case 10:o=0,u=t.nonPositionedFloats,z.label=11;case 11:return o<u.length?(N=u[o],[4,this.renderStack(N)]):[3,14];case 12:z.sent(),z.label=13;case 13:return o++,[3,11];case 14:d=0,p=t.nonPositionedInlineLevel,z.label=15;case 15:return d<p.length?(N=p[d],[4,this.renderStack(N)]):[3,18];case 16:z.sent(),z.label=17;case 17:return d++,[3,15];case 18:_=0,w=t.inlineLevel,z.label=19;case 19:return _<w.length?(N=w[_],[4,this.renderNode(N)]):[3,22];case 20:z.sent(),z.label=21;case 21:return _++,[3,19];case 22:v=0,M=t.zeroOrAutoZIndexOrTransformedOrOpacity,z.label=23;case 23:return v<M.length?(N=M[v],[4,this.renderStack(N)]):[3,26];case 24:z.sent(),z.label=25;case 25:return v++,[3,23];case 26:P=0,D=t.positiveZIndex,z.label=27;case 27:return P<D.length?(N=D[P],[4,this.renderStack(N)]):[3,30];case 28:z.sent(),z.label=29;case 29:return P++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},e.prototype.formatPath=function(t){var n=this;t.forEach(function(i,s){var a=nc(i)?i.start:i;s===0?n.ctx.moveTo(a.x,a.y):n.ctx.lineTo(a.x,a.y),nc(i)&&n.ctx.bezierCurveTo(i.startControl.x,i.startControl.y,i.endControl.x,i.endControl.y,i.end.x,i.end.y)})},e.prototype.renderRepeat=function(t,n,i,s){this.path(t),this.ctx.fillStyle=n,this.ctx.translate(i,s),this.ctx.fill(),this.ctx.translate(-i,-s)},e.prototype.resizeImage=function(t,n,i){var s;if(t.width===n&&t.height===i)return t;var a=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,o=a.createElement("canvas");o.width=Math.max(1,n),o.height=Math.max(1,i);var u=o.getContext("2d");return u.drawImage(t,0,0,t.width,t.height,0,0,n,i),o},e.prototype.renderBackgroundImage=function(t){return La(this,void 0,void 0,function(){var n,i,s,a,o,u;return _a(this,function(d){switch(d.label){case 0:n=t.styles.backgroundImage.length-1,i=function(p){var _,w,v,xe,Ge,et,ve,ge,J,M,xe,Ge,et,ve,ge,P,D,N,z,W,V,$,q,te,J,me,xe,se,oe,ve,ge,Je,Ge,et,Ye,ct,At,kt,ae,Te,Le,De;return _a(this,function(at){switch(at.label){case 0:if(p.type!==0)return[3,5];_=void 0,w=p.url,at.label=1;case 1:return at.trys.push([1,3,,4]),[4,s.context.cache.match(w)];case 2:return _=at.sent(),[3,4];case 3:return at.sent(),s.context.logger.error("Error loading background-image "+w),[3,4];case 4:return _&&(v=vC(t,n,[_.width,_.height,_.width/_.height]),xe=v[0],Ge=v[1],et=v[2],ve=v[3],ge=v[4],J=s.ctx.createPattern(s.resizeImage(_,ve,ge),"repeat"),s.renderRepeat(xe,J,Ge,et)),[3,6];case 5:tfe(p)?(M=vC(t,n,[null,null,null]),xe=M[0],Ge=M[1],et=M[2],ve=M[3],ge=M[4],P=XAe(p.angle,ve,ge),D=P[0],N=P[1],z=P[2],W=P[3],V=P[4],$=document.createElement("canvas"),$.width=ve,$.height=ge,q=$.getContext("2d"),te=q.createLinearGradient(N,W,z,V),wU(p.stops,D).forEach(function(rt){return te.addColorStop(rt.stop,Oo(rt.color))}),q.fillStyle=te,q.fillRect(0,0,ve,ge),ve>0&&ge>0&&(J=s.ctx.createPattern($,"repeat"),s.renderRepeat(xe,J,Ge,et))):rfe(p)&&(me=vC(t,n,[null,null,null]),xe=me[0],se=me[1],oe=me[2],ve=me[3],ge=me[4],Je=p.position.length===0?[KB]:p.position,Ge=Hi(Je[0],ve),et=Hi(Je[Je.length-1],ge),Ye=YAe(p,Ge,et,ve,ge),ct=Ye[0],At=Ye[1],ct>0&&At>0&&(kt=s.ctx.createRadialGradient(se+Ge,oe+et,0,se+Ge,oe+et,ct),wU(p.stops,ct*2).forEach(function(rt){return kt.addColorStop(rt.stop,Oo(rt.color))}),s.path(xe),s.ctx.fillStyle=kt,ct!==At?(ae=t.bounds.left+.5*t.bounds.width,Te=t.bounds.top+.5*t.bounds.height,Le=At/ct,De=1/Le,s.ctx.save(),s.ctx.translate(ae,Te),s.ctx.transform(1,0,0,Le,0,0),s.ctx.translate(-ae,-Te),s.ctx.fillRect(se,De*(oe-Te)+Te,ve,ge*De),s.ctx.restore()):s.ctx.fill())),at.label=6;case 6:return n--,[2]}})},s=this,a=0,o=t.styles.backgroundImage.slice(0).reverse(),d.label=1;case 1:return a<o.length?(u=o[a],[5,i(u)]):[3,4];case 2:d.sent(),d.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(t,n,i){return La(this,void 0,void 0,function(){return _a(this,function(s){return this.path(FD(i,n)),this.ctx.fillStyle=Oo(t),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(t,n,i,s){return La(this,void 0,void 0,function(){var a,o;return _a(this,function(u){switch(u.label){case 0:return n<3?[4,this.renderSolidBorder(t,i,s)]:[3,2];case 1:return u.sent(),[2];case 2:return a=sge(s,i),this.path(a),this.ctx.fillStyle=Oo(t),this.ctx.fill(),o=oge(s,i),this.path(o),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(t){return La(this,void 0,void 0,function(){var n,i,s,a,o,u,d,p,_=this;return _a(this,function(w){switch(w.label){case 0:return this.applyEffects(t.getEffects(2)),n=t.container.styles,i=!VA(n.backgroundColor)||n.backgroundImage.length,s=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],a=mge(jp(n.backgroundClip,0),t.curves),i||n.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),VA(n.backgroundColor)||(this.ctx.fillStyle=Oo(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:w.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(v){_.ctx.save();var M=k1(t.curves),P=v.inset?0:dge,D=nge(M,-P+(v.inset?1:-1)*v.spread.number,(v.inset?1:-1)*v.spread.number,v.spread.number*(v.inset?-2:2),v.spread.number*(v.inset?-2:2));v.inset?(_.path(M),_.ctx.clip(),_.mask(D)):(_.mask(M),_.ctx.clip(),_.path(D)),_.ctx.shadowOffsetX=v.offsetX.number+P,_.ctx.shadowOffsetY=v.offsetY.number,_.ctx.shadowColor=Oo(v.color),_.ctx.shadowBlur=v.blur.number,_.ctx.fillStyle=v.inset?Oo(v.color):"rgba(0,0,0,1)",_.ctx.fill(),_.ctx.restore()}),w.label=2;case 2:o=0,u=0,d=s,w.label=3;case 3:return u<d.length?(p=d[u],p.style!==0&&!VA(p.color)&&p.width>0?p.style!==2?[3,5]:[4,this.renderDashedDottedBorder(p.color,p.width,o,t.curves,2)]:[3,11]):[3,13];case 4:return w.sent(),[3,11];case 5:return p.style!==3?[3,7]:[4,this.renderDashedDottedBorder(p.color,p.width,o,t.curves,3)];case 6:return w.sent(),[3,11];case 7:return p.style!==4?[3,9]:[4,this.renderDoubleBorder(p.color,p.width,o,t.curves)];case 8:return w.sent(),[3,11];case 9:return[4,this.renderSolidBorder(p.color,o,t.curves)];case 10:w.sent(),w.label=11;case 11:o++,w.label=12;case 12:return u++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(t,n,i,s,a){return La(this,void 0,void 0,function(){var o,u,d,p,_,w,v,M,P,D,N,z,W,V,$,q,$,q;return _a(this,function(te){return this.ctx.save(),o=age(s,i),u=FD(s,i),a===2&&(this.path(u),this.ctx.clip()),nc(u[0])?(d=u[0].start.x,p=u[0].start.y):(d=u[0].x,p=u[0].y),nc(u[1])?(_=u[1].end.x,w=u[1].end.y):(_=u[1].x,w=u[1].y),i===0||i===2?v=Math.abs(d-_):v=Math.abs(p-w),this.ctx.beginPath(),a===3?this.formatPath(o):this.formatPath(u.slice(0,2)),M=n<3?n*3:n*2,P=n<3?n*2:n,a===3&&(M=n,P=n),D=!0,v<=M*2?D=!1:v<=M*2+P?(N=v/(2*M+P),M*=N,P*=N):(z=Math.floor((v+P)/(M+P)),W=(v-z*M)/(z-1),V=(v-(z+1)*M)/z,P=V<=0||Math.abs(P-W)<Math.abs(P-V)?W:V),D&&(a===3?this.ctx.setLineDash([0,M+P]):this.ctx.setLineDash([M,P])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=Oo(t),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(nc(u[0])&&($=u[3],q=u[0],this.ctx.beginPath(),this.formatPath([new Qr($.end.x,$.end.y),new Qr(q.start.x,q.start.y)]),this.ctx.stroke()),nc(u[1])&&($=u[1],q=u[2],this.ctx.beginPath(),this.formatPath([new Qr($.end.x,$.end.y),new Qr(q.start.x,q.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(t){return La(this,void 0,void 0,function(){var n;return _a(this,function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Oo(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=ige(t),[4,this.renderStack(n)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(OD),gge=function(r){return r instanceof sD||r instanceof iD?!0:r instanceof uC&&r.type!==R1&&r.type!==F1},mge=function(r,e){switch(r){case 0:return k1(e);case 2:return Zpe(e);case 1:default:return Q1(e)}},_ge=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},yge=["-apple-system","system-ui"],bge=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(e){return yge.indexOf(e)===-1}):r},vge=function(r){eu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=n,i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),i}return e.prototype.render=function(t){return La(this,void 0,void 0,function(){var n,i;return _a(this,function(s){switch(s.label){case 0:return n=aC(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,wge(n)];case 1:return i=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Oo(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(OD),wge=function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){e(n)},n.onerror=t,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},xge=function(){function r(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,Z0([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,Z0([this.id,this.getTime()+"ms"],e))},r.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,Z0([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,Z0([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.instances={},r}(),Bge=function(){function r(e,t){var n;this.windowBounds=t,this.instanceName="#"+r.instanceCount++,this.logger=new xge({id:this.instanceName,enabled:e.logging}),this.cache=(n=e.cache)!==null&&n!==void 0?n:new jpe(this,e)}return r.instanceCount=1,r}(),Cge=function(r,e){return e===void 0&&(e={}),Tge(r,e)};typeof window<"u"&&TD.setContext(window);var Tge=function(r,e){return La(void 0,void 0,void 0,function(){var t,n,i,s,a,o,u,d,p,_,w,v,M,P,D,N,z,W,V,$,te,q,te,J,me,xe,se,oe,ve,ge,Je,Ge,et,Ye,ct,At,kt,ae,Te,Le;return _a(this,function(De){switch(De.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(t=r.ownerDocument,!t)throw new Error("Element is not attached to a Document");if(n=t.defaultView,!n)throw new Error("Document is not attached to a Window");return i={allowTaint:(J=e.allowTaint)!==null&&J!==void 0?J:!1,imageTimeout:(me=e.imageTimeout)!==null&&me!==void 0?me:15e3,proxy:e.proxy,useCORS:(xe=e.useCORS)!==null&&xe!==void 0?xe:!1},s=EB({logging:(se=e.logging)!==null&&se!==void 0?se:!0,cache:e.cache},i),a={windowWidth:(oe=e.windowWidth)!==null&&oe!==void 0?oe:n.innerWidth,windowHeight:(ve=e.windowHeight)!==null&&ve!==void 0?ve:n.innerHeight,scrollX:(ge=e.scrollX)!==null&&ge!==void 0?ge:n.pageXOffset,scrollY:(Je=e.scrollY)!==null&&Je!==void 0?Je:n.pageYOffset},o=new Oh(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),u=new Bge(s,o),d=(Ge=e.foreignObjectRendering)!==null&&Ge!==void 0?Ge:!1,p={allowTaint:(et=e.allowTaint)!==null&&et!==void 0?et:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:d,copyStyles:d},u.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),_=new BD(u,r,p),w=_.clonedReferenceElement,w?[4,_.toIFrame(t,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return v=De.sent(),M=AC(w)||Epe(w)?nhe(w.ownerDocument):J0(u,w),P=M.width,D=M.height,N=M.left,z=M.top,W=Ege(u,w,e.backgroundColor),V={canvas:e.canvas,backgroundColor:W,scale:(ct=(Ye=e.scale)!==null&&Ye!==void 0?Ye:n.devicePixelRatio)!==null&&ct!==void 0?ct:1,x:((At=e.x)!==null&&At!==void 0?At:0)+N,y:((kt=e.y)!==null&&kt!==void 0?kt:0)+z,width:(ae=e.width)!==null&&ae!==void 0?ae:Math.ceil(P),height:(Te=e.height)!==null&&Te!==void 0?Te:Math.ceil(D)},d?(u.logger.debug("Document cloned, using foreign object rendering"),te=new vge(u,V),[4,te.render(w)]):[3,3];case 2:return $=De.sent(),[3,5];case 3:return u.logger.debug("Document cloned, element located at "+N+","+z+" with size "+P+"x"+D+" using computed rendering"),u.logger.debug("Starting DOM parsing"),q=lD(u,w),W===q.styles.backgroundColor&&(q.styles.backgroundColor=Dh.TRANSPARENT),u.logger.debug("Starting renderer for element at "+V.x+","+V.y+" with size "+V.width+"x"+V.height),te=new pge(u,V),[4,te.render(q)];case 4:$=De.sent(),De.label=5;case 5:return(!((Le=e.removeContainer)!==null&&Le!==void 0)||Le)&&(BD.destroy(v)||u.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),u.logger.debug("Finished rendering"),[2,$]}})})},Ege=function(r,e,t){var n=e.ownerDocument,i=n.documentElement?Om(r,getComputedStyle(n.documentElement).backgroundColor):Dh.TRANSPARENT,s=n.body?Om(r,getComputedStyle(n.body).backgroundColor):Dh.TRANSPARENT,a=typeof t=="string"?Om(r,t):t===null?Dh.TRANSPARENT:4294967295;return e===n.documentElement?VA(i)?VA(s)?a:s:i:a};const Sge=Object.freeze(Object.defineProperty({__proto__:null,default:Cge},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.5.8 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.5.8/LICENSE */function qA(r){"@babel/helpers - typeof";return qA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qA(r)}function wC(r,e){return wC=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},wC(r,e)}function Ige(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function $1(r,e,t){return Ige()?$1=Reflect.construct:$1=function(n,i,s){var a=[null];a.push.apply(a,i);var o=Function.bind.apply(n,a),u=new o;return s&&wC(u,s.prototype),u},$1.apply(null,arguments)}function ru(r){return Mge(r)||Pge(r)||Fge(r)||Rge()}function Mge(r){if(Array.isArray(r))return xC(r)}function Pge(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Fge(r,e){if(r){if(typeof r=="string")return xC(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xC(r,e)}}function xC(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Rge(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Lge=Object.hasOwnProperty,UD=Object.setPrototypeOf,Oge=Object.isFrozen,Uge=Object.getPrototypeOf,Dge=Object.getOwnPropertyDescriptor,Da=Object.freeze,sc=Object.seal,Nge=Object.create,DD=typeof Reflect<"u"&&Reflect,G1=DD.apply,BC=DD.construct;G1||(G1=function(r,e,t){return r.apply(e,t)}),Da||(Da=function(r){return r}),sc||(sc=function(r){return r}),BC||(BC=function(r,e){return $1(r,ru(e))});var kge=oc(Array.prototype.forEach),ND=oc(Array.prototype.pop),Hm=oc(Array.prototype.push),q1=oc(String.prototype.toLowerCase),CC=oc(String.prototype.toString),kD=oc(String.prototype.match),nu=oc(String.prototype.replace),Qge=oc(String.prototype.indexOf),zge=oc(String.prototype.trim),Ko=oc(RegExp.prototype.test),TC=Hge(TypeError);function oc(r){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return G1(r,e,n)}}function Hge(r){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return BC(r,t)}}function Fn(r,e,t){var n;t=(n=t)!==null&&n!==void 0?n:q1,UD&&UD(r,null);for(var i=e.length;i--;){var s=e[i];if(typeof s=="string"){var a=t(s);a!==s&&(Oge(e)||(e[i]=a),s=a)}r[s]=!0}return r}function sd(r){var e=Nge(null),t;for(t in r)G1(Lge,r,[t])===!0&&(e[t]=r[t]);return e}function K1(r,e){for(;r!==null;){var t=Dge(r,e);if(t){if(t.get)return oc(t.get);if(typeof t.value=="function")return oc(t.value)}r=Uge(r)}function n(i){return console.warn("fallback value for",i),null}return n}var QD=Da(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),EC=Da(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),SC=Da(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Vge=Da(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),IC=Da(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),jge=Da(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),zD=Da(["#text"]),HD=Da(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),MC=Da(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),VD=Da(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),W1=Da(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),$ge=sc(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Gge=sc(/<%[\w\W]*|[\w\W]*%>/gm),qge=sc(/\${[\w\W]*}/gm),Kge=sc(/^data-[\-\w.\u00B7-\uFFFF]+$/),Wge=sc(/^aria-[\-\w]+$/),Xge=sc(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Yge=sc(/^(?:\w+script|data):/i),Zge=sc(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Jge=sc(/^html$/i),eme=sc(/^[a-z][.\w]*(-[.\w]+)+$/i),tme=function(){return typeof window>"u"?null:window},rme=function(r,e){if(qA(r)!=="object"||typeof r.createPolicy!="function")return null;var t=null,n="data-tt-policy-suffix";e.currentScript&&e.currentScript.hasAttribute(n)&&(t=e.currentScript.getAttribute(n));var i="dompurify"+(t?"#"+t:"");try{return r.createPolicy(i,{createHTML:function(s){return s},createScriptURL:function(s){return s}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function jD(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:tme(),e=function(Ke){return jD(Ke)};if(e.version="2.5.8",e.removed=[],!r||!r.document||r.document.nodeType!==9)return e.isSupported=!1,e;var t=r.document,n=r.document,i=r.DocumentFragment,s=r.HTMLTemplateElement,a=r.Node,o=r.Element,u=r.NodeFilter,d=r.NamedNodeMap,p=d===void 0?r.NamedNodeMap||r.MozNamedAttrMap:d,_=r.HTMLFormElement,w=r.DOMParser,v=r.trustedTypes,M=o.prototype,P=K1(M,"cloneNode"),D=K1(M,"nextSibling"),N=K1(M,"childNodes"),z=K1(M,"parentNode");if(typeof s=="function"){var W=n.createElement("template");W.content&&W.content.ownerDocument&&(n=W.content.ownerDocument)}var V=rme(v,t),$=V?V.createHTML(""):"",q=n,te=q.implementation,J=q.createNodeIterator,me=q.createDocumentFragment,xe=q.getElementsByTagName,se=t.importNode,oe={};try{oe=sd(n).documentMode?n.documentMode:{}}catch{}var ve={};e.isSupported=typeof z=="function"&&te&&te.createHTMLDocument!==void 0&&oe!==9;var ge=$ge,Je=Gge,Ge=qge,et=Kge,Ye=Wge,ct=Yge,At=Zge,kt=eme,ae=Xge,Te=null,Le=Fn({},[].concat(ru(QD),ru(EC),ru(SC),ru(IC),ru(zD))),De=null,at=Fn({},[].concat(ru(HD),ru(MC),ru(VD),ru(W1))),rt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),xt=null,vt=null,nr=!0,qt=!0,or=!1,gr=!0,wr=!1,Ot=!0,ze=!1,$r=!1,Rr=!1,Jt=!1,tr=!1,mr=!1,_r=!0,Ut=!1,ar="user-content-",Sr=!0,Er=!1,Dr={},nn=null,Hr=Fn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Wr=null,vr=Fn({},["audio","video","img","source","image","track"]),Qn=null,un=Fn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ni="http://www.w3.org/1998/Math/MathML",Be="http://www.w3.org/2000/svg",ce="http://www.w3.org/1999/xhtml",de=ce,_e=!1,Ue=null,je=Fn({},[ni,Be,ce],CC),lt,dt=["application/xhtml+xml","text/html"],Ze="text/html",ht,bt=null,pt=n.createElement("form"),We=function(Ke){return Ke instanceof RegExp||Ke instanceof Function},hr=function(Ke){bt&&bt===Ke||((!Ke||qA(Ke)!=="object")&&(Ke={}),Ke=sd(Ke),lt=dt.indexOf(Ke.PARSER_MEDIA_TYPE)===-1?lt=Ze:lt=Ke.PARSER_MEDIA_TYPE,ht=lt==="application/xhtml+xml"?CC:q1,Te="ALLOWED_TAGS"in Ke?Fn({},Ke.ALLOWED_TAGS,ht):Le,De="ALLOWED_ATTR"in Ke?Fn({},Ke.ALLOWED_ATTR,ht):at,Ue="ALLOWED_NAMESPACES"in Ke?Fn({},Ke.ALLOWED_NAMESPACES,CC):je,Qn="ADD_URI_SAFE_ATTR"in Ke?Fn(sd(un),Ke.ADD_URI_SAFE_ATTR,ht):un,Wr="ADD_DATA_URI_TAGS"in Ke?Fn(sd(vr),Ke.ADD_DATA_URI_TAGS,ht):vr,nn="FORBID_CONTENTS"in Ke?Fn({},Ke.FORBID_CONTENTS,ht):Hr,xt="FORBID_TAGS"in Ke?Fn({},Ke.FORBID_TAGS,ht):{},vt="FORBID_ATTR"in Ke?Fn({},Ke.FORBID_ATTR,ht):{},Dr="USE_PROFILES"in Ke?Ke.USE_PROFILES:!1,nr=Ke.ALLOW_ARIA_ATTR!==!1,qt=Ke.ALLOW_DATA_ATTR!==!1,or=Ke.ALLOW_UNKNOWN_PROTOCOLS||!1,gr=Ke.ALLOW_SELF_CLOSE_IN_ATTR!==!1,wr=Ke.SAFE_FOR_TEMPLATES||!1,Ot=Ke.SAFE_FOR_XML!==!1,ze=Ke.WHOLE_DOCUMENT||!1,Jt=Ke.RETURN_DOM||!1,tr=Ke.RETURN_DOM_FRAGMENT||!1,mr=Ke.RETURN_TRUSTED_TYPE||!1,Rr=Ke.FORCE_BODY||!1,_r=Ke.SANITIZE_DOM!==!1,Ut=Ke.SANITIZE_NAMED_PROPS||!1,Sr=Ke.KEEP_CONTENT!==!1,Er=Ke.IN_PLACE||!1,ae=Ke.ALLOWED_URI_REGEXP||ae,de=Ke.NAMESPACE||ce,rt=Ke.CUSTOM_ELEMENT_HANDLING||{},Ke.CUSTOM_ELEMENT_HANDLING&&We(Ke.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(rt.tagNameCheck=Ke.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Ke.CUSTOM_ELEMENT_HANDLING&&We(Ke.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(rt.attributeNameCheck=Ke.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Ke.CUSTOM_ELEMENT_HANDLING&&typeof Ke.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(rt.allowCustomizedBuiltInElements=Ke.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),wr&&(qt=!1),tr&&(Jt=!0),Dr&&(Te=Fn({},ru(zD)),De=[],Dr.html===!0&&(Fn(Te,QD),Fn(De,HD)),Dr.svg===!0&&(Fn(Te,EC),Fn(De,MC),Fn(De,W1)),Dr.svgFilters===!0&&(Fn(Te,SC),Fn(De,MC),Fn(De,W1)),Dr.mathMl===!0&&(Fn(Te,IC),Fn(De,VD),Fn(De,W1))),Ke.ADD_TAGS&&(Te===Le&&(Te=sd(Te)),Fn(Te,Ke.ADD_TAGS,ht)),Ke.ADD_ATTR&&(De===at&&(De=sd(De)),Fn(De,Ke.ADD_ATTR,ht)),Ke.ADD_URI_SAFE_ATTR&&Fn(Qn,Ke.ADD_URI_SAFE_ATTR,ht),Ke.FORBID_CONTENTS&&(nn===Hr&&(nn=sd(nn)),Fn(nn,Ke.FORBID_CONTENTS,ht)),Sr&&(Te["#text"]=!0),ze&&Fn(Te,["html","head","body"]),Te.table&&(Fn(Te,["tbody"]),delete xt.tbody),Da&&Da(Ke),bt=Ke)},sr=Fn({},["mi","mo","mn","ms","mtext"]),rr=Fn({},["annotation-xml"]),Nr=Fn({},["title","style","font","a","script"]),Rt=Fn({},EC);Fn(Rt,SC),Fn(Rt,Vge);var ir=Fn({},IC);Fn(ir,jge);var br=function(Ke){var Pr=z(Ke);(!Pr||!Pr.tagName)&&(Pr={namespaceURI:de,tagName:"template"});var cr=q1(Ke.tagName),pn=q1(Pr.tagName);return Ue[Ke.namespaceURI]?Ke.namespaceURI===Be?Pr.namespaceURI===ce?cr==="svg":Pr.namespaceURI===ni?cr==="svg"&&(pn==="annotation-xml"||sr[pn]):!!Rt[cr]:Ke.namespaceURI===ni?Pr.namespaceURI===ce?cr==="math":Pr.namespaceURI===Be?cr==="math"&&rr[pn]:!!ir[cr]:Ke.namespaceURI===ce?Pr.namespaceURI===Be&&!rr[pn]||Pr.namespaceURI===ni&&!sr[pn]?!1:!ir[cr]&&(Nr[cr]||!Rt[cr]):!!(lt==="application/xhtml+xml"&&Ue[Ke.namespaceURI]):!1},kr=function(Ke){Hm(e.removed,{element:Ke});try{Ke.parentNode.removeChild(Ke)}catch{try{Ke.outerHTML=$}catch{Ke.remove()}}},en=function(Ke,Pr){try{Hm(e.removed,{attribute:Pr.getAttributeNode(Ke),from:Pr})}catch{Hm(e.removed,{attribute:null,from:Pr})}if(Pr.removeAttribute(Ke),Ke==="is"&&!De[Ke])if(Jt||tr)try{kr(Pr)}catch{}else try{Pr.setAttribute(Ke,"")}catch{}},jr=function(Ke){var Pr,cr;if(Rr)Ke="<remove></remove>"+Ke;else{var pn=kD(Ke,/^[\r\n\t ]+/);cr=pn&&pn[0]}lt==="application/xhtml+xml"&&de===ce&&(Ke='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Ke+"</body></html>");var di=V?V.createHTML(Ke):Ke;if(de===ce)try{Pr=new w().parseFromString(di,lt)}catch{}if(!Pr||!Pr.documentElement){Pr=te.createDocument(de,"template",null);try{Pr.documentElement.innerHTML=_e?$:di}catch{}}var As=Pr.body||Pr.documentElement;return Ke&&cr&&As.insertBefore(n.createTextNode(cr),As.childNodes[0]||null),de===ce?xe.call(Pr,ze?"html":"body")[0]:ze?Pr.documentElement:As},Br=function(Ke){return J.call(Ke.ownerDocument||Ke,Ke,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null,!1)},Sn=function(Ke){return Ke instanceof _&&(typeof Ke.nodeName!="string"||typeof Ke.textContent!="string"||typeof Ke.removeChild!="function"||!(Ke.attributes instanceof p)||typeof Ke.removeAttribute!="function"||typeof Ke.setAttribute!="function"||typeof Ke.namespaceURI!="string"||typeof Ke.insertBefore!="function"||typeof Ke.hasChildNodes!="function")},Ti=function(Ke){return qA(a)==="object"?Ke instanceof a:Ke&&qA(Ke)==="object"&&typeof Ke.nodeType=="number"&&typeof Ke.nodeName=="string"},Bn=function(Ke,Pr,cr){ve[Ke]&&kge(ve[Ke],function(pn){pn.call(e,Pr,cr,bt)})},zn=function(Ke){var Pr;if(Bn("beforeSanitizeElements",Ke,null),Sn(Ke)||Ko(/[\u0080-\uFFFF]/,Ke.nodeName))return kr(Ke),!0;var cr=ht(Ke.nodeName);if(Bn("uponSanitizeElement",Ke,{tagName:cr,allowedTags:Te}),Ke.hasChildNodes()&&!Ti(Ke.firstElementChild)&&(!Ti(Ke.content)||!Ti(Ke.content.firstElementChild))&&Ko(/<[/\w]/g,Ke.innerHTML)&&Ko(/<[/\w]/g,Ke.textContent)||cr==="select"&&Ko(/<template/i,Ke.innerHTML)||Ke.nodeType===7||Ot&&Ke.nodeType===8&&Ko(/<[/\w]/g,Ke.data))return kr(Ke),!0;if(!Te[cr]||xt[cr]){if(!xt[cr]&&yi(cr)&&(rt.tagNameCheck instanceof RegExp&&Ko(rt.tagNameCheck,cr)||rt.tagNameCheck instanceof Function&&rt.tagNameCheck(cr)))return!1;if(Sr&&!nn[cr]){var pn=z(Ke)||Ke.parentNode,di=N(Ke)||Ke.childNodes;if(di&&pn)for(var As=di.length,li=As-1;li>=0;--li){var xs=P(di[li],!0);xs.__removalCount=(Ke.__removalCount||0)+1,pn.insertBefore(xs,D(Ke))}}return kr(Ke),!0}return Ke instanceof o&&!br(Ke)||(cr==="noscript"||cr==="noembed"||cr==="noframes")&&Ko(/<\/no(script|embed|frames)/i,Ke.innerHTML)?(kr(Ke),!0):(wr&&Ke.nodeType===3&&(Pr=Ke.textContent,Pr=nu(Pr,ge," "),Pr=nu(Pr,Je," "),Pr=nu(Pr,Ge," "),Ke.textContent!==Pr&&(Hm(e.removed,{element:Ke.cloneNode()}),Ke.textContent=Pr)),Bn("afterSanitizeElements",Ke,null),!1)},Cn=function(Ke,Pr,cr){if(_r&&(Pr==="id"||Pr==="name")&&(cr in n||cr in pt))return!1;if(!(qt&&!vt[Pr]&&Ko(et,Pr))&&!(nr&&Ko(Ye,Pr))){if(!De[Pr]||vt[Pr]){if(!(yi(Ke)&&(rt.tagNameCheck instanceof RegExp&&Ko(rt.tagNameCheck,Ke)||rt.tagNameCheck instanceof Function&&rt.tagNameCheck(Ke))&&(rt.attributeNameCheck instanceof RegExp&&Ko(rt.attributeNameCheck,Pr)||rt.attributeNameCheck instanceof Function&&rt.attributeNameCheck(Pr))||Pr==="is"&&rt.allowCustomizedBuiltInElements&&(rt.tagNameCheck instanceof RegExp&&Ko(rt.tagNameCheck,cr)||rt.tagNameCheck instanceof Function&&rt.tagNameCheck(cr))))return!1}else if(!Qn[Pr]&&!Ko(ae,nu(cr,At,""))&&!((Pr==="src"||Pr==="xlink:href"||Pr==="href")&&Ke!=="script"&&Qge(cr,"data:")===0&&Wr[Ke])&&!(or&&!Ko(ct,nu(cr,At,"")))&&cr)return!1}return!0},yi=function(Ke){return Ke!=="annotation-xml"&&kD(Ke,kt)},Un=function(Ke){var Pr,cr,pn,di;Bn("beforeSanitizeAttributes",Ke,null);var As=Ke.attributes;if(!(!As||Sn(Ke))){var li={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:De};for(di=As.length;di--;){Pr=As[di];var xs=Pr,vo=xs.name,ss=xs.namespaceURI;if(cr=vo==="value"?Pr.value:zge(Pr.value),pn=ht(vo),li.attrName=pn,li.attrValue=cr,li.keepAttr=!0,li.forceKeepAttr=void 0,Bn("uponSanitizeAttribute",Ke,li),cr=li.attrValue,!li.forceKeepAttr&&(en(vo,Ke),!!li.keepAttr)){if(!gr&&Ko(/\/>/i,cr)){en(vo,Ke);continue}wr&&(cr=nu(cr,ge," "),cr=nu(cr,Je," "),cr=nu(cr,Ge," "));var oh=ht(Ke.nodeName);if(Cn(oh,pn,cr)){if(Ut&&(pn==="id"||pn==="name")&&(en(vo,Ke),cr=ar+cr),Ot&&Ko(/((--!?|])>)|<\/(style|title)/i,cr)){en(vo,Ke);continue}if(V&&qA(v)==="object"&&typeof v.getAttributeType=="function"&&!ss)switch(v.getAttributeType(oh,pn)){case"TrustedHTML":{cr=V.createHTML(cr);break}case"TrustedScriptURL":{cr=V.createScriptURL(cr);break}}try{ss?Ke.setAttributeNS(ss,vo,cr):Ke.setAttribute(vo,cr),Sn(Ke)?kr(Ke):ND(e.removed)}catch{}}}}Bn("afterSanitizeAttributes",Ke,null)}},ba=function Ke(Pr){var cr,pn=Br(Pr);for(Bn("beforeSanitizeShadowDOM",Pr,null);cr=pn.nextNode();)Bn("uponSanitizeShadowNode",cr,null),zn(cr),Un(cr),cr.content instanceof i&&Ke(cr.content);Bn("afterSanitizeShadowDOM",Pr,null)};return e.sanitize=function(Ke){var Pr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},cr,pn,di,As,li;if(_e=!Ke,_e&&(Ke="<!-->"),typeof Ke!="string"&&!Ti(Ke))if(typeof Ke.toString=="function"){if(Ke=Ke.toString(),typeof Ke!="string")throw TC("dirty is not a string, aborting")}else throw TC("toString is not a function");if(!e.isSupported){if(qA(r.toStaticHTML)==="object"||typeof r.toStaticHTML=="function"){if(typeof Ke=="string")return r.toStaticHTML(Ke);if(Ti(Ke))return r.toStaticHTML(Ke.outerHTML)}return Ke}if($r||hr(Pr),e.removed=[],typeof Ke=="string"&&(Er=!1),Er){if(Ke.nodeName){var xs=ht(Ke.nodeName);if(!Te[xs]||xt[xs])throw TC("root node is forbidden and cannot be sanitized in-place")}}else if(Ke instanceof a)cr=jr("<!---->"),pn=cr.ownerDocument.importNode(Ke,!0),pn.nodeType===1&&pn.nodeName==="BODY"||pn.nodeName==="HTML"?cr=pn:cr.appendChild(pn);else{if(!Jt&&!wr&&!ze&&Ke.indexOf("<")===-1)return V&&mr?V.createHTML(Ke):Ke;if(cr=jr(Ke),!cr)return Jt?null:mr?$:""}cr&&Rr&&kr(cr.firstChild);for(var vo=Br(Er?Ke:cr);di=vo.nextNode();)di.nodeType===3&&di===As||(zn(di),Un(di),di.content instanceof i&&ba(di.content),As=di);if(As=null,Er)return Ke;if(Jt){if(tr)for(li=me.call(cr.ownerDocument);cr.firstChild;)li.appendChild(cr.firstChild);else li=cr;return(De.shadowroot||De.shadowrootmod)&&(li=se.call(t,li,!0)),li}var ss=ze?cr.outerHTML:cr.innerHTML;return ze&&Te["!doctype"]&&cr.ownerDocument&&cr.ownerDocument.doctype&&cr.ownerDocument.doctype.name&&Ko(Jge,cr.ownerDocument.doctype.name)&&(ss="<!DOCTYPE "+cr.ownerDocument.doctype.name+`>
`+ss),wr&&(ss=nu(ss,ge," "),ss=nu(ss,Je," "),ss=nu(ss,Ge," ")),V&&mr?V.createHTML(ss):ss},e.setConfig=function(Ke){hr(Ke),$r=!0},e.clearConfig=function(){bt=null,$r=!1},e.isValidAttribute=function(Ke,Pr,cr){bt||hr({});var pn=ht(Ke),di=ht(Pr);return Cn(pn,di,cr)},e.addHook=function(Ke,Pr){typeof Pr=="function"&&(ve[Ke]=ve[Ke]||[],Hm(ve[Ke],Pr))},e.removeHook=function(Ke){if(ve[Ke])return ND(ve[Ke])},e.removeHooks=function(Ke){ve[Ke]&&(ve[Ke]=[])},e.removeAllHooks=function(){ve={}},e}var nme=jD();const ime=Object.freeze(Object.defineProperty({__proto__:null,default:nme},Symbol.toStringTag,{value:"Module"}));var PC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $D(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var sme={},GD={},Vm,qD;function vs(){if(qD)return Vm;qD=1;var r=function(e){return e&&e.Math===Math&&e};return Vm=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof PC=="object"&&PC)||r(typeof Vm=="object"&&Vm)||function(){return this}()||Function("return this")(),Vm}var FC={},KD,WD;function Qs(){return WD||(WD=1,KD=function(r){try{return!!r()}catch{return!0}}),KD}var RC,XD;function iu(){if(XD)return RC;XD=1;var r=Qs();return RC=!r(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),RC}var LC,YD;function X1(){if(YD)return LC;YD=1;var r=Qs();return LC=!r(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),LC}var OC,ZD;function Wo(){if(ZD)return OC;ZD=1;var r=X1(),e=Function.prototype.call;return OC=r?e.bind(e):function(){return e.apply(e,arguments)},OC}var UC={},JD;function ome(){if(JD)return UC;JD=1;var r={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,t=e&&!r.call({1:2},1);return UC.f=t?function(n){var i=e(this,n);return!!i&&i.enumerable}:r,UC}var eN,tN;function DC(){return tN||(tN=1,eN=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}}),eN}var NC,rN;function zs(){if(rN)return NC;rN=1;var r=X1(),e=Function.prototype,t=e.call,n=r&&e.bind.bind(t,t);return NC=r?n:function(i){return function(){return t.apply(i,arguments)}},NC}var kC,nN;function od(){if(nN)return kC;nN=1;var r=zs(),e=r({}.toString),t=r("".slice);return kC=function(n){return t(e(n),8,-1)},kC}var QC,iN;function sN(){if(iN)return QC;iN=1;var r=zs(),e=Qs(),t=od(),n=Object,i=r("".split);return QC=e(function(){return!n("z").propertyIsEnumerable(0)})?function(s){return t(s)==="String"?i(s,""):n(s)}:n,QC}var oN,aN;function ad(){return aN||(aN=1,oN=function(r){return r==null}),oN}var zC,lN;function su(){if(lN)return zC;lN=1;var r=ad(),e=TypeError;return zC=function(t){if(r(t))throw new e("Can't call method on "+t);return t},zC}var HC,cN;function jm(){if(cN)return HC;cN=1;var r=sN(),e=su();return HC=function(t){return r(e(t))},HC}var VC,uN;function Hs(){if(uN)return VC;uN=1;var r=typeof document=="object"&&document.all;return VC=typeof r>"u"&&r!==void 0?function(e){return typeof e=="function"||e===r}:function(e){return typeof e=="function"},VC}var jC,hN;function ou(){if(hN)return jC;hN=1;var r=Hs();return jC=function(e){return typeof e=="object"?e!==null:r(e)},jC}var $C,AN;function ld(){if(AN)return $C;AN=1;var r=vs(),e=Hs(),t=function(n){return e(n)?n:void 0};return $C=function(n,i){return arguments.length<2?t(r[n]):r[n]&&r[n][i]},$C}var GC,fN;function Y1(){if(fN)return GC;fN=1;var r=zs();return GC=r({}.isPrototypeOf),GC}var qC,dN;function $m(){if(dN)return qC;dN=1;var r=vs(),e=r.navigator,t=e&&e.userAgent;return qC=t?String(t):"",qC}var KC,pN;function WC(){if(pN)return KC;pN=1;var r=vs(),e=$m(),t=r.process,n=r.Deno,i=t&&t.versions||n&&n.version,s=i&&i.v8,a,o;return s&&(a=s.split("."),o=a[0]>0&&a[0]<4?1:+(a[0]+a[1])),!o&&e&&(a=e.match(/Edge\/(\d+)/),(!a||a[1]>=74)&&(a=e.match(/Chrome\/(\d+)/),a&&(o=+a[1]))),KC=o,KC}var XC,gN;function mN(){if(gN)return XC;gN=1;var r=WC(),e=Qs(),t=vs(),n=t.String;return XC=!!Object.getOwnPropertySymbols&&!e(function(){var i=Symbol("symbol detection");return!n(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&r&&r<41}),XC}var YC,_N;function yN(){if(_N)return YC;_N=1;var r=mN();return YC=r&&!Symbol.sham&&typeof Symbol.iterator=="symbol",YC}var ZC,bN;function vN(){if(bN)return ZC;bN=1;var r=ld(),e=Hs(),t=Y1(),n=yN(),i=Object;return ZC=n?function(s){return typeof s=="symbol"}:function(s){var a=r("Symbol");return e(a)&&t(a.prototype,i(s))},ZC}var JC,wN;function Z1(){if(wN)return JC;wN=1;var r=String;return JC=function(e){try{return r(e)}catch{return"Object"}},JC}var eT,xN;function kh(){if(xN)return eT;xN=1;var r=Hs(),e=Z1(),t=TypeError;return eT=function(n){if(r(n))return n;throw new t(e(n)+" is not a function")},eT}var tT,BN;function $p(){if(BN)return tT;BN=1;var r=kh(),e=ad();return tT=function(t,n){var i=t[n];return e(i)?void 0:r(i)},tT}var rT,CN;function ame(){if(CN)return rT;CN=1;var r=Wo(),e=Hs(),t=ou(),n=TypeError;return rT=function(i,s){var a,o;if(s==="string"&&e(a=i.toString)&&!t(o=r(a,i))||e(a=i.valueOf)&&!t(o=r(a,i))||s!=="string"&&e(a=i.toString)&&!t(o=r(a,i)))return o;throw new n("Can't convert object to primitive value")},rT}var nT={exports:{}},TN,EN;function ih(){return EN||(EN=1,TN=!1),TN}var iT,SN;function sT(){if(SN)return iT;SN=1;var r=vs(),e=Object.defineProperty;return iT=function(t,n){try{e(r,t,{value:n,configurable:!0,writable:!0})}catch{r[t]=n}return n},iT}var IN;function oT(){if(IN)return nT.exports;IN=1;var r=ih(),e=vs(),t=sT(),n="__core-js_shared__",i=nT.exports=e[n]||t(n,{});return(i.versions||(i.versions=[])).push({version:"3.40.0",mode:r?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.40.0/LICENSE",source:"https://github.com/zloirock/core-js"}),nT.exports}var aT,MN;function lT(){if(MN)return aT;MN=1;var r=oT();return aT=function(e,t){return r[e]||(r[e]=t||{})},aT}var cT,PN;function J1(){if(PN)return cT;PN=1;var r=su(),e=Object;return cT=function(t){return e(r(t))},cT}var uT,FN;function au(){if(FN)return uT;FN=1;var r=zs(),e=J1(),t=r({}.hasOwnProperty);return uT=Object.hasOwn||function(n,i){return t(e(n),i)},uT}var hT,RN;function LN(){if(RN)return hT;RN=1;var r=zs(),e=0,t=Math.random(),n=r(1 .toString);return hT=function(i){return"Symbol("+(i===void 0?"":i)+")_"+n(++e+t,36)},hT}var AT,ON;function Uo(){if(ON)return AT;ON=1;var r=vs(),e=lT(),t=au(),n=LN(),i=mN(),s=yN(),a=r.Symbol,o=e("wks"),u=s?a.for||a:a&&a.withoutSetter||n;return AT=function(d){return t(o,d)||(o[d]=i&&t(a,d)?a[d]:u("Symbol."+d)),o[d]},AT}var fT,UN;function lme(){if(UN)return fT;UN=1;var r=Wo(),e=ou(),t=vN(),n=$p(),i=ame(),s=Uo(),a=TypeError,o=s("toPrimitive");return fT=function(u,d){if(!e(u)||t(u))return u;var p=n(u,o),_;if(p){if(d===void 0&&(d="default"),_=r(p,u,d),!e(_)||t(_))return _;throw new a("Can't convert object to primitive value")}return d===void 0&&(d="number"),i(u,d)},fT}var dT,DN;function NN(){if(DN)return dT;DN=1;var r=lme(),e=vN();return dT=function(t){var n=r(t,"string");return e(n)?n:n+""},dT}var pT,kN;function eb(){if(kN)return pT;kN=1;var r=vs(),e=ou(),t=r.document,n=e(t)&&e(t.createElement);return pT=function(i){return n?t.createElement(i):{}},pT}var gT,QN;function zN(){if(QN)return gT;QN=1;var r=iu(),e=Qs(),t=eb();return gT=!r&&!e(function(){return Object.defineProperty(t("div"),"a",{get:function(){return 7}}).a!==7}),gT}var HN;function tb(){if(HN)return FC;HN=1;var r=iu(),e=Wo(),t=ome(),n=DC(),i=jm(),s=NN(),a=au(),o=zN(),u=Object.getOwnPropertyDescriptor;return FC.f=r?u:function(d,p){if(d=i(d),p=s(p),o)try{return u(d,p)}catch{}if(a(d,p))return n(!e(t.f,d,p),d[p])},FC}var mT={},_T,VN;function jN(){if(VN)return _T;VN=1;var r=iu(),e=Qs();return _T=r&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),_T}var yT,$N;function Na(){if($N)return yT;$N=1;var r=ou(),e=String,t=TypeError;return yT=function(n){if(r(n))return n;throw new t(e(n)+" is not an object")},yT}var GN;function KA(){if(GN)return mT;GN=1;var r=iu(),e=zN(),t=jN(),n=Na(),i=NN(),s=TypeError,a=Object.defineProperty,o=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",p="writable";return mT.f=r?t?function(_,w,v){if(n(_),w=i(w),n(v),typeof _=="function"&&w==="prototype"&&"value"in v&&p in v&&!v[p]){var M=o(_,w);M&&M[p]&&(_[w]=v.value,v={configurable:d in v?v[d]:M[d],enumerable:u in v?v[u]:M[u],writable:!1})}return a(_,w,v)}:a:function(_,w,v){if(n(_),w=i(w),n(v),e)try{return a(_,w,v)}catch{}if("get"in v||"set"in v)throw new s("Accessors not supported");return"value"in v&&(_[w]=v.value),_},mT}var bT,qN;function Gm(){if(qN)return bT;qN=1;var r=iu(),e=KA(),t=DC();return bT=r?function(n,i,s){return e.f(n,i,t(1,s))}:function(n,i,s){return n[i]=s,n},bT}var vT={exports:{}},wT,KN;function rb(){if(KN)return wT;KN=1;var r=iu(),e=au(),t=Function.prototype,n=r&&Object.getOwnPropertyDescriptor,i=e(t,"name"),s=i&&(function(){}).name==="something",a=i&&(!r||r&&n(t,"name").configurable);return wT={EXISTS:i,PROPER:s,CONFIGURABLE:a},wT}var xT,WN;function BT(){if(WN)return xT;WN=1;var r=zs(),e=Hs(),t=oT(),n=r(Function.toString);return e(t.inspectSource)||(t.inspectSource=function(i){return n(i)}),xT=t.inspectSource,xT}var CT,XN;function cme(){if(XN)return CT;XN=1;var r=vs(),e=Hs(),t=r.WeakMap;return CT=e(t)&&/native code/.test(String(t)),CT}var TT,YN;function ET(){if(YN)return TT;YN=1;var r=lT(),e=LN(),t=r("keys");return TT=function(n){return t[n]||(t[n]=e(n))},TT}var ZN,JN;function ST(){return JN||(JN=1,ZN={}),ZN}var IT,ek;function nb(){if(ek)return IT;ek=1;var r=cme(),e=vs(),t=ou(),n=Gm(),i=au(),s=oT(),a=ET(),o=ST(),u="Object already initialized",d=e.TypeError,p=e.WeakMap,_,w,v,M=function(z){return v(z)?w(z):_(z,{})},P=function(z){return function(W){var V;if(!t(W)||(V=w(W)).type!==z)throw new d("Incompatible receiver, "+z+" required");return V}};if(r||s.state){var D=s.state||(s.state=new p);D.get=D.get,D.has=D.has,D.set=D.set,_=function(z,W){if(D.has(z))throw new d(u);return W.facade=z,D.set(z,W),W},w=function(z){return D.get(z)||{}},v=function(z){return D.has(z)}}else{var N=a("state");o[N]=!0,_=function(z,W){if(i(z,N))throw new d(u);return W.facade=z,n(z,N,W),W},w=function(z){return i(z,N)?z[N]:{}},v=function(z){return i(z,N)}}return IT={set:_,get:w,has:v,enforce:M,getterFor:P},IT}var tk;function rk(){if(tk)return vT.exports;tk=1;var r=zs(),e=Qs(),t=Hs(),n=au(),i=iu(),s=rb().CONFIGURABLE,a=BT(),o=nb(),u=o.enforce,d=o.get,p=String,_=Object.defineProperty,w=r("".slice),v=r("".replace),M=r([].join),P=i&&!e(function(){return _(function(){},"length",{value:8}).length!==8}),D=String(String).split("String"),N=vT.exports=function(z,W,V){w(p(W),0,7)==="Symbol("&&(W="["+v(p(W),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),V&&V.getter&&(W="get "+W),V&&V.setter&&(W="set "+W),(!n(z,"name")||s&&z.name!==W)&&(i?_(z,"name",{value:W,configurable:!0}):z.name=W),P&&V&&n(V,"arity")&&z.length!==V.arity&&_(z,"length",{value:V.arity});try{V&&n(V,"constructor")&&V.constructor?i&&_(z,"prototype",{writable:!1}):z.prototype&&(z.prototype=void 0)}catch{}var $=u(z);return n($,"source")||($.source=M(D,typeof W=="string"?W:"")),z};return Function.prototype.toString=N(function(){return t(this)&&d(this).source||a(this)},"toString"),vT.exports}var MT,nk;function cd(){if(nk)return MT;nk=1;var r=Hs(),e=KA(),t=rk(),n=sT();return MT=function(i,s,a,o){o||(o={});var u=o.enumerable,d=o.name!==void 0?o.name:s;if(r(a)&&t(a,d,o),o.global)u?i[s]=a:n(s,a);else{try{o.unsafe?i[s]&&(u=!0):delete i[s]}catch{}u?i[s]=a:e.f(i,s,{value:a,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return i},MT}var PT={},FT,ik;function ume(){if(ik)return FT;ik=1;var r=Math.ceil,e=Math.floor;return FT=Math.trunc||function(t){var n=+t;return(n>0?e:r)(n)},FT}var RT,sk;function ib(){if(sk)return RT;sk=1;var r=ume();return RT=function(e){var t=+e;return t!==t||t===0?0:r(t)},RT}var LT,ok;function hme(){if(ok)return LT;ok=1;var r=ib(),e=Math.max,t=Math.min;return LT=function(n,i){var s=r(n);return s<0?e(s+i,0):t(s,i)},LT}var OT,ak;function Gp(){if(ak)return OT;ak=1;var r=ib(),e=Math.min;return OT=function(t){var n=r(t);return n>0?e(n,9007199254740991):0},OT}var UT,lk;function DT(){if(lk)return UT;lk=1;var r=Gp();return UT=function(e){return r(e.length)},UT}var NT,ck;function uk(){if(ck)return NT;ck=1;var r=jm(),e=hme(),t=DT(),n=function(i){return function(s,a,o){var u=r(s),d=t(u);if(d===0)return!i&&-1;var p=e(o,d),_;if(i&&a!==a){for(;d>p;)if(_=u[p++],_!==_)return!0}else for(;d>p;p++)if((i||p in u)&&u[p]===a)return i||p||0;return!i&&-1}};return NT={includes:n(!0),indexOf:n(!1)},NT}var kT,hk;function Ak(){if(hk)return kT;hk=1;var r=zs(),e=au(),t=jm(),n=uk().indexOf,i=ST(),s=r([].push);return kT=function(a,o){var u=t(a),d=0,p=[],_;for(_ in u)!e(i,_)&&e(u,_)&&s(p,_);for(;o.length>d;)e(u,_=o[d++])&&(~n(p,_)||s(p,_));return p},kT}var fk,dk;function QT(){return dk||(dk=1,fk=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),fk}var pk;function Ame(){if(pk)return PT;pk=1;var r=Ak(),e=QT(),t=e.concat("length","prototype");return PT.f=Object.getOwnPropertyNames||function(n){return r(n,t)},PT}var gk={},mk;function fme(){return mk||(mk=1,gk.f=Object.getOwnPropertySymbols),gk}var zT,_k;function dme(){if(_k)return zT;_k=1;var r=ld(),e=zs(),t=Ame(),n=fme(),i=Na(),s=e([].concat);return zT=r("Reflect","ownKeys")||function(a){var o=t.f(i(a)),u=n.f;return u?s(o,u(a)):o},zT}var HT,yk;function pme(){if(yk)return HT;yk=1;var r=au(),e=dme(),t=tb(),n=KA();return HT=function(i,s,a){for(var o=e(s),u=n.f,d=t.f,p=0;p<o.length;p++){var _=o[p];!r(i,_)&&!(a&&r(a,_))&&u(i,_,d(s,_))}},HT}var VT,bk;function vk(){if(bk)return VT;bk=1;var r=Qs(),e=Hs(),t=/#|\.prototype\./,n=function(u,d){var p=s[i(u)];return p===o?!0:p===a?!1:e(d)?r(d):!!d},i=n.normalize=function(u){return String(u).replace(t,".").toLowerCase()},s=n.data={},a=n.NATIVE="N",o=n.POLYFILL="P";return VT=n,VT}var jT,wk;function ka(){if(wk)return jT;wk=1;var r=vs(),e=tb().f,t=Gm(),n=cd(),i=sT(),s=pme(),a=vk();return jT=function(o,u){var d=o.target,p=o.global,_=o.stat,w,v,M,P,D,N;if(p?v=r:_?v=r[d]||i(d,{}):v=r[d]&&r[d].prototype,v)for(M in u){if(D=u[M],o.dontCallGetSet?(N=e(v,M),P=N&&N.value):P=v[M],w=a(p?M:d+(_?".":"#")+M,o.forced),!w&&P!==void 0){if(typeof D==typeof P)continue;s(D,P)}(o.sham||P&&P.sham)&&t(D,"sham",!0),n(v,M,D,o)}},jT}var $T,xk;function Bk(){if(xk)return $T;xk=1;var r=vs(),e=$m(),t=od(),n=function(i){return e.slice(0,i.length)===i};return $T=function(){return n("Bun/")?"BUN":n("Cloudflare-Workers")?"CLOUDFLARE":n("Deno/")?"DENO":n("Node.js/")?"NODE":r.Bun&&typeof Bun.version=="string"?"BUN":r.Deno&&typeof Deno.version=="object"?"DENO":t(r.process)==="process"?"NODE":r.window&&r.document?"BROWSER":"REST"}(),$T}var GT,Ck;function sb(){if(Ck)return GT;Ck=1;var r=Bk();return GT=r==="NODE",GT}var qT,Tk;function gme(){if(Tk)return qT;Tk=1;var r=zs(),e=kh();return qT=function(t,n,i){try{return r(e(Object.getOwnPropertyDescriptor(t,n)[i]))}catch{}},qT}var KT,Ek;function mme(){if(Ek)return KT;Ek=1;var r=ou();return KT=function(e){return r(e)||e===null},KT}var WT,Sk;function _me(){if(Sk)return WT;Sk=1;var r=mme(),e=String,t=TypeError;return WT=function(n){if(r(n))return n;throw new t("Can't set "+e(n)+" as a prototype")},WT}var XT,Ik;function Mk(){if(Ik)return XT;Ik=1;var r=gme(),e=ou(),t=su(),n=_me();return XT=Object.setPrototypeOf||("__proto__"in{}?function(){var i=!1,s={},a;try{a=r(Object.prototype,"__proto__","set"),a(s,[]),i=s instanceof Array}catch{}return function(o,u){return t(o),n(u),e(o)&&(i?a(o,u):o.__proto__=u),o}}():void 0),XT}var YT,Pk;function ob(){if(Pk)return YT;Pk=1;var r=KA().f,e=au(),t=Uo(),n=t("toStringTag");return YT=function(i,s,a){i&&!a&&(i=i.prototype),i&&!e(i,n)&&r(i,n,{configurable:!0,value:s})},YT}var ZT,Fk;function yme(){if(Fk)return ZT;Fk=1;var r=rk(),e=KA();return ZT=function(t,n,i){return i.get&&r(i.get,n,{getter:!0}),i.set&&r(i.set,n,{setter:!0}),e.f(t,n,i)},ZT}var JT,Rk;function bme(){if(Rk)return JT;Rk=1;var r=ld(),e=yme(),t=Uo(),n=iu(),i=t("species");return JT=function(s){var a=r(s);n&&a&&!a[i]&&e(a,i,{configurable:!0,get:function(){return this}})},JT}var eE,Lk;function vme(){if(Lk)return eE;Lk=1;var r=Y1(),e=TypeError;return eE=function(t,n){if(r(n,t))return t;throw new e("Incorrect invocation")},eE}var tE,Ok;function wme(){if(Ok)return tE;Ok=1;var r=Uo(),e=r("toStringTag"),t={};return t[e]="z",tE=String(t)==="[object z]",tE}var rE,Uk;function nE(){if(Uk)return rE;Uk=1;var r=wme(),e=Hs(),t=od(),n=Uo(),i=n("toStringTag"),s=Object,a=t(function(){return arguments}())==="Arguments",o=function(u,d){try{return u[d]}catch{}};return rE=r?t:function(u){var d,p,_;return u===void 0?"Undefined":u===null?"Null":typeof(p=o(d=s(u),i))=="string"?p:a?t(d):(_=t(d))==="Object"&&e(d.callee)?"Arguments":_},rE}var iE,Dk;function xme(){if(Dk)return iE;Dk=1;var r=zs(),e=Qs(),t=Hs(),n=nE(),i=ld(),s=BT(),a=function(){},o=i("Reflect","construct"),u=/^\s*(?:class|function)\b/,d=r(u.exec),p=!u.test(a),_=function(v){if(!t(v))return!1;try{return o(a,[],v),!0}catch{return!1}},w=function(v){if(!t(v))return!1;switch(n(v)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!d(u,s(v))}catch{return!0}};return w.sham=!0,iE=!o||e(function(){var v;return _(_.call)||!_(Object)||!_(function(){v=!0})||v})?w:_,iE}var sE,Nk;function Bme(){if(Nk)return sE;Nk=1;var r=xme(),e=Z1(),t=TypeError;return sE=function(n){if(r(n))return n;throw new t(e(n)+" is not a constructor")},sE}var oE,kk;function Qk(){if(kk)return oE;kk=1;var r=Na(),e=Bme(),t=ad(),n=Uo(),i=n("species");return oE=function(s,a){var o=r(s).constructor,u;return o===void 0||t(u=r(o)[i])?a:e(u)},oE}var aE,zk;function Hk(){if(zk)return aE;zk=1;var r=X1(),e=Function.prototype,t=e.apply,n=e.call;return aE=typeof Reflect=="object"&&Reflect.apply||(r?n.bind(t):function(){return n.apply(t,arguments)}),aE}var lE,Vk;function ab(){if(Vk)return lE;Vk=1;var r=od(),e=zs();return lE=function(t){if(r(t)==="Function")return e(t)},lE}var cE,jk;function uE(){if(jk)return cE;jk=1;var r=ab(),e=kh(),t=X1(),n=r(r.bind);return cE=function(i,s){return e(i),s===void 0?i:t?n(i,s):function(){return i.apply(s,arguments)}},cE}var hE,$k;function Gk(){if($k)return hE;$k=1;var r=ld();return hE=r("document","documentElement"),hE}var AE,qk;function Cme(){if(qk)return AE;qk=1;var r=zs();return AE=r([].slice),AE}var fE,Kk;function Tme(){if(Kk)return fE;Kk=1;var r=TypeError;return fE=function(e,t){if(e<t)throw new r("Not enough arguments");return e},fE}var dE,Wk;function Xk(){if(Wk)return dE;Wk=1;var r=$m();return dE=/(?:ipad|iphone|ipod).*applewebkit/i.test(r),dE}var pE,Yk;function Zk(){if(Yk)return pE;Yk=1;var r=vs(),e=Hk(),t=uE(),n=Hs(),i=au(),s=Qs(),a=Gk(),o=Cme(),u=eb(),d=Tme(),p=Xk(),_=sb(),w=r.setImmediate,v=r.clearImmediate,M=r.process,P=r.Dispatch,D=r.Function,N=r.MessageChannel,z=r.String,W=0,V={},$="onreadystatechange",q,te,J,me;s(function(){q=r.location});var xe=function(ge){if(i(V,ge)){var Je=V[ge];delete V[ge],Je()}},se=function(ge){return function(){xe(ge)}},oe=function(ge){xe(ge.data)},ve=function(ge){r.postMessage(z(ge),q.protocol+"//"+q.host)};return(!w||!v)&&(w=function(ge){d(arguments.length,1);var Je=n(ge)?ge:D(ge),Ge=o(arguments,1);return V[++W]=function(){e(Je,void 0,Ge)},te(W),W},v=function(ge){delete V[ge]},_?te=function(ge){M.nextTick(se(ge))}:P&&P.now?te=function(ge){P.now(se(ge))}:N&&!p?(J=new N,me=J.port2,J.port1.onmessage=oe,te=t(me.postMessage,me)):r.addEventListener&&n(r.postMessage)&&!r.importScripts&&q&&q.protocol!=="file:"&&!s(ve)?(te=ve,r.addEventListener("message",oe,!1)):$ in u("script")?te=function(ge){a.appendChild(u("script"))[$]=function(){a.removeChild(this),xe(ge)}}:te=function(ge){setTimeout(se(ge),0)}),pE={set:w,clear:v},pE}var gE,Jk;function Eme(){if(Jk)return gE;Jk=1;var r=vs(),e=iu(),t=Object.getOwnPropertyDescriptor;return gE=function(n){if(!e)return r[n];var i=t(r,n);return i&&i.value},gE}var mE,e6;function t6(){if(e6)return mE;e6=1;var r=function(){this.head=null,this.tail=null};return r.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e){var t=this.head=e.next;return t===null&&(this.tail=null),e.item}}},mE=r,mE}var _E,r6;function Sme(){if(r6)return _E;r6=1;var r=$m();return _E=/ipad|iphone|ipod/i.test(r)&&typeof Pebble<"u",_E}var yE,n6;function Ime(){if(n6)return yE;n6=1;var r=$m();return yE=/web0s(?!.*chrome)/i.test(r),yE}var bE,i6;function Mme(){if(i6)return bE;i6=1;var r=vs(),e=Eme(),t=uE(),n=Zk().set,i=t6(),s=Xk(),a=Sme(),o=Ime(),u=sb(),d=r.MutationObserver||r.WebKitMutationObserver,p=r.document,_=r.process,w=r.Promise,v=e("queueMicrotask"),M,P,D,N,z;if(!v){var W=new i,V=function(){var $,q;for(u&&($=_.domain)&&$.exit();q=W.get();)try{q()}catch(te){throw W.head&&M(),te}$&&$.enter()};!s&&!u&&!o&&d&&p?(P=!0,D=p.createTextNode(""),new d(V).observe(D,{characterData:!0}),M=function(){D.data=P=!P}):!a&&w&&w.resolve?(N=w.resolve(void 0),N.constructor=w,z=t(N.then,N),M=function(){z(V)}):u?M=function(){_.nextTick(V)}:(n=t(n,r),M=function(){n(V)}),v=function($){W.head||M(),W.add($)}}return bE=v,bE}var s6,o6;function Pme(){return o6||(o6=1,s6=function(r,e){try{arguments.length===1?console.error(r):console.error(r,e)}catch{}}),s6}var a6,l6;function vE(){return l6||(l6=1,a6=function(r){try{return{error:!1,value:r()}}catch(e){return{error:!0,value:e}}}),a6}var wE,c6;function qm(){if(c6)return wE;c6=1;var r=vs();return wE=r.Promise,wE}var xE,u6;function Km(){if(u6)return xE;u6=1;var r=vs(),e=qm(),t=Hs(),n=vk(),i=BT(),s=Uo(),a=Bk(),o=ih(),u=WC(),d=e&&e.prototype,p=s("species"),_=!1,w=t(r.PromiseRejectionEvent),v=n("Promise",function(){var M=i(e),P=M!==String(e);if(!P&&u===66||o&&!(d.catch&&d.finally))return!0;if(!u||u<51||!/native code/.test(M)){var D=new e(function(W){W(1)}),N=function(W){W(function(){},function(){})},z=D.constructor={};if(z[p]=N,_=D.then(function(){})instanceof N,!_)return!0}return!P&&(a==="BROWSER"||a==="DENO")&&!w});return xE={CONSTRUCTOR:v,REJECTION_EVENT:w,SUBCLASSING:_},xE}var BE={},h6;function Wm(){if(h6)return BE;h6=1;var r=kh(),e=TypeError,t=function(n){var i,s;this.promise=new n(function(a,o){if(i!==void 0||s!==void 0)throw new e("Bad Promise constructor");i=a,s=o}),this.resolve=r(i),this.reject=r(s)};return BE.f=function(n){return new t(n)},BE}var A6;function Fme(){if(A6)return GD;A6=1;var r=ka(),e=ih(),t=sb(),n=vs(),i=Wo(),s=cd(),a=Mk(),o=ob(),u=bme(),d=kh(),p=Hs(),_=ou(),w=vme(),v=Qk(),M=Zk().set,P=Mme(),D=Pme(),N=vE(),z=t6(),W=nb(),V=qm(),$=Km(),q=Wm(),te="Promise",J=$.CONSTRUCTOR,me=$.REJECTION_EVENT,xe=$.SUBCLASSING,se=W.getterFor(te),oe=W.set,ve=V&&V.prototype,ge=V,Je=ve,Ge=n.TypeError,et=n.document,Ye=n.process,ct=q.f,At=ct,kt=!!(et&&et.createEvent&&n.dispatchEvent),ae="unhandledrejection",Te="rejectionhandled",Le=0,De=1,at=2,rt=1,xt=2,vt,nr,qt,or,gr=function(Ut){var ar;return _(Ut)&&p(ar=Ut.then)?ar:!1},wr=function(Ut,ar){var Sr=ar.value,Er=ar.state===De,Dr=Er?Ut.ok:Ut.fail,nn=Ut.resolve,Hr=Ut.reject,Wr=Ut.domain,vr,Qn,un;try{Dr?(Er||(ar.rejection===xt&&Jt(ar),ar.rejection=rt),Dr===!0?vr=Sr:(Wr&&Wr.enter(),vr=Dr(Sr),Wr&&(Wr.exit(),un=!0)),vr===Ut.promise?Hr(new Ge("Promise-chain cycle")):(Qn=gr(vr))?i(Qn,vr,nn,Hr):nn(vr)):Hr(Sr)}catch(ni){Wr&&!un&&Wr.exit(),Hr(ni)}},Ot=function(Ut,ar){Ut.notified||(Ut.notified=!0,P(function(){for(var Sr=Ut.reactions,Er;Er=Sr.get();)wr(Er,Ut);Ut.notified=!1,ar&&!Ut.rejection&&$r(Ut)}))},ze=function(Ut,ar,Sr){var Er,Dr;kt?(Er=et.createEvent("Event"),Er.promise=ar,Er.reason=Sr,Er.initEvent(Ut,!1,!0),n.dispatchEvent(Er)):Er={promise:ar,reason:Sr},!me&&(Dr=n["on"+Ut])?Dr(Er):Ut===ae&&D("Unhandled promise rejection",Sr)},$r=function(Ut){i(M,n,function(){var ar=Ut.facade,Sr=Ut.value,Er=Rr(Ut),Dr;if(Er&&(Dr=N(function(){t?Ye.emit("unhandledRejection",Sr,ar):ze(ae,ar,Sr)}),Ut.rejection=t||Rr(Ut)?xt:rt,Dr.error))throw Dr.value})},Rr=function(Ut){return Ut.rejection!==rt&&!Ut.parent},Jt=function(Ut){i(M,n,function(){var ar=Ut.facade;t?Ye.emit("rejectionHandled",ar):ze(Te,ar,Ut.value)})},tr=function(Ut,ar,Sr){return function(Er){Ut(ar,Er,Sr)}},mr=function(Ut,ar,Sr){Ut.done||(Ut.done=!0,Sr&&(Ut=Sr),Ut.value=ar,Ut.state=at,Ot(Ut,!0))},_r=function(Ut,ar,Sr){if(!Ut.done){Ut.done=!0,Sr&&(Ut=Sr);try{if(Ut.facade===ar)throw new Ge("Promise can't be resolved itself");var Er=gr(ar);Er?P(function(){var Dr={done:!1};try{i(Er,ar,tr(_r,Dr,Ut),tr(mr,Dr,Ut))}catch(nn){mr(Dr,nn,Ut)}}):(Ut.value=ar,Ut.state=De,Ot(Ut,!1))}catch(Dr){mr({done:!1},Dr,Ut)}}};if(J&&(ge=function(Ut){w(this,Je),d(Ut),i(vt,this);var ar=se(this);try{Ut(tr(_r,ar),tr(mr,ar))}catch(Sr){mr(ar,Sr)}},Je=ge.prototype,vt=function(Ut){oe(this,{type:te,done:!1,notified:!1,parent:!1,reactions:new z,rejection:!1,state:Le,value:null})},vt.prototype=s(Je,"then",function(Ut,ar){var Sr=se(this),Er=ct(v(this,ge));return Sr.parent=!0,Er.ok=p(Ut)?Ut:!0,Er.fail=p(ar)&&ar,Er.domain=t?Ye.domain:void 0,Sr.state===Le?Sr.reactions.add(Er):P(function(){wr(Er,Sr)}),Er.promise}),nr=function(){var Ut=new vt,ar=se(Ut);this.promise=Ut,this.resolve=tr(_r,ar),this.reject=tr(mr,ar)},q.f=ct=function(Ut){return Ut===ge||Ut===qt?new nr(Ut):At(Ut)},!e&&p(V)&&ve!==Object.prototype)){or=ve.then,xe||s(ve,"then",function(Ut,ar){var Sr=this;return new ge(function(Er,Dr){i(or,Sr,Er,Dr)}).then(Ut,ar)},{unsafe:!0});try{delete ve.constructor}catch{}a&&a(ve,Je)}return r({global:!0,constructor:!0,wrap:!0,forced:J},{Promise:ge}),o(ge,te,!1,!0),u(te),GD}var f6={},d6,p6;function Xm(){return p6||(p6=1,d6={}),d6}var CE,g6;function Rme(){if(g6)return CE;g6=1;var r=Uo(),e=Xm(),t=r("iterator"),n=Array.prototype;return CE=function(i){return i!==void 0&&(e.Array===i||n[t]===i)},CE}var TE,m6;function _6(){if(m6)return TE;m6=1;var r=nE(),e=$p(),t=ad(),n=Xm(),i=Uo(),s=i("iterator");return TE=function(a){if(!t(a))return e(a,s)||e(a,"@@iterator")||n[r(a)]},TE}var EE,y6;function Lme(){if(y6)return EE;y6=1;var r=Wo(),e=kh(),t=Na(),n=Z1(),i=_6(),s=TypeError;return EE=function(a,o){var u=arguments.length<2?i(a):o;if(e(u))return t(r(u,a));throw new s(n(a)+" is not iterable")},EE}var SE,b6;function Ome(){if(b6)return SE;b6=1;var r=Wo(),e=Na(),t=$p();return SE=function(n,i,s){var a,o;e(n);try{if(a=t(n,"return"),!a){if(i==="throw")throw s;return s}a=r(a,n)}catch(u){o=!0,a=u}if(i==="throw")throw s;if(o)throw a;return e(a),s},SE}var IE,v6;function w6(){if(v6)return IE;v6=1;var r=uE(),e=Wo(),t=Na(),n=Z1(),i=Rme(),s=DT(),a=Y1(),o=Lme(),u=_6(),d=Ome(),p=TypeError,_=function(v,M){this.stopped=v,this.result=M},w=_.prototype;return IE=function(v,M,P){var D=P&&P.that,N=!!(P&&P.AS_ENTRIES),z=!!(P&&P.IS_RECORD),W=!!(P&&P.IS_ITERATOR),V=!!(P&&P.INTERRUPTED),$=r(M,D),q,te,J,me,xe,se,oe,ve=function(Je){return q&&d(q,"normal",Je),new _(!0,Je)},ge=function(Je){return N?(t(Je),V?$(Je[0],Je[1],ve):$(Je[0],Je[1])):V?$(Je,ve):$(Je)};if(z)q=v.iterator;else if(W)q=v;else{if(te=u(v),!te)throw new p(n(v)+" is not iterable");if(i(te)){for(J=0,me=s(v);me>J;J++)if(xe=ge(v[J]),xe&&a(w,xe))return xe;return new _(!1)}q=o(v,te)}for(se=z?v.next:q.next;!(oe=e(se,q)).done;){try{xe=ge(oe.value)}catch(Je){d(q,"throw",Je)}if(typeof xe=="object"&&xe&&a(w,xe))return xe}return new _(!1)},IE}var ME,x6;function Ume(){if(x6)return ME;x6=1;var r=Uo(),e=r("iterator"),t=!1;try{var n=0,i={next:function(){return{done:!!n++}},return:function(){t=!0}};i[e]=function(){return this},Array.from(i,function(){throw 2})}catch{}return ME=function(s,a){try{if(!a&&!t)return!1}catch{return!1}var o=!1;try{var u={};u[e]=function(){return{next:function(){return{done:o=!0}}}},s(u)}catch{}return o},ME}var PE,B6;function C6(){if(B6)return PE;B6=1;var r=qm(),e=Ume(),t=Km().CONSTRUCTOR;return PE=t||!e(function(n){r.all(n).then(void 0,function(){})}),PE}var T6;function Dme(){if(T6)return f6;T6=1;var r=ka(),e=Wo(),t=kh(),n=Wm(),i=vE(),s=w6(),a=C6();return r({target:"Promise",stat:!0,forced:a},{all:function(o){var u=this,d=n.f(u),p=d.resolve,_=d.reject,w=i(function(){var v=t(u.resolve),M=[],P=0,D=1;s(o,function(N){var z=P++,W=!1;D++,e(v,u,N).then(function(V){W||(W=!0,M[z]=V,--D||p(M))},_)}),--D||p(M)});return w.error&&_(w.value),d.promise}}),f6}var E6={},S6;function Nme(){if(S6)return E6;S6=1;var r=ka(),e=ih(),t=Km().CONSTRUCTOR,n=qm(),i=ld(),s=Hs(),a=cd(),o=n&&n.prototype;if(r({target:"Promise",proto:!0,forced:t,real:!0},{catch:function(d){return this.then(void 0,d)}}),!e&&s(n)){var u=i("Promise").prototype.catch;o.catch!==u&&a(o,"catch",u,{unsafe:!0})}return E6}var I6={},M6;function kme(){if(M6)return I6;M6=1;var r=ka(),e=Wo(),t=kh(),n=Wm(),i=vE(),s=w6(),a=C6();return r({target:"Promise",stat:!0,forced:a},{race:function(o){var u=this,d=n.f(u),p=d.reject,_=i(function(){var w=t(u.resolve);s(o,function(v){e(w,u,v).then(d.resolve,p)})});return _.error&&p(_.value),d.promise}}),I6}var P6={},F6;function Qme(){if(F6)return P6;F6=1;var r=ka(),e=Wm(),t=Km().CONSTRUCTOR;return r({target:"Promise",stat:!0,forced:t},{reject:function(n){var i=e.f(this),s=i.reject;return s(n),i.promise}}),P6}var R6={},FE,L6;function zme(){if(L6)return FE;L6=1;var r=Na(),e=ou(),t=Wm();return FE=function(n,i){if(r(n),e(i)&&i.constructor===n)return i;var s=t.f(n),a=s.resolve;return a(i),s.promise},FE}var O6;function Hme(){if(O6)return R6;O6=1;var r=ka(),e=ld(),t=ih(),n=qm(),i=Km().CONSTRUCTOR,s=zme(),a=e("Promise"),o=t&&!i;return r({target:"Promise",stat:!0,forced:t||i},{resolve:function(u){return s(o&&this===a?n:this,u)}}),R6}var U6;function Vme(){return U6||(U6=1,Fme(),Dme(),Nme(),kme(),Qme(),Hme()),sme}Vme();function D6(r,e,t,n,i,s,a){try{var o=r[s](a),u=o.value}catch(d){return void t(d)}o.done?e(u):Promise.resolve(u).then(n,i)}function Qh(r){return function(){var e=this,t=arguments;return new Promise(function(n,i){var s=r.apply(e,t);function a(u){D6(s,n,i,a,o,"next",u)}function o(u){D6(s,n,i,a,o,"throw",u)}a(void 0)})}}var N6={},k6={},RE,Q6;function sh(){if(Q6)return RE;Q6=1;var r=nE(),e=String;return RE=function(t){if(r(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(t)},RE}var LE,z6;function H6(){if(z6)return LE;z6=1;var r=Na();return LE=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},LE}var OE,V6;function j6(){if(V6)return OE;V6=1;var r=Qs(),e=vs(),t=e.RegExp,n=r(function(){var a=t("a","y");return a.lastIndex=2,a.exec("abcd")!==null}),i=n||r(function(){return!t("a","y").sticky}),s=n||r(function(){var a=t("^r","gy");return a.lastIndex=2,a.exec("str")!==null});return OE={BROKEN_CARET:s,MISSED_STICKY:i,UNSUPPORTED_Y:n},OE}var UE={},DE,$6;function jme(){if($6)return DE;$6=1;var r=Ak(),e=QT();return DE=Object.keys||function(t){return r(t,e)},DE}var G6;function $me(){if(G6)return UE;G6=1;var r=iu(),e=jN(),t=KA(),n=Na(),i=jm(),s=jme();return UE.f=r&&!e?Object.defineProperties:function(a,o){n(a);for(var u=i(o),d=s(o),p=d.length,_=0,w;p>_;)t.f(a,w=d[_++],u[w]);return a},UE}var NE,q6;function lb(){if(q6)return NE;q6=1;var r=Na(),e=$me(),t=QT(),n=ST(),i=Gk(),s=eb(),a=ET(),o=">",u="<",d="prototype",p="script",_=a("IE_PROTO"),w=function(){},v=function(z){return u+p+o+z+u+"/"+p+o},M=function(z){z.write(v("")),z.close();var W=z.parentWindow.Object;return z=null,W},P=function(){var z=s("iframe"),W="java"+p+":",V;return z.style.display="none",i.appendChild(z),z.src=String(W),V=z.contentWindow.document,V.open(),V.write(v("document.F=Object")),V.close(),V.F},D,N=function(){try{D=new ActiveXObject("htmlfile")}catch{}N=typeof document<"u"?document.domain&&D?M(D):P():M(D);for(var z=t.length;z--;)delete N[d][t[z]];return N()};return n[_]=!0,NE=Object.create||function(z,W){var V;return z!==null?(w[d]=r(z),V=new w,w[d]=null,V[_]=z):V=N(),W===void 0?V:e.f(V,W)},NE}var kE,K6;function Gme(){if(K6)return kE;K6=1;var r=Qs(),e=vs(),t=e.RegExp;return kE=r(function(){var n=t(".","s");return!(n.dotAll&&n.test(`
`)&&n.flags==="s")}),kE}var QE,W6;function qme(){if(W6)return QE;W6=1;var r=Qs(),e=vs(),t=e.RegExp;return QE=r(function(){var n=t("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),QE}var zE,X6;function HE(){if(X6)return zE;X6=1;var r=Wo(),e=zs(),t=sh(),n=H6(),i=j6(),s=lT(),a=lb(),o=nb().get,u=Gme(),d=qme(),p=s("native-string-replace",String.prototype.replace),_=RegExp.prototype.exec,w=_,v=e("".charAt),M=e("".indexOf),P=e("".replace),D=e("".slice),N=function(){var $=/a/,q=/b*/g;return r(_,$,"a"),r(_,q,"a"),$.lastIndex!==0||q.lastIndex!==0}(),z=i.BROKEN_CARET,W=/()??/.exec("")[1]!==void 0,V=N||W||z||u||d;return V&&(w=function($){var q=this,te=o(q),J=t($),me=te.raw,xe,se,oe,ve,ge,Je,Ge;if(me)return me.lastIndex=q.lastIndex,xe=r(w,me,J),q.lastIndex=me.lastIndex,xe;var et=te.groups,Ye=z&&q.sticky,ct=r(n,q),At=q.source,kt=0,ae=J;if(Ye&&(ct=P(ct,"y",""),M(ct,"g")===-1&&(ct+="g"),ae=D(J,q.lastIndex),q.lastIndex>0&&(!q.multiline||q.multiline&&v(J,q.lastIndex-1)!==`
`)&&(At="(?: "+At+")",ae=" "+ae,kt++),se=new RegExp("^(?:"+At+")",ct)),W&&(se=new RegExp("^"+At+"$(?!\\s)",ct)),N&&(oe=q.lastIndex),ve=r(_,Ye?se:q,ae),Ye?ve?(ve.input=D(ve.input,kt),ve[0]=D(ve[0],kt),ve.index=q.lastIndex,q.lastIndex+=ve[0].length):q.lastIndex=0:N&&ve&&(q.lastIndex=q.global?ve.index+ve[0].length:oe),W&&ve&&ve.length>1&&r(p,ve[0],se,function(){for(ge=1;ge<arguments.length-2;ge++)arguments[ge]===void 0&&(ve[ge]=void 0)}),ve&&et)for(ve.groups=Je=a(null),ge=0;ge<et.length;ge++)Ge=et[ge],Je[Ge[0]]=ve[Ge[1]];return ve}),zE=w,zE}var Y6;function Kme(){if(Y6)return k6;Y6=1;var r=ka(),e=HE();return r({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),k6}var VE,Z6;function jE(){if(Z6)return VE;Z6=1,Kme();var r=Wo(),e=cd(),t=HE(),n=Qs(),i=Uo(),s=Gm(),a=i("species"),o=RegExp.prototype;return VE=function(u,d,p,_){var w=i(u),v=!n(function(){var N={};return N[w]=function(){return 7},""[u](N)!==7}),M=v&&!n(function(){var N=!1,z=/a/;return u==="split"&&(z={},z.constructor={},z.constructor[a]=function(){return z},z.flags="",z[w]=/./[w]),z.exec=function(){return N=!0,null},z[w](""),!N});if(!v||!M||p){var P=/./[w],D=d(w,""[u],function(N,z,W,V,$){var q=z.exec;return q===t||q===o.exec?v&&!$?{done:!0,value:r(P,z,W,V)}:{done:!0,value:r(N,W,z,V)}:{done:!1}});e(String.prototype,u,D[0]),e(o,w,D[1])}_&&s(o[w],"sham",!0)},VE}var $E,J6;function Wme(){if(J6)return $E;J6=1;var r=zs(),e=ib(),t=sh(),n=su(),i=r("".charAt),s=r("".charCodeAt),a=r("".slice),o=function(u){return function(d,p){var _=t(n(d)),w=e(p),v=_.length,M,P;return w<0||w>=v?u?"":void 0:(M=s(_,w),M<55296||M>56319||w+1===v||(P=s(_,w+1))<56320||P>57343?u?i(_,w):M:u?a(_,w,w+2):(M-55296<<10)+(P-56320)+65536)}};return $E={codeAt:o(!1),charAt:o(!0)},$E}var GE,e8;function qE(){if(e8)return GE;e8=1;var r=Wme().charAt;return GE=function(e,t,n){return t+(n?r(e,t).length:1)},GE}var KE,t8;function WE(){if(t8)return KE;t8=1;var r=Wo(),e=Na(),t=Hs(),n=od(),i=HE(),s=TypeError;return KE=function(a,o){var u=a.exec;if(t(u)){var d=r(u,a,o);return d!==null&&e(d),d}if(n(a)==="RegExp")return r(i,a,o);throw new s("RegExp#exec called on incompatible receiver")},KE}var r8;function Xme(){if(r8)return N6;r8=1;var r=Wo(),e=jE(),t=Na(),n=ad(),i=Gp(),s=sh(),a=su(),o=$p(),u=qE(),d=WE();return e("match",function(p,_,w){return[function(v){var M=a(this),P=n(v)?void 0:o(v,p);return P?r(P,v,M):new RegExp(v)[p](s(M))},function(v){var M=t(this),P=s(v),D=w(_,M,P);if(D.done)return D.value;if(!M.global)return d(M,P);var N=M.unicode;M.lastIndex=0;for(var z=[],W=0,V;(V=d(M,P))!==null;){var $=s(V[0]);z[W]=$,$===""&&(M.lastIndex=u(P,i(M.lastIndex),N)),W++}return W===0?null:z}]}),N6}Xme();var n8={},XE,i8;function Yme(){if(i8)return XE;i8=1;var r=zs(),e=J1(),t=Math.floor,n=r("".charAt),i=r("".replace),s=r("".slice),a=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,o=/\$([$&'`]|\d{1,2})/g;return XE=function(u,d,p,_,w,v){var M=p+u.length,P=_.length,D=o;return w!==void 0&&(w=e(w),D=a),i(v,D,function(N,z){var W;switch(n(z,0)){case"$":return"$";case"&":return u;case"`":return s(d,0,p);case"'":return s(d,M);case"<":W=w[s(z,1,-1)];break;default:var V=+z;if(V===0)return N;if(V>P){var $=t(V/10);return $===0?N:$<=P?_[$-1]===void 0?n(z,1):_[$-1]+n(z,1):N}W=_[V-1]}return W===void 0?"":W})},XE}var s8;function Zme(){if(s8)return n8;s8=1;var r=Hk(),e=Wo(),t=zs(),n=jE(),i=Qs(),s=Na(),a=Hs(),o=ad(),u=ib(),d=Gp(),p=sh(),_=su(),w=qE(),v=$p(),M=Yme(),P=WE(),D=Uo(),N=D("replace"),z=Math.max,W=Math.min,V=t([].concat),$=t([].push),q=t("".indexOf),te=t("".slice),J=function(oe){return oe===void 0?oe:String(oe)},me=function(){return"a".replace(/./,"$0")==="$0"}(),xe=function(){return/./[N]?/./[N]("a","$0")==="":!1}(),se=!i(function(){var oe=/./;return oe.exec=function(){var ve=[];return ve.groups={a:"7"},ve},"".replace(oe,"$<a>")!=="7"});return n("replace",function(oe,ve,ge){var Je=xe?"$":"$0";return[function(Ge,et){var Ye=_(this),ct=o(Ge)?void 0:v(Ge,N);return ct?e(ct,Ge,Ye,et):e(ve,p(Ye),Ge,et)},function(Ge,et){var Ye=s(this),ct=p(Ge);if(typeof et=="string"&&q(et,Je)===-1&&q(et,"$<")===-1){var At=ge(ve,Ye,ct,et);if(At.done)return At.value}var kt=a(et);kt||(et=p(et));var ae=Ye.global,Te;ae&&(Te=Ye.unicode,Ye.lastIndex=0);for(var Le=[],De;De=P(Ye,ct),!(De===null||($(Le,De),!ae));){var at=p(De[0]);at===""&&(Ye.lastIndex=w(ct,d(Ye.lastIndex),Te))}for(var rt="",xt=0,vt=0;vt<Le.length;vt++){De=Le[vt];for(var nr=p(De[0]),qt=z(W(u(De.index),ct.length),0),or=[],gr,wr=1;wr<De.length;wr++)$(or,J(De[wr]));var Ot=De.groups;if(kt){var ze=V([nr],or,qt,ct);Ot!==void 0&&$(ze,Ot),gr=p(r(et,void 0,ze))}else gr=M(nr,ct,qt,or,Ot,et);qt>=xt&&(rt+=te(ct,xt,qt)+gr,xt=qt+nr.length)}return rt+te(ct,xt)}]},!se||!me||xe),n8}Zme();var o8={},YE,a8;function Jme(){if(a8)return YE;a8=1;var r=ou(),e=od(),t=Uo(),n=t("match");return YE=function(i){var s;return r(i)&&((s=i[n])!==void 0?!!s:e(i)==="RegExp")},YE}var ZE,l8;function JE(){if(l8)return ZE;l8=1;var r=Jme(),e=TypeError;return ZE=function(t){if(r(t))throw new e("The method doesn't accept regular expressions");return t},ZE}var e3,c8;function t3(){if(c8)return e3;c8=1;var r=Uo(),e=r("match");return e3=function(t){var n=/./;try{"/./"[t](n)}catch{try{return n[e]=!1,"/./"[t](n)}catch{}}return!1},e3}var u8;function e_e(){if(u8)return o8;u8=1;var r=ka(),e=ab(),t=tb().f,n=Gp(),i=sh(),s=JE(),a=su(),o=t3(),u=ih(),d=e("".slice),p=Math.min,_=o("startsWith"),w=!u&&!_&&!!function(){var v=t(String.prototype,"startsWith");return v&&!v.writable}();return r({target:"String",proto:!0,forced:!w&&!_},{startsWith:function(v){var M=i(a(this));s(v);var P=n(p(arguments.length>1?arguments[1]:void 0,M.length)),D=i(v);return d(M,P,P+D.length)===D}}),o8}e_e();var r3,h8;function t_e(){if(h8)return r3;h8=1;var r=Uo(),e=lb(),t=KA().f,n=r("unscopables"),i=Array.prototype;return i[n]===void 0&&t(i,n,{configurable:!0,value:e(null)}),r3=function(s){i[n][s]=!0},r3}var n3,A8;function r_e(){if(A8)return n3;A8=1;var r=Qs();return n3=!r(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),n3}var i3,f8;function d8(){if(f8)return i3;f8=1;var r=au(),e=Hs(),t=J1(),n=ET(),i=r_e(),s=n("IE_PROTO"),a=Object,o=a.prototype;return i3=i?a.getPrototypeOf:function(u){var d=t(u);if(r(d,s))return d[s];var p=d.constructor;return e(p)&&d instanceof p?p.prototype:d instanceof a?o:null},i3}var s3,p8;function g8(){if(p8)return s3;p8=1;var r=Qs(),e=Hs(),t=ou(),n=lb(),i=d8(),s=cd(),a=Uo(),o=ih(),u=a("iterator"),d=!1,p,_,w;[].keys&&(w=[].keys(),"next"in w?(_=i(i(w)),_!==Object.prototype&&(p=_)):d=!0);var v=!t(p)||r(function(){var M={};return p[u].call(M)!==M});return v?p={}:o&&(p=n(p)),e(p[u])||s(p,u,function(){return this}),s3={IteratorPrototype:p,BUGGY_SAFARI_ITERATORS:d},s3}var o3,m8;function n_e(){if(m8)return o3;m8=1;var r=g8().IteratorPrototype,e=lb(),t=DC(),n=ob(),i=Xm(),s=function(){return this};return o3=function(a,o,u,d){var p=o+" Iterator";return a.prototype=e(r,{next:t(+!d,u)}),n(a,p,!1,!0),i[p]=s,a},o3}var a3,_8;function i_e(){if(_8)return a3;_8=1;var r=ka(),e=Wo(),t=ih(),n=rb(),i=Hs(),s=n_e(),a=d8(),o=Mk(),u=ob(),d=Gm(),p=cd(),_=Uo(),w=Xm(),v=g8(),M=n.PROPER,P=n.CONFIGURABLE,D=v.IteratorPrototype,N=v.BUGGY_SAFARI_ITERATORS,z=_("iterator"),W="keys",V="values",$="entries",q=function(){return this};return a3=function(te,J,me,xe,se,oe,ve){s(me,J,xe);var ge=function(Le){if(Le===se&&ct)return ct;if(!N&&Le&&Le in et)return et[Le];switch(Le){case W:return function(){return new me(this,Le)};case V:return function(){return new me(this,Le)};case $:return function(){return new me(this,Le)}}return function(){return new me(this)}},Je=J+" Iterator",Ge=!1,et=te.prototype,Ye=et[z]||et["@@iterator"]||se&&et[se],ct=!N&&Ye||ge(se),At=J==="Array"&&et.entries||Ye,kt,ae,Te;if(At&&(kt=a(At.call(new te)),kt!==Object.prototype&&kt.next&&(!t&&a(kt)!==D&&(o?o(kt,D):i(kt[z])||p(kt,z,q)),u(kt,Je,!0,!0),t&&(w[Je]=q))),M&&se===V&&Ye&&Ye.name!==V&&(!t&&P?d(et,"name",V):(Ge=!0,ct=function(){return e(Ye,this)})),se)if(ae={values:ge(V),keys:oe?ct:ge(W),entries:ge($)},ve)for(Te in ae)(N||Ge||!(Te in et))&&p(et,Te,ae[Te]);else r({target:J,proto:!0,forced:N||Ge},ae);return(!t||ve)&&et[z]!==ct&&p(et,z,ct,{name:se}),w[J]=ct,ae},a3}var y8,b8;function s_e(){return b8||(b8=1,y8=function(r,e){return{value:r,done:e}}),y8}var l3,v8;function w8(){if(v8)return l3;v8=1;var r=jm(),e=t_e(),t=Xm(),n=nb(),i=KA().f,s=i_e(),a=s_e(),o=ih(),u=iu(),d="Array Iterator",p=n.set,_=n.getterFor(d);l3=s(Array,"Array",function(v,M){p(this,{type:d,target:r(v),index:0,kind:M})},function(){var v=_(this),M=v.target,P=v.index++;if(!M||P>=M.length)return v.target=null,a(void 0,!0);switch(v.kind){case"keys":return a(P,!1);case"values":return a(M[P],!1)}return a([P,M[P]],!1)},"values");var w=t.Arguments=t.Array;if(e("keys"),e("values"),e("entries"),!o&&u&&w.name!=="values")try{i(w,"name",{value:"values"})}catch{}return l3}w8();var x8={},B8,C8;function o_e(){return C8||(C8=1,B8={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),B8}var c3,T8;function a_e(){if(T8)return c3;T8=1;var r=eb(),e=r("span").classList,t=e&&e.constructor&&e.constructor.prototype;return c3=t===Object.prototype?void 0:t,c3}var E8;function l_e(){if(E8)return x8;E8=1;var r=vs(),e=o_e(),t=a_e(),n=w8(),i=Gm(),s=ob(),a=Uo(),o=a("iterator"),u=n.values,d=function(_,w){if(_){if(_[o]!==u)try{i(_,o,u)}catch{_[o]=u}if(s(_,w,!0),e[w]){for(var v in n)if(_[v]!==n[v])try{i(_,v,n[v])}catch{_[v]=n[v]}}}};for(var p in e)d(r[p]&&r[p].prototype,p);return d(t,"DOMTokenList"),x8}l_e();function c_e(r,e){if(ri(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(ri(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function u_e(r){var e=c_e(r,"string");return ri(e)=="symbol"?e:e+""}function u3(r,e,t){return(e=u_e(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var S8={},h3,I8;function h_e(){if(I8)return h3;I8=1;var r=kh(),e=J1(),t=sN(),n=DT(),i=TypeError,s="Reduce of empty array with no initial value",a=function(o){return function(u,d,p,_){var w=e(u),v=t(w),M=n(w);if(r(d),M===0&&p<2)throw new i(s);var P=o?M-1:0,D=o?-1:1;if(p<2)for(;;){if(P in v){_=v[P],P+=D;break}if(P+=D,o?P<0:M<=P)throw new i(s)}for(;o?P>=0:M>P;P+=D)P in v&&(_=d(_,v[P],P,w));return _}};return h3={left:a(!1),right:a(!0)},h3}var A3,M8;function P8(){if(M8)return A3;M8=1;var r=Qs();return A3=function(e,t){var n=[][e];return!!n&&r(function(){n.call(null,t||function(){return 1},1)})},A3}var F8;function A_e(){if(F8)return S8;F8=1;var r=ka(),e=h_e().left,t=P8(),n=WC(),i=sb(),s=!i&&n>79&&n<83,a=s||!t("reduce");return r({target:"Array",proto:!0,forced:a},{reduce:function(o){var u=arguments.length;return e(this,o,u,u>1?arguments[1]:void 0)}}),S8}A_e();var R8={},L8;function f_e(){if(L8)return R8;L8=1;var r=ka(),e=ab(),t=tb().f,n=Gp(),i=sh(),s=JE(),a=su(),o=t3(),u=ih(),d=e("".slice),p=Math.min,_=o("endsWith"),w=!u&&!_&&!!function(){var v=t(String.prototype,"endsWith");return v&&!v.writable}();return r({target:"String",proto:!0,forced:!w&&!_},{endsWith:function(v){var M=i(a(this));s(v);var P=arguments.length>1?arguments[1]:void 0,D=M.length,N=P===void 0?D:p(n(P),D),z=i(v);return d(M,N-z.length,N)===z}}),R8}f_e();var O8={},U8;function d_e(){if(U8)return O8;U8=1;var r=Wo(),e=zs(),t=jE(),n=Na(),i=ad(),s=su(),a=Qk(),o=qE(),u=Gp(),d=sh(),p=$p(),_=WE(),w=j6(),v=Qs(),M=w.UNSUPPORTED_Y,P=4294967295,D=Math.min,N=e([].push),z=e("".slice),W=!v(function(){var $=/(?:)/,q=$.exec;$.exec=function(){return q.apply(this,arguments)};var te="ab".split($);return te.length!==2||te[0]!=="a"||te[1]!=="b"}),V="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;return t("split",function($,q,te){var J="0".split(void 0,0).length?function(me,xe){return me===void 0&&xe===0?[]:r(q,this,me,xe)}:q;return[function(me,xe){var se=s(this),oe=i(me)?void 0:p(me,$);return oe?r(oe,me,se,xe):r(J,d(se),me,xe)},function(me,xe){var se=n(this),oe=d(me);if(!V){var ve=te(J,se,oe,xe,J!==q);if(ve.done)return ve.value}var ge=a(se,RegExp),Je=se.unicode,Ge=(se.ignoreCase?"i":"")+(se.multiline?"m":"")+(se.unicode?"u":"")+(M?"g":"y"),et=new ge(M?"^(?:"+se.source+")":se,Ge),Ye=xe===void 0?P:xe>>>0;if(Ye===0)return[];if(oe.length===0)return _(et,oe)===null?[oe]:[];for(var ct=0,At=0,kt=[];At<oe.length;){et.lastIndex=M?0:At;var ae=_(et,M?z(oe,At):oe),Te;if(ae===null||(Te=D(u(et.lastIndex+(M?At:0)),oe.length))===ct)At=o(oe,At,Je);else{if(N(kt,z(oe,ct,At)),kt.length===Ye)return kt;for(var Le=1;Le<=ae.length-1;Le++)if(N(kt,ae[Le]),kt.length===Ye)return kt;At=ct=Te}}return N(kt,z(oe,ct)),kt}]},V||!W,M),O8}d_e();var Ym={exports:{}},qp={exports:{}},p_e=qp.exports,D8;function g_e(){return D8||(D8=1,(function(){var r,e,t,n,i,s;typeof performance<"u"&&performance!==null&&performance.now?qp.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(qp.exports=function(){return(r()-i)/1e6},e=process.hrtime,r=function(){var a;return a=e(),a[0]*1e9+a[1]},n=r(),s=process.uptime()*1e9,i=n-s):Date.now?(qp.exports=function(){return Date.now()-t},t=Date.now()):(qp.exports=function(){return new Date().getTime()-t},t=new Date().getTime())}).call(p_e)),qp.exports}var N8;function m_e(){if(N8)return Ym.exports;N8=1;for(var r=g_e(),e=typeof window>"u"?PC:window,t=["moz","webkit"],n="AnimationFrame",i=e["request"+n],s=e["cancel"+n]||e["cancelRequest"+n],a=0;!i&&a<t.length;a++)i=e[t[a]+"Request"+n],s=e[t[a]+"Cancel"+n]||e[t[a]+"CancelRequest"+n];if(!i||!s){var o=0,u=0,d=[],p=1e3/60;i=function(_){if(d.length===0){var w=r(),v=Math.max(0,p-(w-o));o=v+w,setTimeout(function(){var M=d.slice(0);d.length=0;for(var P=0;P<M.length;P++)if(!M[P].cancelled)try{M[P].callback(o)}catch(D){setTimeout(function(){throw D},0)}},Math.round(v))}return d.push({handle:++u,callback:_,cancelled:!1}),u},s=function(_){for(var w=0;w<d.length;w++)d[w].handle===_&&(d[w].cancelled=!0)}}return Ym.exports=function(_){return i.call(e,_)},Ym.exports.cancel=function(){s.apply(e,arguments)},Ym.exports.polyfill=function(_){_||(_=e),_.requestAnimationFrame=i,_.cancelAnimationFrame=s},Ym.exports}var __e=m_e();const f3=$D(__e);var k8={},Q8,z8;function H8(){return z8||(z8=1,Q8=`	
\v\f\r                　\u2028\u2029\uFEFF`),Q8}var d3,V8;function y_e(){if(V8)return d3;V8=1;var r=zs(),e=su(),t=sh(),n=H8(),i=r("".replace),s=RegExp("^["+n+"]+"),a=RegExp("(^|[^"+n+"])["+n+"]+$"),o=function(u){return function(d){var p=t(e(d));return u&1&&(p=i(p,s,"")),u&2&&(p=i(p,a,"$1")),p}};return d3={start:o(1),end:o(2),trim:o(3)},d3}var p3,j8;function b_e(){if(j8)return p3;j8=1;var r=rb().PROPER,e=Qs(),t=H8(),n="​᠎";return p3=function(i){return e(function(){return!!t[i]()||n[i]()!==n||r&&t[i].name!==i})},p3}var $8;function v_e(){if($8)return k8;$8=1;var r=ka(),e=y_e().trim,t=b_e();return r({target:"String",proto:!0,forced:t("trim")},{trim:function(){return e(this)}}),k8}v_e();var G8,q8;function w_e(){return q8||(q8=1,G8=function(r){this.ok=!1,this.alpha=1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r=r.replace(/ /g,""),r=r.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};r=e[r]||r;for(var t=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3]),parseFloat(u[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(u){return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(u){return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)]}}],n=0;n<t.length;n++){var i=t[n].re,s=t[n].process,a=i.exec(r);if(a){var o=s(a);this.r=o[0],this.g=o[1],this.b=o[2],o.length>3&&(this.alpha=o[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var u=this.r.toString(16),d=this.g.toString(16),p=this.b.toString(16);return u.length==1&&(u="0"+u),d.length==1&&(d="0"+d),p.length==1&&(p="0"+p),"#"+u+d+p},this.getHelpXML=function(){for(var u=new Array,d=0;d<t.length;d++)for(var p=t[d].example,_=0;_<p.length;_++)u[u.length]=p[_];for(var w in e)u[u.length]=w;var v=document.createElement("ul");v.setAttribute("id","rgbcolor-examples");for(var d=0;d<u.length;d++)try{var M=document.createElement("li"),P=new RGBColor(u[d]),D=document.createElement("div");D.style.cssText="margin: 3px; border: 1px solid black; background:"+P.toHex()+"; color:"+P.toHex(),D.appendChild(document.createTextNode("test"));var N=document.createTextNode(" "+u[d]+" -> "+P.toRGB()+" -> "+P.toHex());M.appendChild(D),M.appendChild(N),v.appendChild(M)}catch{}return v}}),G8}var x_e=w_e();const g3=$D(x_e);var K8={},W8;function B_e(){if(W8)return K8;W8=1;var r=ka(),e=ab(),t=uk().indexOf,n=P8(),i=e([].indexOf),s=!!i&&1/i([1],1,-0)<0,a=s||!n("indexOf");return r({target:"Array",proto:!0,forced:a},{indexOf:function(o){var u=arguments.length>1?arguments[1]:void 0;return s?i(this,o,u)||0:t(this,o,u)}}),K8}B_e();var X8={},Y8;function C_e(){if(Y8)return X8;Y8=1;var r=ka(),e=zs(),t=JE(),n=su(),i=sh(),s=t3(),a=e("".indexOf);return r({target:"String",proto:!0,forced:!s("includes")},{includes:function(o){return!!~a(i(n(this)),i(t(o)),arguments.length>1?arguments[1]:void 0)}}),X8}C_e();var Z8={},m3,J8;function T_e(){if(J8)return m3;J8=1;var r=od();return m3=Array.isArray||function(e){return r(e)==="Array"},m3}var eQ;function E_e(){if(eQ)return Z8;eQ=1;var r=ka(),e=zs(),t=T_e(),n=e([].reverse),i=[1,2];return r({target:"Array",proto:!0,forced:String(i)===String(i.reverse())},{reverse:function(){return t(this)&&(this.length=this.length),n(this)}}),Z8}E_e();/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var tQ=function(r,e){return(tQ=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(r,e)};function rQ(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=r}tQ(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function S_e(r){var e="";Array.isArray(r)||(r=[r]);for(var t=0;t<r.length;t++){var n=r[t];if(n.type===pr.CLOSE_PATH)e+="z";else if(n.type===pr.HORIZ_LINE_TO)e+=(n.relative?"h":"H")+n.x;else if(n.type===pr.VERT_LINE_TO)e+=(n.relative?"v":"V")+n.y;else if(n.type===pr.MOVE_TO)e+=(n.relative?"m":"M")+n.x+" "+n.y;else if(n.type===pr.LINE_TO)e+=(n.relative?"l":"L")+n.x+" "+n.y;else if(n.type===pr.CURVE_TO)e+=(n.relative?"c":"C")+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===pr.SMOOTH_CURVE_TO)e+=(n.relative?"s":"S")+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===pr.QUAD_TO)e+=(n.relative?"q":"Q")+n.x1+" "+n.y1+" "+n.x+" "+n.y;else if(n.type===pr.SMOOTH_QUAD_TO)e+=(n.relative?"t":"T")+n.x+" "+n.y;else{if(n.type!==pr.ARC)throw new Error('Unexpected command type "'+n.type+'" at index '+t+".");e+=(n.relative?"a":"A")+n.rX+" "+n.rY+" "+n.xRot+" "+ +n.lArcFlag+" "+ +n.sweepFlag+" "+n.x+" "+n.y}}return e}function _3(r,e){var t=r[0],n=r[1];return[t*Math.cos(e)-n*Math.sin(e),t*Math.sin(e)+n*Math.cos(e)]}function lu(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];for(var t=0;t<r.length;t++)if(typeof r[t]!="number")throw new Error("assertNumbers arguments["+t+"] is not a number. "+typeof r[t]+" == typeof "+r[t]);return!0}var WA=Math.PI;function y3(r,e,t){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var n=r.rX,i=r.rY,s=r.x,a=r.y;n=Math.abs(r.rX),i=Math.abs(r.rY);var o=_3([(e-s)/2,(t-a)/2],-r.xRot/180*WA),u=o[0],d=o[1],p=Math.pow(u,2)/Math.pow(n,2)+Math.pow(d,2)/Math.pow(i,2);1<p&&(n*=Math.sqrt(p),i*=Math.sqrt(p)),r.rX=n,r.rY=i;var _=Math.pow(n,2)*Math.pow(d,2)+Math.pow(i,2)*Math.pow(u,2),w=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(n,2)*Math.pow(i,2)-_)/_)),v=n*d/i*w,M=-i*u/n*w,P=_3([v,M],r.xRot/180*WA);r.cX=P[0]+(e+s)/2,r.cY=P[1]+(t+a)/2,r.phi1=Math.atan2((d-M)/i,(u-v)/n),r.phi2=Math.atan2((-d-M)/i,(-u-v)/n),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*WA),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*WA),r.phi1*=180/WA,r.phi2*=180/WA}function nQ(r,e,t){lu(r,e,t);var n=r*r+e*e-t*t;if(0>n)return[];if(n===0)return[[r*t/(r*r+e*e),e*t/(r*r+e*e)]];var i=Math.sqrt(n);return[[(r*t+e*i)/(r*r+e*e),(e*t-r*i)/(r*r+e*e)],[(r*t-e*i)/(r*r+e*e),(e*t+r*i)/(r*r+e*e)]]}var io,zh=Math.PI/180;function iQ(r,e,t){return(1-t)*r+t*e}function sQ(r,e,t,n){return r+Math.cos(n/180*WA)*e+Math.sin(n/180*WA)*t}function oQ(r,e,t,n){var i=1e-6,s=e-r,a=t-e,o=3*s+3*(n-t)-6*a,u=6*(a-s),d=3*s;return Math.abs(o)<i?[-d/u]:function(p,_,w){var v=p*p/4-_;if(v<-1e-6)return[];if(v<=w)return[-p/2];var M=Math.sqrt(v);return[-p/2-M,-p/2+M]}(u/o,d/o,i)}function aQ(r,e,t,n,i){var s=1-i;return r*(s*s*s)+e*(3*s*s*i)+t*(3*s*i*i)+n*(i*i*i)}(function(r){function e(){return i(function(o,u,d){return o.relative&&(o.x1!==void 0&&(o.x1+=u),o.y1!==void 0&&(o.y1+=d),o.x2!==void 0&&(o.x2+=u),o.y2!==void 0&&(o.y2+=d),o.x!==void 0&&(o.x+=u),o.y!==void 0&&(o.y+=d),o.relative=!1),o})}function t(){var o=NaN,u=NaN,d=NaN,p=NaN;return i(function(_,w,v){return _.type&pr.SMOOTH_CURVE_TO&&(_.type=pr.CURVE_TO,o=isNaN(o)?w:o,u=isNaN(u)?v:u,_.x1=_.relative?w-o:2*w-o,_.y1=_.relative?v-u:2*v-u),_.type&pr.CURVE_TO?(o=_.relative?w+_.x2:_.x2,u=_.relative?v+_.y2:_.y2):(o=NaN,u=NaN),_.type&pr.SMOOTH_QUAD_TO&&(_.type=pr.QUAD_TO,d=isNaN(d)?w:d,p=isNaN(p)?v:p,_.x1=_.relative?w-d:2*w-d,_.y1=_.relative?v-p:2*v-p),_.type&pr.QUAD_TO?(d=_.relative?w+_.x1:_.x1,p=_.relative?v+_.y1:_.y1):(d=NaN,p=NaN),_})}function n(){var o=NaN,u=NaN;return i(function(d,p,_){if(d.type&pr.SMOOTH_QUAD_TO&&(d.type=pr.QUAD_TO,o=isNaN(o)?p:o,u=isNaN(u)?_:u,d.x1=d.relative?p-o:2*p-o,d.y1=d.relative?_-u:2*_-u),d.type&pr.QUAD_TO){o=d.relative?p+d.x1:d.x1,u=d.relative?_+d.y1:d.y1;var w=d.x1,v=d.y1;d.type=pr.CURVE_TO,d.x1=((d.relative?0:p)+2*w)/3,d.y1=((d.relative?0:_)+2*v)/3,d.x2=(d.x+2*w)/3,d.y2=(d.y+2*v)/3}else o=NaN,u=NaN;return d})}function i(o){var u=0,d=0,p=NaN,_=NaN;return function(w){if(isNaN(p)&&!(w.type&pr.MOVE_TO))throw new Error("path must start with moveto");var v=o(w,u,d,p,_);return w.type&pr.CLOSE_PATH&&(u=p,d=_),w.x!==void 0&&(u=w.relative?u+w.x:w.x),w.y!==void 0&&(d=w.relative?d+w.y:w.y),w.type&pr.MOVE_TO&&(p=u,_=d),v}}function s(o,u,d,p,_,w){return lu(o,u,d,p,_,w),i(function(v,M,P,D){var N=v.x1,z=v.x2,W=v.relative&&!isNaN(D),V=v.x!==void 0?v.x:W?0:M,$=v.y!==void 0?v.y:W?0:P;function q(ae){return ae*ae}v.type&pr.HORIZ_LINE_TO&&u!==0&&(v.type=pr.LINE_TO,v.y=v.relative?0:P),v.type&pr.VERT_LINE_TO&&d!==0&&(v.type=pr.LINE_TO,v.x=v.relative?0:M),v.x!==void 0&&(v.x=v.x*o+$*d+(W?0:_)),v.y!==void 0&&(v.y=V*u+v.y*p+(W?0:w)),v.x1!==void 0&&(v.x1=v.x1*o+v.y1*d+(W?0:_)),v.y1!==void 0&&(v.y1=N*u+v.y1*p+(W?0:w)),v.x2!==void 0&&(v.x2=v.x2*o+v.y2*d+(W?0:_)),v.y2!==void 0&&(v.y2=z*u+v.y2*p+(W?0:w));var te=o*p-u*d;if(v.xRot!==void 0&&(o!==1||u!==0||d!==0||p!==1))if(te===0)delete v.rX,delete v.rY,delete v.xRot,delete v.lArcFlag,delete v.sweepFlag,v.type=pr.LINE_TO;else{var J=v.xRot*Math.PI/180,me=Math.sin(J),xe=Math.cos(J),se=1/q(v.rX),oe=1/q(v.rY),ve=q(xe)*se+q(me)*oe,ge=2*me*xe*(se-oe),Je=q(me)*se+q(xe)*oe,Ge=ve*p*p-ge*u*p+Je*u*u,et=ge*(o*p+u*d)-2*(ve*d*p+Je*o*u),Ye=ve*d*d-ge*o*d+Je*o*o,ct=(Math.atan2(et,Ge-Ye)+Math.PI)%Math.PI/2,At=Math.sin(ct),kt=Math.cos(ct);v.rX=Math.abs(te)/Math.sqrt(Ge*q(kt)+et*At*kt+Ye*q(At)),v.rY=Math.abs(te)/Math.sqrt(Ge*q(At)-et*At*kt+Ye*q(kt)),v.xRot=180*ct/Math.PI}return v.sweepFlag!==void 0&&0>te&&(v.sweepFlag=+!v.sweepFlag),v})}function a(){return function(o){var u={};for(var d in o)u[d]=o[d];return u}}r.ROUND=function(o){function u(d){return Math.round(d*o)/o}return o===void 0&&(o=1e13),lu(o),function(d){return d.x1!==void 0&&(d.x1=u(d.x1)),d.y1!==void 0&&(d.y1=u(d.y1)),d.x2!==void 0&&(d.x2=u(d.x2)),d.y2!==void 0&&(d.y2=u(d.y2)),d.x!==void 0&&(d.x=u(d.x)),d.y!==void 0&&(d.y=u(d.y)),d.rX!==void 0&&(d.rX=u(d.rX)),d.rY!==void 0&&(d.rY=u(d.rY)),d}},r.TO_ABS=e,r.TO_REL=function(){return i(function(o,u,d){return o.relative||(o.x1!==void 0&&(o.x1-=u),o.y1!==void 0&&(o.y1-=d),o.x2!==void 0&&(o.x2-=u),o.y2!==void 0&&(o.y2-=d),o.x!==void 0&&(o.x-=u),o.y!==void 0&&(o.y-=d),o.relative=!0),o})},r.NORMALIZE_HVZ=function(o,u,d){return o===void 0&&(o=!0),u===void 0&&(u=!0),d===void 0&&(d=!0),i(function(p,_,w,v,M){if(isNaN(v)&&!(p.type&pr.MOVE_TO))throw new Error("path must start with moveto");return u&&p.type&pr.HORIZ_LINE_TO&&(p.type=pr.LINE_TO,p.y=p.relative?0:w),d&&p.type&pr.VERT_LINE_TO&&(p.type=pr.LINE_TO,p.x=p.relative?0:_),o&&p.type&pr.CLOSE_PATH&&(p.type=pr.LINE_TO,p.x=p.relative?v-_:v,p.y=p.relative?M-w:M),p.type&pr.ARC&&(p.rX===0||p.rY===0)&&(p.type=pr.LINE_TO,delete p.rX,delete p.rY,delete p.xRot,delete p.lArcFlag,delete p.sweepFlag),p})},r.NORMALIZE_ST=t,r.QT_TO_C=n,r.INFO=i,r.SANITIZE=function(o){o===void 0&&(o=0),lu(o);var u=NaN,d=NaN,p=NaN,_=NaN;return i(function(w,v,M,P,D){var N=Math.abs,z=!1,W=0,V=0;if(w.type&pr.SMOOTH_CURVE_TO&&(W=isNaN(u)?0:v-u,V=isNaN(d)?0:M-d),w.type&(pr.CURVE_TO|pr.SMOOTH_CURVE_TO)?(u=w.relative?v+w.x2:w.x2,d=w.relative?M+w.y2:w.y2):(u=NaN,d=NaN),w.type&pr.SMOOTH_QUAD_TO?(p=isNaN(p)?v:2*v-p,_=isNaN(_)?M:2*M-_):w.type&pr.QUAD_TO?(p=w.relative?v+w.x1:w.x1,_=w.relative?M+w.y1:w.y2):(p=NaN,_=NaN),w.type&pr.LINE_COMMANDS||w.type&pr.ARC&&(w.rX===0||w.rY===0||!w.lArcFlag)||w.type&pr.CURVE_TO||w.type&pr.SMOOTH_CURVE_TO||w.type&pr.QUAD_TO||w.type&pr.SMOOTH_QUAD_TO){var $=w.x===void 0?0:w.relative?w.x:w.x-v,q=w.y===void 0?0:w.relative?w.y:w.y-M;W=isNaN(p)?w.x1===void 0?W:w.relative?w.x:w.x1-v:p-v,V=isNaN(_)?w.y1===void 0?V:w.relative?w.y:w.y1-M:_-M;var te=w.x2===void 0?0:w.relative?w.x:w.x2-v,J=w.y2===void 0?0:w.relative?w.y:w.y2-M;N($)<=o&&N(q)<=o&&N(W)<=o&&N(V)<=o&&N(te)<=o&&N(J)<=o&&(z=!0)}return w.type&pr.CLOSE_PATH&&N(v-P)<=o&&N(M-D)<=o&&(z=!0),z?[]:w})},r.MATRIX=s,r.ROTATE=function(o,u,d){u===void 0&&(u=0),d===void 0&&(d=0),lu(o,u,d);var p=Math.sin(o),_=Math.cos(o);return s(_,p,-p,_,u-u*_+d*p,d-u*p-d*_)},r.TRANSLATE=function(o,u){return u===void 0&&(u=0),lu(o,u),s(1,0,0,1,o,u)},r.SCALE=function(o,u){return u===void 0&&(u=o),lu(o,u),s(o,0,0,u,0,0)},r.SKEW_X=function(o){return lu(o),s(1,0,Math.atan(o),1,0,0)},r.SKEW_Y=function(o){return lu(o),s(1,Math.atan(o),0,1,0,0)},r.X_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),lu(o),s(-1,0,0,1,o,0)},r.Y_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),lu(o),s(1,0,0,-1,0,o)},r.A_TO_C=function(){return i(function(o,u,d){return pr.ARC===o.type?function(p,_,w){var v,M,P,D;p.cX||y3(p,_,w);for(var N=Math.min(p.phi1,p.phi2),z=Math.max(p.phi1,p.phi2)-N,W=Math.ceil(z/90),V=new Array(W),$=_,q=w,te=0;te<W;te++){var J=iQ(p.phi1,p.phi2,te/W),me=iQ(p.phi1,p.phi2,(te+1)/W),xe=me-J,se=4/3*Math.tan(xe*zh/4),oe=[Math.cos(J*zh)-se*Math.sin(J*zh),Math.sin(J*zh)+se*Math.cos(J*zh)],ve=oe[0],ge=oe[1],Je=[Math.cos(me*zh),Math.sin(me*zh)],Ge=Je[0],et=Je[1],Ye=[Ge+se*Math.sin(me*zh),et-se*Math.cos(me*zh)],ct=Ye[0],At=Ye[1];V[te]={relative:p.relative,type:pr.CURVE_TO};var kt=function(ae,Te){var Le=_3([ae*p.rX,Te*p.rY],p.xRot),De=Le[0],at=Le[1];return[p.cX+De,p.cY+at]};v=kt(ve,ge),V[te].x1=v[0],V[te].y1=v[1],M=kt(ct,At),V[te].x2=M[0],V[te].y2=M[1],P=kt(Ge,et),V[te].x=P[0],V[te].y=P[1],p.relative&&(V[te].x1-=$,V[te].y1-=q,V[te].x2-=$,V[te].y2-=q,V[te].x-=$,V[te].y-=q),$=(D=[V[te].x,V[te].y])[0],q=D[1]}return V}(o,o.relative?0:u,o.relative?0:d):o})},r.ANNOTATE_ARCS=function(){return i(function(o,u,d){return o.relative&&(u=0,d=0),pr.ARC===o.type&&y3(o,u,d),o})},r.CLONE=a,r.CALCULATE_BOUNDS=function(){var o=function(w){var v={};for(var M in w)v[M]=w[M];return v},u=e(),d=n(),p=t(),_=i(function(w,v,M){var P=p(d(u(o(w))));function D(At){At>_.maxX&&(_.maxX=At),At<_.minX&&(_.minX=At)}function N(At){At>_.maxY&&(_.maxY=At),At<_.minY&&(_.minY=At)}if(P.type&pr.DRAWING_COMMANDS&&(D(v),N(M)),P.type&pr.HORIZ_LINE_TO&&D(P.x),P.type&pr.VERT_LINE_TO&&N(P.y),P.type&pr.LINE_TO&&(D(P.x),N(P.y)),P.type&pr.CURVE_TO){D(P.x),N(P.y);for(var z=0,W=oQ(v,P.x1,P.x2,P.x);z<W.length;z++)0<(ct=W[z])&&1>ct&&D(aQ(v,P.x1,P.x2,P.x,ct));for(var V=0,$=oQ(M,P.y1,P.y2,P.y);V<$.length;V++)0<(ct=$[V])&&1>ct&&N(aQ(M,P.y1,P.y2,P.y,ct))}if(P.type&pr.ARC){D(P.x),N(P.y),y3(P,v,M);for(var q=P.xRot/180*Math.PI,te=Math.cos(q)*P.rX,J=Math.sin(q)*P.rX,me=-Math.sin(q)*P.rY,xe=Math.cos(q)*P.rY,se=P.phi1<P.phi2?[P.phi1,P.phi2]:-180>P.phi2?[P.phi2+360,P.phi1+360]:[P.phi2,P.phi1],oe=se[0],ve=se[1],ge=function(At){var kt=At[0],ae=At[1],Te=180*Math.atan2(ae,kt)/Math.PI;return Te<oe?Te+360:Te},Je=0,Ge=nQ(me,-te,0).map(ge);Je<Ge.length;Je++)(ct=Ge[Je])>oe&&ct<ve&&D(sQ(P.cX,te,me,ct));for(var et=0,Ye=nQ(xe,-J,0).map(ge);et<Ye.length;et++){var ct;(ct=Ye[et])>oe&&ct<ve&&N(sQ(P.cY,J,xe,ct))}}return w});return _.minX=1/0,_.maxX=-1/0,_.minY=1/0,_.maxY=-1/0,_}})(io||(io={}));var cu,lQ=function(){function r(){}return r.prototype.round=function(e){return this.transform(io.ROUND(e))},r.prototype.toAbs=function(){return this.transform(io.TO_ABS())},r.prototype.toRel=function(){return this.transform(io.TO_REL())},r.prototype.normalizeHVZ=function(e,t,n){return this.transform(io.NORMALIZE_HVZ(e,t,n))},r.prototype.normalizeST=function(){return this.transform(io.NORMALIZE_ST())},r.prototype.qtToC=function(){return this.transform(io.QT_TO_C())},r.prototype.aToC=function(){return this.transform(io.A_TO_C())},r.prototype.sanitize=function(e){return this.transform(io.SANITIZE(e))},r.prototype.translate=function(e,t){return this.transform(io.TRANSLATE(e,t))},r.prototype.scale=function(e,t){return this.transform(io.SCALE(e,t))},r.prototype.rotate=function(e,t,n){return this.transform(io.ROTATE(e,t,n))},r.prototype.matrix=function(e,t,n,i,s,a){return this.transform(io.MATRIX(e,t,n,i,s,a))},r.prototype.skewX=function(e){return this.transform(io.SKEW_X(e))},r.prototype.skewY=function(e){return this.transform(io.SKEW_Y(e))},r.prototype.xSymmetry=function(e){return this.transform(io.X_AXIS_SYMMETRY(e))},r.prototype.ySymmetry=function(e){return this.transform(io.Y_AXIS_SYMMETRY(e))},r.prototype.annotateArcs=function(){return this.transform(io.ANNOTATE_ARCS())},r}(),I_e=function(r){return r===" "||r==="	"||r==="\r"||r===`
`},cQ=function(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57},M_e=function(r){function e(){var t=r.call(this)||this;return t.curNumber="",t.curCommandType=-1,t.curCommandRelative=!1,t.canParseCommandOrComma=!0,t.curNumberHasExp=!1,t.curNumberHasExpDigits=!1,t.curNumberHasDecimal=!1,t.curArgs=[],t}return rQ(e,r),e.prototype.finish=function(t){if(t===void 0&&(t=[]),this.parse(" ",t),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t},e.prototype.parse=function(t,n){var i=this;n===void 0&&(n=[]);for(var s=function(_){n.push(_),i.curArgs.length=0,i.canParseCommandOrComma=!0},a=0;a<t.length;a++){var o=t[a],u=!(this.curCommandType!==pr.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),d=cQ(o)&&(this.curNumber==="0"&&o==="0"||u);if(!cQ(o)||d)if(o!=="e"&&o!=="E")if(o!=="-"&&o!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(o!=="."||this.curNumberHasExp||this.curNumberHasDecimal||u){if(this.curNumber&&this.curCommandType!==-1){var p=Number(this.curNumber);if(isNaN(p))throw new SyntaxError("Invalid number ending at "+a);if(this.curCommandType===pr.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>p)throw new SyntaxError('Expected positive number, got "'+p+'" at index "'+a+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+a+'"')}this.curArgs.push(p),this.curArgs.length===P_e[this.curCommandType]&&(pr.HORIZ_LINE_TO===this.curCommandType?s({type:pr.HORIZ_LINE_TO,relative:this.curCommandRelative,x:p}):pr.VERT_LINE_TO===this.curCommandType?s({type:pr.VERT_LINE_TO,relative:this.curCommandRelative,y:p}):this.curCommandType===pr.MOVE_TO||this.curCommandType===pr.LINE_TO||this.curCommandType===pr.SMOOTH_QUAD_TO?(s({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),pr.MOVE_TO===this.curCommandType&&(this.curCommandType=pr.LINE_TO)):this.curCommandType===pr.CURVE_TO?s({type:pr.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===pr.SMOOTH_CURVE_TO?s({type:pr.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===pr.QUAD_TO?s({type:pr.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===pr.ARC&&s({type:pr.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!I_e(o))if(o===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(o!=="+"&&o!=="-"&&o!==".")if(d)this.curNumber=o,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+a+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+o+'" at index '+a+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,o!=="z"&&o!=="Z")if(o==="h"||o==="H")this.curCommandType=pr.HORIZ_LINE_TO,this.curCommandRelative=o==="h";else if(o==="v"||o==="V")this.curCommandType=pr.VERT_LINE_TO,this.curCommandRelative=o==="v";else if(o==="m"||o==="M")this.curCommandType=pr.MOVE_TO,this.curCommandRelative=o==="m";else if(o==="l"||o==="L")this.curCommandType=pr.LINE_TO,this.curCommandRelative=o==="l";else if(o==="c"||o==="C")this.curCommandType=pr.CURVE_TO,this.curCommandRelative=o==="c";else if(o==="s"||o==="S")this.curCommandType=pr.SMOOTH_CURVE_TO,this.curCommandRelative=o==="s";else if(o==="q"||o==="Q")this.curCommandType=pr.QUAD_TO,this.curCommandRelative=o==="q";else if(o==="t"||o==="T")this.curCommandType=pr.SMOOTH_QUAD_TO,this.curCommandRelative=o==="t";else{if(o!=="a"&&o!=="A")throw new SyntaxError('Unexpected character "'+o+'" at index '+a+".");this.curCommandType=pr.ARC,this.curCommandRelative=o==="a"}else n.push({type:pr.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=o,this.curNumberHasDecimal=o==="."}else this.curNumber+=o,this.curNumberHasDecimal=!0;else this.curNumber+=o;else this.curNumber+=o,this.curNumberHasExp=!0;else this.curNumber+=o,this.curNumberHasExpDigits=this.curNumberHasExp}return n},e.prototype.transform=function(t){return Object.create(this,{parse:{value:function(n,i){i===void 0&&(i=[]);for(var s=0,a=Object.getPrototypeOf(this).parse.call(this,n);s<a.length;s++){var o=a[s],u=t(o);Array.isArray(u)?i.push.apply(i,u):i.push(u)}return i}}})},e}(lQ),pr=function(r){function e(t){var n=r.call(this)||this;return n.commands=typeof t=="string"?e.parse(t):t,n}return rQ(e,r),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=io.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var n=[],i=0,s=this.commands;i<s.length;i++){var a=t(s[i]);Array.isArray(a)?n.push.apply(n,a):n.push(a)}return this.commands=n,this},e.encode=function(t){return S_e(t)},e.parse=function(t){var n=new M_e,i=[];return n.parse(t,i),n.finish(i),i},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(lQ),P_e=((cu={})[pr.MOVE_TO]=2,cu[pr.LINE_TO]=2,cu[pr.HORIZ_LINE_TO]=1,cu[pr.VERT_LINE_TO]=1,cu[pr.CLOSE_PATH]=0,cu[pr.QUAD_TO]=4,cu[pr.SMOOTH_QUAD_TO]=2,cu[pr.CURVE_TO]=6,cu[pr.SMOOTH_CURVE_TO]=4,cu[pr.ARC]=7,cu),uQ={},b3,hQ;function F_e(){if(hQ)return b3;hQ=1;var r=Wo(),e=au(),t=Y1(),n=H6(),i=RegExp.prototype;return b3=function(s){var a=s.flags;return a===void 0&&!("flags"in i)&&!e(s,"flags")&&t(i,s)?r(n,s):a},b3}var AQ;function R_e(){if(AQ)return uQ;AQ=1;var r=rb().PROPER,e=cd(),t=Na(),n=sh(),i=Qs(),s=F_e(),a="toString",o=RegExp.prototype,u=o[a],d=i(function(){return u.call({source:"a",flags:"b"})!=="/a/b"}),p=r&&u.name!==a;return(d||p)&&e(o,a,function(){var _=t(this),w=n(_.source),v=n(s(_));return"/"+w+"/"+v},{unsafe:!0}),uQ}R_e();function cb(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?cb=function(e){return typeof e}:cb=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cb(r)}function L_e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var O_e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],U_e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function D_e(r,e,t,n,i){if(typeof r=="string"&&(r=document.getElementById(r)),!r||cb(r)!=="object"||!("getContext"in r))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var s=r.getContext("2d");try{return s.getImageData(e,t,n,i)}catch(a){throw new Error("unable to access image data: "+a)}}function N_e(r,e,t,n,i,s){if(!(isNaN(s)||s<1)){s|=0;var a=D_e(r,e,t,n,i);a=k_e(a,e,t,n,i,s),r.getContext("2d").putImageData(a,e,t)}}function k_e(r,e,t,n,i,s){for(var a=r.data,o=2*s+1,u=n-1,d=i-1,p=s+1,_=p*(p+1)/2,w=new fQ,v=w,M,P=1;P<o;P++)v=v.next=new fQ,P===p&&(M=v);v.next=w;for(var D=null,N=null,z=0,W=0,V=O_e[s],$=U_e[s],q=0;q<i;q++){v=w;for(var te=a[W],J=a[W+1],me=a[W+2],xe=a[W+3],se=0;se<p;se++)v.r=te,v.g=J,v.b=me,v.a=xe,v=v.next;for(var oe=0,ve=0,ge=0,Je=0,Ge=p*te,et=p*J,Ye=p*me,ct=p*xe,At=_*te,kt=_*J,ae=_*me,Te=_*xe,Le=1;Le<p;Le++){var De=W+((u<Le?u:Le)<<2),at=a[De],rt=a[De+1],xt=a[De+2],vt=a[De+3],nr=p-Le;At+=(v.r=at)*nr,kt+=(v.g=rt)*nr,ae+=(v.b=xt)*nr,Te+=(v.a=vt)*nr,oe+=at,ve+=rt,ge+=xt,Je+=vt,v=v.next}D=w,N=M;for(var qt=0;qt<n;qt++){var or=Te*V>>>$;if(a[W+3]=or,or!==0){var gr=255/or;a[W]=(At*V>>>$)*gr,a[W+1]=(kt*V>>>$)*gr,a[W+2]=(ae*V>>>$)*gr}else a[W]=a[W+1]=a[W+2]=0;At-=Ge,kt-=et,ae-=Ye,Te-=ct,Ge-=D.r,et-=D.g,Ye-=D.b,ct-=D.a;var wr=qt+s+1;wr=z+(wr<u?wr:u)<<2,oe+=D.r=a[wr],ve+=D.g=a[wr+1],ge+=D.b=a[wr+2],Je+=D.a=a[wr+3],At+=oe,kt+=ve,ae+=ge,Te+=Je,D=D.next;var Ot=N,ze=Ot.r,$r=Ot.g,Rr=Ot.b,Jt=Ot.a;Ge+=ze,et+=$r,Ye+=Rr,ct+=Jt,oe-=ze,ve-=$r,ge-=Rr,Je-=Jt,N=N.next,W+=4}z+=n}for(var tr=0;tr<n;tr++){W=tr<<2;var mr=a[W],_r=a[W+1],Ut=a[W+2],ar=a[W+3],Sr=p*mr,Er=p*_r,Dr=p*Ut,nn=p*ar,Hr=_*mr,Wr=_*_r,vr=_*Ut,Qn=_*ar;v=w;for(var un=0;un<p;un++)v.r=mr,v.g=_r,v.b=Ut,v.a=ar,v=v.next;for(var ni=n,Be=0,ce=0,de=0,_e=0,Ue=1;Ue<=s;Ue++){W=ni+tr<<2;var je=p-Ue;Hr+=(v.r=mr=a[W])*je,Wr+=(v.g=_r=a[W+1])*je,vr+=(v.b=Ut=a[W+2])*je,Qn+=(v.a=ar=a[W+3])*je,_e+=mr,Be+=_r,ce+=Ut,de+=ar,v=v.next,Ue<d&&(ni+=n)}W=tr,D=w,N=M;for(var lt=0;lt<i;lt++){var dt=W<<2;a[dt+3]=ar=Qn*V>>>$,ar>0?(ar=255/ar,a[dt]=(Hr*V>>>$)*ar,a[dt+1]=(Wr*V>>>$)*ar,a[dt+2]=(vr*V>>>$)*ar):a[dt]=a[dt+1]=a[dt+2]=0,Hr-=Sr,Wr-=Er,vr-=Dr,Qn-=nn,Sr-=D.r,Er-=D.g,Dr-=D.b,nn-=D.a,dt=tr+((dt=lt+p)<d?dt:d)*n<<2,Hr+=_e+=D.r=a[dt],Wr+=Be+=D.g=a[dt+1],vr+=ce+=D.b=a[dt+2],Qn+=de+=D.a=a[dt+3],D=D.next,Sr+=mr=N.r,Er+=_r=N.g,Dr+=Ut=N.b,nn+=ar=N.a,_e-=mr,Be-=_r,ce-=Ut,de-=ar,N=N.next,W+=n}}return r}var fQ=function r(){L_e(this,r),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function Q_e(){var{DOMParser:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:r,createCanvas(t,n){return new OffscreenCanvas(t,n)},createImage(t){return Qh(function*(){var n=yield fetch(t),i=yield n.blob(),s=yield createImageBitmap(i);return s})()}};return(typeof DOMParser<"u"||typeof r>"u")&&Reflect.deleteProperty(e,"DOMParser"),e}function z_e(r){var{DOMParser:e,canvas:t,fetch:n}=r;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:e,fetch:n,createCanvas:t.createCanvas,createImage:t.loadImage}}var H_e=Object.freeze({__proto__:null,offscreen:Q_e,node:z_e});function ud(r){return r.replace(/(?!\u3000)\s+/gm," ")}function dQ(r){return r.replace(/^[\n \t]+/,"")}function pQ(r){return r.replace(/[\n \t]+$/,"")}function al(r){var e=(r||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return e.map(parseFloat)}var V_e=/^[A-Z-]+$/;function gQ(r){return V_e.test(r)?r.toLowerCase():r}function v3(r){var e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(r)||[];return e[2]||e[3]||e[4]}function mQ(r){if(!r.startsWith("rgb"))return r;var e=3,t=r.replace(/\d+(\.\d+)?/g,(n,i)=>e--&&i?String(Math.round(parseFloat(n))):n);return t}var j_e=/(\[[^\]]+\])/g,$_e=/(#[^\s+>~.[:]+)/g,G_e=/(\.[^\s+>~.[:]+)/g,q_e=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,K_e=/(:[\w-]+\([^)]*\))/gi,W_e=/(:[^\s+>~.[:]+)/g,X_e=/([^\s+>~.[:]+)/g;function hd(r,e){var t=e.exec(r);return t?[r.replace(e," "),t.length]:[r,0]}function _Q(r){var e=[0,0,0],t=r.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),n=0;return[t,n]=hd(t,j_e),e[1]+=n,[t,n]=hd(t,$_e),e[0]+=n,[t,n]=hd(t,G_e),e[1]+=n,[t,n]=hd(t,q_e),e[2]+=n,[t,n]=hd(t,K_e),e[1]+=n,[t,n]=hd(t,W_e),e[1]+=n,t=t.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[t,n]=hd(t,X_e),e[2]+=n,e.join("")}var Ad=1e-8;function w3(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2))}function ub(r,e){return(r[0]*e[0]+r[1]*e[1])/(w3(r)*w3(e))}function x3(r,e){return(r[0]*e[1]<r[1]*e[0]?-1:1)*Math.acos(ub(r,e))}function B3(r){return r*r*r}function C3(r){return 3*r*r*(1-r)}function T3(r){return 3*r*(1-r)*(1-r)}function E3(r){return(1-r)*(1-r)*(1-r)}function S3(r){return r*r}function I3(r){return 2*r*(1-r)}function M3(r){return(1-r)*(1-r)}class rn{constructor(e,t,n){this.document=e,this.name=t,this.value=n,this.isNormalizedColor=!1}static empty(e){return new rn(e,"EMPTY","")}split(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:t,name:n}=this;return ud(this.getString()).trim().split(e).map(i=>new rn(t,n,i))}hasValue(e){var{value:t}=this;return t!==null&&t!==""&&(e||t!==0)&&typeof t<"u"}isString(e){var{value:t}=this,n=typeof t=="string";return!n||!e?n:e.test(t)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var e=this.getString();switch(!0){case e.endsWith("px"):case/^[0-9]+$/.test(e):return!0;default:return!1}}setValue(e){return this.value=e,this}getValue(e){return typeof e>"u"||this.hasValue()?this.value:e}getNumber(e){if(!this.hasValue())return typeof e>"u"?0:parseFloat(e);var{value:t}=this,n=parseFloat(t);return this.isString(/%$/)&&(n/=100),n}getString(e){return typeof e>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(e)}getColor(e){var t=this.getString(e);return this.isNormalizedColor||(this.isNormalizedColor=!0,t=mQ(t),this.value=t),t}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[n,i]=typeof e=="boolean"?[void 0,e]:[e],{viewPort:s}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(s.computeSize("x"),s.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(s.computeSize("x"),s.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*s.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*s.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&i):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*s.computeSize(n);default:{var a=this.getNumber();return t&&a<1?a*s.computeSize(n):a}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var e=this.getString(),t=/#([^)'"]+)/.exec(e);return t&&(t=t[1]),t||(t=e),this.document.definitions[t]}getFillStyleDefinition(e,t){var n=this.getDefinition();if(!n)return null;if(typeof n.createGradient=="function")return n.createGradient(this.document.ctx,e,t);if(typeof n.createPattern=="function"){if(n.getHrefAttribute().hasValue()){var i=n.getAttribute("patternTransform");n=n.getHrefAttribute().getDefinition(),i.hasValue()&&n.getAttribute("patternTransform",!0).setValue(i.value)}return n.createPattern(this.document.ctx,e,t)}return null}getTextBaseline(){return this.hasValue()?rn.textBaselineMapping[this.getString()]:null}addOpacity(e){for(var t=this.getColor(),n=t.length,i=0,s=0;s<n&&(t[s]===","&&i++,i!==3);s++);if(e.hasValue()&&this.isString()&&i!==3){var a=new g3(t);a.ok&&(a.alpha=e.getNumber(),t=a.toRGBA())}return new rn(this.document,this.name,t)}}rn.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class yQ{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(e,t){this.viewPorts.push({width:e,height:t})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:e}=this;return e[e.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(e){return typeof e=="number"?e:e==="x"?this.width:e==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class ws{constructor(e,t){this.x=e,this.y=t}static parse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[n=t,i=t]=al(e);return new ws(n,i)}static parseScale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[n=t,i=n]=al(e);return new ws(n,i)}static parsePath(e){for(var t=al(e),n=t.length,i=[],s=0;s<n;s+=2)i.push(new ws(t[s],t[s+1]));return i}angleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}applyTransform(e){var{x:t,y:n}=this,i=t*e[0]+n*e[2]+e[4],s=t*e[1]+n*e[3]+e[5];this.x=i,this.y=s}}class bQ{constructor(e){this.screen=e,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:e,onClick:t,onMouseMove:n}=this,i=e.ctx.canvas;i.onclick=t,i.onmousemove=n,this.working=!0}}stop(){if(this.working){var e=this.screen.ctx.canvas;this.working=!1,e.onclick=null,e.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:e,events:t,eventElements:n}=this,{style:i}=e.ctx.canvas;i&&(i.cursor=""),t.forEach((s,a)=>{for(var{run:o}=s,u=n[a];u;)o(u),u=u.parent}),this.events=[],this.eventElements=[]}}checkPath(e,t){if(!(!this.working||!t)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:u}=s;!i[a]&&t.isPointInPath&&t.isPointInPath(o,u)&&(i[a]=e)})}}checkBoundingBox(e,t){if(!(!this.working||!t)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:u}=s;!i[a]&&t.isPointInBox(o,u)&&(i[a]=e)})}}mapXY(e,t){for(var{window:n,ctx:i}=this.screen,s=new ws(e,t),a=i.canvas;a;)s.x-=a.offsetLeft,s.y-=a.offsetTop,a=a.offsetParent;return n.scrollX&&(s.x+=n.scrollX),n.scrollY&&(s.y+=n.scrollY),s}onClick(e){var{x:t,y:n}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onclick",x:t,y:n,run(i){i.onClick&&i.onClick()}})}onMouseMove(e){var{x:t,y:n}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onmousemove",x:t,y:n,run(i){i.onMouseMove&&i.onMouseMove()}})}}var vQ=typeof window<"u"?window:null,wQ=typeof fetch<"u"?fetch.bind(void 0):null;class Zm{constructor(e){var{fetch:t=wQ,window:n=vQ}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=e,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new yQ,this.mouse=new bQ(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=n,this.fetch=t}wait(e){this.waits.push(e)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var e=this.waits.every(t=>t());return e&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=e,e}setDefaults(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4}setViewBox(e){var{document:t,ctx:n,aspectRatio:i,width:s,desiredWidth:a,height:o,desiredHeight:u,minX:d=0,minY:p=0,refX:_,refY:w,clip:v=!1,clipX:M=0,clipY:P=0}=e,D=ud(i).replace(/^defer\s/,""),[N,z]=D.split(" "),W=N||"xMidYMid",V=z||"meet",$=s/a,q=o/u,te=Math.min($,q),J=Math.max($,q),me=a,xe=u;V==="meet"&&(me*=te,xe*=te),V==="slice"&&(me*=J,xe*=J);var se=new rn(t,"refX",_),oe=new rn(t,"refY",w),ve=se.hasValue()&&oe.hasValue();if(ve&&n.translate(-te*se.getPixels("x"),-te*oe.getPixels("y")),v){var ge=te*M,Je=te*P;n.beginPath(),n.moveTo(ge,Je),n.lineTo(s,Je),n.lineTo(s,o),n.lineTo(ge,o),n.closePath(),n.clip()}if(!ve){var Ge=V==="meet"&&te===q,et=V==="slice"&&J===q,Ye=V==="meet"&&te===$,ct=V==="slice"&&J===$;W.startsWith("xMid")&&(Ge||et)&&n.translate(s/2-me/2,0),W.endsWith("YMid")&&(Ye||ct)&&n.translate(0,o/2-xe/2),W.startsWith("xMax")&&(Ge||et)&&n.translate(s-me,0),W.endsWith("YMax")&&(Ye||ct)&&n.translate(0,o-xe)}switch(!0){case W==="none":n.scale($,q);break;case V==="meet":n.scale(te,te);break;case V==="slice":n.scale(J,J);break}n.translate(-d,-p)}start(e){var{enableRedraw:t=!1,ignoreMouse:n=!1,ignoreAnimation:i=!1,ignoreDimensions:s=!1,ignoreClear:a=!1,forceRedraw:o,scaleWidth:u,scaleHeight:d,offsetX:p,offsetY:_}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:w,mouse:v}=this,M=1e3/w;if(this.frameDuration=M,this.readyPromise=new Promise(W=>{this.resolveReady=W}),this.isReady()&&this.render(e,s,a,u,d,p,_),!!t){var P=Date.now(),D=P,N=0,z=()=>{P=Date.now(),N=P-D,N>=M&&(D=P-N%M,this.shouldUpdate(i,o)&&(this.render(e,s,a,u,d,p,_),v.runEvents())),this.intervalId=f3(z)};n||v.start(),this.intervalId=f3(z)}}stop(){this.intervalId&&(f3.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(e,t){if(!e){var{frameDuration:n}=this,i=this.animations.reduce((s,a)=>a.update(n)||s,!1);if(i)return!0}return!!(typeof t=="function"&&t()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(e,t,n,i,s,a,o){var{CLIENT_WIDTH:u,CLIENT_HEIGHT:d,viewPort:p,ctx:_,isFirstRender:w}=this,v=_.canvas;p.clear(),v.width&&v.height?p.setCurrent(v.width,v.height):p.setCurrent(u,d);var M=e.getStyle("width"),P=e.getStyle("height");!t&&(w||typeof i!="number"&&typeof s!="number")&&(M.hasValue()&&(v.width=M.getPixels("x"),v.style&&(v.style.width="".concat(v.width,"px"))),P.hasValue()&&(v.height=P.getPixels("y"),v.style&&(v.style.height="".concat(v.height,"px"))));var D=v.clientWidth||v.width,N=v.clientHeight||v.height;if(t&&M.hasValue()&&P.hasValue()&&(D=M.getPixels("x"),N=P.getPixels("y")),p.setCurrent(D,N),typeof a=="number"&&e.getAttribute("x",!0).setValue(a),typeof o=="number"&&e.getAttribute("y",!0).setValue(o),typeof i=="number"||typeof s=="number"){var z=al(e.getAttribute("viewBox").getString()),W=0,V=0;if(typeof i=="number"){var $=e.getStyle("width");$.hasValue()?W=$.getPixels("x")/i:isNaN(z[2])||(W=z[2]/i)}if(typeof s=="number"){var q=e.getStyle("height");q.hasValue()?V=q.getPixels("y")/s:isNaN(z[3])||(V=z[3]/s)}W||(W=V),V||(V=W),e.getAttribute("width",!0).setValue(i),e.getAttribute("height",!0).setValue(s);var te=e.getStyle("transform",!0,!0);te.setValue("".concat(te.getString()," scale(").concat(1/W,", ").concat(1/V,")"))}n||_.clearRect(0,0,D,N),e.render(_),w&&(this.isFirstRender=!1)}}Zm.defaultWindow=vQ,Zm.defaultFetch=wQ;var{defaultFetch:Y_e}=Zm,Z_e=typeof DOMParser<"u"?DOMParser:null;class hb{constructor(){var{fetch:e=Y_e,DOMParser:t=Z_e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=e,this.DOMParser=t}parse(e){var t=this;return Qh(function*(){return e.startsWith("<")?t.parseFromString(e):t.load(e)})()}parseFromString(e){var t=new this.DOMParser;try{return this.checkDocument(t.parseFromString(e,"image/svg+xml"))}catch{return this.checkDocument(t.parseFromString(e,"text/xml"))}}checkDocument(e){var t=e.getElementsByTagName("parsererror")[0];if(t)throw new Error(t.textContent);return e}load(e){var t=this;return Qh(function*(){var n=yield t.fetch(e),i=yield n.text();return t.parseFromString(i)})()}}class xQ{constructor(e,t){this.type="translate",this.point=null,this.point=ws.parse(t)}apply(e){var{x:t,y:n}=this.point;e.translate(t||0,n||0)}unapply(e){var{x:t,y:n}=this.point;e.translate(-1*t||0,-1*n||0)}applyToPoint(e){var{x:t,y:n}=this.point;e.applyTransform([1,0,0,1,t||0,n||0])}}class BQ{constructor(e,t,n){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var i=al(t);this.angle=new rn(e,"angle",i[0]),this.originX=n[0],this.originY=n[1],this.cx=i[1]||0,this.cy=i[2]||0}apply(e){var{cx:t,cy:n,originX:i,originY:s,angle:a}=this,o=t+i.getPixels("x"),u=n+s.getPixels("y");e.translate(o,u),e.rotate(a.getRadians()),e.translate(-o,-u)}unapply(e){var{cx:t,cy:n,originX:i,originY:s,angle:a}=this,o=t+i.getPixels("x"),u=n+s.getPixels("y");e.translate(o,u),e.rotate(-1*a.getRadians()),e.translate(-o,-u)}applyToPoint(e){var{cx:t,cy:n,angle:i}=this,s=i.getRadians();e.applyTransform([1,0,0,1,t||0,n||0]),e.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]),e.applyTransform([1,0,0,1,-t||0,-n||0])}}class CQ{constructor(e,t,n){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var i=ws.parseScale(t);(i.x===0||i.y===0)&&(i.x=Ad,i.y=Ad),this.scale=i,this.originX=n[0],this.originY=n[1]}apply(e){var{scale:{x:t,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");e.translate(a,o),e.scale(t,n||t),e.translate(-a,-o)}unapply(e){var{scale:{x:t,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");e.translate(a,o),e.scale(1/t,1/n||t),e.translate(-a,-o)}applyToPoint(e){var{x:t,y:n}=this.scale;e.applyTransform([t||0,0,0,n||0,0,0])}}class P3{constructor(e,t,n){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=al(t),this.originX=n[0],this.originY=n[1]}apply(e){var{originX:t,originY:n,matrix:i}=this,s=t.getPixels("x"),a=n.getPixels("y");e.translate(s,a),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e.translate(-s,-a)}unapply(e){var{originX:t,originY:n,matrix:i}=this,s=i[0],a=i[2],o=i[4],u=i[1],d=i[3],p=i[5],_=0,w=0,v=1,M=1/(s*(d*v-p*w)-a*(u*v-p*_)+o*(u*w-d*_)),P=t.getPixels("x"),D=n.getPixels("y");e.translate(P,D),e.transform(M*(d*v-p*w),M*(p*_-u*v),M*(o*w-a*v),M*(s*v-o*_),M*(a*p-o*d),M*(o*u-s*p)),e.translate(-P,-D)}applyToPoint(e){e.applyTransform(this.matrix)}}class F3 extends P3{constructor(e,t,n){super(e,t,n),this.type="skew",this.angle=null,this.angle=new rn(e,"angle",t)}}class TQ extends F3{constructor(e,t,n){super(e,t,n),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class EQ extends F3{constructor(e,t,n){super(e,t,n),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function J_e(r){return ud(r).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function eye(r){var[e,t]=r.split("(");return[e.trim(),t.trim().replace(")","")]}class XA{constructor(e,t,n){this.document=e,this.transforms=[];var i=J_e(t);i.forEach(s=>{if(s!=="none"){var[a,o]=eye(s),u=XA.transformTypes[a];typeof u<"u"&&this.transforms.push(new u(this.document,o,n))}})}static fromElement(e,t){var n=t.getStyle("transform",!1,!0),[i,s=i]=t.getStyle("transform-origin",!1,!0).split(),a=[i,s];return n.hasValue()?new XA(e,n.getString(),a):null}apply(e){for(var{transforms:t}=this,n=t.length,i=0;i<n;i++)t[i].apply(e)}unapply(e){for(var{transforms:t}=this,n=t.length,i=n-1;i>=0;i--)t[i].unapply(e)}applyToPoint(e){for(var{transforms:t}=this,n=t.length,i=0;i<n;i++)t[i].applyToPoint(e)}}XA.transformTypes={translate:xQ,rotate:BQ,scale:CQ,matrix:P3,skewX:TQ,skewY:EQ};class Vi{constructor(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=e,this.node=t,this.captureTextNodes=n,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!t||t.nodeType!==1)){if(Array.from(t.attributes).forEach(o=>{var u=gQ(o.nodeName);this.attributes[u]=new rn(e,u,o.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var i=this.getAttribute("style").getString().split(";").map(o=>o.trim());i.forEach(o=>{if(o){var[u,d]=o.split(":").map(p=>p.trim());this.styles[u]=new rn(e,u,d)}})}var{definitions:s}=e,a=this.getAttribute("id");a.hasValue()&&(s[a.getString()]||(s[a.getString()]=this)),Array.from(t.childNodes).forEach(o=>{if(o.nodeType===1)this.addChild(o);else if(n&&(o.nodeType===3||o.nodeType===4)){var u=e.createTextNode(o);u.getText().length>0&&this.addChild(u)}})}}getAttribute(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.attributes[e];if(!n&&t){var i=new rn(this.document,e,"");return this.attributes[e]=i,i}return n||rn.empty(this.document)}getHrefAttribute(){for(var e in this.attributes)if(e==="href"||e.endsWith(":href"))return this.attributes[e];return rn.empty(this.document)}getStyle(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.styles[e];if(i)return i;var s=this.getAttribute(e);if(s!=null&&s.hasValue())return this.styles[e]=s,s;if(!n){var{parent:a}=this;if(a){var o=a.getStyle(e);if(o!=null&&o.hasValue())return o}}if(t){var u=new rn(this.document,e,"");return this.styles[e]=u,u}return i||rn.empty(this.document)}render(e){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(e.save(),this.getStyle("mask").hasValue()){var t=this.getStyle("mask").getDefinition();t&&(this.applyEffects(e),t.apply(e,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var n=this.getStyle("filter").getDefinition();n&&(this.applyEffects(e),n.apply(e,this))}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}}setContext(e){}applyEffects(e){var t=XA.fromElement(this.document,this);t&&t.apply(e);var n=this.getStyle("clip-path",!1,!0);if(n.hasValue()){var i=n.getDefinition();i&&i.apply(e)}}clearContext(e){}renderChildren(e){this.children.forEach(t=>{t.render(e)})}addChild(e){var t=e instanceof Vi?e:this.document.createElement(e);t.parent=this,Vi.ignoreChildTypes.includes(t.type)||this.children.push(t)}matchesSelector(e){var t,{node:n}=this;if(typeof n.matches=="function")return n.matches(e);var i=(t=n.getAttribute)===null||t===void 0?void 0:t.call(n,"class");return!i||i===""?!1:i.split(" ").some(s=>".".concat(s)===e)}addStylesFromStyleDefinition(){var{styles:e,stylesSpecificity:t}=this.document;for(var n in e)if(!n.startsWith("@")&&this.matchesSelector(n)){var i=e[n],s=t[n];if(i)for(var a in i){var o=this.stylesSpecificity[a];typeof o>"u"&&(o="000"),s>=o&&(this.styles[a]=i[a],this.stylesSpecificity[a]=s)}}}removeStyles(e,t){var n=t.reduce((i,s)=>{var a=e.getStyle(s);if(!a.hasValue())return i;var o=a.getString();return a.setValue(""),[...i,[s,o]]},[]);return n}restoreStyles(e,t){t.forEach(n=>{var[i,s]=n;e.getStyle(i,!0).setValue(s)})}isFirstChild(){var e;return((e=this.parent)===null||e===void 0?void 0:e.children.indexOf(this))===0}}Vi.ignoreChildTypes=["title"];class SQ extends Vi{constructor(e,t,n){super(e,t,n)}}function tye(r){var e=r.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function rye(r){return typeof process>"u"?r:r.trim().split(",").map(tye).join(",")}function nye(r){if(!r)return"";var e=r.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}function iye(r){if(!r)return"";var e=r.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class ya{constructor(e,t,n,i,s,a){var o=a?typeof a=="string"?ya.parse(a):a:{};this.fontFamily=s||o.fontFamily,this.fontSize=i||o.fontSize,this.fontStyle=e||o.fontStyle,this.fontWeight=n||o.fontWeight,this.fontVariant=t||o.fontVariant}static parse(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n="",i="",s="",a="",o="",u=ud(e).trim().split(" "),d={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return u.forEach(p=>{switch(!0){case(!d.fontStyle&&ya.styles.includes(p)):p!=="inherit"&&(n=p),d.fontStyle=!0;break;case(!d.fontVariant&&ya.variants.includes(p)):p!=="inherit"&&(i=p),d.fontStyle=!0,d.fontVariant=!0;break;case(!d.fontWeight&&ya.weights.includes(p)):p!=="inherit"&&(s=p),d.fontStyle=!0,d.fontVariant=!0,d.fontWeight=!0;break;case!d.fontSize:p!=="inherit"&&([a]=p.split("/")),d.fontStyle=!0,d.fontVariant=!0,d.fontWeight=!0,d.fontSize=!0;break;default:p!=="inherit"&&(o+=p)}}),new ya(n,i,s,a,o,t)}toString(){return[nye(this.fontStyle),this.fontVariant,iye(this.fontWeight),this.fontSize,rye(this.fontFamily)].join(" ").trim()}}ya.styles="normal|italic|oblique|inherit",ya.variants="normal|small-caps|inherit",ya.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class ac{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=e,this.y1=t,this.x2=n,this.y2=i,this.addPoint(e,t),this.addPoint(n,i)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(e,t){typeof e<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))}addX(e){this.addPoint(e,null)}addY(e){this.addPoint(null,e)}addBoundingBox(e){if(e){var{x1:t,y1:n,x2:i,y2:s}=e;this.addPoint(t,n),this.addPoint(i,s)}}sumCubic(e,t,n,i,s){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*n+3*(1-e)*Math.pow(e,2)*i+Math.pow(e,3)*s}bezierCurveAdd(e,t,n,i,s){var a=6*t-12*n+6*i,o=-3*t+9*n-9*i+3*s,u=3*n-3*t;if(o===0){if(a===0)return;var d=-u/a;0<d&&d<1&&(e?this.addX(this.sumCubic(d,t,n,i,s)):this.addY(this.sumCubic(d,t,n,i,s)));return}var p=Math.pow(a,2)-4*u*o;if(!(p<0)){var _=(-a+Math.sqrt(p))/(2*o);0<_&&_<1&&(e?this.addX(this.sumCubic(_,t,n,i,s)):this.addY(this.sumCubic(_,t,n,i,s)));var w=(-a-Math.sqrt(p))/(2*o);0<w&&w<1&&(e?this.addX(this.sumCubic(w,t,n,i,s)):this.addY(this.sumCubic(w,t,n,i,s)))}}addBezierCurve(e,t,n,i,s,a,o,u){this.addPoint(e,t),this.addPoint(o,u),this.bezierCurveAdd(!0,e,n,s,o),this.bezierCurveAdd(!1,t,i,a,u)}addQuadraticCurve(e,t,n,i,s,a){var o=e+.6666666666666666*(n-e),u=t+2/3*(i-t),d=o+1/3*(s-e),p=u+1/3*(a-t);this.addBezierCurve(e,t,o,d,u,p,s,a)}isPointInBox(e,t){var{x1:n,y1:i,x2:s,y2:a}=this;return n<=e&&e<=s&&i<=t&&t<=a}}class xn extends pr{constructor(e){super(e.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new ws(0,0),this.control=new ws(0,0),this.current=new ws(0,0),this.points=[],this.angles=[]}isEnd(){var{i:e,commands:t}=this;return e>=t.length-1}next(){var e=this.commands[++this.i];return this.previousCommand=this.command,this.command=e,e}getPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",n=new ws(this.command[e],this.command[t]);return this.makeAbsolute(n)}getAsControlPoint(e,t){var n=this.getPoint(e,t);return this.control=n,n}getAsCurrentPoint(e,t){var n=this.getPoint(e,t);return this.current=n,n}getReflectedControlPoint(){var e=this.previousCommand.type;if(e!==pr.CURVE_TO&&e!==pr.SMOOTH_CURVE_TO&&e!==pr.QUAD_TO&&e!==pr.SMOOTH_QUAD_TO)return this.current;var{current:{x:t,y:n},control:{x:i,y:s}}=this,a=new ws(2*t-i,2*n-s);return a}makeAbsolute(e){if(this.command.relative){var{x:t,y:n}=this.current;e.x+=t,e.y+=n}return e}addMarker(e,t,n){var{points:i,angles:s}=this;n&&s.length>0&&!s[s.length-1]&&(s[s.length-1]=i[i.length-1].angleTo(n)),this.addMarkerAngle(e,t?t.angleTo(e):null)}addMarkerAngle(e,t){this.points.push(e),this.angles.push(t)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:e}=this,t=e.length,n=0;n<t;n++)if(!e[n]){for(var i=n+1;i<t;i++)if(e[i]){e[n]=e[i];break}}return e}}class YA extends Vi{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var e=1,t=this;t;){var n=t.getStyle("opacity",!1,!0);n.hasValue(!0)&&(e*=n.getNumber()),t=t.parent}return e}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!t){var n=this.getStyle("fill"),i=this.getStyle("fill-opacity"),s=this.getStyle("stroke"),a=this.getStyle("stroke-opacity");if(n.isUrlDefinition()){var o=n.getFillStyleDefinition(this,i);o&&(e.fillStyle=o)}else if(n.hasValue()){n.getString()==="currentColor"&&n.setValue(this.getStyle("color").getColor());var u=n.getColor();u!=="inherit"&&(e.fillStyle=u==="none"?"rgba(0,0,0,0)":u)}if(i.hasValue()){var d=new rn(this.document,"fill",e.fillStyle).addOpacity(i).getColor();e.fillStyle=d}if(s.isUrlDefinition()){var p=s.getFillStyleDefinition(this,a);p&&(e.strokeStyle=p)}else if(s.hasValue()){s.getString()==="currentColor"&&s.setValue(this.getStyle("color").getColor());var _=s.getString();_!=="inherit"&&(e.strokeStyle=_==="none"?"rgba(0,0,0,0)":_)}if(a.hasValue()){var w=new rn(this.document,"stroke",e.strokeStyle).addOpacity(a).getString();e.strokeStyle=w}var v=this.getStyle("stroke-width");if(v.hasValue()){var M=v.getPixels();e.lineWidth=M||Ad}var P=this.getStyle("stroke-linecap"),D=this.getStyle("stroke-linejoin"),N=this.getStyle("stroke-miterlimit"),z=this.getStyle("stroke-dasharray"),W=this.getStyle("stroke-dashoffset");if(P.hasValue()&&(e.lineCap=P.getString()),D.hasValue()&&(e.lineJoin=D.getString()),N.hasValue()&&(e.miterLimit=N.getNumber()),z.hasValue()&&z.getString()!=="none"){var V=al(z.getString());typeof e.setLineDash<"u"?e.setLineDash(V):typeof e.webkitLineDash<"u"?e.webkitLineDash=V:typeof e.mozDash<"u"&&!(V.length===1&&V[0]===0)&&(e.mozDash=V);var $=W.getPixels();typeof e.lineDashOffset<"u"?e.lineDashOffset=$:typeof e.webkitLineDashOffset<"u"?e.webkitLineDashOffset=$:typeof e.mozDashOffset<"u"&&(e.mozDashOffset=$)}}if(this.modifiedEmSizeStack=!1,typeof e.font<"u"){var q=this.getStyle("font"),te=this.getStyle("font-style"),J=this.getStyle("font-variant"),me=this.getStyle("font-weight"),xe=this.getStyle("font-size"),se=this.getStyle("font-family"),oe=new ya(te.getString(),J.getString(),me.getString(),xe.hasValue()?"".concat(xe.getPixels(!0),"px"):"",se.getString(),ya.parse(q.getString(),e.font));te.setValue(oe.fontStyle),J.setValue(oe.fontVariant),me.setValue(oe.fontWeight),xe.setValue(oe.fontSize),se.setValue(oe.fontFamily),e.font=oe.toString(),xe.isPixels()&&(this.document.emSize=xe.getPixels(),this.modifiedEmSizeStack=!0)}t||(this.applyEffects(e),e.globalAlpha=this.calculateOpacity())}clearContext(e){super.clearContext(e),this.modifiedEmSizeStack&&this.document.popEmSize()}}class fi extends YA{constructor(e,t,n){super(e,t,n),this.type="path",this.pathParser=null,this.pathParser=new xn(this.getAttribute("d").getString())}path(e){var{pathParser:t}=this,n=new ac;for(t.reset(),e&&e.beginPath();!t.isEnd();)switch(t.next().type){case xn.MOVE_TO:this.pathM(e,n);break;case xn.LINE_TO:this.pathL(e,n);break;case xn.HORIZ_LINE_TO:this.pathH(e,n);break;case xn.VERT_LINE_TO:this.pathV(e,n);break;case xn.CURVE_TO:this.pathC(e,n);break;case xn.SMOOTH_CURVE_TO:this.pathS(e,n);break;case xn.QUAD_TO:this.pathQ(e,n);break;case xn.SMOOTH_QUAD_TO:this.pathT(e,n);break;case xn.ARC:this.pathA(e,n);break;case xn.CLOSE_PATH:this.pathZ(e,n);break}return n}getBoundingBox(e){return this.path()}getMarkers(){var{pathParser:e}=this,t=e.getMarkerPoints(),n=e.getMarkerAngles(),i=t.map((s,a)=>[s,n[a]]);return i}renderChildren(e){this.path(e),this.document.screen.mouse.checkPath(this,e);var t=this.getStyle("fill-rule");e.fillStyle!==""&&(t.getString("inherit")!=="inherit"?e.fill(t.getString()):e.fill()),e.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(e.save(),e.setTransform(1,0,0,1,0,0),e.stroke(),e.restore()):e.stroke());var n=this.getMarkers();if(n){var i=n.length-1,s=this.getStyle("marker-start"),a=this.getStyle("marker-mid"),o=this.getStyle("marker-end");if(s.isUrlDefinition()){var u=s.getDefinition(),[d,p]=n[0];u.render(e,d,p)}if(a.isUrlDefinition())for(var _=a.getDefinition(),w=1;w<i;w++){var[v,M]=n[w];_.render(e,v,M)}if(o.isUrlDefinition()){var P=o.getDefinition(),[D,N]=n[i];P.render(e,D,N)}}}static pathM(e){var t=e.getAsCurrentPoint();return e.start=e.current,{point:t}}pathM(e,t){var{pathParser:n}=this,{point:i}=fi.pathM(n),{x:s,y:a}=i;n.addMarker(i),t.addPoint(s,a),e&&e.moveTo(s,a)}static pathL(e){var{current:t}=e,n=e.getAsCurrentPoint();return{current:t,point:n}}pathL(e,t){var{pathParser:n}=this,{current:i,point:s}=fi.pathL(n),{x:a,y:o}=s;n.addMarker(s,i),t.addPoint(a,o),e&&e.lineTo(a,o)}static pathH(e){var{current:t,command:n}=e,i=new ws((n.relative?t.x:0)+n.x,t.y);return e.current=i,{current:t,point:i}}pathH(e,t){var{pathParser:n}=this,{current:i,point:s}=fi.pathH(n),{x:a,y:o}=s;n.addMarker(s,i),t.addPoint(a,o),e&&e.lineTo(a,o)}static pathV(e){var{current:t,command:n}=e,i=new ws(t.x,(n.relative?t.y:0)+n.y);return e.current=i,{current:t,point:i}}pathV(e,t){var{pathParser:n}=this,{current:i,point:s}=fi.pathV(n),{x:a,y:o}=s;n.addMarker(s,i),t.addPoint(a,o),e&&e.lineTo(a,o)}static pathC(e){var{current:t}=e,n=e.getPoint("x1","y1"),i=e.getAsControlPoint("x2","y2"),s=e.getAsCurrentPoint();return{current:t,point:n,controlPoint:i,currentPoint:s}}pathC(e,t){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=fi.pathC(n);n.addMarker(o,a,s),t.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),e&&e.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathS(e){var{current:t}=e,n=e.getReflectedControlPoint(),i=e.getAsControlPoint("x2","y2"),s=e.getAsCurrentPoint();return{current:t,point:n,controlPoint:i,currentPoint:s}}pathS(e,t){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=fi.pathS(n);n.addMarker(o,a,s),t.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),e&&e.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathQ(e){var{current:t}=e,n=e.getAsControlPoint("x1","y1"),i=e.getAsCurrentPoint();return{current:t,controlPoint:n,currentPoint:i}}pathQ(e,t){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=fi.pathQ(n);n.addMarker(a,s,s),t.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),e&&e.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathT(e){var{current:t}=e,n=e.getReflectedControlPoint();e.control=n;var i=e.getAsCurrentPoint();return{current:t,controlPoint:n,currentPoint:i}}pathT(e,t){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=fi.pathT(n);n.addMarker(a,s,s),t.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),e&&e.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathA(e){var{current:t,command:n}=e,{rX:i,rY:s,xRot:a,lArcFlag:o,sweepFlag:u}=n,d=a*(Math.PI/180),p=e.getAsCurrentPoint(),_=new ws(Math.cos(d)*(t.x-p.x)/2+Math.sin(d)*(t.y-p.y)/2,-Math.sin(d)*(t.x-p.x)/2+Math.cos(d)*(t.y-p.y)/2),w=Math.pow(_.x,2)/Math.pow(i,2)+Math.pow(_.y,2)/Math.pow(s,2);w>1&&(i*=Math.sqrt(w),s*=Math.sqrt(w));var v=(o===u?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(s,2)-Math.pow(i,2)*Math.pow(_.y,2)-Math.pow(s,2)*Math.pow(_.x,2))/(Math.pow(i,2)*Math.pow(_.y,2)+Math.pow(s,2)*Math.pow(_.x,2)));isNaN(v)&&(v=0);var M=new ws(v*i*_.y/s,v*-s*_.x/i),P=new ws((t.x+p.x)/2+Math.cos(d)*M.x-Math.sin(d)*M.y,(t.y+p.y)/2+Math.sin(d)*M.x+Math.cos(d)*M.y),D=x3([1,0],[(_.x-M.x)/i,(_.y-M.y)/s]),N=[(_.x-M.x)/i,(_.y-M.y)/s],z=[(-_.x-M.x)/i,(-_.y-M.y)/s],W=x3(N,z);return ub(N,z)<=-1&&(W=Math.PI),ub(N,z)>=1&&(W=0),{currentPoint:p,rX:i,rY:s,sweepFlag:u,xAxisRotation:d,centp:P,a1:D,ad:W}}pathA(e,t){var{pathParser:n}=this,{currentPoint:i,rX:s,rY:a,sweepFlag:o,xAxisRotation:u,centp:d,a1:p,ad:_}=fi.pathA(n),w=1-o?1:-1,v=p+w*(_/2),M=new ws(d.x+s*Math.cos(v),d.y+a*Math.sin(v));if(n.addMarkerAngle(M,v-w*Math.PI/2),n.addMarkerAngle(i,v-w*Math.PI),t.addPoint(i.x,i.y),e&&!isNaN(p)&&!isNaN(_)){var P=s>a?s:a,D=s>a?1:s/a,N=s>a?a/s:1;e.translate(d.x,d.y),e.rotate(u),e.scale(D,N),e.arc(0,0,P,p,p+_,!!(1-o)),e.scale(1/D,1/N),e.rotate(-u),e.translate(-d.x,-d.y)}}static pathZ(e){e.current=e.start}pathZ(e,t){fi.pathZ(this.pathParser),e&&t.x1!==t.x2&&t.y1!==t.y2&&e.closePath()}}class R3 extends fi{constructor(e,t,n){super(e,t,n),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class Hh extends YA{constructor(e,t,n){super(e,t,new.target===Hh?!0:n),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(e,t);var n=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();n&&(e.textBaseline=n)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(e){if(this.type!=="text")return this.getTElementBoundingBox(e);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e);var t=null;return this.children.forEach((n,i)=>{var s=this.getChildBoundingBox(e,this,this,i);t?t.addBoundingBox(s):t=s}),t}getFontSize(){var{document:e,parent:t}=this,n=ya.parse(e.ctx.font).fontSize,i=t.getStyle("font-size").getNumber(n);return i}getTElementBoundingBox(e){var t=this.getFontSize();return new ac(this.x,this.y-t,this.x+this.measureText(e),this.y)}getGlyph(e,t,n){var i=t[n],s=null;if(e.isArabic){var a=t.length,o=t[n-1],u=t[n+1],d="isolated";if((n===0||o===" ")&&n<a-1&&u!==" "&&(d="terminal"),n>0&&o!==" "&&n<a-1&&u!==" "&&(d="medial"),n>0&&o!==" "&&(n===a-1||u===" ")&&(d="initial"),typeof e.glyphs[i]<"u"){var p=e.glyphs[i];s=p instanceof R3?p:p[d]}}else s=e.glyphs[i];return s||(s=e.missingGlyph),s}getText(){return""}getTextFromNode(e){var t=e||this.node,n=Array.from(t.parentNode.childNodes),i=n.indexOf(t),s=n.length-1,a=ud(t.textContent||"");return i===0&&(a=dQ(a)),i===s&&(a=pQ(a)),a}renderChildren(e){if(this.type!=="text"){this.renderTElementChildren(e);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e),this.children.forEach((n,i)=>{this.renderChild(e,this,this,i)});var{mouse:t}=this.document.screen;t.isWorking()&&t.checkBoundingBox(this,this.getBoundingBox(e))}renderTElementChildren(e){var{document:t,parent:n}=this,i=this.getText(),s=n.getStyle("font-family").getDefinition();if(s){for(var{unitsPerEm:a}=s.fontFace,o=ya.parse(t.ctx.font),u=n.getStyle("font-size").getNumber(o.fontSize),d=n.getStyle("font-style").getString(o.fontStyle),p=u/a,_=s.isRTL?i.split("").reverse().join(""):i,w=al(n.getAttribute("dx").getString()),v=_.length,M=0;M<v;M++){var P=this.getGlyph(s,_,M);e.translate(this.x,this.y),e.scale(p,-p);var D=e.lineWidth;e.lineWidth=e.lineWidth*a/u,d==="italic"&&e.transform(1,0,.4,1,0,0),P.render(e),d==="italic"&&e.transform(1,0,-.4,1,0,0),e.lineWidth=D,e.scale(1/p,-1/p),e.translate(-this.x,-this.y),this.x+=u*(P.horizAdvX||s.horizAdvX)/a,typeof w[M]<"u"&&!isNaN(w[M])&&(this.x+=w[M])}return}var{x:N,y:z}=this;e.fillStyle&&e.fillText(i,N,z),e.strokeStyle&&e.strokeText(i,N,z)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var e=this.leafTexts[this.textChunkStart],t=e.getStyle("text-anchor").getString("start"),n=!1,i=0;t==="start"||t==="end"&&n?i=e.x-this.minX:t==="end"||t==="start"&&n?i=e.x-this.maxX:i=e.x-(this.minX+this.maxX)/2;for(var s=this.textChunkStart;s<this.leafTexts.length;s++)this.leafTexts[s].x+=i;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(e){this.children.forEach((t,n)=>{this.adjustChildCoordinatesRecursiveCore(e,this,this,n)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(e,t,n,i){var s=n.children[i];s.children.length>0?s.children.forEach((a,o)=>{t.adjustChildCoordinatesRecursiveCore(e,t,s,o)}):this.adjustChildCoordinates(e,t,n,i)}adjustChildCoordinates(e,t,n,i){var s=n.children[i];if(typeof s.measureText!="function")return s;e.save(),s.setContext(e,!0);var a=s.getAttribute("x"),o=s.getAttribute("y"),u=s.getAttribute("dx"),d=s.getAttribute("dy"),p=s.getStyle("font-family").getDefinition(),_=!!p&&p.isRTL;i===0&&(a.hasValue()||a.setValue(s.getInheritedAttribute("x")),o.hasValue()||o.setValue(s.getInheritedAttribute("y")),u.hasValue()||u.setValue(s.getInheritedAttribute("dx")),d.hasValue()||d.setValue(s.getInheritedAttribute("dy")));var w=s.measureText(e);return _&&(t.x-=w),a.hasValue()?(t.applyAnchoring(),s.x=a.getPixels("x"),u.hasValue()&&(s.x+=u.getPixels("x"))):(u.hasValue()&&(t.x+=u.getPixels("x")),s.x=t.x),t.x=s.x,_||(t.x+=w),o.hasValue()?(s.y=o.getPixels("y"),d.hasValue()&&(s.y+=d.getPixels("y"))):(d.hasValue()&&(t.y+=d.getPixels("y")),s.y=t.y),t.y=s.y,t.leafTexts.push(s),t.minX=Math.min(t.minX,s.x,s.x+w),t.maxX=Math.max(t.maxX,s.x,s.x+w),s.clearContext(e),e.restore(),s}getChildBoundingBox(e,t,n,i){var s=n.children[i];if(typeof s.getBoundingBox!="function")return null;var a=s.getBoundingBox(e);return a?(s.children.forEach((o,u)=>{var d=t.getChildBoundingBox(e,t,s,u);a.addBoundingBox(d)}),a):null}renderChild(e,t,n,i){var s=n.children[i];s.render(e),s.children.forEach((a,o)=>{t.renderChild(e,t,s,o)})}measureText(e){var{measureCache:t}=this;if(~t)return t;var n=this.getText(),i=this.measureTargetText(e,n);return this.measureCache=i,i}measureTargetText(e,t){if(!t.length)return 0;var{parent:n}=this,i=n.getStyle("font-family").getDefinition();if(i){for(var s=this.getFontSize(),a=i.isRTL?t.split("").reverse().join(""):t,o=al(n.getAttribute("dx").getString()),u=a.length,d=0,p=0;p<u;p++){var _=this.getGlyph(i,a,p);d+=(_.horizAdvX||i.horizAdvX)*s/i.fontFace.unitsPerEm,typeof o[p]<"u"&&!isNaN(o[p])&&(d+=o[p])}return d}if(!e.measureText)return t.length*10;e.save(),this.setContext(e,!0);var{width:w}=e.measureText(t);return this.clearContext(e),e.restore(),w}getInheritedAttribute(e){for(var t=this;t instanceof Hh&&t.isFirstChild();){var n=t.parent.getAttribute(e);if(n.hasValue(!0))return n.getValue("0");t=t.parent}return null}}class Jm extends Hh{constructor(e,t,n){super(e,t,new.target===Jm?!0:n),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class sye extends Jm{constructor(){super(...arguments),this.type="textNode"}}class Kp extends YA{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(e){var t,{document:n}=this,{screen:i,window:s}=n,a=e.canvas;if(i.setDefaults(e),a.style&&typeof e.font<"u"&&s&&typeof s.getComputedStyle<"u"){e.font=s.getComputedStyle(a).getPropertyValue("font");var o=new rn(n,"fontSize",ya.parse(e.font).fontSize);o.hasValue()&&(n.rootEmSize=o.getPixels("y"),n.emSize=n.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:u,height:d}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var p=this.getAttribute("refX"),_=this.getAttribute("refY"),w=this.getAttribute("viewBox"),v=w.hasValue()?al(w.getString()):null,M=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",P=0,D=0,N=0,z=0;v&&(P=v[0],D=v[1]),this.root||(u=this.getStyle("width").getPixels("x"),d=this.getStyle("height").getPixels("y"),this.type==="marker"&&(N=P,z=D,P=0,D=0)),i.viewPort.setCurrent(u,d),this.node&&(!this.parent||((t=this.node.parentNode)===null||t===void 0?void 0:t.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(e),e.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),v&&(u=v[2],d=v[3]),n.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:u,height:i.viewPort.height,desiredHeight:d,minX:P,minY:D,refX:p.getValue(),refY:_.getValue(),clip:M,clipX:N,clipY:z}),v&&(i.viewPort.removeCurrent(),i.viewPort.setCurrent(u,d))}clearContext(e){super.clearContext(e),this.document.screen.viewPort.removeCurrent()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getAttribute("width",!0),s=this.getAttribute("height",!0),a=this.getAttribute("viewBox"),o=this.getAttribute("style"),u=i.getNumber(0),d=s.getNumber(0);if(n)if(typeof n=="string")this.getAttribute("preserveAspectRatio",!0).setValue(n);else{var p=this.getAttribute("preserveAspectRatio");p.hasValue()&&p.setValue(p.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(i.setValue(e),s.setValue(t),a.hasValue()||a.setValue("0 0 ".concat(u||e," ").concat(d||t)),o.hasValue()){var _=this.getStyle("width"),w=this.getStyle("height");_.hasValue()&&_.setValue("".concat(e,"px")),w.hasValue()&&w.setValue("".concat(t,"px"))}}}class L3 extends fi{constructor(){super(...arguments),this.type="rect"}path(e){var t=this.getAttribute("x").getPixels("x"),n=this.getAttribute("y").getPixels("y"),i=this.getStyle("width",!1,!0).getPixels("x"),s=this.getStyle("height",!1,!0).getPixels("y"),a=this.getAttribute("rx"),o=this.getAttribute("ry"),u=a.getPixels("x"),d=o.getPixels("y");if(a.hasValue()&&!o.hasValue()&&(d=u),o.hasValue()&&!a.hasValue()&&(u=d),u=Math.min(u,i/2),d=Math.min(d,s/2),e){var p=4*((Math.sqrt(2)-1)/3);e.beginPath(),s>0&&i>0&&(e.moveTo(t+u,n),e.lineTo(t+i-u,n),e.bezierCurveTo(t+i-u+p*u,n,t+i,n+d-p*d,t+i,n+d),e.lineTo(t+i,n+s-d),e.bezierCurveTo(t+i,n+s-d+p*d,t+i-u+p*u,n+s,t+i-u,n+s),e.lineTo(t+u,n+s),e.bezierCurveTo(t+u-p*u,n+s,t,n+s-d+p*d,t,n+s-d),e.lineTo(t,n+d),e.bezierCurveTo(t,n+d-p*d,t+u-p*u,n,t+u,n),e.closePath())}return new ac(t,n,t+i,n+s)}getMarkers(){return null}}class IQ extends fi{constructor(){super(...arguments),this.type="circle"}path(e){var t=this.getAttribute("cx").getPixels("x"),n=this.getAttribute("cy").getPixels("y"),i=this.getAttribute("r").getPixels();return e&&i>0&&(e.beginPath(),e.arc(t,n,i,0,Math.PI*2,!1),e.closePath()),new ac(t-i,n-i,t+i,n+i)}getMarkers(){return null}}class MQ extends fi{constructor(){super(...arguments),this.type="ellipse"}path(e){var t=4*((Math.sqrt(2)-1)/3),n=this.getAttribute("rx").getPixels("x"),i=this.getAttribute("ry").getPixels("y"),s=this.getAttribute("cx").getPixels("x"),a=this.getAttribute("cy").getPixels("y");return e&&n>0&&i>0&&(e.beginPath(),e.moveTo(s+n,a),e.bezierCurveTo(s+n,a+t*i,s+t*n,a+i,s,a+i),e.bezierCurveTo(s-t*n,a+i,s-n,a+t*i,s-n,a),e.bezierCurveTo(s-n,a-t*i,s-t*n,a-i,s,a-i),e.bezierCurveTo(s+t*n,a-i,s+n,a-t*i,s+n,a),e.closePath()),new ac(s-n,a-i,s+n,a+i)}getMarkers(){return null}}class PQ extends fi{constructor(){super(...arguments),this.type="line"}getPoints(){return[new ws(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new ws(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(e){var[{x:t,y:n},{x:i,y:s}]=this.getPoints();return e&&(e.beginPath(),e.moveTo(t,n),e.lineTo(i,s)),new ac(t,n,i,s)}getMarkers(){var[e,t]=this.getPoints(),n=e.angleTo(t);return[[e,n],[t,n]]}}class O3 extends fi{constructor(e,t,n){super(e,t,n),this.type="polyline",this.points=[],this.points=ws.parsePath(this.getAttribute("points").getString())}path(e){var{points:t}=this,[{x:n,y:i}]=t,s=new ac(n,i);return e&&(e.beginPath(),e.moveTo(n,i)),t.forEach(a=>{var{x:o,y:u}=a;s.addPoint(o,u),e&&e.lineTo(o,u)}),s}getMarkers(){var{points:e}=this,t=e.length-1,n=[];return e.forEach((i,s)=>{s!==t&&n.push([i,i.angleTo(e[s+1])])}),n.length>0&&n.push([e[e.length-1],n[n.length-1][1]]),n}}class FQ extends O3{constructor(){super(...arguments),this.type="polygon"}path(e){var t=super.path(e),[{x:n,y:i}]=this.points;return e&&(e.lineTo(n,i),e.closePath()),t}}class RQ extends Vi{constructor(){super(...arguments),this.type="pattern"}createPattern(e,t,n){var i=this.getStyle("width").getPixels("x",!0),s=this.getStyle("height").getPixels("y",!0),a=new Kp(this.document,null);a.attributes.viewBox=new rn(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.width=new rn(this.document,"width","".concat(i,"px")),a.attributes.height=new rn(this.document,"height","".concat(s,"px")),a.attributes.transform=new rn(this.document,"transform",this.getAttribute("patternTransform").getValue()),a.children=this.children;var o=this.document.createCanvas(i,s),u=o.getContext("2d"),d=this.getAttribute("x"),p=this.getAttribute("y");d.hasValue()&&p.hasValue()&&u.translate(d.getPixels("x",!0),p.getPixels("y",!0)),n.hasValue()?this.styles["fill-opacity"]=n:Reflect.deleteProperty(this.styles,"fill-opacity");for(var _=-1;_<=1;_++)for(var w=-1;w<=1;w++)u.save(),a.attributes.x=new rn(this.document,"x",_*o.width),a.attributes.y=new rn(this.document,"y",w*o.height),a.render(u),u.restore();var v=e.createPattern(o,"repeat");return v}}class LQ extends Vi{constructor(){super(...arguments),this.type="marker"}render(e,t,n){if(t){var{x:i,y:s}=t,a=this.getAttribute("orient").getString("auto"),o=this.getAttribute("markerUnits").getString("strokeWidth");e.translate(i,s),a==="auto"&&e.rotate(n),o==="strokeWidth"&&e.scale(e.lineWidth,e.lineWidth),e.save();var u=new Kp(this.document,null);u.type=this.type,u.attributes.viewBox=new rn(this.document,"viewBox",this.getAttribute("viewBox").getValue()),u.attributes.refX=new rn(this.document,"refX",this.getAttribute("refX").getValue()),u.attributes.refY=new rn(this.document,"refY",this.getAttribute("refY").getValue()),u.attributes.width=new rn(this.document,"width",this.getAttribute("markerWidth").getValue()),u.attributes.height=new rn(this.document,"height",this.getAttribute("markerHeight").getValue()),u.attributes.overflow=new rn(this.document,"overflow",this.getAttribute("overflow").getValue()),u.attributes.fill=new rn(this.document,"fill",this.getAttribute("fill").getColor("black")),u.attributes.stroke=new rn(this.document,"stroke",this.getAttribute("stroke").getValue("none")),u.children=this.children,u.render(e),e.restore(),o==="strokeWidth"&&e.scale(1/e.lineWidth,1/e.lineWidth),a==="auto"&&e.rotate(-n),e.translate(-i,-s)}}}class OQ extends Vi{constructor(){super(...arguments),this.type="defs"}render(){}}class Ab extends YA{constructor(){super(...arguments),this.type="g"}getBoundingBox(e){var t=new ac;return this.children.forEach(n=>{t.addBoundingBox(n.getBoundingBox(e))}),t}}class U3 extends Vi{constructor(e,t,n){super(e,t,n),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:i,children:s}=this;s.forEach(a=>{a.type==="stop"&&i.push(a)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(e,t,n){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var{stops:s}=i,a=this.getGradient(e,t);if(!a)return this.addParentOpacity(n,s[s.length-1].color);if(s.forEach(D=>{a.addColorStop(D.offset,this.addParentOpacity(n,D.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:o}=this,{MAX_VIRTUAL_PIXELS:u,viewPort:d}=o.screen,[p]=d.viewPorts,_=new L3(o,null);_.attributes.x=new rn(o,"x",-u/3),_.attributes.y=new rn(o,"y",-u/3),_.attributes.width=new rn(o,"width",u),_.attributes.height=new rn(o,"height",u);var w=new Ab(o,null);w.attributes.transform=new rn(o,"transform",this.getAttribute("gradientTransform").getValue()),w.children=[_];var v=new Kp(o,null);v.attributes.x=new rn(o,"x",0),v.attributes.y=new rn(o,"y",0),v.attributes.width=new rn(o,"width",p.width),v.attributes.height=new rn(o,"height",p.height),v.children=[w];var M=o.createCanvas(p.width,p.height),P=M.getContext("2d");return P.fillStyle=a,v.render(P),P.createPattern(M,"no-repeat")}return a}inheritStopContainer(e){this.attributesToInherit.forEach(t=>{!this.getAttribute(t).hasValue()&&e.getAttribute(t).hasValue()&&this.getAttribute(t,!0).setValue(e.getAttribute(t).getValue())})}addParentOpacity(e,t){if(e.hasValue()){var n=new rn(this.document,"color",t);return n.addOpacity(e).getColor()}return t}}class UQ extends U3{constructor(e,t,n){super(e,t,n),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(e,t){var n=this.getGradientUnits()==="objectBoundingBox",i=n?t.getBoundingBox(e):null;if(n&&!i)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var s=n?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),a=n?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),o=n?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),u=n?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return s===o&&a===u?null:e.createLinearGradient(s,a,o,u)}}class DQ extends U3{constructor(e,t,n){super(e,t,n),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(e,t){var n=this.getGradientUnits()==="objectBoundingBox",i=t.getBoundingBox(e);if(n&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var s=n?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),a=n?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),o=s,u=a;this.getAttribute("fx").hasValue()&&(o=n?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(u=n?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var d=n?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),p=this.getAttribute("fr").getPixels();return e.createRadialGradient(o,u,p,s,a,d)}}class NQ extends Vi{constructor(e,t,n){super(e,t,n),this.type="stop";var i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),s=this.getStyle("stop-opacity"),a=this.getStyle("stop-color",!0);a.getString()===""&&a.setValue("#000"),s.hasValue()&&(a=a.addOpacity(s)),this.offset=i,this.color=a.getColor()}}class fb extends Vi{constructor(e,t,n){super(e,t,n),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,e.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new rn(e,"values",null);var i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}getProperty(){var e=this.getAttribute("attributeType").getString(),t=this.getAttribute("attributeName").getString();return e==="CSS"?this.parent.getStyle(t,!0):this.parent.getAttribute(t,!0)}calcValue(){var{initialUnits:e}=this,{progress:t,from:n,to:i}=this.getProgress(),s=n.getNumber()+(i.getNumber()-n.getNumber())*t;return e==="%"&&(s*=100),"".concat(s).concat(e)}update(e){var{parent:t}=this,n=this.getProperty();if(this.initialValue||(this.initialValue=n.getString(),this.initialUnits=n.getUnits()),this.duration>this.maxDuration){var i=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(i==="freeze"&&!this.frozen)this.frozen=!0,t.animationFrozen=!0,t.animationFrozenValue=n.getString();else if(i==="remove"&&!this.removed)return this.removed=!0,n.setValue(t.animationFrozen?t.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=e;var s=!1;if(this.begin<this.duration){var a=this.calcValue(),o=this.getAttribute("type");if(o.hasValue()){var u=o.getString();a="".concat(u,"(").concat(a,")")}n.setValue(a),s=!0}return s}getProgress(){var{document:e,values:t}=this,n={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(t.hasValue()){var i=n.progress*(t.getValue().length-1),s=Math.floor(i),a=Math.ceil(i);n.from=new rn(e,"from",parseFloat(t.getValue()[s])),n.to=new rn(e,"to",parseFloat(t.getValue()[a])),n.progress=(i-s)/(a-s)}else n.from=this.from,n.to=this.to;return n}}class kQ extends fb{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:e,from:t,to:n}=this.getProgress(),i=new g3(t.getColor()),s=new g3(n.getColor());if(i.ok&&s.ok){var a=i.r+(s.r-i.r)*e,o=i.g+(s.g-i.g)*e,u=i.b+(s.b-i.b)*e;return"rgb(".concat(Math.floor(a),", ").concat(Math.floor(o),", ").concat(Math.floor(u),")")}return this.getAttribute("from").getColor()}}class QQ extends fb{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:e,from:t,to:n}=this.getProgress(),i=al(t.getString()),s=al(n.getString()),a=i.map((o,u)=>{var d=s[u];return o+(d-o)*e}).join(" ");return a}}class zQ extends Vi{constructor(e,t,n){super(e,t,n),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:i}=e,{children:s}=this;for(var a of s)switch(a.type){case"font-face":{this.fontFace=a;var o=a.getStyle("font-family");o.hasValue()&&(i[o.getString()]=this);break}case"missing-glyph":this.missingGlyph=a;break;case"glyph":{var u=a;u.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[u.unicode]>"u"&&(this.glyphs[u.unicode]={}),this.glyphs[u.unicode][u.arabicForm]=u):this.glyphs[u.unicode]=u;break}}}render(){}}class HQ extends Vi{constructor(e,t,n){super(e,t,n),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class VQ extends fi{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class jQ extends Hh{constructor(){super(...arguments),this.type="tref"}getText(){var e=this.getHrefAttribute().getDefinition();if(e){var t=e.children[0];if(t)return t.getText()}return""}}class $Q extends Hh{constructor(e,t,n){super(e,t,n),this.type="a";var{childNodes:i}=t,s=i[0],a=i.length>0&&Array.from(i).every(o=>o.nodeType===3);this.hasText=a,this.text=a?this.getTextFromNode(s):""}getText(){return this.text}renderChildren(e){if(this.hasText){super.renderChildren(e);var{document:t,x:n,y:i}=this,{mouse:s}=t.screen,a=new rn(t,"fontSize",ya.parse(t.ctx.font).fontSize);s.isWorking()&&s.checkBoundingBox(this,new ac(n,i-a.getPixels("y"),n+this.measureText(e),i))}else if(this.children.length>0){var o=new Ab(this.document,null);o.children=this.children,o.parent=this,o.render(e)}}onClick(){var{window:e}=this.document;e&&e.open(this.getHrefAttribute().getString())}onMouseMove(){var e=this.document.ctx;e.canvas.style.cursor="pointer"}}function GQ(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function db(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?GQ(Object(t),!0).forEach(function(n){u3(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):GQ(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class qQ extends Hh{constructor(e,t,n){super(e,t,n),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(i)}getText(){return this.text}path(e){var{dataArray:t}=this;e&&e.beginPath(),t.forEach(n=>{var{type:i,points:s}=n;switch(i){case xn.LINE_TO:e&&e.lineTo(s[0],s[1]);break;case xn.MOVE_TO:e&&e.moveTo(s[0],s[1]);break;case xn.CURVE_TO:e&&e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case xn.QUAD_TO:e&&e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case xn.ARC:{var[a,o,u,d,p,_,w,v]=s,M=u>d?u:d,P=u>d?1:u/d,D=u>d?d/u:1;e&&(e.translate(a,o),e.rotate(w),e.scale(P,D),e.arc(0,0,M,p,p+_,!!(1-v)),e.scale(1/P,1/D),e.rotate(-w),e.translate(-a,-o));break}case xn.CLOSE_PATH:e&&e.closePath();break}})}renderChildren(e){this.setTextData(e),e.save();var t=this.parent.getStyle("text-decoration").getString(),n=this.getFontSize(),{glyphInfo:i}=this,s=e.fillStyle;t==="underline"&&e.beginPath(),i.forEach((a,o)=>{var{p0:u,p1:d,rotation:p,text:_}=a;e.save(),e.translate(u.x,u.y),e.rotate(p),e.fillStyle&&e.fillText(_,0,0),e.strokeStyle&&e.strokeText(_,0,0),e.restore(),t==="underline"&&(o===0&&e.moveTo(u.x,u.y+n/8),e.lineTo(d.x,d.y+n/5))}),t==="underline"&&(e.lineWidth=n/20,e.strokeStyle=s,e.stroke(),e.closePath()),e.restore()}getLetterSpacingAt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[e]||0}findSegmentToFitChar(e,t,n,i,s,a,o,u,d){var p=a,_=this.measureText(e,u);u===" "&&t==="justify"&&n<i&&(_+=(i-n)/s),d>-1&&(p+=this.getLetterSpacingAt(d));var w=this.textHeight/20,v=this.getEquidistantPointOnPath(p,w,0),M=this.getEquidistantPointOnPath(p+_,w,0),P={p0:v,p1:M},D=v&&M?Math.atan2(M.y-v.y,M.x-v.x):0;if(o){var N=Math.cos(Math.PI/2+D)*o,z=Math.cos(-D)*o;P.p0=db(db({},v),{},{x:v.x+N,y:v.y+z}),P.p1=db(db({},M),{},{x:M.x+N,y:M.y+z})}return p+=_,{offset:p,segment:P,rotation:D}}measureText(e,t){var{measuresCache:n}=this,i=t||this.getText();if(n.has(i))return n.get(i);var s=this.measureTargetText(e,i);return n.set(i,s),s}setTextData(e){if(!this.glyphInfo){var t=this.getText(),n=t.split(""),i=t.split(" ").length-1,s=this.parent.getAttribute("dx").split().map(V=>V.getPixels("x")),a=this.parent.getAttribute("dy").getPixels("y"),o=this.parent.getStyle("text-anchor").getString("start"),u=this.getStyle("letter-spacing"),d=this.parent.getStyle("letter-spacing"),p=0;!u.hasValue()||u.getValue()==="inherit"?p=d.getPixels():u.hasValue()&&u.getValue()!=="initial"&&u.getValue()!=="unset"&&(p=u.getPixels());var _=[],w=t.length;this.letterSpacingCache=_;for(var v=0;v<w;v++)_.push(typeof s[v]<"u"?s[v]:p);var M=_.reduce((V,$,q)=>q===0?0:V+$||0,0),P=this.measureText(e),D=Math.max(P+M,0);this.textWidth=P,this.textHeight=this.getFontSize(),this.glyphInfo=[];var N=this.getPathLength(),z=this.getStyle("startOffset").getNumber(0)*N,W=0;(o==="middle"||o==="center")&&(W=-D/2),(o==="end"||o==="right")&&(W=-D),W+=z,n.forEach((V,$)=>{var{offset:q,segment:te,rotation:J}=this.findSegmentToFitChar(e,o,D,N,i,W,a,V,$);W=q,!(!te.p0||!te.p1)&&this.glyphInfo.push({text:n[$],p0:te.p0,p1:te.p1,rotation:J})})}}parsePathData(e){if(this.pathLength=-1,!e)return[];var t=[],{pathParser:n}=e;for(n.reset();!n.isEnd();){var{current:i}=n,s=i?i.x:0,a=i?i.y:0,o=n.next(),u=o.type,d=[];switch(o.type){case xn.MOVE_TO:this.pathM(n,d);break;case xn.LINE_TO:u=this.pathL(n,d);break;case xn.HORIZ_LINE_TO:u=this.pathH(n,d);break;case xn.VERT_LINE_TO:u=this.pathV(n,d);break;case xn.CURVE_TO:this.pathC(n,d);break;case xn.SMOOTH_CURVE_TO:u=this.pathS(n,d);break;case xn.QUAD_TO:this.pathQ(n,d);break;case xn.SMOOTH_QUAD_TO:u=this.pathT(n,d);break;case xn.ARC:d=this.pathA(n);break;case xn.CLOSE_PATH:fi.pathZ(n);break}o.type!==xn.CLOSE_PATH?t.push({type:u,points:d,start:{x:s,y:a},pathLength:this.calcLength(s,a,u,d)}):t.push({type:xn.CLOSE_PATH,points:[],pathLength:0})}return t}pathM(e,t){var{x:n,y:i}=fi.pathM(e).point;t.push(n,i)}pathL(e,t){var{x:n,y:i}=fi.pathL(e).point;return t.push(n,i),xn.LINE_TO}pathH(e,t){var{x:n,y:i}=fi.pathH(e).point;return t.push(n,i),xn.LINE_TO}pathV(e,t){var{x:n,y:i}=fi.pathV(e).point;return t.push(n,i),xn.LINE_TO}pathC(e,t){var{point:n,controlPoint:i,currentPoint:s}=fi.pathC(e);t.push(n.x,n.y,i.x,i.y,s.x,s.y)}pathS(e,t){var{point:n,controlPoint:i,currentPoint:s}=fi.pathS(e);return t.push(n.x,n.y,i.x,i.y,s.x,s.y),xn.CURVE_TO}pathQ(e,t){var{controlPoint:n,currentPoint:i}=fi.pathQ(e);t.push(n.x,n.y,i.x,i.y)}pathT(e,t){var{controlPoint:n,currentPoint:i}=fi.pathT(e);return t.push(n.x,n.y,i.x,i.y),xn.QUAD_TO}pathA(e){var{rX:t,rY:n,sweepFlag:i,xAxisRotation:s,centp:a,a1:o,ad:u}=fi.pathA(e);return i===0&&u>0&&(u-=2*Math.PI),i===1&&u<0&&(u+=2*Math.PI),[a.x,a.y,t,n,o,u,s,i]}calcLength(e,t,n,i){var s=0,a=null,o=null,u=0;switch(n){case xn.LINE_TO:return this.getLineLength(e,t,i[0],i[1]);case xn.CURVE_TO:for(s=0,a=this.getPointOnCubicBezier(0,e,t,i[0],i[1],i[2],i[3],i[4],i[5]),u=.01;u<=1;u+=.01)o=this.getPointOnCubicBezier(u,e,t,i[0],i[1],i[2],i[3],i[4],i[5]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case xn.QUAD_TO:for(s=0,a=this.getPointOnQuadraticBezier(0,e,t,i[0],i[1],i[2],i[3]),u=.01;u<=1;u+=.01)o=this.getPointOnQuadraticBezier(u,e,t,i[0],i[1],i[2],i[3]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case xn.ARC:{s=0;var d=i[4],p=i[5],_=i[4]+p,w=Math.PI/180;if(Math.abs(d-_)<w&&(w=Math.abs(d-_)),a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],d,0),p<0)for(u=d-w;u>_;u-=w)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;else for(u=d+w;u<_;u+=w)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],_,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),s}}return 0}getPointOnLine(e,t,n,i,s){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:t,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:n,u=(s-n)/(i-t+Ad),d=Math.sqrt(e*e/(1+u*u));i<t&&(d*=-1);var p=u*d,_=null;if(i===t)_={x:a,y:o+p};else if((o-n)/(a-t+Ad)===u)_={x:a+d,y:o+p};else{var w=0,v=0,M=this.getLineLength(t,n,i,s);if(M<Ad)return null;var P=(a-t)*(i-t)+(o-n)*(s-n);P/=M*M,w=t+P*(i-t),v=n+P*(s-n);var D=this.getLineLength(a,o,w,v),N=Math.sqrt(e*e-D*D);d=Math.sqrt(N*N/(1+u*u)),i<t&&(d*=-1),p=u*d,_={x:w+d,y:v+p}}return _}getPointOnPath(e){var t=this.getPathLength(),n=0,i=null;if(e<-5e-5||e-5e-5>t)return null;var{dataArray:s}=this;for(var a of s){if(a&&(a.pathLength<5e-5||n+a.pathLength+5e-5<e)){n+=a.pathLength;continue}var o=e-n,u=0;switch(a.type){case xn.LINE_TO:i=this.getPointOnLine(o,a.start.x,a.start.y,a.points[0],a.points[1],a.start.x,a.start.y);break;case xn.ARC:{var d=a.points[4],p=a.points[5],_=a.points[4]+p;if(u=d+o/a.pathLength*p,p<0&&u<_||p>=0&&u>_)break;i=this.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],u,a.points[6]);break}case xn.CURVE_TO:u=o/a.pathLength,u>1&&(u=1),i=this.getPointOnCubicBezier(u,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case xn.QUAD_TO:u=o/a.pathLength,u>1&&(u=1),i=this.getPointOnQuadraticBezier(u,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);break}if(i)return i;break}return null}getLineLength(e,t,n,i){return Math.sqrt((n-e)*(n-e)+(i-t)*(i-t))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((e,t)=>t.pathLength>0?e+t.pathLength:e,0)),this.pathLength}getPointOnCubicBezier(e,t,n,i,s,a,o,u,d){var p=u*B3(e)+a*C3(e)+i*T3(e)+t*E3(e),_=d*B3(e)+o*C3(e)+s*T3(e)+n*E3(e);return{x:p,y:_}}getPointOnQuadraticBezier(e,t,n,i,s,a,o){var u=a*S3(e)+i*I3(e)+t*M3(e),d=o*S3(e)+s*I3(e)+n*M3(e);return{x:u,y:d}}getPointOnEllipticalArc(e,t,n,i,s,a){var o=Math.cos(a),u=Math.sin(a),d={x:n*Math.cos(s),y:i*Math.sin(s)};return{x:e+(d.x*o-d.y*u),y:t+(d.x*u+d.y*o)}}buildEquidistantCache(e,t){var n=this.getPathLength(),i=t||.25,s=e||n/100;if(!this.equidistantCache||this.equidistantCache.step!==s||this.equidistantCache.precision!==i){this.equidistantCache={step:s,precision:i,points:[]};for(var a=0,o=0;o<=n;o+=i){var u=this.getPointOnPath(o),d=this.getPointOnPath(o+i);!u||!d||(a+=this.getLineLength(u.x,u.y,d.x,d.y),a>=s&&(this.equidistantCache.points.push({x:u.x,y:u.y,distance:o}),a-=s))}}}getEquidistantPointOnPath(e,t,n){if(this.buildEquidistantCache(t,n),e<0||e-this.getPathLength()>5e-5)return null;var i=Math.round(e/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}}var oye=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class KQ extends YA{constructor(e,t,n){super(e,t,n),this.type="image",this.loaded=!1;var i=this.getHrefAttribute().getString();if(i){var s=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);e.images.push(this),s?this.loadSvg(i):this.loadImage(i),this.isSvg=s}}loadImage(e){var t=this;return Qh(function*(){try{var n=yield t.document.createImage(e);t.image=n}catch(i){console.error('Error while loading image "'.concat(e,'":'),i)}t.loaded=!0})()}loadSvg(e){var t=this;return Qh(function*(){var n=oye.exec(e);if(n){var i=n[5];n[4]==="base64"?t.image=atob(i):t.image=decodeURIComponent(i)}else try{var s=yield t.document.fetch(e),a=yield s.text();t.image=a}catch(o){console.error('Error while loading image "'.concat(e,'":'),o)}t.loaded=!0})()}renderChildren(e){var{document:t,image:n,loaded:i}=this,s=this.getAttribute("x").getPixels("x"),a=this.getAttribute("y").getPixels("y"),o=this.getStyle("width").getPixels("x"),u=this.getStyle("height").getPixels("y");if(!(!i||!n||!o||!u)){if(e.save(),e.translate(s,a),this.isSvg){var d=t.canvg.forkString(e,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:o,scaleHeight:u});d.document.documentElement.parent=this,d.render()}else{var p=this.image;t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:o,desiredWidth:p.width,height:u,desiredHeight:p.height}),this.loaded&&(typeof p.complete>"u"||p.complete)&&e.drawImage(p,0,0)}e.restore()}}getBoundingBox(){var e=this.getAttribute("x").getPixels("x"),t=this.getAttribute("y").getPixels("y"),n=this.getStyle("width").getPixels("x"),i=this.getStyle("height").getPixels("y");return new ac(e,t,e+n,t+i)}}class WQ extends YA{constructor(){super(...arguments),this.type="symbol"}render(e){}}class XQ{constructor(e){this.document=e,this.loaded=!1,e.fonts.push(this)}load(e,t){var n=this;return Qh(function*(){try{var{document:i}=n,s=yield i.canvg.parser.load(t),a=s.getElementsByTagName("font");Array.from(a).forEach(o=>{var u=i.createElement(o);i.definitions[e]=u})}catch(o){console.error('Error while loading font "'.concat(t,'":'),o)}n.loaded=!0})()}}class D3 extends Vi{constructor(e,t,n){super(e,t,n),this.type="style";var i=ud(Array.from(t.childNodes).map(a=>a.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),s=i.split("}");s.forEach(a=>{var o=a.trim();if(o){var u=o.split("{"),d=u[0].split(","),p=u[1].split(";");d.forEach(_=>{var w=_.trim();if(w){var v=e.styles[w]||{};if(p.forEach(D=>{var N=D.indexOf(":"),z=D.substr(0,N).trim(),W=D.substr(N+1,D.length-N).trim();z&&W&&(v[z]=new rn(e,z,W))}),e.styles[w]=v,e.stylesSpecificity[w]=_Q(w),w==="@font-face"){var M=v["font-family"].getString().replace(/"|'/g,""),P=v.src.getString().split(",");P.forEach(D=>{if(D.indexOf('format("svg")')>0){var N=v3(D);N&&new XQ(e).load(M,N)}})}}})}})}}D3.parseExternalUrl=v3;class YQ extends YA{constructor(){super(...arguments),this.type="use"}setContext(e){super.setContext(e);var t=this.getAttribute("x"),n=this.getAttribute("y");t.hasValue()&&e.translate(t.getPixels("x"),0),n.hasValue()&&e.translate(0,n.getPixels("y"))}path(e){var{element:t}=this;t&&t.path(e)}renderChildren(e){var{document:t,element:n}=this;if(n){var i=n;if(n.type==="symbol"&&(i=new Kp(t,null),i.attributes.viewBox=new rn(t,"viewBox",n.getAttribute("viewBox").getString()),i.attributes.preserveAspectRatio=new rn(t,"preserveAspectRatio",n.getAttribute("preserveAspectRatio").getString()),i.attributes.overflow=new rn(t,"overflow",n.getAttribute("overflow").getString()),i.children=n.children,n.styles.opacity=new rn(t,"opacity",this.calculateOpacity())),i.type==="svg"){var s=this.getStyle("width",!1,!0),a=this.getStyle("height",!1,!0);s.hasValue()&&(i.attributes.width=new rn(t,"width",s.getString())),a.hasValue()&&(i.attributes.height=new rn(t,"height",a.getString()))}var o=i.parent;i.parent=this,i.render(e),i.parent=o}}getBoundingBox(e){var{element:t}=this;return t?t.getBoundingBox(e):null}elementTransform(){var{document:e,element:t}=this;return XA.fromElement(e,t)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function pb(r,e,t,n,i,s){return r[t*n*4+e*4+s]}function gb(r,e,t,n,i,s,a){r[t*n*4+e*4+s]=a}function so(r,e,t){var n=r[e];return n*t}function Vh(r,e,t,n){return e+Math.cos(r)*t+Math.sin(r)*n}class N3 extends Vi{constructor(e,t,n){super(e,t,n),this.type="feColorMatrix";var i=al(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var s=i[0];i=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var a=i[0]*Math.PI/180;i=[Vh(a,.213,.787,-.213),Vh(a,.715,-.715,-.715),Vh(a,.072,-.072,.928),0,0,Vh(a,.213,-.213,.143),Vh(a,.715,.285,.14),Vh(a,.072,-.072,-.283),0,0,Vh(a,.213,-.213,-.787),Vh(a,.715,-.715,.715),Vh(a,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=i,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(e,t,n,i,s){for(var{includeOpacity:a,matrix:o}=this,u=e.getImageData(0,0,i,s),d=0;d<s;d++)for(var p=0;p<i;p++){var _=pb(u.data,p,d,i,s,0),w=pb(u.data,p,d,i,s,1),v=pb(u.data,p,d,i,s,2),M=pb(u.data,p,d,i,s,3),P=so(o,0,_)+so(o,1,w)+so(o,2,v)+so(o,3,M)+so(o,4,1),D=so(o,5,_)+so(o,6,w)+so(o,7,v)+so(o,8,M)+so(o,9,1),N=so(o,10,_)+so(o,11,w)+so(o,12,v)+so(o,13,M)+so(o,14,1),z=so(o,15,_)+so(o,16,w)+so(o,17,v)+so(o,18,M)+so(o,19,1);a&&(P=0,D=0,N=0,z*=M/255),gb(u.data,p,d,i,s,0,P),gb(u.data,p,d,i,s,1,D),gb(u.data,p,d,i,s,2,N),gb(u.data,p,d,i,s,3,z)}e.clearRect(0,0,i,s),e.putImageData(u,0,0)}}class e_ extends Vi{constructor(){super(...arguments),this.type="mask"}apply(e,t){var{document:n}=this,i=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y");if(!a&&!o){var u=new ac;this.children.forEach(M=>{u.addBoundingBox(M.getBoundingBox(e))}),i=Math.floor(u.x1),s=Math.floor(u.y1),a=Math.floor(u.width),o=Math.floor(u.height)}var d=this.removeStyles(t,e_.ignoreStyles),p=n.createCanvas(i+a,s+o),_=p.getContext("2d");n.screen.setDefaults(_),this.renderChildren(_),new N3(n,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(_,0,0,i+a,s+o);var w=n.createCanvas(i+a,s+o),v=w.getContext("2d");n.screen.setDefaults(v),t.render(v),v.globalCompositeOperation="destination-in",v.fillStyle=_.createPattern(p,"no-repeat"),v.fillRect(0,0,i+a,s+o),e.fillStyle=v.createPattern(w,"no-repeat"),e.fillRect(0,0,i+a,s+o),this.restoreStyles(t,d)}render(e){}}e_.ignoreStyles=["mask","transform","clip-path"];var ZQ=()=>{};class JQ extends Vi{constructor(){super(...arguments),this.type="clipPath"}apply(e){var{document:t}=this,n=Reflect.getPrototypeOf(e),{beginPath:i,closePath:s}=e;n&&(n.beginPath=ZQ,n.closePath=ZQ),Reflect.apply(i,e,[]),this.children.forEach(a=>{if(!(typeof a.path>"u")){var o=typeof a.elementTransform<"u"?a.elementTransform():null;o||(o=XA.fromElement(t,a)),o&&o.apply(e),a.path(e),n&&(n.closePath=s),o&&o.unapply(e)}}),Reflect.apply(s,e,[]),e.clip(),n&&(n.beginPath=i,n.closePath=s)}render(e){}}class t_ extends Vi{constructor(){super(...arguments),this.type="filter"}apply(e,t){var{document:n,children:i}=this,s=t.getBoundingBox(e);if(s){var a=0,o=0;i.forEach(N=>{var z=N.extraFilterDistance||0;a=Math.max(a,z),o=Math.max(o,z)});var u=Math.floor(s.width),d=Math.floor(s.height),p=u+2*a,_=d+2*o;if(!(p<1||_<1)){var w=Math.floor(s.x),v=Math.floor(s.y),M=this.removeStyles(t,t_.ignoreStyles),P=n.createCanvas(p,_),D=P.getContext("2d");n.screen.setDefaults(D),D.translate(-w+a,-v+o),t.render(D),i.forEach(N=>{typeof N.apply=="function"&&N.apply(D,0,0,p,_)}),e.drawImage(P,0,0,p,_,w-a,v-o,p,_),this.restoreStyles(t,M)}}}render(e){}}t_.ignoreStyles=["filter","transform","clip-path"];class ez extends Vi{constructor(e,t,n){super(e,t,n),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(e,t,n,i,s){}}class tz extends Vi{constructor(){super(...arguments),this.type="feMorphology"}apply(e,t,n,i,s){}}class rz extends Vi{constructor(){super(...arguments),this.type="feComposite"}apply(e,t,n,i,s){}}class nz extends Vi{constructor(e,t,n){super(e,t,n),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(e,t,n,i,s){var{document:a,blurRadius:o}=this,u=a.window?a.window.document.body:null,d=e.canvas;d.id=a.getUniqueId(),u&&(d.style.display="none",u.appendChild(d)),N_e(d,t,n,i,s,o),u&&u.removeChild(d)}}class iz extends Vi{constructor(){super(...arguments),this.type="title"}}class sz extends Vi{constructor(){super(...arguments),this.type="desc"}}var aye={svg:Kp,rect:L3,circle:IQ,ellipse:MQ,line:PQ,polyline:O3,polygon:FQ,path:fi,pattern:RQ,marker:LQ,defs:OQ,linearGradient:UQ,radialGradient:DQ,stop:NQ,animate:fb,animateColor:kQ,animateTransform:QQ,font:zQ,"font-face":HQ,"missing-glyph":VQ,glyph:R3,text:Hh,tspan:Jm,tref:jQ,a:$Q,textPath:qQ,image:KQ,g:Ab,symbol:WQ,style:D3,use:YQ,mask:e_,clipPath:JQ,filter:t_,feDropShadow:ez,feMorphology:tz,feComposite:rz,feColorMatrix:N3,feGaussianBlur:nz,title:iz,desc:sz};function oz(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function lye(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?oz(Object(t),!0).forEach(function(n){u3(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):oz(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function cye(r,e){var t=document.createElement("canvas");return t.width=r,t.height=e,t}function uye(r){return k3.apply(this,arguments)}function k3(){return k3=Qh(function*(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=document.createElement("img");return e&&(t.crossOrigin="Anonymous"),new Promise((n,i)=>{t.onload=()=>{n(t)},t.onerror=(s,a,o,u,d)=>{i(d)},t.src=r})}),k3.apply(this,arguments)}class jh{constructor(e){var{rootEmSize:t=12,emSize:n=12,createCanvas:i=jh.createCanvas,createImage:s=jh.createImage,anonymousCrossOrigin:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=e,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=e.screen,this.rootEmSize=t,this.emSize=n,this.createCanvas=i,this.createImage=this.bindCreateImage(s,a),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(e,t){return typeof t=="boolean"?(n,i)=>e(n,typeof i=="boolean"?i:t):e}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:e}=this;return e[e.length-1]}set emSize(e){var{emSizeStack:t}=this;t.push(e)}popEmSize(){var{emSizeStack:e}=this;e.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(e=>e.loaded)}isFontsLoaded(){return this.fonts.every(e=>e.loaded)}createDocumentElement(e){var t=this.createElement(e.documentElement);return t.root=!0,t.addStylesFromStyleDefinition(),this.documentElement=t,t}createElement(e){var t=e.nodeName.replace(/^[^:]+:/,""),n=jh.elementTypes[t];return typeof n<"u"?new n(this,e):new SQ(this,e)}createTextNode(e){return new sye(this,e)}setViewBox(e){this.screen.setViewBox(lye({document:this},e))}}jh.createCanvas=cye,jh.createImage=uye,jh.elementTypes=aye;function az(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function fd(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?az(Object(t),!0).forEach(function(n){u3(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):az(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class dd{constructor(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new hb(n),this.screen=new Zm(e,n),this.options=n;var i=new jh(this,n),s=i.createDocumentElement(t);this.document=i,this.documentElement=s}static from(e,t){var n=arguments;return Qh(function*(){var i=n.length>2&&n[2]!==void 0?n[2]:{},s=new hb(i),a=yield s.parse(t);return new dd(e,a,i)})()}static fromString(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=new hb(n),s=i.parseFromString(t);return new dd(e,s,n)}fork(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return dd.from(e,t,fd(fd({},this.options),n))}forkString(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return dd.fromString(e,t,fd(fd({},this.options),n))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var e=arguments,t=this;return Qh(function*(){var n=e.length>0&&e[0]!==void 0?e[0]:{};t.start(fd({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},n)),yield t.ready(),t.stop()})()}start(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:t,screen:n,options:i}=this;n.start(t,fd(fd({enableRedraw:!0},i),e))}stop(){this.screen.stop()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(e,t,n)}}const hye=Object.freeze(Object.defineProperty({__proto__:null,AElement:$Q,AnimateColorElement:kQ,AnimateElement:fb,AnimateTransformElement:QQ,BoundingBox:ac,CB1:B3,CB2:C3,CB3:T3,CB4:E3,Canvg:dd,CircleElement:IQ,ClipPathElement:JQ,DefsElement:OQ,DescElement:sz,Document:jh,Element:Vi,EllipseElement:MQ,FeColorMatrixElement:N3,FeCompositeElement:rz,FeDropShadowElement:ez,FeGaussianBlurElement:nz,FeMorphologyElement:tz,FilterElement:t_,Font:ya,FontElement:zQ,FontFaceElement:HQ,GElement:Ab,GlyphElement:R3,GradientElement:U3,ImageElement:KQ,LineElement:PQ,LinearGradientElement:UQ,MarkerElement:LQ,MaskElement:e_,Matrix:P3,MissingGlyphElement:VQ,Mouse:bQ,PSEUDO_ZERO:Ad,Parser:hb,PathElement:fi,PathParser:xn,PatternElement:RQ,Point:ws,PolygonElement:FQ,PolylineElement:O3,Property:rn,QB1:S3,QB2:I3,QB3:M3,RadialGradientElement:DQ,RectElement:L3,RenderedElement:YA,Rotate:BQ,SVGElement:Kp,SVGFontLoader:XQ,Scale:CQ,Screen:Zm,Skew:F3,SkewX:TQ,SkewY:EQ,StopElement:NQ,StyleElement:D3,SymbolElement:WQ,TRefElement:jQ,TSpanElement:Jm,TextElement:Hh,TextPathElement:qQ,TitleElement:iz,Transform:XA,Translate:xQ,UnknownElement:SQ,UseElement:YQ,ViewPort:yQ,compressSpaces:ud,default:dd,getSelectorSpecificity:_Q,normalizeAttributeName:gQ,normalizeColor:mQ,parseExternalUrl:v3,presets:H_e,toNumbers:al,trimLeft:dQ,trimRight:pQ,vectorMagnitude:w3,vectorsAngle:x3,vectorsRatio:ub},Symbol.toStringTag,{value:"Module"}));Ja.CompareMaps=rhe,Ja.Config=IO,Ja.Map=Xue,Object.defineProperty(Ja,Symbol.toStringTag,{value:"Module"})});
