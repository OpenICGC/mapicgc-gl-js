(function(Rh,Om){typeof exports=="object"&&typeof module<"u"?Om(exports):typeof define=="function"&&define.amd?define(["exports"],Om):(Rh=typeof globalThis<"u"?globalThis:Rh||self,Om(Rh.mapicgcgl={}))})(this,function(Rh){"use strict";function Om(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in i)){const o=Object.getOwnPropertyDescriptor(r,n);o&&Object.defineProperty(i,n,o.get?o:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}var cf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Um(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var zI={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(cf,function(){var t={},r={};function n(l,s,g){if(r[l]=g,l==="index"){var v="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",T={};return r.shared(T),r.index(t,T),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),t}}n("shared",["exports"],function(l){function s(f,u,m,C){return new(m||(m=Promise))(function(D,Q){function H(de){try{re(C.next(de))}catch(h){Q(h)}}function Z(de){try{re(C.throw(de))}catch(h){Q(h)}}function re(de){var h;de.done?D(de.value):(h=de.value,h instanceof m?h:new m(function(c){c(h)})).then(H,Z)}re((C=C.apply(f,u||[])).next())})}function g(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}typeof SuppressedError=="function"&&SuppressedError;var v=T;function T(f,u){this.x=f,this.y=u}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(f){return this.clone()._add(f)},sub:function(f){return this.clone()._sub(f)},multByPoint:function(f){return this.clone()._multByPoint(f)},divByPoint:function(f){return this.clone()._divByPoint(f)},mult:function(f){return this.clone()._mult(f)},div:function(f){return this.clone()._div(f)},rotate:function(f){return this.clone()._rotate(f)},rotateAround:function(f,u){return this.clone()._rotateAround(f,u)},matMult:function(f){return this.clone()._matMult(f)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(f){return this.x===f.x&&this.y===f.y},dist:function(f){return Math.sqrt(this.distSqr(f))},distSqr:function(f){var u=f.x-this.x,m=f.y-this.y;return u*u+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(f){return Math.atan2(this.y-f.y,this.x-f.x)},angleWith:function(f){return this.angleWithSep(f.x,f.y)},angleWithSep:function(f,u){return Math.atan2(this.x*u-this.y*f,this.x*f+this.y*u)},_matMult:function(f){var u=f[2]*this.x+f[3]*this.y;return this.x=f[0]*this.x+f[1]*this.y,this.y=u,this},_add:function(f){return this.x+=f.x,this.y+=f.y,this},_sub:function(f){return this.x-=f.x,this.y-=f.y,this},_mult:function(f){return this.x*=f,this.y*=f,this},_div:function(f){return this.x/=f,this.y/=f,this},_multByPoint:function(f){return this.x*=f.x,this.y*=f.y,this},_divByPoint:function(f){return this.x/=f.x,this.y/=f.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var f=this.y;return this.y=this.x,this.x=-f,this},_rotate:function(f){var u=Math.cos(f),m=Math.sin(f),C=m*this.x+u*this.y;return this.x=u*this.x-m*this.y,this.y=C,this},_rotateAround:function(f,u){var m=Math.cos(f),C=Math.sin(f),D=u.y+C*(this.x-u.x)+m*(this.y-u.y);return this.x=u.x+m*(this.x-u.x)-C*(this.y-u.y),this.y=D,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(f){return f instanceof T?f:Array.isArray(f)?new T(f[0],f[1]):f};var F=g(v),R=U;function U(f,u,m,C){this.cx=3*f,this.bx=3*(m-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=u,this.p2x=m,this.p2y=C}U.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,u){if(u===void 0&&(u=1e-6),f<0)return 0;if(f>1)return 1;for(var m=f,C=0;C<8;C++){var D=this.sampleCurveX(m)-f;if(Math.abs(D)<u)return m;var Q=this.sampleCurveDerivativeX(m);if(Math.abs(Q)<1e-6)break;m-=D/Q}var H=0,Z=1;for(m=f,C=0;C<20&&(D=this.sampleCurveX(m),!(Math.abs(D-f)<u));C++)f>D?H=m:Z=m,m=.5*(Z-H)+H;return m},solve:function(f,u){return this.sampleCurveY(this.solveCurveX(f,u))}};var J=g(R);let te,Ae;function he(){return te==null&&(te=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),te}function pe(){if(Ae==null&&(Ae=!1,he())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let C=0;C<5*5;C++){const D=4*C;u.fillStyle=`rgb(${D},${D+1},${D+2})`,u.fillRect(C%5,Math.floor(C/5),1,1)}const m=u.getImageData(0,0,5,5).data;for(let C=0;C<5*5*4;C++)if(C%4!=3&&m[C]!==C){Ae=!0;break}}}return Ae||!1}function be(f,u,m,C){const D=new J(f,u,m,C);return function(Q){return D.solve(Q)}}const Te=be(.25,.1,.25,1);function qe(f,u,m){return Math.min(m,Math.max(u,f))}function je(f,u,m){const C=m-u,D=((f-u)%C+C)%C+u;return D===u?m:D}function We(f){for(var u=arguments.length,m=new Array(u>1?u-1:0),C=1;C<u;C++)m[C-1]=arguments[C];for(const D of m)for(const Q in D)f[Q]=D[Q];return f}let Ne=1;function at(f,u,m){const C={};for(const D in f)C[D]=u.call(m||this,f[D],D,f);return C}function nt(f,u,m){const C={};for(const D in f)u.call(m||this,f[D],D,f)&&(C[D]=f[D]);return C}function ke(f){return Array.isArray(f)?f.map(ke):typeof f=="object"&&f?at(f,ke):f}const De={};function Ye(f){De[f]||(typeof console<"u"&&console.warn(f),De[f]=!0)}function Ze(f,u,m){return(m.y-f.y)*(u.x-f.x)>(u.y-f.y)*(m.x-f.x)}function Ct(f){let u=0;for(let m,C,D=0,Q=f.length,H=Q-1;D<Q;H=D++)m=f[D],C=f[H],u+=(C.x-m.x)*(m.y+C.y);return u}function Et(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let Pt=null;function bt(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}const Rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ft(f,u,m,C,D){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const Q=new VideoFrame(f,{timestamp:0});try{const H=Q==null?void 0:Q.format;if(!H||!H.startsWith("BGR")&&!H.startsWith("RGB"))throw new Error(`Unrecognized format ${H}`);const Z=H.startsWith("BGR"),re=new Uint8ClampedArray(C*D*4);if(yield Q.copyTo(re,function(de,h,c,d,_){const S=4*Math.max(-h,0),M=(Math.max(0,c)-c)*d*4+S,k=4*d,G=Math.max(0,h),W=Math.max(0,c);return{rect:{x:G,y:W,width:Math.min(de.width,h+d)-G,height:Math.min(de.height,c+_)-W},layout:[{offset:M,stride:k}]}}(f,u,m,C,D)),Z)for(let de=0;de<re.length;de+=4){const h=re[de];re[de]=re[de+2],re[de+2]=h}return re}finally{Q.close()}})}let Xt,Le;const Xe="AbortError";function it(){return new Error(Xe)}const pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function mt(f){return pt.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}const Bt="global-dispatcher";class Dt extends Error{constructor(u,m,C,D){super(`AJAXError: ${m} (${u}): ${C}`),this.status=u,this.statusText=m,this.url=C,this.body=D}}const Mt=()=>Et(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,qt=function(f,u){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){const C=mt(f.url);if(C)return C(f,u);if(Et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:f,targetMapId:Bt},u)}if(!(/^file:/.test(m=f.url)||/^file:/.test(Mt())&&!/^\w+:/.test(m))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(C,D){return s(this,void 0,void 0,function*(){const Q=new Request(C.url,{method:C.method||"GET",body:C.body,credentials:C.credentials,headers:C.headers,cache:C.cache,referrer:Mt(),signal:D.signal});C.type==="json"&&Q.headers.set("Accept","application/json");const H=yield fetch(Q);if(!H.ok){const de=yield H.blob();throw new Dt(H.status,H.statusText,C.url,de)}let Z;Z=C.type==="arrayBuffer"||C.type==="image"?H.arrayBuffer():C.type==="json"?H.json():H.text();const re=yield Z;if(D.signal.aborted)throw it();return{data:re,cacheControl:H.headers.get("Cache-Control"),expires:H.headers.get("Expires")}})}(f,u);if(Et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:f,mustQueue:!0,targetMapId:Bt},u)}var m;return function(C,D){return new Promise((Q,H)=>{const Z=new XMLHttpRequest;Z.open(C.method||"GET",C.url,!0),C.type!=="arrayBuffer"&&C.type!=="image"||(Z.responseType="arraybuffer");for(const re in C.headers)Z.setRequestHeader(re,C.headers[re]);C.type==="json"&&(Z.responseType="text",Z.setRequestHeader("Accept","application/json")),Z.withCredentials=C.credentials==="include",Z.onerror=()=>{H(new Error(Z.statusText))},Z.onload=()=>{if(!D.signal.aborted)if((Z.status>=200&&Z.status<300||Z.status===0)&&Z.response!==null){let re=Z.response;if(C.type==="json")try{re=JSON.parse(Z.response)}catch(de){return void H(de)}Q({data:re,cacheControl:Z.getResponseHeader("Cache-Control"),expires:Z.getResponseHeader("Expires")})}else{const re=new Blob([Z.response],{type:Z.getResponseHeader("Content-Type")});H(new Dt(Z.status,Z.statusText,C.url,re))}},D.signal.addEventListener("abort",()=>{Z.abort(),H(it())}),Z.send(C.body)})}(f,u)};function ni(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;const u=new URL(f),m=window.location;return u.protocol===m.protocol&&u.host===m.host}function _i(f,u,m){m[f]&&m[f].indexOf(u)!==-1||(m[f]=m[f]||[],m[f].push(u))}function vi(f,u,m){if(m&&m[f]){const C=m[f].indexOf(u);C!==-1&&m[f].splice(C,1)}}class Pi{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};We(this,m),this.type=u}}class kt extends Pi{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",We({error:u},m))}}class lt{on(u,m){return this._listeners=this._listeners||{},_i(u,m,this._listeners),this}off(u,m){return vi(u,m,this._listeners),vi(u,m,this._oneTimeListeners),this}once(u,m){return m?(this._oneTimeListeners=this._oneTimeListeners||{},_i(u,m,this._oneTimeListeners),this):new Promise(C=>this.once(u,C))}fire(u,m){typeof u=="string"&&(u=new Pi(u,m||{}));const C=u.type;if(this.listens(C)){u.target=this;const D=this._listeners&&this._listeners[C]?this._listeners[C].slice():[];for(const Z of D)Z.call(this,u);const Q=this._oneTimeListeners&&this._oneTimeListeners[C]?this._oneTimeListeners[C].slice():[];for(const Z of Q)vi(C,Z,this._oneTimeListeners),Z.call(this,u);const H=this._eventedParent;H&&(We(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),H.fire(u))}else u instanceof kt&&console.error(u.error);return this}listens(u){return this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u)}setEventedParent(u,m){return this._eventedParent=u,this._eventedParentData=m,this}}var wt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Oi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ti(f,u){const m={};for(const C in f)C!=="ref"&&(m[C]=f[C]);return Oi.forEach(C=>{C in u&&(m[C]=u[C])}),m}function ht(f,u){if(Array.isArray(f)){if(!Array.isArray(u)||f.length!==u.length)return!1;for(let m=0;m<f.length;m++)if(!ht(f[m],u[m]))return!1;return!0}if(typeof f=="object"&&f!==null&&u!==null){if(typeof u!="object"||Object.keys(f).length!==Object.keys(u).length)return!1;for(const m in f)if(!ht(f[m],u[m]))return!1;return!0}return f===u}function $t(f,u){f.push(u)}function oi(f,u,m){$t(m,{command:"addSource",args:[f,u[f]]})}function gi(f,u,m){$t(u,{command:"removeSource",args:[f]}),m[f]=!0}function ci(f,u,m,C){gi(f,m,C),oi(f,u,m)}function Ki(f,u,m){let C;for(C in f[m])if(Object.prototype.hasOwnProperty.call(f[m],C)&&C!=="data"&&!ht(f[m][C],u[m][C]))return!1;for(C in u[m])if(Object.prototype.hasOwnProperty.call(u[m],C)&&C!=="data"&&!ht(f[m][C],u[m][C]))return!1;return!0}function tr(f,u,m,C,D,Q){f=f||{},u=u||{};for(const H in f)Object.prototype.hasOwnProperty.call(f,H)&&(ht(f[H],u[H])||m.push({command:Q,args:[C,H,u[H],D]}));for(const H in u)Object.prototype.hasOwnProperty.call(u,H)&&!Object.prototype.hasOwnProperty.call(f,H)&&(ht(f[H],u[H])||m.push({command:Q,args:[C,H,u[H],D]}))}function pr(f){return f.id}function Mr(f,u){return f[u.id]=u,f}class zt{constructor(u,m,C,D){this.message=(u?`${u}: `:"")+C,D&&(this.identifier=D),m!=null&&m.__line__&&(this.line=m.__line__)}}function Wi(f){for(var u=arguments.length,m=new Array(u>1?u-1:0),C=1;C<u;C++)m[C-1]=arguments[C];for(const D of m)for(const Q in D)f[Q]=D[Q];return f}class hi extends Error{constructor(u,m){super(m),this.message=m,this.key=u}}class Wt{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=u,this.bindings={};for(const[C,D]of m)this.bindings[C]=D}concat(u){return new Wt(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}const Ar={kind:"null"},Qt={kind:"number"},Si={kind:"string"},Ii={kind:"boolean"},Zt={kind:"color"},bi={kind:"object"},ei={kind:"value"},_r={kind:"collator"},Zr={kind:"formatted"},Qe={kind:"padding"},Be={kind:"resolvedImage"},ce={kind:"variableAnchorOffsetCollection"};function ie(f,u){return{kind:"array",itemType:f,N:u}}function ue(f){if(f.kind==="array"){const u=ue(f.itemType);return typeof f.N=="number"?`array<${u}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${u}>`}return f.kind}const ge=[Ar,Qt,Si,Ii,Zt,Zr,bi,ie(ei),Qe,Be,ce];function xe(f,u){if(u.kind==="error")return null;if(f.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!xe(f.itemType,u.itemType))&&(typeof f.N!="number"||f.N===u.N))return null}else{if(f.kind===u.kind)return null;if(f.kind==="value"){for(const m of ge)if(!xe(m,u))return null}}return`Expected ${ue(f)} but found ${ue(u)} instead.`}function Ee(f,u){return u.some(m=>m.kind===f.kind)}function we(f,u){return u.some(m=>m==="null"?f===null:m==="array"?Array.isArray(f):m==="object"?f&&!Array.isArray(f)&&typeof f=="object":m===typeof f)}function Fe(f,u){return f.kind==="array"&&u.kind==="array"?f.itemType.kind===u.itemType.kind&&typeof f.N=="number":f.kind===u.kind}const ze=.96422,Ge=.82521,st=4/29,vt=6/29,Tt=3*vt*vt,Kt=vt*vt*vt,ii=Math.PI/180,Gt=180/Math.PI;function Ai(f){return(f%=360)<0&&(f+=360),f}function Bi(f){let[u,m,C,D]=f,Q,H;const Z=Ci((.2225045*(u=Hi(u))+.7168786*(m=Hi(m))+.0606169*(C=Hi(C)))/1);u===m&&m===C?Q=H=Z:(Q=Ci((.4360747*u+.3850649*m+.1430804*C)/ze),H=Ci((.0139322*u+.0971045*m+.7141733*C)/Ge));const re=116*Z-16;return[re<0?0:re,500*(Q-Z),200*(Z-H),D]}function Hi(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function Ci(f){return f>Kt?Math.pow(f,1/3):f/Tt+st}function Ni(f){let[u,m,C,D]=f,Q=(u+16)/116,H=isNaN(m)?Q:Q+m/500,Z=isNaN(C)?Q:Q-C/200;return Q=1*ri(Q),H=ze*ri(H),Z=Ge*ri(Z),[ot(3.1338561*H-1.6168667*Q-.4906146*Z),ot(-.9787684*H+1.9161415*Q+.033454*Z),ot(.0719453*H-.2289914*Q+1.4052427*Z),D]}function ot(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function ri(f){return f>vt?f*f*f:Tt*(f-st)}function Vt(f){return parseInt(f.padEnd(2,f),16)/255}function Vi(f,u){return lr(u?f/100:f,0,1)}function lr(f,u,m){return Math.min(Math.max(u,f),m)}function un(f){return!f.some(Number.isNaN)}const wn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class gr{constructor(u,m,C){let D=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=u,this.g=m,this.b=C,this.a=D,Q||(this.r*=D,this.g*=D,this.b*=D,D||this.overwriteGetter("rgb",[u,m,C,D]))}static parse(u){if(u instanceof gr)return u;if(typeof u!="string")return;const m=function(C){if((C=C.toLowerCase().trim())==="transparent")return[0,0,0,0];const D=wn[C];if(D){const[H,Z,re]=D;return[H/255,Z/255,re/255,1]}if(C.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(C)){const H=C.length<6?1:2;let Z=1;return[Vt(C.slice(Z,Z+=H)),Vt(C.slice(Z,Z+=H)),Vt(C.slice(Z,Z+=H)),Vt(C.slice(Z,Z+H)||"ff")]}if(C.startsWith("rgb")){const H=C.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(H){const[Z,re,de,h,c,d,_,S,M,k,G,W]=H,Y=[h||" ",_||" ",k].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const ae=[de,d,M].join(""),fe=ae==="%%%"?100:ae===""?255:0;if(fe){const me=[lr(+re/fe,0,1),lr(+c/fe,0,1),lr(+S/fe,0,1),G?Vi(+G,W):1];if(un(me))return me}}return}}const Q=C.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Q){const[H,Z,re,de,h,c,d,_,S]=Q,M=[re||" ",h||" ",d].join("");if(M==="  "||M==="  /"||M===",,"||M===",,,"){const k=[+Z,lr(+de,0,100),lr(+c,0,100),_?Vi(+_,S):1];if(un(k))return function(G){let[W,Y,ae,fe]=G;function me(Ce){const Me=(Ce+W/30)%12,Ue=Y*Math.min(ae,1-ae);return ae-Ue*Math.max(-1,Math.min(Me-3,9-Me,1))}return W=Ai(W),Y/=100,ae/=100,[me(0),me(8),me(4),fe]}(k)}}}(u);return m?new gr(...m,!1):void 0}get rgb(){const{r:u,g:m,b:C,a:D}=this,Q=D||1/0;return this.overwriteGetter("rgb",[u/Q,m/Q,C/Q,D])}get hcl(){return this.overwriteGetter("hcl",function(u){const[m,C,D,Q]=Bi(u),H=Math.sqrt(C*C+D*D);return[Math.round(1e4*H)?Ai(Math.atan2(D,C)*Gt):NaN,H,m,Q]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Bi(this.rgb))}overwriteGetter(u,m){return Object.defineProperty(this,u,{value:m}),m}toString(){const[u,m,C,D]=this.rgb;return`rgba(${[u,m,C].map(Q=>Math.round(255*Q)).join(",")},${D})`}}gr.black=new gr(0,0,0,1),gr.white=new gr(1,1,1,1),gr.transparent=new gr(0,0,0,0),gr.red=new gr(1,0,0,1);class mn{constructor(u,m,C){this.sensitivity=u?m?"variant":"case":m?"accent":"base",this.locale=C,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,m){return this.collator.compare(u,m)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yn{constructor(u,m,C,D,Q){this.text=u,this.image=m,this.scale=C,this.fontStack=D,this.textColor=Q}}class dr{constructor(u){this.sections=u}static fromString(u){return new dr([new yn(u,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(u=>u.text.length!==0||u.image&&u.image.name.length!==0)}static factory(u){return u instanceof dr?u:dr.fromString(u)}toString(){return this.sections.length===0?"":this.sections.map(u=>u.text).join("")}}class Hn{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Hn)return u;if(typeof u=="number")return new Hn([u,u,u,u]);if(Array.isArray(u)&&!(u.length<1||u.length>4)){for(const m of u)if(typeof m!="number")return;switch(u.length){case 1:u=[u[0],u[0],u[0],u[0]];break;case 2:u=[u[0],u[1],u[0],u[1]];break;case 3:u=[u[0],u[1],u[2],u[1]]}return new Hn(u)}}toString(){return JSON.stringify(this.values)}}const Gs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Or{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Or)return u;if(Array.isArray(u)&&!(u.length<1)&&u.length%2==0){for(let m=0;m<u.length;m+=2){const C=u[m],D=u[m+1];if(typeof C!="string"||!Gs.has(C)||!Array.isArray(D)||D.length!==2||typeof D[0]!="number"||typeof D[1]!="number")return}return new Or(u)}}toString(){return JSON.stringify(this.values)}}class Bn{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new Bn({name:u,available:!1}):null}}function qa(f,u,m,C){return typeof f=="number"&&f>=0&&f<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof m=="number"&&m>=0&&m<=255?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid rgba value [${[f,u,m,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof C=="number"?[f,u,m,C]:[f,u,m]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Un(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof gr||f instanceof mn||f instanceof dr||f instanceof Hn||f instanceof Or||f instanceof Bn)return!0;if(Array.isArray(f)){for(const u of f)if(!Un(u))return!1;return!0}if(typeof f=="object"){for(const u in f)if(!Un(f[u]))return!1;return!0}return!1}function Zi(f){if(f===null)return Ar;if(typeof f=="string")return Si;if(typeof f=="boolean")return Ii;if(typeof f=="number")return Qt;if(f instanceof gr)return Zt;if(f instanceof mn)return _r;if(f instanceof dr)return Zr;if(f instanceof Hn)return Qe;if(f instanceof Or)return ce;if(f instanceof Bn)return Be;if(Array.isArray(f)){const u=f.length;let m;for(const C of f){const D=Zi(C);if(m){if(m===D)continue;m=ei;break}m=D}return ie(m||ei,u)}return bi}function ao(f){const u=typeof f;return f===null?"":u==="string"||u==="number"||u==="boolean"?String(f):f instanceof gr||f instanceof dr||f instanceof Hn||f instanceof Or||f instanceof Bn?f.toString():JSON.stringify(f)}class Ms{constructor(u,m){this.type=u,this.value=m}static parse(u,m){if(u.length!==2)return m.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!Un(u[1]))return m.error("invalid value");const C=u[1];let D=Zi(C);const Q=m.expectedType;return D.kind!=="array"||D.N!==0||!Q||Q.kind!=="array"||typeof Q.N=="number"&&Q.N!==0||(D=Q),new Ms(D,C)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class vr{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}}const Tr={string:Si,number:Qt,boolean:Ii,object:bi};class rs{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");let C,D=1;const Q=u[0];if(Q==="array"){let Z,re;if(u.length>2){const de=u[1];if(typeof de!="string"||!(de in Tr)||de==="object")return m.error('The item type argument of "array" must be one of string, number, boolean',1);Z=Tr[de],D++}else Z=ei;if(u.length>3){if(u[2]!==null&&(typeof u[2]!="number"||u[2]<0||u[2]!==Math.floor(u[2])))return m.error('The length argument to "array" must be a positive integer literal',2);re=u[2],D++}C=ie(Z,re)}else{if(!Tr[Q])throw new Error(`Types doesn't contain name = ${Q}`);C=Tr[Q]}const H=[];for(;D<u.length;D++){const Z=m.parse(u[D],D,ei);if(!Z)return null;H.push(Z)}return new rs(C,H)}evaluate(u){for(let m=0;m<this.args.length;m++){const C=this.args[m].evaluate(u);if(!xe(this.type,Zi(C)))return C;if(m===this.args.length-1)throw new vr(`Expected value to be of type ${ue(this.type)}, but found ${ue(Zi(C))} instead.`)}throw new Error}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const Gr={"to-boolean":Ii,"to-color":Zt,"to-number":Qt,"to-string":Si};class Tn{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");const C=u[0];if(!Gr[C])throw new Error(`Can't parse ${C} as it is not part of the known types`);if((C==="to-boolean"||C==="to-string")&&u.length!==2)return m.error("Expected one argument.");const D=Gr[C],Q=[];for(let H=1;H<u.length;H++){const Z=m.parse(u[H],H,ei);if(!Z)return null;Q.push(Z)}return new Tn(D,Q)}evaluate(u){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(u);case"color":{let m,C;for(const D of this.args){if(m=D.evaluate(u),C=null,m instanceof gr)return m;if(typeof m=="string"){const Q=u.parseColor(m);if(Q)return Q}else if(Array.isArray(m)&&(C=m.length<3||m.length>4?`Invalid rbga value ${JSON.stringify(m)}: expected an array containing either three or four numeric values.`:qa(m[0],m[1],m[2],m[3]),!C))return new gr(m[0]/255,m[1]/255,m[2]/255,m[3])}throw new vr(C||`Could not parse color from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"padding":{let m;for(const C of this.args){m=C.evaluate(u);const D=Hn.parse(m);if(D)return D}throw new vr(`Could not parse padding from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"variableAnchorOffsetCollection":{let m;for(const C of this.args){m=C.evaluate(u);const D=Or.parse(m);if(D)return D}throw new vr(`Could not parse variableAnchorOffsetCollection from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"number":{let m=null;for(const C of this.args){if(m=C.evaluate(u),m===null)return 0;const D=Number(m);if(!isNaN(D))return D}throw new vr(`Could not convert ${JSON.stringify(m)} to number.`)}case"formatted":return dr.fromString(ao(this.args[0].evaluate(u)));case"resolvedImage":return Bn.fromString(ao(this.args[0].evaluate(u)));default:return ao(this.args[0].evaluate(u))}}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const Cn=["Unknown","Point","LineString","Polygon"];class po{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Cn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(u){let m=this._parseColorCache[u];return m||(m=this._parseColorCache[u]=gr.parse(u)),m}}class Lr{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],D=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Wt,H=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=u,this.path=C,this.key=C.map(Z=>`[${Z}]`).join(""),this.scope=Q,this.errors=H,this.expectedType=D,this._isConstant=m}parse(u,m,C,D){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return m?this.concat(m,C,D)._parse(u,Q):this._parse(u,Q)}_parse(u,m){function C(D,Q,H){return H==="assert"?new rs(Q,[D]):H==="coerce"?new Tn(Q,[D]):D}if(u!==null&&typeof u!="string"&&typeof u!="boolean"&&typeof u!="number"||(u=["literal",u]),Array.isArray(u)){if(u.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const D=u[0];if(typeof D!="string")return this.error(`Expression name must be a string, but found ${typeof D} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Q=this.registry[D];if(Q){let H=Q.parse(u,this);if(!H)return null;if(this.expectedType){const Z=this.expectedType,re=H.type;if(Z.kind!=="string"&&Z.kind!=="number"&&Z.kind!=="boolean"&&Z.kind!=="object"&&Z.kind!=="array"||re.kind!=="value")if(Z.kind!=="color"&&Z.kind!=="formatted"&&Z.kind!=="resolvedImage"||re.kind!=="value"&&re.kind!=="string")if(Z.kind!=="padding"||re.kind!=="value"&&re.kind!=="number"&&re.kind!=="array")if(Z.kind!=="variableAnchorOffsetCollection"||re.kind!=="value"&&re.kind!=="array"){if(this.checkSubtype(Z,re))return null}else H=C(H,Z,m.typeAnnotation||"coerce");else H=C(H,Z,m.typeAnnotation||"coerce");else H=C(H,Z,m.typeAnnotation||"coerce");else H=C(H,Z,m.typeAnnotation||"assert")}if(!(H instanceof Ms)&&H.type.kind!=="resolvedImage"&&this._isConstant(H)){const Z=new po;try{H=new Ms(H.type,H.evaluate(Z))}catch(re){return this.error(re.message),null}}return H}return this.error(`Unknown expression "${D}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(u===void 0?"'undefined' value invalid. Use null instead.":typeof u=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,m,C){const D=typeof u=="number"?this.path.concat(u):this.path,Q=C?this.scope.concat(C):this.scope;return new Lr(this.registry,this._isConstant,D,m||null,Q,this.errors)}error(u){for(var m=arguments.length,C=new Array(m>1?m-1:0),D=1;D<m;D++)C[D-1]=arguments[D];const Q=`${this.key}${C.map(H=>`[${H}]`).join("")}`;this.errors.push(new hi(Q,u))}checkSubtype(u,m){const C=xe(u,m);return C&&this.error(C),C}}class $a{constructor(u,m,C){this.type=_r,this.locale=C,this.caseSensitive=u,this.diacriticSensitive=m}static parse(u,m){if(u.length!==2)return m.error("Expected one argument.");const C=u[1];if(typeof C!="object"||Array.isArray(C))return m.error("Collator options argument must be an object.");const D=m.parse(C["case-sensitive"]!==void 0&&C["case-sensitive"],1,Ii);if(!D)return null;const Q=m.parse(C["diacritic-sensitive"]!==void 0&&C["diacritic-sensitive"],1,Ii);if(!Q)return null;let H=null;return C.locale&&(H=m.parse(C.locale,1,Si),!H)?null:new $a(D,Q,H)}evaluate(u){return new mn(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}}const Zs=8192;function Ka(f,u){f[0]=Math.min(f[0],u[0]),f[1]=Math.min(f[1],u[1]),f[2]=Math.max(f[2],u[0]),f[3]=Math.max(f[3],u[1])}function He(f,u){return!(f[0]<=u[0]||f[2]>=u[2]||f[1]<=u[1]||f[3]>=u[3])}function Je(f,u){const m=(180+f[0])/360,C=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,D=Math.pow(2,u.z);return[Math.round(m*D*Zs),Math.round(C*D*Zs)]}function gt(f,u,m){const C=f[0]-u[0],D=f[1]-u[1],Q=f[0]-m[0],H=f[1]-m[1];return C*H-Q*D==0&&C*Q<=0&&D*H<=0}function Ot(f,u){let m=!1;for(let H=0,Z=u.length;H<Z;H++){const re=u[H];for(let de=0,h=re.length;de<h-1;de++){if(gt(f,re[de],re[de+1]))return!1;(D=re[de])[1]>(C=f)[1]!=(Q=re[de+1])[1]>C[1]&&C[0]<(Q[0]-D[0])*(C[1]-D[1])/(Q[1]-D[1])+D[0]&&(m=!m)}}var C,D,Q;return m}function di(f,u){for(let m=0;m<u.length;m++)if(Ot(f,u[m]))return!0;return!1}function ji(f,u,m,C){const D=C[0]-m[0],Q=C[1]-m[1],H=(f[0]-m[0])*Q-D*(f[1]-m[1]),Z=(u[0]-m[0])*Q-D*(u[1]-m[1]);return H>0&&Z<0||H<0&&Z>0}function Br(f,u,m){for(const de of m)for(let h=0;h<de.length-1;++h)if((Z=[(H=de[h+1])[0]-(Q=de[h])[0],H[1]-Q[1]])[0]*(re=[(D=u)[0]-(C=f)[0],D[1]-C[1]])[1]-Z[1]*re[0]!=0&&ji(C,D,Q,H)&&ji(Q,H,C,D))return!0;var C,D,Q,H,Z,re;return!1}function In(f,u){for(let m=0;m<f.length;++m)if(!Ot(f[m],u))return!1;for(let m=0;m<f.length-1;++m)if(Br(f[m],f[m+1],u))return!1;return!0}function Gn(f,u){for(let m=0;m<u.length;m++)if(In(f,u[m]))return!0;return!1}function ns(f,u,m){const C=[];for(let D=0;D<f.length;D++){const Q=[];for(let H=0;H<f[D].length;H++){const Z=Je(f[D][H],m);Ka(u,Z),Q.push(Z)}C.push(Q)}return C}function _n(f,u,m){const C=[];for(let D=0;D<f.length;D++){const Q=ns(f[D],u,m);C.push(Q)}return C}function uu(f,u,m,C){if(f[0]<m[0]||f[0]>m[2]){const D=.5*C;let Q=f[0]-m[0]>D?-C:m[0]-f[0]>D?C:0;Q===0&&(Q=f[0]-m[2]>D?-C:m[2]-f[0]>D?C:0),f[0]+=Q}Ka(u,f)}function Nl(f,u,m,C){const D=Math.pow(2,C.z)*Zs,Q=[C.x*Zs,C.y*Zs],H=[];for(const Z of f)for(const re of Z){const de=[re.x+Q[0],re.y+Q[1]];uu(de,u,m,D),H.push(de)}return H}function Cr(f,u,m,C){const D=Math.pow(2,C.z)*Zs,Q=[C.x*Zs,C.y*Zs],H=[];for(const re of f){const de=[];for(const h of re){const c=[h.x+Q[0],h.y+Q[1]];Ka(u,c),de.push(c)}H.push(de)}if(u[2]-u[0]<=D/2){(Z=u)[0]=Z[1]=1/0,Z[2]=Z[3]=-1/0;for(const re of H)for(const de of re)uu(de,u,m,D)}var Z;return H}class Wa{constructor(u,m){this.type=Ii,this.geojson=u,this.geometries=m}static parse(u,m){if(u.length!==2)return m.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(Un(u[1])){const C=u[1];if(C.type==="FeatureCollection"){const D=[];for(const Q of C.features){const{type:H,coordinates:Z}=Q.geometry;H==="Polygon"&&D.push(Z),H==="MultiPolygon"&&D.push(...Z)}if(D.length)return new Wa(C,{type:"MultiPolygon",coordinates:D})}else if(C.type==="Feature"){const D=C.geometry.type;if(D==="Polygon"||D==="MultiPolygon")return new Wa(C,C.geometry)}else if(C.type==="Polygon"||C.type==="MultiPolygon")return new Wa(C,C)}return m.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(u.geometry()!=null&&u.canonicalID()!=null){if(u.geometryType()==="Point")return function(m,C){const D=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],H=m.canonicalID();if(C.type==="Polygon"){const Z=ns(C.coordinates,Q,H),re=Nl(m.geometry(),D,Q,H);if(!He(D,Q))return!1;for(const de of re)if(!Ot(de,Z))return!1}if(C.type==="MultiPolygon"){const Z=_n(C.coordinates,Q,H),re=Nl(m.geometry(),D,Q,H);if(!He(D,Q))return!1;for(const de of re)if(!di(de,Z))return!1}return!0}(u,this.geometries);if(u.geometryType()==="LineString")return function(m,C){const D=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],H=m.canonicalID();if(C.type==="Polygon"){const Z=ns(C.coordinates,Q,H),re=Cr(m.geometry(),D,Q,H);if(!He(D,Q))return!1;for(const de of re)if(!In(de,Z))return!1}if(C.type==="MultiPolygon"){const Z=_n(C.coordinates,Q,H),re=Cr(m.geometry(),D,Q,H);if(!He(D,Q))return!1;for(const de of re)if(!Gn(de,Z))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class zl{constructor(u,m){this.type=m.type,this.name=u,this.boundExpression=m}static parse(u,m){if(u.length!==2||typeof u[1]!="string")return m.error("'var' expression requires exactly one string literal argument.");const C=u[1];return m.scope.has(C)?new zl(C,m.scope.get(C)):m.error(`Unknown variable "${C}". Make sure "${C}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}}class ss{constructor(u,m,C,D){this.name=u,this.type=m,this._evaluate=C,this.args=D}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}static parse(u,m){const C=u[0],D=ss.definitions[C];if(!D)return m.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0);const Q=Array.isArray(D)?D[0]:D.type,H=Array.isArray(D)?[[D[1],D[2]]]:D.overloads,Z=H.filter(de=>{let[h]=de;return!Array.isArray(h)||h.length===u.length-1});let re=null;for(const[de,h]of Z){re=new Lr(m.registry,To,m.path,null,m.scope);const c=[];let d=!1;for(let _=1;_<u.length;_++){const S=u[_],M=Array.isArray(de)?de[_-1]:de.type,k=re.parse(S,1+c.length,M);if(!k){d=!0;break}c.push(k)}if(!d)if(Array.isArray(de)&&de.length!==c.length)re.error(`Expected ${de.length} arguments, but found ${c.length} instead.`);else{for(let _=0;_<c.length;_++){const S=Array.isArray(de)?de[_]:de.type,M=c[_];re.concat(_+1).checkSubtype(S,M.type)}if(re.errors.length===0)return new ss(C,Q,h,c)}}if(Z.length===1)m.errors.push(...re.errors);else{const de=(Z.length?Z:H).map(c=>{let[d]=c;return _=d,Array.isArray(_)?`(${_.map(ue).join(", ")})`:`(${ue(_.type)}...)`;var _}).join(" | "),h=[];for(let c=1;c<u.length;c++){const d=m.parse(u[c],1+h.length);if(!d)return null;h.push(ue(d.type))}m.error(`Expected arguments of type ${de}, but found (${h.join(", ")}) instead.`)}return null}static register(u,m){ss.definitions=m;for(const C in m)u[C]=ss}}function To(f){if(f instanceof zl)return To(f.boundExpression);if(f instanceof ss&&f.name==="error"||f instanceof $a||f instanceof Wa)return!1;const u=f instanceof Tn||f instanceof rs;let m=!0;return f.eachChild(C=>{m=u?m&&To(C):m&&C instanceof Ms}),!!m&&Ea(f)&&Sa(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ea(f){if(f instanceof ss&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof Wa)return!1;let u=!0;return f.eachChild(m=>{u&&!Ea(m)&&(u=!1)}),u}function gs(f){if(f instanceof ss&&f.name==="feature-state")return!1;let u=!0;return f.eachChild(m=>{u&&!gs(m)&&(u=!1)}),u}function Sa(f,u){if(f instanceof ss&&u.indexOf(f.name)>=0)return!1;let m=!0;return f.eachChild(C=>{m&&!Sa(C,u)&&(m=!1)}),m}function Za(f,u){const m=f.length-1;let C,D,Q=0,H=m,Z=0;for(;Q<=H;)if(Z=Math.floor((Q+H)/2),C=f[Z],D=f[Z+1],C<=u){if(Z===m||u<D)return Z;Q=Z+1}else{if(!(C>u))throw new vr("Input is not a number.");H=Z-1}return 0}class ca{constructor(u,m,C){this.type=u,this.input=m,this.labels=[],this.outputs=[];for(const[D,Q]of C)this.labels.push(D),this.outputs.push(Q)}static parse(u,m){if(u.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return m.error("Expected an even number of arguments.");const C=m.parse(u[1],1,Qt);if(!C)return null;const D=[];let Q=null;m.expectedType&&m.expectedType.kind!=="value"&&(Q=m.expectedType);for(let H=1;H<u.length;H+=2){const Z=H===1?-1/0:u[H],re=u[H+1],de=H,h=H+1;if(typeof Z!="number")return m.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',de);if(D.length&&D[D.length-1][0]>=Z)return m.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',de);const c=m.parse(re,h,Q);if(!c)return null;Q=Q||c.type,D.push([Z,c])}return new ca(Q,C,D)}evaluate(u){const m=this.labels,C=this.outputs;if(m.length===1)return C[0].evaluate(u);const D=this.input.evaluate(u);if(D<=m[0])return C[0].evaluate(u);const Q=m.length;return D>=m[Q-1]?C[Q-1].evaluate(u):C[Za(m,D)].evaluate(u)}eachChild(u){u(this.input);for(const m of this.outputs)u(m)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function Uc(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Xa=go;function go(f,u,m,C){this.cx=3*f,this.bx=3*(m-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=u,this.p2x=m,this.p2y=C}go.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,u){if(u===void 0&&(u=1e-6),f<0)return 0;if(f>1)return 1;for(var m=f,C=0;C<8;C++){var D=this.sampleCurveX(m)-f;if(Math.abs(D)<u)return m;var Q=this.sampleCurveDerivativeX(m);if(Math.abs(Q)<1e-6)break;m-=D/Q}var H=0,Z=1;for(m=f,C=0;C<20&&(D=this.sampleCurveX(m),!(Math.abs(D-f)<u));C++)f>D?H=m:Z=m,m=.5*(Z-H)+H;return m},solve:function(f,u){return this.sampleCurveY(this.solveCurveX(f,u))}};var Pr=Uc(Xa);function ua(f,u,m){return f+m*(u-f)}function us(f,u,m){return f.map((C,D)=>ua(C,u[D],m))}const En={number:ua,color:function(f,u,m){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[D,Q,H,Z]=us(f.rgb,u.rgb,m);return new gr(D,Q,H,Z,!1)}case"hcl":{const[D,Q,H,Z]=f.hcl,[re,de,h,c]=u.hcl;let d,_;if(isNaN(D)||isNaN(re))isNaN(D)?isNaN(re)?d=NaN:(d=re,H!==1&&H!==0||(_=de)):(d=D,h!==1&&h!==0||(_=Q));else{let W=re-D;re>D&&W>180?W-=360:re<D&&D-re>180&&(W+=360),d=D+m*W}const[S,M,k,G]=function(W){let[Y,ae,fe,me]=W;return Y=isNaN(Y)?0:Y*ii,Ni([fe,Math.cos(Y)*ae,Math.sin(Y)*ae,me])}([d,_??ua(Q,de,m),ua(H,h,m),ua(Z,c,m)]);return new gr(S,M,k,G,!1)}case"lab":{const[D,Q,H,Z]=Ni(us(f.lab,u.lab,m));return new gr(D,Q,H,Z,!1)}}},array:us,padding:function(f,u,m){return new Hn(us(f.values,u.values,m))},variableAnchorOffsetCollection:function(f,u,m){const C=f.values,D=u.values;if(C.length!==D.length)throw new vr(`Cannot interpolate values of different length. from: ${f.toString()}, to: ${u.toString()}`);const Q=[];for(let H=0;H<C.length;H+=2){if(C[H]!==D[H])throw new vr(`Cannot interpolate values containing mismatched anchors. from[${H}]: ${C[H]}, to[${H}]: ${D[H]}`);Q.push(C[H]);const[Z,re]=C[H+1],[de,h]=D[H+1];Q.push([ua(Z,de,m),ua(re,h,m)])}return new Or(Q)}};class hs{constructor(u,m,C,D,Q){this.type=u,this.operator=m,this.interpolation=C,this.input=D,this.labels=[],this.outputs=[];for(const[H,Z]of Q)this.labels.push(H),this.outputs.push(Z)}static interpolationFactor(u,m,C,D){let Q=0;if(u.name==="exponential")Q=ha(m,u.base,C,D);else if(u.name==="linear")Q=ha(m,1,C,D);else if(u.name==="cubic-bezier"){const H=u.controlPoints;Q=new Pr(H[0],H[1],H[2],H[3]).solve(ha(m,1,C,D))}return Q}static parse(u,m){let[C,D,Q,...H]=u;if(!Array.isArray(D)||D.length===0)return m.error("Expected an interpolation type expression.",1);if(D[0]==="linear")D={name:"linear"};else if(D[0]==="exponential"){const de=D[1];if(typeof de!="number")return m.error("Exponential interpolation requires a numeric base.",1,1);D={name:"exponential",base:de}}else{if(D[0]!=="cubic-bezier")return m.error(`Unknown interpolation type ${String(D[0])}`,1,0);{const de=D.slice(1);if(de.length!==4||de.some(h=>typeof h!="number"||h<0||h>1))return m.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);D={name:"cubic-bezier",controlPoints:de}}}if(u.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return m.error("Expected an even number of arguments.");if(Q=m.parse(Q,2,Qt),!Q)return null;const Z=[];let re=null;C==="interpolate-hcl"||C==="interpolate-lab"?re=Zt:m.expectedType&&m.expectedType.kind!=="value"&&(re=m.expectedType);for(let de=0;de<H.length;de+=2){const h=H[de],c=H[de+1],d=de+3,_=de+4;if(typeof h!="number")return m.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(Z.length&&Z[Z.length-1][0]>=h)return m.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);const S=m.parse(c,_,re);if(!S)return null;re=re||S.type,Z.push([h,S])}return Fe(re,Qt)||Fe(re,Zt)||Fe(re,Qe)||Fe(re,ce)||Fe(re,ie(Qt))?new hs(re,C,D,Q,Z):m.error(`Type ${ue(re)} is not interpolatable.`)}evaluate(u){const m=this.labels,C=this.outputs;if(m.length===1)return C[0].evaluate(u);const D=this.input.evaluate(u);if(D<=m[0])return C[0].evaluate(u);const Q=m.length;if(D>=m[Q-1])return C[Q-1].evaluate(u);const H=Za(m,D),Z=hs.interpolationFactor(this.interpolation,D,m[H],m[H+1]),re=C[H].evaluate(u),de=C[H+1].evaluate(u);switch(this.operator){case"interpolate":return En[this.type.kind](re,de,Z);case"interpolate-hcl":return En.color(re,de,Z,"hcl");case"interpolate-lab":return En.color(re,de,Z,"lab")}}eachChild(u){u(this.input);for(const m of this.outputs)u(m)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function ha(f,u,m,C){const D=C-m,Q=f-m;return D===0?0:u===1?Q/D:(Math.pow(u,Q)-1)/(Math.pow(u,D)-1)}class jr{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expectected at least one argument.");let C=null;const D=m.expectedType;D&&D.kind!=="value"&&(C=D);const Q=[];for(const Z of u.slice(1)){const re=m.parse(Z,1+Q.length,C,void 0,{typeAnnotation:"omit"});if(!re)return null;C=C||re.type,Q.push(re)}if(!C)throw new Error("No output type");const H=D&&Q.some(Z=>xe(D,Z.type));return new jr(H?ei:C,Q)}evaluate(u){let m,C=null,D=0;for(const Q of this.args)if(D++,C=Q.evaluate(u),C&&C instanceof Bn&&!C.available&&(m||(m=C.name),C=null,D===this.args.length&&(C=m)),C!==null)break;return C}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}class cl{constructor(u,m){this.type=m.type,this.bindings=[].concat(u),this.result=m}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(const m of this.bindings)u(m[1]);u(this.result)}static parse(u,m){if(u.length<4)return m.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);const C=[];for(let Q=1;Q<u.length-1;Q+=2){const H=u[Q];if(typeof H!="string")return m.error(`Expected string, but found ${typeof H} instead.`,Q);if(/[^a-zA-Z0-9_]/.test(H))return m.error("Variable names must contain only alphanumeric characters or '_'.",Q);const Z=m.parse(u[Q+1],Q+1);if(!Z)return null;C.push([H,Z])}const D=m.parse(u[u.length-1],u.length-1,m.expectedType,C);return D?new cl(C,D):null}outputDefined(){return this.result.outputDefined()}}class Ql{constructor(u,m,C){this.type=u,this.index=m,this.input=C}static parse(u,m){if(u.length!==3)return m.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Qt),D=m.parse(u[2],2,ie(m.expectedType||ei));return C&&D?new Ql(D.type.itemType,C,D):null}evaluate(u){const m=this.index.evaluate(u),C=this.input.evaluate(u);if(m<0)throw new vr(`Array index out of bounds: ${m} < 0.`);if(m>=C.length)throw new vr(`Array index out of bounds: ${m} > ${C.length-1}.`);if(m!==Math.floor(m))throw new vr(`Array index must be an integer, but found ${m} instead.`);return C[m]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}}class Io{constructor(u,m){this.type=Ii,this.needle=u,this.haystack=m}static parse(u,m){if(u.length!==3)return m.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,ei),D=m.parse(u[2],2,ei);return C&&D?Ee(C.type,[Ii,Si,Qt,Ar,ei])?new Io(C,D):m.error(`Expected first argument to be of type boolean, string, number or null, but found ${ue(C.type)} instead`):null}evaluate(u){const m=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!C)return!1;if(!we(m,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${ue(Zi(m))} instead.`);if(!we(C,["string","array"]))throw new vr(`Expected second argument to be of type array or string, but found ${ue(Zi(C))} instead.`);return C.indexOf(m)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}}class Ko{constructor(u,m,C){this.type=Qt,this.needle=u,this.haystack=m,this.fromIndex=C}static parse(u,m){if(u.length<=2||u.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,ei),D=m.parse(u[2],2,ei);if(!C||!D)return null;if(!Ee(C.type,[Ii,Si,Qt,Ar,ei]))return m.error(`Expected first argument to be of type boolean, string, number or null, but found ${ue(C.type)} instead`);if(u.length===4){const Q=m.parse(u[3],3,Qt);return Q?new Ko(C,D,Q):null}return new Ko(C,D)}evaluate(u){const m=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!we(m,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${ue(Zi(m))} instead.`);if(!we(C,["string","array"]))throw new vr(`Expected second argument to be of type array or string, but found ${ue(Zi(C))} instead.`);if(this.fromIndex){const D=this.fromIndex.evaluate(u);return C.indexOf(m,D)}return C.indexOf(m)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}}class mc{constructor(u,m,C,D,Q,H){this.inputType=u,this.type=m,this.input=C,this.cases=D,this.outputs=Q,this.otherwise=H}static parse(u,m){if(u.length<5)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return m.error("Expected an even number of arguments.");let C,D;m.expectedType&&m.expectedType.kind!=="value"&&(D=m.expectedType);const Q={},H=[];for(let de=2;de<u.length-1;de+=2){let h=u[de];const c=u[de+1];Array.isArray(h)||(h=[h]);const d=m.concat(de);if(h.length===0)return d.error("Expected at least one branch label.");for(const S of h){if(typeof S!="number"&&typeof S!="string")return d.error("Branch labels must be numbers or strings.");if(typeof S=="number"&&Math.abs(S)>Number.MAX_SAFE_INTEGER)return d.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof S=="number"&&Math.floor(S)!==S)return d.error("Numeric branch labels must be integer values.");if(C){if(d.checkSubtype(C,Zi(S)))return null}else C=Zi(S);if(Q[String(S)]!==void 0)return d.error("Branch labels must be unique.");Q[String(S)]=H.length}const _=m.parse(c,de,D);if(!_)return null;D=D||_.type,H.push(_)}const Z=m.parse(u[1],1,ei);if(!Z)return null;const re=m.parse(u[u.length-1],u.length-1,D);return re?Z.type.kind!=="value"&&m.concat(1).checkSubtype(C,Z.type)?null:new mc(C,D,Z,Q,H,re):null}evaluate(u){const m=this.input.evaluate(u);return(Zi(m)===this.inputType&&this.outputs[this.cases[m]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every(u=>u.outputDefined())&&this.otherwise.outputDefined()}}class Wo{constructor(u,m,C){this.type=u,this.branches=m,this.otherwise=C}static parse(u,m){if(u.length<4)return m.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return m.error("Expected an odd number of arguments.");let C;m.expectedType&&m.expectedType.kind!=="value"&&(C=m.expectedType);const D=[];for(let H=1;H<u.length-1;H+=2){const Z=m.parse(u[H],H,Ii);if(!Z)return null;const re=m.parse(u[H+1],H+1,C);if(!re)return null;D.push([Z,re]),C=C||re.type}const Q=m.parse(u[u.length-1],u.length-1,C);if(!Q)return null;if(!C)throw new Error("Can't infer output type");return new Wo(C,D,Q)}evaluate(u){for(const[m,C]of this.branches)if(m.evaluate(u))return C.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(const[m,C]of this.branches)u(m),u(C);u(this.otherwise)}outputDefined(){return this.branches.every(u=>{let[m,C]=u;return C.outputDefined()})&&this.otherwise.outputDefined()}}class mo{constructor(u,m,C,D){this.type=u,this.input=m,this.beginIndex=C,this.endIndex=D}static parse(u,m){if(u.length<=2||u.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,ei),D=m.parse(u[2],2,Qt);if(!C||!D)return null;if(!Ee(C.type,[ie(ei),Si,ei]))return m.error(`Expected first argument to be of type array or string, but found ${ue(C.type)} instead`);if(u.length===4){const Q=m.parse(u[3],3,Qt);return Q?new mo(C.type,C,D,Q):null}return new mo(C.type,C,D)}evaluate(u){const m=this.input.evaluate(u),C=this.beginIndex.evaluate(u);if(!we(m,["string","array"]))throw new vr(`Expected first argument to be of type array or string, but found ${ue(Zi(m))} instead.`);if(this.endIndex){const D=this.endIndex.evaluate(u);return m.slice(C,D)}return m.slice(C)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}}function yc(f,u){return f==="=="||f==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Zo(f,u,m,C){return C.compare(u,m)===0}function Vl(f,u,m){const C=f!=="=="&&f!=="!=";return class g8{constructor(Q,H,Z){this.type=Ii,this.lhs=Q,this.rhs=H,this.collator=Z,this.hasUntypedArgument=Q.type.kind==="value"||H.type.kind==="value"}static parse(Q,H){if(Q.length!==3&&Q.length!==4)return H.error("Expected two or three arguments.");const Z=Q[0];let re=H.parse(Q[1],1,ei);if(!re)return null;if(!yc(Z,re.type))return H.concat(1).error(`"${Z}" comparisons are not supported for type '${ue(re.type)}'.`);let de=H.parse(Q[2],2,ei);if(!de)return null;if(!yc(Z,de.type))return H.concat(2).error(`"${Z}" comparisons are not supported for type '${ue(de.type)}'.`);if(re.type.kind!==de.type.kind&&re.type.kind!=="value"&&de.type.kind!=="value")return H.error(`Cannot compare types '${ue(re.type)}' and '${ue(de.type)}'.`);C&&(re.type.kind==="value"&&de.type.kind!=="value"?re=new rs(de.type,[re]):re.type.kind!=="value"&&de.type.kind==="value"&&(de=new rs(re.type,[de])));let h=null;if(Q.length===4){if(re.type.kind!=="string"&&de.type.kind!=="string"&&re.type.kind!=="value"&&de.type.kind!=="value")return H.error("Cannot use collator to compare non-string types.");if(h=H.parse(Q[3],3,_r),!h)return null}return new g8(re,de,h)}evaluate(Q){const H=this.lhs.evaluate(Q),Z=this.rhs.evaluate(Q);if(C&&this.hasUntypedArgument){const re=Zi(H),de=Zi(Z);if(re.kind!==de.kind||re.kind!=="string"&&re.kind!=="number")throw new vr(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${re.kind}, ${de.kind}) instead.`)}if(this.collator&&!C&&this.hasUntypedArgument){const re=Zi(H),de=Zi(Z);if(re.kind!=="string"||de.kind!=="string")return u(Q,H,Z)}return this.collator?m(Q,H,Z,this.collator.evaluate(Q)):u(Q,H,Z)}eachChild(Q){Q(this.lhs),Q(this.rhs),this.collator&&Q(this.collator)}outputDefined(){return!0}}}const Nc=Vl("==",function(f,u,m){return u===m},Zo),bh=Vl("!=",function(f,u,m){return u!==m},function(f,u,m,C){return!Zo(0,u,m,C)}),hu=Vl("<",function(f,u,m){return u<m},function(f,u,m,C){return C.compare(u,m)<0}),Au=Vl(">",function(f,u,m){return u>m},function(f,u,m,C){return C.compare(u,m)>0}),Ou=Vl("<=",function(f,u,m){return u<=m},function(f,u,m,C){return C.compare(u,m)<=0}),Hl=Vl(">=",function(f,u,m){return u>=m},function(f,u,m,C){return C.compare(u,m)>=0});class Ja{constructor(u,m,C,D,Q){this.type=Si,this.number=u,this.locale=m,this.currency=C,this.minFractionDigits=D,this.maxFractionDigits=Q}static parse(u,m){if(u.length!==3)return m.error("Expected two arguments.");const C=m.parse(u[1],1,Qt);if(!C)return null;const D=u[2];if(typeof D!="object"||Array.isArray(D))return m.error("NumberFormat options argument must be an object.");let Q=null;if(D.locale&&(Q=m.parse(D.locale,1,Si),!Q))return null;let H=null;if(D.currency&&(H=m.parse(D.currency,1,Si),!H))return null;let Z=null;if(D["min-fraction-digits"]&&(Z=m.parse(D["min-fraction-digits"],1,Qt),!Z))return null;let re=null;return D["max-fraction-digits"]&&(re=m.parse(D["max-fraction-digits"],1,Qt),!re)?null:new Ja(C,Q,H,Z,re)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}}class Ya{constructor(u){this.type=Zr,this.sections=u}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");const C=u[1];if(!Array.isArray(C)&&typeof C=="object")return m.error("First argument must be an image or text section.");const D=[];let Q=!1;for(let H=1;H<=u.length-1;++H){const Z=u[H];if(Q&&typeof Z=="object"&&!Array.isArray(Z)){Q=!1;let re=null;if(Z["font-scale"]&&(re=m.parse(Z["font-scale"],1,Qt),!re))return null;let de=null;if(Z["text-font"]&&(de=m.parse(Z["text-font"],1,ie(Si)),!de))return null;let h=null;if(Z["text-color"]&&(h=m.parse(Z["text-color"],1,Zt),!h))return null;const c=D[D.length-1];c.scale=re,c.font=de,c.textColor=h}else{const re=m.parse(u[H],1,ei);if(!re)return null;const de=re.type.kind;if(de!=="string"&&de!=="value"&&de!=="null"&&de!=="resolvedImage")return m.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Q=!0,D.push({content:re,scale:null,font:null,textColor:null})}}return new Ya(D)}evaluate(u){return new dr(this.sections.map(m=>{const C=m.content.evaluate(u);return Zi(C)===Be?new yn("",C,null,null,null):new yn(ao(C),null,m.scale?m.scale.evaluate(u):null,m.font?m.font.evaluate(u).join(","):null,m.textColor?m.textColor.evaluate(u):null)}))}eachChild(u){for(const m of this.sections)u(m.content),m.scale&&u(m.scale),m.font&&u(m.font),m.textColor&&u(m.textColor)}outputDefined(){return!1}}class Gl{constructor(u){this.type=Be,this.input=u}static parse(u,m){if(u.length!==2)return m.error("Expected two arguments.");const C=m.parse(u[1],1,Si);return C?new Gl(C):m.error("No image name provided.")}evaluate(u){const m=this.input.evaluate(u),C=Bn.fromString(m);return C&&u.availableImages&&(C.available=u.availableImages.indexOf(m)>-1),C}eachChild(u){u(this.input)}outputDefined(){return!1}}class el{constructor(u){this.type=Qt,this.input=u}static parse(u,m){if(u.length!==2)return m.error(`Expected 1 argument, but found ${u.length-1} instead.`);const C=m.parse(u[1],1);return C?C.type.kind!=="array"&&C.type.kind!=="string"&&C.type.kind!=="value"?m.error(`Expected argument of type string or array, but found ${ue(C.type)} instead.`):new el(C):null}evaluate(u){const m=this.input.evaluate(u);if(typeof m=="string"||Array.isArray(m))return m.length;throw new vr(`Expected value to be of type string or array, but found ${ue(Zi(m))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}}const Aa={"==":Nc,"!=":bh,">":Au,"<":hu,">=":Hl,"<=":Ou,array:rs,at:Ql,boolean:rs,case:Wo,coalesce:jr,collator:$a,format:Ya,image:Gl,in:Io,"index-of":Ko,interpolate:hs,"interpolate-hcl":hs,"interpolate-lab":hs,length:el,let:cl,literal:Ms,match:mc,number:rs,"number-format":Ja,object:rs,slice:mo,step:ca,string:rs,"to-boolean":Tn,"to-color":Tn,"to-number":Tn,"to-string":Tn,var:zl,within:Wa};function ul(f,u){let[m,C,D,Q]=u;m=m.evaluate(f),C=C.evaluate(f),D=D.evaluate(f);const H=Q?Q.evaluate(f):1,Z=qa(m,C,D,H);if(Z)throw new vr(Z);return new gr(m/255,C/255,D/255,H,!1)}function jl(f,u){return f in u}function lo(f,u){const m=u[f];return m===void 0?null:m}function da(f){return{type:f}}function ne(f){return{result:"success",value:f}}function Pe(f){return{result:"error",value:f}}function ct(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function _t(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function xt(f){return!!f.expression&&f.expression.interpolated}function Lt(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function pi(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function si(f){return f}function nr(f,u){const m=u.type==="color",C=f.stops&&typeof f.stops[0][0]=="object",D=C||!(C||f.property!==void 0),Q=f.type||(xt(u)?"exponential":"interval");if(m||u.type==="padding"){const h=m?gr.parse:Hn.parse;(f=Wi({},f)).stops&&(f.stops=f.stops.map(c=>[c[0],h(c[1])])),f.default=h(f.default?f.default:u.default)}if(f.colorSpace&&(H=f.colorSpace)!=="rgb"&&H!=="hcl"&&H!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var H;let Z,re,de;if(Q==="exponential")Z=jn;else if(Q==="interval")Z=cr;else if(Q==="categorical"){Z=Yi,re=Object.create(null);for(const h of f.stops)re[h[0]]=h[1];de=typeof f.stops[0][0]}else{if(Q!=="identity")throw new Error(`Unknown function type "${Q}"`);Z=or}if(C){const h={},c=[];for(let S=0;S<f.stops.length;S++){const M=f.stops[S],k=M[0].zoom;h[k]===void 0&&(h[k]={zoom:k,type:f.type,property:f.property,default:f.default,stops:[]},c.push(k)),h[k].stops.push([M[0].value,M[1]])}const d=[];for(const S of c)d.push([h[S].zoom,nr(h[S],u)]);const _={name:"linear"};return{kind:"composite",interpolationType:_,interpolationFactor:hs.interpolationFactor.bind(void 0,_),zoomStops:d.map(S=>S[0]),evaluate:(S,M)=>{let{zoom:k}=S;return jn({stops:d,base:f.base},u,k).evaluate(k,M)}}}if(D){const h=Q==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:h,interpolationFactor:hs.interpolationFactor.bind(void 0,h),zoomStops:f.stops.map(c=>c[0]),evaluate:c=>{let{zoom:d}=c;return Z(f,u,d,re,de)}}}return{kind:"source",evaluate(h,c){const d=c&&c.properties?c.properties[f.property]:void 0;return d===void 0?qi(f.default,u.default):Z(f,u,d,re,de)}}}function qi(f,u,m){return f!==void 0?f:u!==void 0?u:m!==void 0?m:void 0}function Yi(f,u,m,C,D){return qi(typeof m===D?C[m]:void 0,f.default,u.default)}function cr(f,u,m){if(Lt(m)!=="number")return qi(f.default,u.default);const C=f.stops.length;if(C===1||m<=f.stops[0][0])return f.stops[0][1];if(m>=f.stops[C-1][0])return f.stops[C-1][1];const D=Za(f.stops.map(Q=>Q[0]),m);return f.stops[D][1]}function jn(f,u,m){const C=f.base!==void 0?f.base:1;if(Lt(m)!=="number")return qi(f.default,u.default);const D=f.stops.length;if(D===1||m<=f.stops[0][0])return f.stops[0][1];if(m>=f.stops[D-1][0])return f.stops[D-1][1];const Q=Za(f.stops.map(h=>h[0]),m),H=function(h,c,d,_){const S=_-d,M=h-d;return S===0?0:c===1?M/S:(Math.pow(c,M)-1)/(Math.pow(c,S)-1)}(m,C,f.stops[Q][0],f.stops[Q+1][0]),Z=f.stops[Q][1],re=f.stops[Q+1][1],de=En[u.type]||si;return typeof Z.evaluate=="function"?{evaluate(){for(var h=arguments.length,c=new Array(h),d=0;d<h;d++)c[d]=arguments[d];const _=Z.evaluate.apply(void 0,c),S=re.evaluate.apply(void 0,c);if(_!==void 0&&S!==void 0)return de(_,S,H,f.colorSpace)}}:de(Z,re,H,f.colorSpace)}function or(f,u,m){switch(u.type){case"color":m=gr.parse(m);break;case"formatted":m=dr.fromString(m.toString());break;case"resolvedImage":m=Bn.fromString(m.toString());break;case"padding":m=Hn.parse(m);break;default:Lt(m)===u.type||u.type==="enum"&&u.values[m]||(m=void 0)}return qi(m,f.default,u.default)}ss.register(Aa,{error:[{kind:"error"},[Si],(f,u)=>{let[m]=u;throw new vr(m.evaluate(f))}],typeof:[Si,[ei],(f,u)=>{let[m]=u;return ue(Zi(m.evaluate(f)))}],"to-rgba":[ie(Qt,4),[Zt],(f,u)=>{let[m]=u;const[C,D,Q,H]=m.evaluate(f).rgb;return[255*C,255*D,255*Q,H]}],rgb:[Zt,[Qt,Qt,Qt],ul],rgba:[Zt,[Qt,Qt,Qt,Qt],ul],has:{type:Ii,overloads:[[[Si],(f,u)=>{let[m]=u;return jl(m.evaluate(f),f.properties())}],[[Si,bi],(f,u)=>{let[m,C]=u;return jl(m.evaluate(f),C.evaluate(f))}]]},get:{type:ei,overloads:[[[Si],(f,u)=>{let[m]=u;return lo(m.evaluate(f),f.properties())}],[[Si,bi],(f,u)=>{let[m,C]=u;return lo(m.evaluate(f),C.evaluate(f))}]]},"feature-state":[ei,[Si],(f,u)=>{let[m]=u;return lo(m.evaluate(f),f.featureState||{})}],properties:[bi,[],f=>f.properties()],"geometry-type":[Si,[],f=>f.geometryType()],id:[ei,[],f=>f.id()],zoom:[Qt,[],f=>f.globals.zoom],"heatmap-density":[Qt,[],f=>f.globals.heatmapDensity||0],"line-progress":[Qt,[],f=>f.globals.lineProgress||0],accumulated:[ei,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[Qt,da(Qt),(f,u)=>{let m=0;for(const C of u)m+=C.evaluate(f);return m}],"*":[Qt,da(Qt),(f,u)=>{let m=1;for(const C of u)m*=C.evaluate(f);return m}],"-":{type:Qt,overloads:[[[Qt,Qt],(f,u)=>{let[m,C]=u;return m.evaluate(f)-C.evaluate(f)}],[[Qt],(f,u)=>{let[m]=u;return-m.evaluate(f)}]]},"/":[Qt,[Qt,Qt],(f,u)=>{let[m,C]=u;return m.evaluate(f)/C.evaluate(f)}],"%":[Qt,[Qt,Qt],(f,u)=>{let[m,C]=u;return m.evaluate(f)%C.evaluate(f)}],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(f,u)=>{let[m,C]=u;return Math.pow(m.evaluate(f),C.evaluate(f))}],sqrt:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.sqrt(m.evaluate(f))}],log10:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.log(m.evaluate(f))/Math.LN10}],ln:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.log(m.evaluate(f))}],log2:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.log(m.evaluate(f))/Math.LN2}],sin:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.sin(m.evaluate(f))}],cos:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.cos(m.evaluate(f))}],tan:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.tan(m.evaluate(f))}],asin:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.asin(m.evaluate(f))}],acos:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.acos(m.evaluate(f))}],atan:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.atan(m.evaluate(f))}],min:[Qt,da(Qt),(f,u)=>Math.min(...u.map(m=>m.evaluate(f)))],max:[Qt,da(Qt),(f,u)=>Math.max(...u.map(m=>m.evaluate(f)))],abs:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.abs(m.evaluate(f))}],round:[Qt,[Qt],(f,u)=>{let[m]=u;const C=m.evaluate(f);return C<0?-Math.round(-C):Math.round(C)}],floor:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.floor(m.evaluate(f))}],ceil:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.ceil(m.evaluate(f))}],"filter-==":[Ii,[Si,ei],(f,u)=>{let[m,C]=u;return f.properties()[m.value]===C.value}],"filter-id-==":[Ii,[ei],(f,u)=>{let[m]=u;return f.id()===m.value}],"filter-type-==":[Ii,[Si],(f,u)=>{let[m]=u;return f.geometryType()===m.value}],"filter-<":[Ii,[Si,ei],(f,u)=>{let[m,C]=u;const D=f.properties()[m.value],Q=C.value;return typeof D==typeof Q&&D<Q}],"filter-id-<":[Ii,[ei],(f,u)=>{let[m]=u;const C=f.id(),D=m.value;return typeof C==typeof D&&C<D}],"filter->":[Ii,[Si,ei],(f,u)=>{let[m,C]=u;const D=f.properties()[m.value],Q=C.value;return typeof D==typeof Q&&D>Q}],"filter-id->":[Ii,[ei],(f,u)=>{let[m]=u;const C=f.id(),D=m.value;return typeof C==typeof D&&C>D}],"filter-<=":[Ii,[Si,ei],(f,u)=>{let[m,C]=u;const D=f.properties()[m.value],Q=C.value;return typeof D==typeof Q&&D<=Q}],"filter-id-<=":[Ii,[ei],(f,u)=>{let[m]=u;const C=f.id(),D=m.value;return typeof C==typeof D&&C<=D}],"filter->=":[Ii,[Si,ei],(f,u)=>{let[m,C]=u;const D=f.properties()[m.value],Q=C.value;return typeof D==typeof Q&&D>=Q}],"filter-id->=":[Ii,[ei],(f,u)=>{let[m]=u;const C=f.id(),D=m.value;return typeof C==typeof D&&C>=D}],"filter-has":[Ii,[ei],(f,u)=>{let[m]=u;return m.value in f.properties()}],"filter-has-id":[Ii,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[Ii,[ie(Si)],(f,u)=>{let[m]=u;return m.value.indexOf(f.geometryType())>=0}],"filter-id-in":[Ii,[ie(ei)],(f,u)=>{let[m]=u;return m.value.indexOf(f.id())>=0}],"filter-in-small":[Ii,[Si,ie(ei)],(f,u)=>{let[m,C]=u;return C.value.indexOf(f.properties()[m.value])>=0}],"filter-in-large":[Ii,[Si,ie(ei)],(f,u)=>{let[m,C]=u;return function(D,Q,H,Z){for(;H<=Z;){const re=H+Z>>1;if(Q[re]===D)return!0;Q[re]>D?Z=re-1:H=re+1}return!1}(f.properties()[m.value],C.value,0,C.value.length-1)}],all:{type:Ii,overloads:[[[Ii,Ii],(f,u)=>{let[m,C]=u;return m.evaluate(f)&&C.evaluate(f)}],[da(Ii),(f,u)=>{for(const m of u)if(!m.evaluate(f))return!1;return!0}]]},any:{type:Ii,overloads:[[[Ii,Ii],(f,u)=>{let[m,C]=u;return m.evaluate(f)||C.evaluate(f)}],[da(Ii),(f,u)=>{for(const m of u)if(m.evaluate(f))return!0;return!1}]]},"!":[Ii,[Ii],(f,u)=>{let[m]=u;return!m.evaluate(f)}],"is-supported-script":[Ii,[Si],(f,u)=>{let[m]=u;const C=f.globals&&f.globals.isSupportedScript;return!C||C(m.evaluate(f))}],upcase:[Si,[Si],(f,u)=>{let[m]=u;return m.evaluate(f).toUpperCase()}],downcase:[Si,[Si],(f,u)=>{let[m]=u;return m.evaluate(f).toLowerCase()}],concat:[Si,da(ei),(f,u)=>u.map(m=>ao(m.evaluate(f))).join("")],"resolved-locale":[Si,[_r],(f,u)=>{let[m]=u;return m.evaluate(f).resolvedLocale()}]});class Pn{constructor(u,m){var C;this.expression=u,this._warningHistory={},this._evaluator=new po,this._defaultValue=m?(C=m).type==="color"&&pi(C.default)?new gr(0,0,0,0):C.type==="color"?gr.parse(C.default)||null:C.type==="padding"?Hn.parse(C.default)||null:C.type==="variableAnchorOffsetCollection"?Or.parse(C.default)||null:C.default===void 0?null:C.default:null,this._enumValues=m&&m.type==="enum"?m.values:null}evaluateWithoutErrorHandling(u,m,C,D,Q,H){return this._evaluator.globals=u,this._evaluator.feature=m,this._evaluator.featureState=C,this._evaluator.canonical=D,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=H,this.expression.evaluate(this._evaluator)}evaluate(u,m,C,D,Q,H){this._evaluator.globals=u,this._evaluator.feature=m||null,this._evaluator.featureState=C||null,this._evaluator.canonical=D,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=H||null;try{const Z=this.expression.evaluate(this._evaluator);if(Z==null||typeof Z=="number"&&Z!=Z)return this._defaultValue;if(this._enumValues&&!(Z in this._enumValues))throw new vr(`Expected value to be one of ${Object.keys(this._enumValues).map(re=>JSON.stringify(re)).join(", ")}, but found ${JSON.stringify(Z)} instead.`);return Z}catch(Z){return this._warningHistory[Z.message]||(this._warningHistory[Z.message]=!0,typeof console<"u"&&console.warn(Z.message)),this._defaultValue}}}function Fr(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in Aa}function Ir(f,u){const m=new Lr(Aa,To,[],u?function(D){const Q={color:Zt,string:Si,number:Qt,enum:Si,boolean:Ii,formatted:Zr,padding:Qe,resolvedImage:Be,variableAnchorOffsetCollection:ce};return D.type==="array"?ie(Q[D.value]||ei,D.length):Q[D.type]}(u):void 0),C=m.parse(f,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return C?ne(new Pn(C,u)):Pe(m.errors)}class Ps{constructor(u,m){this.kind=u,this._styleExpression=m,this.isStateDependent=u!=="constant"&&!gs(m.expression)}evaluateWithoutErrorHandling(u,m,C,D,Q,H){return this._styleExpression.evaluateWithoutErrorHandling(u,m,C,D,Q,H)}evaluate(u,m,C,D,Q,H){return this._styleExpression.evaluate(u,m,C,D,Q,H)}}class Xs{constructor(u,m,C,D){this.kind=u,this.zoomStops=C,this._styleExpression=m,this.isStateDependent=u!=="camera"&&!gs(m.expression),this.interpolationType=D}evaluateWithoutErrorHandling(u,m,C,D,Q,H){return this._styleExpression.evaluateWithoutErrorHandling(u,m,C,D,Q,H)}evaluate(u,m,C,D,Q,H){return this._styleExpression.evaluate(u,m,C,D,Q,H)}interpolationFactor(u,m,C){return this.interpolationType?hs.interpolationFactor(this.interpolationType,u,m,C):0}}function Lo(f,u){const m=Ir(f,u);if(m.result==="error")return m;const C=m.value.expression,D=Ea(C);if(!D&&!ct(u))return Pe([new hi("","data expressions not supported")]);const Q=Sa(C,["zoom"]);if(!Q&&!_t(u))return Pe([new hi("","zoom expressions not supported")]);const H=fa(C);return H||Q?H instanceof hi?Pe([H]):H instanceof hs&&!xt(u)?Pe([new hi("",'"interpolate" expressions cannot be used with this property')]):ne(H?new Xs(D?"camera":"composite",m.value,H.labels,H instanceof hs?H.interpolation:void 0):new Ps(D?"constant":"source",m.value)):Pe([new hi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ta{constructor(u,m){this._parameters=u,this._specification=m,Wi(this,nr(this._parameters,this._specification))}static deserialize(u){return new Ta(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function fa(f){let u=null;if(f instanceof cl)u=fa(f.result);else if(f instanceof jr){for(const m of f.args)if(u=fa(m),u)break}else(f instanceof ca||f instanceof hs)&&f.input instanceof ss&&f.input.name==="zoom"&&(u=f);return u instanceof hi||f.eachChild(m=>{const C=fa(m);C instanceof hi?u=C:!u&&C?u=new hi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):u&&C&&u!==C&&(u=new hi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),u}function _c(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(const u of f.slice(1))if(!_c(u)&&typeof u!="boolean")return!1;return!0;default:return!0}}const hl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ql(f){if(f==null)return{filter:()=>!0,needGeometry:!1};_c(f)||(f=ms(f));const u=Ir(f,hl);if(u.result==="error")throw new Error(u.value.map(m=>`${m.key}: ${m.message}`).join(", "));return{filter:(m,C,D)=>u.value.evaluate(m,C,{},D),needGeometry:Ia(f)}}function vc(f,u){return f<u?-1:f>u?1:0}function Ia(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(let u=1;u<f.length;u++)if(Ia(f[u]))return!0;return!1}function ms(f){if(!f)return!0;const u=f[0];return f.length<=1?u!=="any":u==="=="?Al(f[1],f[2],"=="):u==="!="?Ma(Al(f[1],f[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Al(f[1],f[2],u):u==="any"?(m=f.slice(1),["any"].concat(m.map(ms))):u==="all"?["all"].concat(f.slice(1).map(ms)):u==="none"?["all"].concat(f.slice(1).map(ms).map(Ma)):u==="in"?$l(f[1],f.slice(2)):u==="!in"?Ma($l(f[1],f.slice(2))):u==="has"?La(f[1]):u==="!has"?Ma(La(f[1])):u!=="within"||f;var m}function Al(f,u,m){switch(f){case"$type":return[`filter-type-${m}`,u];case"$id":return[`filter-id-${m}`,u];default:return[`filter-${m}`,f,u]}}function $l(f,u){if(u.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(m=>typeof m!=typeof u[0])?["filter-in-large",f,["literal",u.sort(vc)]]:["filter-in-small",f,["literal",u]]}}function La(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function Ma(f){return["!",f]}function Fs(f){const u=typeof f;if(u==="number"||u==="boolean"||u==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let D="[";for(const Q of f)D+=`${Fs(Q)},`;return`${D}]`}const m=Object.keys(f).sort();let C="{";for(let D=0;D<m.length;D++)C+=`${JSON.stringify(m[D])}:${Fs(f[m[D]])},`;return`${C}}`}function Uu(f){let u="";for(const m of Oi)u+=`/${Fs(f[m])}`;return u}function Ln(f){const u=f.value;return u?[new zt(f.key,u,"constants have been deprecated as of v8")]:[]}function fn(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function pn(f){if(Array.isArray(f))return f.map(pn);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){const u={};for(const m in f)u[m]=pn(f[m]);return u}return fn(f)}function As(f){const u=f.key,m=f.value,C=f.valueSpec||{},D=f.objectElementValidators||{},Q=f.style,H=f.styleSpec,Z=f.validateSpec;let re=[];const de=Lt(m);if(de!=="object")return[new zt(u,m,`object expected, ${de} found`)];for(const h in m){const c=h.split(".")[0],d=C[c]||C["*"];let _;if(D[c])_=D[c];else if(C[c])_=Z;else if(D["*"])_=D["*"];else{if(!C["*"]){re.push(new zt(u,m[h],`unknown property "${h}"`));continue}_=Z}re=re.concat(_({key:(u&&`${u}.`)+h,value:m[h],valueSpec:d,style:Q,styleSpec:H,object:m,objectKey:h,validateSpec:Z},m))}for(const h in C)D[h]||C[h].required&&C[h].default===void 0&&m[h]===void 0&&re.push(new zt(u,m,`missing required property "${h}"`));return re}function pa(f){const u=f.value,m=f.valueSpec,C=f.style,D=f.styleSpec,Q=f.key,H=f.arrayElementValidator||f.validateSpec;if(Lt(u)!=="array")return[new zt(Q,u,`array expected, ${Lt(u)} found`)];if(m.length&&u.length!==m.length)return[new zt(Q,u,`array length ${m.length} expected, length ${u.length} found`)];if(m["min-length"]&&u.length<m["min-length"])return[new zt(Q,u,`array length at least ${m["min-length"]} expected, length ${u.length} found`)];let Z={type:m.value,values:m.values};D.$version<7&&(Z.function=m.function),Lt(m.value)==="object"&&(Z=m.value);let re=[];for(let de=0;de<u.length;de++)re=re.concat(H({array:u,arrayIndex:de,value:u[de],valueSpec:Z,validateSpec:f.validateSpec,style:C,styleSpec:D,key:`${Q}[${de}]`}));return re}function Kl(f){const u=f.key,m=f.value,C=f.valueSpec;let D=Lt(m);return D==="number"&&m!=m&&(D="NaN"),D!=="number"?[new zt(u,m,`number expected, ${D} found`)]:"minimum"in C&&m<C.minimum?[new zt(u,m,`${m} is less than the minimum value ${C.minimum}`)]:"maximum"in C&&m>C.maximum?[new zt(u,m,`${m} is greater than the maximum value ${C.maximum}`)]:[]}function co(f){const u=f.valueSpec,m=fn(f.value.type);let C,D,Q,H={};const Z=m!=="categorical"&&f.value.property===void 0,re=!Z,de=Lt(f.value.stops)==="array"&&Lt(f.value.stops[0])==="array"&&Lt(f.value.stops[0][0])==="object",h=As({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(_){if(m==="identity")return[new zt(_.key,_.value,'identity function may not have a "stops" property')];let S=[];const M=_.value;return S=S.concat(pa({key:_.key,value:M,valueSpec:_.valueSpec,validateSpec:_.validateSpec,style:_.style,styleSpec:_.styleSpec,arrayElementValidator:c})),Lt(M)==="array"&&M.length===0&&S.push(new zt(_.key,M,"array must have at least one stop")),S},default:function(_){return _.validateSpec({key:_.key,value:_.value,valueSpec:u,validateSpec:_.validateSpec,style:_.style,styleSpec:_.styleSpec})}}});return m==="identity"&&Z&&h.push(new zt(f.key,f.value,'missing required property "property"')),m==="identity"||f.value.stops||h.push(new zt(f.key,f.value,'missing required property "stops"')),m==="exponential"&&f.valueSpec.expression&&!xt(f.valueSpec)&&h.push(new zt(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(re&&!ct(f.valueSpec)?h.push(new zt(f.key,f.value,"property functions not supported")):Z&&!_t(f.valueSpec)&&h.push(new zt(f.key,f.value,"zoom functions not supported"))),m!=="categorical"&&!de||f.value.property!==void 0||h.push(new zt(f.key,f.value,'"property" property is required')),h;function c(_){let S=[];const M=_.value,k=_.key;if(Lt(M)!=="array")return[new zt(k,M,`array expected, ${Lt(M)} found`)];if(M.length!==2)return[new zt(k,M,`array length 2 expected, length ${M.length} found`)];if(de){if(Lt(M[0])!=="object")return[new zt(k,M,`object expected, ${Lt(M[0])} found`)];if(M[0].zoom===void 0)return[new zt(k,M,"object stop key must have zoom")];if(M[0].value===void 0)return[new zt(k,M,"object stop key must have value")];if(Q&&Q>fn(M[0].zoom))return[new zt(k,M[0].zoom,"stop zoom values must appear in ascending order")];fn(M[0].zoom)!==Q&&(Q=fn(M[0].zoom),D=void 0,H={}),S=S.concat(As({key:`${k}[0]`,value:M[0],valueSpec:{zoom:{}},validateSpec:_.validateSpec,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{zoom:Kl,value:d}}))}else S=S.concat(d({key:`${k}[0]`,value:M[0],valueSpec:{},validateSpec:_.validateSpec,style:_.style,styleSpec:_.styleSpec},M));return Fr(pn(M[1]))?S.concat([new zt(`${k}[1]`,M[1],"expressions are not allowed in function stops.")]):S.concat(_.validateSpec({key:`${k}[1]`,value:M[1],valueSpec:u,validateSpec:_.validateSpec,style:_.style,styleSpec:_.styleSpec}))}function d(_,S){const M=Lt(_.value),k=fn(_.value),G=_.value!==null?_.value:S;if(C){if(M!==C)return[new zt(_.key,G,`${M} stop domain type must match previous stop domain type ${C}`)]}else C=M;if(M!=="number"&&M!=="string"&&M!=="boolean")return[new zt(_.key,G,"stop domain value must be a number, string, or boolean")];if(M!=="number"&&m!=="categorical"){let W=`number expected, ${M} found`;return ct(u)&&m===void 0&&(W+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new zt(_.key,G,W)]}return m!=="categorical"||M!=="number"||isFinite(k)&&Math.floor(k)===k?m!=="categorical"&&M==="number"&&D!==void 0&&k<D?[new zt(_.key,G,"stop domain values must appear in ascending order")]:(D=k,m==="categorical"&&k in H?[new zt(_.key,G,"stop domain values must be unique")]:(H[k]=!0,[])):[new zt(_.key,G,`integer expected, found ${k}`)]}}function ys(f){const u=(f.expressionContext==="property"?Lo:Ir)(pn(f.value),f.valueSpec);if(u.result==="error")return u.value.map(C=>new zt(`${f.key}${C.key}`,f.value,C.message));const m=u.value.expression||u.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!m.outputDefined())return[new zt(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!gs(m))return[new zt(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!gs(m))return[new zt(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!Sa(m,["zoom","feature-state"]))return[new zt(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!Ea(m))return[new zt(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ds(f){const u=f.key,m=f.value,C=f.valueSpec,D=[];return Array.isArray(C.values)?C.values.indexOf(fn(m))===-1&&D.push(new zt(u,m,`expected one of [${C.values.join(", ")}], ${JSON.stringify(m)} found`)):Object.keys(C.values).indexOf(fn(m))===-1&&D.push(new zt(u,m,`expected one of [${Object.keys(C.values).join(", ")}], ${JSON.stringify(m)} found`)),D}function Mo(f){return _c(pn(f.value))?ys(Wi({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):yo(f)}function yo(f){const u=f.value,m=f.key;if(Lt(u)!=="array")return[new zt(m,u,`array expected, ${Lt(u)} found`)];const C=f.styleSpec;let D,Q=[];if(u.length<1)return[new zt(m,u,"filter array must have at least 1 element")];switch(Q=Q.concat(ds({key:`${m}[0]`,value:u[0],valueSpec:C.filter_operator,style:f.style,styleSpec:f.styleSpec})),fn(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&fn(u[1])==="$type"&&Q.push(new zt(m,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&Q.push(new zt(m,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(D=Lt(u[1]),D!=="string"&&Q.push(new zt(`${m}[1]`,u[1],`string expected, ${D} found`)));for(let H=2;H<u.length;H++)D=Lt(u[H]),fn(u[1])==="$type"?Q=Q.concat(ds({key:`${m}[${H}]`,value:u[H],valueSpec:C.geometry_type,style:f.style,styleSpec:f.styleSpec})):D!=="string"&&D!=="number"&&D!=="boolean"&&Q.push(new zt(`${m}[${H}]`,u[H],`string, number, or boolean expected, ${D} found`));break;case"any":case"all":case"none":for(let H=1;H<u.length;H++)Q=Q.concat(yo({key:`${m}[${H}]`,value:u[H],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":D=Lt(u[1]),u.length!==2?Q.push(new zt(m,u,`filter array for "${u[0]}" operator must have 2 elements`)):D!=="string"&&Q.push(new zt(`${m}[1]`,u[1],`string expected, ${D} found`));break;case"within":D=Lt(u[1]),u.length!==2?Q.push(new zt(m,u,`filter array for "${u[0]}" operator must have 2 elements`)):D!=="object"&&Q.push(new zt(`${m}[1]`,u[1],`object expected, ${D} found`))}return Q}function ga(f,u){const m=f.key,C=f.validateSpec,D=f.style,Q=f.styleSpec,H=f.value,Z=f.objectKey,re=Q[`${u}_${f.layerType}`];if(!re)return[];const de=Z.match(/^(.*)-transition$/);if(u==="paint"&&de&&re[de[1]]&&re[de[1]].transition)return C({key:m,value:H,valueSpec:Q.transition,style:D,styleSpec:Q});const h=f.valueSpec||re[Z];if(!h)return[new zt(m,H,`unknown property "${Z}"`)];let c;if(Lt(H)==="string"&&ct(h)&&!h.tokens&&(c=/^{([^}]+)}$/.exec(H)))return[new zt(m,H,`"${Z}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const d=[];return f.layerType==="symbol"&&(Z==="text-field"&&D&&!D.glyphs&&d.push(new zt(m,H,'use of "text-field" requires a style "glyphs" property')),Z==="text-font"&&pi(pn(H))&&fn(H.type)==="identity"&&d.push(new zt(m,H,'"text-font" does not support identity functions'))),d.concat(C({key:f.key,value:H,valueSpec:h,style:D,styleSpec:Q,expressionContext:"property",propertyType:u,propertyKey:Z}))}function tl(f){return ga(f,"paint")}function Po(f){return ga(f,"layout")}function Js(f){let u=[];const m=f.value,C=f.key,D=f.style,Q=f.styleSpec;m.type||m.ref||u.push(new zt(C,m,'either "type" or "ref" is required'));let H=fn(m.type);const Z=fn(m.ref);if(m.id){const re=fn(m.id);for(let de=0;de<f.arrayIndex;de++){const h=D.layers[de];fn(h.id)===re&&u.push(new zt(C,m.id,`duplicate layer id "${m.id}", previously used at line ${h.id.__line__}`))}}if("ref"in m){let re;["type","source","source-layer","filter","layout"].forEach(de=>{de in m&&u.push(new zt(C,m[de],`"${de}" is prohibited for ref layers`))}),D.layers.forEach(de=>{fn(de.id)===Z&&(re=de)}),re?re.ref?u.push(new zt(C,m.ref,"ref cannot reference another ref layer")):H=fn(re.type):u.push(new zt(C,m.ref,`ref layer "${Z}" not found`))}else if(H!=="background")if(m.source){const re=D.sources&&D.sources[m.source],de=re&&fn(re.type);re?de==="vector"&&H==="raster"?u.push(new zt(C,m.source,`layer "${m.id}" requires a raster source`)):de!=="raster-dem"&&H==="hillshade"?u.push(new zt(C,m.source,`layer "${m.id}" requires a raster-dem source`)):de==="raster"&&H!=="raster"?u.push(new zt(C,m.source,`layer "${m.id}" requires a vector source`)):de!=="vector"||m["source-layer"]?de==="raster-dem"&&H!=="hillshade"?u.push(new zt(C,m.source,"raster-dem source can only be used with layer type 'hillshade'.")):H!=="line"||!m.paint||!m.paint["line-gradient"]||de==="geojson"&&re.lineMetrics||u.push(new zt(C,m,`layer "${m.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):u.push(new zt(C,m,`layer "${m.id}" must specify a "source-layer"`)):u.push(new zt(C,m.source,`source "${m.source}" not found`))}else u.push(new zt(C,m,'missing required property "source"'));return u=u.concat(As({key:C,value:m,valueSpec:Q.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${C}.type`,value:m.type,valueSpec:Q.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:m,objectKey:"type"}),filter:Mo,layout:re=>As({layer:m,key:re.key,value:re.value,style:re.style,styleSpec:re.styleSpec,validateSpec:re.validateSpec,objectElementValidators:{"*":de=>Po(Wi({layerType:H},de))}}),paint:re=>As({layer:m,key:re.key,value:re.value,style:re.style,styleSpec:re.styleSpec,validateSpec:re.validateSpec,objectElementValidators:{"*":de=>tl(Wi({layerType:H},de))}})}})),u}function js(f){const u=f.value,m=f.key,C=Lt(u);return C!=="string"?[new zt(m,u,`string expected, ${C} found`)]:[]}const _s={promoteId:function(f){let{key:u,value:m}=f;if(Lt(m)==="string")return js({key:u,value:m});{const C=[];for(const D in m)C.push(...js({key:`${u}.${D}`,value:m[D]}));return C}}};function uo(f){const u=f.value,m=f.key,C=f.styleSpec,D=f.style,Q=f.validateSpec;if(!u.type)return[new zt(m,u,'"type" is required')];const H=fn(u.type);let Z;switch(H){case"vector":case"raster":return Z=As({key:m,value:u,valueSpec:C[`source_${H.replace("-","_")}`],style:f.style,styleSpec:C,objectElementValidators:_s,validateSpec:Q}),Z;case"raster-dem":return Z=function(re){var de;const h=(de=re.sourceName)!==null&&de!==void 0?de:"",c=re.value,d=re.styleSpec,_=d.source_raster_dem,S=re.style;let M=[];const k=Lt(c);if(c===void 0)return M;if(k!=="object")return M.push(new zt("source_raster_dem",c,`object expected, ${k} found`)),M;const G=fn(c.encoding)==="custom",W=["redFactor","greenFactor","blueFactor","baseShift"],Y=re.value.encoding?`"${re.value.encoding}"`:"Default";for(const ae in c)!G&&W.includes(ae)?M.push(new zt(ae,c[ae],`In "${h}": "${ae}" is only valid when "encoding" is set to "custom". ${Y} encoding found`)):_[ae]?M=M.concat(re.validateSpec({key:ae,value:c[ae],valueSpec:_[ae],validateSpec:re.validateSpec,style:S,styleSpec:d})):M.push(new zt(ae,c[ae],`unknown property "${ae}"`));return M}({sourceName:m,value:u,style:f.style,styleSpec:C,validateSpec:Q}),Z;case"geojson":if(Z=As({key:m,value:u,valueSpec:C.source_geojson,style:D,styleSpec:C,validateSpec:Q,objectElementValidators:_s}),u.cluster)for(const re in u.clusterProperties){const[de,h]=u.clusterProperties[re],c=typeof de=="string"?[de,["accumulated"],["get",re]]:de;Z.push(...ys({key:`${m}.${re}.map`,value:h,validateSpec:Q,expressionContext:"cluster-map"})),Z.push(...ys({key:`${m}.${re}.reduce`,value:c,validateSpec:Q,expressionContext:"cluster-reduce"}))}return Z;case"video":return As({key:m,value:u,valueSpec:C.source_video,style:D,validateSpec:Q,styleSpec:C});case"image":return As({key:m,value:u,valueSpec:C.source_image,style:D,validateSpec:Q,styleSpec:C});case"canvas":return[new zt(m,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ds({key:`${m}.type`,value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:D,validateSpec:Q,styleSpec:C})}}function Pa(f){const u=f.value,m=f.styleSpec,C=m.light,D=f.style;let Q=[];const H=Lt(u);if(u===void 0)return Q;if(H!=="object")return Q=Q.concat([new zt("light",u,`object expected, ${H} found`)]),Q;for(const Z in u){const re=Z.match(/^(.*)-transition$/);Q=Q.concat(re&&C[re[1]]&&C[re[1]].transition?f.validateSpec({key:Z,value:u[Z],valueSpec:m.transition,validateSpec:f.validateSpec,style:D,styleSpec:m}):C[Z]?f.validateSpec({key:Z,value:u[Z],valueSpec:C[Z],validateSpec:f.validateSpec,style:D,styleSpec:m}):[new zt(Z,u[Z],`unknown property "${Z}"`)])}return Q}function dl(f){const u=f.value,m=f.styleSpec,C=m.sky,D=f.style,Q=Lt(u);if(u===void 0)return[];if(Q!=="object")return[new zt("sky",u,`object expected, ${Q} found`)];let H=[];for(const Z in u)H=H.concat(C[Z]?ln({key:Z,value:u[Z],valueSpec:C[Z],style:D,styleSpec:m}):[new zt(Z,u[Z],`unknown property "${Z}"`)]);return H}function Wl(f){const u=f.value,m=f.styleSpec,C=m.terrain,D=f.style;let Q=[];const H=Lt(u);if(u===void 0)return Q;if(H!=="object")return Q=Q.concat([new zt("terrain",u,`object expected, ${H} found`)]),Q;for(const Z in u)Q=Q.concat(C[Z]?f.validateSpec({key:Z,value:u[Z],valueSpec:C[Z],validateSpec:f.validateSpec,style:D,styleSpec:m}):[new zt(Z,u[Z],`unknown property "${Z}"`)]);return Q}function Ds(f){let u=[];const m=f.value,C=f.key;if(Array.isArray(m)){const D=[],Q=[];for(const H in m)m[H].id&&D.includes(m[H].id)&&u.push(new zt(C,m,`all the sprites' ids must be unique, but ${m[H].id} is duplicated`)),D.push(m[H].id),m[H].url&&Q.includes(m[H].url)&&u.push(new zt(C,m,`all the sprites' URLs must be unique, but ${m[H].url} is duplicated`)),Q.push(m[H].url),u=u.concat(As({key:`${C}[${H}]`,value:m[H],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return u}return js({key:C,value:m})}const Xo={"*":()=>[],array:pa,boolean:function(f){const u=f.value,m=f.key,C=Lt(u);return C!=="boolean"?[new zt(m,u,`boolean expected, ${C} found`)]:[]},number:Kl,color:function(f){const u=f.key,m=f.value,C=Lt(m);return C!=="string"?[new zt(u,m,`color expected, ${C} found`)]:gr.parse(String(m))?[]:[new zt(u,m,`color expected, "${m}" found`)]},constants:Ln,enum:ds,filter:Mo,function:co,layer:Js,object:As,source:uo,light:Pa,sky:dl,terrain:Wl,string:js,formatted:function(f){return js(f).length===0?[]:ys(f)},resolvedImage:function(f){return js(f).length===0?[]:ys(f)},padding:function(f){const u=f.key,m=f.value;if(Lt(m)==="array"){if(m.length<1||m.length>4)return[new zt(u,m,`padding requires 1 to 4 values; ${m.length} values found`)];const C={type:"number"};let D=[];for(let Q=0;Q<m.length;Q++)D=D.concat(f.validateSpec({key:`${u}[${Q}]`,value:m[Q],validateSpec:f.validateSpec,valueSpec:C}));return D}return Kl({key:u,value:m,valueSpec:{}})},variableAnchorOffsetCollection:function(f){const u=f.key,m=f.value,C=Lt(m),D=f.styleSpec;if(C!=="array"||m.length<1||m.length%2!=0)return[new zt(u,m,"variableAnchorOffsetCollection requires a non-empty array of even length")];let Q=[];for(let H=0;H<m.length;H+=2)Q=Q.concat(ds({key:`${u}[${H}]`,value:m[H],valueSpec:D.layout_symbol["text-anchor"]})),Q=Q.concat(pa({key:`${u}[${H+1}]`,value:m[H+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:D}));return Q},sprite:Ds};function ln(f){const u=f.value,m=f.valueSpec,C=f.styleSpec;return f.validateSpec=ln,m.expression&&pi(fn(u))?co(f):m.expression&&Fr(pn(u))?ys(f):m.type&&Xo[m.type]?Xo[m.type](f):As(Wi({},f,{valueSpec:m.type?C[m.type]:m}))}function qn(f){const u=f.value,m=f.key,C=js(f);return C.length||(u.indexOf("{fontstack}")===-1&&C.push(new zt(m,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&C.push(new zt(m,u,'"glyphs" url must include a "{range}" token'))),C}function os(f){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wt,m=[];return m=m.concat(ln({key:"",value:f,valueSpec:u.$root,styleSpec:u,style:f,validateSpec:ln,objectElementValidators:{glyphs:qn,"*":()=>[]}})),f.constants&&(m=m.concat(Ln({key:"constants",value:f.constants,style:f,styleSpec:u,validateSpec:ln}))),en(m)}function Ur(f){return function(u){return f({...u,validateSpec:ln})}}function en(f){return[].concat(f).sort((u,m)=>u.line-m.line)}function nn(f){return function(){for(var u=arguments.length,m=new Array(u),C=0;C<u;C++)m[C]=arguments[C];return en(f.apply(this,m))}}os.source=nn(Ur(uo)),os.sprite=nn(Ur(Ds)),os.glyphs=nn(Ur(qn)),os.light=nn(Ur(Pa)),os.sky=nn(Ur(dl)),os.terrain=nn(Ur(Wl)),os.layer=nn(Ur(Js)),os.filter=nn(Ur(Mo)),os.paintProperty=nn(Ur(tl)),os.layoutProperty=nn(Ur(Po));const Nn=os,ma=Nn.light,Fa=Nn.paintProperty,Jo=Nn.layoutProperty;function Yo(f,u){let m=!1;if(u&&u.length)for(const C of u)f.fire(new kt(new Error(C.message))),m=!0;return m}class Ui{constructor(u,m,C){const D=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;const H=new Int32Array(this.arrayBuffer);u=H[0],this.d=(m=H[1])+2*(C=H[2]);for(let re=0;re<this.d*this.d;re++){const de=H[3+re],h=H[3+re+1];D.push(de===h?null:H.subarray(de,h))}const Z=H[3+D.length+1];this.keys=H.subarray(H[3+D.length],Z),this.bboxes=H.subarray(Z),this.insert=this._insertReadonly}else{this.d=m+2*C;for(let H=0;H<this.d*this.d;H++)D.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=u,this.padding=C,this.scale=m/u,this.uid=0;const Q=C/m*u;this.min=-Q,this.max=u+Q}insert(u,m,C,D,Q){this._forEachCell(m,C,D,Q,this._insertCell,this.uid++,void 0,void 0),this.keys.push(u),this.bboxes.push(m),this.bboxes.push(C),this.bboxes.push(D),this.bboxes.push(Q)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(u,m,C,D,Q,H){this.cells[Q].push(H)}query(u,m,C,D,Q){const H=this.min,Z=this.max;if(u<=H&&m<=H&&Z<=C&&Z<=D&&!Q)return Array.prototype.slice.call(this.keys);{const re=[];return this._forEachCell(u,m,C,D,this._queryCell,re,{},Q),re}}_queryCell(u,m,C,D,Q,H,Z,re){const de=this.cells[Q];if(de!==null){const h=this.keys,c=this.bboxes;for(let d=0;d<de.length;d++){const _=de[d];if(Z[_]===void 0){const S=4*_;(re?re(c[S+0],c[S+1],c[S+2],c[S+3]):u<=c[S+2]&&m<=c[S+3]&&C>=c[S+0]&&D>=c[S+1])?(Z[_]=!0,H.push(h[_])):Z[_]=!1}}}}_forEachCell(u,m,C,D,Q,H,Z,re){const de=this._convertToCellCoord(u),h=this._convertToCellCoord(m),c=this._convertToCellCoord(C),d=this._convertToCellCoord(D);for(let _=de;_<=c;_++)for(let S=h;S<=d;S++){const M=this.d*S+_;if((!re||re(this._convertFromCellCoord(_),this._convertFromCellCoord(S),this._convertFromCellCoord(_+1),this._convertFromCellCoord(S+1)))&&Q.call(this,u,m,C,D,M,H,Z,re))return}}_convertFromCellCoord(u){return(u-this.padding)/this.scale}_convertToCellCoord(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const u=this.cells,m=3+this.cells.length+1+1;let C=0;for(let H=0;H<this.cells.length;H++)C+=this.cells[H].length;const D=new Int32Array(m+C+this.keys.length+this.bboxes.length);D[0]=this.extent,D[1]=this.n,D[2]=this.padding;let Q=m;for(let H=0;H<u.length;H++){const Z=u[H];D[3+H]=Q,D.set(Z,Q),Q+=Z.length}return D[3+u.length]=Q,D.set(this.keys,Q),Q+=this.keys.length,D[3+u.length+1]=Q,D.set(this.bboxes,Q),Q+=this.bboxes.length,D.buffer}static serialize(u,m){const C=u.toArrayBuffer();return m&&m.push(C),{buffer:C}}static deserialize(u){return new Ui(u.buffer)}}const ya={};function Di(f,u){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(ya[f])throw new Error(`${f} is already registered.`);Object.defineProperty(u,"_classRegistryKey",{value:f,writeable:!1}),ya[f]={klass:u,omit:m.omit||[],shallow:m.shallow||[]}}Di("Object",Object),Di("TransferableGridIndex",Ui),Di("Color",gr),Di("Error",Error),Di("AJAXError",Dt),Di("ResolvedImage",Bn),Di("StylePropertyFunction",Ta),Di("StyleExpression",Pn,{omit:["_evaluator"]}),Di("ZoomDependentExpression",Xs),Di("ZoomConstantExpression",Ps),Di("CompoundExpression",ss,{omit:["_evaluate"]});for(const f in Aa)Aa[f]._classRegistryKey||Di(`Expression_${f}`,Aa[f]);function fl(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function pl(f,u){if(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error)return f;if(fl(f)||bt(f))return u&&u.push(f),f;if(ArrayBuffer.isView(f)){const m=f;return u&&u.push(m.buffer),m}if(f instanceof ImageData)return u&&u.push(f.data.buffer),f;if(Array.isArray(f)){const m=[];for(const C of f)m.push(pl(C,u));return m}if(typeof f=="object"){const m=f.constructor,C=m._classRegistryKey;if(!C)throw new Error(`can't serialize object of unregistered class ${m.name}`);if(!ya[C])throw new Error(`${C} is not registered.`);const D=m.serialize?m.serialize(f,u):{};if(m.serialize){if(u&&D===u[u.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Q in f){if(!f.hasOwnProperty(Q)||ya[C].omit.indexOf(Q)>=0)continue;const H=f[Q];D[Q]=ya[C].shallow.indexOf(Q)>=0?H:pl(H,u)}f instanceof Error&&(D.message=f.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(D.$name=C),D}throw new Error("can't serialize object of type "+typeof f)}function Li(f){if(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||fl(f)||bt(f)||ArrayBuffer.isView(f)||f instanceof ImageData)return f;if(Array.isArray(f))return f.map(Li);if(typeof f=="object"){const u=f.$name||"Object";if(!ya[u])throw new Error(`can't deserialize unregistered class ${u}`);const{klass:m}=ya[u];if(!m)throw new Error(`can't deserialize unregistered class ${u}`);if(m.deserialize)return m.deserialize(f);const C=Object.create(m.prototype);for(const D of Object.keys(f)){if(D==="$name")continue;const Q=f[D];C[D]=ya[u].shallow.indexOf(D)>=0?Q:Li(Q)}return C}throw new Error("can't deserialize object of type "+typeof f)}class bc{constructor(){this.first=!0}update(u,m){const C=Math.floor(u);return this.first?(this.first=!1,this.lastIntegerZoom=C,this.lastIntegerZoomTime=0,this.lastZoom=u,this.lastFloorZoom=C,!0):(this.lastFloorZoom>C?(this.lastIntegerZoom=C+1,this.lastIntegerZoomTime=m):this.lastFloorZoom<C&&(this.lastIntegerZoom=C,this.lastIntegerZoomTime=m),u!==this.lastZoom&&(this.lastZoom=u,this.lastFloorZoom=C,!0))}}const Fi={"Latin-1 Supplement":f=>f>=128&&f<=255,Arabic:f=>f>=1536&&f<=1791,"Arabic Supplement":f=>f>=1872&&f<=1919,"Arabic Extended-A":f=>f>=2208&&f<=2303,"Hangul Jamo":f=>f>=4352&&f<=4607,"Unified Canadian Aboriginal Syllabics":f=>f>=5120&&f<=5759,Khmer:f=>f>=6016&&f<=6143,"Unified Canadian Aboriginal Syllabics Extended":f=>f>=6320&&f<=6399,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"CJK Radicals Supplement":f=>f>=11904&&f<=12031,"Kangxi Radicals":f=>f>=12032&&f<=12255,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Hiragana:f=>f>=12352&&f<=12447,Katakana:f=>f>=12448&&f<=12543,Bopomofo:f=>f>=12544&&f<=12591,"Hangul Compatibility Jamo":f=>f>=12592&&f<=12687,Kanbun:f=>f>=12688&&f<=12703,"Bopomofo Extended":f=>f>=12704&&f<=12735,"CJK Strokes":f=>f>=12736&&f<=12783,"Katakana Phonetic Extensions":f=>f>=12784&&f<=12799,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"CJK Unified Ideographs Extension A":f=>f>=13312&&f<=19903,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"CJK Unified Ideographs":f=>f>=19968&&f<=40959,"Yi Syllables":f=>f>=40960&&f<=42127,"Yi Radicals":f=>f>=42128&&f<=42191,"Hangul Jamo Extended-A":f=>f>=43360&&f<=43391,"Hangul Syllables":f=>f>=44032&&f<=55215,"Hangul Jamo Extended-B":f=>f>=55216&&f<=55295,"Private Use Area":f=>f>=57344&&f<=63743,"CJK Compatibility Ideographs":f=>f>=63744&&f<=64255,"Arabic Presentation Forms-A":f=>f>=64336&&f<=65023,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Arabic Presentation Forms-B":f=>f>=65136&&f<=65279,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function Ys(f){for(const u of f)if(Zl(u.charCodeAt(0)))return!0;return!1}function eo(f){for(const u of f)if(!zc(u.charCodeAt(0)))return!1;return!0}function zc(f){return!(Fi.Arabic(f)||Fi["Arabic Supplement"](f)||Fi["Arabic Extended-A"](f)||Fi["Arabic Presentation Forms-A"](f)||Fi["Arabic Presentation Forms-B"](f))}function Zl(f){return!(f!==746&&f!==747&&(f<4352||!(Fi["Bopomofo Extended"](f)||Fi.Bopomofo(f)||Fi["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||Fi["CJK Compatibility Ideographs"](f)||Fi["CJK Compatibility"](f)||Fi["CJK Radicals Supplement"](f)||Fi["CJK Strokes"](f)||!(!Fi["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||Fi["CJK Unified Ideographs Extension A"](f)||Fi["CJK Unified Ideographs"](f)||Fi["Enclosed CJK Letters and Months"](f)||Fi["Hangul Compatibility Jamo"](f)||Fi["Hangul Jamo Extended-A"](f)||Fi["Hangul Jamo Extended-B"](f)||Fi["Hangul Jamo"](f)||Fi["Hangul Syllables"](f)||Fi.Hiragana(f)||Fi["Ideographic Description Characters"](f)||Fi.Kanbun(f)||Fi["Kangxi Radicals"](f)||Fi["Katakana Phonetic Extensions"](f)||Fi.Katakana(f)&&f!==12540||!(!Fi["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!Fi["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||Fi["Unified Canadian Aboriginal Syllabics"](f)||Fi["Unified Canadian Aboriginal Syllabics Extended"](f)||Fi["Vertical Forms"](f)||Fi["Yijing Hexagram Symbols"](f)||Fi["Yi Syllables"](f)||Fi["Yi Radicals"](f))))}function du(f){return!(Zl(f)||function(u){return!!(Fi["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||Fi["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Fi["Letterlike Symbols"](u)||Fi["Number Forms"](u)||Fi["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||Fi["Control Pictures"](u)&&u!==9251||Fi["Optical Character Recognition"](u)||Fi["Enclosed Alphanumerics"](u)||Fi["Geometric Shapes"](u)||Fi["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Fi["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Fi["CJK Symbols and Punctuation"](u)||Fi.Katakana(u)||Fi["Private Use Area"](u)||Fi["CJK Compatibility Forms"](u)||Fi["Small Form Variants"](u)||Fi["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(f))}function Qc(f){return f>=1424&&f<=2303||Fi["Arabic Presentation Forms-A"](f)||Fi["Arabic Presentation Forms-B"](f)}function Xl(f,u){return!(!u&&Qc(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||Fi.Khmer(f))}function Vc(f){for(const u of f)if(Qc(u.charCodeAt(0)))return!0;return!1}const il=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class vn{constructor(u,m){this.zoom=u,m?(this.now=m.now,this.fadeDuration=m.fadeDuration,this.zoomHistory=m.zoomHistory,this.transition=m.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bc,this.transition={})}isSupportedScript(u){return function(m,C){for(const D of m)if(!Xl(D.charCodeAt(0),C))return!1;return!0}(u,il.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const u=this.zoom,m=u-Math.floor(u),C=this.crossFadingFactor();return u>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:m+(1-m)*C}:{fromScale:.5,toScale:1,t:1-(1-C)*m}}}class Rs{constructor(u,m){this.property=u,this.value=m,this.expression=function(C,D){if(pi(C))return new Ta(C,D);if(Fr(C)){const Q=Lo(C,D);if(Q.result==="error")throw new Error(Q.value.map(H=>`${H.key}: ${H.message}`).join(", "));return Q.value}{let Q=C;return D.type==="color"&&typeof C=="string"?Q=gr.parse(C):D.type!=="padding"||typeof C!="number"&&!Array.isArray(C)?D.type==="variableAnchorOffsetCollection"&&Array.isArray(C)&&(Q=Or.parse(C)):Q=Hn.parse(C),{kind:"constant",evaluate:()=>Q}}}(m===void 0?u.specification.default:m,u.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(u,m,C){return this.property.possiblyEvaluate(this,u,m,C)}}class Fo{constructor(u){this.property=u,this.value=new Rs(u,void 0)}transitioned(u,m){return new fu(this.property,this.value,m,We({},u.transition,this.transition),u.now)}untransitioned(){return new fu(this.property,this.value,null,{},0)}}class gl{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return ke(this._values[u].value.value)}setValue(u,m){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Fo(this._values[u].property)),this._values[u].value=new Rs(this._values[u].property,m===null?void 0:ke(m))}getTransition(u){return ke(this._values[u].transition)}setTransition(u,m){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Fo(this._values[u].property)),this._values[u].transition=ke(m)||void 0}serialize(){const u={};for(const m of Object.keys(this._values)){const C=this.getValue(m);C!==void 0&&(u[m]=C);const D=this.getTransition(m);D!==void 0&&(u[`${m}-transition`]=D)}return u}transitioned(u,m){const C=new Hc(this._properties);for(const D of Object.keys(this._values))C._values[D]=this._values[D].transitioned(u,m._values[D]);return C}untransitioned(){const u=new Hc(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].untransitioned();return u}}class fu{constructor(u,m,C,D,Q){this.property=u,this.value=m,this.begin=Q+D.delay||0,this.end=this.begin+D.duration||0,u.specification.transition&&(D.delay||D.duration)&&(this.prior=C)}possiblyEvaluate(u,m,C){const D=u.now||0,Q=this.value.possiblyEvaluate(u,m,C),H=this.prior;if(H){if(D>this.end)return this.prior=null,Q;if(this.value.isDataDriven())return this.prior=null,Q;if(D<this.begin)return H.possiblyEvaluate(u,m,C);{const Z=(D-this.begin)/(this.end-this.begin);return this.property.interpolate(H.possiblyEvaluate(u,m,C),Q,function(re){if(re<=0)return 0;if(re>=1)return 1;const de=re*re,h=de*re;return 4*(re<.5?h:3*(re-de)+h-.75)}(Z))}}return Q}}class Hc{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,m,C){const D=new to(this._properties);for(const Q of Object.keys(this._values))D._values[Q]=this._values[Q].possiblyEvaluate(u,m,C);return D}hasTransition(){for(const u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class Nu{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}hasValue(u){return this._values[u].value!==void 0}getValue(u){return ke(this._values[u].value)}setValue(u,m){this._values[u]=new Rs(this._values[u].property,m===null?void 0:ke(m))}serialize(){const u={};for(const m of Object.keys(this._values)){const C=this.getValue(m);C!==void 0&&(u[m]=C)}return u}possiblyEvaluate(u,m,C){const D=new to(this._properties);for(const Q of Object.keys(this._values))D._values[Q]=this._values[Q].possiblyEvaluate(u,m,C);return D}}class _a{constructor(u,m,C){this.property=u,this.value=m,this.parameters=C}isConstant(){return this.value.kind==="constant"}constantOr(u){return this.value.kind==="constant"?this.value.value:u}evaluate(u,m,C,D){return this.property.evaluate(this.value,this.parameters,u,m,C,D)}}class to{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class Ei{constructor(u){this.specification=u}possiblyEvaluate(u,m){if(u.isDataDriven())throw new Error("Value should not be data driven");return u.expression.evaluate(m)}interpolate(u,m,C){const D=En[this.specification.type];return D?D(u,m,C):u}}class sr{constructor(u,m){this.specification=u,this.overrides=m}possiblyEvaluate(u,m,C,D){return new _a(this,u.expression.kind==="constant"||u.expression.kind==="camera"?{kind:"constant",value:u.expression.evaluate(m,null,{},C,D)}:u.expression,m)}interpolate(u,m,C){if(u.value.kind!=="constant"||m.value.kind!=="constant")return u;if(u.value.value===void 0||m.value.value===void 0)return new _a(this,{kind:"constant",value:void 0},u.parameters);const D=En[this.specification.type];if(D){const Q=D(u.value.value,m.value.value,C);return new _a(this,{kind:"constant",value:Q},u.parameters)}return u}evaluate(u,m,C,D,Q,H){return u.kind==="constant"?u.value:u.evaluate(m,C,D,Q,H)}}class ml extends sr{possiblyEvaluate(u,m,C,D){if(u.value===void 0)return new _a(this,{kind:"constant",value:void 0},m);if(u.expression.kind==="constant"){const Q=u.expression.evaluate(m,null,{},C,D),H=u.property.specification.type==="resolvedImage"&&typeof Q!="string"?Q.name:Q,Z=this._calculate(H,H,H,m);return new _a(this,{kind:"constant",value:Z},m)}if(u.expression.kind==="camera"){const Q=this._calculate(u.expression.evaluate({zoom:m.zoom-1}),u.expression.evaluate({zoom:m.zoom}),u.expression.evaluate({zoom:m.zoom+1}),m);return new _a(this,{kind:"constant",value:Q},m)}return new _a(this,u.expression,m)}evaluate(u,m,C,D,Q,H){if(u.kind==="source"){const Z=u.evaluate(m,C,D,Q,H);return this._calculate(Z,Z,Z,m)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(m.zoom)-1},C,D),u.evaluate({zoom:Math.floor(m.zoom)},C,D),u.evaluate({zoom:Math.floor(m.zoom)+1},C,D),m):u.value}_calculate(u,m,C,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:u,to:m}:{from:C,to:m}}interpolate(u){return u}}class Gc{constructor(u){this.specification=u}possiblyEvaluate(u,m,C,D){if(u.value!==void 0){if(u.expression.kind==="constant"){const Q=u.expression.evaluate(m,null,{},C,D);return this._calculate(Q,Q,Q,m)}return this._calculate(u.expression.evaluate(new vn(Math.floor(m.zoom-1),m)),u.expression.evaluate(new vn(Math.floor(m.zoom),m)),u.expression.evaluate(new vn(Math.floor(m.zoom+1),m)),m)}}_calculate(u,m,C,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:u,to:m}:{from:C,to:m}}interpolate(u){return u}}class Jl{constructor(u){this.specification=u}possiblyEvaluate(u,m,C,D){return!!u.expression.evaluate(m,null,{},C,D)}interpolate(){return!1}}class ks{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const m in u){const C=u[m];C.specification.overridable&&this.overridableProperties.push(m);const D=this.defaultPropertyValues[m]=new Rs(C,void 0),Q=this.defaultTransitionablePropertyValues[m]=new Fo(C);this.defaultTransitioningPropertyValues[m]=Q.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=D.possiblyEvaluate({})}}}Di("DataDrivenProperty",sr),Di("DataConstantProperty",Ei),Di("CrossFadedDataDrivenProperty",ml),Di("CrossFadedProperty",Gc),Di("ColorRampProperty",Jl);const nA="-transition";class $n extends lt{constructor(u,m){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1},u.type!=="custom"&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),m.layout&&(this._unevaluatedLayout=new Nu(m.layout)),m.paint)){this._transitionablePaint=new gl(m.paint);for(const C in u.paint)this.setPaintProperty(C,u.paint[C],{validate:!1});for(const C in u.layout)this.setLayoutProperty(C,u.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new to(m.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};m!=null&&this._validate(Jo,`layers.${this.id}.layout.${u}`,u,m,C)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,m):this.visibility=m)}getPaintProperty(u){return u.endsWith(nA)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(m!=null&&this._validate(Fa,`layers.${this.id}.paint.${u}`,u,m,C))return!1;if(u.endsWith(nA))return this._transitionablePaint.setTransition(u.slice(0,-11),m||void 0),!1;{const D=this._transitionablePaint._values[u],Q=D.property.specification["property-type"]==="cross-faded-data-driven",H=D.value.isDataDriven(),Z=D.value;this._transitionablePaint.setValue(u,m),this._handleSpecialPaintPropertyUpdate(u);const re=this._transitionablePaint._values[u].value;return re.isDataDriven()||H||Q||this._handleOverridablePaintPropertyUpdate(u,Z,re)}}_handleSpecialPaintPropertyUpdate(u){}_handleOverridablePaintPropertyUpdate(u,m,C){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,m){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,m)}serialize(){const u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),nt(u,(m,C)=>!(m===void 0||C==="layout"&&!Object.keys(m).length||C==="paint"&&!Object.keys(m).length))}_validate(u,m,C,D){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!Q||Q.validate!==!1)&&Yo(this,u.call(Nn,{key:m,layerType:this.type,objectKey:C,value:D,styleSpec:wt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const u in this.paint._values){const m=this.paint.get(u);if(m instanceof _a&&ct(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1}}const jc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $i{constructor(u,m){this._structArray=u,this._pos1=m*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,m){return u._trim(),m&&(u.isTransferred=!0,m.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){const m=Object.create(this.prototype);return m.arrayBuffer=u.arrayBuffer,m.length=u.length,m.capacity=u.arrayBuffer.byteLength/m.bytesPerElement,m._refreshViews(),m}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const m=this.uint8;this._refreshViews(),m&&this.uint8.set(m)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Kn(f){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,m=0,C=0;return{members:f.map(D=>{const Q=jc[D.type].BYTES_PER_ELEMENT,H=m=zu(m,Math.max(u,Q)),Z=D.components||1;return C=Math.max(C,Q),m+=Q*Z,{name:D.name,type:D.type,components:Z,offset:H}}),size:zu(m,Math.max(C,u)),alignment:u}}function zu(f,u){return Math.ceil(f/u)*u}class Do extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const D=2*u;return this.int16[D+0]=m,this.int16[D+1]=C,u}}Do.prototype.bytesPerElement=4,Di("StructArrayLayout2i4",Do);class sn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=3*u;return this.int16[Q+0]=m,this.int16[Q+1]=C,this.int16[Q+2]=D,u}}sn.prototype.bytesPerElement=6,Di("StructArrayLayout3i6",sn);class qs extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,D)}emplace(u,m,C,D,Q){const H=4*u;return this.int16[H+0]=m,this.int16[H+1]=C,this.int16[H+2]=D,this.int16[H+3]=Q,u}}qs.prototype.bytesPerElement=8,Di("StructArrayLayout4i8",qs);class Ro extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H){const Z=this.length;return this.resize(Z+1),this.emplace(Z,u,m,C,D,Q,H)}emplace(u,m,C,D,Q,H,Z){const re=6*u;return this.int16[re+0]=m,this.int16[re+1]=C,this.int16[re+2]=D,this.int16[re+3]=Q,this.int16[re+4]=H,this.int16[re+5]=Z,u}}Ro.prototype.bytesPerElement=12,Di("StructArrayLayout2i4i12",Ro);class pu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H){const Z=this.length;return this.resize(Z+1),this.emplace(Z,u,m,C,D,Q,H)}emplace(u,m,C,D,Q,H,Z){const re=4*u,de=8*u;return this.int16[re+0]=m,this.int16[re+1]=C,this.uint8[de+4]=D,this.uint8[de+5]=Q,this.uint8[de+6]=H,this.uint8[de+7]=Z,u}}pu.prototype.bytesPerElement=8,Di("StructArrayLayout2i4ub8",pu);class $s extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const D=2*u;return this.float32[D+0]=m,this.float32[D+1]=C,u}}$s.prototype.bytesPerElement=8,Di("StructArrayLayout2f8",$s);class Jr extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,Z,re,de,h){const c=this.length;return this.resize(c+1),this.emplace(c,u,m,C,D,Q,H,Z,re,de,h)}emplace(u,m,C,D,Q,H,Z,re,de,h,c){const d=10*u;return this.uint16[d+0]=m,this.uint16[d+1]=C,this.uint16[d+2]=D,this.uint16[d+3]=Q,this.uint16[d+4]=H,this.uint16[d+5]=Z,this.uint16[d+6]=re,this.uint16[d+7]=de,this.uint16[d+8]=h,this.uint16[d+9]=c,u}}Jr.prototype.bytesPerElement=20,Di("StructArrayLayout10ui20",Jr);class Fn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,Z,re,de,h,c,d){const _=this.length;return this.resize(_+1),this.emplace(_,u,m,C,D,Q,H,Z,re,de,h,c,d)}emplace(u,m,C,D,Q,H,Z,re,de,h,c,d,_){const S=12*u;return this.int16[S+0]=m,this.int16[S+1]=C,this.int16[S+2]=D,this.int16[S+3]=Q,this.uint16[S+4]=H,this.uint16[S+5]=Z,this.uint16[S+6]=re,this.uint16[S+7]=de,this.int16[S+8]=h,this.int16[S+9]=c,this.int16[S+10]=d,this.int16[S+11]=_,u}}Fn.prototype.bytesPerElement=24,Di("StructArrayLayout4i4ui4i24",Fn);class Yl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=3*u;return this.float32[Q+0]=m,this.float32[Q+1]=C,this.float32[Q+2]=D,u}}Yl.prototype.bytesPerElement=12,Di("StructArrayLayout3f12",Yl);class ec extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.uint32[1*u+0]=m,u}}ec.prototype.bytesPerElement=4,Di("StructArrayLayout1ul4",ec);class ko extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,Z,re,de){const h=this.length;return this.resize(h+1),this.emplace(h,u,m,C,D,Q,H,Z,re,de)}emplace(u,m,C,D,Q,H,Z,re,de,h){const c=10*u,d=5*u;return this.int16[c+0]=m,this.int16[c+1]=C,this.int16[c+2]=D,this.int16[c+3]=Q,this.int16[c+4]=H,this.int16[c+5]=Z,this.uint32[d+3]=re,this.uint16[c+8]=de,this.uint16[c+9]=h,u}}ko.prototype.bytesPerElement=20,Di("StructArrayLayout6i1ul2ui20",ko);class Da extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H){const Z=this.length;return this.resize(Z+1),this.emplace(Z,u,m,C,D,Q,H)}emplace(u,m,C,D,Q,H,Z){const re=6*u;return this.int16[re+0]=m,this.int16[re+1]=C,this.int16[re+2]=D,this.int16[re+3]=Q,this.int16[re+4]=H,this.int16[re+5]=Z,u}}Da.prototype.bytesPerElement=12,Di("StructArrayLayout2i2i2i12",Da);class tc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q){const H=this.length;return this.resize(H+1),this.emplace(H,u,m,C,D,Q)}emplace(u,m,C,D,Q,H){const Z=4*u,re=8*u;return this.float32[Z+0]=m,this.float32[Z+1]=C,this.float32[Z+2]=D,this.int16[re+6]=Q,this.int16[re+7]=H,u}}tc.prototype.bytesPerElement=16,Di("StructArrayLayout2f1f2i16",tc);class qc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,D){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,D)}emplace(u,m,C,D,Q){const H=12*u,Z=3*u;return this.uint8[H+0]=m,this.uint8[H+1]=C,this.float32[Z+1]=D,this.float32[Z+2]=Q,u}}qc.prototype.bytesPerElement=12,Di("StructArrayLayout2ub2f12",qc);class Oo extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=3*u;return this.uint16[Q+0]=m,this.uint16[Q+1]=C,this.uint16[Q+2]=D,u}}Oo.prototype.bytesPerElement=6,Di("StructArrayLayout3ui6",Oo);class ic extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,Z,re,de,h,c,d,_,S,M,k,G){const W=this.length;return this.resize(W+1),this.emplace(W,u,m,C,D,Q,H,Z,re,de,h,c,d,_,S,M,k,G)}emplace(u,m,C,D,Q,H,Z,re,de,h,c,d,_,S,M,k,G,W){const Y=24*u,ae=12*u,fe=48*u;return this.int16[Y+0]=m,this.int16[Y+1]=C,this.uint16[Y+2]=D,this.uint16[Y+3]=Q,this.uint32[ae+2]=H,this.uint32[ae+3]=Z,this.uint32[ae+4]=re,this.uint16[Y+10]=de,this.uint16[Y+11]=h,this.uint16[Y+12]=c,this.float32[ae+7]=d,this.float32[ae+8]=_,this.uint8[fe+36]=S,this.uint8[fe+37]=M,this.uint8[fe+38]=k,this.uint32[ae+10]=G,this.int16[Y+22]=W,u}}ic.prototype.bytesPerElement=48,Di("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ic);class va extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,Z,re,de,h,c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke,ut){const tt=this.length;return this.resize(tt+1),this.emplace(tt,u,m,C,D,Q,H,Z,re,de,h,c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke,ut)}emplace(u,m,C,D,Q,H,Z,re,de,h,c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke,ut,tt){const rt=32*u,yt=16*u;return this.int16[rt+0]=m,this.int16[rt+1]=C,this.int16[rt+2]=D,this.int16[rt+3]=Q,this.int16[rt+4]=H,this.int16[rt+5]=Z,this.int16[rt+6]=re,this.int16[rt+7]=de,this.uint16[rt+8]=h,this.uint16[rt+9]=c,this.uint16[rt+10]=d,this.uint16[rt+11]=_,this.uint16[rt+12]=S,this.uint16[rt+13]=M,this.uint16[rt+14]=k,this.uint16[rt+15]=G,this.uint16[rt+16]=W,this.uint16[rt+17]=Y,this.uint16[rt+18]=ae,this.uint16[rt+19]=fe,this.uint16[rt+20]=me,this.uint16[rt+21]=Ce,this.uint16[rt+22]=Me,this.uint32[yt+12]=Ue,this.float32[yt+13]=$e,this.float32[yt+14]=Ke,this.uint16[rt+30]=ut,this.uint16[rt+31]=tt,u}}va.prototype.bytesPerElement=64,Di("StructArrayLayout8i15ui1ul2f2ui64",va);class zr extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.float32[1*u+0]=m,u}}zr.prototype.bytesPerElement=4,Di("StructArrayLayout1f4",zr);class N extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=3*u;return this.uint16[6*u+0]=m,this.float32[Q+1]=C,this.float32[Q+2]=D,u}}N.prototype.bytesPerElement=12,Di("StructArrayLayout1ui2f12",N);class A extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=4*u;return this.uint32[2*u+0]=m,this.uint16[Q+2]=C,this.uint16[Q+3]=D,u}}A.prototype.bytesPerElement=8,Di("StructArrayLayout1ul2ui8",A);class b extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const D=2*u;return this.uint16[D+0]=m,this.uint16[D+1]=C,u}}b.prototype.bytesPerElement=4,Di("StructArrayLayout2ui4",b);class L extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.uint16[1*u+0]=m,u}}L.prototype.bytesPerElement=2,Di("StructArrayLayout1ui2",L);class O extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,D){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,D)}emplace(u,m,C,D,Q){const H=4*u;return this.float32[H+0]=m,this.float32[H+1]=C,this.float32[H+2]=D,this.float32[H+3]=Q,u}}O.prototype.bytesPerElement=16,Di("StructArrayLayout4f16",O);class z extends $i{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new F(this.anchorPointX,this.anchorPointY)}}z.prototype.size=20;class X extends ko{get(u){return new z(this,u)}}Di("CollisionBoxArray",X);class w extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(u){this._structArray.uint8[this._pos1+37]=u}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(u){this._structArray.uint8[this._pos1+38]=u}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(u){this._structArray.uint32[this._pos4+10]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}w.prototype.size=48;class a extends ic{get(u){return new w(this,u)}}Di("PlacedSymbolArray",a);class p extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(u){this._structArray.uint32[this._pos4+12]=u}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class x extends va{get(u){return new p(this,u)}}Di("SymbolInstanceArray",x);class B extends zr{getoffsetX(u){return this.float32[1*u+0]}}Di("GlyphOffsetArray",B);class I extends sn{getx(u){return this.int16[3*u+0]}gety(u){return this.int16[3*u+1]}gettileUnitDistanceFromAnchor(u){return this.int16[3*u+2]}}Di("SymbolLineVertexArray",I);class j extends $i{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}j.prototype.size=12;class y extends N{get(u){return new j(this,u)}}Di("TextAnchorOffsetArray",y);class E extends $i{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}E.prototype.size=8;class P extends A{get(u){return new E(this,u)}}Di("FeatureIndexArray",P);class V extends Do{}class q extends Do{}class K extends Do{}class ee extends Ro{}class se extends pu{}class oe extends $s{}class le extends Jr{}class _e extends Fn{}class Ie extends Yl{}class ve extends ec{}class Se extends Da{}class et extends qc{}class Oe extends Oo{}class Re extends b{}const Ve=Kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:At}=Ve;class dt{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=u}prepareSegment(u,m,C,D){let Q=this.segments[this.segments.length-1];return u>dt.MAX_VERTEX_ARRAY_LENGTH&&Ye(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}`),(!Q||Q.vertexLength+u>dt.MAX_VERTEX_ARRAY_LENGTH||Q.sortKey!==D)&&(Q={vertexOffset:m.length,primitiveOffset:C.length,vertexLength:0,primitiveLength:0},D!==void 0&&(Q.sortKey=D),this.segments.push(Q)),Q}get(){return this.segments}destroy(){for(const u of this.segments)for(const m in u.vaos)u.vaos[m].destroy()}static simpleSegment(u,m,C,D){return new dt([{vertexOffset:u,primitiveOffset:m,vertexLength:C,primitiveLength:D,vaos:{},sortKey:0}])}}function ft(f,u){return 256*(f=qe(Math.floor(f),0,255))+qe(Math.floor(u),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Di("SegmentVector",dt);const Nt=Kn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var It={exports:{}},jt={exports:{}};jt.exports=function(f,u){var m,C,D,Q,H,Z,re,de;for(C=f.length-(m=3&f.length),D=u,H=3432918353,Z=461845907,de=0;de<C;)re=255&f.charCodeAt(de)|(255&f.charCodeAt(++de))<<8|(255&f.charCodeAt(++de))<<16|(255&f.charCodeAt(++de))<<24,++de,D=27492+(65535&(Q=5*(65535&(D=(D^=re=(65535&(re=(re=(65535&re)*H+(((re>>>16)*H&65535)<<16)&4294967295)<<15|re>>>17))*Z+(((re>>>16)*Z&65535)<<16)&4294967295)<<13|D>>>19))+((5*(D>>>16)&65535)<<16)&4294967295))+((58964+(Q>>>16)&65535)<<16);switch(re=0,m){case 3:re^=(255&f.charCodeAt(de+2))<<16;case 2:re^=(255&f.charCodeAt(de+1))<<8;case 1:D^=re=(65535&(re=(re=(65535&(re^=255&f.charCodeAt(de)))*H+(((re>>>16)*H&65535)<<16)&4294967295)<<15|re>>>17))*Z+(((re>>>16)*Z&65535)<<16)&4294967295}return D^=f.length,D=2246822507*(65535&(D^=D>>>16))+((2246822507*(D>>>16)&65535)<<16)&4294967295,D=3266489909*(65535&(D^=D>>>13))+((3266489909*(D>>>16)&65535)<<16)&4294967295,(D^=D>>>16)>>>0};var Ht=jt.exports,Mi={exports:{}};Mi.exports=function(f,u){for(var m,C=f.length,D=u^C,Q=0;C>=4;)m=1540483477*(65535&(m=255&f.charCodeAt(Q)|(255&f.charCodeAt(++Q))<<8|(255&f.charCodeAt(++Q))<<16|(255&f.charCodeAt(++Q))<<24))+((1540483477*(m>>>16)&65535)<<16),D=1540483477*(65535&D)+((1540483477*(D>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),C-=4,++Q;switch(C){case 3:D^=(255&f.charCodeAt(Q+2))<<16;case 2:D^=(255&f.charCodeAt(Q+1))<<8;case 1:D=1540483477*(65535&(D^=255&f.charCodeAt(Q)))+((1540483477*(D>>>16)&65535)<<16)}return D=1540483477*(65535&(D^=D>>>13))+((1540483477*(D>>>16)&65535)<<16),(D^=D>>>15)>>>0};var mi=Ht,Ti=Mi.exports;It.exports=mi,It.exports.murmur3=mi,It.exports.murmur2=Ti;var ui=g(It.exports);class ar{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,m,C,D){this.ids.push(er(u)),this.positions.push(m,C,D)}getPositions(u){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const m=er(u);let C=0,D=this.ids.length-1;for(;C<D;){const H=C+D>>1;this.ids[H]>=m?D=H:C=H+1}const Q=[];for(;this.ids[C]===m;)Q.push({index:this.positions[3*C],start:this.positions[3*C+1],end:this.positions[3*C+2]}),C++;return Q}static serialize(u,m){const C=new Float64Array(u.ids),D=new Uint32Array(u.positions);return ir(C,D,0,C.length-1),m&&m.push(C.buffer,D.buffer),{ids:C,positions:D}}static deserialize(u){const m=new ar;return m.ids=u.ids,m.positions=u.positions,m.indexed=!0,m}}function er(f){const u=+f;return!isNaN(u)&&u<=Number.MAX_SAFE_INTEGER?u:ui(String(f))}function ir(f,u,m,C){for(;m<C;){const D=f[m+C>>1];let Q=m-1,H=C+1;for(;;){do Q++;while(f[Q]<D);do H--;while(f[H]>D);if(Q>=H)break;Dr(f,Q,H),Dr(u,3*Q,3*H),Dr(u,3*Q+1,3*H+1),Dr(u,3*Q+2,3*H+2)}H-m<C-H?(ir(f,u,m,H),m=H+1):(ir(f,u,H+1,C),C=H)}}function Dr(f,u,m){const C=f[u];f[u]=f[m],f[m]=C}Di("FeaturePositionMap",ar);class Rr{constructor(u,m){this.gl=u.gl,this.location=m}}class xr extends Rr{constructor(u,m){super(u,m),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class $r extends Rr{constructor(u,m){super(u,m),this.current=[0,0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))}}class br extends Rr{constructor(u,m){super(u,m),this.current=gr.transparent}set(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))}}const Wn=new Float32Array(16);function Kr(f){return[ft(255*f.r,255*f.g),ft(255*f.b,255*f.a)]}class kr{constructor(u,m,C){this.value=u,this.uniformNames=m.map(D=>`u_${D}`),this.type=C}setUniform(u,m,C){u.set(C.constantOr(this.value))}getBinding(u,m,C){return this.type==="color"?new br(u,m):new xr(u,m)}}class Wr{constructor(u,m){this.uniformNames=m.map(C=>`u_${C}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(u,m){this.pixelRatioFrom=m.pixelRatio,this.pixelRatioTo=u.pixelRatio,this.patternFrom=m.tlbr,this.patternTo=u.tlbr}setUniform(u,m,C,D){const Q=D==="u_pattern_to"?this.patternTo:D==="u_pattern_from"?this.patternFrom:D==="u_pixel_ratio_to"?this.pixelRatioTo:D==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Q&&u.set(Q)}getBinding(u,m,C){return C.substr(0,9)==="u_pattern"?new $r(u,m):new xr(u,m)}}class ur{constructor(u,m,C,D){this.expression=u,this.type=C,this.maxValue=0,this.paintVertexAttributes=m.map(Q=>({name:`a_${Q}`,type:"Float32",components:C==="color"?2:1,offset:0})),this.paintVertexArray=new D}populatePaintArray(u,m,C,D,Q){const H=this.paintVertexArray.length,Z=this.expression.evaluate(new vn(0),m,{},D,[],Q);this.paintVertexArray.resize(u),this._setPaintValue(H,u,Z)}updatePaintArray(u,m,C,D){const Q=this.expression.evaluate({zoom:0},C,D);this._setPaintValue(u,m,Q)}_setPaintValue(u,m,C){if(this.type==="color"){const D=Kr(C);for(let Q=u;Q<m;Q++)this.paintVertexArray.emplace(Q,D[0],D[1])}else{for(let D=u;D<m;D++)this.paintVertexArray.emplace(D,C);this.maxValue=Math.max(this.maxValue,Math.abs(C))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nr{constructor(u,m,C,D,Q,H){this.expression=u,this.uniformNames=m.map(Z=>`u_${Z}_t`),this.type=C,this.useIntegerZoom=D,this.zoom=Q,this.maxValue=0,this.paintVertexAttributes=m.map(Z=>({name:`a_${Z}`,type:"Float32",components:C==="color"?4:2,offset:0})),this.paintVertexArray=new H}populatePaintArray(u,m,C,D,Q){const H=this.expression.evaluate(new vn(this.zoom),m,{},D,[],Q),Z=this.expression.evaluate(new vn(this.zoom+1),m,{},D,[],Q),re=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(re,u,H,Z)}updatePaintArray(u,m,C,D){const Q=this.expression.evaluate({zoom:this.zoom},C,D),H=this.expression.evaluate({zoom:this.zoom+1},C,D);this._setPaintValue(u,m,Q,H)}_setPaintValue(u,m,C,D){if(this.type==="color"){const Q=Kr(C),H=Kr(D);for(let Z=u;Z<m;Z++)this.paintVertexArray.emplace(Z,Q[0],Q[1],H[0],H[1])}else{for(let Q=u;Q<m;Q++)this.paintVertexArray.emplace(Q,C,D);this.maxValue=Math.max(this.maxValue,Math.abs(C),Math.abs(D))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,m){const C=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,D=qe(this.expression.interpolationFactor(C,this.zoom,this.zoom+1),0,1);u.set(D)}getBinding(u,m,C){return new xr(u,m)}}class on{constructor(u,m,C,D,Q,H){this.expression=u,this.type=m,this.useIntegerZoom=C,this.zoom=D,this.layerId=H,this.zoomInPaintVertexArray=new Q,this.zoomOutPaintVertexArray=new Q}populatePaintArray(u,m,C){const D=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(u),this.zoomOutPaintVertexArray.resize(u),this._setPaintValues(D,u,m.patterns&&m.patterns[this.layerId],C)}updatePaintArray(u,m,C,D,Q){this._setPaintValues(u,m,C.patterns&&C.patterns[this.layerId],Q)}_setPaintValues(u,m,C,D){if(!D||!C)return;const{min:Q,mid:H,max:Z}=C,re=D[Q],de=D[H],h=D[Z];if(re&&de&&h)for(let c=u;c<m;c++)this.zoomInPaintVertexArray.emplace(c,de.tl[0],de.tl[1],de.br[0],de.br[1],re.tl[0],re.tl[1],re.br[0],re.br[1],de.pixelRatio,re.pixelRatio),this.zoomOutPaintVertexArray.emplace(c,de.tl[0],de.tl[1],de.br[0],de.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],de.pixelRatio,h.pixelRatio)}upload(u){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=u.createVertexBuffer(this.zoomInPaintVertexArray,Nt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=u.createVertexBuffer(this.zoomOutPaintVertexArray,Nt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class es{constructor(u,m,C){this.binders={},this._buffers=[];const D=[];for(const Q in u.paint._values){if(!C(Q))continue;const H=u.paint.get(Q);if(!(H instanceof _a&&ct(H.property.specification)))continue;const Z=ts(Q,u.type),re=H.value,de=H.property.specification.type,h=H.property.useIntegerZoom,c=H.property.specification["property-type"],d=c==="cross-faded"||c==="cross-faded-data-driven";if(re.kind==="constant")this.binders[Q]=d?new Wr(re.value,Z):new kr(re.value,Z,de),D.push(`/u_${Q}`);else if(re.kind==="source"||d){const _=Bs(Q,de,"source");this.binders[Q]=d?new on(re,de,h,m,_,u.id):new ur(re,Z,de,_),D.push(`/a_${Q}`)}else{const _=Bs(Q,de,"composite");this.binders[Q]=new Nr(re,Z,de,h,m,_),D.push(`/z_${Q}`)}}this.cacheKey=D.sort().join("")}getMaxValue(u){const m=this.binders[u];return m instanceof ur||m instanceof Nr?m.maxValue:0}populatePaintArrays(u,m,C,D,Q){for(const H in this.binders){const Z=this.binders[H];(Z instanceof ur||Z instanceof Nr||Z instanceof on)&&Z.populatePaintArray(u,m,C,D,Q)}}setConstantPatternPositions(u,m){for(const C in this.binders){const D=this.binders[C];D instanceof Wr&&D.setConstantPatternPositions(u,m)}}updatePaintArrays(u,m,C,D,Q){let H=!1;for(const Z in u){const re=m.getPositions(Z);for(const de of re){const h=C.feature(de.index);for(const c in this.binders){const d=this.binders[c];if((d instanceof ur||d instanceof Nr||d instanceof on)&&d.expression.isStateDependent===!0){const _=D.paint.get(c);d.expression=_.value,d.updatePaintArray(de.start,de.end,h,u[Z],Q),H=!0}}}}return H}defines(){const u=[];for(const m in this.binders){const C=this.binders[m];(C instanceof kr||C instanceof Wr)&&u.push(...C.uniformNames.map(D=>`#define HAS_UNIFORM_${D}`))}return u}getBinderAttributes(){const u=[];for(const m in this.binders){const C=this.binders[m];if(C instanceof ur||C instanceof Nr)for(let D=0;D<C.paintVertexAttributes.length;D++)u.push(C.paintVertexAttributes[D].name);else if(C instanceof on)for(let D=0;D<Nt.members.length;D++)u.push(Nt.members[D].name)}return u}getBinderUniforms(){const u=[];for(const m in this.binders){const C=this.binders[m];if(C instanceof kr||C instanceof Wr||C instanceof Nr)for(const D of C.uniformNames)u.push(D)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u,m){const C=[];for(const D in this.binders){const Q=this.binders[D];if(Q instanceof kr||Q instanceof Wr||Q instanceof Nr){for(const H of Q.uniformNames)if(m[H]){const Z=Q.getBinding(u,m[H],H);C.push({name:H,property:D,binding:Z})}}}return C}setUniforms(u,m,C,D){for(const{name:Q,property:H,binding:Z}of m)this.binders[H].setUniform(Z,D,C.get(H),Q)}updatePaintBuffers(u){this._buffers=[];for(const m in this.binders){const C=this.binders[m];if(u&&C instanceof on){const D=u.fromScale===2?C.zoomInPaintVertexBuffer:C.zoomOutPaintVertexBuffer;D&&this._buffers.push(D)}else(C instanceof ur||C instanceof Nr)&&C.paintVertexBuffer&&this._buffers.push(C.paintVertexBuffer)}}upload(u){for(const m in this.binders){const C=this.binders[m];(C instanceof ur||C instanceof Nr||C instanceof on)&&C.upload(u)}this.updatePaintBuffers()}destroy(){for(const u in this.binders){const m=this.binders[u];(m instanceof ur||m instanceof Nr||m instanceof on)&&m.destroy()}}}class an{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const D of u)this.programConfigurations[D.id]=new es(D,m,C);this.needsUpload=!1,this._featureMap=new ar,this._bufferOffset=0}populatePaintArrays(u,m,C,D,Q,H){for(const Z in this.programConfigurations)this.programConfigurations[Z].populatePaintArrays(u,m,D,Q,H);m.id!==void 0&&this._featureMap.add(m.id,C,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,m,C,D){for(const Q of C)this.needsUpload=this.programConfigurations[Q.id].updatePaintArrays(u,this._featureMap,m,Q,D)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(const m in this.programConfigurations)this.programConfigurations[m].upload(u);this.needsUpload=!1}}destroy(){for(const u in this.programConfigurations)this.programConfigurations[u].destroy()}}function ts(f,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${u}-`,"").replace(/-/g,"_")]}function Bs(f,u,m){const C={color:{source:$s,composite:O},number:{source:zr,composite:$s}},D=function(Q){return{"line-pattern":{source:le,composite:le},"fill-pattern":{source:le,composite:le},"fill-extrusion-pattern":{source:le,composite:le}}[Q]}(f);return D&&D[m]||C[u][m]}Di("ConstantBinder",kr),Di("CrossFadedConstantBinder",Wr),Di("SourceExpressionBinder",ur),Di("CrossFadedCompositeBinder",on),Di("CompositeExpressionBinder",Nr),Di("ProgramConfiguration",es,{omit:["_buffers"]}),Di("ProgramConfigurationSet",an);const mr=8192,bn=Math.pow(2,14)-1,ea=-bn-1;function Os(f){const u=mr/f.extent,m=f.loadGeometry();for(let C=0;C<m.length;C++){const D=m[C];for(let Q=0;Q<D.length;Q++){const H=D[Q],Z=Math.round(H.x*u),re=Math.round(H.y*u);H.x=qe(Z,ea,bn),H.y=qe(re,ea,bn),(Z<H.x||Z>H.x+1||re<H.y||re>H.y+1)&&Ye("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return m}function io(f,u){return{type:f.type,id:f.id,properties:f.properties,geometry:u?Os(f):[]}}function yl(f,u,m,C,D){f.emplaceBack(2*u+(C+1)/2,2*m+(D+1)/2)}class _o{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new q,this.indexArray=new Oe,this.segments=new dt,this.programConfigurations=new an(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){const D=this.layers[0],Q=[];let H=null,Z=!1;D.type==="circle"&&(H=D.layout.get("circle-sort-key"),Z=!H.isConstant());for(const{feature:re,id:de,index:h,sourceLayerIndex:c}of u){const d=this.layers[0]._featureFilter.needGeometry,_=io(re,d);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),_,C))continue;const S=Z?H.evaluate(_,{},C):void 0,M={id:de,properties:re.properties,type:re.type,sourceLayerIndex:c,index:h,geometry:d?_.geometry:Os(re),patterns:{},sortKey:S};Q.push(M)}Z&&Q.sort((re,de)=>re.sortKey-de.sortKey);for(const re of Q){const{geometry:de,index:h,sourceLayerIndex:c}=re,d=u[h].feature;this.addFeature(re,de,h,C),m.featureIndex.insert(d,de,h,c,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,At),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,m,C,D){for(const Q of m)for(const H of Q){const Z=H.x,re=H.y;if(Z<0||Z>=mr||re<0||re>=mr)continue;const de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,u.sortKey),h=de.vertexLength;yl(this.layoutVertexArray,Z,re,-1,-1),yl(this.layoutVertexArray,Z,re,1,-1),yl(this.layoutVertexArray,Z,re,1,1),yl(this.layoutVertexArray,Z,re,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),de.vertexLength+=4,de.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,{},D)}}function rc(f,u){for(let m=0;m<f.length;m++)if($c(u,f[m]))return!0;for(let m=0;m<u.length;m++)if($c(f,u[m]))return!0;return!!gu(f,u)}function Ra(f,u,m){return!!$c(f,u)||!!rl(u,f,m)}function Dn(f,u){if(f.length===1)return sA(u,f[0]);for(let m=0;m<u.length;m++){const C=u[m];for(let D=0;D<C.length;D++)if($c(f,C[D]))return!0}for(let m=0;m<f.length;m++)if(sA(u,f[m]))return!0;for(let m=0;m<u.length;m++)if(gu(f,u[m]))return!0;return!1}function xc(f,u,m){if(f.length>1){if(gu(f,u))return!0;for(let C=0;C<u.length;C++)if(rl(u[C],f,m))return!0}for(let C=0;C<f.length;C++)if(rl(f[C],u,m))return!0;return!1}function gu(f,u){if(f.length===0||u.length===0)return!1;for(let m=0;m<f.length-1;m++){const C=f[m],D=f[m+1];for(let Q=0;Q<u.length-1;Q++)if(_l(C,D,u[Q],u[Q+1]))return!0}return!1}function _l(f,u,m,C){return Ze(f,m,C)!==Ze(u,m,C)&&Ze(f,u,m)!==Ze(f,u,C)}function rl(f,u,m){const C=m*m;if(u.length===1)return f.distSqr(u[0])<C;for(let D=1;D<u.length;D++)if(Qu(f,u[D-1],u[D])<C)return!0;return!1}function Qu(f,u,m){const C=u.distSqr(m);if(C===0)return f.distSqr(u);const D=((f.x-u.x)*(m.x-u.x)+(f.y-u.y)*(m.y-u.y))/C;return f.distSqr(D<0?u:D>1?m:m.sub(u)._mult(D)._add(u))}function sA(f,u){let m,C,D,Q=!1;for(let H=0;H<f.length;H++){m=f[H];for(let Z=0,re=m.length-1;Z<m.length;re=Z++)C=m[Z],D=m[re],C.y>u.y!=D.y>u.y&&u.x<(D.x-C.x)*(u.y-C.y)/(D.y-C.y)+C.x&&(Q=!Q)}return Q}function $c(f,u){let m=!1;for(let C=0,D=f.length-1;C<f.length;D=C++){const Q=f[C],H=f[D];Q.y>u.y!=H.y>u.y&&u.x<(H.x-Q.x)*(u.y-Q.y)/(H.y-Q.y)+Q.x&&(m=!m)}return m}function jA(f,u,m){const C=m[0],D=m[2];if(f.x<C.x&&u.x<C.x||f.x>D.x&&u.x>D.x||f.y<C.y&&u.y<C.y||f.y>D.y&&u.y>D.y)return!1;const Q=Ze(f,u,m[0]);return Q!==Ze(f,u,m[1])||Q!==Ze(f,u,m[2])||Q!==Ze(f,u,m[3])}function oA(f,u,m){const C=u.paint.get(f).value;return C.kind==="constant"?C.value:m.programConfigurations.get(u.id).getMaxValue(f)}function kd(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function Vu(f,u,m,C,D){if(!u[0]&&!u[1])return f;const Q=F.convert(u)._mult(D);m==="viewport"&&Q._rotate(-C);const H=[];for(let Z=0;Z<f.length;Z++)H.push(f[Z].sub(Q));return H}let mu,Od;Di("CircleBucket",_o,{omit:["layers"]});var Am={get paint(){return Od=Od||new ks({"circle-radius":new sr(wt.paint_circle["circle-radius"]),"circle-color":new sr(wt.paint_circle["circle-color"]),"circle-blur":new sr(wt.paint_circle["circle-blur"]),"circle-opacity":new sr(wt.paint_circle["circle-opacity"]),"circle-translate":new Ei(wt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ei(wt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ei(wt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ei(wt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sr(wt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sr(wt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sr(wt.paint_circle["circle-stroke-opacity"])})},get layout(){return mu=mu||new ks({"circle-sort-key":new sr(wt.layout_circle["circle-sort-key"])})}},ta=1e-6,nc=typeof Float32Array<"u"?Float32Array:Array;function aA(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function xh(f,u,m){var C=u[0],D=u[1],Q=u[2],H=u[3],Z=u[4],re=u[5],de=u[6],h=u[7],c=u[8],d=u[9],_=u[10],S=u[11],M=u[12],k=u[13],G=u[14],W=u[15],Y=m[0],ae=m[1],fe=m[2],me=m[3];return f[0]=Y*C+ae*Z+fe*c+me*M,f[1]=Y*D+ae*re+fe*d+me*k,f[2]=Y*Q+ae*de+fe*_+me*G,f[3]=Y*H+ae*h+fe*S+me*W,f[4]=(Y=m[4])*C+(ae=m[5])*Z+(fe=m[6])*c+(me=m[7])*M,f[5]=Y*D+ae*re+fe*d+me*k,f[6]=Y*Q+ae*de+fe*_+me*G,f[7]=Y*H+ae*h+fe*S+me*W,f[8]=(Y=m[8])*C+(ae=m[9])*Z+(fe=m[10])*c+(me=m[11])*M,f[9]=Y*D+ae*re+fe*d+me*k,f[10]=Y*Q+ae*de+fe*_+me*G,f[11]=Y*H+ae*h+fe*S+me*W,f[12]=(Y=m[12])*C+(ae=m[13])*Z+(fe=m[14])*c+(me=m[15])*M,f[13]=Y*D+ae*re+fe*d+me*k,f[14]=Y*Q+ae*de+fe*_+me*G,f[15]=Y*H+ae*h+fe*S+me*W,f}Math.hypot||(Math.hypot=function(){for(var f=0,u=arguments.length;u--;)f+=arguments[u]*arguments[u];return Math.sqrt(f)});var yu,wh=xh;function Bh(f,u,m){var C=u[0],D=u[1],Q=u[2],H=u[3];return f[0]=m[0]*C+m[4]*D+m[8]*Q+m[12]*H,f[1]=m[1]*C+m[5]*D+m[9]*Q+m[13]*H,f[2]=m[2]*C+m[6]*D+m[10]*Q+m[14]*H,f[3]=m[3]*C+m[7]*D+m[11]*Q+m[15]*H,f}yu=new nc(4),nc!=Float32Array&&(yu[0]=0,yu[1]=0,yu[2]=0,yu[3]=0);class lA extends $n{constructor(u){super(u,Am)}createBucket(u){return new _o(u)}queryRadius(u){const m=u;return oA("circle-radius",this,m)+oA("circle-stroke-width",this,m)+kd(this.paint.get("circle-translate"))}queryIntersectsFeature(u,m,C,D,Q,H,Z,re){const de=Vu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),H.angle,Z),h=this.paint.get("circle-radius").evaluate(m,C)+this.paint.get("circle-stroke-width").evaluate(m,C),c=this.paint.get("circle-pitch-alignment")==="map",d=c?de:function(S,M){return S.map(k=>Yf(k,M))}(de,re),_=c?h*Z:h;for(const S of D)for(const M of S){const k=c?M:Yf(M,re);let G=_;const W=Bh([],[M.x,M.y,0,1],re);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?G*=W[3]/H.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(G*=H.cameraToCenterDistance/W[3]),Ra(d,k,G))return!0}return!1}}function Yf(f,u){const m=Bh([],[f.x,f.y,0,1],u);return new F(m[0]/m[3],m[1]/m[3])}class ia extends _o{}let Kc;Di("HeatmapBucket",ia,{omit:["layers"]});var Ud={get paint(){return Kc=Kc||new ks({"heatmap-radius":new sr(wt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sr(wt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ei(wt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Jl(wt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ei(wt.paint_heatmap["heatmap-opacity"])})}};function cA(f,u,m,C){let{width:D,height:Q}=u;if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==D*Q*m)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${D*Q*m}`)}else C=new Uint8Array(D*Q*m);return f.width=D,f.height=Q,f.data=C,f}function vl(f,u,m){let{width:C,height:D}=u;if(C===f.width&&D===f.height)return;const Q=cA({},{width:C,height:D},m);Nd(f,Q,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,C),height:Math.min(f.height,D)},m),f.width=C,f.height=D,f.data=Q.data}function Nd(f,u,m,C,D,Q){if(D.width===0||D.height===0)return u;if(D.width>f.width||D.height>f.height||m.x>f.width-D.width||m.y>f.height-D.height)throw new RangeError("out of range source coordinates for image copy");if(D.width>u.width||D.height>u.height||C.x>u.width-D.width||C.y>u.height-D.height)throw new RangeError("out of range destination coordinates for image copy");const H=f.data,Z=u.data;if(H===Z)throw new Error("srcData equals dstData, so image is already copied");for(let re=0;re<D.height;re++){const de=((m.y+re)*f.width+m.x)*Q,h=((C.y+re)*u.width+C.x)*Q;for(let c=0;c<D.width*Q;c++)Z[h+c]=H[de+c]}return u}class _u{constructor(u,m){cA(this,u,1,m)}resize(u){vl(this,u,1)}clone(){return new _u({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,m,C,D,Q){Nd(u,m,C,D,Q,1)}}class bl{constructor(u,m){cA(this,u,4,m)}resize(u){vl(this,u,4)}replace(u,m){m?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new bl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,m,C,D,Q){Nd(u,m,C,D,Q,4)}}function zd(f){const u={},m=f.resolution||256,C=f.clips?f.clips.length:1,D=f.image||new bl({width:m,height:C});if(Math.log(m)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${m}`);const Q=(H,Z,re)=>{u[f.evaluationKey]=re;const de=f.expression.evaluate(u);D.data[H+Z+0]=Math.floor(255*de.r/de.a),D.data[H+Z+1]=Math.floor(255*de.g/de.a),D.data[H+Z+2]=Math.floor(255*de.b/de.a),D.data[H+Z+3]=Math.floor(255*de.a)};if(f.clips)for(let H=0,Z=0;H<C;++H,Z+=4*m)for(let re=0,de=0;re<m;re++,de+=4){const h=re/(m-1),{start:c,end:d}=f.clips[H];Q(Z,de,c*(1-h)+d*h)}else for(let H=0,Z=0;H<m;H++,Z+=4)Q(0,Z,H/(m-1));return D}Di("AlphaImage",_u),Di("RGBAImage",bl);class Ch extends $n{createBucket(u){return new ia(u)}constructor(u){super(u,Ud),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=zd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ep;var dm={get paint(){return ep=ep||new ks({"hillshade-illumination-direction":new Ei(wt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ei(wt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ei(wt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ei(wt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ei(wt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ei(wt.paint_hillshade["hillshade-accent-color"])})}};class tp extends $n{constructor(u){super(u,dm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const ip=Kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:rp}=ip;var wc={exports:{}};function Uo(f,u,m){m=m||2;var C,D,Q,H,Z,re,de,h=u&&u.length,c=h?u[0]*m:f.length,d=uA(f,0,c,m,!0),_=[];if(!d||d.next===d.prev)return _;if(h&&(d=function(M,k,G,W){var Y,ae,fe,me=[];for(Y=0,ae=k.length;Y<ae;Y++)(fe=uA(M,k[Y]*W,Y<ae-1?k[Y+1]*W:M.length,W,!1))===fe.next&&(fe.steiner=!0),me.push(op(fe));for(me.sort(sp),Y=0;Y<me.length;Y++)G=hA(me[Y],G);return G}(f,u,d,m)),f.length>80*m){C=Q=f[0],D=H=f[1];for(var S=m;S<c;S+=m)(Z=f[S])<C&&(C=Z),(re=f[S+1])<D&&(D=re),Z>Q&&(Q=Z),re>H&&(H=re);de=(de=Math.max(Q-C,H-D))!==0?32767/de:0}return xl(d,_,m,C,D,de,0),_}function uA(f,u,m,C,D){var Q,H;if(D===Gd(f,u,m,C)>0)for(Q=u;Q<m;Q+=C)H=$A(Q,f[Q],f[Q+1],H);else for(Q=m-C;Q>=u;Q-=C)H=$A(Q,f[Q],f[Q+1],H);return H&&pm(H,H.next)&&(ap(H),H=H.next),H}function ka(f,u){if(!f)return f;u||(u=f);var m,C=f;do if(m=!1,C.steiner||!pm(C,C.next)&&ro(C.prev,C,C.next)!==0)C=C.next;else{if(ap(C),(C=u=C.prev)===C.next)break;m=!0}while(m||C!==u);return u}function xl(f,u,m,C,D,Q,H){if(f){!H&&Q&&function(h,c,d,_){var S=h;do S.z===0&&(S.z=Eh(S.x,S.y,c,d,_)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==h);S.prevZ.nextZ=null,S.prevZ=null,function(M){var k,G,W,Y,ae,fe,me,Ce,Me=1;do{for(G=M,M=null,ae=null,fe=0;G;){for(fe++,W=G,me=0,k=0;k<Me&&(me++,W=W.nextZ);k++);for(Ce=Me;me>0||Ce>0&&W;)me!==0&&(Ce===0||!W||G.z<=W.z)?(Y=G,G=G.nextZ,me--):(Y=W,W=W.nextZ,Ce--),ae?ae.nextZ=Y:M=Y,Y.prevZ=ae,ae=Y;G=W}ae.nextZ=null,Me*=2}while(fe>1)}(S)}(f,C,D,Q);for(var Z,re,de=f;f.prev!==f.next;)if(Z=f.prev,re=f.next,Q?Qd(f,C,D,Q):Hu(f))u.push(Z.i/m|0),u.push(f.i/m|0),u.push(re.i/m|0),ap(f),f=re.next,de=re.next;else if((f=re)===de){H?H===1?xl(f=np(ka(f),u,m),u,m,C,D,Q,2):H===2&&fm(f,u,m,C,D,Q):xl(ka(f),u,m,C,D,Q,1);break}}}function Hu(f){var u=f.prev,m=f,C=f.next;if(ro(u,m,C)>=0)return!1;for(var D=u.x,Q=m.x,H=C.x,Z=u.y,re=m.y,de=C.y,h=D<Q?D<H?D:H:Q<H?Q:H,c=Z<re?Z<de?Z:de:re<de?re:de,d=D>Q?D>H?D:H:Q>H?Q:H,_=Z>re?Z>de?Z:de:re>de?re:de,S=C.next;S!==u;){if(S.x>=h&&S.x<=d&&S.y>=c&&S.y<=_&&Hd(D,Z,Q,re,H,de,S.x,S.y)&&ro(S.prev,S,S.next)>=0)return!1;S=S.next}return!0}function Qd(f,u,m,C){var D=f.prev,Q=f,H=f.next;if(ro(D,Q,H)>=0)return!1;for(var Z=D.x,re=Q.x,de=H.x,h=D.y,c=Q.y,d=H.y,_=Z<re?Z<de?Z:de:re<de?re:de,S=h<c?h<d?h:d:c<d?c:d,M=Z>re?Z>de?Z:de:re>de?re:de,k=h>c?h>d?h:d:c>d?c:d,G=Eh(_,S,u,m,C),W=Eh(M,k,u,m,C),Y=f.prevZ,ae=f.nextZ;Y&&Y.z>=G&&ae&&ae.z<=W;){if(Y.x>=_&&Y.x<=M&&Y.y>=S&&Y.y<=k&&Y!==D&&Y!==H&&Hd(Z,h,re,c,de,d,Y.x,Y.y)&&ro(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,ae.x>=_&&ae.x<=M&&ae.y>=S&&ae.y<=k&&ae!==D&&ae!==H&&Hd(Z,h,re,c,de,d,ae.x,ae.y)&&ro(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;Y&&Y.z>=G;){if(Y.x>=_&&Y.x<=M&&Y.y>=S&&Y.y<=k&&Y!==D&&Y!==H&&Hd(Z,h,re,c,de,d,Y.x,Y.y)&&ro(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;ae&&ae.z<=W;){if(ae.x>=_&&ae.x<=M&&ae.y>=S&&ae.y<=k&&ae!==D&&ae!==H&&Hd(Z,h,re,c,de,d,ae.x,ae.y)&&ro(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function np(f,u,m){var C=f;do{var D=C.prev,Q=C.next.next;!pm(D,Q)&&ox(D,C,C.next,Q)&&qA(D,Q)&&qA(Q,D)&&(u.push(D.i/m|0),u.push(C.i/m|0),u.push(Q.i/m|0),ap(C),ap(C.next),C=f=Q),C=C.next}while(C!==f);return ka(C)}function fm(f,u,m,C,D,Q){var H=f;do{for(var Z=H.next.next;Z!==H.prev;){if(H.i!==Z.i&&fI(H,Z)){var re=ax(H,Z);return H=ka(H,H.next),re=ka(re,re.next),xl(H,u,m,C,D,Q,0),void xl(re,u,m,C,D,Q,0)}Z=Z.next}H=H.next}while(H!==f)}function sp(f,u){return f.x-u.x}function hA(f,u){var m=function(D,Q){var H,Z=Q,re=D.x,de=D.y,h=-1/0;do{if(de<=Z.y&&de>=Z.next.y&&Z.next.y!==Z.y){var c=Z.x+(de-Z.y)*(Z.next.x-Z.x)/(Z.next.y-Z.y);if(c<=re&&c>h&&(h=c,H=Z.x<Z.next.x?Z:Z.next,c===re))return H}Z=Z.next}while(Z!==Q);if(!H)return null;var d,_=H,S=H.x,M=H.y,k=1/0;Z=H;do re>=Z.x&&Z.x>=S&&re!==Z.x&&Hd(de<M?re:h,de,S,M,de<M?h:re,de,Z.x,Z.y)&&(d=Math.abs(de-Z.y)/(re-Z.x),qA(Z,D)&&(d<k||d===k&&(Z.x>H.x||Z.x===H.x&&Vd(H,Z)))&&(H=Z,k=d)),Z=Z.next;while(Z!==_);return H}(f,u);if(!m)return u;var C=ax(m,f);return ka(C,C.next),ka(m,m.next)}function Vd(f,u){return ro(f.prev,f,u.prev)<0&&ro(u.next,f,f.next)<0}function Eh(f,u,m,C,D){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-m)*D|0)|f<<8))|f<<4))|f<<2))|f<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-C)*D|0)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function op(f){var u=f,m=f;do(u.x<m.x||u.x===m.x&&u.y<m.y)&&(m=u),u=u.next;while(u!==f);return m}function Hd(f,u,m,C,D,Q,H,Z){return(D-H)*(u-Z)>=(f-H)*(Q-Z)&&(f-H)*(C-Z)>=(m-H)*(u-Z)&&(m-H)*(Q-Z)>=(D-H)*(C-Z)}function fI(f,u){return f.next.i!==u.i&&f.prev.i!==u.i&&!function(m,C){var D=m;do{if(D.i!==m.i&&D.next.i!==m.i&&D.i!==C.i&&D.next.i!==C.i&&ox(D,D.next,m,C))return!0;D=D.next}while(D!==m);return!1}(f,u)&&(qA(f,u)&&qA(u,f)&&function(m,C){var D=m,Q=!1,H=(m.x+C.x)/2,Z=(m.y+C.y)/2;do D.y>Z!=D.next.y>Z&&D.next.y!==D.y&&H<(D.next.x-D.x)*(Z-D.y)/(D.next.y-D.y)+D.x&&(Q=!Q),D=D.next;while(D!==m);return Q}(f,u)&&(ro(f.prev,f,u.prev)||ro(f,u.prev,u))||pm(f,u)&&ro(f.prev,f,f.next)>0&&ro(u.prev,u,u.next)>0)}function ro(f,u,m){return(u.y-f.y)*(m.x-u.x)-(u.x-f.x)*(m.y-u.y)}function pm(f,u){return f.x===u.x&&f.y===u.y}function ox(f,u,m,C){var D=mm(ro(f,u,m)),Q=mm(ro(f,u,C)),H=mm(ro(m,C,f)),Z=mm(ro(m,C,u));return D!==Q&&H!==Z||!(D!==0||!gm(f,m,u))||!(Q!==0||!gm(f,C,u))||!(H!==0||!gm(m,f,C))||!(Z!==0||!gm(m,u,C))}function gm(f,u,m){return u.x<=Math.max(f.x,m.x)&&u.x>=Math.min(f.x,m.x)&&u.y<=Math.max(f.y,m.y)&&u.y>=Math.min(f.y,m.y)}function mm(f){return f>0?1:f<0?-1:0}function qA(f,u){return ro(f.prev,f,f.next)<0?ro(f,u,f.next)>=0&&ro(f,f.prev,u)>=0:ro(f,u,f.prev)<0||ro(f,f.next,u)<0}function ax(f,u){var m=new Us(f.i,f.x,f.y),C=new Us(u.i,u.x,u.y),D=f.next,Q=u.prev;return f.next=u,u.prev=f,m.next=D,D.prev=m,C.next=m,m.prev=C,Q.next=C,C.prev=Q,C}function $A(f,u,m,C){var D=new Us(f,u,m);return C?(D.next=C.next,D.prev=C,C.next.prev=D,C.next=D):(D.prev=D,D.next=D),D}function ap(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function Us(f,u,m){this.i=f,this.x=u,this.y=m,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gd(f,u,m,C){for(var D=0,Q=u,H=m-C;Q<m;Q+=C)D+=(f[H]-f[Q])*(f[Q+1]+f[H+1]),H=Q;return D}wc.exports=Uo,wc.exports.default=Uo,Uo.deviation=function(f,u,m,C){var D=u&&u.length,Q=Math.abs(Gd(f,0,D?u[0]*m:f.length,m));if(D)for(var H=0,Z=u.length;H<Z;H++)Q-=Math.abs(Gd(f,u[H]*m,H<Z-1?u[H+1]*m:f.length,m));var re=0;for(H=0;H<C.length;H+=3){var de=C[H]*m,h=C[H+1]*m,c=C[H+2]*m;re+=Math.abs((f[de]-f[c])*(f[h+1]-f[de+1])-(f[de]-f[h])*(f[c+1]-f[de+1]))}return Q===0&&re===0?0:Math.abs((re-Q)/Q)},Uo.flatten=function(f){for(var u=f[0][0].length,m={vertices:[],holes:[],dimensions:u},C=0,D=0;D<f.length;D++){for(var Q=0;Q<f[D].length;Q++)for(var H=0;H<u;H++)m.vertices.push(f[D][Q][H]);D>0&&m.holes.push(C+=f[D-1].length)}return m};var U0=g(wc.exports);function ym(f,u,m,C,D){lp(f,u,m||0,C||f.length-1,D||lx)}function lp(f,u,m,C,D){for(;C>m;){if(C-m>600){var Q=C-m+1,H=u-m+1,Z=Math.log(Q),re=.5*Math.exp(2*Z/3),de=.5*Math.sqrt(Z*re*(Q-re)/Q)*(H-Q/2<0?-1:1);lp(f,u,Math.max(m,Math.floor(u-H*re/Q+de)),Math.min(C,Math.floor(u+(Q-H)*re/Q+de)),D)}var h=f[u],c=m,d=C;for(Sh(f,m,u),D(f[C],h)>0&&Sh(f,m,C);c<d;){for(Sh(f,c,d),c++,d--;D(f[c],h)<0;)c++;for(;D(f[d],h)>0;)d--}D(f[m],h)===0?Sh(f,m,d):Sh(f,++d,C),d<=u&&(m=d+1),u<=d&&(C=d-1)}}function Sh(f,u,m){var C=f[u];f[u]=f[m],f[m]=C}function lx(f,u){return f<u?-1:f>u?1:0}function _m(f,u){const m=f.length;if(m<=1)return[f];const C=[];let D,Q;for(let H=0;H<m;H++){const Z=Ct(f[H]);Z!==0&&(f[H].area=Math.abs(Z),Q===void 0&&(Q=Z<0),Q===Z<0?(D&&C.push(D),D=[f[H]]):D.push(f[H]))}if(D&&C.push(D),u>1)for(let H=0;H<C.length;H++)C[H].length<=u||(ym(C[H],u,1,C[H].length-1,cp),C[H]=C[H].slice(0,u));return C}function cp(f,u){return u.area-f.area}function up(f,u,m){const C=m.patternDependencies;let D=!1;for(const Q of u){const H=Q.paint.get(`${f}-pattern`);H.isConstant()||(D=!0);const Z=H.constantOr(null);Z&&(D=!0,C[Z.to]=!0,C[Z.from]=!0)}return D}function hp(f,u,m,C,D){const Q=D.patternDependencies;for(const H of u){const Z=H.paint.get(`${f}-pattern`).value;if(Z.kind!=="constant"){let re=Z.evaluate({zoom:C-1},m,{},D.availableImages),de=Z.evaluate({zoom:C},m,{},D.availableImages),h=Z.evaluate({zoom:C+1},m,{},D.availableImages);re=re&&re.name?re.name:re,de=de&&de.name?de.name:de,h=h&&h.name?h.name:h,Q[re]=!0,Q[de]=!0,Q[h]=!0,m.patterns[H.id]={min:re,mid:de,max:h}}}return m}class vm{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new K,this.indexArray=new Oe,this.indexArray2=new Re,this.programConfigurations=new an(u.layers,u.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.hasPattern=up("fill",this.layers,m);const D=this.layers[0].layout.get("fill-sort-key"),Q=!D.isConstant(),H=[];for(const{feature:Z,id:re,index:de,sourceLayerIndex:h}of u){const c=this.layers[0]._featureFilter.needGeometry,d=io(Z,c);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),d,C))continue;const _=Q?D.evaluate(d,{},C,m.availableImages):void 0,S={id:re,properties:Z.properties,type:Z.type,sourceLayerIndex:h,index:de,geometry:c?d.geometry:Os(Z),patterns:{},sortKey:_};H.push(S)}Q&&H.sort((Z,re)=>Z.sortKey-re.sortKey);for(const Z of H){const{geometry:re,index:de,sourceLayerIndex:h}=Z;if(this.hasPattern){const c=hp("fill",this.layers,Z,this.zoom,m);this.patternFeatures.push(c)}else this.addFeature(Z,re,de,C,{});m.featureIndex.insert(u[de].feature,re,de,h,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}addFeatures(u,m,C){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,rp),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,m,C,D,Q){for(const H of _m(m,500)){let Z=0;for(const _ of H)Z+=_.length;const re=this.segments.prepareSegment(Z,this.layoutVertexArray,this.indexArray),de=re.vertexLength,h=[],c=[];for(const _ of H){if(_.length===0)continue;_!==H[0]&&c.push(h.length/2);const S=this.segments2.prepareSegment(_.length,this.layoutVertexArray,this.indexArray2),M=S.vertexLength;this.layoutVertexArray.emplaceBack(_[0].x,_[0].y),this.indexArray2.emplaceBack(M+_.length-1,M),h.push(_[0].x),h.push(_[0].y);for(let k=1;k<_.length;k++)this.layoutVertexArray.emplaceBack(_[k].x,_[k].y),this.indexArray2.emplaceBack(M+k-1,M+k),h.push(_[k].x),h.push(_[k].y);S.vertexLength+=_.length,S.primitiveLength+=_.length}const d=U0(h,c);for(let _=0;_<d.length;_+=3)this.indexArray.emplaceBack(de+d[_],de+d[_+1],de+d[_+2]);re.vertexLength+=Z,re.primitiveLength+=d.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,D)}}let cx,N0;Di("FillBucket",vm,{omit:["layers","patternFeatures"]});var Ap={get paint(){return N0=N0||new ks({"fill-antialias":new Ei(wt.paint_fill["fill-antialias"]),"fill-opacity":new sr(wt.paint_fill["fill-opacity"]),"fill-color":new sr(wt.paint_fill["fill-color"]),"fill-outline-color":new sr(wt.paint_fill["fill-outline-color"]),"fill-translate":new Ei(wt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ei(wt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ml(wt.paint_fill["fill-pattern"])})},get layout(){return cx=cx||new ks({"fill-sort-key":new sr(wt.layout_fill["fill-sort-key"])})}};class pI extends $n{constructor(u){super(u,Ap)}recalculate(u,m){super.recalculate(u,m);const C=this.paint._values["fill-outline-color"];C.value.kind==="constant"&&C.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new vm(u)}queryRadius(){return kd(this.paint.get("fill-translate"))}queryIntersectsFeature(u,m,C,D,Q,H,Z){return Dn(Vu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),H.angle,Z),D)}isTileClipped(){return!0}}const z0=Kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),gI=Kn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Q0}=z0;var Gu={},V0=v,H0=KA;function KA(f,u,m,C,D){this.properties={},this.extent=m,this.type=0,this._pbf=f,this._geometry=-1,this._keys=C,this._values=D,f.readFields(mI,this,u)}function mI(f,u,m){f==1?u.id=m.readVarint():f==2?function(C,D){for(var Q=C.readVarint()+C.pos;C.pos<Q;){var H=D._keys[C.readVarint()],Z=D._values[C.readVarint()];D.properties[H]=Z}}(m,u):f==3?u.type=m.readVarint():f==4&&(u._geometry=m.pos)}function yI(f){for(var u,m,C=0,D=0,Q=f.length,H=Q-1;D<Q;H=D++)C+=((m=f[H]).x-(u=f[D]).x)*(u.y+m.y);return C}KA.types=["Unknown","Point","LineString","Polygon"],KA.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var u,m=f.readVarint()+f.pos,C=1,D=0,Q=0,H=0,Z=[];f.pos<m;){if(D<=0){var re=f.readVarint();C=7&re,D=re>>3}if(D--,C===1||C===2)Q+=f.readSVarint(),H+=f.readSVarint(),C===1&&(u&&Z.push(u),u=[]),u.push(new V0(Q,H));else{if(C!==7)throw new Error("unknown command "+C);u&&u.push(u[0].clone())}}return u&&Z.push(u),Z},KA.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var u=f.readVarint()+f.pos,m=1,C=0,D=0,Q=0,H=1/0,Z=-1/0,re=1/0,de=-1/0;f.pos<u;){if(C<=0){var h=f.readVarint();m=7&h,C=h>>3}if(C--,m===1||m===2)(D+=f.readSVarint())<H&&(H=D),D>Z&&(Z=D),(Q+=f.readSVarint())<re&&(re=Q),Q>de&&(de=Q);else if(m!==7)throw new Error("unknown command "+m)}return[H,re,Z,de]},KA.prototype.toGeoJSON=function(f,u,m){var C,D,Q=this.extent*Math.pow(2,m),H=this.extent*f,Z=this.extent*u,re=this.loadGeometry(),de=KA.types[this.type];function h(_){for(var S=0;S<_.length;S++){var M=_[S];_[S]=[360*(M.x+H)/Q-180,360/Math.PI*Math.atan(Math.exp((180-360*(M.y+Z)/Q)*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(C=0;C<re.length;C++)c[C]=re[C][0];h(re=c);break;case 2:for(C=0;C<re.length;C++)h(re[C]);break;case 3:for(re=function(_){var S=_.length;if(S<=1)return[_];for(var M,k,G=[],W=0;W<S;W++){var Y=yI(_[W]);Y!==0&&(k===void 0&&(k=Y<0),k===Y<0?(M&&G.push(M),M=[_[W]]):M.push(_[W]))}return M&&G.push(M),G}(re),C=0;C<re.length;C++)for(D=0;D<re[C].length;D++)h(re[C][D])}re.length===1?re=re[0]:de="Multi"+de;var d={type:"Feature",geometry:{type:de,coordinates:re},properties:this.properties};return"id"in this&&(d.id=this.id),d};var _I=H0,ux=hx;function hx(f,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=f,this._keys=[],this._values=[],this._features=[],f.readFields(AA,this,u),this.length=this._features.length}function AA(f,u,m){f===15?u.version=m.readVarint():f===1?u.name=m.readString():f===5?u.extent=m.readVarint():f===2?u._features.push(m.pos):f===3?u._keys.push(m.readString()):f===4&&u._values.push(function(C){for(var D=null,Q=C.readVarint()+C.pos;C.pos<Q;){var H=C.readVarint()>>3;D=H===1?C.readString():H===2?C.readFloat():H===3?C.readDouble():H===4?C.readVarint64():H===5?C.readVarint():H===6?C.readSVarint():H===7?C.readBoolean():null}return D}(m))}hx.prototype.feature=function(f){if(f<0||f>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[f];var u=this._pbf.readVarint()+this._pbf.pos;return new _I(this._pbf,u,this.extent,this._keys,this._values)};var vI=ux;function Ax(f,u,m){if(f===3){var C=new vI(m,m.readVarint()+m.pos);C.length&&(u[C.name]=C)}}Gu.VectorTile=function(f,u){this.layers=f.readFields(Ax,{},u)},Gu.VectorTileFeature=H0,Gu.VectorTileLayer=ux;const jd=Gu.VectorTileFeature.types,G0=Math.pow(2,13);function dp(f,u,m,C,D,Q,H,Z){f.emplaceBack(u,m,2*Math.floor(C*G0)+H,D*G0*2,Q*G0*2,Math.round(Z))}class j0{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new ee,this.centroidVertexArray=new V,this.indexArray=new Oe,this.programConfigurations=new an(u.layers,u.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.features=[],this.hasPattern=up("fill-extrusion",this.layers,m);for(const{feature:D,id:Q,index:H,sourceLayerIndex:Z}of u){const re=this.layers[0]._featureFilter.needGeometry,de=io(D,re);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),de,C))continue;const h={id:Q,sourceLayerIndex:Z,index:H,geometry:re?de.geometry:Os(D),properties:D.properties,type:D.type,patterns:{}};this.hasPattern?this.features.push(hp("fill-extrusion",this.layers,h,this.zoom,m)):this.addFeature(h,h.geometry,H,C,{}),m.featureIndex.insert(D,h.geometry,H,Z,this.index,!0)}}addFeatures(u,m,C){for(const D of this.features){const{geometry:Q}=D;this.addFeature(D,Q,D.index,m,C)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Q0),this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,gI.members,!0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(u,m,C,D,Q){const H={x:0,y:0,vertexCount:0};for(const Z of _m(m,500)){let re=0;for(const S of Z)re+=S.length;let de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const S of Z){if(S.length===0||fx(S))continue;let M=0;for(let k=0;k<S.length;k++){const G=S[k];if(k>=1){const W=S[k-1];if(!dx(G,W)){de.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Y=G.sub(W)._perp()._unit(),ae=W.dist(G);M+ae>32768&&(M=0),dp(this.layoutVertexArray,G.x,G.y,Y.x,Y.y,0,0,M),dp(this.layoutVertexArray,G.x,G.y,Y.x,Y.y,0,1,M),H.x+=2*G.x,H.y+=2*G.y,H.vertexCount+=2,M+=ae,dp(this.layoutVertexArray,W.x,W.y,Y.x,Y.y,0,0,M),dp(this.layoutVertexArray,W.x,W.y,Y.x,Y.y,0,1,M),H.x+=2*W.x,H.y+=2*W.y,H.vertexCount+=2;const fe=de.vertexLength;this.indexArray.emplaceBack(fe,fe+2,fe+1),this.indexArray.emplaceBack(fe+1,fe+2,fe+3),de.vertexLength+=4,de.primitiveLength+=2}}}}if(de.vertexLength+re>dt.MAX_VERTEX_ARRAY_LENGTH&&(de=this.segments.prepareSegment(re,this.layoutVertexArray,this.indexArray)),jd[u.type]!=="Polygon")continue;const h=[],c=[],d=de.vertexLength;for(const S of Z)if(S.length!==0){S!==Z[0]&&c.push(h.length/2);for(let M=0;M<S.length;M++){const k=S[M];dp(this.layoutVertexArray,k.x,k.y,0,0,1,1,0),H.x+=k.x,H.y+=k.y,H.vertexCount+=1,h.push(k.x),h.push(k.y)}}const _=U0(h,c);for(let S=0;S<_.length;S+=3)this.indexArray.emplaceBack(d+_[S],d+_[S+2],d+_[S+1]);de.primitiveLength+=_.length/3,de.vertexLength+=re}for(let Z=0;Z<H.vertexCount;Z++)this.centroidVertexArray.emplaceBack(Math.floor(H.x/H.vertexCount),Math.floor(H.y/H.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,D)}}function dx(f,u){return f.x===u.x&&(f.x<0||f.x>mr)||f.y===u.y&&(f.y<0||f.y>mr)}function fx(f){return f.every(u=>u.x<0)||f.every(u=>u.x>mr)||f.every(u=>u.y<0)||f.every(u=>u.y>mr)}let px;Di("FillExtrusionBucket",j0,{omit:["layers","features"]});var bI={get paint(){return px=px||new ks({"fill-extrusion-opacity":new Ei(wt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sr(wt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ei(wt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ei(wt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ml(wt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new sr(wt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sr(wt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ei(wt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class xI extends $n{constructor(u){super(u,bI)}createBucket(u){return new j0(u)}queryRadius(){return kd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u,m,C,D,Q,H,Z,re){const de=Vu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),H.angle,Z),h=this.paint.get("fill-extrusion-height").evaluate(m,C),c=this.paint.get("fill-extrusion-base").evaluate(m,C),d=function(S,M,k,G){const W=[];for(const Y of S){const ae=[Y.x,Y.y,0,1];Bh(ae,ae,M),W.push(new F(ae[0]/ae[3],ae[1]/ae[3]))}return W}(de,re),_=function(S,M,k,G){const W=[],Y=[],ae=G[8]*M,fe=G[9]*M,me=G[10]*M,Ce=G[11]*M,Me=G[8]*k,Ue=G[9]*k,$e=G[10]*k,Ke=G[11]*k;for(const ut of S){const tt=[],rt=[];for(const yt of ut){const St=yt.x,Jt=yt.y,wi=G[0]*St+G[4]*Jt+G[12],ai=G[1]*St+G[5]*Jt+G[13],fi=G[2]*St+G[6]*Jt+G[14],yi=G[3]*St+G[7]*Jt+G[15],Ri=fi+me,li=yi+Ce,Yt=wi+Me,Gi=ai+Ue,Qi=fi+$e,yr=yi+Ke,Qr=new F((wi+ae)/li,(ai+fe)/li);Qr.z=Ri/li,tt.push(Qr);const qr=new F(Yt/yr,Gi/yr);qr.z=Qi/yr,rt.push(qr)}W.push(tt),Y.push(rt)}return[W,Y]}(D,c,h,re);return function(S,M,k){let G=1/0;Dn(k,M)&&(G=bm(k,M[0]));for(let W=0;W<M.length;W++){const Y=M[W],ae=S[W];for(let fe=0;fe<Y.length-1;fe++){const me=Y[fe],Ce=[me,Y[fe+1],ae[fe+1],ae[fe],me];rc(k,Ce)&&(G=Math.min(G,bm(k,Ce)))}}return G!==1/0&&G}(_[0],_[1],d)}}function fp(f,u){return f.x*u.x+f.y*u.y}function bm(f,u){if(f.length===1){let m=0;const C=u[m++];let D;for(;!D||C.equals(D);)if(D=u[m++],!D)return 1/0;for(;m<u.length;m++){const Q=u[m],H=f[0],Z=D.sub(C),re=Q.sub(C),de=H.sub(C),h=fp(Z,Z),c=fp(Z,re),d=fp(re,re),_=fp(de,Z),S=fp(de,re),M=h*d-c*c,k=(d*_-c*S)/M,G=(h*S-c*_)/M,W=C.z*(1-k-G)+D.z*k+Q.z*G;if(isFinite(W))return W}return 1/0}{let m=1/0;for(const C of u)m=Math.min(m,C.z);return m}}const pp=Kn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:q0}=pp,wI=Kn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:BI}=wI,gx=Gu.VectorTileFeature.types,CI=Math.cos(Math.PI/180*37.5),mx=Math.pow(2,14)/.5;class WA{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(m=>{this.gradients[m.id]={}}),this.layoutVertexArray=new se,this.layoutVertexArray2=new oe,this.indexArray=new Oe,this.programConfigurations=new an(u.layers,u.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.hasPattern=up("line",this.layers,m);const D=this.layers[0].layout.get("line-sort-key"),Q=!D.isConstant(),H=[];for(const{feature:Z,id:re,index:de,sourceLayerIndex:h}of u){const c=this.layers[0]._featureFilter.needGeometry,d=io(Z,c);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),d,C))continue;const _=Q?D.evaluate(d,{},C):void 0,S={id:re,properties:Z.properties,type:Z.type,sourceLayerIndex:h,index:de,geometry:c?d.geometry:Os(Z),patterns:{},sortKey:_};H.push(S)}Q&&H.sort((Z,re)=>Z.sortKey-re.sortKey);for(const Z of H){const{geometry:re,index:de,sourceLayerIndex:h}=Z;if(this.hasPattern){const c=hp("line",this.layers,Z,this.zoom,m);this.patternFeatures.push(c)}else this.addFeature(Z,re,de,C,{});m.featureIndex.insert(u[de].feature,re,de,h,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}addFeatures(u,m,C){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,BI)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,q0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,m,C,D,Q){const H=this.layers[0].layout,Z=H.get("line-join").evaluate(u,{}),re=H.get("line-cap"),de=H.get("line-miter-limit"),h=H.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(const c of m)this.addLine(c,u,Z,re,de,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,D)}addLine(u,m,C,D,Q,H){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<u.length-1;G++)this.totalDistance+=u[G].dist(u[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const Z=gx[m.type]==="Polygon";let re=u.length;for(;re>=2&&u[re-1].equals(u[re-2]);)re--;let de=0;for(;de<re-1&&u[de].equals(u[de+1]);)de++;if(re<(Z?3:2))return;C==="bevel"&&(Q=1.05);const h=this.overscaling<=16?15*mr/(512*this.overscaling):0,c=this.segments.prepareSegment(10*re,this.layoutVertexArray,this.indexArray);let d,_,S,M,k;this.e1=this.e2=-1,Z&&(d=u[re-2],k=u[de].sub(d)._unit()._perp());for(let G=de;G<re;G++){if(S=G===re-1?Z?u[de+1]:void 0:u[G+1],S&&u[G].equals(S))continue;k&&(M=k),d&&(_=d),d=u[G],k=S?S.sub(d)._unit()._perp():M,M=M||k;let W=M.add(k);W.x===0&&W.y===0||W._unit();const Y=M.x*k.x+M.y*k.y,ae=W.x*k.x+W.y*k.y,fe=ae!==0?1/ae:1/0,me=2*Math.sqrt(2-2*ae),Ce=ae<CI&&_&&S,Me=M.x*k.y-M.y*k.x>0;if(Ce&&G>de){const Ke=d.dist(_);if(Ke>2*h){const ut=d.sub(d.sub(_)._mult(h/Ke)._round());this.updateDistance(_,ut),this.addCurrentVertex(ut,M,0,0,c),_=ut}}const Ue=_&&S;let $e=Ue?C:Z?"butt":D;if(Ue&&$e==="round"&&(fe<H?$e="miter":fe<=2&&($e="fakeround")),$e==="miter"&&fe>Q&&($e="bevel"),$e==="bevel"&&(fe>2&&($e="flipbevel"),fe<Q&&($e="miter")),_&&this.updateDistance(_,d),$e==="miter")W._mult(fe),this.addCurrentVertex(d,W,0,0,c);else if($e==="flipbevel"){if(fe>100)W=k.mult(-1);else{const Ke=fe*M.add(k).mag()/M.sub(k).mag();W._perp()._mult(Ke*(Me?-1:1))}this.addCurrentVertex(d,W,0,0,c),this.addCurrentVertex(d,W.mult(-1),0,0,c)}else if($e==="bevel"||$e==="fakeround"){const Ke=-Math.sqrt(fe*fe-1),ut=Me?Ke:0,tt=Me?0:Ke;if(_&&this.addCurrentVertex(d,M,ut,tt,c),$e==="fakeround"){const rt=Math.round(180*me/Math.PI/20);for(let yt=1;yt<rt;yt++){let St=yt/rt;if(St!==.5){const wi=St-.5;St+=St*wi*(St-1)*((1.0904+Y*(Y*(3.55645-1.43519*Y)-3.2452))*wi*wi+(.848013+Y*(.215638*Y-1.06021)))}const Jt=k.sub(M)._mult(St)._add(M)._unit()._mult(Me?-1:1);this.addHalfVertex(d,Jt.x,Jt.y,!1,Me,0,c)}}S&&this.addCurrentVertex(d,k,-ut,-tt,c)}else if($e==="butt")this.addCurrentVertex(d,W,0,0,c);else if($e==="square"){const Ke=_?1:-1;this.addCurrentVertex(d,W,Ke,Ke,c)}else $e==="round"&&(_&&(this.addCurrentVertex(d,M,0,0,c),this.addCurrentVertex(d,M,1,1,c,!0)),S&&(this.addCurrentVertex(d,k,-1,-1,c,!0),this.addCurrentVertex(d,k,0,0,c)));if(Ce&&G<re-1){const Ke=d.dist(S);if(Ke>2*h){const ut=d.add(S.sub(d)._mult(h/Ke)._round());this.updateDistance(d,ut),this.addCurrentVertex(ut,k,0,0,c),d=ut}}}}addCurrentVertex(u,m,C,D,Q){let H=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const Z=m.y*D-m.x,re=-m.y-m.x*D;this.addHalfVertex(u,m.x+m.y*C,m.y-m.x*C,H,!1,C,Q),this.addHalfVertex(u,Z,re,H,!0,-D,Q),this.distance>mx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(u,m,C,D,Q,H))}addHalfVertex(u,m,C,D,Q,H,Z){let{x:re,y:de}=u;const h=.5*(this.lineClips?this.scaledDistance*(mx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((re<<1)+(D?1:0),(de<<1)+(Q?1:0),Math.round(63*m)+128,Math.round(63*C)+128,1+(H===0?0:H<0?-1:1)|(63&h)<<2,h>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=Z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),Z.primitiveLength++),Q?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(u,m){this.distance+=u.dist(m),this.updateScaledDistance()}}let $0,yx;Di("LineBucket",WA,{omit:["layers","patternFeatures"]});var _x={get paint(){return yx=yx||new ks({"line-opacity":new sr(wt.paint_line["line-opacity"]),"line-color":new sr(wt.paint_line["line-color"]),"line-translate":new Ei(wt.paint_line["line-translate"]),"line-translate-anchor":new Ei(wt.paint_line["line-translate-anchor"]),"line-width":new sr(wt.paint_line["line-width"]),"line-gap-width":new sr(wt.paint_line["line-gap-width"]),"line-offset":new sr(wt.paint_line["line-offset"]),"line-blur":new sr(wt.paint_line["line-blur"]),"line-dasharray":new Gc(wt.paint_line["line-dasharray"]),"line-pattern":new ml(wt.paint_line["line-pattern"]),"line-gradient":new Jl(wt.paint_line["line-gradient"])})},get layout(){return $0=$0||new ks({"line-cap":new Ei(wt.layout_line["line-cap"]),"line-join":new sr(wt.layout_line["line-join"]),"line-miter-limit":new Ei(wt.layout_line["line-miter-limit"]),"line-round-limit":new Ei(wt.layout_line["line-round-limit"]),"line-sort-key":new sr(wt.layout_line["line-sort-key"])})}};class EI extends sr{possiblyEvaluate(u,m){return m=new vn(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),super.possiblyEvaluate(u,m)}evaluate(u,m,C,D){return m=We({},m,{zoom:Math.floor(m.zoom)}),super.evaluate(u,m,C,D)}}let xm;class SI extends $n{constructor(u){super(u,_x),this.gradientVersion=0,xm||(xm=new EI(_x.paint.properties["line-width"].specification),xm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const m=this.gradientExpression();this.stepInterpolant=!!function(C){return C._styleExpression!==void 0}(m)&&m._styleExpression.expression instanceof ca,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,m){super.recalculate(u,m),this.paint._values["line-floorwidth"]=xm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new WA(u)}queryRadius(u){const m=u,C=vx(oA("line-width",this,m),oA("line-gap-width",this,m)),D=oA("line-offset",this,m);return C/2+Math.abs(D)+kd(this.paint.get("line-translate"))}queryIntersectsFeature(u,m,C,D,Q,H,Z){const re=Vu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),H.angle,Z),de=Z/2*vx(this.paint.get("line-width").evaluate(m,C),this.paint.get("line-gap-width").evaluate(m,C)),h=this.paint.get("line-offset").evaluate(m,C);return h&&(D=function(c,d){const _=[];for(let S=0;S<c.length;S++){const M=c[S],k=[];for(let G=0;G<M.length;G++){const W=M[G-1],Y=M[G],ae=M[G+1],fe=G===0?new F(0,0):Y.sub(W)._unit()._perp(),me=G===M.length-1?new F(0,0):ae.sub(Y)._unit()._perp(),Ce=fe._add(me)._unit(),Me=Ce.x*me.x+Ce.y*me.y;Me!==0&&Ce._mult(1/Me),k.push(Ce._mult(d)._add(Y))}_.push(k)}return _}(D,h*Z)),function(c,d,_){for(let S=0;S<d.length;S++){const M=d[S];if(c.length>=3){for(let k=0;k<M.length;k++)if($c(c,M[k]))return!0}if(xc(c,M,_))return!0}return!1}(re,D,de)}isTileClipped(){return!0}}function vx(f,u){return u>0?u+2*f:f}const bx=Kn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),K0=Kn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Kn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xx=Kn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Kn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const W0=Kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wx=Kn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function TI(f,u,m){return f.sections.forEach(C=>{C.text=function(D,Q,H){const Z=Q.layout.get("text-transform").evaluate(H,{});return Z==="uppercase"?D=D.toLocaleUpperCase():Z==="lowercase"&&(D=D.toLocaleLowerCase()),il.applyArabicShaping&&(D=il.applyArabicShaping(D)),D}(C.text,u,m)}),f}Kn([{name:"triangle",components:3,type:"Uint16"}]),Kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Kn([{type:"Float32",name:"offsetX"}]),Kn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Kn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const dA={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var vo=24,Z0=Zn,Bx=function(f,u,m,C,D){var Q,H,Z=8*D-C-1,re=(1<<Z)-1,de=re>>1,h=-7,c=m?D-1:0,d=m?-1:1,_=f[u+c];for(c+=d,Q=_&(1<<-h)-1,_>>=-h,h+=Z;h>0;Q=256*Q+f[u+c],c+=d,h-=8);for(H=Q&(1<<-h)-1,Q>>=-h,h+=C;h>0;H=256*H+f[u+c],c+=d,h-=8);if(Q===0)Q=1-de;else{if(Q===re)return H?NaN:1/0*(_?-1:1);H+=Math.pow(2,C),Q-=de}return(_?-1:1)*H*Math.pow(2,Q-C)},Cx=function(f,u,m,C,D,Q){var H,Z,re,de=8*Q-D-1,h=(1<<de)-1,c=h>>1,d=D===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=C?0:Q-1,S=C?1:-1,M=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(Z=isNaN(u)?1:0,H=h):(H=Math.floor(Math.log(u)/Math.LN2),u*(re=Math.pow(2,-H))<1&&(H--,re*=2),(u+=H+c>=1?d/re:d*Math.pow(2,1-c))*re>=2&&(H++,re/=2),H+c>=h?(Z=0,H=h):H+c>=1?(Z=(u*re-1)*Math.pow(2,D),H+=c):(Z=u*Math.pow(2,c-1)*Math.pow(2,D),H=0));D>=8;f[m+_]=255&Z,_+=S,Z/=256,D-=8);for(H=H<<D|Z,de+=D;de>0;f[m+_]=255&H,_+=S,H/=256,de-=8);f[m+_-S]|=128*M};function Zn(f){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(f)?f:new Uint8Array(f||0),this.pos=0,this.type=0,this.length=this.buf.length}Zn.Varint=0,Zn.Fixed64=1,Zn.Bytes=2,Zn.Fixed32=5;var wm=4294967296,Ex=1/wm,Sx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Bc(f){return f.type===Zn.Bytes?f.readVarint()+f.pos:f.pos+1}function Cs(f,u,m){return m?4294967296*u+(f>>>0):4294967296*(u>>>0)+(f>>>0)}function X0(f,u,m){var C=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));m.realloc(C);for(var D=m.pos-1;D>=f;D--)m.buf[D+C]=m.buf[D]}function Tx(f,u){for(var m=0;m<f.length;m++)u.writeVarint(f[m])}function Ix(f,u){for(var m=0;m<f.length;m++)u.writeSVarint(f[m])}function Xn(f,u){for(var m=0;m<f.length;m++)u.writeFloat(f[m])}function J0(f,u){for(var m=0;m<f.length;m++)u.writeDouble(f[m])}function Lx(f,u){for(var m=0;m<f.length;m++)u.writeBoolean(f[m])}function Mx(f,u){for(var m=0;m<f.length;m++)u.writeFixed32(f[m])}function Th(f,u){for(var m=0;m<f.length;m++)u.writeSFixed32(f[m])}function qd(f,u){for(var m=0;m<f.length;m++)u.writeFixed64(f[m])}function Px(f,u){for(var m=0;m<f.length;m++)u.writeSFixed64(f[m])}function Bm(f,u){return(f[u]|f[u+1]<<8|f[u+2]<<16)+16777216*f[u+3]}function $d(f,u,m){f[m]=u,f[m+1]=u>>>8,f[m+2]=u>>>16,f[m+3]=u>>>24}function Fx(f,u){return(f[u]|f[u+1]<<8|f[u+2]<<16)+(f[u+3]<<24)}Zn.prototype={destroy:function(){this.buf=null},readFields:function(f,u,m){for(m=m||this.length;this.pos<m;){var C=this.readVarint(),D=C>>3,Q=this.pos;this.type=7&C,f(D,u,this),this.pos===Q&&this.skip(C)}return u},readMessage:function(f,u){return this.readFields(f,u,this.readVarint()+this.pos)},readFixed32:function(){var f=Bm(this.buf,this.pos);return this.pos+=4,f},readSFixed32:function(){var f=Fx(this.buf,this.pos);return this.pos+=4,f},readFixed64:function(){var f=Bm(this.buf,this.pos)+Bm(this.buf,this.pos+4)*wm;return this.pos+=8,f},readSFixed64:function(){var f=Bm(this.buf,this.pos)+Fx(this.buf,this.pos+4)*wm;return this.pos+=8,f},readFloat:function(){var f=Bx(this.buf,this.pos,!0,23,4);return this.pos+=4,f},readDouble:function(){var f=Bx(this.buf,this.pos,!0,52,8);return this.pos+=8,f},readVarint:function(f){var u,m,C=this.buf;return u=127&(m=C[this.pos++]),m<128?u:(u|=(127&(m=C[this.pos++]))<<7,m<128?u:(u|=(127&(m=C[this.pos++]))<<14,m<128?u:(u|=(127&(m=C[this.pos++]))<<21,m<128?u:function(D,Q,H){var Z,re,de=H.buf;if(Z=(112&(re=de[H.pos++]))>>4,re<128||(Z|=(127&(re=de[H.pos++]))<<3,re<128)||(Z|=(127&(re=de[H.pos++]))<<10,re<128)||(Z|=(127&(re=de[H.pos++]))<<17,re<128)||(Z|=(127&(re=de[H.pos++]))<<24,re<128)||(Z|=(1&(re=de[H.pos++]))<<31,re<128))return Cs(D,Z,Q);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(m=C[this.pos]))<<28,f,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var f=this.readVarint();return f%2==1?(f+1)/-2:f/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var f=this.readVarint()+this.pos,u=this.pos;return this.pos=f,f-u>=12&&Sx?function(m,C,D){return Sx.decode(m.subarray(C,D))}(this.buf,u,f):function(m,C,D){for(var Q="",H=C;H<D;){var Z,re,de,h=m[H],c=null,d=h>239?4:h>223?3:h>191?2:1;if(H+d>D)break;d===1?h<128&&(c=h):d===2?(192&(Z=m[H+1]))==128&&(c=(31&h)<<6|63&Z)<=127&&(c=null):d===3?(re=m[H+2],(192&(Z=m[H+1]))==128&&(192&re)==128&&((c=(15&h)<<12|(63&Z)<<6|63&re)<=2047||c>=55296&&c<=57343)&&(c=null)):d===4&&(re=m[H+2],de=m[H+3],(192&(Z=m[H+1]))==128&&(192&re)==128&&(192&de)==128&&((c=(15&h)<<18|(63&Z)<<12|(63&re)<<6|63&de)<=65535||c>=1114112)&&(c=null)),c===null?(c=65533,d=1):c>65535&&(c-=65536,Q+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),Q+=String.fromCharCode(c),H+=d}return Q}(this.buf,u,f)},readBytes:function(){var f=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,f);return this.pos=f,u},readPackedVarint:function(f,u){if(this.type!==Zn.Bytes)return f.push(this.readVarint(u));var m=Bc(this);for(f=f||[];this.pos<m;)f.push(this.readVarint(u));return f},readPackedSVarint:function(f){if(this.type!==Zn.Bytes)return f.push(this.readSVarint());var u=Bc(this);for(f=f||[];this.pos<u;)f.push(this.readSVarint());return f},readPackedBoolean:function(f){if(this.type!==Zn.Bytes)return f.push(this.readBoolean());var u=Bc(this);for(f=f||[];this.pos<u;)f.push(this.readBoolean());return f},readPackedFloat:function(f){if(this.type!==Zn.Bytes)return f.push(this.readFloat());var u=Bc(this);for(f=f||[];this.pos<u;)f.push(this.readFloat());return f},readPackedDouble:function(f){if(this.type!==Zn.Bytes)return f.push(this.readDouble());var u=Bc(this);for(f=f||[];this.pos<u;)f.push(this.readDouble());return f},readPackedFixed32:function(f){if(this.type!==Zn.Bytes)return f.push(this.readFixed32());var u=Bc(this);for(f=f||[];this.pos<u;)f.push(this.readFixed32());return f},readPackedSFixed32:function(f){if(this.type!==Zn.Bytes)return f.push(this.readSFixed32());var u=Bc(this);for(f=f||[];this.pos<u;)f.push(this.readSFixed32());return f},readPackedFixed64:function(f){if(this.type!==Zn.Bytes)return f.push(this.readFixed64());var u=Bc(this);for(f=f||[];this.pos<u;)f.push(this.readFixed64());return f},readPackedSFixed64:function(f){if(this.type!==Zn.Bytes)return f.push(this.readSFixed64());var u=Bc(this);for(f=f||[];this.pos<u;)f.push(this.readSFixed64());return f},skip:function(f){var u=7&f;if(u===Zn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Zn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Zn.Fixed32)this.pos+=4;else{if(u!==Zn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(f,u){this.writeVarint(f<<3|u)},realloc:function(f){for(var u=this.length||16;u<this.pos+f;)u*=2;if(u!==this.length){var m=new Uint8Array(u);m.set(this.buf),this.buf=m,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(f){this.realloc(4),$d(this.buf,f,this.pos),this.pos+=4},writeSFixed32:function(f){this.realloc(4),$d(this.buf,f,this.pos),this.pos+=4},writeFixed64:function(f){this.realloc(8),$d(this.buf,-1&f,this.pos),$d(this.buf,Math.floor(f*Ex),this.pos+4),this.pos+=8},writeSFixed64:function(f){this.realloc(8),$d(this.buf,-1&f,this.pos),$d(this.buf,Math.floor(f*Ex),this.pos+4),this.pos+=8},writeVarint:function(f){(f=+f||0)>268435455||f<0?function(u,m){var C,D;if(u>=0?(C=u%4294967296|0,D=u/4294967296|0):(D=~(-u/4294967296),4294967295^(C=~(-u%4294967296))?C=C+1|0:(C=0,D=D+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),function(Q,H,Z){Z.buf[Z.pos++]=127&Q|128,Q>>>=7,Z.buf[Z.pos++]=127&Q|128,Q>>>=7,Z.buf[Z.pos++]=127&Q|128,Q>>>=7,Z.buf[Z.pos++]=127&Q|128,Z.buf[Z.pos]=127&(Q>>>=7)}(C,0,m),function(Q,H){var Z=(7&Q)<<4;H.buf[H.pos++]|=Z|((Q>>>=3)?128:0),Q&&(H.buf[H.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(H.buf[H.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(H.buf[H.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(H.buf[H.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(H.buf[H.pos++]=127&Q)))))}(D,m)}(f,this):(this.realloc(4),this.buf[this.pos++]=127&f|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=f>>>7&127))))},writeSVarint:function(f){this.writeVarint(f<0?2*-f-1:2*f)},writeBoolean:function(f){this.writeVarint(!!f)},writeString:function(f){f=String(f),this.realloc(4*f.length),this.pos++;var u=this.pos;this.pos=function(C,D,Q){for(var H,Z,re=0;re<D.length;re++){if((H=D.charCodeAt(re))>55295&&H<57344){if(!Z){H>56319||re+1===D.length?(C[Q++]=239,C[Q++]=191,C[Q++]=189):Z=H;continue}if(H<56320){C[Q++]=239,C[Q++]=191,C[Q++]=189,Z=H;continue}H=Z-55296<<10|H-56320|65536,Z=null}else Z&&(C[Q++]=239,C[Q++]=191,C[Q++]=189,Z=null);H<128?C[Q++]=H:(H<2048?C[Q++]=H>>6|192:(H<65536?C[Q++]=H>>12|224:(C[Q++]=H>>18|240,C[Q++]=H>>12&63|128),C[Q++]=H>>6&63|128),C[Q++]=63&H|128)}return Q}(this.buf,f,this.pos);var m=this.pos-u;m>=128&&X0(u,m,this),this.pos=u-1,this.writeVarint(m),this.pos+=m},writeFloat:function(f){this.realloc(4),Cx(this.buf,f,this.pos,!0,23,4),this.pos+=4},writeDouble:function(f){this.realloc(8),Cx(this.buf,f,this.pos,!0,52,8),this.pos+=8},writeBytes:function(f){var u=f.length;this.writeVarint(u),this.realloc(u);for(var m=0;m<u;m++)this.buf[this.pos++]=f[m]},writeRawMessage:function(f,u){this.pos++;var m=this.pos;f(u,this);var C=this.pos-m;C>=128&&X0(m,C,this),this.pos=m-1,this.writeVarint(C),this.pos+=C},writeMessage:function(f,u,m){this.writeTag(f,Zn.Bytes),this.writeRawMessage(u,m)},writePackedVarint:function(f,u){u.length&&this.writeMessage(f,Tx,u)},writePackedSVarint:function(f,u){u.length&&this.writeMessage(f,Ix,u)},writePackedBoolean:function(f,u){u.length&&this.writeMessage(f,Lx,u)},writePackedFloat:function(f,u){u.length&&this.writeMessage(f,Xn,u)},writePackedDouble:function(f,u){u.length&&this.writeMessage(f,J0,u)},writePackedFixed32:function(f,u){u.length&&this.writeMessage(f,Mx,u)},writePackedSFixed32:function(f,u){u.length&&this.writeMessage(f,Th,u)},writePackedFixed64:function(f,u){u.length&&this.writeMessage(f,qd,u)},writePackedSFixed64:function(f,u){u.length&&this.writeMessage(f,Px,u)},writeBytesField:function(f,u){this.writeTag(f,Zn.Bytes),this.writeBytes(u)},writeFixed32Field:function(f,u){this.writeTag(f,Zn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(f,u){this.writeTag(f,Zn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(f,u){this.writeTag(f,Zn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(f,u){this.writeTag(f,Zn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(f,u){this.writeTag(f,Zn.Varint),this.writeVarint(u)},writeSVarintField:function(f,u){this.writeTag(f,Zn.Varint),this.writeSVarint(u)},writeStringField:function(f,u){this.writeTag(f,Zn.Bytes),this.writeString(u)},writeFloatField:function(f,u){this.writeTag(f,Zn.Fixed32),this.writeFloat(u)},writeDoubleField:function(f,u){this.writeTag(f,Zn.Fixed64),this.writeDouble(u)},writeBooleanField:function(f,u){this.writeVarintField(f,!!u)}};var Y0=g(Z0);const e_=3;function II(f,u,m){f===1&&m.readMessage(LI,u)}function LI(f,u,m){if(f===3){const{id:C,bitmap:D,width:Q,height:H,left:Z,top:re,advance:de}=m.readMessage(MI,{});u.push({id:C,bitmap:new _u({width:Q+2*e_,height:H+2*e_},D),metrics:{width:Q,height:H,left:Z,top:re,advance:de}})}}function MI(f,u,m){f===1?u.id=m.readVarint():f===2?u.bitmap=m.readBytes():f===3?u.width=m.readVarint():f===4?u.height=m.readVarint():f===5?u.left=m.readSVarint():f===6?u.top=m.readSVarint():f===7&&(u.advance=m.readVarint())}const Dx=e_;function gp(f){let u=0,m=0;for(const H of f)u+=H.w*H.h,m=Math.max(m,H.w);f.sort((H,Z)=>Z.h-H.h);const C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),m),h:1/0}];let D=0,Q=0;for(const H of f)for(let Z=C.length-1;Z>=0;Z--){const re=C[Z];if(!(H.w>re.w||H.h>re.h)){if(H.x=re.x,H.y=re.y,Q=Math.max(Q,H.y+H.h),D=Math.max(D,H.x+H.w),H.w===re.w&&H.h===re.h){const de=C.pop();Z<C.length&&(C[Z]=de)}else H.h===re.h?(re.x+=H.w,re.w-=H.w):H.w===re.w?(re.y+=H.h,re.h-=H.h):(C.push({x:re.x+H.w,y:re.y,w:re.w-H.w,h:H.h}),re.y+=H.h,re.h-=H.h);break}}return{w:D,h:Q,fill:u/(D*Q)||0}}const No=1;class Cm{constructor(u,m){let{pixelRatio:C,version:D,stretchX:Q,stretchY:H,content:Z}=m;this.paddedRect=u,this.pixelRatio=C,this.stretchX=Q,this.stretchY=H,this.content=Z,this.version=D}get tl(){return[this.paddedRect.x+No,this.paddedRect.y+No]}get br(){return[this.paddedRect.x+this.paddedRect.w-No,this.paddedRect.y+this.paddedRect.h-No]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*No)/this.pixelRatio,(this.paddedRect.h-2*No)/this.pixelRatio]}}class Em{constructor(u,m){const C={},D={};this.haveRenderCallbacks=[];const Q=[];this.addImages(u,C,Q),this.addImages(m,D,Q);const{w:H,h:Z}=gp(Q),re=new bl({width:H||1,height:Z||1});for(const de in u){const h=u[de],c=C[de].paddedRect;bl.copy(h.data,re,{x:0,y:0},{x:c.x+No,y:c.y+No},h.data)}for(const de in m){const h=m[de],c=D[de].paddedRect,d=c.x+No,_=c.y+No,S=h.data.width,M=h.data.height;bl.copy(h.data,re,{x:0,y:0},{x:d,y:_},h.data),bl.copy(h.data,re,{x:0,y:M-1},{x:d,y:_-1},{width:S,height:1}),bl.copy(h.data,re,{x:0,y:0},{x:d,y:_+M},{width:S,height:1}),bl.copy(h.data,re,{x:S-1,y:0},{x:d-1,y:_},{width:1,height:M}),bl.copy(h.data,re,{x:0,y:0},{x:d+S,y:_},{width:1,height:M})}this.image=re,this.iconPositions=C,this.patternPositions=D}addImages(u,m,C){for(const D in u){const Q=u[D],H={x:0,y:0,w:Q.data.width+2*No,h:Q.data.height+2*No};C.push(H),m[D]=new Cm(H,Q),Q.hasRenderCallback&&this.haveRenderCallbacks.push(D)}}patchUpdatedImages(u,m){u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const C in u.updatedImages)this.patchUpdatedImage(this.iconPositions[C],u.getImage(C),m),this.patchUpdatedImage(this.patternPositions[C],u.getImage(C),m)}patchUpdatedImage(u,m,C){if(!u||!m||u.version===m.version)return;u.version=m.version;const[D,Q]=u.tl;C.update(m.data,void 0,{x:D,y:Q})}}var ju;Di("ImagePosition",Cm),Di("ImageAtlas",Em),l.ah=void 0,(ju=l.ah||(l.ah={}))[ju.none=0]="none",ju[ju.horizontal=1]="horizontal",ju[ju.vertical=2]="vertical",ju[ju.horizontalOnly=3]="horizontalOnly";const mp=-17;class yp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(u,m){const C=new yp;return C.scale=u||1,C.fontStack=m,C}static forImage(u){const m=new yp;return m.imageName=u,m}}class Kd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,m){const C=new Kd;for(let D=0;D<u.sections.length;D++){const Q=u.sections[D];Q.image?C.addImageSection(Q):C.addTextSection(Q,m)}return C}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(){this.text=function(u){let m="";for(let C=0;C<u.length;C++){const D=u.charCodeAt(C+1)||null,Q=u.charCodeAt(C-1)||null;m+=D&&du(D)&&!dA[u[C+1]]||Q&&du(Q)&&!dA[u[C-1]]||!dA[u[C]]?u[C]:dA[u[C]]}return m}(this.text)}trim(){let u=0;for(let C=0;C<this.text.length&&vp[this.text.charCodeAt(C)];C++)u++;let m=this.text.length;for(let C=this.text.length-1;C>=0&&C>=u&&vp[this.text.charCodeAt(C)];C--)m--;this.text=this.text.substring(u,m),this.sectionIndex=this.sectionIndex.slice(u,m)}substring(u,m){const C=new Kd;return C.text=this.text.substring(u,m),C.sectionIndex=this.sectionIndex.slice(u,m),C.sections=this.sections,C}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((u,m)=>Math.max(u,this.sections[m].scale),0)}addTextSection(u,m){this.text+=u.text,this.sections.push(yp.forText(u.scale,u.fontStack||m));const C=this.sections.length-1;for(let D=0;D<u.text.length;++D)this.sectionIndex.push(C)}addImageSection(u){const m=u.image?u.image.name:"";if(m.length===0)return void Ye("Can't add FormattedSection with an empty image.");const C=this.getNextImageSectionCharCode();C?(this.text+=String.fromCharCode(C),this.sections.push(yp.forImage(m)),this.sectionIndex.push(this.sections.length-1)):Ye("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _p(f,u,m,C,D,Q,H,Z,re,de,h,c,d,_,S,M){const k=Kd.fromFeature(f,D);let G;c===l.ah.vertical&&k.verticalizePunctuation();const{processBidirectionalText:W,processStyledBidirectionalText:Y}=il;if(W&&k.sections.length===1){G=[];const me=W(k.toString(),pA(k,de,Q,u,C,_,S));for(const Ce of me){const Me=new Kd;Me.text=Ce,Me.sections=k.sections;for(let Ue=0;Ue<Ce.length;Ue++)Me.sectionIndex.push(0);G.push(Me)}}else if(Y){G=[];const me=Y(k.text,k.sectionIndex,pA(k,de,Q,u,C,_,S));for(const Ce of me){const Me=new Kd;Me.text=Ce[0],Me.sectionIndex=Ce[1],Me.sections=k.sections,G.push(Me)}}else G=function(me,Ce){const Me=[],Ue=me.text;let $e=0;for(const Ke of Ce)Me.push(me.substring($e,Ke)),$e=Ke;return $e<Ue.length&&Me.push(me.substring($e,Ue.length)),Me}(k,pA(k,de,Q,u,C,_,S));const ae=[],fe={positionedLines:ae,text:k.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:c,iconsInText:!1,verticalizable:!1};return function(me,Ce,Me,Ue,$e,Ke,ut,tt,rt,yt,St,Jt){let wi=0,ai=mp,fi=0,yi=0;const Ri=tt==="right"?1:tt==="left"?0:.5;let li=0;for(const Qr of $e){Qr.trim();const qr=Qr.getMaxScale(),gn=(qr-1)*vo,as={positionedGlyphs:[],lineOffset:0};me.positionedLines[li]=as;const zn=as.positionedGlyphs;let xn=0;if(!Qr.length()){ai+=Ke,++li;continue}for(let hn=0;hn<Qr.length();hn++){const wr=Qr.getSection(hn),Qn=Qr.getSectionIndex(hn),An=Qr.getCharCode(hn);let tn=0,fs=null,Es=null,vs=null,no=vo;const Ss=!(rt===l.ah.horizontal||!St&&!Zl(An)||St&&(vp[An]||(Yt=An,Fi.Arabic(Yt)||Fi["Arabic Supplement"](Yt)||Fi["Arabic Extended-A"](Yt)||Fi["Arabic Presentation Forms-A"](Yt)||Fi["Arabic Presentation Forms-B"](Yt))));if(wr.imageName){const kn=Ue[wr.imageName];if(!kn)continue;vs=wr.imageName,me.iconsInText=me.iconsInText||!0,Es=kn.paddedRect;const Er=kn.displaySize;wr.scale=wr.scale*vo/Jt,fs={width:Er[0],height:Er[1],left:No,top:-Dx,advance:Ss?Er[1]:Er[0]},tn=gn+(vo-Er[1]*wr.scale),no=fs.advance;const Ns=Ss?Er[0]*wr.scale-vo*qr:Er[1]*wr.scale-vo*qr;Ns>0&&Ns>xn&&(xn=Ns)}else{const kn=Me[wr.fontStack],Er=kn&&kn[An];if(Er&&Er.rect)Es=Er.rect,fs=Er.metrics;else{const Ns=Ce[wr.fontStack],ho=Ns&&Ns[An];if(!ho)continue;fs=ho.metrics}tn=(qr-wr.scale)*vo}Ss?(me.verticalizable=!0,zn.push({glyph:An,imageName:vs,x:wi,y:ai+tn,vertical:Ss,scale:wr.scale,fontStack:wr.fontStack,sectionIndex:Qn,metrics:fs,rect:Es}),wi+=no*wr.scale+yt):(zn.push({glyph:An,imageName:vs,x:wi,y:ai+tn,vertical:Ss,scale:wr.scale,fontStack:wr.fontStack,sectionIndex:Qn,metrics:fs,rect:Es}),wi+=fs.advance*wr.scale+yt)}zn.length!==0&&(fi=Math.max(wi-yt,fi),Tm(zn,0,zn.length-1,Ri,xn)),wi=0;const Rn=Ke*qr+xn;as.lineOffset=Math.max(xn,gn),ai+=Rn,yi=Math.max(Rn,yi),++li}var Yt;const Gi=ai-mp,{horizontalAlign:Qi,verticalAlign:yr}=Xd(ut);(function(Qr,qr,gn,as,zn,xn,Rn,hn,wr){const Qn=(qr-gn)*zn;let An=0;An=xn!==Rn?-hn*as-mp:(-as*wr+.5)*Rn;for(const tn of Qr)for(const fs of tn.positionedGlyphs)fs.x+=Qn,fs.y+=An})(me.positionedLines,Ri,Qi,yr,fi,yi,Ke,Gi,$e.length),me.top+=-yr*Gi,me.bottom=me.top+Gi,me.left+=-Qi*fi,me.right=me.left+fi}(fe,u,m,C,G,H,Z,re,c,de,d,M),!function(me){for(const Ce of me)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(ae)&&fe}const vp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wl={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sm(f,u,m,C,D,Q){if(u.imageName){const H=C[u.imageName];return H?H.displaySize[0]*u.scale*vo/Q+D:0}{const H=m[u.fontStack],Z=H&&H[f];return Z?Z.metrics.advance*u.scale+D:0}}function t_(f,u,m,C){const D=Math.pow(f-u,2);return C?f<u?D/2:2*D:D+Math.abs(m)*m}function fA(f,u,m){let C=0;return f===10&&(C-=1e4),m&&(C+=150),f!==40&&f!==65288||(C+=50),u!==41&&u!==65289||(C+=50),C}function Wd(f,u,m,C,D,Q){let H=null,Z=t_(u,m,D,Q);for(const re of C){const de=t_(u-re.x,m,D,Q)+re.badness;de<=Z&&(H=re,Z=de)}return{index:f,x:u,priorBreak:H,badness:Z}}function Zd(f){return f?Zd(f.priorBreak).concat(f.index):[]}function pA(f,u,m,C,D,Q,H){if(Q!=="point")return[];if(!f)return[];const Z=[],re=function(d,_,S,M,k,G){let W=0;for(let Y=0;Y<d.length();Y++){const ae=d.getSection(Y);W+=Sm(d.getCharCode(Y),ae,M,k,_,G)}return W/Math.max(1,Math.ceil(W/S))}(f,u,m,C,D,H),de=f.text.indexOf("​")>=0;let h=0;for(let d=0;d<f.length();d++){const _=f.getSection(d),S=f.getCharCode(d);if(vp[S]||(h+=Sm(S,_,C,D,u,H)),d<f.length()-1){const M=!((c=S)<11904||!(Fi["Bopomofo Extended"](c)||Fi.Bopomofo(c)||Fi["CJK Compatibility Forms"](c)||Fi["CJK Compatibility Ideographs"](c)||Fi["CJK Compatibility"](c)||Fi["CJK Radicals Supplement"](c)||Fi["CJK Strokes"](c)||Fi["CJK Symbols and Punctuation"](c)||Fi["CJK Unified Ideographs Extension A"](c)||Fi["CJK Unified Ideographs"](c)||Fi["Enclosed CJK Letters and Months"](c)||Fi["Halfwidth and Fullwidth Forms"](c)||Fi.Hiragana(c)||Fi["Ideographic Description Characters"](c)||Fi["Kangxi Radicals"](c)||Fi["Katakana Phonetic Extensions"](c)||Fi.Katakana(c)||Fi["Vertical Forms"](c)||Fi["Yi Radicals"](c)||Fi["Yi Syllables"](c)));(wl[S]||M||_.imageName)&&Z.push(Wd(d+1,h,re,Z,fA(S,f.getCharCode(d+1),M&&de),!1))}}var c;return Zd(Wd(f.length(),h,re,Z,0,!0))}function Xd(f){let u=.5,m=.5;switch(f){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":m=1;break;case"top":case"top-right":case"top-left":m=0}return{horizontalAlign:u,verticalAlign:m}}function Tm(f,u,m,C,D){if(!C&&!D)return;const Q=f[m],H=(f[m].x+Q.metrics.advance*Q.scale)*C;for(let Z=u;Z<=m;Z++)f[Z].x-=H,f[Z].y+=D}function PI(f,u,m){const{horizontalAlign:C,verticalAlign:D}=Xd(m),Q=u[0]-f.displaySize[0]*C,H=u[1]-f.displaySize[1]*D;return{image:f,top:H,bottom:H+f.displaySize[1],left:Q,right:Q+f.displaySize[0]}}function i_(f,u,m,C,D,Q){const H=f.image;let Z;if(H.content){const k=H.content,G=H.pixelRatio||1;Z=[k[0]/G,k[1]/G,H.displaySize[0]-k[2]/G,H.displaySize[1]-k[3]/G]}const re=u.left*Q,de=u.right*Q;let h,c,d,_;m==="width"||m==="both"?(_=D[0]+re-C[3],c=D[0]+de+C[1]):(_=D[0]+(re+de-H.displaySize[0])/2,c=_+H.displaySize[0]);const S=u.top*Q,M=u.bottom*Q;return m==="height"||m==="both"?(h=D[1]+S-C[0],d=D[1]+M+C[2]):(h=D[1]+(S+M-H.displaySize[1])/2,d=h+H.displaySize[1]),{image:H,top:h,right:c,bottom:d,left:_,collisionPadding:Z}}const Jd=255,qu=128,Ih=Jd*qu;function r_(f,u){const{expression:m}=u;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new vn(f+1))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:C,interpolationType:D}=m;let Q=0;for(;Q<C.length&&C[Q]<=f;)Q++;Q=Math.max(0,Q-1);let H=Q;for(;H<C.length&&C[H]<f+1;)H++;H=Math.min(C.length-1,H);const Z=C[Q],re=C[H];return m.kind==="composite"?{kind:"composite",minZoom:Z,maxZoom:re,interpolationType:D}:{kind:"camera",minZoom:Z,maxZoom:re,minSize:m.evaluate(new vn(Z)),maxSize:m.evaluate(new vn(re)),interpolationType:D}}}function bp(f,u,m){let C="never";const D=f.get(u);return D?C=D:f.get(m)&&(C="always"),C}const n_=Gu.VectorTileFeature.types,FI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Im(f,u,m,C,D,Q,H,Z,re,de,h,c,d){const _=Z?Math.min(Ih,Math.round(Z[0])):0,S=Z?Math.min(Ih,Math.round(Z[1])):0;f.emplaceBack(u,m,Math.round(32*C),Math.round(32*D),Q,H,(_<<1)+(re?1:0),S,16*de,16*h,256*c,256*d)}function Lm(f,u,m){f.emplaceBack(u.x,u.y,m),f.emplaceBack(u.x,u.y,m),f.emplaceBack(u.x,u.y,m),f.emplaceBack(u.x,u.y,m)}function xp(f){for(const u of f.sections)if(Vc(u.text))return!0;return!1}class Wc{constructor(u){this.layoutVertexArray=new _e,this.indexArray=new Oe,this.programConfigurations=u,this.segments=new dt,this.dynamicLayoutVertexArray=new Ie,this.opacityVertexArray=new ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new a}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(u,m,C,D){this.isEmpty()||(C&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,bx.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,m),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,K0.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,FI,!0),this.opacityVertexBuffer.itemSize=1),(C||D)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Di("SymbolBuffers",Wc);class $u{constructor(u,m,C){this.layoutVertexArray=new u,this.layoutAttributes=m,this.indexArray=new C,this.segments=new dt,this.collisionVertexArray=new et}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,xx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Di("CollisionBuffers",$u);class ZA{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(H=>H.id),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=aA([]),this.placementViewportMatrix=aA([]);const m=this.layers[0]._unevaluatedLayout._values;this.textSizeData=r_(this.zoom,m["text-size"]),this.iconSizeData=r_(this.zoom,m["icon-size"]);const C=this.layers[0].layout,D=C.get("symbol-sort-key"),Q=C.get("symbol-z-order");this.canOverlap=bp(C,"text-overlap","text-allow-overlap")!=="never"||bp(C,"icon-overlap","icon-allow-overlap")!=="never"||C.get("text-ignore-placement")||C.get("icon-ignore-placement"),this.sortFeaturesByKey=Q!=="viewport-y"&&!D.isConstant(),this.sortFeaturesByY=(Q==="viewport-y"||Q==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,C.get("symbol-placement")==="point"&&(this.writingModes=C.get("text-writing-mode").map(H=>l.ah[H])),this.stateDependentLayerIds=this.layers.filter(H=>H.isStateDependent()).map(H=>H.id),this.sourceID=u.sourceID}createArrays(){this.text=new Wc(new an(this.layers,this.zoom,u=>/^text/.test(u))),this.icon=new Wc(new an(this.layers,this.zoom,u=>/^icon/.test(u))),this.glyphOffsetArray=new B,this.lineVertexArray=new I,this.symbolInstances=new x,this.textAnchorOffsets=new y}calculateGlyphDependencies(u,m,C,D,Q){for(let H=0;H<u.length;H++)if(m[u.charCodeAt(H)]=!0,(C||D)&&Q){const Z=dA[u.charAt(H)];Z&&(m[Z.charCodeAt(0)]=!0)}}populate(u,m,C){const D=this.layers[0],Q=D.layout,H=Q.get("text-font"),Z=Q.get("text-field"),re=Q.get("icon-image"),de=(Z.value.kind!=="constant"||Z.value.value instanceof dr&&!Z.value.value.isEmpty()||Z.value.value.toString().length>0)&&(H.value.kind!=="constant"||H.value.value.length>0),h=re.value.kind!=="constant"||!!re.value.value||Object.keys(re.parameters).length>0,c=Q.get("symbol-sort-key");if(this.features=[],!de&&!h)return;const d=m.iconDependencies,_=m.glyphDependencies,S=m.availableImages,M=new vn(this.zoom);for(const{feature:k,id:G,index:W,sourceLayerIndex:Y}of u){const ae=D._featureFilter.needGeometry,fe=io(k,ae);if(!D._featureFilter.filter(M,fe,C))continue;let me,Ce;if(ae||(fe.geometry=Os(k)),de){const Ue=D.getValueAndResolveTokens("text-field",fe,C,S),$e=dr.factory(Ue),Ke=this.hasRTLText=this.hasRTLText||xp($e);(!Ke||il.getRTLTextPluginStatus()==="unavailable"||Ke&&il.isParsed())&&(me=TI($e,D,fe))}if(h){const Ue=D.getValueAndResolveTokens("icon-image",fe,C,S);Ce=Ue instanceof Bn?Ue:Bn.fromString(Ue)}if(!me&&!Ce)continue;const Me=this.sortFeaturesByKey?c.evaluate(fe,{},C):void 0;if(this.features.push({id:G,text:me,icon:Ce,index:W,sourceLayerIndex:Y,geometry:fe.geometry,properties:k.properties,type:n_[k.type],sortKey:Me}),Ce&&(d[Ce.name]=!0),me){const Ue=H.evaluate(fe,{},C).join(","),$e=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ah.vertical)>=0;for(const Ke of me.sections)if(Ke.image)d[Ke.image.name]=!0;else{const ut=Ys(me.toString()),tt=Ke.fontStack||Ue,rt=_[tt]=_[tt]||{};this.calculateGlyphDependencies(Ke.text,rt,$e,this.allowVerticalPlacement,ut)}}}Q.get("symbol-placement")==="line"&&(this.features=function(k){const G={},W={},Y=[];let ae=0;function fe(Ue){Y.push(k[Ue]),ae++}function me(Ue,$e,Ke){const ut=W[Ue];return delete W[Ue],W[$e]=ut,Y[ut].geometry[0].pop(),Y[ut].geometry[0]=Y[ut].geometry[0].concat(Ke[0]),ut}function Ce(Ue,$e,Ke){const ut=G[$e];return delete G[$e],G[Ue]=ut,Y[ut].geometry[0].shift(),Y[ut].geometry[0]=Ke[0].concat(Y[ut].geometry[0]),ut}function Me(Ue,$e,Ke){const ut=Ke?$e[0][$e[0].length-1]:$e[0][0];return`${Ue}:${ut.x}:${ut.y}`}for(let Ue=0;Ue<k.length;Ue++){const $e=k[Ue],Ke=$e.geometry,ut=$e.text?$e.text.toString():null;if(!ut){fe(Ue);continue}const tt=Me(ut,Ke),rt=Me(ut,Ke,!0);if(tt in W&&rt in G&&W[tt]!==G[rt]){const yt=Ce(tt,rt,Ke),St=me(tt,rt,Y[yt].geometry);delete G[tt],delete W[rt],W[Me(ut,Y[St].geometry,!0)]=St,Y[yt].geometry=null}else tt in W?me(tt,rt,Ke):rt in G?Ce(tt,rt,Ke):(fe(Ue),G[tt]=ae-1,W[rt]=ae-1)}return Y.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((k,G)=>k.sortKey-G.sortKey)}update(u,m,C){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,m,this.layers,C),this.icon.programConfigurations.updatePaintArrays(u,m,this.layers,C))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,m){const C=this.lineVertexArray.length;if(u.segment!==void 0){let D=u.dist(m[u.segment+1]),Q=u.dist(m[u.segment]);const H={};for(let Z=u.segment+1;Z<m.length;Z++)H[Z]={x:m[Z].x,y:m[Z].y,tileUnitDistanceFromAnchor:D},Z<m.length-1&&(D+=m[Z+1].dist(m[Z]));for(let Z=u.segment||0;Z>=0;Z--)H[Z]={x:m[Z].x,y:m[Z].y,tileUnitDistanceFromAnchor:Q},Z>0&&(Q+=m[Z-1].dist(m[Z]));for(let Z=0;Z<m.length;Z++){const re=H[Z];this.lineVertexArray.emplaceBack(re.x,re.y,re.tileUnitDistanceFromAnchor)}}return{lineStartIndex:C,lineLength:this.lineVertexArray.length-C}}addSymbols(u,m,C,D,Q,H,Z,re,de,h,c,d){const _=u.indexArray,S=u.layoutVertexArray,M=u.segments.prepareSegment(4*m.length,S,_,this.canOverlap?H.sortKey:void 0),k=this.glyphOffsetArray.length,G=M.vertexLength,W=this.allowVerticalPlacement&&Z===l.ah.vertical?Math.PI/2:0,Y=H.text&&H.text.sections;for(let ae=0;ae<m.length;ae++){const{tl:fe,tr:me,bl:Ce,br:Me,tex:Ue,pixelOffsetTL:$e,pixelOffsetBR:Ke,minFontScaleX:ut,minFontScaleY:tt,glyphOffset:rt,isSDF:yt,sectionIndex:St}=m[ae],Jt=M.vertexLength,wi=rt[1];Im(S,re.x,re.y,fe.x,wi+fe.y,Ue.x,Ue.y,C,yt,$e.x,$e.y,ut,tt),Im(S,re.x,re.y,me.x,wi+me.y,Ue.x+Ue.w,Ue.y,C,yt,Ke.x,$e.y,ut,tt),Im(S,re.x,re.y,Ce.x,wi+Ce.y,Ue.x,Ue.y+Ue.h,C,yt,$e.x,Ke.y,ut,tt),Im(S,re.x,re.y,Me.x,wi+Me.y,Ue.x+Ue.w,Ue.y+Ue.h,C,yt,Ke.x,Ke.y,ut,tt),Lm(u.dynamicLayoutVertexArray,re,W),_.emplaceBack(Jt,Jt+1,Jt+2),_.emplaceBack(Jt+1,Jt+2,Jt+3),M.vertexLength+=4,M.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(rt[0]),ae!==m.length-1&&St===m[ae+1].sectionIndex||u.programConfigurations.populatePaintArrays(S.length,H,H.index,{},d,Y&&Y[St])}u.placedSymbolArray.emplaceBack(re.x,re.y,k,this.glyphOffsetArray.length-k,G,de,h,re.segment,C?C[0]:0,C?C[1]:0,D[0],D[1],Z,0,!1,0,c)}_addCollisionDebugVertex(u,m,C,D,Q,H){return m.emplaceBack(0,0),u.emplaceBack(C.x,C.y,D,Q,Math.round(H.x),Math.round(H.y))}addCollisionDebugVertices(u,m,C,D,Q,H,Z){const re=Q.segments.prepareSegment(4,Q.layoutVertexArray,Q.indexArray),de=re.vertexLength,h=Q.layoutVertexArray,c=Q.collisionVertexArray,d=Z.anchorX,_=Z.anchorY;this._addCollisionDebugVertex(h,c,H,d,_,new F(u,m)),this._addCollisionDebugVertex(h,c,H,d,_,new F(C,m)),this._addCollisionDebugVertex(h,c,H,d,_,new F(C,D)),this._addCollisionDebugVertex(h,c,H,d,_,new F(u,D)),re.vertexLength+=4;const S=Q.indexArray;S.emplaceBack(de,de+1),S.emplaceBack(de+1,de+2),S.emplaceBack(de+2,de+3),S.emplaceBack(de+3,de),re.primitiveLength+=4}addDebugCollisionBoxes(u,m,C,D){for(let Q=u;Q<m;Q++){const H=this.collisionBoxArray.get(Q);this.addCollisionDebugVertices(H.x1,H.y1,H.x2,H.y2,D?this.textCollisionBox:this.iconCollisionBox,H.anchorPoint,C)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $u(Se,W0.members,Re),this.iconCollisionBox=new $u(Se,W0.members,Re);for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u);this.addDebugCollisionBoxes(m.textBoxStartIndex,m.textBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.iconBoxStartIndex,m.iconBoxEndIndex,m,!1),this.addDebugCollisionBoxes(m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m,!1)}}_deserializeCollisionBoxesForSymbol(u,m,C,D,Q,H,Z,re,de){const h={};for(let c=m;c<C;c++){const d=u.get(c);h.textBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},h.textFeatureIndex=d.featureIndex;break}for(let c=D;c<Q;c++){const d=u.get(c);h.verticalTextBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},h.verticalTextFeatureIndex=d.featureIndex;break}for(let c=H;c<Z;c++){const d=u.get(c);h.iconBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},h.iconFeatureIndex=d.featureIndex;break}for(let c=re;c<de;c++){const d=u.get(c);h.verticalIconBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},h.verticalIconFeatureIndex=d.featureIndex;break}return h}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){const C=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,C.textBoxStartIndex,C.textBoxEndIndex,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C.iconBoxStartIndex,C.iconBoxEndIndex,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,m){const C=u.placedSymbolArray.get(m),D=C.vertexStartIndex+4*C.numGlyphs;for(let Q=C.vertexStartIndex;Q<D;Q+=4)u.indexArray.emplaceBack(Q,Q+1,Q+2),u.indexArray.emplaceBack(Q+1,Q+2,Q+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const m=Math.sin(u),C=Math.cos(u),D=[],Q=[],H=[];for(let Z=0;Z<this.symbolInstances.length;++Z){H.push(Z);const re=this.symbolInstances.get(Z);D.push(0|Math.round(m*re.anchorX+C*re.anchorY)),Q.push(re.featureIndex)}return H.sort((Z,re)=>D[Z]-D[re]||Q[re]-Q[Z]),H}addToSortKeyRanges(u,m){const C=this.sortKeyRanges[this.sortKeyRanges.length-1];C&&C.sortKey===m?C.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:m,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){const C=this.symbolInstances.get(m);this.featureSortOrder.push(C.featureIndex),[C.rightJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.leftJustifiedTextSymbolIndex].forEach((D,Q,H)=>{D>=0&&H.indexOf(D)===Q&&this.addIndicesForPlacedSymbol(this.text,D)}),C.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,C.verticalPlacedTextSymbolIndex),C.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.placedIconSymbolIndex),C.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Mm,Rx;Di("SymbolBucket",ZA,{omit:["layers","collisionBoxArray","features","compareText"]}),ZA.MAX_GLYPHS=65535,ZA.addDynamicAttributes=Lm;var s_={get paint(){return Rx=Rx||new ks({"icon-opacity":new sr(wt.paint_symbol["icon-opacity"]),"icon-color":new sr(wt.paint_symbol["icon-color"]),"icon-halo-color":new sr(wt.paint_symbol["icon-halo-color"]),"icon-halo-width":new sr(wt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sr(wt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ei(wt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ei(wt.paint_symbol["icon-translate-anchor"]),"text-opacity":new sr(wt.paint_symbol["text-opacity"]),"text-color":new sr(wt.paint_symbol["text-color"],{runtimeType:Zt,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new sr(wt.paint_symbol["text-halo-color"]),"text-halo-width":new sr(wt.paint_symbol["text-halo-width"]),"text-halo-blur":new sr(wt.paint_symbol["text-halo-blur"]),"text-translate":new Ei(wt.paint_symbol["text-translate"]),"text-translate-anchor":new Ei(wt.paint_symbol["text-translate-anchor"])})},get layout(){return Mm=Mm||new ks({"symbol-placement":new Ei(wt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ei(wt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ei(wt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sr(wt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ei(wt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ei(wt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ei(wt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ei(wt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ei(wt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ei(wt.layout_symbol["icon-rotation-alignment"]),"icon-size":new sr(wt.layout_symbol["icon-size"]),"icon-text-fit":new Ei(wt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ei(wt.layout_symbol["icon-text-fit-padding"]),"icon-image":new sr(wt.layout_symbol["icon-image"]),"icon-rotate":new sr(wt.layout_symbol["icon-rotate"]),"icon-padding":new sr(wt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ei(wt.layout_symbol["icon-keep-upright"]),"icon-offset":new sr(wt.layout_symbol["icon-offset"]),"icon-anchor":new sr(wt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ei(wt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ei(wt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ei(wt.layout_symbol["text-rotation-alignment"]),"text-field":new sr(wt.layout_symbol["text-field"]),"text-font":new sr(wt.layout_symbol["text-font"]),"text-size":new sr(wt.layout_symbol["text-size"]),"text-max-width":new sr(wt.layout_symbol["text-max-width"]),"text-line-height":new Ei(wt.layout_symbol["text-line-height"]),"text-letter-spacing":new sr(wt.layout_symbol["text-letter-spacing"]),"text-justify":new sr(wt.layout_symbol["text-justify"]),"text-radial-offset":new sr(wt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ei(wt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new sr(wt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new sr(wt.layout_symbol["text-anchor"]),"text-max-angle":new Ei(wt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ei(wt.layout_symbol["text-writing-mode"]),"text-rotate":new sr(wt.layout_symbol["text-rotate"]),"text-padding":new Ei(wt.layout_symbol["text-padding"]),"text-keep-upright":new Ei(wt.layout_symbol["text-keep-upright"]),"text-transform":new sr(wt.layout_symbol["text-transform"]),"text-offset":new sr(wt.layout_symbol["text-offset"]),"text-allow-overlap":new Ei(wt.layout_symbol["text-allow-overlap"]),"text-overlap":new Ei(wt.layout_symbol["text-overlap"]),"text-ignore-placement":new Ei(wt.layout_symbol["text-ignore-placement"]),"text-optional":new Ei(wt.layout_symbol["text-optional"])})}};class wp{constructor(u){if(u.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=u.property.overrides?u.property.overrides.runtimeType:Ar,this.defaultValue=u}evaluate(u){if(u.formattedSection){const m=this.defaultValue.property.overrides;if(m&&m.hasOverride(u.formattedSection))return m.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Di("FormatSectionOverride",wp,{omit:["defaultValue"]});class Yd extends $n{constructor(u){super(u,s_)}recalculate(u,m){if(super.recalculate(u,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const C=this.layout.get("text-writing-mode");if(C){const D=[];for(const Q of C)D.indexOf(Q)<0&&D.push(Q);this.layout._values["text-writing-mode"]=D}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(u,m,C,D){const Q=this.layout.get(u).evaluate(m,{},C,D),H=this._unevaluatedLayout._values[u];return H.isDataDriven()||Fr(H.value)||!Q?Q:function(Z,re){return re.replace(/{([^{}]+)}/g,(de,h)=>Z&&h in Z?String(Z[h]):"")}(m.properties,Q)}createBucket(u){return new ZA(u)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const u of s_.paint.overridableProperties){if(!Yd.hasPaintOverride(this.layout,u))continue;const m=this.paint.get(u),C=new wp(m),D=new Pn(C,m.property.specification);let Q=null;Q=m.value.kind==="constant"||m.value.kind==="source"?new Ps("source",D):new Xs("composite",D,m.value.zoomStops),this.paint._values[u]=new _a(m.property,Q,m.parameters)}}_handleOverridablePaintPropertyUpdate(u,m,C){return!(!this.layout||m.isDataDriven()||C.isDataDriven())&&Yd.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,m){const C=u.get("text-field"),D=s_.paint.properties[m];let Q=!1;const H=Z=>{for(const re of Z)if(D.overrides&&D.overrides.hasOverride(re))return void(Q=!0)};if(C.value.kind==="constant"&&C.value.value instanceof dr)H(C.value.value.sections);else if(C.value.kind==="source"){const Z=de=>{Q||(de instanceof Ms&&Zi(de.value)===Zr?H(de.value.sections):de instanceof Ya?H(de.sections):de.eachChild(Z))},re=C.value;re._styleExpression&&Z(re._styleExpression.expression)}return Q}}let kx;var o_={get paint(){return kx=kx||new ks({"background-color":new Ei(wt.paint_background["background-color"]),"background-pattern":new Gc(wt.paint_background["background-pattern"]),"background-opacity":new Ei(wt.paint_background["background-opacity"])})}};class a_ extends $n{constructor(u){super(u,o_)}}let XA;var Ox={get paint(){return XA=XA||new ks({"raster-opacity":new Ei(wt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ei(wt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ei(wt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ei(wt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ei(wt.paint_raster["raster-saturation"]),"raster-contrast":new Ei(wt.paint_raster["raster-contrast"]),"raster-resampling":new Ei(wt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ei(wt.paint_raster["raster-fade-duration"])})}};class Ux extends $n{constructor(u){super(u,Ox)}}class l_ extends $n{constructor(u){super(u,{}),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=u}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Nx{constructor(u){this._methodToThrottle=u,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ef=63710088e-1;class Lh{constructor(u,m){if(isNaN(u)||isNaN(m))throw new Error(`Invalid LngLat object: (${u}, ${m})`);if(this.lng=+u,this.lat=+m,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Lh(je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){const m=Math.PI/180,C=this.lat*m,D=u.lat*m,Q=Math.sin(C)*Math.sin(D)+Math.cos(C)*Math.cos(D)*Math.cos((u.lng-this.lng)*m);return ef*Math.acos(Math.min(Q,1))}static convert(u){if(u instanceof Lh)return u;if(Array.isArray(u)&&(u.length===2||u.length===3))return new Lh(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&typeof u=="object"&&u!==null)return new Lh(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const zx=2*Math.PI*ef;function Qx(f){return zx*Math.cos(f*Math.PI/180)}function c_(f){return(180+f)/360}function Vx(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function Hx(f,u){return f/Qx(u)}function u_(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}class Pm{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+u,this.y=+m,this.z=+C}static fromLngLat(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const C=Lh.convert(u);return new Pm(c_(C.lng),Vx(C.lat),Hx(m,C.lat))}toLngLat(){return new Lh(360*this.x-180,u_(this.y))}toAltitude(){return this.z*Qx(u_(this.y))}meterInMercatorCoordinateUnits(){return 1/zx*(u=u_(this.y),1/Math.cos(u*Math.PI/180));var u}}function Fm(f,u,m){var C=2*Math.PI*6378137/256/Math.pow(2,m);return[f*C-2*Math.PI*6378137/2,u*C-2*Math.PI*6378137/2]}class Ku{constructor(u,m,C){if(u<0||u>25||C<0||C>=Math.pow(2,u)||m<0||m>=Math.pow(2,u))throw new Error(`x=${m}, y=${C}, z=${u} outside of bounds. 0<=x<${Math.pow(2,u)}, 0<=y<${Math.pow(2,u)} 0<=z<=25 `);this.z=u,this.x=m,this.y=C,this.key=tf(0,u,u,m,C)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,m,C){const D=(H=this.y,Z=this.z,re=Fm(256*(Q=this.x),256*(H=Math.pow(2,Z)-H-1),Z),de=Fm(256*(Q+1),256*(H+1),Z),re[0]+","+re[1]+","+de[0]+","+de[1]);var Q,H,Z,re,de;const h=function(c,d,_){let S,M="";for(let k=c;k>0;k--)S=1<<k-1,M+=(d&S?1:0)+(_&S?2:0);return M}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(C==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,m>1?"@2x":"").replace(/{quadkey}/g,h).replace(/{bbox-epsg-3857}/g,D)}isChildOf(u){const m=this.z-u.z;return m>0&&u.x===this.x>>m&&u.y===this.y>>m}getTilePoint(u){const m=Math.pow(2,this.z);return new F((u.x*m-this.x)*mr,(u.y*m-this.y)*mr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class h_{constructor(u,m){this.wrap=u,this.canonical=m,this.key=tf(u,m.z,m.z,m.x,m.y)}}class sc{constructor(u,m,C,D,Q){if(u<C)throw new Error(`overscaledZ should be >= z; overscaledZ = ${u}; z = ${C}`);this.overscaledZ=u,this.wrap=m,this.canonical=new Ku(C,+D,+Q),this.key=tf(m,u,C,D,Q)}clone(){return new sc(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-u;return u>this.canonical.z?new sc(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sc(u,this.wrap,u,this.canonical.x>>m,this.canonical.y>>m)}calculateScaledKey(u,m){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const C=this.canonical.z-u;return u>this.canonical.z?tf(this.wrap*+m,u,this.canonical.z,this.canonical.x,this.canonical.y):tf(this.wrap*+m,u,u,this.canonical.x>>C,this.canonical.y>>C)}isChildOf(u){if(u.wrap!==this.wrap)return!1;const m=this.canonical.z-u.canonical.z;return u.overscaledZ===0||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>m&&u.canonical.y===this.canonical.y>>m}children(u){if(this.overscaledZ>=u)return[new sc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const m=this.canonical.z+1,C=2*this.canonical.x,D=2*this.canonical.y;return[new sc(m,this.wrap,m,C,D),new sc(m,this.wrap,m,C+1,D),new sc(m,this.wrap,m,C,D+1),new sc(m,this.wrap,m,C+1,D+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new sc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new sc(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new h_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(u){return this.canonical.getTilePoint(new Pm(u.x-this.wrap,u.y))}}function tf(f,u,m,C,D){(f*=2)<0&&(f=-1*f-1);const Q=1<<m;return(Q*Q*f+Q*D+C).toString(36)+m.toString(36)+u.toString(36)}Di("CanonicalTileID",Ku),Di("OverscaledTileID",sc,{omit:["posMatrix"]});class A_{constructor(u,m,C){let D=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,H=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,Z=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=u,m.height!==m.width)throw new RangeError("DEM tiles must be square");if(C&&!["mapbox","terrarium","custom"].includes(C))return void Ye(`"${C}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=m.height;const re=this.dim=m.height-2;switch(this.data=new Uint32Array(m.data.buffer),C){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=D,this.greenFactor=Q,this.blueFactor=H,this.baseShift=Z;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let de=0;de<re;de++)this.data[this._idx(-1,de)]=this.data[this._idx(0,de)],this.data[this._idx(re,de)]=this.data[this._idx(re-1,de)],this.data[this._idx(de,-1)]=this.data[this._idx(de,0)],this.data[this._idx(de,re)]=this.data[this._idx(de,re-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(re,-1)]=this.data[this._idx(re-1,0)],this.data[this._idx(-1,re)]=this.data[this._idx(0,re-1)],this.data[this._idx(re,re)]=this.data[this._idx(re-1,re-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let de=0;de<re;de++)for(let h=0;h<re;h++){const c=this.get(de,h);c>this.max&&(this.max=c),c<this.min&&(this.min=c)}}get(u,m){const C=new Uint8Array(this.data.buffer),D=4*this._idx(u,m);return this.unpack(C[D],C[D+1],C[D+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(u,m){if(u<-1||u>=this.dim+1||m<-1||m>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(m+1)*this.stride+(u+1)}unpack(u,m,C){return u*this.redFactor+m*this.greenFactor+C*this.blueFactor-this.baseShift}getPixels(){return new bl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(u,m,C){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let D=m*this.dim,Q=m*this.dim+this.dim,H=C*this.dim,Z=C*this.dim+this.dim;switch(m){case-1:D=Q-1;break;case 1:Q=D+1}switch(C){case-1:H=Z-1;break;case 1:Z=H+1}const re=-m*this.dim,de=-C*this.dim;for(let h=H;h<Z;h++)for(let c=D;c<Q;c++)this.data[this._idx(c,h)]=u.data[this._idx(c+re,h+de)]}}Di("DEMData",A_);class d_{constructor(u){this._stringToNumber={},this._numberToString=[];for(let m=0;m<u.length;m++){const C=u[m];this._stringToNumber[C]=m,this._numberToString[m]=C}}encode(u){return this._stringToNumber[u]}decode(u){if(u>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${u} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[u]}}class f_{constructor(u,m,C,D,Q){this.type="Feature",this._vectorTileFeature=u,u._z=m,u._x=C,u._y=D,this.properties=u.properties,this.id=Q}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){const u={geometry:this.geometry};for(const m in this)m!=="_geometry"&&m!=="_vectorTileFeature"&&(u[m]=this[m]);return u}}class Dm{constructor(u,m){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new Ui(mr,16,0),this.grid3D=new Ui(mr,16,0),this.featureIndexArray=new P,this.promoteId=m}insert(u,m,C,D,Q,H){const Z=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(C,D,Q);const re=H?this.grid3D:this.grid;for(let de=0;de<m.length;de++){const h=m[de],c=[1/0,1/0,-1/0,-1/0];for(let d=0;d<h.length;d++){const _=h[d];c[0]=Math.min(c[0],_.x),c[1]=Math.min(c[1],_.y),c[2]=Math.max(c[2],_.x),c[3]=Math.max(c[3],_.y)}c[0]<mr&&c[1]<mr&&c[2]>=0&&c[3]>=0&&re.insert(Z,c[0],c[1],c[2],c[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Gu.VectorTile(new Y0(this.rawTileData)).layers,this.sourceLayerCoder=new d_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(u,m,C,D){this.loadVTLayers();const Q=u.params||{},H=mr/u.tileSize/u.scale,Z=ql(Q.filter),re=u.queryGeometry,de=u.queryPadding*H,h=p_(re),c=this.grid.query(h.minX-de,h.minY-de,h.maxX+de,h.maxY+de),d=p_(u.cameraQueryGeometry),_=this.grid3D.query(d.minX-de,d.minY-de,d.maxX+de,d.maxY+de,(k,G,W,Y)=>function(ae,fe,me,Ce,Me){for(const $e of ae)if(fe<=$e.x&&me<=$e.y&&Ce>=$e.x&&Me>=$e.y)return!0;const Ue=[new F(fe,me),new F(fe,Me),new F(Ce,Me),new F(Ce,me)];if(ae.length>2){for(const $e of Ue)if($c(ae,$e))return!0}for(let $e=0;$e<ae.length-1;$e++)if(jA(ae[$e],ae[$e+1],Ue))return!0;return!1}(u.cameraQueryGeometry,k-de,G-de,W+de,Y+de));for(const k of _)c.push(k);c.sort(g_);const S={};let M;for(let k=0;k<c.length;k++){const G=c[k];if(G===M)continue;M=G;const W=this.featureIndexArray.get(G);let Y=null;this.loadMatchingFeature(S,W.bucketIndex,W.sourceLayerIndex,W.featureIndex,Z,Q.layers,Q.availableImages,m,C,D,(ae,fe,me)=>(Y||(Y=Os(ae)),fe.queryIntersectsFeature(re,ae,me,Y,this.z,u.transform,H,u.pixelPosMatrix)))}return S}loadMatchingFeature(u,m,C,D,Q,H,Z,re,de,h,c){const d=this.bucketLayerIDs[m];if(H&&!function(k,G){for(let W=0;W<k.length;W++)if(G.indexOf(k[W])>=0)return!0;return!1}(H,d))return;const _=this.sourceLayerCoder.decode(C),S=this.vtLayers[_].feature(D);if(Q.needGeometry){const k=io(S,!0);if(!Q.filter(new vn(this.tileID.overscaledZ),k,this.tileID.canonical))return}else if(!Q.filter(new vn(this.tileID.overscaledZ),S))return;const M=this.getId(S,_);for(let k=0;k<d.length;k++){const G=d[k];if(H&&H.indexOf(G)<0)continue;const W=re[G];if(!W)continue;let Y={};M&&h&&(Y=h.getState(W.sourceLayer||"_geojsonTileLayer",M));const ae=We({},de[G]);ae.paint=Bp(ae.paint,W.paint,S,Y,Z),ae.layout=Bp(ae.layout,W.layout,S,Y,Z);const fe=!c||c(S,W,Y);if(!fe)continue;const me=new f_(S,this.z,this.x,this.y,M);me.layer=ae;let Ce=u[G];Ce===void 0&&(Ce=u[G]=[]),Ce.push({featureIndex:D,feature:me,intersectionZ:fe})}}lookupSymbolFeatures(u,m,C,D,Q,H,Z,re){const de={};this.loadVTLayers();const h=ql(Q);for(const c of u)this.loadMatchingFeature(de,C,D,c,h,H,Z,re,m);return de}hasLayer(u){for(const m of this.bucketLayerIDs)for(const C of m)if(u===C)return!0;return!1}getId(u,m){let C=u.id;return this.promoteId&&(C=u.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[m]],typeof C=="boolean"&&(C=Number(C))),C}}function Bp(f,u,m,C,D){return at(f,(Q,H)=>{const Z=u instanceof to?u.get(H):null;return Z&&Z.evaluate?Z.evaluate(m,C,D):Z})}function p_(f){let u=1/0,m=1/0,C=-1/0,D=-1/0;for(const Q of f)u=Math.min(u,Q.x),m=Math.min(m,Q.y),C=Math.max(C,Q.x),D=Math.max(D,Q.y);return{minX:u,minY:m,maxX:C,maxY:D}}function g_(f,u){return u-f}function m_(f,u,m,C,D){const Q=[];for(let H=0;H<f.length;H++){const Z=f[H];let re;for(let de=0;de<Z.length-1;de++){let h=Z[de],c=Z[de+1];h.x<u&&c.x<u||(h.x<u?h=new F(u,h.y+(u-h.x)/(c.x-h.x)*(c.y-h.y))._round():c.x<u&&(c=new F(u,h.y+(u-h.x)/(c.x-h.x)*(c.y-h.y))._round()),h.y<m&&c.y<m||(h.y<m?h=new F(h.x+(m-h.y)/(c.y-h.y)*(c.x-h.x),m)._round():c.y<m&&(c=new F(h.x+(m-h.y)/(c.y-h.y)*(c.x-h.x),m)._round()),h.x>=C&&c.x>=C||(h.x>=C?h=new F(C,h.y+(C-h.x)/(c.x-h.x)*(c.y-h.y))._round():c.x>=C&&(c=new F(C,h.y+(C-h.x)/(c.x-h.x)*(c.y-h.y))._round()),h.y>=D&&c.y>=D||(h.y>=D?h=new F(h.x+(D-h.y)/(c.y-h.y)*(c.x-h.x),D)._round():c.y>=D&&(c=new F(h.x+(D-h.y)/(c.y-h.y)*(c.x-h.x),D)._round()),re&&h.equals(re[re.length-1])||(re=[h],Q.push(re)),re.push(c)))))}}return Q}Di("FeatureIndex",Dm,{omit:["rawTileData","sourceLayerCoder"]});class zo extends F{constructor(u,m,C,D){super(u,m),this.angle=C,D!==void 0&&(this.segment=D)}clone(){return new zo(this.x,this.y,this.angle,this.segment)}}function rf(f,u,m,C,D){if(u.segment===void 0||m===0)return!0;let Q=u,H=u.segment+1,Z=0;for(;Z>-m/2;){if(H--,H<0)return!1;Z-=f[H].dist(Q),Q=f[H]}Z+=f[H].dist(f[H+1]),H++;const re=[];let de=0;for(;Z<m/2;){const h=f[H],c=f[H+1];if(!c)return!1;let d=f[H-1].angleTo(h)-h.angleTo(c);for(d=Math.abs((d+3*Math.PI)%(2*Math.PI)-Math.PI),re.push({distance:Z,angleDelta:d}),de+=d;Z-re[0].distance>C;)de-=re.shift().angleDelta;if(de>D)return!1;H++,Z+=h.dist(c)}return!0}function y_(f){let u=0;for(let m=0;m<f.length-1;m++)u+=f[m].dist(f[m+1]);return u}function __(f,u,m){return f?.6*u*m:0}function v_(f,u){return Math.max(f?f.right-f.left:0,u?u.right-u.left:0)}function Gx(f,u,m,C,D,Q){const H=__(m,D,Q),Z=v_(m,C)*Q;let re=0;const de=y_(f)/2;for(let h=0;h<f.length-1;h++){const c=f[h],d=f[h+1],_=c.dist(d);if(re+_>de){const S=(de-re)/_,M=En.number(c.x,d.x,S),k=En.number(c.y,d.y,S),G=new zo(M,k,d.angleTo(c),h);return G._round(),!H||rf(f,G,Z,H,u)?G:void 0}re+=_}}function jx(f,u,m,C,D,Q,H,Z,re){const de=__(C,Q,H),h=v_(C,D),c=h*H,d=f[0].x===0||f[0].x===re||f[0].y===0||f[0].y===re;return u-c<u/4&&(u=c+u/4),b_(f,d?u/2*Z%u:(h/2+2*Q)*H*Z%u,u,de,m,c,d,!1,re)}function b_(f,u,m,C,D,Q,H,Z,re){const de=Q/2,h=y_(f);let c=0,d=u-m,_=[];for(let S=0;S<f.length-1;S++){const M=f[S],k=f[S+1],G=M.dist(k),W=k.angleTo(M);for(;d+m<c+G;){d+=m;const Y=(d-c)/G,ae=En.number(M.x,k.x,Y),fe=En.number(M.y,k.y,Y);if(ae>=0&&ae<re&&fe>=0&&fe<re&&d-de>=0&&d+de<=h){const me=new zo(ae,fe,W,S);me._round(),C&&!rf(f,me,Q,C,D)||_.push(me)}}c+=G}return Z||_.length||H||(_=b_(f,c/2,m,C,D,Q,H,!0,re)),_}Di("Anchor",zo);const nf=No;function x_(f,u,m,C){const D=[],Q=f.image,H=Q.pixelRatio,Z=Q.paddedRect.w-2*nf,re=Q.paddedRect.h-2*nf,de=f.right-f.left,h=f.bottom-f.top,c=Q.stretchX||[[0,Z]],d=Q.stretchY||[[0,re]],_=(Ke,ut)=>Ke+ut[1]-ut[0],S=c.reduce(_,0),M=d.reduce(_,0),k=Z-S,G=re-M;let W=0,Y=S,ae=0,fe=M,me=0,Ce=k,Me=0,Ue=G;if(Q.content&&C){const Ke=Q.content;W=vu(c,0,Ke[0]),ae=vu(d,0,Ke[1]),Y=vu(c,Ke[0],Ke[2]),fe=vu(d,Ke[1],Ke[3]),me=Ke[0]-W,Me=Ke[1]-ae,Ce=Ke[2]-Ke[0]-Y,Ue=Ke[3]-Ke[1]-fe}const $e=(Ke,ut,tt,rt)=>{const yt=Cp(Ke.stretch-W,Y,de,f.left),St=Ep(Ke.fixed-me,Ce,Ke.stretch,S),Jt=Cp(ut.stretch-ae,fe,h,f.top),wi=Ep(ut.fixed-Me,Ue,ut.stretch,M),ai=Cp(tt.stretch-W,Y,de,f.left),fi=Ep(tt.fixed-me,Ce,tt.stretch,S),yi=Cp(rt.stretch-ae,fe,h,f.top),Ri=Ep(rt.fixed-Me,Ue,rt.stretch,M),li=new F(yt,Jt),Yt=new F(ai,Jt),Gi=new F(ai,yi),Qi=new F(yt,yi),yr=new F(St/H,wi/H),Qr=new F(fi/H,Ri/H),qr=u*Math.PI/180;if(qr){const zn=Math.sin(qr),xn=Math.cos(qr),Rn=[xn,-zn,zn,xn];li._matMult(Rn),Yt._matMult(Rn),Qi._matMult(Rn),Gi._matMult(Rn)}const gn=Ke.stretch+Ke.fixed,as=ut.stretch+ut.fixed;return{tl:li,tr:Yt,bl:Qi,br:Gi,tex:{x:Q.paddedRect.x+nf+gn,y:Q.paddedRect.y+nf+as,w:tt.stretch+tt.fixed-gn,h:rt.stretch+rt.fixed-as},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yr,pixelOffsetBR:Qr,minFontScaleX:Ce/H/de,minFontScaleY:Ue/H/h,isSDF:m}};if(C&&(Q.stretchX||Q.stretchY)){const Ke=w_(c,k,S),ut=w_(d,G,M);for(let tt=0;tt<Ke.length-1;tt++){const rt=Ke[tt],yt=Ke[tt+1];for(let St=0;St<ut.length-1;St++)D.push($e(rt,ut[St],yt,ut[St+1]))}}else D.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:Z+1},{fixed:0,stretch:re+1}));return D}function vu(f,u,m){let C=0;for(const D of f)C+=Math.max(u,Math.min(m,D[1]))-Math.max(u,Math.min(m,D[0]));return C}function w_(f,u,m){const C=[{fixed:-nf,stretch:0}];for(const[D,Q]of f){const H=C[C.length-1];C.push({fixed:D-H.stretch,stretch:H.stretch}),C.push({fixed:D-H.stretch,stretch:H.stretch+(Q-D)})}return C.push({fixed:u+nf,stretch:m}),C}function Cp(f,u,m,C){return f/u*m+C}function Ep(f,u,m,C){return f-u*m/C}class Sp{constructor(u,m,C,D,Q,H,Z,re,de,h){if(this.boxStartIndex=u.length,de){let c=H.top,d=H.bottom;const _=H.collisionPadding;_&&(c-=_[1],d+=_[3]);let S=d-c;S>0&&(S=Math.max(10,S),this.circleDiameter=S)}else{let c=H.top*Z-re[0],d=H.bottom*Z+re[2],_=H.left*Z-re[3],S=H.right*Z+re[1];const M=H.collisionPadding;if(M&&(_-=M[0]*Z,c-=M[1]*Z,S+=M[2]*Z,d+=M[3]*Z),h){const k=new F(_,c),G=new F(S,c),W=new F(_,d),Y=new F(S,d),ae=h*Math.PI/180;k._rotate(ae),G._rotate(ae),W._rotate(ae),Y._rotate(ae),_=Math.min(k.x,G.x,W.x,Y.x),S=Math.max(k.x,G.x,W.x,Y.x),c=Math.min(k.y,G.y,W.y,Y.y),d=Math.max(k.y,G.y,W.y,Y.y)}u.emplaceBack(m.x,m.y,_,c,S,d,C,D,Q)}this.boxEndIndex=u.length}}class DI{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:RI;if(this.data=u,this.length=this.data.length,this.compare=m,this.length>0)for(let C=(this.length>>1)-1;C>=0;C--)this._down(C)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const u=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:m,compare:C}=this,D=m[u];for(;u>0;){const Q=u-1>>1,H=m[Q];if(C(D,H)>=0)break;m[u]=H,u=Q}m[u]=D}_down(u){const{data:m,compare:C}=this,D=this.length>>1,Q=m[u];for(;u<D;){let H=1+(u<<1),Z=m[H];const re=H+1;if(re<this.length&&C(m[re],Z)<0&&(H=re,Z=m[re]),C(Z,Q)>=0)break;m[u]=Z,u=H}m[u]=Q}}function RI(f,u){return f<u?-1:f>u?1:0}function qx(f){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,C=1/0,D=1/0,Q=-1/0,H=-1/0;const Z=f[0];for(let _=0;_<Z.length;_++){const S=Z[_];(!_||S.x<C)&&(C=S.x),(!_||S.y<D)&&(D=S.y),(!_||S.x>Q)&&(Q=S.x),(!_||S.y>H)&&(H=S.y)}const re=Math.min(Q-C,H-D);let de=re/2;const h=new DI([],sf);if(re===0)return new F(C,D);for(let _=C;_<Q;_+=re)for(let S=D;S<H;S+=re)h.push(new JA(_+de,S+de,de,f));let c=function(_){let S=0,M=0,k=0;const G=_[0];for(let W=0,Y=G.length,ae=Y-1;W<Y;ae=W++){const fe=G[W],me=G[ae],Ce=fe.x*me.y-me.x*fe.y;M+=(fe.x+me.x)*Ce,k+=(fe.y+me.y)*Ce,S+=3*Ce}return new JA(M/S,k/S,0,_)}(f),d=h.length;for(;h.length;){const _=h.pop();(_.d>c.d||!c.d)&&(c=_,m&&console.log("found best %d after %d probes",Math.round(1e4*_.d)/1e4,d)),_.max-c.d<=u||(de=_.h/2,h.push(new JA(_.p.x-de,_.p.y-de,de,f)),h.push(new JA(_.p.x+de,_.p.y-de,de,f)),h.push(new JA(_.p.x-de,_.p.y+de,de,f)),h.push(new JA(_.p.x+de,_.p.y+de,de,f)),d+=4)}return m&&(console.log(`num probes: ${d}`),console.log(`best distance: ${c.d}`)),c.p}function sf(f,u){return u.max-f.max}function JA(f,u,m,C){this.p=new F(f,u),this.h=m,this.d=function(D,Q){let H=!1,Z=1/0;for(let re=0;re<Q.length;re++){const de=Q[re];for(let h=0,c=de.length,d=c-1;h<c;d=h++){const _=de[h],S=de[d];_.y>D.y!=S.y>D.y&&D.x<(S.x-_.x)*(D.y-_.y)/(S.y-_.y)+_.x&&(H=!H),Z=Math.min(Z,Qu(D,_,S))}}return(H?1:-1)*Math.sqrt(Z)}(this.p,C),this.max=this.d+this.h*Math.SQRT2}var bo;l.ap=void 0,(bo=l.ap||(l.ap={}))[bo.center=1]="center",bo[bo.left=2]="left",bo[bo.right=3]="right",bo[bo.top=4]="top",bo[bo.bottom=5]="bottom",bo[bo["top-left"]=6]="top-left",bo[bo["top-right"]=7]="top-right",bo[bo["bottom-left"]=8]="bottom-left",bo[bo["bottom-right"]=9]="bottom-right";const Mh=7,of=Number.POSITIVE_INFINITY;function Tp(f,u){return u[1]!==of?function(m,C,D){let Q=0,H=0;switch(C=Math.abs(C),D=Math.abs(D),m){case"top-right":case"top-left":case"top":H=D-Mh;break;case"bottom-right":case"bottom-left":case"bottom":H=-D+Mh}switch(m){case"top-right":case"bottom-right":case"right":Q=-C;break;case"top-left":case"bottom-left":case"left":Q=C}return[Q,H]}(f,u[0],u[1]):function(m,C){let D=0,Q=0;C<0&&(C=0);const H=C/Math.SQRT2;switch(m){case"top-right":case"top-left":Q=H-Mh;break;case"bottom-right":case"bottom-left":Q=-H+Mh;break;case"bottom":Q=-C+Mh;break;case"top":Q=C-Mh}switch(m){case"top-right":case"bottom-right":D=-H;break;case"top-left":case"bottom-left":D=H;break;case"left":D=C;break;case"right":D=-C}return[D,Q]}(f,u[0])}function Ip(f,u,m){var C;const D=f.layout,Q=(C=D.get("text-variable-anchor-offset"))===null||C===void 0?void 0:C.evaluate(u,{},m);if(Q){const Z=Q.values,re=[];for(let de=0;de<Z.length;de+=2){const h=re[de]=Z[de],c=Z[de+1].map(d=>d*vo);h.startsWith("top")?c[1]-=Mh:h.startsWith("bottom")&&(c[1]+=Mh),re[de+1]=c}return new Or(re)}const H=D.get("text-variable-anchor");if(H){let Z;Z=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[D.get("text-radial-offset").evaluate(u,{},m)*vo,of]:D.get("text-offset").evaluate(u,{},m).map(de=>de*vo);const re=[];for(const de of H)re.push(de,Tp(de,Z));return new Or(re)}return null}function B_(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kI(f,u,m,C,D,Q,H,Z,re,de,h){let c=Q.textMaxSize.evaluate(u,{});c===void 0&&(c=H);const d=f.layers[0].layout,_=d.get("icon-offset").evaluate(u,{},h),S=Kx(m.horizontal),M=H/24,k=f.tilePixelRatio*M,G=f.tilePixelRatio*c/24,W=f.tilePixelRatio*Z,Y=f.tilePixelRatio*d.get("symbol-spacing"),ae=d.get("text-padding")*f.tilePixelRatio,fe=function(rt,yt,St){let Jt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const wi=rt.get("icon-padding").evaluate(yt,{},St),ai=wi&&wi.values;return[ai[0]*Jt,ai[1]*Jt,ai[2]*Jt,ai[3]*Jt]}(d,u,h,f.tilePixelRatio),me=d.get("text-max-angle")/180*Math.PI,Ce=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",Me=d.get("icon-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point",Ue=d.get("symbol-placement"),$e=Y/2,Ke=d.get("icon-text-fit");let ut;C&&Ke!=="none"&&(f.allowVerticalPlacement&&m.vertical&&(ut=i_(C,m.vertical,Ke,d.get("icon-text-fit-padding"),_,M)),S&&(C=i_(C,S,Ke,d.get("icon-text-fit-padding"),_,M)));const tt=(rt,yt)=>{yt.x<0||yt.x>=mr||yt.y<0||yt.y>=mr||function(St,Jt,wi,ai,fi,yi,Ri,li,Yt,Gi,Qi,yr,Qr,qr,gn,as,zn,xn,Rn,hn,wr,Qn,An,tn,fs){const Es=St.addToLineVertexArray(Jt,wi);let vs,no,Ss,kn,Er=0,Ns=0,ho=0,Ao=0,oc=-1,Cc=-1;const na={};let Zu=ui("");if(St.allowVerticalPlacement&&ai.vertical){const Oa=li.layout.get("text-rotate").evaluate(wr,{},tn)+90;Ss=new Sp(Yt,Jt,Gi,Qi,yr,ai.vertical,Qr,qr,gn,Oa),Ri&&(kn=new Sp(Yt,Jt,Gi,Qi,yr,Ri,zn,xn,gn,Oa))}if(fi){const Oa=li.layout.get("icon-rotate").evaluate(wr,{}),Tc=li.layout.get("icon-text-fit")!=="none",YA=x_(fi,Oa,An,Tc),bu=Ri?x_(Ri,Oa,An,Tc):void 0;no=new Sp(Yt,Jt,Gi,Qi,yr,fi,zn,xn,!1,Oa),Er=4*YA.length;const Ua=St.iconSizeData;let Ic=null;Ua.kind==="source"?(Ic=[qu*li.layout.get("icon-size").evaluate(wr,{})],Ic[0]>Ih&&Ye(`${St.layerIds[0]}: Value for "icon-size" is >= ${Jd}. Reduce your "icon-size".`)):Ua.kind==="composite"&&(Ic=[qu*Qn.compositeIconSizes[0].evaluate(wr,{},tn),qu*Qn.compositeIconSizes[1].evaluate(wr,{},tn)],(Ic[0]>Ih||Ic[1]>Ih)&&Ye(`${St.layerIds[0]}: Value for "icon-size" is >= ${Jd}. Reduce your "icon-size".`)),St.addSymbols(St.icon,YA,Ic,hn,Rn,wr,l.ah.none,Jt,Es.lineStartIndex,Es.lineLength,-1,tn),oc=St.icon.placedSymbolArray.length-1,bu&&(Ns=4*bu.length,St.addSymbols(St.icon,bu,Ic,hn,Rn,wr,l.ah.vertical,Jt,Es.lineStartIndex,Es.lineLength,-1,tn),Cc=St.icon.placedSymbolArray.length-1)}const Ec=Object.keys(ai.horizontal);for(const Oa of Ec){const Tc=ai.horizontal[Oa];if(!vs){Zu=ui(Tc.text);const bu=li.layout.get("text-rotate").evaluate(wr,{},tn);vs=new Sp(Yt,Jt,Gi,Qi,yr,Tc,Qr,qr,gn,bu)}const YA=Tc.positionedLines.length===1;if(ho+=$x(St,Jt,Tc,yi,li,gn,wr,as,Es,ai.vertical?l.ah.horizontal:l.ah.horizontalOnly,YA?Ec:[Oa],na,oc,Qn,tn),YA)break}ai.vertical&&(Ao+=$x(St,Jt,ai.vertical,yi,li,gn,wr,as,Es,l.ah.vertical,["vertical"],na,Cc,Qn,tn));const Sc=vs?vs.boxStartIndex:St.collisionBoxArray.length,Bl=vs?vs.boxEndIndex:St.collisionBoxArray.length,Ph=Ss?Ss.boxStartIndex:St.collisionBoxArray.length,kp=Ss?Ss.boxEndIndex:St.collisionBoxArray.length,Xx=no?no.boxStartIndex:St.collisionBoxArray.length,E_=no?no.boxEndIndex:St.collisionBoxArray.length,S_=kn?kn.boxStartIndex:St.collisionBoxArray.length,Fh=kn?kn.boxEndIndex:St.collisionBoxArray.length;let Zc=-1;const Op=(Oa,Tc)=>Oa&&Oa.circleDiameter?Math.max(Oa.circleDiameter,Tc):Tc;Zc=Op(vs,Zc),Zc=Op(Ss,Zc),Zc=Op(no,Zc),Zc=Op(kn,Zc);const Jx=Zc>-1?1:0;Jx&&(Zc*=fs/vo),St.glyphOffsetArray.length>=ZA.MAX_GLYPHS&&Ye("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wr.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,wr.sortKey);const OI=Ip(li,wr,tn),[UI,NI]=function(Oa,Tc){const YA=Oa.length,bu=Tc==null?void 0:Tc.values;if((bu==null?void 0:bu.length)>0)for(let Ua=0;Ua<bu.length;Ua+=2){const Ic=bu[Ua+1];Oa.emplaceBack(l.ap[bu[Ua]],Ic[0],Ic[1])}return[YA,Oa.length]}(St.textAnchorOffsets,OI);St.symbolInstances.emplaceBack(Jt.x,Jt.y,na.right>=0?na.right:-1,na.center>=0?na.center:-1,na.left>=0?na.left:-1,na.vertical||-1,oc,Cc,Zu,Sc,Bl,Ph,kp,Xx,E_,S_,Fh,Gi,ho,Ao,Er,Ns,Jx,0,Qr,Zc,UI,NI)}(f,yt,rt,m,C,D,ut,f.layers[0],f.collisionBoxArray,u.index,u.sourceLayerIndex,f.index,k,[ae,ae,ae,ae],Ce,re,W,fe,Me,_,u,Q,de,h,H)};if(Ue==="line")for(const rt of m_(u.geometry,0,0,mr,mr)){const yt=jx(rt,Y,me,m.vertical||S,C,24,G,f.overscaling,mr);for(const St of yt)S&&af(f,S.text,$e,St)||tt(rt,St)}else if(Ue==="line-center"){for(const rt of u.geometry)if(rt.length>1){const yt=Gx(rt,me,m.vertical||S,C,24,G);yt&&tt(rt,yt)}}else if(u.type==="Polygon")for(const rt of _m(u.geometry,0)){const yt=qx(rt,16);tt(rt[0],new zo(yt.x,yt.y,0))}else if(u.type==="LineString")for(const rt of u.geometry)tt(rt,new zo(rt[0].x,rt[0].y,0));else if(u.type==="Point")for(const rt of u.geometry)for(const yt of rt)tt([yt],new zo(yt.x,yt.y,0))}function $x(f,u,m,C,D,Q,H,Z,re,de,h,c,d,_,S){const M=function(W,Y,ae,fe,me,Ce,Me,Ue){const $e=fe.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,Ke=[];for(const ut of Y.positionedLines)for(const tt of ut.positionedGlyphs){if(!tt.rect)continue;const rt=tt.rect||{};let yt=Dx+1,St=!0,Jt=1,wi=0;const ai=(me||Ue)&&tt.vertical,fi=tt.metrics.advance*tt.scale/2;if(Ue&&Y.verticalizable&&(wi=ut.lineOffset/2-(tt.imageName?-(vo-tt.metrics.width*tt.scale)/2:(tt.scale-1)*vo)),tt.imageName){const hn=Me[tt.imageName];St=hn.sdf,Jt=hn.pixelRatio,yt=No/Jt}const yi=me?[tt.x+fi,tt.y]:[0,0];let Ri=me?[0,0]:[tt.x+fi+ae[0],tt.y+ae[1]-wi],li=[0,0];ai&&(li=Ri,Ri=[0,0]);const Yt=tt.metrics.isDoubleResolution?2:1,Gi=(tt.metrics.left-yt)*tt.scale-fi+Ri[0],Qi=(-tt.metrics.top-yt)*tt.scale+Ri[1],yr=Gi+rt.w/Yt*tt.scale/Jt,Qr=Qi+rt.h/Yt*tt.scale/Jt,qr=new F(Gi,Qi),gn=new F(yr,Qi),as=new F(Gi,Qr),zn=new F(yr,Qr);if(ai){const hn=new F(-fi,fi-mp),wr=-Math.PI/2,Qn=vo/2-fi,An=new F(5-mp-Qn,-(tt.imageName?Qn:0)),tn=new F(...li);qr._rotateAround(wr,hn)._add(An)._add(tn),gn._rotateAround(wr,hn)._add(An)._add(tn),as._rotateAround(wr,hn)._add(An)._add(tn),zn._rotateAround(wr,hn)._add(An)._add(tn)}if($e){const hn=Math.sin($e),wr=Math.cos($e),Qn=[wr,-hn,hn,wr];qr._matMult(Qn),gn._matMult(Qn),as._matMult(Qn),zn._matMult(Qn)}const xn=new F(0,0),Rn=new F(0,0);Ke.push({tl:qr,tr:gn,bl:as,br:zn,tex:rt,writingMode:Y.writingMode,glyphOffset:yi,sectionIndex:tt.sectionIndex,isSDF:St,pixelOffsetTL:xn,pixelOffsetBR:Rn,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,m,Z,D,Q,H,C,f.allowVerticalPlacement),k=f.textSizeData;let G=null;k.kind==="source"?(G=[qu*D.layout.get("text-size").evaluate(H,{})],G[0]>Ih&&Ye(`${f.layerIds[0]}: Value for "text-size" is >= ${Jd}. Reduce your "text-size".`)):k.kind==="composite"&&(G=[qu*_.compositeTextSizes[0].evaluate(H,{},S),qu*_.compositeTextSizes[1].evaluate(H,{},S)],(G[0]>Ih||G[1]>Ih)&&Ye(`${f.layerIds[0]}: Value for "text-size" is >= ${Jd}. Reduce your "text-size".`)),f.addSymbols(f.text,M,G,Z,Q,H,de,u,re.lineStartIndex,re.lineLength,d,S);for(const W of h)c[W]=f.text.placedSymbolArray.length-1;return 4*M.length}function Kx(f){for(const u in f)return f[u];return null}function af(f,u,m,C){const D=f.compareText;if(u in D){const Q=D[u];for(let H=Q.length-1;H>=0;H--)if(C.dist(Q[H])<m)return!0}else D[u]=[];return D[u].push(C),!1}const ra=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wu{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[m,C]=new Uint8Array(u,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");const D=C>>4;if(D!==1)throw new Error(`Got v${D} data when expected v1.`);const Q=ra[15&C];if(!Q)throw new Error("Unrecognized array type.");const[H]=new Uint16Array(u,2,1),[Z]=new Uint32Array(u,4,1);return new Wu(Z,H,Q,u)}constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,D=arguments.length>3?arguments[3]:void 0;if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+m,2),65535),this.ArrayType=C,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;const Q=ra.indexOf(this.ArrayType),H=2*u*this.ArrayType.BYTES_PER_ELEMENT,Z=u*this.IndexArrayType.BYTES_PER_ELEMENT,re=(8-Z%8)%8;if(Q<0)throw new Error(`Unexpected typed array class: ${C}.`);D&&D instanceof ArrayBuffer?(this.data=D,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+Z+re,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+H+Z+re),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+Z+re,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+Q]),new Uint16Array(this.data,2,1)[0]=m,new Uint32Array(this.data,4,1)[0]=u)}add(u,m){const C=this._pos>>1;return this.ids[C]=C,this.coords[this._pos++]=u,this.coords[this._pos++]=m,C}finish(){const u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return Lp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,m,C,D){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Q,coords:H,nodeSize:Z}=this,re=[0,Q.length-1,0],de=[];for(;re.length;){const h=re.pop()||0,c=re.pop()||0,d=re.pop()||0;if(c-d<=Z){for(let k=d;k<=c;k++){const G=H[2*k],W=H[2*k+1];G>=u&&G<=C&&W>=m&&W<=D&&de.push(Q[k])}continue}const _=d+c>>1,S=H[2*_],M=H[2*_+1];S>=u&&S<=C&&M>=m&&M<=D&&de.push(Q[_]),(h===0?u<=S:m<=M)&&(re.push(d),re.push(_-1),re.push(1-h)),(h===0?C>=S:D>=M)&&(re.push(_+1),re.push(c),re.push(1-h))}return de}within(u,m,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:D,coords:Q,nodeSize:H}=this,Z=[0,D.length-1,0],re=[],de=C*C;for(;Z.length;){const h=Z.pop()||0,c=Z.pop()||0,d=Z.pop()||0;if(c-d<=H){for(let k=d;k<=c;k++)Wx(Q[2*k],Q[2*k+1],u,m)<=de&&re.push(D[k]);continue}const _=d+c>>1,S=Q[2*_],M=Q[2*_+1];Wx(S,M,u,m)<=de&&re.push(D[_]),(h===0?u-C<=S:m-C<=M)&&(Z.push(d),Z.push(_-1),Z.push(1-h)),(h===0?u+C>=S:m+C>=M)&&(Z.push(_+1),Z.push(c),Z.push(1-h))}return re}}function Lp(f,u,m,C,D,Q){if(D-C<=m)return;const H=C+D>>1;C_(f,u,H,C,D,Q),Lp(f,u,m,C,H-1,1-Q),Lp(f,u,m,H+1,D,1-Q)}function C_(f,u,m,C,D,Q){for(;D>C;){if(D-C>600){const de=D-C+1,h=m-C+1,c=Math.log(de),d=.5*Math.exp(2*c/3),_=.5*Math.sqrt(c*d*(de-d)/de)*(h-de/2<0?-1:1);C_(f,u,m,Math.max(C,Math.floor(m-h*d/de+_)),Math.min(D,Math.floor(m+(de-h)*d/de+_)),Q)}const H=u[2*m+Q];let Z=C,re=D;for(lf(f,u,C,m),u[2*D+Q]>H&&lf(f,u,C,D);Z<re;){for(lf(f,u,Z,re),Z++,re--;u[2*Z+Q]<H;)Z++;for(;u[2*re+Q]>H;)re--}u[2*C+Q]===H?lf(f,u,C,re):(re++,lf(f,u,re,D)),re<=m&&(C=re+1),m<=re&&(D=re-1)}}function lf(f,u,m,C){Mp(f,m,C),Mp(u,2*m,2*C),Mp(u,2*m+1,2*C+1)}function Mp(f,u,m){const C=f[u];f[u]=f[m],f[m]=C}function Wx(f,u,m,C){const D=f-m,Q=u-C;return D*D+Q*Q}var Rm;l.bd=void 0,(Rm=l.bd||(l.bd={})).create="create",Rm.load="load",Rm.fullLoad="fullLoad";let Pp=null,Fp=[];const km=1e3/60,Dp="loadTime",Rp="fullLoadTime",Zx={mark(f){performance.mark(f)},frame(f){const u=f;Pp!=null&&Fp.push(u-Pp),Pp=u},clearMetrics(){Pp=null,Fp=[],performance.clearMeasures(Dp),performance.clearMeasures(Rp);for(const f in l.bd)performance.clearMarks(l.bd[f])},getPerformanceMetrics(){performance.measure(Dp,l.bd.create,l.bd.load),performance.measure(Rp,l.bd.create,l.bd.fullLoad);const f=performance.getEntriesByName(Dp)[0].duration,u=performance.getEntriesByName(Rp)[0].duration,m=Fp.length,C=1/(Fp.reduce((Q,H)=>Q+H,0)/m/1e3),D=Fp.filter(Q=>Q>km).reduce((Q,H)=>Q+(H-km)/km,0);return{loadTime:f,fullLoadTime:u,fps:C,percentDroppedFrames:D/(m+D)*100,totalFrames:m}}};l.$=dt,l.A=nc,l.B=function(f){if(Pt==null){const u=f.navigator?f.navigator.userAgent:null;Pt=!!f.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Pt},l.C=class{constructor(f,u){this.target=f,this.mapId=u,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Nx(()=>this.process()),this.subscription=function(m,C,D,Q){return m.addEventListener(C,D,!1),{unsubscribe:()=>{m.removeEventListener(C,D,!1)}}}(this.target,"message",m=>this.receive(m)),this.globalScope=Et(self)?f:window}registerMessageHandler(f,u){this.messageHandlers[f]=u}sendAsync(f,u){return new Promise((m,C)=>{const D=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[D]={resolve:m,reject:C},u&&u.signal.addEventListener("abort",()=>{delete this.resolveRejects[D];const Z={id:D,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(Z)},{once:!0});const Q=[],H=Object.assign(Object.assign({},f),{id:D,sourceMapId:this.mapId,origin:location.origin,data:pl(f.data,Q)});this.target.postMessage(H,{transfer:Q})})}receive(f){const u=f.data,m=u.id;if(!(u.origin!=="file://"&&location.origin!=="file://"&&u.origin!==location.origin||u.targetMapId&&this.mapId!==u.targetMapId)){if(u.type==="<cancel>"){delete this.tasks[m];const C=this.abortControllers[m];return delete this.abortControllers[m],void(C&&C.abort())}if(Et(self)||u.mustQueue)return this.tasks[m]=u,this.taskQueue.push(m),void this.invoker.trigger();this.processTask(m,u)}}process(){if(this.taskQueue.length===0)return;const f=this.taskQueue.shift(),u=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),u&&this.processTask(f,u)}processTask(f,u){return s(this,void 0,void 0,function*(){if(u.type==="<response>"){const D=this.resolveRejects[f];return delete this.resolveRejects[f],D?void(u.error?D.reject(Li(u.error)):D.resolve(Li(u.data))):void 0}if(!this.messageHandlers[u.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${u.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const m=Li(u.data),C=new AbortController;this.abortControllers[f]=C;try{const D=yield this.messageHandlers[u.type](u.sourceMapId,m,C);this.completeTask(f,null,D)}catch(D){this.completeTask(f,D)}})}completeTask(f,u,m){const C=[];delete this.abortControllers[f];const D={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:u?pl(u):null,data:pl(m,C)};this.target.postMessage(D,{transfer:C})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},l.D=Ei,l.E=lt,l.F=function(){var f=new nc(16);return nc!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},l.G=Bt,l.H=function(f,u,m){var C,D,Q,H,Z,re,de,h,c,d,_,S,M=m[0],k=m[1],G=m[2];return u===f?(f[12]=u[0]*M+u[4]*k+u[8]*G+u[12],f[13]=u[1]*M+u[5]*k+u[9]*G+u[13],f[14]=u[2]*M+u[6]*k+u[10]*G+u[14],f[15]=u[3]*M+u[7]*k+u[11]*G+u[15]):(D=u[1],Q=u[2],H=u[3],Z=u[4],re=u[5],de=u[6],h=u[7],c=u[8],d=u[9],_=u[10],S=u[11],f[0]=C=u[0],f[1]=D,f[2]=Q,f[3]=H,f[4]=Z,f[5]=re,f[6]=de,f[7]=h,f[8]=c,f[9]=d,f[10]=_,f[11]=S,f[12]=C*M+Z*k+c*G+u[12],f[13]=D*M+re*k+d*G+u[13],f[14]=Q*M+de*k+_*G+u[14],f[15]=H*M+h*k+S*G+u[15]),f},l.I=Cm,l.J=function(f,u,m){var C=m[0],D=m[1],Q=m[2];return f[0]=u[0]*C,f[1]=u[1]*C,f[2]=u[2]*C,f[3]=u[3]*C,f[4]=u[4]*D,f[5]=u[5]*D,f[6]=u[6]*D,f[7]=u[7]*D,f[8]=u[8]*Q,f[9]=u[9]*Q,f[10]=u[10]*Q,f[11]=u[11]*Q,f[12]=u[12],f[13]=u[13],f[14]=u[14],f[15]=u[15],f},l.K=xh,l.L=function(f,u){const m={};for(let C=0;C<u.length;C++){const D=u[C];D in f&&(m[D]=f[D])}return m},l.M=Lh,l.N=c_,l.O=Vx,l.P=F,l.Q=sc,l.R=bl,l.S=he,l.T=gl,l.U=pe,l.V=Ft,l.W=mr,l.X=Kn,l.Y=Pm,l.Z=class extends qs{},l._=s,l.a=pt,l.a$=function(f,u,m){return f[0]=u[0]*m[0],f[1]=u[1]*m[1],f[2]=u[2]*m[2],f[3]=u[3]*m[3],f},l.a0=Ku,l.a1=zt,l.a2=f=>{const u=window.document.createElement("video");return u.muted=!0,new Promise(m=>{u.onloadstart=()=>{m(u)};for(const C of f){const D=window.document.createElement("source");ni(C)||(u.crossOrigin="Anonymous"),D.src=C,u.appendChild(D)}})},l.a3=function(){return Ne++},l.a4=X,l.a5=ZA,l.a6=ql,l.a7=io,l.a8=vn,l.a9=f_,l.aA=ke,l.aB=function(f,u){if(!f)return[{command:"setStyle",args:[u]}];let m=[];try{if(!ht(f.version,u.version))return[{command:"setStyle",args:[u]}];ht(f.center,u.center)||m.push({command:"setCenter",args:[u.center]}),ht(f.zoom,u.zoom)||m.push({command:"setZoom",args:[u.zoom]}),ht(f.bearing,u.bearing)||m.push({command:"setBearing",args:[u.bearing]}),ht(f.pitch,u.pitch)||m.push({command:"setPitch",args:[u.pitch]}),ht(f.sprite,u.sprite)||m.push({command:"setSprite",args:[u.sprite]}),ht(f.glyphs,u.glyphs)||m.push({command:"setGlyphs",args:[u.glyphs]}),ht(f.transition,u.transition)||m.push({command:"setTransition",args:[u.transition]}),ht(f.light,u.light)||m.push({command:"setLight",args:[u.light]}),ht(f.terrain,u.terrain)||m.push({command:"setTerrain",args:[u.terrain]}),ht(f.sky,u.sky)||m.push({command:"setSky",args:[u.sky]});const C={},D=[];(function(H,Z,re,de){let h;for(h in Z=Z||{},H=H||{})Object.prototype.hasOwnProperty.call(H,h)&&(Object.prototype.hasOwnProperty.call(Z,h)||gi(h,re,de));for(h in Z)Object.prototype.hasOwnProperty.call(Z,h)&&(Object.prototype.hasOwnProperty.call(H,h)?ht(H[h],Z[h])||(H[h].type==="geojson"&&Z[h].type==="geojson"&&Ki(H,Z,h)?$t(re,{command:"setGeoJSONSourceData",args:[h,Z[h].data]}):ci(h,Z,re,de)):oi(h,Z,re))})(f.sources,u.sources,D,C);const Q=[];f.layers&&f.layers.forEach(H=>{"source"in H&&C[H.source]?m.push({command:"removeLayer",args:[H.id]}):Q.push(H)}),m=m.concat(D),function(H,Z,re){Z=Z||[];const de=(H=H||[]).map(pr),h=Z.map(pr),c=H.reduce(Mr,{}),d=Z.reduce(Mr,{}),_=de.slice(),S=Object.create(null);let M,k,G,W,Y;for(let ae=0,fe=0;ae<de.length;ae++)M=de[ae],Object.prototype.hasOwnProperty.call(d,M)?fe++:($t(re,{command:"removeLayer",args:[M]}),_.splice(_.indexOf(M,fe),1));for(let ae=0,fe=0;ae<h.length;ae++)M=h[h.length-1-ae],_[_.length-1-ae]!==M&&(Object.prototype.hasOwnProperty.call(c,M)?($t(re,{command:"removeLayer",args:[M]}),_.splice(_.lastIndexOf(M,_.length-fe),1)):fe++,W=_[_.length-ae],$t(re,{command:"addLayer",args:[d[M],W]}),_.splice(_.length-ae,0,M),S[M]=!0);for(let ae=0;ae<h.length;ae++)if(M=h[ae],k=c[M],G=d[M],!S[M]&&!ht(k,G))if(ht(k.source,G.source)&&ht(k["source-layer"],G["source-layer"])&&ht(k.type,G.type)){for(Y in tr(k.layout,G.layout,re,M,null,"setLayoutProperty"),tr(k.paint,G.paint,re,M,null,"setPaintProperty"),ht(k.filter,G.filter)||$t(re,{command:"setFilter",args:[M,G.filter]}),ht(k.minzoom,G.minzoom)&&ht(k.maxzoom,G.maxzoom)||$t(re,{command:"setLayerZoomRange",args:[M,G.minzoom,G.maxzoom]}),k)Object.prototype.hasOwnProperty.call(k,Y)&&Y!=="layout"&&Y!=="paint"&&Y!=="filter"&&Y!=="metadata"&&Y!=="minzoom"&&Y!=="maxzoom"&&(Y.indexOf("paint.")===0?tr(k[Y],G[Y],re,M,Y.slice(6),"setPaintProperty"):ht(k[Y],G[Y])||$t(re,{command:"setLayerProperty",args:[M,Y,G[Y]]}));for(Y in G)Object.prototype.hasOwnProperty.call(G,Y)&&!Object.prototype.hasOwnProperty.call(k,Y)&&Y!=="layout"&&Y!=="paint"&&Y!=="filter"&&Y!=="metadata"&&Y!=="minzoom"&&Y!=="maxzoom"&&(Y.indexOf("paint.")===0?tr(k[Y],G[Y],re,M,Y.slice(6),"setPaintProperty"):ht(k[Y],G[Y])||$t(re,{command:"setLayerProperty",args:[M,Y,G[Y]]}))}else $t(re,{command:"removeLayer",args:[M]}),W=_[_.lastIndexOf(M)+1],$t(re,{command:"addLayer",args:[G,W]})}(Q,u.layers,m)}catch(C){console.warn("Unable to compute style diff:",C),m=[{command:"setStyle",args:[u]}]}return m},l.aC=function(f){const u=[],m=f.id;return m===void 0&&u.push({message:`layers.${m}: missing required property "id"`}),f.render===void 0&&u.push({message:`layers.${m}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&u.push({message:`layers.${m}: property "renderingMode" must be either "2d" or "3d"`}),u},l.aD=function f(u,m){if(Array.isArray(u)){if(!Array.isArray(m)||u.length!==m.length)return!1;for(let C=0;C<u.length;C++)if(!f(u[C],m[C]))return!1;return!0}if(typeof u=="object"&&u!==null&&m!==null){if(typeof m!="object"||Object.keys(u).length!==Object.keys(m).length)return!1;for(const C in u)if(!f(u[C],m[C]))return!1;return!0}return u===m},l.aE=at,l.aF=nt,l.aG=class extends Rr{constructor(f,u){super(f,u),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},l.aH=xr,l.aI=class extends Rr{constructor(f,u){super(f,u),this.current=Wn}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let u=1;u<16;u++)if(f[u]!==this.current[u]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},l.aJ=$r,l.aK=class extends Rr{constructor(f,u){super(f,u),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},l.aL=class extends Rr{constructor(f,u){super(f,u),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},l.aM=br,l.aN=function(f,u,m,C,D,Q,H){var Z=1/(u-m),re=1/(C-D),de=1/(Q-H);return f[0]=-2*Z,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*re,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*de,f[11]=0,f[12]=(u+m)*Z,f[13]=(D+C)*re,f[14]=(H+Q)*de,f[15]=1,f},l.aO=gr,l.aP=wh,l.aQ=class extends tc{},l.aR=wx,l.aS=class extends Oo{},l.aT=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},l.aU=zd,l.aV=V,l.aW=class extends L{},l.aX=Oe,l.aY=function(f,u){return f[0]===u[0]&&f[1]===u[1]&&f[2]===u[2]&&f[3]===u[3]&&f[4]===u[4]&&f[5]===u[5]&&f[6]===u[6]&&f[7]===u[7]&&f[8]===u[8]&&f[9]===u[9]&&f[10]===u[10]&&f[11]===u[11]&&f[12]===u[12]&&f[13]===u[13]&&f[14]===u[14]&&f[15]===u[15]},l.aZ=function(f,u){var m=f[0],C=f[1],D=f[2],Q=f[3],H=f[4],Z=f[5],re=f[6],de=f[7],h=f[8],c=f[9],d=f[10],_=f[11],S=f[12],M=f[13],k=f[14],G=f[15],W=u[0],Y=u[1],ae=u[2],fe=u[3],me=u[4],Ce=u[5],Me=u[6],Ue=u[7],$e=u[8],Ke=u[9],ut=u[10],tt=u[11],rt=u[12],yt=u[13],St=u[14],Jt=u[15];return Math.abs(m-W)<=ta*Math.max(1,Math.abs(m),Math.abs(W))&&Math.abs(C-Y)<=ta*Math.max(1,Math.abs(C),Math.abs(Y))&&Math.abs(D-ae)<=ta*Math.max(1,Math.abs(D),Math.abs(ae))&&Math.abs(Q-fe)<=ta*Math.max(1,Math.abs(Q),Math.abs(fe))&&Math.abs(H-me)<=ta*Math.max(1,Math.abs(H),Math.abs(me))&&Math.abs(Z-Ce)<=ta*Math.max(1,Math.abs(Z),Math.abs(Ce))&&Math.abs(re-Me)<=ta*Math.max(1,Math.abs(re),Math.abs(Me))&&Math.abs(de-Ue)<=ta*Math.max(1,Math.abs(de),Math.abs(Ue))&&Math.abs(h-$e)<=ta*Math.max(1,Math.abs(h),Math.abs($e))&&Math.abs(c-Ke)<=ta*Math.max(1,Math.abs(c),Math.abs(Ke))&&Math.abs(d-ut)<=ta*Math.max(1,Math.abs(d),Math.abs(ut))&&Math.abs(_-tt)<=ta*Math.max(1,Math.abs(_),Math.abs(tt))&&Math.abs(S-rt)<=ta*Math.max(1,Math.abs(S),Math.abs(rt))&&Math.abs(M-yt)<=ta*Math.max(1,Math.abs(M),Math.abs(yt))&&Math.abs(k-St)<=ta*Math.max(1,Math.abs(k),Math.abs(St))&&Math.abs(G-Jt)<=ta*Math.max(1,Math.abs(G),Math.abs(Jt))},l.a_=function(f,u){return f[0]=u[0],f[1]=u[1],f[2]=u[2],f[3]=u[3],f[4]=u[4],f[5]=u[5],f[6]=u[6],f[7]=u[7],f[8]=u[8],f[9]=u[9],f[10]=u[10],f[11]=u[11],f[12]=u[12],f[13]=u[13],f[14]=u[14],f[15]=u[15],f},l.aa=function(f){const u={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(m,C,D,Q)=>{const H=D||Q;return u[C]=!H||H.toLowerCase(),""}),u["max-age"]){const m=parseInt(u["max-age"],10);isNaN(m)?delete u["max-age"]:u["max-age"]=m}return u},l.ab=function(f,u){const m=[];for(const C in f)C in u||m.push(C);return m},l.ac=qe,l.ad=function(f,u,m){var C=Math.sin(m),D=Math.cos(m),Q=u[0],H=u[1],Z=u[2],re=u[3],de=u[4],h=u[5],c=u[6],d=u[7];return u!==f&&(f[8]=u[8],f[9]=u[9],f[10]=u[10],f[11]=u[11],f[12]=u[12],f[13]=u[13],f[14]=u[14],f[15]=u[15]),f[0]=Q*D+de*C,f[1]=H*D+h*C,f[2]=Z*D+c*C,f[3]=re*D+d*C,f[4]=de*D-Q*C,f[5]=h*D-H*C,f[6]=c*D-Z*C,f[7]=d*D-re*C,f},l.ae=function(f){var u=new nc(16);return u[0]=f[0],u[1]=f[1],u[2]=f[2],u[3]=f[3],u[4]=f[4],u[5]=f[5],u[6]=f[6],u[7]=f[7],u[8]=f[8],u[9]=f[9],u[10]=f[10],u[11]=f[11],u[12]=f[12],u[13]=f[13],u[14]=f[14],u[15]=f[15],u},l.af=Bh,l.ag=function(f,u){let m=0,C=0;if(f.kind==="constant")C=f.layoutSize;else if(f.kind!=="source"){const{interpolationType:D,minZoom:Q,maxZoom:H}=f,Z=D?qe(hs.interpolationFactor(D,u,Q,H),0,1):0;f.kind==="camera"?C=En.number(f.minSize,f.maxSize,Z):m=Z}return{uSizeT:m,uSize:C}},l.ai=function(f,u,m){let{uSize:C,uSizeT:D}=u,{lowerSize:Q,upperSize:H}=m;return f.kind==="source"?Q/qu:f.kind==="composite"?En.number(Q/qu,H/qu,D):C},l.aj=Lm,l.ak=function(f,u,m,C){const D=u.y-f.y,Q=u.x-f.x,H=C.y-m.y,Z=C.x-m.x,re=H*Q-Z*D;if(re===0)return null;const de=(Z*(f.y-m.y)-H*(f.x-m.x))/re;return new F(f.x+de*Q,f.y+de*D)},l.al=m_,l.am=rc,l.an=aA,l.ao=vo,l.aq=bp,l.ar=function(f,u){var m=u[0],C=u[1],D=u[2],Q=u[3],H=u[4],Z=u[5],re=u[6],de=u[7],h=u[8],c=u[9],d=u[10],_=u[11],S=u[12],M=u[13],k=u[14],G=u[15],W=m*Z-C*H,Y=m*re-D*H,ae=m*de-Q*H,fe=C*re-D*Z,me=C*de-Q*Z,Ce=D*de-Q*re,Me=h*M-c*S,Ue=h*k-d*S,$e=h*G-_*S,Ke=c*k-d*M,ut=c*G-_*M,tt=d*G-_*k,rt=W*tt-Y*ut+ae*Ke+fe*$e-me*Ue+Ce*Me;return rt?(f[0]=(Z*tt-re*ut+de*Ke)*(rt=1/rt),f[1]=(D*ut-C*tt-Q*Ke)*rt,f[2]=(M*Ce-k*me+G*fe)*rt,f[3]=(d*me-c*Ce-_*fe)*rt,f[4]=(re*$e-H*tt-de*Ue)*rt,f[5]=(m*tt-D*$e+Q*Ue)*rt,f[6]=(k*ae-S*Ce-G*Y)*rt,f[7]=(h*Ce-d*ae+_*Y)*rt,f[8]=(H*ut-Z*$e+de*Me)*rt,f[9]=(C*$e-m*ut-Q*Me)*rt,f[10]=(S*me-M*ae+G*W)*rt,f[11]=(c*ae-h*me-_*W)*rt,f[12]=(Z*Ue-H*Ke-re*Me)*rt,f[13]=(m*Ke-C*Ue+D*Me)*rt,f[14]=(M*Y-S*fe-k*W)*rt,f[15]=(h*fe-c*Y+d*W)*rt,f):null},l.as=B_,l.at=Xd,l.au=Wu,l.av=function(){const f={},u=wt.$version;for(const m in wt.$root){const C=wt.$root[m];if(C.required){let D=null;D=m==="version"?u:C.type==="array"?[]:{},D!=null&&(f[m]=D)}}return f},l.aw=bc,l.ax=Mt,l.ay=function(f){f=f.slice();const u=Object.create(null);for(let m=0;m<f.length;m++)u[f[m].id]=f[m];for(let m=0;m<f.length;m++)"ref"in f[m]&&(f[m]=ti(f[m],u[f[m].ref]));return f},l.az=function(f){if(f.type==="custom")return new l_(f);switch(f.type){case"background":return new a_(f);case"circle":return new lA(f);case"fill":return new pI(f);case"fill-extrusion":return new xI(f);case"heatmap":return new Ch(f);case"hillshade":return new tp(f);case"line":return new SI(f);case"raster":return new Ux(f);case"symbol":return new Yd(f)}},l.b=bt,l.b0=function(f,u){return f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3]},l.b1=je,l.b2=h_,l.b3=Hx,l.b4=function(f,u,m,C,D){var Q,H=1/Math.tan(u/2);return f[0]=H/m,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=H,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,D!=null&&D!==1/0?(f[10]=(D+C)*(Q=1/(C-D)),f[14]=2*D*C*Q):(f[10]=-1,f[14]=-2*C),f},l.b5=function(f,u,m){var C=Math.sin(m),D=Math.cos(m),Q=u[4],H=u[5],Z=u[6],re=u[7],de=u[8],h=u[9],c=u[10],d=u[11];return u!==f&&(f[0]=u[0],f[1]=u[1],f[2]=u[2],f[3]=u[3],f[12]=u[12],f[13]=u[13],f[14]=u[14],f[15]=u[15]),f[4]=Q*D+de*C,f[5]=H*D+h*C,f[6]=Z*D+c*C,f[7]=re*D+d*C,f[8]=de*D-Q*C,f[9]=h*D-H*C,f[10]=c*D-Z*C,f[11]=d*D-re*C,f},l.b6=be,l.b7=Te,l.b8=function(f){return f*Math.PI/180},l.b9=function(f,u){return f[0]=u[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=u[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=u[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},l.bA=il,l.ba=class extends sn{},l.bb=ef,l.bc=Zx,l.be=Dt,l.bf=function(f,u){pt.REGISTERED_PROTOCOLS[f]=u},l.bg=function(f){delete pt.REGISTERED_PROTOCOLS[f]},l.bh=function(f,u){const m={};for(let D=0;D<f.length;D++){const Q=u&&u[f[D].id]||Uu(f[D]);u&&(u[f[D].id]=Q);let H=m[Q];H||(H=m[Q]=[]),H.push(f[D])}const C=[];for(const D in m)C.push(m[D]);return C},l.bi=Di,l.bj=d_,l.bk=Dm,l.bl=Em,l.bm=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=mr/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;const u=f.bucket.layers[0],m=u.layout,C=u._unevaluatedLayout._values,D={layoutIconSize:C["icon-size"].possiblyEvaluate(new vn(f.bucket.zoom+1),f.canonical),layoutTextSize:C["text-size"].possiblyEvaluate(new vn(f.bucket.zoom+1),f.canonical),textMaxSize:C["text-size"].possiblyEvaluate(new vn(18))};if(f.bucket.textSizeData.kind==="composite"){const{minZoom:de,maxZoom:h}=f.bucket.textSizeData;D.compositeTextSizes=[C["text-size"].possiblyEvaluate(new vn(de),f.canonical),C["text-size"].possiblyEvaluate(new vn(h),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){const{minZoom:de,maxZoom:h}=f.bucket.iconSizeData;D.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new vn(de),f.canonical),C["icon-size"].possiblyEvaluate(new vn(h),f.canonical)]}const Q=m.get("text-line-height")*vo,H=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point",Z=m.get("text-keep-upright"),re=m.get("text-size");for(const de of f.bucket.features){const h=m.get("text-font").evaluate(de,{},f.canonical).join(","),c=re.evaluate(de,{},f.canonical),d=D.layoutTextSize.evaluate(de,{},f.canonical),_=D.layoutIconSize.evaluate(de,{},f.canonical),S={horizontal:{},vertical:void 0},M=de.text;let k,G=[0,0];if(M){const ae=M.toString(),fe=m.get("text-letter-spacing").evaluate(de,{},f.canonical)*vo,me=eo(ae)?fe:0,Ce=m.get("text-anchor").evaluate(de,{},f.canonical),Me=Ip(u,de,f.canonical);if(!Me){const tt=m.get("text-radial-offset").evaluate(de,{},f.canonical);G=tt?Tp(Ce,[tt*vo,of]):m.get("text-offset").evaluate(de,{},f.canonical).map(rt=>rt*vo)}let Ue=H?"center":m.get("text-justify").evaluate(de,{},f.canonical);const $e=m.get("symbol-placement"),Ke=$e==="point"?m.get("text-max-width").evaluate(de,{},f.canonical)*vo:0,ut=()=>{f.bucket.allowVerticalPlacement&&Ys(ae)&&(S.vertical=_p(M,f.glyphMap,f.glyphPositions,f.imagePositions,h,Ke,Q,Ce,"left",me,G,l.ah.vertical,!0,$e,d,c))};if(!H&&Me){const tt=new Set;if(Ue==="auto")for(let yt=0;yt<Me.values.length;yt+=2)tt.add(B_(Me.values[yt]));else tt.add(Ue);let rt=!1;for(const yt of tt)if(!S.horizontal[yt])if(rt)S.horizontal[yt]=S.horizontal[0];else{const St=_p(M,f.glyphMap,f.glyphPositions,f.imagePositions,h,Ke,Q,"center",yt,me,G,l.ah.horizontal,!1,$e,d,c);St&&(S.horizontal[yt]=St,rt=St.positionedLines.length===1)}ut()}else{Ue==="auto"&&(Ue=B_(Ce));const tt=_p(M,f.glyphMap,f.glyphPositions,f.imagePositions,h,Ke,Q,Ce,Ue,me,G,l.ah.horizontal,!1,$e,d,c);tt&&(S.horizontal[Ue]=tt),ut(),Ys(ae)&&H&&Z&&(S.vertical=_p(M,f.glyphMap,f.glyphPositions,f.imagePositions,h,Ke,Q,Ce,Ue,me,G,l.ah.vertical,!1,$e,d,c))}}let W=!1;if(de.icon&&de.icon.name){const ae=f.imageMap[de.icon.name];ae&&(k=PI(f.imagePositions[de.icon.name],m.get("icon-offset").evaluate(de,{},f.canonical),m.get("icon-anchor").evaluate(de,{},f.canonical)),W=!!ae.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=W:f.bucket.sdfIcons!==W&&Ye("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==f.bucket.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}const Y=Kx(S.horizontal)||S.vertical;f.bucket.iconsInText=!!Y&&Y.iconsInText,(Y||k)&&kI(f.bucket,de,S,k,f.imageMap,D,d,_,G,W,f.canonical)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},l.bn=WA,l.bo=vm,l.bp=j0,l.bq=Gu,l.br=Y0,l.bs=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},l.bt=function(f,u,m,C,D){return s(this,void 0,void 0,function*(){if(pe())try{return yield Ft(f,u,m,C,D)}catch{}return function(Q,H,Z,re,de){const h=Q.width,c=Q.height;Xt&&Le||(Xt=new OffscreenCanvas(h,c),Le=Xt.getContext("2d",{willReadFrequently:!0})),Xt.width=h,Xt.height=c,Le.drawImage(Q,0,0,h,c);const d=Le.getImageData(H,Z,re,de);return Le.clearRect(0,0,h,c),d.data}(f,u,m,C,D)})},l.bu=A_,l.bv=g,l.bw=v,l.bx=Z0,l.by=Ir,l.bz=function(f){return f.message===Xe},l.c=it,l.d=f=>s(void 0,void 0,void 0,function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));const u=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(u)}catch(m){throw new Error(`Could not load image because of ${m.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),l.e=We,l.f=f=>new Promise((u,m)=>{const C=new Image;C.onload=()=>{u(C),URL.revokeObjectURL(C.src),C.onload=null,window.requestAnimationFrame(()=>{C.src=Rt})},C.onerror=()=>m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(f)],{type:"image/png"});C.src=f.byteLength?URL.createObjectURL(D):Rt}),l.g=mt,l.h=(f,u)=>qt(We(f,{type:"json"}),u),l.i=Et,l.j=kt,l.k=Pi,l.l=(f,u)=>qt(We(f,{type:"arrayBuffer"}),u),l.m=qt,l.n=function(f){return new Y0(f).readFields(II,[])},l.o=_u,l.p=gp,l.q=ks,l.r=ma,l.s=ni,l.t=Yo,l.u=Fi,l.v=wt,l.w=Ye,l.x=Nn,l.y=function(f){let[u,m,C]=f;return m+=90,m*=Math.PI/180,C*=Math.PI/180,{x:u*Math.cos(m)*Math.sin(C),y:u*Math.sin(m)*Math.sin(C),z:u*Math.cos(C)}},l.z=En}),n("worker",["./shared"],function(l){class s{constructor(Be){this.keyCache={},Be&&this.replace(Be)}replace(Be){this._layerConfigs={},this._layers={},this.update(Be,[])}update(Be,ce){for(const ue of Be){this._layerConfigs[ue.id]=ue;const ge=this._layers[ue.id]=l.az(ue);ge._featureFilter=l.a6(ge.filter),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of ce)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const ie=l.bh(Object.values(this._layerConfigs),this.keyCache);for(const ue of ie){const ge=ue.map(Ge=>this._layers[Ge.id]),xe=ge[0];if(xe.visibility==="none")continue;const Ee=xe.source||"";let we=this.familiesBySource[Ee];we||(we=this.familiesBySource[Ee]={});const Fe=xe.sourceLayer||"_geojsonTileLayer";let ze=we[Fe];ze||(ze=we[Fe]=[]),ze.push(ge)}}}class g{constructor(Be){const ce={},ie=[];for(const Ee in Be){const we=Be[Ee],Fe=ce[Ee]={};for(const ze in we){const Ge=we[+ze];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const st={x:0,y:0,w:Ge.bitmap.width+2,h:Ge.bitmap.height+2};ie.push(st),Fe[ze]={rect:st,metrics:Ge.metrics}}}const{w:ue,h:ge}=l.p(ie),xe=new l.o({width:ue||1,height:ge||1});for(const Ee in Be){const we=Be[Ee];for(const Fe in we){const ze=we[+Fe];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Ge=ce[Ee][Fe].rect;l.o.copy(ze.bitmap,xe,{x:0,y:0},{x:Ge.x+1,y:Ge.y+1},ze.bitmap)}}this.image=xe,this.positions=ce}}l.bi("GlyphAtlas",g);class v{constructor(Be){this.tileID=new l.Q(Be.tileID.overscaledZ,Be.tileID.wrap,Be.tileID.canonical.z,Be.tileID.canonical.x,Be.tileID.canonical.y),this.uid=Be.uid,this.zoom=Be.zoom,this.pixelRatio=Be.pixelRatio,this.tileSize=Be.tileSize,this.source=Be.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Be.showCollisionBoxes,this.collectResourceTiming=!!Be.collectResourceTiming,this.returnDependencies=!!Be.returnDependencies,this.promoteId=Be.promoteId,this.inFlightDependencies=[]}parse(Be,ce,ie,ue){return l._(this,void 0,void 0,function*(){this.status="parsing",this.data=Be,this.collisionBoxArray=new l.a4;const ge=new l.bj(Object.keys(Be.layers).sort()),xe=new l.bk(this.tileID,this.promoteId);xe.bucketLayerIDs=[];const Ee={},we={featureIndex:xe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie},Fe=ce.familiesBySource[this.source];for(const Ci in Fe){const Ni=Be.layers[Ci];if(!Ni)continue;Ni.version===1&&l.w(`Vector tile source "${this.source}" layer "${Ci}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ot=ge.encode(Ci),ri=[];for(let Vt=0;Vt<Ni.length;Vt++){const Vi=Ni.feature(Vt),lr=xe.getId(Vi,Ci);ri.push({feature:Vi,id:lr,index:Vt,sourceLayerIndex:ot})}for(const Vt of Fe[Ci]){const Vi=Vt[0];Vi.source!==this.source&&l.w(`layer.source = ${Vi.source} does not equal this.source = ${this.source}`),Vi.minzoom&&this.zoom<Math.floor(Vi.minzoom)||Vi.maxzoom&&this.zoom>=Vi.maxzoom||Vi.visibility!=="none"&&(T(Vt,this.zoom,ie),(Ee[Vi.id]=Vi.createBucket({index:xe.bucketLayerIDs.length,layers:Vt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ot,sourceID:this.source})).populate(ri,we,this.tileID.canonical),xe.bucketLayerIDs.push(Vt.map(lr=>lr.id)))}}const ze=l.aE(we.glyphDependencies,Ci=>Object.keys(Ci).map(Number));this.inFlightDependencies.forEach(Ci=>Ci==null?void 0:Ci.abort()),this.inFlightDependencies=[];let Ge=Promise.resolve({});if(Object.keys(ze).length){const Ci=new AbortController;this.inFlightDependencies.push(Ci),Ge=ue.sendAsync({type:"getGlyphs",data:{stacks:ze,source:this.source,tileID:this.tileID,type:"glyphs"}},Ci)}const st=Object.keys(we.iconDependencies);let vt=Promise.resolve({});if(st.length){const Ci=new AbortController;this.inFlightDependencies.push(Ci),vt=ue.sendAsync({type:"getImages",data:{icons:st,source:this.source,tileID:this.tileID,type:"icons"}},Ci)}const Tt=Object.keys(we.patternDependencies);let Kt=Promise.resolve({});if(Tt.length){const Ci=new AbortController;this.inFlightDependencies.push(Ci),Kt=ue.sendAsync({type:"getImages",data:{icons:Tt,source:this.source,tileID:this.tileID,type:"patterns"}},Ci)}const[ii,Gt,Ai]=yield Promise.all([Ge,vt,Kt]),Bi=new g(ii),Hi=new l.bl(Gt,Ai);for(const Ci in Ee){const Ni=Ee[Ci];Ni instanceof l.a5?(T(Ni.layers,this.zoom,ie),l.bm({bucket:Ni,glyphMap:ii,glyphPositions:Bi.positions,imageMap:Gt,imagePositions:Hi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ni.hasPattern&&(Ni instanceof l.bn||Ni instanceof l.bo||Ni instanceof l.bp)&&(T(Ni.layers,this.zoom,ie),Ni.addFeatures(we,this.tileID.canonical,Hi.patternPositions))}return this.status="done",{buckets:Object.values(Ee).filter(Ci=>!Ci.isEmpty()),featureIndex:xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Bi.image,imageAtlas:Hi,glyphMap:this.returnDependencies?ii:null,iconMap:this.returnDependencies?Gt:null,glyphPositions:this.returnDependencies?Bi.positions:null}})}}function T(Qe,Be,ce){const ie=new l.a8(Be);for(const ue of Qe)ue.recalculate(ie,ce)}class F{constructor(Be,ce,ie){this.actor=Be,this.layerIndex=ce,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Be,ce){return l._(this,void 0,void 0,function*(){const ie=yield l.l(Be.request,ce);try{return{vectorTile:new l.bq.VectorTile(new l.br(ie.data)),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(ue){const ge=new Uint8Array(ie.data);let xe=`Unable to parse the tile at ${Be.request.url}, `;throw xe+=ge[0]===31&&ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ue.messge}`,new Error(xe)}})}loadTile(Be){return l._(this,void 0,void 0,function*(){const ce=Be.uid,ie=!!(Be&&Be.request&&Be.request.collectResourceTiming)&&new l.bs(Be.request),ue=new v(Be);this.loading[ce]=ue;const ge=new AbortController;ue.abort=ge;try{const xe=yield this.loadVectorTile(Be,ge);if(delete this.loading[ce],!xe)return null;const Ee=xe.rawData,we={};xe.expires&&(we.expires=xe.expires),xe.cacheControl&&(we.cacheControl=xe.cacheControl);const Fe={};if(ie){const Ge=ie.finish();Ge&&(Fe.resourceTiming=JSON.parse(JSON.stringify(Ge)))}ue.vectorTile=xe.vectorTile;const ze=ue.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ce]=ue,this.fetching[ce]={rawTileData:Ee,cacheControl:we,resourceTiming:Fe};try{const Ge=yield ze;return l.e({rawTileData:Ee.slice(0)},Ge,we,Fe)}finally{delete this.fetching[ce]}}catch(xe){throw delete this.loading[ce],ue.status="done",this.loaded[ce]=ue,xe}})}reloadTile(Be){return l._(this,void 0,void 0,function*(){const ce=Be.uid;if(!this.loaded||!this.loaded[ce])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[ce];if(ie.showCollisionBoxes=Be.showCollisionBoxes,ie.status==="parsing"){const ue=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor);let ge;if(this.fetching[ce]){const{rawTileData:xe,cacheControl:Ee,resourceTiming:we}=this.fetching[ce];delete this.fetching[ce],ge=l.e({rawTileData:xe.slice(0)},ue,Ee,we)}else ge=ue;return ge}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Be){return l._(this,void 0,void 0,function*(){const ce=this.loading,ie=Be.uid;ce&&ce[ie]&&ce[ie].abort&&(ce[ie].abort.abort(),delete ce[ie])})}removeTile(Be){return l._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Be.uid]&&delete this.loaded[Be.uid]})}}class R{constructor(){this.loaded={}}loadTile(Be){return l._(this,void 0,void 0,function*(){const{uid:ce,encoding:ie,rawImageData:ue,redFactor:ge,greenFactor:xe,blueFactor:Ee,baseShift:we}=Be,Fe=ue.width+2,ze=ue.height+2,Ge=l.b(ue)?new l.R({width:Fe,height:ze},yield l.bt(ue,-1,-1,Fe,ze)):ue,st=new l.bu(ce,Ge,ie,ge,xe,Ee,we);return this.loaded=this.loaded||{},this.loaded[ce]=st,st})}removeTile(Be){const ce=this.loaded,ie=Be.uid;ce&&ce[ie]&&delete ce[ie]}}function U(Qe,Be){if(Qe.length!==0){J(Qe[0],Be);for(var ce=1;ce<Qe.length;ce++)J(Qe[ce],!Be)}}function J(Qe,Be){for(var ce=0,ie=0,ue=0,ge=Qe.length,xe=ge-1;ue<ge;xe=ue++){var Ee=(Qe[ue][0]-Qe[xe][0])*(Qe[xe][1]+Qe[ue][1]),we=ce+Ee;ie+=Math.abs(ce)>=Math.abs(Ee)?ce-we+Ee:Ee-we+ce,ce=we}ce+ie>=0!=!!Be&&Qe.reverse()}var te=l.bv(function Qe(Be,ce){var ie,ue=Be&&Be.type;if(ue==="FeatureCollection")for(ie=0;ie<Be.features.length;ie++)Qe(Be.features[ie],ce);else if(ue==="GeometryCollection")for(ie=0;ie<Be.geometries.length;ie++)Qe(Be.geometries[ie],ce);else if(ue==="Feature")Qe(Be.geometry,ce);else if(ue==="Polygon")U(Be.coordinates,ce);else if(ue==="MultiPolygon")for(ie=0;ie<Be.coordinates.length;ie++)U(Be.coordinates[ie],ce);return Be});const Ae=l.bq.VectorTileFeature.prototype.toGeoJSON;var he={exports:{}},pe=l.bw,be=l.bq.VectorTileFeature,Te=qe;function qe(Qe,Be){this.options=Be||{},this.features=Qe,this.length=Qe.length}function je(Qe,Be){this.id=typeof Qe.id=="number"?Qe.id:void 0,this.type=Qe.type,this.rawGeometry=Qe.type===1?[Qe.geometry]:Qe.geometry,this.properties=Qe.tags,this.extent=Be||4096}qe.prototype.feature=function(Qe){return new je(this.features[Qe],this.options.extent)},je.prototype.loadGeometry=function(){var Qe=this.rawGeometry;this.geometry=[];for(var Be=0;Be<Qe.length;Be++){for(var ce=Qe[Be],ie=[],ue=0;ue<ce.length;ue++)ie.push(new pe(ce[ue][0],ce[ue][1]));this.geometry.push(ie)}return this.geometry},je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Qe=this.geometry,Be=1/0,ce=-1/0,ie=1/0,ue=-1/0,ge=0;ge<Qe.length;ge++)for(var xe=Qe[ge],Ee=0;Ee<xe.length;Ee++){var we=xe[Ee];Be=Math.min(Be,we.x),ce=Math.max(ce,we.x),ie=Math.min(ie,we.y),ue=Math.max(ue,we.y)}return[Be,ie,ce,ue]},je.prototype.toGeoJSON=be.prototype.toGeoJSON;var We=l.bx,Ne=Te;function at(Qe){var Be=new We;return function(ce,ie){for(var ue in ce.layers)ie.writeMessage(3,nt,ce.layers[ue])}(Qe,Be),Be.finish()}function nt(Qe,Be){var ce;Be.writeVarintField(15,Qe.version||1),Be.writeStringField(1,Qe.name||""),Be.writeVarintField(5,Qe.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<Qe.length;ce++)ie.feature=Qe.feature(ce),Be.writeMessage(2,ke,ie);var ue=ie.keys;for(ce=0;ce<ue.length;ce++)Be.writeStringField(3,ue[ce]);var ge=ie.values;for(ce=0;ce<ge.length;ce++)Be.writeMessage(4,Et,ge[ce])}function ke(Qe,Be){var ce=Qe.feature;ce.id!==void 0&&Be.writeVarintField(1,ce.id),Be.writeMessage(2,De,Qe),Be.writeVarintField(3,ce.type),Be.writeMessage(4,Ct,ce)}function De(Qe,Be){var ce=Qe.feature,ie=Qe.keys,ue=Qe.values,ge=Qe.keycache,xe=Qe.valuecache;for(var Ee in ce.properties){var we=ce.properties[Ee],Fe=ge[Ee];if(we!==null){Fe===void 0&&(ie.push(Ee),ge[Ee]=Fe=ie.length-1),Be.writeVarint(Fe);var ze=typeof we;ze!=="string"&&ze!=="boolean"&&ze!=="number"&&(we=JSON.stringify(we));var Ge=ze+":"+we,st=xe[Ge];st===void 0&&(ue.push(we),xe[Ge]=st=ue.length-1),Be.writeVarint(st)}}}function Ye(Qe,Be){return(Be<<3)+(7&Qe)}function Ze(Qe){return Qe<<1^Qe>>31}function Ct(Qe,Be){for(var ce=Qe.loadGeometry(),ie=Qe.type,ue=0,ge=0,xe=ce.length,Ee=0;Ee<xe;Ee++){var we=ce[Ee],Fe=1;ie===1&&(Fe=we.length),Be.writeVarint(Ye(1,Fe));for(var ze=ie===3?we.length-1:we.length,Ge=0;Ge<ze;Ge++){Ge===1&&ie!==1&&Be.writeVarint(Ye(2,ze-1));var st=we[Ge].x-ue,vt=we[Ge].y-ge;Be.writeVarint(Ze(st)),Be.writeVarint(Ze(vt)),ue+=st,ge+=vt}ie===3&&Be.writeVarint(Ye(7,1))}}function Et(Qe,Be){var ce=typeof Qe;ce==="string"?Be.writeStringField(1,Qe):ce==="boolean"?Be.writeBooleanField(7,Qe):ce==="number"&&(Qe%1!=0?Be.writeDoubleField(3,Qe):Qe<0?Be.writeSVarintField(6,Qe):Be.writeVarintField(5,Qe))}he.exports=at,he.exports.fromVectorTileJs=at,he.exports.fromGeojsonVt=function(Qe,Be){Be=Be||{};var ce={};for(var ie in Qe)ce[ie]=new Ne(Qe[ie].features,Be),ce[ie].name=ie,ce[ie].version=Be.version,ce[ie].extent=Be.extent;return at({layers:ce})},he.exports.GeoJSONWrapper=Ne;var Pt=l.bv(he.exports);const bt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Qe=>Qe},Rt=Math.fround||(Ft=new Float32Array(1),Qe=>(Ft[0]=+Qe,Ft[0]));var Ft;const Xt=3,Le=5,Xe=6;class it{constructor(Be){this.options=Object.assign(Object.create(bt),Be),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Be){const{log:ce,minZoom:ie,maxZoom:ue}=this.options;ce&&console.time("total time");const ge=`prepare ${Be.length} points`;ce&&console.time(ge),this.points=Be;const xe=[];for(let we=0;we<Be.length;we++){const Fe=Be[we];if(!Fe.geometry)continue;const[ze,Ge]=Fe.geometry.coordinates,st=Rt(Bt(ze)),vt=Rt(Dt(Ge));xe.push(st,vt,1/0,we,-1,1),this.options.reduce&&xe.push(0)}let Ee=this.trees[ue+1]=this._createTree(xe);ce&&console.timeEnd(ge);for(let we=ue;we>=ie;we--){const Fe=+Date.now();Ee=this.trees[we]=this._createTree(this._cluster(Ee,we)),ce&&console.log("z%d: %d clusters in %dms",we,Ee.numItems,+Date.now()-Fe)}return ce&&console.timeEnd("total time"),this}getClusters(Be,ce){let ie=((Be[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,Be[1]));let ge=Be[2]===180?180:((Be[2]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,Be[3]));if(Be[2]-Be[0]>=360)ie=-180,ge=180;else if(ie>ge){const Ge=this.getClusters([ie,ue,180,xe],ce),st=this.getClusters([-180,ue,ge,xe],ce);return Ge.concat(st)}const Ee=this.trees[this._limitZoom(ce)],we=Ee.range(Bt(ie),Dt(xe),Bt(ge),Dt(ue)),Fe=Ee.data,ze=[];for(const Ge of we){const st=this.stride*Ge;ze.push(Fe[st+Le]>1?pt(Fe,st,this.clusterProps):this.points[Fe[st+Xt]])}return ze}getChildren(Be){const ce=this._getOriginId(Be),ie=this._getOriginZoom(Be),ue="No cluster with the specified id.",ge=this.trees[ie];if(!ge)throw new Error(ue);const xe=ge.data;if(ce*this.stride>=xe.length)throw new Error(ue);const Ee=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),we=ge.within(xe[ce*this.stride],xe[ce*this.stride+1],Ee),Fe=[];for(const ze of we){const Ge=ze*this.stride;xe[Ge+4]===Be&&Fe.push(xe[Ge+Le]>1?pt(xe,Ge,this.clusterProps):this.points[xe[Ge+Xt]])}if(Fe.length===0)throw new Error(ue);return Fe}getLeaves(Be,ce,ie){const ue=[];return this._appendLeaves(ue,Be,ce=ce||10,ie=ie||0,0),ue}getTile(Be,ce,ie){const ue=this.trees[this._limitZoom(Be)],ge=Math.pow(2,Be),{extent:xe,radius:Ee}=this.options,we=Ee/xe,Fe=(ie-we)/ge,ze=(ie+1+we)/ge,Ge={features:[]};return this._addTileFeatures(ue.range((ce-we)/ge,Fe,(ce+1+we)/ge,ze),ue.data,ce,ie,ge,Ge),ce===0&&this._addTileFeatures(ue.range(1-we/ge,Fe,1,ze),ue.data,ge,ie,ge,Ge),ce===ge-1&&this._addTileFeatures(ue.range(0,Fe,we/ge,ze),ue.data,-1,ie,ge,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(Be){let ce=this._getOriginZoom(Be)-1;for(;ce<=this.options.maxZoom;){const ie=this.getChildren(Be);if(ce++,ie.length!==1)break;Be=ie[0].properties.cluster_id}return ce}_appendLeaves(Be,ce,ie,ue,ge){const xe=this.getChildren(ce);for(const Ee of xe){const we=Ee.properties;if(we&&we.cluster?ge+we.point_count<=ue?ge+=we.point_count:ge=this._appendLeaves(Be,we.cluster_id,ie,ue,ge):ge<ue?ge++:Be.push(Ee),Be.length===ie)break}return ge}_createTree(Be){const ce=new l.au(Be.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<Be.length;ie+=this.stride)ce.add(Be[ie],Be[ie+1]);return ce.finish(),ce.data=Be,ce}_addTileFeatures(Be,ce,ie,ue,ge,xe){for(const Ee of Be){const we=Ee*this.stride,Fe=ce[we+Le]>1;let ze,Ge,st;if(Fe)ze=mt(ce,we,this.clusterProps),Ge=ce[we],st=ce[we+1];else{const Kt=this.points[ce[we+Xt]];ze=Kt.properties;const[ii,Gt]=Kt.geometry.coordinates;Ge=Bt(ii),st=Dt(Gt)}const vt={type:1,geometry:[[Math.round(this.options.extent*(Ge*ge-ie)),Math.round(this.options.extent*(st*ge-ue))]],tags:ze};let Tt;Tt=Fe||this.options.generateId?ce[we+Xt]:this.points[ce[we+Xt]].id,Tt!==void 0&&(vt.id=Tt),xe.features.push(vt)}}_limitZoom(Be){return Math.max(this.options.minZoom,Math.min(Math.floor(+Be),this.options.maxZoom+1))}_cluster(Be,ce){const{radius:ie,extent:ue,reduce:ge,minPoints:xe}=this.options,Ee=ie/(ue*Math.pow(2,ce)),we=Be.data,Fe=[],ze=this.stride;for(let Ge=0;Ge<we.length;Ge+=ze){if(we[Ge+2]<=ce)continue;we[Ge+2]=ce;const st=we[Ge],vt=we[Ge+1],Tt=Be.within(we[Ge],we[Ge+1],Ee),Kt=we[Ge+Le];let ii=Kt;for(const Gt of Tt){const Ai=Gt*ze;we[Ai+2]>ce&&(ii+=we[Ai+Le])}if(ii>Kt&&ii>=xe){let Gt,Ai=st*Kt,Bi=vt*Kt,Hi=-1;const Ci=((Ge/ze|0)<<5)+(ce+1)+this.points.length;for(const Ni of Tt){const ot=Ni*ze;if(we[ot+2]<=ce)continue;we[ot+2]=ce;const ri=we[ot+Le];Ai+=we[ot]*ri,Bi+=we[ot+1]*ri,we[ot+4]=Ci,ge&&(Gt||(Gt=this._map(we,Ge,!0),Hi=this.clusterProps.length,this.clusterProps.push(Gt)),ge(Gt,this._map(we,ot)))}we[Ge+4]=Ci,Fe.push(Ai/ii,Bi/ii,1/0,Ci,-1,ii),ge&&Fe.push(Hi)}else{for(let Gt=0;Gt<ze;Gt++)Fe.push(we[Ge+Gt]);if(ii>1)for(const Gt of Tt){const Ai=Gt*ze;if(!(we[Ai+2]<=ce)){we[Ai+2]=ce;for(let Bi=0;Bi<ze;Bi++)Fe.push(we[Ai+Bi])}}}}return Fe}_getOriginId(Be){return Be-this.points.length>>5}_getOriginZoom(Be){return(Be-this.points.length)%32}_map(Be,ce,ie){if(Be[ce+Le]>1){const xe=this.clusterProps[Be[ce+Xe]];return ie?Object.assign({},xe):xe}const ue=this.points[Be[ce+Xt]].properties,ge=this.options.map(ue);return ie&&ge===ue?Object.assign({},ge):ge}}function pt(Qe,Be,ce){return{type:"Feature",id:Qe[Be+Xt],properties:mt(Qe,Be,ce),geometry:{type:"Point",coordinates:[(ie=Qe[Be],360*(ie-.5)),Mt(Qe[Be+1])]}};var ie}function mt(Qe,Be,ce){const ie=Qe[Be+Le],ue=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,ge=Qe[Be+Xe],xe=ge===-1?{}:Object.assign({},ce[ge]);return Object.assign(xe,{cluster:!0,cluster_id:Qe[Be+Xt],point_count:ie,point_count_abbreviated:ue})}function Bt(Qe){return Qe/360+.5}function Dt(Qe){const Be=Math.sin(Qe*Math.PI/180),ce=.5-.25*Math.log((1+Be)/(1-Be))/Math.PI;return ce<0?0:ce>1?1:ce}function Mt(Qe){const Be=(180-360*Qe)*Math.PI/180;return 360*Math.atan(Math.exp(Be))/Math.PI-90}function qt(Qe,Be,ce,ie){for(var ue,ge=ie,xe=ce-Be>>1,Ee=ce-Be,we=Qe[Be],Fe=Qe[Be+1],ze=Qe[ce],Ge=Qe[ce+1],st=Be+3;st<ce;st+=3){var vt=ni(Qe[st],Qe[st+1],we,Fe,ze,Ge);if(vt>ge)ue=st,ge=vt;else if(vt===ge){var Tt=Math.abs(st-xe);Tt<Ee&&(ue=st,Ee=Tt)}}ge>ie&&(ue-Be>3&&qt(Qe,Be,ue,ie),Qe[ue+2]=ge,ce-ue>3&&qt(Qe,ue,ce,ie))}function ni(Qe,Be,ce,ie,ue,ge){var xe=ue-ce,Ee=ge-ie;if(xe!==0||Ee!==0){var we=((Qe-ce)*xe+(Be-ie)*Ee)/(xe*xe+Ee*Ee);we>1?(ce=ue,ie=ge):we>0&&(ce+=xe*we,ie+=Ee*we)}return(xe=Qe-ce)*xe+(Ee=Be-ie)*Ee}function _i(Qe,Be,ce,ie){var ue={id:Qe===void 0?null:Qe,type:Be,geometry:ce,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var xe=ge.geometry,Ee=ge.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")vi(ge,xe);else if(Ee==="Polygon"||Ee==="MultiLineString")for(var we=0;we<xe.length;we++)vi(ge,xe[we]);else if(Ee==="MultiPolygon")for(we=0;we<xe.length;we++)for(var Fe=0;Fe<xe[we].length;Fe++)vi(ge,xe[we][Fe])}(ue),ue}function vi(Qe,Be){for(var ce=0;ce<Be.length;ce+=3)Qe.minX=Math.min(Qe.minX,Be[ce]),Qe.minY=Math.min(Qe.minY,Be[ce+1]),Qe.maxX=Math.max(Qe.maxX,Be[ce]),Qe.maxY=Math.max(Qe.maxY,Be[ce+1])}function Pi(Qe,Be,ce,ie){if(Be.geometry){var ue=Be.geometry.coordinates,ge=Be.geometry.type,xe=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),Ee=[],we=Be.id;if(ce.promoteId?we=Be.properties[ce.promoteId]:ce.generateId&&(we=ie||0),ge==="Point")kt(ue,Ee);else if(ge==="MultiPoint")for(var Fe=0;Fe<ue.length;Fe++)kt(ue[Fe],Ee);else if(ge==="LineString")lt(ue,Ee,xe,!1);else if(ge==="MultiLineString"){if(ce.lineMetrics){for(Fe=0;Fe<ue.length;Fe++)lt(ue[Fe],Ee=[],xe,!1),Qe.push(_i(we,"LineString",Ee,Be.properties));return}wt(ue,Ee,xe,!1)}else if(ge==="Polygon")wt(ue,Ee,xe,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(Fe=0;Fe<Be.geometry.geometries.length;Fe++)Pi(Qe,{id:we,geometry:Be.geometry.geometries[Fe],properties:Be.properties},ce,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Fe=0;Fe<ue.length;Fe++){var ze=[];wt(ue[Fe],ze,xe,!0),Ee.push(ze)}}Qe.push(_i(we,ge,Ee,Be.properties))}}function kt(Qe,Be){Be.push(Oi(Qe[0])),Be.push(ti(Qe[1])),Be.push(0)}function lt(Qe,Be,ce,ie){for(var ue,ge,xe=0,Ee=0;Ee<Qe.length;Ee++){var we=Oi(Qe[Ee][0]),Fe=ti(Qe[Ee][1]);Be.push(we),Be.push(Fe),Be.push(0),Ee>0&&(xe+=ie?(ue*Fe-we*ge)/2:Math.sqrt(Math.pow(we-ue,2)+Math.pow(Fe-ge,2))),ue=we,ge=Fe}var ze=Be.length-3;Be[2]=1,qt(Be,0,ze,ce),Be[ze+2]=1,Be.size=Math.abs(xe),Be.start=0,Be.end=Be.size}function wt(Qe,Be,ce,ie){for(var ue=0;ue<Qe.length;ue++){var ge=[];lt(Qe[ue],ge,ce,ie),Be.push(ge)}}function Oi(Qe){return Qe/360+.5}function ti(Qe){var Be=Math.sin(Qe*Math.PI/180),ce=.5-.25*Math.log((1+Be)/(1-Be))/Math.PI;return ce<0?0:ce>1?1:ce}function ht(Qe,Be,ce,ie,ue,ge,xe,Ee){if(ie/=Be,ge>=(ce/=Be)&&xe<ie)return Qe;if(xe<ce||ge>=ie)return null;for(var we=[],Fe=0;Fe<Qe.length;Fe++){var ze=Qe[Fe],Ge=ze.geometry,st=ze.type,vt=ue===0?ze.minX:ze.minY,Tt=ue===0?ze.maxX:ze.maxY;if(vt>=ce&&Tt<ie)we.push(ze);else if(!(Tt<ce||vt>=ie)){var Kt=[];if(st==="Point"||st==="MultiPoint")$t(Ge,Kt,ce,ie,ue);else if(st==="LineString")oi(Ge,Kt,ce,ie,ue,!1,Ee.lineMetrics);else if(st==="MultiLineString")ci(Ge,Kt,ce,ie,ue,!1);else if(st==="Polygon")ci(Ge,Kt,ce,ie,ue,!0);else if(st==="MultiPolygon")for(var ii=0;ii<Ge.length;ii++){var Gt=[];ci(Ge[ii],Gt,ce,ie,ue,!0),Gt.length&&Kt.push(Gt)}if(Kt.length){if(Ee.lineMetrics&&st==="LineString"){for(ii=0;ii<Kt.length;ii++)we.push(_i(ze.id,st,Kt[ii],ze.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(Kt.length===1?(st="LineString",Kt=Kt[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=Kt.length===3?"Point":"MultiPoint"),we.push(_i(ze.id,st,Kt,ze.tags))}}}return we.length?we:null}function $t(Qe,Be,ce,ie,ue){for(var ge=0;ge<Qe.length;ge+=3){var xe=Qe[ge+ue];xe>=ce&&xe<=ie&&(Be.push(Qe[ge]),Be.push(Qe[ge+1]),Be.push(Qe[ge+2]))}}function oi(Qe,Be,ce,ie,ue,ge,xe){for(var Ee,we,Fe=gi(Qe),ze=ue===0?tr:pr,Ge=Qe.start,st=0;st<Qe.length-3;st+=3){var vt=Qe[st],Tt=Qe[st+1],Kt=Qe[st+2],ii=Qe[st+3],Gt=Qe[st+4],Ai=ue===0?vt:Tt,Bi=ue===0?ii:Gt,Hi=!1;xe&&(Ee=Math.sqrt(Math.pow(vt-ii,2)+Math.pow(Tt-Gt,2))),Ai<ce?Bi>ce&&(we=ze(Fe,vt,Tt,ii,Gt,ce),xe&&(Fe.start=Ge+Ee*we)):Ai>ie?Bi<ie&&(we=ze(Fe,vt,Tt,ii,Gt,ie),xe&&(Fe.start=Ge+Ee*we)):Ki(Fe,vt,Tt,Kt),Bi<ce&&Ai>=ce&&(we=ze(Fe,vt,Tt,ii,Gt,ce),Hi=!0),Bi>ie&&Ai<=ie&&(we=ze(Fe,vt,Tt,ii,Gt,ie),Hi=!0),!ge&&Hi&&(xe&&(Fe.end=Ge+Ee*we),Be.push(Fe),Fe=gi(Qe)),xe&&(Ge+=Ee)}var Ci=Qe.length-3;vt=Qe[Ci],Tt=Qe[Ci+1],Kt=Qe[Ci+2],(Ai=ue===0?vt:Tt)>=ce&&Ai<=ie&&Ki(Fe,vt,Tt,Kt),Ci=Fe.length-3,ge&&Ci>=3&&(Fe[Ci]!==Fe[0]||Fe[Ci+1]!==Fe[1])&&Ki(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&Be.push(Fe)}function gi(Qe){var Be=[];return Be.size=Qe.size,Be.start=Qe.start,Be.end=Qe.end,Be}function ci(Qe,Be,ce,ie,ue,ge){for(var xe=0;xe<Qe.length;xe++)oi(Qe[xe],Be,ce,ie,ue,ge,!1)}function Ki(Qe,Be,ce,ie){Qe.push(Be),Qe.push(ce),Qe.push(ie)}function tr(Qe,Be,ce,ie,ue,ge){var xe=(ge-Be)/(ie-Be);return Qe.push(ge),Qe.push(ce+(ue-ce)*xe),Qe.push(1),xe}function pr(Qe,Be,ce,ie,ue,ge){var xe=(ge-ce)/(ue-ce);return Qe.push(Be+(ie-Be)*xe),Qe.push(ge),Qe.push(1),xe}function Mr(Qe,Be){for(var ce=[],ie=0;ie<Qe.length;ie++){var ue,ge=Qe[ie],xe=ge.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")ue=zt(ge.geometry,Be);else if(xe==="MultiLineString"||xe==="Polygon"){ue=[];for(var Ee=0;Ee<ge.geometry.length;Ee++)ue.push(zt(ge.geometry[Ee],Be))}else if(xe==="MultiPolygon")for(ue=[],Ee=0;Ee<ge.geometry.length;Ee++){for(var we=[],Fe=0;Fe<ge.geometry[Ee].length;Fe++)we.push(zt(ge.geometry[Ee][Fe],Be));ue.push(we)}ce.push(_i(ge.id,xe,ue,ge.tags))}return ce}function zt(Qe,Be){var ce=[];ce.size=Qe.size,Qe.start!==void 0&&(ce.start=Qe.start,ce.end=Qe.end);for(var ie=0;ie<Qe.length;ie+=3)ce.push(Qe[ie]+Be,Qe[ie+1],Qe[ie+2]);return ce}function Wi(Qe,Be){if(Qe.transformed)return Qe;var ce,ie,ue,ge=1<<Qe.z,xe=Qe.x,Ee=Qe.y;for(ce=0;ce<Qe.features.length;ce++){var we=Qe.features[ce],Fe=we.geometry,ze=we.type;if(we.geometry=[],ze===1)for(ie=0;ie<Fe.length;ie+=2)we.geometry.push(hi(Fe[ie],Fe[ie+1],Be,ge,xe,Ee));else for(ie=0;ie<Fe.length;ie++){var Ge=[];for(ue=0;ue<Fe[ie].length;ue+=2)Ge.push(hi(Fe[ie][ue],Fe[ie][ue+1],Be,ge,xe,Ee));we.geometry.push(Ge)}}return Qe.transformed=!0,Qe}function hi(Qe,Be,ce,ie,ue,ge){return[Math.round(ce*(Qe*ie-ue)),Math.round(ce*(Be*ie-ge))]}function Wt(Qe,Be,ce,ie,ue){for(var ge=Be===ue.maxZoom?0:ue.tolerance/((1<<Be)*ue.extent),xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:ie,z:Be,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ee=0;Ee<Qe.length;Ee++){xe.numFeatures++,Ar(xe,Qe[Ee],ge,ue);var we=Qe[Ee].minX,Fe=Qe[Ee].minY,ze=Qe[Ee].maxX,Ge=Qe[Ee].maxY;we<xe.minX&&(xe.minX=we),Fe<xe.minY&&(xe.minY=Fe),ze>xe.maxX&&(xe.maxX=ze),Ge>xe.maxY&&(xe.maxY=Ge)}return xe}function Ar(Qe,Be,ce,ie){var ue=Be.geometry,ge=Be.type,xe=[];if(ge==="Point"||ge==="MultiPoint")for(var Ee=0;Ee<ue.length;Ee+=3)xe.push(ue[Ee]),xe.push(ue[Ee+1]),Qe.numPoints++,Qe.numSimplified++;else if(ge==="LineString")Qt(xe,ue,Qe,ce,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(Ee=0;Ee<ue.length;Ee++)Qt(xe,ue[Ee],Qe,ce,ge==="Polygon",Ee===0);else if(ge==="MultiPolygon")for(var we=0;we<ue.length;we++){var Fe=ue[we];for(Ee=0;Ee<Fe.length;Ee++)Qt(xe,Fe[Ee],Qe,ce,!0,Ee===0)}if(xe.length){var ze=Be.tags||null;if(ge==="LineString"&&ie.lineMetrics){for(var Ge in ze={},Be.tags)ze[Ge]=Be.tags[Ge];ze.mapbox_clip_start=ue.start/ue.size,ze.mapbox_clip_end=ue.end/ue.size}var st={geometry:xe,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:ze};Be.id!==null&&(st.id=Be.id),Qe.features.push(st)}}function Qt(Qe,Be,ce,ie,ue,ge){var xe=ie*ie;if(ie>0&&Be.size<(ue?xe:ie))ce.numPoints+=Be.length/3;else{for(var Ee=[],we=0;we<Be.length;we+=3)(ie===0||Be[we+2]>xe)&&(ce.numSimplified++,Ee.push(Be[we]),Ee.push(Be[we+1])),ce.numPoints++;ue&&function(Fe,ze){for(var Ge=0,st=0,vt=Fe.length,Tt=vt-2;st<vt;Tt=st,st+=2)Ge+=(Fe[st]-Fe[Tt])*(Fe[st+1]+Fe[Tt+1]);if(Ge>0===ze)for(st=0,vt=Fe.length;st<vt/2;st+=2){var Kt=Fe[st],ii=Fe[st+1];Fe[st]=Fe[vt-2-st],Fe[st+1]=Fe[vt-1-st],Fe[vt-2-st]=Kt,Fe[vt-1-st]=ii}}(Ee,ge),Qe.push(Ee)}}function Si(Qe,Be){var ce=(Be=this.options=function(ue,ge){for(var xe in ge)ue[xe]=ge[xe];return ue}(Object.create(this.options),Be)).debug;if(ce&&console.time("preprocess data"),Be.maxZoom<0||Be.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Be.promoteId&&Be.generateId)throw new Error("promoteId and generateId cannot be used together.");var ie=function(ue,ge){var xe=[];if(ue.type==="FeatureCollection")for(var Ee=0;Ee<ue.features.length;Ee++)Pi(xe,ue.features[Ee],ge,Ee);else Pi(xe,ue.type==="Feature"?ue:{geometry:ue},ge);return xe}(Qe,Be);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Be.indexMaxZoom,Be.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=function(ue,ge){var xe=ge.buffer/ge.extent,Ee=ue,we=ht(ue,1,-1-xe,xe,0,-1,2,ge),Fe=ht(ue,1,1-xe,2+xe,0,-1,2,ge);return(we||Fe)&&(Ee=ht(ue,1,-xe,1+xe,0,-1,2,ge)||[],we&&(Ee=Mr(we,1).concat(Ee)),Fe&&(Ee=Ee.concat(Mr(Fe,-1)))),Ee}(ie,Be),ie.length&&this.splitTile(ie,0,0,0),ce&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ii(Qe,Be,ce){return 32*((1<<Qe)*ce+Be)+Qe}function Zt(Qe,Be){return Be?Qe.properties[Be]:Qe.id}function bi(Qe,Be){if(Qe==null)return!0;if(Qe.type==="Feature")return Zt(Qe,Be)!=null;if(Qe.type==="FeatureCollection"){const ce=new Set;for(const ie of Qe.features){const ue=Zt(ie,Be);if(ue==null||ce.has(ue))return!1;ce.add(ue)}return!0}return!1}function ei(Qe,Be){const ce=new Map;if(Qe!=null)if(Qe.type==="Feature")ce.set(Zt(Qe,Be),Qe);else for(const ie of Qe.features)ce.set(Zt(ie,Be),ie);return ce}Si.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Si.prototype.splitTile=function(Qe,Be,ce,ie,ue,ge,xe){for(var Ee=[Qe,Be,ce,ie],we=this.options,Fe=we.debug;Ee.length;){ie=Ee.pop(),ce=Ee.pop(),Be=Ee.pop(),Qe=Ee.pop();var ze=1<<Be,Ge=Ii(Be,ce,ie),st=this.tiles[Ge];if(!st&&(Fe>1&&console.time("creation"),st=this.tiles[Ge]=Wt(Qe,Be,ce,ie,we),this.tileCoords.push({z:Be,x:ce,y:ie}),Fe)){Fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Be,ce,ie,st.numFeatures,st.numPoints,st.numSimplified),console.timeEnd("creation"));var vt="z"+Be;this.stats[vt]=(this.stats[vt]||0)+1,this.total++}if(st.source=Qe,ue){if(Be===we.maxZoom||Be===ue)continue;var Tt=1<<ue-Be;if(ce!==Math.floor(ge/Tt)||ie!==Math.floor(xe/Tt))continue}else if(Be===we.indexMaxZoom||st.numPoints<=we.indexMaxPoints)continue;if(st.source=null,Qe.length!==0){Fe>1&&console.time("clipping");var Kt,ii,Gt,Ai,Bi,Hi,Ci=.5*we.buffer/we.extent,Ni=.5-Ci,ot=.5+Ci,ri=1+Ci;Kt=ii=Gt=Ai=null,Bi=ht(Qe,ze,ce-Ci,ce+ot,0,st.minX,st.maxX,we),Hi=ht(Qe,ze,ce+Ni,ce+ri,0,st.minX,st.maxX,we),Qe=null,Bi&&(Kt=ht(Bi,ze,ie-Ci,ie+ot,1,st.minY,st.maxY,we),ii=ht(Bi,ze,ie+Ni,ie+ri,1,st.minY,st.maxY,we),Bi=null),Hi&&(Gt=ht(Hi,ze,ie-Ci,ie+ot,1,st.minY,st.maxY,we),Ai=ht(Hi,ze,ie+Ni,ie+ri,1,st.minY,st.maxY,we),Hi=null),Fe>1&&console.timeEnd("clipping"),Ee.push(Kt||[],Be+1,2*ce,2*ie),Ee.push(ii||[],Be+1,2*ce,2*ie+1),Ee.push(Gt||[],Be+1,2*ce+1,2*ie),Ee.push(Ai||[],Be+1,2*ce+1,2*ie+1)}}},Si.prototype.getTile=function(Qe,Be,ce){var ie=this.options,ue=ie.extent,ge=ie.debug;if(Qe<0||Qe>24)return null;var xe=1<<Qe,Ee=Ii(Qe,Be=(Be%xe+xe)%xe,ce);if(this.tiles[Ee])return Wi(this.tiles[Ee],ue);ge>1&&console.log("drilling down to z%d-%d-%d",Qe,Be,ce);for(var we,Fe=Qe,ze=Be,Ge=ce;!we&&Fe>0;)Fe--,ze=Math.floor(ze/2),Ge=Math.floor(Ge/2),we=this.tiles[Ii(Fe,ze,Ge)];return we&&we.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Fe,ze,Ge),ge>1&&console.time("drilling down"),this.splitTile(we.source,Fe,ze,Ge,Qe,Be,ce),ge>1&&console.timeEnd("drilling down"),this.tiles[Ee]?Wi(this.tiles[Ee],ue):null):null};class _r extends F{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Be,ce){return l._(this,void 0,void 0,function*(){const ie=Be.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ue=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!ue)return null;const ge=new class{constructor(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.W,this.length=Ee.length,this._features=Ee}feature(Ee){return new class{constructor(we){this._feature=we,this.extent=l.W,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const Fe of this._feature.geometry)we.push([new l.P(Fe[0],Fe[1])]);return we}{const we=[];for(const Fe of this._feature.geometry){const ze=[];for(const Ge of Fe)ze.push(new l.P(Ge[0],Ge[1]));we.push(ze)}return we}}toGeoJSON(we,Fe,ze){return Ae.call(this,we,Fe,ze)}}(this._features[Ee])}}(ue.features);let xe=Pt(ge);return xe.byteOffset===0&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),{vectorTile:ge,rawData:xe.buffer}})}loadData(Be){return l._(this,void 0,void 0,function*(){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.abort();const ie=!!(Be&&Be.request&&Be.request.collectResourceTiming)&&new l.bs(Be.request);this._pendingRequest=new AbortController;try{let ue=yield this.loadGeoJSON(Be,this._pendingRequest);if(delete this._pendingRequest,typeof ue!="object")throw new Error(`Input data given to '${Be.source}' is not a valid GeoJSON object.`);if(te(ue,!0),Be.filter){const xe=l.by(Be.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map(we=>`${we.key}: ${we.message}`).join(", "));ue={type:"FeatureCollection",features:ue.features.filter(we=>xe.value.evaluate({zoom:0},we))}}this._geoJSONIndex=Be.cluster?new it(function(xe){let{superclusterOptions:Ee,clusterProperties:we}=xe;if(!we||!Ee)return Ee;const Fe={},ze={},Ge={accumulated:null,zoom:0},st={properties:null},vt=Object.keys(we);for(const Tt of vt){const[Kt,ii]=we[Tt],Gt=l.by(ii),Ai=l.by(typeof Kt=="string"?[Kt,["accumulated"],["get",Tt]]:Kt);Fe[Tt]=Gt.value,ze[Tt]=Ai.value}return Ee.map=Tt=>{st.properties=Tt;const Kt={};for(const ii of vt)Kt[ii]=Fe[ii].evaluate(Ge,st);return Kt},Ee.reduce=(Tt,Kt)=>{st.properties=Kt;for(const ii of vt)Ge.accumulated=Tt[ii],Tt[ii]=ze[ii].evaluate(Ge,st)},Ee}(Be)).load(ue.features):function(xe,Ee){return new Si(xe,Ee)}(ue,Be.geojsonVtOptions),this.loaded={};const ge={};if(ie){const xe=ie.finish();xe&&(ge.resourceTiming={},ge.resourceTiming[Be.source]=JSON.parse(JSON.stringify(xe)))}return ge}catch(ue){if(delete this._pendingRequest,l.bz(ue))return{abandoned:!0};throw ue}})}reloadTile(Be){const ce=this.loaded;return ce&&ce[Be.uid]?super.reloadTile(Be):this.loadTile(Be)}loadGeoJSON(Be,ce){return l._(this,void 0,void 0,function*(){const{promoteId:ie}=Be;if(Be.request){const ue=yield l.h(Be.request,ce);return this._dataUpdateable=bi(ue.data,ie)?ei(ue.data,ie):void 0,ue.data}if(typeof Be.data=="string")try{const ue=JSON.parse(Be.data);return this._dataUpdateable=bi(ue,ie)?ei(ue,ie):void 0,ue}catch{throw new Error(`Input data given to '${Be.source}' is not a valid GeoJSON object.`)}if(!Be.dataDiff)throw new Error(`Input data given to '${Be.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Be.source}`);return function(ue,ge,xe){var Ee,we,Fe,ze;if(ge.removeAll&&ue.clear(),ge.remove)for(const Ge of ge.remove)ue.delete(Ge);if(ge.add)for(const Ge of ge.add){const st=Zt(Ge,xe);st!=null&&ue.set(st,Ge)}if(ge.update)for(const Ge of ge.update){let st=ue.get(Ge.id);if(st==null)continue;const vt=!Ge.removeAllProperties&&(((Ee=Ge.removeProperties)===null||Ee===void 0?void 0:Ee.length)>0||((we=Ge.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0);if((Ge.newGeometry||Ge.removeAllProperties||vt)&&(st=Object.assign({},st),ue.set(Ge.id,st),vt&&(st.properties=Object.assign({},st.properties))),Ge.newGeometry&&(st.geometry=Ge.newGeometry),Ge.removeAllProperties)st.properties={};else if(((Fe=Ge.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0)for(const Tt of Ge.removeProperties)Object.prototype.hasOwnProperty.call(st.properties,Tt)&&delete st.properties[Tt];if(((ze=Ge.addOrUpdateProperties)===null||ze===void 0?void 0:ze.length)>0)for(const{key:Tt,value:Kt}of Ge.addOrUpdateProperties)st.properties[Tt]=Kt}}(this._dataUpdateable,Be.dataDiff,ie),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Be){return l._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Be){return this._geoJSONIndex.getClusterExpansionZoom(Be.clusterId)}getClusterChildren(Be){return this._geoJSONIndex.getChildren(Be.clusterId)}getClusterLeaves(Be){return this._geoJSONIndex.getLeaves(Be.clusterId,Be.limit,Be.offset)}}class Zr{constructor(Be){this.self=Be,this.actor=new l.C(Be),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ce,ie)=>{if(this.externalWorkerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.externalWorkerSourceTypes[ce]=ie},this.self.addProtocol=l.bf,this.self.removeProtocol=l.bg,this.self.registerRTLTextPlugin=ce=>{if(l.bA.isParsed())throw new Error("RTL text plugin already registered.");l.bA.setMethods(ce)},this.actor.registerMessageHandler("loadDEMTile",(ce,ie)=>this._getDEMWorkerSource(ce,ie.source).loadTile(ie)),this.actor.registerMessageHandler("removeDEMTile",(ce,ie)=>l._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ce,ie.source).removeTile(ie)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(ce,ie)=>l._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ie.type,ie.source).getClusterExpansionZoom(ie)})),this.actor.registerMessageHandler("getClusterChildren",(ce,ie)=>l._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ie.type,ie.source).getClusterChildren(ie)})),this.actor.registerMessageHandler("getClusterLeaves",(ce,ie)=>l._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ie.type,ie.source).getClusterLeaves(ie)})),this.actor.registerMessageHandler("loadData",(ce,ie)=>this._getWorkerSource(ce,ie.type,ie.source).loadData(ie)),this.actor.registerMessageHandler("loadTile",(ce,ie)=>this._getWorkerSource(ce,ie.type,ie.source).loadTile(ie)),this.actor.registerMessageHandler("reloadTile",(ce,ie)=>this._getWorkerSource(ce,ie.type,ie.source).reloadTile(ie)),this.actor.registerMessageHandler("abortTile",(ce,ie)=>this._getWorkerSource(ce,ie.type,ie.source).abortTile(ie)),this.actor.registerMessageHandler("removeTile",(ce,ie)=>this._getWorkerSource(ce,ie.type,ie.source).removeTile(ie)),this.actor.registerMessageHandler("removeSource",(ce,ie)=>l._(this,void 0,void 0,function*(){if(!this.workerSources[ce]||!this.workerSources[ce][ie.type]||!this.workerSources[ce][ie.type][ie.source])return;const ue=this.workerSources[ce][ie.type][ie.source];delete this.workerSources[ce][ie.type][ie.source],ue.removeSource!==void 0&&ue.removeSource(ie)})),this.actor.registerMessageHandler("removeMap",ce=>l._(this,void 0,void 0,function*(){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce]})),this.actor.registerMessageHandler("setReferrer",(ce,ie)=>l._(this,void 0,void 0,function*(){this.referrer=ie})),this.actor.registerMessageHandler("syncRTLPluginState",(ce,ie)=>this._syncRTLPluginState(ce,ie)),this.actor.registerMessageHandler("importScript",(ce,ie)=>l._(this,void 0,void 0,function*(){this.self.importScripts(ie)})),this.actor.registerMessageHandler("setImages",(ce,ie)=>this._setImages(ce,ie)),this.actor.registerMessageHandler("updateLayers",(ce,ie)=>l._(this,void 0,void 0,function*(){this._getLayerIndex(ce).update(ie.layers,ie.removedIds)})),this.actor.registerMessageHandler("setLayers",(ce,ie)=>l._(this,void 0,void 0,function*(){this._getLayerIndex(ce).replace(ie)}))}_setImages(Be,ce){return l._(this,void 0,void 0,function*(){this.availableImages[Be]=ce;for(const ie in this.workerSources[Be]){const ue=this.workerSources[Be][ie];for(const ge in ue)ue[ge].availableImages=ce}})}_syncRTLPluginState(Be,ce){return l._(this,void 0,void 0,function*(){if(l.bA.isParsed())return l.bA.getState();if(ce.pluginStatus!=="loading")return l.bA.setState(ce),ce;const ie=ce.pluginURL;if(this.self.importScripts(ie),l.bA.isParsed()){const ue={pluginStatus:"loaded",pluginURL:ie};return l.bA.setState(ue),ue}throw l.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ie}`)})}_getAvailableImages(Be){let ce=this.availableImages[Be];return ce||(ce=[]),ce}_getLayerIndex(Be){let ce=this.layerIndexes[Be];return ce||(ce=this.layerIndexes[Be]=new s),ce}_getWorkerSource(Be,ce,ie){if(this.workerSources[Be]||(this.workerSources[Be]={}),this.workerSources[Be][ce]||(this.workerSources[Be][ce]={}),!this.workerSources[Be][ce][ie]){const ue={sendAsync:(ge,xe)=>(ge.targetMapId=Be,this.actor.sendAsync(ge,xe))};switch(ce){case"vector":this.workerSources[Be][ce][ie]=new F(ue,this._getLayerIndex(Be),this._getAvailableImages(Be));break;case"geojson":this.workerSources[Be][ce][ie]=new _r(ue,this._getLayerIndex(Be),this._getAvailableImages(Be));break;default:this.workerSources[Be][ce][ie]=new this.externalWorkerSourceTypes[ce](ue,this._getLayerIndex(Be),this._getAvailableImages(Be))}}return this.workerSources[Be][ce][ie]}_getDEMWorkerSource(Be,ce){return this.demWorkerSources[Be]||(this.demWorkerSources[Be]={}),this.demWorkerSources[Be][ce]||(this.demWorkerSources[Be][ce]=new R),this.demWorkerSources[Be][ce]}}return l.i(self)&&(self.worker=new Zr(self)),Zr}),n("index",["exports","./shared"],function(l,s){var g="4.1.2";let v,T;const F={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((a,p)=>{const x=requestAnimationFrame(a);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(x),p(s.c())})}),getImageData(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(w).getImageData(-a,-a,w.width+2*a,w.height+2*a)},getImageCanvasContext(w){const a=window.document.createElement("canvas"),p=a.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return a.width=w.width,a.height=w.height,p.drawImage(w,0,0,w.width,w.height),p},resolveURL:w=>(v||(v=document.createElement("a")),v.href=w,v.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(T==null&&(T=matchMedia("(prefers-reduced-motion: reduce)")),T.matches)}};class R{static testProp(a){if(!R.docStyle)return a[0];for(let p=0;p<a.length;p++)if(a[p]in R.docStyle)return a[p];return a[0]}static create(a,p,x){const B=window.document.createElement(a);return p!==void 0&&(B.className=p),x&&x.appendChild(B),B}static createNS(a,p){return window.document.createElementNS(a,p)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(a,p){a.style[R.transformProp]=p}static addEventListener(a,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.addEventListener(p,x,"passive"in B?B:B.capture)}static removeEventListener(a,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.removeEventListener(p,x,"passive"in B?B:B.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static getScale(a){const p=a.getBoundingClientRect();return{x:p.width/a.offsetWidth||1,y:p.height/a.offsetHeight||1,boundingClientRect:p}}static getPoint(a,p,x){const B=p.boundingClientRect;return new s.P((x.clientX-B.left)/p.x-a.clientLeft,(x.clientY-B.top)/p.y-a.clientTop)}static mousePos(a,p){const x=R.getScale(a);return R.getPoint(a,x,p)}static touchPos(a,p){const x=[],B=R.getScale(a);for(let I=0;I<p.length;I++)x.push(R.getPoint(a,B,p[I]));return x}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const U={supported:!1,testSupport:function(w){!Ae&&te&&(he?pe(w):J=w)}};let J,te,Ae=!1,he=!1;function pe(w){const a=w.createTexture();w.bindTexture(w.TEXTURE_2D,a);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,te),w.isContextLost())return;U.supported=!0}catch{}w.deleteTexture(a),Ae=!0}var be,Te;typeof document<"u"&&(te=document.createElement("img"),te.onload=function(){J&&pe(J),J=null,he=!0},te.onerror=function(){Ae=!0,J=null},te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let a,p,x,B;w.resetRequestQueue=()=>{a=[],p=0,x=0,B={}},w.addThrottleControl=E=>{const P=x++;return B[P]=E,P},w.removeThrottleControl=E=>{delete B[E],j()},w.getImage=function(E,P){let V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((q,K)=>{U.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),s.e(E,{type:"image"}),a.push({abortController:P,requestParameters:E,supportImageRefresh:V,state:"queued",onError:ee=>{K(ee)},onSuccess:ee=>{q(ee)}}),j()})};const I=E=>s._(this,void 0,void 0,function*(){E.state="running";const{requestParameters:P,supportImageRefresh:V,onError:q,onSuccess:K,abortController:ee}=E,se=V===!1&&!s.i(self)&&!s.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((_e,Ie)=>_e&&Ie==="accept",!0));p++;const oe=se?y(P,ee):s.m(P,ee);try{const _e=yield oe;delete E.abortController,E.state="completed",_e.data instanceof HTMLImageElement||s.b(_e.data)?K(_e):_e.data&&K({data:yield(le=_e.data,typeof createImageBitmap=="function"?s.d(le):s.f(le)),cacheControl:_e.cacheControl,expires:_e.expires})}catch(_e){delete E.abortController,q(_e)}finally{p--,j()}var le}),j=()=>{const E=(()=>{for(const P of Object.keys(B))if(B[P]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=p;P<E&&a.length>0;P++){const V=a.shift();V.abortController.signal.aborted?P--:I(V)}},y=(E,P)=>new Promise((V,q)=>{const K=new Image,ee=E.url,se=E.credentials;se&&se==="include"?K.crossOrigin="use-credentials":(se&&se==="same-origin"||!s.s(ee))&&(K.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{K.src="",q(s.c())}),K.fetchPriority="high",K.onload=()=>{K.onerror=K.onload=null,V({data:K})},K.onerror=()=>{K.onerror=K.onload=null,P.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},K.src=ee})}(be||(be={})),be.resetRequestQueue(),function(w){w.Glyphs="Glyphs",w.Image="Image",w.Source="Source",w.SpriteImage="SpriteImage",w.SpriteJSON="SpriteJSON",w.Style="Style",w.Tile="Tile",w.Unknown="Unknown"}(Te||(Te={}));class qe{constructor(a){this._transformRequestFn=a}transformRequest(a,p){return this._transformRequestFn&&this._transformRequestFn(a,p)||{url:a}}normalizeSpriteURL(a,p,x){const B=function(I){const j=I.match(je);if(!j)throw new Error(`Unable to parse URL "${I}"`);return{protocol:j[1],authority:j[2],path:j[3]||"/",params:j[4]?j[4].split("&"):[]}}(a);return B.path+=`${p}${x}`,function(I){const j=I.params.length?`?${I.params.join("&")}`:"";return`${I.protocol}://${I.authority}${I.path}${j}`}(B)}setTransformRequest(a){this._transformRequestFn=a}}const je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function We(w){var a=new s.A(3);return a[0]=w[0],a[1]=w[1],a[2]=w[2],a}var Ne,at=function(w,a,p){return w[0]=a[0]-p[0],w[1]=a[1]-p[1],w[2]=a[2]-p[2],w};Ne=new s.A(3),s.A!=Float32Array&&(Ne[0]=0,Ne[1]=0,Ne[2]=0);var nt=function(w){var a=w[0],p=w[1];return a*a+p*p};function ke(w){const a=[];if(typeof w=="string")a.push({id:"default",url:w});else if(w&&w.length>0){const p=[];for(const{id:x,url:B}of w){const I=`${x}${B}`;p.indexOf(I)===-1&&(p.push(I),a.push({id:x,url:B}))}}return a}(function(){var w=new s.A(2);s.A!=Float32Array&&(w[0]=0,w[1]=0)})();class De{constructor(a,p,x,B){this.context=a,this.format=x,this.texture=a.gl.createTexture(),this.update(p,B)}update(a,p,x){const{width:B,height:I}=a,j=!(this.size&&this.size[0]===B&&this.size[1]===I||x),{context:y}=this,{gl:E}=y;if(this.useMipmap=!!(p&&p.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!p||p.premultiply!==!1)),j)this.size=[B,I],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,a):E.texImage2D(E.TEXTURE_2D,0,this.format,B,I,0,this.format,E.UNSIGNED_BYTE,a.data);else{const{x:P,y:V}=x||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?E.texSubImage2D(E.TEXTURE_2D,0,P,V,E.RGBA,E.UNSIGNED_BYTE,a):E.texSubImage2D(E.TEXTURE_2D,0,P,V,B,I,E.RGBA,E.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(a,p,x){const{context:B}=this,{gl:I}=B;I.bindTexture(I.TEXTURE_2D,this.texture),x!==I.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(x=I.LINEAR),a!==this.filter&&(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,a),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,x||a),this.filter=a),p!==this.wrap&&(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,p),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,p),this.wrap=p)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function Ye(w){const{userImage:a}=w;return!!(a&&a.render&&a.render())&&(w.data.replace(new Uint8Array(a.data.buffer)),!0)}class Ze extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:p,promiseResolve:x}of this.requestors)x(this._getImagesForIds(p));this.requestors=[]}}getImage(a){const p=this.images[a];if(p&&!p.data&&p.spriteData){const x=p.spriteData;p.data=new s.R({width:x.width,height:x.height},x.context.getImageData(x.x,x.y,x.width,x.height).data),p.spriteData=null}return p}addImage(a,p){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,p)&&(this.images[a]=p)}_validate(a,p){let x=!0;const B=p.data||p.spriteData;return this._validateStretch(p.stretchX,B&&B.width)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "stretchX" value`))),x=!1),this._validateStretch(p.stretchY,B&&B.height)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "stretchY" value`))),x=!1),this._validateContent(p.content,p)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "content" value`))),x=!1),x}_validateStretch(a,p){if(!a)return!0;let x=0;for(const B of a){if(B[0]<x||B[1]<B[0]||p<B[1])return!1;x=B[1]}return!0}_validateContent(a,p){if(!a)return!0;if(a.length!==4)return!1;const x=p.spriteData,B=x&&x.width||p.data.width,I=x&&x.height||p.data.height;return!(a[0]<0||B<a[0]||a[1]<0||I<a[1]||a[2]<0||B<a[2]||a[3]<0||I<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const B=this.getImage(a);if(x&&(B.data.width!==p.data.width||B.data.height!==p.data.height))throw new Error(`size mismatch between old image (${B.data.width}x${B.data.height}) and new image (${p.data.width}x${p.data.height}).`);p.version=B.version+1,this.images[a]=p,this.updatedImages[a]=!0}removeImage(a){const p=this.images[a];delete this.images[a],delete this.patterns[a],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((p,x)=>{let B=!0;if(!this.isLoaded())for(const I of a)this.images[I]||(B=!1);this.isLoaded()||B?p(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:p})})}_getImagesForIds(a){const p={};for(const x of a){let B=this.getImage(x);B||(this.fire(new s.k("styleimagemissing",{id:x})),B=this.getImage(x)),B?p[x]={data:B.data.clone(),pixelRatio:B.pixelRatio,sdf:B.sdf,version:B.version,stretchX:B.stretchX,stretchY:B.stretchY,content:B.content,hasRenderCallback:!!(B.userImage&&B.userImage.render)}:s.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return p}getPixelSize(){const{width:a,height:p}=this.atlasImage;return{width:a,height:p}}getPattern(a){const p=this.patterns[a],x=this.getImage(a);if(!x)return null;if(p&&p.position.version===x.version)return p.position;if(p)p.position.version=x.version;else{const B={w:x.data.width+2,h:x.data.height+2,x:0,y:0},I=new s.I(B,x);this.patterns[a]={bin:B,position:I}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const p=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new De(a,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const I in this.patterns)a.push(this.patterns[I].bin);const{w:p,h:x}=s.p(a),B=this.atlasImage;B.resize({width:p||1,height:x||1});for(const I in this.patterns){const{bin:j}=this.patterns[I],y=j.x+1,E=j.y+1,P=this.getImage(I).data,V=P.width,q=P.height;s.R.copy(P,B,{x:0,y:0},{x:y,y:E},{width:V,height:q}),s.R.copy(P,B,{x:0,y:q-1},{x:y,y:E-1},{width:V,height:1}),s.R.copy(P,B,{x:0,y:0},{x:y,y:E+q},{width:V,height:1}),s.R.copy(P,B,{x:V-1,y:0},{x:y-1,y:E},{width:1,height:q}),s.R.copy(P,B,{x:0,y:0},{x:y+V,y:E},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const p of a){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const x=this.getImage(p);x||s.w(`Image with ID: "${p}" was not found`),Ye(x)&&this.updateImage(p,x)}}}const Ct=1e20;function Et(w,a,p,x,B,I,j,y,E){for(let P=a;P<a+x;P++)Pt(w,p*I+P,I,B,j,y,E);for(let P=p;P<p+B;P++)Pt(w,P*I+a,1,x,j,y,E)}function Pt(w,a,p,x,B,I,j){I[0]=0,j[0]=-Ct,j[1]=Ct,B[0]=w[a];for(let y=1,E=0,P=0;y<x;y++){B[y]=w[a+y*p];const V=y*y;do{const q=I[E];P=(B[y]-B[q]+V-q*q)/(y-q)/2}while(P<=j[E]&&--E>-1);E++,I[E]=y,j[E]=P,j[E+1]=Ct}for(let y=0,E=0;y<x;y++){for(;j[E+1]<y;)E++;const P=I[E],V=y-P;w[a+y*p]=B[P]+V*V}}class bt{constructor(a,p){this.requestManager=a,this.localIdeographFontFamily=p,this.entries={}}setURL(a){this.url=a}getGlyphs(a){return s._(this,void 0,void 0,function*(){const p=[];for(const I in a)for(const j of a[I])p.push(this._getAndCacheGlyphsPromise(I,j));const x=yield Promise.all(p),B={};for(const{stack:I,id:j,glyph:y}of x)B[I]||(B[I]={}),B[I][j]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics};return B})}_getAndCacheGlyphsPromise(a,p){return s._(this,void 0,void 0,function*(){let x=this.entries[a];x||(x=this.entries[a]={glyphs:{},requests:{},ranges:{}});let B=x.glyphs[p];if(B!==void 0)return{stack:a,id:p,glyph:B};if(B=this._tinySDF(x,a,p),B)return x.glyphs[p]=B,{stack:a,id:p,glyph:B};const I=Math.floor(p/256);if(256*I>65535)throw new Error("glyphs > 65535 not supported");if(x.ranges[I])return{stack:a,id:p,glyph:B};if(!this.url)throw new Error("glyphsUrl is not set");if(!x.requests[I]){const y=bt.loadGlyphRange(a,I,this.url,this.requestManager);x.requests[I]=y}const j=yield x.requests[I];for(const y in j)this._doesCharSupportLocalGlyph(+y)||(x.glyphs[+y]=j[+y]);return x.ranges[I]=!0,{stack:a,id:p,glyph:j[p]||null}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](a)||s.u["Hangul Syllables"](a)||s.u.Hiragana(a)||s.u.Katakana(a))}_tinySDF(a,p,x){const B=this.localIdeographFontFamily;if(!B||!this._doesCharSupportLocalGlyph(x))return;let I=a.tinySDF;if(!I){let y="400";/bold/i.test(p)?y="900":/medium/i.test(p)?y="500":/light/i.test(p)&&(y="200"),I=a.tinySDF=new bt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:B,fontWeight:y})}const j=I.draw(String.fromCharCode(x));return{id:x,bitmap:new s.o({width:j.width||60,height:j.height||60},j.data),metrics:{width:j.glyphWidth/2||24,height:j.glyphHeight/2||24,left:j.glyphLeft/2+.5||0,top:j.glyphTop/2-27.5||-8,advance:j.glyphAdvance/2||24,isDoubleResolution:!0}}}}bt.loadGlyphRange=function(w,a,p,x){return s._(this,void 0,void 0,function*(){const B=256*a,I=B+255,j=x.transformRequest(p.replace("{fontstack}",w).replace("{range}",`${B}-${I}`),Te.Glyphs),y=yield s.l(j,new AbortController);if(!y||!y.data)throw new Error(`Could not load glyph range. range: ${a}, ${B}-${I}`);const E={};for(const P of s.n(y.data))E[P.id]=P;return E})},bt.TinySDF=class{constructor(){let{fontSize:w=24,buffer:a=3,radius:p=8,cutoff:x=.25,fontFamily:B="sans-serif",fontWeight:I="normal",fontStyle:j="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=a,this.cutoff=x,this.radius=p;const y=this.size=w+4*a,E=this._createCanvas(y),P=this.ctx=E.getContext("2d",{willReadFrequently:!0});P.font=`${j} ${I} ${w}px ${B}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(w){const a=document.createElement("canvas");return a.width=a.height=w,a}draw(w){const{width:a,actualBoundingBoxAscent:p,actualBoundingBoxDescent:x,actualBoundingBoxLeft:B,actualBoundingBoxRight:I}=this.ctx.measureText(w),j=Math.ceil(p),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(I-B))),E=Math.min(this.size-this.buffer,j+Math.ceil(x)),P=y+2*this.buffer,V=E+2*this.buffer,q=Math.max(P*V,0),K=new Uint8ClampedArray(q),ee={data:K,width:P,height:V,glyphWidth:y,glyphHeight:E,glyphTop:j,glyphLeft:0,glyphAdvance:a};if(y===0||E===0)return ee;const{ctx:se,buffer:oe,gridInner:le,gridOuter:_e}=this;se.clearRect(oe,oe,y,E),se.fillText(w,oe,oe+j);const Ie=se.getImageData(oe,oe,y,E);_e.fill(Ct,0,q),le.fill(0,0,q);for(let ve=0;ve<E;ve++)for(let Se=0;Se<y;Se++){const et=Ie.data[4*(ve*y+Se)+3]/255;if(et===0)continue;const Oe=(ve+oe)*P+Se+oe;if(et===1)_e[Oe]=0,le[Oe]=Ct;else{const Re=.5-et;_e[Oe]=Re>0?Re*Re:0,le[Oe]=Re<0?Re*Re:0}}Et(_e,0,0,P,V,P,this.f,this.v,this.z),Et(le,oe,oe,y,E,P,this.f,this.v,this.z);for(let ve=0;ve<q;ve++){const Se=Math.sqrt(_e[ve])-Math.sqrt(le[ve]);K[ve]=Math.round(255-255*(Se/this.radius+this.cutoff))}return ee}};class Rt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(a,p){return s.y(a.expression.evaluate(p))}interpolate(a,p,x){return{x:s.z.number(a.x,p.x,x),y:s.z.number(a.y,p.y,x),z:s.z.number(a.z,p.z,x)}}}let Ft;class Xt extends s.E{constructor(a){super(),Ft=Ft||new s.q({anchor:new s.D(s.v.light.anchor),position:new Rt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Ft),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.r,a,p))for(const x in a){const B=a[x];x.endsWith("-transition")?this._transitionable.setTransition(x.slice(0,-11),B):this._transitionable.setValue(x,B)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,p,x){return(!x||x.validate!==!1)&&s.t(this,a.call(s.x,{value:p,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class Le{constructor(a,p){this.width=a,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,p){const x=a.join(",")+String(p);return this.dashEntry[x]||(this.dashEntry[x]=this.addDash(a,p)),this.dashEntry[x]}getDashRanges(a,p,x){const B=[];let I=a.length%2==1?-a[a.length-1]*x:0,j=a[0]*x,y=!0;B.push({left:I,right:j,isDash:y,zeroLength:a[0]===0});let E=a[0];for(let P=1;P<a.length;P++){y=!y;const V=a[P];I=E*x,E+=V,j=E*x,B.push({left:I,right:j,isDash:y,zeroLength:V===0})}return B}addRoundDash(a,p,x){const B=p/2;for(let I=-x;I<=x;I++){const j=this.width*(this.nextRow+x+I);let y=0,E=a[y];for(let P=0;P<this.width;P++){P/E.right>1&&(E=a[++y]);const V=Math.abs(P-E.left),q=Math.abs(P-E.right),K=Math.min(V,q);let ee;const se=I/x*(B+1);if(E.isDash){const oe=B-Math.abs(se);ee=Math.sqrt(K*K+oe*oe)}else ee=B-Math.sqrt(K*K+se*se);this.data[j+P]=Math.max(0,Math.min(255,ee+128))}}}addRegularDash(a){for(let y=a.length-1;y>=0;--y){const E=a[y],P=a[y+1];E.zeroLength?a.splice(y,1):P&&P.isDash===E.isDash&&(P.left=E.left,a.splice(y,1))}const p=a[0],x=a[a.length-1];p.isDash===x.isDash&&(p.left=x.left-this.width,x.right=p.right+this.width);const B=this.width*this.nextRow;let I=0,j=a[I];for(let y=0;y<this.width;y++){y/j.right>1&&(j=a[++I]);const E=Math.abs(y-j.left),P=Math.abs(y-j.right),V=Math.min(E,P);this.data[B+y]=Math.max(0,Math.min(255,(j.isDash?V:-V)+128))}}addDash(a,p){const x=p?7:0,B=2*x+1;if(this.nextRow+B>this.height)return s.w("LineAtlas out of space"),null;let I=0;for(let y=0;y<a.length;y++)I+=a[y];if(I!==0){const y=this.width/I,E=this.getDashRanges(a,this.width,y);p?this.addRoundDash(E,y,x):this.addRegularDash(E)}const j={y:(this.nextRow+x+.5)/this.height,height:2*x/this.height,width:I};return this.nextRow+=B,this.dirty=!0,j}bind(a){const p=a.gl;this.texture?(p.bindTexture(p.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,p.texSubImage2D(p.TEXTURE_2D,0,0,0,this.width,this.height,p.ALPHA,p.UNSIGNED_BYTE,this.data))):(this.texture=p.createTexture(),p.bindTexture(p.TEXTURE_2D,this.texture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texImage2D(p.TEXTURE_2D,0,p.ALPHA,this.width,this.height,0,p.ALPHA,p.UNSIGNED_BYTE,this.data))}}const Xe="maplibre_preloaded_worker_pool";class it{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<it.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xe]}numActive(){return Object.keys(this.active).length}}const pt=Math.floor(F.hardwareConcurrency/2);let mt,Bt;function Dt(){return mt||(mt=new it),mt}it.workerCount=s.B(globalThis)?Math.max(Math.min(pt,3),1):1;class Mt{constructor(a,p){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=p;const x=this.workerPool.acquire(p);for(let B=0;B<x.length;B++){const I=new s.C(x[B],p);I.name=`Worker ${B}`,this.actors.push(I)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,p){const x=[];for(const B of this.actors)x.push(B.sendAsync({type:a,data:p}));return Promise.all(x)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(p=>{p.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,p){for(const x of this.actors)x.registerMessageHandler(a,p)}}function qt(){return Bt||(Bt=new Mt(Dt(),s.G),Bt.registerMessageHandler("getResource",(w,a,p)=>s.m(a,p))),Bt}function ni(w,a){const p=s.F();return s.H(p,p,[1,1,0]),s.J(p,p,[.5*w.width,.5*w.height,1]),s.K(p,p,w.calculatePosMatrix(a.toUnwrapped()))}function _i(w,a,p,x,B,I){const j=function(q,K,ee){if(q)for(const se of q){const oe=K[se];if(oe&&oe.source===ee&&oe.type==="fill-extrusion")return!0}else for(const se in K){const oe=K[se];if(oe.source===ee&&oe.type==="fill-extrusion")return!0}return!1}(B&&B.layers,a,w.id),y=I.maxPitchScaleFactor(),E=w.tilesIn(x,y,j);E.sort(vi);const P=[];for(const q of E)P.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(a,p,w._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,B,I,y,ni(w.transform,q.tileID))});const V=function(q){const K={},ee={};for(const se of q){const oe=se.queryResults,le=se.wrappedTileID,_e=ee[le]=ee[le]||{};for(const Ie in oe){const ve=oe[Ie],Se=_e[Ie]=_e[Ie]||{},et=K[Ie]=K[Ie]||[];for(const Oe of ve)Se[Oe.featureIndex]||(Se[Oe.featureIndex]=!0,et.push(Oe))}}return K}(P);for(const q in V)V[q].forEach(K=>{const ee=K.feature,se=w.getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=se});return V}function vi(w,a){const p=w.tileID,x=a.tileID;return p.overscaledZ-x.overscaledZ||p.canonical.y-x.canonical.y||p.wrap-x.wrap||p.canonical.x-x.canonical.x}function Pi(w,a,p){return s._(this,void 0,void 0,function*(){let x=w;if(w.url?x=(yield s.h(a.transformRequest(w.url,Te.Source),p)).data:yield F.frameAsync(p),!x)return null;const B=s.L(s.e(x,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in x&&x.vector_layers&&(B.vectorLayerIds=x.vector_layers.map(I=>I.id)),B})}class kt{constructor(a,p){a&&(p?this.setSouthWest(a).setNorthEast(p):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof s.M?new s.M(a.lng,a.lat):s.M.convert(a),this}setSouthWest(a){return this._sw=a instanceof s.M?new s.M(a.lng,a.lat):s.M.convert(a),this}extend(a){const p=this._sw,x=this._ne;let B,I;if(a instanceof s.M)B=a,I=a;else{if(!(a instanceof kt))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(kt.convert(a)):this.extend(s.M.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(s.M.convert(a)):this;if(B=a._sw,I=a._ne,!B||!I)return this}return p||x?(p.lng=Math.min(B.lng,p.lng),p.lat=Math.min(B.lat,p.lat),x.lng=Math.max(I.lng,x.lng),x.lat=Math.max(I.lat,x.lat)):(this._sw=new s.M(B.lng,B.lat),this._ne=new s.M(I.lng,I.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:p,lat:x}=s.M.convert(a);let B=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(B=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&B}static convert(a){return a instanceof kt?a:a&&new kt(a)}static fromLngLat(a){const x=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,B=x/Math.cos(Math.PI/180*a.lat);return new kt(new s.M(a.lng-B,a.lat-x),new s.M(a.lng+B,a.lat+x))}}class lt{constructor(a,p,x){this.bounds=kt.convert(this.validateBounds(a)),this.minzoom=p||0,this.maxzoom=x||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const p=Math.pow(2,a.z),x=Math.floor(s.N(this.bounds.getWest())*p),B=Math.floor(s.O(this.bounds.getNorth())*p),I=Math.ceil(s.N(this.bounds.getEast())*p),j=Math.ceil(s.O(this.bounds.getSouth())*p);return a.x>=x&&a.x<I&&a.y>=B&&a.y<j}}class wt extends s.E{constructor(a,p,x,B){if(super(),this.id=a,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(p,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(B)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Pi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a&&(s.e(this,a),a.bounds&&(this.tileBounds=new lt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new s.j(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(a){return s._(this,void 0,void 0,function*(){const p=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),x={request:this.map._requestManager.transformRequest(p,Te.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};x.request.collectResourceTiming=this._collectResourceTiming;let B="reloadTile";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((I,j)=>{a.reloadPromise={resolve:I,reject:j}})}else a.actor=this.dispatcher.getActor(),B="loadTile";a.abortController=new AbortController;try{const I=yield a.actor.sendAsync({type:B,data:x},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,I)}catch(I){if(delete a.abortController,a.aborted)return;if(I&&I.status!==404)throw I;this._afterTileLoadWorkerResponse(a,null)}})}_afterTileLoadWorkerResponse(a,p){if(p&&p.resourceTiming&&(a.resourceTiming=p.resourceTiming),p&&this.map._refreshExpiredTiles&&a.setExpiryData(p),a.loadVectorData(p,this.map.painter),a.reloadPromise){const x=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(x.resolve).catch(x.reject)}}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"abortTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Oi extends s.E{constructor(a,p,x,B){super(),this.id=a,this.dispatcher=x,this.setEventedParent(B),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},p),s.e(this,s.L(p,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Pi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(s.e(this,a),a.bounds&&(this.tileBounds=new lt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new s.j(a))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return s.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return s._(this,void 0,void 0,function*(){const p=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{const x=yield be.getImage(this.map._requestManager.transformRequest(p,Te.Tile),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(x&&x.data){this.map._refreshExpiredTiles&&x.cacheControl&&x.expires&&a.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const B=this.map.painter.context,I=B.gl,j=x.data;a.texture=this.map.painter.getTileTexture(j.width),a.texture?a.texture.update(j,{useMipmap:!0}):(a.texture=new De(B,j,I.RGBA,{useMipmap:!0}),a.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),B.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax)),a.state="loaded"}}catch(x){if(delete a.abortController,a.aborted)a.state="unloaded";else if(x)throw a.state="errored",x}})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class ti extends Oi{constructor(a,p,x,B){super(a,p,x,B),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox",this.redFactor=p.redFactor,this.greenFactor=p.greenFactor,this.blueFactor=p.blueFactor,this.baseShift=p.baseShift}loadTile(a){return s._(this,void 0,void 0,function*(){const p=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),x=this.map._requestManager.transformRequest(p,Te.Tile);a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{const B=yield be.getImage(x,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(B&&B.data){const I=B.data;this.map._refreshExpiredTiles&&B.cacheControl&&B.expires&&a.setExpiryData({cacheControl:B.cacheControl,expires:B.expires});const j=s.b(I)&&s.S()?I:yield this.readImageNow(I),y={type:this.type,uid:a.uid,source:this.id,rawImageData:j,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();const E=yield a.actor.sendAsync({type:"loadDEMTile",data:y});a.dem=E,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(B){if(delete a.abortController,a.aborted)a.state="unloaded";else if(B)throw a.state="errored",B}})}readImageNow(a){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const p=a.width+2,x=a.height+2;try{return new s.R({width:p,height:x},yield s.V(a,-1,-1,p,x))}catch{}}return F.getImageData(a,1)})}_getNeighboringTiles(a){const p=a.canonical,x=Math.pow(2,p.z),B=(p.x-1+x)%x,I=p.x===0?a.wrap-1:a.wrap,j=(p.x+1+x)%x,y=p.x+1===x?a.wrap+1:a.wrap,E={};return E[new s.Q(a.overscaledZ,I,p.z,B,p.y).key]={backfilled:!1},E[new s.Q(a.overscaledZ,y,p.z,j,p.y).key]={backfilled:!1},p.y>0&&(E[new s.Q(a.overscaledZ,I,p.z,B,p.y-1).key]={backfilled:!1},E[new s.Q(a.overscaledZ,a.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},E[new s.Q(a.overscaledZ,y,p.z,j,p.y-1).key]={backfilled:!1}),p.y+1<x&&(E[new s.Q(a.overscaledZ,I,p.z,B,p.y+1).key]={backfilled:!1},E[new s.Q(a.overscaledZ,a.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},E[new s.Q(a.overscaledZ,y,p.z,j,p.y+1).key]={backfilled:!1}),E}unloadTile(a){return s._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:a.uid,source:this.id}}))})}}class ht extends s.E{constructor(a,p,x,B){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=x.getActor(),this.setEventedParent(B),this._data=p.data,this._options=s.e({},p),this._collectResourceTiming=p.collectResourceTiming,p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;const I=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*I,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*I,extent:s.W,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?p.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:s.W,radius:(p.clusterRadius||50)*I,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData(),this}updateData(a){return this._updateWorkerData(a),this}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a&&(a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=a.clusterRadius),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=a.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,p,x){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:a,limit:p,offset:x}})}_updateWorkerData(a){return s._(this,void 0,void 0,function*(){const p=s.e({type:this.type},this.workerOptions);a?p.dataDiff=a:typeof this._data=="string"?(p.request=this.map._requestManager.transformRequest(F.resolveURL(this._data),Te.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const x=yield this.actor.sendAsync({type:"loadData",data:p});if(this._pendingLoads--,this._removed||x.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let B=null;x.resourceTiming&&x.resourceTiming[this.id]&&(B=x.resourceTiming[this.id].slice(0));const I={dataType:"source"};this._collectResourceTiming&&B&&B.length>0&&s.e(I,{resourceTiming:B}),this.fire(new s.k("data",Object.assign(Object.assign({},I),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},I),{sourceDataType:"content"})))}catch(x){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(x))}})}loaded(){return this._pendingLoads===0}loadTile(a){return s._(this,void 0,void 0,function*(){const p=a.actor?"reloadTile":"loadTile";a.actor=this.actor;const x={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.abortController=new AbortController;const B=yield this.actor.sendAsync({type:p,data:x},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(B,this.map.painter,p==="reloadTile")})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var $t=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class oi extends s.E{constructor(a,p,x,B){super(),this.id=a,this.dispatcher=x,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(B),this.options=p}load(a){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const p=yield be.getImage(this.map._requestManager.transformRequest(this.url,Te.Image),this._request);this._request=null,this._loaded=!0,p&&p.data&&(this.image=p.data,a&&(this.coordinates=a),this._finishLoading())}catch(p){this._request=null,this.fire(new s.j(p))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;const p=a.map(s.Y.fromLngLat);this.tileID=function(B){let I=1/0,j=1/0,y=-1/0,E=-1/0;for(const K of B)I=Math.min(I,K.x),j=Math.min(j,K.y),y=Math.max(y,K.x),E=Math.max(E,K.y);const P=Math.max(y-I,E-j),V=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),q=Math.pow(2,V);return new s.a0(V,Math.floor((I+y)/2*q),Math.floor((j+E)/2*q))}(p),this.minzoom=this.maxzoom=this.tileID.z;const x=p.map(B=>this.tileID.getTilePoint(B)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(x[0].x,x[0].y,0,0),this._boundsArray.emplaceBack(x[1].x,x[1].y,s.W,0),this._boundsArray.emplaceBack(x[3].x,x[3].y,0,s.W),this._boundsArray.emplaceBack(x[2].x,x[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,p=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,$t.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new De(a,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));let x=!1;for(const B in this.tiles){const I=this.tiles[B];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,x=!0)}x&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class gi extends oi{constructor(a,p,x,B){super(a,p,x,B),this.roundZoom=!0,this.type="video",this.options=p}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const a=this.options;this.urls=[];for(const p of a.urls)this.urls.push(this.map._requestManager.transformRequest(p,Te.Source).url);try{const p=yield s.a2(this.urls);if(this._loaded=!0,!p)return;this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(p){this.fire(new s.j(p))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const p=this.video.seekable;a<p.start(0)||a>p.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${p.start(0)} and ${p.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,p=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,$t.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new De(a,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));let x=!1;for(const B in this.tiles){const I=this.tiles[B];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,x=!0)}x&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ci extends oi{constructor(a,p,x,B){super(a,p,x,B),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(I=>!Array.isArray(I)||I.length!==2||I.some(j=>typeof j!="number"))||this.fire(new s.j(new s.a1(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${a}`,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${a}`,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const p=this.map.painter.context,x=p.gl;this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,$t.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new De(p,this.canvas,x.RGBA,{premultiply:!0});let B=!1;for(const I in this.tiles){const j=this.tiles[I];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture,B=!0)}B&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const Ki={},tr=w=>{switch(w){case"geojson":return ht;case"image":return oi;case"raster":return Oi;case"raster-dem":return ti;case"vector":return wt;case"video":return gi;case"canvas":return ci}return Ki[w]},pr="RTLPluginLoaded";class Mr extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=qt()}_syncState(a){return this.status=a,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:a,pluginURL:this.url}).catch(p=>{throw this.status="error",p})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(a){return s._(this,arguments,void 0,function(p){var x=this;let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(x.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(x.url=F.resolveURL(p),!x.url)throw new Error(`requested url ${p} is invalid`);if(x.status==="unavailable"){if(!B)return x._requestImport();x.status="deferred",x._syncState(x.status)}else if(x.status==="requested")return x._requestImport()}()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(pr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let zt=null;function Wi(){return zt||(zt=new Mr),zt}class hi{constructor(a,p){this.timeAdded=0,this.fadeEndTime=0,this.tileID=a,this.uid=s.a3(),this.uses=0,this.tileSize=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const p=a+this.timeAdded;p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,p,x){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(B,I){const j={};if(!I)return j;for(const y of B){const E=y.layerIds.map(P=>I.getLayer(P)).filter(Boolean);if(E.length!==0){y.layers=E,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(P=>E.filter(V=>V.id===P)[0]));for(const P of E)j[P.id]=y}}return j}(a.buckets,p.style),this.hasSymbolBuckets=!1;for(const B in this.buckets){const I=this.buckets[B];if(I instanceof s.a5){if(this.hasSymbolBuckets=!0,!x)break;I.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const B in this.buckets){const I=this.buckets[B];if(I instanceof s.a5&&I.hasRTLText){this.hasRTLText=!0,Wi().lazyLoad();break}}this.queryPadding=0;for(const B in this.buckets){const I=this.buckets[B];this.queryPadding=Math.max(this.queryPadding,p.style.getLayer(B).queryRadius(I))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const x in this.buckets){const B=this.buckets[x];B.uploadPending()&&B.upload(a)}const p=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new De(a,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new De(a,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,p,x,B,I,j,y,E,P,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:B,cameraQueryGeometry:I,scale:j,tileSize:this.tileSize,pixelPosMatrix:V,transform:E,params:y,queryPadding:this.queryPadding*P},a,p,x):{}}querySourceFeatures(a,p){const x=this.latestFeatureIndex;if(!x||!x.rawTileData)return;const B=x.loadVTLayers(),I=p&&p.sourceLayer?p.sourceLayer:"",j=B._geojsonTileLayer||B[I];if(!j)return;const y=s.a6(p&&p.filter),{z:E,x:P,y:V}=this.tileID.canonical,q={z:E,x:P,y:V};for(let K=0;K<j.length;K++){const ee=j.feature(K);if(y.needGeometry){const le=s.a7(ee,!0);if(!y.filter(new s.a8(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!y.filter(new s.a8(this.tileID.overscaledZ),ee))continue;const se=x.getId(ee,I),oe=new s.a9(ee,E,P,V,se);oe.tile=q,a.push(oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const p=this.expirationTime;if(a.cacheControl){const x=s.aa(a.cacheControl);x["max-age"]&&(this.expirationTime=Date.now()+1e3*x["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const x=Date.now();let B=!1;if(this.expirationTime>x)B=!1;else if(p)if(this.expirationTime<p)B=!0;else{const I=this.expirationTime-p;I?this.expirationTime=x+Math.max(I,3e4):B=!0}else B=!0;B?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,p){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const x=this.latestFeatureIndex.loadVTLayers();for(const B in this.buckets){if(!p.style.hasLayer(B))continue;const I=this.buckets[B],j=I.layers[0].sourceLayer||"_geojsonTileLayer",y=x[j],E=a[j];if(!y||!E||Object.keys(E).length===0)continue;I.update(E,y,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=p&&p.style&&p.style.getLayer(B);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=F.now()+a}setDependencies(a,p){const x={};for(const B of p)x[B]=!0;this.dependencies[a]=x}hasDependency(a,p){for(const x of a){const B=this.dependencies[x];if(B){for(const I of p)if(B[I])return!0}}return!1}}class Wt{constructor(a,p){this.max=a,this.onRemove=p,this.reset()}reset(){for(const a in this.data)for(const p of this.data[a])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(a,p,x){const B=a.wrapped().key;this.data[B]===void 0&&(this.data[B]=[]);const I={value:p,timeout:void 0};if(x!==void 0&&(I.timeout=setTimeout(()=>{this.remove(a,I)},x)),this.data[B].push(I),this.order.push(B),this.order.length>this.max){const j=this._getAndRemoveByKey(this.order[0]);j&&this.onRemove(j)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const p=this.data[a].shift();return p.timeout&&clearTimeout(p.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),p.value}getByKey(a){const p=this.data[a];return p?p[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,p){if(!this.has(a))return this;const x=a.wrapped().key,B=p===void 0?0:this.data[x].indexOf(p),I=this.data[x][B];return this.data[x].splice(B,1),I.timeout&&clearTimeout(I.timeout),this.data[x].length===0&&delete this.data[x],this.onRemove(I.value),this.order.splice(this.order.indexOf(x),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(a){const p=[];for(const x in this.data)for(const B of this.data[x])a(B.value)||p.push(B);for(const x of p)this.remove(x.value.tileID,x)}}class Ar{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,p,x){const B=String(p);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][B]=this.stateChanges[a][B]||{},s.e(this.stateChanges[a][B],x),this.deletedStates[a]===null){this.deletedStates[a]={};for(const I in this.state[a])I!==B&&(this.deletedStates[a][I]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][B]===null){this.deletedStates[a][B]={};for(const I in this.state[a][B])x[I]||(this.deletedStates[a][B][I]=null)}else for(const I in x)this.deletedStates[a]&&this.deletedStates[a][B]&&this.deletedStates[a][B][I]===null&&delete this.deletedStates[a][B][I]}removeFeatureState(a,p,x){if(this.deletedStates[a]===null)return;const B=String(p);if(this.deletedStates[a]=this.deletedStates[a]||{},x&&p!==void 0)this.deletedStates[a][B]!==null&&(this.deletedStates[a][B]=this.deletedStates[a][B]||{},this.deletedStates[a][B][x]=null);else if(p!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][B])for(x in this.deletedStates[a][B]={},this.stateChanges[a][B])this.deletedStates[a][B][x]=null;else this.deletedStates[a][B]=null;else this.deletedStates[a]=null}getState(a,p){const x=String(p),B=s.e({},(this.state[a]||{})[x],(this.stateChanges[a]||{})[x]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const I=this.deletedStates[a][p];if(I===null)return{};for(const j in I)delete B[j]}return B}initializeTileState(a,p){a.setFeatureState(this.state,p)}coalesceChanges(a,p){const x={};for(const B in this.stateChanges){this.state[B]=this.state[B]||{};const I={};for(const j in this.stateChanges[B])this.state[B][j]||(this.state[B][j]={}),s.e(this.state[B][j],this.stateChanges[B][j]),I[j]=this.state[B][j];x[B]=I}for(const B in this.deletedStates){this.state[B]=this.state[B]||{};const I={};if(this.deletedStates[B]===null)for(const j in this.state[B])I[j]={},this.state[B][j]={};else for(const j in this.deletedStates[B]){if(this.deletedStates[B][j]===null)this.state[B][j]={};else for(const y of Object.keys(this.deletedStates[B][j]))delete this.state[B][j][y];I[j]=this.state[B][j]}x[B]=x[B]||{},s.e(x[B],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(x).length!==0)for(const B in a)a[B].setFeatureState(x,p)}}class Qt extends s.E{constructor(a,p,x){super(),this.id=a,this.dispatcher=x,this.on("data",B=>{B.dataType==="source"&&B.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&B.dataType==="source"&&B.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((B,I,j,y)=>{const E=new(tr(I.type))(B,I,j,y);if(E.id!==B)throw new Error(`Expected Source id to be ${B} instead of ${E.id}`);return E})(a,p,x,this),this._tiles={},this._cache=new Wt(0,B=>this._unloadTile(B)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ar,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const a in this._tiles){const p=this._tiles[a];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,p,x){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,p,x)}catch(B){a.state="errored",B.status!==404?this._source.fire(new s.j(B,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new s.k("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const x=this._tiles[p];x.upload(a),x.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Si).map(a=>a.key)}getRenderableIds(a){const p=[];for(const x in this._tiles)this._isIdRenderable(x,a)&&p.push(this._tiles[x]);return a?p.sort((x,B)=>{const I=x.tileID,j=B.tileID,y=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle),E=new s.P(j.canonical.x,j.canonical.y)._rotate(this.transform.angle);return I.overscaledZ-j.overscaledZ||E.y-y.y||E.x-y.x}).map(x=>x.tileID.key):p.map(x=>x.tileID).sort(Si).map(x=>x.key)}hasRenderableParent(a){const p=this.findLoadedParent(a,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(a,p){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(p||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,p){return s._(this,void 0,void 0,function*(){const x=this._tiles[a];x&&(x.state!=="loading"&&(x.state=p),yield this._loadTile(x,a,p))})}_tileLoaded(a,p,x){a.timeAdded=F.now(),x==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(p,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const p=this.getRenderableIds();for(let B=0;B<p.length;B++){const I=p[B];if(a.neighboringTiles&&a.neighboringTiles[I]){const j=this.getTileByID(I);x(a,j),x(j,a)}}function x(B,I){B.needsHillshadePrepare=!0,B.needsTerrainPrepare=!0;let j=I.tileID.canonical.x-B.tileID.canonical.x;const y=I.tileID.canonical.y-B.tileID.canonical.y,E=Math.pow(2,B.tileID.canonical.z),P=I.tileID.key;j===0&&y===0||Math.abs(y)>1||(Math.abs(j)>1&&(Math.abs(j+E)===1?j+=E:Math.abs(j-E)===1&&(j-=E)),I.dem&&B.dem&&(B.dem.backfillBorder(I.dem,j,y),B.neighboringTiles&&B.neighboringTiles[P]&&(B.neighboringTiles[P].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,p,x,B){for(const I in this._tiles){let j=this._tiles[I];if(B[I]||!j.hasData()||j.tileID.overscaledZ<=p||j.tileID.overscaledZ>x)continue;let y=j.tileID;for(;j&&j.tileID.overscaledZ>p+1;){const P=j.tileID.scaledTo(j.tileID.overscaledZ-1);j=this._tiles[P.key],j&&j.hasData()&&(y=P)}let E=y;for(;E.overscaledZ>p;)if(E=E.scaledTo(E.overscaledZ-1),a[E.key]){B[y.key]=y;break}}}findLoadedParent(a,p){if(a.key in this._loadedParentTiles){const x=this._loadedParentTiles[a.key];return x&&x.tileID.overscaledZ>=p?x:null}for(let x=a.overscaledZ-1;x>=p;x--){const B=a.scaledTo(x),I=this._getLoadedTile(B);if(I)return I}}_getLoadedTile(a){const p=this._tiles[a.key];return p&&p.hasData()?p:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const p=Math.ceil(a.width/this._source.tileSize)+1,x=Math.ceil(a.height/this._source.tileSize)+1,B=Math.floor(p*x*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,B):B;this._cache.setMaxSize(I)}handleWrapJump(a){const p=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,p){const x={};for(const B in this._tiles){const I=this._tiles[B];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+p),x[I.tileID.key]=I}this._tiles=x;for(const B in this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(const B in this._tiles)this._setTileReloadTimer(B,this._tiles[B])}}update(a,p){if(this.transform=a,this.terrain=p,!this._sourceLoaded||this._paused)return;let x;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?x=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new s.Q(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)):(x=a.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:p}),this._source.hasTile&&(x=x.filter(V=>this._source.hasTile(V)))):x=[];const B=a.coveringZoomLevel(this._source),I=Math.max(B-Qt.maxOverzooming,this._source.minzoom),j=Math.max(B+Qt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const V={};for(const q of x)if(q.canonical.z>this._source.minzoom){const K=q.scaledTo(q.canonical.z-1);V[K.key]=K;const ee=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));V[ee.key]=ee}x=x.concat(Object.values(V))}const y=x.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(x,B);if(Ii(this._source.type)){const V={},q={},K=Object.keys(E),ee=F.now();for(const se of K){const oe=E[se],le=this._tiles[se];if(!le||le.fadeEndTime!==0&&le.fadeEndTime<=ee)continue;const _e=this.findLoadedParent(oe,I);_e&&(this._addTile(_e.tileID),V[_e.tileID.key]=_e.tileID),q[se]=oe}this._retainLoadedChildren(q,B,j,E);for(const se in V)E[se]||(this._coveredTiles[se]=!0,E[se]=V[se]);if(p){const se={},oe={};for(const le of x)this._tiles[le.key].hasData()?se[le.key]=le:oe[le.key]=le;for(const le in oe){const _e=oe[le].children(this._source.maxzoom);this._tiles[_e[0].key]&&this._tiles[_e[1].key]&&this._tiles[_e[2].key]&&this._tiles[_e[3].key]&&(se[_e[0].key]=E[_e[0].key]=_e[0],se[_e[1].key]=E[_e[1].key]=_e[1],se[_e[2].key]=E[_e[2].key]=_e[2],se[_e[3].key]=E[_e[3].key]=_e[3],delete oe[le])}for(const le in oe){const _e=this.findLoadedParent(oe[le],this._source.minzoom);if(_e){se[_e.tileID.key]=E[_e.tileID.key]=_e.tileID;for(const Ie in se)se[Ie].isChildOf(_e.tileID)&&delete se[Ie]}}for(const le in this._tiles)se[le]||(this._coveredTiles[le]=!0)}}for(const V in E)this._tiles[V].clearFadeHold();const P=s.ab(this._tiles,E);for(const V of P){const q=this._tiles[V];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(V)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,p){const x={},B={},I=Math.max(p-Qt.maxOverzooming,this._source.minzoom),j=Math.max(p+Qt.maxUnderzooming,this._source.minzoom),y={};for(const E of a){const P=this._addTile(E);x[E.key]=E,P.hasData()||p<this._source.maxzoom&&(y[E.key]=E)}this._retainLoadedChildren(y,p,j,x);for(const E of a){let P=this._tiles[E.key];if(P.hasData())continue;if(p+1>this._source.maxzoom){const q=E.children(this._source.maxzoom)[0],K=this.getTile(q);if(K&&K.hasData()){x[q.key]=q;continue}}else{const q=E.children(this._source.maxzoom);if(x[q[0].key]&&x[q[1].key]&&x[q[2].key]&&x[q[3].key])continue}let V=P.wasRequested();for(let q=E.overscaledZ-1;q>=I;--q){const K=E.scaledTo(q);if(B[K.key])break;if(B[K.key]=!0,P=this.getTile(K),!P&&V&&(P=this._addTile(K)),P){const ee=P.hasData();if((V||ee)&&(x[K.key]=K),V=P.wasRequested(),ee)break}}}return x}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const p=[];let x,B=this._tiles[a].tileID;for(;B.overscaledZ>0;){if(B.key in this._loadedParentTiles){x=this._loadedParentTiles[B.key];break}p.push(B.key);const I=B.scaledTo(B.overscaledZ-1);if(x=this._getLoadedTile(I),x)break;B=I}for(const I of p)this._loadedParentTiles[I]=x}}_addTile(a){let p=this._tiles[a.key];if(p)return p;p=this._cache.getAndRemove(a),p&&(this._setTileReloadTimer(a.key,p),p.tileID=a,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,p)));const x=p;return p||(p=new hi(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(p,a.key,p.state)),p.uses++,this._tiles[a.key]=p,x||this._source.fire(new s.k("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p}_setTileReloadTimer(a,p){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const x=p.getExpiryTimeout();x&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},x))}_removeTile(a){const p=this._tiles[a];p&&(p.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,p,x){const B=[],I=this.transform;if(!I)return B;const j=x?I.getCameraQueryGeometry(a):a,y=a.map(se=>I.pointCoordinate(se,this.terrain)),E=j.map(se=>I.pointCoordinate(se,this.terrain)),P=this.getIds();let V=1/0,q=1/0,K=-1/0,ee=-1/0;for(const se of E)V=Math.min(V,se.x),q=Math.min(q,se.y),K=Math.max(K,se.x),ee=Math.max(ee,se.y);for(let se=0;se<P.length;se++){const oe=this._tiles[P[se]];if(oe.holdingForFade())continue;const le=oe.tileID,_e=Math.pow(2,I.zoom-oe.tileID.overscaledZ),Ie=p*oe.queryPadding*s.W/oe.tileSize/_e,ve=[le.getTilePoint(new s.Y(V,q)),le.getTilePoint(new s.Y(K,ee))];if(ve[0].x-Ie<s.W&&ve[0].y-Ie<s.W&&ve[1].x+Ie>=0&&ve[1].y+Ie>=0){const Se=y.map(Oe=>le.getTilePoint(Oe)),et=E.map(Oe=>le.getTilePoint(Oe));B.push({tile:oe,tileID:le,queryGeometry:Se,cameraQueryGeometry:et,scale:_e})}}return B}getVisibleCoordinates(a){const p=this.getRenderableIds(a).map(x=>this._tiles[x].tileID);for(const x of p)x.posMatrix=this.transform.calculatePosMatrix(x.toUnwrapped());return p}hasTransition(){if(this._source.hasTransition())return!0;if(Ii(this._source.type)){const a=F.now();for(const p in this._tiles)if(this._tiles[p].fadeEndTime>=a)return!0}return!1}setFeatureState(a,p,x){this._state.updateState(a=a||"_geojsonTileLayer",p,x)}removeFeatureState(a,p,x){this._state.removeFeatureState(a=a||"_geojsonTileLayer",p,x)}getFeatureState(a,p){return this._state.getState(a=a||"_geojsonTileLayer",p)}setDependencies(a,p,x){const B=this._tiles[a];B&&B.setDependencies(p,x)}reloadTilesForDependencies(a,p){for(const x in this._tiles)this._tiles[x].hasDependency(a,p)&&this._reloadTile(x,"reloading");this._cache.filter(x=>!x.hasDependency(a,p))}}function Si(w,a){const p=Math.abs(2*w.wrap)-+(w.wrap<0),x=Math.abs(2*a.wrap)-+(a.wrap<0);return w.overscaledZ-a.overscaledZ||x-p||a.canonical.y-w.canonical.y||a.canonical.x-w.canonical.x}function Ii(w){return w==="raster"||w==="image"||w==="video"}Qt.maxOverzooming=10,Qt.maxUnderzooming=3;class Zt{constructor(a,p){this.reset(a,p)}reset(a,p){this.points=a||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=s.ac(a,0,1);let p=1,x=this._distances[p];const B=a*this.paddedLength+this.padding;for(;x<B&&p<this._distances.length;)x=this._distances[++p];const I=p-1,j=this._distances[I],y=x-j,E=y>0?(B-j)/y:0;return this.points[I].mult(1-E).add(this.points[p].mult(E))}}function bi(w,a){let p=!0;return w==="always"||w!=="never"&&a!=="never"||(p=!1),p}class ei{constructor(a,p,x){const B=this.boxCells=[],I=this.circleCells=[];this.xCellCount=Math.ceil(a/x),this.yCellCount=Math.ceil(p/x);for(let j=0;j<this.xCellCount*this.yCellCount;j++)B.push([]),I.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=p,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,p,x,B,I){this._forEachCell(p,x,B,I,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(B),this.bboxes.push(I)}insertCircle(a,p,x,B){this._forEachCell(p-B,x-B,p+B,x+B,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(p),this.circles.push(x),this.circles.push(B)}_insertBoxCell(a,p,x,B,I,j){this.boxCells[I].push(j)}_insertCircleCell(a,p,x,B,I,j){this.circleCells[I].push(j)}_query(a,p,x,B,I,j,y){if(x<0||a>this.width||B<0||p>this.height)return[];const E=[];if(a<=0&&p<=0&&this.width<=x&&this.height<=B){if(I)return[{key:null,x1:a,y1:p,x2:x,y2:B}];for(let P=0;P<this.boxKeys.length;P++)E.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const V=this.circles[3*P],q=this.circles[3*P+1],K=this.circles[3*P+2];E.push({key:this.circleKeys[P],x1:V-K,y1:q-K,x2:V+K,y2:q+K})}}else this._forEachCell(a,p,x,B,this._queryCell,E,{hitTest:I,overlapMode:j,seenUids:{box:{},circle:{}}},y);return E}query(a,p,x,B){return this._query(a,p,x,B,!1,null)}hitTest(a,p,x,B,I,j){return this._query(a,p,x,B,!0,I,j).length>0}hitTestCircle(a,p,x,B,I){const j=a-x,y=a+x,E=p-x,P=p+x;if(y<0||j>this.width||P<0||E>this.height)return!1;const V=[];return this._forEachCell(j,E,y,P,this._queryCellCircle,V,{hitTest:!0,overlapMode:B,circle:{x:a,y:p,radius:x},seenUids:{box:{},circle:{}}},I),V.length>0}_queryCell(a,p,x,B,I,j,y,E){const{seenUids:P,hitTest:V,overlapMode:q}=y,K=this.boxCells[I];if(K!==null){const se=this.bboxes;for(const oe of K)if(!P.box[oe]){P.box[oe]=!0;const le=4*oe,_e=this.boxKeys[oe];if(a<=se[le+2]&&p<=se[le+3]&&x>=se[le+0]&&B>=se[le+1]&&(!E||E(_e))&&(!V||!bi(q,_e.overlapMode))&&(j.push({key:_e,x1:se[le],y1:se[le+1],x2:se[le+2],y2:se[le+3]}),V))return!0}}const ee=this.circleCells[I];if(ee!==null){const se=this.circles;for(const oe of ee)if(!P.circle[oe]){P.circle[oe]=!0;const le=3*oe,_e=this.circleKeys[oe];if(this._circleAndRectCollide(se[le],se[le+1],se[le+2],a,p,x,B)&&(!E||E(_e))&&(!V||!bi(q,_e.overlapMode))){const Ie=se[le],ve=se[le+1],Se=se[le+2];if(j.push({key:_e,x1:Ie-Se,y1:ve-Se,x2:Ie+Se,y2:ve+Se}),V)return!0}}}return!1}_queryCellCircle(a,p,x,B,I,j,y,E){const{circle:P,seenUids:V,overlapMode:q}=y,K=this.boxCells[I];if(K!==null){const se=this.bboxes;for(const oe of K)if(!V.box[oe]){V.box[oe]=!0;const le=4*oe,_e=this.boxKeys[oe];if(this._circleAndRectCollide(P.x,P.y,P.radius,se[le+0],se[le+1],se[le+2],se[le+3])&&(!E||E(_e))&&!bi(q,_e.overlapMode))return j.push(!0),!0}}const ee=this.circleCells[I];if(ee!==null){const se=this.circles;for(const oe of ee)if(!V.circle[oe]){V.circle[oe]=!0;const le=3*oe,_e=this.circleKeys[oe];if(this._circlesCollide(se[le],se[le+1],se[le+2],P.x,P.y,P.radius)&&(!E||E(_e))&&!bi(q,_e.overlapMode))return j.push(!0),!0}}}_forEachCell(a,p,x,B,I,j,y,E){const P=this._convertToXCellCoord(a),V=this._convertToYCellCoord(p),q=this._convertToXCellCoord(x),K=this._convertToYCellCoord(B);for(let ee=P;ee<=q;ee++)for(let se=V;se<=K;se++)if(I.call(this,a,p,x,B,this.xCellCount*se+ee,j,y,E))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,p,x,B,I,j){const y=B-a,E=I-p,P=x+j;return P*P>y*y+E*E}_circleAndRectCollide(a,p,x,B,I,j,y){const E=(j-B)/2,P=Math.abs(a-(B+E));if(P>E+x)return!1;const V=(y-I)/2,q=Math.abs(p-(I+V));if(q>V+x)return!1;if(P<=E||q<=V)return!0;const K=P-E,ee=q-V;return K*K+ee*ee<=x*x}}function _r(w,a,p,x,B){const I=s.F();return a?(s.J(I,I,[1/B,1/B,1]),p||s.ad(I,I,x.angle)):s.K(I,x.labelPlaneMatrix,w),I}function Zr(w,a,p,x,B){if(a){const I=s.ae(w);return s.J(I,I,[B,B,1]),p||s.ad(I,I,-x.angle),I}return x.glCoordMatrix}function Qe(w,a,p){let x;p?(x=[w.x,w.y,p(w.x,w.y),1],s.af(x,x,a)):(x=[w.x,w.y,0,1],Tt(x,x,a));const B=x[3];return{point:new s.P(x[0]/B,x[1]/B),signedDistanceFromCamera:B}}function Be(w,a){return .5+w/a*.5}function ce(w,a){const p=w[0]/w[3],x=w[1]/w[3];return p>=-a[0]&&p<=a[0]&&x>=-a[1]&&x<=a[1]}function ie(w,a,p,x,B,I,j,y,E,P){const V=x?w.textSizeData:w.iconSizeData,q=s.ag(V,p.transform.zoom),K=[256/p.width*2+1,256/p.height*2+1],ee=x?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;ee.clear();const se=w.lineVertexArray,oe=x?w.text.placedSymbolArray:w.icon.placedSymbolArray,le=p.transform.width/p.transform.height;let _e=!1;for(let Ie=0;Ie<oe.length;Ie++){const ve=oe.get(Ie);if(ve.hidden||ve.writingMode===s.ah.vertical&&!_e){vt(ve.numGlyphs,ee);continue}let Se;if(_e=!1,P?(Se=[ve.anchorX,ve.anchorY,P(ve.anchorX,ve.anchorY),1],s.af(Se,Se,a)):(Se=[ve.anchorX,ve.anchorY,0,1],Tt(Se,Se,a)),!ce(Se,K)){vt(ve.numGlyphs,ee);continue}const et=Be(p.transform.cameraToCenterDistance,Se[3]),Oe=s.ai(V,q,ve),Re=j?Oe/et:Oe*et,Ve=new s.P(ve.anchorX,ve.anchorY),At=Qe(Ve,B,P).point,dt={projections:{},offsets:{}},ft=xe(ve,Re,!1,y,a,B,I,w.glyphOffsetArray,se,ee,At,Ve,dt,le,E,P);_e=ft.useVertical,(ft.notEnoughRoom||_e||ft.needsFlipping&&xe(ve,Re,!0,y,a,B,I,w.glyphOffsetArray,se,ee,At,Ve,dt,le,E,P).notEnoughRoom)&&vt(ve.numGlyphs,ee)}x?w.text.dynamicLayoutVertexBuffer.updateData(ee):w.icon.dynamicLayoutVertexBuffer.updateData(ee)}function ue(w,a,p,x,B,I,j,y,E,P,V,q,K){const ee=y.glyphStartIndex+y.numGlyphs,se=y.lineStartIndex,oe=y.lineStartIndex+y.lineLength,le=a.getoffsetX(y.glyphStartIndex),_e=a.getoffsetX(ee-1),Ie=Ge(w*le,p,x,B,I,j,y.segment,se,oe,E,P,V,q,K);if(!Ie)return null;const ve=Ge(w*_e,p,x,B,I,j,y.segment,se,oe,E,P,V,q,K);return ve?{first:Ie,last:ve}:null}function ge(w,a,p,x){return w===s.ah.horizontal&&Math.abs(p.y-a.y)>Math.abs(p.x-a.x)*x?{useVertical:!0}:(w===s.ah.vertical?a.y<p.y:a.x>p.x)?{needsFlipping:!0}:null}function xe(w,a,p,x,B,I,j,y,E,P,V,q,K,ee,se,oe){const le=a/24,_e=w.lineOffsetX*le,Ie=w.lineOffsetY*le;let ve;if(w.numGlyphs>1){const Se=w.glyphStartIndex+w.numGlyphs,et=w.lineStartIndex,Oe=w.lineStartIndex+w.lineLength,Re=ue(le,y,_e,Ie,p,V,q,w,E,I,K,se,oe);if(!Re)return{notEnoughRoom:!0};const Ve=Qe(Re.first.point,j,oe).point,At=Qe(Re.last.point,j,oe).point;if(x&&!p){const dt=ge(w.writingMode,Ve,At,ee);if(dt)return dt}ve=[Re.first];for(let dt=w.glyphStartIndex+1;dt<Se-1;dt++)ve.push(Ge(le*y.getoffsetX(dt),_e,Ie,p,V,q,w.segment,et,Oe,E,I,K,se,oe));ve.push(Re.last)}else{if(x&&!p){const et=Qe(q,B,oe).point,Oe=w.lineStartIndex+w.segment+1,Re=new s.P(E.getx(Oe),E.gety(Oe)),Ve=Qe(Re,B,oe),At=Ve.signedDistanceFromCamera>0?Ve.point:Ee(q,Re,et,1,B,oe),dt=ge(w.writingMode,et,At,ee);if(dt)return dt}const Se=Ge(le*y.getoffsetX(w.glyphStartIndex),_e,Ie,p,V,q,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,E,I,K,se,oe);if(!Se)return{notEnoughRoom:!0};ve=[Se]}for(const Se of ve)s.aj(P,Se.point,Se.angle);return{}}function Ee(w,a,p,x,B,I){const j=Qe(w.add(w.sub(a)._unit()),B,I).point,y=p.sub(j);return p.add(y._mult(x/y.mag()))}function we(w,a){const{projectionCache:p,lineVertexArray:x,labelPlaneMatrix:B,tileAnchorPoint:I,distanceFromAnchor:j,getElevation:y,previousVertex:E,direction:P,absOffsetX:V}=a;if(p.projections[w])return p.projections[w];const q=new s.P(x.getx(w),x.gety(w)),K=Qe(q,B,y);if(K.signedDistanceFromCamera>0)return p.projections[w]=K.point,K.point;const ee=w-P;return Ee(j===0?I:new s.P(x.getx(ee),x.gety(ee)),q,E,V-j+1,B,y)}function Fe(w,a,p){return w._unit()._perp()._mult(a*p)}function ze(w,a,p,x,B,I,j,y){const{projectionCache:E,direction:P}=y;if(E.offsets[w])return E.offsets[w];const V=p.add(a);if(w+P<x||w+P>=B)return E.offsets[w]=V,V;const q=we(w+P,y),K=Fe(q.sub(p),j,P),ee=p.add(K),se=q.add(K);return E.offsets[w]=s.ak(I,V,ee,se)||V,E.offsets[w]}function Ge(w,a,p,x,B,I,j,y,E,P,V,q,K,ee){const se=x?w-a:w+a;let oe=se>0?1:-1,le=0;x&&(oe*=-1,le=Math.PI),oe<0&&(le+=Math.PI);let _e,Ie,ve=oe>0?y+j:y+j+1,Se=B,et=B,Oe=0,Re=0;const Ve=Math.abs(se),At=[];let dt;for(;Oe+Re<=Ve;){if(ve+=oe,ve<y||ve>=E)return null;Oe+=Re,et=Se,Ie=_e;const It={projectionCache:q,lineVertexArray:P,labelPlaneMatrix:V,tileAnchorPoint:I,distanceFromAnchor:Oe,getElevation:ee,previousVertex:et,direction:oe,absOffsetX:Ve};if(Se=we(ve,It),p===0)At.push(et),dt=Se.sub(et);else{let jt;const Ht=Se.sub(et);jt=Ht.mag()===0?Fe(we(ve+oe,It).sub(Se),p,oe):Fe(Ht,p,oe),Ie||(Ie=et.add(jt)),_e=ze(ve,jt,Se,y,E,Ie,p,It),At.push(Ie),dt=_e.sub(Ie)}Re=dt.mag()}const ft=dt._mult((Ve-Oe)/Re)._add(Ie||et),Nt=le+Math.atan2(Se.y-et.y,Se.x-et.x);return At.push(ft),{point:ft,angle:K?Nt:0,path:At}}const st=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function vt(w,a){for(let p=0;p<w;p++){const x=a.length;a.resize(x+4),a.float32.set(st,3*x)}}function Tt(w,a,p){const x=a[0],B=a[1];return w[0]=p[0]*x+p[4]*B+p[12],w[1]=p[1]*x+p[5]*B+p[13],w[3]=p[3]*x+p[7]*B+p[15],w}const Kt=100;class ii{constructor(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new ei(a.width+200,a.height+200,25),x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new ei(a.width+200,a.height+200,25);this.transform=a,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Kt,this.screenBottomBoundary=a.height+Kt,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,p,x,B,I,j){const y=this.projectAndGetPerspectiveRatio(B,a.anchorPointX,a.anchorPointY,j),E=x*y.perspectiveRatio,P=a.x1*E+y.point.x,V=a.y1*E+y.point.y,q=a.x2*E+y.point.x,K=a.y2*E+y.point.y;return!this.isInsideGrid(P,V,q,K)||p!=="always"&&this.grid.hitTest(P,V,q,K,p,I)||y.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[P,V,q,K],offscreen:this.isOffscreen(P,V,q,K)}}placeCollisionCircles(a,p,x,B,I,j,y,E,P,V,q,K,ee,se){const oe=[],le=new s.P(p.anchorX,p.anchorY),_e=Qe(le,j,se),Ie=Be(this.transform.cameraToCenterDistance,_e.signedDistanceFromCamera),ve=(V?I/Ie:I*Ie)/s.ao,Se=Qe(le,y,se).point,et=ue(ve,B,p.lineOffsetX*ve,p.lineOffsetY*ve,!1,Se,le,p,x,y,{projections:{},offsets:{}},!1,se);let Oe=!1,Re=!1,Ve=!0;if(et){const At=.5*K*Ie+ee,dt=new s.P(-100,-100),ft=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Nt=new Zt,It=et.first,jt=et.last;let Ht=[];for(let Ti=It.path.length-1;Ti>=1;Ti--)Ht.push(It.path[Ti]);for(let Ti=1;Ti<jt.path.length;Ti++)Ht.push(jt.path[Ti]);const Mi=2.5*At;if(E){const Ti=Ht.map(ui=>Qe(ui,E,se));Ht=Ti.some(ui=>ui.signedDistanceFromCamera<=0)?[]:Ti.map(ui=>ui.point)}let mi=[];if(Ht.length>0){const Ti=Ht[0].clone(),ui=Ht[0].clone();for(let ar=1;ar<Ht.length;ar++)Ti.x=Math.min(Ti.x,Ht[ar].x),Ti.y=Math.min(Ti.y,Ht[ar].y),ui.x=Math.max(ui.x,Ht[ar].x),ui.y=Math.max(ui.y,Ht[ar].y);mi=Ti.x>=dt.x&&ui.x<=ft.x&&Ti.y>=dt.y&&ui.y<=ft.y?[Ht]:ui.x<dt.x||Ti.x>ft.x||ui.y<dt.y||Ti.y>ft.y?[]:s.al([Ht],dt.x,dt.y,ft.x,ft.y)}for(const Ti of mi){Nt.reset(Ti,.25*At);let ui=0;ui=Nt.length<=.5*At?1:Math.ceil(Nt.paddedLength/Mi)+1;for(let ar=0;ar<ui;ar++){const er=ar/Math.max(ui-1,1),ir=Nt.lerp(er),Dr=ir.x+Kt,Rr=ir.y+Kt;oe.push(Dr,Rr,At,0);const xr=Dr-At,$r=Rr-At,br=Dr+At,Wn=Rr+At;if(Ve=Ve&&this.isOffscreen(xr,$r,br,Wn),Re=Re||this.isInsideGrid(xr,$r,br,Wn),a!=="always"&&this.grid.hitTestCircle(Dr,Rr,At,a,q)&&(Oe=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Oe}}}}return{circles:!P&&Oe||!Re||Ie<this.perspectiveRatioCutoff?[]:oe,offscreen:Ve,collisionDetected:Oe}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let x=1/0,B=1/0,I=-1/0,j=-1/0;for(const V of a){const q=new s.P(V.x+Kt,V.y+Kt);x=Math.min(x,q.x),B=Math.min(B,q.y),I=Math.max(I,q.x),j=Math.max(j,q.y),p.push(q)}const y=this.grid.query(x,B,I,j).concat(this.ignoredGrid.query(x,B,I,j)),E={},P={};for(const V of y){const q=V.key;if(E[q.bucketInstanceId]===void 0&&(E[q.bucketInstanceId]={}),E[q.bucketInstanceId][q.featureIndex])continue;const K=[new s.P(V.x1,V.y1),new s.P(V.x2,V.y1),new s.P(V.x2,V.y2),new s.P(V.x1,V.y2)];s.am(p,K)&&(E[q.bucketInstanceId][q.featureIndex]=!0,P[q.bucketInstanceId]===void 0&&(P[q.bucketInstanceId]=[]),P[q.bucketInstanceId].push(q.featureIndex))}return P}insertCollisionBox(a,p,x,B,I,j){(x?this.ignoredGrid:this.grid).insert({bucketInstanceId:B,featureIndex:I,collisionGroupID:j,overlapMode:p},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,p,x,B,I,j){const y=x?this.ignoredGrid:this.grid,E={bucketInstanceId:B,featureIndex:I,collisionGroupID:j,overlapMode:p};for(let P=0;P<a.length;P+=4)y.insertCircle(E,a[P],a[P+1],a[P+2])}projectAndGetPerspectiveRatio(a,p,x,B){let I;return B?(I=[p,x,B(p,x),1],s.af(I,I,a)):(I=[p,x,0,1],Tt(I,I,a)),{point:new s.P((I[0]/I[3]+1)/2*this.transform.width+Kt,(-I[1]/I[3]+1)/2*this.transform.height+Kt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/I[3]*.5}}isOffscreen(a,p,x,B){return x<Kt||a>=this.screenRightBoundary||B<Kt||p>this.screenBottomBoundary}isInsideGrid(a,p,x,B){return x>=0&&a<this.gridRightBoundary&&B>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const a=s.an([]);return s.H(a,a,[-100,-100,0]),a}}function Gt(w,a,p){return a*(s.W/(w.tileSize*Math.pow(2,p-w.tileID.overscaledZ)))}class Ai{constructor(a,p,x,B){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?p:-p))):B&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class Bi{constructor(a,p,x,B,I){this.text=new Ai(a?a.text:null,p,x,I),this.icon=new Ai(a?a.icon:null,p,B,I)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Hi{constructor(a,p,x){this.text=a,this.icon=p,this.skipFade=x}}class Ci{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class Ni{constructor(a,p,x,B,I){this.bucketInstanceId=a,this.featureIndex=p,this.sourceLayerIndex=x,this.bucketIndex=B,this.tileID=I}}class ot{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const p=++this.maxGroupID;this.collisionGroups[a]={ID:p,predicate:x=>x.collisionGroupID===p}}return this.collisionGroups[a]}}function ri(w,a,p,x,B){const{horizontalAlign:I,verticalAlign:j}=s.at(w);return new s.P(-(I-.5)*a+x[0]*B,-(j-.5)*p+x[1]*B)}function Vt(w,a,p,x,B,I){const{x1:j,x2:y,y1:E,y2:P,anchorPointX:V,anchorPointY:q}=w,K=new s.P(a,p);return x&&K._rotate(B?I:-I),{x1:j+K.x,y1:E+K.y,x2:y+K.x,y2:P+K.y,anchorPointX:V,anchorPointY:q}}class Vi{constructor(a,p,x,B,I){this.transform=a.clone(),this.terrain=p,this.collisionIndex=new ii(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=x,this.retainedQueryData={},this.collisionGroups=new ot(B),this.collisionCircleArrays={},this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,p,x,B){const I=x.getBucket(p),j=x.latestFeatureIndex;if(!I||!j||p.id!==I.layerIds[0])return;const y=x.collisionBoxArray,E=I.layers[0].layout,P=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),V=x.tileSize/s.W,q=this.transform.calculatePosMatrix(x.tileID.toUnwrapped()),K=E.get("text-pitch-alignment")==="map",ee=E.get("text-rotation-alignment")==="map",se=Gt(x,1,this.transform.zoom),oe=_r(q,K,ee,this.transform,se);let le=null;if(K){const Ie=Zr(q,K,ee,this.transform,se);le=s.K([],this.transform.labelPlaneMatrix,Ie)}this.retainedQueryData[I.bucketInstanceId]=new Ni(I.bucketInstanceId,j,I.sourceLayerIndex,I.index,x.tileID);const _e={bucket:I,layout:E,posMatrix:q,textLabelPlaneMatrix:oe,labelToScreenMatrix:le,scale:P,textPixelRatio:V,holdingForFade:x.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:s.ag(I.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(I.sourceID)};if(B)for(const Ie of I.sortKeyRanges){const{sortKey:ve,symbolInstanceStart:Se,symbolInstanceEnd:et}=Ie;a.push({sortKey:ve,symbolInstanceStart:Se,symbolInstanceEnd:et,parameters:_e})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(a,p,x,B,I,j,y,E,P,V,q,K,ee,se,oe,le){const _e=s.ap[a.textAnchor],Ie=[a.textOffset0,a.textOffset1],ve=ri(_e,x,B,Ie,I),Se=this.collisionIndex.placeCollisionBox(Vt(p,ve.x,ve.y,j,y,this.transform.angle),q,E,P,V.predicate,le);if((!oe||this.collisionIndex.placeCollisionBox(Vt(oe,ve.x,ve.y,j,y,this.transform.angle),q,E,P,V.predicate,le).box.length!==0)&&Se.box.length>0){let et;if(this.prevPlacement&&this.prevPlacement.variableOffsets[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID].text&&(et=this.prevPlacement.variableOffsets[K.crossTileID].anchor),K.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[K.crossTileID]={textOffset:Ie,width:x,height:B,anchor:_e,textBoxScale:I,prevAnchor:et},this.markUsedJustification(ee,_e,K,se),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,se,K),this.placedOrientations[K.crossTileID]=se),{shift:ve,placedGlyphBoxes:Se}}}placeLayerBucketPart(a,p,x){const{bucket:B,layout:I,posMatrix:j,textLabelPlaneMatrix:y,labelToScreenMatrix:E,textPixelRatio:P,holdingForFade:V,collisionBoxArray:q,partiallyEvaluatedTextSize:K,collisionGroup:ee}=a.parameters,se=I.get("text-optional"),oe=I.get("icon-optional"),le=s.aq(I,"text-overlap","text-allow-overlap"),_e=le==="always",Ie=s.aq(I,"icon-overlap","icon-allow-overlap"),ve=Ie==="always",Se=I.get("text-rotation-alignment")==="map",et=I.get("text-pitch-alignment")==="map",Oe=I.get("icon-text-fit")!=="none",Re=I.get("symbol-z-order")==="viewport-y",Ve=_e&&(ve||!B.hasIconData()||oe),At=ve&&(_e||!B.hasTextData()||se);!B.collisionArrays&&q&&B.deserializeCollisionBoxes(q);const dt=this.retainedQueryData[B.bucketInstanceId].tileID,ft=this.terrain?(It,jt)=>this.terrain.getElevation(dt,It,jt):null,Nt=(It,jt)=>{var Ht,Mi;if(p[It.crossTileID])return;if(V)return void(this.placements[It.crossTileID]=new Hi(!1,!1,!1));let mi=!1,Ti=!1,ui=!0,ar=null,er={box:null,offscreen:null},ir={box:null,offscreen:null},Dr=null,Rr=null,xr=null,$r=0,br=0,Wn=0;jt.textFeatureIndex?$r=jt.textFeatureIndex:It.useRuntimeCollisionCircles&&($r=It.featureIndex),jt.verticalTextFeatureIndex&&(br=jt.verticalTextFeatureIndex);const Kr=jt.textBox;if(Kr){const ur=an=>{let ts=s.ah.horizontal;if(B.allowVerticalPlacement&&!an&&this.prevPlacement){const Bs=this.prevPlacement.placedOrientations[It.crossTileID];Bs&&(this.placedOrientations[It.crossTileID]=Bs,ts=Bs,this.markUsedOrientation(B,ts,It))}return ts},Nr=(an,ts)=>{if(B.allowVerticalPlacement&&It.numVerticalGlyphVertices>0&&jt.verticalTextBox){for(const Bs of B.writingModes)if(Bs===s.ah.vertical?(er=ts(),ir=er):er=an(),er&&er.box&&er.box.length)break}else er=an()},on=It.textAnchorOffsetStartIndex,es=It.textAnchorOffsetEndIndex;if(es===on){const an=(ts,Bs)=>{const mr=this.collisionIndex.placeCollisionBox(ts,le,P,j,ee.predicate,ft);return mr&&mr.box&&mr.box.length&&(this.markUsedOrientation(B,Bs,It),this.placedOrientations[It.crossTileID]=Bs),mr};Nr(()=>an(Kr,s.ah.horizontal),()=>{const ts=jt.verticalTextBox;return B.allowVerticalPlacement&&It.numVerticalGlyphVertices>0&&ts?an(ts,s.ah.vertical):{box:null,offscreen:null}}),ur(er&&er.box&&er.box.length)}else{let an=s.ap[(Mi=(Ht=this.prevPlacement)===null||Ht===void 0?void 0:Ht.variableOffsets[It.crossTileID])===null||Mi===void 0?void 0:Mi.anchor];const ts=(mr,bn,ea)=>{const Os=mr.x2-mr.x1,io=mr.y2-mr.y1,yl=It.textBoxScale,_o=Oe&&Ie==="never"?bn:null;let rc={box:[],offscreen:!1},Ra=le==="never"?1:2,Dn="never";an&&Ra++;for(let xc=0;xc<Ra;xc++){for(let gu=on;gu<es;gu++){const _l=B.textAnchorOffsets.get(gu);if(an&&_l.textAnchor!==an)continue;const rl=this.attemptAnchorPlacement(_l,mr,Os,io,yl,Se,et,P,j,ee,Dn,It,B,ea,_o,ft);if(rl&&(rc=rl.placedGlyphBoxes,rc&&rc.box&&rc.box.length))return mi=!0,ar=rl.shift,rc}an?an=null:Dn=le}return rc};Nr(()=>ts(Kr,jt.iconBox,s.ah.horizontal),()=>{const mr=jt.verticalTextBox;return B.allowVerticalPlacement&&!(er&&er.box&&er.box.length)&&It.numVerticalGlyphVertices>0&&mr?ts(mr,jt.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),er&&(mi=er.box,ui=er.offscreen);const Bs=ur(er&&er.box);if(!mi&&this.prevPlacement){const mr=this.prevPlacement.variableOffsets[It.crossTileID];mr&&(this.variableOffsets[It.crossTileID]=mr,this.markUsedJustification(B,mr.anchor,It,Bs))}}}if(Dr=er,mi=Dr&&Dr.box&&Dr.box.length>0,ui=Dr&&Dr.offscreen,It.useRuntimeCollisionCircles){const ur=B.text.placedSymbolArray.get(It.centerJustifiedTextSymbolIndex),Nr=s.ai(B.textSizeData,K,ur),on=I.get("text-padding");Rr=this.collisionIndex.placeCollisionCircles(le,ur,B.lineVertexArray,B.glyphOffsetArray,Nr,j,y,E,x,et,ee.predicate,It.collisionCircleDiameter,on,ft),Rr.circles.length&&Rr.collisionDetected&&!x&&s.w("Collisions detected, but collision boxes are not shown"),mi=_e||Rr.circles.length>0&&!Rr.collisionDetected,ui=ui&&Rr.offscreen}if(jt.iconFeatureIndex&&(Wn=jt.iconFeatureIndex),jt.iconBox){const ur=Nr=>{const on=Oe&&ar?Vt(Nr,ar.x,ar.y,Se,et,this.transform.angle):Nr;return this.collisionIndex.placeCollisionBox(on,Ie,P,j,ee.predicate,ft)};ir&&ir.box&&ir.box.length&&jt.verticalIconBox?(xr=ur(jt.verticalIconBox),Ti=xr.box.length>0):(xr=ur(jt.iconBox),Ti=xr.box.length>0),ui=ui&&xr.offscreen}const kr=se||It.numHorizontalGlyphVertices===0&&It.numVerticalGlyphVertices===0,Wr=oe||It.numIconVertices===0;if(kr||Wr?Wr?kr||(Ti=Ti&&mi):mi=Ti&&mi:Ti=mi=Ti&&mi,mi&&Dr&&Dr.box&&this.collisionIndex.insertCollisionBox(Dr.box,le,I.get("text-ignore-placement"),B.bucketInstanceId,ir&&ir.box&&br?br:$r,ee.ID),Ti&&xr&&this.collisionIndex.insertCollisionBox(xr.box,Ie,I.get("icon-ignore-placement"),B.bucketInstanceId,Wn,ee.ID),Rr&&(mi&&this.collisionIndex.insertCollisionCircles(Rr.circles,le,I.get("text-ignore-placement"),B.bucketInstanceId,$r,ee.ID),x)){const ur=B.bucketInstanceId;let Nr=this.collisionCircleArrays[ur];Nr===void 0&&(Nr=this.collisionCircleArrays[ur]=new Ci);for(let on=0;on<Rr.circles.length;on+=4)Nr.circles.push(Rr.circles[on+0]),Nr.circles.push(Rr.circles[on+1]),Nr.circles.push(Rr.circles[on+2]),Nr.circles.push(Rr.collisionDetected?1:0)}if(It.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(B.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[It.crossTileID]=new Hi(mi||Ve,Ti||At,ui||B.justReloaded),p[It.crossTileID]=!0};if(Re){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const It=B.getSortedSymbolIndexes(this.transform.angle);for(let jt=It.length-1;jt>=0;--jt){const Ht=It[jt];Nt(B.symbolInstances.get(Ht),B.collisionArrays[Ht])}}else for(let It=a.symbolInstanceStart;It<a.symbolInstanceEnd;It++)Nt(B.symbolInstances.get(It),B.collisionArrays[It]);if(x&&B.bucketInstanceId in this.collisionCircleArrays){const It=this.collisionCircleArrays[B.bucketInstanceId];s.ar(It.invProjMatrix,j),It.viewportMatrix=this.collisionIndex.getViewportMatrix()}B.justReloaded=!1}markUsedJustification(a,p,x,B){let I;I=B===s.ah.vertical?x.verticalPlacedTextSymbolIndex:{left:x.leftJustifiedTextSymbolIndex,center:x.centerJustifiedTextSymbolIndex,right:x.rightJustifiedTextSymbolIndex}[s.as(p)];const j=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex,x.verticalPlacedTextSymbolIndex];for(const y of j)y>=0&&(a.text.placedSymbolArray.get(y).crossTileID=I>=0&&y!==I?0:x.crossTileID)}markUsedOrientation(a,p,x){const B=p===s.ah.horizontal||p===s.ah.horizontalOnly?p:0,I=p===s.ah.vertical?p:0,j=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex];for(const y of j)a.text.placedSymbolArray.get(y).placedOrientation=B;x.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(x.verticalPlacedTextSymbolIndex).placedOrientation=I)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let x=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const B=p?p.symbolFadeChange(a):1,I=p?p.opacities:{},j=p?p.variableOffsets:{},y=p?p.placedOrientations:{};for(const E in this.placements){const P=this.placements[E],V=I[E];V?(this.opacities[E]=new Bi(V,B,P.text,P.icon),x=x||P.text!==V.text.placed||P.icon!==V.icon.placed):(this.opacities[E]=new Bi(null,B,P.text,P.icon,P.skipFade),x=x||P.text||P.icon)}for(const E in I){const P=I[E];if(!this.opacities[E]){const V=new Bi(P,B,!1,!1);V.isHidden()||(this.opacities[E]=V,x=x||P.text.placed||P.icon.placed)}}for(const E in j)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=j[E]);for(const E in y)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=y[E]);if(p&&p.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");x?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:a)}updateLayerOpacities(a,p){const x={};for(const B of p){const I=B.getBucket(a);I&&B.latestFeatureIndex&&a.id===I.layerIds[0]&&this.updateBucketOpacities(I,x,B.collisionBoxArray)}}updateBucketOpacities(a,p,x){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const B=a.layers[0],I=B.layout,j=new Bi(null,0,!1,!1,!0),y=I.get("text-allow-overlap"),E=I.get("icon-allow-overlap"),P=B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"),V=I.get("text-rotation-alignment")==="map",q=I.get("text-pitch-alignment")==="map",K=I.get("icon-text-fit")!=="none",ee=new Bi(null,0,y&&(E||!a.hasIconData()||I.get("icon-optional")),E&&(y||!a.hasTextData()||I.get("text-optional")),!0);!a.collisionArrays&&x&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(x);const se=(oe,le,_e)=>{for(let Ie=0;Ie<le/4;Ie++)oe.opacityVertexArray.emplaceBack(_e);oe.hasVisibleVertices=oe.hasVisibleVertices||_e!==Or};for(let oe=0;oe<a.symbolInstances.length;oe++){const le=a.symbolInstances.get(oe),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:Ie,crossTileID:ve}=le;let Se=this.opacities[ve];p[ve]?Se=j:Se||(Se=ee,this.opacities[ve]=Se),p[ve]=!0;const et=le.numIconVertices>0,Oe=this.placedOrientations[le.crossTileID],Re=Oe===s.ah.vertical,Ve=Oe===s.ah.horizontal||Oe===s.ah.horizontalOnly;if(_e>0||Ie>0){const At=Gs(Se.text);se(a.text,_e,Re?Or:At),se(a.text,Ie,Ve?Or:At);const dt=Se.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(It=>{It>=0&&(a.text.placedSymbolArray.get(It).hidden=dt||Re?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=dt||Ve?1:0);const ft=this.variableOffsets[le.crossTileID];ft&&this.markUsedJustification(a,ft.anchor,le,Oe);const Nt=this.placedOrientations[le.crossTileID];Nt&&(this.markUsedJustification(a,"left",le,Nt),this.markUsedOrientation(a,Nt,le))}if(et){const At=Gs(Se.icon),dt=!(K&&le.verticalPlacedIconSymbolIndex&&Re);le.placedIconSymbolIndex>=0&&(se(a.icon,le.numIconVertices,dt?At:Or),a.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=Se.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&(se(a.icon,le.numVerticalIconVertices,dt?Or:At),a.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=Se.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const At=a.collisionArrays[oe];if(At){let dt=new s.P(0,0);if(At.textBox||At.verticalTextBox){let Nt=!0;if(P){const It=this.variableOffsets[ve];It?(dt=ri(It.anchor,It.width,It.height,It.textOffset,It.textBoxScale),V&&dt._rotate(q?this.transform.angle:-this.transform.angle)):Nt=!1}At.textBox&&lr(a.textCollisionBox.collisionVertexArray,Se.text.placed,!Nt||Re,dt.x,dt.y),At.verticalTextBox&&lr(a.textCollisionBox.collisionVertexArray,Se.text.placed,!Nt||Ve,dt.x,dt.y)}const ft=!!(!Ve&&At.verticalIconBox);At.iconBox&&lr(a.iconCollisionBox.collisionVertexArray,Se.icon.placed,ft,K?dt.x:0,K?dt.y:0),At.verticalIconBox&&lr(a.iconCollisionBox.collisionVertexArray,Se.icon.placed,!ft,K?dt.x:0,K?dt.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);if(a.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=oe.invProjMatrix,a.placementViewportMatrix=oe.viewportMatrix,a.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,p){const x=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*x>a}setStale(){this.stale=!0}}function lr(w,a,p,x,B){w.emplaceBack(a?1:0,p?1:0,x||0,B||0),w.emplaceBack(a?1:0,p?1:0,x||0,B||0),w.emplaceBack(a?1:0,p?1:0,x||0,B||0),w.emplaceBack(a?1:0,p?1:0,x||0,B||0)}const un=Math.pow(2,25),wn=Math.pow(2,24),gr=Math.pow(2,17),mn=Math.pow(2,16),yn=Math.pow(2,9),dr=Math.pow(2,8),Hn=Math.pow(2,1);function Gs(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const a=w.placed?1:0,p=Math.floor(127*w.opacity);return p*un+a*wn+p*gr+a*mn+p*yn+a*dr+p*Hn+a}const Or=0;class Bn{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,p,x,B,I){const j=this._bucketParts;for(;this._currentTileIndex<a.length;)if(p.getBucketParts(j,B,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,I())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort((y,E)=>y.sortKey-E.sortKey));this._currentPartIndex<j.length;)if(p.placeLayerBucketPart(j[this._currentPartIndex],this._seenCrossTileIDs,x),this._currentPartIndex++,I())return!0;return!1}}class qa{constructor(a,p,x,B,I,j,y,E){this.placement=new Vi(a,p,j,y,E),this._currentPlacementIndex=x.length-1,this._forceFullPlacement=B,this._showCollisionBoxes=I,this._done=!1}isDone(){return this._done}continuePlacement(a,p,x){const B=F.now(),I=()=>!this._forceFullPlacement&&F.now()-B>2;for(;this._currentPlacementIndex>=0;){const j=p[a[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=y)&&(!j.maxzoom||j.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new Bn(j)),this._inProgressLayer.continuePlacement(x[j.source],this.placement,this._showCollisionBoxes,j,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Un=512/s.W/2;class Zi{constructor(a,p,x){this.tileID=a,this.bucketInstanceId=x,this._symbolsByKey={};const B=new Map;for(let I=0;I<p.length;I++){const j=p.get(I),y=j.key,E=B.get(y);E?E.push(j):B.set(y,[j])}for(const[I,j]of B){const y={positions:j.map(E=>({x:Math.floor(E.anchorX*Un),y:Math.floor(E.anchorY*Un)})),crossTileIDs:j.map(E=>E.crossTileID)};if(y.positions.length>128){const E=new s.au(y.positions.length,16,Uint16Array);for(const{x:P,y:V}of y.positions)E.add(P,V);E.finish(),delete y.positions,y.index=E}this._symbolsByKey[I]=y}}getScaledCoordinates(a,p){const{x,y:B,z:I}=this.tileID.canonical,{x:j,y,z:E}=p.canonical,P=Un/Math.pow(2,E-I),V=(y*s.W+a.anchorY)*P,q=B*s.W*Un;return{x:Math.floor((j*s.W+a.anchorX)*P-x*s.W*Un),y:Math.floor(V-q)}}findMatches(a,p,x){const B=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let I=0;I<a.length;I++){const j=a.get(I);if(j.crossTileID)continue;const y=this._symbolsByKey[j.key];if(!y)continue;const E=this.getScaledCoordinates(j,p);if(y.index){const P=y.index.range(E.x-B,E.y-B,E.x+B,E.y+B).sort();for(const V of P){const q=y.crossTileIDs[V];if(!x[q]){x[q]=!0,j.crossTileID=q;break}}}else if(y.positions)for(let P=0;P<y.positions.length;P++){const V=y.positions[P],q=y.crossTileIDs[P];if(Math.abs(V.x-E.x)<=B&&Math.abs(V.y-E.y)<=B&&!x[q]){x[q]=!0,j.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(a=>{let{crossTileIDs:p}=a;return p})}}class ao{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ms{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const p=Math.round((a-this.lng)/360);if(p!==0)for(const x in this.indexes){const B=this.indexes[x],I={};for(const j in B){const y=B[j];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+p),I[y.tileID.key]=y}this.indexes[x]=I}this.lng=a}addBucket(a,p,x){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let I=0;I<p.symbolInstances.length;I++)p.symbolInstances.get(I).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const B=this.usedCrossTileIDs[a.overscaledZ];for(const I in this.indexes){const j=this.indexes[I];if(Number(I)>a.overscaledZ)for(const y in j){const E=j[y];E.tileID.isChildOf(a)&&E.findMatches(p.symbolInstances,a,B)}else{const y=j[a.scaledTo(Number(I)).key];y&&y.findMatches(p.symbolInstances,a,B)}}for(let I=0;I<p.symbolInstances.length;I++){const j=p.symbolInstances.get(I);j.crossTileID||(j.crossTileID=x.generate(),B[j.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Zi(a,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(a,p){for(const x of p.getCrossTileIDsLists())for(const B of x)delete this.usedCrossTileIDs[a][B]}removeStaleBuckets(a){let p=!1;for(const x in this.indexes){const B=this.indexes[x];for(const I in B)a[B[I].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,B[I]),delete B[I],p=!0)}return p}}class vr{constructor(){this.layerIndexes={},this.crossTileIDs=new ao,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,p,x){let B=this.layerIndexes[a.id];B===void 0&&(B=this.layerIndexes[a.id]=new Ms);let I=!1;const j={};B.handleWrapJump(x);for(const y of p){const E=y.getBucket(a);E&&a.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),B.addBucket(y.tileID,E,this.crossTileIDs)&&(I=!0),j[E.bucketInstanceId]=!0)}return B.removeStaleBuckets(j)&&(I=!0),I}pruneUnusedLayers(a){const p={};a.forEach(x=>{p[x]=!0});for(const x in this.layerIndexes)p[x]||delete this.layerIndexes[x]}}const Tr=(w,a)=>s.t(w,a&&a.filter(p=>p.identifier!=="source.canvas")),rs=s.av();class Gr extends s.E{constructor(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const x in this.sourceCaches){const B=this.sourceCaches[x].getSource().type;B!=="vector"&&B!=="geojson"||this.sourceCaches[x].reload()}},this.map=a,this.dispatcher=new Mt(Dt(),a._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(x,B)=>this.getGlyphs(x,B)),this.dispatcher.registerMessageHandler("getImages",(x,B)=>this.getImages(x,B)),this.imageManager=new Ze,this.imageManager.setEventedParent(this),this.glyphManager=new bt(a._requestManager,p.localIdeographFontFamily),this.lineAtlas=new Le(256,512),this.crossTileSymbolIndex=new vr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.ax()),Wi().on(pr,this._rtlPluginLoaded),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const B=this.sourceCaches[x.sourceId];if(!B)return;const I=B.getSource();if(I&&I.vectorLayerIds)for(const j in this._layers){const y=this._layers[j];y.source===I.id&&this._validateLayer(y)}})}loadURL(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),p.validate=typeof p.validate!="boolean"||p.validate;const B=this.map._requestManager.transformRequest(a,Te.Style);this._loadStyleRequest=new AbortController,s.h(B,this._loadStyleRequest).then(I=>{this._loadStyleRequest=null,this._load(I.data,p,x)}).catch(I=>{this._loadStyleRequest=null,I&&this.fire(new s.j(I))})}loadJSON(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,p.validate=p.validate!==!1,this._load(a,p,x)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(rs,{validate:!1})}_load(a,p,x){var B;const I=p.transformStyle?p.transformStyle(x,a):a;if(!p.validate||!Tr(this,s.x(I))){this._loaded=!0,this.stylesheet=I;for(const j in I.sources)this.addSource(j,I.sources[j],{validate:!1});I.sprite?this._loadSprite(I.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(I.glyphs),this._createLayers(),this.light=new Xt(this.stylesheet.light),this.map.setTerrain((B=this.stylesheet.terrain)!==null&&B!==void 0?B:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const a=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",a),this._order=a.map(p=>p.id),this._layers={},this._serializedLayers=null;for(const p of a){const x=s.az(p);x.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=x}}_loadSprite(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,B;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(I,j,y,E){return s._(this,void 0,void 0,function*(){const P=ke(I),V=y>1?"@2x":"",q={},K={};for(const{id:ee,url:se}of P){const oe=j.transformRequest(j.normalizeSpriteURL(se,V,".json"),Te.SpriteJSON);q[ee]=s.h(oe,E);const le=j.transformRequest(j.normalizeSpriteURL(se,V,".png"),Te.SpriteImage);K[ee]=be.getImage(le,E)}return yield Promise.all([...Object.values(q),...Object.values(K)]),function(ee,se){return s._(this,void 0,void 0,function*(){const oe={};for(const le in ee){oe[le]={};const _e=F.getImageCanvasContext((yield se[le]).data),Ie=(yield ee[le]).data;for(const ve in Ie){const{width:Se,height:et,x:Oe,y:Re,sdf:Ve,pixelRatio:At,stretchX:dt,stretchY:ft,content:Nt}=Ie[ve];oe[le][ve]={data:null,pixelRatio:At,sdf:Ve,stretchX:dt,stretchY:ft,content:Nt,spriteData:{width:Se,height:et,x:Oe,y:Re,context:_e}}}}return oe})}(q,K)})}(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(I=>{if(this._spriteRequest=null,I)for(const j in I){this._spritesImagesIds[j]=[];const y=this._spritesImagesIds[j]?this._spritesImagesIds[j].filter(E=>!(E in I)):[];for(const E of y)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in I[j]){const P=j==="default"?E:`${j}:${E}`;this._spritesImagesIds[j].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,I[j][E],!1):this.imageManager.addImage(P,I[j][E]),p&&(this._changedImages[P]=!0)}}}).catch(I=>{this._spriteRequest=null,B=I,this.fire(new s.j(B))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),p&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),x&&x(B)})}_unloadSprite(){for(const a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(a){const p=this.sourceCaches[a.source];if(!p)return;const x=a.sourceLayer;if(!x)return;const B=p.getSource();(B.type==="geojson"||B.vectorLayerIds&&B.vectorLayerIds.indexOf(x)===-1)&&this.fire(new s.j(new Error(`Source layer "${x}" does not exist on source "${B.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a){const p=this._serializedAllLayers();if(!a||a.length===0)return Object.values(p);const x=[];for(const B of a)p[B]&&x.push(p[B]);return x}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};const p=Object.keys(this._layers);for(const x of p){const B=this._layers[x];B.type!=="custom"&&(a[x]=B.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const p=this._changed;if(this._changed){const B=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);(B.length||I.length)&&this._updateWorkerLayers(B,I);for(const j in this._updatedSources){const y=this._updatedSources[j];if(y==="reload")this._reloadSource(j);else{if(y!=="clear")throw new Error(`Invalid action ${y}`);this._clearSource(j)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const j in this._updatedPaintProps)this._layers[j].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const x={};for(const B in this.sourceCaches){const I=this.sourceCaches[B];x[B]=I.used,I.used=!1}for(const B of this._order){const I=this._layers[B];I.recalculate(a,this._availableImages),!I.isHidden(a.zoom)&&I.source&&(this.sourceCaches[I.source].used=!0)}for(const B in x){const I=this.sourceCaches[B];x[B]!==I.used&&I.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:B}))}this.light.recalculate(a),this.z=a.zoom,p&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(a),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var x;this._checkLoaded();const B=this.serialize();if(a=p.transformStyle?p.transformStyle(B,a):a,((x=p.validate)===null||x===void 0||x)&&Tr(this,s.x(a)))return!1;(a=s.aA(a)).layers=s.ay(a.layers);const I=s.aB(B,a),j=this._getOperationsToPerform(I);if(j.unimplemented.length>0)throw new Error(`Unimplemented: ${j.unimplemented.join(", ")}.`);if(j.operations.length===0)return!1;for(const y of j.operations)y();return this.stylesheet=a,this._serializedLayers=null,!0}_getOperationsToPerform(a){const p=[],x=[];for(const B of a)switch(B.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":p.push(()=>this.addLayer.apply(this,B.args));break;case"removeLayer":p.push(()=>this.removeLayer.apply(this,B.args));break;case"setPaintProperty":p.push(()=>this.setPaintProperty.apply(this,B.args));break;case"setLayoutProperty":p.push(()=>this.setLayoutProperty.apply(this,B.args));break;case"setFilter":p.push(()=>this.setFilter.apply(this,B.args));break;case"addSource":p.push(()=>this.addSource.apply(this,B.args));break;case"removeSource":p.push(()=>this.removeSource.apply(this,B.args));break;case"setLayerZoomRange":p.push(()=>this.setLayerZoomRange.apply(this,B.args));break;case"setLight":p.push(()=>this.setLight.apply(this,B.args));break;case"setGeoJSONSourceData":p.push(()=>this.setGeoJSONSourceData.apply(this,B.args));break;case"setGlyphs":p.push(()=>this.setGlyphs.apply(this,B.args));break;case"setSprite":p.push(()=>this.setSprite.apply(this,B.args));break;case"setTerrain":p.push(()=>this.map.setTerrain.apply(this,B.args));break;case"setTransition":p.push(()=>{});break;default:x.push(B.command)}return{operations:p,unimplemented:x}}addImage(a,p){if(this.getImage(a))return this.fire(new s.j(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,p),this._afterImageUpdated(a)}updateImage(a,p){this.imageManager.updateImage(a,p)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new s.j(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(s.x.source,`sources.${a}`,p,null,x))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const B=this.sourceCaches[a]=new Qt(a,p,this.dispatcher);B.style=this,B.setEventedParent(this,()=>({isSourceLoaded:B.loaded(),source:B.serialize(),sourceId:a})),B.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===a)return this.fire(new s.j(new Error(`Source "${a}" cannot be removed while layer "${x}" is using it.`)));const p=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],p.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),p.setEventedParent(null),p.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,p){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const x=this.sourceCaches[a].getSource();if(x.type!=="geojson")throw new Error(`geojsonSource.type is ${x.type}, which is !== 'geojson`);x.setData(p),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=a.id;if(this.getLayer(B))return void this.fire(new s.j(new Error(`Layer "${B}" already exists on this map.`)));let I;if(a.type==="custom"){if(Tr(this,s.aC(a)))return;I=s.az(a)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(B,a.source),a=s.aA(a),a=s.e(a,{source:B})),this._validate(s.x.layer,`layers.${B}`,a,{arrayIndex:-1},x))return;I=s.az(a),this._validateLayer(I),I.setEventedParent(this,{layer:{id:B}})}const j=p?this._order.indexOf(p):this._order.length;if(p&&j===-1)this.fire(new s.j(new Error(`Cannot add layer "${B}" before non-existing layer "${p}".`)));else{if(this._order.splice(j,0,B),this._layerOrderChanged=!0,this._layers[B]=I,this._removedLayers[B]&&I.source&&I.type!=="custom"){const y=this._removedLayers[B];delete this._removedLayers[B],y.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",this.sourceCaches[I.source].pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map)}}moveLayer(a,p){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new s.j(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===p)return;const x=this._order.indexOf(a);this._order.splice(x,1);const B=p?this._order.indexOf(p):this._order.length;p&&B===-1?this.fire(new s.j(new Error(`Cannot move layer "${a}" before non-existing layer "${p}".`))):(this._order.splice(B,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const p=this._layers[a];if(!p)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${a}".`)));p.setEventedParent(null);const x=this._order.indexOf(a);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=p,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],p.onRemove&&p.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,p,x){this._checkLoaded();const B=this.getLayer(a);B?B.minzoom===p&&B.maxzoom===x||(p!=null&&(B.minzoom=p),x!=null&&(B.maxzoom=x),this._updateLayer(B)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=this.getLayer(a);if(B){if(!s.aD(B.filter,p))return p==null?(B.filter=void 0,void this._updateLayer(B)):void(this._validate(s.x.filter,`layers.${B.id}.filter`,p,null,x)||(B.filter=s.aA(p),this._updateLayer(B)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return s.aA(this.getLayer(a).filter)}setLayoutProperty(a,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const I=this.getLayer(a);I?s.aD(I.getLayoutProperty(p),x)||(I.setLayoutProperty(p,x,B),this._updateLayer(I)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,p){const x=this.getLayer(a);if(x)return x.getLayoutProperty(p);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const I=this.getLayer(a);I?s.aD(I.getPaintProperty(p),x)||(I.setPaintProperty(p,x,B)&&this._updateLayer(I),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,p){return this.getLayer(a).getPaintProperty(p)}setFeatureState(a,p){this._checkLoaded();const x=a.source,B=a.sourceLayer,I=this.sourceCaches[x];if(I===void 0)return void this.fire(new s.j(new Error(`The source '${x}' does not exist in the map's style.`)));const j=I.getSource().type;j==="geojson"&&B?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):j!=="vector"||B?(a.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),I.setFeatureState(B,a.id,p)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,p){this._checkLoaded();const x=a.source,B=this.sourceCaches[x];if(B===void 0)return void this.fire(new s.j(new Error(`The source '${x}' does not exist in the map's style.`)));const I=B.getSource().type,j=I==="vector"?a.sourceLayer:void 0;I!=="vector"||j?p&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):B.removeFeatureState(j,a.id,p):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const p=a.source,x=a.sourceLayer,B=this.sourceCaches[p];if(B!==void 0)return B.getSource().type!=="vector"||x?(a.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),B.getFeatureState(x,a.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const a=s.aE(this.sourceCaches,I=>I.serialize()),p=this._serializeByIds(this._order),x=this.map.getTerrain()||void 0,B=this.stylesheet;return s.aF({version:B.version,name:B.name,metadata:B.metadata,light:B.light,center:B.center,zoom:B.zoom,bearing:B.bearing,pitch:B.pitch,sprite:B.sprite,glyphs:B.glyphs,transition:B.transition,sources:a,layers:p,terrain:x},I=>I!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){const p=j=>this._layers[j].type==="fill-extrusion",x={},B=[];for(let j=this._order.length-1;j>=0;j--){const y=this._order[j];if(p(y)){x[y]=j;for(const E of a){const P=E[y];if(P)for(const V of P)B.push(V)}}}B.sort((j,y)=>y.intersectionZ-j.intersectionZ);const I=[];for(let j=this._order.length-1;j>=0;j--){const y=this._order[j];if(p(y))for(let E=B.length-1;E>=0;E--){const P=B[E].feature;if(x[P.layer.id]<j)break;I.push(P),B.pop()}else for(const E of a){const P=E[y];if(P)for(const V of P)I.push(V.feature)}}return I}queryRenderedFeatures(a,p,x){p&&p.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",p.filter,null,p);const B={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const y of p.layers){const E=this._layers[y];if(!E)return this.fire(new s.j(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];B[E.source]=!0}}const I=[];p.availableImages=this._availableImages;const j=this._serializedAllLayers();for(const y in this.sourceCaches)p.layers&&!B[y]||I.push(_i(this.sourceCaches[y],this._layers,j,a,p,x));return this.placement&&I.push(function(y,E,P,V,q,K,ee){const se={},oe=K.queryRenderedSymbols(V),le=[];for(const _e of Object.keys(oe).map(Number))le.push(ee[_e]);le.sort(vi);for(const _e of le){const Ie=_e.featureIndex.lookupSymbolFeatures(oe[_e.bucketInstanceId],E,_e.bucketIndex,_e.sourceLayerIndex,q.filter,q.layers,q.availableImages,y);for(const ve in Ie){const Se=se[ve]=se[ve]||[],et=Ie[ve];et.sort((Oe,Re)=>{const Ve=_e.featureSortOrder;if(Ve){const At=Ve.indexOf(Oe.featureIndex);return Ve.indexOf(Re.featureIndex)-At}return Re.featureIndex-Oe.featureIndex});for(const Oe of et)Se.push(Oe)}}for(const _e in se)se[_e].forEach(Ie=>{const ve=Ie.feature,Se=P[y[_e].source].getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=Se});return se}(this._layers,j,this.sourceCaches,a,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(I)}querySourceFeatures(a,p){p&&p.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",p.filter,null,p);const x=this.sourceCaches[a];return x?function(B,I){const j=B.getRenderableIds().map(P=>B.getTileByID(P)),y=[],E={};for(let P=0;P<j.length;P++){const V=j[P],q=V.tileID.canonical.key;E[q]||(E[q]=!0,V.querySourceFeatures(y,I))}return y}(x,p):[]}getLight(){return this.light.getLight()}setLight(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const x=this.light.getLight();let B=!1;for(const j in a)if(!s.aD(a[j],x[j])){B=!0;break}if(!B)return;const I={now:F.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,p),this.light.updateTransitions(I)}_validate(a,p,x,B){let I=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!I||I.validate!==!1)&&Tr(this,a.call(s.x,s.e({key:p,style:this.serialize(),value:x,styleSpec:s.v},B)))}_remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Wi().off(pr,this._rtlPluginLoaded);for(const p in this._layers)this._layers[p].setEventedParent(null);for(const p in this.sourceCaches){const x=this.sourceCaches[p];x.setEventedParent(null),x.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),a&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(a)}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const p in this.sourceCaches)this.sourceCaches[p].update(a,this.map.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,p,x,B){let I=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,j=!1,y=!1;const E={};for(const P of this._order){const V=this._layers[P];if(V.type!=="symbol")continue;if(!E[V.source]){const K=this.sourceCaches[V.source];E[V.source]=K.getRenderableIds(!0).map(ee=>K.getTileByID(ee)).sort((ee,se)=>se.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(se.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(V,E[V.source],a.center.lng);j=j||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((I=I||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(F.now(),a.zoom))&&(this.pauseablePlacement=new qa(a,this.map.terrain,this._order,I,p,x,B,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(F.now()),y=!0),j&&this.pauseablePlacement.placement.setStale()),y||j)for(const P of this._order){const V=this._layers[P];V.type==="symbol"&&this.placement.updateLayerOpacities(V,E[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(F.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,p){return s._(this,void 0,void 0,function*(){const x=yield this.imageManager.getImages(p.icons);this._updateTilesForChangedImages();const B=this.sourceCaches[p.source];return B&&B.setDependencies(p.tileID.key,p.type,p.icons),x})}getGlyphs(a,p){return s._(this,void 0,void 0,function*(){const x=yield this.glyphManager.getGlyphs(p.stacks),B=this.sourceCaches[p.source];return B&&B.setDependencies(p.tileID.key,p.type,[""]),x})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),a&&this._validate(s.x.glyphs,"glyphs",a,null,p)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}addSprite(a,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const I=[{id:a,url:p}],j=[...ke(this.stylesheet.sprite),...I];this._validate(s.x.sprite,"sprite",j,null,x)||(this.stylesheet.sprite=j,this._loadSprite(I,!0,B))}removeSprite(a){this._checkLoaded();const p=ke(this.stylesheet.sprite);if(p.find(x=>x.id===a)){if(this._spritesImagesIds[a])for(const x of this._spritesImagesIds[a])this.imageManager.removeImage(x),this._changedImages[x]=!0;p.splice(p.findIndex(x=>x.id===a),1),this.stylesheet.sprite=p.length>0?p:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return ke(this.stylesheet.sprite)}setSprite(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),a&&this._validate(s.x.sprite,"sprite",a,null,p)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,x):(this._unloadSprite(),x&&x(null)))}}var Tn=s.X([{name:"a_pos",type:"Int16",components:2}]),Cn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const po={prelude:Lr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Lr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Lr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Lr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Lr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Lr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Lr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Lr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Lr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Lr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Lr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Lr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Lr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Lr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Lr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Lr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Lr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Lr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Lr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Lr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Lr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Lr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Lr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Lr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Lr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Lr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Lr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Cn),terrainDepth:Lr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Cn),terrainCoords:Lr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Cn)};function Lr(w,a){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=a.match(/attribute ([\w]+) ([\w]+)/g),B=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),j=I?I.concat(B):B,y={};return{fragmentSource:w=w.replace(p,(E,P,V,q,K)=>(y[K]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${K}
varying ${V} ${q} ${K};
#else
uniform ${V} ${q} u_${K};
#endif
`:`
#ifdef HAS_UNIFORM_u_${K}
    ${V} ${q} ${K} = u_${K};
#endif
`)),vertexSource:a=a.replace(p,(E,P,V,q,K)=>{const ee=q==="float"?"vec2":"vec4",se=K.match(/color/)?"color":ee;return y[K]?P==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${V} ${ee} a_${K};
varying ${V} ${q} ${K};
#else
uniform ${V} ${q} u_${K};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${V} ${q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${se}(a_${K}, u_${K}_t);
#else
    ${V} ${q} ${K} = u_${K};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${V} ${ee} a_${K};
#else
uniform ${V} ${q} u_${K};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${V} ${q} ${K} = a_${K};
#else
    ${V} ${q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${V} ${q} ${K} = unpack_mix_${se}(a_${K}, u_${K}_t);
#else
    ${V} ${q} ${K} = u_${K};
#endif
`}),staticAttributes:x,staticUniforms:j}}class $a{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,p,x,B,I,j,y,E,P){this.context=a;let V=this.boundPaintVertexBuffers.length!==B.length;for(let q=0;!V&&q<B.length;q++)this.boundPaintVertexBuffers[q]!==B[q]&&(V=!0);!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==x||V||this.boundIndexBuffer!==I||this.boundVertexOffset!==j||this.boundDynamicVertexBuffer!==y||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==P?this.freshBind(p,x,B,I,j,y,E,P):(a.bindVertexArray.set(this.vao),y&&y.bind(),I&&I.dynamicDraw&&I.bind(),E&&E.bind(),P&&P.bind())}freshBind(a,p,x,B,I,j,y,E){const P=a.numAttributes,V=this.context,q=V.gl;this.vao&&this.destroy(),this.vao=V.createVertexArray(),V.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=B,this.boundVertexOffset=I,this.boundDynamicVertexBuffer=j,this.boundDynamicVertexBuffer2=y,this.boundDynamicVertexBuffer3=E,p.enableAttributes(q,a);for(const K of x)K.enableAttributes(q,a);j&&j.enableAttributes(q,a),y&&y.enableAttributes(q,a),E&&E.enableAttributes(q,a),p.bind(),p.setVertexAttribPointers(q,a,I);for(const K of x)K.bind(),K.setVertexAttribPointers(q,a,I);j&&(j.bind(),j.setVertexAttribPointers(q,a,I)),B&&B.bind(),y&&(y.bind(),y.setVertexAttribPointers(q,a,I)),E&&(E.bind(),E.setVertexAttribPointers(q,a,I)),V.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Zs(w){const a=[];for(let p=0;p<w.length;p++){if(w[p]===null)continue;const x=w[p].split(" ");a.push(x.pop())}return a}class Ka{constructor(a,p,x,B,I,j){const y=a.gl;this.program=y.createProgram();const E=Zs(p.staticAttributes),P=x?x.getBinderAttributes():[],V=E.concat(P),q=po.prelude.staticUniforms?Zs(po.prelude.staticUniforms):[],K=p.staticUniforms?Zs(p.staticUniforms):[],ee=x?x.getBinderUniforms():[],se=q.concat(K).concat(ee),oe=[];for(const Oe of se)oe.indexOf(Oe)<0&&oe.push(Oe);const le=x?x.defines():[];I&&le.push("#define OVERDRAW_INSPECTOR;"),j&&le.push("#define TERRAIN3D;");const _e=le.concat(po.prelude.fragmentSource,p.fragmentSource).join(`
`),Ie=le.concat(po.prelude.vertexSource,p.vertexSource).join(`
`),ve=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(ve,_e),y.compileShader(ve),!y.getShaderParameter(ve,y.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${y.getShaderInfoLog(ve)}`);y.attachShader(this.program,ve);const Se=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(Se,Ie),y.compileShader(Se),!y.getShaderParameter(Se,y.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${y.getShaderInfoLog(Se)}`);y.attachShader(this.program,Se),this.attributes={};const et={};this.numAttributes=V.length;for(let Oe=0;Oe<this.numAttributes;Oe++)V[Oe]&&(y.bindAttribLocation(this.program,Oe,V[Oe]),this.attributes[V[Oe]]=Oe);if(y.linkProgram(this.program),!y.getProgramParameter(this.program,y.LINK_STATUS))throw new Error(`Program failed to link: ${y.getProgramInfoLog(this.program)}`);y.deleteShader(Se),y.deleteShader(ve);for(let Oe=0;Oe<oe.length;Oe++){const Re=oe[Oe];if(Re&&!et[Re]){const Ve=y.getUniformLocation(this.program,Re);Ve&&(et[Re]=Ve)}}this.fixedUniforms=B(a,et),this.terrainUniforms=((Oe,Re)=>({u_depth:new s.aG(Oe,Re.u_depth),u_terrain:new s.aG(Oe,Re.u_terrain),u_terrain_dim:new s.aH(Oe,Re.u_terrain_dim),u_terrain_matrix:new s.aI(Oe,Re.u_terrain_matrix),u_terrain_unpack:new s.aJ(Oe,Re.u_terrain_unpack),u_terrain_exaggeration:new s.aH(Oe,Re.u_terrain_exaggeration)}))(a,et),this.binderUniforms=x?x.getUniforms(a,et):[]}draw(a,p,x,B,I,j,y,E,P,V,q,K,ee,se,oe,le,_e,Ie){const ve=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(x),a.setStencilMode(B),a.setColorMode(I),a.setCullFace(j),E){a.activeTexture.set(ve.TEXTURE2),ve.bindTexture(ve.TEXTURE_2D,E.depthTexture),a.activeTexture.set(ve.TEXTURE3),ve.bindTexture(ve.TEXTURE_2D,E.texture);for(const et in this.terrainUniforms)this.terrainUniforms[et].set(E[et])}for(const et in this.fixedUniforms)this.fixedUniforms[et].set(y[et]);oe&&oe.setUniforms(a,this.binderUniforms,ee,{zoom:se});let Se=0;switch(p){case ve.LINES:Se=2;break;case ve.TRIANGLES:Se=3;break;case ve.LINE_STRIP:Se=1}for(const et of K.get()){const Oe=et.vaos||(et.vaos={});(Oe[P]||(Oe[P]=new $a)).bind(a,this,V,oe?oe.getPaintVertexBuffers():[],q,et.vertexOffset,le,_e,Ie),ve.drawElements(p,et.primitiveLength*Se,ve.UNSIGNED_SHORT,et.primitiveOffset*Se*2)}}}function He(w,a,p){const x=1/Gt(p,1,a.transform.tileZoom),B=Math.pow(2,p.tileID.overscaledZ),I=p.tileSize*Math.pow(2,a.transform.tileZoom)/B,j=I*(p.tileID.canonical.x+p.tileID.wrap*B),y=I*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[x,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[j>>16,y>>16],u_pixel_coord_lower:[65535&j,65535&y]}}const Je=(w,a,p,x)=>{const B=a.style.light,I=B.properties.get("position"),j=[I.x,I.y,I.z],y=function(){var P=new s.A(9);return s.A!=Float32Array&&(P[1]=0,P[2]=0,P[3]=0,P[5]=0,P[6]=0,P[7]=0),P[0]=1,P[4]=1,P[8]=1,P}();B.properties.get("anchor")==="viewport"&&function(P,V){var q=Math.sin(V),K=Math.cos(V);P[0]=K,P[1]=q,P[2]=0,P[3]=-q,P[4]=K,P[5]=0,P[6]=0,P[7]=0,P[8]=1}(y,-a.transform.angle),function(P,V,q){var K=V[0],ee=V[1],se=V[2];P[0]=K*q[0]+ee*q[3]+se*q[6],P[1]=K*q[1]+ee*q[4]+se*q[7],P[2]=K*q[2]+ee*q[5]+se*q[8]}(j,j,y);const E=B.properties.get("color");return{u_matrix:w,u_lightpos:j,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+p,u_opacity:x}},gt=(w,a,p,x,B,I,j)=>s.e(Je(w,a,p,x),He(I,a,j),{u_height_factor:-Math.pow(2,B.overscaledZ)/j.tileSize/8}),Ot=w=>({u_matrix:w}),di=(w,a,p,x)=>s.e(Ot(w),He(p,a,x)),ji=(w,a)=>({u_matrix:w,u_world:a}),Br=(w,a,p,x,B)=>s.e(di(w,a,p,x),{u_world:B}),In=(w,a,p,x)=>{const B=w.transform;let I,j;if(x.paint.get("circle-pitch-alignment")==="map"){const y=Gt(p,1,B.zoom);I=!0,j=[y,y]}else I=!1,j=B.pixelsToGLUnits;return{u_camera_to_center_distance:B.cameraToCenterDistance,u_scale_with_map:+(x.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(a.posMatrix,p,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_pitch_with_map:+I,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:j}},Gn=(w,a,p)=>{const x=Gt(p,1,a.zoom),B=Math.pow(2,a.zoom-p.tileID.overscaledZ),I=p.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:x,u_extrude_scale:[a.pixelsToGLUnits[0]/(x*B),a.pixelsToGLUnits[1]/(x*B)],u_overscale_factor:I}},ns=function(w,a){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:w,u_color:a,u_overlay:0,u_overlay_scale:p}},_n=w=>({u_matrix:w}),uu=(w,a,p,x)=>({u_matrix:w,u_extrude_scale:Gt(a,1,p),u_intensity:x});function Nl(w,a){const p=Math.pow(2,a.canonical.z),x=a.canonical.y;return[new s.Y(0,x/p).toLngLat().lat,new s.Y(0,(x+1)/p).toLngLat().lat]}const Cr=(w,a,p,x)=>{const B=w.transform;return{u_matrix:Ea(w,a,p,x),u_ratio:1/Gt(a,1,B.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]]}},Wa=(w,a,p,x,B)=>s.e(Cr(w,a,p,B),{u_image:0,u_image_height:x}),zl=(w,a,p,x,B)=>{const I=w.transform,j=To(a,I);return{u_matrix:Ea(w,a,p,B),u_texsize:a.imageAtlasTexture.size,u_ratio:1/Gt(a,1,I.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[j,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]]}},ss=(w,a,p,x,B,I)=>{const j=w.lineAtlas,y=To(a,w.transform),E=p.layout.get("line-cap")==="round",P=j.getDash(x.from,E),V=j.getDash(x.to,E),q=P.width*B.fromScale,K=V.width*B.toScale;return s.e(Cr(w,a,p,I),{u_patternscale_a:[y/q,-P.height/2],u_patternscale_b:[y/K,-V.height/2],u_sdfgamma:j.width/(256*Math.min(q,K)*w.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:V.y,u_mix:B.t})};function To(w,a){return 1/Gt(w,1,a.tileZoom)}function Ea(w,a,p,x){return w.translatePosMatrix(x?x.posMatrix:a.tileID.posMatrix,a,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}const gs=(w,a,p,x,B)=>{return{u_matrix:w,u_tl_parent:a,u_scale_parent:p,u_buffer_scale:1,u_fade_t:x.mix,u_opacity:x.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:(j=B.paint.get("raster-saturation"),j>0?1-1/(1.001-j):-j),u_contrast_factor:(I=B.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Sa(B.paint.get("raster-hue-rotate"))};var I,j};function Sa(w){w*=Math.PI/180;const a=Math.sin(w),p=Math.cos(w);return[(2*p+1)/3,(-Math.sqrt(3)*a-p+1)/3,(Math.sqrt(3)*a-p+1)/3]}const Za=(w,a,p,x,B,I,j,y,E,P)=>{const V=B.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:V.width/V.height,u_fade_change:B.options.fadeDuration?B.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:j,u_coord_matrix:y,u_is_text:+E,u_pitch_with_map:+x,u_texsize:P,u_texture:0}},ca=(w,a,p,x,B,I,j,y,E,P,V)=>{const q=B.transform;return s.e(Za(w,a,p,x,B,I,j,y,E,P),{u_gamma_scale:x?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:B.pixelRatio,u_is_halo:+V})},Uc=(w,a,p,x,B,I,j,y,E,P)=>s.e(ca(w,a,p,x,B,I,j,y,!0,E,!0),{u_texsize_icon:P,u_texture_icon:1}),Xa=(w,a,p)=>({u_matrix:w,u_opacity:a,u_color:p}),go=(w,a,p,x,B,I)=>s.e(function(j,y,E,P){const V=E.imageManager.getPattern(j.from.toString()),q=E.imageManager.getPattern(j.to.toString()),{width:K,height:ee}=E.imageManager.getPixelSize(),se=Math.pow(2,P.tileID.overscaledZ),oe=P.tileSize*Math.pow(2,E.transform.tileZoom)/se,le=oe*(P.tileID.canonical.x+P.tileID.wrap*se),_e=oe*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[K,ee],u_mix:y.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/Gt(P,1,E.transform.tileZoom),u_pixel_coord_upper:[le>>16,_e>>16],u_pixel_coord_lower:[65535&le,65535&_e]}}(x,I,p,B),{u_matrix:w,u_opacity:a}),Pr={fillExtrusion:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_lightpos:new s.aK(w,a.u_lightpos),u_lightintensity:new s.aH(w,a.u_lightintensity),u_lightcolor:new s.aK(w,a.u_lightcolor),u_vertical_gradient:new s.aH(w,a.u_vertical_gradient),u_opacity:new s.aH(w,a.u_opacity)}),fillExtrusionPattern:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_lightpos:new s.aK(w,a.u_lightpos),u_lightintensity:new s.aH(w,a.u_lightintensity),u_lightcolor:new s.aK(w,a.u_lightcolor),u_vertical_gradient:new s.aH(w,a.u_vertical_gradient),u_height_factor:new s.aH(w,a.u_height_factor),u_image:new s.aG(w,a.u_image),u_texsize:new s.aL(w,a.u_texsize),u_pixel_coord_upper:new s.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,a.u_pixel_coord_lower),u_scale:new s.aK(w,a.u_scale),u_fade:new s.aH(w,a.u_fade),u_opacity:new s.aH(w,a.u_opacity)}),fill:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix)}),fillPattern:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_image:new s.aG(w,a.u_image),u_texsize:new s.aL(w,a.u_texsize),u_pixel_coord_upper:new s.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,a.u_pixel_coord_lower),u_scale:new s.aK(w,a.u_scale),u_fade:new s.aH(w,a.u_fade)}),fillOutline:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_world:new s.aL(w,a.u_world)}),fillOutlinePattern:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_world:new s.aL(w,a.u_world),u_image:new s.aG(w,a.u_image),u_texsize:new s.aL(w,a.u_texsize),u_pixel_coord_upper:new s.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,a.u_pixel_coord_lower),u_scale:new s.aK(w,a.u_scale),u_fade:new s.aH(w,a.u_fade)}),circle:(w,a)=>({u_camera_to_center_distance:new s.aH(w,a.u_camera_to_center_distance),u_scale_with_map:new s.aG(w,a.u_scale_with_map),u_pitch_with_map:new s.aG(w,a.u_pitch_with_map),u_extrude_scale:new s.aL(w,a.u_extrude_scale),u_device_pixel_ratio:new s.aH(w,a.u_device_pixel_ratio),u_matrix:new s.aI(w,a.u_matrix)}),collisionBox:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_camera_to_center_distance:new s.aH(w,a.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(w,a.u_pixels_to_tile_units),u_extrude_scale:new s.aL(w,a.u_extrude_scale),u_overscale_factor:new s.aH(w,a.u_overscale_factor)}),collisionCircle:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_inv_matrix:new s.aI(w,a.u_inv_matrix),u_camera_to_center_distance:new s.aH(w,a.u_camera_to_center_distance),u_viewport_size:new s.aL(w,a.u_viewport_size)}),debug:(w,a)=>({u_color:new s.aM(w,a.u_color),u_matrix:new s.aI(w,a.u_matrix),u_overlay:new s.aG(w,a.u_overlay),u_overlay_scale:new s.aH(w,a.u_overlay_scale)}),clippingMask:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix)}),heatmap:(w,a)=>({u_extrude_scale:new s.aH(w,a.u_extrude_scale),u_intensity:new s.aH(w,a.u_intensity),u_matrix:new s.aI(w,a.u_matrix)}),heatmapTexture:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_world:new s.aL(w,a.u_world),u_image:new s.aG(w,a.u_image),u_color_ramp:new s.aG(w,a.u_color_ramp),u_opacity:new s.aH(w,a.u_opacity)}),hillshade:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_image:new s.aG(w,a.u_image),u_latrange:new s.aL(w,a.u_latrange),u_light:new s.aL(w,a.u_light),u_shadow:new s.aM(w,a.u_shadow),u_highlight:new s.aM(w,a.u_highlight),u_accent:new s.aM(w,a.u_accent)}),hillshadePrepare:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_image:new s.aG(w,a.u_image),u_dimension:new s.aL(w,a.u_dimension),u_zoom:new s.aH(w,a.u_zoom),u_unpack:new s.aJ(w,a.u_unpack)}),line:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_ratio:new s.aH(w,a.u_ratio),u_device_pixel_ratio:new s.aH(w,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,a.u_units_to_pixels)}),lineGradient:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_ratio:new s.aH(w,a.u_ratio),u_device_pixel_ratio:new s.aH(w,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,a.u_units_to_pixels),u_image:new s.aG(w,a.u_image),u_image_height:new s.aH(w,a.u_image_height)}),linePattern:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_texsize:new s.aL(w,a.u_texsize),u_ratio:new s.aH(w,a.u_ratio),u_device_pixel_ratio:new s.aH(w,a.u_device_pixel_ratio),u_image:new s.aG(w,a.u_image),u_units_to_pixels:new s.aL(w,a.u_units_to_pixels),u_scale:new s.aK(w,a.u_scale),u_fade:new s.aH(w,a.u_fade)}),lineSDF:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_ratio:new s.aH(w,a.u_ratio),u_device_pixel_ratio:new s.aH(w,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,a.u_units_to_pixels),u_patternscale_a:new s.aL(w,a.u_patternscale_a),u_patternscale_b:new s.aL(w,a.u_patternscale_b),u_sdfgamma:new s.aH(w,a.u_sdfgamma),u_image:new s.aG(w,a.u_image),u_tex_y_a:new s.aH(w,a.u_tex_y_a),u_tex_y_b:new s.aH(w,a.u_tex_y_b),u_mix:new s.aH(w,a.u_mix)}),raster:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_tl_parent:new s.aL(w,a.u_tl_parent),u_scale_parent:new s.aH(w,a.u_scale_parent),u_buffer_scale:new s.aH(w,a.u_buffer_scale),u_fade_t:new s.aH(w,a.u_fade_t),u_opacity:new s.aH(w,a.u_opacity),u_image0:new s.aG(w,a.u_image0),u_image1:new s.aG(w,a.u_image1),u_brightness_low:new s.aH(w,a.u_brightness_low),u_brightness_high:new s.aH(w,a.u_brightness_high),u_saturation_factor:new s.aH(w,a.u_saturation_factor),u_contrast_factor:new s.aH(w,a.u_contrast_factor),u_spin_weights:new s.aK(w,a.u_spin_weights)}),symbolIcon:(w,a)=>({u_is_size_zoom_constant:new s.aG(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,a.u_is_size_feature_constant),u_size_t:new s.aH(w,a.u_size_t),u_size:new s.aH(w,a.u_size),u_camera_to_center_distance:new s.aH(w,a.u_camera_to_center_distance),u_pitch:new s.aH(w,a.u_pitch),u_rotate_symbol:new s.aG(w,a.u_rotate_symbol),u_aspect_ratio:new s.aH(w,a.u_aspect_ratio),u_fade_change:new s.aH(w,a.u_fade_change),u_matrix:new s.aI(w,a.u_matrix),u_label_plane_matrix:new s.aI(w,a.u_label_plane_matrix),u_coord_matrix:new s.aI(w,a.u_coord_matrix),u_is_text:new s.aG(w,a.u_is_text),u_pitch_with_map:new s.aG(w,a.u_pitch_with_map),u_texsize:new s.aL(w,a.u_texsize),u_texture:new s.aG(w,a.u_texture)}),symbolSDF:(w,a)=>({u_is_size_zoom_constant:new s.aG(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,a.u_is_size_feature_constant),u_size_t:new s.aH(w,a.u_size_t),u_size:new s.aH(w,a.u_size),u_camera_to_center_distance:new s.aH(w,a.u_camera_to_center_distance),u_pitch:new s.aH(w,a.u_pitch),u_rotate_symbol:new s.aG(w,a.u_rotate_symbol),u_aspect_ratio:new s.aH(w,a.u_aspect_ratio),u_fade_change:new s.aH(w,a.u_fade_change),u_matrix:new s.aI(w,a.u_matrix),u_label_plane_matrix:new s.aI(w,a.u_label_plane_matrix),u_coord_matrix:new s.aI(w,a.u_coord_matrix),u_is_text:new s.aG(w,a.u_is_text),u_pitch_with_map:new s.aG(w,a.u_pitch_with_map),u_texsize:new s.aL(w,a.u_texsize),u_texture:new s.aG(w,a.u_texture),u_gamma_scale:new s.aH(w,a.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,a.u_device_pixel_ratio),u_is_halo:new s.aG(w,a.u_is_halo)}),symbolTextAndIcon:(w,a)=>({u_is_size_zoom_constant:new s.aG(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,a.u_is_size_feature_constant),u_size_t:new s.aH(w,a.u_size_t),u_size:new s.aH(w,a.u_size),u_camera_to_center_distance:new s.aH(w,a.u_camera_to_center_distance),u_pitch:new s.aH(w,a.u_pitch),u_rotate_symbol:new s.aG(w,a.u_rotate_symbol),u_aspect_ratio:new s.aH(w,a.u_aspect_ratio),u_fade_change:new s.aH(w,a.u_fade_change),u_matrix:new s.aI(w,a.u_matrix),u_label_plane_matrix:new s.aI(w,a.u_label_plane_matrix),u_coord_matrix:new s.aI(w,a.u_coord_matrix),u_is_text:new s.aG(w,a.u_is_text),u_pitch_with_map:new s.aG(w,a.u_pitch_with_map),u_texsize:new s.aL(w,a.u_texsize),u_texsize_icon:new s.aL(w,a.u_texsize_icon),u_texture:new s.aG(w,a.u_texture),u_texture_icon:new s.aG(w,a.u_texture_icon),u_gamma_scale:new s.aH(w,a.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,a.u_device_pixel_ratio),u_is_halo:new s.aG(w,a.u_is_halo)}),background:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_opacity:new s.aH(w,a.u_opacity),u_color:new s.aM(w,a.u_color)}),backgroundPattern:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_opacity:new s.aH(w,a.u_opacity),u_image:new s.aG(w,a.u_image),u_pattern_tl_a:new s.aL(w,a.u_pattern_tl_a),u_pattern_br_a:new s.aL(w,a.u_pattern_br_a),u_pattern_tl_b:new s.aL(w,a.u_pattern_tl_b),u_pattern_br_b:new s.aL(w,a.u_pattern_br_b),u_texsize:new s.aL(w,a.u_texsize),u_mix:new s.aH(w,a.u_mix),u_pattern_size_a:new s.aL(w,a.u_pattern_size_a),u_pattern_size_b:new s.aL(w,a.u_pattern_size_b),u_scale_a:new s.aH(w,a.u_scale_a),u_scale_b:new s.aH(w,a.u_scale_b),u_pixel_coord_upper:new s.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,a.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(w,a.u_tile_units_to_pixels)}),terrain:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_texture:new s.aG(w,a.u_texture),u_ele_delta:new s.aH(w,a.u_ele_delta)}),terrainDepth:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_ele_delta:new s.aH(w,a.u_ele_delta)}),terrainCoords:(w,a)=>({u_matrix:new s.aI(w,a.u_matrix),u_texture:new s.aG(w,a.u_texture),u_terrain_coords_id:new s.aH(w,a.u_terrain_coords_id),u_ele_delta:new s.aH(w,a.u_ele_delta)})};class ua{constructor(a,p,x){this.context=a;const B=a.gl;this.buffer=B.createBuffer(),this.dynamicDraw=!!x,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),B.bufferData(B.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?B.DYNAMIC_DRAW:B.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const p=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const us={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class En{constructor(a,p,x,B){this.length=p.length,this.attributes=x,this.itemSize=p.bytesPerElement,this.dynamicDraw=B,this.context=a;const I=a.gl;this.buffer=I.createBuffer(),a.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,p){for(let x=0;x<this.attributes.length;x++){const B=p.attributes[this.attributes[x].name];B!==void 0&&a.enableVertexAttribArray(B)}}setVertexAttribPointers(a,p,x){for(let B=0;B<this.attributes.length;B++){const I=this.attributes[B],j=p.attributes[I.name];j!==void 0&&a.vertexAttribPointer(j,I.components,a[us[I.type]],!1,this.itemSize,I.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hs=new WeakMap;function ha(w){var a;if(hs.has(w))return hs.get(w);{const p=(a=w.getParameter(w.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return hs.set(w,p),p}}class jr{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class cl extends jr{getDefault(){return s.aO.transparent}set(a){const p=this.current;(a.r!==p.r||a.g!==p.g||a.b!==p.b||a.a!==p.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Ql extends jr{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Io extends jr{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Ko extends jr{getDefault(){return[!0,!0,!0,!0]}set(a){const p=this.current;(a[0]!==p[0]||a[1]!==p[1]||a[2]!==p[2]||a[3]!==p[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class mc extends jr{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Wo extends jr{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class mo extends jr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const p=this.current;(a.func!==p.func||a.ref!==p.ref||a.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class yc extends jr{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const p=this.current;(a[0]!==p[0]||a[1]!==p[1]||a[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Zo extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;a?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=a,this.dirty=!1}}class Vl extends jr{getDefault(){return[0,1]}set(a){const p=this.current;(a[0]!==p[0]||a[1]!==p[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Nc extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;a?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=a,this.dirty=!1}}class bh extends jr{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class hu extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;a?p.enable(p.BLEND):p.disable(p.BLEND),this.current=a,this.dirty=!1}}class Au extends jr{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const p=this.current;(a[0]!==p[0]||a[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Ou extends jr{getDefault(){return s.aO.transparent}set(a){const p=this.current;(a.r!==p.r||a.g!==p.g||a.b!==p.b||a.a!==p.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Hl extends jr{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Ja extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;a?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=a,this.dirty=!1}}class Ya extends jr{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Gl extends jr{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class el extends jr{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class Aa extends jr{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class ul extends jr{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const p=this.current;(a[0]!==p[0]||a[1]!==p[1]||a[2]!==p[2]||a[3]!==p[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class jl extends jr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class lo extends jr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class da extends jr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ne extends jr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Pe extends jr{getDefault(){return null}set(a){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ct extends jr{getDefault(){return null}set(a){var p;if(a===this.current&&!this.dirty)return;const x=this.gl;ha(x)?x.bindVertexArray(a):(p=x.getExtension("OES_vertex_array_object"))===null||p===void 0||p.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class _t extends jr{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class xt extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Lt extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class pi extends jr{constructor(a,p){super(a),this.context=a,this.parent=p}getDefault(){return null}}class si extends pi{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class nr extends pi{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class qi extends pi{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Yi{constructor(a,p,x,B,I){this.context=a,this.width=p,this.height=x;const j=a.gl,y=this.framebuffer=j.createFramebuffer();if(this.colorAttachment=new si(a,y),B)this.depthAttachment=I?new qi(a,y):new nr(a,y);else if(I)throw new Error("Stencil cannot be set without depth");if(j.checkFramebufferStatus(j.FRAMEBUFFER)!==j.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const a=this.context.gl,p=this.colorAttachment.get();if(p&&a.deleteTexture(p),this.depthAttachment){const x=this.depthAttachment.get();x&&a.deleteRenderbuffer(x)}a.deleteFramebuffer(this.framebuffer)}}class cr{constructor(a,p,x){this.blendFunction=a,this.blendColor=p,this.mask=x}}cr.Replace=[1,0],cr.disabled=new cr(cr.Replace,s.aO.transparent,[!1,!1,!1,!1]),cr.unblended=new cr(cr.Replace,s.aO.transparent,[!0,!0,!0,!0]),cr.alphaBlended=new cr([1,771],s.aO.transparent,[!0,!0,!0,!0]);class jn{constructor(a){var p,x;if(this.gl=a,this.clearColor=new cl(this),this.clearDepth=new Ql(this),this.clearStencil=new Io(this),this.colorMask=new Ko(this),this.depthMask=new mc(this),this.stencilMask=new Wo(this),this.stencilFunc=new mo(this),this.stencilOp=new yc(this),this.stencilTest=new Zo(this),this.depthRange=new Vl(this),this.depthTest=new Nc(this),this.depthFunc=new bh(this),this.blend=new hu(this),this.blendFunc=new Au(this),this.blendColor=new Ou(this),this.blendEquation=new Hl(this),this.cullFace=new Ja(this),this.cullFaceSide=new Ya(this),this.frontFace=new Gl(this),this.program=new el(this),this.activeTexture=new Aa(this),this.viewport=new ul(this),this.bindFramebuffer=new jl(this),this.bindRenderbuffer=new lo(this),this.bindTexture=new da(this),this.bindVertexBuffer=new ne(this),this.bindElementBuffer=new Pe(this),this.bindVertexArray=new ct(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new xt(this),this.pixelStoreUnpackFlipY=new Lt(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),ha(a)){this.HALF_FLOAT=a.HALF_FLOAT;const B=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(p=a.RGBA16F)!==null&&p!==void 0?p:B==null?void 0:B.RGBA16F_EXT,this.RGB16F=(x=a.RGB16F)!==null&&x!==void 0?x:B==null?void 0:B.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");const B=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=B==null?void 0:B.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,p){return new ua(this,a,p)}createVertexBuffer(a,p,x){return new En(this,a,p,x)}createRenderbuffer(a,p,x){const B=this.gl,I=B.createRenderbuffer();return this.bindRenderbuffer.set(I),B.renderbufferStorage(B.RENDERBUFFER,a,p,x),this.bindRenderbuffer.set(null),I}createFramebuffer(a,p,x,B){return new Yi(this,a,p,x,B)}clear(a){let{color:p,depth:x,stencil:B}=a;const I=this.gl;let j=0;p&&(j|=I.COLOR_BUFFER_BIT,this.clearColor.set(p),this.colorMask.set([!0,!0,!0,!0])),x!==void 0&&(j|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(x),this.depthMask.set(!0)),B!==void 0&&(j|=I.STENCIL_BUFFER_BIT,this.clearStencil.set(B),this.stencilMask.set(255)),I.clear(j)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){s.aD(a.blendFunction,cr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return ha(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var p;return ha(this.gl)?this.gl.deleteVertexArray(a):(p=this.gl.getExtension("OES_vertex_array_object"))===null||p===void 0?void 0:p.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}class or{constructor(a,p,x){this.func=a,this.mask=p,this.range=x}}or.ReadOnly=!1,or.ReadWrite=!0,or.disabled=new or(519,or.ReadOnly,[0,1]);const Pn=7680;class Fr{constructor(a,p,x,B,I,j){this.test=a,this.ref=p,this.mask=x,this.fail=B,this.depthFail=I,this.pass=j}}Fr.disabled=new Fr({func:519,mask:0},0,0,Pn,Pn,Pn);class Ir{constructor(a,p,x){this.enable=a,this.mode=p,this.frontFace=x}}let Ps;function Xs(w,a,p,x,B,I,j){const y=w.context,E=y.gl,P=w.useProgram("collisionBox"),V=[];let q=0,K=0;for(let ve=0;ve<x.length;ve++){const Se=x[ve],et=a.getTile(Se),Oe=et.getBucket(p);if(!Oe)continue;let Re=Se.posMatrix;B[0]===0&&B[1]===0||(Re=w.translatePosMatrix(Se.posMatrix,et,B,I));const Ve=j?Oe.textCollisionBox:Oe.iconCollisionBox,At=Oe.collisionCircleArray;if(At.length>0){const dt=s.F(),ft=Re;s.aP(dt,Oe.placementInvProjMatrix,w.transform.glCoordMatrix),s.aP(dt,dt,Oe.placementViewportMatrix),V.push({circleArray:At,circleOffset:K,transform:ft,invTransform:dt,coord:Se}),q+=At.length/4,K=q}Ve&&P.draw(y,E.LINES,or.disabled,Fr.disabled,w.colorModeForRenderPass(),Ir.disabled,Gn(Re,w.transform,et),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Se),p.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,w.transform.zoom,null,null,Ve.collisionVertexBuffer)}if(!j||!V.length)return;const ee=w.useProgram("collisionCircle"),se=new s.aQ;se.resize(4*q),se._trim();let oe=0;for(const ve of V)for(let Se=0;Se<ve.circleArray.length/4;Se++){const et=4*Se,Oe=ve.circleArray[et+0],Re=ve.circleArray[et+1],Ve=ve.circleArray[et+2],At=ve.circleArray[et+3];se.emplace(oe++,Oe,Re,Ve,At,0),se.emplace(oe++,Oe,Re,Ve,At,1),se.emplace(oe++,Oe,Re,Ve,At,2),se.emplace(oe++,Oe,Re,Ve,At,3)}(!Ps||Ps.length<2*q)&&(Ps=function(ve){const Se=2*ve,et=new s.aS;et.resize(Se),et._trim();for(let Oe=0;Oe<Se;Oe++){const Re=6*Oe;et.uint16[Re+0]=4*Oe+0,et.uint16[Re+1]=4*Oe+1,et.uint16[Re+2]=4*Oe+2,et.uint16[Re+3]=4*Oe+2,et.uint16[Re+4]=4*Oe+3,et.uint16[Re+5]=4*Oe+0}return et}(q));const le=y.createIndexBuffer(Ps,!0),_e=y.createVertexBuffer(se,s.aR.members,!0);for(const ve of V){const Se={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(Ie=w.transform).cameraToCenterDistance,u_viewport_size:[Ie.width,Ie.height]};ee.draw(y,E.TRIANGLES,or.disabled,Fr.disabled,w.colorModeForRenderPass(),Ir.disabled,Se,w.style.map.terrain&&w.style.map.terrain.getTerrainData(ve.coord),p.id,_e,le,s.$.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,w.transform.zoom,null,null,null)}var Ie;_e.destroy(),le.destroy()}Ir.disabled=new Ir(!1,1029,2305),Ir.backCCW=new Ir(!0,1029,2305);const Lo=s.an(new Float32Array(16));function Ta(w,a,p,x,B,I){const{horizontalAlign:j,verticalAlign:y}=s.at(w);return new s.P((-(j-.5)*a/B+x[0])*I,(-(y-.5)*p/B+x[1])*I)}function fa(w,a,p,x,B,I,j,y,E,P,V){const q=w.text.placedSymbolArray,K=w.text.dynamicLayoutVertexArray,ee=w.icon.dynamicLayoutVertexArray,se={};K.clear();for(let oe=0;oe<q.length;oe++){const le=q.get(oe),_e=le.hidden||!le.crossTileID||w.allowVerticalPlacement&&!le.placedOrientation?null:x[le.crossTileID];if(_e){const Ie=new s.P(le.anchorX,le.anchorY),ve=Qe(Ie,p?j:I,V),Se=Be(B.cameraToCenterDistance,ve.signedDistanceFromCamera);let et=s.ai(w.textSizeData,E,le)*Se/s.ao;p&&(et*=w.tilePixelRatio/y);const{width:Oe,height:Re,anchor:Ve,textOffset:At,textBoxScale:dt}=_e,ft=Ta(Ve,Oe,Re,At,dt,et),Nt=p?Qe(Ie.add(ft),I,V).point:ve.point.add(a?ft.rotate(-B.angle):ft),It=w.allowVerticalPlacement&&le.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let jt=0;jt<le.numGlyphs;jt++)s.aj(K,Nt,It);P&&le.associatedIconIndex>=0&&(se[le.associatedIconIndex]={shiftedAnchor:Nt,angle:It})}else vt(le.numGlyphs,K)}if(P){ee.clear();const oe=w.icon.placedSymbolArray;for(let le=0;le<oe.length;le++){const _e=oe.get(le);if(_e.hidden)vt(_e.numGlyphs,ee);else{const Ie=se[le];if(Ie)for(let ve=0;ve<_e.numGlyphs;ve++)s.aj(ee,Ie.shiftedAnchor,Ie.angle);else vt(_e.numGlyphs,ee)}}w.icon.dynamicLayoutVertexBuffer.updateData(ee)}w.text.dynamicLayoutVertexBuffer.updateData(K)}function _c(w,a,p){return p.iconsInText&&a?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function hl(w,a,p,x,B,I,j,y,E,P,V,q){const K=w.context,ee=K.gl,se=w.transform,oe=y==="map",le=E==="map",_e=y!=="viewport"&&p.layout.get("symbol-placement")!=="point",Ie=oe&&!le&&!_e,ve=!p.layout.get("symbol-sort-key").isConstant();let Se=!1;const et=w.depthModeForSublayer(0,or.ReadOnly),Oe=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[];for(const Ve of x){const At=a.getTile(Ve),dt=At.getBucket(p);if(!dt)continue;const ft=B?dt.text:dt.icon;if(!ft||!ft.segments.get().length||!ft.hasVisibleVertices)continue;const Nt=ft.programConfigurations.get(p.id),It=B||dt.sdfIcons,jt=B?dt.textSizeData:dt.iconSizeData,Ht=le||se.pitch!==0,Mi=w.useProgram(_c(It,B,dt),Nt),mi=s.ag(jt,se.zoom),Ti=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve);let ui,ar,er,ir,Dr=[0,0],Rr=null;if(B)ar=At.glyphAtlasTexture,er=ee.LINEAR,ui=At.glyphAtlasTexture.size,dt.iconsInText&&(Dr=At.imageAtlasTexture.size,Rr=At.imageAtlasTexture,ir=Ht||w.options.rotating||w.options.zooming||jt.kind==="composite"||jt.kind==="camera"?ee.LINEAR:ee.NEAREST);else{const an=p.layout.get("icon-size").constantOr(0)!==1||dt.iconsNeedLinear;ar=At.imageAtlasTexture,er=It||w.options.rotating||w.options.zooming||an||Ht?ee.LINEAR:ee.NEAREST,ui=At.imageAtlasTexture.size}const xr=Gt(At,1,w.transform.zoom),$r=_r(Ve.posMatrix,le,oe,w.transform,xr),br=Zr(Ve.posMatrix,le,oe,w.transform,xr),Wn=Oe&&dt.hasTextData(),Kr=p.layout.get("icon-text-fit")!=="none"&&Wn&&dt.hasIconData();if(_e){const an=w.style.map.terrain?(Bs,mr)=>w.style.map.terrain.getElevation(Ve,Bs,mr):null,ts=p.layout.get("text-rotation-alignment")==="map";ie(dt,Ve.posMatrix,w,B,$r,br,le,P,ts,an)}const kr=w.translatePosMatrix(Ve.posMatrix,At,I,j),Wr=_e||B&&Oe||Kr?Lo:$r,ur=w.translatePosMatrix(br,At,I,j,!0),Nr=It&&p.paint.get(B?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let on;on=It?dt.iconsInText?Uc(jt.kind,mi,Ie,le,w,kr,Wr,ur,ui,Dr):ca(jt.kind,mi,Ie,le,w,kr,Wr,ur,B,ui,!0):Za(jt.kind,mi,Ie,le,w,kr,Wr,ur,B,ui);const es={program:Mi,buffers:ft,uniformValues:on,atlasTexture:ar,atlasTextureIcon:Rr,atlasInterpolation:er,atlasInterpolationIcon:ir,isSDF:It,hasHalo:Nr};if(ve&&dt.canOverlap){Se=!0;const an=ft.segments.get();for(const ts of an)Re.push({segments:new s.$([ts]),sortKey:ts.sortKey,state:es,terrainData:Ti})}else Re.push({segments:ft.segments,sortKey:0,state:es,terrainData:Ti})}Se&&Re.sort((Ve,At)=>Ve.sortKey-At.sortKey);for(const Ve of Re){const At=Ve.state;if(K.activeTexture.set(ee.TEXTURE0),At.atlasTexture.bind(At.atlasInterpolation,ee.CLAMP_TO_EDGE),At.atlasTextureIcon&&(K.activeTexture.set(ee.TEXTURE1),At.atlasTextureIcon&&At.atlasTextureIcon.bind(At.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),At.isSDF){const dt=At.uniformValues;At.hasHalo&&(dt.u_is_halo=1,ql(At.buffers,Ve.segments,p,w,At.program,et,V,q,dt,Ve.terrainData)),dt.u_is_halo=0}ql(At.buffers,Ve.segments,p,w,At.program,et,V,q,At.uniformValues,Ve.terrainData)}}function ql(w,a,p,x,B,I,j,y,E,P){const V=x.context;B.draw(V,V.gl.TRIANGLES,I,j,y,Ir.disabled,E,P,p.id,w.layoutVertexBuffer,w.indexBuffer,a,p.paint,x.transform.zoom,w.programConfigurations.get(p.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function vc(w,a,p,x,B){if(!p||!x||!x.imageAtlas)return;const I=x.imageAtlas.patternPositions;let j=I[p.to.toString()],y=I[p.from.toString()];if(!j&&y&&(j=y),!y&&j&&(y=j),!j||!y){const E=B.getPaintProperty(a);j=I[E],y=I[E]}j&&y&&w.setConstantPatternPositions(j,y)}function Ia(w,a,p,x,B,I,j){const y=w.context.gl,E="fill-pattern",P=p.paint.get(E),V=P&&P.constantOr(1),q=p.getCrossfadeParameters();let K,ee,se,oe,le;j?(ee=V&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",K=y.LINES):(ee=V?"fillPattern":"fill",K=y.TRIANGLES);const _e=P.constantOr(null);for(const Ie of x){const ve=a.getTile(Ie);if(V&&!ve.patternsLoaded())continue;const Se=ve.getBucket(p);if(!Se)continue;const et=Se.programConfigurations.get(p.id),Oe=w.useProgram(ee,et),Re=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ie);V&&(w.context.activeTexture.set(y.TEXTURE0),ve.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),et.updatePaintBuffers(q)),vc(et,E,_e,ve,p);const Ve=Re?Ie:null,At=w.translatePosMatrix(Ve?Ve.posMatrix:Ie.posMatrix,ve,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(j){oe=Se.indexBuffer2,le=Se.segments2;const dt=[y.drawingBufferWidth,y.drawingBufferHeight];se=ee==="fillOutlinePattern"&&V?Br(At,w,q,ve,dt):ji(At,dt)}else oe=Se.indexBuffer,le=Se.segments,se=V?di(At,w,q,ve):Ot(At);Oe.draw(w.context,K,B,w.stencilModeForClipping(Ie),I,Ir.disabled,se,Re,p.id,Se.layoutVertexBuffer,oe,le,p.paint,w.transform.zoom,et)}}function ms(w,a,p,x,B,I,j){const y=w.context,E=y.gl,P="fill-extrusion-pattern",V=p.paint.get(P),q=V.constantOr(1),K=p.getCrossfadeParameters(),ee=p.paint.get("fill-extrusion-opacity"),se=V.constantOr(null);for(const oe of x){const le=a.getTile(oe),_e=le.getBucket(p);if(!_e)continue;const Ie=w.style.map.terrain&&w.style.map.terrain.getTerrainData(oe),ve=_e.programConfigurations.get(p.id),Se=w.useProgram(q?"fillExtrusionPattern":"fillExtrusion",ve);q&&(w.context.activeTexture.set(E.TEXTURE0),le.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ve.updatePaintBuffers(K)),vc(ve,P,se,le,p);const et=w.translatePosMatrix(oe.posMatrix,le,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Oe=p.paint.get("fill-extrusion-vertical-gradient"),Re=q?gt(et,w,Oe,ee,oe,K,le):Je(et,w,Oe,ee);Se.draw(y,y.gl.TRIANGLES,B,I,j,Ir.backCCW,Re,Ie,p.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,p.paint,w.transform.zoom,ve,w.style.map.terrain&&_e.centroidVertexBuffer)}}function Al(w,a,p,x,B,I,j){const y=w.context,E=y.gl,P=p.fbo;if(!P)return;const V=w.useProgram("hillshade"),q=w.style.map.terrain&&w.style.map.terrain.getTerrainData(a);y.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,P.colorAttachment.get()),V.draw(y,E.TRIANGLES,B,I,j,Ir.disabled,((K,ee,se,oe)=>{const le=se.paint.get("hillshade-shadow-color"),_e=se.paint.get("hillshade-highlight-color"),Ie=se.paint.get("hillshade-accent-color");let ve=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(ve-=K.transform.angle);const Se=!K.options.moving;return{u_matrix:oe?oe.posMatrix:K.transform.calculatePosMatrix(ee.tileID.toUnwrapped(),Se),u_image:0,u_latrange:Nl(0,ee.tileID),u_light:[se.paint.get("hillshade-exaggeration"),ve],u_shadow:le,u_highlight:_e,u_accent:Ie}})(w,p,x,q?a:null),q,x.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function $l(w,a,p,x,B,I){const j=w.context,y=j.gl,E=a.dem;if(E&&E.data){const P=E.dim,V=E.stride,q=E.getPixels();if(j.activeTexture.set(y.TEXTURE1),j.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||w.getTileTexture(V),a.demTexture){const ee=a.demTexture;ee.update(q,{premultiply:!1}),ee.bind(y.NEAREST,y.CLAMP_TO_EDGE)}else a.demTexture=new De(j,q,y.RGBA,{premultiply:!1}),a.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);j.activeTexture.set(y.TEXTURE0);let K=a.fbo;if(!K){const ee=new De(j,{width:P,height:P,data:null},y.RGBA);ee.bind(y.LINEAR,y.CLAMP_TO_EDGE),K=a.fbo=j.createFramebuffer(P,P,!0,!1),K.colorAttachment.set(ee.texture)}j.bindFramebuffer.set(K.framebuffer),j.viewport.set([0,0,P,P]),w.useProgram("hillshadePrepare").draw(j,y.TRIANGLES,x,B,I,Ir.disabled,((ee,se)=>{const oe=se.stride,le=s.F();return s.aN(le,0,s.W,-s.W,0,0,1),s.H(le,le,[0,-s.W,0]),{u_matrix:le,u_image:1,u_dimension:[oe,oe],u_zoom:ee.overscaledZ,u_unpack:se.getUnpackVector()}})(a.tileID,E),null,p.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function La(w,a,p,x,B,I){const j=x.paint.get("raster-fade-duration");if(!I&&j>0){const y=F.now(),E=(y-w.timeAdded)/j,P=a?(y-a.timeAdded)/j:-1,V=p.getSource(),q=B.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),K=!a||Math.abs(a.tileID.overscaledZ-q)>Math.abs(w.tileID.overscaledZ-q),ee=K&&w.refreshedUponExpiration?1:s.ac(K?E:1-P,0,1);return w.refreshedUponExpiration&&E>=1&&(w.refreshedUponExpiration=!1),a?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}const Ma=new s.aO(1,0,0,1),Fs=new s.aO(0,1,0,1),Uu=new s.aO(0,0,1,1),Ln=new s.aO(1,0,1,1),fn=new s.aO(0,1,1,1);function pn(w,a,p,x){pa(w,0,a+p/2,w.transform.width,p,x)}function As(w,a,p,x){pa(w,a-p/2,0,p,w.transform.height,x)}function pa(w,a,p,x,B,I){const j=w.context,y=j.gl;y.enable(y.SCISSOR_TEST),y.scissor(a*w.pixelRatio,p*w.pixelRatio,x*w.pixelRatio,B*w.pixelRatio),j.clear({color:I}),y.disable(y.SCISSOR_TEST)}function Kl(w,a,p){const x=w.context,B=x.gl,I=p.posMatrix,j=w.useProgram("debug"),y=or.disabled,E=Fr.disabled,P=w.colorModeForRenderPass(),V="$debug",q=w.style.map.terrain&&w.style.map.terrain.getTerrainData(p);x.activeTexture.set(B.TEXTURE0);const K=a.getTileByID(p.key).latestRawTileData,ee=Math.floor((K&&K.byteLength||0)/1024),se=a.getTile(p).tileSize,oe=512/Math.min(se,512)*(p.overscaledZ/w.transform.zoom)*.5;let le=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(le+=` => ${p.overscaledZ}`),function(_e,Ie){_e.initDebugOverlayCanvas();const ve=_e.debugOverlayCanvas,Se=_e.context.gl,et=_e.debugOverlayCanvas.getContext("2d");et.clearRect(0,0,ve.width,ve.height),et.shadowColor="white",et.shadowBlur=2,et.lineWidth=1.5,et.strokeStyle="white",et.textBaseline="top",et.font="bold 36px Open Sans, sans-serif",et.fillText(Ie,5,5),et.strokeText(Ie,5,5),_e.debugOverlayTexture.update(ve),_e.debugOverlayTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}(w,`${le} ${ee}kB`),j.draw(x,B.TRIANGLES,y,E,cr.alphaBlended,Ir.disabled,ns(I,s.aO.transparent,oe),null,V,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),j.draw(x,B.LINE_STRIP,y,E,P,Ir.disabled,ns(I,s.aO.red),q,V,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function co(w,a,p){const x=w.context,B=x.gl,I=w.colorModeForRenderPass(),j=new or(B.LEQUAL,or.ReadWrite,w.depthRangeFor3D),y=w.useProgram("terrain"),E=a.getTerrainMesh();x.bindFramebuffer.set(null),x.viewport.set([0,0,w.width,w.height]);for(const P of p){const V=w.renderToTexture.getTexture(P),q=a.getTerrainData(P.tileID);x.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,V.texture);const K={u_matrix:w.transform.calculatePosMatrix(P.tileID.toUnwrapped()),u_texture:0,u_ele_delta:a.getMeshFrameDelta(w.transform.zoom)};y.draw(x,B.TRIANGLES,j,Fr.disabled,I,Ir.backCCW,K,q,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class ys{constructor(a,p){this.context=new jn(a),this.transform=p,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Qt.maxUnderzooming+Qt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new vr}resize(a,p,x){if(this.width=Math.floor(a*x),this.height=Math.floor(p*x),this.pixelRatio=x,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const B of this.style._order)this.style._layers[B].resize()}setup(){const a=this.context,p=new s.aV;p.emplaceBack(0,0),p.emplaceBack(s.W,0),p.emplaceBack(0,s.W),p.emplaceBack(s.W,s.W),this.tileExtentBuffer=a.createVertexBuffer(p,Tn.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const x=new s.aV;x.emplaceBack(0,0),x.emplaceBack(s.W,0),x.emplaceBack(0,s.W),x.emplaceBack(s.W,s.W),this.debugBuffer=a.createVertexBuffer(x,Tn.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const B=new s.Z;B.emplaceBack(0,0,0,0),B.emplaceBack(s.W,0,s.W,0),B.emplaceBack(0,s.W,0,s.W),B.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=a.createVertexBuffer(B,$t.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const I=new s.aV;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(I,Tn.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const j=new s.aW;j.emplaceBack(0),j.emplaceBack(1),j.emplaceBack(3),j.emplaceBack(2),j.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(j);const y=new s.aX;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(y);const E=this.context.gl;this.stencilClearMode=new Fr({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const a=this.context,p=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const x=s.F();s.aN(x,0,this.width,this.height,0,0,1),s.J(x,x,[p.drawingBufferWidth,p.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,p.TRIANGLES,or.disabled,this.stencilClearMode,cr.disabled,Ir.disabled,_n(x),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,p){if(this.currentStencilSource===a.source||!a.isTileClipped()||!p||!p.length)return;this.currentStencilSource=a.source;const x=this.context,B=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(cr.disabled),x.setDepthMode(or.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const j of p){const y=this._tileClippingMaskIDs[j.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(j);I.draw(x,B.TRIANGLES,or.disabled,new Fr({func:B.ALWAYS,mask:0},y,255,B.KEEP,B.KEEP,B.REPLACE),cr.disabled,Ir.disabled,_n(j.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,p=this.context.gl;return new Fr({func:p.NOTEQUAL,mask:255},a,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(a){const p=this.context.gl;return new Fr({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(a){const p=this.context.gl,x=a.sort((j,y)=>y.overscaledZ-j.overscaledZ),B=x[x.length-1].overscaledZ,I=x[0].overscaledZ-B+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();const j={};for(let y=0;y<I;y++)j[y+B]=new Fr({func:p.GEQUAL,mask:255},y+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=I,[j,x]}return[{[B]:Fr.disabled},x]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new cr([a.CONSTANT_COLOR,a.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?cr.unblended:cr.alphaBlended}depthModeForSublayer(a,p,x){if(!this.opaquePassEnabledForLayer())return or.disabled;const B=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new or(x||this.context.gl.LEQUAL,p,[B,B])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,p){this.style=a,this.options=p,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(F.now()),this.imageManager.beginFrame();const x=this.style._order,B=this.style.sourceCaches,I={},j={},y={};for(const E in B){const P=B[E];P.used&&P.prepare(this.context),I[E]=P.getVisibleCoordinates(),j[E]=I[E].slice().reverse(),y[E]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<x.length;E++)if(this.style._layers[x[E]].is3D()){this.opaquePassCutoff=E;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const E of x){const P=this.style._layers[E];if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const V=j[P.source];(P.type==="custom"||V.length)&&this.renderLayer(this,B[P.source],P,V)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:p.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[x[this.currentLayer]],P=B[E.source],V=I[E.source];this._renderTileClippingMasks(E,V),this.renderLayer(this,P,E,V)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const E=this.style._layers[x[this.currentLayer]],P=B[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const V=(E.type==="symbol"?y:j)[E.source];this._renderTileClippingMasks(E,I[E.source]),this.renderLayer(this,P,E,V)}if(this.options.showTileBoundaries){const E=function(P,V){let q=null;const K=Object.values(P._layers).flatMap(le=>le.source&&!le.isHidden(V)?[P.sourceCaches[le.source]]:[]),ee=K.filter(le=>le.getSource().type==="vector"),se=K.filter(le=>le.getSource().type!=="vector"),oe=le=>{(!q||q.getSource().maxzoom<le.getSource().maxzoom)&&(q=le)};return ee.forEach(le=>oe(le)),q||se.forEach(le=>oe(le)),q}(this.style,this.transform.zoom);E&&function(P,V,q){for(let K=0;K<q.length;K++)Kl(P,V,q[K])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const P=E.transform.padding;pn(E,E.transform.height-(P.top||0),3,Ma),pn(E,P.bottom||0,3,Fs),As(E,P.left||0,3,Uu),As(E,E.transform.width-(P.right||0),3,Ln);const V=E.transform.centerPoint;(function(q,K,ee,se){pa(q,K-1,ee-10,2,20,se),pa(q,K-10,ee-1,20,2,se)})(E,V.x,E.transform.height-V.y,fn)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(a){if(!this.style||!this.style.map||!this.style.map.terrain)return;const p=this.terrainFacilitator.matrix,x=this.transform.projMatrix;let B=this.terrainFacilitator.dirty;B||(B=a?!s.aY(p,x):!s.aZ(p,x)),B||(B=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),B&&(s.a_(p,x),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(I,j){const y=I.context,E=y.gl,P=cr.unblended,V=new or(E.LEQUAL,or.ReadWrite,[0,1]),q=j.getTerrainMesh(),K=j.sourceCache.getRenderableTiles(),ee=I.useProgram("terrainDepth");y.bindFramebuffer.set(j.getFramebuffer("depth").framebuffer),y.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),y.clear({color:s.aO.transparent,depth:1});for(const se of K){const oe=j.getTerrainData(se.tileID),le={u_matrix:I.transform.calculatePosMatrix(se.tileID.toUnwrapped()),u_ele_delta:j.getMeshFrameDelta(I.transform.zoom)};ee.draw(y,E.TRIANGLES,V,Fr.disabled,P,Ir.backCCW,le,oe,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}y.bindFramebuffer.set(null),y.viewport.set([0,0,I.width,I.height])}(this,this.style.map.terrain),function(I,j){const y=I.context,E=y.gl,P=cr.unblended,V=new or(E.LEQUAL,or.ReadWrite,[0,1]),q=j.getTerrainMesh(),K=j.getCoordsTexture(),ee=j.sourceCache.getRenderableTiles(),se=I.useProgram("terrainCoords");y.bindFramebuffer.set(j.getFramebuffer("coords").framebuffer),y.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),y.clear({color:s.aO.transparent,depth:1}),j.coordsIndex=[];for(const oe of ee){const le=j.getTerrainData(oe.tileID);y.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,K.texture);const _e={u_matrix:I.transform.calculatePosMatrix(oe.tileID.toUnwrapped()),u_terrain_coords_id:(255-j.coordsIndex.length)/255,u_texture:0,u_ele_delta:j.getMeshFrameDelta(I.transform.zoom)};se.draw(y,E.TRIANGLES,V,Fr.disabled,P,Ir.backCCW,_e,le,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),j.coordsIndex.push(oe.tileID.key)}y.bindFramebuffer.set(null),y.viewport.set([0,0,I.width,I.height])}(this,this.style.map.terrain))}renderLayer(a,p,x,B){if(!x.isHidden(this.transform.zoom)&&(x.type==="background"||x.type==="custom"||(B||[]).length))switch(this.id=x.id,x.type){case"symbol":(function(I,j,y,E,P){if(I.renderPass!=="translucent")return;const V=Fr.disabled,q=I.colorModeForRenderPass();(y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(K,ee,se,oe,le,_e,Ie){const ve=ee.transform,Se=le==="map",et=_e==="map";for(const Oe of K){const Re=oe.getTile(Oe),Ve=Re.getBucket(se);if(!Ve||!Ve.text||!Ve.text.segments.get().length)continue;const At=s.ag(Ve.textSizeData,ve.zoom),dt=Gt(Re,1,ee.transform.zoom),ft=_r(Oe.posMatrix,et,Se,ee.transform,dt),Nt=se.layout.get("icon-text-fit")!=="none"&&Ve.hasIconData();if(At){const It=Math.pow(2,ve.zoom-Re.tileID.overscaledZ);fa(Ve,Se,et,Ie,ve,ft,Oe.posMatrix,It,At,Nt,ee.style.map.terrain?(jt,Ht)=>ee.style.map.terrain.getElevation(Oe,jt,Ht):null)}}}(E,I,y,j,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),P),y.paint.get("icon-opacity").constantOr(1)!==0&&hl(I,j,y,E,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),V,q),y.paint.get("text-opacity").constantOr(1)!==0&&hl(I,j,y,E,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),V,q),j.map.showCollisionBoxes&&(Xs(I,j,y,E,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),!0),Xs(I,j,y,E,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),!1))})(a,p,x,B,this.style.placement.variableOffsets);break;case"circle":(function(I,j,y,E){if(I.renderPass!=="translucent")return;const P=y.paint.get("circle-opacity"),V=y.paint.get("circle-stroke-width"),q=y.paint.get("circle-stroke-opacity"),K=!y.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(V.constantOr(1)===0||q.constantOr(1)===0))return;const ee=I.context,se=ee.gl,oe=I.depthModeForSublayer(0,or.ReadOnly),le=Fr.disabled,_e=I.colorModeForRenderPass(),Ie=[];for(let ve=0;ve<E.length;ve++){const Se=E[ve],et=j.getTile(Se),Oe=et.getBucket(y);if(!Oe)continue;const Re=Oe.programConfigurations.get(y.id),Ve=I.useProgram("circle",Re),At=Oe.layoutVertexBuffer,dt=Oe.indexBuffer,ft=I.style.map.terrain&&I.style.map.terrain.getTerrainData(Se),Nt={programConfiguration:Re,program:Ve,layoutVertexBuffer:At,indexBuffer:dt,uniformValues:In(I,Se,et,y),terrainData:ft};if(K){const It=Oe.segments.get();for(const jt of It)Ie.push({segments:new s.$([jt]),sortKey:jt.sortKey,state:Nt})}else Ie.push({segments:Oe.segments,sortKey:0,state:Nt})}K&&Ie.sort((ve,Se)=>ve.sortKey-Se.sortKey);for(const ve of Ie){const{programConfiguration:Se,program:et,layoutVertexBuffer:Oe,indexBuffer:Re,uniformValues:Ve,terrainData:At}=ve.state;et.draw(ee,se.TRIANGLES,oe,le,_e,Ir.disabled,Ve,At,y.id,Oe,Re,ve.segments,y.paint,I.transform.zoom,Se)}})(a,p,x,B);break;case"heatmap":(function(I,j,y,E){if(y.paint.get("heatmap-opacity")!==0)if(I.renderPass==="offscreen"){const P=I.context,V=P.gl,q=Fr.disabled,K=new cr([V.ONE,V.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(ee,se,oe){const le=ee.gl;ee.activeTexture.set(le.TEXTURE1),ee.viewport.set([0,0,se.width/4,se.height/4]);let _e=oe.heatmapFbo;if(_e)le.bindTexture(le.TEXTURE_2D,_e.colorAttachment.get()),ee.bindFramebuffer.set(_e.framebuffer);else{const Ie=le.createTexture();le.bindTexture(le.TEXTURE_2D,Ie),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MAG_FILTER,le.LINEAR),_e=oe.heatmapFbo=ee.createFramebuffer(se.width/4,se.height/4,!1,!1),function(ve,Se,et,Oe){var Re,Ve;const At=ve.gl,dt=(Re=ve.HALF_FLOAT)!==null&&Re!==void 0?Re:At.UNSIGNED_BYTE,ft=(Ve=ve.RGBA16F)!==null&&Ve!==void 0?Ve:At.RGBA;At.texImage2D(At.TEXTURE_2D,0,ft,Se.width/4,Se.height/4,0,At.RGBA,dt,null),Oe.colorAttachment.set(et)}(ee,se,Ie,_e)}})(P,I,y),P.clear({color:s.aO.transparent});for(let ee=0;ee<E.length;ee++){const se=E[ee];if(j.hasRenderableParent(se))continue;const oe=j.getTile(se),le=oe.getBucket(y);if(!le)continue;const _e=le.programConfigurations.get(y.id),Ie=I.useProgram("heatmap",_e),{zoom:ve}=I.transform;Ie.draw(P,V.TRIANGLES,or.disabled,q,K,Ir.disabled,uu(se.posMatrix,oe,ve,y.paint.get("heatmap-intensity")),null,y.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,y.paint,I.transform.zoom,_e)}P.viewport.set([0,0,I.width,I.height])}else I.renderPass==="translucent"&&(I.context.setColorMode(I.colorModeForRenderPass()),function(P,V){const q=P.context,K=q.gl,ee=V.heatmapFbo;if(!ee)return;q.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,ee.colorAttachment.get()),q.activeTexture.set(K.TEXTURE1);let se=V.colorRampTexture;se||(se=V.colorRampTexture=new De(q,V.colorRamp,K.RGBA)),se.bind(K.LINEAR,K.CLAMP_TO_EDGE),P.useProgram("heatmapTexture").draw(q,K.TRIANGLES,or.disabled,Fr.disabled,P.colorModeForRenderPass(),Ir.disabled,((oe,le,_e,Ie)=>{const ve=s.F();s.aN(ve,0,oe.width,oe.height,0,0,1);const Se=oe.context.gl;return{u_matrix:ve,u_world:[Se.drawingBufferWidth,Se.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:le.paint.get("heatmap-opacity")}})(P,V),null,V.id,P.viewportBuffer,P.quadTriangleIndexBuffer,P.viewportSegments,V.paint,P.transform.zoom)}(I,y))})(a,p,x,B);break;case"line":(function(I,j,y,E){if(I.renderPass!=="translucent")return;const P=y.paint.get("line-opacity"),V=y.paint.get("line-width");if(P.constantOr(1)===0||V.constantOr(1)===0)return;const q=I.depthModeForSublayer(0,or.ReadOnly),K=I.colorModeForRenderPass(),ee=y.paint.get("line-dasharray"),se=y.paint.get("line-pattern"),oe=se.constantOr(1),le=y.paint.get("line-gradient"),_e=y.getCrossfadeParameters(),Ie=oe?"linePattern":ee?"lineSDF":le?"lineGradient":"line",ve=I.context,Se=ve.gl;let et=!0;for(const Oe of E){const Re=j.getTile(Oe);if(oe&&!Re.patternsLoaded())continue;const Ve=Re.getBucket(y);if(!Ve)continue;const At=Ve.programConfigurations.get(y.id),dt=I.context.program.get(),ft=I.useProgram(Ie,At),Nt=et||ft.program!==dt,It=I.style.map.terrain&&I.style.map.terrain.getTerrainData(Oe),jt=se.constantOr(null);if(jt&&Re.imageAtlas){const mi=Re.imageAtlas,Ti=mi.patternPositions[jt.to.toString()],ui=mi.patternPositions[jt.from.toString()];Ti&&ui&&At.setConstantPatternPositions(Ti,ui)}const Ht=It?Oe:null,Mi=oe?zl(I,Re,y,_e,Ht):ee?ss(I,Re,y,ee,_e,Ht):le?Wa(I,Re,y,Ve.lineClipsArray.length,Ht):Cr(I,Re,y,Ht);if(oe)ve.activeTexture.set(Se.TEXTURE0),Re.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),At.updatePaintBuffers(_e);else if(ee&&(Nt||I.lineAtlas.dirty))ve.activeTexture.set(Se.TEXTURE0),I.lineAtlas.bind(ve);else if(le){const mi=Ve.gradients[y.id];let Ti=mi.texture;if(y.gradientVersion!==mi.version){let ui=256;if(y.stepInterpolant){const ar=j.getSource().maxzoom,er=Oe.canonical.z===ar?Math.ceil(1<<I.transform.maxZoom-Oe.canonical.z):1;ui=s.ac(s.aT(Ve.maxLineLength/s.W*1024*er),256,ve.maxTextureSize)}mi.gradient=s.aU({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:ui,image:mi.gradient||void 0,clips:Ve.lineClipsArray}),mi.texture?mi.texture.update(mi.gradient):mi.texture=new De(ve,mi.gradient,Se.RGBA),mi.version=y.gradientVersion,Ti=mi.texture}ve.activeTexture.set(Se.TEXTURE0),Ti.bind(y.stepInterpolant?Se.NEAREST:Se.LINEAR,Se.CLAMP_TO_EDGE)}ft.draw(ve,Se.TRIANGLES,q,I.stencilModeForClipping(Oe),K,Ir.disabled,Mi,It,y.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,y.paint,I.transform.zoom,At,Ve.layoutVertexBuffer2),et=!1}})(a,p,x,B);break;case"fill":(function(I,j,y,E){const P=y.paint.get("fill-color"),V=y.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const q=I.colorModeForRenderPass(),K=y.paint.get("fill-pattern"),ee=I.opaquePassEnabledForLayer()&&!K.constantOr(1)&&P.constantOr(s.aO.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(I.renderPass===ee){const se=I.depthModeForSublayer(1,I.renderPass==="opaque"?or.ReadWrite:or.ReadOnly);Ia(I,j,y,E,se,q,!1)}if(I.renderPass==="translucent"&&y.paint.get("fill-antialias")){const se=I.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,or.ReadOnly);Ia(I,j,y,E,se,q,!0)}})(a,p,x,B);break;case"fill-extrusion":(function(I,j,y,E){const P=y.paint.get("fill-extrusion-opacity");if(P!==0&&I.renderPass==="translucent"){const V=new or(I.context.gl.LEQUAL,or.ReadWrite,I.depthRangeFor3D);if(P!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))ms(I,j,y,E,V,Fr.disabled,cr.disabled),ms(I,j,y,E,V,I.stencilModeFor3D(),I.colorModeForRenderPass());else{const q=I.colorModeForRenderPass();ms(I,j,y,E,V,Fr.disabled,q)}}})(a,p,x,B);break;case"hillshade":(function(I,j,y,E){if(I.renderPass!=="offscreen"&&I.renderPass!=="translucent")return;const P=I.context,V=I.depthModeForSublayer(0,or.ReadOnly),q=I.colorModeForRenderPass(),[K,ee]=I.renderPass==="translucent"?I.stencilConfigForOverlap(E):[{},E];for(const se of ee){const oe=j.getTile(se);oe.needsHillshadePrepare!==void 0&&oe.needsHillshadePrepare&&I.renderPass==="offscreen"?$l(I,oe,y,V,Fr.disabled,q):I.renderPass==="translucent"&&Al(I,se,oe,y,V,K[se.overscaledZ],q)}P.viewport.set([0,0,I.width,I.height])})(a,p,x,B);break;case"raster":(function(I,j,y,E){if(I.renderPass!=="translucent"||y.paint.get("raster-opacity")===0||!E.length)return;const P=I.context,V=P.gl,q=j.getSource(),K=I.useProgram("raster"),ee=I.colorModeForRenderPass(),[se,oe]=q instanceof oi?[{},E]:I.stencilConfigForOverlap(E),le=oe[oe.length-1].overscaledZ,_e=!I.options.moving;for(const Ie of oe){const ve=I.depthModeForSublayer(Ie.overscaledZ-le,y.paint.get("raster-opacity")===1?or.ReadWrite:or.ReadOnly,V.LESS),Se=j.getTile(Ie);Se.registerFadeDuration(y.paint.get("raster-fade-duration"));const et=j.findLoadedParent(Ie,0),Oe=La(Se,et,j,y,I.transform,I.style.map.terrain);let Re,Ve;const At=y.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;P.activeTexture.set(V.TEXTURE0),Se.texture.bind(At,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),P.activeTexture.set(V.TEXTURE1),et?(et.texture.bind(At,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,et.tileID.overscaledZ-Se.tileID.overscaledZ),Ve=[Se.tileID.canonical.x*Re%1,Se.tileID.canonical.y*Re%1]):Se.texture.bind(At,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const dt=I.style.map.terrain&&I.style.map.terrain.getTerrainData(Ie),ft=dt?Ie:null,Nt=ft?ft.posMatrix:I.transform.calculatePosMatrix(Ie.toUnwrapped(),_e),It=gs(Nt,Ve||[0,0],Re||1,Oe,y);q instanceof oi?K.draw(P,V.TRIANGLES,ve,Fr.disabled,ee,Ir.disabled,It,dt,y.id,q.boundsBuffer,I.quadTriangleIndexBuffer,q.boundsSegments):K.draw(P,V.TRIANGLES,ve,se[Ie.overscaledZ],ee,Ir.disabled,It,dt,y.id,I.rasterBoundsBuffer,I.quadTriangleIndexBuffer,I.rasterBoundsSegments)}})(a,p,x,B);break;case"background":(function(I,j,y,E){const P=y.paint.get("background-color"),V=y.paint.get("background-opacity");if(V===0)return;const q=I.context,K=q.gl,ee=I.transform,se=ee.tileSize,oe=y.paint.get("background-pattern");if(I.isPatternMissing(oe))return;const le=!oe&&P.a===1&&V===1&&I.opaquePassEnabledForLayer()?"opaque":"translucent";if(I.renderPass!==le)return;const _e=Fr.disabled,Ie=I.depthModeForSublayer(0,le==="opaque"?or.ReadWrite:or.ReadOnly),ve=I.colorModeForRenderPass(),Se=I.useProgram(oe?"backgroundPattern":"background"),et=E||ee.coveringTiles({tileSize:se,terrain:I.style.map.terrain});oe&&(q.activeTexture.set(K.TEXTURE0),I.imageManager.bind(I.context));const Oe=y.getCrossfadeParameters();for(const Re of et){const Ve=E?Re.posMatrix:I.transform.calculatePosMatrix(Re.toUnwrapped()),At=oe?go(Ve,V,I,oe,{tileID:Re,tileSize:se},Oe):Xa(Ve,V,P),dt=I.style.map.terrain&&I.style.map.terrain.getTerrainData(Re);Se.draw(q,K.TRIANGLES,Ie,_e,ve,Ir.disabled,At,dt,y.id,I.tileExtentBuffer,I.quadTriangleIndexBuffer,I.tileExtentSegments)}})(a,0,x,B);break;case"custom":(function(I,j,y){const E=I.context,P=y.implementation;if(I.renderPass==="offscreen"){const V=P.prerender;V&&(I.setCustomLayerDefaults(),E.setColorMode(I.colorModeForRenderPass()),V.call(P,E.gl,I.transform.customLayerMatrix()),E.setDirty(),I.setBaseState())}else if(I.renderPass==="translucent"){I.setCustomLayerDefaults(),E.setColorMode(I.colorModeForRenderPass()),E.setStencilMode(Fr.disabled);const V=P.renderingMode==="3d"?new or(I.context.gl.LEQUAL,or.ReadWrite,I.depthRangeFor3D):I.depthModeForSublayer(0,or.ReadOnly);E.setDepthMode(V),P.render(E.gl,I.transform.customLayerMatrix()),E.setDirty(),I.setBaseState(),E.bindFramebuffer.set(null)}})(a,0,x)}}translatePosMatrix(a,p,x,B,I){if(!x[0]&&!x[1])return a;const j=I?B==="map"?this.transform.angle:0:B==="viewport"?-this.transform.angle:0;if(j){const P=Math.sin(j),V=Math.cos(j);x=[x[0]*V-x[1]*P,x[0]*P+x[1]*V]}const y=[I?x[0]:Gt(p,x[0],this.transform.zoom),I?x[1]:Gt(p,x[1],this.transform.zoom),0],E=new Float32Array(16);return s.H(E,a,y),E}saveTileTexture(a){const p=this._tileTextures[a.size[0]];p?p.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const p=this._tileTextures[a];return p&&p.length>0?p.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const p=this.imageManager.getPattern(a.from.toString()),x=this.imageManager.getPattern(a.to.toString());return!p||!x}useProgram(a,p){this.cache=this.cache||{};const x=a+(p?p.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[x]||(this.cache[x]=new Ka(this.context,po[a],p,Pr[a],this._showOverdrawInspector,this.style.map.terrain)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new De(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:a,drawingBufferHeight:p}=this.context.gl;return this.width!==a||this.height!==p}}class ds{constructor(a,p){this.points=a,this.planes=p}static fromInvProjectionMatrix(a,p,x){const B=Math.pow(2,x),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const E=1/(y=s.af([],y,a))[3]/p*B;return s.a$(y,y,[E,E,1/y[3],E])}),j=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const E=function(K,ee){var se=ee[0],oe=ee[1],le=ee[2],_e=se*se+oe*oe+le*le;return _e>0&&(_e=1/Math.sqrt(_e)),K[0]=ee[0]*_e,K[1]=ee[1]*_e,K[2]=ee[2]*_e,K}([],function(K,ee,se){var oe=ee[0],le=ee[1],_e=ee[2],Ie=se[0],ve=se[1],Se=se[2];return K[0]=le*Se-_e*ve,K[1]=_e*Ie-oe*Se,K[2]=oe*ve-le*Ie,K}([],at([],I[y[0]],I[y[1]]),at([],I[y[2]],I[y[1]]))),P=-((V=E)[0]*(q=I[y[1]])[0]+V[1]*q[1]+V[2]*q[2]);var V,q;return E.concat(P)});return new ds(I,j)}}class Mo{constructor(a,p){this.min=a,this.max=p,this.center=function(x,B,I){return x[0]=.5*B[0],x[1]=.5*B[1],x[2]=.5*B[2],x}([],function(x,B,I){return x[0]=B[0]+I[0],x[1]=B[1]+I[1],x[2]=B[2]+I[2],x}([],this.min,this.max))}quadrant(a){const p=[a%2==0,a<2],x=We(this.min),B=We(this.max);for(let I=0;I<p.length;I++)x[I]=p[I]?this.min[I]:this.center[I],B[I]=p[I]?this.center[I]:this.max[I];return B[2]=this.max[2],new Mo(x,B)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const p=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let x=!0;for(let B=0;B<a.planes.length;B++){const I=a.planes[B];let j=0;for(let y=0;y<p.length;y++)s.b0(I,p[y])>=0&&j++;if(j===0)return 0;j!==p.length&&(x=!1)}if(x)return 2;for(let B=0;B<3;B++){let I=Number.MAX_VALUE,j=-Number.MAX_VALUE;for(let y=0;y<a.points.length;y++){const E=a.points[y][B]-this.min[B];I=Math.min(I,E),j=Math.max(j,E)}if(j<0||I>this.max[B]-this.min[B])return 0}return 1}}class yo{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(a)||a<0||isNaN(p)||p<0||isNaN(x)||x<0||isNaN(B)||B<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=p,this.left=x,this.right=B}interpolate(a,p,x){return p.top!=null&&a.top!=null&&(this.top=s.z.number(a.top,p.top,x)),p.bottom!=null&&a.bottom!=null&&(this.bottom=s.z.number(a.bottom,p.bottom,x)),p.left!=null&&a.left!=null&&(this.left=s.z.number(a.left,p.left,x)),p.right!=null&&a.right!=null&&(this.right=s.z.number(a.right,p.right,x)),this}getCenter(a,p){const x=s.ac((this.left+a-this.right)/2,0,a),B=s.ac((this.top+p-this.bottom)/2,0,p);return new s.P(x,B)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new yo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ga=85.051129;class tl{constructor(a,p,x,B,I){this.tileSize=512,this._renderWorldCopies=I===void 0||!!I,this._minZoom=a||0,this._maxZoom=p||22,this._minPitch=x??0,this._maxPitch=B??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new yo,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const a=new tl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.apply(this),a}apply(a){this.tileSize=a.tileSize,this.latRange=a.latRange,this.width=a.width,this.height=a.height,this._center=a._center,this._elevation=a._elevation,this.minElevationForCurrentTile=a.minElevationForCurrentTile,this.zoom=a.zoom,this.angle=a.angle,this._fov=a._fov,this._pitch=a._pitch,this._unmodified=a._unmodified,this._edgeInsets=a._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const p=-s.b1(a,-180,180)*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=function(){var x=new s.A(4);return s.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}(),function(x,B,I){var j=B[0],y=B[1],E=B[2],P=B[3],V=Math.sin(I),q=Math.cos(I);x[0]=j*q+E*V,x[1]=y*q+P*V,x[2]=j*-V+E*q,x[3]=y*-V+P*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const p=s.ac(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const p=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._zoom=p,this.tileZoom=Math.max(0,Math.floor(p)),this.scale=this.zoomScale(p),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,p,x){this._unmodified=!1,this._edgeInsets.interpolate(a,p,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const p=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(a){const p=[new s.b2(0,a)];if(this._renderWorldCopies){const x=this.pointCoordinate(new s.P(0,0)),B=this.pointCoordinate(new s.P(this.width,0)),I=this.pointCoordinate(new s.P(this.width,this.height)),j=this.pointCoordinate(new s.P(0,this.height)),y=Math.floor(Math.min(x.x,B.x,I.x,j.x)),E=Math.floor(Math.max(x.x,B.x,I.x,j.x)),P=1;for(let V=y-P;V<=E+P;V++)V!==0&&p.push(new s.b2(V,a))}return p}coveringTiles(a){var p,x;let B=this.coveringZoomLevel(a);const I=B;if(a.minzoom!==void 0&&B<a.minzoom)return[];a.maxzoom!==void 0&&B>a.maxzoom&&(B=a.maxzoom);const j=this.pointCoordinate(this.getCameraPoint()),y=s.Y.fromLngLat(this.center),E=Math.pow(2,B),P=[E*j.x,E*j.y,0],V=[E*y.x,E*y.y,0],q=ds.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,B);let K=a.minzoom||0;!a.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(K=B);const ee=a.terrain?2/Math.min(this.tileSize,a.tileSize)*this.tileSize:3,se=ve=>({aabb:new Mo([ve*E,0,0],[(ve+1)*E,E,0]),zoom:0,x:0,y:0,wrap:ve,fullyVisible:!1}),oe=[],le=[],_e=B,Ie=a.reparseOverscaled?I:B;if(this._renderWorldCopies)for(let ve=1;ve<=3;ve++)oe.push(se(-ve)),oe.push(se(ve));for(oe.push(se(0));oe.length>0;){const ve=oe.pop(),Se=ve.x,et=ve.y;let Oe=ve.fullyVisible;if(!Oe){const ft=ve.aabb.intersects(q);if(ft===0)continue;Oe=ft===2}const Re=a.terrain?P:V,Ve=ve.aabb.distanceX(Re),At=ve.aabb.distanceY(Re),dt=Math.max(Math.abs(Ve),Math.abs(At));if(ve.zoom===_e||dt>ee+(1<<_e-ve.zoom)-2&&ve.zoom>=K){const ft=_e-ve.zoom,Nt=P[0]-.5-(Se<<ft),It=P[1]-.5-(et<<ft);le.push({tileID:new s.Q(ve.zoom===_e?Ie:ve.zoom,ve.wrap,ve.zoom,Se,et),distanceSq:nt([V[0]-.5-Se,V[1]-.5-et]),tileDistanceToCamera:Math.sqrt(Nt*Nt+It*It)})}else for(let ft=0;ft<4;ft++){const Nt=(Se<<1)+ft%2,It=(et<<1)+(ft>>1),jt=ve.zoom+1;let Ht=ve.aabb.quadrant(ft);if(a.terrain){const Mi=new s.Q(jt,ve.wrap,jt,Nt,It),mi=a.terrain.getMinMaxElevation(Mi),Ti=(p=mi.minElevation)!==null&&p!==void 0?p:this.elevation,ui=(x=mi.maxElevation)!==null&&x!==void 0?x:this.elevation;Ht=new Mo([Ht.min[0],Ht.min[1],Ti],[Ht.max[0],Ht.max[1],ui])}oe.push({aabb:Ht,zoom:jt,x:Nt,y:It,wrap:ve.wrap,fullyVisible:Oe})}}return le.sort((ve,Se)=>ve.distanceSq-Se.distanceSq).map(ve=>ve.tileID)}resize(a,p){this.width=a,this.height=p,this.pixelsToGLUnits=[2/a,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const p=s.ac(a.lat,-85.051129,ga);return new s.P(s.N(a.lng)*this.worldSize,s.O(p)*this.worldSize)}unproject(a){return new s.Y(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(a){const p=this.elevation,x=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,B=this.pointLocation(this.centerPoint,a),I=a.getElevationForLngLatZoom(B,this.tileZoom);if(!(this.elevation-I))return;const j=x+p-I,y=Math.cos(this._pitch)*this.cameraToCenterDistance/j/s.b3(1,B.lat),E=this.scaleZoom(y/this.tileSize);this._elevation=I,this._center=B,this.zoom=E}setLocationAtPoint(a,p){const x=this.pointCoordinate(p),B=this.pointCoordinate(this.centerPoint),I=this.locationCoordinate(a),j=new s.Y(I.x-(x.x-B.x),I.y-(x.y-B.y));this.center=this.coordinateLocation(j),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a,p){return p?this.coordinatePoint(this.locationCoordinate(a),p.getElevationForLngLatZoom(a,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a,p){return this.coordinateLocation(this.pointCoordinate(a,p))}locationCoordinate(a){return s.Y.fromLngLat(a)}coordinateLocation(a){return a&&a.toLngLat()}pointCoordinate(a,p){if(p){const K=p.pointCoordinate(a);if(K!=null)return K}const x=[a.x,a.y,0,1],B=[a.x,a.y,1,1];s.af(x,x,this.pixelMatrixInverse),s.af(B,B,this.pixelMatrixInverse);const I=x[3],j=B[3],y=x[1]/I,E=B[1]/j,P=x[2]/I,V=B[2]/j,q=P===V?0:(0-P)/(V-P);return new s.Y(s.z.number(x[0]/I,B[0]/j,q)/this.worldSize,s.z.number(y,E,q)/this.worldSize)}coordinatePoint(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const B=[a.x*this.worldSize,a.y*this.worldSize,p,1];return s.af(B,B,x),new s.P(B[0]/B[3],B[1]/B[3])}getBounds(){const a=Math.max(0,this.height/2-this.getHorizon());return new kt().extend(this.pointLocation(new s.P(0,a))).extend(this.pointLocation(new s.P(this.width,a))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new kt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,ga])}calculatePosMatrix(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const x=a.key,B=p?this._alignedPosMatrixCache:this._posMatrixCache;if(B[x])return B[x];const I=a.canonical,j=this.worldSize/this.zoomScale(I.z),y=I.x+Math.pow(2,I.z)*a.wrap,E=s.an(new Float64Array(16));return s.H(E,E,[y*j,I.y*j,0]),s.J(E,E,[j/s.W,j/s.W,1]),s.K(E,p?this.alignedProjMatrix:this.projMatrix,E),B[x]=new Float32Array(E),B[x]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(a,p){p=s.ac(+p,this.minZoom,this.maxZoom);const x={center:new s.M(a.lng,a.lat),zoom:p};let B=this.lngRange;if(!this._renderWorldCopies&&B===null){const ve=179.9999999999;B=[-ve,ve]}const I=this.tileSize*this.zoomScale(x.zoom);let j=0,y=I,E=0,P=I,V=0,q=0;const{x:K,y:ee}=this.size;if(this.latRange){const ve=this.latRange;j=s.O(ve[1])*I,y=s.O(ve[0])*I,y-j<ee&&(V=ee/(y-j))}B&&(E=s.b1(s.N(B[0])*I,0,I),P=s.b1(s.N(B[1])*I,0,I),P<E&&(P+=I),P-E<K&&(q=K/(P-E)));const{x:se,y:oe}=this.project.call({worldSize:I},a);let le,_e;const Ie=Math.max(q||0,V||0);if(Ie){const ve=new s.P(q?(P+E)/2:se,V?(y+j)/2:oe);return x.center=this.unproject.call({worldSize:I},ve).wrap(),x.zoom+=this.scaleZoom(Ie),x}if(this.latRange){const ve=ee/2;oe-ve<j&&(_e=j+ve),oe+ve>y&&(_e=y-ve)}if(B){const ve=(E+P)/2;let Se=se;this._renderWorldCopies&&(Se=s.b1(se,ve-I/2,ve+I/2));const et=K/2;Se-et<E&&(le=E+et),Se+et>P&&(le=P-et)}if(le!==void 0||_e!==void 0){const ve=new s.P(le??se,_e??oe);x.center=this.unproject.call({worldSize:I},ve).wrap()}return x}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this._unmodified,{center:p,zoom:x}=this.getConstrained(this.center,this.zoom);this.center=p,this.zoom=x,this._unmodified=a,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,p=this.point.x,x=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b3(1,this.center.lat)*this.worldSize;let B=s.an(new Float64Array(16));s.J(B,B,[this.width/2,-this.height/2,1]),s.H(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=s.an(new Float64Array(16)),s.J(B,B,[1,-1,1]),s.H(B,B,[-1,-1,0]),s.J(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B;const I=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),j=Math.min(this.elevation,this.minElevationForCurrentTile),y=I-j*this._pixelPerMeter/Math.cos(this._pitch),E=j<0?y:I,P=Math.PI/2+this._pitch,V=this._fov*(.5+a.y/this.height),q=Math.sin(V)*E/Math.sin(s.ac(Math.PI-P-V,.01,Math.PI-.01)),K=this.getHorizon(),ee=2*Math.atan(K/this.cameraToCenterDistance)*(.5+a.y/(2*K)),se=Math.sin(ee)*E/Math.sin(s.ac(Math.PI-P-ee,.01,Math.PI-.01)),oe=Math.min(q,se),le=1.01*(Math.cos(Math.PI/2-this._pitch)*oe+E),_e=this.height/50;B=new Float64Array(16),s.b4(B,this._fov,this.width/this.height,_e,le),B[8]=2*-a.x/this.width,B[9]=2*a.y/this.height,s.J(B,B,[1,-1,1]),s.H(B,B,[0,0,-this.cameraToCenterDistance]),s.b5(B,B,this._pitch),s.ad(B,B,this.angle),s.H(B,B,[-p,-x,0]),this.mercatorMatrix=s.J([],B,[this.worldSize,this.worldSize,this.worldSize]),s.J(B,B,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,B),s.H(B,B,[0,0,-this.elevation]),this.projMatrix=B,this.invProjMatrix=s.ar([],B),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,B);const Ie=this.width%2/2,ve=this.height%2/2,Se=Math.cos(this.angle),et=Math.sin(this.angle),Oe=p-Math.round(p)+Se*Ie+et*ve,Re=x-Math.round(x)+Se*ve+et*Ie,Ve=new Float64Array(B);if(s.H(Ve,Ve,[Oe>.5?Oe-1:Oe,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=Ve,B=s.ar(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");this.pixelMatrixInverse=B,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new s.P(0,0)),p=[a.x*this.worldSize,a.y*this.worldSize,0,1];return s.af(p,p,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,a))}getCameraQueryGeometry(a){const p=this.getCameraPoint();if(a.length===1)return[a[0],p];{let x=p.x,B=p.y,I=p.x,j=p.y;for(const y of a)x=Math.min(x,y.x),B=Math.min(B,y.y),I=Math.max(I,y.x),j=Math.max(j,y.y);return[new s.P(x,B),new s.P(I,B),new s.P(I,j),new s.P(x,j),new s.P(x,B)]}}lngLatToCameraDepth(a,p){const x=this.locationCoordinate(a),B=[x.x*this.worldSize,x.y*this.worldSize,p,1];return s.af(B,B,this.projMatrix),B[2]/B[3]}}function Po(w,a){var p=this;let x,B=!1,I=null,j=null;const y=()=>{I=null,B&&(w.apply(j,x),I=setTimeout(y,a),B=!1)};return function(){for(var E=arguments.length,P=new Array(E),V=0;V<E;V++)P[V]=arguments[V];return B=!0,j=p,x=P,I||y(),I}}class Js{constructor(a){this._getCurrentHash=()=>{const p=window.location.hash.replace("#","");if(this._hashName){let x;return p.split("&").map(B=>B.split("=")).forEach(B=>{B[0]===this._hashName&&(x=B)}),(x&&x[1]||"").split("/")}return p.split("/")},this._onHashChange=()=>{const p=this._getCurrentHash();if(p.length>=3&&!p.some(x=>isNaN(x))){const x=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(p[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:x,pitch:+(p[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const p=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,p)}catch{}},this._updateHash=Po(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const p=this._map.getCenter(),x=Math.round(100*this._map.getZoom())/100,B=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,B),j=Math.round(p.lng*I)/I,y=Math.round(p.lat*I)/I,E=this._map.getBearing(),P=this._map.getPitch();let V="";if(V+=a?`/${j}/${y}/${x}`:`${x}/${y}/${j}`,(E||P)&&(V+="/"+Math.round(10*E)/10),P&&(V+=`/${Math.round(P)}`),this._hashName){const q=this._hashName;let K=!1;const ee=window.location.hash.slice(1).split("&").map(se=>{const oe=se.split("=")[0];return oe===q?(K=!0,`${oe}=${V}`):se}).filter(se=>se);return K||ee.push(`${q}=${V}`),`#${ee.join("&")}`}return`#${V}`}}const js={linearity:.3,easing:s.b6(0,0,.3,1)},_s=s.e({deceleration:2500,maxSpeed:1400},js),uo=s.e({deceleration:20,maxSpeed:1400},js),Pa=s.e({deceleration:1e3,maxSpeed:360},js),dl=s.e({deceleration:1e3,maxSpeed:90},js);class Wl{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:F.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,p=F.now();for(;a.length>0&&p-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:I}of this._inertiaBuffer)p.zoom+=I.zoomDelta||0,p.bearing+=I.bearingDelta||0,p.pitch+=I.pitchDelta||0,I.panDelta&&p.pan._add(I.panDelta),I.around&&(p.around=I.around),I.pinchAround&&(p.pinchAround=I.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,B={};if(p.pan.mag()){const I=Xo(p.pan.mag(),x,s.e({},_s,a||{}));B.offset=p.pan.mult(I.amount/p.pan.mag()),B.center=this._map.transform.center,Ds(B,I)}if(p.zoom){const I=Xo(p.zoom,x,uo);B.zoom=this._map.transform.zoom+I.amount,Ds(B,I)}if(p.bearing){const I=Xo(p.bearing,x,Pa);B.bearing=this._map.transform.bearing+s.ac(I.amount,-179,179),Ds(B,I)}if(p.pitch){const I=Xo(p.pitch,x,dl);B.pitch=this._map.transform.pitch+I.amount,Ds(B,I)}if(B.zoom||B.bearing){const I=p.pinchAround===void 0?p.around:p.pinchAround;B.around=I?this._map.unproject(I):this._map.getCenter()}return this.clear(),s.e(B,{noMoveStart:!0})}}function Ds(w,a){(!w.duration||w.duration<a.duration)&&(w.duration=a.duration,w.easing=a.easing)}function Xo(w,a,p){const{maxSpeed:x,linearity:B,deceleration:I}=p,j=s.ac(w*B/(a/1e3),-x,x),y=Math.abs(j)/(I*B);return{easing:p.easing,duration:1e3*y,amount:j*(y/2)}}class ln extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const I=R.mousePos(p.getCanvas(),x),j=p.unproject(I);super(a,s.e({point:I,lngLat:j,originalEvent:x},B)),this._defaultPrevented=!1,this.target=p}}class qn extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,p,x){const B=a==="touchend"?x.changedTouches:x.touches,I=R.touchPos(p.getCanvasContainer(),B),j=I.map(E=>p.unproject(E)),y=I.reduce((E,P,V,q)=>E.add(P.div(q.length)),new s.P(0,0));super(a,{points:I,point:y,lngLats:j,lngLat:p.unproject(y),originalEvent:x}),this._defaultPrevented=!1}}class os extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,p,x){super(a,{originalEvent:x}),this._defaultPrevented=!1}}class Ur{constructor(a,p){this._map=a,this._clickTolerance=p.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new os(a.type,this._map,a))}mousedown(a,p){return this._mousedownPos=p,this._firePreventable(new ln(a.type,this._map,a))}mouseup(a){this._map.fire(new ln(a.type,this._map,a))}click(a,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||this._map.fire(new ln(a.type,this._map,a))}dblclick(a){return this._firePreventable(new ln(a.type,this._map,a))}mouseover(a){this._map.fire(new ln(a.type,this._map,a))}mouseout(a){this._map.fire(new ln(a.type,this._map,a))}touchstart(a){return this._firePreventable(new qn(a.type,this._map,a))}touchmove(a){this._map.fire(new qn(a.type,this._map,a))}touchend(a){this._map.fire(new qn(a.type,this._map,a))}touchcancel(a){this._map.fire(new qn(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class en{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new ln(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new ln(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nn{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.pointLocation(s.P.convert(a),this._map.terrain)}}class Nn{constructor(a,p){this._map=a,this._tr=new nn(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,p){this.isEnabled()&&a.shiftKey&&a.button===0&&(R.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(a,p){if(!this._active)return;const x=p;if(this._lastPos.equals(x)||!this._box&&x.dist(this._startPos)<this._clickTolerance)return;const B=this._startPos;this._lastPos=x,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));const I=Math.min(B.x,x.x),j=Math.max(B.x,x.x),y=Math.min(B.y,x.y),E=Math.max(B.y,x.y);R.setTransform(this._box,`translate(${I}px,${y}px)`),this._box.style.width=j-I+"px",this._box.style.height=E-y+"px"}mouseupWindow(a,p){if(!this._active||a.button!==0)return;const x=this._startPos,B=p;if(this.reset(),R.suppressClick(),x.x!==B.x||x.y!==B.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:a})),{cameraAnimation:I=>I.fitScreenCoordinates(x,B,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,p){return this._map.fire(new s.k(a,{originalEvent:p}))}}function ma(w,a){if(w.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${a.length}`);const p={};for(let x=0;x<w.length;x++)p[w[x].identifier]=a[x];return p}class Fa{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,p,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),x.length===this.numTouches&&(this.centroid=function(B){const I=new s.P(0,0);for(const j of B)I._add(j);return I.div(B.length)}(p),this.touches=ma(x,p)))}touchmove(a,p,x){if(this.aborted||!this.centroid)return;const B=ma(x,p);for(const I in this.touches){const j=B[I];(!j||j.dist(this.touches[I])>30)&&(this.aborted=!0)}}touchend(a,p,x){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const B=!this.aborted&&this.centroid;if(this.reset(),B)return B}}}class Jo{constructor(a){this.singleTap=new Fa(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,p,x){this.singleTap.touchstart(a,p,x)}touchmove(a,p,x){this.singleTap.touchmove(a,p,x)}touchend(a,p,x){const B=this.singleTap.touchend(a,p,x);if(B){const I=a.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(B)<30;if(I&&j||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=B,this.count===this.numTaps)return this.reset(),B}}}class Yo{constructor(a){this._tr=new nn(a),this._zoomIn=new Jo({numTouches:1,numTaps:2}),this._zoomOut=new Jo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,p,x){this._zoomIn.touchstart(a,p,x),this._zoomOut.touchstart(a,p,x)}touchmove(a,p,x){this._zoomIn.touchmove(a,p,x),this._zoomOut.touchmove(a,p,x)}touchend(a,p,x){const B=this._zoomIn.touchend(a,p,x),I=this._zoomOut.touchend(a,p,x),j=this._tr;return B?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:j.zoom+1,around:j.unproject(B)},{originalEvent:a})}):I?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:j.zoom-1,around:j.unproject(I)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ui{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(){const a=this._moveFunction(...arguments);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(a,p){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=p.length?p[0]:p,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,p){if(!this.isEnabled())return;const x=this._lastPoint;if(!x)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);const B=p.length?p[0]:p;return!this._moved&&B.dist(x)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=B,this._move(x,B))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&R.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ya={0:1,2:2};class Di{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){const p=R.mouseButton(a);this._eventButton=p}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!function(p,x){const B=ya[x];return p.buttons===void 0||(p.buttons&B)!==B}(a,this._eventButton)}isValidEndEvent(a){return R.mouseButton(a)===this._eventButton}}class fl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}const pl=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(a){a.preventDefault()}},Li=w=>{let{enable:a,clickTolerance:p,bearingDegreesPerPixelMoved:x=.8}=w;const B=new Di({checkCorrectEvent:I=>R.mouseButton(I)===0&&I.ctrlKey||R.mouseButton(I)===2});return new Ui({clickTolerance:p,move:(I,j)=>({bearingDelta:(j.x-I.x)*x}),moveStateManager:B,enable:a,assignEvents:pl})},bc=w=>{let{enable:a,clickTolerance:p,pitchDegreesPerPixelMoved:x=-.5}=w;const B=new Di({checkCorrectEvent:I=>R.mouseButton(I)===0&&I.ctrlKey||R.mouseButton(I)===2});return new Ui({clickTolerance:p,move:(I,j)=>({pitchDelta:(j.y-I.y)*x}),moveStateManager:B,enable:a,assignEvents:pl})};class Fi{constructor(a,p){this._clickTolerance=a.clickTolerance||1,this._map=p,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(a,p,x){return this._calculateTransform(a,p,x)}touchmove(a,p,x){if(this._active&&!(x.length<this.minTouchs()))return a.preventDefault(),this._calculateTransform(a,p,x)}touchend(a,p,x){this._calculateTransform(a,p,x),this._active&&x.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,p,x){x.length>0&&(this._active=!0);const B=ma(x,p),I=new s.P(0,0),j=new s.P(0,0);let y=0;for(const P in B){const V=B[P],q=this._touches[P];q&&(I._add(V),j._add(V.sub(q)),y++,B[P]=V)}if(this._touches=B,y<this.minTouchs()||!j.mag())return;const E=j.div(y);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:I.div(y),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ys{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,p,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([p[0],p[1]]))}touchmove(a,p,x){if(!this._firstTwoTouches)return;a.preventDefault();const[B,I]=this._firstTwoTouches,j=eo(x,p,B),y=eo(x,p,I);if(!j||!y)return;const E=this._aroundCenter?null:j.add(y).div(2);return this._move([j,y],E,a)}touchend(a,p,x){if(!this._firstTwoTouches)return;const[B,I]=this._firstTwoTouches,j=eo(x,p,B),y=eo(x,p,I);j&&y||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function eo(w,a,p){for(let x=0;x<w.length;x++)if(w[x].identifier===p)return a[x]}function zc(w,a){return Math.log(w/a)/Math.LN2}class Zl extends Ys{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,p){const x=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(zc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zc(this._distance,x),pinchAround:p}}}function du(w,a){return 180*w.angleWith(a)/Math.PI}class Qc extends Ys{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,p,x){const B=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:du(this._vector,B),pinchAround:p}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const p=25/(Math.PI*this._minDiameter)*360,x=du(a,this._startVector);return Math.abs(x)<p}}function Xl(w){return Math.abs(w.y)>Math.abs(w.x)}class Vc extends Ys{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,p,x){super.touchstart(a,p,x),this._currentTouchCount=x.length}_start(a){this._lastPoints=a,Xl(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,p,x){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const B=a[0].sub(this._lastPoints[0]),I=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(B,I,x.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(B.y+I.y)/2*-.5}):void 0}gestureBeginsVertically(a,p,x){if(this._valid!==void 0)return this._valid;const B=a.mag()>=2,I=p.mag()>=2;if(!B&&!I)return;if(!B||!I)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;const j=a.y>0==p.y>0;return Xl(a)&&Xl(p)&&j}}const il={panStep:100,bearingStep:15,pitchStep:10};class vn{constructor(a){this._tr=new nn(a);const p=il;this._panStep=p.panStep,this._bearingStep=p.bearingStep,this._pitchStep=p.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let p=0,x=0,B=0,I=0,j=0;switch(a.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:a.shiftKey?x=-1:(a.preventDefault(),I=-1);break;case 39:a.shiftKey?x=1:(a.preventDefault(),I=1);break;case 38:a.shiftKey?B=1:(a.preventDefault(),j=-1);break;case 40:a.shiftKey?B=-1:(a.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(x=0,B=0),{cameraAnimation:y=>{const E=this._tr;y.easeTo({duration:300,easeId:"keyboardHandler",easing:Rs,zoom:p?Math.round(E.zoom)+p*(a.shiftKey?2:1):E.zoom,bearing:E.bearing+x*this._bearingStep,pitch:E.pitch+B*this._pitchStep,offset:[-I*this._panStep,-j*this._panStep],center:E.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rs(w){return w*(2-w)}const Fo=4.000244140625;class gl{constructor(a,p){this._onTimeout=x=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(x)},this._map=a,this._tr=new nn(a),this._triggerRenderFrame=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!a[this._map.cooperativeGestures._bypassKey])return;let p=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const x=F.now(),B=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,p!==0&&p%Fo==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":B>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(B*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),a.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=a,this._delta-=p,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=R.mousePos(this._map.getCanvas(),a),x=this._tr;this._around=p.y>x.transform.height/2-x.transform.getHorizon()?s.M.convert(this._aroundCenter?x.center:x.unproject(p)):s.M.convert(x.center),this._aroundPoint=x.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._tr.transform;if(this._delta!==0){const y=this._type==="wheel"&&Math.abs(this._delta)>Fo?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&E!==0&&(E=1/E);const P=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(P*E))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,x=this._startZoom,B=this._easing;let I,j=!1;if(this._type==="wheel"&&x&&B){const y=Math.min((F.now()-this._lastWheelEventTime)/200,1),E=B(y);I=s.z.number(x,p,E),y<1?this._frameId||(this._frameId=!0):j=!0}else I=p,j=!0;return this._active=!0,j&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!j,zoomDelta:I-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let p=s.b7;if(this._prevEase){const x=this._prevEase,B=(F.now()-x.start)/x.duration,I=x.easing(B+.01)-x.easing(B),j=.27/Math.sqrt(I*I+1e-4)*.01,y=Math.sqrt(.0729-j*j);p=s.b6(j,y,.25,1)}return this._prevEase={start:F.now(),duration:a,easing:p},p}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class fu{constructor(a,p){this._clickZoom=a,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hc{constructor(a){this._tr=new nn(a),this.reset()}reset(){this._active=!1}dblclick(a,p){return a.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:this._tr.zoom+(a.shiftKey?-1:1),around:this._tr.unproject(p)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nu{constructor(){this._tap=new Jo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,p,x){if(!this._swipePoint)if(this._tapTime){const B=p[0],I=a.timeStamp-this._tapTime<500,j=this._tapPoint.dist(B)<30;I&&j?x.length>0&&(this._swipePoint=B,this._swipeTouch=x[0].identifier):this.reset()}else this._tap.touchstart(a,p,x)}touchmove(a,p,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const B=p[0],I=B.y-this._swipePoint.y;return this._swipePoint=B,a.preventDefault(),this._active=!0,{zoomDelta:I/128}}}else this._tap.touchmove(a,p,x)}touchend(a,p,x){if(this._tapTime)this._swipePoint&&x.length===0&&this.reset();else{const B=this._tap.touchend(a,p,x);B&&(this._tapTime=a.timeStamp,this._tapPoint=B)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _a{constructor(a,p,x){this._el=a,this._mousePan=p,this._touchPan=x}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class to{constructor(a,p,x){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=p,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ei{constructor(a,p,x,B){this._el=a,this._touchZoom=p,this._touchRotate=x,this._tapDragZoom=B,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class sr{constructor(a,p){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=p,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=R.create("div","maplibregl-cooperative-gesture-screen",a);let p=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(p=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const x=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),B=document.createElement("div");B.className="maplibregl-desktop-message",B.textContent=p,this._container.appendChild(B);const I=document.createElement("div");I.className="maplibregl-mobile-message",I.textContent=x,this._container.appendChild(I),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(R.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(a){this._onCooperativeGesture(a.touches.length===1)}wheel(a){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!a[this._bypassKey])}_onCooperativeGesture(a){this._enabled&&a&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ml=w=>w.zoom||w.drag||w.pitch||w.rotate;class Gc extends s.k{}function Jl(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class ks{constructor(a,p){this.handleWindowEvent=B=>{this.handleEvent(B,`${B.type}Window`)},this.handleEvent=(B,I)=>{if(B.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const j=B.type==="renderFrame"?void 0:B,y={needsRenderFrame:!1},E={},P={},V=B.touches,q=V?this._getMapTouches(V):void 0,K=q?R.touchPos(this._map.getCanvas(),q):R.mousePos(this._map.getCanvas(),B);for(const{handlerName:oe,handler:le,allowed:_e}of this._handlers){if(!le.isEnabled())continue;let Ie;this._blockedByActive(P,_e,oe)?le.reset():le[I||B.type]&&(Ie=le[I||B.type](B,K,q),this.mergeHandlerResult(y,E,Ie,oe,j),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||le.isActive())&&(P[oe]=le)}const ee={};for(const oe in this._previousActiveHandlers)P[oe]||(ee[oe]=j);this._previousActiveHandlers=P,(Object.keys(ee).length||Jl(y))&&(this._changes.push([y,E,ee]),this._triggerRenderFrame()),(Object.keys(P).length||Jl(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:se}=y;se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],se(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wl(a),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[window,"blur",void 0]];for(const[B,I,j]of this._listeners)R.addEventListener(B,I,B===document?this.handleWindowEvent:this.handleEvent,j)}destroy(){for(const[a,p,x]of this._listeners)R.removeEventListener(a,p,a===document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(a){const p=this._map,x=p.getCanvasContainer();this._add("mapEvent",new Ur(p,a));const B=p.boxZoom=new Nn(p,a);this._add("boxZoom",B),a.interactive&&a.boxZoom&&B.enable();const I=p.cooperativeGestures=new sr(p,a.cooperativeGestures);this._add("cooperativeGestures",I),a.cooperativeGestures&&I.enable();const j=new Yo(p),y=new Hc(p);p.doubleClickZoom=new fu(y,j),this._add("tapZoom",j),this._add("clickZoom",y),a.interactive&&a.doubleClickZoom&&p.doubleClickZoom.enable();const E=new Nu;this._add("tapDragZoom",E);const P=p.touchPitch=new Vc(p);this._add("touchPitch",P),a.interactive&&a.touchPitch&&p.touchPitch.enable(a.touchPitch);const V=Li(a),q=bc(a);p.dragRotate=new to(a,V,q),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]),a.interactive&&a.dragRotate&&p.dragRotate.enable();const K=(Ie=>{let{enable:ve,clickTolerance:Se}=Ie;const et=new Di({checkCorrectEvent:Oe=>R.mouseButton(Oe)===0&&!Oe.ctrlKey});return new Ui({clickTolerance:Se,move:(Oe,Re)=>({around:Re,panDelta:Re.sub(Oe)}),activateOnStart:!0,moveStateManager:et,enable:ve,assignEvents:pl})})(a),ee=new Fi(a,p);p.dragPan=new _a(x,K,ee),this._add("mousePan",K),this._add("touchPan",ee,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&p.dragPan.enable(a.dragPan);const se=new Qc,oe=new Zl;p.touchZoomRotate=new Ei(x,oe,se,E),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&p.touchZoomRotate.enable(a.touchZoomRotate);const le=p.scrollZoom=new gl(p,()=>this._triggerRenderFrame());this._add("scrollZoom",le,["mousePan"]),a.interactive&&a.scrollZoom&&p.scrollZoom.enable(a.scrollZoom);const _e=p.keyboard=new vn(p);this._add("keyboard",_e),a.interactive&&a.keyboard&&p.keyboard.enable(),this._add("blockableMapEvent",new en(p))}_add(a,p,x){this._handlers.push({handlerName:a,handler:p,allowed:x}),this._handlersById[a]=p}stop(a){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ml(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,p,x){for(const B in a)if(B!==x&&(!p||p.indexOf(B)<0))return!0;return!1}_getMapTouches(a){const p=[];for(const x of a)this._el.contains(x.target)&&p.push(x);return p}mergeHandlerResult(a,p,x,B,I){if(!x)return;s.e(a,x);const j={handlerName:B,originalEvent:x.originalEvent||I};x.zoomDelta!==void 0&&(p.zoom=j),x.panDelta!==void 0&&(p.drag=j),x.pitchDelta!==void 0&&(p.pitch=j),x.bearingDelta!==void 0&&(p.rotate=j)}_applyChanges(){const a={},p={},x={};for(const[B,I,j]of this._changes)B.panDelta&&(a.panDelta=(a.panDelta||new s.P(0,0))._add(B.panDelta)),B.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+B.zoomDelta),B.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+B.bearingDelta),B.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+B.pitchDelta),B.around!==void 0&&(a.around=B.around),B.pinchAround!==void 0&&(a.pinchAround=B.pinchAround),B.noInertia&&(a.noInertia=B.noInertia),s.e(p,I),s.e(x,j);this._updateMapTransform(a,p,x),this._changes=[]}_updateMapTransform(a,p,x){const B=this._map,I=B._getTransformForUpdate(),j=B.terrain;if(!(Jl(a)||j&&this._terrainMovement))return this._fireEvents(p,x,!0);let{panDelta:y,zoomDelta:E,bearingDelta:P,pitchDelta:V,around:q,pinchAround:K}=a;K!==void 0&&(q=K),B._stop(!0),q=q||B.transform.centerPoint;const ee=I.pointLocation(y?q.sub(y):q);P&&(I.bearing+=P),V&&(I.pitch+=V),E&&(I.zoom+=E),j?this._terrainMovement||!p.drag&&!p.zoom?p.drag&&this._terrainMovement?I.center=I.pointLocation(I.centerPoint.sub(y)):I.setLocationAtPoint(ee,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,I.setLocationAtPoint(ee,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,I.recalculateZoom(B.terrain)})):I.setLocationAtPoint(ee,q),B._applyUpdatedTransform(I),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(p,x,!0)}_fireEvents(a,p,x){const B=ml(this._eventsInProgress),I=ml(a),j={};for(const V in a){const{originalEvent:q}=a[V];this._eventsInProgress[V]||(j[`${V}start`]=q),this._eventsInProgress[V]=a[V]}!B&&I&&this._fireEvent("movestart",I.originalEvent);for(const V in j)this._fireEvent(V,j[V]);I&&this._fireEvent("move",I.originalEvent);for(const V in a){const{originalEvent:q}=a[V];this._fireEvent(V,q)}const y={};let E;for(const V in this._eventsInProgress){const{handlerName:q,originalEvent:K}=this._eventsInProgress[V];this._handlersById[q].isActive()||(delete this._eventsInProgress[V],E=p[q]||K,y[`${V}end`]=E)}for(const V in y)this._fireEvent(V,y[V]);const P=ml(this._eventsInProgress);if(x&&(B||I)&&!P){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;!V||!V.essential&&F.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:E})),q(this._map.getBearing())&&this._map.resetNorth()):(q(V.bearing||this._map.getBearing())&&(V.bearing=0),V.freezeElevation=!0,this._map.easeTo(V,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(a,p){this._map.fire(new s.k(a,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new Gc("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class nA extends s.E{constructor(a,p){super(),this._renderFrameCallback=()=>{const x=Math.min((F.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(x)),x<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=p.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(a,p){return this.jumpTo({center:a},p)}panBy(a,p,x){return a=s.P.convert(a).mult(-1),this.panTo(this.transform.center,s.e({offset:a},p),x)}panTo(a,p,x){return this.easeTo(s.e({center:a},p),x)}getZoom(){return this.transform.zoom}setZoom(a,p){return this.jumpTo({zoom:a},p),this}zoomTo(a,p,x){return this.easeTo(s.e({zoom:a},p),x)}zoomIn(a,p){return this.zoomTo(this.getZoom()+1,a,p),this}zoomOut(a,p){return this.zoomTo(this.getZoom()-1,a,p),this}getBearing(){return this.transform.bearing}setBearing(a,p){return this.jumpTo({bearing:a},p),this}getPadding(){return this.transform.padding}setPadding(a,p){return this.jumpTo({padding:a},p),this}rotateTo(a,p,x){return this.easeTo(s.e({bearing:a},p),x)}resetNorth(a,p){return this.rotateTo(0,s.e({duration:1e3},a),p),this}resetNorthPitch(a,p){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},a),p),this}snapToNorth(a,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,p):this}getPitch(){return this.transform.pitch}setPitch(a,p){return this.jumpTo({pitch:a},p),this}cameraForBounds(a,p){a=kt.convert(a);const x=p&&p.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),x,p)}_cameraForBoxAndBearing(a,p,x,B){const I={top:0,bottom:0,right:0,left:0};if(typeof(B=s.e({padding:I,offset:[0,0],maxZoom:this.transform.maxZoom},B)).padding=="number"){const ft=B.padding;B.padding={top:ft,bottom:ft,right:ft,left:ft}}B.padding=s.e(I,B.padding);const j=this.transform,y=j.padding,E=new kt(a,p),P=j.project(E.getNorthWest()),V=j.project(E.getNorthEast()),q=j.project(E.getSouthEast()),K=j.project(E.getSouthWest()),ee=s.b8(-x),se=P.rotate(ee),oe=V.rotate(ee),le=q.rotate(ee),_e=K.rotate(ee),Ie=new s.P(Math.max(se.x,oe.x,_e.x,le.x),Math.max(se.y,oe.y,_e.y,le.y)),ve=new s.P(Math.min(se.x,oe.x,_e.x,le.x),Math.min(se.y,oe.y,_e.y,le.y)),Se=Ie.sub(ve),et=(j.width-(y.left+y.right+B.padding.left+B.padding.right))/Se.x,Oe=(j.height-(y.top+y.bottom+B.padding.top+B.padding.bottom))/Se.y;if(Oe<0||et<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Re=Math.min(j.scaleZoom(j.scale*Math.min(et,Oe)),B.maxZoom),Ve=s.P.convert(B.offset),At=new s.P((B.padding.left-B.padding.right)/2,(B.padding.top-B.padding.bottom)/2).rotate(s.b8(x)),dt=Ve.add(At).mult(j.scale/j.zoomScale(Re));return{center:j.unproject(P.add(q).div(2).sub(dt)),zoom:Re,bearing:x}}fitBounds(a,p,x){return this._fitInternal(this.cameraForBounds(a,p),p,x)}fitScreenCoordinates(a,p,x,B,I){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(a)),this.transform.pointLocation(s.P.convert(p)),x,B),B,I)}_fitInternal(a,p,x){return a?(delete(p=s.e(a,p)).padding,p.linear?this.easeTo(p,x):this.flyTo(p,x)):this}jumpTo(a,p){this.stop();const x=this._getTransformForUpdate();let B=!1,I=!1,j=!1;return"zoom"in a&&x.zoom!==+a.zoom&&(B=!0,x.zoom=+a.zoom),a.center!==void 0&&(x.center=s.M.convert(a.center)),"bearing"in a&&x.bearing!==+a.bearing&&(I=!0,x.bearing=+a.bearing),"pitch"in a&&x.pitch!==+a.pitch&&(j=!0,x.pitch=+a.pitch),a.padding==null||x.isPaddingEqual(a.padding)||(x.padding=a.padding),this._applyUpdatedTransform(x),this.fire(new s.k("movestart",p)).fire(new s.k("move",p)),B&&this.fire(new s.k("zoomstart",p)).fire(new s.k("zoom",p)).fire(new s.k("zoomend",p)),I&&this.fire(new s.k("rotatestart",p)).fire(new s.k("rotate",p)).fire(new s.k("rotateend",p)),j&&this.fire(new s.k("pitchstart",p)).fire(new s.k("pitch",p)).fire(new s.k("pitchend",p)),this.fire(new s.k("moveend",p))}calculateCameraOptionsFromTo(a,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const I=s.Y.fromLngLat(a,p),j=s.Y.fromLngLat(x,B),y=j.x-I.x,E=j.y-I.y,P=j.z-I.z,V=Math.hypot(y,E,P);if(V===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(y,E),K=this.transform.scaleZoom(this.transform.cameraToCenterDistance/V/this.transform.tileSize),ee=180*Math.atan2(y,-E)/Math.PI;let se=180*Math.acos(q/V)/Math.PI;return se=P<0?90-se:90+se,{center:j.toLngLat(),zoom:K,pitch:se,bearing:ee}}easeTo(a,p){var x;this._stop(!1,a.easeId),((a=s.e({offset:[0,0],duration:500,easing:s.b7},a)).animate===!1||!a.essential&&F.prefersReducedMotion)&&(a.duration=0);const B=this._getTransformForUpdate(),I=this.getZoom(),j=this.getBearing(),y=this.getPitch(),E=this.getPadding(),P="bearing"in a?this._normalizeBearing(a.bearing,j):j,V="pitch"in a?+a.pitch:y,q="padding"in a?a.padding:B.padding,K=s.P.convert(a.offset);let ee=B.centerPoint.add(K);const se=B.pointLocation(ee),{center:oe,zoom:le}=B.getConstrained(s.M.convert(a.center||se),(x=a.zoom)!==null&&x!==void 0?x:I);this._normalizeCenter(oe);const _e=B.project(se),Ie=B.project(oe).sub(_e),ve=B.zoomScale(le-I);let Se,et;a.around&&(Se=s.M.convert(a.around),et=B.locationPoint(Se));const Oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==I,this._rotating=this._rotating||j!==P,this._pitching=this._pitching||V!==y,this._padding=!B.isPaddingEqual(q),this._easeId=a.easeId,this._prepareEase(p,a.noMoveStart,Oe),this.terrain&&this._prepareElevation(oe),this._ease(Re=>{if(this._zooming&&(B.zoom=s.z.number(I,le,Re)),this._rotating&&(B.bearing=s.z.number(j,P,Re)),this._pitching&&(B.pitch=s.z.number(y,V,Re)),this._padding&&(B.interpolatePadding(E,q,Re),ee=B.centerPoint.add(K)),this.terrain&&!a.freezeElevation&&this._updateElevation(Re),Se)B.setLocationAtPoint(Se,et);else{const Ve=B.zoomScale(B.zoom-I),At=le>I?Math.min(2,ve):Math.max(.5,ve),dt=Math.pow(At,1-Re),ft=B.unproject(_e.add(Ie.mult(Re*dt)).mult(Ve));B.setLocationAtPoint(B.renderWorldCopies?ft.wrap():ft,ee)}this._applyUpdatedTransform(B),this._fireMoveEvents(p)},Re=>{this.terrain&&this._finalizeElevation(),this._afterEase(p,Re)},a),this}_prepareEase(a,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,p||x.moving||this.fire(new s.k("movestart",a)),this._zooming&&!x.zooming&&this.fire(new s.k("zoomstart",a)),this._rotating&&!x.rotating&&this.fire(new s.k("rotatestart",a)),this._pitching&&!x.pitching&&this.fire(new s.k("pitchstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const p=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&p!==this._elevationTarget){const x=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(x-(p-(x*a+this._elevationStart))/(1-a)),this._elevationTarget=p}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,a)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(a){if(!this.transformCameraUpdate)return;const p=a.clone(),{center:x,zoom:B,pitch:I,bearing:j,elevation:y}=this.transformCameraUpdate(p);x&&(p.center=x),B!==void 0&&(p.zoom=B),I!==void 0&&(p.pitch=I),j!==void 0&&(p.bearing=j),y!==void 0&&(p.elevation=y),this.transform.apply(p)}_fireMoveEvents(a){this.fire(new s.k("move",a)),this._zooming&&this.fire(new s.k("zoom",a)),this._rotating&&this.fire(new s.k("rotate",a)),this._pitching&&this.fire(new s.k("pitch",a))}_afterEase(a,p){if(this._easeId&&p&&this._easeId===p)return;delete this._easeId;const x=this._zooming,B=this._rotating,I=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new s.k("zoomend",a)),B&&this.fire(new s.k("rotateend",a)),I&&this.fire(new s.k("pitchend",a)),this.fire(new s.k("moveend",a))}flyTo(a,p){var x;if(!a.essential&&F.prefersReducedMotion){const Mi=s.L(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Mi,p)}this.stop(),a=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b7},a);const B=this._getTransformForUpdate(),I=this.getZoom(),j=this.getBearing(),y=this.getPitch(),E=this.getPadding(),P="bearing"in a?this._normalizeBearing(a.bearing,j):j,V="pitch"in a?+a.pitch:y,q="padding"in a?a.padding:B.padding,K=s.P.convert(a.offset);let ee=B.centerPoint.add(K);const se=B.pointLocation(ee),{center:oe,zoom:le}=B.getConstrained(s.M.convert(a.center||se),(x=a.zoom)!==null&&x!==void 0?x:I);this._normalizeCenter(oe);const _e=B.zoomScale(le-I),Ie=B.project(se),ve=B.project(oe).sub(Ie);let Se=a.curve;const et=Math.max(B.width,B.height),Oe=et/_e,Re=ve.mag();if("minZoom"in a){const Mi=s.ac(Math.min(a.minZoom,I,le),B.minZoom,B.maxZoom),mi=et/B.zoomScale(Mi-I);Se=Math.sqrt(mi/Re*2)}const Ve=Se*Se;function At(Mi){const mi=(Oe*Oe-et*et+(Mi?-1:1)*Ve*Ve*Re*Re)/(2*(Mi?Oe:et)*Ve*Re);return Math.log(Math.sqrt(mi*mi+1)-mi)}function dt(Mi){return(Math.exp(Mi)-Math.exp(-Mi))/2}function ft(Mi){return(Math.exp(Mi)+Math.exp(-Mi))/2}const Nt=At(!1);let It=function(Mi){return ft(Nt)/ft(Nt+Se*Mi)},jt=function(Mi){return et*((ft(Nt)*(dt(mi=Nt+Se*Mi)/ft(mi))-dt(Nt))/Ve)/Re;var mi},Ht=(At(!0)-Nt)/Se;if(Math.abs(Re)<1e-6||!isFinite(Ht)){if(Math.abs(et-Oe)<1e-6)return this.easeTo(a,p);const Mi=Oe<et?-1:1;Ht=Math.abs(Math.log(Oe/et))/Se,jt=function(){return 0},It=function(mi){return Math.exp(Mi*Se*mi)}}return a.duration="duration"in a?+a.duration:1e3*Ht/("screenSpeed"in a?+a.screenSpeed/Se:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=j!==P,this._pitching=V!==y,this._padding=!B.isPaddingEqual(q),this._prepareEase(p,!1),this.terrain&&this._prepareElevation(oe),this._ease(Mi=>{const mi=Mi*Ht,Ti=1/It(mi);B.zoom=Mi===1?le:I+B.scaleZoom(Ti),this._rotating&&(B.bearing=s.z.number(j,P,Mi)),this._pitching&&(B.pitch=s.z.number(y,V,Mi)),this._padding&&(B.interpolatePadding(E,q,Mi),ee=B.centerPoint.add(K)),this.terrain&&!a.freezeElevation&&this._updateElevation(Mi);const ui=Mi===1?oe:B.unproject(Ie.add(ve.mult(jt(mi))).mult(Ti));B.setLocationAtPoint(B.renderWorldCopies?ui.wrap():ui,ee),this._applyUpdatedTransform(B),this._fireMoveEvents(p)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(p)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,p)}if(!a){const x=this.handlers;x&&x.stop(!1)}return this}_ease(a,p,x){x.animate===!1||x.duration===0?(a(1),p()):(this._easeStart=F.now(),this._easeOptions=x,this._onEaseFrame=a,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,p){a=s.b1(a,-180,180);const x=Math.abs(a-p);return Math.abs(a-360-p)<x&&(a-=360),Math.abs(a+360-p)<x&&(a+=360),a}_normalizeCenter(a){const p=this.transform;if(!p.renderWorldCopies||p.lngRange)return;const x=a.lng-p.center.lng;a.lng+=x>180?-360:x<-180?360:0}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(a),this.transform.tileZoom)-this.transform.elevation:null}}const $n={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class jc{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$n;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=p=>{!p||p.sourceDataType!=="metadata"&&p.sourceDataType!=="visibility"&&p.dataType!=="style"&&p.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,p){const x=this._map._getUIString(`AttributionControl.${p}`);a.title=x,a.setAttribute("aria-label",x)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(B=>typeof B!="string"?"":B)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const B=this._map.style.stylesheet;this.styleOwner=B.owner,this.styleId=B.id}const p=this._map.style.sourceCaches;for(const B in p){const I=p[B];if(I.used||I.usedForTerrain){const j=I.getSource();j.attribution&&a.indexOf(j.attribution)<0&&a.push(j.attribution)}}a=a.filter(B=>String(B).trim()),a.sort((B,I)=>B.length-I.length),a=a.filter((B,I)=>{for(let j=I+1;j<a.length;j++)if(a[j].indexOf(B)>=0)return!1;return!0});const x=a.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,a.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class $i{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const p=this._container.children;if(p.length){const x=p[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&x.classList.add("maplibregl-compact"):x.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const p=R.create("a","maplibregl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://maplibre.org/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class zi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const p=++this._id;return this._queue.push({callback:a,id:p,cancelled:!1}),p}remove(a){const p=this._currentlyRunning,x=p?this._queue.concat(p):this._queue;for(const B of x)if(B.id===a)return void(B.cancelled=!0)}run(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const p=this._currentlyRunning=this._queue;this._queue=[];for(const x of p)if(!x.cancelled&&(x.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Kn=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class zu extends s.E{constructor(a){super(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,a.usedForTerrain=!0,a.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(a,p){this.sourceCache.update(a,p),this._renderableTilesKeys=[];const x={};for(const B of a.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:p}))x[B.key]=!0,this._renderableTilesKeys.push(B.key),this._tiles[B.key]||(B.posMatrix=new Float64Array(16),s.aN(B.posMatrix,0,s.W,0,s.W,0,1),this._tiles[B.key]=new hi(B,this.tileSize));for(const B in this._tiles)x[B]||delete this._tiles[B]}freeRtt(a){for(const p in this._tiles){const x=this._tiles[p];(!a||x.tileID.equals(a)||x.tileID.isChildOf(a)||a.isChildOf(x.tileID))&&(x.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a){const p={};for(const x of this._renderableTilesKeys){const B=this._tiles[x].tileID;if(B.canonical.equals(a.canonical)){const I=a.clone();I.posMatrix=new Float64Array(16),s.aN(I.posMatrix,0,s.W,0,s.W,0,1),p[x]=I}else if(B.canonical.isChildOf(a.canonical)){const I=a.clone();I.posMatrix=new Float64Array(16);const j=B.canonical.z-a.canonical.z,y=B.canonical.x-(B.canonical.x>>j<<j),E=B.canonical.y-(B.canonical.y>>j<<j),P=s.W>>j;s.aN(I.posMatrix,0,P,0,P,0,1),s.H(I.posMatrix,I.posMatrix,[-y*P,-E*P,0]),p[x]=I}else if(a.canonical.isChildOf(B.canonical)){const I=a.clone();I.posMatrix=new Float64Array(16);const j=a.canonical.z-B.canonical.z,y=a.canonical.x-(a.canonical.x>>j<<j),E=a.canonical.y-(a.canonical.y>>j<<j),P=s.W>>j;s.aN(I.posMatrix,0,s.W,0,s.W,0,1),s.H(I.posMatrix,I.posMatrix,[y*P,E*P,0]),s.J(I.posMatrix,I.posMatrix,[1/2**j,1/2**j,0]),p[x]=I}}return p}getSourceTile(a,p){const x=this.sourceCache._source;let B=a.overscaledZ-this.deltaZoom;if(B>x.maxzoom&&(B=x.maxzoom),B<x.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(B).key);let I=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!I||!I.dem)&&p)for(;B>=x.minzoom&&(!I||!I.dem);)I=this.sourceCache.getTileByID(a.scaledTo(B--).key);return I}tilesAfterTime(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(p=>p.timeAdded>=a)}}class Do{constructor(a,p,x){this.painter=a,this.sourceCache=new zu(p),this.options=x,this.exaggeration=typeof x.exaggeration=="number"?x.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;var I;if(!(p>=0&&p<B&&x>=0&&x<B))return 0;const j=this.getTerrainData(a),y=(I=j.tile)===null||I===void 0?void 0:I.dem;if(!y)return 0;const E=function(se,oe,le){var _e=oe[0],Ie=oe[1];return se[0]=le[0]*_e+le[4]*Ie+le[12],se[1]=le[1]*_e+le[5]*Ie+le[13],se}([],[p/B*s.W,x/B*s.W],j.u_terrain_matrix),P=[E[0]*y.dim,E[1]*y.dim],V=Math.floor(P[0]),q=Math.floor(P[1]),K=P[0]-V,ee=P[1]-q;return y.get(V,q)*(1-K)*(1-ee)+y.get(V+1,q)*K*(1-ee)+y.get(V,q+1)*(1-K)*ee+y.get(V+1,q+1)*K*ee}getElevationForLngLatZoom(a,p){const{tileID:x,mercatorX:B,mercatorY:I}=this._getOverscaledTileIDFromLngLatZoom(a,p);return this.getElevation(x,B%s.W,I%s.W,s.W)}getElevation(a,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;return this.getDEMElevation(a,p,x,B)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const B=this.painter.context,I=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new De(B,I,B.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new De(B,new s.R({width:1,height:1}),B.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const p=this.sourceCache.getSourceTile(a,!0);if(p&&p.dem&&(!p.demTexture||p.needsTerrainPrepare)){const B=this.painter.context;p.demTexture=this.painter.getTileTexture(p.dem.stride),p.demTexture?p.demTexture.update(p.dem.getPixels(),{premultiply:!1}):p.demTexture=new De(B,p.dem.getPixels(),B.gl.RGBA,{premultiply:!1}),p.demTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),p.needsTerrainPrepare=!1}const x=p&&p+p.tileID.key+a.key;if(x&&!this._demMatrixCache[x]){const B=this.sourceCache.sourceCache._source.maxzoom;let I=a.canonical.z-p.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=B?I=a.canonical.z-B:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const j=a.canonical.x-(a.canonical.x>>I<<I),y=a.canonical.y-(a.canonical.y>>I<<I),E=s.b9(new Float64Array(16),[1/(s.W<<I),1/(s.W<<I),0]);s.H(E,E,[j*s.W,y*s.W,0]),this._demMatrixCache[a.key]={matrix:E,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:p&&p.dem&&p.dem.dim||1,u_terrain_matrix:x?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:p&&p.dem&&p.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(p&&p.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:p}}getFramebuffer(a){const p=this.painter,x=p.width/devicePixelRatio,B=p.height/devicePixelRatio;return!this._fbo||this._fbo.width===x&&this._fbo.height===B||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new De(p.context,{width:x,height:B,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new De(p.context,{width:x,height:B,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=p.context.createFramebuffer(x,B,!0,!1),this._fbo.depthAttachment.set(p.context.createRenderbuffer(p.context.gl.DEPTH_COMPONENT16,x,B))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const p=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let I=0,j=0;I<this._coordsTextureSize;I++)for(let y=0;y<this._coordsTextureSize;y++,j+=4)p[j+0]=255&y,p[j+1]=255&I,p[j+2]=y>>8<<4|I>>8,p[j+3]=0;const x=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(p.buffer)),B=new De(a,x,a.gl.RGBA,{premultiply:!1});return B.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=B,B}pointCoordinate(a){this.painter.maybeDrawDepthAndCoords(!0);const p=new Uint8Array(4),x=this.painter.context,B=x.gl;x.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),B.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,p),x.bindFramebuffer.set(null);const I=p[0]+(p[2]>>4<<8),j=p[1]+((15&p[2])<<8),y=this.coordsIndex[255-p[3]],E=y&&this.sourceCache.getTileByID(y);if(!E)return null;const P=this._coordsTextureSize,V=(1<<E.tileID.canonical.z)*P;return new s.Y((E.tileID.canonical.x*P+I)/V+E.tileID.wrap,(E.tileID.canonical.y*P+j)/V,this.getElevation(E.tileID,I,j,P))}depthAtPoint(a){const p=new Uint8Array(4),x=this.painter.context,B=x.gl;return x.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),B.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,p),x.bindFramebuffer.set(null),(p[0]/16777216+p[1]/65536+p[2]/256+p[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const a=this.painter.context,p=new s.ba,x=new s.aX,B=this.meshSize,I=s.W/B,j=B*B;for(let q=0;q<=B;q++)for(let K=0;K<=B;K++)p.emplaceBack(K*I,q*I,0);for(let q=0;q<j;q+=B+1)for(let K=0;K<B;K++)x.emplaceBack(K+q,B+K+q+1,B+K+q+2),x.emplaceBack(K+q,B+K+q+2,K+q+1);const y=p.length,E=y+2*(B+1);for(const q of[0,1])for(let K=0;K<=B;K++)for(const ee of[0,1])p.emplaceBack(K*I,q*s.W,ee);for(let q=0;q<2*B;q+=2)x.emplaceBack(E+q,E+q+1,E+q+3),x.emplaceBack(E+q,E+q+3,E+q+2),x.emplaceBack(y+q,y+q+3,y+q+1),x.emplaceBack(y+q,y+q+2,y+q+3);const P=p.length,V=P+2*(B+1);for(const q of[0,1])for(let K=0;K<=B;K++)for(const ee of[0,1])p.emplaceBack(q*s.W,K*I,ee);for(let q=0;q<2*B;q+=2)x.emplaceBack(P+q,P+q+1,P+q+3),x.emplaceBack(P+q,P+q+3,P+q+2),x.emplaceBack(V+q,V+q+3,V+q+1),x.emplaceBack(V+q,V+q+2,V+q+3);return this._mesh={indexBuffer:a.createIndexBuffer(x),vertexBuffer:a.createVertexBuffer(p,Kn.members),segments:s.$.simpleSegment(0,0,p.length,x.length)},this._mesh}getMeshFrameDelta(a){return 2*Math.PI*s.bb/Math.pow(2,a)/5}getMinTileElevationForLngLatZoom(a,p){var x;const{tileID:B}=this._getOverscaledTileIDFromLngLatZoom(a,p);return(x=this.getMinMaxElevation(B).minElevation)!==null&&x!==void 0?x:0}getMinMaxElevation(a){const p=this.getTerrainData(a).tile,x={minElevation:null,maxElevation:null};return p&&p.dem&&(x.minElevation=p.dem.min*this.exaggeration,x.maxElevation=p.dem.max*this.exaggeration),x}_getOverscaledTileIDFromLngLatZoom(a,p){const x=s.Y.fromLngLat(a.wrap()),B=(1<<p)*s.W,I=x.x*B,j=x.y*B,y=Math.floor(I/s.W),E=Math.floor(j/s.W);return{tileID:new s.Q(p,0,p,y,E),mercatorX:I,mercatorY:j}}}class sn{constructor(a,p,x){this._context=a,this._size=p,this._tileSize=x,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){const p=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),x=new De(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return x.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),p.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),p.colorAttachment.set(x.texture),{id:a,fbo:p,texture:x,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(p=>a.id!==p),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(const p of this._recentlyUsed)if(!this._objects[p].inUse)return this._objects[p];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(const a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}const qs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ro{constructor(a,p){this.painter=a,this.terrain=p,this.pool=new sn(a.context,30,p.sourceCache.tileSize*p.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,p){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=a._order.filter(x=>!a._layers[x].isHidden(p)),this._coordsDescendingInv={};for(const x in a.sourceCaches){this._coordsDescendingInv[x]={};const B=a.sourceCaches[x].getVisibleCoordinates();for(const I of B){const j=this.terrain.sourceCache.getTerrainCoords(I);for(const y in j)this._coordsDescendingInv[x][y]||(this._coordsDescendingInv[x][y]=[]),this._coordsDescendingInv[x][y].push(j[y])}}this._coordsDescendingInvStr={};for(const x of a._order){const B=a._layers[x],I=B.source;if(qs[B.type]&&!this._coordsDescendingInvStr[I]){this._coordsDescendingInvStr[I]={};for(const j in this._coordsDescendingInv[I])this._coordsDescendingInvStr[I][j]=this._coordsDescendingInv[I][j].map(y=>y.key).sort().join()}}for(const x of this._renderableTiles)for(const B in this._coordsDescendingInvStr){const I=this._coordsDescendingInvStr[B][x.tileID.key];I&&I!==x.rttCoords[B]&&(x.rtt=[])}}renderLayer(a){if(a.isHidden(this.painter.transform.zoom))return!1;const p=a.type,x=this.painter,B=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(qs[p]&&(this._prevType&&qs[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(a.id),!B))return!0;if(qs[this._prevType]||qs[p]&&B){this._prevType=p;const I=this._stacks.length-1,j=this._stacks[I]||[];for(const y of this._renderableTiles){if(this.pool.isFull()&&(co(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(y),y.rtt[I]){const P=this.pool.getObjectForId(y.rtt[I].id);if(P.stamp===y.rtt[I].stamp){this.pool.useObject(P);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),y.rtt[I]={id:E.id,stamp:E.stamp},x.context.bindFramebuffer.set(E.fbo.framebuffer),x.context.clear({color:s.aO.transparent,stencil:0}),x.currentStencilSource=void 0;for(let P=0;P<j.length;P++){const V=x.style._layers[j[P]],q=V.source?this._coordsDescendingInv[V.source][y.tileID.key]:[y.tileID];x.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),x._renderTileClippingMasks(V,q),x.renderLayer(x,x.style.sourceCaches[V.source],V,q),V.source&&(y.rttCoords[V.source]=this._coordsDescendingInvStr[V.source][y.tileID.key])}}return co(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),qs[p]}return!1}}const pu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},$s=g,Jr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:$n,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Fn=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},Yl={showCompass:!0,showZoom:!0,visualizePitch:!1};class ec{constructor(a,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=j=>{this.startMouse(s.e({},j,{ctrlKey:!0,preventDefault:()=>j.preventDefault()}),R.mousePos(this.element,j)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=j=>{this.moveMouse(j,R.mousePos(this.element,j))},this.mouseup=j=>{this.mouseRotate.dragEnd(j),this.mousePitch&&this.mousePitch.dragEnd(j),this.offTemp()},this.touchstart=j=>{j.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,j.targetTouches)[0],this.startTouch(j,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=j=>{j.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,j.targetTouches)[0],this.moveTouch(j,this._lastPos))},this.touchend=j=>{j.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const B=a.dragRotate._mouseRotate.getClickTolerance(),I=a.dragRotate._mousePitch.getClickTolerance();this.element=p,this.mouseRotate=Li({clickTolerance:B,enable:!0}),this.touchRotate=(j=>{let{enable:y,clickTolerance:E,bearingDegreesPerPixelMoved:P=.8}=j;const V=new fl;return new Ui({clickTolerance:E,move:(q,K)=>({bearingDelta:(K.x-q.x)*P}),moveStateManager:V,enable:y,assignEvents:Fn})})({clickTolerance:B,enable:!0}),this.map=a,x&&(this.mousePitch=bc({clickTolerance:I,enable:!0}),this.touchPitch=(j=>{let{enable:y,clickTolerance:E,pitchDegreesPerPixelMoved:P=-.5}=j;const V=new fl;return new Ui({clickTolerance:E,move:(q,K)=>({pitchDelta:(K.y-q.y)*P}),moveStateManager:V,enable:y,assignEvents:Fn})})({clickTolerance:I,enable:!0})),R.addEventListener(p,"mousedown",this.mousedown),R.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(p,"touchcancel",this.reset)}startMouse(a,p){this.mouseRotate.dragStart(a,p),this.mousePitch&&this.mousePitch.dragStart(a,p),R.disableDrag()}startTouch(a,p){this.touchRotate.dragStart(a,p),this.touchPitch&&this.touchPitch.dragStart(a,p),R.disableDrag()}moveMouse(a,p){const x=this.map,{bearingDelta:B}=this.mouseRotate.dragMove(a,p)||{};if(B&&x.setBearing(x.getBearing()+B),this.mousePitch){const{pitchDelta:I}=this.mousePitch.dragMove(a,p)||{};I&&x.setPitch(x.getPitch()+I)}}moveTouch(a,p){const x=this.map,{bearingDelta:B}=this.touchRotate.dragMove(a,p)||{};if(B&&x.setBearing(x.getBearing()+B),this.touchPitch){const{pitchDelta:I}=this.touchPitch.dragMove(a,p)||{};I&&x.setPitch(x.getPitch()+I)}}off(){const a=this.element;R.removeEventListener(a,"mousedown",this.mousedown),R.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let ko;function Da(w,a,p){const x=new s.M(w.lng,w.lat);if(w=new s.M(w.lng,w.lat),a){const B=new s.M(w.lng-360,w.lat),I=new s.M(w.lng+360,w.lat),j=p.locationPoint(w).distSqr(a);p.locationPoint(B).distSqr(a)<j?w=B:p.locationPoint(I).distSqr(a)<j&&(w=I)}for(;Math.abs(w.lng-p.center.lng)>180;){const B=p.locationPoint(w);if(B.x>=0&&B.y>=0&&B.x<=p.width&&B.y<=p.height)break;w.lng>p.center.lng?w.lng-=360:w.lng+=360}return w.lng!==x.lng&&p.locationPoint(w).y>p.height/2-p.getHorizon()?w:x}const tc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qc(w,a,p){const x=w.classList;for(const B in tc)x.remove(`maplibregl-${p}-anchor-${B}`);x.add(`maplibregl-${p}-anchor-${a}`)}class Oo extends s.E{constructor(a){if(super(),this._onKeyPress=p=>{const x=p.code,B=p.charCode||p.keyCode;x!=="Space"&&x!=="Enter"&&B!==32&&B!==13||this.togglePopup()},this._onMapClick=p=>{const x=p.originalEvent.target,B=this._element;this._popup&&(x===B||B.contains(x))&&this.togglePopup()},this._update=p=>{var x;if(!this._map)return;const B=this._map.loaded()&&!this._map.isMoving();((p==null?void 0:p.type)==="terrain"||(p==null?void 0:p.type)==="render"&&!B)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Da(this._lngLat,this._flatPos,this._map.transform):(x=this._lngLat)===null||x===void 0?void 0:x.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let I="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?I=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(I=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let j="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?j="rotateX(0deg)":this._pitchAlignment==="map"&&(j=`rotateX(${this._map.getPitch()}deg)`),p&&p.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${tc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${j} ${I}`),F.frameAsync(new AbortController).then(()=>{this._updateOpacity(p&&p.type==="moveend")}).catch(()=>{})},this._onMove=p=>{if(!this._isDragging){const x=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=x}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=p=>{this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(a==null?void 0:a.opacity,a==null?void 0:a.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=s.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div"),this._element.setAttribute("aria-label","Map marker");const p=R.createNS("http://www.w3.org/2000/svg","svg"),x=41,B=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${x}px`),p.setAttributeNS(null,"width",`${B}px`),p.setAttributeNS(null,"viewBox",`0 0 ${B} ${x}`);const I=R.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");const j=R.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill-rule","nonzero");const y=R.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const _e of E){const Ie=R.createNS("http://www.w3.org/2000/svg","ellipse");Ie.setAttributeNS(null,"opacity","0.04"),Ie.setAttributeNS(null,"cx","10.5"),Ie.setAttributeNS(null,"cy","5.80029008"),Ie.setAttributeNS(null,"rx",_e.rx),Ie.setAttributeNS(null,"ry",_e.ry),y.appendChild(Ie)}const P=R.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const V=R.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(V);const q=R.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const K=R.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(K);const ee=R.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ee.setAttributeNS(null,"fill","#FFFFFF");const se=R.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(8.0, 8.0)");const oe=R.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#000000"),oe.setAttributeNS(null,"opacity","0.25"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962");const le=R.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),se.appendChild(oe),se.appendChild(le),j.appendChild(y),j.appendChild(P),j.appendChild(q),j.appendChild(ee),j.appendChild(se),p.appendChild(j),p.setAttributeNS(null,"height",x*this._scale+"px"),p.setAttributeNS(null,"width",B*this._scale+"px"),this._element.appendChild(p),this._offset=s.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),qc(this._element,this._anchor,"marker"),a&&a.className)for(const p of a.className.split(" "))this._element.classList.add(p);this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=s.M.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const B=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[B,-1*(38.1-13.5+B)],"bottom-right":[-B,-1*(38.1-13.5+B)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const a=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:a?(a.isOpen()?a.remove():(a.setLngLat(this._lngLat),a.addTo(this._map)),this):this}_updateOpacity(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var p,x;if(!(!((p=this._map)===null||p===void 0)&&p.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const B=this._map,I=B.terrain.depthAtPoint(this._pos),j=B.terrain.getElevationForLngLatZoom(this._lngLat,B.transform.tileZoom);if(B.transform.lngLatToCameraDepth(this._lngLat,j)-I<.006)return void(this._element.style.opacity=this._opacity);const y=-this._offset.y/B.transform._pixelPerMeter,E=Math.sin(B.getPitch()*Math.PI/180)*y,P=B.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),V=B.transform.lngLatToCameraDepth(this._lngLat,j+E)-P>.006;!((x=this._popup)===null||x===void 0)&&x.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=s.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,p){return a===void 0&&p===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),p!==void 0&&(this._opacityWhenCovered=p),this._map&&this._updateOpacity(!0),this}}const ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let va=0,zr=!1;const N={maxWidth:100,unit:"metric"};function A(w,a,p){const x=p&&p.maxWidth||100,B=w._container.clientHeight/2,I=w.unproject([0,B]),j=w.unproject([x,B]),y=I.distanceTo(j);if(p&&p.unit==="imperial"){const E=3.2808*y;E>5280?b(a,x,E/5280,w._getUIString("ScaleControl.Miles")):b(a,x,E,w._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?b(a,x,y/1852,w._getUIString("ScaleControl.NauticalMiles")):y>=1e3?b(a,x,y/1e3,w._getUIString("ScaleControl.Kilometers")):b(a,x,y,w._getUIString("ScaleControl.Meters"))}function b(w,a,p,x){const B=function(I){const j=Math.pow(10,`${Math.floor(I)}`.length-1);let y=I/j;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(E){const P=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*P)/P}(y),j*y}(p);w.style.width=a*(B/p)+"px",w.innerHTML=`${B}&nbsp;${x}`}const L={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},O=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function z(w){if(w){if(typeof w=="number"){const a=Math.round(Math.abs(w)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,w),"top-left":new s.P(a,a),"top-right":new s.P(-a,a),bottom:new s.P(0,-w),"bottom-left":new s.P(a,-a),"bottom-right":new s.P(-a,-a),left:new s.P(w,0),right:new s.P(-w,0)}}if(w instanceof s.P||Array.isArray(w)){const a=s.P.convert(w);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:s.P.convert(w.center||[0,0]),top:s.P.convert(w.top||[0,0]),"top-left":s.P.convert(w["top-left"]||[0,0]),"top-right":s.P.convert(w["top-right"]||[0,0]),bottom:s.P.convert(w.bottom||[0,0]),"bottom-left":s.P.convert(w["bottom-left"]||[0,0]),"bottom-right":s.P.convert(w["bottom-right"]||[0,0]),left:s.P.convert(w.left||[0,0]),right:s.P.convert(w.right||[0,0])}}return z(new s.P(0,0))}const X=g;l.AJAXError=s.be,l.Evented=s.E,l.LngLat=s.M,l.MercatorCoordinate=s.Y,l.Point=s.P,l.addProtocol=s.bf,l.config=s.a,l.removeProtocol=s.bg,l.AttributionControl=jc,l.BoxZoomHandler=Nn,l.CanvasSource=ci,l.CooperativeGesturesHandler=sr,l.DoubleClickZoomHandler=fu,l.DragPanHandler=_a,l.DragRotateHandler=to,l.EdgeInsets=yo,l.FullscreenControl=class extends s.E{constructor(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var a;let p=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((a=p==null?void 0:p.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)p=p.shadowRoot.fullscreenElement;p===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},l.GeoJSONSource=ht,l.GeolocateControl=class extends s.E{constructor(w){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",a)),this._finish()}},this._updateCamera=a=>{const p=new s.M(a.coords.longitude,a.coords.latitude),x=a.coords.accuracy,B=this._map.getBearing(),I=s.e({bearing:B},this.options.fitBoundsOptions),j=kt.fromLngLat(p,x);this._map.fitBounds(j,I,{geolocateSource:!0})},this._updateMarker=a=>{if(a){const p=new s.M(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=a=>{if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&zr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=a=>{if(this._map){if(this._container.addEventListener("contextmenu",p=>p.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",a===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}else{const p=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Oo({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Oo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",p=>{p.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p.originalEvent&&p.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},ic,w)}onAdd(w){return this._map=w,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return s._(this,arguments,void 0,function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(ko!==void 0&&!a)return ko;if(window.navigator.permissions===void 0)return ko=!!window.navigator.geolocation,ko;try{ko=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ko=!!window.navigator.geolocation}return ko}()})}().then(a=>this._setupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,va=0,zr=!1}_isOutOfMapMaxBounds(w){const a=this._map.getMaxBounds(),p=w.coords;return a&&(p.longitude<a.getWest()||p.longitude>a.getEast()||p.latitude<a.getSouth()||p.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),a=w.getSouthEast(),p=w.getNorthEast(),x=a.distanceTo(p),B=Math.ceil(this._accuracy/(x/this._map._container.clientHeight)*2);this._circleElement.style.width=`${B}px`,this._circleElement.style.height=`${B}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":va--,zr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),va++,va>1?(w={maximumAge:6e5,timeout:0},zr=!0):(w=this.options.positionOptions,zr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},l.Hash=Js,l.ImageSource=oi,l.KeyboardHandler=vn,l.LngLatBounds=kt,l.LogoControl=$i,l.Map=class extends nA{constructor(w){if(s.bc.mark(s.bd.create),(w=s.e({},Jr,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new tl(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new zi,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},pu,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=be.addThrottleControl(()=>this.isMoving()),this._requestManager=new qe(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const p=Po(x=>{this._trackResize&&!this._removed&&this.resize(x)._update()},50);this._resizeObserver=new ResizeObserver(x=>{a?p(x):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ks(this,w),this._hash=w.hash&&new Js(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,s.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new jc(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new $i,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new s.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(w,a){if(a===void 0&&(a=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=w.onAdd(this);this._controls.push(w);const x=this._controlPositions[a];return a.indexOf("bottom")!==-1?x.insertBefore(p,x.firstChild):x.appendChild(p),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(w);return a>-1&&this._controls.splice(a,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,a,p,x){return x==null&&this.terrain&&(x=this.terrain.getElevationForLngLatZoom(p,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,a,p,x)}resize(w){var a;const p=this._containerDimensions(),x=p[0],B=p[1],I=this._getClampedPixelRatio(x,B);if(this._resizeCanvas(x,B,I),this.painter.resize(x,B,I),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const E=this._getClampedPixelRatio(x,B);this._resizeCanvas(x,B,E),this.painter.resize(x,B,E)}this.transform.resize(x,B),(a=this._requestedCameraState)===null||a===void 0||a.resize(x,B);const j=!this._moving;return j&&(this.stop(),this.fire(new s.k("movestart",w)).fire(new s.k("move",w))),this.fire(new s.k("resize",w)),j&&this.fire(new s.k("moveend",w)),this}_getClampedPixelRatio(w,a){const{0:p,1:x}=this._maxCanvasSize,B=this.getPixelRatio(),I=w*B,j=a*B;return Math.min(I>p?p/I:1,j>x?x/j:1)*B}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(kt.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(s.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(s.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,a,p){if(w==="mouseenter"||w==="mouseover"){let x=!1;return{layer:a,listener:p,delegates:{mousemove:I=>{const j=this.getLayer(a)?this.queryRenderedFeatures(I.point,{layers:[a]}):[];j.length?x||(x=!0,p.call(this,new ln(w,this,I.originalEvent,{features:j}))):x=!1},mouseout:()=>{x=!1}}}}if(w==="mouseleave"||w==="mouseout"){let x=!1;return{layer:a,listener:p,delegates:{mousemove:j=>{(this.getLayer(a)?this.queryRenderedFeatures(j.point,{layers:[a]}):[]).length?x=!0:x&&(x=!1,p.call(this,new ln(w,this,j.originalEvent)))},mouseout:j=>{x&&(x=!1,p.call(this,new ln(w,this,j.originalEvent)))}}}}{const x=B=>{const I=this.getLayer(a)?this.queryRenderedFeatures(B.point,{layers:[a]}):[];I.length&&(B.features=I,p.call(this,B),delete B.features)};return{layer:a,listener:p,delegates:{[w]:x}}}}on(w,a,p){if(p===void 0)return super.on(w,a);const x=this._createDelegatedListener(w,a,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(x);for(const B in x.delegates)this.on(B,x.delegates[B]);return this}once(w,a,p){if(p===void 0)return super.once(w,a);const x=this._createDelegatedListener(w,a,p);for(const B in x.delegates)this.once(B,x.delegates[B]);return this}off(w,a,p){return p===void 0?super.off(w,a):(this._delegatedListeners&&this._delegatedListeners[w]&&(x=>{const B=this._delegatedListeners[w];for(let I=0;I<B.length;I++){const j=B[I];if(j.layer===a&&j.listener===p){for(const y in j.delegates)this.off(y,j.delegates[y]);return B.splice(I,1),this}}})(),this)}queryRenderedFeatures(w,a){if(!this.style)return[];let p;const x=w instanceof s.P||Array.isArray(w),B=x?w:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(x?{}:w)||{},B instanceof s.P||typeof B[0]=="number")p=[s.P.convert(B)];else{const I=s.P.convert(B[0]),j=s.P.convert(B[1]);p=[I,new s.P(j.x,I.y),j,new s.P(I.x,j.y),I]}return this.style.queryRenderedFeatures(p,a,this.transform)}querySourceFeatures(w,a){return this.style.querySourceFeatures(w,a)}setStyle(w,a){return(a=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(w,a))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const a=this._locale[w];if(a==null)throw new Error(`Missing UI string '${w}'`);return a}_updateStyle(w,a){if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,a));const p=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new Gr(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,a,p):this.style.loadJSON(w,a,p),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Gr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,a){if(typeof w=="string"){const p=this._requestManager.transformRequest(w,Te.Style);s.h(p,new AbortController).then(x=>{this._updateDiff(x.data,a)}).catch(x=>{x&&this.fire(new s.j(x))})}else typeof w=="object"&&this._updateDiff(w,a)}_updateDiff(w,a){try{this.style.setState(w,a)&&this._update(!0)}catch(p){s.w(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(w,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(w,a){return this._lazyInitEmptyStyle(),this.style.addSource(w,a),this._update(!0)}isSourceLoaded(w){const a=this.style&&this.style.sourceCaches[w];if(a!==void 0)return a.loaded();this.fire(new s.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const a=this.style.sourceCaches[w.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&a.reload();for(const p in this.style._layers){const x=this.style._layers[p];x.type==="hillshade"&&x.source===w.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Do(this.painter,a,w),this.painter.renderToTexture=new Ro(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=p=>{p.dataType==="style"?this.terrain.sourceCache.freeRtt():p.dataType==="source"&&p.tile&&(p.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(p.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:w})),this}getTerrain(){var w,a;return(a=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&a!==void 0?a:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const a in w){const p=w[a]._tiles;for(const x in p){const B=p[x];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,a){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:x=1,sdf:B=!1,stretchX:I,stretchY:j,content:y}=p;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||s.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:P,data:V}=a,q=a;return this.style.addImage(w,{data:new s.R({width:E,height:P},new Uint8Array(V)),pixelRatio:x,stretchX:I,stretchY:j,content:y,sdf:B,version:0,userImage:q}),q.onAdd&&q.onAdd(this,w),this}}{const{width:E,height:P,data:V}=F.getImageData(a);this.style.addImage(w,{data:new s.R({width:E,height:P},V),pixelRatio:x,stretchX:I,stretchY:j,content:y,sdf:B,version:0})}}updateImage(w,a){const p=this.style.getImage(w);if(!p)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=a instanceof HTMLImageElement||s.b(a)?F.getImageData(a):a,{width:B,height:I,data:j}=x;if(B===void 0||I===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(B!==p.data.width||I!==p.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const y=!(a instanceof HTMLImageElement||s.b(a));return p.data.replace(j,y),this.style.updateImage(w,p),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return be.getImage(this._requestManager.transformRequest(w,Te.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,a){return this._lazyInitEmptyStyle(),this.style.addLayer(w,a),this._update(!0)}moveLayer(w,a){return this.style.moveLayer(w,a),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,a,p){return this.style.setLayerZoomRange(w,a,p),this._update(!0)}setFilter(w,a){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(w,a,p),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,a,p){let x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(w,a,p,x),this._update(!0)}getPaintProperty(w,a){return this.style.getPaintProperty(w,a)}setLayoutProperty(w,a,p){let x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(w,a,p,x),this._update(!0)}getLayoutProperty(w,a){return this.style.getLayoutProperty(w,a)}setGlyphs(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,a){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(w,a,p,x=>{x||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(w,a,p=>{p||this._update(!0)}),this}setLight(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(w,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,a){return this.style.setFeatureState(w,a),this._update()}removeFeatureState(w,a){return this.style.removeFeatureState(w,a),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,a=0;return this._container&&(w=this._container.clientWidth||400,a=this._container.clientHeight||300),[w,a]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const a=this._canvasContainer=R.create("div","maplibregl-canvas-container",w);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const p=this._containerDimensions(),x=this._getClampedPixelRatio(p[0],p[1]);this._resizeCanvas(p[0],p[1],x);const B=this._controlContainer=R.create("div","maplibregl-control-container",w),I=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(j=>{I[j]=R.create("div",`maplibregl-ctrl-${j} `,B)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,a,p){this._canvas.width=Math.floor(p*w),this._canvas.height=Math.floor(p*a),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let a=null;this._canvas.addEventListener("webglcontextcreationerror",x=>{a={requestedAttributes:w},x&&(a.statusMessage=x.statusMessage,a.type=x.type)},{once:!0});const p=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!p){const x="Failed to initialize WebGL";throw a?(a.message=x,new Error(JSON.stringify(a))):new Error(x)}this.painter=new ys(p,this.transform),U.testSupport(p)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const a=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let p=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,I=F.now();this.style.zoomHistory.update(B,I);const j=new s.a8(B,{now:I,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),y=j.crossFadingFactor();y===1&&y===this._crossFadingFactor||(p=!0,this._crossFadingFactor=y),this.style.update(j)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bc.mark(s.bd.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,s.bc.mark(s.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const p of this._controls)p.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),be.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bc.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(w=>{s.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return $s}getCameraTargetElevation(){return this.transform.elevation}},l.MapMouseEvent=ln,l.MapTouchEvent=qn,l.MapWheelEvent=os,l.Marker=Oo,l.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const a=this._map.getZoom(),p=a===this._map.getMaxZoom(),x=a===this._map.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())},this._rotateCompassArrow=()=>{const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a},this._setButtonTitle=(a,p)=>{const x=this._map._getUIString(`NavigationControl.${p}`);a.title=x,a.setAttribute("aria-label",x)},this.options=s.e({},Yl,w),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ec(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,a){const p=R.create("button",w,this._container);return p.type="button",p.addEventListener("click",a),p}},l.Popup=class extends s.E{constructor(w){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{var p;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Da(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._trackPointer&&!a)return;const x=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationPoint(this._lngLat));let B=this.options.anchor;const I=z(this.options.offset);if(!B){const y=this._container.offsetWidth,E=this._container.offsetHeight;let P;P=x.y+I.bottom.y<E?["top"]:x.y>this._map.transform.height-E?["bottom"]:[],x.x<y/2?P.push("left"):x.x>this._map.transform.width-y/2&&P.push("right"),B=P.length===0?"bottom":P.join("-")}let j=x.add(I[B]);this.options.subpixelPositioning||(j=j.round()),R.setTransform(this._container,`${tc[B]} translate(${j.x}px,${j.y}px)`),qc(this._container,B,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(L),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=s.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const a=document.createDocumentFragment(),p=document.createElement("body");let x;for(p.innerHTML=w;x=p.firstChild,x;)a.appendChild(x);return this.setDOMContent(a)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(O);w&&w.focus()}},l.RasterDEMTileSource=ti,l.RasterTileSource=Oi,l.ScaleControl=class{constructor(w){this._onMove=()=>{A(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,A(this._map,this._container,this.options)},this.options=s.e({},N,w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},l.ScrollZoomHandler=gl,l.Style=Gr,l.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},l.TwoFingersTouchPitchHandler=Vc,l.TwoFingersTouchRotateHandler=Qc,l.TwoFingersTouchZoomHandler=Zl,l.TwoFingersTouchZoomRotateHandler=Ei,l.VectorTileSource=wt,l.VideoSource=gi,l.addSourceType=(w,a)=>s._(void 0,void 0,void 0,function*(){if(tr(w))throw new Error(`A source type called "${w}" already exists.`);((p,x)=>{Ki[p]=x})(w,a)}),l.clearPrewarmedResources=function(){const w=mt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(Xe),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},l.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},l.getRTLTextPluginStatus=function(){return Wi().getRTLTextPluginStatus()},l.getVersion=function(){return X},l.getWorkerCount=function(){return it.workerCount},l.getWorkerUrl=function(){return s.a.WORKER_URL},l.importScriptInWorkers=function(w){return qt().broadcast("importScript",w)},l.prewarm=function(){Dt().acquire(Xe)},l.setMaxParallelImageRequests=function(w){s.a.MAX_PARALLEL_IMAGE_REQUESTS=w},l.setRTLTextPlugin=function(w,a){return Wi().setRTLTextPlugin(w,a)},l.setWorkerCount=function(w){it.workerCount=w},l.setWorkerUrl=function(w){s.a.WORKER_URL=w}});var o=t;return o})})(zI);var y8=zI.exports;const El=Um(y8);var Na;(function(i){i[i.Unknown=0]="Unknown",i[i.Point=1]="Point",i[i.LineString=2]="LineString",i[i.Polygon=3]="Polygon",i[i.MultiPoint=4]="MultiPoint",i[i.MultiLineString=5]="MultiLineString",i[i.MultiPolygon=6]="MultiPolygon",i[i.GeometryCollection=7]="GeometryCollection",i[i.CircularString=8]="CircularString",i[i.CompoundCurve=9]="CompoundCurve",i[i.CurvePolygon=10]="CurvePolygon",i[i.MultiCurve=11]="MultiCurve",i[i.MultiSurface=12]="MultiSurface",i[i.Curve=13]="Curve",i[i.Surface=14]="Surface",i[i.PolyhedralSurface=15]="PolyhedralSurface",i[i.TIN=16]="TIN",i[i.Triangle=17]="Triangle"})(Na||(Na={}));const Nm=4,zm=4,Qm=4,ed=new Int32Array(2),QI=new Float32Array(ed.buffer),VI=new Float64Array(ed.buffer),T_=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Yx;(function(i){i[i.UTF8_BYTES=1]="UTF8_BYTES",i[i.UTF16_STRING=2]="UTF16_STRING"})(Yx||(Yx={}));class mA{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new mA(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return ed[0]=this.readInt32(e),QI[0]}readFloat64(e){return ed[T_?0:1]=this.readInt32(e),ed[T_?1:0]=this.readInt32(e+4),VI[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){QI[0]=t,this.writeInt32(e,ed[0])}writeFloat64(e,t){VI[0]=t,this.writeInt32(e,ed[T_?0:1]),this.writeInt32(e+4,ed[T_?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Nm+zm)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<zm;t++)e+=String.fromCharCode(this.readInt8(this.position_+Nm+t));return e}__offset(e,t){const r=e-this.readInt32(e);return t<this.readInt16(r)?this.readInt16(r+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const r=this.readInt32(e);e+=Nm;const n=this.bytes_.subarray(e,e+r);return t===Yx.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Nm}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=zm)throw new Error("FlatBuffers: file identifier must be length "+zm);for(let t=0;t<zm;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Nm+t))return!1;return!0}createScalarList(e,t){const r=[];for(let n=0;n<t;++n){const o=e(n);o!==null&&r.push(o)}return r}createObjList(e,t){const r=[];for(let n=0;n<t;++n){const o=e(n);o!==null&&r.push(o.unpack())}return r}}let _8=class Xc{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new Xc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Qm),(t||new Xc).__init(e.readInt32(e.position())+e.position(),e)}ends(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}endsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){const e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}xyLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}zLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}mLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}tLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){const e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+e*8):BigInt(0)}tmLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):Na.Unknown}parts(e,t){const r=this.bb.__offset(this.bb_pos,18);return r?(t||new Xc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}partsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addInt32(t[r]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addInt64(t[r]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,Na.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,r,n,o,l,s,g,v){return Xc.startGeometry(e),Xc.addEnds(e,t),Xc.addXy(e,r),Xc.addZ(e,n),Xc.addM(e,o),Xc.addT(e,l),Xc.addTm(e,s),Xc.addType(e,g),Xc.addParts(e,v),Xc.endGeometry(e)}};function ew(i,e){const t=[];for(let r=0;r<i.length;r+=2){const n=[i[r],i[r+1]];e&&n.push(e[r>>1]),t.push(n)}return t}function HI(i,e,t){if(!t||t.length===0)return[ew(i,e)];let r=0;const n=Array.from(t).map(l=>i.slice(r,r=l<<1));let o;return e&&(r=0,o=Array.from(t).map(l=>e.slice(r,r=l))),n.map((l,s)=>ew(l,o?o[s]:void 0))}function v8(i,e){const t=i.xyArray(),r=i.zArray();switch(e){case Na.Point:{const n=Array.from(t);return r&&n.push(r[0]),n}case Na.MultiPoint:case Na.LineString:return ew(t,r);case Na.MultiLineString:return HI(t,r,i.endsArray());case Na.Polygon:return HI(t,r,i.endsArray())}}function tw(i,e){let t=e;if(t===Na.Unknown&&(t=i.type()),t===Na.GeometryCollection){const n=[];for(let o=0;o<i.partsLength();o++){const l=i.parts(o),s=l.type();n.push(tw(l,s))}return{type:Na[t],geometries:n}}else if(t===Na.MultiPolygon){const n=[];for(let o=0;o<i.partsLength();o++)n.push(tw(i.parts(o),Na.Polygon));return{type:Na[t],coordinates:n.map(o=>o.coordinates)}}const r=v8(i,t);return{type:Na[t],coordinates:r}}var za;(function(i){i[i.Byte=0]="Byte",i[i.UByte=1]="UByte",i[i.Bool=2]="Bool",i[i.Short=3]="Short",i[i.UShort=4]="UShort",i[i.Int=5]="Int",i[i.UInt=6]="UInt",i[i.Long=7]="Long",i[i.ULong=8]="ULong",i[i.Float=9]="Float",i[i.Double=10]="Double",i[i.String=11]="String",i[i.Json=12]="Json",i[i.DateTime=13]="DateTime",i[i.Binary=14]="Binary"})(za||(za={}));class Qa{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Qa).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Qm),(t||new Qa).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):za.Byte}title(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){const e=this.bb.__offset(this.bb_pos,18);return e?!!this.bb.readInt8(this.bb_pos+e):!0}unique(){const e=this.bb.__offset(this.bb_pos,20);return e?!!this.bb.readInt8(this.bb_pos+e):!1}primaryKey(){const e=this.bb.__offset(this.bb_pos,22);return e?!!this.bb.readInt8(this.bb_pos+e):!1}metadata(e){const t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,za.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){const t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,r,n,o,l,s,g,v,T,F,R){return Qa.startColumn(e),Qa.addName(e,t),Qa.addType(e,r),Qa.addTitle(e,n),Qa.addDescription(e,o),Qa.addWidth(e,l),Qa.addPrecision(e,s),Qa.addScale(e,g),Qa.addNullable(e,v),Qa.addUnique(e,T),Qa.addPrimaryKey(e,F),Qa.addMetadata(e,R),Qa.endColumn(e)}}class Xu{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new Xu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Qm),(t||new Xu).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){const t=this.bb.__offset(this.bb_pos,4);return t?(e||new _8).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){const r=this.bb.__offset(this.bb_pos,8);return r?(t||new Qa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let r=t.length-1;r>=0;r--)e.addInt8(t[r]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,r,n){return Xu.startFeature(e),Xu.addGeometry(e,t),Xu.addProperties(e,r),Xu.addColumns(e,n),Xu.endFeature(e)}}new TextEncoder;const GI=new TextDecoder;function b8(i,e){const t={};if(!e||e.length===0)return t;const r=i.propertiesArray();if(!r)return t;const n=new DataView(r.buffer,r.byteOffset),o=i.propertiesLength();let l=0;for(;l<o;){const s=n.getUint16(l,!0);l+=2;const g=e[s],v=g.name;switch(g.type){case za.Bool:{t[v]=!!n.getUint8(l),l+=1;break}case za.Byte:{t[v]=n.getInt8(l),l+=1;break}case za.UByte:{t[v]=n.getUint8(l),l+=1;break}case za.Short:{t[v]=n.getInt16(l,!0),l+=2;break}case za.UShort:{t[v]=n.getUint16(l,!0),l+=2;break}case za.Int:{t[v]=n.getInt32(l,!0),l+=4;break}case za.UInt:{t[v]=n.getUint32(l,!0),l+=4;break}case za.Long:{t[v]=Number(n.getBigInt64(l,!0)),l+=8;break}case za.ULong:{t[v]=Number(n.getBigUint64(l,!0)),l+=8;break}case za.Float:{t[v]=n.getFloat32(l,!0),l+=4;break}case za.Double:{t[v]=n.getFloat64(l,!0),l+=8;break}case za.DateTime:case za.String:{const T=n.getUint32(l,!0);l+=4,t[v]=GI.decode(r.subarray(l,l+T)),l+=T;break}case za.Json:{const T=n.getUint32(l,!0);l+=4;const F=GI.decode(r.subarray(l,l+T));t[v]=JSON.parse(F),l+=T;break}default:throw new Error("Unknown type "+g.type)}}return t}function iw(i,e){const t=e.columns;return{type:"Feature",geometry:tw(i.geometry(),e.geometryType),properties:b8(i,t)}}const rw=new Uint8Array(0);function x8(){return this._source.cancel()}function w8(i,e){if(!i.length)return e;if(!e.length)return i;var t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function B8(){var i=this,e=i._array.subarray(i._index);return i._source.read().then(function(t){return i._array=rw,i._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:w8(e,t.value)}})}function C8(i){if((i|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+i<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=i));var r=new Uint8Array(i);return r.set(this._array.subarray(this._index)),function n(){return e._source.read().then(function(o){return o.done?(e._array=rw,e._index=0,t>0?r.subarray(0,t):null):t+o.value.length>=i?(e._array=o.value,e._index=i-t,r.set(o.value.subarray(0,i-t),t),r):(r.set(o.value,t),t+=o.value.length,n())})}()}function E8(i){return typeof i.slice=="function"?i:new I_(typeof i.read=="function"?i:i.getReader())}function I_(i){this._source=i,this._array=rw,this._index=0}I_.prototype.read=B8,I_.prototype.slice=C8,I_.prototype.cancel=x8;class wu{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new wu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Qm),(t||new wu).__init(e.readInt32(e.position())+e.position(),e)}org(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,r,n,o,l,s){return wu.startCrs(e),wu.addOrg(e,t),wu.addCode(e,r),wu.addName(e,n),wu.addDescription(e,o),wu.addWkt(e,l),wu.addCodeString(e,s),wu.endCrs(e)}}class L_{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new L_).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Qm),(t||new L_).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}envelopeLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Na.Unknown}hasZ(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasM(){const e=this.bb.__offset(this.bb_pos,12);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasT(){const e=this.bb.__offset(this.bb_pos,14);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasTm(){const e=this.bb.__offset(this.bb_pos,16);return e?!!this.bb.readInt8(this.bb_pos+e):!1}columns(e,t){const r=this.bb.__offset(this.bb_pos,18);return r?(t||new Qa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){const e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){const t=this.bb.__offset(this.bb_pos,24);return t?(e||new wu).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){const t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){const t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,Na.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function nw(i){const e=L_.getRootAsHeader(i),t=e.featuresCount(),r=e.indexNodeSize(),n=[];for(let g=0;g<e.columnsLength();g++){const v=e.columns(g);if(!v)throw new Error("Column unexpectedly missing");if(!v.name())throw new Error("Column name unexpectedly missing");n.push({name:v.name(),type:v.type(),title:v.title(),description:v.description(),width:v.width(),precision:v.precision(),scale:v.scale(),nullable:v.nullable(),unique:v.unique(),primary_key:v.primaryKey()})}const o=e.crs(),l=o?{org:o.org(),code:o.code(),name:o.name(),description:o.description(),wkt:o.wkt(),code_string:o.codeString()}:null;return{geometryType:e.geometryType(),columns:n,envelope:null,featuresCount:Number(t),indexNodeSize:r,crs:l,title:e.title(),description:e.description(),metadata:e.metadata()}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var sw=function(i,e){return sw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},sw(i,e)};function S8(i,e){sw(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function zp(i,e,t,r){function n(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function s(T){try{v(r.next(T))}catch(F){l(F)}}function g(T){try{v(r.throw(T))}catch(F){l(F)}}function v(T){T.done?o(T.value):n(T.value).then(s,g)}v((r=r.apply(i,e||[])).next())})}function td(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(v){return function(T){return g([v,T])}}function g(v){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,n&&(o=v[0]&2?n.return:v[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,v[1])).done)return o;switch(n=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,n=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=e.call(i,t)}catch(T){v=[6,T],n=0}finally{r=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function Qp(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],r=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Vm(i){return this instanceof Vm?(this.v=i,this):new Vm(i)}function T8(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(i,e||[]),n,o=[];return n={},l("next"),l("throw"),l("return"),n[Symbol.asyncIterator]=function(){return this},n;function l(R){r[R]&&(n[R]=function(U){return new Promise(function(J,te){o.push([R,U,J,te])>1||s(R,U)})})}function s(R,U){try{g(r[R](U))}catch(J){F(o[0][3],J)}}function g(R){R.value instanceof Vm?Promise.resolve(R.value.v).then(v,T):F(o[0][2],R)}function v(R){s("next",R)}function T(R){s("throw",R)}function F(R,U){R(U),o.shift(),o.length&&s(o[0][0],o[0][1])}}var jI=function(i){S8(e,i);function e(t){var r=i.call(this,t)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return e}(Error);(function(){function i(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),i.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})(),function(){function i(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i}(),function(){function i(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i}();function ow(i){i!=null&&typeof i.then=="function"&&i.then(F_,F_)}var aw=0,qI=1,uf=2,M_=3,lw=4,P_=1024,F_=function(){};function Vp(i){var e=i.err,t=Promise.resolve(i.execution).then(function(r){if(e!=null)throw e;return r});return i.err=void 0,i.execution=t.then(function(){},function(){}),i.pending===void 0?t:i.pending.then(function(){return t})}function hf(i,e){var t=i.state>=M_;return Promise.resolve(e).then(function(r){return!t&&i.state>=lw?Vp(i).then(function(n){return{value:n,done:!0}}):{value:r,done:t}})}function cw(i,e){var t,r;if(!(i.state>=uf))if(i.state=uf,i.onnext(),i.onstop(),i.err==null&&(i.err=e),i.pushes.length===0&&(typeof i.buffer>"u"||i.buffer.empty))Hm(i);else try{for(var n=Qp(i.pushes),o=n.next();!o.done;o=n.next()){var l=o.value;l.resolve()}}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}function Hm(i){var e,t;if(!(i.state>=M_)){i.state<uf&&cw(i),i.state=M_,i.buffer=void 0;try{for(var r=Qp(i.nexts),n=r.next();!n.done;n=r.next()){var o=n.value,l=i.pending===void 0?Vp(i):i.pending.then(function(){return Vp(i)});o.resolve(hf(i,l))}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}i.pushes=[],i.nexts=[]}}function $I(i){i.state>=lw||(i.state<M_&&Hm(i),i.state=lw)}function I8(i,e){if(ow(e),i.pushes.length>=P_)throw new jI("No more than "+P_+" pending calls to push are allowed on a single repeater.");if(i.state>=uf)return Promise.resolve(void 0);var t=i.pending===void 0?Promise.resolve(e):i.pending.then(function(){return e});t=t.catch(function(g){i.state<uf&&(i.err=g),$I(i)});var r;if(i.nexts.length){var n=i.nexts.shift();n.resolve(hf(i,t)),i.nexts.length?r=Promise.resolve(i.nexts[0].value):r=new Promise(function(g){return i.onnext=g})}else typeof i.buffer<"u"&&!i.buffer.full?(i.buffer.add(t),r=Promise.resolve(void 0)):r=new Promise(function(g){return i.pushes.push({resolve:g,value:t})});var o=!0,l={},s=r.catch(function(g){if(o)throw g});return l.then=function(g,v){return o=!1,Promise.prototype.then.call(r,g,v)},l.catch=function(g){return o=!1,Promise.prototype.catch.call(r,g)},l.finally=r.finally.bind(r),i.pending=t.then(function(){return s}).catch(function(g){i.err=g,$I(i)}),l}function L8(i){var e=cw.bind(null,i),t=new Promise(function(r){return i.onstop=r});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function M8(i){if(!(i.state>=qI)){i.state=qI;var e=I8.bind(null,i),t=L8(i);i.execution=new Promise(function(r){return r(i.executor(e,t))}),i.execution.catch(function(){return cw(i)})}}var D_=new WeakMap,Gm=function(){function i(e,t){D_.set(this,{executor:e,buffer:t,err:void 0,state:aw,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:F_,onstop:F_})}return i.prototype.next=function(e){ow(e);var t=D_.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=P_)throw new jI("No more than "+P_+" pending calls to next are allowed on a single repeater.");if(t.state<=aw&&M8(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var r=hf(t,t.buffer.remove());if(t.pushes.length){var n=t.pushes.shift();t.buffer.add(n.value),t.onnext=n.resolve}return r}else if(t.pushes.length){var o=t.pushes.shift();return t.onnext=o.resolve,hf(t,o.value)}else if(t.state>=uf)return Hm(t),hf(t,Vp(t));return new Promise(function(l){return t.nexts.push({resolve:l,value:e})})},i.prototype.return=function(e){ow(e);var t=D_.get(this);if(t===void 0)throw new Error("WeakMap error");return Hm(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),hf(t,Vp(t))},i.prototype.throw=function(e){var t=D_.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=aw||t.state>=uf||typeof t.buffer<"u"&&!t.buffer.empty?(Hm(t),t.err==null&&(t.err=e),hf(t,Vp(t))):this.next(Promise.reject(e))},i.prototype[Symbol.asyncIterator]=function(){return this},i.race=P8,i.merge=F8,i.zip=D8,i.latest=R8,i}();function R_(i,e){var t,r,n=[],o=function(v){v!=null&&typeof v[Symbol.asyncIterator]=="function"?n.push(v[Symbol.asyncIterator]()):v!=null&&typeof v[Symbol.iterator]=="function"?n.push(v[Symbol.iterator]()):n.push(function(){return T8(this,arguments,function(){return td(this,function(R){switch(R.label){case 0:return e.yieldValues?[4,Vm(v)]:[3,3];case 1:return[4,R.sent()];case 2:R.sent(),R.label=3;case 3:return e.returnValues?[4,Vm(v)]:[3,5];case 4:return[2,R.sent()];case 5:return[2]}})})}())};try{for(var l=Qp(i),s=l.next();!s.done;s=l.next()){var g=s.value;o(g)}}catch(v){t={error:v}}finally{try{s&&!s.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return n}function P8(i){var e=this,t=R_(i,{returnValues:!0});return new Gm(function(r,n){return zp(e,void 0,void 0,function(){var o,l,s,g,v,T;return td(this,function(F){switch(F.label){case 0:if(!t.length)return n(),[2];l=!1,n.then(function(){o(),l=!0}),F.label=1;case 1:F.trys.push([1,,5,7]),g=void 0,v=0,T=function(){var R,U,J,te,Ae,he;return td(this,function(pe){switch(pe.label){case 0:R=v;try{for(U=(Ae=void 0,Qp(t)),J=U.next();!J.done;J=U.next())te=J.value,Promise.resolve(te.next()).then(function(be){be.done?(n(),s===void 0&&(s=be)):v===R&&(v++,o(be))},function(be){return n(be)})}catch(be){Ae={error:be}}finally{try{J&&!J.done&&(he=U.return)&&he.call(U)}finally{if(Ae)throw Ae.error}}return[4,new Promise(function(be){return o=be})];case 1:return g=pe.sent(),g===void 0?[3,3]:[4,r(g.value)];case 2:pe.sent(),pe.label=3;case 3:return[2]}})},F.label=2;case 2:return l?[3,4]:[5,T()];case 3:return F.sent(),[3,2];case 4:return[2,s&&s.value];case 5:return n(),[4,Promise.race(t.map(function(R){return R.return&&R.return()}))];case 6:return F.sent(),[7];case 7:return[2]}})})})}function F8(i){var e=this,t=R_(i,{yieldValues:!0});return new Gm(function(r,n){return zp(e,void 0,void 0,function(){var o,l,s,g=this;return td(this,function(v){switch(v.label){case 0:if(!t.length)return n(),[2];o=[],l=!1,n.then(function(){var T,F;l=!0;try{for(var R=Qp(o),U=R.next();!U.done;U=R.next()){var J=U.value;J()}}catch(te){T={error:te}}finally{try{U&&!U.done&&(F=R.return)&&F.call(R)}finally{if(T)throw T.error}}}),v.label=1;case 1:return v.trys.push([1,,3,4]),[4,Promise.all(t.map(function(T,F){return zp(g,void 0,void 0,function(){var R,U;return td(this,function(J){switch(J.label){case 0:J.trys.push([0,,6,9]),J.label=1;case 1:return l?[3,5]:(Promise.resolve(T.next()).then(function(te){return o[F](te)},function(te){return n(te)}),[4,new Promise(function(te){o[F]=te})]);case 2:return R=J.sent(),R===void 0?[3,4]:R.done?(s=R,[2]):[4,r(R.value)];case 3:J.sent(),J.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return U=T.return,U?[4,T.return()]:[3,8];case 7:U=J.sent(),J.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return v.sent(),[2,s&&s.value];case 3:return n(),[7];case 4:return[2]}})})})}function D8(i){var e=this,t=R_(i,{returnValues:!0});return new Gm(function(r,n){return zp(e,void 0,void 0,function(){var o,l,s,g;return td(this,function(v){switch(v.label){case 0:if(!t.length)return n(),[2,[]];l=!1,n.then(function(){o(),l=!0}),v.label=1;case 1:v.trys.push([1,,6,8]),v.label=2;case 2:return l?[3,5]:(Promise.all(t.map(function(T){return T.next()})).then(function(T){return o(T)},function(T){return n(T)}),[4,new Promise(function(T){return o=T})]);case 3:return s=v.sent(),s===void 0?[2]:(g=s.map(function(T){return T.value}),s.some(function(T){return T.done})?[2,g]:[4,r(g)]);case 4:return v.sent(),[3,2];case 5:return[3,8];case 6:return n(),[4,Promise.all(t.map(function(T){return T.return&&T.return()}))];case 7:return v.sent(),[7];case 8:return[2]}})})})}function R8(i){var e=this,t=R_(i,{yieldValues:!0,returnValues:!0});return new Gm(function(r,n){return zp(e,void 0,void 0,function(){var o,l,s,g,v,T=this;return td(this,function(F){switch(F.label){case 0:if(!t.length)return n(),[2,[]];l=[],s=!1,n.then(function(){var R,U;o();try{for(var J=Qp(l),te=J.next();!te.done;te=J.next()){var Ae=te.value;Ae()}}catch(he){R={error:he}}finally{try{te&&!te.done&&(U=J.return)&&U.call(J)}finally{if(R)throw R.error}}s=!0}),F.label=1;case 1:return F.trys.push([1,,5,7]),Promise.all(t.map(function(R){return R.next()})).then(function(R){return o(R)},function(R){return n(R)}),[4,new Promise(function(R){return o=R})];case 2:return g=F.sent(),g===void 0?[2]:(v=g.map(function(R){return R.value}),g.every(function(R){return R.done})?[2,v]:[4,r(v.slice())]);case 3:return F.sent(),[4,Promise.all(t.map(function(R,U){return zp(T,void 0,void 0,function(){var J;return td(this,function(te){switch(te.label){case 0:if(g[U].done)return[2,g[U].value];te.label=1;case 1:return s?[3,4]:(Promise.resolve(R.next()).then(function(Ae){return l[U](Ae)},function(Ae){return n(Ae)}),[4,new Promise(function(Ae){return l[U]=Ae})]);case 2:return J=te.sent(),J===void 0?[2,g[U].value]:J.done?[2,J.value]:(v[U]=J.value,[4,r(v.slice())]);case 3:return te.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,F.sent()];case 5:return n(),[4,Promise.all(t.map(function(R){return R.return&&R.return()}))];case 6:return F.sent(),[7];case 7:return[2]}})})})}class k_{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}}k_.global=new k_;var Ju;(function(i){i[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Warn=2]="Warn",i[i.Error=3]="Error"})(Ju||(Ju={}));class Va{static debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Ju.Debug,...t)}static info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Ju.Info,...t)}static warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Ju.Warn,...t)}static error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Ju.Error,...t)}static log(e){if(!(this.logLevel>e)){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];switch(e){case Ju.Debug:{console.debug(...r);break}case Ju.Info:{console.info(...r);break}case Ju.Warn:{console.warn(...r);break}case Ju.Error:{console.error(...r);break}}}}}Va.logLevel=Ju.Warn;const Af=8*4+8,k8=16;function uw(i,e){e=Math.min(Math.max(+e,2),65535);let t=i,r=t;do t=Math.ceil(t/e),r+=t;while(t!==1);return r*Af}function O8(i,e){if(e<2)throw new Error("Node size must be at least 2");if(i===0)throw new Error("Number of items must be greater than 0");let t=i,r=t;const n=[t];do t=Math.ceil(t/e),r+=t,n.push(t);while(t!==1);const o=[];t=r;for(const s of n)o.push(t-s),t-=s;const l=[];for(let s=0;s<n.length;s++)l.push([o[s],o[s]+n[s]]);return l}async function*U8(i,e,t,r){class n{constructor(J,te){this._level=te,this.nodes=J}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(J){console.assert(J>this.nodes[1]),this.nodes[1]=J}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:o,minY:l,maxX:s,maxY:g}=t;Va.info(`tree items: ${i}, nodeSize: ${e}`);const v=O8(i,e),T=v[0][0],R=[(()=>{const U=[0,1],J=v.length-1;return new n(U,J)})()];for(Va.debug(`starting stream search with queue: ${R}, numItems: ${i}, nodeSize: ${e}, levelBounds: ${v}`);R.length!=0;){const U=R.shift();Va.debug(`popped node: ${U}, queueLength: ${R.length}`);const J=U.startNodeIdx(),te=J>=T,Ae=(()=>{const[,Te]=v[U.level()],qe=Math.min(U.endNodeIdx()+e,Te);return te&&qe<Te?qe+1:qe})(),he=Ae-J,pe=await r(J*Af,he*Af),be=new DataView(pe);for(let Te=J;Te<Ae;Te++){const qe=Te-J,je=qe*Af;if(s<be.getFloat64(je+0,!0)||g<be.getFloat64(je+8,!0)||o>be.getFloat64(je+16,!0)||l>be.getFloat64(je+24,!0))continue;const We=be.getBigUint64(je+32,!0);if(te){const De=We,Ye=(()=>{if(Te<i-1){const Ct=(qe+1)*Af;return be.getBigUint64(Ct+32,!0)-De}else return null})(),Ze=Te-T;yield[Number(De),Ze,Number(Ye)];continue}const Ne=We,at=k_.global.extraRequestThreshold()/Af,nt=R[R.length-1];if(nt!==void 0&&nt.level()==U.level()-1&&Ne<nt.endNodeIdx()+at){Va.debug(`Merging "nodeRange" request into existing range: ${nt}, newEndNodeIdx: ${nt.endNodeIdx()} -> ${Ne}`),nt.extendEndNodeIdx(Number(Ne));continue}const ke=(()=>{const De=U.level()-1,Ye=[Number(Ne),Number(Ne)+1];return new n(Ye,De)})();nt!==void 0&&nt.level()==ke.level()?Va.info(`Same level, but too far away. Pushing new request for nodeIdx: ${Ne} rather than merging with distant ${nt}`):Va.info(`Pushing new level for ${ke} onto queue with nearestNodeRange: ${nt} since there's not already a range for this level.`),R.push(ke)}}}const id=new Uint8Array([102,103,98,3,102,103,98,0]),yA=4;class hw{constructor(e,t,r,n){this.headerClient=e,this.header=t,this.headerLength=r,this.indexLength=n}static async open(e){const r=new KI(e),n=(()=>{const F=k8,R=3;let U=0,J;for(J=0;J<R;J++){const te=F**J*Af;U+=te}return U})(),o=2024+n;Va.debug(`fetching header. minReqLength: ${o} (assumedHeaderLength: 2024, assumedIndexLength: ${n})`);{const F=new Uint8Array(await r.getRange(0,8,o,"header"));if(!F.subarray(0,3).every((R,U)=>id[U]===R))throw Va.error(`bytes: ${F} != ${id}`),new Error("Not a FlatGeobuf file");Va.debug("magic bytes look good")}let l;{const F=await r.getRange(8,4,o,"header");l=new DataView(F).getUint32(0,!0);const R=1048576*10;if(l>R||l<8)throw new Error("Invalid header size");Va.debug(`headerLength: ${l}`)}const s=await r.getRange(12,l,o,"header"),g=new mA(new Uint8Array(s)),v=nw(g),T=uw(v.featuresCount,v.indexNodeSize);return Va.debug("completed: opening http reader"),new hw(r,v,l,T)}async*selectBbox(e){const t=this.lengthBeforeTree(),r=this.headerClient,n=async function(g,v){return r.getRange(t+g,v,0,"index")},o=[];let l=[];for await(const g of U8(this.header.featuresCount,this.header.indexNodeSize,e,n)){const[v,,]=g;let[,,T]=g;if(T||(Va.info("final feature"),T=4),l.length==0){l.push([v,T]);continue}const F=l[l.length-1],R=v-(F[0]+F[1]);R>k_.global.extraRequestThreshold()&&(Va.info(`Pushing new feature batch, since gap ${R} was too large`),o.push(l),l=[]),l.push([v,T])}this.headerClient.logUsage("header+index"),l.length>0&&o.push(l);const s=o.flatMap(g=>this.readFeatureBatch(g));yield*Gm.merge(s)}lengthBeforeTree(){return id.length+yA+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(){return new KI(this.headerClient.httpClient)}async*readFeatureBatch(e){const[t]=e[0],[r,n]=e[e.length-1],o=t,s=r+n-o,g=this.buildFeatureClient();let v=s;for(const[T]of e)yield await this.readFeature(g,T,v),v=0;g.logUsage("feature")}async readFeature(e,t,r){const n=t+this.lengthBeforeFeatures();let o;{const T=await e.getRange(n,4,r,"feature length");o=new DataView(T).getUint32(0,!0)}const l=await e.getRange(n+4,o,r,"feature data"),s=new Uint8Array(l),g=new Uint8Array(o+yA);g.set(s,yA);const v=new mA(g);return v.setPosition(yA),Xu.getRootAsFeature(v)}}class KI{constructor(e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof e=="string")this.httpClient=new WI(e);else if(e instanceof WI)this.httpClient=e;else throw new Error("Unknown source ")}async getRange(e,t,r,n){this.bytesEverUsed+=t;const o=e-this.head,l=o+t;if(o>=0&&l<=this.buffer.byteLength)return this.buffer.slice(o,l);const s=Math.max(t,r);return this.bytesEverFetched+=s,Va.debug(`requesting for new Range: ${e}-${e+s-1}`),this.buffer=await this.httpClient.getRange(e,s,n),this.head=e,this.buffer.slice(0,t)}logUsage(e){const t=e.split(" ")[0],r=this.bytesEverUsed,n=this.bytesEverFetched,o=(100*r/n).toFixed(2);Va.info(`${t} bytes used/requested: ${r} / ${n} = ${o}%`)}}class WI{constructor(e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=e}async getRange(e,t,r){this.requestsEverMade+=1,this.bytesEverRequested+=t;const n=`bytes=${e}-${e+t-1}`;return Va.info(`request: #${this.requestsEverMade}, purpose: ${r}), bytes: (this_request: ${t}, ever: ${this.bytesEverRequested}), Range: ${n}`),(await fetch(this.url,{headers:{Range:n}})).arrayBuffer()}}function N8(i,e,t){if(!i.subarray(0,3).every((T,F)=>id[F]===T))throw new Error("Not a FlatGeobuf file");const r=new mA(i),n=r.readUint32(id.length);r.setPosition(id.length+yA);const o=nw(r);t&&t(o);let l=id.length+yA+n;const{indexNodeSize:s,featuresCount:g}=o;s>0&&(l+=uw(g,s));const v=[];for(;l<r.capacity();){const T=r.readUint32(l);r.setPosition(l+yA);const F=Xu.getRootAsFeature(r);v.push(e(F,o)),l+=yA+T}return v}async function*z8(i,e,t){const r=E8(i),n=async R=>await r.slice(R);let o=new Uint8Array(await n(8));if(!o.subarray(0,3).every((R,U)=>id[U]===R))throw new Error("Not a FlatGeobuf file");o=new Uint8Array(await n(4));let l=new mA(o);const s=l.readUint32(0);o=new Uint8Array(await n(s)),l=new mA(o);const g=nw(l);t&&t(g);const{indexNodeSize:v,featuresCount:T}=g;if(v>0){const R=uw(T,v);await n(R)}let F;for(;F=await V8(n,g,e);)yield F}async function*Q8(i,e,t,r){const n=await hw.open(i);Va.debug("opened reader"),r&&r(n.header);for await(const o of n.selectBbox(e))yield t(o,n.header)}async function V8(i,e,t){let r=new Uint8Array(await i(4,"feature length"));if(r.byteLength===0)return;let n=new mA(r);const o=n.readUint32(0);r=new Uint8Array(await i(o,"feature data"));const l=new Uint8Array(o+4);l.set(r,4),n=new mA(l),n.setPosition(yA);const s=Xu.getRootAsFeature(n);return t(s,e)}function H8(i,e){return{type:"FeatureCollection",features:N8(i,iw,e)}}function G8(i,e){return z8(i,iw,e)}function j8(i,e,t){return Q8(i,e,iw,t)}function ZI(i,e,t){return i instanceof Uint8Array?H8(i,t):i instanceof ReadableStream?G8(i,t):j8(i,e,t)}class q8{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(e){this._map=e;let t=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(t._btn.className.indexOf("3d")!=-1){let v={pitch:t._pitch,bearing:t._bearing};t._minpitchzoom&&e.getZoom()>t._minpitchzoom&&(v.zoom=t._minpitchzoom);var r=0,n=38.5,o=6,l=62.33,{longitude:s,latitude:g}=e.getCenter();e.getZoom()<10?e.setTerrain({source:"terrainMapZen",exaggeration:1.5}):s>=r&&s<=o&&g>=n&&g<=l?e.setTerrain({source:"terrainICGC",exaggeration:1.2}):e.setTerrain({source:"terrainMapZen",exaggeration:1.5}),e.easeTo(v),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else e.setTerrain(null),e.easeTo({pitch:0,bearing:0}),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function jm(i){"@babel/helpers - typeof";return jm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jm(i)}function $8(i,e){if(jm(i)!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(jm(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function K8(i){var e=$8(i,"string");return jm(e)=="symbol"?e:String(e)}function ye(i,e,t){return e=K8(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ts(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const O_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),XI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);XI&&parseFloat(XI[1]);const W8="3.4.14";function kh(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const Aw={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Z8=Aw.global||Aw.self||Aw.window||{},_A=typeof process!="object"||String(process)!=="[object process]"||process.browser,dw=typeof importScripts=="function",X8=typeof window<"u"&&typeof window.orientation<"u",JI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);JI&&parseFloat(JI[1]);class J8{constructor(e,t){ye(this,"name",void 0),ye(this,"workerThread",void 0),ye(this,"isRunning",!0),ye(this,"result",void 0),ye(this,"_resolve",()=>{}),ye(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((r,n)=>{this._resolve=r,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){kh(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){kh(this.isRunning),this.isRunning=!1,this._reject(e)}}let fw=class{terminate(){}};const pw=new Map;function Y8(i){kh(i.source&&!i.url||!i.source&&i.url);let e=pw.get(i.source||i.url);return e||(i.url&&(e=ez(i.url),pw.set(i.url,e)),i.source&&(e=YI(i.source),pw.set(i.source,e))),kh(e),e}function ez(i){if(!i.startsWith("http"))return i;const e=tz(i);return YI(e)}function YI(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function tz(i){return`try {
  importScripts('`.concat(i,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function e5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const r=t||new Set;if(i){if(t5(i))r.add(i);else if(t5(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const n in i)e5(i[n],e,r)}}return t===void 0?Array.from(r):[]}function t5(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const gw=()=>{};class mw{static isSupported(){return typeof Worker<"u"&&_A||typeof fw<"u"&&!_A}constructor(e){ye(this,"name",void 0),ye(this,"source",void 0),ye(this,"url",void 0),ye(this,"terminated",!1),ye(this,"worker",void 0),ye(this,"onMessage",void 0),ye(this,"onError",void 0),ye(this,"_loadableURL","");const{name:t,source:r,url:n}=e;kh(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=gw,this.onError=o=>console.log(o),this.worker=_A?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=gw,this.onError=gw,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||e5(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=Y8({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new fw(r,{eval:!1})}else if(this.source)e=new fw(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class iz{static isSupported(){return mw.isSupported()}constructor(e){ye(this,"name","unnamed"),ye(this,"source",void 0),ye(this,"url",void 0),ye(this,"maxConcurrency",1),ye(this,"maxMobileConcurrency",1),ye(this,"onDebug",()=>{}),ye(this,"reuseWorkers",!0),ye(this,"props",{}),ye(this,"jobQueue",[]),ye(this,"idleQueue",[]),ye(this,"count",0),ye(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,l,s)=>o.done(s),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,l)=>o.error(l);const n=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:o}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new J8(t.name,e);e.onMessage=n=>t.onMessage(r,n.type,n.payload),e.onError=n=>t.onError(r,n),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new mw({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return X8?this.maxMobileConcurrency:this.maxConcurrency}}const rz={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class vA{static isSupported(){return mw.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return vA._workerFarm=vA._workerFarm||new vA({}),vA._workerFarm.setProps(e),vA._workerFarm}constructor(e){ye(this,"props",void 0),ye(this,"workerPools",new Map),this.props={...rz},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:n}=e;let o=this.workerPools.get(t);return o||(o=new iz({name:t,source:r,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}ye(vA,"_workerFarm",void 0);const nz="latest";function sz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[i.id]||{},r="".concat(i.id,"-worker.js");let n=t.workerUrl;if(!n&&i.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(n="modules/".concat(i.module,"/dist/").concat(r)),!n){let o=i.version;o==="latest"&&(o=nz);const l=o?"@".concat(o):"";n="https://unpkg.com/@loaders.gl/".concat(i.module).concat(l,"/dist/").concat(r)}return kh(n),n}function oz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:W8;kh(i,"no worker provided");const t=i.version;return!(!e||!t)}const az=null,lz=null,yw=null,i5=null,cz=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:az,readFileAsText:lz,requireFromFile:yw,requireFromString:i5},Symbol.toStringTag,{value:"Module"})),uz="3.4.14",_w={};async function df(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(i=hz(i,e,t)),_w[i]=_w[i]||Az(i),await _w[i]}function hz(i,e,t){if(i.startsWith("http"))return i;const r=t.modules||{};return r[i]?r[i]:_A?t.CDN?(kh(t.CDN.startsWith("http")),"".concat(t.CDN,"/").concat(e,"@").concat(uz,"/dist/libs/").concat(i)):dw?"../src/libs/".concat(i):"modules/".concat(e,"/src/libs/").concat(i):"modules/".concat(e,"/dist/libs/").concat(i)}async function Az(i){if(i.endsWith("wasm"))return await(await fetch(i)).arrayBuffer();if(!_A)try{return cz&&yw&&await yw(i)}catch{return null}if(dw)return importScripts(i);const t=await(await fetch(i)).text();return dz(t,i)}function dz(i,e){if(!_A)return i5;if(dw)return eval.call(Z8,i),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(i))}catch{t.text=i}return document.body.appendChild(t),null}function fz(i,e){return!vA.isSupported()||!_A&&!(e!=null&&e._nodeWorkers)?!1:i.worker&&(e==null?void 0:e.worker)}async function pz(i,e,t,r,n){const o=i.id,l=sz(i,t),g=vA.getWorkerFarm(t).getWorkerPool({name:o,url:l});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const v=await g.startJob("process-on-worker",gz.bind(null,n));return v.postMessage("process",{input:e,options:t,context:r}),await(await v.result).result}async function gz(i,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:n,input:o,options:l}=r;try{const s=await i(o,l);e.postMessage("done",{id:n,result:s})}catch(s){const g=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:n,error:g})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function mz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?r5(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?r5(i,0,e):""}function r5(i,e,t){if(i.byteLength<=e+t)return"";const r=new DataView(i);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}function yz(i){try{return JSON.parse(i)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(mz(i),'"'))}}function _z(i,e,t){if(t=t||i.byteLength,i.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(i),n=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==n[o])return!1;return!0}function vz(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];const r=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=r.reduce((s,g)=>s+g.byteLength,0),o=new Uint8Array(n);let l=0;for(const s of r)o.set(s,l),l+=s.byteLength;return o.buffer}function vw(i,e,t){const r=t!==void 0?new Uint8Array(i).subarray(e,e+t):new Uint8Array(i).subarray(e);return new Uint8Array(r).buffer}function qm(i,e){return Ts(i>=0),Ts(e>0),i+(e-1)&~(e-1)}function bz(i,e,t){let r;if(i instanceof ArrayBuffer)r=new Uint8Array(i);else{const n=i.byteOffset,o=i.byteLength;r=new Uint8Array(i.buffer||i.arrayBuffer,n,o)}return e.set(r,t),t+qm(r.byteLength,4)}async function xz(i){const e=[];for await(const t of i)e.push(t);return vz(...e)}function n5(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}let s5=class{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=n5(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(n5()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},wz=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(e instanceof s5?n=e:n=new s5(t,r),this.stats[t]=n),n}};const Bz="Queued Requests",Cz="Active Requests",Ez="Cancelled Requests",Sz="Queued Requests Ever",Tz="Active Requests Ever",Iz={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Lz{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"props",void 0),ye(this,"stats",void 0),ye(this,"activeRequestCount",0),ye(this,"requestQueue",[]),ye(this,"requestMap",new Map),ye(this,"deferredUpdate",null),this.props={...Iz,...e},this.stats=new wz({id:this.props.id}),this.stats.get(Bz),this.stats.get(Cz),this.stats.get(Ez),this.stats.get(Sz),this.stats.get(Tz)}scheduleRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:t},n=new Promise(o=>(r.resolve=o,r));return this.requestQueue.push(r),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:t,resolve:r}=e;let n=!1;const o=()=>{n||(n=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((t,r)=>t.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let Mz="";const o5={};function Pz(i){for(const e in o5)if(i.startsWith(e)){const t=o5[e];i=i.replace(e,t)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="".concat(Mz).concat(i)),i}function qve(i){return i}function Fz(i){return i&&typeof i=="object"&&i.isBuffer}function a5(i){if(Fz(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function l5(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(e+1):""}function bw(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(0,e):""}const Dz=i=>typeof i=="boolean",$m=i=>typeof i=="function",Km=i=>i!==null&&typeof i=="object",c5=i=>Km(i)&&i.constructor==={}.constructor,Rz=i=>i&&typeof i[Symbol.iterator]=="function",kz=i=>i&&typeof i[Symbol.asyncIterator]=="function",ff=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,pf=i=>typeof Blob<"u"&&i instanceof Blob,Oz=i=>i&&typeof i=="object"&&i.isBuffer,Uz=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||Km(i)&&$m(i.tee)&&$m(i.cancel)&&$m(i.getReader),Nz=i=>Km(i)&&$m(i.read)&&$m(i.pipe)&&Dz(i.readable),u5=i=>Uz(i)||Nz(i),zz=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Qz=/^([-\w.]+\/[-\w.+]+)/;function Vz(i){const e=Qz.exec(i);return e?e[1]:i}function h5(i){const e=zz.exec(i);return e?e[1]:""}const A5=/\?.*/;function Hz(i){const e=i.match(A5);return e&&e[0]}function xw(i){return i.replace(A5,"")}function U_(i){return ff(i)?i.url:pf(i)?i.name||"":typeof i=="string"?i:""}function ww(i){if(ff(i)){const e=i,t=e.headers.get("content-type")||"",r=xw(e.url);return Vz(t)||h5(r)}return pf(i)?i.type||"":typeof i=="string"?h5(i):""}function Gz(i){return ff(i)?i.headers["content-length"]||-1:pf(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function d5(i){if(ff(i))return i;const e={},t=Gz(i);t>=0&&(e["content-length"]=String(t));const r=U_(i),n=ww(i);n&&(e["content-type"]=n);const o=await $z(i);o&&(e["x-first-bytes"]=o),typeof i=="string"&&(i=new TextEncoder().encode(i));const l=new Response(i,{headers:e});return Object.defineProperty(l,"url",{value:r}),l}async function jz(i){if(!i.ok){const e=await qz(i);throw new Error(e)}}async function qz(i){let e="Failed to fetch resource ".concat(i.url," (").concat(i.status,"): ");try{const t=i.headers.get("Content-Type");let r=i.statusText;t.includes("application/json")&&(r+=" ".concat(await i.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function $z(i){if(typeof i=="string")return"data:,".concat(i.slice(0,5));if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(r=>{const n=new FileReader;n.onload=o=>{var l;return r(o==null||(l=o.target)===null||l===void 0?void 0:l.result)},n.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5),r=Kz(t);return"data:base64,".concat(r)}return null}function Kz(i){let e="";const t=new Uint8Array(i);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}async function f5(i,e){if(typeof i=="string"){i=Pz(i);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(i,t)}return await d5(i)}function Wz(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function Wm(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Wz()}const N_=globalThis.window||globalThis.self||globalThis.global,Zm=globalThis.process||{},p5=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Wm();function Zz(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let Xz=class{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=Zz(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function Jz(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function Yz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}function Bw(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(t=Math.min(t,r/i.width));const o=i.width*t,l=i.height*t,s=["font-size:1px;",`padding:${Math.floor(l/2)}px ${Math.floor(o/2)}px;`,`line-height:${l}px;`,`background:url(${n});`,`background-size:${o}px ${l}px;`,"color:transparent;"].join("");return[`${e} %c+`,s]}let z_;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(z_||(z_={}));const eQ=10;function g5(i){return typeof i!="string"?i:(i=i.toUpperCase(),z_[i]||z_.WHITE)}function tQ(i,e,t){return!Wm&&typeof i=="string"&&(e&&(i=`\x1B[${g5(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${g5(t)+eQ}m${i}\x1B[49m`)),i}function iQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t),n=i;for(const o of r){const l=n[o];typeof l=="function"&&(e.find(s=>o===s)||(n[o]=l.bind(i)))}}function Q_(i,e){if(!i)throw new Error(e||"Assertion failed")}function Hp(){let i;if(Wm()&&N_.performance){var e,t;i=N_==null||(e=N_.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Zm){var r;const n=Zm==null||(r=Zm.hrtime)===null||r===void 0?void 0:r.call(Zm);i=n[0]*1e3+n[1]/1e6}else i=Date.now();return i}const Gp={debug:Wm()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},rQ={enabled:!0,level:0};function Bu(){}const m5={},y5={once:!0};let Cw=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=p5,this._startTs=Hp(),this._deltaTs=Hp(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Xz(`__probe-${this.id}__`,rQ),this.timeStamp(`${this.id} started`),iQ(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Hp()-this._startTs).toPrecision(10))}getDelta(){return Number((Hp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Q_(e,t)}warn(e){return this._getLogFunction(0,e,Gp.warn,arguments,y5)}error(e){return this._getLogFunction(0,e,Gp.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Gp.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Gp.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Gp.debug||Gp.info,arguments,y5)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Bu,r&&[r],{tag:aQ(t)}):Bu}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:l=1}=e;return this._shouldLog(t||r)?Wm()?oQ({image:n,message:o,scale:l}):sQ():Bu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Bu)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=v5({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Bu)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=_5(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=v5({logLevel:e,message:t,args:n,opts:o}),r=r||o.method,Q_(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Hp();const l=o.tag||o.message;if(o.once&&l)if(!m5[l])m5[l]=Hp();else return Bu;return t=nQ(this.id,o.message,o),r.bind(console,t,...o.args)}return Bu}};Cw.VERSION=p5;function _5(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return Q_(Number.isFinite(e)&&e>=0),e}function v5(i){const{logLevel:e,message:t}=i;i.logLevel=_5(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const n=typeof i.message;return Q_(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function nQ(i,e,t){if(typeof e=="string"){const r=t.time?Yz(Jz(t.total)):"";e=t.time?`${i}: ${r}  ${e}`:`${i}: ${e}`,e=tQ(e,t.color,t.background)}return e}function sQ(i){return console.warn("removed"),Bu}function oQ(i){let{image:e,message:t="",scale:r=1}=i;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const l=Bw(o,t,r);console.log(...l)},o.src=e,Bu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Bw(e,t,r)),Bu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...Bw(o,t,r)),o.src=e.toDataURL(),Bu}return Bu}function aQ(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const b5=new Cw({id:"loaders.gl"});class lQ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class cQ{constructor(){ye(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}}const x5={fetch:null,mimeType:void 0,nothrow:!1,log:new cQ,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:O_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},uQ={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function w5(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state=i._state||{},i._state}const B5=()=>{const i=w5();return i.globalOptions=i.globalOptions||{...x5},i.globalOptions};function hQ(i,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],AQ(i,t),fQ(e,i,r)}function AQ(i,e){C5(i,null,x5,uQ,e);for(const t of e){const r=i&&i[t.id]||{},n=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};C5(r,t.id,n,o,e)}}function C5(i,e,t,r,n){const o=e||"Top level",l=e?"".concat(e,"."):"";for(const s in i){const g=!e&&Km(i[s]),v=s==="baseUri"&&!e,T=s==="workerUrl"&&e;if(!(s in t)&&!v&&!T){if(s in r)b5.warn("".concat(o," loader option '").concat(l).concat(s,"' no longer supported, use '").concat(r[s],"'"))();else if(!g){const F=dQ(s,n);b5.warn("".concat(o," loader option '").concat(l).concat(s,"' not recognized. ").concat(F))()}}}}function dQ(i,e){const t=i.toLowerCase();let r="";for(const n of e)for(const o in n.options){if(i===o)return"Did you mean '".concat(n.id,".").concat(o,"'?");const l=o.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(r=r||"Did you mean '".concat(n.id,".").concat(o,"'?"))}return r}function fQ(i,e,t){const n={...i.options||{}};return pQ(n,t),n.log===null&&(n.log=new lQ),E5(n,B5()),E5(n,e),n}function E5(i,e){for(const t in e)if(t in e){const r=e[t];c5(r)&&c5(i[t])?i[t]={...i[t],...e[t]}:i[t]=e[t]}}function pQ(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function Ew(i){var e;return i?(Array.isArray(i)&&(i=i[0]),Array.isArray((e=i)===null||e===void 0?void 0:e.extensions)):!1}function Sw(i){var e,t;Ts(i,"null loader"),Ts(Ew(i),"invalid loader");let r;return Array.isArray(i)&&(r=i[1],i=i[0],i={...i,options:{...i.options,...r}}),((e=i)!==null&&e!==void 0&&e.parseTextSync||(t=i)!==null&&t!==void 0&&t.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const S5=()=>{const i=w5();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function gQ(i){const e=S5();i=Array.isArray(i)?i:[i];for(const t of i){const r=Sw(t);e.find(n=>r===n)||e.unshift(r)}}function mQ(){return S5()}const yQ=new Cw({id:"loaders.gl"}),_Q=/\.([^.]+)$/;async function vQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!I5(i))return null;let n=T5(i,e,{...t,nothrow:!0},r);if(n)return n;if(pf(i)&&(i=await i.slice(0,10).arrayBuffer(),n=T5(i,e,t,r)),!n&&!(t!=null&&t.nothrow))throw new Error(L5(i));return n}function T5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!I5(i))return null;if(e&&!Array.isArray(e))return Sw(e);let n=[];e&&(n=n.concat(e)),t!=null&&t.ignoreRegisteredLoaders||n.push(...mQ()),xQ(n);const o=bQ(i,n,t,r);if(!o&&!(t!=null&&t.nothrow))throw new Error(L5(i));return o}function bQ(i,e,t,r){const n=U_(i),o=ww(i),l=xw(n)||(r==null?void 0:r.url);let s=null,g="";if(t!=null&&t.mimeType&&(s=Tw(e,t==null?void 0:t.mimeType),g="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),s=s||wQ(e,l),g=g||(s?"matched url ".concat(l):""),s=s||Tw(e,o),g=g||(s?"matched MIME type ".concat(o):""),s=s||CQ(e,i),g=g||(s?"matched initial data ".concat(P5(i)):""),s=s||Tw(e,t==null?void 0:t.fallbackMimeType),g=g||(s?"matched fallback MIME type ".concat(o):""),g){var v;yQ.log(1,"selectLoader selected ".concat((v=s)===null||v===void 0?void 0:v.name,": ").concat(g,"."))}return s}function I5(i){return!(i instanceof Response&&i.status===204)}function L5(i){const e=U_(i),t=ww(i);let r="No valid loader found (";r+=e?"".concat(l5(e),", "):"no url provided, ",r+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const n=i?P5(i):"";return r+=n?' first bytes: "'.concat(n,'"'):"first bytes: not available",r+=")",r}function xQ(i){for(const e of i)Sw(e)}function wQ(i,e){const t=e&&_Q.exec(e),r=t&&t[1];return r?BQ(i,r):null}function BQ(i,e){e=e.toLowerCase();for(const t of i)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function Tw(i,e){for(const t of i)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function CQ(i,e){if(!e)return null;for(const t of i)if(typeof e=="string"){if(EQ(e,t))return t}else if(ArrayBuffer.isView(e)){if(M5(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&M5(e,0,t))return t;return null}function EQ(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>i.startsWith(r))}function M5(i,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>SQ(i,e,t,n))}function SQ(i,e,t,r){if(r instanceof ArrayBuffer)return _z(r,i,r.byteLength);switch(typeof r){case"function":return r(i,t);case"string":const n=Iw(i,e,r.length);return r===n;default:return!1}}function P5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?Iw(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?Iw(i,0,e):""}function Iw(i,e,t){if(i.byteLength<e+t)return"";const r=new DataView(i);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}const TQ=256*1024;function*IQ(i,e){const t=(e==null?void 0:e.chunkSize)||TQ;let r=0;const n=new TextEncoder;for(;r<i.length;){const o=Math.min(i.length-r,t),l=i.slice(r,r+o);r+=o,yield n.encode(l)}}const LQ=256*1024;function MQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=LQ}=e;let r=0;for(;r<i.byteLength;){const n=Math.min(i.byteLength-r,t),o=new ArrayBuffer(n),l=new Uint8Array(i,r,n);new Uint8Array(o).set(l),r+=n,yield o}}()}const PQ=1024*1024;async function*FQ(i,e){const t=(e==null?void 0:e.chunkSize)||PQ;let r=0;for(;r<i.size;){const n=r+t,o=await i.slice(r,n).arrayBuffer();r=n,yield o}}function F5(i,e){return O_?DQ(i,e):RQ(i)}async function*DQ(i,e){const t=i.getReader();let r;try{for(;;){const n=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:o,value:l}=await n;if(o)return;yield a5(l)}}catch{t.releaseLock()}}async function*RQ(i,e){for await(const t of i)yield a5(t)}function kQ(i,e){if(typeof i=="string")return IQ(i,e);if(i instanceof ArrayBuffer)return MQ(i,e);if(pf(i))return FQ(i,e);if(u5(i))return F5(i,e);if(ff(i))return F5(i.body,e);throw new Error("makeIterator")}const D5="Cannot convert supplied data type";function OQ(i,e,t){if(e.text&&typeof i=="string")return i;if(Oz(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const n=i.byteLength||i.length;return(i.byteOffset!==0||n!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+n)),r}throw new Error(D5)}async function UQ(i,e,t){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return OQ(i,e);if(pf(i)&&(i=await d5(i)),ff(i)){const n=i;return await jz(n),e.binary?await n.arrayBuffer():await n.text()}if(u5(i)&&(i=kQ(i,t)),Rz(i)||kz(i))return xz(i);throw new Error(D5)}function R5(i,e){const t=B5(),r=i||t;return typeof r.fetch=="function"?r.fetch:Km(r.fetch)?n=>f5(n,r):e!=null&&e.fetch?e==null?void 0:e.fetch:f5}function NQ(i,e,t){if(t)return t;const r={fetch:R5(e,i),...i};if(r.url){const n=xw(r.url);r.baseUrl=n,r.queryString=Hz(r.url),r.filename=l5(n),r.baseUrl=bw(n)}return Array.isArray(r.loaders)||(r.loaders=null),r}function zQ(i,e){if(!e&&i&&!Array.isArray(i))return i;let t;if(i&&(t=Array.isArray(i)?i:[i]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:null}async function Lw(i,e,t,r){kh(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Ew(e)&&(r=void 0,t=e,e=void 0),i=await i,t=t||{};const n=U_(i),l=zQ(e,r),s=await vQ(i,l,t);return s?(t=hQ(t,s,l,n),r=NQ({url:n,parse:Lw,loaders:l},t,r||null),await QQ(s,i,t,r)):null}async function QQ(i,e,t,r){if(oz(i),ff(e)){const n=e,{ok:o,redirected:l,status:s,statusText:g,type:v,url:T}=n,F=Object.fromEntries(n.headers.entries());r.response={headers:F,ok:o,redirected:l,status:s,statusText:g,type:v,url:T}}if(e=await UQ(e,i,t),i.parseTextSync&&typeof e=="string")return t.dataType="text",i.parseTextSync(e,t,r,i);if(fz(i,t))return await pz(i,e,t,r,Lw);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,r,i);if(i.parse)return await i.parse(e,t,r,i);throw kh(!i.parseSync),new Error("".concat(i.id," loader - no parser found and worker is disabled"))}async function rd(i,e,t,r){!Array.isArray(e)&&!Ew(e)&&(t=e,e=void 0);const n=R5(t);let o=i;return typeof i=="string"&&(o=await n(i)),pf(i)&&(o=await n(i)),await Lw(o,e,t)}const VQ="3.4.14",{_parseImageNode:HQ}=globalThis,Mw=typeof Image<"u",Pw=typeof ImageBitmap<"u",Fw=O_?!0:!!HQ;function GQ(i){switch(i){case"auto":return Pw||Mw||Fw;case"imagebitmap":return Pw;case"image":return Mw;case"data":return Fw;default:throw new Error("@loaders.gl/images: image ".concat(i," not supported in this environment"))}}function jQ(){if(Pw)return"imagebitmap";if(Mw)return"image";if(Fw)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function qQ(i){const e=KQ(i);if(!e)throw new Error("Not an image");return e}function $Q(i){switch(qQ(i)){case"data":return i;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),t.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function KQ(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const WQ=/^data:image\/svg\+xml/,ZQ=/\.svg((\?|#).*)?$/;function Dw(i){return i&&(WQ.test(i)||ZQ.test(i))}function XQ(i,e){if(Dw(e)){let r=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return k5(i,e)}function k5(i,e){if(Dw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function O5(i,e,t){const r=XQ(i,t),n=self.URL||self.webkitURL,o=typeof r!="string"&&n.createObjectURL(r);try{return await JQ(o||r,e)}finally{o&&n.revokeObjectURL(o)}}async function JQ(i,e){const t=new Image;return t.src=i,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,n)=>{try{t.onload=()=>r(t),t.onerror=o=>n(new Error("Could not load image ".concat(i,": ").concat(o)))}catch(o){n(o)}})}const YQ={};let U5=!0;async function eV(i,e,t){let r;Dw(t)?r=await O5(i,e,t):r=k5(i,t);const n=e&&e.imagebitmap;return await tV(r,n)}async function tV(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((iV(e)||!U5)&&(e=null),e)try{return await createImageBitmap(i,e)}catch(t){console.warn(t),U5=!1}return await createImageBitmap(i)}function iV(i){for(const e in i||YQ)return!1;return!0}function rV(i){return!aV(i,"ftyp",4)||!(i[8]&96)?null:nV(i)}function nV(i){switch(sV(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function sV(i,e,t){return String.fromCharCode(...i.slice(e,t))}function oV(i){return[...i].map(e=>e.charCodeAt(0))}function aV(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=oV(e);for(let n=0;n<r.length;++n)if(r[n]!==i[n+t])return!1;return!0}const Oh=!1,Xm=!0;function Rw(i){const e=Jm(i);return cV(e)||AV(e)||uV(e)||hV(e)||lV(e)}function lV(i){const e=new Uint8Array(i instanceof DataView?i.buffer:i),t=rV(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function cV(i){const e=Jm(i);return e.byteLength>=24&&e.getUint32(0,Oh)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Oh),height:e.getUint32(20,Oh)}:null}function uV(i){const e=Jm(i);return e.byteLength>=10&&e.getUint32(0,Oh)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Xm),height:e.getUint16(8,Xm)}:null}function hV(i){const e=Jm(i);return e.byteLength>=14&&e.getUint16(0,Oh)===16973&&e.getUint32(2,Xm)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Xm),height:e.getUint32(22,Xm)}:null}function AV(i){const e=Jm(i);if(!(e.byteLength>=3&&e.getUint16(0,Oh)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:n}=dV();let o=2;for(;o+9<e.byteLength;){const l=e.getUint16(o,Oh);if(n.has(l))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Oh),width:e.getUint16(o+7,Oh)};if(!r.has(l))return null;o+=2,o+=e.getUint16(o,Oh)}return null}function dV(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Jm(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function fV(i,e){const{mimeType:t}=Rw(i)||{},r=globalThis._parseImageNode;return Ts(r),await r(i,t)}async function pV(i,e,t){e=e||{};const n=(e.image||{}).type||"auto",{url:o}=t||{},l=gV(n);let s;switch(l){case"imagebitmap":s=await eV(i,e,o);break;case"image":s=await O5(i,e,o);break;case"data":s=await fV(i);break;default:Ts(!1)}return n==="data"&&(s=$Q(s)),s}function gV(i){switch(i){case"auto":case"data":return jQ();default:return GQ(i),i}}const N5={id:"image",module:"images",name:"Images",version:VQ,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:pV,tests:[i=>!!Rw(new DataView(i))],options:{image:{type:"auto",decode:!0}}},kw={};function mV(i){if(kw[i]===void 0){const e=O_?_V(i):yV(i);kw[i]=e}return kw[i]}function yV(i){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:t,_imageFormatsNode:r=e}=globalThis;return!!t&&r.includes(i)}function _V(i){switch(i){case"image/avif":case"image/webp":return vV(i);default:return!0}}function vV(i){try{return document.createElement("canvas").toDataURL(i).indexOf("data:".concat(i))===0}catch{return!1}}function z5(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function bA(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||z5()}const V_={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},H_=V_.window||V_.self||V_.global,Ym=V_.process||{},Q5=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";bA();const Ow=globalThis;function V5(i){if(!i&&!bA())return"Node";if(z5(i))return"Electron";const t=i||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return r||n?"IE":Ow.chrome?"Chrome":Ow.safari?"Safari":Ow.mozInnerScreenX?"Firefox":"Unknown"}function bV(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class xV{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";ye(this,"storage",void 0),ye(this,"id",void 0),ye(this,"config",void 0),this.storage=bV(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function wV(i){let e;return i<10?e="".concat(i.toFixed(2),"ms"):i<100?e="".concat(i.toFixed(1),"ms"):i<1e3?e="".concat(i.toFixed(0),"ms"):e="".concat((i/1e3).toFixed(2),"s"),e}function BV(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-i.length,0);return"".concat(" ".repeat(t)).concat(i)}function Uw(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(t=Math.min(t,r/i.width));const o=i.width*t,l=i.height*t,s=["font-size:1px;","padding:".concat(Math.floor(l/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(l,"px;"),"background:url(".concat(n,");"),"background-size:".concat(o,"px ").concat(l,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}let G_;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(G_||(G_={}));function H5(i){return typeof i=="string"?G_[i.toUpperCase()]||G_.WHITE:i}function CV(i,e,t){return!bA&&typeof i=="string"&&(e&&(e=H5(e),i="\x1B[".concat(e,"m").concat(i,"\x1B[39m")),t&&(e=H5(t),i="\x1B[".concat(t+10,"m").concat(i,"\x1B[49m"))),i}function EV(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t);for(const n of r)typeof i[n]=="function"&&(e.find(o=>n===o)||(i[n]=i[n].bind(i)))}function j_(i,e){if(!i)throw new Error(e||"Assertion failed")}function jp(){let i;if(bA&&"performance"in H_){var e,t;i=H_==null||(e=H_.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Ym){var r;const n=Ym==null||(r=Ym.hrtime)===null||r===void 0?void 0:r.call(Ym);i=n[0]*1e3+n[1]/1e6}else i=Date.now();return i}const qp={debug:bA&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},SV={enabled:!0,level:0};function Cu(){}const G5={},j5={once:!0};class Nw{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};ye(this,"id",void 0),ye(this,"VERSION",Q5),ye(this,"_startTs",jp()),ye(this,"_deltaTs",jp()),ye(this,"_storage",void 0),ye(this,"userData",{}),ye(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new xV("__probe-".concat(this.id,"__"),SV),this.timeStamp("".concat(this.id," started")),EV(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((jp()-this._startTs).toPrecision(10))}getDelta(){return Number((jp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){j_(e,t)}warn(e){return this._getLogFunction(0,e,qp.warn,arguments,j5)}error(e){return this._getLogFunction(0,e,qp.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,qp.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,qp.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return this._getLogFunction(e,t,qp.debug||qp.info,arguments,j5)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Cu,r&&[r],{tag:MV(t)}):Cu}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:l=1}=e;return this._shouldLog(t||r)?bA?LV({image:n,message:o,scale:l}):IV():Cu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Cu)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=$5({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Cu)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=q5(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=$5({logLevel:e,message:t,args:n,opts:o}),r=r||o.method,j_(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=jp();const l=o.tag||o.message;if(o.once)if(!G5[l])G5[l]=jp();else return Cu;return t=TV(this.id,o.message,o),r.bind(console,t,...o.args)}return Cu}}ye(Nw,"VERSION",Q5);function q5(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return j_(Number.isFinite(e)&&e>=0),e}function $5(i){const{logLevel:e,message:t}=i;i.logLevel=q5(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const n=typeof i.message;return j_(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function TV(i,e,t){if(typeof e=="string"){const r=t.time?BV(wV(t.total)):"";e=t.time?"".concat(i,": ").concat(r,"  ").concat(e):"".concat(i,": ").concat(e),e=CV(e,t.color,t.background)}return e}function IV(i){return console.warn("removed"),Cu}function LV(i){let{image:e,message:t="",scale:r=1}=i;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const l=Uw(o,t,r);console.log(...l)},o.src=e,Cu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Uw(e,t,r)),Cu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...Uw(o,t,r)),o.src=e.toDataURL(),Cu}return Cu}function MV(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const On=new Nw({id:"deck"}),nd={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},zw=1,ey=2,Qw=3,Vw=4,PV=2,FV=i=>({"layer.changeFlag":(e,t,r)=>{i.log(Qw,"".concat(e.id," ").concat(t,": "),r[t])()},"layer.initialize":e=>{i.log(zw,"Initializing ".concat(e))()},"layer.update":(e,t)=>{if(t){const r=e.getChangeFlags();i.log(ey,"Updating ".concat(e," because: ").concat(Object.keys(r).filter(n=>r[n]).join(", ")))()}else i.log(Vw,"".concat(e," does not need update"))()},"layer.matched":(e,t)=>{t&&i.log(Vw,"Matched ".concat(e,", state transfered"))()},"layer.finalize":e=>{i.log(zw,"Finalizing ".concat(e))()},"compositeLayer.renderLayers":(e,t,r)=>{t?i.log(ey,"Composite layer rendered new subLayers ".concat(e),r)():i.log(Vw,"Composite layer reused subLayers ".concat(e),r)()},"layerManager.setLayers":(e,t,r)=>{t&&i.log(ey,"Updating ".concat(r.length," deck layers"))()},"layerManager.activateViewport":(e,t)=>{i.log(Qw,"Viewport changed",t)()},"attributeManager.invalidate":(e,t,r)=>{i.log(zw,r?"invalidated attributes ".concat(r," (").concat(t,") for ").concat(e.id):"invalidated all attributes for ".concat(e.id))()},"attributeManager.updateStart":e=>{nd.attributeUpdateMessages.length=0,nd.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(e,t)=>{const r=Math.round(Date.now()-nd.attributeManagerUpdateStart);i.groupCollapsed(ey,"Updated attributes for ".concat(t," instances in ").concat(e.id," in ").concat(r,"ms"))();for(const n of nd.attributeUpdateMessages)i.log(Qw,n)();i.groupEnd(ey)()},"attribute.updateStart":e=>{nd.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const r="".concat(e.id," allocated ").concat(t);nd.attributeUpdateMessages.push(r)},"attribute.updateEnd":(e,t)=>{const r=Math.round(Date.now()-nd.attributeUpdateStart),n="".concat(e.id," updated ").concat(t," in ").concat(r,"ms");nd.attributeUpdateMessages.push(n)},"deckRenderer.renderLayers":(e,t,r)=>{const{pass:n,redrawReason:o,stats:l}=r;for(const s of t){const{totalCount:g,visibleCount:v,compositeCount:T,pickableCount:F}=s,U=g-T-v;i.log(PV,"RENDER #".concat(e.renderCount,"   ").concat(v," (of ").concat(g," layers) to ").concat(n," because ").concat(o,"   (").concat(U," hidden, ").concat(T," composite ").concat(F," pickable)"))(),l&&l.get("Redraw Layers").add(v)}}});var DV={};let q_={};DV.NODE_ENV!=="production"&&(q_=FV(On));function RV(i){q_=i}function Sl(i,e,t,r){On.level>0&&q_[i]&&q_[i].call(null,e,t,r)}function kV(i){const e=i[0],t=i[i.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const OV={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:kV,parseTextSync:JSON.parse};function UV(){const i="8.9.35",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==i)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(i));return e||(On.log(1,"deck.gl ".concat(i))(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:On,_registerLoggers:RV},gQ([OV,[N5,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const NV=UV(),Mn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Mn,"IDENTITY",{get:()=>(On.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Uh={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Hw={common:0,meters:1,pixels:2},K5={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},hr=new Nw({id:"luma.gl"});function ac(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}const zV="Invalid WebGLRenderingContext",QV="Requires WebGL2";function $_(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}function dn(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function VV(i){return dn(i)?i:null}function K_(i){return ac($_(i),zV),i}function lc(i){return ac(dn(i),QV),i}const ty={};function HV(i){globalThis.console&&globalThis.console.error&&globalThis.console.error(i)}function GV(i){globalThis.console&&globalThis.console.log&&globalThis.console.log(i)}function jV(i,e){ty[i]=!0,e!==void 0&&HV(e)}function qV(i){const e=i.getError;i.getError=function(){let r;do r=e.apply(i),r!==0&&(ty[r]=!0);while(r!==0);for(r in ty)if(ty[r])return delete ty[r],parseInt(r,10);return 0}}const iy=function i(e){const t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const n=new i.VertexAttrib(t);this.attribs[r]=n}this.maxAttrib=0};iy.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},iy.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const gf=function(e){const t=this;this.gl=e,qV(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(o){return o===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(o){const l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,o);const s=l.attribs[o];return s.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(o){const l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,o);const s=l.attribs[o];return s.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(o,l){switch(o){case 34962:t.currentArrayBuffer=l;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=l;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(o,l){const g=t.currentVertexArrayObject.attribs[o];switch(l){case 34975:return g.buffer;case 34338:return g.enabled;case 34339:return g.size;case 34340:return g.stride;case 34341:return g.type;case 34922:return g.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(o,l,s,g,v,T){const F=t.currentVertexArrayObject;F.maxAttrib=Math.max(F.maxAttrib,o);const R=F.attribs[o];return R.buffer=t.currentArrayBuffer,R.size=l,R.type=s,R.normalized=g,R.stride=v,R.offset=T,R.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{GV("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};gf.prototype.VERTEX_ARRAY_BINDING_OES=34229,gf.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new iy(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},gf.prototype.createVertexArrayOES=function(){const e=new iy(this);return this.vertexArrayObjects.push(e),e},gf.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},gf.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof iy&&e.hasBeenBound&&e.ext===this)},gf.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){jV(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const o=this.currentVertexArrayObject;if(n===o)return;(!n||o.elementArrayBuffer!==n.elementArrayBuffer)&&r.bindBuffer.call(t,34963,o.elementArrayBuffer);let l=this.currentArrayBuffer;const s=Math.max(n?n.maxAttrib:0,o.maxAttrib);for(let g=0;g<=s;g++){const v=o.attribs[g],T=n?n.attribs[g]:null;if((!n||v.enabled!==T.enabled)&&(v.enabled?r.enableVertexAttribArray.call(t,g):r.disableVertexAttribArray.call(t,g)),v.enabled){let F=!1;(!n||v.buffer!==T.buffer)&&(l!==v.buffer&&(r.bindBuffer.call(t,34962,v.buffer),l=v.buffer),F=!0),(F||v.cached!==T.cached)&&r.vertexAttribPointer.call(t,g,v.size,v.type,v.normalized,v.stride,v.offset)}}this.currentArrayBuffer!==l&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)};function $V(i){if(typeof i.createVertexArray=="function")return;const e=i.getSupportedExtensions;i.getSupportedExtensions=function(){const n=e.call(this)||[];return n.indexOf("OES_vertex_array_object")<0&&n.push("OES_vertex_array_object"),n};const t=i.getExtension;i.getExtension=function(n){const o=t.call(this,n);return o||(n!=="OES_vertex_array_object"?null:(i.__OESVertexArrayObject||(this.__OESVertexArrayObject=new gf(this)),this.__OESVertexArrayObject))}}const W5="OES_element_index",Z5="WEBGL_draw_buffers",KV="EXT_disjoint_timer_query",WV="EXT_disjoint_timer_query_webgl2",ZV="EXT_texture_filter_anisotropic",X5="WEBGL_debug_renderer_info",XV=35723,JV=4352,YV=36795,e9=34047,t9=37445,i9=37446,zs=i=>dn(i)?void 0:0,r9={3074:i=>dn(i)?void 0:36064,[XV]:i=>dn(i)?void 0:JV,35977:zs,32937:zs,[YV]:(i,e)=>{const t=dn(i)?i.getExtension(WV):i.getExtension(KV);return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},[t9]:(i,e)=>{const t=i.getExtension(X5);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},[i9]:(i,e)=>{const t=i.getExtension(X5);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},[e9]:(i,e)=>{const t=i.luma.extensions[ZV];return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:zs,35071:zs,37447:zs,36063:(i,e)=>{if(!dn(i)){const t=i.getExtension(Z5);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:zs,35374:zs,35377:zs,34852:i=>{if(!dn(i)){const e=i.getExtension(Z5);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:i=>i.getExtension(W5)?2147483647:65535,33001:i=>i.getExtension(W5)?16777216:65535,33e3:i=>16777216,37157:zs,35373:zs,35657:zs,36183:zs,37137:zs,34045:zs,35978:zs,35979:zs,35968:zs,35376:zs,35375:zs,35659:zs,37154:zs,35371:zs,35658:zs,35076:zs,35077:zs,35380:zs};function n9(i,e,t){const r=r9[t],n=typeof r=="function"?r(i,e,t):r;return n!==void 0?n:e(t)}const s9="OES_vertex_array_object",J5="ANGLE_instanced_arrays",o9="WEBGL_draw_buffers",a9="EXT_disjoint_timer_query",l9="EXT_texture_filter_anisotropic",c9="VertexArray requires WebGL2 or OES_vertex_array_object extension";function u9(i,e){return{webgl2:dn(i),ext:i.getExtension(e)}}const Y5={[s9]:{meta:{suffix:"OES"},createVertexArray:()=>{ac(!1,c9)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[J5]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(i,e){ac(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[o9]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{ac(!1)}},[a9]:{meta:{suffix:"EXT"},createQuery:()=>{ac(!1)},deleteQuery:()=>{ac(!1)},beginQuery:()=>{ac(!1)},endQuery:()=>{},getQuery(i,e){return this.getQueryObject(i,e)},getQueryParameter(i,e){return this.getQueryObject(i,e)},getQueryObject:()=>{}}},Gw={readBuffer:(i,e,t)=>{dn(i)&&e(t)},getVertexAttrib:(i,e,t,r)=>{const{webgl2:n,ext:o}=u9(i,J5);let l;switch(r){case 35069:l=n?void 0:!1;break;case 35070:l=!n&&!o?0:void 0;break}return l!==void 0?l:e(t,r)},getProgramParameter:(i,e,t,r)=>{if(!dn(i))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(t,r)},getInternalformatParameter:(i,e,t,r,n)=>{if(!dn(i))switch(n){case 32937:return new Int32Array([0])}return i.getInternalformatParameter(t,r,n)},getTexParameter(i,e,t,r){switch(r){case 34046:const{extensions:n}=i.luma,o=n[l9];r=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(t,r)},getParameter:n9,hint(i,e,t,r){return e(t,r)}};function h9(i){i.luma=i.luma||{};const{luma:e}=i;return e.polyfilled||($V(i),A9(i),f9(i,Y5),d9(i,{target:e,target2:i}),e.polyfilled=!0),i}globalThis.polyfillContext=h9;function A9(i){i.luma.extensions={};const e=i.getSupportedExtensions()||[];for(const t of e)i.luma[t]=i.getExtension(t)}function d9(i,e){let{target:t,target2:r}=e;Object.keys(Gw).forEach(n=>{if(typeof Gw[n]=="function"){const o=i[n]?i[n].bind(i):()=>{},l=Gw[n].bind(null,i,o);t[n]=l,r[n]=l}})}function f9(i,e){for(const t of Object.getOwnPropertyNames(e))t!=="overrides"&&p9(i,{extension:t,target:i.luma,target2:i})}function p9(i,e){let{extension:t,target:r,target2:n}=e;const o=Y5[t];ac(o);const{meta:l={}}=o,{suffix:s=""}=l,g=i.getExtension(t);for(const v of Object.keys(o)){const T="".concat(v).concat(s);let F=null;v==="meta"||typeof i[v]=="function"||(g&&typeof g[T]=="function"?F=function(){return g[T](...arguments)}:typeof o[v]=="function"&&(F=o[v].bind(r))),F&&(r[v]=F,n[v]=F)}}const jw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},sd=(i,e,t)=>e?i.enable(t):i.disable(t),e3=(i,e,t)=>i.hint(t,e),Jc=(i,e,t)=>i.pixelStorei(t,e),g9=(i,e)=>{const t=dn(i)?36009:36160;return i.bindFramebuffer(t,e)},m9=(i,e)=>i.bindFramebuffer(36008,e);function ry(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const y9={3042:sd,32773:(i,e)=>i.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,e)=>i.clearColor(...e),3107:(i,e)=>i.colorMask(...e),2884:sd,2885:(i,e)=>i.cullFace(e),2929:sd,2931:(i,e)=>i.clearDepth(e),2932:(i,e)=>i.depthFunc(e),2928:(i,e)=>i.depthRange(...e),2930:(i,e)=>i.depthMask(e),3024:sd,35723:e3,36006:g9,2886:(i,e)=>i.frontFace(e),33170:e3,2849:(i,e)=>i.lineWidth(e),32823:sd,32824:"polygonOffset",10752:"polygonOffset",35977:sd,32938:"sampleCoverage",32939:"sampleCoverage",3089:sd,3088:(i,e)=>i.scissor(...e),2960:sd,2961:(i,e)=>i.clearStencil(e),2968:(i,e)=>i.stencilMaskSeparate(1028,e),36005:(i,e)=>i.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,e)=>i.viewport(...e),3333:Jc,3317:Jc,37440:Jc,37441:Jc,37443:Jc,3330:Jc,3332:Jc,3331:Jc,36010:m9,3314:Jc,32878:Jc,3316:Jc,3315:Jc,32877:Jc,framebuffer:(i,e)=>{const t=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,t)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{e=ry(e)?e:[e,e],i.blendEquationSeparate(...e)},blendFunc:(i,e)=>{e=ry(e)&&e.length===2?[...e,...e]:e,i.blendFuncSeparate(...e)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(...e),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=ry(e)?e:[e,e];const[t,r]=e;i.stencilMaskSeparate(1028,t),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,e)=>{e=ry(e)&&e.length===3?[...e,...e]:e;const[t,r,n,o,l,s]=e;i.stencilFuncSeparate(1028,t,r,n),i.stencilFuncSeparate(1029,o,l,s)},stencilOp:(i,e)=>{e=ry(e)&&e.length===3?[...e,...e]:e;const[t,r,n,o,l,s]=e;i.stencilOpSeparate(1028,t,r,n),i.stencilOpSeparate(1029,o,l,s)},viewport:(i,e)=>i.viewport(...e)};function xo(i,e,t){return e[i]!==void 0?e[i]:t[i]}const _9={blendEquation:(i,e,t)=>i.blendEquationSeparate(xo(32777,e,t),xo(34877,e,t)),blendFunc:(i,e,t)=>i.blendFuncSeparate(xo(32969,e,t),xo(32968,e,t),xo(32971,e,t),xo(32970,e,t)),polygonOffset:(i,e,t)=>i.polygonOffset(xo(32824,e,t),xo(10752,e,t)),sampleCoverage:(i,e,t)=>i.sampleCoverage(xo(32938,e,t),xo(32939,e,t)),stencilFuncFront:(i,e,t)=>i.stencilFuncSeparate(1028,xo(2962,e,t),xo(2967,e,t),xo(2963,e,t)),stencilFuncBack:(i,e,t)=>i.stencilFuncSeparate(1029,xo(34816,e,t),xo(36003,e,t),xo(36004,e,t)),stencilOpFront:(i,e,t)=>i.stencilOpSeparate(1028,xo(2964,e,t),xo(2965,e,t),xo(2966,e,t)),stencilOpBack:(i,e,t)=>i.stencilOpSeparate(1029,xo(34817,e,t),xo(34818,e,t),xo(34819,e,t))},t3={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,t)=>i({[e]:t}),hint:(i,e,t)=>i({[e]:t}),bindFramebuffer:(i,e,t)=>{switch(e){case 36160:return i({36006:t,36010:t});case 36009:return i({36006:t});case 36008:return i({36010:t});default:return null}},blendColor:(i,e,t,r,n)=>i({32773:new Float32Array([e,t,r,n])}),blendEquation:(i,e)=>i({32777:e,34877:e}),blendEquationSeparate:(i,e,t)=>i({32777:e,34877:t}),blendFunc:(i,e,t)=>i({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(i,e,t,r,n)=>i({32969:e,32968:t,32971:r,32970:n}),clearColor:(i,e,t,r,n)=>i({3106:new Float32Array([e,t,r,n])}),clearDepth:(i,e)=>i({2931:e}),clearStencil:(i,e)=>i({2961:e}),colorMask:(i,e,t,r,n)=>i({3107:[e,t,r,n]}),cullFace:(i,e)=>i({2885:e}),depthFunc:(i,e)=>i({2932:e}),depthRange:(i,e,t)=>i({2928:new Float32Array([e,t])}),depthMask:(i,e)=>i({2930:e}),frontFace:(i,e)=>i({2886:e}),lineWidth:(i,e)=>i({2849:e}),polygonOffset:(i,e,t)=>i({32824:e,10752:t}),sampleCoverage:(i,e,t)=>i({32938:e,32939:t}),scissor:(i,e,t,r,n)=>i({3088:new Int32Array([e,t,r,n])}),stencilMask:(i,e)=>i({2968:e,36005:e}),stencilMaskSeparate:(i,e,t)=>i({[e===1028?2968:36005]:t}),stencilFunc:(i,e,t,r)=>i({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(i,e,t,r,n)=>i({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:n}),stencilOp:(i,e,t,r)=>i({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(i,e,t,r,n)=>i({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:n}),viewport:(i,e,t,r,n)=>i({2978:[e,t,r,n]})},Nh=(i,e)=>i.isEnabled(e),i3={3042:Nh,2884:Nh,2929:Nh,3024:Nh,32823:Nh,32926:Nh,32928:Nh,3089:Nh,2960:Nh,35977:Nh};function r3(i){for(const e in i)return!1;return!0}function v9(i,e){if(i===e)return!0;const t=Array.isArray(i)||ArrayBuffer.isView(i),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&i.length===e.length){for(let n=0;n<i.length;++n)if(i[n]!==e[n])return!1;return!0}return!1}function n3(i,e){const t=i[e].bind(i);i[e]=function(){const n=arguments.length<=0?void 0:arguments[0];return n in i.state.cache?i.state.enable?i.state.cache[n]:t(...arguments):t(...arguments)},Object.defineProperty(i[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function b9(i,e,t){const r=i[e].bind(i);i[e]=function(){for(var o=arguments.length,l=new Array(o),s=0;s<o;s++)l[s]=arguments[s];const{valueChanged:g,oldValue:v}=t(i.state._updateCache,...l);return g&&r(...l),v},Object.defineProperty(i[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function x9(i){const e=i.useProgram.bind(i);i.useProgram=function(r){i.state.program!==r&&(e(r),i.state.program=r)}}class w9{constructor(e){let{copyState:t=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?C9(e):Object.assign({},jw),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){ac(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];xA(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,r;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in e){ac(o!==void 0);const l=e[o],s=this.cache[o];v9(l,s)||(t=!0,r=s,n&&!(o in n)&&(n[o]=s),this.cache[o]=l)}return{valueChanged:t,oldValue:r}}}function s3(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:t=!0,copyState:r}=e;if(ac(r!==void 0),!i.state){const{polyfillContext:n}=globalThis;n&&n(i),i.state=new w9(i,{copyState:r}),x9(i);for(const o in t3){const l=t3[o];b9(i,o,l)}n3(i,"getParameter"),n3(i,"isEnabled")}return i.state.enable=t,i}function B9(i){i.state||s3(i,{copyState:!1}),i.state.push()}function o3(i){ac(i.state),i.state.pop()}function xA(i,e){if(ac($_(i),"setParameters requires a WebGL context"),r3(e))return;const t={};for(const n in e){const o=Number(n),l=y9[n];l&&(typeof l=="string"?t[l]=!0:l(i,e[n],o))}const r=i.state&&i.state.cache;if(r)for(const n in t){const o=_9[n];o(i,e,r)}}function C9(i,e){if(e=e||jw,typeof e=="number"){const n=e,o=i3[n];return o?o(i,n):i.getParameter(n)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const n of t){const o=i3[n];r[n]=o?o(i,Number(n)):i.getParameter(Number(n))}return r}function E9(i){xA(i,jw)}function Yu(i,e,t){if(r3(e))return t(i);const{nocatch:r=!0}=e;B9(i),xA(i,e);let n;if(r)n=t(i),o3(i);else try{n=t(i)}finally{o3(i)}return n}function $p(i){const{luma:e}=i;if(i.canvas&&e){const t=e.canvasSizeInfo,r="clientWidth"in t?t.clientWidth:i.canvas.clientWidth;return r?i.drawingBufferWidth/r:1}return 1}function qw(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=$p(i),n=i.drawingBufferWidth,o=i.drawingBufferHeight;return T9(e,r,n,o,t)}function S9(i){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(i)?i<=0?1:i:i?e:1}function T9(i,e,t,r,n){const o=a3(i[0],e,t);let l=l3(i[1],e,r,n),s=a3(i[0]+1,e,t);const g=s===t-1?s:s-1;s=l3(i[1]+1,e,r,n);let v;return n?(s=s===0?s:s+1,v=l,l=s):v=s===r-1?s:s-1,{x:o,y:l,width:Math.max(g-o+1,1),height:Math.max(v-l+1,1)}}function a3(i,e,t){return Math.min(Math.round(i*e),t-1)}function l3(i,e,t,r){return r?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}const $w=bA(),I9=$w&&typeof document<"u",c3={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function u3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ac($w,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),i=Object.assign({},c3,i);const{width:e,height:t}=i;function r(s){if(i.throwOnError)throw new Error(s);return console.error(s),null}i.onError=r;let n;const{canvas:o}=i,l=F9({canvas:o,width:e,height:t,onError:r});return n=P9(l,i),n?(n=Kw(n,i),D9(n),n):null}function Kw(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!i||i._instrumented)return i;i._version=i._version||R9(i),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{},e=Object.assign({},c3,e);const{manageState:t,debug:r}=e;return t&&s3(i,{copyState:!1,log:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return hr.log(1,...o)()}}),$w&&r&&(globalThis.makeDebugContext?(i=globalThis.makeDebugContext(i,e),hr.level=Math.max(hr.level,1)):hr.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),i._instrumented=!0,i}function L9(i){const e=i.getParameter(7936),t=i.getParameter(7937),r=i.getExtension("WEBGL_debug_renderer_info"),n=r&&i.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),o=r&&i.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:n||e,renderer:o||t,vendorMasked:e,rendererMasked:t,version:i.getParameter(7938),shadingLanguageVersion:i.getParameter(35724)}}function M9(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i.canvas){const r=S9(e.useDevicePixels);k9(i,r,e);return}const t=i.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}function P9(i,e){const{onError:t}=e;let r=null;const n=g=>r=g.statusMessage||r;i.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:o=!0,webgl2:l=!0}=e;let s=null;return l&&(s=s||i.getContext("webgl2",e),s=s||i.getContext("experimental-webgl2",e)),o&&(s=s||i.getContext("webgl",e),s=s||i.getContext("experimental-webgl",e)),i.removeEventListener("webglcontextcreationerror",n,!1),s?(e.onContextLost&&i.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&i.addEventListener("webglcontextrestored",e.onContextRestored,!1),s):t("Failed to create ".concat(l&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function F9(i){let{canvas:e,width:t=800,height:r=600,onError:n}=i,o;return typeof e=="string"?(I9&&document.readyState==="complete"||n("createGLContext called on canvas '".concat(e,"' before page was loaded")),o=document.getElementById(e)):e?o=e:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",o.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function D9(i){const e=dn(i)?"WebGL2":"WebGL1",t=L9(i),r=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",n=i.debug?" debug":"";hr.info(1,"".concat(e).concat(n," context ").concat(r))()}function R9(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?2:1}function k9(i,e,t){let r="width"in t?t.width:i.canvas.clientWidth,n="height"in t?t.height:i.canvas.clientHeight;(!r||!n)&&(hr.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=i.canvas.width||1,n=i.canvas.height||1),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{};const o=i.luma.canvasSizeInfo;if(o.clientWidth!==r||o.clientHeight!==n||o.devicePixelRatio!==e){let l=e;const s=Math.floor(r*l),g=Math.floor(n*l);i.canvas.width=s,i.canvas.height=g,(i.drawingBufferWidth!==s||i.drawingBufferHeight!==g)&&(hr.warn("Device pixel ratio clamped")(),l=Math.min(i.drawingBufferWidth/r,i.drawingBufferHeight/n),i.canvas.width=Math.floor(r*l),i.canvas.height=Math.floor(n*l)),Object.assign(i.luma.canvasSizeInfo,{clientWidth:r,clientHeight:n,devicePixelRatio:e})}}function h3(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}let A3=class{constructor(e,t){ye(this,"name",void 0),ye(this,"type",void 0),ye(this,"sampleSize",1),ye(this,"time",void 0),ye(this,"count",void 0),ye(this,"samples",void 0),ye(this,"lastTiming",void 0),ye(this,"lastSampleTime",void 0),ye(this,"lastSampleCount",void 0),ye(this,"_count",0),ye(this,"_time",0),ye(this,"_samples",0),ye(this,"_startTime",0),ye(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=h3(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(h3()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},Ww=class{constructor(e){ye(this,"id",void 0),ye(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:r}=e;return this.stats[t]||(e instanceof A3?this.stats[t]=e:this.stats[t]=new A3(t,r)),this.stats[t]}};const ny="8.5.21",O9="set luma.log.level=1 (or higher) to trace rendering";class U9{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Ww({id:e})),this.stats.get(e)}}const mf=new U9;if(globalThis.luma&&globalThis.luma.VERSION!==ny)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(ny));globalThis.luma||(bA()&&hr.log(1,"luma.gl ".concat(ny," - ").concat(O9))(),globalThis.luma=globalThis.luma||{VERSION:ny,version:ny,log:hr,stats:mf,globals:{modules:{},nodeIO:{}}});function N9(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function z9(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}function Xi(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}function Zw(i,e){if(typeof e!="string")return e;const t=Number(e);if(!isNaN(t))return t;e=e.replace(/^.*\./,"");const r=i[e];return Xi(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function od(i,e){e=Number(e);for(const t in i)if(i[t]===e)return"GL.".concat(t);return String(e)}const Xw={};function wA(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Xw[i]=Xw[i]||1;const e=Xw[i]++;return"".concat(i,"-").concat(e)}function d3(i){return Xi(typeof i=="number","Input must be a number"),i&&(i&i-1)===0}function Kp(i){let e=!0;for(const t in i){e=!1;break}return e}function f3(i,e,t,r){const n="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(i);r.forEach(l=>{o.methodName||(o[l]=()=>{throw hr.removed("Calling removed method ".concat(e,".").concat(l,": "),n)(),new Error(l)})})}const Wp="Resource subclass must define virtual methods";let BA=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};K_(e);const{id:r,userData:n={}}=t;this.gl=e,this.gl2=e,this.id=r||wA(this[Symbol.toStringTag]),this.userData=n,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Zw(this.gl,e),Xi(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=dn(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const s=n.webgl1,g="webgl2"in n?n.webgl2:n.webgl1;return o?g:s}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:r}=e,n=this.constructor.PARAMETERS||{},o=dn(this.gl),l={},s=t||Object.keys(n);for(const g of s){const v=n[g];if(v&&(!("webgl2"in v)||o)&&(!("extension"in v)||this.gl.getExtension(v.extension))){const F=r?od(this.gl,g):g;l[F]=this.getParameter(g,e),r&&v.type==="GLenum"&&(l[F]=od(this.gl,l[F]))}}return l}setParameter(e,t){e=Zw(this.gl,e),Xi(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=dn(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");n.type==="GLenum"&&(t=Zw(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return f3(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(Wp)}_deleteHandle(){throw new Error(Wp)}_bindHandle(e){throw new Error(Wp)}_getOptsFromHandle(){throw new Error(Wp)}_getParameter(e,t){throw new Error(Wp)}_setParameter(e,t){throw new Error(Wp)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=mf.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];mf.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const n=mf.get("Memory Usage".concat(r));n.get("GPU Memory").addCount(e),n.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=mf.get("Memory Usage".concat(t));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const Q9="Failed to deduce GL constant from typed array";function Jw(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Q9)}}function sy(i){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function V9(i){let{data:e,width:t,height:r,bytesPerPixel:n=4,temp:o}=i;const l=t*n;o=o||new Uint8Array(l);for(let s=0;s<r/2;++s){const g=s*l,v=(r-s-1)*l;o.set(e.subarray(g,g+l)),e.copyWithin(g,v,v+l),e.set(o,v)}}function H9(i){let{data:e,width:t,height:r}=i;const n=Math.round(t/2),o=Math.round(r/2),l=new Uint8Array(n*o*4);for(let s=0;s<o;s++)for(let g=0;g<n;g++)for(let v=0;v<4;v++)l[(s*n+g)*4+v]=e[(s*2*t+g*2)*4+v];return{data:l,width:n,height:o}}function Yw(i,e,t){const{removedProps:r={},deprecatedProps:n={},replacedProps:o={}}=t;for(const s in r)if(s in e){const v=r[s]?"".concat(i,".").concat(r[s]):"N/A";hr.removed("".concat(i,".").concat(s),v)()}for(const s in n)if(s in e){const g=n[s];hr.deprecated("".concat(i,".").concat(s),"".concat(i,".").concat(g))()}let l=null;for(const s in o)if(s in e){const g=o[s];hr.deprecated("".concat(i,".").concat(s),"".concat(i,".").concat(g))(),l=l||Object.assign({},e),l[g]=e[s],delete l[s]}return l||e}const G9={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},j9={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Lc{static getBytesPerElement(e){return sy(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Xi(e.size),sy(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Lc(G9,...t)}constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Lc.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Lc.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Yw("Accessor",e,j9),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const p3=10,g3={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},q9={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:g3},$9={removedProps:g3};class bs extends BA{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Lc.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Lc.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Yw("Buffer",e,q9),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Yw("Buffer",e,$9),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Lc(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:n=0}=e,o=e.byteLength||e.length;Xi(t);const l=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(l,this.handle),n!==0||o!==void 0?(lc(this.gl),this.gl.bufferSubData(this.target,r,t,n,o)):this.gl.bufferSubData(l,r,t),this.gl.bindBuffer(l,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:r=0,writeOffset:n=0,size:o}=e;const{gl:l}=this;return lc(l),l.bindBuffer(36662,t.handle),l.bindBuffer(36663,this.handle),l.copyBufferSubData(36662,36663,r,n,o),l.bindBuffer(36662,null),l.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:n=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};lc(this.gl);const o=sy(this.accessor.type||5126,{clamped:!1}),l=this._getAvailableElementCount(t),s=r;let g,v;e?(v=e.length,g=v-s):(g=Math.min(l,n||l),v=s+g);const T=Math.min(l,g);return n=n||T,Xi(n<=T),e=e||new o(v),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,n),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?n!==void 0?this.gl.bindBufferRange(e,t,this.handle,r,n):(Xi(r===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(p3,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;Xi(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.usage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.debugData=e.slice(0,p3),this.bytesUsed=r,this._trackAllocatedMemory(r);const o=Jw(e);return Xi(o),this.setAccessor(new Lc(this.accessor,{type:o})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Xi(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=sy(this.accessor.type||5126,{clamped:!1}),r=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new Lc(this.accessor,{type:Jw(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return hr.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return hr.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return hr.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return hr.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Lc(this.accessor,e),this}}const e2={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},m3={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},y3={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function K9(i,e){const t=e2[e];if(!t)return!1;if(t.gl1===void 0&&t.gl2===void 0)return!0;const r=dn(i)&&t.gl2||t.gl1;return typeof r=="string"?i.getExtension(r):r}function W9(i,e){const t=e2[e];switch(t&&t.types[0]){case 5126:return i.getExtension("OES_texture_float_linear");case 5131:return i.getExtension("OES_texture_half_float_linear");default:return!0}}const Z9=[9729,9728],_3=globalThis.WebGLBuffer||function(){};class Zp extends BA{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:n}=t;let o=!0;return r&&(o=o&&K9(e,r),o=o&&(!n||W9(e,r))),o}constructor(e,t){const{id:r=wA("texture"),handle:n,target:o}=t;super(e,{id:r,handle:n}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(pe=>this.initialize(Object.assign({},e,{pixels:pe,data:pe}))),this;const r=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(r&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:n=null,format:o=6408,border:l=0,recreate:s=!1,parameters:g={},pixelStore:v={},textureUnit:T=void 0}=e;t||(t=n);let{width:F,height:R,dataFormat:U,type:J,compressed:te=!1,mipmaps:Ae=!0}=e;const{depth:he=0}=e;return{width:F,height:R,compressed:te,dataFormat:U,type:J}=this._deduceParameters({format:o,type:J,dataFormat:U,compressed:te,data:t,width:F,height:R}),this.width=F,this.height=R,this.depth=he,this.format=o,this.type=J,this.dataFormat=U,this.border=l,this.textureUnit=T,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),Ae&&this._isNPOT()&&(hr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),Ae=!1,this._updateForNPOT(g)),this.mipmaps=Ae,this.setImageData({data:t,width:F,height:R,depth:he,format:o,type:J,dataFormat:U,border:l,mipmaps:Ae,parameters:v,compressed:te}),Ae&&this.generateMipmap(),this.setParameters(g),s&&(this.data=t),r&&(this._video={video:t,parameters:g,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:r,mipmaps:n=!1}=e;return r!==this.width||t!==this.height?this.initialize({width:r,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(hr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Yu(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:n=0,format:o=this.format,border:l=this.border,offset:s=0,parameters:g={}}=e;let{data:v=null,type:T=this.type,width:F=this.width,height:R=this.height,dataFormat:U=this.dataFormat,compressed:J=!1}=e;v||(v=r),{type:T,dataFormat:U,compressed:J,width:F,height:R}=this._deduceParameters({format:o,type:T,dataFormat:U,compressed:J,data:v,width:F,height:R});const{gl:te}=this;te.bindTexture(this.target,this.handle);let Ae=null;({data:v,dataType:Ae}=this._getDataType({data:v,compressed:J}));let he,pe=0;if(Yu(this.gl,g,()=>{switch(Ae){case"null":te.texImage2D(t,n,o,F,R,l,U,T,v);break;case"typed-array":te.texImage2D(t,n,o,F,R,l,U,T,v,s);break;case"buffer":he=lc(te),he.bindBuffer(35052,v.handle||v),he.texImage2D(t,n,o,F,R,l,U,T,s),he.bindBuffer(35052,null);break;case"browser-object":dn(te)?te.texImage2D(t,n,o,F,R,l,U,T,v):te.texImage2D(t,n,o,U,T,v);break;case"compressed":for(const[be,Te]of v.entries())te.compressedTexImage2D(t,be,Te.format,Te.width,Te.height,l,Te.data),pe+=Te.levelSize;break;default:Xi(!1,"Unknown image data type")}}),Ae==="compressed")this._trackAllocatedMemory(pe,"Texture");else if(v&&v.byteLength)this._trackAllocatedMemory(v.byteLength,"Texture");else{const be=m3[this.dataFormat]||4,Te=y3[this.type]||1;this._trackAllocatedMemory(this.width*this.height*be*Te,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:r=null,data:n=null,x:o=0,y:l=0,width:s=this.width,height:g=this.height,level:v=0,format:T=this.format,type:F=this.type,dataFormat:R=this.dataFormat,compressed:U=!1,offset:J=0,border:te=this.border,parameters:Ae={}}=e;if({type:F,dataFormat:R,compressed:U,width:s,height:g}=this._deduceParameters({format:T,type:F,dataFormat:R,compressed:U,data:n,width:s,height:g}),Xi(this.depth===0,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){const he=n;n=he.data,s=he.shape[0],g=he.shape[1]}n instanceof bs&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Yu(this.gl,Ae,()=>{if(U)this.gl.compressedTexSubImage2D(t,v,o,l,s,g,T,n);else if(n===null)this.gl.texSubImage2D(t,v,o,l,s,g,R,F,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(t,v,o,l,s,g,R,F,n,J);else if(n instanceof _3){const he=lc(this.gl);he.bindBuffer(35052,n),he.texSubImage2D(t,v,o,l,s,g,R,F,J),he.bindBuffer(35052,null)}else dn(this.gl)?lc(this.gl).texSubImage2D(t,v,o,l,s,g,R,F,n):this.gl.texSubImage2D(t,v,o,l,R,F,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return hr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:r=!1}=e;return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof bs?{data:t.handle,dataType:"buffer"}:t instanceof _3?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:n,height:o,dataFormat:l,type:s,compressed:g}=e;const v=e2[t];return l=l||v&&v.dataFormat,s=s||v&&v.types[0],g=g||v&&v.compressed,{width:n,height:o}=this._deduceImageSize(r,n,o),{dataFormat:l,type:s,compressed:g,width:n,height:o,format:t,data:r}}_deduceImageSize(e,t,r){let n;return typeof ImageData<"u"&&e instanceof ImageData?n={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?n={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?n={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?n={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?n={width:e.videoWidth,height:e.videoHeight}:e?n={width:t,height:r}:n={width:t>=0?t:1,height:r>=0?r:1},Xi(n,"Could not deduced texture size"),Xi(t===void 0||n.width===t,"Deduced texture width does not match supplied width"),Xi(r===void 0||n.height===r,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Xi(!1);break;default:this.gl.texParameteri(this.target,e,t);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return dn(this.gl)||!this.width||!this.height?!1:!d3(this.width)||!d3(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:Z9.indexOf(t)===-1&&(t=9729);break;case 10242:case 10243:t!==33071&&(t=33071);break}return t}}let X9="";function J9(i,e){return Xi(typeof i=="string"),i=X9+i,new Promise((t,r)=>{try{const n=new Image;n.onload=()=>t(n),n.onerror=()=>r(new Error("Could not load image ".concat(i,"."))),n.crossOrigin=e&&e.crossOrigin||"anonymous",n.src=i}catch(n){r(n)}})}class Yc extends Zp{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return Zp.isSupported(e,t)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};K_(e),(t instanceof Promise||typeof t=="string")&&(t={data:t}),typeof t.data=="string"&&(t=Object.assign({},t,{data:J9(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const t2=[34069,34070,34071,34072,34073,34074];class v3 extends Zp{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};K_(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:t=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:t,data:r,x:n=0,y:o=0,mipmapLevel:l=0}=e;return this._subImage({target:t,data:r,x:n,y:o,mipmapLevel:l})}async setCubeMapImageData(e){let{width:t,height:r,pixels:n,data:o,border:l=0,format:s=6408,type:g=5121}=e;const{gl:v}=this,T=n||o,F=await Promise.all(t2.map(R=>{const U=T[R];return Promise.all(Array.isArray(U)?U:[U])}));this.bind(),t2.forEach((R,U)=>{F[U].length>1&&this.opts.mipmaps!==!1&&hr.warn("".concat(this.id," has mipmap and multiple LODs."))(),F[U].forEach((J,te)=>{t&&r?v.texImage2D(R,te,s,t,r,l,s,g,J):v.texImage2D(R,te,s,s,g,J)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:n,pixels:o,data:l,border:s=0,format:g=6408,type:v=5121}=e,{gl:T}=this,F=o||l;return this.bind(),F instanceof Promise?F.then(R=>this.setImageDataForFace(Object.assign({},e,{face:t,data:R,pixels:R}))):this.width||this.height?T.texImage2D(t,0,g,r,n,s,g,v,F):T.texImage2D(t,0,g,g,v,F),this}}v3.FACES=t2;class Y9 extends Zp{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return dn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};lc(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:r=6408,width:n,height:o,depth:l=1,border:s=0,format:g,type:v=5121,offset:T=0,data:F,parameters:R={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Yu(this.gl,R,()=>{ArrayBuffer.isView(F)&&this.gl.texImage3D(this.target,t,r,n,o,l,s,g,v,F),F instanceof bs&&(this.gl.bindBuffer(35052,F.handle),this.gl.texImage3D(this.target,t,r,n,o,l,s,g,v,T))}),F&&F.byteLength)this._trackAllocatedMemory(F.byteLength,"Texture");else{const U=m3[this.dataFormat]||4,J=y3[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*U*J,"Texture")}return this.loaded=!0,this}}const yf="EXT_color_buffer_float",b3={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:yf,bpp:2},33327:{gl2:yf,bpp:4},34842:{gl2:yf,bpp:8},33326:{gl2:yf,bpp:4},33328:{gl2:yf,bpp:8},34836:{gl2:yf,bpp:16},35898:{gl2:yf,bpp:4}};function eH(i,e,t){const r=t[e];if(!r)return!1;const n=dn(i)&&r.gl2||r.gl1;return typeof n=="string"?i.getExtension(n):n}class Xp extends BA{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!t||eH(e,t,b3)}static getSamplesForFormat(e,t){let{format:r}=t;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:r=1,height:n=1,samples:o=0}=e;return Xi(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&dn(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,t,r,n):this.gl.renderbufferStorage(36161,t,r,n),this.format=t,this.width=r,this.height=n,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*b3[this.format].bpp),this}resize(e){let{width:t,height:r}=e;return t!==this.width||r!==this.height?this.initialize({width:t,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const tH=256,iH=1024,rH=16384,x3=6144,w3=6145,B3=6146,C3=34041,E3="clear: bad arguments";function i2(i){let{framebuffer:e=null,color:t=null,depth:r=null,stencil:n=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};e&&(o.framebuffer=e);let l=0;t&&(l|=rH,t!==!0&&(o.clearColor=t)),r&&(l|=tH,r!==!0&&(o.clearDepth=r)),n&&(l|=iH,r!==!0&&(o.clearStencil=r)),Xi(l!==0,E3),Yu(i,o,()=>{i.clear(l)})}function nH(i){let{framebuffer:e=null,buffer:t=x3,drawBuffer:r=0,value:n=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};lc(i),Yu(i,{framebuffer:e},()=>{switch(t){case x3:switch(n.constructor){case Int32Array:i.clearBufferiv(t,r,n);break;case Uint32Array:i.clearBufferuiv(t,r,n);break;case Float32Array:default:i.clearBufferfv(t,r,n)}break;case w3:i.clearBufferfv(w3,0,[n]);break;case B3:i.clearBufferiv(B3,0,[n]);break;case C3:const[o,l]=n;i.clearBufferfi(C3,0,o,l);break;default:Xi(!1,E3)}})}function sH(i){switch(i){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Xi(!1),0}}function W_(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:t=0,sourceY:r=0,sourceFormat:n=6408}=e;let{sourceAttachment:o=36064,target:l=null,sourceWidth:s,sourceHeight:g,sourceType:v}=e;const{framebuffer:T,deleteFramebuffer:F}=oH(i);Xi(T);const{gl:R,handle:U,attachments:J}=T;s=s||T.width,g=g||T.height,o===36064&&U===null&&(o=1028),Xi(J[o]),v=v||J[o].type,l=aH(l,v,n,s,g),v=v||Jw(l);const te=R.bindFramebuffer(36160,U);return R.readPixels(t,r,s,g,n,v,l),R.bindFramebuffer(36160,te||null),F&&T.delete(),l}function S3(i){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=W_(i,{sourceAttachment:e}),{width:n,height:o}=i;for(;o>t;)({data:r,width:n,height:o}=H9({data:r,width:n,height:o}));V9({data:r,width:n,height:o});const l=document.createElement("canvas");l.width=n,l.height=o;const s=l.getContext("2d"),g=s.createImageData(n,o);return g.data.set(r),s.putImageData(g,0,0),l.toDataURL()}function oH(i){return i instanceof ba?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:gH(i),deleteFramebuffer:!0}}function aH(i,e,t,r,n){if(i)return i;e=e||5121;const o=sy(e,{clamped:!1}),l=sH(t);return new o(r*n*l)}const Qs={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function lH(i){const e=new Yc(i,{format:6408,type:5126,dataFormat:6408}),t=new ba(i,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=t.getStatus();return e.delete(),t.delete(),r===36053}const T3={[Qs.WEBGL2]:[!1,!0],[Qs.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Qs.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Qs.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Qs.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Qs.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Qs.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Qs.FLOAT_BLEND]:["EXT_float_blend"],[Qs.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Qs.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Qs.TEXTURE_FLOAT]:["OES_texture_float",!0],[Qs.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Qs.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Qs.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Qs.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Qs.COLOR_ATTACHMENT_RGBA32F]:[lH,"EXT_color_buffer_float"],[Qs.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Qs.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Qs.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Qs.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Qs.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Qs.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},cH=2;function r2(i,e){return I3(i,e)}function I3(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>L3(i,t))}function uH(i){i.luma=i.luma||{},i.luma.caps=i.luma.caps||{};for(const e in T3)i.luma.caps[e]===void 0&&(i.luma.caps[e]=L3(i,e));return i.luma.caps}function L3(i,e){return i.luma=i.luma||{},i.luma.caps=i.luma.caps||{},i.luma.caps[e]===void 0&&(i.luma.caps[e]=hH(i,e)),i.luma.caps[e]||hr.log(cH,"Feature: ".concat(e," not supported"))(),i.luma.caps[e]}function hH(i,e){const t=T3[e];Xi(t,e);let r;const n=dn(i)&&t[1]||t[0];if(typeof n=="function")r=n(i);else if(Array.isArray(n)){r=!0;for(const o of n)r=r&&!!i.getExtension(o)}else typeof n=="string"?r=!!i.getExtension(n):typeof n=="boolean"?r=n:Xi(!1);return r}const M3="Multiple render targets not supported";class ba extends BA{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:n}=t;let o=!0;return r&&(o=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),n&&(o=o&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new ba(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=lc(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=lc(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:r=1,attachments:n=null,color:o=!0,depth:l=!0,stencil:s=!1,check:g=!0,readBuffer:v=void 0,drawBuffers:T=void 0}=e;if(Xi(t>=0&&r>=0,"Width and height need to be integers"),this.width=t,this.height=r,n)for(const F in n){const R=n[F];(Array.isArray(R)?R[0]:R).resize({width:t,height:r})}else n=this._createDefaultAttachments(o,l,s,t,r);this.update({clearAttachments:!0,attachments:n,readBuffer:v,drawBuffers:T}),n&&g&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:r,drawBuffers:n,clearAttachments:o=!1,resizeAttachments:l=!0}=e;this.attach(t,{clearAttachments:o,resizeAttachments:l});const{gl:s}=this,g=s.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),n&&this._setDrawBuffers(n),s.bindFramebuffer(36160,g||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:t,height:r}=e;if(this.handle===null)return Xi(t===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&hr.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(r))();for(const n in this.attachments)this.attachments[n].resize({width:t,height:r});return this.width=t,this.height=r,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};t&&Object.keys(this.attachments).forEach(l=>{n[l]=null}),Object.assign(n,e);const o=this.gl.bindFramebuffer(36160,this.handle);for(const l in n){Xi(l!==void 0,"Misspelled framebuffer binding point?");const s=Number(l),g=n[s];let v=g;if(!v)this._unattach(s);else if(v instanceof Xp)this._attachRenderbuffer({attachment:s,renderbuffer:v});else if(Array.isArray(g)){const[T,F=0,R=0]=g;v=T,this._attachTexture({attachment:s,texture:T,layer:F,level:R})}else this._attachTexture({attachment:s,texture:v,layer:0,level:0});r&&v&&v.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(l=>!this.attachments[l]).forEach(l=>{delete this.attachments[l]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(dH(e));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:t,depth:r,stencil:n,drawBuffers:o=[]}=e,l=this.gl.bindFramebuffer(36160,this.handle);return(t||r||n)&&i2(this.gl,{color:t,depth:r,stencil:n}),o.forEach((s,g)=>{nH(this.gl,{drawBuffer:g,value:s})}),this.gl.bindFramebuffer(36160,l||null),this}readPixels(){return hr.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return hr.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return hr.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return hr.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return hr.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return hr.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:r=0,y:n=0,width:o,height:l}=e;const s=lc(this.gl),g=s.bindFramebuffer(36008,this.handle);return r===0&&n===0&&o===void 0&&l===void 0?s.invalidateFramebuffer(36008,t):s.invalidateFramebuffer(36008,t,r,n,o,l),s.bindFramebuffer(36008,g),this}getAttachmentParameter(e,t,r){let n=this._getAttachmentParameterFallback(t);return n===null&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),r&&n>1e3&&(n=od(this.gl,n)),n}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const n={};for(const o of r){const l=t?od(this.gl,o):o;n[l]=this.getAttachmentParameter(e,o,t)}return n}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const t=Object.keys(this.attachments),r={};for(const n of t){const o=Number(n),l=e?od(this.gl,o):o;r[l]=this.getAttachmentParameters(o,e)}return r}show(){return typeof window<"u"&&window.open(S3(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>hr.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);const r=S3(this,{targetMaxHeight:100});return hr.image({logLevel:e,message:t,image:r},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,n,o){let l=null;return e&&(l=l||{},l[36064]=new Yc(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:n,height:o,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(l[36064])),t&&r?(l=l||{},l[33306]=new Xp(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:n,height:111}),this.ownResources.push(l[33306])):t?(l=l||{},l[36096]=new Xp(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:n,height:o}),this.ownResources.push(l[36096])):r&&Xi(!1),l}_unattach(e){const t=this.attachments[e];t&&(t instanceof Xp?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:r}=e;const{gl:n}=this;n.framebufferRenderbuffer(36160,t,36161,r.handle),this.attachments[t]=r}_attachTexture(e){let{attachment:t=36064,texture:r,layer:n,level:o}=e;const{gl:l}=this;switch(l.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:lc(l).framebufferTextureLayer(36160,t,r.target,o,n);break;case 34067:const g=AH(n);l.framebufferTexture2D(36160,t,g,r.handle,o);break;case 3553:l.framebufferTexture2D(36160,t,3553,r.handle,o);break;default:Xi(!1,"Illegal texture type")}l.bindTexture(r.target,null),this.attachments[t]=r}_setReadBuffer(e){const t=VV(this.gl);t?t.readBuffer(e):Xi(e===36064||e===1029,M3),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,r=lc(t);if(r)r.drawBuffers(e);else{const n=t.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(e):Xi(e.length===1&&(e[0]===36064||e[0]===1029),M3)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=uH(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return!t.WEBGL2&&!t.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function AH(i){return i<34069?i+34069:i}function dH(i){return(ba.STATUS||{})[i]||"Framebuffer error ".concat(i)}const fH=[36049,36048,33296,33298,33299,33300,33301,33302,33303];ba.ATTACHMENT_PARAMETERS=fH;function pH(i,e){Xi(i instanceof Yc||i instanceof v3||i instanceof Y9);const t=i.constructor,{gl:r,width:n,height:o,format:l,type:s,dataFormat:g,border:v,mipmaps:T}=i,F=Object.assign({width:n,height:o,format:l,type:s,dataFormat:g,border:v,mipmaps:T},e);return new t(r,F)}function gH(i,e){const{gl:t,width:r,height:n,id:o}=i;return new ba(t,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:n,attachments:{36064:i}}))}function Z_(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=i.match(t);return r?r[1]:e}const mH=35632,yH=35633;function _H(i){switch(i){case mH:return"fragment";case yH:return"vertex";default:return"unknown type"}}function vH(i,e,t,r){const n=i.split(/\r?\n/),o={},l={},s=r||Z_(e)||"(unnamed)",g="".concat(_H(t)," shader ").concat(s);for(let T=0;T<n.length;T++){const F=n[T];if(F.length<=1)continue;const R=F.split(":"),U=R[0],J=parseInt(R[2],10);if(isNaN(J))throw new Error("GLSL compilation error in ".concat(g,": ").concat(i));U!=="WARNING"?o[J]=F:l[J]=F}const v=bH(e);return{shaderName:g,errors:P3(o,v),warnings:P3(l,v)}}function P3(i,e){let t="";for(let r=0;r<e.length;r++){const n=e[r];if(!(!i[r+3]&&!i[r+2]&&!i[r+1])&&(t+="".concat(n,`
`),i[r+1])){const o=i[r+1],l=o.split(":",3),s=l[0],g=parseInt(l[1],10)||0,v=o.substring(l.join(":").length+1).trim();t+=F3("^^^ ".concat(s,": ").concat(v,`

`),g)}}return t}function bH(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=i.split(/\r?\n/),n=String(r.length+e-1).length;return r.map((o,l)=>{const s=String(l+e),g=s.length;return F3(s,n-g)+t+o})}function F3(i,e){let t="";for(let r=0;r<e;++r)t+=" ";return"".concat(t).concat(i)}function D3(i){let e=100;const t=i.match(/[^\s]+/g);if(t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}return e}const xH="Shader: GLSL source code must be a JavaScript string";class oy extends BA{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Xi(!1),"unknown"}}constructor(e,t){K_(e),Xi(typeof t.source=="string",xH);const r=Z_(t.source,null)||t.id||wA("unnamed ".concat(oy.getTypeName(t.shaderType)));super(e,{id:r}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e;const r=Z_(t,null);r&&(this.id=wA(r)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(oy.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Z_(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:n,errors:o,warnings:l}=vH(r,this.source,this.shaderType,this.id);throw hr.error("GLSL compilation errors in ".concat(n,`
`).concat(o))(),hr.warn("GLSL compilation warnings in ".concat(n,`
`).concat(l))(),new Error("GLSL compilation errors in ".concat(n))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class n2 extends oy{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class s2 extends oy{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const wH={5126:Ks.bind(null,"uniform1fv",eu,1,Tl),35664:Ks.bind(null,"uniform2fv",eu,2,Tl),35665:Ks.bind(null,"uniform3fv",eu,3,Tl),35666:Ks.bind(null,"uniform4fv",eu,4,Tl),5124:Ks.bind(null,"uniform1iv",ad,1,Tl),35667:Ks.bind(null,"uniform2iv",ad,2,Tl),35668:Ks.bind(null,"uniform3iv",ad,3,Tl),35669:Ks.bind(null,"uniform4iv",ad,4,Tl),35670:Ks.bind(null,"uniform1iv",ad,1,Tl),35671:Ks.bind(null,"uniform2iv",ad,2,Tl),35672:Ks.bind(null,"uniform3iv",ad,3,Tl),35673:Ks.bind(null,"uniform4iv",ad,4,Tl),35674:Ks.bind(null,"uniformMatrix2fv",eu,4,CA),35675:Ks.bind(null,"uniformMatrix3fv",eu,9,CA),35676:Ks.bind(null,"uniformMatrix4fv",eu,16,CA),35678:nl,35680:nl,5125:Ks.bind(null,"uniform1uiv",X_,1,Tl),36294:Ks.bind(null,"uniform2uiv",X_,2,Tl),36295:Ks.bind(null,"uniform3uiv",X_,3,Tl),36296:Ks.bind(null,"uniform4uiv",X_,4,Tl),35685:Ks.bind(null,"uniformMatrix2x3fv",eu,6,CA),35686:Ks.bind(null,"uniformMatrix2x4fv",eu,8,CA),35687:Ks.bind(null,"uniformMatrix3x2fv",eu,6,CA),35688:Ks.bind(null,"uniformMatrix3x4fv",eu,12,CA),35689:Ks.bind(null,"uniformMatrix4x2fv",eu,8,CA),35690:Ks.bind(null,"uniformMatrix4x3fv",eu,12,CA),35678:nl,35680:nl,35679:nl,35682:nl,36289:nl,36292:nl,36293:nl,36298:nl,36299:nl,36300:nl,36303:nl,36306:nl,36307:nl,36308:nl,36311:nl},BH={},CH={},EH={},R3=[0];function o2(i,e,t,r){e===1&&typeof i=="boolean"&&(i=i?1:0),Number.isFinite(i)&&(R3[0]=i,i=R3);const n=i.length;if(n%e&&hr.warn("Uniform size should be multiples of ".concat(e),i)(),i instanceof t)return i;let o=r[n];o||(o=new t(n),r[n]=o);for(let l=0;l<n;l++)o[l]=i[l];return o}function eu(i,e){return o2(i,e,Float32Array,BH)}function ad(i,e){return o2(i,e,Int32Array,CH)}function X_(i,e){return o2(i,e,Uint32Array,EH)}function k3(i,e,t){const r=wH[t.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(t.type));return r().bind(null,i,e)}function SH(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,t=i.match(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(i));return{name:t[1],length:t[2]||1,isArray:!!t[2]}}function TH(i,e,t){for(const r in i){const n=i[r];if((!t||!!t[r])&&!IH(n))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),n),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function IH(i){return Array.isArray(i)||ArrayBuffer.isView(i)?MH(i):isFinite(i)||i===!0||i===!1||i instanceof Zp||i instanceof Xp?!0:i instanceof ba?!!i.texture:!1}function LH(i,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(i[e]){const r=i[e];for(let n=0,o=t.length;n<o;++n)r[n]=t[n]}else i[e]=t.slice();else i[e]=t}function MH(i){if(i.length===0)return!1;const e=Math.min(i.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(i[t]))return!1;return!0}function nl(){let i=null;return(e,t,r)=>{const n=i!==r;return n&&(e.uniform1i(t,r),i=r),n}}function Ks(i,e,t,r){let n=null,o=null;return(l,s,g)=>{const v=e(g,t),T=v.length;let F=!1;if(n===null)n=new Float32Array(T),o=T,F=!0;else{Xi(o===T,"Uniform length cannot change.");for(let R=0;R<T;++R)if(v[R]!==n[R]){F=!0;break}}return F&&(r(l,i,s,v),n.set(v)),F}}function Tl(i,e,t,r){i[e](t,r)}function CA(i,e,t,r){i[e](t,!1,r)}const PH=5120,FH=5121,DH=5122,RH=5123,O3=0,J_=1,kH=2,OH=3,Y_=4,UH=5,NH=6,xa=5126,zH=35664,QH=35665,VH=35666,ay=5124,HH=35667,GH=35668,jH=35669,ly=5125,qH=36294,$H=36295,KH=36296,WH=35670,ZH=35671,XH=35672,JH=35673,YH=35674,e7=35675,t7=35676,i7=35685,r7=35686,n7=35687,s7=35688,o7=35689,a7=35690,a2={[xa]:[xa,1,"float"],[zH]:[xa,2,"vec2"],[QH]:[xa,3,"vec3"],[VH]:[xa,4,"vec4"],[ay]:[ay,1,"int"],[HH]:[ay,2,"ivec2"],[GH]:[ay,3,"ivec3"],[jH]:[ay,4,"ivec4"],[ly]:[ly,1,"uint"],[qH]:[ly,2,"uvec2"],[$H]:[ly,3,"uvec3"],[KH]:[ly,4,"uvec4"],[WH]:[xa,1,"bool"],[ZH]:[xa,2,"bvec2"],[XH]:[xa,3,"bvec3"],[JH]:[xa,4,"bvec4"],[YH]:[xa,8,"mat2"],[i7]:[xa,8,"mat2x3"],[r7]:[xa,8,"mat2x4"],[e7]:[xa,12,"mat3"],[n7]:[xa,12,"mat3x2"],[s7]:[xa,12,"mat3x4"],[t7]:[xa,16,"mat4"],[o7]:[xa,16,"mat4x2"],[a7]:[xa,16,"mat4x3"]};function l7(i){switch(i){case O3:return O3;case J_:return J_;case OH:return J_;case kH:return J_;case Y_:return Y_;case UH:return Y_;case NH:return Y_;default:return Xi(!1),0}}function U3(i){const e=a2[i];if(!e)return null;const[t,r]=e;return{type:t,components:r}}function N3(i,e){switch(i){case PH:case FH:case DH:case RH:i=xa;break}for(const t in a2){const[r,n,o]=a2[t];if(r===i&&n===e)return{glType:t,name:o}}return null}class c7{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,35721);for(let n=0;n<r;n++){const{name:o,type:l,size:s}=t.getActiveAttrib(e.handle,n),g=t.getAttribLocation(e.handle,o);g>=0&&this._addAttribute(g,o,l,s)}this.attributeInfos.sort((n,o)=>n.location-o.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!dn(t))return;const r=t.getProgramParameter(e.handle,35971);for(let n=0;n<r;n++){const{name:o,type:l,size:s}=t.getTransformFeedbackVarying(e.handle,n);this._addVarying(n,o,l,s)}this.varyingInfos.sort((n,o)=>n.location-o.location)}_addAttribute(e,t,r,n){const{type:o,components:l}=U3(r),s={type:o,size:n*l};this._inferProperties(e,t,s);const g={location:e,name:t,accessor:new Lc(s)};this.attributeInfos.push(g),this.attributeInfosByLocation[e]=g,this.attributeInfosByName[g.name]=g}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,n){const{type:o,components:l}=U3(r),s=new Lc({type:o,size:n*l}),g={location:e,name:t,accessor:s};this.varyingInfos.push(g),this.varyingInfosByName[g.name]=g}}const z3=4,u7=35981,h7=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Q3 extends BA{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",h7),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:t,vs:r,fs:n,varyings:o,bufferMode:l=u7}=e;return this.hash=t||"",this.vs=typeof r=="string"?new n2(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof n=="string"?new s2(this.gl,{id:"".concat(e.id,"-fs"),source:n}):n,Xi(this.vs instanceof n2),Xi(this.fs instanceof s2),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(lc(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,l)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new c7(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:r=4,vertexCount:n,offset:o=0,start:l,end:s,isIndexed:g=!1,indexType:v=5123,instanceCount:T=0,isInstanced:F=T>0,vertexArray:R=null,transformFeedback:U,framebuffer:J,parameters:te={},uniforms:Ae,samplers:he}=e;if((Ae||he)&&(hr.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(Ae||{})),hr.priority>=t){const pe=J?J.id:"default",be="mode=".concat(od(this.gl,r)," verts=").concat(n," ")+"instances=".concat(T," indexType=").concat(od(this.gl,v)," ")+"isInstanced=".concat(F," isIndexed=").concat(g," ")+"Framebuffer=".concat(pe);hr.log(t,be)()}return Xi(R),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||n===0||F&&T===0?!1:(R.bindForDraw(n,T,()=>{if(J!==void 0&&(te=Object.assign({},te,{framebuffer:J})),U){const pe=l7(r);U.begin(pe)}this._bindTextures(),Yu(this.gl,te,()=>{g&&F?this.gl2.drawElementsInstanced(r,n,v,o,T):g&&dn(this.gl)&&!isNaN(l)&&!isNaN(s)?this.gl2.drawRangeElements(r,l,s,n,v,o):g?this.gl.drawElements(r,n,v,o):F?this.gl2.drawArraysInstanced(r,o,n,T):this.gl.drawArrays(r,o,n)}),U&&U.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};hr.priority>=2&&TH(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],n=this._uniformSetters[t];if(n){let o=r,l=!1;if(o instanceof ba&&(o=o.texture),o instanceof Zp)if(l=this.uniforms[t]!==r,l){n.textureIndex===void 0&&(n.textureIndex=this._textureIndexCounter++);const s=o,{textureIndex:g}=n;s.bind(g),o=g,this._textureUniforms[t]=s}else o=n.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(n(o)||l)&&LH(this.uniforms,t,r)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const n of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new n2({handle:n});break;case 35632:r.fs=new s2({handle:n});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const t=this._getName();this.id=wA(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),hr.time(z3,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),hr.timeEnd(z3,"linkProgram for ".concat(this._getName()))(),e.debug||hr.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:n}=SH(r.name);let o=e.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=k3(e,o,r),r.size>1)for(let l=0;l<r.size;l++)o=e.getUniformLocation(this.handle,"".concat(n,"[").concat(l,"]")),this._uniformSetters["".concat(n,"[").concat(l,"]")]=k3(e,o,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}const A7=34918,d7=34919,f7=35007,p7=36795,g7=35976,m7=35887,y7=36202;class e1 extends BA{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=dn(e),n=I3(e,Qs.TIMER_QUERY);let o=r||n;for(const l of t)switch(l){case"queries":o=o&&r;break;case"timers":o=o&&n;break;default:Xi(!1)}return o}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(f7)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?y7:m7)}beginTransformFeedbackQuery(){return this.begin(g7)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,d7);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(p7)}getResult(){return this.gl2.getQueryParameter(this.handle,A7)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,n)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return e1.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class V3 extends BA{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return dn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};lc(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Kp(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:n,byteSize:o,byteOffset:l}=this._getBufferParams(t);return r<0?(this.unused[e]=n,hr.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,n,l,o),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,r,n;return e instanceof bs?n=e:(n=e.buffer,r=e.byteSize,t=e.byteOffset),(t!==void 0||r!==void 0)&&(t=t||0,r=r||n.byteLength-t),{buffer:n,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:n}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,n,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;const o=t&&t.handle;return!o||n===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,r,n),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let t1=null;function _7(i){return(!t1||t1.byteLength<i)&&(t1=new ArrayBuffer(i)),t1}function v7(i,e){const t=_7(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function b7(i){let{target:e,source:t,start:r=0,count:n=1}=i;const o=t.length,l=n*o;let s=0;for(let g=r;s<o;s++)e[g++]=t[s];for(;s<l;)s<l-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+l-s),s=l);return e}const x7="elements must be GL.ELEMENT_ARRAY_BUFFER";class tu extends BA{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?dn(e)||V5()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new tu(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return tu.MAX_ATTRIBUTES=tu.MAX_ATTRIBUTES||e.getParameter(34921),tu.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:tu._setConstantFloatArray(e,t,r);break;case Int32Array:tu._setConstantIntArray(e,t,r);break;case Uint32Array:tu._setConstantUintArray(e,t,r);break;default:Xi(!1)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return tu.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Xi(!e||e.target===34963,x7),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===34963)return this.setElementBuffer(t,r);const{size:n,type:o,stride:l,offset:s,normalized:g,integer:v,divisor:T}=r,{gl:F,gl2:R}=this;return e=Number(e),this.bind(()=>{F.bindBuffer(34962,t.handle),v?(Xi(dn(F)),R.vertexAttribIPointer(e,n,o,l,s)):F.vertexAttribPointer(e,n,o,g,l,s),F.enableVertexAttribArray(e),R.vertexAttribDivisor(e,T||0)}),this}enable(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!t&&e===0&&!tu.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const r=this._normalizeConstantArrayValue(t),n=r.byteLength*e,o=r.length*e;let l=!this.buffer;if(this.buffer=this.buffer||new bs(this.gl,n),l=l||this.buffer.reallocate(n),l=l||!this._compareConstantArrayValues(r,this.bufferValue),l){const s=v7(t.constructor,o);b7({target:s,source:r,start:0,count:o}),this.buffer.subData(s),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:Xi(!1)}}static _setConstantIntArray(e,t,r){switch(Xi(dn(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:Xi(!1)}}static _setConstantUintArray(e,t,r){switch(Xi(dn(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:Xi(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:r}=t;return Xi(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const w7="VertexArray: attributes must be Buffers or constants (i.e. typed array)",B7=/^(.+)__LOCATION_([0-9]+)$/,C7=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class E7{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new tu(e),f3(this,"VertexArray","v6.0",C7),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.target===34963)return this.setElementBuffer(t,r);const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return n>=0&&(this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,t,o)),this}setConstant(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return n>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new bs(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof bs&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof bs&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),n=r()}),n}_resolveLocationAndAccessor(e,t,r,n){const o={location:-1,accessor:null},{location:l,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(l)||l<0)return this.unused[e]=t,hr.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),o;const g=this._getAttributeInfo(s||l);if(!g)return o;const v=this.accessors[l]||{},T=Lc.resolve(g.accessor,v,r,n),{size:F,type:R}=T;return Xi(Number.isFinite(F)&&Number.isFinite(R)),{location:l,accessor:T}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=B7.exec(e),n=r?r[1]:e,o=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+o,name:n}:{location:-1}}_setAttribute(e,t){if(t instanceof bs)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof bs){const r=t[0],n=t[1];this.setBuffer(e,r,n)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else if(t.buffer instanceof bs){const r=t;this.setBuffer(e,r.buffer,r)}else throw new Error(w7)}_setConstantAttributes(e,t){const r=Math.max(e|0,t|0);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)n=this.values[o],ArrayBuffer.isView(n)&&this._setConstantAttribute(o,n)}_setConstantAttributeZero(e,t){if(tu.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){tu.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],n=this.accessors[t];if(!r)return;const{divisor:o}=n,l=o>0;if(e.isInstanced=e.isInstanced||l,r instanceof bs){const s=r;if(l){const g=s.getVertexCount(n);e.instanceCount=Math.min(e.instanceCount,g)}else{const g=s.getVertexCount(n);e.vertexCount=Math.min(e.vertexCount,g)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return hr.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function S7(i,e){const{maxElts:t=16,size:r=1}=e;let n="[";for(let l=0;l<i.length&&l<t;++l)l>0&&(n+=",".concat(l%r===0?" ":"")),n+=cy(i[l],e);const o=i.length>t?"...":"]";return"".concat(n).concat(o)}function cy(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=1e-16,{isInteger:r=!1}=e;if(Array.isArray(i)||ArrayBuffer.isView(i))return S7(i,e);if(!Number.isFinite(i))return String(i);if(Math.abs(i)<t)return r?"0":"0.";if(r||Math.abs(i)>100&&Math.abs(i)<1e4)return i.toFixed(0);const n=i.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function H3(i){let{header:e="Uniforms",program:t,uniforms:r,undefinedOnly:n=!1}=i;Xi(t);const o=".*_.*",l=".*Matrix",s=t._uniformSetters,g={},v=Object.keys(s).sort();let T=0;for(const U of v)!U.match(o)&&!U.match(l)&&l2({table:g,header:e,uniforms:r,uniformName:U,undefinedOnly:n})&&T++;for(const U of v)U.match(l)&&l2({table:g,header:e,uniforms:r,uniformName:U,undefinedOnly:n})&&T++;for(const U of v)g[U]||l2({table:g,header:e,uniforms:r,uniformName:U,undefinedOnly:n})&&T++;let F=0;const R={};if(!n)for(const U in r){const J=r[U];g[U]||(F++,R[U]={Type:"NOT USED: ".concat(J),[e]:cy(J)})}return{table:g,count:T,unusedTable:R,unusedCount:F}}function l2(i){let{table:e,header:t,uniforms:r,uniformName:n,undefinedOnly:o}=i;const l=r[n],s=T7(l);return!o||!s?(e[n]={[t]:s?cy(l):"N/A","Uniform Type":s?l:"NOT PROVIDED"},!0):!1}function T7(i){return i!=null}function I7(i){let{vertexArray:e,header:t="Attributes"}=i;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=G3(e,e.elements,null,t));const n=e.values;for(const o in n){const l=e._getAttributeInfo(o);if(l){let s="".concat(o,": ").concat(l.name);const g=e.accessors[l.location];g&&(s="".concat(o,": ").concat(L7(l.name,g))),r[s]=G3(e,n[o],g,t)}}return r}function G3(i,e,t,r){const{gl:n}=i;if(!e)return{[r]:"null","Format ":"N/A"};let o="NOT PROVIDED",l=1,s=0,g=0,v,T,F;if(t&&(o=t.type,l=t.size,o=String(o).replace("Array",""),v=o.indexOf("nt")!==-1),e instanceof bs){const R=e,{data:U,changed:J}=R.getDebugData();T=J?"*":"",F=U,g=R.byteLength,s=g/U.BYTES_PER_ELEMENT/l;let te;if(t){const Ae=t.divisor>0;te="".concat(Ae?"I ":"P "," ").concat(s," (x").concat(l,"=").concat(g," bytes ").concat(od(n,o),")")}else v=!0,te="".concat(g," bytes");return{[r]:"".concat(T).concat(cy(F,{size:l,isInteger:v})),"Format ":te}}return F=e,l=e.length,o=String(e.constructor.name).replace("Array",""),v=o.indexOf("nt")!==-1,{[r]:"".concat(cy(F,{size:l,isInteger:v})," (constant)"),"Format ":"".concat(l,"x").concat(o," (constant)")}}function L7(i,e){const{type:t,size:r}=e,n=N3(t,r);return n?"".concat(i," (").concat(n.name,")"):i}function M7(i){const e={},t="Accessors for ".concat(i.id);for(const r of i.attributeInfos)if(r){const n=j3(r);e["in ".concat(n)]={[t]:JSON.stringify(r.accessor)}}for(const r of i.varyingInfos)if(r){const n=j3(r);e["out ".concat(n)]={[t]:JSON.stringify(r.accessor)}}return e}function j3(i){const{type:e,size:t}=i.accessor,r=N3(e,t);return r?"".concat(r.name," ").concat(i.name):i.name}const q3=bA()&&typeof document<"u";let P7=0;class F7{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:t=Ae=>u3(Ae),onAddHTML:r=null,onInitialize:n=()=>{},onRender:o=()=>{},onFinalize:l=()=>{},onError:s,gl:g=null,glOptions:v={},debug:T=!1,createFramebuffer:F=!1,autoResizeViewport:R=!0,autoResizeDrawingBuffer:U=!0,stats:J=mf.get("animation-loop-".concat(P7++))}=e;let{useDevicePixels:te=!0}=e;"useDevicePixelRatio"in e&&(hr.deprecated("useDevicePixelRatio","useDevicePixels")(),te=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:n,onRender:o,onFinalize:l,onError:s,gl:g,glOptions:v,debug:T,createFramebuffer:F},this.gl=g,this.needsRedraw=null,this.timeline=null,this.stats=J,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:R,autoResizeDrawingBuffer:U,useDevicePixels:te}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Xi(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=e1.isSupported(this.gl,["timers"])?new e1(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):t}setViewParameters(){return hr.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=q3?new Promise((e,t)=>{if(q3&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):z9(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):N9(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Kw(this.props.gl,e):this.onCreateContext(e),!$_(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");E9(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;const{canvas:n}=this.gl;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&M9(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new ba(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const uy="vs",c2="fs";function iu(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const u2={number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},array:{validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function D7(i){const e={};for(const t in i){const r=i[t],n=R7(r);e[t]=n}return e}function R7(i){let e=$3(i);return e==="object"?i?"type"in i?Object.assign({},i,u2[i.type]):"value"in i?(e=$3(i.value),Object.assign({type:e},i,u2[e])):{type:"object",value:i}:{type:"object",value:null}:Object.assign({type:e,value:i},u2[e])}function $3(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const k7="vs",O7="fs";class K3{constructor(e){let{name:t,vs:r,fs:n,dependencies:o=[],uniforms:l,getUniforms:s,deprecations:g=[],defines:v={},inject:T={},vertexShader:F,fragmentShader:R}=e;iu(typeof t=="string"),this.name=t,this.vs=r||F,this.fs=n||R,this.getModuleUniforms=s,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(g),this.defines=v,this.injections=U7(T),l&&(this.uniforms=D7(l))}getModuleSource(e){let t;switch(e){case k7:t=this.vs||"";break;case O7:t=this.fs||"";break;default:iu(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(t,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={},r=this.uniforms;for(const n in r){const o=r[n];n in e&&!o.private?(o.validate&&iu(o.validate(e[n],o),"".concat(this.name,": invalid ").concat(n)),t[n]=e[n]):t[n]=o.value}return t}}function U7(i){const e={vs:{},fs:{}};for(const t in i){let r=i[t];const n=t.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[n][t]=r}return e}function N7(i){return z7(Z3(i))}function z7(i){const e={},t={};return W3({modules:i,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((r,n)=>t[n]-t[r]).map(r=>e[r])}function W3(i){let{modules:e,level:t,moduleMap:r,moduleDepth:n}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)r[o.name]=o,(n[o.name]===void 0||n[o.name]<t)&&(n[o.name]=t);for(const o of e)o.dependencies&&W3({modules:o.dependencies,level:t+1,moduleMap:r,moduleDepth:n})}function Z3(i,e){return i.map(t=>(t instanceof K3||(iu(typeof t!="string","Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),iu(t.name,"shader module has no name"),t=new K3(t),t.dependencies=Z3(t.dependencies)),t))}function Q7(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},t=i.userAgent||e.userAgent||"",r=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return r||n}const V7=7936,H7=7937,G7=7938,j7=35724,h2={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},_f={};Object.keys(h2).forEach(i=>{_f[i]=i});function q7(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function $7(i){const e=i.getExtension("WEBGL_debug_renderer_info"),t=i.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||V7),r=i.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||H7);return{gpuVendor:K7(t,r),vendor:t,renderer:r,version:i.getParameter(G7),shadingLanguageVersion:i.getParameter(j7)}}function K7(i,e){return i.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":i.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":i.match(/AMD/i)||e.match(/AMD/i)||i.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const A2={};function X3(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=h2[e];if(iu(r,e),!Q7(t))return!0;if(e in A2)return A2[e];const n=r[0],o=t.behavior||"enable",l="#extension GL_".concat(n," : ").concat(o,`
void main(void) {}`),s=i.createShader(35633);i.shaderSource(s,l),i.compileShader(s);const g=i.getShaderParameter(s,35713);return i.deleteShader(s),A2[e]=g,g}function W7(i,e){const t=h2[e];iu(t,e);const r=q7(i)&&t[1]||t[0],n=typeof r=="string"?!!i.getExtension(r):r;return iu(n===!1||n===!0),n}function i1(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>W7(i,t))}function Z7(i){switch($7(i).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function X7(i,e,t){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return i1(i,_f.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),i1(i,_f.GLSL_DERIVATIVES)&&X3(i,_f.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),i1(i,_f.GLSL_FRAG_DATA)&&X3(i,_f.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),i1(i,_f.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const J7=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Y7=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,eG={[uy]:J7,[c2]:Y7},r1="__LUMA_INJECT_DECLARATIONS__",J3=/void\s+main\s*\([^)]*\)\s*\{\n?/,Y3=/}\n?[^{}]*$/,d2=[];function eL(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=e===uy;for(const o in t){const l=t[o];l.sort((g,v)=>g.order-v.order),d2.length=l.length;for(let g=0,v=l.length;g<v;++g)d2[g]=l[g].injection;const s="".concat(d2.join(`
`),`
`);switch(o){case"vs:#decl":n&&(i=i.replace(r1,s));break;case"vs:#main-start":n&&(i=i.replace(J3,g=>g+s));break;case"vs:#main-end":n&&(i=i.replace(Y3,g=>s+g));break;case"fs:#decl":n||(i=i.replace(r1,s));break;case"fs:#main-start":n||(i=i.replace(J3,g=>g+s));break;case"fs:#main-end":n||(i=i.replace(Y3,g=>s+g));break;default:i=i.replace(o,g=>g+s)}}return i=i.replace(r1,""),r&&(i=i.replace(/\}\s*$/,o=>o+eG[e])),i}function f2(i){const e={};return iu(Array.isArray(i)&&i.length>1),i.forEach(t=>{for(const r in t)e[r]=e[r]?"".concat(e[r],`
`).concat(t[r]):t[r]}),e}function Jp(i){return new RegExp("\\b".concat(i,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const tL=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],tG=[...tL,[Jp("attribute"),"in $1"],[Jp("varying"),"out $1"]],iG=[...tL,[Jp("varying"),"in $1"]],iL=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],rG=[...iL,[Jp("in"),"attribute $1"],[Jp("out"),"varying $1"]],nG=[...iL,[Jp("in"),"varying $1"]],p2="gl_FragColor",g2=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,sG=/void\s+main\s*\([^)]*\)\s*\{\n?/;function oG(i,e,t){switch(e){case 300:return t?n1(i,tG):aG(i);case 100:return t?n1(i,rG):lG(i);default:throw new Error("unknown GLSL version ".concat(e))}}function n1(i,e){for(const[t,r]of e)i=i.replace(t,r);return i}function aG(i){i=n1(i,iG);const e=i.match(g2);if(e){const t=e[1];i=i.replace(new RegExp("\\b".concat(p2,"\\b"),"g"),t)}else{const t="fragmentColor";i=i.replace(sG,r=>"out vec4 ".concat(t,`;
`).concat(r)).replace(new RegExp("\\b".concat(p2,"\\b"),"g"),t)}return i}function lG(i){i=n1(i,nG);const e=i.match(g2);if(e){const t=e[1];i=i.replace(g2,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),p2)}return i}const cG=`

`.concat(r1,`

`),rL={[uy]:"vertex",[c2]:"fragment"},uG=`precision highp float;

`;function hG(i,e){const{vs:t,fs:r}=e,n=N7(e.modules||[]);return{gl:i,vs:nL(i,Object.assign({},e,{source:t,type:uy,modules:n})),fs:nL(i,Object.assign({},e,{source:r,type:c2,modules:n})),getUniforms:AG(n)}}function nL(i,e){let{id:t,source:r,type:n,modules:o,defines:l={},hookFunctions:s=[],inject:g={},transpileToGLSL100:v=!1,prologue:T=!0,log:F}=e;iu(typeof r=="string","shader source must be a string");const R=n===uy,U=r.split(`
`);let J=100,te="",Ae=r;U[0].indexOf("#version ")===0?(J=300,te=U[0],Ae=U.slice(1).join(`
`)):te="#version ".concat(J);const he={};o.forEach(We=>{Object.assign(he,We.getDefines())}),Object.assign(he,l);let pe=T?"".concat(te,`
`).concat(fG({id:t,source:r,type:n}),`
`).concat(dG({type:n}),`
`).concat(Z7(i),`
`).concat(X7(i),`
`).concat(pG(he),`
`).concat(R?"":uG,`
`):"".concat(te,`
`);const be=mG(s),Te={},qe={},je={};for(const We in g){const Ne=typeof g[We]=="string"?{injection:g[We],order:0}:g[We],at=We.match(/^(v|f)s:(#)?([\w-]+)$/);if(at){const nt=at[2],ke=at[3];nt?ke==="decl"?qe[We]=[Ne]:je[We]=[Ne]:Te[We]=[Ne]}else je[We]=[Ne]}for(const We of o){F&&We.checkDeprecations(Ae,F);const Ne=We.getModuleSource(n,J);pe+=Ne;const at=We.injections[n];for(const nt in at){const ke=nt.match(/^(v|f)s:#([\w-]+)$/);if(ke){const Ye=ke[2]==="decl"?qe:je;Ye[nt]=Ye[nt]||[],Ye[nt].push(at[nt])}else Te[nt]=Te[nt]||[],Te[nt].push(at[nt])}}return pe+=cG,pe=eL(pe,n,qe),pe+=gG(be[n],Te),pe+=Ae,pe=eL(pe,n,je),pe=oG(pe,v?100:J,R),pe}function AG(i){return function(t){const r={};for(const n of i){const o=n.getUniforms(t,r);Object.assign(r,o)}return r}}function dG(i){let{type:e}=i;return`
#define SHADER_TYPE_`.concat(rL[e].toUpperCase(),`
`)}function fG(i){let{id:e,source:t,type:r}=i;return e&&typeof e=="string"&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(rL[r],`

`):""}function pG(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,t="";for(const r in i){e===0&&(t+=`
// APPLICATION DEFINES
`),e++;const n=i[r];(n||Number.isFinite(n))&&(t+="#define ".concat(r.toUpperCase()," ").concat(i[r],`
`))}return e===0&&(t+=`
`),t}function gG(i,e){let t="";for(const r in i){const n=i[r];if(t+="void ".concat(n.signature,` {
`),n.header&&(t+="  ".concat(n.header)),e[r]){const o=e[r];o.sort((l,s)=>l.order-s.order);for(const l of o)t+="  ".concat(l.injection,`
`)}n.footer&&(t+="  ".concat(n.footer)),t+=`}
`}return t}function mG(i){const e={vs:{},fs:{}};return i.forEach(t=>{let r;typeof t!="string"?(r=t,t=r.hook):r={},t=t.trim();const[n,o]=t.split(":"),l=t.replace(/\(.+/,"");e[n][l]=Object.assign(r,{signature:o})}),e}const yG="void main() {gl_FragColor = vec4(0);}",sL=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,_G=`#version 300 es
`.concat(sL);function oL(i,e){e=Array.isArray(e)?e:[e];const t=i.replace(/^\s+/,"").split(/\s+/),[r,n,o]=t;if(!e.includes(r)||!n||!o)return null;const l=o.split(";")[0];return{qualifier:r,type:n,name:l}}function aL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:t,inputType:r,output:n}=i;if(!t)return e===300?_G:e>300?"#version ".concat(e,`
`).concat(sL):yG;const o=xG(t,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(t,`;
out vec4 `).concat(n,`;
void main() {
  `).concat(n," = ").concat(o,`;
}`):"varying ".concat(r," ").concat(t,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function vG(i){switch(i){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return iu(!1),null}}function bG(i){switch(i){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return iu(!1),null}}function xG(i,e){switch(e){case"float":return"vec4(".concat(i,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(i,", 0.0, 1.0)");case"vec3":return"vec4(".concat(i,", 1.0)");case"vec4":return i;default:return iu(!1),null}}const wG={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function eh(i,e){if(!i)throw new Error("math.gl assertion ".concat(e))}const BG=1/Math.PI*180,CG=1/180*Math.PI,wa={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function EG(i){let{precision:e=wa.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=LG(i),"".concat(parseFloat(i.toPrecision(e)))}function ld(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function SG(i){return IG(i)}function TG(i){return EA(i)}function IG(i,e){return m2(i,t=>t*CG,e)}function EA(i,e){return m2(i,t=>t*BG,e)}function SA(i,e,t){return m2(i,r=>Math.max(e,Math.min(t,r)))}function s1(i,e,t){return ld(i)?i.map((r,n)=>s1(r,e[n],t)):t*e+(1-t)*i}function th(i,e,t){const r=wa.EPSILON;t&&(wa.EPSILON=t);try{if(i===e)return!0;if(ld(i)&&ld(e)){if(i.length!==e.length)return!1;for(let n=0;n<i.length;++n)if(!th(i[n],e[n]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=wa.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{wa.EPSILON=r}}function LG(i){return Math.round(i/wa.EPSILON)*wa.EPSILON}function MG(i){return i.clone?i.clone():new Array(i.length)}function m2(i,e,t){if(ld(i)){const r=i;t=t||MG(r);for(let n=0;n<t.length&&n<r.length;++n)t[n]=e(i[n],n,t);return t}return e(i)}function PG(i){function e(){var t=Reflect.construct(i,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i,e}class y2 extends PG(Array){clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ld(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(wa)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+EG(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!th(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let n=0;n<this.ELEMENTS;++n){const o=e[n];this[n]=o+r*(t[n]-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]+=n[o];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]-=n[o];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(wa.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function FG(i,e){if(i.length!==e)return!1;for(let t=0;t<i.length;++t)if(!Number.isFinite(i[t]))return!1;return!0}function is(i){if(!Number.isFinite(i))throw new Error("Invalid number ".concat(i));return i}function hy(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(wa.debug&&!FG(i,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return i}let _2=class extends y2{get x(){return this[0]}set x(e){this[0]=is(e)}get y(){return this[1]}set y(e){this[1]=is(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const n=this[r]-e[r];t+=n*n}return is(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return is(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]*=n[o];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]/=n[o];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return eh(e>=0&&e<this.ELEMENTS,"index is out of range"),is(this[e])}setComponent(e,t){return eh(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};var Ay=1e-6,ih=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function DG(){var i=new ih(2);return ih!=Float32Array&&(i[0]=0,i[1]=0),i}function lL(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i}function RG(i,e){return i[0]=-e[0],i[1]=-e[1],i}function cL(i,e,t,r){var n=e[0],o=e[1];return i[0]=n+r*(t[0]-n),i[1]=o+r*(t[1]-o),i}function kG(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i}function OG(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n+t[4],i[1]=t[1]*r+t[3]*n+t[5],i}function uL(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[3]*n+t[6],i[1]=t[1]*r+t[4]*n+t[7],i}function hL(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[4]*n+t[12],i[1]=t[1]*r+t[5]*n+t[13],i}(function(){var i=DG();return function(e,t,r,n,o,l){var s,g;for(t||(t=2),r||(r=0),n?g=Math.min(n*t+r,e.length):g=e.length,s=r;s<g;s+=t)i[0]=e[s],i[1]=e[s+1],o(i,i,l),e[s]=i[0],e[s+1]=i[1];return e}})();function AL(i,e,t){const r=e[0],n=e[1],o=t[3]*r+t[7]*n||1;return i[0]=(t[0]*r+t[4]*n)/o,i[1]=(t[1]*r+t[5]*n)/o,i}function dL(i,e,t){const r=e[0],n=e[1],o=e[2],l=t[3]*r+t[7]*n+t[11]*o||1;return i[0]=(t[0]*r+t[4]*n+t[8]*o)/l,i[1]=(t[1]*r+t[5]*n+t[9]*o)/l,i[2]=(t[2]*r+t[6]*n+t[10]*o)/l,i}function UG(i,e,t){const r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i[2]=e[2],i}function NG(i,e,t){const r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i[2]=e[2],i[3]=e[3],i}function fL(i,e,t){const r=e[0],n=e[1],o=e[2];return i[0]=t[0]*r+t[3]*n+t[6]*o,i[1]=t[1]*r+t[4]*n+t[7]*o,i[2]=t[2]*r+t[5]*n+t[8]*o,i[3]=e[3],i}class v2 extends _2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),ld(e)&&arguments.length===1?this.copy(e):(wa.debug&&(is(e),is(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return wa.debug&&(is(e.x),is(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return hL(this,this,e),this.check()}transformAsVector(e){return AL(this,this,e),this.check()}transformByMatrix3(e){return uL(this,this,e),this.check()}transformByMatrix2x3(e){return OG(this,this,e),this.check()}transformByMatrix2(e){return kG(this,this,e),this.check()}}function pL(){var i=new ih(3);return ih!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function gL(i){var e=i[0],t=i[1],r=i[2];return Math.hypot(e,t,r)}function mL(i,e,t){var r=new ih(3);return r[0]=i,r[1]=e,r[2]=t,r}function zG(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function QG(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function VG(i,e){var t=e[0],r=e[1],n=e[2],o=t*t+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i}function b2(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function o1(i,e,t){var r=e[0],n=e[1],o=e[2],l=t[0],s=t[1],g=t[2];return i[0]=n*g-o*s,i[1]=o*l-r*g,i[2]=r*s-n*l,i}function x2(i,e,t){var r=e[0],n=e[1],o=e[2],l=t[3]*r+t[7]*n+t[11]*o+t[15];return l=l||1,i[0]=(t[0]*r+t[4]*n+t[8]*o+t[12])/l,i[1]=(t[1]*r+t[5]*n+t[9]*o+t[13])/l,i[2]=(t[2]*r+t[6]*n+t[10]*o+t[14])/l,i}function yL(i,e,t){var r=e[0],n=e[1],o=e[2];return i[0]=r*t[0]+n*t[3]+o*t[6],i[1]=r*t[1]+n*t[4]+o*t[7],i[2]=r*t[2]+n*t[5]+o*t[8],i}function _L(i,e,t){var r=t[0],n=t[1],o=t[2],l=t[3],s=e[0],g=e[1],v=e[2],T=n*v-o*g,F=o*s-r*v,R=r*g-n*s,U=n*R-o*F,J=o*T-r*R,te=r*F-n*T,Ae=l*2;return T*=Ae,F*=Ae,R*=Ae,U*=2,J*=2,te*=2,i[0]=s+T+U,i[1]=g+F+J,i[2]=v+R+te,i}function HG(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function GG(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function jG(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function qG(i,e){var t=i[0],r=i[1],n=i[2],o=e[0],l=e[1],s=e[2],g=Math.sqrt(t*t+r*r+n*n),v=Math.sqrt(o*o+l*l+s*s),T=g*v,F=T&&b2(i,e)/T;return Math.acos(Math.min(Math.max(F,-1),1))}var $G=zG,KG=gL;(function(){var i=pL();return function(e,t,r,n,o,l){var s,g;for(t||(t=3),r||(r=0),n?g=Math.min(n*t+r,e.length):g=e.length,s=r;s<g;s+=t)i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],o(i,i,l),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2];return e}})();const w2=[0,0,0];let a1;class Ut extends _2{static get ZERO(){return a1||(a1=new Ut(0,0,0),Object.freeze(a1)),a1}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&ld(e)?this.copy(e):(wa.debug&&(is(e),is(t),is(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return wa.debug&&(is(e.x),is(e.y),is(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=is(e)}angle(e){return qG(this,e)}cross(e){return o1(this,this,e),this.check()}rotateX(e){let{radians:t,origin:r=w2}=e;return HG(this,this,r,t),this.check()}rotateY(e){let{radians:t,origin:r=w2}=e;return GG(this,this,r,t),this.check()}rotateZ(e){let{radians:t,origin:r=w2}=e;return jG(this,this,r,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return x2(this,this,e),this.check()}transformAsVector(e){return dL(this,this,e),this.check()}transformByMatrix3(e){return yL(this,this,e),this.check()}transformByMatrix2(e){return UG(this,this,e),this.check()}transformByQuaternion(e){return _L(this,this,e),this.check()}}let l1;class B2 extends _2{static get ZERO(){return l1||(l1=new B2(0,0,0,0),Object.freeze(l1)),l1}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),ld(e)&&arguments.length===1?this.copy(e):(wa.debug&&(is(e),is(t),is(r),is(n)),this[0]=e,this[1]=t,this[2]=r,this[3]=n)}set(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return wa.debug&&(is(e.x),is(e.y),is(e.z),is(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=is(e)}get w(){return this[3]}set w(e){this[3]=is(e)}transform(e){return x2(this,this,e),this.check()}transformByMatrix3(e){return fL(this,this,e),this.check()}transformByMatrix2(e){return NG(this,this,e),this.check()}transformByQuaternion(e){return _L(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class vL extends y2{toString(){let e="[";if(wa.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=is(r),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const r=e*this.RANK;for(let n=0;n<this.RANK;++n)t[n]=this[r+n];return t}setColumn(e,t){const r=e*this.RANK;for(let n=0;n<this.RANK;++n)this[r+n]=t[n];return this}}function WG(){var i=new ih(9);return ih!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function ZG(i,e){if(i===e){var t=e[1],r=e[2],n=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=r,i[7]=n}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i}function XG(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=e[4],s=e[5],g=e[6],v=e[7],T=e[8],F=T*l-s*v,R=-T*o+s*g,U=v*o-l*g,J=t*F+r*R+n*U;return J?(J=1/J,i[0]=F*J,i[1]=(-T*r+n*v)*J,i[2]=(s*r-n*l)*J,i[3]=R*J,i[4]=(T*t-n*g)*J,i[5]=(-s*t+n*o)*J,i[6]=U*J,i[7]=(-v*t+r*g)*J,i[8]=(l*t-r*o)*J,i):null}function JG(i){var e=i[0],t=i[1],r=i[2],n=i[3],o=i[4],l=i[5],s=i[6],g=i[7],v=i[8];return e*(v*o-l*g)+t*(-v*n+l*s)+r*(g*n-o*s)}function bL(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],v=e[6],T=e[7],F=e[8],R=t[0],U=t[1],J=t[2],te=t[3],Ae=t[4],he=t[5],pe=t[6],be=t[7],Te=t[8];return i[0]=R*r+U*l+J*v,i[1]=R*n+U*s+J*T,i[2]=R*o+U*g+J*F,i[3]=te*r+Ae*l+he*v,i[4]=te*n+Ae*s+he*T,i[5]=te*o+Ae*g+he*F,i[6]=pe*r+be*l+Te*v,i[7]=pe*n+be*s+Te*T,i[8]=pe*o+be*g+Te*F,i}function YG(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],v=e[6],T=e[7],F=e[8],R=t[0],U=t[1];return i[0]=r,i[1]=n,i[2]=o,i[3]=l,i[4]=s,i[5]=g,i[6]=R*r+U*l+v,i[7]=R*n+U*s+T,i[8]=R*o+U*g+F,i}function ej(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],v=e[6],T=e[7],F=e[8],R=Math.sin(t),U=Math.cos(t);return i[0]=U*r+R*l,i[1]=U*n+R*s,i[2]=U*o+R*g,i[3]=U*l-R*r,i[4]=U*s-R*n,i[5]=U*g-R*o,i[6]=v,i[7]=T,i[8]=F,i}function xL(i,e,t){var r=t[0],n=t[1];return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=n*e[3],i[4]=n*e[4],i[5]=n*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i}function tj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t+t,s=r+r,g=n+n,v=t*l,T=r*l,F=r*s,R=n*l,U=n*s,J=n*g,te=o*l,Ae=o*s,he=o*g;return i[0]=1-F-J,i[3]=T-he,i[6]=R+Ae,i[1]=T+he,i[4]=1-v-J,i[7]=U-te,i[2]=R-Ae,i[5]=U+te,i[8]=1-v-F,i}var C2;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(C2||(C2={}));const ij=Object.freeze([1,0,0,0,1,0,0,0,1]);class wo extends vL{static get IDENTITY(){return nj()}static get ZERO(){return rj()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return C2}constructor(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(ij)}fromObject(e){return this.check()}fromQuaternion(e){return tj(this,e),this.check()}set(e,t,r,n,o,l,s,g,v){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=o,this[5]=l,this[6]=s,this[7]=g,this[8]=v,this.check()}setRowMajor(e,t,r,n,o,l,s,g,v){return this[0]=e,this[1]=n,this[2]=s,this[3]=t,this[4]=o,this[5]=g,this[6]=r,this[7]=l,this[8]=v,this.check()}determinant(){return JG(this)}transpose(){return ZG(this,this),this.check()}invert(){return XG(this,this),this.check()}multiplyLeft(e){return bL(this,e,this),this.check()}multiplyRight(e){return bL(this,this,e),this.check()}rotate(e){return ej(this,this,e),this.check()}scale(e){return Array.isArray(e)?xL(this,this,e):xL(this,this,[e,e]),this.check()}translate(e){return YG(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=uL(t||[-0,-0],e,this);break;case 3:r=yL(t||[-0,-0,-0],e,this);break;case 4:r=fL(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hy(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let c1,u1;function rj(){return c1||(c1=new wo([0,0,0,0,0,0,0,0,0]),Object.freeze(c1)),c1}function nj(){return u1||(u1=new wo,Object.freeze(u1)),u1}function sj(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function oj(i,e){if(i===e){var t=e[1],r=e[2],n=e[3],o=e[6],l=e[7],s=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=r,i[9]=o,i[11]=e[14],i[12]=n,i[13]=l,i[14]=s}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function E2(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=e[4],s=e[5],g=e[6],v=e[7],T=e[8],F=e[9],R=e[10],U=e[11],J=e[12],te=e[13],Ae=e[14],he=e[15],pe=t*s-r*l,be=t*g-n*l,Te=t*v-o*l,qe=r*g-n*s,je=r*v-o*s,We=n*v-o*g,Ne=T*te-F*J,at=T*Ae-R*J,nt=T*he-U*J,ke=F*Ae-R*te,De=F*he-U*te,Ye=R*he-U*Ae,Ze=pe*Ye-be*De+Te*ke+qe*nt-je*at+We*Ne;return Ze?(Ze=1/Ze,i[0]=(s*Ye-g*De+v*ke)*Ze,i[1]=(n*De-r*Ye-o*ke)*Ze,i[2]=(te*We-Ae*je+he*qe)*Ze,i[3]=(R*je-F*We-U*qe)*Ze,i[4]=(g*nt-l*Ye-v*at)*Ze,i[5]=(t*Ye-n*nt+o*at)*Ze,i[6]=(Ae*Te-J*We-he*be)*Ze,i[7]=(T*We-R*Te+U*be)*Ze,i[8]=(l*De-s*nt+v*Ne)*Ze,i[9]=(r*nt-t*De-o*Ne)*Ze,i[10]=(J*je-te*Te+he*pe)*Ze,i[11]=(F*Te-T*je-U*pe)*Ze,i[12]=(s*at-l*ke-g*Ne)*Ze,i[13]=(t*ke-r*at+n*Ne)*Ze,i[14]=(te*be-J*qe-Ae*pe)*Ze,i[15]=(T*qe-F*be+R*pe)*Ze,i):null}function aj(i){var e=i[0],t=i[1],r=i[2],n=i[3],o=i[4],l=i[5],s=i[6],g=i[7],v=i[8],T=i[9],F=i[10],R=i[11],U=i[12],J=i[13],te=i[14],Ae=i[15],he=e*l-t*o,pe=e*s-r*o,be=e*g-n*o,Te=t*s-r*l,qe=t*g-n*l,je=r*g-n*s,We=v*J-T*U,Ne=v*te-F*U,at=v*Ae-R*U,nt=T*te-F*J,ke=T*Ae-R*J,De=F*Ae-R*te;return he*De-pe*ke+be*nt+Te*at-qe*Ne+je*We}function vf(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],v=e[6],T=e[7],F=e[8],R=e[9],U=e[10],J=e[11],te=e[12],Ae=e[13],he=e[14],pe=e[15],be=t[0],Te=t[1],qe=t[2],je=t[3];return i[0]=be*r+Te*s+qe*F+je*te,i[1]=be*n+Te*g+qe*R+je*Ae,i[2]=be*o+Te*v+qe*U+je*he,i[3]=be*l+Te*T+qe*J+je*pe,be=t[4],Te=t[5],qe=t[6],je=t[7],i[4]=be*r+Te*s+qe*F+je*te,i[5]=be*n+Te*g+qe*R+je*Ae,i[6]=be*o+Te*v+qe*U+je*he,i[7]=be*l+Te*T+qe*J+je*pe,be=t[8],Te=t[9],qe=t[10],je=t[11],i[8]=be*r+Te*s+qe*F+je*te,i[9]=be*n+Te*g+qe*R+je*Ae,i[10]=be*o+Te*v+qe*U+je*he,i[11]=be*l+Te*T+qe*J+je*pe,be=t[12],Te=t[13],qe=t[14],je=t[15],i[12]=be*r+Te*s+qe*F+je*te,i[13]=be*n+Te*g+qe*R+je*Ae,i[14]=be*o+Te*v+qe*U+je*he,i[15]=be*l+Te*T+qe*J+je*pe,i}function h1(i,e,t){var r=t[0],n=t[1],o=t[2],l,s,g,v,T,F,R,U,J,te,Ae,he;return e===i?(i[12]=e[0]*r+e[4]*n+e[8]*o+e[12],i[13]=e[1]*r+e[5]*n+e[9]*o+e[13],i[14]=e[2]*r+e[6]*n+e[10]*o+e[14],i[15]=e[3]*r+e[7]*n+e[11]*o+e[15]):(l=e[0],s=e[1],g=e[2],v=e[3],T=e[4],F=e[5],R=e[6],U=e[7],J=e[8],te=e[9],Ae=e[10],he=e[11],i[0]=l,i[1]=s,i[2]=g,i[3]=v,i[4]=T,i[5]=F,i[6]=R,i[7]=U,i[8]=J,i[9]=te,i[10]=Ae,i[11]=he,i[12]=l*r+T*n+J*o+e[12],i[13]=s*r+F*n+te*o+e[13],i[14]=g*r+R*n+Ae*o+e[14],i[15]=v*r+U*n+he*o+e[15]),i}function S2(i,e,t){var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,i[11]=e[11]*o,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function lj(i,e,t,r){var n=r[0],o=r[1],l=r[2],s=Math.hypot(n,o,l),g,v,T,F,R,U,J,te,Ae,he,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Ze,Ct;return s<Ay?null:(s=1/s,n*=s,o*=s,l*=s,g=Math.sin(t),v=Math.cos(t),T=1-v,F=e[0],R=e[1],U=e[2],J=e[3],te=e[4],Ae=e[5],he=e[6],pe=e[7],be=e[8],Te=e[9],qe=e[10],je=e[11],We=n*n*T+v,Ne=o*n*T+l*g,at=l*n*T-o*g,nt=n*o*T-l*g,ke=o*o*T+v,De=l*o*T+n*g,Ye=n*l*T+o*g,Ze=o*l*T-n*g,Ct=l*l*T+v,i[0]=F*We+te*Ne+be*at,i[1]=R*We+Ae*Ne+Te*at,i[2]=U*We+he*Ne+qe*at,i[3]=J*We+pe*Ne+je*at,i[4]=F*nt+te*ke+be*De,i[5]=R*nt+Ae*ke+Te*De,i[6]=U*nt+he*ke+qe*De,i[7]=J*nt+pe*ke+je*De,i[8]=F*Ye+te*Ze+be*Ct,i[9]=R*Ye+Ae*Ze+Te*Ct,i[10]=U*Ye+he*Ze+qe*Ct,i[11]=J*Ye+pe*Ze+je*Ct,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function wL(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[4],l=e[5],s=e[6],g=e[7],v=e[8],T=e[9],F=e[10],R=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=o*n+v*r,i[5]=l*n+T*r,i[6]=s*n+F*r,i[7]=g*n+R*r,i[8]=v*n-o*r,i[9]=T*n-l*r,i[10]=F*n-s*r,i[11]=R*n-g*r,i}function cj(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[0],l=e[1],s=e[2],g=e[3],v=e[8],T=e[9],F=e[10],R=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*n-v*r,i[1]=l*n-T*r,i[2]=s*n-F*r,i[3]=g*n-R*r,i[8]=o*r+v*n,i[9]=l*r+T*n,i[10]=s*r+F*n,i[11]=g*r+R*n,i}function BL(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[0],l=e[1],s=e[2],g=e[3],v=e[4],T=e[5],F=e[6],R=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*n+v*r,i[1]=l*n+T*r,i[2]=s*n+F*r,i[3]=g*n+R*r,i[4]=v*n-o*r,i[5]=T*n-l*r,i[6]=F*n-s*r,i[7]=R*n-g*r,i}function uj(i,e){var t=e[0],r=e[1],n=e[2],o=e[4],l=e[5],s=e[6],g=e[8],v=e[9],T=e[10];return i[0]=Math.hypot(t,r,n),i[1]=Math.hypot(o,l,s),i[2]=Math.hypot(g,v,T),i}function hj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t+t,s=r+r,g=n+n,v=t*l,T=r*l,F=r*s,R=n*l,U=n*s,J=n*g,te=o*l,Ae=o*s,he=o*g;return i[0]=1-F-J,i[1]=T+he,i[2]=R-Ae,i[3]=0,i[4]=T-he,i[5]=1-v-J,i[6]=U+te,i[7]=0,i[8]=R+Ae,i[9]=U-te,i[10]=1-v-F,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Aj(i,e,t,r,n,o,l){var s=1/(t-e),g=1/(n-r),v=1/(o-l);return i[0]=o*2*s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o*2*g,i[6]=0,i[7]=0,i[8]=(t+e)*s,i[9]=(n+r)*g,i[10]=(l+o)*v,i[11]=-1,i[12]=0,i[13]=0,i[14]=l*o*2*v,i[15]=0,i}function dj(i,e,t,r,n){var o=1/Math.tan(e/2),l;return i[0]=o/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,n!=null&&n!==1/0?(l=1/(r-n),i[10]=(n+r)*l,i[14]=2*n*r*l):(i[10]=-1,i[14]=-2*r),i}var fj=dj;function pj(i,e,t,r,n,o,l){var s=1/(e-t),g=1/(r-n),v=1/(o-l);return i[0]=-2*s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*v,i[11]=0,i[12]=(e+t)*s,i[13]=(n+r)*g,i[14]=(l+o)*v,i[15]=1,i}var gj=pj;function mj(i,e,t,r){var n,o,l,s,g,v,T,F,R,U,J=e[0],te=e[1],Ae=e[2],he=r[0],pe=r[1],be=r[2],Te=t[0],qe=t[1],je=t[2];return Math.abs(J-Te)<Ay&&Math.abs(te-qe)<Ay&&Math.abs(Ae-je)<Ay?sj(i):(T=J-Te,F=te-qe,R=Ae-je,U=1/Math.hypot(T,F,R),T*=U,F*=U,R*=U,n=pe*R-be*F,o=be*T-he*R,l=he*F-pe*T,U=Math.hypot(n,o,l),U?(U=1/U,n*=U,o*=U,l*=U):(n=0,o=0,l=0),s=F*l-R*o,g=R*n-T*l,v=T*o-F*n,U=Math.hypot(s,g,v),U?(U=1/U,s*=U,g*=U,v*=U):(s=0,g=0,v=0),i[0]=n,i[1]=s,i[2]=T,i[3]=0,i[4]=o,i[5]=g,i[6]=F,i[7]=0,i[8]=l,i[9]=v,i[10]=R,i[11]=0,i[12]=-(n*J+o*te+l*Ae),i[13]=-(s*J+g*te+v*Ae),i[14]=-(T*J+F*te+R*Ae),i[15]=1,i)}function yj(){var i=new ih(4);return ih!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function _j(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function CL(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function vj(i){var e=i[0],t=i[1],r=i[2],n=i[3];return Math.hypot(e,t,r,n)}function bj(i){var e=i[0],t=i[1],r=i[2],n=i[3];return e*e+t*t+r*r+n*n}function xj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t*t+r*r+n*n+o*o;return l>0&&(l=1/Math.sqrt(l)),i[0]=t*l,i[1]=r*l,i[2]=n*l,i[3]=o*l,i}function wj(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]}function Bj(i,e,t,r){var n=e[0],o=e[1],l=e[2],s=e[3];return i[0]=n+r*(t[0]-n),i[1]=o+r*(t[1]-o),i[2]=l+r*(t[2]-l),i[3]=s+r*(t[3]-s),i}function dy(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*o+t[12]*l,i[1]=t[1]*r+t[5]*n+t[9]*o+t[13]*l,i[2]=t[2]*r+t[6]*n+t[10]*o+t[14]*l,i[3]=t[3]*r+t[7]*n+t[11]*o+t[15]*l,i}function Cj(i,e,t){var r=e[0],n=e[1],o=e[2],l=t[0],s=t[1],g=t[2],v=t[3],T=v*r+s*o-g*n,F=v*n+g*r-l*o,R=v*o+l*n-s*r,U=-l*r-s*n-g*o;return i[0]=T*v+U*-l+F*-g-R*-s,i[1]=F*v+U*-s+R*-l-T*-g,i[2]=R*v+U*-g+T*-s-F*-l,i[3]=e[3],i}(function(){var i=yj();return function(e,t,r,n,o,l){var s,g;for(t||(t=4),r||(r=0),n?g=Math.min(n*t+r,e.length):g=e.length,s=r;s<g;s+=t)i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],i[3]=e[s+3],o(i,i,l),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],e[s+3]=i[3];return e}})();var T2;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(T2||(T2={}));const Ej=45*Math.PI/180,Sj=1,I2=.1,L2=500,Tj=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Sn extends vL{static get IDENTITY(){return Lj()}static get ZERO(){return Ij()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return T2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,n,o,l,s,g,v,T,F,R,U,J,te,Ae){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=o,this[5]=l,this[6]=s,this[7]=g,this[8]=v,this[9]=T,this[10]=F,this[11]=R,this[12]=U,this[13]=J,this[14]=te,this[15]=Ae,this.check()}setRowMajor(e,t,r,n,o,l,s,g,v,T,F,R,U,J,te,Ae){return this[0]=e,this[1]=o,this[2]=v,this[3]=U,this[4]=t,this[5]=l,this[6]=T,this[7]=J,this[8]=r,this[9]=s,this[10]=F,this[11]=te,this[12]=n,this[13]=g,this[14]=R,this[15]=Ae,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Tj)}fromObject(e){return this.check()}fromQuaternion(e){return hj(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:n,top:o,near:l=I2,far:s=L2}=e;return s===1/0?Mj(this,t,r,n,o,l):Aj(this,t,r,n,o,l,s),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:n=[0,1,0]}=e;return mj(this,t,r,n),this.check()}ortho(e){const{left:t,right:r,bottom:n,top:o,near:l=I2,far:s=L2}=e;return gj(this,t,r,n,o,l,s),this.check()}orthographic(e){const{fovy:t=Ej,aspect:r=Sj,focalDistance:n=1,near:o=I2,far:l=L2}=e;EL(t);const s=t/2,g=n*Math.tan(s),v=g*r;return this.ortho({left:-v,right:v,bottom:-g,top:g,near:o,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:n=.1,far:o=500}=e;return EL(t),fj(this,t,r,n,o),this.check()}determinant(){return aj(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),n=1/r[0],o=1/r[1],l=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*o,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*o,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),n=1/r[0],o=1/r[1],l=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=this[4]*n,e[4]=this[5]*o,e[5]=this[6]*l,e[6]=this[8]*n,e[7]=this[9]*o,e[8]=this[10]*l,e}transpose(){return oj(this,this),this.check()}invert(){return E2(this,this),this.check()}multiplyLeft(e){return vf(this,e,this),this.check()}multiplyRight(e){return vf(this,this,e),this.check()}rotateX(e){return wL(this,this,e),this.check()}rotateY(e){return cj(this,this,e),this.check()}rotateZ(e){return BL(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return lj(this,this,e,t),this.check()}scale(e){return S2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return h1(this,this,e),this.check()}transform(e,t){return e.length===4?(t=dy(t||[-0,-0,-0,-0],e,this),hy(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let n;switch(r){case 2:n=hL(t||[-0,-0],e,this);break;case 3:n=x2(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hy(n,e.length),n}transformAsVector(e,t){let r;switch(e.length){case 2:r=AL(t||[-0,-0],e,this);break;case 3:r=dL(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hy(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let A1,d1;function Ij(){return A1||(A1=new Sn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(A1)),A1}function Lj(){return d1||(d1=new Sn,Object.freeze(d1)),d1}function EL(i){if(i>Math.PI*2)throw Error("expected radians")}function Mj(i,e,t,r,n,o){const l=2*o/(t-e),s=2*o/(n-r),g=(t+e)/(t-e),v=(n+r)/(n-r),T=-1,F=-1,R=-2*o;return i[0]=l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=g,i[9]=v,i[10]=T,i[11]=F,i[12]=0,i[13]=0,i[14]=R,i[15]=0,i}function SL(){var i=new ih(4);return ih!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Pj(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function TL(i,e,t){t=t*.5;var r=Math.sin(t);return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=Math.cos(t),i}function IL(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=t[0],g=t[1],v=t[2],T=t[3];return i[0]=r*T+l*s+n*v-o*g,i[1]=n*T+l*g+o*s-r*v,i[2]=o*T+l*v+r*g-n*s,i[3]=l*T-r*s-n*g-o*v,i}function Fj(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],l=e[3],s=Math.sin(t),g=Math.cos(t);return i[0]=r*g+l*s,i[1]=n*g+o*s,i[2]=o*g-n*s,i[3]=l*g-r*s,i}function Dj(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],l=e[3],s=Math.sin(t),g=Math.cos(t);return i[0]=r*g-o*s,i[1]=n*g+l*s,i[2]=o*g+r*s,i[3]=l*g-n*s,i}function Rj(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],l=e[3],s=Math.sin(t),g=Math.cos(t);return i[0]=r*g+n*s,i[1]=n*g-r*s,i[2]=o*g+l*s,i[3]=l*g-o*s,i}function kj(i,e){var t=e[0],r=e[1],n=e[2];return i[0]=t,i[1]=r,i[2]=n,i[3]=Math.sqrt(Math.abs(1-t*t-r*r-n*n)),i}function f1(i,e,t,r){var n=e[0],o=e[1],l=e[2],s=e[3],g=t[0],v=t[1],T=t[2],F=t[3],R,U,J,te,Ae;return U=n*g+o*v+l*T+s*F,U<0&&(U=-U,g=-g,v=-v,T=-T,F=-F),1-U>Ay?(R=Math.acos(U),J=Math.sin(R),te=Math.sin((1-r)*R)/J,Ae=Math.sin(r*R)/J):(te=1-r,Ae=r),i[0]=te*n+Ae*g,i[1]=te*o+Ae*v,i[2]=te*l+Ae*T,i[3]=te*s+Ae*F,i}function Oj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t*t+r*r+n*n+o*o,s=l?1/l:0;return i[0]=-t*s,i[1]=-r*s,i[2]=-n*s,i[3]=o*s,i}function Uj(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i}function LL(i,e){var t=e[0]+e[4]+e[8],r;if(t>0)r=Math.sqrt(t+1),i[3]=.5*r,r=.5/r,i[0]=(e[5]-e[7])*r,i[1]=(e[6]-e[2])*r,i[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var o=(n+1)%3,l=(n+2)%3;r=Math.sqrt(e[n*3+n]-e[o*3+o]-e[l*3+l]+1),i[n]=.5*r,r=.5/r,i[3]=(e[o*3+l]-e[l*3+o])*r,i[o]=(e[o*3+n]+e[n*3+o])*r,i[l]=(e[l*3+n]+e[n*3+l])*r}return i}var Nj=_j,zj=CL,Qj=wj,Vj=Bj,Hj=vj,Gj=bj,ML=xj,jj=function(){var i=pL(),e=mL(1,0,0),t=mL(0,1,0);return function(r,n,o){var l=b2(n,o);return l<-.999999?(o1(i,e,n),KG(i)<1e-6&&o1(i,t,n),VG(i,i),TL(r,i,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o1(i,n,o),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+l,ML(r,r))}}();(function(){var i=SL(),e=SL();return function(t,r,n,o,l,s){return f1(i,r,l,s),f1(e,n,o,s),f1(t,i,e,2*s*(1-s)),t}})(),function(){var i=WG();return function(e,t,r,n){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],ML(e,LL(e,i))}}();const qj=[0,0,0,1];class fy extends y2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,r,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return LL(this,e),this.check()}fromAxisRotation(e,t){return TL(this,e,t),this.check()}identity(){return Pj(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=is(e)}get y(){return this[1]}set y(e){this[1]=is(e)}get z(){return this[2]}set z(e){this[2]=is(e)}get w(){return this[3]}set w(e){this[3]=is(e)}len(){return Hj(this)}lengthSquared(){return Gj(this)}dot(e){return Qj(this,e)}rotationTo(e,t){return jj(this,e,t),this.check()}add(e){return Nj(this,this,e),this.check()}calculateW(){return kj(this,this),this.check()}conjugate(){return Uj(this,this),this.check()}invert(){return Oj(this,this),this.check()}lerp(e,t,r){return r===void 0?this.lerp(this,e,t):(Vj(this,e,t,r),this.check())}multiplyRight(e){return IL(this,this,e),this.check()}multiplyLeft(e){return IL(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return Fj(this,this,e),this.check()}rotateY(e){return Dj(this,this,e),this.check()}rotateZ(e){return Rj(this,this,e),this.check()}scale(e){return zj(this,this,e),this.check()}slerp(e,t,r){let n,o,l;switch(arguments.length){case 1:({start:n=qj,target:o,ratio:l}=e);break;case 2:n=this,o=e,l=t;break;default:n=e,o=t,l=r}return f1(this,n,o,l),this.check()}transformVector4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new B2;return Cj(t,e,this),hy(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const py={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},PL=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,$j={lightSources:{}};function M2(){let{color:i=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i.map(t=>t*e/255)}function Kj(i){let{ambientLight:e,pointLights:t=[],directionalLights:r=[]}=i;const n={};return e?n["lighting_uAmbientLight.color"]=M2(e):n["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((o,l)=>{n["lighting_uPointLight[".concat(l,"].color")]=M2(o),n["lighting_uPointLight[".concat(l,"].position")]=o.position,n["lighting_uPointLight[".concat(l,"].attenuation")]=o.attenuation||[1,0,0]}),n.lighting_uPointLightCount=t.length,r.forEach((o,l)=>{n["lighting_uDirectionalLight[".concat(l,"].color")]=M2(o),n["lighting_uDirectionalLight[".concat(l,"].direction")]=o.direction}),n.lighting_uDirectionalLightCount=r.length,n}function FL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$j;if("lightSources"in i){const{ambientLight:e,pointLights:t,directionalLights:r}=i.lightSources||{};return e||t&&t.length>0||r&&r.length>0?Object.assign({},Kj({ambientLight:e,pointLights:t,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in i){const e={pointLights:[],directionalLights:[]};for(const t of i.lights||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights.push(t);break;case"point":e.pointLights.push(t);break}return FL({lightSources:e})}return{}}const P2={name:"lights",vs:PL,fs:PL,getUniforms:FL,defines:{MAX_LIGHTS:3}},Wj={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function Zj(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Wj;const e={};if(i.pickingSelectedColor!==void 0)if(!i.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const t=i.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}if(i.pickingHighlightColor){const t=Array.from(i.pickingHighlightColor,r=>r/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return i.pickingActive!==void 0&&(e.picking_uActive=!!i.pickingActive,e.picking_uAttribute=!!i.pickingAttribute),e}const Xj={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:Zj},DL=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,Jj={};function Yj(i){const{ambient:e=.35,diffuse:t=.6,shininess:r=32,specularColor:n=[30,30,30]}=i;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:r,lighting_uSpecularColor:n.map(o=>o/255)}}function RL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jj;if(!("material"in i))return{};const{material:e}=i;return e?Yj(e):{lighting_uEnabled:!1}}const eq={name:"gouraud-lighting",dependencies:[P2],vs:DL,defines:{LIGHTING_VERTEX:1},getUniforms:RL},tq={name:"phong-lighting",dependencies:[P2],fs:DL,defines:{LIGHTING_FRAGMENT:1},getUniforms:RL},F2={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[P2]},iq={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class gy{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new gy(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:t="",fs:r="",defines:n={},inject:o={},varyings:l=[],bufferMode:s=35981,transpileToGLSL100:g=!1}=e,v=this._getModuleList(e.modules),T=this._getHash(t),F=this._getHash(r),R=v.map(be=>this._getHash(be.name)).sort(),U=l.map(be=>this._getHash(be)),J=Object.keys(n).sort(),te=Object.keys(o).sort(),Ae=[],he=[];for(const be of J)Ae.push(this._getHash(be)),Ae.push(this._getHash(n[be]));for(const be of te)he.push(this._getHash(be)),he.push(this._getHash(o[be]));const pe="".concat(T,"/").concat(F,"D").concat(Ae.join("/"),"M").concat(R.join("/"),"I").concat(he.join("/"),"V").concat(U.join("/"),"H").concat(this.stateHash,"B").concat(s).concat(g?"T":"");if(!this._programCache[pe]){const be=hG(this.gl,{vs:t,fs:r,modules:v,inject:o,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:g});this._programCache[pe]=new Q3(this.gl,{hash:pe,vs:be.vs,fs:be.fs,varyings:l,bufferMode:s}),this._getUniforms[pe]=be.getUniforms||(Te=>{}),this._useCounts[pe]=0}return this._useCounts[pe]++,this._programCache[pe]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,this._useCounts[t]===0&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),r={};let n=0;for(let o=0,l=this._defaultModules.length;o<l;++o){const s=this._defaultModules[o],g=s.name;t[n++]=s,r[g]=!0}for(let o=0,l=e.length;o<l;++o){const s=e[o],g=s.name;r[g]||(t[n++]=s,r[g]=!0)}return t.length=n,t}}const rq={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function nq(i,e,t){const r={};let n=e.indices;for(const o in e.attributes){const l=e.attributes[o],s=sq(o,t);if(o==="indices")n=l;else if(l.constant)r[s]=l.value;else{const g=l.value,v={...l};delete v.value,r[s]=[new bs(i,g),v],oq(o,v)}}if(n){const o=n.value||n;Xi(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');const l={size:1,isIndexed:n.isIndexed===void 0?!0:n.isIndexed};r.indices=[new bs(i,{data:o,target:34963}),l]}return r}function sq(i,e){const{attributeMap:t=rq}=e||{};return t&&t[i]||i}function oq(i,e){let t;switch(i){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors";break}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}Xi(Number.isFinite(e.size),"attribute ".concat(i," needs size"))}const Yp=2,aq=1e4,lq="Model needs drawMode and vertexCount",kL=()=>{},cq={};class eg{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=wA("model")}=t;Xi($_(e)),this.id=r,this.gl=e,this.id=t.id||wA("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||gy.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:v,transpileToGLSL100:T}=e;this.programProps={program:t,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:v,transpileToGLSL100:T},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Xi(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),lq)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:v,transpileToGLSL100:T}=e;this.programProps={program:t,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:v,transpileToGLSL100:T},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Xi(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Xi(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=nq(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Kp(e))return this;const t={};for(const r in e){const n=e[r];t[r]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(t),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return i2(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:t=null,framebuffer:r,uniforms:n={},attributes:o={},transformFeedback:l=this.transformFeedback,parameters:s={},vertexArray:g=this.vertexArray}=e;this.setAttributes(o),this.updateModuleSettings(t),this.setUniforms(n);let v;hr.priority>=Yp&&(v=this._logDrawCallStart(Yp));const T=this.vertexArray.getDrawParams(),{isIndexed:F=T.isIndexed,indexType:R=T.indexType,indexOffset:U=T.indexOffset,vertexArrayInstanced:J=T.isInstanced}=this.props;J&&!this.isInstanced&&hr.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:te,instanceCount:Ae}=this,{onBeforeRender:he=kL,onAfterRender:pe=kL}=this.props;he(),this.program.setUniforms(this.uniforms);const be=this.program.draw(Object.assign(cq,e,{logPriority:v,uniforms:null,framebuffer:r,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:g,transformFeedback:l,isIndexed:F,indexType:R,isInstanced:te,instanceCount:Ae,offset:F?U:0}));return pe(),hr.priority>=Yp&&this._logDrawCallEnd(v,g,r),be}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:t=!0,feedbackBuffers:r,unbindModels:n=[]}=e;let{parameters:o}=e;r&&this._setFeedbackBuffers(r),t&&(o=Object.assign({},o,{35977:t})),n.forEach(l=>l.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:o}))}finally{n.forEach(l=>l.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return hr.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:r,fs:n,modules:o,inject:l,defines:s,varyings:g,bufferMode:v,transpileToGLSL100:T}=this.programProps;t=this.programManager.get({vs:r,fs:n,modules:o,inject:l,defines:s,varyings:g,bufferMode:v,transpileToGLSL100:T}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Xi(t instanceof Q3,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new E7(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof bs&&t.delete()}}_setAnimationProps(e){this.animated&&Xi(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Kp(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new V3(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:aq;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),hr.group(Yp,">>> DRAWING MODEL ".concat(this.id),{collapsed:hr.level<=2})(),e}_logDrawCallEnd(e,t,r,n){if(e===void 0)return;const o=I7({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:l,unusedTable:s,unusedCount:g}=H3({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:v,count:T}=H3({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});T>0&&hr.log("MISSING UNIFORMS",Object.keys(v))(),g>0&&hr.log("UNUSED UNIFORMS",Object.keys(s))();const F=M7(this.vertexArray.configuration);hr.table(e,o)(),hr.table(e,l)(),hr.table(e+1,F)(),n&&n.log({logLevel:Yp,message:"Rendered to ".concat(n.id)}),hr.groupEnd(Yp)()}}class uq{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:n}=t;return{attributes:Object.assign({},r,e.attributes),transformFeedback:n}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],r=e?t[e]:null;return r?r instanceof bs?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:t}=e,r=this.getBuffer(t);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Xi(dn(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const n in this.feedbackMap){const o=this.feedbackMap[n];n in t&&(r[o]=n)}Object.assign(r,e.feedbackBuffers);for(const n in r){const o=r[n];if(typeof o=="string"){const l=t[o],{byteLength:s,usage:g,accessor:v}=l;r[n]=this._createNewBuffer(n,{byteLength:s,usage:g,accessor:v})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:r})}_setupTransformFeedback(e,t){let{model:r}=t;const{program:n}=r;e.transformFeedback=new V3(this.gl,{program:n,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:t,feedbackBuffers:r})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const n in this.feedbackMap){const o=this.feedbackMap[n];t[n]=e.feedbackBuffers[o],r[o]=e.sourceBuffers[n],Xi(r[o]instanceof bs)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){const r=new bs(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const hq="transform_uSampler_",p1="transform_uSize_",OL="transform_position";function Aq(i){let{vs:e,sourceTextureMap:t,targetTextureVarying:r,targetTexture:n}=i,l=Object.keys(t).length,s=null;const g={};let v=e,T={};if(l>0||r){const F=v.split(`
`),R=F.slice();if(F.forEach((U,J,te)=>{if(l>0){const Ae=mq(U,t);if(Ae){const{updatedLine:he,inject:pe}=Ae;R[J]=he,T=f2([T,pe]),Object.assign(g,Ae.samplerTextureMap),l--}}r&&!s&&(s=gq(U,r))}),r){Xi(n);const U="".concat(p1).concat(r),J="uniform vec2 ".concat(U,`;
`),te="     vec2 ".concat(OL," = transform_getPos(").concat(U,`);
     gl_Position = vec4(`).concat(OL,`, 0, 1.);
`);T=f2([T,{"vs:#decl":J,"vs:#main-start":te}])}v=R.join(`
`)}return{vs:v,targetTextureType:s,inject:T,samplerTextureMap:g}}function dq(i){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}=i;const n={};let o,l;t&&({width:o,height:l}=r,n["".concat(p1).concat(t)]=[o,l]);for(const s in e)({width:o,height:l}=e[s]),n["".concat(p1).concat(s)]=[o,l];return n}function fq(i){return oL(i,["attribute","in"])}function pq(i){const e="".concat(hq).concat(i),t="".concat(p1).concat(i),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(t,";");return{samplerName:e,sizeName:t,uniformDeclerations:r}}function gq(i,e){const t=oL(i,["varying","out"]);return t&&t.name===e?t.type:null}function mq(i,e){const t={},r=fq(i);if(!r)return null;const{type:n,name:o}=r;if(o&&e[o]){const l="// ".concat(i," => Replaced by Transform with a sampler"),{samplerName:s,sizeName:g,uniformDeclerations:v}=pq(o),T=vG(n),F="  ".concat(n," ").concat(o," = transform_getInput(").concat(s,", ").concat(g,").").concat(T,`;
`);return t[s]=o,{updatedLine:l,inject:{"vs:#decl":v,"vs:#main-start":F},samplerTextureMap:t}}return null}const yq={10241:9728,10240:9728,10242:33071,10243:33071},_q="transform_output";class vq{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,sourceTextures:r,framebuffer:n,targetTexture:o}=this.bindings[this.currentIndex],l=Object.assign({},t,e.attributes),s=Object.assign({},e.uniforms),g=Object.assign({},e.parameters);let v=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){l.transform_elementID=this.elementIDBuffer;for(const F in this.samplerTextureMap){const R=this.samplerTextureMap[F];s[F]=r[R]}this._setSourceTextureParameters();const T=dq({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(s,T)}return this.hasTargetTexture&&(v=!1,g.viewport=[0,0,n.width,n.height]),{attributes:l,framebuffer:n,uniforms:s,discard:v,parameters:g}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:t}=this.bindings[this.currentIndex],r=W_(t);if(!e)return r;const n=r.constructor,o=bG(this.targetTextureType),l=new n(r.length*o/4);let s=0;for(let g=0;g<r.length;g+=4)for(let v=0;v<o;v++)l[s++]=r[g+v];return l}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:r}=e;if(r instanceof Yc)return r;const n=t[r];return n?(this._targetRefTexName=r,this._createNewTexture(n)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,_sourceTextures:r={},_targetTexture:n}=e,o=this._createTargetTexture({sourceTextures:r,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:o}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((r,n,o)=>{o[n]=n}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new bs(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:t,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:t,targetTexture:r})}}_updateBinding(e,t){const{sourceBuffers:r,sourceTextures:n,targetTexture:o}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,r),o){e.targetTexture=o;const{width:l,height:s}=o,{framebuffer:g}=e;g?(g.update({attachments:{36064:o},resizeAttachments:!1}),g.resize({width:l,height:s})):e.framebuffer=new ba(this.gl,{id:"transform-framebuffer",width:l,height:s,attachments:{36064:o}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const r in t)t[r].setParameters(yq)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:r}}_createNewTexture(e){const t=pH(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:n,uniforms:o,targetTextureType:l,inject:s,samplerTextureMap:g}=Aq({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),v=f2([e.inject||{},s]);this.targetTextureType=l,this.samplerTextureMap=g;const T=e._fs||aL({version:D3(n),input:this.targetTextureVarying,inputType:l,output:_q}),F=this.hasSourceTextures||this.targetTextureVarying?[iq].concat(e.modules||[]):e.modules;return{vs:n,fs:T,modules:F,uniforms:o,inject:v}}}class D2{static isSupported(e){return dn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:t=!0}=e,r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)e=e||r.swap();Xi(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t){const n=r.getData(e);if(n)return n}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new eg(t,Object.assign({},e,{fs:e.fs||aL({version:D3(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)t=n.updateModelProps(t);return t}_buildResourceTransforms(e,t){bq(t)&&(this.bufferTransform=new uq(e,t)),xq(t)&&(this.textureTransform=new vq(e,t)),Xi(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)t=Object.assign(t,n.getDrawOptions(t));return t}}function bq(i){return!!(!Kp(i.feedbackBuffers)||!Kp(i.feedbackMap)||i.varyings&&i.varyings.length>0)}function xq(i){return!!(!Kp(i._sourceTextures)||i._targetTexture||i._targetTextureVarying)}const UL={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class my{static get DRAW_MODE(){return UL}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t=wA("geometry"),drawMode:r=UL.TRIANGLES,attributes:n={},indices:o=null,vertexCount:l=null}=e;this.id=t,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(n,o),this.vertexCount=l||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const r in e){let n=e[r];n=ArrayBuffer.isView(n)?{value:n}:n,Xi(ArrayBuffer.isView(n.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!n.size&&(n.size=3),r==="indices"?(Xi(!this.indices),this.indices=n):this.attributes[r]=n}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const n in e){const o=e[n],{value:l,size:s,constant:g}=o;!g&&l&&s>=1&&(r=Math.min(r,l.length/s))}return Xi(Number.isFinite(r)),r}}let wq=1,Bq=1;class NL{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:n=1,repeat:o=1}=e,l=wq++,s={time:0,delay:t,duration:r,rate:n,repeat:o};return this._setChannelTime(s,this.time),this.channels.set(l,s),l}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const n of t)this._setChannelTime(n,this.time);const r=this.animations.values();for(const n of r){const{animation:o,channel:l}=n;o.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=Bq++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,n=e.duration*e.repeat;r>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const Cq=[255,255,255],Eq=1;let Sq=0;class zL{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"color",void 0),ye(this,"intensity",void 0),ye(this,"type","ambient");const{color:t=Cq}=e,{intensity:r=Eq}=e;this.id=e.id||"ambient-".concat(Sq++),this.color=t,this.intensity=r}}const Tq=[255,255,255],Iq=1,Lq=[0,0,-1];let Mq=0;class QL{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"color",void 0),ye(this,"intensity",void 0),ye(this,"type","directional"),ye(this,"direction",void 0),ye(this,"shadow",void 0);const{color:t=Tq}=e,{intensity:r=Iq}=e,{direction:n=Lq}=e,{_shadow:o=!1}=e;this.id=e.id||"directional-".concat(Mq++),this.color=t,this.intensity=r,this.type="directional",this.direction=new Ut(n).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class Pq{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};ye(this,"id",void 0),ye(this,"gl",void 0),ye(this,"props",void 0);const{id:r}=t;this.id=r,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class R2 extends Pq{constructor(){super(...arguments),ye(this,"_lastRenderIndex",-1)}render(e){const t=this.gl;return xA(t,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:r,viewports:n,views:o,onViewportActive:l,clearStack:s=!0,clearCanvas:g=!0}=e;e.pass=e.pass||"unknown";const v=this.gl;g&&Dq(v,t),s&&(this._lastRenderIndex=-1);const T=[];for(const F of n){const R=o&&o[F.id];l==null||l(F);const U=this._getDrawLayerParams(F,e),J=F.subViewports||[F];for(const te of J){const Ae=this._drawLayersInViewport(v,{target:t,moduleParameters:r,viewport:te,view:R,pass:e.pass,layers:e.layers},U);T.push(Ae)}}return T}_getDrawLayerParams(e,t){let{layers:r,pass:n,isPicking:o=!1,layerFilter:l,cullRect:s,effects:g,moduleParameters:v}=t,T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const F=[],R=VL(this._lastRenderIndex+1),U={layer:r[0],viewport:e,isPicking:o,renderPass:n,cullRect:s},J={};for(let te=0;te<r.length;te++){const Ae=r[te],he=this._shouldDrawLayer(Ae,U,l,J),pe={shouldDrawLayer:he};he&&!T&&(pe.layerRenderIndex=R(Ae,he),pe.moduleParameters=this._getModuleParameters(Ae,g,n,v),pe.layerParameters=this.getLayerParameters(Ae,te,e)),F[te]=pe}return F}_drawLayersInViewport(e,t,r){let{layers:n,moduleParameters:o,pass:l,target:s,viewport:g,view:v}=t;const T=Fq(e,{moduleParameters:o,target:s,viewport:g});if(v&&v.props.clear){const R=v.props.clear===!0?{color:!0,depth:!0}:v.props.clear;Yu(e,{scissorTest:!0,scissor:T},()=>i2(e,R))}const F={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};xA(e,{viewport:T});for(let R=0;R<n.length;R++){const U=n[R],{shouldDrawLayer:J,layerRenderIndex:te,moduleParameters:Ae,layerParameters:he}=r[R];if(J&&U.props.pickable&&F.pickableCount++,U.isComposite)F.compositeCount++;else if(J){F.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,te),Ae.viewport=g;try{U._drawLayer({moduleParameters:Ae,uniforms:{layerIndex:te},parameters:he})}catch(pe){U.raiseError(pe,"drawing ".concat(U," to ").concat(l))}}}return F}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(r){const s=t.layer.id;if(s in n||(n[s]=r(t)),!n[s])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,r,n){var o;const l=Object.assign(Object.create(((o=e.internalState)===null||o===void 0?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:$p(this.gl)});if(t)for(const g of t){var s;Object.assign(l,(s=g.getModuleParameters)===null||s===void 0?void 0:s.call(g,e))}return Object.assign(l,this.getModuleParameters(e,t),n)}}function VL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t={},r=(n,o)=>{const l=n.props._offset,s=n.id,g=n.parent&&n.parent.id;let v;if(g&&!(g in e)&&r(n.parent,!1),g in t){const T=t[g]=t[g]||VL(e[g],e);v=T(n,o),t[s]=T}else Number.isFinite(l)?(v=l+(e[g]||0),t[s]=null):v=i;return o&&v>=i&&(i=v+1),e[s]=v,v};return r}function Fq(i,e){let{moduleParameters:t,target:r,viewport:n}=e;const o=r&&r.id!=="default-framebuffer",l=t&&t.devicePixelRatio||$p(i),s=o?r.height:i.drawingBufferHeight,g=n;return[g.x*l,s-(g.y+g.height)*l,g.width*l,g.height*l]}function Dq(i,e){const t=e?e.width:i.drawingBufferWidth,r=e?e.height:i.drawingBufferHeight;xA(i,{viewport:[0,0,t,r]}),i.clear(16640)}class Rq extends R2{constructor(e,t){super(e,t),ye(this,"shadowMap",void 0),ye(this,"depthBuffer",void 0),ye(this,"fbo",void 0),this.shadowMap=new Yc(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Xp(e,{format:33189,width:1,height:1}),this.fbo=new ba(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;Yu(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],n=$p(this.gl),o=r.width*n,l=r.height*n;(o!==t.width||l!==t.height)&&t.resize({width:o,height:l}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const HL="#define SMOOTH_EDGE_RADIUS 0.5",kq=`
`.concat(HL,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),Oq=`
`.concat(HL,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),Uq={name:"geometry",vs:kq,fs:Oq},Nq=Object.keys(Mn).map(i=>"const int COORDINATE_SYSTEM_".concat(i," = ").concat(Mn[i],";")).join(""),zq=Object.keys(Uh).map(i=>"const int PROJECTION_MODE_".concat(i," = ").concat(Uh[i],";")).join(""),Qq=Object.keys(Hw).map(i=>"const int UNIT_".concat(i.toUpperCase()," = ").concat(Hw[i],";")).join(""),Vq="".concat(Nq,`
`).concat(zq,`
`).concat(Qq,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function Hq(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}return!1}function yy(i){let e={},t;return r=>{for(const n in r)if(!Hq(r[n],e[n])){t=i(r),e=r;break}return t}}const jL=[0,0,0,0],Gq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],qL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],jq=[0,0,0],$L=[0,0,0],qq=yy(Wq);function KL(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:$L;t.length<3&&(t=[t[0],t[1],0]);let r=t,n,o=!0;switch(e===Mn.LNGLAT_OFFSETS||e===Mn.METER_OFFSETS?n=t:n=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Uh.WEB_MERCATOR:(e===Mn.LNGLAT||e===Mn.CARTESIAN)&&(n=[0,0,0],o=!1);break;case Uh.WEB_MERCATOR_AUTO_OFFSET:e===Mn.LNGLAT?r=n:e===Mn.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],n=i.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Uh.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case Uh.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:r,offsetMode:o}}function $q(i,e,t){const{viewMatrixUncentered:r,projectionMatrix:n}=i;let{viewMatrix:o,viewProjectionMatrix:l}=i,s=jL,g=jL,v=i.cameraPosition;const{geospatialOrigin:T,shaderCoordinateOrigin:F,offsetMode:R}=KL(i,e,t);return R&&(g=i.projectPosition(T||F),v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],g[3]=1,s=dy([],g,l),o=r||o,l=vf([],n,o),l=vf([],l,Gq)),{viewMatrix:o,viewProjectionMatrix:l,projectionCenter:s,originCommon:g,cameraPosCommon:v,shaderCoordinateOrigin:F,geospatialOrigin:T}}function Kq(i){let{viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=Mn.DEFAULT,coordinateOrigin:o=$L,autoWrapLongitude:l=!1}=i;n===Mn.DEFAULT&&(n=e.isGeospatial?Mn.LNGLAT:Mn.CARTESIAN);const s=qq({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:o});return s.project_uWrapLongitude=l,s.project_uModelMatrix=r||qL,s}function Wq(i){let{viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}=i;const{projectionCenter:o,viewProjectionMatrix:l,originCommon:s,cameraPosCommon:g,shaderCoordinateOrigin:v,geospatialOrigin:T}=$q(e,r,n),F=e.getDistanceScales(),R=[e.width*t,e.height*t],U=dy([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,J={project_uCoordinateSystem:r,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:v,project_uCommonOrigin:s.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!e._pseudoMeters,project_uViewportSize:R,project_uDevicePixelRatio:t,project_uFocalDistance:U,project_uCommonUnitsPerMeter:F.unitsPerMeter,project_uCommonUnitsPerWorldUnit:F.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:jq,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:l,project_uModelMatrix:qL,project_uCameraPosition:g};if(T){const te=e.getDistanceScales(T);switch(r){case Mn.METER_OFFSETS:J.project_uCommonUnitsPerWorldUnit=te.unitsPerMeter,J.project_uCommonUnitsPerWorldUnit2=te.unitsPerMeter2;break;case Mn.LNGLAT:case Mn.LNGLAT_OFFSETS:e._pseudoMeters||(J.project_uCommonUnitsPerMeter=te.unitsPerMeter),J.project_uCommonUnitsPerWorldUnit=te.unitsPerDegree,J.project_uCommonUnitsPerWorldUnit2=te.unitsPerDegree2;break;case Mn.CARTESIAN:J.project_uCommonUnitsPerWorldUnit=[1,1,te.unitsPerMeter[2]],J.project_uCommonUnitsPerWorldUnit2=[0,0,te.unitsPerMeter2[2]];break}}return J}const Zq={};function Xq(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Zq;return"viewport"in i?Kq(i):{}}const k2={name:"project",dependencies:[wG,Uq],vs:Vq,getUniforms:Xq};function Jq(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function tg(i,e){const t=dy([],e,i);return CL(t,t,1/t[3]),t}function WL(i,e){const t=i%e;return t<0?e+t:t}function O2(i,e,t){return i<e?e:i>t?t:i}function Yq(i){return Math.log(i)*Math.LOG2E}const U2=Math.log2||Yq;function TA(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const rh=Math.PI,ZL=rh/4,Eu=rh/180,N2=180/rh,ig=512,g1=4003e4,m1=85.051129,e$=1.5;function t$(i){return U2(i)}function _y(i){const[e,t]=i;TA(Number.isFinite(e)),TA(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*Eu,n=t*Eu,o=ig*(r+rh)/(2*rh),l=ig*(rh+Math.log(Math.tan(ZL+n*.5)))/(2*rh);return[o,l]}function rg(i){const[e,t]=i,r=e/ig*(2*rh)-rh,n=2*(Math.atan(Math.exp(t/ig*(2*rh)-rh))-ZL);return[r*N2,n*N2]}function i$(i){const{latitude:e}=i;TA(Number.isFinite(e));const t=Math.cos(e*Eu);return t$(g1*t)-9}function y1(i){const e=Math.cos(i*Eu);return ig/g1/e}function z2(i){const{latitude:e,longitude:t,highPrecision:r=!1}=i;TA(Number.isFinite(e)&&Number.isFinite(t));const n=ig,o=Math.cos(e*Eu),l=n/360,s=l/o,g=n/g1/o,v={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[l,s,g],degreesPerUnit:[1/l,1/s,1/g]};if(r){const T=Eu*Math.tan(e*Eu)/o,F=l*T/2,R=n/g1*T,U=R/s*g;v.unitsPerDegree2=[0,F,R],v.unitsPerMeter2=[U,0,U]}return v}function XL(i,e){const[t,r,n]=i,[o,l,s]=e,{unitsPerMeter:g,unitsPerMeter2:v}=z2({longitude:t,latitude:r,highPrecision:!0}),T=_y(i);T[0]+=o*(g[0]+v[0]*l),T[1]+=l*(g[1]+v[1]*l);const F=rg(T),R=(n||0)+(s||0);return Number.isFinite(n)||Number.isFinite(s)?[F[0],F[1],R]:F}function r$(i){const{height:e,pitch:t,bearing:r,altitude:n,scale:o,center:l}=i,s=Jq();h1(s,s,[0,0,-n]),wL(s,s,-t*Eu),BL(s,s,r*Eu);const g=o/e;return S2(s,s,[g,g,g]),l&&h1(s,s,QG([],l)),s}function n$(i){const{width:e,height:t,altitude:r,pitch:n=0,offset:o,center:l,scale:s,nearZMultiplier:g=1,farZMultiplier:v=1}=i;let{fovy:T=_1(e$)}=i;r!==void 0&&(T=_1(r));const F=T*Eu,R=n*Eu,U=JL(T);let J=U;l&&(J+=l[2]*s/Math.cos(R)/t);const te=F*(.5+(o?o[1]:0)/t),Ae=Math.sin(te)*J/Math.sin(O2(Math.PI/2-R-te,.01,Math.PI-.01)),he=Math.sin(R)*Ae+J,pe=J*10,be=Math.min(he*v,pe);return{fov:F,aspect:e/t,focalDistance:U,near:g,far:be}}function _1(i){return 2*Math.atan(.5/i)*N2}function JL(i){return .5/Math.tan(.5*i*Eu)}function YL(i,e){const[t,r,n=0]=i;return TA(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(n)),tg(e,[t,r,n,1])}function Q2(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[r,n,o]=i;if(TA(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return tg(e,[r,n,o,1]);const l=tg(e,[r,n,0,1]),s=tg(e,[r,n,1,1]),g=l[2],v=s[2],T=g===v?0:((t||0)-g)/(v-g);return cL([],l,s,T)}function s$(i){const{width:e,height:t,bounds:r,minExtent:n=0,maxZoom:o=24,offset:l=[0,0]}=i,[[s,g],[v,T]]=r,F=o$(i.padding),R=_y([s,O2(T,-m1,m1)]),U=_y([v,O2(g,-m1,m1)]),J=[Math.max(Math.abs(U[0]-R[0]),n),Math.max(Math.abs(U[1]-R[1]),n)],te=[e-F.left-F.right-Math.abs(l[0])*2,t-F.top-F.bottom-Math.abs(l[1])*2];TA(te[0]>0&&te[1]>0);const Ae=te[0]/J[0],he=te[1]/J[1],pe=(F.right-F.left)/2/Ae,be=(F.top-F.bottom)/2/he,Te=[(U[0]+R[0])/2+pe,(U[1]+R[1])/2+be],qe=rg(Te),je=Math.min(o,U2(Math.abs(Math.min(Ae,he))));return TA(Number.isFinite(je)),{longitude:qe[0],latitude:qe[1],zoom:je}}function o$(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(TA(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const eM=Math.PI/180;function a$(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:t,height:r,unproject:n}=i,o={targetZ:e},l=n([0,r],o),s=n([t,r],o);let g,v;const T=i.fovy?.5*i.fovy*eM:Math.atan(.5/i.altitude),F=(90-i.pitch)*eM;return T>F-.01?(g=tM(i,0,e),v=tM(i,t,e)):(g=n([0,0],o),v=n([t,0],o)),[l,s,v,g]}function tM(i,e,t){const{pixelUnprojectionMatrix:r}=i,n=tg(r,[e,0,1,1]),o=tg(r,[e,i.height,1,1]),s=(t*i.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),g=cL([],n,o,s),v=rg(g);return v.push(t),v}const iM=512;function l$(i){const{width:e,height:t,pitch:r=0}=i;let{longitude:n,latitude:o,zoom:l,bearing:s=0}=i;(n<-180||n>180)&&(n=WL(n+180,360)-180),(s<-180||s>180)&&(s=WL(s+180,360)-180);const g=U2(t/iM);if(l<=g)l=g,o=0;else{const v=t/2/Math.pow(2,l),T=rg([0,v])[1];if(o<T)o=T;else{const F=rg([0,iM-v])[1];o>F&&(o=F)}}return{width:e,height:t,longitude:n,latitude:o,zoom:l,pitch:r,bearing:s}}const c$=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,u$=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,h$=yy(g$),A$=yy(m$),d$=[0,0,0,1],f$=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function p$(i,e){const[t,r,n]=i,o=Q2([t,r,n],e);return Number.isFinite(n)?o:[o[0],o[1],0]}function g$(i){let{viewport:e,center:t}=i;return new Sn(e.viewProjectionMatrix).invert().transform(t)}function m$(i){let{viewport:e,shadowMatrices:t}=i;const r=[],n=e.pixelUnprojectionMatrix,o=e.isGeospatial?void 0:1,l=[[0,0,o],[e.width,0,o],[0,e.height,o],[e.width,e.height,o],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>p$(s,n));for(const s of t){const g=s.clone().translate(new Ut(e.center).negate()),v=l.map(F=>g.transform(F)),T=new Sn().ortho({left:Math.min(...v.map(F=>F[0])),right:Math.max(...v.map(F=>F[0])),bottom:Math.min(...v.map(F=>F[1])),top:Math.max(...v.map(F=>F[1])),near:Math.min(...v.map(F=>-F[2])),far:Math.max(...v.map(F=>-F[2]))});r.push(T.multiplyRight(s))}return r}function y$(i,e){const{shadowEnabled:t=!0}=i;if(!t||!i.shadowMatrices||!i.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!i.drawToShadowMap,shadow_uUseShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,shadow_uColor:i.shadowColor||d$,shadow_uLightId:i.shadowLightId||0,shadow_uLightCount:i.shadowMatrices.length},n=h$({viewport:i.viewport,center:e.project_uCenter}),o=[],l=A$({shadowMatrices:i.shadowMatrices,viewport:i.viewport}).slice();for(let s=0;s<i.shadowMatrices.length;s++){const g=l[s],v=g.clone().translate(new Ut(i.viewport.center).negate());e.project_uCoordinateSystem===Mn.LNGLAT&&e.project_uProjectionMode===Uh.WEB_MERCATOR?(l[s]=v,o[s]=n):(l[s]=g.clone().multiplyRight(f$),o[s]=v.transform(n))}for(let s=0;s<l.length;s++)r["shadow_uViewProjectionMatrices[".concat(s,"]")]=l[s],r["shadow_uProjectCenters[".concat(s,"]")]=o[s],i.shadowMaps&&i.shadowMaps.length>0?r["shadow_uShadowMap".concat(s)]=i.shadowMaps[s]:r["shadow_uShadowMap".concat(s)]=i.dummyShadowMap;return r}const V2={name:"shadow",dependencies:[k2],vs:c$,fs:u$,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in i&&(i.drawToShadowMap||i.shadowMaps&&i.shadowMaps.length>0)?y$(i,e):{}}},_$={color:[255,255,255],intensity:1},rM=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],v$=[0,0,0,200/255];class H2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id","lighting-effect"),ye(this,"props",void 0),ye(this,"shadowColor",v$),ye(this,"shadow",void 0),ye(this,"ambientLight",void 0),ye(this,"directionalLights",void 0),ye(this,"pointLights",void 0),ye(this,"shadowPasses",[]),ye(this,"shadowMaps",[]),ye(this,"dummyShadowMap",null),ye(this,"programManager",void 0),ye(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.props=e}preRender(e,t){let{layers:r,layerFilter:n,viewports:o,onViewportActive:l,views:s}=t;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=gy.getDefaultProgramManager(e),V2&&this.programManager.addDefaultModule(V2)),this.dummyShadowMap||(this.dummyShadowMap=new Yc(e,{width:1,height:1}));for(let g=0;g<this.shadowPasses.length;g++)this.shadowPasses[g].render({layers:r,layerFilter:n,viewports:o,onViewportActive:l,views:s,moduleParameters:{shadowLightId:g,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(V2),this.programManager=null)}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new Sn().lookAt({eye:new Ut(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new Rq(e);this.shadowPasses[t]=r,this.shadowMaps[t]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new zL(_$),this.directionalLights.push(new QL(rM[0]),new QL(rM[1])))}}class b${constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"_pool",[]),ye(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,r){let{size:n=1,type:o,padding:l=0,copy:s=!1,initialize:g=!1,maxCount:v}=r;const T=o||e&&e.constructor||Float32Array,F=t*n+l;if(ArrayBuffer.isView(e)){if(F<=e.length)return e;if(F*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new T(e.buffer,0,F)}let R=1/0;v&&(R=v*n+l);const U=this._allocate(T,F,g,R);return e&&s?U.set(e):g||U.fill(0,0,4),this._release(e),U}release(e){this._release(e)}_allocate(e,t,r,n){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>n&&(o=n);const l=this._pool,s=e.BYTES_PER_ELEMENT*o,g=l.findIndex(v=>v.byteLength>=s);if(g>=0){const v=new e(l.splice(g,1)[0],0,o);return r&&v.fill(0),v}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:n}=r,o=t.findIndex(l=>l.byteLength>=n);o<0?t.push(r):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,r),t.length>this.opts.poolSize&&t.shift()}}const vy=new b$;function by(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function x$(i){return[i[12],i[13],i[14]]}function w$(i){return{left:ng(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:ng(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:ng(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:ng(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:ng(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:ng(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const nM=new Ut;function ng(i,e,t,r){nM.set(i,e,t);const n=nM.len();return{distance:r/n,normal:new Ut(-i/n,-e/n,-t/n)}}function B$(i){return i-Math.fround(i)}let xy;function G2(i,e){const{size:t=1,startIndex:r=0}=e,n=e.endIndex!==void 0?e.endIndex:i.length,o=(n-r)/t;xy=vy.allocate(xy,o,{type:Float32Array,size:t*2});let l=r,s=0;for(;l<n;){for(let g=0;g<t;g++){const v=i[l++];xy[s+g]=v,xy[s+g+t]=B$(v)}s+=t*2}return xy.subarray(0,o*t*2)}function C$(i){let e=null,t=!1;for(const r of i)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const E$=Math.PI/180,S$=by(),sM=[0,0,0],T$={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function I$(i){let{width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:o,padding:l,near:s,far:g}=i;const v=e/t,T=r?new Sn().orthographic({fovy:n,aspect:v,focalDistance:o,near:s,far:g}):new Sn().perspective({fovy:n,aspect:v,near:s,far:g});if(l){const{left:F=0,right:R=0,top:U=0,bottom:J=0}=l,te=SA((F+e-R)/2,0,e)-e/2,Ae=SA((U+t-J)/2,0,t)-t/2;T[8]-=te*2/e,T[9]+=Ae*2/t}return T}class sg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"x",void 0),ye(this,"y",void 0),ye(this,"width",void 0),ye(this,"height",void 0),ye(this,"padding",void 0),ye(this,"isGeospatial",void 0),ye(this,"zoom",void 0),ye(this,"focalDistance",void 0),ye(this,"position",void 0),ye(this,"modelMatrix",void 0),ye(this,"distanceScales",void 0),ye(this,"scale",void 0),ye(this,"center",void 0),ye(this,"cameraPosition",void 0),ye(this,"projectionMatrix",void 0),ye(this,"viewMatrix",void 0),ye(this,"viewMatrixUncentered",void 0),ye(this,"viewMatrixInverse",void 0),ye(this,"viewProjectionMatrix",void 0),ye(this,"pixelProjectionMatrix",void 0),ye(this,"pixelUnprojectionMatrix",void 0),ye(this,"resolution",void 0),ye(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||T$,this.focalDistance=e.focalDistance||1,this.position=e.position||sM,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Uh.WEB_MERCATOR:Uh.WEB_MERCATOR_AUTO_OFFSET:Uh.IDENTITY}equals(e){return e instanceof sg?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&th(e.projectionMatrix,this.projectionMatrix)&&th(e.viewMatrix,this.viewMatrix):!1}project(e){let{topLeft:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.projectPosition(e),n=YL(r,this.pixelProjectionMatrix),[o,l]=n,s=t?l:this.height-l;return e.length===2?[o,s]:[o,s,n[2]]}unproject(e){let{topLeft:t=!0,targetZ:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[n,o,l]=e,s=t?o:this.height-o,g=r&&r*this.distanceScales.unitsPerMeter[2],v=Q2([n,s,l],this.pixelUnprojectionMatrix,g),[T,F,R]=this.unprojectPosition(v);return Number.isFinite(l)?[T,F,R]:Number.isFinite(r)?[T,F,r]:[T,F]}projectPosition(e){const[t,r]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,n]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,n]}projectFlat(e){if(this.isGeospatial){const t=_y(e);return t[1]=SA(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?rg(e):e}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},r=this.unproject([0,0],t),n=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(r[0],n[0],o[0],l[0]),Math.min(r[1],n[1],o[1],l[1]),Math.max(r[0],n[0],o[0],l[0]),Math.max(r[1],n[1],o[1],l[1])]}getDistanceScales(e){return e?z2({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:r,width:n=1,height:o=1}=e;return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,w$(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=i$({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||z2({latitude:r,longitude:t}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:o,modelMatrix:l}=e;let s=sM;if(o&&(s=l?new Sn(l).transformAsVector(o,[]):o),this.isGeospatial){const g=this.projectPosition([t,r,0]);this.center=new Ut(s).scale(this.distanceScales.unitsPerMeter).add(g)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:t=S$,projectionMatrix:r=null,orthographic:n=!1,fovyRadians:o,fovy:l=75,near:s=.1,far:g=1e3,padding:v=null,focalDistance:T=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Sn().multiplyRight(t).translate(new Ut(this.center).negate()),this.projectionMatrix=r||I$({width:this.width,height:this.height,orthographic:n,fovyRadians:o||l*E$,focalDistance:T,padding:v,near:s,far:g});const F=by();vf(F,F,this.projectionMatrix),vf(F,F,this.viewMatrix),this.viewProjectionMatrix=F,this.viewMatrixInverse=E2([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=x$(this.viewMatrixInverse);const R=by(),U=by();S2(R,R,[this.width/2,-this.height/2,1]),h1(R,R,[1,-1,0]),vf(U,R,this.viewProjectionMatrix),this.pixelProjectionMatrix=U,this.pixelUnprojectionMatrix=E2(by(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||On.warn("Pixel project matrix not invertible")()}}ye(sg,"displayName","Viewport");class bf extends sg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:t=0,longitude:r=0,zoom:n=0,pitch:o=0,bearing:l=0,nearZMultiplier:s=.1,farZMultiplier:g=1.01,nearZ:v,farZ:T,orthographic:F=!1,projectionMatrix:R,repeat:U=!1,worldOffset:J=0,position:te,padding:Ae,legacyMeterSizes:he=!1}=e;let{width:pe,height:be,altitude:Te=1.5}=e;const qe=Math.pow(2,n);pe=pe||1,be=be||1;let je,We=null;if(R)Te=R[5]/2,je=_1(Te);else{e.fovy?(je=e.fovy,Te=JL(je)):je=_1(Te);let at;if(Ae){const{top:nt=0,bottom:ke=0}=Ae;at=[0,SA((nt+be-ke)/2,0,be)-be/2]}We=n$({width:pe,height:be,scale:qe,center:te&&[0,0,te[2]*y1(t)],offset:at,pitch:o,fovy:je,nearZMultiplier:s,farZMultiplier:g}),Number.isFinite(v)&&(We.near=v),Number.isFinite(T)&&(We.far=T)}let Ne=r$({height:be,pitch:o,bearing:l,scale:qe,altitude:Te});J&&(Ne=new Sn().translate([512*J,0,0]).multiplyLeft(Ne)),super({...e,width:pe,height:be,viewMatrix:Ne,longitude:r,latitude:t,zoom:n,...We,fovy:je,focalDistance:Te}),ye(this,"longitude",void 0),ye(this,"latitude",void 0),ye(this,"pitch",void 0),ye(this,"bearing",void 0),ye(this,"altitude",void 0),ye(this,"fovy",void 0),ye(this,"orthographic",void 0),ye(this,"_subViewports",void 0),ye(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=r,this.zoom=n,this.pitch=o,this.bearing=l,this.altitude=Te,this.fovy=je,this.orthographic=F,this._subViewports=U?[]:null,this._pseudoMeters=he,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let n=t;n<=r;n++){const o=n?new bf({...this,worldOffset:n}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),n=(e[2]||0)*y1(e[1]);return[t,r,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),n=(e[2]||0)/y1(r);return[t,r,n]}addMetersToLngLat(e,t){return XL(e,t)}panByPosition(e,t){const r=Q2(t,this.pixelUnprojectionMatrix),n=this.projectFlat(e),o=lL([],n,RG([],r)),l=lL([],this.center,o),[s,g]=this.unprojectFlat(l);return{longitude:s,latitude:g}}getBounds(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=a$(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:r,height:n}=this,{longitude:o,latitude:l,zoom:s}=s$({width:r,height:n,bounds:e,...t});return new bf({width:r,height:n,longitude:o,latitude:l,zoom:s})}}ye(bf,"displayName","WebMercatorViewport");const oM=[0,0,0];function j2(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=e.projectPosition(i);if(t&&e instanceof bf){const[n,o,l=0]=i,s=e.getDistanceScales([n,o]);r[2]=l*s.unitsPerMeter[2]}return r}function L$(i){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=i;let{coordinateSystem:n,fromCoordinateSystem:o,fromCoordinateOrigin:l}=i;return n===Mn.DEFAULT&&(n=e.isGeospatial?Mn.LNGLAT:Mn.CARTESIAN),o===void 0&&(o=n),l===void 0&&(l=r),{viewport:e,coordinateSystem:n,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:l}}function aM(i,e){let{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:o,offsetMode:l}=e,[s,g,v=0]=i;switch(r&&([s,g,v]=dy([],[s,g,v,1],r)),n){case Mn.LNGLAT:return j2([s,g,v],t,l);case Mn.LNGLAT_OFFSETS:return j2([s+o[0],g+o[1],v+(o[2]||0)],t,l);case Mn.METER_OFFSETS:return j2(XL(o,[s,g,v]),t,l);case Mn.CARTESIAN:default:return t.isGeospatial?[s+o[0],g+o[1],v+o[2]]:t.projectPosition([s,g,v])}}function M$(i,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:n,modelMatrix:o,fromCoordinateSystem:l,fromCoordinateOrigin:s}=L$(e),{autoOffset:g=!0}=e,{geospatialOrigin:v=oM,shaderCoordinateOrigin:T=oM,offsetMode:F=!1}=g?KL(t,r,n):{},R=aM(i,{viewport:t,modelMatrix:o,coordinateSystem:l,coordinateOrigin:s,offsetMode:F});if(F){const U=t.projectPosition(v||T);$G(R,R,U)}return R}const lM={blendFunc:[1,0,32771,0],blendEquation:32774};class cM extends R2{constructor(){super(...arguments),ye(this,"pickZ",void 0),ye(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:l,pickingFBO:s,deviceRect:{x:g,y:v,width:T,height:F},cullRect:R,effects:U,pass:J="picking",pickZ:te,moduleParameters:Ae}=e;const he=this.gl;this.pickZ=te;const pe=this._resetColorEncoder(te),be=Yu(he,{scissorTest:!0,scissor:[g,v,T,F],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...lM,blend:!te},()=>super.render({target:s,layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:l,cullRect:R,effects:U==null?void 0:U.filter(qe=>qe.useInPicking),pass:J,isPicking:!0,moduleParameters:Ae}));return this._colorEncoderState=null,{decodePickingColor:pe&&F$.bind(null,pe),stats:be}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,r){const n={...e.props.parameters},{pickable:o,operation:l}=e.props;return this._colorEncoderState?o&&l.includes("draw")&&(Object.assign(n,lM),n.blend=!0,n.blendColor=P$(this._colorEncoderState,e,r)):n.blend=!1,l.includes("terrain")&&(n.blend=!1),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function P$(i,e,t){const{byLayer:r,byAlpha:n}=i;let o,l=r.get(e);return l?(l.viewports.push(t),o=l.a):(o=r.size+1,o<=255?(l={a:o,layer:e,viewports:[t]},r.set(e,l),n[o]=l):(On.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function F$(i,e){const t=i.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const og={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},v1=Symbol.for("component"),cd=Symbol.for("propTypes"),q2=Symbol.for("deprecatedProps"),ag=Symbol.for("asyncPropDefaults"),xf=Symbol.for("asyncPropOriginal"),ud=Symbol.for("asyncPropResolved");function b1(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(i)?uM(i,e,[]):e(i)?[i]:[]}function uM(i,e,t){let r=-1;for(;++r<i.length;){const n=i[r];Array.isArray(n)?uM(n,e,t):e(n)&&t.push(n)}return t}function D$(i){let{target:e,source:t,start:r=0,count:n=1}=i;const o=t.length,l=n*o;let s=0;for(let g=r;s<o;s++)e[g++]=t[s];for(;s<l;)s<l-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+l-s),s=l);return e}class R${constructor(e,t,r){ye(this,"id",void 0),ye(this,"context",void 0),ye(this,"isLoaded",void 0),ye(this,"persistent",void 0),ye(this,"_loadCount",0),ye(this,"_subscribers",new Set),ye(this,"_data",void 0),ye(this,"_loader",void 0),ye(this,"_error",void 0),ye(this,"_content",void 0),this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let n=e;typeof e=="string"&&(n=rd(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class k${constructor(e){let{gl:t,protocol:r}=e;ye(this,"protocol",void 0),ye(this,"_context",void 0),ye(this,"_resources",void 0),ye(this,"_consumers",void 0),ye(this,"_pruneRequest",void 0),this.protocol=r||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add(e){let{resourceId:t,data:r,forceUpdate:n=!1,persistent:o=!0}=e,l=this._resources[t];l?l.setData(r,n):(l=new R$(t,r,this._context),this._resources[t]=l),l.persistent=o}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const r=this._consumers[t];if(r){for(const n in r){const o=r[n],l=this._resources[o.resourceId];l&&l.unsubscribe(o)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:r,consumerId:n,requestId:o="default"}=e;const{_resources:l,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),l[t]||this.add({resourceId:t,data:null,persistent:!1}));const g=l[t];if(this._track(n,o,g,r),g)return g.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,n){const o=this._consumers,l=o[e]=o[e]||{},s=l[t]||{},g=s.resourceId&&this._resources[s.resourceId];g&&(g.unsubscribe(s),this.prune()),r&&(l[t]=s,s.onChange=n,s.resourceId=r.id,r.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const $2={name:"project32",dependencies:[k2],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},K2={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...Xj},O$=[k2],U$=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function N$(i){const e=gy.getDefaultProgramManager(i);for(const t of O$)e.addDefaultModule(t);for(const t of U$)e.addShaderHook(t);return e}const z$="layerManager.setLayers",Q$="layerManager.activateViewport";class V${constructor(e){let{deck:t,stats:r,viewport:n,timeline:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ye(this,"layers",void 0),ye(this,"context",void 0),ye(this,"resourceManager",void 0),ye(this,"_lastRenderedLayers",[]),ye(this,"_needsRedraw",!1),ye(this,"_needsUpdate",!1),ye(this,"_nextLayers",null),ye(this,"_debug",!1),ye(this,"activateViewport",l=>{Sl(Q$,this,l),l&&(this.context.viewport=l)}),this.layers=[],this.resourceManager=new k$({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&N$(e),stats:r||new Ww({id:"deck.gl"}),viewport:n||new sg({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new NL,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const n=r.getNeedsRedraw(e);t=t||n}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Sl(z$,this,t,e),this._lastRenderedLayers=e;const r=b1(e,Boolean);for(const n of r)n.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,r){r.raiseError(t,"".concat(e," of ").concat(r))}_updateLayers(e,t){const r={};for(const l of e)r[l.id]?On.warn("Multiple old layers with same id ".concat(l.id))():r[l.id]=l;const n=[];this._updateSublayersRecursively(t,r,n),this._finalizeOldLayers(r);let o=!1;for(const l of n)if(l.hasUniformTransition()){o="Uniform transition in ".concat(l);break}this._needsUpdate=o,this.layers=n}_updateSublayersRecursively(e,t,r){for(const n of e){n.context=this.context;const o=t[n.id];o===null&&On.warn("Multiple new layers with same id ".concat(n.id))(),t[n.id]=null;let l=null;try{this._debug&&o!==n&&n.validateProps(),o?(this._transferLayerState(o,n),this._updateLayer(n)):this._initializeLayer(n),r.push(n),l=n.isComposite?n.getSubLayers():null}catch(s){this._handleError("matching",s,n)}l&&this._updateSublayersRecursively(l,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=og.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=og.MATCHED,t!==e&&(e.lifecycle=og.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=og.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=og.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function zh(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!zh(i[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const r=Object.keys(i),n=Object.keys(e);if(r.length!==n.length)return!1;for(const o of r)if(!e.hasOwnProperty(o)||!zh(i[o],e[o],t-1))return!1;return!0}return!1}class H${constructor(e){ye(this,"width",void 0),ye(this,"height",void 0),ye(this,"views",void 0),ye(this,"viewState",void 0),ye(this,"controllers",void 0),ye(this,"timeline",void 0),ye(this,"_viewports",void 0),ye(this,"_viewportMap",void 0),ye(this,"_isUpdating",void 0),ye(this,"_needsRedraw",void 0),ye(this,"_needsUpdate",void 0),ye(this,"_eventManager",void 0),ye(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),n={x:e[0],y:e[1]};for(let o=r.length-1;o>=0;--o){const l=r[o];if(l.containsPixel(n)){const s=e.slice();return s[0]-=l.x,s[1]-=l.y,l.unproject(s,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=b1(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!zh(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):On.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var l;return(l=this.getView(e.id))===null||l===void 0?void 0:l.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,r,n){const o=e.controller;if(o&&r){const l={...t,...o,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!n||n.constructor!==o.type)&&(n=this._createController(e,l)),n&&n.setProps(l),n}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let n=e.length;n--;){const o=e[n],l=this.getViewState(o),s=o.makeViewport({viewState:l,width:this.width,height:this.height});let g=t[o.id];const v=!!o.controller;v&&!g&&(r=!0),(r||!v)&&g&&(g.finalize(),g=null),this.controllers[o.id]=this._updateController(o,l,s,g),s&&this._viewports.unshift(s)}for(const n in t){const o=t[n];o&&!this.controllers[n]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,n)=>!e[n].equals(t[n]))}}const G$=/([0-9]+\.?[0-9]*)(%|px)/;function hd(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const e=G$.exec(i);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error("Could not parse position string ".concat(i))}}function Ad(i,e){return i.relative?Math.round(i.position*e):i.position}function sl(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}class j${constructor(e){ye(this,"id",void 0),ye(this,"viewportInstance",void 0),ye(this,"_x",void 0),ye(this,"_y",void 0),ye(this,"_width",void 0),ye(this,"_height",void 0),ye(this,"_padding",void 0),ye(this,"props",void 0);const{id:t,x:r=0,y:n=0,width:o="100%",height:l="100%",padding:s=null,viewportInstance:g}=e||{};sl(!g||g instanceof sg),this.viewportInstance=g,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=hd(r),this._y=hd(n),this._width=hd(o),this._height=hd(l),this._padding=s&&{left:hd(s.left||0),right:hd(s.right||0),top:hd(s.top||0),bottom:hd(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&zh(this.props,e.props,2)}makeViewport(e){let{width:t,height:r,viewState:n}=e;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const o=this.getDimensions({width:t,height:r});return!o.height||!o.width?null:new this.ViewportType({...n,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions(e){let{width:t,height:r}=e;const n={x:Ad(this._x,t),y:Ad(this._y,r),width:Ad(this._width,t),height:Ad(this._height,r)};return this._padding&&(n.padding={left:Ad(this._padding.left,t),top:Ad(this._padding.top,r),right:Ad(this._padding.right,t),bottom:Ad(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class wy{constructor(e){ye(this,"_inProgress",void 0),ye(this,"_handle",void 0),ye(this,"_timeline",void 0),ye(this,"time",void 0),ye(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(t=(r=this.settings).onStart)===null||t===void 0||t.call(r,this)}end(){if(this._inProgress){var e,t;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)===null||e===void 0||e.call(t,this)}}cancel(){if(this._inProgress){var e,t;(e=(t=this.settings).onInterrupt)===null||e===void 0||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:n}=this;this._handle=r.addChannel({delay:r.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)===null||e===void 0||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const hM=()=>{},W2={BREAK:1,SNAP_TO_END:2,IGNORE:3},q$=i=>i,$$=W2.BREAK;class K${constructor(e){ye(this,"getControllerState",void 0),ye(this,"props",void 0),ye(this,"propsInTransition",void 0),ye(this,"transition",void 0),ye(this,"onViewStateChange",void 0),ye(this,"onStateChange",void 0),ye(this,"_onTransitionUpdate",t=>{const{time:r,settings:{interpolator:n,startProps:o,endProps:l,duration:s,easing:g}}=t,v=g(r/s),T=n.interpolateProps(o,l,v);this.propsInTransition=this.getControllerState({...this.props,...T}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new wy(e.timeline),this.onViewStateChange=e.onViewStateChange||hM,this.onStateChange=e.onStateChange||hM}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let n=r;if(this.transition.inProgress){const{interruption:o,endProps:l}=this.transition.settings;n={...r,...o===W2.SNAP_TO_END?l:this.propsInTransition||r}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===W2.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(r),o=t.transitionInterpolator,l=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(l===0)return;const s=o.initializeProps(e,n);this.propsInTransition={};const g={duration:l,easing:t.transitionEasing||q$,interpolator:o,interruption:t.transitionInterruption||$$,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(g),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}class W${constructor(e){ye(this,"_propsToCompare",void 0),ye(this,"_propsToExtract",void 0),ye(this,"_requiredProps",void 0);const{compare:t,extract:r,required:n}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=n}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!th(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},n={};for(const o of this._propsToExtract)(o in e||o in t)&&(r[o]=e[o],n[o]=t[o]);return this._checkRequiredProps(r),this._checkRequiredProps(n),{start:r,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];sl(Number.isFinite(r)||Array.isArray(r),"".concat(t," is required for transition"))})}}const Z$=["longitude","latitude","zoom","bearing","pitch"],X$=["longitude","latitude","zoom"];class AM extends W${constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Z$,required:X$},super(r.transitionProps),ye(this,"opts",void 0),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:n,around:o}=this.opts;if(n&&o){const l=n(e),s=n(t),g=l.unproject(o);r.start.around=o,Object.assign(r.end,{around:s.project(g),aroundPosition:g,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const n={};for(const o of this._propsToExtract)n[o]=s1(e[o]||0,t[o]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...n});Object.assign(n,o.panByPosition(t.aroundPosition,s1(e.around,t.around,r)))}return n}}const dd={transitionDuration:0},J$=300,x1=i=>1-(1-i)*(1-i),lg={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},wf={};class Y${constructor(e){ye(this,"props",void 0),ye(this,"state",{}),ye(this,"transitionManager",void 0),ye(this,"eventManager",void 0),ye(this,"onViewStateChange",void 0),ye(this,"onStateChange",void 0),ye(this,"makeViewport",void 0),ye(this,"_controllerState",void 0),ye(this,"_events",{}),ye(this,"_interactionState",{isDragging:!1}),ye(this,"_customEvents",[]),ye(this,"_eventStartBlocked",null),ye(this,"_panMove",!1),ye(this,"invertPan",!1),ye(this,"dragMode","rotate"),ye(this,"inertia",0),ye(this,"scrollZoom",!0),ye(this,"dragPan",!0),ye(this,"dragRotate",!0),ye(this,"doubleClickZoom",!0),ye(this,"touchZoom",!0),ye(this,"touchRotate",!1),ye(this,"keyboard",!0),this.transitionManager=new K$({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)if(this._events[t]){var e;(e=this.eventManager)===null||e===void 0||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:n}=e;return[n.x-t,n.y-r]}isPointInBounds(e,t){const{width:r,height:n}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=n;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?J$:0;const{scrollZoom:r=!0,dragPan:n=!0,dragRotate:o=!0,doubleClickZoom:l=!0,touchZoom:s=!0,touchRotate:g=!1,keyboard:v=!0}=e,T=!!this.onViewStateChange;this.toggleEvents(lg.WHEEL,T&&r),this.toggleEvents(lg.PAN,T),this.toggleEvents(lg.PINCH,T&&(s||g)),this.toggleEvents(lg.TRIPLE_PAN,T&&g),this.toggleEvents(lg.DOUBLE_TAP,T&&l),this.toggleEvents(lg.KEYBOARD,T&&v),this.scrollZoom=r,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=l,this.touchZoom=s,this.touchRotate=g,this.keyboard=v}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),o){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:l})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const n=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(n,dd,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,dd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:x1},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,dd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:x1},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let l=2/(1+Math.exp(-Math.abs(o*r)));o<0&&l!==0&&(l=1/l);const s=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(s,{...this._getTransitionProps({around:t}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,dd,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,dd,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),n=[r[0],r[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:n});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:x1},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return wf._startPinchRotation=e.rotation,wf._lastPinchEvent=e,this.updateViewport(r,dd,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,n=this.getCenter(e);t=t.zoom({pos:n,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:wf._startPinchRotation-r})}return this.updateViewport(t,dd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),wf._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=wf;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const n=this.getCenter(e);let o=this.controllerState.rotateEnd();const l=Math.log2(e.scale),s=(l-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),g=Math.pow(2,l+s*t/2);o=o.zoom({pos:n,scale:g}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:t,transitionEasing:x1},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return wf._startPinchRotation=null,wf._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(n,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:n,rotateSpeedX:o,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let g;const v={};switch(e.srcEvent.code){case"Minus":g=t?s.zoomOut(r).zoomOut(r):s.zoomOut(r),v.isZooming=!0;break;case"Equal":g=t?s.zoomIn(r).zoomIn(r):s.zoomIn(r),v.isZooming=!0;break;case"ArrowLeft":t?(g=s.rotateLeft(o),v.isRotating=!0):(g=s.moveLeft(n),v.isPanning=!0);break;case"ArrowRight":t?(g=s.rotateRight(o),v.isRotating=!0):(g=s.moveRight(n),v.isPanning=!0);break;case"ArrowUp":t?(g=s.rotateUp(l),v.isRotating=!0):(g=s.moveUp(n),v.isPanning=!0);break;case"ArrowDown":t?(g=s.rotateDown(l),v.isRotating=!0):(g=s.moveDown(n),v.isPanning=!0);break;default:return!1}return this.updateViewport(g,this._getTransitionProps(),v),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?dd:e?{...t,transitionInterpolator:new AM({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class eK{constructor(e,t){ye(this,"_viewportProps",void 0),ye(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const dM=5,tK=1.2;class iK extends eK{constructor(e){const{width:t,height:r,latitude:n,longitude:o,zoom:l,bearing:s=0,pitch:g=0,altitude:v=1.5,position:T=[0,0,0],maxZoom:F=20,minZoom:R=0,maxPitch:U=60,minPitch:J=0,startPanLngLat:te,startZoomLngLat:Ae,startRotatePos:he,startBearing:pe,startPitch:be,startZoom:Te,normalize:qe=!0}=e;sl(Number.isFinite(o)),sl(Number.isFinite(n)),sl(Number.isFinite(l)),super({width:t,height:r,latitude:n,longitude:o,zoom:l,bearing:s,pitch:g,altitude:v,maxZoom:F,minZoom:R,maxPitch:U,minPitch:J,normalize:qe,position:T},{startPanLngLat:te,startZoomLngLat:Ae,startRotatePos:he,startBearing:pe,startPitch:be,startZoom:Te}),ye(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:r}=e;const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:r=0,deltaAngleY:n=0}=e;const{startRotatePos:o,startBearing:l,startPitch:s}=this.getState();if(!o||l===void 0||s===void 0)return this;let g;return t?g=this._getNewRotation(t,o,s,l):g={bearing:l+r,pitch:s+n},this._getUpdatedState(g)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:r,scale:n}=e,{startZoom:o,startZoomLngLat:l}=this.getState();if(l||(o=this.getViewportProps().zoom,l=this._unproject(r)||this._unproject(t)),!l)return this;const{maxZoom:s,minZoom:g}=this.getViewportProps();let v=o+Math.log2(n);v=SA(v,g,s);const T=this.makeViewport({...this.getViewportProps(),zoom:v});return this._getUpdatedState({zoom:v,...T.panByPosition(l,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:n,longitude:o}=r;return Math.abs(n-t.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(o-t.longitude)>180&&(r.longitude=o<0?o+360:o-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:n}=e;e.zoom=SA(n,r,t);const{maxPitch:o,minPitch:l,pitch:s}=e;e.pitch=SA(s,l,o);const{normalize:g=!0}=e;return g&&Object.assign(e,l$(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,n){const o=e[0]-t[0],l=e[1]-t[1],s=e[1],g=t[1],{width:v,height:T}=this.getViewportProps(),F=o/v;let R=0;l>0?Math.abs(T-g)>dM&&(R=l/(g-T)*tK):l<0&&g>dM&&(R=1-s/g),R=SA(R,-1,1);const{minPitch:U,maxPitch:J}=this.getViewportProps(),te=n+180*F;let Ae=r;return R>0?Ae=r+R*(J-r):R<0&&(Ae=r-R*(U-r)),{pitch:Ae,bearing:te}}}class rK extends Y${constructor(){super(...arguments),ye(this,"ControllerState",iK),ye(this,"transition",{transitionDuration:300,transitionInterpolator:new AM({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),ye(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Z2 extends j${get ViewportType(){return bf}get ControllerType(){return rK}}ye(Z2,"displayName","MapView");const nK=new H2;function sK(i,e){var t,r;const n=(t=i.order)!==null&&t!==void 0?t:1/0,o=(r=e.order)!==null&&r!==void 0?r:1/0;return n-o}class oK{constructor(){ye(this,"effects",void 0),ye(this,"_resolvedEffects",[]),ye(this,"_defaultEffects",[]),ye(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(n=>sK(n,e)>0);r<0?t.push(e):t.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(zh(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const n of this.effects)t[n.id]=n;const r=[];for(const n of e){const o=t[n.id];o&&o!==n?o.setProps?(o.setProps(n.props),r.push(o)):(o.cleanup(),r.push(n)):r.push(n),delete t[n.id]}for(const n in t)t[n].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(n=>n instanceof H2)||this._resolvedEffects.push(nK),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class aK extends R2{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const lK="deckRenderer.renderLayers";class cK{constructor(e){ye(this,"gl",void 0),ye(this,"layerFilter",void 0),ye(this,"drawPickingColors",void 0),ye(this,"drawLayersPass",void 0),ye(this,"pickLayersPass",void 0),ye(this,"renderCount",void 0),ye(this,"_needsRedraw",void 0),ye(this,"renderBuffers",void 0),ye(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new aK(e),this.pickLayersPass=new cM(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||ba.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const n=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,o=t.render({...r,target:n});r.effects&&this._postRender(r.effects,r),this.renderCount++,Sl(lK,this,o,e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(this.gl,t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new ba(this.gl),new ba(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:r}=this,n={...t,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const o of e)if(o.postRender){if(o.id===this.lastPostProcessEffect){n.target=t.target,o.postRender(this.gl,n);break}const l=o.postRender(this.gl,n);n.inputBuffer=l,n.swapBuffer=l===r[0]?r[1]:r[0]}}}const uK={pickedColor:null,pickedObjectIndex:-1};function hK(i){let{pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:o,deviceRect:l}=i;const{x:s,y:g,width:v,height:T}=l;let F=o*o,R=-1,U=0;for(let J=0;J<T;J++){const te=J+g-n,Ae=te*te;if(Ae>F)U+=4*v;else for(let he=0;he<v;he++){if(e[U+3]-1>=0){const be=he+s-r,Te=be*be+Ae;Te<=F&&(F=Te,R=U)}U+=4}}if(R>=0){const J=e.slice(R,R+4),te=t(J);if(te){const Ae=Math.floor(R/4/v),he=R/4-Ae*v;return{...te,pickedColor:J,pickedX:s+he,pickedY:g+Ae}}On.error("Picked non-existent layer. Is picking buffer corrupt?")()}return uK}function AK(i){let{pickedColors:e,decodePickingColor:t}=i;const r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){const l=e.slice(n,n+4),s=l.join(",");if(!r.has(s)){const g=t(l);g?r.set(s,{...g,color:l}):On.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function fM(i){let{pickInfo:e,viewports:t,pixelRatio:r,x:n,y:o,z:l}=i,s=t[0];t.length>1&&(s=fK((e==null?void 0:e.pickedViewports)||t,{x:n,y:o}));let g;if(s){const v=[n-s.x,o-s.y];l!==void 0&&(v[2]=l),g=s.unproject(v)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:o,pixel:[n,o],coordinate:g,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function dK(i){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:n}=i,{pickedColor:o,pickedLayer:l,pickedObjectIndex:s}=e,g=l?[l]:[];if(r==="hover"){const F=t.index,R=t.layerId,U=l?l.props.id:null;if(U!==R||s!==F){if(U!==R){const J=n.find(te=>te.props.id===R);J&&g.unshift(J)}t.layerId=U,t.index=s,t.info=null}}const v=fM(i),T=new Map;return T.set(null,v),g.forEach(F=>{let R={...v};F===l&&(R.color=o,R.index=s,R.picked=!0),R=pM({layer:F,info:R,mode:r});const U=R.layer;F===l&&r==="hover"&&(t.info=R),T.set(U.id,R),r==="hover"&&U.updateAutoHighlight(R)}),T}function pM(i){let{layer:e,info:t,mode:r}=i;for(;e&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function fK(i,e){for(let t=i.length-1;t>=0;t--){const r=i[t];if(r.containsPixel(e))return r}return i[0]}class pK{constructor(e){ye(this,"gl",void 0),ye(this,"pickingFBO",void 0),ye(this,"depthFBO",void 0),ye(this,"pickLayersPass",void 0),ye(this,"layerFilter",void 0),ye(this,"lastPickedInfo",void 0),ye(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new cM(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:t,y:r,layers:n,viewports:o}=e,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const s=l&&l.layer&&l.layer.id,g=l&&l.viewport&&l.viewport.id,v=s?n.find(U=>U.id===s):null,T=g&&o.find(U=>U.id===g)||o[0],F=T&&T.unproject([t-T.x,r-T.y]);return{...l,...{x:t,y:r,viewport:T,coordinate:F,layer:v}}}_resizeBuffer(){var e,t;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new ba(r),ba.isSupported(r,{colorBufferFloat:!0}))){const n=new ba(r);n.attach({36064:new Yc(r,{format:dn(r)?34836:6408,type:5126})}),this.depthFBO=n}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(t=this.depthFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject(e){let{layers:t,views:r,viewports:n,x:o,y:l,radius:s=0,depth:g=1,mode:v="query",unproject3D:T,onViewportActive:F,effects:R}=e;const U=this._getPickable(t),J=$p(this.gl);if(!U)return{result:[],emptyInfo:fM({viewports:n,x:o,y:l,pixelRatio:J})};this._resizeBuffer();const te=qw(this.gl,[o,l],!0),Ae=[te.x+Math.floor(te.width/2),te.y+Math.floor(te.height/2)],he=Math.round(s*J),{width:pe,height:be}=this.pickingFBO,Te=this._getPickingRect({deviceX:Ae[0],deviceY:Ae[1],deviceRadius:he,deviceWidth:pe,deviceHeight:be}),qe={x:o-s,y:l-s,width:s*2+1,height:s*2+1};let je;const We=[],Ne=new Set;for(let at=0;at<g;at++){let nt;if(Te){const De=this._drawAndSample({layers:U,views:r,viewports:n,onViewportActive:F,deviceRect:Te,cullRect:qe,effects:R,pass:"picking:".concat(v)});nt=hK({...De,deviceX:Ae[0],deviceY:Ae[1],deviceRadius:he,deviceRect:Te})}else nt={pickedColor:null,pickedObjectIndex:-1};let ke;if(nt.pickedLayer&&T&&this.depthFBO){const{pickedColors:De}=this._drawAndSample({layers:[nt.pickedLayer],views:r,viewports:n,onViewportActive:F,deviceRect:{x:nt.pickedX,y:nt.pickedY,width:1,height:1},cullRect:qe,effects:R,pass:"picking:".concat(v,":z")},!0);De[3]&&(ke=De[0])}nt.pickedLayer&&at+1<g&&(Ne.add(nt.pickedLayer),nt.pickedLayer.disablePickingIndex(nt.pickedObjectIndex)),je=dK({pickInfo:nt,lastPickedInfo:this.lastPickedInfo,mode:v,layers:U,viewports:n,x:o,y:l,z:ke,pixelRatio:J});for(const De of je.values())De.layer&&We.push(De);if(!nt.pickedColor)break}for(const at of Ne)at.restorePickingColors();return{result:We,emptyInfo:je.get(null)}}_pickVisibleObjects(e){let{layers:t,views:r,viewports:n,x:o,y:l,width:s=1,height:g=1,mode:v="query",maxObjects:T=null,onViewportActive:F,effects:R}=e;const U=this._getPickable(t);if(!U)return[];this._resizeBuffer();const J=$p(this.gl),te=qw(this.gl,[o,l],!0),Ae=te.x,he=te.y+te.height,pe=qw(this.gl,[o+s,l+g],!0),be=pe.x+pe.width,Te=pe.y,qe={x:Ae,y:Te,width:be-Ae,height:he-Te},je=this._drawAndSample({layers:U,views:r,viewports:n,onViewportActive:F,deviceRect:qe,cullRect:{x:o,y:l,width:s,height:g},effects:R,pass:"picking:".concat(v)}),We=AK(je),Ne=new Map,at=Number.isFinite(T);for(let ke=0;ke<We.length;ke++){var nt;if(at&&T&&Ne.size>=T)break;const De=We[ke];let Ye={color:De.pickedColor,layer:null,index:De.pickedObjectIndex,picked:!0,x:o,y:l,pixelRatio:J};Ye=pM({layer:De.pickedLayer,info:Ye,mode:v});const Ze=(nt=Ye.object)!==null&&nt!==void 0?nt:"".concat(Ye.layer.id,"[").concat(Ye.index,"]");Ne.has(Ze)||Ne.set(Ze,Ye)}return Array.from(Ne.values())}_drawAndSample(e){let{layers:t,views:r,viewports:n,onViewportActive:o,deviceRect:l,cullRect:s,effects:g,pass:v}=e,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const F=T?this.depthFBO:this.pickingFBO,R={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:o,pickingFBO:F,deviceRect:l,cullRect:s,effects:g,pass:v,pickZ:T,preRenderStats:{}};for(const be of g)be.useInPicking&&(R.preRenderStats[be.id]=be.preRender(this.gl,R));const{decodePickingColor:U}=this.pickLayersPass.render(R),{x:J,y:te,width:Ae,height:he}=l,pe=new(T?Float32Array:Uint8Array)(Ae*he*4);return W_(F,{sourceX:J,sourceY:te,sourceWidth:Ae,sourceHeight:he,target:pe}),{pickedColors:pe,decodePickingColor:U}}_getPickingRect(e){let{deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:o,deviceHeight:l}=e;const s=Math.max(0,t-n),g=Math.max(0,r-n),v=Math.min(o,t+n+1)-s,T=Math.min(l,r+n+1)-g;return v<=0||T<=0?null:{x:s,y:g,width:v,height:T}}}const gK={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class mK{constructor(e){ye(this,"el",null),ye(this,"isVisible",!1);const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,gK),t.appendChild(this.el))}setTooltip(e,t,r){const n=this.el;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform="translate(".concat(t,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var gM={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(i){(function(e,t,r,n){var o=["","webkit","Moz","MS","ms","o"],l=t.createElement("div"),s="function",g=Math.round,v=Math.abs,T=Date.now;function F(He,Je,gt){return setTimeout(be(He,gt),Je)}function R(He,Je,gt){return Array.isArray(He)?(U(He,gt[Je],gt),!0):!1}function U(He,Je,gt){var Ot;if(He)if(He.forEach)He.forEach(Je,gt);else if(He.length!==n)for(Ot=0;Ot<He.length;)Je.call(gt,He[Ot],Ot,He),Ot++;else for(Ot in He)He.hasOwnProperty(Ot)&&Je.call(gt,He[Ot],Ot,He)}function J(He,Je,gt){var Ot="DEPRECATED METHOD: "+Je+`
`+gt+` AT 
`;return function(){var di=new Error("get-stack-trace"),ji=di&&di.stack?di.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Br=e.console&&(e.console.warn||e.console.log);return Br&&Br.call(e.console,Ot,ji),He.apply(this,arguments)}}var te;typeof Object.assign!="function"?te=function(Je){if(Je===n||Je===null)throw new TypeError("Cannot convert undefined or null to object");for(var gt=Object(Je),Ot=1;Ot<arguments.length;Ot++){var di=arguments[Ot];if(di!==n&&di!==null)for(var ji in di)di.hasOwnProperty(ji)&&(gt[ji]=di[ji])}return gt}:te=Object.assign;var Ae=J(function(Je,gt,Ot){for(var di=Object.keys(gt),ji=0;ji<di.length;)(!Ot||Ot&&Je[di[ji]]===n)&&(Je[di[ji]]=gt[di[ji]]),ji++;return Je},"extend","Use `assign`."),he=J(function(Je,gt){return Ae(Je,gt,!0)},"merge","Use `assign`.");function pe(He,Je,gt){var Ot=Je.prototype,di;di=He.prototype=Object.create(Ot),di.constructor=He,di._super=Ot,gt&&te(di,gt)}function be(He,Je){return function(){return He.apply(Je,arguments)}}function Te(He,Je){return typeof He==s?He.apply(Je&&Je[0]||n,Je):He}function qe(He,Je){return He===n?Je:He}function je(He,Je,gt){U(nt(Je),function(Ot){He.addEventListener(Ot,gt,!1)})}function We(He,Je,gt){U(nt(Je),function(Ot){He.removeEventListener(Ot,gt,!1)})}function Ne(He,Je){for(;He;){if(He==Je)return!0;He=He.parentNode}return!1}function at(He,Je){return He.indexOf(Je)>-1}function nt(He){return He.trim().split(/\s+/g)}function ke(He,Je,gt){if(He.indexOf&&!gt)return He.indexOf(Je);for(var Ot=0;Ot<He.length;){if(gt&&He[Ot][gt]==Je||!gt&&He[Ot]===Je)return Ot;Ot++}return-1}function De(He){return Array.prototype.slice.call(He,0)}function Ye(He,Je,gt){for(var Ot=[],di=[],ji=0;ji<He.length;){var Br=Je?He[ji][Je]:He[ji];ke(di,Br)<0&&Ot.push(He[ji]),di[ji]=Br,ji++}return gt&&(Je?Ot=Ot.sort(function(Gn,ns){return Gn[Je]>ns[Je]}):Ot=Ot.sort()),Ot}function Ze(He,Je){for(var gt,Ot,di=Je[0].toUpperCase()+Je.slice(1),ji=0;ji<o.length;){if(gt=o[ji],Ot=gt?gt+di:Je,Ot in He)return Ot;ji++}return n}var Ct=1;function Et(){return Ct++}function Pt(He){var Je=He.ownerDocument||He;return Je.defaultView||Je.parentWindow||e}var bt=/mobile|tablet|ip(ad|hone|od)|android/i,Rt="ontouchstart"in e,Ft=Ze(e,"PointerEvent")!==n,Xt=Rt&&bt.test(navigator.userAgent),Le="touch",Xe="pen",it="mouse",pt="kinect",mt=25,Bt=1,Dt=2,Mt=4,qt=8,ni=1,_i=2,vi=4,Pi=8,kt=16,lt=_i|vi,wt=Pi|kt,Oi=lt|wt,ti=["x","y"],ht=["clientX","clientY"];function $t(He,Je){var gt=this;this.manager=He,this.callback=Je,this.element=He.element,this.target=He.options.inputTarget,this.domHandler=function(Ot){Te(He.options.enable,[He])&&gt.handler(Ot)},this.init()}$t.prototype={handler:function(){},init:function(){this.evEl&&je(this.element,this.evEl,this.domHandler),this.evTarget&&je(this.target,this.evTarget,this.domHandler),this.evWin&&je(Pt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&We(this.element,this.evEl,this.domHandler),this.evTarget&&We(this.target,this.evTarget,this.domHandler),this.evWin&&We(Pt(this.element),this.evWin,this.domHandler)}};function oi(He){var Je,gt=He.options.inputClass;return gt?Je=gt:Ft?Je=Be:Xt?Je=Fe:Rt?Je=vt:Je=bi,new Je(He,gi)}function gi(He,Je,gt){var Ot=gt.pointers.length,di=gt.changedPointers.length,ji=Je&Bt&&Ot-di===0,Br=Je&(Mt|qt)&&Ot-di===0;gt.isFirst=!!ji,gt.isFinal=!!Br,ji&&(He.session={}),gt.eventType=Je,ci(He,gt),He.emit("hammer.input",gt),He.recognize(gt),He.session.prevInput=gt}function ci(He,Je){var gt=He.session,Ot=Je.pointers,di=Ot.length;gt.firstInput||(gt.firstInput=pr(Je)),di>1&&!gt.firstMultiple?gt.firstMultiple=pr(Je):di===1&&(gt.firstMultiple=!1);var ji=gt.firstInput,Br=gt.firstMultiple,In=Br?Br.center:ji.center,Gn=Je.center=Mr(Ot);Je.timeStamp=T(),Je.deltaTime=Je.timeStamp-ji.timeStamp,Je.angle=Wt(In,Gn),Je.distance=hi(In,Gn),Ki(gt,Je),Je.offsetDirection=Wi(Je.deltaX,Je.deltaY);var ns=zt(Je.deltaTime,Je.deltaX,Je.deltaY);Je.overallVelocityX=ns.x,Je.overallVelocityY=ns.y,Je.overallVelocity=v(ns.x)>v(ns.y)?ns.x:ns.y,Je.scale=Br?Qt(Br.pointers,Ot):1,Je.rotation=Br?Ar(Br.pointers,Ot):0,Je.maxPointers=gt.prevInput?Je.pointers.length>gt.prevInput.maxPointers?Je.pointers.length:gt.prevInput.maxPointers:Je.pointers.length,tr(gt,Je);var _n=He.element;Ne(Je.srcEvent.target,_n)&&(_n=Je.srcEvent.target),Je.target=_n}function Ki(He,Je){var gt=Je.center,Ot=He.offsetDelta||{},di=He.prevDelta||{},ji=He.prevInput||{};(Je.eventType===Bt||ji.eventType===Mt)&&(di=He.prevDelta={x:ji.deltaX||0,y:ji.deltaY||0},Ot=He.offsetDelta={x:gt.x,y:gt.y}),Je.deltaX=di.x+(gt.x-Ot.x),Je.deltaY=di.y+(gt.y-Ot.y)}function tr(He,Je){var gt=He.lastInterval||Je,Ot=Je.timeStamp-gt.timeStamp,di,ji,Br,In;if(Je.eventType!=qt&&(Ot>mt||gt.velocity===n)){var Gn=Je.deltaX-gt.deltaX,ns=Je.deltaY-gt.deltaY,_n=zt(Ot,Gn,ns);ji=_n.x,Br=_n.y,di=v(_n.x)>v(_n.y)?_n.x:_n.y,In=Wi(Gn,ns),He.lastInterval=Je}else di=gt.velocity,ji=gt.velocityX,Br=gt.velocityY,In=gt.direction;Je.velocity=di,Je.velocityX=ji,Je.velocityY=Br,Je.direction=In}function pr(He){for(var Je=[],gt=0;gt<He.pointers.length;)Je[gt]={clientX:g(He.pointers[gt].clientX),clientY:g(He.pointers[gt].clientY)},gt++;return{timeStamp:T(),pointers:Je,center:Mr(Je),deltaX:He.deltaX,deltaY:He.deltaY}}function Mr(He){var Je=He.length;if(Je===1)return{x:g(He[0].clientX),y:g(He[0].clientY)};for(var gt=0,Ot=0,di=0;di<Je;)gt+=He[di].clientX,Ot+=He[di].clientY,di++;return{x:g(gt/Je),y:g(Ot/Je)}}function zt(He,Je,gt){return{x:Je/He||0,y:gt/He||0}}function Wi(He,Je){return He===Je?ni:v(He)>=v(Je)?He<0?_i:vi:Je<0?Pi:kt}function hi(He,Je,gt){gt||(gt=ti);var Ot=Je[gt[0]]-He[gt[0]],di=Je[gt[1]]-He[gt[1]];return Math.sqrt(Ot*Ot+di*di)}function Wt(He,Je,gt){gt||(gt=ti);var Ot=Je[gt[0]]-He[gt[0]],di=Je[gt[1]]-He[gt[1]];return Math.atan2(di,Ot)*180/Math.PI}function Ar(He,Je){return Wt(Je[1],Je[0],ht)+Wt(He[1],He[0],ht)}function Qt(He,Je){return hi(Je[0],Je[1],ht)/hi(He[0],He[1],ht)}var Si={mousedown:Bt,mousemove:Dt,mouseup:Mt},Ii="mousedown",Zt="mousemove mouseup";function bi(){this.evEl=Ii,this.evWin=Zt,this.pressed=!1,$t.apply(this,arguments)}pe(bi,$t,{handler:function(Je){var gt=Si[Je.type];gt&Bt&&Je.button===0&&(this.pressed=!0),gt&Dt&&Je.which!==1&&(gt=Mt),this.pressed&&(gt&Mt&&(this.pressed=!1),this.callback(this.manager,gt,{pointers:[Je],changedPointers:[Je],pointerType:it,srcEvent:Je}))}});var ei={pointerdown:Bt,pointermove:Dt,pointerup:Mt,pointercancel:qt,pointerout:qt},_r={2:Le,3:Xe,4:it,5:pt},Zr="pointerdown",Qe="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Zr="MSPointerDown",Qe="MSPointerMove MSPointerUp MSPointerCancel");function Be(){this.evEl=Zr,this.evWin=Qe,$t.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}pe(Be,$t,{handler:function(Je){var gt=this.store,Ot=!1,di=Je.type.toLowerCase().replace("ms",""),ji=ei[di],Br=_r[Je.pointerType]||Je.pointerType,In=Br==Le,Gn=ke(gt,Je.pointerId,"pointerId");ji&Bt&&(Je.button===0||In)?Gn<0&&(gt.push(Je),Gn=gt.length-1):ji&(Mt|qt)&&(Ot=!0),!(Gn<0)&&(gt[Gn]=Je,this.callback(this.manager,ji,{pointers:gt,changedPointers:[Je],pointerType:Br,srcEvent:Je}),Ot&&gt.splice(Gn,1))}});var ce={touchstart:Bt,touchmove:Dt,touchend:Mt,touchcancel:qt},ie="touchstart",ue="touchstart touchmove touchend touchcancel";function ge(){this.evTarget=ie,this.evWin=ue,this.started=!1,$t.apply(this,arguments)}pe(ge,$t,{handler:function(Je){var gt=ce[Je.type];if(gt===Bt&&(this.started=!0),!!this.started){var Ot=xe.call(this,Je,gt);gt&(Mt|qt)&&Ot[0].length-Ot[1].length===0&&(this.started=!1),this.callback(this.manager,gt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Le,srcEvent:Je})}}});function xe(He,Je){var gt=De(He.touches),Ot=De(He.changedTouches);return Je&(Mt|qt)&&(gt=Ye(gt.concat(Ot),"identifier",!0)),[gt,Ot]}var Ee={touchstart:Bt,touchmove:Dt,touchend:Mt,touchcancel:qt},we="touchstart touchmove touchend touchcancel";function Fe(){this.evTarget=we,this.targetIds={},$t.apply(this,arguments)}pe(Fe,$t,{handler:function(Je){var gt=Ee[Je.type],Ot=ze.call(this,Je,gt);Ot&&this.callback(this.manager,gt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Le,srcEvent:Je})}});function ze(He,Je){var gt=De(He.touches),Ot=this.targetIds;if(Je&(Bt|Dt)&&gt.length===1)return Ot[gt[0].identifier]=!0,[gt,gt];var di,ji,Br=De(He.changedTouches),In=[],Gn=this.target;if(ji=gt.filter(function(ns){return Ne(ns.target,Gn)}),Je===Bt)for(di=0;di<ji.length;)Ot[ji[di].identifier]=!0,di++;for(di=0;di<Br.length;)Ot[Br[di].identifier]&&In.push(Br[di]),Je&(Mt|qt)&&delete Ot[Br[di].identifier],di++;if(In.length)return[Ye(ji.concat(In),"identifier",!0),In]}var Ge=2500,st=25;function vt(){$t.apply(this,arguments);var He=be(this.handler,this);this.touch=new Fe(this.manager,He),this.mouse=new bi(this.manager,He),this.primaryTouch=null,this.lastTouches=[]}pe(vt,$t,{handler:function(Je,gt,Ot){var di=Ot.pointerType==Le,ji=Ot.pointerType==it;if(!(ji&&Ot.sourceCapabilities&&Ot.sourceCapabilities.firesTouchEvents)){if(di)Tt.call(this,gt,Ot);else if(ji&&ii.call(this,Ot))return;this.callback(Je,gt,Ot)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Tt(He,Je){He&Bt?(this.primaryTouch=Je.changedPointers[0].identifier,Kt.call(this,Je)):He&(Mt|qt)&&Kt.call(this,Je)}function Kt(He){var Je=He.changedPointers[0];if(Je.identifier===this.primaryTouch){var gt={x:Je.clientX,y:Je.clientY};this.lastTouches.push(gt);var Ot=this.lastTouches,di=function(){var ji=Ot.indexOf(gt);ji>-1&&Ot.splice(ji,1)};setTimeout(di,Ge)}}function ii(He){for(var Je=He.srcEvent.clientX,gt=He.srcEvent.clientY,Ot=0;Ot<this.lastTouches.length;Ot++){var di=this.lastTouches[Ot],ji=Math.abs(Je-di.x),Br=Math.abs(gt-di.y);if(ji<=st&&Br<=st)return!0}return!1}var Gt=Ze(l.style,"touchAction"),Ai=Gt!==n,Bi="compute",Hi="auto",Ci="manipulation",Ni="none",ot="pan-x",ri="pan-y",Vt=un();function Vi(He,Je){this.manager=He,this.set(Je)}Vi.prototype={set:function(He){He==Bi&&(He=this.compute()),Ai&&this.manager.element.style&&Vt[He]&&(this.manager.element.style[Gt]=He),this.actions=He.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var He=[];return U(this.manager.recognizers,function(Je){Te(Je.options.enable,[Je])&&(He=He.concat(Je.getTouchAction()))}),lr(He.join(" "))},preventDefaults:function(He){var Je=He.srcEvent,gt=He.offsetDirection;if(this.manager.session.prevented){Je.preventDefault();return}var Ot=this.actions,di=at(Ot,Ni)&&!Vt[Ni],ji=at(Ot,ri)&&!Vt[ri],Br=at(Ot,ot)&&!Vt[ot];if(di){var In=He.pointers.length===1,Gn=He.distance<2,ns=He.deltaTime<250;if(In&&Gn&&ns)return}if(!(Br&&ji)&&(di||ji&&gt&lt||Br&&gt&wt))return this.preventSrc(Je)},preventSrc:function(He){this.manager.session.prevented=!0,He.preventDefault()}};function lr(He){if(at(He,Ni))return Ni;var Je=at(He,ot),gt=at(He,ri);return Je&&gt?Ni:Je||gt?Je?ot:ri:at(He,Ci)?Ci:Hi}function un(){if(!Ai)return!1;var He={},Je=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(gt){He[gt]=Je?e.CSS.supports("touch-action",gt):!0}),He}var wn=1,gr=2,mn=4,yn=8,dr=yn,Hn=16,Gs=32;function Or(He){this.options=te({},this.defaults,He||{}),this.id=Et(),this.manager=null,this.options.enable=qe(this.options.enable,!0),this.state=wn,this.simultaneous={},this.requireFail=[]}Or.prototype={defaults:{},set:function(He){return te(this.options,He),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(He){if(R(He,"recognizeWith",this))return this;var Je=this.simultaneous;return He=Un(He,this),Je[He.id]||(Je[He.id]=He,He.recognizeWith(this)),this},dropRecognizeWith:function(He){return R(He,"dropRecognizeWith",this)?this:(He=Un(He,this),delete this.simultaneous[He.id],this)},requireFailure:function(He){if(R(He,"requireFailure",this))return this;var Je=this.requireFail;return He=Un(He,this),ke(Je,He)===-1&&(Je.push(He),He.requireFailure(this)),this},dropRequireFailure:function(He){if(R(He,"dropRequireFailure",this))return this;He=Un(He,this);var Je=ke(this.requireFail,He);return Je>-1&&this.requireFail.splice(Je,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(He){return!!this.simultaneous[He.id]},emit:function(He){var Je=this,gt=this.state;function Ot(di){Je.manager.emit(di,He)}gt<yn&&Ot(Je.options.event+Bn(gt)),Ot(Je.options.event),He.additionalEvent&&Ot(He.additionalEvent),gt>=yn&&Ot(Je.options.event+Bn(gt))},tryEmit:function(He){if(this.canEmit())return this.emit(He);this.state=Gs},canEmit:function(){for(var He=0;He<this.requireFail.length;){if(!(this.requireFail[He].state&(Gs|wn)))return!1;He++}return!0},recognize:function(He){var Je=te({},He);if(!Te(this.options.enable,[this,Je])){this.reset(),this.state=Gs;return}this.state&(dr|Hn|Gs)&&(this.state=wn),this.state=this.process(Je),this.state&(gr|mn|yn|Hn)&&this.tryEmit(Je)},process:function(He){},getTouchAction:function(){},reset:function(){}};function Bn(He){return He&Hn?"cancel":He&yn?"end":He&mn?"move":He&gr?"start":""}function qa(He){return He==kt?"down":He==Pi?"up":He==_i?"left":He==vi?"right":""}function Un(He,Je){var gt=Je.manager;return gt?gt.get(He):He}function Zi(){Or.apply(this,arguments)}pe(Zi,Or,{defaults:{pointers:1},attrTest:function(He){var Je=this.options.pointers;return Je===0||He.pointers.length===Je},process:function(He){var Je=this.state,gt=He.eventType,Ot=Je&(gr|mn),di=this.attrTest(He);return Ot&&(gt&qt||!di)?Je|Hn:Ot||di?gt&Mt?Je|yn:Je&gr?Je|mn:gr:Gs}});function ao(){Zi.apply(this,arguments),this.pX=null,this.pY=null}pe(ao,Zi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Oi},getTouchAction:function(){var He=this.options.direction,Je=[];return He&lt&&Je.push(ri),He&wt&&Je.push(ot),Je},directionTest:function(He){var Je=this.options,gt=!0,Ot=He.distance,di=He.direction,ji=He.deltaX,Br=He.deltaY;return di&Je.direction||(Je.direction&lt?(di=ji===0?ni:ji<0?_i:vi,gt=ji!=this.pX,Ot=Math.abs(He.deltaX)):(di=Br===0?ni:Br<0?Pi:kt,gt=Br!=this.pY,Ot=Math.abs(He.deltaY))),He.direction=di,gt&&Ot>Je.threshold&&di&Je.direction},attrTest:function(He){return Zi.prototype.attrTest.call(this,He)&&(this.state&gr||!(this.state&gr)&&this.directionTest(He))},emit:function(He){this.pX=He.deltaX,this.pY=He.deltaY;var Je=qa(He.direction);Je&&(He.additionalEvent=this.options.event+Je),this._super.emit.call(this,He)}});function Ms(){Zi.apply(this,arguments)}pe(Ms,Zi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ni]},attrTest:function(He){return this._super.attrTest.call(this,He)&&(Math.abs(He.scale-1)>this.options.threshold||this.state&gr)},emit:function(He){if(He.scale!==1){var Je=He.scale<1?"in":"out";He.additionalEvent=this.options.event+Je}this._super.emit.call(this,He)}});function vr(){Or.apply(this,arguments),this._timer=null,this._input=null}pe(vr,Or,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Hi]},process:function(He){var Je=this.options,gt=He.pointers.length===Je.pointers,Ot=He.distance<Je.threshold,di=He.deltaTime>Je.time;if(this._input=He,!Ot||!gt||He.eventType&(Mt|qt)&&!di)this.reset();else if(He.eventType&Bt)this.reset(),this._timer=F(function(){this.state=dr,this.tryEmit()},Je.time,this);else if(He.eventType&Mt)return dr;return Gs},reset:function(){clearTimeout(this._timer)},emit:function(He){this.state===dr&&(He&&He.eventType&Mt?this.manager.emit(this.options.event+"up",He):(this._input.timeStamp=T(),this.manager.emit(this.options.event,this._input)))}});function Tr(){Zi.apply(this,arguments)}pe(Tr,Zi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ni]},attrTest:function(He){return this._super.attrTest.call(this,He)&&(Math.abs(He.rotation)>this.options.threshold||this.state&gr)}});function rs(){Zi.apply(this,arguments)}pe(rs,Zi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:lt|wt,pointers:1},getTouchAction:function(){return ao.prototype.getTouchAction.call(this)},attrTest:function(He){var Je=this.options.direction,gt;return Je&(lt|wt)?gt=He.overallVelocity:Je&lt?gt=He.overallVelocityX:Je&wt&&(gt=He.overallVelocityY),this._super.attrTest.call(this,He)&&Je&He.offsetDirection&&He.distance>this.options.threshold&&He.maxPointers==this.options.pointers&&v(gt)>this.options.velocity&&He.eventType&Mt},emit:function(He){var Je=qa(He.offsetDirection);Je&&this.manager.emit(this.options.event+Je,He),this.manager.emit(this.options.event,He)}});function Gr(){Or.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}pe(Gr,Or,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ci]},process:function(He){var Je=this.options,gt=He.pointers.length===Je.pointers,Ot=He.distance<Je.threshold,di=He.deltaTime<Je.time;if(this.reset(),He.eventType&Bt&&this.count===0)return this.failTimeout();if(Ot&&di&&gt){if(He.eventType!=Mt)return this.failTimeout();var ji=this.pTime?He.timeStamp-this.pTime<Je.interval:!0,Br=!this.pCenter||hi(this.pCenter,He.center)<Je.posThreshold;this.pTime=He.timeStamp,this.pCenter=He.center,!Br||!ji?this.count=1:this.count+=1,this._input=He;var In=this.count%Je.taps;if(In===0)return this.hasRequireFailures()?(this._timer=F(function(){this.state=dr,this.tryEmit()},Je.interval,this),gr):dr}return Gs},failTimeout:function(){return this._timer=F(function(){this.state=Gs},this.options.interval,this),Gs},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==dr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Tn(He,Je){return Je=Je||{},Je.recognizers=qe(Je.recognizers,Tn.defaults.preset),new Lr(He,Je)}Tn.VERSION="2.0.7",Tn.defaults={domEvents:!1,touchAction:Bi,enable:!0,inputTarget:null,inputClass:null,preset:[[Tr,{enable:!1}],[Ms,{enable:!1},["rotate"]],[rs,{direction:lt}],[ao,{direction:lt},["swipe"]],[Gr],[Gr,{event:"doubletap",taps:2},["tap"]],[vr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Cn=1,po=2;function Lr(He,Je){this.options=te({},Tn.defaults,Je||{}),this.options.inputTarget=this.options.inputTarget||He,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=He,this.input=oi(this),this.touchAction=new Vi(this,this.options.touchAction),$a(this,!0),U(this.options.recognizers,function(gt){var Ot=this.add(new gt[0](gt[1]));gt[2]&&Ot.recognizeWith(gt[2]),gt[3]&&Ot.requireFailure(gt[3])},this)}Lr.prototype={set:function(He){return te(this.options,He),He.touchAction&&this.touchAction.update(),He.inputTarget&&(this.input.destroy(),this.input.target=He.inputTarget,this.input.init()),this},stop:function(He){this.session.stopped=He?po:Cn},recognize:function(He){var Je=this.session;if(!Je.stopped){this.touchAction.preventDefaults(He);var gt,Ot=this.recognizers,di=Je.curRecognizer;(!di||di&&di.state&dr)&&(di=Je.curRecognizer=null);for(var ji=0;ji<Ot.length;)gt=Ot[ji],Je.stopped!==po&&(!di||gt==di||gt.canRecognizeWith(di))?gt.recognize(He):gt.reset(),!di&&gt.state&(gr|mn|yn)&&(di=Je.curRecognizer=gt),ji++}},get:function(He){if(He instanceof Or)return He;for(var Je=this.recognizers,gt=0;gt<Je.length;gt++)if(Je[gt].options.event==He)return Je[gt];return null},add:function(He){if(R(He,"add",this))return this;var Je=this.get(He.options.event);return Je&&this.remove(Je),this.recognizers.push(He),He.manager=this,this.touchAction.update(),He},remove:function(He){if(R(He,"remove",this))return this;if(He=this.get(He),He){var Je=this.recognizers,gt=ke(Je,He);gt!==-1&&(Je.splice(gt,1),this.touchAction.update())}return this},on:function(He,Je){if(He!==n&&Je!==n){var gt=this.handlers;return U(nt(He),function(Ot){gt[Ot]=gt[Ot]||[],gt[Ot].push(Je)}),this}},off:function(He,Je){if(He!==n){var gt=this.handlers;return U(nt(He),function(Ot){Je?gt[Ot]&&gt[Ot].splice(ke(gt[Ot],Je),1):delete gt[Ot]}),this}},emit:function(He,Je){this.options.domEvents&&Zs(He,Je);var gt=this.handlers[He]&&this.handlers[He].slice();if(!(!gt||!gt.length)){Je.type=He,Je.preventDefault=function(){Je.srcEvent.preventDefault()};for(var Ot=0;Ot<gt.length;)gt[Ot](Je),Ot++}},destroy:function(){this.element&&$a(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function $a(He,Je){var gt=He.element;if(gt.style){var Ot;U(He.options.cssProps,function(di,ji){Ot=Ze(gt.style,ji),Je?(He.oldCssProps[Ot]=gt.style[Ot],gt.style[Ot]=di):gt.style[Ot]=He.oldCssProps[Ot]||""}),Je||(He.oldCssProps={})}}function Zs(He,Je){var gt=t.createEvent("Event");gt.initEvent(He,!0,!0),gt.gesture=Je,Je.target.dispatchEvent(gt)}te(Tn,{INPUT_START:Bt,INPUT_MOVE:Dt,INPUT_END:Mt,INPUT_CANCEL:qt,STATE_POSSIBLE:wn,STATE_BEGAN:gr,STATE_CHANGED:mn,STATE_ENDED:yn,STATE_RECOGNIZED:dr,STATE_CANCELLED:Hn,STATE_FAILED:Gs,DIRECTION_NONE:ni,DIRECTION_LEFT:_i,DIRECTION_RIGHT:vi,DIRECTION_UP:Pi,DIRECTION_DOWN:kt,DIRECTION_HORIZONTAL:lt,DIRECTION_VERTICAL:wt,DIRECTION_ALL:Oi,Manager:Lr,Input:$t,TouchAction:Vi,TouchInput:Fe,MouseInput:bi,PointerEventInput:Be,TouchMouseInput:vt,SingleTouchInput:ge,Recognizer:Or,AttrRecognizer:Zi,Tap:Gr,Pan:ao,Swipe:rs,Pinch:Ms,Rotate:Tr,Press:vr,on:je,off:We,each:U,merge:he,extend:Ae,assign:te,inherit:pe,bindFn:be,prefixed:Ze});var Ka=typeof e<"u"?e:typeof self<"u"?self:{};Ka.Hammer=Tn,typeof n=="function"&&n.amd?n(function(){return Tn}):i.exports?i.exports=Tn:e[r]=Tn})(window,document,"Hammer")})(gM);var By=gM.exports;const Qh=Om({__proto__:null,default:Um(By)},[By]),mM=1,yM=2,X2=4,yK={mousedown:mM,mousemove:yM,mouseup:X2};function _K(i,e){for(let t=0;t<i.length;t++)if(e(i[t]))return!0;return!1}function vK(i){const e=i.prototype.handler;i.prototype.handler=function(r){const n=this.store;r.button>0&&r.type==="pointerdown"&&(_K(n,o=>o.pointerId===r.pointerId)||n.push(r)),e.call(this,r)}}function bK(i){i.prototype.handler=function(t){let r=yK[t.type];r&mM&&t.button>=0&&(this.pressed=!0),r&yM&&t.which===0&&(r=X2),this.pressed&&(r&X2&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}vK(By.PointerEventInput),bK(By.MouseInput);const xK=By.Manager;class w1{constructor(e,t,r){this.element=e,this.callback=t,this.options={enable:!0,...r}}}const wK=Qh?[[Qh.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Qh.Rotate,{enable:!1}],[Qh.Pinch,{enable:!1}],[Qh.Swipe,{enable:!1}],[Qh.Pan,{threshold:0,enable:!1}],[Qh.Press,{enable:!1}],[Qh.Tap,{event:"doubletap",taps:2,enable:!1}],[Qh.Tap,{event:"anytap",enable:!1}],[Qh.Tap,{enable:!1}]]:null,_M={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},BK={doubletap:["tap"]},CK={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},J2={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},EK={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},vM={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},SK=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",cg=typeof window<"u"?window:global;let Y2=!1;try{const i={get passive(){return Y2=!0,!0}};cg.addEventListener("test",null,i),cg.removeEventListener("test",null)}catch{Y2=!1}const TK=SK.indexOf("firefox")!==-1,{WHEEL_EVENTS:IK}=J2,bM="wheel",xM=4.000244140625,LK=40,MK=.25;class PK extends w1{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{if(!this.options.enable)return;let o=n.deltaY;cg.WheelEvent&&(TK&&n.deltaMode===cg.WheelEvent.DOM_DELTA_PIXEL&&(o/=cg.devicePixelRatio),n.deltaMode===cg.WheelEvent.DOM_DELTA_LINE&&(o*=LK)),o!==0&&o%xM===0&&(o=Math.floor(o/xM)),n.shiftKey&&o&&(o=o*MK),this.callback({type:bM,center:{x:n.clientX,y:n.clientY},delta:-o,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(IK),this.events.forEach(n=>e.addEventListener(n,this.handleEvent,Y2?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===bM&&(this.options.enable=t)}}const{MOUSE_EVENTS:FK}=J2,wM="pointermove",BM="pointerover",CM="pointerout",EM="pointerenter",SM="pointerleave";class DK extends w1{constructor(e,t,r){super(e,t,r),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(FK),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===wM&&(this.enableMoveEvent=t),e===BM&&(this.enableOverEvent=t),e===CM&&(this.enableOutEvent=t),e===EM&&(this.enableEnterEvent=t),e===SM&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(BM,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(CM,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(EM,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(SM,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(wM,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:RK}=J2,TM="keydown",IM="keyup";class kK extends w1{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{const o=n.target||n.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:TM,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:IM,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(RK),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===TM&&(this.enableDownEvent=t),e===IM&&(this.enableUpEvent=t)}}const LM="contextmenu";class OK extends w1{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{this.options.enable&&this.callback({type:LM,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===LM&&(this.options.enable=t)}}const eB=1,B1=2,tB=4,UK={pointerdown:eB,pointermove:B1,pointerup:tB,mousedown:eB,mousemove:B1,mouseup:tB},NK=1,zK=2,QK=3,VK=0,HK=1,GK=2,jK=1,qK=2,$K=4;function KK(i){const e=UK[i.srcEvent.type];if(!e)return null;const{buttons:t,button:r,which:n}=i.srcEvent;let o=!1,l=!1,s=!1;return e===tB||e===B1&&!Number.isFinite(t)?(o=n===NK,l=n===zK,s=n===QK):e===B1?(o=!!(t&jK),l=!!(t&$K),s=!!(t&qK)):e===eB&&(o=r===VK,l=r===HK,s=r===GK),{leftButton:o,middleButton:l,rightButton:s}}function WK(i,e){const t=i.center;if(!t)return null;const r=e.getBoundingClientRect(),n=r.width/e.offsetWidth||1,o=r.height/e.offsetHeight||1,l={x:(t.x-r.left-e.clientLeft)/n,y:(t.y-r.top-e.clientTop)/o};return{center:t,offsetCenter:l}}const iB={srcElement:"root",priority:0};class ZK{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const r=this._normalizeEvent(t);let n=t.srcEvent.target;for(;n&&n!==r.rootElement;){if(this._emit(r,n),r.handled)return;n=n.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:l,handlersByElement:s}=this;let g=iB;typeof r=="string"||r&&r.addEventListener?g={...iB,srcElement:r}:r&&(g={...iB,...r});let v=s.get(g.srcElement);v||(v=[],s.set(g.srcElement,v));const T={type:e,handler:t,srcElement:g.srcElement,priority:g.priority};n&&(T.once=!0),o&&(T.passive=!0),l.push(T),this._active=this._active||!T.passive;let F=v.length-1;for(;F>=0&&!(v[F].priority>=T.priority);)F--;v.splice(F+1,0,T)}remove(e,t){const{handlers:r,handlersByElement:n}=this;for(let o=r.length-1;o>=0;o--){const l=r[o];if(l.type===e&&l.handler===t){r.splice(o,1);const s=n.get(l.srcElement);s.splice(s.indexOf(l),1),s.length===0&&n.delete(l.srcElement)}}this._active=r.some(o=>!o.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let n=!1;const o=()=>{e.handled=!0},l=()=>{e.handled=!0,n=!0},s=[];for(let g=0;g<r.length;g++){const{type:v,handler:T,once:F}=r[g];if(T({...e,type:v,stopPropagation:o,stopImmediatePropagation:l}),F&&s.push(r[g]),n)break}for(let g=0;g<s.length;g++){const{type:v,handler:T}=s[g];this.remove(v,T)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...KK(e),...WK(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const XK={events:null,recognizers:null,recognizerOptions:{},Manager:xK,touchAction:"none",tabIndex:0};class JK{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;this._onBasicInput=n=>{const{srcEvent:o}=n,l=CK[o.type];l&&this.manager.emit(l,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...XK,...t},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,r=t.Manager;this.manager=new r(e,{touchAction:t.touchAction,recognizers:t.recognizers||wK}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(_M).forEach(n=>{const o=this.manager.get(n);o&&_M[n].forEach(l=>{o.recognizeWith(l)})});for(const n in t.recognizerOptions){const o=this.manager.get(n);if(o){const l=t.recognizerOptions[n];delete l.enable,o.set(l)}}this.wheelInput=new PK(e,this._onOtherEvent,{enable:!1}),this.moveInput=new DK(e,this._onOtherEvent,{enable:!1}),this.keyInput=new kK(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new OK(e,this._onOtherEvent,{enable:!1});for(const[n,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(n,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const n=r.get(e);if(n&&n.options.enable!==t){n.set({enable:t});const o=BK[e];o&&!this.options.recognizers&&o.forEach(l=>{const s=r.get(l);t?(s.requireFailure(e),n.dropRequireFailure(l)):s.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,r,n,o){if(typeof e!="string"){r=t;for(const T in e)this._addEventHandler(T,e[T],r,n,o);return}const{manager:l,events:s}=this,g=vM[e]||e;let v=s.get(g);v||(v=new ZK(this),s.set(g,v),v.recognizerName=EK[g]||g,l&&l.on(g,v.handleEvent)),v.add(e,t,r,n,o),v.isEmpty()||this._toggleRecognizer(v.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const l in e)this._removeEventHandler(l,e[l]);return}const{events:r}=this,n=vM[e]||e,o=r.get(n);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:l}=o;let s=!1;for(const g of r.values())if(g.recognizerName===l&&!g.isEmpty()){s=!0;break}s||this._toggleRecognizer(l,!1)}}}function Bf(){}const MM={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Bf,onResize:Bf,onViewStateChange:Bf,onInteractionStateChange:Bf,onBeforeRender:Bf,onAfterRender:Bf,onLoad:Bf,onError:i=>On.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:i=>{let{isDragging:e}=i;return e?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class rB{constructor(e){ye(this,"props",void 0),ye(this,"width",0),ye(this,"height",0),ye(this,"userData",{}),ye(this,"canvas",null),ye(this,"viewManager",null),ye(this,"layerManager",null),ye(this,"effectManager",null),ye(this,"deckRenderer",null),ye(this,"deckPicker",null),ye(this,"eventManager",null),ye(this,"tooltip",null),ye(this,"metrics",void 0),ye(this,"animationLoop",void 0),ye(this,"stats",void 0),ye(this,"viewState",void 0),ye(this,"cursorState",void 0),ye(this,"_needsRedraw",void 0),ye(this,"_pickRequest",void 0),ye(this,"_lastPointerDownInfo",null),ye(this,"_metricsCounter",void 0),ye(this,"_onPointerMove",t=>{const{_pickRequest:r}=this;if(t.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(t.leftButton||t.rightButton)return;{const n=t.offsetCenter;if(!n)return;r.x=n.x,r.y=n.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=t}),ye(this,"_onEvent",t=>{const r=K5[t.type],n=t.offsetCenter;if(!r||!n||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:o,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=l,g=s&&(s[r.handler]||s.props[r.handler]),v=this.props[r.handler];let T=!1;g&&(T=g.call(s,l,t)),!T&&v&&v(l,t)}),ye(this,"_onPointerDown",t=>{const r=t.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo}),this.props={...MM,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&On.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),V5()==="IE"&&On.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Ww({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&vy.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,n,o,l,s,g;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(t=this.layerManager)===null||t===void 0||t.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(n=this.effectManager)===null||n===void 0||n.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)===null||l===void 0||l.finalize(),this.deckPicker=null,(s=this.eventManager)===null||s===void 0||s.destroy(),this.eventManager=null,(g=this.tooltip)===null||g===void 0||g.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var v;(v=this.canvas.parentElement)===null||v===void 0||v.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&On.removed("onLayerHover","onHover")(),"onLayerClick"in e&&On.removed("onLayerClick","onClick")(),e.initialViewState&&!zh(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||r||n||o||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return sl(this.viewManager),this.viewManager.views}getViewports(e){return sl(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,t,r){sl(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return n.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),sl(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const o=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=o}if(r||r===0){var n;const o=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((n=e.style)===null||n===void 0?void 0:n.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var e,t;const{canvas:r}=this;if(!r)return;const n=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,o=(t=r.clientHeight)!==null&&t!==void 0?t:r.height;if(n!==this.width||o!==this.height){var l,s;this.width=n,this.height=o,(l=this.viewManager)===null||l===void 0||l.setProps({width:n,height:o}),(s=this.layerManager)===null||s===void 0||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:o})}}_createAnimationLoop(e){const{width:t,height:r,gl:n,glOptions:o,debug:l,onError:s,onBeforeRender:g,onAfterRender:v,useDevicePixels:T}=e;return new F7({width:t,height:r,useDevicePixels:T,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,gl:n,onCreateContext:F=>u3({...o,...F,canvas:this.canvas,debug:l,onContextLost:()=>this._onContextLost()}),onInitialize:F=>this._setGLContext(F.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:g,onAfterRender:v,onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new Z2({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let o=n,l=!1;for(const s of r){var t;o=s,l=((t=s.layer)===null||t===void 0?void 0:t.onHover(s,e.event))||l}if(!l&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){const s=this.props.getTooltip(o);this.tooltip.setTooltip(s,o.x,o.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Kw(e,{enable:!0,copyState:!0})),this.tooltip=new mK(this.canvas),xA(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new NL;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new JK(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in K5)this.eventManager.on(n,this._onEvent);this.viewManager=new H$({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new V$(e,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new oK,this.deckRenderer=new cK(e),this.deckPicker=new pK(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:r}=this.layerManager.context;xA(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),On.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=mf.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}ye(rB,"defaultProps",MM),ye(rB,"VERSION",NV);class nB{constructor(e,t){ye(this,"opts",void 0),ye(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:r}=this.source,{size:n}=t;let o=r;if(r&&r.length!==n){o=new Float32Array(n);const l=t.elementOffset||0;for(let s=0;s<n;++s)o[s]=r[l+s]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function YK(i){switch(i){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function C1(i){return i.stride||i.size*i.bytesPerElement}function PM(i,e){e.offset&&On.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=C1(i),r=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,n=e.elementOffset||0,o=r*t+n*i.bytesPerElement+(i.offset||0);return{...e,offset:o,stride:t}}function eW(i,e){const t=PM(i,e);return{high:t,low:{...t,offset:t.offset+i.size*4}}}class tW{constructor(e,t,r){ye(this,"gl",void 0),ye(this,"id",void 0),ye(this,"size",void 0),ye(this,"settings",void 0),ye(this,"value",void 0),ye(this,"doublePrecision",void 0),ye(this,"_buffer",void 0),ye(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,o=n===5130;let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let s;o?s=5126:!n&&t.isIndexed?s=e&&r2(e,Qs.ELEMENT_INDEX_UINT32)?5125:5123:s=n||5126;let g=YK(n||s||5126);this.doublePrecision=o,o&&t.fp64===!1&&(g=Float32Array),this.value=null,this.settings={...t,defaultType:g,defaultValue:l,logicalType:n,type:s,size:this.size,bytesPerElement:g.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new bs(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*C1(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),vy.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const r={},n=this.value instanceof Float64Array,o=eW(this.getAccessor(),t||{});return r[e]=new nB(this,o.high),r["".concat(e,"64Low")]=n?new nB(this,o.low):new Float32Array(this.size),r}if(t){const r=PM(this.getAccessor(),t);return{[e]:new nB(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:n}=this,o=r*n;if(t&&o&&t.length>=o){const l=new Array(n).fill(1/0),s=new Array(n).fill(-1/0);for(let g=0;g<o;)for(let v=0;v<n;v++){const T=t[g++];T<l[v]&&(l[v]=T),T>s[v]&&(s[v]=T)}e=[l,s]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof bs?r={buffer:e}:r=e;const n={...this.settings,...r};if(t.bufferAccessor=n,t.bounds=null,r.constant){let o=r.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=o}else if(r.buffer){const o=r.buffer;t.externalBuffer=o,t.constant=!1,this.value=r.value||null;const l=r.value instanceof Float64Array;n.type=r.type||o.accessor.type,n.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(l?2:1),n.stride=C1(n)}else if(r.value){this._checkExternalBuffer(r);let o=r.value;t.externalBuffer=null,t.constant=!1,this.value=o,n.bytesPerElement=o.BYTES_PER_ELEMENT,n.stride=C1(n);const{buffer:l,byteOffset:s}=this;this.doublePrecision&&o instanceof Float64Array&&(o=G2(o,n));const g=o.byteLength+s+n.stride*2;l.byteLength<g&&l.reallocate(g),l.setAccessor(null),l.subData({data:o,offset:s}),n.type=r.type||l.accessor.type}return!0}updateSubBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:n}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?G2(t,{size:this.size,startIndex:r,endIndex:n}):t.subarray(r,n),offset:r*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:r}=this,n=r.allocatedValue,o=vy.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{buffer:l,byteOffset:s}=this;return l.byteLength<o.byteLength+s&&(l.reallocate(o.byteLength+s),t&&n&&l.subData({data:n instanceof Float64Array?G2(n,this):n,offset:s})),r.allocatedValue=o,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=t.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&On.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:n,size:o}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let l=o;for(;--l>=0;)t[r+l]=n[l];return t}switch(o){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let l=o;for(;--l>=0;)t[r+l]=Number.isFinite(e[l])?e[l]:n[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}}const FM=[],DM=[];function RM(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,r=FM;const n={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(DM.length=i.length,r=DM):r=FM,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),n.index=e-1),{iterable:r,objectInfo:n}}function kM(i){return i&&i[Symbol.asyncIterator]}function iW(i,e){const{size:t,stride:r,offset:n,startIndices:o,nested:l}=e,s=i.BYTES_PER_ELEMENT,g=r?r/s:t,v=n?n/s:0,T=Math.floor((i.length-v)/g);return(F,R)=>{let{index:U,target:J}=R;if(!o){const pe=U*g+v;for(let be=0;be<t;be++)J[be]=i[pe+be];return J}const te=o[U],Ae=o[U+1]||T;let he;if(l){he=new Array(Ae-te);for(let pe=te;pe<Ae;pe++){const be=pe*g+v;J=new Array(t);for(let Te=0;Te<t;Te++)J[Te]=i[be+Te];he[pe-te]=J}}else if(g===t)he=i.subarray(te*t+v,Ae*t+v);else{he=new i.constructor((Ae-te)*t);let pe=0;for(let be=te;be<Ae;be++){const Te=be*g+v;for(let qe=0;qe<t;qe++)he[pe++]=i[Te+qe]}}return he}}const rW=[],E1=[[0,1/0]];function nW(i,e){if(i===E1||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const t=[],r=i.length;let n=0;for(let o=0;o<r;o++){const l=i[o];l[1]<e[0]?(t.push(l),n=o+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(n,0,e),t}function sB(i){const{source:e,target:t,start:r=0,size:n,getData:o}=i,l=i.end||t.length,s=e.length,g=l-r;if(s>g){t.set(e.subarray(0,g),r);return}if(t.set(e,r),!o)return;let v=s;for(;v<g;){const T=o(v,e);for(let F=0;F<n;F++)t[r+v]=T[F]||0,v++}}function sW(i){let{source:e,target:t,size:r,getData:n,sourceStartIndices:o,targetStartIndices:l}=i;if(!Array.isArray(l))return sB({source:e,target:t,size:r,getData:n}),t;let s=0,g=0;const v=n&&((F,R)=>n(F+g,R)),T=Math.min(o.length,l.length);for(let F=1;F<T;F++){const R=o[F]*r,U=l[F]*r;sB({source:e.subarray(s,R),target:t,start:g,end:U,size:r,getData:v}),s=R,g=U}return g<t.length&&sB({source:[],target:t,start:g,size:r,getData:v}),t}const oW={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function OM(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const t=i.type||"interpolation";return{...oW[t],...e,...i,type:t}}function UM(i,e){const t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function NM(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(i,'"'))}}function zM(i){i.push(i.shift())}function oB(i,e){const{doublePrecision:t,settings:r,value:n,size:o}=i,l=t&&n instanceof Float64Array?2:1;return(r.noAlloc?n.length:e*o)*l}function QM(i){let{buffer:e,numInstances:t,attribute:r,fromLength:n,fromStartIndices:o,getData:l=pe=>pe}=i;const s=r.doublePrecision&&r.value instanceof Float64Array?2:1,g=r.size*s,v=r.byteOffset,T=r.startIndices,F=o&&T,R=oB(r,t),U=r.isConstant;if(!F&&n>=R)return;const J=U?r.value:r.getBuffer().getData({srcByteOffset:v});if(r.settings.normalized&&!U){const pe=l;l=(be,Te)=>r.normalizeConstant(pe(be,Te))}const te=U?(pe,be)=>l(J,be):(pe,be)=>l(J.subarray(pe,pe+g),be),Ae=e.getData({length:n}),he=new Float32Array(R);sW({source:Ae,target:he,sourceStartIndices:o,targetStartIndices:T,size:g,getData:te}),e.byteLength<he.byteLength+v&&e.reallocate(he.byteLength+v),e.subData({data:he,offset:v})}class aB extends tW{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:E1}),ye(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,n=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return OM(n,r)}setNeedsUpdate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:n=1/0}=t;this.state.updateRanges=nW(this.state.updateRanges,[r,n])}else this.state.updateRanges=E1}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=rW}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==E1),!0):!1}updateBuffer(e){let{numInstances:t,data:r,props:n,context:o}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:s,noAlloc:g}}=this;let v=!0;if(s){for(const[T,F]of l)s.call(o,this,{data:r,startRow:T,endRow:F,props:n,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[T,F]of l){const R=Number.isFinite(T)?this.getVertexOffset(T):0,U=Number.isFinite(F)?this.getVertexOffset(F):g||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:R,endOffset:U})}this._checkAttributeArray()}else v=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),v}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:r,settings:n}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),n.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;sl(ArrayBuffer.isView(l.value),"invalid ".concat(n.accessor));const s=!!l.size&&l.size!==this.size;return r.binaryAccessor=iW(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const r in e)Object.assign(t,super.getShaderAttributes(r,e[r]));return t}_autoUpdater(e,t){let{data:r,startRow:n,endRow:o,props:l,numInstances:s}=t;if(e.constant)return;const{settings:g,state:v,value:T,size:F,startIndices:R}=e,{accessor:U,transform:J}=g,te=v.binaryAccessor||(typeof U=="function"?U:l[U]);sl(typeof te=="function",'accessor "'.concat(U,'" is not a function'));let Ae=e.getVertexOffset(n);const{iterable:he,objectInfo:pe}=RM(r,n,o);for(const be of he){pe.index++;let Te=te(be,pe);if(J&&(Te=J.call(this,Te)),R){const qe=(pe.index<R.length-1?R[pe.index+1]:s)-R[pe.index];if(Te&&Array.isArray(Te[0])){let je=Ae;for(const We of Te)e._normalizeValue(We,T,je),je+=F}else Te&&Te.length>F?T.set(Te,Ae):(e._normalizeValue(Te,pe.target,0),D$({target:T,source:pe.target,start:Ae,count:qe}));Ae+=qe*F}else e._normalizeValue(Te,T,Ae),Ae+=F}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class aW{constructor(e){let{gl:t,attribute:r,timeline:n}=e;ye(this,"gl",void 0),ye(this,"type","interpolation"),ye(this,"attributeInTransition",void 0),ye(this,"settings",void 0),ye(this,"attribute",void 0),ye(this,"transition",void 0),ye(this,"currentStartIndices",void 0),ye(this,"currentLength",void 0),ye(this,"transform",void 0),ye(this,"buffers",void 0),this.gl=t,this.transition=new wy(n),this.attribute=r,this.attributeInTransition=new aB(t,r.settings),this.currentStartIndices=r.startIndices,this.currentLength=0,this.transform=cW(t,r);const o={byteLength:0,usage:35050};this.buffers=[new bs(t,o),new bs(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:n,attribute:o}=this;zM(n);const l={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)QM({buffer:s,...l});this.currentStartIndices=o.startIndices,this.currentLength=oB(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:n[0],aTo:UM(r,o)},feedbackBuffers:{vCurrent:n[1]}})}update(){const e=this.transition.update();if(e){const{duration:t,easing:r}=this.settings,{time:n}=this.transition;let o=n/t;r&&(o=r(o)),this.transform.run({uniforms:{time:o}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const lW=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function cW(i,e){const t=NM(e.size);return new D2(i,{vs:lW,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}class uW{constructor(e){let{gl:t,attribute:r,timeline:n}=e;ye(this,"gl",void 0),ye(this,"type","spring"),ye(this,"attributeInTransition",void 0),ye(this,"settings",void 0),ye(this,"attribute",void 0),ye(this,"transition",void 0),ye(this,"currentStartIndices",void 0),ye(this,"currentLength",void 0),ye(this,"texture",void 0),ye(this,"framebuffer",void 0),ye(this,"transform",void 0),ye(this,"buffers",void 0),this.gl=t,this.type="spring",this.transition=new wy(n),this.attribute=r,this.attributeInTransition=new aB(t,{...r.settings,normalized:!1}),this.currentStartIndices=r.startIndices,this.currentLength=0,this.texture=AW(t),this.framebuffer=dW(t,this.texture),this.transform=hW(t,r,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new bs(t,o),new bs(t,o),new bs(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:r,buffers:n,attribute:o}=this,l={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)QM({buffer:s,...l});this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=oB(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:UM(r,o)}})}update(){const{buffers:e,transform:t,framebuffer:r,transition:n}=this;if(!n.update())return!1;const l=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:l.stiffness,damping:l.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),zM(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),W_(r)[0]>0||n.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function hW(i,e,t){const r=NM(e.size);return new D2(i,{framebuffer:t,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function AW(i){return new Yc(i,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function dW(i,e){return new ba(i,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const fW={interpolation:aW,spring:uW};class pW{constructor(e,t){let{id:r,timeline:n}=t;ye(this,"id",void 0),ye(this,"isSupported",void 0),ye(this,"gl",void 0),ye(this,"timeline",void 0),ye(this,"transitions",void 0),ye(this,"needsRedraw",void 0),ye(this,"numInstances",void 0),this.id=r,this.gl=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=D2.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:r,numInstances:n}=e;this.numInstances=n||1;for(const o in t){const l=t[o],s=l.getTransitionSetting(r);s&&this._updateAttribute(o,l,s)}for(const o in this.transitions){const l=t[o];(!l||!l.getTransitionSetting(r))&&this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,r){const n=this.transitions[e];let o=!n||n.type!==r.type;if(o){if(!this.isSupported){On.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}n&&this._removeTransition(e);const l=fW[r.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,gl:this.gl}):(On.error("unsupported transition type '".concat(r.type,"'"))(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const VM="attributeManager.invalidate",gW="attributeManager.updateStart",mW="attributeManager.updateEnd",yW="attribute.updateStart",_W="attribute.allocate",vW="attribute.updateEnd";class bW{constructor(e){let{id:t="attribute-manager",stats:r,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ye(this,"id",void 0),ye(this,"gl",void 0),ye(this,"attributes",void 0),ye(this,"updateTriggers",void 0),ye(this,"needsRedraw",void 0),ye(this,"userData",void 0),ye(this,"stats",void 0),ye(this,"attributeTransitionManager",void 0),ye(this,"mergeBoundsMemoized",yy(C$)),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new pW(e,{id:"".concat(t,"-transitions"),timeline:n}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);Sl(VM,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Sl(VM,this,"all")}update(e){let{data:t,numInstances:r,startIndices:n=null,transitions:o,props:l={},buffers:s={},context:g={}}=e,v=!1;Sl(gW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const T in this.attributes){const F=this.attributes[T],R=F.settings.accessor;F.startIndices=n,F.numInstances=r,l[T]&&On.removed("props.".concat(T),"data.attributes.".concat(T))(),F.setExternalBuffer(s[T])||F.setBinaryValue(typeof R=="string"?s[R]:void 0,t.startIndices)||typeof R=="string"&&!s[R]&&F.setConstantValue(l[R])||F.needsUpdate()&&(v=!0,this._updateAttribute({attribute:F,numInstances:r,data:t,props:l,context:g})),this.needsRedraw=this.needsRedraw||F.needsRedraw()}v&&Sl(mW,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getBounds(e){const t=e.map(r=>{var n;return(n=this.attributes[r])===null||n===void 0?void 0:n.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:t,attributeTransitionManager:r}=this,n={...r.getAttributes()};for(const o in t){const l=t[o];l.needsRedraw(e)&&!r.hasAttribute(o)&&(n[o]=l)}return n}getShaderAttributes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());const r={};for(const n in e)t[n]||Object.assign(r,e[n].getShaderAttributes());return r}_add(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const r in e){const n=e[r];this.attributes[r]=this._createAttribute(r,n,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,r){const n={...t,id:e,size:t.isIndexed&&1||t.size||1,divisor:r.instanced?1:t.divisor||0};return new aB(this.gl,n)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:n}=this,o=n[e];return o&&o.forEach(l=>{const s=r[l];s&&s.setNeedsUpdate(s.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(Sl(yW,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&Sl(_W,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,Sl(vW,t,r))}}class xW extends wy{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:n,easing:o}}=this,l=o(e/n);this._value=s1(t,r,l)}}const HM=1e-5;function GM(i,e,t,r,n){const o=e-i,s=(t-e)*n,g=-o*r;return s+g+o+e}function wW(i,e,t,r,n){if(Array.isArray(t)){const o=[];for(let l=0;l<t.length;l++)o[l]=GM(i[l],e[l],t[l],r,n);return o}return GM(i,e,t,r,n)}function jM(i,e){if(Array.isArray(i)){let t=0;for(let r=0;r<i.length;r++){const n=i[r]-e[r];t+=n*n}return Math.sqrt(t)}return Math.abs(i-e)}class BW extends wy{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:n}=this.settings,{_prevValue:o=e,_currValue:l=e}=this;let s=wW(o,l,t,r,n);const g=jM(s,t),v=jM(s,l);g<HM&&v<HM&&(s=t,this.end()),this._prevValue=l,this._currValue=s}}const CW={interpolation:xW,spring:BW};class EW{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,n){const{transitions:o}=this;if(o.has(e)){const g=o.get(e),{value:v=g.settings.fromValue}=g;t=v,this.remove(e)}if(n=OM(n),!n)return;const l=CW[n.type];if(!l){On.error("unsupported transition type '".concat(n.type,"'"))();return}const s=new l(this.timeline);s.start({...n,fromValue:t,toValue:r}),o.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function SW(i){const e=i[cd];for(const t in e){const r=e[t],{validate:n}=r;if(n&&!n(i[t],r))throw new Error("Invalid prop ".concat(t,": ").concat(i[t]))}}function TW(i,e){const t=qM({newProps:i,oldProps:e,propTypes:i[cd],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=LW(i,e);let n=!1;return r||(n=MW(i,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:n,extensionsChanged:PW(i,e),transitionsChanged:IW(i,e)}}function IW(i,e){if(!i.transitions)return!1;const t={},r=i[cd];let n=!1;for(const o in i.transitions){const l=r[o],s=l&&l.type;(s==="number"||s==="color"||s==="array")&&lB(i[o],e[o],l)&&(t[o]=!0,n=!0)}return n?t:!1}function qM(i){let{newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:o="props"}=i;if(t===e)return!1;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return"".concat(o," changed shallowly");for(const l of Object.keys(e))if(!(l in r)){if(!(l in t))return"".concat(o,".").concat(l," added");const s=lB(e[l],t[l],n[l]);if(s)return"".concat(o,".").concat(l," ").concat(s)}for(const l of Object.keys(t))if(!(l in r)){if(!(l in e))return"".concat(o,".").concat(l," dropped");if(!Object.hasOwnProperty.call(e,l)){const s=lB(e[l],t[l],n[l]);if(s)return"".concat(o,".").concat(l," ").concat(s)}}return!1}function lB(i,e,t){let r=t&&t.equal;return r&&!r(i,e,t)||!r&&(r=i&&e&&i.equals,r&&!r.call(i,e))?"changed deeply":!r&&e!==i?"changed shallowly":null}function LW(i,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:n}=i;return r?r(i.data,e.data)||(t="Data comparator detected a change"):i.data!==e.data&&(t="A new data container was supplied"),t&&n&&(t=n(i.data,e.data)||t),t}function MW(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&$M(i,e,"all"))return{all:!0};const t={};let r=!1;for(const n in i.updateTriggers)n!=="all"&&$M(i,e,n)&&(t[n]=!0,r=!0);return r?t:!1}function PW(i,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=i;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let n=0;n<r.length;n++)if(!r[n].equals(t[n]))return!0;return!1}function $M(i,e,t){let r=i.updateTriggers[t];r=r??{};let n=e.updateTriggers[t];return n=n??{},qM({oldProps:n,newProps:r,triggerName:t})}const FW="count(): argument not an object",DW="count(): argument not a container";function RW(i){if(!OW(i))throw new Error(FW);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(kW(i))return Object.keys(i).length;throw new Error(DW)}function kW(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function OW(i){return i!==null&&typeof i=="object"}function UW(i,e){if(!e)return i;const t={...i,...e};if("defines"in e&&(t.defines={...i.defines,...e.defines}),"modules"in e&&(t.modules=(i.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(n=>n.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!i.inject)t.inject=e.inject;else{const r={...i.inject};for(const n in e.inject)r[n]=(r[n]||"")+e.inject[n];t.inject=r}return t}const NW={10241:9987,10240:9729,10242:33071,10243:33071},cB={};function zW(i,e,t,r){if(t instanceof Yc)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let n=null;t.compressed&&(n={10241:t.data.length>1?9985:9729});const o=new Yc(e,{...t,parameters:{...NW,...n,...r}});return cB[o.id]=i,o}function QW(i,e){!e||!(e instanceof Yc)||cB[e.id]===i&&(e.delete(),delete cB[e.id])}const VW={boolean:{validate(i,e){return!0},equal(i,e,t){return!!i==!!e}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||uB(i)&&(i.length===3||i.length===4)},equal(i,e,t){return zh(i,e,1)}},accessor:{validate(i,e){const t=S1(i);return t==="function"||t===S1(e.value)},equal(i,e,t){return typeof e=="function"?!0:zh(i,e,1)}},array:{validate(i,e){return e.optional&&!i||uB(i)},equal(i,e,t){const{compare:r}=t,n=Number.isInteger(r)?r:r?1:0;return r?zh(i,e,n):i===e}},object:{equal(i,e,t){if(t.ignore)return!0;const{compare:r}=t,n=Number.isInteger(r)?r:r?1:0;return r?zh(i,e,n):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,t){return!t.compare&&t.ignore!==!1||i===e}},data:{transform:(i,e,t)=>{const{dataTransform:r}=t.props;return r&&i?r(i):i}},image:{transform:(i,e,t)=>{const r=t.context;return!r||!r.gl?null:zW(t.id,r.gl,i,{...e.parameters,...t.props.textureParameters})},release:(i,e,t)=>{QW(t.id,i)}}};function HW(i){const e={},t={},r={};for(const[n,o]of Object.entries(i)){const l=o==null?void 0:o.deprecatedFor;if(l)r[n]=Array.isArray(l)?l:[l];else{const s=GW(n,o);e[n]=s,t[n]=s.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function GW(i,e){switch(S1(e)){case"object":return Cy(i,e);case"array":return Cy(i,{type:"array",value:e,compare:!1});case"boolean":return Cy(i,{type:"boolean",value:e});case"number":return Cy(i,{type:"number",value:e});case"function":return Cy(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function Cy(i,e){return"type"in e?{name:i,...VW[e.type],...e}:"value"in e?{name:i,type:S1(e.value),...e}:{name:i,type:"object",value:e}}function uB(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function S1(i){return uB(i)?"array":i===null?"null":typeof i}function jW(i,e){let t;for(let o=e.length-1;o>=0;o--){const l=e[o];"extensions"in l&&(t=l.extensions)}const r=hB(i.constructor,t),n=Object.create(r);n[v1]=i,n[xf]={},n[ud]={};for(let o=0;o<e.length;++o){const l=e[o];for(const s in l)n[s]=l[s]}return Object.freeze(n),n}const qW="_mergedDefaultProps";function hB(i,e){let t=qW;if(e)for(const n of e){const o=n.constructor;o&&(t+=":".concat(o.extensionName||o.name))}const r=KM(i,t);return r||(i[t]=$W(i,e||[]))}function $W(i,e){if(!i.prototype)return null;const r=Object.getPrototypeOf(i),n=hB(r),o=KM(i,"defaultProps")||{},l=HW(o),s=Object.assign(Object.create(null),n,l.defaultProps),g=Object.assign(Object.create(null),n==null?void 0:n[cd],l.propTypes),v=Object.assign(Object.create(null),n==null?void 0:n[q2],l.deprecatedProps);for(const T of e){const F=hB(T.constructor);F&&(Object.assign(s,F),Object.assign(g,F[cd]),Object.assign(v,F[q2]))}return KW(s,i),ZW(s,g),WW(s,v),s[cd]=g,s[q2]=v,e.length===0&&!AB(i,"_propTypes")&&(i._propTypes=g),s}function KW(i,e){const t=JW(e);Object.defineProperties(i,{id:{writable:!0,value:t}})}function WW(i,e){for(const t in e)Object.defineProperty(i,t,{enumerable:!1,set(r){const n="".concat(this.id,": ").concat(t);for(const o of e[t])AB(this,o)||(this[o]=r);On.deprecated(n,e[t].join("/"))()}})}function ZW(i,e){const t={},r={};for(const n in e){const o=e[n],{name:l,value:s}=o;o.async&&(t[l]=s,r[l]=XW(l))}i[ag]=t,i[xf]={},Object.defineProperties(i,r)}function XW(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||kM(e)?this[xf][i]=e:this[ud][i]=e},get(){if(this[ud]){if(i in this[ud])return this[ud][i]||this[ag][i];if(i in this[xf]){const e=this[v1]&&this[v1].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[ag][i]}}return this[ag][i]}}}function AB(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function KM(i,e){return AB(i,e)&&i[e]}function JW(i){const e=i.componentName;return e||On.warn("".concat(i.name,".componentName not specified"))(),e||i.name}let YW=0;class dB{constructor(){ye(this,"id",void 0),ye(this,"props",void 0),ye(this,"count",void 0);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.props=jW(this,t),this.id=this.props.id,this.count=YW++}clone(e){const{props:t}=this,r={};for(const n in t[ag])n in t[ud]?r[n]=t[ud][n]:n in t[xf]&&(r[n]=t[xf][n]);return new this.constructor({...t,...r,...e})}}ye(dB,"componentName","Component"),ye(dB,"defaultProps",{});const eZ=Object.freeze({});class tZ{constructor(e){ye(this,"component",void 0),ye(this,"onAsyncPropUpdated",void 0),ye(this,"asyncProps",void 0),ye(this,"oldProps",void 0),ye(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||eZ}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[v1]||this.component;const t=e[ud]||{},r=e[xf]||e,n=e[ag]||{};for(const o in t){const l=t[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,l),t[o]=this.getAsyncProp(o)}for(const o in r){const l=r[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(kM(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const n=this.asyncProps[e];n&&r>=n.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=t,n.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const n=r.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(r,o),this._setAsyncPropValue(e,o,n),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const n=r.pendingLoadCount;let o=[],l=0;for await(const s of t){if(!this.component)return;const{dataTransform:g}=this.component.props;g?o=g(s,o):o=o.concat(s),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:l,endRow:o.length}]}),l=o.length,this._setAsyncPropValue(e,o,n)}this._onResolve(e,o)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[cd];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class iZ extends tZ{constructor(e){let{attributeManager:t,layer:r}=e;super(r),ye(this,"attributeManager",void 0),ye(this,"needsRedraw",void 0),ye(this,"needsUpdate",void 0),ye(this,"subLayers",void 0),ye(this,"usesPickingColorCache",void 0),ye(this,"hasPickingBuffer",void 0),ye(this,"changeFlags",void 0),ye(this,"viewport",void 0),ye(this,"uniformTransitions",void 0),ye(this,"propsInTransition",void 0),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,n=r==null?void 0:r.props.fetch;return n?n(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const n=r.props.onDataLoad;e==="data"&&n&&n(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const rZ="layer.changeFlag",nZ="layer.initialize",sZ="layer.update",oZ="layer.finalize",aZ="layer.matched",WM=2**24-1,lZ=Object.freeze([]),cZ=yy(i=>{let{oldViewport:e,viewport:t}=i;return e.equals(t)});let Vh=new Uint8ClampedArray(0);const uZ={data:{type:"data",value:lZ,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,e)=>{let{propName:t,layer:r,loaders:n,loadOptions:o,signal:l}=e;const{resourceManager:s}=r.context;if(o=o||r.getLoadOptions(),n=n||r.props.loaders,l){var g;o={...o,fetch:{...(g=o)===null||g===void 0?void 0:g.fetch,signal:l}}}let v=s.contains(i);return!v&&!o&&(s.add({resourceId:i,data:rd(i,n),persistent:!1}),v=!0),v?s.subscribe({resourceId:i,onChange:T=>{var F;return(F=r.internalState)===null||F===void 0?void 0:F.reloadAsyncProp(t,T)},consumerId:r.id,requestId:t}):rd(i,n,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Mn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:i=>{let{layerIndex:e}=i;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class ug extends dB{constructor(){super(...arguments),ye(this,"internalState",null),ye(this,"lifecycle",og.NO_STATE),ye(this,"context",void 0),ye(this,"state",void 0),ye(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){sl(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=aM(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,o,l]=YL(r,t.pixelProjectionMatrix);return e.length===2?[n,o]:[n,o,l]}unproject(e){return sl(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){sl(this.internalState);const r=this.internalState.viewport||this.context.viewport;return M$(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Mn.DEFAULT||e===Mn.LNGLAT||e===Mn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){sl(e instanceof Uint8Array);const[t,r,n]=e;return t+r*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:RW(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const t of this.props.extensions)e=UW(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const n of r)t.invalidateAll(n);else t.invalidateAll();if(t){const{props:n}=e,o=this.internalState.hasPickingBuffer,l=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(s=>s.getNeedsPickingBuffer.call(this,s));if(o!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:s,instancePickingColors:g}=t.attributes,v=s||g;v&&(l&&v.constant&&(v.constant=!1,t.invalidate(v.id)),!v.value&&!l&&(v.constant=!0,v.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo(e){let{info:t,mode:r,sourceLayer:n}=e;const{index:o}=t;return o>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[o]),t}raiseError(e,t){var r,n;if(t&&(e=new Error("".concat(t,": ").concat(e.message),{cause:e})),!((r=(n=this.props).onError)!==null&&r!==void 0&&r.call(n,e))){var o,l;(o=this.context)===null||o===void 0||(l=o.onError)===null||l===void 0||l.call(o,e,this)}}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!cZ({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),n=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const n in t)Object.defineProperty(r,n,{value:t[n]});return r}return this.props}calculateInstancePickingColors(e,t){let{numInstances:r}=t;if(e.constant)return;const n=Math.floor(Vh.length/3);if(this.internalState.usesPickingColorCache=!0,n<r){r>WM&&On.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Vh=vy.allocate(Vh,r,{size:3,copy:!0,maxCount:Math.max(r,WM)});const o=Math.floor(Vh.length/3),l=[];for(let s=n;s<o;s++)this.encodePickingColor(s,l),Vh[s*3+0]=l[0],Vh[s*3+1]=l[1],Vh[s*3+2]=l[2]}e.value=Vh.subarray(0,r*3)}_setModelAttributes(e,t){const r=this.getAttributeManager(),n=e.userData.excludeAttributes||{},o=r.getShaderAttributes(t,n);e.setAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,o=r||n,l=o&&t.attributes&&t.attributes[o.id];if(l&&l.value){const s=l.value,g=this.encodePickingColor(e);for(let v=0;v<t.length;v++){const T=o.getVertexOffset(v);s[T]===g[0]&&s[T+1]===g[1]&&s[T+2]===g[2]&&this._disablePickingIndex(v)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;if(!n)return;const o=n.getVertexOffset(e),l=n.getVertexOffset(e+1);n.buffer.subData({data:new Uint8Array(l-o),offset:o})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Vh.buffer&&(r.value=Vh.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){sl(!this.internalState),sl(Number.isFinite(this.props.coordinateSystem)),Sl(nZ,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new iZ({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(On.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new EW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Sl(aZ,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Sl(sZ,this,e),!e)return;const t=this.props,r=this.context,n=this.internalState,o=r.viewport,l=this._updateUniformTransition();n.propsInTransition=l,r.viewport=n.viewport||o,this.props=l;try{const s=this._getUpdateParams(),g=this.getModels();if(r.gl)this.updateState(s);else try{this.updateState(s)}catch{}for(const T of this.props.extensions)T.updateState.call(this,s,T);const v=this.getModels()[0]!==g[0];this._postUpdate(s,v)}finally{r.viewport=o,this.props=t,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){Sl(oZ,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{moduleParameters:t=null,uniforms:r={},parameters:n={}}=e;this._updateAttributeTransition();const o=this.props,l=this.context;this.props=this.internalState.propsInTransition||o;const s=this.props.opacity;r.opacity=Math.pow(s,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:g}=this.props,v=g&&g(r)||[0,0];xA(l.gl,{polygonOffset:v}),Yu(l.gl,n,()=>{const T={moduleParameters:t,uniforms:r,parameters:n,context:l};for(const F of this.props.extensions)F.draw.call(this,T,F);this.draw(T)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let o=!1;switch(n){case"dataChanged":const l=e[n],s=t[n];l&&Array.isArray(s)&&(t.dataChanged=Array.isArray(l)?s.concat(l):l,o=!0);default:t[n]||(t[n]=e[n],o=!0)}o&&Sl(rZ,this,n,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=TW(e,t);if(r.updateTriggersChanged)for(const o in r.updateTriggersChanged)r.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(r.transitionsChanged)for(const o in r.transitionsChanged){var n;this.internalState.uniformTransitions.add(o,t[o],e[o],(n=e.transitions)===null||n===void 0?void 0:n[o])}return this.setChangeFlags(r)}validateProps(){SW(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.pickingHighlightColor=r(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new bW(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:n}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:o}=this.state;o==null||o.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:s,highlightColor:g}=r;if(t||n.autoHighlight!==l||n.highlightedObjectIndex!==s||n.highlightColor!==g){const v={};l||(v.pickingSelectedColor=null),Array.isArray(g)&&(v.pickingHighlightColor=g),(t||s!==n.highlightedObjectIndex)&&(v.pickingSelectedColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setModuleParameters(v)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),n=r?r.getNeedsRedraw(e):!1;if(t=t||n,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ye(ug,"defaultProps",uZ),ye(ug,"layerName","Layer");const hZ="compositeLayer.renderLayers";class ZM extends ug{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:t}=e;const{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,n)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,n)}return e}getSubLayerProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t;const{opacity:r,pickable:n,visible:o,parameters:l,getPolygonOffset:s,highlightedObjectIndex:g,autoHighlight:v,highlightColor:T,coordinateSystem:F,coordinateOrigin:R,wrapLongitude:U,positionFormat:J,modelMatrix:te,extensions:Ae,fetch:he,operation:pe,_subLayerProps:be}=this.props,Te={id:"",updateTriggers:{},opacity:r,pickable:n,visible:o,parameters:l,getPolygonOffset:s,highlightedObjectIndex:g,autoHighlight:v,highlightColor:T,coordinateSystem:F,coordinateOrigin:R,wrapLongitude:U,positionFormat:J,modelMatrix:te,extensions:Ae,fetch:he,operation:pe},qe=be&&e.id&&be[e.id],je=qe&&qe.updateTriggers,We=e.id||"sublayer";if(qe){const Ne=this.props[cd],at=e.type?e.type._propTypes:{};for(const nt in qe){const ke=at[nt]||Ne[nt];ke&&ke.type==="accessor"&&(qe[nt]=this.getSubLayerAccessor(qe[nt]))}}Object.assign(Te,e,qe),Te.id="".concat(this.props.id,"-").concat(We),Te.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...je};for(const Ne of Ae){const at=Ne.getSubLayerProps.call(this,Ne);at&&Object.assign(Te,at,{updateTriggers:Object.assign(Te.updateTriggers,at.updateTriggers)})}return Te}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const n=!r||this.needsUpdate();if(n){const o=this.renderLayers();r=b1(o,Boolean),this.internalState.subLayers=r}Sl(hZ,this,n,r);for(const o of r)o.parent=this}}ye(ZM,"layerName","CompositeLayer");const fB=512,AZ=Math.PI/180;function dZ(i){let{map:e,gl:t,deck:r}=i;if(e.__deck)return e.__deck;const n=r==null?void 0:r.props._customRender,o=r==null?void 0:r.props.onLoad,l=pZ({...r==null?void 0:r.props,_customRender:()=>{e.triggerRepaint(),n==null||n("")}});let s;return(!r||r.props.gl===t)&&(Object.assign(l,{gl:t,width:null,height:null,touchAction:"unset",viewState:pB(e)}),r!=null&&r.isInitialized?XM(r,e):l.onLoad=()=>{o==null||o(),XM(s,e)}),r?(s=r,r.setProps(l),r.userData.isExternal=!0):(s=new rB(l),e.on("remove",()=>{fZ(e)})),s.userData.mapboxLayers=new Set,e.__deck=s,e.on("render",()=>{s.isInitialized&&bZ(s,e)}),s}function XM(i,e){const t=()=>{i.isInitialized?xZ(i,e):e.off("move",t)};e.on("move",t)}function fZ(i){var e;(e=i.__deck)===null||e===void 0||e.finalize(),i.__deck=null}function pZ(i){return{...i,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...i.parameters},views:i.views||[new Z2({id:"mapbox"})]}}function gZ(i,e){i.userData.mapboxLayers.add(e),gB(i)}function mZ(i,e){i.userData.mapboxLayers.delete(e),gB(i)}function yZ(i,e){gB(i)}function _Z(i,e,t){let{currentViewport:r}=i.userData,n=!1;r||(r=JM(i,e,!0),i.userData.currentViewport=r,n=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:o=>{let{layer:l}=o;return t.id===l.id||l.props.operation.includes("terrain")},clearStack:n,clearCanvas:!1})}function pB(i){var e;const{lng:t,lat:r}=i.getCenter(),n={longitude:(t+540)%360-180,latitude:r,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(e=i.getTerrain)!==null&&e!==void 0&&e.call(i)&&vZ(i,n),n}function vZ(i,e){if(i.getFreeCameraOptions){const{position:t}=i.getFreeCameraOptions();if(!t||t.z===void 0)return;const r=i.transform.height,{longitude:n,latitude:o,pitch:l}=e,s=t.x*fB,g=(1-t.y)*fB,v=t.z*fB,T=_y([n,o]),F=s-T[0],R=g-T[1],U=Math.sqrt(F*F+R*R),J=l*AZ,te=1.5*r,Ae=J<.001?te*Math.cos(J)/v:te*Math.sin(J)/U;e.zoom=Math.log2(Ae);const he=te*Math.cos(J)/Ae,pe=v-he;e.position=[0,0,pe/y1(o)]}else typeof i.transform.elevation=="number"&&(e.position=[0,0,i.transform.elevation])}function JM(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new bf({id:"mapbox",x:0,y:0,width:i.width,height:i.height,...pB(e),nearZMultiplier:t?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function bZ(i,e){const{mapboxLayers:t,isExternal:r}=i.userData;if(r){const n=Array.from(t,T=>T.id),l=b1(i.props.layers,Boolean).some(T=>T&&!n.includes(T.id));let s=i.getViewports();const g=s.findIndex(T=>T.id==="mapbox"),v=s.length>1||g<0;(l||v)&&(g>=0&&(s=s.slice(),s[g]=JM(i,e,!1)),i._drawLayers("mapbox-repaint",{viewports:s,layerFilter:T=>(!i.props.layerFilter||i.props.layerFilter(T))&&(T.viewport.id!=="mapbox"||!n.includes(T.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function xZ(i,e){i.setProps({viewState:pB(e)}),i.needsRedraw({clearRedrawFlags:!0})}function gB(i){if(i.userData.isExternal)return;const e=[];i.userData.mapboxLayers.forEach(t=>{const r=t.props.type,n=new r(t.props);e.push(n)}),i.setProps({layers:e})}class wZ{constructor(e){if(ye(this,"id",void 0),ye(this,"type",void 0),ye(this,"renderingMode",void 0),ye(this,"map",void 0),ye(this,"deck",void 0),ye(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=dZ({map:e,gl:t,deck:this.props.deck}),gZ(this.deck,this)}onRemove(){this.deck&&mZ(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&yZ(this.deck)}render(){_Z(this.deck,this.map,this)}}const BZ=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,CZ=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,YM=[0,0,0,255],eP=[0,0,1],EZ={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:i=>i.position},getNormal:{type:"accessor",value:eP},getColor:{type:"accessor",value:YM},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function SZ(i){const{header:e,attributes:t}=i;!e||!t||(i.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0&&(t.instanceColors=t.COLOR_0))}class mB extends ug{getShaders(){return super.getShaders({vs:BZ,fs:CZ,modules:[$2,eq,K2]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:eP},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:YM}})}updateState(e){const{changeFlags:t,props:r}=e;if(super.updateState(e),t.extensionsChanged){var n;const{gl:o}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}t.dataChanged&&SZ(r.data)}draw(e){let{uniforms:t}=e;const{pointSize:r,sizeUnits:n}=this.props;this.state.model.setUniforms(t).setUniforms({sizeUnits:Hw[n],radiusPixels:r}).draw()}_getModel(e){const t=[];for(let r=0;r<3;r++){const n=r/3*Math.PI*2;t.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new eg(e,{...this.getShaders(),id:this.props.id,geometry:new my({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}ye(mB,"layerName","PointCloudLayer"),ye(mB,"defaultProps",EZ);const ru={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Ut,new Ut;const Ey=new Ut,tP=new Ut;class Sy{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ye(this,"center",void 0),ye(this,"radius",void 0),this.radius=-0,this.center=new Ut,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Ey.from(t),this.center=new Ut().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Sy(this.center,this.radius)}union(e){const t=this.center,r=this.radius,n=e.center,o=e.radius,l=Ey.copy(n).subtract(t),s=l.magnitude();if(r>=s+o)return this.clone();if(o>=s+r)return e.clone();const g=(r+s+o)*.5;return tP.copy(l).scale((-r+g)/s).add(t),this.center.copy(tP),this.radius=g,this}expand(e){const r=Ey.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const t=uj(Ey,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const r=Ey.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const t=this.center,r=this.radius,o=e.normal.dot(t)+e.distance;return o<-r?ru.OUTSIDE:o<r?ru.INTERSECTING:ru.INSIDE}}const TZ=new Ut,IZ=new Ut,T1=new Ut,I1=new Ut,L1=new Ut,LZ=new Ut,MZ=new Ut,IA={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Ty{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];ye(this,"center",void 0),ye(this,"halfAxes",void 0),this.center=new Ut().from(e),this.halfAxes=new wo(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Ut(e).len(),new Ut(t).len(),new Ut(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new Ut(e).normalize(),o=new Ut(t).normalize(),l=new Ut(r).normalize();return new fy().fromMatrix3(new wo([...n,...o,...l]))}fromCenterHalfSizeQuaternion(e,t,r){const n=new fy(r),o=new wo().fromQuaternion(n);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new Ut().from(e),this.halfAxes=o,this}clone(){return new Ty(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Sy;const t=this.halfAxes,r=t.getColumn(0,T1),n=t.getColumn(1,I1),o=t.getColumn(2,L1),l=TZ.copy(r).add(n).add(o);return e.center.copy(this.center),e.radius=l.magnitude(),e}intersectPlane(e){const t=this.center,r=e.normal,n=this.halfAxes,o=r.x,l=r.y,s=r.z,g=Math.abs(o*n[IA.COLUMN0ROW0]+l*n[IA.COLUMN0ROW1]+s*n[IA.COLUMN0ROW2])+Math.abs(o*n[IA.COLUMN1ROW0]+l*n[IA.COLUMN1ROW1]+s*n[IA.COLUMN1ROW2])+Math.abs(o*n[IA.COLUMN2ROW0]+l*n[IA.COLUMN2ROW1]+s*n[IA.COLUMN2ROW2]),v=r.dot(t)+e.distance;return v<=-g?ru.OUTSIDE:v>=g?ru.INSIDE:ru.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=IZ.from(e).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,T1),o=r.getColumn(1,I1),l=r.getColumn(2,L1),s=n.magnitude(),g=o.magnitude(),v=l.magnitude();n.normalize(),o.normalize(),l.normalize();let T=0,F;return F=Math.abs(t.dot(n))-s,F>0&&(T+=F*F),F=Math.abs(t.dot(o))-g,F>0&&(T+=F*F),F=Math.abs(t.dot(l))-v,F>0&&(T+=F*F),T}computePlaneDistances(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const l=this.center,s=this.halfAxes,g=s.getColumn(0,T1),v=s.getColumn(1,I1),T=s.getColumn(2,L1),F=LZ.copy(g).add(v).add(T).add(l),R=MZ.copy(F).subtract(e);let U=t.dot(R);return n=Math.min(U,n),o=Math.max(U,o),F.copy(l).add(g).add(v).subtract(T),R.copy(F).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),F.copy(l).add(g).subtract(v).add(T),R.copy(F).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),F.copy(l).add(g).subtract(v).subtract(T),R.copy(F).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),l.copy(F).subtract(g).add(v).add(T),R.copy(F).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),l.copy(F).subtract(g).add(v).subtract(T),R.copy(F).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),l.copy(F).subtract(g).subtract(v).add(T),R.copy(F).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),l.copy(F).subtract(g).subtract(v).subtract(T),R.copy(F).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),r[0]=n,r[1]=o,r}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,T1);t.transformAsPoint(e);const r=this.halfAxes.getColumn(1,I1);r.transformAsPoint(e);const n=this.halfAxes.getColumn(2,L1);return n.transformAsPoint(e),this.halfAxes=new wo([...t,...r,...n]),this}getTransform(){throw new Error("not implemented")}}const iP=new Ut,rP=new Ut;class nh{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ye(this,"normal",void 0),ye(this,"distance",void 0),this.normal=new Ut,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return eh(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=iP.from(e),this.normal.from(t).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,n){return this.normal.set(e,t,r),eh(th(this.normal.len(),1)),this.distance=n,this}clone(){return new nh(this.normal,this.distance)}equals(e){return th(this.distance,e.distance)&&th(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=rP.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];e=iP.from(e);const r=this.getPointDistance(e),n=rP.copy(this.normal).scale(r);return e.subtract(n).to(t)}}const nP=[new Ut([1,0,0]),new Ut([0,1,0]),new Ut([0,0,1])],sP=new Ut,PZ=new Ut;new nh(new Ut(1,0,0),0);class Su{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];ye(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*nP.length;const t=e.center,r=e.radius;let n=0;for(const o of nP){let l=this.planes[n],s=this.planes[n+1];l||(l=this.planes[n]=new nh),s||(s=this.planes[n+1]=new nh);const g=sP.copy(o).scale(-r).add(t);-o.dot(g),l.fromPointNormal(g,o);const v=sP.copy(o).scale(r).add(t),T=PZ.copy(o).negate();-T.dot(v),s.fromPointNormal(v,T),n+=2}return this}computeVisibility(e){let t=ru.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case ru.OUTSIDE:return ru.OUTSIDE;case ru.INTERSECTING:t=ru.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(eh(Number.isFinite(t),"parentPlaneMask is required."),t===Su.MASK_OUTSIDE||t===Su.MASK_INSIDE)return t;let r=Su.MASK_INSIDE;const n=this.planes;for(let o=0;o<this.planes.length;++o){const l=o<31?1<<o:0;if(o<31&&!(t&l))continue;const s=n[o],g=e.intersectPlane(s);if(g===ru.OUTSIDE)return Su.MASK_OUTSIDE;g===ru.INTERSECTING&&(r|=l)}return r}}ye(Su,"MASK_OUTSIDE",4294967295),ye(Su,"MASK_INSIDE",0),ye(Su,"MASK_INDETERMINATE",2147483647),new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut;const Hh=new wo,FZ=new wo,DZ=new wo,M1=new wo,oP=new wo;function RZ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=py.EPSILON20,r=10;let n=0,o=0;const l=FZ,s=DZ;l.identity(),s.copy(i);const g=t*kZ(s);for(;o<r&&OZ(s)>g;)UZ(s,M1),oP.copy(M1).transpose(),s.multiplyRight(M1),s.multiplyLeft(oP),l.multiplyRight(M1),++n>2&&(++o,n=0);return e.unitary=l.toTarget(e.unitary),e.diagonal=s.toTarget(e.diagonal),e}function kZ(i){let e=0;for(let t=0;t<9;++t){const r=i[t];e+=r*r}return Math.sqrt(e)}const yB=[1,0,0],_B=[2,2,1];function OZ(i){let e=0;for(let t=0;t<3;++t){const r=i[Hh.getElementIndex(_B[t],yB[t])];e+=2*r*r}return Math.sqrt(e)}function UZ(i,e){const t=py.EPSILON15;let r=0,n=1;for(let v=0;v<3;++v){const T=Math.abs(i[Hh.getElementIndex(_B[v],yB[v])]);T>r&&(n=v,r=T)}const o=yB[n],l=_B[n];let s=1,g=0;if(Math.abs(i[Hh.getElementIndex(l,o)])>t){const v=i[Hh.getElementIndex(l,l)],T=i[Hh.getElementIndex(o,o)],F=i[Hh.getElementIndex(l,o)],R=(v-T)/2/F;let U;R<0?U=-1/(-R+Math.sqrt(1+R*R)):U=1/(R+Math.sqrt(1+R*R)),s=1/Math.sqrt(1+U*U),g=U*s}return wo.IDENTITY.to(e),e[Hh.getElementIndex(o,o)]=e[Hh.getElementIndex(l,l)]=s,e[Hh.getElementIndex(l,o)]=g,e[Hh.getElementIndex(o,l)]=-g,e}const fd=new Ut,NZ=new Ut,zZ=new Ut,QZ=new Ut,VZ=new Ut,HZ=new wo,GZ={diagonal:new wo,unitary:new wo};function jZ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Ty;if(!i||i.length===0)return e.halfAxes=new wo([0,0,0,0,0,0,0,0,0]),e.center=new Ut,e;const t=i.length,r=new Ut(0,0,0);for(const at of i)r.add(at);const n=1/t;r.multiplyByScalar(n);let o=0,l=0,s=0,g=0,v=0,T=0;for(const at of i){const nt=fd.copy(at).subtract(r);o+=nt.x*nt.x,l+=nt.x*nt.y,s+=nt.x*nt.z,g+=nt.y*nt.y,v+=nt.y*nt.z,T+=nt.z*nt.z}o*=n,l*=n,s*=n,g*=n,v*=n,T*=n;const F=HZ;F[0]=o,F[1]=l,F[2]=s,F[3]=l,F[4]=g,F[5]=v,F[6]=s,F[7]=v,F[8]=T;const{unitary:R}=RZ(F,GZ),U=e.halfAxes.copy(R);let J=U.getColumn(0,zZ),te=U.getColumn(1,QZ),Ae=U.getColumn(2,VZ),he=-Number.MAX_VALUE,pe=-Number.MAX_VALUE,be=-Number.MAX_VALUE,Te=Number.MAX_VALUE,qe=Number.MAX_VALUE,je=Number.MAX_VALUE;for(const at of i)fd.copy(at),he=Math.max(fd.dot(J),he),pe=Math.max(fd.dot(te),pe),be=Math.max(fd.dot(Ae),be),Te=Math.min(fd.dot(J),Te),qe=Math.min(fd.dot(te),qe),je=Math.min(fd.dot(Ae),je);J=J.multiplyByScalar(.5*(Te+he)),te=te.multiplyByScalar(.5*(qe+pe)),Ae=Ae.multiplyByScalar(.5*(je+be)),e.center.copy(J).add(te).add(Ae);const We=NZ.set(he-Te,pe-qe,be-je).multiplyByScalar(.5),Ne=new wo([We[0],0,0,0,We[1],0,0,0,We[2]]);return e.halfAxes.multiplyRight(Ne),e}const vB=Math.PI/180,P1=new Float32Array(16),aP=new Float32Array(12);function lP(i,e,t){const r=e[0]*vB,n=e[1]*vB,o=e[2]*vB,l=Math.sin(o),s=Math.sin(r),g=Math.sin(n),v=Math.cos(o),T=Math.cos(r),F=Math.cos(n),R=t[0],U=t[1],J=t[2];i[0]=R*F*T,i[1]=R*g*T,i[2]=R*-s,i[3]=U*(-g*v+F*s*l),i[4]=U*(F*v+g*s*l),i[5]=U*T*l,i[6]=J*(g*l+F*s*v),i[7]=J*(-F*l+g*s*v),i[8]=J*T*v}function cP(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const uP={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,e){let{startRow:t,endRow:r}=e;const{data:n,getOrientation:o,getScale:l,getTranslation:s,getTransformMatrix:g}=this.props,v=Array.isArray(g),T=v&&g.length===16,F=Array.isArray(l),R=Array.isArray(o),U=Array.isArray(s),J=T||!v&&!!g(n[0]);J?i.constant=T:i.constant=R&&F&&U;const te=i.value;if(i.constant){let Ae;J?(P1.set(g),Ae=cP(P1)):(Ae=aP,lP(Ae,o,l),Ae.set(s,9)),i.value=new Float32Array(Ae)}else{let Ae=t*i.size;const{iterable:he,objectInfo:pe}=RM(n,t,r);for(const be of he){pe.index++;let Te;if(J)P1.set(T?g:g(be,pe)),Te=cP(P1);else{Te=aP;const qe=R?o:o(be,pe),je=F?l:l(be,pe);lP(Te,qe,je),Te.set(U?s:s(be,pe),9)}te[Ae++]=Te[0],te[Ae++]=Te[1],te[Ae++]=Te[2],te[Ae++]=Te[3],te[Ae++]=Te[4],te[Ae++]=Te[5],te[Ae++]=Te[6],te[Ae++]=Te[7],te[Ae++]=Te[8],te[Ae++]=Te[9],te[Ae++]=Te[10],te[Ae++]=Te[11]}}}};function hP(i,e){return e===Mn.CARTESIAN||e===Mn.METER_OFFSETS||e===Mn.DEFAULT&&!i.isGeospatial}const qZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,$Z=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function AP(i){let e=1/0,t=1/0,r=1/0,n=-1/0,o=-1/0,l=-1/0;const s=i.POSITION?i.POSITION.value:[],g=s&&s.length;for(let v=0;v<g;v+=3){const T=s[v],F=s[v+1],R=s[v+2];e=T<e?T:e,t=F<t?F:t,r=R<r?R:r,n=T>n?T:n,o=F>o?F:o,l=R>l?R:l}return[[e,t,r],[n,o,l]]}function KZ(i,e){if(!i)throw new Error(e||"loader assertion failed.")}class hg{constructor(e,t){ye(this,"fields",void 0),ye(this,"metadata",void 0),KZ(Array.isArray(e)),WZ(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(){const e=Object.create(null);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(const l of r)e[l]=!0;const o=this.fields.filter(l=>e[l.name]);return new hg(o,this.metadata)}selectAt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.map(o=>this.fields[o]).filter(Boolean);return new hg(n,this.metadata)}assign(e){let t,r=this.metadata;if(e instanceof hg){const l=e;t=l.fields,r=dP(dP(new Map,this.metadata),l.metadata)}else t=e;const n=Object.create(null);for(const l of this.fields)n[l.name]=l;for(const l of t)n[l.name]=l;const o=Object.values(n);return new hg(o,r)}}function WZ(i){const e={};for(const t of i)e[t.name]&&console.warn("Schema: duplicated field name",t.name,t),e[t.name]=!0}function dP(i,e){return new Map([...i||new Map,...e||new Map])}class F1{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;ye(this,"name",void 0),ye(this,"type",void 0),ye(this,"nullable",void 0),ye(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=r,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new F1(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Bo=function(i){return i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i}({}),fP,pP,gP;class bB{static isNull(e){return e&&e.typeId===Bo.Null}static isInt(e){return e&&e.typeId===Bo.Int}static isFloat(e){return e&&e.typeId===Bo.Float}static isBinary(e){return e&&e.typeId===Bo.Binary}static isUtf8(e){return e&&e.typeId===Bo.Utf8}static isBool(e){return e&&e.typeId===Bo.Bool}static isDecimal(e){return e&&e.typeId===Bo.Decimal}static isDate(e){return e&&e.typeId===Bo.Date}static isTime(e){return e&&e.typeId===Bo.Time}static isTimestamp(e){return e&&e.typeId===Bo.Timestamp}static isInterval(e){return e&&e.typeId===Bo.Interval}static isList(e){return e&&e.typeId===Bo.List}static isStruct(e){return e&&e.typeId===Bo.Struct}static isUnion(e){return e&&e.typeId===Bo.Union}static isFixedSizeBinary(e){return e&&e.typeId===Bo.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===Bo.FixedSizeList}static isMap(e){return e&&e.typeId===Bo.Map}static isDictionary(e){return e&&e.typeId===Bo.Dictionary}get typeId(){return Bo.NONE}compareTo(e){return this===e}}fP=Symbol.toStringTag;class Ag extends bB{constructor(e,t){super(),ye(this,"isSigned",void 0),ye(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return Bo.Int}get[fP](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class ZZ extends Ag{constructor(){super(!0,8)}}class XZ extends Ag{constructor(){super(!0,16)}}class JZ extends Ag{constructor(){super(!0,32)}}class YZ extends Ag{constructor(){super(!1,8)}}class eX extends Ag{constructor(){super(!1,16)}}class tX extends Ag{constructor(){super(!1,32)}}const mP={HALF:16,SINGLE:32,DOUBLE:64};pP=Symbol.toStringTag;class yP extends bB{constructor(e){super(),ye(this,"precision",void 0),this.precision=e}get typeId(){return Bo.Float}get[pP](){return"Float"}toString(){return"Float".concat(this.precision)}}class iX extends yP{constructor(){super(mP.SINGLE)}}class rX extends yP{constructor(){super(mP.DOUBLE)}}gP=Symbol.toStringTag;class nX extends bB{constructor(e,t){super(),ye(this,"listSize",void 0),ye(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return Bo.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[gP](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function sX(i){switch(i.constructor){case Int8Array:return new ZZ;case Uint8Array:return new YZ;case Int16Array:return new XZ;case Uint16Array:return new eX;case Int32Array:return new JZ;case Uint32Array:return new tX;case Float32Array:return new iX;case Float64Array:return new rX;default:throw new Error("array type not supported")}}function oX(i,e,t){const r=sX(e.value),n=t||aX(e);return new F1(i,new nX(e.size,new F1("value",r)),!1,n)}function aX(i){const e=new Map;return"byteOffset"in i&&e.set("byteOffset",i.byteOffset.toString(10)),"byteStride"in i&&e.set("byteStride",i.byteStride.toString(10)),"normalized"in i&&e.set("normalized",i.normalized.toString()),e}function _P(i,e){(i.COLOR_0||i.colors)&&e||(i.colors={constant:!0,value:new Float32Array([1,1,1])}),On.assert(i.positions||i.POSITION,'no "postions" or "POSITION" attribute in mesh')}function vP(i,e){if(i.attributes)return _P(i.attributes,e),i instanceof my?i:new my(i);if(i.positions||i.POSITION)return _P(i,e),new my({attributes:i});throw Error("Invalid mesh")}const lX={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class xB extends ug{constructor(){super(...arguments),ye(this,"state",void 0)}getShaders(){const e=!dn(this.context.gl),t={};return r2(this.context.gl,Qs.GLSL_DERIVATIVES)&&(t.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:qZ,fs:$Z,modules:[$2,tq,K2],transpileToGLSL100:e,defines:t})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:r}=this.props;if(!r)return null;if(t=(e=r.header)===null||e===void 0?void 0:e.boundingBox,!t){const{attributes:n}=vP(r,this.props._useMeshColors);n.POSITION=n.POSITION||n.positions,t=AP(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:uP}),this.setState({emptyTexture:new Yc(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:n}=e;if(t.mesh!==r.mesh||n.extensionsChanged){var o;if(this.state.positionBounds=null,(o=this.state.model)===null||o===void 0||o.delete(),t.mesh){this.state.model=this.getModel(t.mesh);const l=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(l.NORMAL||l.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==r.texture&&this.setTexture(t.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw(e){let{uniforms:t}=e;if(!this.state.model)return;const{viewport:r}=this.context,{sizeScale:n,coordinateSystem:o,_instanced:l}=this.props;this.state.model.setUniforms(t).setUniforms({sizeScale:n,composeModelMatrix:!l||hP(r,o),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.model)&&super.isLoaded}getModel(e){const t=new eg(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:vP(e,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:n}=this.state;return t.setUniforms({sampler:r||n,hasTexture:!!r}),t}setTexture(e){const{emptyTexture:t,model:r}=this.state;r&&r.setUniforms({sampler:e||t,hasTexture:!!e})}}ye(xB,"defaultProps",lX),ye(xB,"layerName","SimpleMeshLayer");class dg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t}=e;this.id=t||wA(this.constructor.name),this.display=!0,this.position=new Ut,this.rotation=new Ut,this.scale=new Ut(1,1,1),this.matrix=new Sn,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return Xi(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return Xi(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return Xi(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:t,rotation:r,scale:n,update:o=!0}=e;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(r),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:t,rotation:r,scale:n}=e;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,t){Xi(e),t=t||this.matrix;const r=new Sn(e).multiplyRight(t),n=r.invert(),o=n.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:r,worldInverseMatrix:n,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Iy extends dg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:t=[]}=e;hr.assert(t.every(r=>r instanceof dg),"every child must an instance of ScenegraphNode"),super(e),this.children=t}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(e){const t=this.children,r=t.indexOf(e);return r>-1&&t.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((t,r)=>{let{worldMatrix:n}=r;const o=t.getBounds();if(!o)return;const[l,s]=o,g=new Ut(l).add(s).divide([2,2,2]);n.transformAsPoint(g,g);const v=new Ut(s).subtract(l).divide([2,2,2]);n.transformAsVector(v,v);for(let T=0;T<8;T++){const F=new Ut(T&1?-1:1,T&2?-1:1,T&4?-1:1).multiply(v).add(g);for(let R=0;R<3;R++)e[0][R]=Math.min(e[0][R],F[R]),e[1][R]=Math.max(e[1][R],F[R])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:t=new Sn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new Sn(t).multiplyRight(this.matrix);for(const n of this.children)n instanceof Iy?n.traverse(e,{worldMatrix:r}):e(n,{worldMatrix:r})}}const cX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},uX={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function bP(i){if(!i._animation){const e=uX[i.componentType],t=cX[i.type],r=t*i.count,{buffer:n,byteOffset:o}=i.bufferView.data,l=new e(n,o+(i.byteOffset||0),r);if(t===1)i._animation=Array.from(l);else{const s=[];for(let g=0;g<l.length;g+=t)s.push(Array.from(l.slice(g,g+t)));i._animation=s}}return i._animation}const hX=new Sn;function AX(i,e){if(e.matrix.identity(),i.translation&&e.matrix.translate(i.translation),i.rotation){const t=hX.fromQuaternion(i.rotation);e.matrix.multiplyRight(t)}i.scale&&e.matrix.scale(i.scale)}const wB=new fy;function dX(i,e,t,r,n){if(e==="rotation"){wB.slerp({start:t,target:r,ratio:n});for(let o=0;o<wB.length;o++)i[e][o]=wB[o]}else for(let o=0;o<t.length;o++)i[e][o]=n*r[o]+(1-n)*t[o]}function fX(i,e,t){let{p0:r,outTangent0:n,inTangent1:o,p1:l,tDiff:s,ratio:g}=t;for(let v=0;v<i[e].length;v++){const T=n[v]*s,F=o[v]*s;i[e][v]=(2*Math.pow(g,3)-3*Math.pow(g,2)+1)*r[v]+(Math.pow(g,3)-2*Math.pow(g,2)+g)*T+(-2*Math.pow(g,3)+3*Math.pow(g,2))*l[v]+(Math.pow(g,3)-Math.pow(g,2))*F}}function pX(i,e,t){for(let r=0;r<t.length;r++)i[e][r]=t[r]}function gX(i,e,t,r){let{input:n,interpolation:o,output:l}=e;const s=n[n.length-1],g=i%s,v=n.findIndex(U=>U>=g),T=Math.max(0,v-1);if(!Array.isArray(t[r]))switch(r){case"translation":t[r]=[0,0,0];break;case"rotation":t[r]=[0,0,0,1];break;case"scale":t[r]=[1,1,1];break;default:hr.warn("Bad animation path ".concat(r))()}Xi(t[r].length===l[T].length);const F=n[T],R=n[v];switch(o){case"STEP":pX(t,r,l[T]);break;case"LINEAR":if(R>F){const U=(g-F)/(R-F);dX(t,r,l[T],l[v],U)}break;case"CUBICSPLINE":if(R>F){const U=(g-F)/(R-F),J=R-F,te=l[3*T+1],Ae=l[3*T+2],he=l[3*v+0],pe=l[3*v+1];fX(t,r,{p0:te,outTangent0:Ae,inTangent1:he,p1:pe,tDiff:J,ratio:U})}break;default:hr.warn("Interpolation ".concat(o," not supported"))();break}}class mX{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(n=>{let{sampler:o,target:l,path:s}=n;gX(r,o,l,s),AX(l,l._node)})}}class yX{constructor(e){this.animations=e.animations.map((t,r)=>{const n=t.name||"Animation-".concat(r),o=t.samplers.map(s=>{let{input:g,interpolation:v="LINEAR",output:T}=s;return{input:bP(e.accessors[g]),interpolation:v,output:bP(e.accessors[T])}}),l=t.channels.map(s=>{let{sampler:g,target:v}=s;return{sampler:o[g],target:e.nodes[v.node],path:v.path}});return new mX({name:n,channels:l})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}class _X extends dg{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),this.onBeforeRender=null,this.AfterRender=null,e instanceof eg?(this.model=e,this._setModelNodeProps(t)):this.model=new eg(e,t),this.bounds=null,this.managedResources=t.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class xP{constructor(e,t){let{attributes:r,material:n,pbrDebug:o,imageBasedLightingEnvironment:l,lights:s,useTangents:g}=t;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},r2(e,Qs.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],l&&(this.uniforms.u_DiffuseEnvSampler=l.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=l.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=l.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),o&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&g,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(l,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(o,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(e,t){e&&(this.defines[t]=1)}parseTexture(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},o=e.texture.source.image;let l,s={};o.compressed?(l=o,s={[this.gl.TEXTURE_MIN_FILTER]:o.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):l={data:o};const g=new Yc(this.gl,{id:e.name||e.id,parameters:{...n,...s},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...l});this.uniforms[t]=g,this.defineIfPresent(r,r),this.generatedTextures.push(g)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:t=1,roughnessFactor:r=1}=e;this.uniforms.u_MetallicRoughnessValues=[t,r]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:t=1}=e.normalTexture;this.uniforms.u_NormalScale=t}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:t=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=t}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:t=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=t}else e.alphaMode==="BLEND"&&(hr.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const vX=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,bX=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function wP(i,e){return dn(i)?`#version 300 es
`.concat(e):e}function xX(i,e){const{id:t,drawMode:r,vertexCount:n,attributes:o,modelOptions:l}=e,s=new xP(i,e);hr.info(4,"createGLTFModel defines: ",s.defines)();const g=[];g.push(...s.generatedTextures),g.push(...Object.values(o).map(T=>T.buffer));const v=new _X(i,{id:t,drawMode:r,vertexCount:n,modules:[F2],parameters:s.parameters,vs:wP(i,vX),fs:wP(i,bX),managedResources:g,...l,defines:{...s.defines,...l.defines}});return v.setProps({attributes:o}),v.setUniforms(s.uniforms),v}const wX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BX={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class CX{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},BX,t)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new yX(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(o=>this.createNode(o));return new Iy({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(o=>this.createNode(o));e.mesh&&r.push(this.createMesh(e.mesh));const n=new Iy({id:e.name||e.id,children:r});if(e.matrix)n.setMatrix(e.matrix);else{if(n.matrix.identity(),e.translation&&n.matrix.translate(e.translation),e.rotation){const o=new Sn().fromQuaternion(e.rotation);n.matrix.multiplyRight(o)}e.scale&&n.matrix.scale(e.scale)}e._node=n}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((o,l)=>this.createPrimitive(o,l,e)),n=new Iy({id:e.name||e.id,children:r});e._mesh=n}return e._mesh}getVertexCount(e){hr.warn("getVertexCount() not found")()}createPrimitive(e,t,r){const n=xX(this.gl,Object.assign({id:e.name||"".concat(r.name||r.id,"-primitive-").concat(t),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return n.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],n}createAttributes(e,t){const r={};return Object.keys(e).forEach(n=>{r[n]=this.createAccessor(e[n],this.createBuffer(e[n],this.gl.ARRAY_BUFFER))}),t&&(r.indices=this.createAccessor(t,this.createBuffer(t,this.gl.ELEMENT_ARRAY_BUFFER))),hr.info(4,"glTF Attributes",{attributes:e,indices:t,generated:r})(),r}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[t]||(r.lumaBuffers[t]=new bs(this.gl,{id:"from-".concat(r.id),data:r.data||e.value,target:t})),r.lumaBuffers[t]}createAccessor(e,t){return new Lc({buffer:t,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:wX[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function EX(i,e,t){const r=new CX(i,t),n=r.instantiate(e),o=r.createAnimator();return{scenes:n,animator:o}}const SX="3.4.14",TX="3.4.14",BP="3.4.14",IX="https://unpkg.com/@loaders.gl/textures@".concat(BP,"/dist/libs/basis_encoder.wasm"),LX="https://unpkg.com/@loaders.gl/textures@".concat(BP,"/dist/libs/basis_encoder.js");let BB;async function CP(i){const e=i.modules||{};return e.basis?e.basis:(BB=BB||MX(i),await BB)}async function MX(i){let e=null,t=null;return[e,t]=await Promise.all([await df("basis_transcoder.js","textures",i),await df("basis_transcoder.wasm","textures",i)]),e=e||globalThis.BASIS,await PX(e,t)}function PX(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i(t).then(n=>{const{BasisFile:o,initializeBasis:l}=n;l(),r({BasisFile:o})})})}let CB;async function EP(i){const e=i.modules||{};return e.basisEncoder?e.basisEncoder:(CB=CB||FX(i),await CB)}async function FX(i){let e=null,t=null;return[e,t]=await Promise.all([await df(LX,"textures",i),await df(IX,"textures",i)]),e=e||globalThis.BASIS,await DX(e,t)}function DX(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i(t).then(n=>{const{BasisFile:o,KTX2File:l,initializeBasis:s,BasisEncoder:g}=n;s(),r({BasisFile:o,KTX2File:l,BasisEncoder:g})})})}const fg={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},RX=["","WEBKIT_","MOZ_"],SP={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let D1=null;function kX(i){if(!D1){i=i||OX()||void 0,D1=new Set;for(const e of RX)for(const t in SP)if(i&&i.getExtension("".concat(e).concat(t))){const r=SP[t];D1.add(r)}}return D1}function OX(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var TP,IP,LP,MP,PP,FP,DP,RP;(function(i){i[i.NONE=0]="NONE",i[i.BASISLZ=1]="BASISLZ",i[i.ZSTD=2]="ZSTD",i[i.ZLIB=3]="ZLIB"})(TP||(TP={})),function(i){i[i.BASICFORMAT=0]="BASICFORMAT"}(IP||(IP={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.ETC1S=163]="ETC1S",i[i.UASTC=166]="UASTC"}(LP||(LP={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.SRGB=1]="SRGB"}(MP||(MP={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.LINEAR=1]="LINEAR",i[i.SRGB=2]="SRGB",i[i.ITU=3]="ITU",i[i.NTSC=4]="NTSC",i[i.SLOG=5]="SLOG",i[i.SLOG2=6]="SLOG2"}(PP||(PP={})),function(i){i[i.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",i[i.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(FP||(FP={})),function(i){i[i.RGB=0]="RGB",i[i.RRR=3]="RRR",i[i.GGG=4]="GGG",i[i.AAA=15]="AAA"}(DP||(DP={})),function(i){i[i.RGB=0]="RGB",i[i.RGBA=3]="RGBA",i[i.RRR=4]="RRR",i[i.RRRG=5]="RRRG"}(RP||(RP={}));const nu=[171,75,84,88,32,50,48,187,13,10,26,10];function UX(i){const e=new Uint8Array(i);return!(e.byteLength<nu.length||e[0]!==nu[0]||e[1]!==nu[1]||e[2]!==nu[2]||e[3]!==nu[3]||e[4]!==nu[4]||e[5]!==nu[5]||e[6]!==nu[6]||e[7]!==nu[7]||e[8]!==nu[8]||e[9]!==nu[9]||e[10]!==nu[10]||e[11]!==nu[11])}const NX={etc1:{basisFormat:0,compressed:!0,format:fg.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:fg.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:fg.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:fg.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:fg.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:fg.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function zX(i,e){if(e.basis.containerFormat==="auto"){if(UX(i)){const r=await EP(e);return kP(r.KTX2File,i,e)}const{BasisFile:t}=await CP(e);return EB(t,i,e)}switch(e.basis.module){case"encoder":const t=await EP(e);switch(e.basis.containerFormat){case"ktx2":return kP(t.KTX2File,i,e);case"basis":default:return EB(t.BasisFile,i,e)}case"transcoder":default:const{BasisFile:r}=await CP(e);return EB(r,i,e)}}function EB(i,e,t){const r=new i(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const n=r.getNumImages(),o=[];for(let l=0;l<n;l++){const s=r.getNumLevels(l),g=[];for(let v=0;v<s;v++)g.push(QX(r,l,v,t));o.push(g)}return o}finally{r.close(),r.delete()}}function QX(i,e,t,r){const n=i.getImageWidth(e,t),o=i.getImageHeight(e,t),l=i.getHasAlpha(),{compressed:s,format:g,basisFormat:v}=OP(r,l),T=i.getImageTranscodedSizeInBytes(e,t,v),F=new Uint8Array(T);if(!i.transcodeImage(F,e,t,v,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:o,data:F,compressed:s,format:g,hasAlpha:l}}function kP(i,e,t){const r=new i(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=r.getLevels(),o=[];for(let l=0;l<n;l++){o.push(VX(r,l,t));break}return[o]}finally{r.close(),r.delete()}}function VX(i,e,t){const{alphaFlag:r,height:n,width:o}=i.getImageLevelInfo(e,0,0),{compressed:l,format:s,basisFormat:g}=OP(t,r),v=i.getImageTranscodedSizeInBytes(e,0,0,g),T=new Uint8Array(v);if(!i.transcodeImage(T,e,0,0,g,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:T,compressed:l,levelSize:v,hasAlpha:r,format:s}}function OP(i,e){let t=i&&i.basis&&i.basis.format;return t==="auto"&&(t=UP()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),NX[t]}function UP(){const i=kX();return i.has("astc")?"astc-4x4":i.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:i.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:i.has("etc1")?"etc1":i.has("etc2")?"etc2":"rgb565"}const HX={...{name:"Basis",id:_A?"basis":"basis-nodejs",module:"textures",version:TX,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:zX};function su(i,e){if(!i)throw new Error(e||"assert failed: gltf")}function NP(i,e){if(i.startsWith("data:")||i.startsWith("http:")||i.startsWith("https:"))return i;const r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(i));return r.substr(0,r.lastIndexOf("/")+1)+i}function GX(i,e,t){const r=i.bufferViews[t];su(r);const n=r.buffer,o=e[n];su(o);const l=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,l,r.byteLength)}const zP=["SCALAR","VEC2","VEC3","VEC4"],jX=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],qX=new Map(jX),$X={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},KX={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},WX={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function QP(i){return zP[i-1]||zP[0]}function VP(i){const e=qX.get(i.constructor);if(!e)throw new Error("Illegal typed array");return e}function SB(i,e){const t=WX[i.componentType],r=$X[i.type],n=KX[i.componentType],o=i.count*r,l=i.count*r*n;return su(l>=0&&l<=e.byteLength),{ArrayType:t,length:o,byteLength:l}}function HP(i){let{images:e,bufferViews:t}=i;e=e||[],t=t||[];const r=e.map(l=>l.bufferView);t=t.filter(l=>!r.includes(l));const n=t.reduce((l,s)=>l+s.byteLength,0),o=e.reduce((l,s)=>{const{width:g,height:v}=s.image;return l+g*v},0);return n+Math.ceil(4*o*1.33)}const ZX={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Mc{constructor(e){ye(this,"gltf",void 0),ye(this,"sourceBuffers",void 0),ye(this,"byteLength",void 0),this.gltf=e||{json:{...ZX},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find(n=>n===e),r=this.json.extensions||{};return t?r[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const r=this.json[e]&&this.json[e][t];if(!r)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,r=this.gltf.buffers[t];su(r);const n=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,{ArrayType:o,length:l}=SB(e,t),s=t.byteOffset+e.byteOffset;return new o(n,s,l)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(n,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){const n=e.extensions||{};n[t]=r}removeObjectExtension(e,t){const r=e.extensions||{},n=r[t];return delete r[t],n}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return su(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return su(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:r}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:r,material:n,mode:o=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(r){const g=this._addIndices(r);s.primitives[0].indices=g}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,t){const r=Rw(e),n=t||(r==null?void 0:r.mimeType),l={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(l),this.json.images.length-1}addBufferView(e){const t=e.byteLength;su(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=qm(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const r={bufferView:e,type:QP(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(e);let n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:VP(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,r={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const r=this.byteLength,n=new ArrayBuffer(r),o=new Uint8Array(n);let l=0;for(const s of this.sourceBuffers||[])l=bz(s,o,l);(e=this.json)!==null&&e!==void 0&&(t=e.buffers)!==null&&t!==void 0&&t[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(e,t){let r=!0;for(;r;){const n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const r in e){const n=e[r],o=this._getGltfAttributeName(r),l=this.addBinaryBuffer(n.value,n);t[o]=l}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const r={min:null,max:null};if(e.length<t)return r;r.min=[],r.max=[];const n=e.subarray(0,t);for(const o of n)r.min.push(o),r.max.push(o);for(let o=t;o<e.length;o+=t)for(let l=0;l<t;l++)r.min[0+l]=Math.min(r.min[0+l],e[o+l]),r.max[0+l]=Math.max(r.max[0+l],e[o+l]);return r}}const XX="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",JX="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",YX=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),eJ=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),tJ={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},iJ={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function rJ(i,e,t,r,n){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const l=await nJ();aJ(l,l.exports[iJ[n]],i,e,t,r,l.exports[tJ[o||"NONE"]])}let TB;async function nJ(){return TB||(TB=sJ()),TB}async function sJ(){let i=XX;WebAssembly.validate(YX)&&(i=JX,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(oJ(i),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function oJ(i){const e=new Uint8Array(i.length);for(let r=0;r<i.length;++r){const n=i.charCodeAt(r);e[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let t=0;for(let r=0;r<i.length;++r)e[t++]=e[r]<60?eJ[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,t)}function aJ(i,e,t,r,n,o,l){const s=i.exports.sbrk,g=r+3&-4,v=s(g*n),T=s(o.length),F=new Uint8Array(i.exports.memory.buffer);F.set(o,T);const R=e(v,r,n,T,o.length);if(R===0&&l&&l(v,g,n),t.set(F.subarray(v,v+r*n)),s(v-s(0)),R!==0)throw new Error("Malformed buffer data: ".concat(R))}const IB="EXT_meshopt_compression",lJ=IB;async function cJ(i,e){var t;const r=new Mc(i);if(!(e!=null&&(t=e.gltf)!==null&&t!==void 0&&t.decompressMeshes))return;const n=[];for(const o of i.json.bufferViews||[])n.push(uJ(r,o));await Promise.all(n),r.removeExtension(IB)}async function uJ(i,e){const t=i.getObjectExtension(e,IB);if(t){const{byteOffset:r=0,byteLength:n=0,byteStride:o,count:l,mode:s,filter:g="NONE",buffer:v}=t,T=i.gltf.buffers[v],F=new Uint8Array(T.arrayBuffer,T.byteOffset+r,n),R=new Uint8Array(i.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await rJ(R,l,o,F,s,g),R}return null}const hJ=Object.freeze(Object.defineProperty({__proto__:null,decode:cJ,name:lJ},Symbol.toStringTag,{value:"Module"})),pg="EXT_texture_webp",AJ=pg;function dJ(i,e){const t=new Mc(i);if(!mV("image/webp")){if(t.getRequiredExtensions().includes(pg))throw new Error("gltf: Required extension ".concat(pg," not supported by browser"));return}const{json:r}=t;for(const n of r.textures||[]){const o=t.getObjectExtension(n,pg);o&&(n.source=o.source),t.removeObjectExtension(n,pg)}t.removeExtension(pg)}const fJ=Object.freeze(Object.defineProperty({__proto__:null,name:AJ,preprocess:dJ},Symbol.toStringTag,{value:"Module"})),R1="KHR_texture_basisu",pJ=R1;function gJ(i,e){const t=new Mc(i),{json:r}=t;for(const n of r.textures||[]){const o=t.getObjectExtension(n,R1);o&&(n.source=o.source),t.removeObjectExtension(n,R1)}t.removeExtension(R1)}const mJ=Object.freeze(Object.defineProperty({__proto__:null,name:pJ,preprocess:gJ},Symbol.toStringTag,{value:"Module"})),yJ={name:"Draco",id:_A?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.14",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function _J(i,e,t){const r=jP(e.metadata),n=[],o=vJ(e.attributes);for(const l in i){const s=i[l],g=GP(l,s,o[l]);n.push(g)}if(t){const l=GP("indices",t);n.push(l)}return new hg(n,r)}function vJ(i){const e={};for(const t in i){const r=i[t];e[r.name||"undefined"]=r}return e}function GP(i,e,t){const r=t?jP(t.metadata):void 0;return oX(i,e,r)}function jP(i){const e=new Map;for(const t in i)e.set("".concat(t,".string"),JSON.stringify(i[t]));return e}const qP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},bJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},xJ=4;class wJ{constructor(e){ye(this,"draco",void 0),ye(this,"decoder",void 0),ye(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const n=this.decoder.GetEncodedGeometryType(r),o=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let l;switch(n){case this.draco.TRIANGULAR_MESH:l=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:l=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!l.ok()||!o.ptr){const R="DRACO decompression failed: ".concat(l.error_msg());throw new Error(R)}const s=this._getDracoLoaderData(o,n,t),g=this._getMeshData(o,s,t),v=AP(g.attributes),T=_J(g.attributes,s,g.indices);return{loader:"draco",loaderData:s,header:{vertexCount:o.num_points(),boundingBox:v},...g,schema:T}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,r){const n=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:o}}_getDracoAttributes(e,t){const r={};for(let n=0;n<e.num_attributes();n++){const o=this.decoder.GetAttribute(e,n),l=this._getAttributeMetadata(e,n);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:n,metadata:l};const s=this._getQuantizationTransform(o,t);s&&(r[o.unique_id()].quantization_transform=s);const g=this._getOctahedronTransform(o,t);g&&(r[o.unique_id()].octahedron_transform=g)}return r}_getMeshData(e,t,r){const n=this._getMeshAttributes(t,e,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,r){const n={};for(const o of Object.values(e.attributes)){const l=this._deduceAttributeName(o,r);o.name=l;const{value:s,size:g}=this._getAttributeValues(t,o);n[l]={value:s,size:g,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return n}_getTriangleListIndices(e){const r=e.num_faces()*3,n=r*xJ,o=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,o),new Uint32Array(this.draco.HEAPF32.buffer,o,r).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),EJ(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const r=bJ[t.data_type],n=t.num_components,l=e.num_points()*n,s=l*r.BYTES_PER_ELEMENT,g=BJ(this.draco,r);let v;const T=this.draco._malloc(s);try{const F=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,F,g,s,T),v=new r(this.draco.HEAPF32.buffer,T,l).slice()}finally{this.draco._free(T)}return{value:v,size:n}}_deduceAttributeName(e,t){const r=e.unique_id;for(const[l,s]of Object.entries(t.extraAttributes||{}))if(s===r)return l;const n=e.attribute_type;for(const l in qP)if(this.draco[l]===n)return qP[l];const o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const r=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},r=this.metadataQuerier.NumEntries(e);for(let n=0;n<r;n++){const o=this.metadataQuerier.GetEntryName(e,n);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);const n=CJ(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:r=[]}=e,n=[...t,...r];for(const o of n)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){const{quantizedAttributes:r=[]}=t,n=e.attribute_type();if(r.map(l=>this.decoder[l]).includes(n)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits(),range:l.range(),min_values:new Float32Array([1,2,3]).map(s=>l.min_value(s))}}finally{this.draco.destroy(l)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:r=[]}=t,n=e.attribute_type();if(r.map(l=>this.decoder[l]).includes(n)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits()}}finally{this.draco.destroy(l)}}return null}}function BJ(i,e){switch(e){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32;default:return i.DT_INVALID}}function CJ(i){const e=i.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=i.GetValue(r);return t}function EJ(i){const e=i.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=i.GetValue(r);return t}const LB="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),SJ="".concat(LB,"/draco_decoder.js"),TJ="".concat(LB,"/draco_wasm_wrapper.js"),IJ="".concat(LB,"/draco_decoder.wasm");let Ly;async function LJ(i){const e=i.modules||{};return e.draco3d?Ly=Ly||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):Ly=Ly||MJ(i),await Ly}async function MJ(i){let e,t;switch(i.draco&&i.draco.decoderType){case"js":e=await df(SJ,"draco",i);break;case"wasm":default:[e,t]=await Promise.all([await df(TJ,"draco",i),await df(IJ,"draco",i)])}return e=e||globalThis.DracoDecoderModule,await PJ(e,t)}function PJ(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i({...t,onModuleLoaded:n=>r({draco:n})})})}const $P={...yJ,parse:FJ};async function FJ(i,e){const{draco:t}=await LJ(e),r=new wJ(t);try{return r.parseSync(i,e==null?void 0:e.draco)}finally{r.destroy()}}function DJ(i){const e={};for(const t in i){const r=i[t];if(t!=="indices"){const n=KP(r);e[t]=n}}return e}function KP(i){const{buffer:e,size:t,count:r}=RJ(i);return{value:e,size:t,byteOffset:0,count:r,type:QP(t),componentType:VP(e)}}function RJ(i){let e=i,t=1,r=0;return i&&i.value&&(e=i.value,t=i.size||1),e&&(ArrayBuffer.isView(e)||(e=kJ(e,Float32Array)),r=e.length/t),{buffer:e,size:t,count:r}}function kJ(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return i?Array.isArray(i)?new e(i):t&&!(i instanceof e)?new e(i):i:null}const Cf="KHR_draco_mesh_compression",OJ=Cf;function UJ(i,e,t){const r=new Mc(i);for(const n of WP(r))r.getObjectExtension(n,Cf)}async function NJ(i,e,t){var r;if(!(e!=null&&(r=e.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const n=new Mc(i),o=[];for(const l of WP(n))n.getObjectExtension(l,Cf)&&o.push(QJ(n,l,e,t));await Promise.all(o),n.removeExtension(Cf)}function zJ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new Mc(i);for(const r of t.json.meshes||[])VJ(r,e),t.addRequiredExtension(Cf)}async function QJ(i,e,t,r){const n=i.getObjectExtension(e,Cf);if(!n)return;const o=i.getTypedArrayForBufferView(n.bufferView),l=vw(o.buffer,o.byteOffset),{parse:s}=r,g={...t};delete g["3d-tiles"];const v=await s(l,$P,g,r),T=DJ(v.attributes);for(const[F,R]of Object.entries(T))if(F in e.attributes){const U=e.attributes[F],J=i.getAccessor(U);J!=null&&J.min&&J!==null&&J!==void 0&&J.max&&(R.min=J.min,R.max=J.max)}e.attributes=T,v.indices&&(e.indices=KP(v.indices)),HJ(e)}function VJ(i,e){var t;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const l=n.DracoWriter.encodeSync({attributes:i}),s=o==null||(t=o.parseSync)===null||t===void 0?void 0:t.call(o,{attributes:i}),g=n._addFauxAttributes(s.attributes),v=n.addBufferView(l);return{primitives:[{attributes:g,mode:r,extensions:{[Cf]:{bufferView:v,attributes:g}}}]}}function HJ(i){if(!i.attributes&&Object.keys(i.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*WP(i){for(const e of i.json.meshes||[])for(const t of e.primitives)yield t}const GJ=Object.freeze(Object.defineProperty({__proto__:null,decode:NJ,encode:zJ,name:OJ,preprocess:UJ},Symbol.toStringTag,{value:"Module"})),jJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},MB="KHR_texture_transform",$J=MB,k1=new Ut,KJ=new wo,WJ=new wo;async function ZJ(i,e){if(!new Mc(i).getExtension(MB))return;const n=i.json.materials||[];for(let o=0;o<n.length;o++)XJ(o,i)}function XJ(i,e){var t,r,n;const o=[],l=(t=e.json.materials)===null||t===void 0?void 0:t[i],s=l==null||(r=l.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;s&&My(e,i,s,o);const g=l==null?void 0:l.emissiveTexture;g&&My(e,i,g,o);const v=l==null?void 0:l.normalTexture;v&&My(e,i,v,o);const T=l==null?void 0:l.occlusionTexture;T&&My(e,i,T,o);const F=l==null||(n=l.pbrMetallicRoughness)===null||n===void 0?void 0:n.metallicRoughnessTexture;F&&My(e,i,F,o)}function My(i,e,t,r){const n=JJ(t,r);if(!n)return;const o=i.json.meshes||[];for(const l of o)for(const s of l.primitives){const g=s.material;Number.isFinite(g)&&e===g&&YJ(i,s,n)}}function JJ(i,e){var t;const r=(t=i.extensions)===null||t===void 0?void 0:t[MB],{texCoord:n=0}=i,{texCoord:o=n}=r;if(!(e.findIndex(s=>{let[g,v]=s;return g===n&&v===o})!==-1)){const s=iY(r);return n!==o&&(i.texCoord=o),e.push([n,o]),{originalTexCoord:n,texCoord:o,matrix:s}}return null}function YJ(i,e,t){const{originalTexCoord:r,texCoord:n,matrix:o}=t,l=e.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(l)){var s;const v=(s=i.json.accessors)===null||s===void 0?void 0:s[l];if(v&&v.bufferView){var g;const T=(g=i.json.bufferViews)===null||g===void 0?void 0:g[v.bufferView];if(T){const{arrayBuffer:F,byteOffset:R}=i.buffers[T.buffer],U=(R||0)+(v.byteOffset||0)+(T.byteOffset||0),{ArrayType:J,length:te}=SB(v,T),Ae=qJ[v.componentType],he=jJ[v.type],pe=T.byteStride||Ae*he,be=new Float32Array(te);for(let Te=0;Te<v.count;Te++){const qe=new J(F,U+Te*pe,2);k1.set(qe[0],qe[1],1),k1.transformByMatrix3(o),be.set([k1[0],k1[1]],Te*he)}r===n?eY(v,T,i.buffers,be):tY(n,v,e,i,be)}}}}function eY(i,e,t,r){i.componentType=5126,t.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function tY(i,e,t,r,n){r.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const l=r.json.accessors;l&&(l.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes["TEXCOORD_".concat(i)]=l.length-1)}function iY(i){const{offset:e=[0,0],rotation:t=0,scale:r=[1,1]}=i,n=new wo().set(1,0,0,0,1,0,e[0],e[1],1),o=KJ.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),l=WJ.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(l)}const rY=Object.freeze(Object.defineProperty({__proto__:null,decode:ZJ,name:$J},Symbol.toStringTag,{value:"Module"})),Ef="KHR_lights_punctual",nY=Ef;async function sY(i){const e=new Mc(i),{json:t}=e,r=e.getExtension(Ef);r&&(e.json.lights=r.lights,e.removeExtension(Ef));for(const n of t.nodes||[]){const o=e.getObjectExtension(n,Ef);o&&(n.light=o.light),e.removeObjectExtension(n,Ef)}}async function oY(i){const e=new Mc(i),{json:t}=e;if(t.lights){const r=e.addExtension(Ef);su(!r.lights),r.lights=t.lights,delete t.lights}if(e.json.lights){for(const r of e.json.lights){const n=r.node;e.addObjectExtension(n,Ef,r)}delete e.json.lights}}const aY=Object.freeze(Object.defineProperty({__proto__:null,decode:sY,encode:oY,name:nY},Symbol.toStringTag,{value:"Module"})),Py="KHR_materials_unlit",lY=Py;async function cY(i){const e=new Mc(i),{json:t}=e;for(const r of t.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,Py);e.removeExtension(Py)}function uY(i){const e=new Mc(i),{json:t}=e;if(e.materials)for(const r of t.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,Py,{}),e.addExtension(Py))}const hY=Object.freeze(Object.defineProperty({__proto__:null,decode:cY,encode:uY,name:lY},Symbol.toStringTag,{value:"Module"})),Fy="KHR_techniques_webgl",AY=Fy;async function dY(i){const e=new Mc(i),{json:t}=e,r=e.getExtension(Fy);if(r){const n=pY(r,e);for(const o of t.materials||[]){const l=e.getObjectExtension(o,Fy);l&&(o.technique=Object.assign({},l,n[l.technique]),o.technique.values=gY(o.technique,e)),e.removeObjectExtension(o,Fy)}e.removeExtension(Fy)}}async function fY(i,e){}function pY(i,e){const{programs:t=[],shaders:r=[],techniques:n=[]}=i,o=new TextDecoder;return r.forEach(l=>{if(Number.isFinite(l.bufferView))l.code=o.decode(e.getTypedArrayForBufferView(l.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(l=>{l.fragmentShader=r[l.fragmentShader],l.vertexShader=r[l.vertexShader]}),n.forEach(l=>{l.program=t[l.program]}),n}function gY(i,e){const t=Object.assign({},i.values);return Object.keys(i.uniforms||{}).forEach(r=>{i.uniforms[r].value&&!(r in t)&&(t[r]=i.uniforms[r].value)}),Object.keys(t).forEach(r=>{typeof t[r]=="object"&&t[r].index!==void 0&&(t[r].texture=e.getTexture(t[r].index))}),t}const mY=Object.freeze(Object.defineProperty({__proto__:null,decode:dY,encode:fY,name:AY},Symbol.toStringTag,{value:"Module"})),ZP="EXT_feature_metadata",yY=ZP;async function _Y(i){const e=new Mc(i);vY(e)}function vY(i){var e;const t=i.getExtension(ZP),r=t==null||(e=t.schema)===null||e===void 0?void 0:e.classes,n=t==null?void 0:t.featureTables;if((t==null?void 0:t.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&n)for(const l in r){const s=r[l],g=wY(n,l);g&&bY(i,g,s)}}function bY(i,e,t){for(const n in t.properties){var r;const o=t.properties[n],l=e==null||(r=e.properties)===null||r===void 0?void 0:r[n],s=e.count;if(l){const g=xY(i,o,s,l);l.data=g}}}function xY(i,e,t,r){const n=r.bufferView;let o=i.getTypedArrayForBufferView(n);switch(e.type){case"STRING":{const l=r.stringOffsetBufferView,s=i.getTypedArrayForBufferView(l);o=BY(o,s,t);break}}return o}function wY(i,e){for(const t in i){const r=i[t];if(r.class===e)return r}return null}function BY(i,e,t){const r=[],n=new TextDecoder("utf8");let o=0;const l=4;for(let s=0;s<t;s++){const g=e[(s+1)*l]-e[s*l],v=i.subarray(o,g+o),T=n.decode(v);r.push(T),o+=g}return r}const XP=[hJ,fJ,mJ,GJ,aY,hY,mY,rY,Object.freeze(Object.defineProperty({__proto__:null,decode:_Y,name:yY},Symbol.toStringTag,{value:"Module"}))];function CY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const r=XP.filter(o=>JP(o.name,e));for(const o of r){var n;(n=o.preprocess)===null||n===void 0||n.call(o,i,e,t)}}async function EY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const r=XP.filter(o=>JP(o.name,e));for(const o of r){var n;await((n=o.decode)===null||n===void 0?void 0:n.call(o,i,e,t))}}function JP(i,e){var t;const r=(e==null||(t=e.gltf)===null||t===void 0?void 0:t.excludeExtensions)||{};return!(i in r&&!r[i])}const PB="KHR_binary_glTF";function SY(i){const e=new Mc(i),{json:t}=e;for(const r of t.images||[]){const n=e.getObjectExtension(r,PB);n&&Object.assign(r,n),e.removeObjectExtension(r,PB)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(PB)}const YP={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},TY={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class IY{constructor(){ye(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),ye(this,"json",void 0)}normalize(e,t){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),SY(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in YP)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const r=e[t];if(!(!r||Array.isArray(r))){e[t]=[];for(const n in r){const o=r[n];o.id=o.id||n;const l=e[t].length;e[t].push(o),this.idToIndexMap[t][n]=l}}}_convertObjectIdsToArrayIndices(e){for(const t in YP)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:r,indices:n,material:o}=t;for(const l in r)r[l]=this._convertIdToIndex(r[l],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const r of e[t])for(const n in r){const o=r[n],l=this._convertIdToIndex(o,n);r[n]=l}}_convertIdToIndex(e,t){const r=TY[t];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][e];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const o of e.materials){var t,r,n;o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const l=((t=o.values)===null||t===void 0?void 0:t.tex)||((r=o.values)===null||r===void 0?void 0:r.texture2d_0)||((n=o.values)===null||n===void 0?void 0:n.diffuseTex),s=e.textures.findIndex(g=>g.id===l);s!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:s})}}}function LY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new IY().normalize(i,e)}const MY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},PY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Tu={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},FY={magFilter:Tu.TEXTURE_MAG_FILTER,minFilter:Tu.TEXTURE_MIN_FILTER,wrapS:Tu.TEXTURE_WRAP_S,wrapT:Tu.TEXTURE_WRAP_T},DY={[Tu.TEXTURE_MAG_FILTER]:Tu.LINEAR,[Tu.TEXTURE_MIN_FILTER]:Tu.NEAREST_MIPMAP_LINEAR,[Tu.TEXTURE_WRAP_S]:Tu.REPEAT,[Tu.TEXTURE_WRAP_T]:Tu.REPEAT};function RY(i){return PY[i]}function kY(i){return MY[i]}class OY{constructor(){ye(this,"baseUri",""),ye(this,"json",{}),ye(this,"buffers",[]),ye(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:n=[],images:o=[],baseUri:l=""}=e;return su(r),this.baseUri=l,this.json=r,this.buffers=n,this.images=o,this._resolveTree(this.json,t),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((t,r)=>this._resolveBufferView(t,r))),e.images&&(e.images=e.images.map((t,r)=>this._resolveImage(t,r))),e.samplers&&(e.samplers=e.samplers.map((t,r)=>this._resolveSampler(t,r))),e.textures&&(e.textures=e.textures.map((t,r)=>this._resolveTexture(t,r))),e.accessors&&(e.accessors=e.accessors.map((t,r)=>this._resolveAccessor(t,r))),e.materials&&(e.materials=e.materials.map((t,r)=>this._resolveMaterial(t,r))),e.meshes&&(e.meshes=e.meshes.map((t,r)=>this._resolveMesh(t,r))),e.nodes&&(e.nodes=e.nodes.map((t,r)=>this._resolveNode(t,r))),e.skins&&(e.skins=e.skins.map((t,r)=>this._resolveSkin(t,r))),e.scenes&&(e.scenes=e.scenes.map((t,r)=>this._resolveScene(t,r))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if(typeof t=="object")return t;const r=this.json[e]&&this.json[e][t];return r||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),r}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map(r=>this.getNode(r)),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map(r=>this.getNode(r))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((r,n)=>{const o=this.getMesh(n);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map(r=>{r={...r};const n=r.attributes;r.attributes={};for(const o in n)r.attributes[o]=this.getAccessor(n[o]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||"accessor-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=RY(e.componentType),e.components=kY(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:n,byteLength:o}=SB(e,e.bufferView),l=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset;let s=r.arrayBuffer.slice(l,l+o);e.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(r,l,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new n(s)}return e}_getValueFromInterleavedBuffer(e,t,r,n,o){const l=new Uint8Array(o*n);for(let s=0;s<o;s++){const g=t+s*r;l.set(new Uint8Array(e.arrayBuffer.slice(g,g+n)),s*n)}return l.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):DY,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const r in e){const n=this._enumSamplerParameter(r);n!==void 0&&(e.parameters[n]=e[r])}return e}_enumSamplerParameter(e){return FY[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const r=this.images[t];return r&&(e.image=r),e}_resolveBufferView(e,t){const r=e.buffer,n={id:"bufferView-".concat(t),...e,buffer:this.buffers[r]},o=this.buffers[r].arrayBuffer;let l=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(l+=e.byteOffset),n.data=new Uint8Array(o,l,e.byteLength),n}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}function UY(i,e){return new OY().postProcess(i,e)}const eF=1735152710,FB=12,O1=8,NY=1313821514,zY=5130562,QY=0,VY=1,HY=0,gg=!0;function GY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(i.getUint8(e+0))).concat(String.fromCharCode(i.getUint8(e+1))).concat(String.fromCharCode(i.getUint8(e+2))).concat(String.fromCharCode(i.getUint8(e+3)))}function jY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(i),{magic:n=eF}=t,o=r.getUint32(e,!1);return o===n||o===eF}function qY(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e),n=GY(r,t+0),o=r.getUint32(t+4,gg),l=r.getUint32(t+8,gg);switch(Object.assign(i,{header:{byteOffset:t,byteLength:l,hasBinChunk:!1},type:n,version:o,json:{},binChunks:[]}),t+=FB,i.version){case 1:return $Y(i,r,t);case 2:return KY(i,r,t,{});default:throw new Error("Invalid GLB version ".concat(i.version,". Only supports v1 and v2."))}}function $Y(i,e,t){Ts(i.header.byteLength>FB+O1);const r=e.getUint32(t+0,gg),n=e.getUint32(t+4,gg);return t+=O1,Ts(n===HY),DB(i,e,t,r),t+=r,t+=RB(i,e,t,i.header.byteLength),t}function KY(i,e,t,r){return Ts(i.header.byteLength>FB+O1),WY(i,e,t,r),t+i.header.byteLength}function WY(i,e,t,r){for(;t+8<=i.header.byteLength;){const n=e.getUint32(t+0,gg),o=e.getUint32(t+4,gg);switch(t+=O1,o){case NY:DB(i,e,t,n);break;case zY:RB(i,e,t,n);break;case QY:r.strict||DB(i,e,t,n);break;case VY:r.strict||RB(i,e,t,n);break}t+=qm(n,4)}return t}function DB(i,e,t,r){const n=new Uint8Array(e.buffer,t,r),l=new TextDecoder("utf8").decode(n);return i.json=JSON.parse(l),qm(r,4)}function RB(i,e,t,r){return i.header.hasBinChunk=!0,i.binChunks.push({byteOffset:t,byteLength:r,arrayBuffer:e.buffer}),qm(r,4)}async function ZY(i,e){var t,r,n,o;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;XY(i,e,l,s),LY(i,{normalize:s==null||(t=s.gltf)===null||t===void 0?void 0:t.normalize}),CY(i,s,g);const v=[];if(s!=null&&(r=s.gltf)!==null&&r!==void 0&&r.loadBuffers&&i.json.buffers&&await JY(i,s,g),s!=null&&(n=s.gltf)!==null&&n!==void 0&&n.loadImages){const F=YY(i,s,g);v.push(F)}const T=EY(i,s,g);return v.push(T),await Promise.all(v),s!=null&&(o=s.gltf)!==null&&o!==void 0&&o.postProcess?UY(i,s):i}function XY(i,e,t,r){if(r.uri&&(i.baseUri=r.uri),e instanceof ArrayBuffer&&!jY(e,t,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")i.json=yz(e);else if(e instanceof ArrayBuffer){const l={};t=qY(l,e,t,r.glb),su(l.type==="glTF","Invalid GLB magic string ".concat(l.type)),i._glb=l,i.json=l.json}else su(!1,"GLTF: must be ArrayBuffer or string");const n=i.json.buffers||[];if(i.buffers=new Array(n.length).fill(null),i._glb&&i._glb.header.hasBinChunk){const{binChunks:l}=i._glb;i.buffers[0]={arrayBuffer:l[0].arrayBuffer,byteOffset:l[0].byteOffset,byteLength:l[0].byteLength}}const o=i.json.images||[];i.images=new Array(o.length).fill({})}async function JY(i,e,t){const r=i.json.buffers||[];for(let l=0;l<r.length;++l){const s=r[l];if(s.uri){var n,o;const{fetch:g}=t;su(g);const v=NP(s.uri,e),T=await(t==null||(n=t.fetch)===null||n===void 0?void 0:n.call(t,v)),F=await(T==null||(o=T.arrayBuffer)===null||o===void 0?void 0:o.call(T));i.buffers[l]={arrayBuffer:F,byteOffset:0,byteLength:F.byteLength},delete s.uri}else i.buffers[l]===null&&(i.buffers[l]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function YY(i,e,t){const r=eee(i),n=i.json.images||[],o=[];for(const l of r)o.push(tee(i,n[l],l,e,t));return await Promise.all(o)}function eee(i){const e=new Set,t=i.json.textures||[];for(const r of t)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function tee(i,e,t,r,n){const{fetch:o,parse:l}=n;let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const v=NP(e.uri,r);s=await(await o(v)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const v=GX(i.json,i.buffers,e.bufferView);s=vw(v.buffer,v.byteOffset,v.byteLength)}su(s,"glTF image has no data");let g=await l(s,[N5,HX],{mimeType:e.mimeType,basis:r.basis||{format:UP()}},n);g&&g[0]&&(g={compressed:!0,mipmaps:!1,width:g[0].width,height:g[0].height,data:g[0]}),i.images=i.images||[],i.images[t]=g}const Dy={name:"glTF",id:"gltf",module:"gltf",version:SX,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:iee,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function iee(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...Dy.options,...e},e.gltf={...Dy.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await ZY({},i,r,e,t)}async function ree(i){const e=[];return i.scenes.forEach(t=>{t.traverse(r=>{Object.values(r.model.getUniforms()).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await nee(()=>e.some(t=>!t.loaded))}async function nee(i){for(;i();)await new Promise(e=>requestAnimationFrame(e))}const see=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,oee=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,tF=[255,255,255,255],aee={scenegraph:{type:"object",value:null,async:!0},getScene:i=>i&&i.scenes?typeof i.scene=="object"?i.scene:i.scenes[i.scene||0]:i,getAnimator:i=>i&&i.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:tF},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Dy]};class kB extends ug{constructor(){super(...arguments),ye(this,"state",void 0)}getShaders(){const e=[$2,K2];return this.props._lighting==="pbr"&&e.push(F2),super.getShaders({vs:see,fs:oee,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:tF,transition:!0},instanceModelMatrix:uP})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;t.scenegraph!==r.scenegraph?this._updateScenegraph():t._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.scenegraph)&&super.isLoaded}_updateScenegraph(){const e=this.props,{gl:t}=this.context;let r=null;if(e.scenegraph instanceof dg)r={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const s=e.scenegraph,g=EX(t,s,this._getModelOptions());r={gltf:s,...g},ree(g).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(On.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=e.scenegraph);const n={layer:this,gl:t},o=e.getScene(r,n),l=e.getAnimator(r,n);o instanceof dg?(this._deleteScenegraph(),this._applyAllAttributes(o),this._applyAnimationsProp(o,l,e._animations),this.setState({scenegraph:o,animator:l})):o!==null&&On.warn("invalid scenegraph:",o)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const t=this.getAttributeManager().getAttributes();e.traverse(r=>{this._setModelAttributes(r.model,t)})}}_applyAnimationsProp(e,t,r){if(!e||!t||!r)return;const n=t.getAnimations();Object.keys(r).sort().forEach(o=>{const l=r[o];if(o==="*")n.forEach(s=>{Object.assign(s,l)});else if(Number.isFinite(Number(o))){const s=Number(o);s>=0&&s<n.length?Object.assign(n[s],l):On.warn("animation ".concat(o," not found"))()}else{const s=n.find(g=>{let{name:v}=g;return v===o});s?Object.assign(s,l):On.warn("animation ".concat(o," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof dg&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t=null;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:t,modelOptions:{isInstanced:!0,transpileToGLSL100:!dn(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(t=>{this._setModelAttributes(t.model,e)})}draw(e){let{moduleParameters:t=null,parameters:r={},context:n}=e;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:o}=this.context,{sizeScale:l,sizeMinPixels:s,sizeMaxPixels:g,opacity:v,coordinateSystem:T}=this.props,F=this.getNumInstances();this.state.scenegraph.traverse((R,U)=>{let{worldMatrix:J}=U;R.model.setInstanceCount(F),R.updateModuleSettings(t),R.draw({parameters:r,uniforms:{sizeScale:l,opacity:v,sizeMinPixels:s,sizeMaxPixels:g,composeModelMatrix:hP(o,T),sceneModelMatrix:J,u_Camera:R.model.getUniforms().project_uCameraPosition}})})}}ye(kB,"defaultProps",aee),ye(kB,"layerName","ScenegraphLayer");const lee=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,cee=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function uee(i){i.COLOR_0||i.colors||(i.colors={constant:!0,value:new Float32Array([1,1,1])})}const hee={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class OB extends xB{getShaders(){const e=super.getShaders();return e.modules.push(F2),{...e,vs:lee,fs:cee}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;t.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!t}),super.draw(e))}getModel(e){const{id:t,pbrMaterial:r}=this.props,n=this.parseMaterial(r,e);this.setState({materialParser:n});const o=this.getShaders();return uee(e.attributes),new eg(this.context.gl,{...this.getShaders(),id:t,geometry:e,defines:{...o.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:r}=this.props,n=this.parseMaterial(e,r);this.setState({materialParser:n}),t.setUniforms(n.uniforms)}}parseMaterial(e,t){var r;const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new xP(this.context.gl,{attributes:{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},material:{unlit:n,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,r=new Uint8ClampedArray(t.length*e.size),n=[];for(let o=0;o<t.length;o++)this.encodePickingColor(t[o],n),r[o*3]=n[0],r[o*3+1]=n[1],r[o*3+2]=n[2];e.value=r}finalizeState(e){var t;super.finalizeState(e),(t=this.state.materialParser)===null||t===void 0||t.delete(),this.setState({materialParser:null})}}ye(OB,"layerName","MeshLayer"),ye(OB,"defaultProps",hee);const Aee=6378137,dee=6378137,fee=6356752314245179e-9;function U1(i){return i}new Ut;function pee(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:U1;return"longitude"in i?(e[0]=t(i.longitude),e[1]=t(i.latitude),e[2]=i.height):"x"in i?(e[0]=t(i.x),e[1]=t(i.y),e[2]=i.z):(e[0]=t(i[0]),e[1]=t(i[1]),e[2]=i[2]),e}function gee(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return pee(i,e,wa._cartographicRadians?U1:SG)}function mee(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:U1;return"longitude"in e?(e.longitude=t(i[0]),e.latitude=t(i[1]),e.height=i[2]):"x"in e?(e.x=t(i[0]),e.y=t(i[1]),e.z=i[2]):(e[0]=t(i[0]),e[1]=t(i[1]),e[2]=i[2]),e}function yee(i,e){return mee(i,e,wa._cartographicRadians?U1:TG)}const mg=new Ut,_ee=new Ut,vee=new Ut;function bee(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:r,oneOverRadiiSquared:n,centerToleranceSquared:o}=e;mg.from(i);const l=mg.x,s=mg.y,g=mg.z,v=r.x,T=r.y,F=r.z,R=l*l*v*v,U=s*s*T*T,J=g*g*F*F,te=R+U+J,Ae=Math.sqrt(1/te);if(!Number.isFinite(Ae))return;const he=_ee;if(he.copy(i).scale(Ae),te<o)return he.to(t);const pe=n.x,be=n.y,Te=n.z,qe=vee;qe.set(he.x*pe*2,he.y*be*2,he.z*Te*2);let je=(1-Ae)*mg.len()/(.5*qe.len()),We=0,Ne,at,nt,ke;do{je-=We,Ne=1/(1+je*pe),at=1/(1+je*be),nt=1/(1+je*Te);const De=Ne*Ne,Ye=at*at,Ze=nt*nt,Ct=De*Ne,Et=Ye*at,Pt=Ze*nt;ke=R*De+U*Ye+J*Ze-1;const Rt=-2*(R*Ct*pe+U*Et*be+J*Pt*Te);We=ke/Rt}while(Math.abs(ke)>py.EPSILON12);return mg.scale([Ne,at,nt]).to(t)}const iF=1e-14,xee=new Ut,rF={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},UB={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ry={east:new Ut,north:new Ut,up:new Ut,west:new Ut,south:new Ut,down:new Ut},wee=new Ut,Bee=new Ut,Cee=new Ut;function nF(i,e,t,r,n,o){const l=rF[e]&&rF[e][t];eh(l&&(!r||r===l));let s,g,v;const T=xee.copy(n);if(th(T.x,0,iF)&&th(T.y,0,iF)){const R=Math.sign(T.z);s=wee.fromArray(UB[e]),e!=="east"&&e!=="west"&&s.scale(R),g=Bee.fromArray(UB[t]),t!=="east"&&t!=="west"&&g.scale(R),v=Cee.fromArray(UB[r]),r!=="east"&&r!=="west"&&v.scale(R)}else{const{up:R,east:U,north:J}=Ry;U.set(-T.y,T.x,0).normalize(),i.geodeticSurfaceNormal(T,R),J.copy(R).cross(U);const{down:te,west:Ae,south:he}=Ry;te.copy(R).scale(-1),Ae.copy(U).scale(-1),he.copy(J).scale(-1),s=Ry[e],g=Ry[t],v=Ry[r]}return o[0]=s.x,o[1]=s.y,o[2]=s.z,o[3]=0,o[4]=g.x,o[5]=g.y,o[6]=g.z,o[7]=0,o[8]=v.x,o[9]=v.y,o[10]=v.z,o[11]=0,o[12]=T.x,o[13]=T.y,o[14]=T.z,o[15]=1,o}const N1=new Ut,sF=new Ut,Eee=new Ut,sh=new Ut,See=new Ut,z1=new Ut;class fo{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;ye(this,"radii",void 0),ye(this,"radiiSquared",void 0),ye(this,"radiiToTheFourth",void 0),ye(this,"oneOverRadii",void 0),ye(this,"oneOverRadiiSquared",void 0),ye(this,"minimumRadius",void 0),ye(this,"maximumRadius",void 0),ye(this,"centerToleranceSquared",py.EPSILON1),ye(this,"squaredXOverSquaredZ",void 0),eh(e>=0),eh(t>=0),eh(r>=0),this.radii=new Ut(e,t,r),this.radiiSquared=new Ut(e*e,t*t,r*r),this.radiiToTheFourth=new Ut(e*e*e*e,t*t*t*t,r*r*r*r),this.oneOverRadii=new Ut(e===0?0:1/e,t===0?0:1/t,r===0?0:1/r),this.oneOverRadiiSquared=new Ut(e===0?0:1/(e*e),t===0?0:1/(t*t),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,t,r),this.maximumRadius=Math.max(e,t,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=sF,n=Eee,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,r),n.copy(this.radiiSquared).scale(r);const l=Math.sqrt(r.dot(n));return n.scale(1/l),r.scale(o),n.add(r),n.to(t)}cartesianToCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];z1.from(e);const r=this.scaleToGeodeticSurface(z1,sh);if(!r)return;const n=this.geodeticSurfaceNormal(r,sF),o=See;o.copy(z1).subtract(r);const l=Math.atan2(n.y,n.x),s=Math.asin(n.z),g=Math.sign(b2(o,z1))*gL(o);return yee([l,s,g],t)}eastNorthUpToFixedFrame(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Sn;return nF(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,r,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Sn;return nF(this,e,t,r,n,o)}geocentricSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return N1.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=gee(e),n=r[0],o=r[1],l=Math.cos(o);return N1.set(l*Math.cos(n),l*Math.sin(n),Math.sin(o)).normalize(),N1.to(t)}geodeticSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return N1.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return bee(e,this,t)}scaleToGeocentricSurface(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];sh.from(e);const r=sh.x,n=sh.y,o=sh.z,l=this.oneOverRadiiSquared,s=1/Math.sqrt(r*r*l.x+n*n*l.y+o*o*l.z);return sh.multiplyScalar(s).to(t)}transformPositionToScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return sh.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return sh.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];eh(th(this.radii.x,this.radii.y,py.EPSILON15)),eh(this.radii.z>0),sh.from(e);const n=sh.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return sh.set(0,0,n).to(r)}}ye(fo,"WGS84",new fo(Aee,dee,fee));function oF(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class aF{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=oF(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(oF()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Tee{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(e instanceof aF?n=e:n=new aF(t,r),this.stats[t]=n),n}}class Iee{constructor(e,t,r){ye(this,"item",void 0),ye(this,"previous",void 0),ye(this,"next",void 0),this.item=e,this.previous=t,this.next=r}}class Lee{constructor(){ye(this,"head",null),ye(this,"tail",null),ye(this,"_length",0)}get length(){return this._length}add(e){const t=new Iee(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}class Mee{constructor(){ye(this,"_list",void 0),ye(this,"_sentinel",void 0),ye(this,"_trimTiles",void 0),this._list=new Lee,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,r){t._cacheNode||(t._cacheNode=this._list.add(t),r&&r(e,t))}unloadTile(e,t,r){const n=t._cacheNode;n&&(this._list.remove(n),t._cacheNode=null,r&&r(e,t))}unloadTiles(e,t){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,o=e.maximumMemoryUsage*1024*1024,l=this._sentinel;let s=n.head;for(;s!==l&&(e.gpuMemoryUsageInBytes>o||r);){const g=s.item;s=s.next,this.unloadTile(e,g,t)}}trim(){this._trimTiles=!0}}function Pee(i,e){Ts(i),Ts(e);const{rtcCenter:t,gltfUpAxis:r}=e,{computedTransform:n,boundingVolume:{center:o}}=i;let l=new Sn(n);switch(t&&l.translate(t),r){case"Z":break;case"Y":const F=new Sn().rotateX(Math.PI/2);l=l.multiplyRight(F);break;case"X":const R=new Sn().rotateY(-Math.PI/2);l=l.multiplyRight(R);break}e.isQuantized&&l.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const s=new Ut(o);e.cartesianModelMatrix=l,e.cartesianOrigin=s;const g=fo.WGS84.cartesianToCartographic(s,new Ut),T=fo.WGS84.eastNorthUpToFixedFrame(s).invert();e.cartographicModelMatrix=T.multiplyRight(l),e.cartographicOrigin=g,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const lF=new Ut,NB=new Ut,zB=new Su([new nh,new nh,new nh,new nh,new nh,new nh]);function Fee(i,e){const{cameraDirection:t,cameraUp:r,height:n}=i,{metersPerUnit:o}=i.distanceScales,l=Q1(i,i.center),s=fo.WGS84.eastNorthUpToFixedFrame(l),g=i.unprojectPosition(i.cameraPosition),v=fo.WGS84.cartographicToCartesian(g,new Ut),T=new Ut(s.transformAsVector(new Ut(t).scale(o))).normalize(),F=new Ut(s.transformAsVector(new Ut(r).scale(o))).normalize();Ree(i);const R=i.constructor,{longitude:U,latitude:J,width:te,bearing:Ae,zoom:he}=i,pe=new R({longitude:U,latitude:J,height:n,width:te,bearing:Ae,zoom:he,pitch:0});return{camera:{position:v,direction:T,up:F},viewport:i,topDownViewport:pe,height:n,cullingVolume:zB,frameNumber:e,sseDenominator:1.15}}function Dee(i,e,t){if(t===0||i.length<=t)return[i,[]];const r=[],{longitude:n,latitude:o}=e.viewport;for(const[v,T]of i.entries()){const[F,R]=T.header.mbs,U=Math.abs(n-F),J=Math.abs(o-R),te=Math.sqrt(J*J+U*U);r.push([v,te])}const l=r.sort((v,T)=>v[1]-T[1]),s=[];for(let v=0;v<t;v++)s.push(i[l[v][0]]);const g=[];for(let v=t;v<l.length;v++)g.push(i[l[v][0]]);return[s,g]}function Ree(i){const e=i.getFrustumPlanes(),t=cF(e.near,i.cameraPosition),r=Q1(i,t),n=Q1(i,i.cameraPosition,NB);let o=0;zB.planes[o++].fromPointNormal(r,lF.copy(r).subtract(n));for(const l in e){if(l==="near")continue;const s=e[l],g=cF(s,t,NB),v=Q1(i,g,NB);zB.planes[o++].fromPointNormal(v,lF.copy(r).subtract(v))}}function cF(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ut;const r=i.normal.dot(e);return t.copy(i.normal).scale(i.distance-r).add(e),t}function Q1(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ut;const r=i.unprojectPosition(e);return fo.WGS84.cartographicToCartesian(r,t)}const kee=6378137,Oee=6378137,QB=6356752314245179e-9,uF=new Ut;function Uee(i,e){if(i instanceof Ty){const{halfAxes:t}=i,r=zee(t);return Math.log2(QB/(r+e[2]))}else if(i instanceof Sy){const{radius:t}=i;return Math.log2(QB/(t+e[2]))}else if(i.width&&i.height){const{width:t,height:r}=i,n=Math.log2(kee/t),o=Math.log2(Oee/r);return(n+o)/2}return 1}function hF(i,e,t){const r=fo.WGS84.cartographicToCartesian([i.xmax,i.ymax,i.zmax],new Ut),n=Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2)+Math.pow(r[2]-t[2],2));return Math.log2(QB/(n+e[2]))}function Nee(i,e,t){const[r,n,o,l]=i;return hF({xmin:r,xmax:o,ymin:n,ymax:l,zmin:0,zmax:0},e,t)}function zee(i){i.getColumn(0,uF);const e=i.getColumn(1),t=i.getColumn(2);return uF.add(e).add(t).len()}const ou={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},LA={ADD:1,REPLACE:2},yg={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Iu={I3S:"I3S",TILES3D:"TILES3D"},V1={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},Qee={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function AF(i){return i!=null}const Il=new Ut,H1=new Ut,Vee=new Ut,Hee=new Ut;function VB(i,e,t){if(Ts(i,"3D Tile: boundingVolume must be defined"),i.box)return jee(i.box,e,t);if(i.region){const[r,n,o,l,s,g]=i.region,v=fo.WGS84.cartographicToCartesian([EA(r),EA(l),s],Vee),T=fo.WGS84.cartographicToCartesian([EA(o),EA(n),g],Hee),F=new Ut().addVectors(v,T).multiplyScalar(.5),R=new Ut().subVectors(v,T).len()/2;return dF([F[0],F[1],F[2],R],new Sn)}if(i.sphere)return dF(i.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Gee(i,e){if(i.box)return qee(e);if(i.region){const[t,r,n,o,l,s]=i.region;return[[EA(t),EA(r),l],[EA(n),EA(o),s]]}if(i.sphere)return $ee(e);throw new Error("Unkown boundingVolume type")}function jee(i,e,t){const r=new Ut(i[0],i[1],i[2]);e.transform(r,r);let n=[];if(i.length===10){const v=i.slice(3,6),T=new fy;T.fromArray(i,6);const F=new Ut([1,0,0]),R=new Ut([0,1,0]),U=new Ut([0,0,1]);F.transformByQuaternion(T),F.scale(v[0]),R.transformByQuaternion(T),R.scale(v[1]),U.transformByQuaternion(T),U.scale(v[2]),n=[...F.toArray(),...R.toArray(),...U.toArray()]}else n=[...i.slice(3,6),...i.slice(6,9),...i.slice(9,12)];const o=e.transformAsVector(n.slice(0,3)),l=e.transformAsVector(n.slice(3,6)),s=e.transformAsVector(n.slice(6,9)),g=new wo([o[0],o[1],o[2],l[0],l[1],l[2],s[0],s[1],s[2]]);return AF(t)?(t.center=r,t.halfAxes=g,t):new Ty(r,g)}function dF(i,e,t){const r=new Ut(i[0],i[1],i[2]);e.transform(r,r);const n=e.getScale(H1),o=Math.max(Math.max(n[0],n[1]),n[2]),l=i[3]*o;return AF(t)?(t.center=r,t.radius=l,t):new Sy(r,l)}function qee(i){const e=fF(),{halfAxes:t}=i,r=new Ut(t.getColumn(0)),n=new Ut(t.getColumn(1)),o=new Ut(t.getColumn(2));for(let l=0;l<2;l++){for(let s=0;s<2;s++){for(let g=0;g<2;g++)Il.copy(i.center),Il.add(r),Il.add(n),Il.add(o),pF(e,Il),o.negate();n.negate()}r.negate()}return e}function $ee(i){const e=fF(),{center:t,radius:r}=i,n=fo.WGS84.scaleToGeodeticSurface(t,Il);let o;n?o=fo.WGS84.geodeticSurfaceNormal(n):o=new Ut(0,0,1);let l=new Ut(o[2],-o[1],0);l.len()>0?l.normalize():l=new Ut(0,1,0);const s=l.clone().cross(o);for(const g of[l,s,o]){H1.copy(g).scale(r);for(let v=0;v<2;v++)Il.copy(t),Il.add(H1),pF(e,Il),H1.negate()}return e}function fF(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function pF(i,e){fo.WGS84.cartesianToCartographic(e,Il),i[0][0]=Math.min(i[0][0],Il[0]),i[0][1]=Math.min(i[0][1],Il[1]),i[0][2]=Math.min(i[0][2],Il[2]),i[1][0]=Math.max(i[1][0],Il[0]),i[1][1]=Math.max(i[1][1],Il[1]),i[1][2]=Math.max(i[1][2],Il[2])}new Ut,new Ut,new Sn,new Ut,new Ut,new Ut;function Kee(i,e){const t=i*e;return 1-Math.exp(-(t*t))}function Wee(i,e){if(i.dynamicScreenSpaceError&&i.dynamicScreenSpaceErrorComputedDensity){const t=i.dynamicScreenSpaceErrorComputedDensity,r=i.dynamicScreenSpaceErrorFactor;return Kee(e,t)*r}return 0}function Zee(i,e,t){const r=i.tileset,n=i.parent&&i.parent.lodMetricValue||i.lodMetricValue,o=t?n:i.lodMetricValue;if(o===0)return 0;const l=Math.max(i._distanceToCamera,1e-7),{height:s,sseDenominator:g}=e,{viewDistanceScale:v}=r.options;let T=o*s*(v||1)/(l*g);return T-=Wee(r,l),T}const HB=new Ut,gF=new Ut,pd=new Ut,mF=new Ut,Xee=new Ut,GB=new Sn,yF=new Sn;function Jee(i,e){if(i.lodMetricValue===0||isNaN(i.lodMetricValue))return"DIG";const t=2*_F(i,e);return t<2?"OUT":!i.header.children||t<=i.lodMetricValue?"DRAW":i.header.children?"DIG":"OUT"}function _F(i,e){const{topDownViewport:t}=e,r=i.header.mbs[1],n=i.header.mbs[0],o=i.header.mbs[2],l=i.header.mbs[3],s=[...i.boundingVolume.center],g=t.unprojectPosition(t.cameraPosition);fo.WGS84.cartographicToCartesian(g,HB),gF.copy(HB).subtract(s).normalize(),fo.WGS84.eastNorthUpToFixedFrame(s,GB),yF.copy(GB).invert(),pd.copy(HB).transform(yF);const v=Math.sqrt(pd[0]*pd[0]+pd[1]*pd[1]),T=v*v/pd[2];mF.copy([pd[0],pd[1],T]);const R=mF.transform(GB).subtract(s).normalize(),J=gF.cross(R).normalize().scale(l).add(s),te=fo.WGS84.cartesianToCartographic(J),Ae=t.project([n,r,o]),he=t.project(te);return Xee.copy(Ae).subtract(he).magnitude()}function Yee(i){return{assetGltfUpAxis:i.asset&&i.asset.gltfUpAxis||"Y"}}class vF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;ye(this,"_map",new Map),ye(this,"_array",void 0),ye(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ts(e<this._array.length),this._array[e]}set(e,t){Ts(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ts(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ts(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const ete={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class G1{traversalFinished(e){return!0}constructor(e){ye(this,"options",void 0),ye(this,"root",null),ye(this,"selectedTiles",{}),ye(this,"requestedTiles",{}),ye(this,"emptyTiles",{}),ye(this,"lastUpdate",new Date().getTime()),ye(this,"updateDebounceTime",1e3),ye(this,"_traversalStack",new vF),ye(this,"_emptyTraversalStack",new vF),ye(this,"_frameNumber",null),this.options={...ete,...e}}traverse(e,t,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const o=r.pop();let l=!1;this.canTraverse(o,t)&&(this.updateChildTiles(o,t),l=this.updateAndPushChildren(o,t,r,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const s=o.parent,g=!!(!s||s._shouldRefine),v=!l;o.hasRenderContent?o.refine===LA.ADD?(this.loadTile(o,t),this.selectTile(o,t)):o.refine===LA.REPLACE&&(this.loadTile(o,t),v&&this.selectTile(o,t)):(this.emptyTiles[o.id]=o,this.loadTile(o,t),v&&this.selectTile(o,t)),this.touchTile(o,t),o._shouldRefine=l&&g}const n=new Date().getTime();(this.traversalFinished(t)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const r=e.children;for(const n of r)this.updateTile(n,t)}updateAndPushChildren(e,t,r,n){const{loadSiblings:o,skipLevelOfDetail:l}=this.options,s=e.children;s.sort(this.compareDistanceToCamera.bind(this));const g=e.refine===LA.REPLACE&&e.hasRenderContent&&!l;let v=!1,T=!0;for(const F of s)if(F._selectionDepth=n,F.isVisibleAndInRequestVolume?(r.find(F)&&r.delete(F),r.push(F),v=!0):(g||o)&&(this.loadTile(F,t),this.touchTile(F,t)),g){let R;if(F._inRequestVolume?F.hasRenderContent?R=F.contentAvailable:R=this.executeEmptyTraversal(F,t):R=!1,T=T&&R,!T)return!1}return v||(T=!1),T}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!n&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,t,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=e._screenSpaceError;return r&&(n=e.getScreenSpaceError(t,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const r=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===t.viewport.id&&r.push(n);else r.push(t.viewport.id);e.updateVisibility(t,r)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let r=!1;for(const n of e.children)n.updateVisibility(t),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,t){let r=!0;const n=this._emptyTraversalStack;for(n.push(e);n.length>0&&r;){const o=n.pop();if(this.updateTile(o,t),o.isVisibleAndInRequestVolume||this.loadTile(o,t),this.touchTile(o,t),!o.hasRenderContent&&this.canTraverse(o,t,!1,!0)){const s=o.children;for(const g of s)n.find(g)&&n.delete(g),n.push(g)}else!o.contentAvailable&&!o.hasEmptyContent&&(r=!1)}return r}}const bF=new Ut;function tte(i){return i!=null}class jB{constructor(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";ye(this,"tileset",void 0),ye(this,"header",void 0),ye(this,"id",void 0),ye(this,"url",void 0),ye(this,"parent",void 0),ye(this,"refine",void 0),ye(this,"type",void 0),ye(this,"contentUrl",void 0),ye(this,"lodMetricType","geometricError"),ye(this,"lodMetricValue",0),ye(this,"boundingVolume",null),ye(this,"content",null),ye(this,"contentState",ou.UNLOADED),ye(this,"gpuMemoryUsageInBytes",0),ye(this,"children",[]),ye(this,"depth",0),ye(this,"viewportIds",[]),ye(this,"transform",new Sn),ye(this,"extensions",null),ye(this,"implicitTiling",null),ye(this,"userData",{}),ye(this,"computedTransform",void 0),ye(this,"hasEmptyContent",!1),ye(this,"hasTilesetContent",!1),ye(this,"traverser",new G1({})),ye(this,"_cacheNode",null),ye(this,"_frameNumber",null),ye(this,"_expireDate",null),ye(this,"_expiredContent",null),ye(this,"_boundingBox",void 0),ye(this,"_distanceToCamera",0),ye(this,"_screenSpaceError",0),ye(this,"_visibilityPlaneMask",void 0),ye(this,"_visible",void 0),ye(this,"_contentBoundingVolume",void 0),ye(this,"_viewerRequestVolume",void 0),ye(this,"_initialTransform",new Sn),ye(this,"_priority",0),ye(this,"_selectedFrame",0),ye(this,"_requestedFrame",0),ye(this,"_selectionDepth",0),ye(this,"_touchedFrame",0),ye(this,"_centerZDepth",0),ye(this,"_shouldRefine",!1),ye(this,"_stackLength",0),ye(this,"_visitedFrame",0),ye(this,"_inRequestVolume",!1),ye(this,"_lodJudge",null),this.header=t,this.tileset=e,this.id=n||t.id,this.url=t.url,this.parent=r,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ou.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ou.UNLOADED}get contentExpired(){return this.contentState===ou.EXPIRED}get contentFailed(){return this.contentState===ou.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Gee(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Iu.I3S:return _F(this,e);case Iu.TILES3D:return Zee(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,r=this.refine===LA.ADD||t;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ou.UNLOADED)return-1;const n=this.parent,l=n&&(!r||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-l,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ou.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=ou.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,o={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await rd(r,n,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ou.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=ou.FAILED,r}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ou.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const r=this.parent,n=r?r._visibilityPlaneMask:Su.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==Su.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:r}=e,{boundingVolume:n}=this;return r.computeVisibilityWithPlaneMask(n,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const r=this.boundingVolume;return bF.subVectors(r.center,t.position),t.direction.dot(bF)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(tte(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=ou.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Sn(e.transform):new Sn;const t=this.parent,r=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new Sn(n).multiplyRight(this.transform);const o=t&&t._initialTransform?t._initialTransform.clone():new Sn;this._initialTransform=new Sn(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ou.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Su.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||LA.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=VB(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=VB(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=VB(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Sn).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Yee(this.tileset.tileset)}}}class ite extends G1{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const l=e.children[0];this.updateTileVisibility(l,t),e._visible=l._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const n=e.refine===LA.REPLACE,o=e._optimChildrenWithinParent===Qee.USE_OPTIMIZATION;if(n&&o&&r&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==LA.ADD?!1:!this.shouldRefine(e,t,!0)}}class rte{constructor(){ye(this,"frameNumberMap",new Map)}register(e,t){const r=this.frameNumberMap.get(e)||new Map,n=r.get(t)||0;r.set(t,n+1),this.frameNumberMap.set(e,r)}deregister(e,t){const r=this.frameNumberMap.get(e);if(!r)return;const n=r.get(t)||1;r.set(t,n-1)}isZero(e,t){var r;return(((r=this.frameNumberMap.get(e))===null||r===void 0?void 0:r.get(t))||0)===0}}const qB={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class nte{constructor(){ye(this,"_statusMap",void 0),ye(this,"pendingTilesRegister",new rte),this._statusMap={}}add(e,t,r,n){if(!this._statusMap[t]){const{frameNumber:o,viewport:{id:l}}=n;this._statusMap[t]={request:e,callback:r,key:t,frameState:n,status:qB.REQUESTED},this.pendingTilesRegister.register(l,o),e().then(s=>{this._statusMap[t].status=qB.COMPLETED;const{frameNumber:g,viewport:{id:v}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(v,g),this._statusMap[t].callback(s,n)}).catch(s=>{this._statusMap[t].status=qB.ERROR;const{frameNumber:g,viewport:{id:v}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(v,g),r(s)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,r);const{frameNumber:o,viewport:{id:l}}=t;this.pendingTilesRegister.register(l,o),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class ste extends G1{constructor(e){super(e),ye(this,"_tileManager",void 0),this._tileManager=new nte}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=Jee(e,t),e._lodJudge==="DIG"}updateChildTiles(e,t){const r=e.header.children||[],n=e.children,o=e.tileset;for(const l of r){const s="".concat(l.id,"-").concat(t.viewport.id),g=n&&n.find(v=>v.id===s);if(g)g&&this.updateTile(g,t);else{let v=()=>this._loadTile(l.id,o);this._tileManager.find(s)?this._tileManager.update(s,t):(o.tileset.nodePages&&(v=()=>o.tileset.nodePagesTile.formTileFromNodePages(l.id)),this._tileManager.add(v,s,F=>this._onTileLoad(F,e,s),t))}}return!1}async _loadTile(e,t){const{loader:r}=t,n=t.getTileUrl("".concat(t.url,"/nodes/").concat(e)),o={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await rd(n,r,o)}_onTileLoad(e,t,r){const n=new jB(t.tileset,e,t,r);t.children.push(n);const o=this._tileManager.find(n.id).frameState;this.updateTile(n,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,o)}}const ote={description:"",ellipsoid:fo.WGS84,modelMatrix:new Sn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:i=>i,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},j1="Tiles In Tileset(s)",$B="Tiles In Memory",xF="Tiles In View",wF="Tiles To Render",BF="Tiles Loaded",KB="Tiles Loading",CF="Tiles Unloaded",EF="Failed Tile Loads",SF="Points/Vertices",WB="Tile Memory Use";class ate{constructor(e,t){ye(this,"options",void 0),ye(this,"loadOptions",void 0),ye(this,"type",void 0),ye(this,"tileset",void 0),ye(this,"loader",void 0),ye(this,"url",void 0),ye(this,"basePath",void 0),ye(this,"modelMatrix",void 0),ye(this,"ellipsoid",void 0),ye(this,"lodMetricType",void 0),ye(this,"lodMetricValue",void 0),ye(this,"refine",void 0),ye(this,"root",null),ye(this,"roots",{}),ye(this,"asset",{}),ye(this,"description",""),ye(this,"properties",void 0),ye(this,"extras",null),ye(this,"attributions",{}),ye(this,"credits",{}),ye(this,"stats",void 0),ye(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),ye(this,"cartographicCenter",null),ye(this,"cartesianCenter",null),ye(this,"zoom",1),ye(this,"boundingVolume",null),ye(this,"dynamicScreenSpaceErrorComputedDensity",0),ye(this,"maximumMemoryUsage",32),ye(this,"gpuMemoryUsageInBytes",0),ye(this,"_frameNumber",0),ye(this,"_queryParams",{}),ye(this,"_extensionsUsed",[]),ye(this,"_tiles",{}),ye(this,"_pendingCount",0),ye(this,"selectedTiles",[]),ye(this,"traverseCounter",0),ye(this,"geometricError",0),ye(this,"lastUpdatedVieports",null),ye(this,"_requestedTiles",[]),ye(this,"_emptyTiles",[]),ye(this,"frameStateData",{}),ye(this,"_traverser",void 0),ye(this,"_cache",new Mee),ye(this,"_requestScheduler",void 0),ye(this,"updatePromise",null),ye(this,"tilesetInitializationPromise",void 0),this.options={...ote,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||bw(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Lz({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new Tee({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const r=[];for(const n of t){const o=n.id;this._needTraverse(o)?r.push(o):this.traverseCounter--}for(const n of t){const o=n.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!r.includes(o))continue;const l=Fee(n,this._frameNumber);this._traverser.traverse(this.roots[o],l,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[t],n=Object.values(this._traverser.selectedTiles),[o,l]=Dee(n,e,this.options.maximumTilesSelected);r.selectedTiles=o;for(const s of l)s.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const r=new Set(e.map(l=>l.id)),n=new Set(t.map(l=>l.id));let o=e.filter(l=>!n.has(l.id)).length>0;return o=o||t.filter(l=>!r.has(l.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?t+=r.content.pointCount:t+=r.content.vertexCount);this.stats.get(xF).count=this.selectedTiles.length,this.stats.get(wF).count=e,this.stats.get(SF).count=t}async _initializeTileSet(e){this.type===Iu.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Iu.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Iu.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const t=this.tileset.fullExtent;if(t){const{xmin:n,xmax:o,ymin:l,ymax:s,zmin:g,zmax:v}=t;this.cartographicCenter=new Ut(n+(o-n)/2,l+(s-l)/2,g+(v-g)/2),this.cartesianCenter=fo.WGS84.cartographicToCartesian(this.cartographicCenter,new Ut),this.zoom=hF(t,this.cartographicCenter,this.cartesianCenter);return}const r=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(r){const[n,o,l,s]=r;this.cartographicCenter=new Ut(n+(l-n)/2,o+(s-o)/2,0),this.cartesianCenter=fo.WGS84.cartographicToCartesian(this.cartographicCenter,new Ut),this.zoom=Nee(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Ut,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Ut,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?this.cartographicCenter=fo.WGS84.cartesianToCartographic(t,new Ut):this.cartographicCenter=new Ut(0,0,-fo.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=Uee(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(j1),this.stats.get(KB),this.stats.get($B),this.stats.get(xF),this.stats.get(wF),this.stats.get(BF),this.stats.get(CF),this.stats.get(EF),this.stats.get(SF),this.stats.get(WB,"memory")}_initializeTileHeaders(e,t){const r=new jB(this,e.root,t);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===Iu.TILES3D){const o=[];for(o.push(r);o.length>0;){const l=o.pop();this.stats.get(j1).incrementCount();const s=l.header.children||[];for(const g of s){var n;const v=new jB(this,g,l);if((n=v.contentUrl)!==null&&n!==void 0&&n.includes("?session=")){const F=new URL(v.contentUrl).searchParams.get("session");F&&(this._queryParams.session=F)}l.children.push(v),v.depth=l.depth+1,o.push(v)}}}return r}_initializeTraverser(){let e;switch(this.type){case Iu.TILES3D:e=ite;break;case Iu.I3S:e=ste;break;default:e=G1}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(EF).incrementCount();const r=t.message||t.toString(),n=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,n)}_onTileLoad(e,t){if(t){if(this.type===Iu.I3S){var r,n;const o=((r=this.tileset)===null||r===void 0||(n=r.nodePagesTile)===null||n===void 0?void 0:n.nodesInNodePages)||0;this.stats.get(j1).reset(),this.stats.get(j1).addCount(o)}e&&e.content&&Pee(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Iu.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Iu.TILES3D){var t;const{extensionsRemoved:r=[]}=((t=e.content)===null||t===void 0?void 0:t.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(KB).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(KB).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(BF).incrementCount(),this.stats.get($B).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(WB).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get($B).decrementCount(),this.stats.get(CF).incrementCount(),this.stats.get(WB).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const r of t.children)e.push(r);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,r=[];for(r.push(t);r.length>0;){e=r.pop();for(const n of e.children)r.push(n);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),r=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const TF="3.4.14",ky={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function IF(i,e,t){Ts(i instanceof ArrayBuffer);const r=new TextDecoder("utf8"),n=new Uint8Array(i,e,t);return r.decode(n)}function lte(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(i);return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}const cte={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},sa={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Vn={...cte,...sa},ZB={[sa.DOUBLE]:Float64Array,[sa.FLOAT]:Float32Array,[sa.UNSIGNED_SHORT]:Uint16Array,[sa.UNSIGNED_INT]:Uint32Array,[sa.UNSIGNED_BYTE]:Uint8Array,[sa.BYTE]:Int8Array,[sa.SHORT]:Int16Array,[sa.INT]:Int32Array},ute={DOUBLE:sa.DOUBLE,FLOAT:sa.FLOAT,UNSIGNED_SHORT:sa.UNSIGNED_SHORT,UNSIGNED_INT:sa.UNSIGNED_INT,UNSIGNED_BYTE:sa.UNSIGNED_BYTE,BYTE:sa.BYTE,SHORT:sa.SHORT,INT:sa.INT},XB="Failed to convert GL type";class Gh{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in ZB)if(ZB[t]===e)return t;throw new Error(XB)}static fromName(e){const t=ute[e];if(!t)throw new Error(XB);return t}static getArrayType(e){switch(e){case sa.UNSIGNED_SHORT_5_6_5:case sa.UNSIGNED_SHORT_4_4_4_4:case sa.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=ZB[e];if(!t)throw new Error(XB);return t}}static getByteSize(e){return Gh.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Gh.getArrayType(e)}static createTypedArray(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;n===void 0&&(n=(t.byteLength-r)/Gh.getByteSize(e));const o=Gh.getArrayType(e);return new o(t,r,n)}}function hte(i,e){if(!i)throw new Error("math.gl assertion failed. ".concat(e))}function Ate(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=i>>11&31,r=i>>5&63,n=i&31;return e[0]=t<<3,e[1]=r<<2,e[2]=n<<3,e}new v2,new Ut,new v2,new v2;function LF(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return SA(i,0,e)/e*2-1}function MF(i){return i<0?-1:1}function dte(i,e,t,r){if(hte(r),i<0||i>t||e<0||e>t)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(t));if(r.x=LF(i,t),r.y=LF(e,t),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const n=r.x;r.x=(1-Math.abs(r.y))*MF(n),r.y=(1-Math.abs(n))*MF(r.y)}return r.normalize()}function fte(i,e,t){return dte(i,e,255,t)}class JB{constructor(e,t){ye(this,"json",void 0),ye(this,"buffer",void 0),ye(this,"featuresLength",0),ye(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vn.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}getPropertyArray(e,t,r){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=Gh.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}getProperty(e,t,r,n,o){const l=this.json[e];if(!l)return l;const s=this.getPropertyArray(e,t,r);if(r===1)return s[n];for(let g=0;g<r;++g)o[g]=s[r*n+g];return o}_getTypedArrayFromBinary(e,t,r,n,o){const l=this._cachedTypedArrays;let s=l[e];return s||(s=Gh.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+o,n*r),l[e]=s),s}_getTypedArrayFromArray(e,t,r){const n=this._cachedTypedArrays;let o=n[e];return o||(o=Gh.createTypedArray(t,r),n[e]=o),o}}const pte={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gte={SCALAR:(i,e)=>i[e],VEC2:(i,e)=>[i[2*e+0],i[2*e+1]],VEC3:(i,e)=>[i[3*e+0],i[3*e+1],i[3*e+2]],VEC4:(i,e)=>[i[4*e+0],i[4*e+1],i[4*e+2],i[4*e+3]],MAT2:(i,e)=>[i[4*e+0],i[4*e+1],i[4*e+2],i[4*e+3]],MAT3:(i,e)=>[i[9*e+0],i[9*e+1],i[9*e+2],i[9*e+3],i[9*e+4],i[9*e+5],i[9*e+6],i[9*e+7],i[9*e+8]],MAT4:(i,e)=>[i[16*e+0],i[16*e+1],i[16*e+2],i[16*e+3],i[16*e+4],i[16*e+5],i[16*e+6],i[16*e+7],i[16*e+8],i[16*e+9],i[16*e+10],i[16*e+11],i[16*e+12],i[16*e+13],i[16*e+14],i[16*e+15]]},mte={SCALAR:(i,e,t)=>{e[t]=i},VEC2:(i,e,t)=>{e[2*t+0]=i[0],e[2*t+1]=i[1]},VEC3:(i,e,t)=>{e[3*t+0]=i[0],e[3*t+1]=i[1],e[3*t+2]=i[2]},VEC4:(i,e,t)=>{e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},MAT2:(i,e,t)=>{e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},MAT3:(i,e,t)=>{e[9*t+0]=i[0],e[9*t+1]=i[1],e[9*t+2]=i[2],e[9*t+3]=i[3],e[9*t+4]=i[4],e[9*t+5]=i[5],e[9*t+6]=i[6],e[9*t+7]=i[7],e[9*t+8]=i[8],e[9*t+9]=i[9]},MAT4:(i,e,t)=>{e[16*t+0]=i[0],e[16*t+1]=i[1],e[16*t+2]=i[2],e[16*t+3]=i[3],e[16*t+4]=i[4],e[16*t+5]=i[5],e[16*t+6]=i[6],e[16*t+7]=i[7],e[16*t+8]=i[8],e[16*t+9]=i[9],e[16*t+10]=i[10],e[16*t+11]=i[11],e[16*t+12]=i[12],e[16*t+13]=i[13],e[16*t+14]=i[14],e[16*t+15]=i[15]}};function yte(i,e,t,r){const{componentType:n}=i;Ts(i.componentType);const o=typeof n=="string"?Gh.fromName(n):n,l=pte[i.type],s=gte[i.type],g=mte[i.type];return t+=i.byteOffset,{values:Gh.createTypedArray(o,e,t,l*r),type:o,size:l,unpacker:s,packer:g}}const jh=i=>i!==void 0;function _te(i,e,t){if(!e)return null;let r=i.getExtension("3DTILES_batch_table_hierarchy");const n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,r=n),r?vte(r,t):null}function vte(i,e){let t,r,n;const o=i.instancesLength,l=i.classes;let s=i.classIds,g=i.parentCounts,v=i.parentIds,T=o;jh(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,GL.UNSIGNED_SHORT),s.type=AttributeType.SCALAR,n=getBinaryAccessor(s),s=n.createArrayBufferView(e.buffer,e.byteOffset+s.byteOffset,o));let F;if(jh(g))for(jh(g.byteOffset)&&(g.componentType=defaultValue(g.componentType,GL.UNSIGNED_SHORT),g.type=AttributeType.SCALAR,n=getBinaryAccessor(g),g=n.createArrayBufferView(e.buffer,e.byteOffset+g.byteOffset,o)),F=new Uint16Array(o),T=0,t=0;t<o;++t)F[t]=T,T+=g[t];jh(v)&&jh(v.byteOffset)&&(v.componentType=defaultValue(v.componentType,GL.UNSIGNED_SHORT),v.type=AttributeType.SCALAR,n=getBinaryAccessor(v),v=n.createArrayBufferView(e.buffer,e.byteOffset+v.byteOffset,T));const R=l.length;for(t=0;t<R;++t){const Ae=l[t].length,he=l[t].instances,pe=getBinaryProperties(Ae,he,e);l[t].instances=combine(pe,he)}const U=new Array(R).fill(0),J=new Uint16Array(o);for(t=0;t<o;++t)r=s[t],J[t]=U[r],++U[r];const te={classes:l,classIds:s,classIndexes:J,parentCounts:g,parentIndexes:F,parentIds:v};return wte(te),te}function Oy(i,e,t){if(!i)return;const r=i.parentCounts;return i.parentIds?t(i,e):r>0?bte(i,e,t):xte(i,e,t)}function bte(i,e,t){const r=i.classIds,n=i.parentCounts,o=i.parentIds,l=i.parentIndexes,s=r.length,g=scratchVisited;g.length=Math.max(g.length,s);const v=++marker,T=scratchStack;for(T.length=0,T.push(e);T.length>0;){if(e=T.pop(),g[e]===v)continue;g[e]=v;const F=t(i,e);if(jh(F))return F;const R=n[e],U=l[e];for(let J=0;J<R;++J){const te=o[U+J];te!==e&&T.push(te)}}return null}function xte(i,e,t){let r=!0;for(;r;){const n=t(i,e);if(jh(n))return n;const o=i.parentIds[e];r=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function wte(i){const t=i.classIds.length;for(let r=0;r<t;++r)PF(i,r,stack)}function PF(i,e,t){const r=i.parentCounts,n=i.parentIds,o=i.parentIndexes,s=i.classIds.length;if(!jh(n))return;assert(e<s,"Parent index ".concat(e," exceeds the total number of instances: ").concat(s)),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const g=jh(r)?r[e]:1,v=jh(r)?o[e]:e;for(let T=0;T<g;++T){const F=n[v+T];F!==e&&PF(i,F,t)}t.pop(e)}function Pc(i){return i!=null}const q1=(i,e)=>i,Bte={HIERARCHY:!0,extensions:!0,extras:!0};class FF{constructor(e,t,r){var n;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};ye(this,"json",void 0),ye(this,"binary",void 0),ye(this,"featureCount",void 0),ye(this,"_extensions",void 0),ye(this,"_properties",void 0),ye(this,"_binaryProperties",void 0),ye(this,"_hierarchy",void 0),Ts(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=((n=this.json)===null||n===void 0?void 0:n.extensions)||{},this._properties={};for(const l in this.json)Bte[l]||(this._properties[l]=this.json[l]);this._binaryProperties=this._initializeBinaryProperties(),o["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=_te(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Ts(typeof t=="string",t),this._hierarchy){const r=Oy(this._hierarchy,e,(n,o)=>{const l=n.classIds[o];return n.classes[l].name===t});return Pc(r)}return!1}isExactClass(e,t){return Ts(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Ts(typeof t=="string",t),Pc(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=Pc(t)?t:[],t.length=0;const r=Object.keys(this._properties);return t.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Ts(typeof t=="string",t),this._binaryProperties){const n=this._binaryProperties[t];if(Pc(n))return this._getBinaryProperty(n,e)}const r=this._properties[t];if(Pc(r))return q1(r[e]);if(this._hierarchy){const n=this._getHierarchyProperty(e,t);if(Pc(n))return n}}setProperty(e,t,r){const n=this.featureCount;if(this._checkBatchId(e),Ts(typeof t=="string",t),this._binaryProperties){const l=this._binaryProperties[t];if(l){this._setBinaryProperty(l,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,r))return;let o=this._properties[t];Pc(o)||(this._properties[t]=new Array(n),o=this._properties[t]),o[e]=q1(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,r){e.pack(r,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const r=this._properties[t],n=this._initializeBinaryProperty(t,r);n&&(e=e||{},e[t]=n)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const r=t;Ts(this.binary,"Property ".concat(e," requires a batch table binary.")),Ts(r.type,"Property ".concat(e," requires a type."));const n=yte(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const r=Oy(this._hierarchy,e,(n,o)=>{const l=n.classIds[o],s=n.classes[l].instances;return Pc(s[t])});return Pc(r)}_getPropertyNamesInHierarchy(e,t){Oy(this._hierarchy,e,(r,n)=>{const o=r.classIds[n],l=r.classes[o].instances;for(const s in l)l.hasOwnProperty(s)&&t.indexOf(s)===-1&&t.push(s)})}_getHierarchyProperty(e,t){return Oy(this._hierarchy,e,(r,n)=>{const o=r.classIds[n],l=r.classes[o],s=r.classIndexes[n],g=l.instances[t];return Pc(g)?Pc(g.typedArray)?this._getBinaryProperty(g,s):q1(g[s]):null})}_setHierarchyProperty(e,t,r,n){const o=Oy(this._hierarchy,t,(l,s)=>{const g=l.classIds[s],v=l.classes[g],T=l.classIndexes[s],F=v.instances[r];return Pc(F)?(Ts(s===t,'Inherited property "'.concat(r,'" is read-only.')),Pc(F.typedArray)?this._setBinaryProperty(F,T,n):F[T]=q1(n),!0):!1});return Pc(o)}}const YB=4;function $1(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e);if(i.magic=r.getUint32(t,!0),t+=YB,i.version=r.getUint32(t,!0),t+=YB,i.byteLength=r.getUint32(t,!0),t+=YB,i.version!==1)throw new Error("3D Tile Version ".concat(i.version," not supported"));return t}const _g=4,DF="b3dm tile in legacy format.";function eC(i,e,t){const r=new DataView(e);let n;i.header=i.header||{};let o=r.getUint32(t,!0);t+=_g;let l=r.getUint32(t,!0);t+=_g;let s=r.getUint32(t,!0);t+=_g;let g=r.getUint32(t,!0);return t+=_g,s>=570425344?(t-=_g*2,n=o,s=l,g=0,o=0,l=0,console.warn(DF)):g>=570425344&&(t-=_g,n=s,s=o,g=l,o=0,l=0,console.warn(DF)),i.header.featureTableJsonByteLength=o,i.header.featureTableBinaryByteLength=l,i.header.batchTableJsonByteLength=s,i.header.batchTableBinaryByteLength=g,i.header.batchLength=n,t}function tC(i,e,t,r){return t=Cte(i,e,t),t=Ete(i,e,t),t}function Cte(i,e,t,r){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:o,batchLength:l}=i.header;if(i.featureTableJson={BATCH_LENGTH:l||0},n>0){const s=IF(e,t,n);i.featureTableJson=JSON.parse(s)}return t+=n,i.featureTableBinary=new Uint8Array(e,t,o),t+=o,t}function Ete(i,e,t,r){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:o}=i.header;if(n>0){const l=IF(e,t,n);i.batchTableJson=JSON.parse(l),t+=n,o>0&&(i.batchTableBinary=new Uint8Array(e,t,o),i.batchTableBinary=new Uint8Array(i.batchTableBinary),t+=o)}return t}function RF(i,e,t){if(!e&&(!i||!i.batchIds||!t))return null;const{batchIds:r,isRGB565:n,pointCount:o}=i;if(r&&t){const l=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const g=r[s],T=t.getProperty(g,"dimensions").map(F=>F*255);l[s*3]=T[0],l[s*3+1]=T[1],l[s*3+2]=T[2]}return{type:Vn.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}if(n){const l=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const g=Ate(e[s]);l[s*3]=g[0],l[s*3+1]=g[1],l[s*3+2]=g[2]}return{type:Vn.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}return e&&e.length===o*3?{type:Vn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Vn.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const kF=new Ut;function Ste(i,e){if(!e)return null;if(i.isOctEncoded16P){const t=new Float32Array(i.pointsLength*3);for(let r=0;r<i.pointsLength;r++)fte(e[r*2],e[r*2+1],kF),kF.toArray(t,r*3);return{type:Vn.FLOAT,size:2,value:t}}return{type:Vn.FLOAT,size:2,value:e}}function Tte(i,e,t){return i.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(i.isQuantized=!1,Ite(i,e)):{type:Vn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Ite(i,e){const t=new Ut,r=new Float32Array(i.pointCount*3);for(let n=0;n<i.pointCount;n++)t.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/i.quantizedRange).multiply(i.quantizedVolumeScale).add(i.quantizedVolumeOffset).toArray(r,n*3);return r}async function Lte(i,e,t,r,n){t=$1(i,e,t),t=eC(i,e,t),t=tC(i,e,t),Mte(i);const{featureTable:o,batchTable:l}=Pte(i);return await Ote(i,o,l,r,n),Fte(i,o,r),Dte(i,o,l),Rte(i,o),t}function Mte(i){i.attributes={positions:null,colors:null,normals:null,batchIds:null},i.isQuantized=!1,i.isTranslucent=!1,i.isRGB565=!1,i.isOctEncoded16P=!1}function Pte(i){const e=new JB(i.featureTableJson,i.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,i.featuresLength=t,i.pointsLength=t,i.pointCount=t,i.rtcCenter=e.getGlobalProperty("RTC_CENTER",Vn.FLOAT,3);const r=kte(i,e);return{featureTable:e,batchTable:r}}function Fte(i,e,t){if(!i.attributes.positions){if(e.hasProperty("POSITION"))i.attributes.positions=e.getPropertyArray("POSITION",Vn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",Vn.UNSIGNED_SHORT,3);if(i.isQuantized=!0,i.quantizedRange=65535,i.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Vn.FLOAT,3),!i.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(i.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Vn.FLOAT,3),!i.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");i.attributes.positions=Tte(i,r,t)}}if(!i.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Dte(i,e,t){if(!i.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",Vn.UNSIGNED_BYTE,4),i.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",Vn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",Vn.UNSIGNED_SHORT,1),i.isRGB565=!0),i.attributes.colors=RF(i,r,t)}e.hasProperty("CONSTANT_RGBA")&&(i.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Vn.UNSIGNED_BYTE,4))}function Rte(i,e){if(!i.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Vn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Vn.UNSIGNED_BYTE,2),i.isOctEncoded16P=!0),i.attributes.normals=Ste(i,t)}}function kte(i,e){let t=null;if(!i.batchIds&&e.hasProperty("BATCH_ID")&&(i.batchIds=e.getPropertyArray("BATCH_ID",Vn.UNSIGNED_SHORT,1),i.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:o}=i;t=new FF(n,o,r)}return t}async function Ote(i,e,t,r,n){let o,l,s;const g=i.batchTableJson&&i.batchTableJson.extensions&&i.batchTableJson.extensions["3DTILES_draco_point_compression"];g&&(s=g.properties);const v=e.getExtension("3DTILES_draco_point_compression");if(v){l=v.properties;const F=v.byteOffset,R=v.byteLength;if(!l||!Number.isFinite(F)||!R)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=i.featureTableBinary.slice(F,F+R),i.hasPositions=Number.isFinite(l.POSITION),i.hasColors=Number.isFinite(l.RGB)||Number.isFinite(l.RGBA),i.hasNormals=Number.isFinite(l.NORMAL),i.hasBatchIds=Number.isFinite(l.BATCH_ID),i.isTranslucent=Number.isFinite(l.RGBA)}if(!o)return!0;const T={buffer:o,properties:{...l,...s},featureTableProperties:l,batchTableProperties:s,dequantizeInShader:!1};return await Ute(i,T,r,n)}async function Ute(i,e,t,r){const{parse:n}=r,o={...t,draco:{...t.draco,extraAttributes:e.batchTableProperties||{}}};delete o["3d-tiles"];const l=await n(e.buffer,$P,o),s=l.attributes.POSITION&&l.attributes.POSITION.value,g=l.attributes.COLOR_0&&l.attributes.COLOR_0.value,v=l.attributes.NORMAL&&l.attributes.NORMAL.value,T=l.attributes.BATCH_ID&&l.attributes.BATCH_ID.value,F=s&&l.attributes.POSITION.value.quantization,R=v&&l.attributes.NORMAL.value.quantization;if(F){const J=l.POSITION.data.quantization,te=J.range;i.quantizedVolumeScale=new Ut(te,te,te),i.quantizedVolumeOffset=new Ut(J.minValues),i.quantizedRange=(1<<J.quantizationBits)-1,i.isQuantizedDraco=!0}R&&(i.octEncodedRange=(1<<l.NORMAL.data.quantization.quantizationBits)-1,i.isOctEncodedDraco=!0);const U={};if(e.batchTableProperties)for(const J of Object.keys(e.batchTableProperties))l.attributes[J]&&l.attributes[J].value&&(U[J.toLowerCase()]=l.attributes[J].value);i.attributes={positions:s,colors:RF(i,g,void 0),normals:v,batchIds:T,...U}}const iC={URI:0,EMBEDDED:1};function OF(i,e,t,r){i.rotateYtoZ=!0;const n=i.byteOffset+i.byteLength-t;if(n===0)throw new Error("glTF byte length must be greater than 0.");return i.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",i.gltfArrayBuffer=vw(e,t,n),i.gltfByteOffset=0,i.gltfByteLength=n,t%4===0||console.warn("".concat(i.type,": embedded glb is not aligned to a 4-byte boundary.")),i.byteOffset+i.byteLength}async function UF(i,e,t,r){const n=t["3d-tiles"]||{};if(Nte(i,e),n.loadGLTF){const{parse:o,fetch:l}=r;i.gltfUrl&&(i.gltfArrayBuffer=await l(i.gltfUrl,t),i.gltfByteOffset=0),i.gltfArrayBuffer&&(i.gltf=await o(i.gltfArrayBuffer,Dy,t,r),i.gpuMemoryUsageInBytes=HP(i.gltf),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength)}}function Nte(i,e,t){switch(e){case iC.URI:const r=new Uint8Array(i.gltfArrayBuffer,i.gltfByteOffset),o=new TextDecoder().decode(r);i.gltfUrl=o.replace(/[\s\0]+$/,""),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength;break;case iC.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function zte(i,e,t,r,n){var o;t=Qte(i,e,t,r),await UF(i,iC.EMBEDDED,r,n);const l=i==null||(o=i.gltf)===null||o===void 0?void 0:o.extensions;return l&&l.CESIUM_RTC&&(i.rtcCenter=l.CESIUM_RTC.center),t}function Qte(i,e,t,r,n){t=$1(i,e,t),t=eC(i,e,t),t=tC(i,e,t),t=OF(i,e,t,r);const o=new JB(i.featureTableJson,i.featureTableBinary);return i.rtcCenter=o.getGlobalProperty("RTC_CENTER",Vn.FLOAT,3),t}async function Vte(i,e,t,r,n){return t=Hte(i,e,t,r),await UF(i,i.gltfFormat,r,n),t}function Hte(i,e,t,r,n){if(t=$1(i,e,t),i.version!==1)throw new Error("Instanced 3D Model version ".concat(i.version," is not supported"));t=eC(i,e,t);const o=new DataView(e);if(i.gltfFormat=o.getUint32(t,!0),t+=4,t=tC(i,e,t),t=OF(i,e,t,r),i.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const l=new JB(i.featureTableJson,i.featureTableBinary),s=l.getGlobalProperty("INSTANCES_LENGTH");if(l.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");i.eastNorthUp=l.getGlobalProperty("EAST_NORTH_UP"),i.rtcCenter=l.getGlobalProperty("RTC_CENTER",Vn.FLOAT,3);const g=new FF(i.batchTableJson,i.batchTableBinary,s);return Gte(i,l,g,s),t}function Gte(i,e,t,r){const o={instances:new Array(r),batchTable:i._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,l=new Ut;new Ut,new Ut,new Ut;const s=new wo,g=new fy,v=new Ut,T={},F=new Sn,R=[],U=[],J=new Ut,te=new Ut;for(let Ae=0;Ae<r;Ae++){let he;if(e.hasProperty("POSITION"))he=e.getProperty("POSITION",Vn.FLOAT,3,Ae,l);else if(e.hasProperty("POSITION_QUANTIZED")){he=e.getProperty("POSITION_QUANTIZED",Vn.UNSIGNED_SHORT,3,Ae,l);const We=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Vn.FLOAT,3,J);if(!We)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ne=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Vn.FLOAT,3,te);if(!Ne)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const at=65535;for(let nt=0;nt<3;nt++)he[nt]=he[nt]/at*Ne[nt]+We[nt]}if(!he)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(l.copy(he),T.translation=l,i.normalUp=e.getProperty("NORMAL_UP",Vn.FLOAT,3,Ae,R),i.normalRight=e.getProperty("NORMAL_RIGHT",Vn.FLOAT,3,Ae,U),i.normalUp){if(!i.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");i.hasCustomOrientation=!0}else{if(i.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Vn.UNSIGNED_SHORT,2,R),i.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Vn.UNSIGNED_SHORT,2,U),i.octNormalUp)throw i.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");i.eastNorthUp?(fo.WGS84.eastNorthUpToFixedFrame(l,F),F.getRotationMatrix3(s)):s.identity()}g.fromMatrix3(s),T.rotation=g,v.set(1,1,1);const pe=e.getProperty("SCALE",Vn.FLOAT,1,Ae);Number.isFinite(pe)&&v.multiplyByScalar(pe);const be=e.getProperty("SCALE_NON_UNIFORM",Vn.FLOAT,3,Ae,R);be&&v.scale(be),T.scale=v;let Te=e.getProperty("BATCH_ID",Vn.UNSIGNED_SHORT,1,Ae);Te===void 0&&(Te=Ae);const qe=new Sn().fromQuaternion(T.rotation);F.identity(),F.translate(T.translation),F.multiplyRight(qe),F.scale(T.scale);const je=F.clone();o[Ae]={modelMatrix:je,batchId:Te}}i.instances=o}async function jte(i,e,t,r,n,o){t=$1(i,e,t);const l=new DataView(e);for(i.tilesLength=l.getUint32(t,!0),t+=4,i.tiles=[];i.tiles.length<i.tilesLength&&i.byteLength-t>12;){const s={};i.tiles.push(s),t=await o(e,t,r,n,s)}return t}async function qte(i,e,t,r){i.rotateYtoZ=!0,i.gltfUpAxis=t["3d-tiles"]&&t["3d-tiles"].assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y";const{parse:n}=r;i.gltf=await n(e,Dy,t,r),i.gpuMemoryUsageInBytes=HP(i.gltf)}async function NF(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(n.byteOffset=e,n.type=lte(i,e),n.type){case ky.COMPOSITE:return await jte(n,i,e,t,r,NF);case ky.BATCHED_3D_MODEL:return await zte(n,i,e,t,r);case ky.GLTF:return await qte(n,i,t,r);case ky.INSTANCED_3D_MODEL:return await Vte(n,i,e,t,r);case ky.POINT_CLOUD:return await Lte(n,i,e,t,r);default:throw new Error("3DTileLoader: unknown type ".concat(n.type))}}const $te=1952609651,Kte=1;async function Wte(i,e,t){if(new Uint32Array(i.slice(0,4))[0]!==$te)throw new Error("Wrong subtree file magic number");if(new Uint32Array(i.slice(4,8))[0]!==Kte)throw new Error("Wrong subtree file verson, must be 1");const o=zF(i.slice(8,16)),l=new Uint8Array(i,24,o),g=new TextDecoder("utf8").decode(l),v=JSON.parse(g),T=zF(i.slice(16,24));let F=new ArrayBuffer(0);return T&&(F=i.slice(24+o)),"bufferView"in v.tileAvailability&&(v.tileAvailability.explicitBitstream=await rC(v,"tileAvailability",F,t)),"bufferView"in v.contentAvailability&&(v.contentAvailability.explicitBitstream=await rC(v,"contentAvailability",F,t)),"bufferView"in v.childSubtreeAvailability&&(v.childSubtreeAvailability.explicitBitstream=await rC(v,"childSubtreeAvailability",F,t)),v}function Zte(i,e){if(e.startsWith("http")){const o=new URL(i,e);return decodeURI(o.toString())}const r="http://".concat(e),n=new URL(i,r);return"/".concat(n.host).concat(n.pathname)}async function rC(i,e,t,r){const n=i[e].bufferView,o=i.bufferViews[n],l=i.buffers[o.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(l.uri){const s=Zte(l.uri,r==null?void 0:r.url),v=await(await r.fetch(s)).arrayBuffer();return new Uint8Array(v,o.byteOffset,o.byteLength)}return new Uint8Array(t,o.byteOffset,o.byteLength)}function zF(i){const e=new DataView(i),t=e.getUint32(0,!0),r=e.getUint32(4,!0);return t+2**32*r}const QF={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:TF,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Wte,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Lu=null;try{Lu=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ps(i,e,t){this.low=i|0,this.high=e|0,this.unsigned=!!t}ps.prototype.__isLong__,Object.defineProperty(ps.prototype,"__isLong__",{value:!0});function Ll(i){return(i&&i.__isLong__)===!0}function VF(i){var e=Math.clz32(i&-i);return i?31-e:e}ps.isLong=Ll;var HF={},GF={};function Sf(i,e){var t,r,n;return e?(i>>>=0,(n=0<=i&&i<256)&&(r=GF[i],r)?r:(t=Jn(i,0,!0),n&&(GF[i]=t),t)):(i|=0,(n=-128<=i&&i<128)&&(r=HF[i],r)?r:(t=Jn(i,i<0?-1:0,!1),n&&(HF[i]=t),t))}ps.fromInt=Sf;function Mu(i,e){if(isNaN(i))return e?MA:ah;if(e){if(i<0)return MA;if(i>=qF)return XF}else{if(i<=-$F)return Fc;if(i+1>=$F)return ZF}return i<0?Mu(-i,e).neg():Jn(i%vg|0,i/vg|0,e)}ps.fromNumber=Mu;function Jn(i,e,t){return new ps(i,e,t)}ps.fromBits=Jn;var K1=Math.pow;function nC(i,e,t){if(i.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return e?MA:ah;if(t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=i.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return nC(i.substring(1),e,t).neg();for(var n=Mu(K1(t,8)),o=ah,l=0;l<i.length;l+=8){var s=Math.min(8,i.length-l),g=parseInt(i.substring(l,l+s),t);if(s<8){var v=Mu(K1(t,s));o=o.mul(v).add(Mu(g))}else o=o.mul(n),o=o.add(Mu(g))}return o.unsigned=e,o}ps.fromString=nC;function oh(i,e){return typeof i=="number"?Mu(i,e):typeof i=="string"?nC(i,e):Jn(i.low,i.high,typeof e=="boolean"?e:i.unsigned)}ps.fromValue=oh;var jF=65536,Xte=1<<24,vg=jF*jF,qF=vg*vg,$F=qF/2,KF=Sf(Xte),ah=Sf(0);ps.ZERO=ah;var MA=Sf(0,!0);ps.UZERO=MA;var bg=Sf(1);ps.ONE=bg;var WF=Sf(1,!0);ps.UONE=WF;var sC=Sf(-1);ps.NEG_ONE=sC;var ZF=Jn(-1,2147483647,!1);ps.MAX_VALUE=ZF;var XF=Jn(-1,-1,!0);ps.MAX_UNSIGNED_VALUE=XF;var Fc=Jn(0,-2147483648,!1);ps.MIN_VALUE=Fc;var ki=ps.prototype;ki.toInt=function(){return this.unsigned?this.low>>>0:this.low},ki.toNumber=function(){return this.unsigned?(this.high>>>0)*vg+(this.low>>>0):this.high*vg+(this.low>>>0)},ki.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Fc)){var t=Mu(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Mu(K1(e,6),this.unsigned),l=this,s="";;){var g=l.div(o),v=l.sub(g.mul(o)).toInt()>>>0,T=v.toString(e);if(l=g,l.isZero())return T+s;for(;T.length<6;)T="0"+T;s=""+T+s}},ki.getHighBits=function(){return this.high},ki.getHighBitsUnsigned=function(){return this.high>>>0},ki.getLowBits=function(){return this.low},ki.getLowBitsUnsigned=function(){return this.low>>>0},ki.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Fc)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1},ki.isZero=function(){return this.high===0&&this.low===0},ki.eqz=ki.isZero,ki.isNegative=function(){return!this.unsigned&&this.high<0},ki.isPositive=function(){return this.unsigned||this.high>=0},ki.isOdd=function(){return(this.low&1)===1},ki.isEven=function(){return(this.low&1)===0},ki.equals=function(e){return Ll(e)||(e=oh(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},ki.eq=ki.equals,ki.notEquals=function(e){return!this.eq(e)},ki.neq=ki.notEquals,ki.ne=ki.notEquals,ki.lessThan=function(e){return this.comp(e)<0},ki.lt=ki.lessThan,ki.lessThanOrEqual=function(e){return this.comp(e)<=0},ki.lte=ki.lessThanOrEqual,ki.le=ki.lessThanOrEqual,ki.greaterThan=function(e){return this.comp(e)>0},ki.gt=ki.greaterThan,ki.greaterThanOrEqual=function(e){return this.comp(e)>=0},ki.gte=ki.greaterThanOrEqual,ki.ge=ki.greaterThanOrEqual,ki.compare=function(e){if(Ll(e)||(e=oh(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},ki.comp=ki.compare,ki.negate=function(){return!this.unsigned&&this.eq(Fc)?Fc:this.not().add(bg)},ki.neg=ki.negate,ki.add=function(e){Ll(e)||(e=oh(e));var t=this.high>>>16,r=this.high&65535,n=this.low>>>16,o=this.low&65535,l=e.high>>>16,s=e.high&65535,g=e.low>>>16,v=e.low&65535,T=0,F=0,R=0,U=0;return U+=o+v,R+=U>>>16,U&=65535,R+=n+g,F+=R>>>16,R&=65535,F+=r+s,T+=F>>>16,F&=65535,T+=t+l,T&=65535,Jn(R<<16|U,T<<16|F,this.unsigned)},ki.subtract=function(e){return Ll(e)||(e=oh(e)),this.add(e.neg())},ki.sub=ki.subtract,ki.multiply=function(e){if(this.isZero())return this;if(Ll(e)||(e=oh(e)),Lu){var t=Lu.mul(this.low,this.high,e.low,e.high);return Jn(t,Lu.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?MA:ah;if(this.eq(Fc))return e.isOdd()?Fc:ah;if(e.eq(Fc))return this.isOdd()?Fc:ah;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(KF)&&e.lt(KF))return Mu(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=this.high&65535,o=this.low>>>16,l=this.low&65535,s=e.high>>>16,g=e.high&65535,v=e.low>>>16,T=e.low&65535,F=0,R=0,U=0,J=0;return J+=l*T,U+=J>>>16,J&=65535,U+=o*T,R+=U>>>16,U&=65535,U+=l*v,R+=U>>>16,U&=65535,R+=n*T,F+=R>>>16,R&=65535,R+=o*v,F+=R>>>16,R&=65535,R+=l*g,F+=R>>>16,R&=65535,F+=r*T+n*v+o*g+l*s,F&=65535,Jn(U<<16|J,F<<16|R,this.unsigned)},ki.mul=ki.multiply,ki.divide=function(e){if(Ll(e)||(e=oh(e)),e.isZero())throw Error("division by zero");if(Lu){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Lu.div_u:Lu.div_s)(this.low,this.high,e.low,e.high);return Jn(t,Lu.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?MA:ah;var r,n,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return MA;if(e.gt(this.shru(1)))return WF;o=MA}else{if(this.eq(Fc)){if(e.eq(bg)||e.eq(sC))return Fc;if(e.eq(Fc))return bg;var l=this.shr(1);return r=l.div(e).shl(1),r.eq(ah)?e.isNegative()?bg:sC:(n=this.sub(e.mul(r)),o=r.add(n.div(e)),o)}else if(e.eq(Fc))return this.unsigned?MA:ah;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=ah}for(n=this;n.gte(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),g=s<=48?1:K1(2,s-48),v=Mu(r),T=v.mul(e);T.isNegative()||T.gt(n);)r-=g,v=Mu(r,this.unsigned),T=v.mul(e);v.isZero()&&(v=bg),o=o.add(v),n=n.sub(T)}return o},ki.div=ki.divide,ki.modulo=function(e){if(Ll(e)||(e=oh(e)),Lu){var t=(this.unsigned?Lu.rem_u:Lu.rem_s)(this.low,this.high,e.low,e.high);return Jn(t,Lu.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},ki.mod=ki.modulo,ki.rem=ki.modulo,ki.not=function(){return Jn(~this.low,~this.high,this.unsigned)},ki.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},ki.clz=ki.countLeadingZeros,ki.countTrailingZeros=function(){return this.low?VF(this.low):VF(this.high)+32},ki.ctz=ki.countTrailingZeros,ki.and=function(e){return Ll(e)||(e=oh(e)),Jn(this.low&e.low,this.high&e.high,this.unsigned)},ki.or=function(e){return Ll(e)||(e=oh(e)),Jn(this.low|e.low,this.high|e.high,this.unsigned)},ki.xor=function(e){return Ll(e)||(e=oh(e)),Jn(this.low^e.low,this.high^e.high,this.unsigned)},ki.shiftLeft=function(e){return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Jn(0,this.low<<e-32,this.unsigned)},ki.shl=ki.shiftLeft,ki.shiftRight=function(e){return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Jn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},ki.shr=ki.shiftRight,ki.shiftRightUnsigned=function(e){return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jn(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Jn(this.high,0,this.unsigned):Jn(this.high>>>e-32,0,this.unsigned)},ki.shru=ki.shiftRightUnsigned,ki.shr_u=ki.shiftRightUnsigned,ki.rotateLeft=function(e){var t;return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Jn(this.high,this.low,this.unsigned):e<32?(t=32-e,Jn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Jn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},ki.rotl=ki.rotateLeft,ki.rotateRight=function(e){var t;return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Jn(this.high,this.low,this.unsigned):e<32?(t=32-e,Jn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Jn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},ki.rotr=ki.rotateRight,ki.toSigned=function(){return this.unsigned?Jn(this.low,this.high,!1):this},ki.toUnsigned=function(){return this.unsigned?this:Jn(this.low,this.high,!0)},ki.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},ki.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},ki.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},ps.fromBytes=function(e,t,r){return r?ps.fromBytesLE(e,t):ps.fromBytesBE(e,t)},ps.fromBytesLE=function(e,t){return new ps(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},ps.fromBytesBE=function(e,t){return new ps(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Jte=16;function JF(i){i==="X"&&(i="");const e=i.padEnd(Jte,"0");return ps.fromString(e,!0,16)}function Yte(i){if(i.isZero())return"X";let e=i.countTrailingZeros();const t=e%4;e=(e-t)/4;const r=e;e*=4;const o=i.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-o.length).join("0")+o}function eie(i,e){const t=tie(i).shiftRightUnsigned(2);return i.add(ps.fromNumber(2*e+1-4).multiply(t))}function tie(i){return i.and(i.not().add(1))}const iie=3,rie=2*30+1,YF=180/Math.PI;function nie(i){if(i.length===0)throw new Error("Invalid Hilbert quad key ".concat(i));const e=i.split("/"),t=parseInt(e[0],10),r=e[1],n=r.length;let o=0;const l=[0,0];for(let s=n-1;s>=0;s--){o=n-s;const g=r[s];let v=0,T=0;g==="1"?T=1:g==="2"?(v=1,T=1):g==="3"&&(v=1);const F=Math.pow(2,o-1);oie(F,l,v,T),l[0]+=F*v,l[1]+=F*T}if(t%2===1){const s=l[0];l[0]=l[1],l[1]=s}return{face:t,ij:l,level:o}}function sie(i){if(i.isZero())return"";let e=i.toString(2);for(;e.length<iie+rie;)e="0"+e;const t=e.lastIndexOf("1"),r=e.substring(0,3),n=e.substring(3,t),o=n.length/2,l=ps.fromString(r,!0,2).toString(10);let s="";if(o!==0)for(s=ps.fromString(n,!0,2).toString(4);s.length<o;)s="0"+s;return"".concat(l,"/").concat(s)}function e4(i,e,t){const r=1<<e;return[(i[0]+t[0])/r,(i[1]+t[1])/r]}function t4(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))}function i4(i){return[t4(i[0]),t4(i[1])]}function r4(i,e){let[t,r]=e;switch(i){case 0:return[1,t,r];case 1:return[-t,1,r];case 2:return[-t,-r,1];case 3:return[-1,-r,-t];case 4:return[r,-1,-t];case 5:return[r,t,-1];default:throw new Error("Invalid face")}}function n4(i){let[e,t,r]=i;const n=Math.atan2(r,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*YF,n*YF]}function oie(i,e,t,r){if(r===0){t===1&&(e[0]=i-1-e[0],e[1]=i-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}function aie(i){const e=e4(i.ij,i.level,[.5,.5]),t=i4(e),r=r4(i.face,t);return n4(r)}const lie=100;function s4(i){const{face:e,ij:t,level:r}=i,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(lie*Math.pow(2,-r))),l=new Float64Array(4*o*2+2);let s=0,g=0;for(let v=0;v<4;v++){const T=n[v].slice(0),F=n[v+1],R=(F[0]-T[0])/o,U=(F[1]-T[1])/o;for(let J=0;J<o;J++){T[0]+=R,T[1]+=U;const te=e4(t,r,T),Ae=i4(te),he=r4(e,Ae),pe=n4(he);Math.abs(pe[1])>89.999&&(pe[0]=g);const be=pe[0]-g;pe[0]+=be>180?-360:be<-180?360:0,l[s++]=pe[0],l[s++]=pe[1],g=pe[0]}}return l[s++]=l[0],l[s++]=l[1],l}function oC(i){const e=cie(i);return nie(e)}function cie(i){if(i.indexOf("/")>0)return i;const e=JF(i);return sie(e)}function uie(i){const e=oC(i);return aie(e)}function hie(i){let e;if(i.face===2||i.face===5){let t=null,r=0;for(let n=0;n<4;n++){const o="".concat(i.face,"/").concat(n),l=oC(o),s=s4(l);(typeof t>"u"||t===null)&&(t=new Float64Array(4*s.length)),t.set(s,r),r+=s.length}e=o4(t)}else{const t=s4(i);e=o4(t)}return e}function o4(i){if(i.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let r=0;r<i.length;r+=2)e.push(i[r]),t.push(i[r+1]);return e.sort((r,n)=>r-n),t.sort((r,n)=>r-n),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function Aie(i,e){const t=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,n=oC(i),o=hie(n),l=o.west,s=o.south,g=o.east,v=o.north,T=[];return T.push(new Ut(l,v,t)),T.push(new Ut(g,v,t)),T.push(new Ut(g,s,t)),T.push(new Ut(l,s,t)),T.push(new Ut(l,v,r)),T.push(new Ut(g,v,r)),T.push(new Ut(g,s,r)),T.push(new Ut(l,s,r)),T}function a4(i){const e=i.token,t={minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight},r=Aie(e,t),n=uie(e),o=n[0],l=n[1],s=fo.WGS84.cartographicToCartesian([o,l,t.maximumHeight]),g=new Ut(s[0],s[1],s[2]);r.push(g);const v=jZ(r);return[...v.center,...v.halfAxes]}const die={QUADTREE:4,OCTREE:8};function fie(i,e,t){if(i!=null&&i.box){const r=JF(i.s2VolumeInfo.token),n=eie(r,e),o=Yte(n),l={...i.s2VolumeInfo};switch(l.token=o,t){case"OCTREE":const v=i.s2VolumeInfo,T=v.maximumHeight-v.minimumHeight,F=T/2,R=v.minimumHeight+T/2;v.minimumHeight=R-F,v.maximumHeight=R+F;break}return{box:a4(l),s2VolumeInfo:l}}}async function l4(i){const{options:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:n={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:o}=i;let{subtree:l,level:s=0}=i;const{subdivisionScheme:g,subtreeLevels:v,maximumLevel:T,contentUrlTemplate:F,subtreesUriTemplate:R,basePath:U}=e,J={children:[],lodMetricValue:0,contentUrl:""},te=die[g],Ae=r&1,he=r>>1&1,pe=r>>2&1,be=(te**s-1)/(te-1);let Te=Tf(t.mortonIndex,r),qe=be+Te,je=Tf(t.x,Ae),We=Tf(t.y,he),Ne=Tf(t.z,pe),at=!1;s+1>v&&(at=aC(l.childSubtreeAvailability,Te));const nt=Tf(n.x,je),ke=Tf(n.y,We),De=Tf(n.z,Ne),Ye=s+n.level;if(at){const bt="".concat(U,"/").concat(R),Rt=lC(bt,Ye,nt,ke,De);l=await rd(Rt,QF),n.mortonIndex=Te,n.x=je,n.y=We,n.z=Ne,n.level=s,Te=0,qe=0,je=0,We=0,Ne=0,s=0}if(!aC(l.tileAvailability,qe)||s>T)return J;aC(l.contentAvailability,qe)&&(J.contentUrl=lC(F,Ye,nt,ke,De));const Et=s+1,Pt={mortonIndex:Te,x:je,y:We,z:Ne};for(let bt=0;bt<te;bt++){const Rt=fie(o,bt,g),Ft=await l4({subtree:l,options:e,parentData:Pt,childIndex:bt,level:Et,globalData:n,s2VolumeBox:Rt});if(Ft.contentUrl||Ft.children.length){const Xt=Ye+1,Xe=pie(Ft,Xt,{childTileX:je,childTileY:We,childTileZ:Ne},e,o);J.children.push(Xe)}}return J}function aC(i,e){return"constant"in i?!!i.constant:i.explicitBitstream?yie(e,i.explicitBitstream):!1}function pie(i,e,t,r,n){const{basePath:o,refine:l,getRefine:s,lodMetricType:g,getTileType:v,rootLodMetricValue:T,rootBoundingVolume:F}=r,R=i.contentUrl&&i.contentUrl.replace("".concat(o,"/"),""),U=T/2**e,J=n!=null&&n.box?{box:n.box}:F,te=gie(e,J,t);return{children:i.children,contentUrl:i.contentUrl,content:{uri:R},id:i.contentUrl,refine:s(l),type:v(i),lodMetricType:g,lodMetricValue:U,geometricError:U,transform:i.transform,boundingVolume:te}}function gie(i,e,t){if(e.region){const{childTileX:r,childTileY:n,childTileZ:o}=t,[l,s,g,v,T,F]=e.region,R=2**i,U=(g-l)/R,J=(v-s)/R,te=(F-T)/R,[Ae,he]=[l+U*r,l+U*(r+1)],[pe,be]=[s+J*n,s+J*(n+1)],[Te,qe]=[T+te*o,T+te*(o+1)];return{region:[Ae,pe,he,be,Te,qe]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function Tf(i,e){return parseInt(i.toString(2)+e.toString(2),2)}function lC(i,e,t,r,n){const o=mie({level:e,x:t,y:r,z:n});return i.replace(/{level}|{x}|{y}|{z}/gi,l=>o[l])}function mie(i){const e={};for(const t in i)e["{".concat(t,"}")]=i[t];return e}function yie(i,e){const t=Math.floor(i/8),r=i%8;return(e[t]>>r&1)===1}function cC(i){if(!i.contentUrl)return yg.EMPTY;const t=i.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return yg.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return yg.SCENEGRAPH;default:return t}}function uC(i){switch(i){case"REPLACE":case"replace":return LA.REPLACE;case"ADD":case"add":return LA.ADD;default:return i}}function hC(i,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(i,"".concat(e,"/"));return decodeURI(r.toString())}else if(i.startsWith("/"))return i;return"".concat(e,"/").concat(i)}function c4(i,e){if(!i)return null;if(i.content){const t=i.content.uri||i.content.url;i.contentUrl=hC(t,e.basePath)}return i.id=i.contentUrl,i.lodMetricType=V1.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform,i.type=cC(i),i.refine=uC(i.refine),i}async function _ie(i,e){const t=i.basePath;let r;const n=h4(i==null?void 0:i.root);n&&i.root?r=await u4(i.root,i,n,e):r=c4(i.root,i);const o=[];for(o.push(r);o.length>0;){const s=(o.pop()||{}).children||[];for(let g of s){const v=h4(g);v?g=await u4(g,i,v,e):c4(g,{basePath:t}),o.push(g)}}return r}async function u4(i,e,t,r){var n,o;const l=e.basePath,{subdivisionScheme:s,maximumLevel:g,subtreeLevels:v,subtrees:{uri:T}}=t,F=lC(T,0,0,0,0),R=hC(F,l),U=await rd(R,QF,r),J=hC(i.content.uri,l),te=e==null||(n=e.root)===null||n===void 0?void 0:n.refine,Ae=i.geometricError,he=(o=i.boundingVolume.extensions)===null||o===void 0?void 0:o["3DTILES_bounding_volume_S2"];if(he){const qe={box:a4(he),s2VolumeInfo:he};i.boundingVolume=qe}const pe=i.boundingVolume,be={contentUrlTemplate:J,subtreesUriTemplate:T,subdivisionScheme:s,subtreeLevels:v,maximumLevel:g,refine:te,basePath:l,lodMetricType:V1.GEOMETRIC_ERROR,rootLodMetricValue:Ae,rootBoundingVolume:pe,getTileType:cC,getRefine:uC};return await vie(i,U,be)}async function vie(i,e,t){if(!i)return null;i.lodMetricType=V1.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform;const{children:r,contentUrl:n}=await l4({subtree:e,options:t,s2VolumeBox:i});return n&&(i.contentUrl=n,i.content={uri:n.replace("".concat(t.basePath,"/"),"")}),i.refine=uC(i.refine),i.type=cC(i),i.children=r,i.id=i.contentUrl,i}function h4(i){var e;return(i==null||(e=i.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(i==null?void 0:i.implicitTiling)}const AC={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:TF,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Bie,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function bie(i){return bw(i.url)}async function xie(i,e,t){const r={content:{featureIds:null}};return await NF(i,0,e,t,r.content),r.content}async function wie(i,e,t){var r;const n=JSON.parse(new TextDecoder().decode(i));return n.loader=e.loader||AC,n.url=t.url,n.queryString=t.queryString,n.basePath=bie(n),n.root=await _ie(n,e),n.type=Iu.TILES3D,n.lodMetricType=V1.GEOMETRIC_ERROR,n.lodMetricValue=((r=n.root)===null||r===void 0?void 0:r.lodMetricValue)||0,n}async function Bie(i,e,t){const r=e["3d-tiles"]||{};let n;return r.isTileset==="auto"?n=t.url&&t.url.indexOf(".json")!==-1:n=r.isTileset,n?i=await wie(i,e,t):i=await xie(i,e,t),i}const A4=[0],Cie={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:AC,onTilesetLoad:{type:"function",value:i=>{}},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:(i,e,t)=>{}},_getMeshColor:{type:"function",value:i=>[255,255,255]}};class dC extends ZM{constructor(){super(...arguments),ye(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&On.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!(!((e=this.state)===null||e===void 0||(t=e.tileset3d)===null||t===void 0)&&t.isLoaded()&&super.isLoaded)}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){let{props:t,oldProps:r,changeFlags:n}=e;if(t.data&&t.data!==r.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:o}=this.state;Object.keys(o).length&&(this._updateTileset(o),this.state.lastUpdatedViewports=o,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:o}=this.state;for(const l in o)o[l].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,t[e.id]=e;const n=r==null?void 0:r[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(e){let{info:t,sourceLayer:r}=e;const n=r&&r.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer(e){let{layer:t,viewport:r}=e;const{tile:n}=t.props,{id:o}=r;return n.selected&&n.viewportIds.includes(o)}_updateAutoHighlight(e){const t=e.sourceTile,r=this.state.layerMap[t==null?void 0:t.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const n={loadOptions:{...t}};let o=e;if(r.preload){const g=await r.preload(e,t);g.url&&(o=g.url),g.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:g.headers}),Object.assign(n,g)}const l=await rd(o,r,n.loadOptions),s=new ate(l,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:s,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(s)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:r}=this.context,n=Object.keys(e).length;!r||!n||!t||t.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case yg.POINTCLOUD:return this._makePointCloudLayer(e,t);case yg.SCENEGRAPH:return this._make3DModelLayer(e);case yg.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,t){const{attributes:r,pointCount:n,constantRGBA:o,cartographicOrigin:l,modelMatrix:s}=e.content,{positions:g,normals:v,colors:T}=r;if(!g)return null;const F=t&&t.props.data||{header:{vertexCount:n},attributes:{POSITION:g,NORMAL:v,COLOR_0:T}},{pointSize:R,getPointColor:U}=this.props,J=this.getSubLayerClass("pointcloud",mB);return new J({pointSize:R},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:F,coordinateSystem:Mn.METER_OFFSETS,coordinateOrigin:l,modelMatrix:s,getColor:o||U,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:r,cartographicOrigin:n,modelMatrix:o}=e.content,l=this.getSubLayerClass("scenegraph",kB);return new l({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:r||A4,scenegraph:t,coordinateSystem:Mn.METER_OFFSETS,coordinateOrigin:n,modelMatrix:o,getTransformMatrix:s=>s.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const r=e.content,{attributes:n,indices:o,modelMatrix:l,cartographicOrigin:s,coordinateSystem:g=Mn.METER_OFFSETS,material:v,featureIds:T}=r,{_getMeshColor:F}=this.props,R=t&&t.props.mesh||new my({drawMode:4,attributes:Eie(n),indices:o}),U=this.getSubLayerClass("mesh",OB);return new U(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:R,data:A4,getColor:F(e),pbrMaterial:v,modelMatrix:l,coordinateOrigin:s,coordinateSystem:g,featureIds:T,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(r=>{const n=t[r.id]=t[r.id]||{tile:r};let{layer:o}=n;return r.selected&&(o?n.needsUpdate&&(o=this._getSubLayer(r,o),n.needsUpdate=!1):o=this._getSubLayer(r)),n.layer=o,o}).filter(Boolean):null}}ye(dC,"defaultProps",Cie),ye(dC,"layerName","Tile3DLayer");function Eie(i){const e={};return e.positions={...i.positions,value:new Float32Array(i.positions.value)},i.normals&&(e.normals=i.normals),i.texCoords&&(e.texCoords=i.texCoords),i.colors&&(e.colors=i.colors),i.uvRegions&&(e.uvRegions=i.uvRegions),e}var d4={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(cf,function(){var t,r,n;function o(s,g){if(!t)t=g;else if(!r)r=g;else{var v="var sharedChunk = {}; ("+t+")(sharedChunk); ("+r+")(sharedChunk);",T={};t(T),n=g(T),typeof window<"u"&&(n.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}}o(["exports"],function(s){function g(h,c,d,_){return new(d||(d=Promise))(function(S,M){function k(Y){try{W(_.next(Y))}catch(ae){M(ae)}}function G(Y){try{W(_.throw(Y))}catch(ae){M(ae)}}function W(Y){var ae;Y.done?S(Y.value):(ae=Y.value,ae instanceof d?ae:new d(function(fe){fe(ae)})).then(k,G)}W((_=_.apply(h,c||[])).next())})}function v(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}typeof SuppressedError=="function"&&SuppressedError;var T=F;function F(h,c){this.x=h,this.y=c}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,c){return this.clone()._rotateAround(h,c)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var c=h.x-this.x,d=h.y-this.y;return c*c+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,c){return Math.atan2(this.x*c-this.y*h,this.x*h+this.y*c)},_matMult:function(h){var c=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=c,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var c=Math.cos(h),d=Math.sin(h),_=d*this.x+c*this.y;return this.x=c*this.x-d*this.y,this.y=_,this},_rotateAround:function(h,c){var d=Math.cos(h),_=Math.sin(h),S=c.y+_*(this.x-c.x)+d*(this.y-c.y);return this.x=c.x+d*(this.x-c.x)-_*(this.y-c.y),this.y=S,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(h){return h instanceof F?h:Array.isArray(h)?new F(h[0],h[1]):h};var R=v(T),U=J;function J(h,c,d,_){this.cx=3*h,this.bx=3*(d-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(_-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=c,this.p2x=d,this.p2y=_}J.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,c){if(c===void 0&&(c=1e-6),h<0)return 0;if(h>1)return 1;for(var d=h,_=0;_<8;_++){var S=this.sampleCurveX(d)-h;if(Math.abs(S)<c)return d;var M=this.sampleCurveDerivativeX(d);if(Math.abs(M)<1e-6)break;d-=S/M}var k=0,G=1;for(d=h,_=0;_<20&&(S=this.sampleCurveX(d),!(Math.abs(S-h)<c));_++)h>S?k=d:G=d,d=.5*(G-k)+k;return d},solve:function(h,c){return this.sampleCurveY(this.solveCurveX(h,c))}};var te=v(U);let Ae,he;function pe(){return Ae==null&&(Ae=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ae}function be(){if(he==null&&(he=!1,pe())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let _=0;_<5*5;_++){const S=4*_;c.fillStyle=`rgb(${S},${S+1},${S+2})`,c.fillRect(_%5,Math.floor(_/5),1,1)}const d=c.getImageData(0,0,5,5).data;for(let _=0;_<5*5*4;_++)if(_%4!=3&&d[_]!==_){he=!0;break}}}return he||!1}function Te(h,c,d,_){const S=new te(h,c,d,_);return function(M){return S.solve(M)}}const qe=Te(.25,.1,.25,1);function je(h,c,d){return Math.min(d,Math.max(c,h))}function We(h,c,d){const _=d-c,S=((h-c)%_+_)%_+c;return S===c?d:S}function Ne(h){for(var c=arguments.length,d=new Array(c>1?c-1:0),_=1;_<c;_++)d[_-1]=arguments[_];for(const S of d)for(const M in S)h[M]=S[M];return h}let at=1;function nt(h,c,d){const _={};for(const S in h)_[S]=c.call(d||this,h[S],S,h);return _}function ke(h,c,d){const _={};for(const S in h)c.call(d||this,h[S],S,h)&&(_[S]=h[S]);return _}function De(h){return Array.isArray(h)?h.map(De):typeof h=="object"&&h?nt(h,De):h}const Ye={};function Ze(h){Ye[h]||(typeof console<"u"&&console.warn(h),Ye[h]=!0)}function Ct(h,c,d){return(d.y-h.y)*(c.x-h.x)>(c.y-h.y)*(d.x-h.x)}function Et(h){let c=0;for(let d,_,S=0,M=h.length,k=M-1;S<M;k=S++)d=h[S],_=h[k],c+=(_.x-d.x)*(d.y+_.y);return c}function Pt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let bt=null;function Rt(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const Ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Xt(h,c,d,_,S){return g(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const M=new VideoFrame(h,{timestamp:0});try{const k=M==null?void 0:M.format;if(!k||!k.startsWith("BGR")&&!k.startsWith("RGB"))throw new Error(`Unrecognized format ${k}`);const G=k.startsWith("BGR"),W=new Uint8ClampedArray(_*S*4);if(yield M.copyTo(W,function(Y,ae,fe,me,Ce){const Me=4*Math.max(-ae,0),Ue=(Math.max(0,fe)-fe)*me*4+Me,$e=4*me,Ke=Math.max(0,ae),ut=Math.max(0,fe);return{rect:{x:Ke,y:ut,width:Math.min(Y.width,ae+me)-Ke,height:Math.min(Y.height,fe+Ce)-ut},layout:[{offset:Ue,stride:$e}]}}(h,c,d,_,S)),G)for(let Y=0;Y<W.length;Y+=4){const ae=W[Y];W[Y]=W[Y+2],W[Y+2]=ae}return W}finally{M.close()}})}let Le,Xe,it,pt;const mt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h){const c=requestAnimationFrame(h);return{cancel:()=>cancelAnimationFrame(c)}},getImageData(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(h).getImageData(-c,-c,h.width+2*c,h.height+2*c)},getImageCanvasContext(h){const c=window.document.createElement("canvas"),d=c.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return c.width=h.width,c.height=h.height,d.drawImage(h,0,0,h.width,h.height),d},resolveURL:h=>(it||(it=document.createElement("a")),it.href=h,it.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(pt==null&&(pt=matchMedia("(prefers-reduced-motion: reduce)")),pt.matches)}},Bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Dt extends Error{constructor(c,d,_,S){super(`AJAXError: ${d} (${c}): ${_}`),this.status=c,this.statusText=d,this.url=_,this.body=S}}const Mt=Pt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,qt=h=>Bt.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))];function ni(h,c){const d=new AbortController,_=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:Mt(),signal:d.signal});let S=!1,M=!1;return h.type==="json"&&_.headers.set("Accept","application/json"),M||fetch(_).then(k=>k.ok?(G=>{(h.type==="arrayBuffer"||h.type==="image"?G.arrayBuffer():h.type==="json"?G.json():G.text()).then(W=>{M||(S=!0,c(null,W,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(W=>{M||c(new Error(W.message))})})(k):k.blob().then(G=>c(new Dt(k.status,k.statusText,h.url,G)))).catch(k=>{k.code!==20&&c(new Error(k.message))}),{cancel:()=>{M=!0,S||d.abort()}}}const _i=function(h,c){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){if(Pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,c);if(!Pt())return(qt(h.url)||ni)(h,c)}if(!(/^file:/.test(d=h.url)||/^file:/.test(Mt())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ni(h,c);if(Pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,c,void 0,!0)}var d;return function(_,S){const M=new XMLHttpRequest;M.open(_.method||"GET",_.url,!0),_.type!=="arrayBuffer"&&_.type!=="image"||(M.responseType="arraybuffer");for(const k in _.headers)M.setRequestHeader(k,_.headers[k]);return _.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=_.credentials==="include",M.onerror=()=>{S(new Error(M.statusText))},M.onload=()=>{if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let k=M.response;if(_.type==="json")try{k=JSON.parse(M.response)}catch(G){return S(G)}S(null,k,M.getResponseHeader("Cache-Control"),M.getResponseHeader("Expires"))}else{const k=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});S(new Dt(M.status,M.statusText,_.url,k))}},M.send(_.body),{cancel:()=>M.abort()}}(h,c)},vi=function(h,c){return _i(Ne(h,{type:"arrayBuffer"}),c)};function Pi(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const c=new URL(h),d=window.location;return c.protocol===d.protocol&&c.host===d.host}function kt(h,c,d){d[h]&&d[h].indexOf(c)!==-1||(d[h]=d[h]||[],d[h].push(c))}function lt(h,c,d){if(d&&d[h]){const _=d[h].indexOf(c);_!==-1&&d[h].splice(_,1)}}class wt{constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ne(this,d),this.type=c}}class Oi extends wt{constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Ne({error:c},d))}}class ti{on(c,d){return this._listeners=this._listeners||{},kt(c,d,this._listeners),this}off(c,d){return lt(c,d,this._listeners),lt(c,d,this._oneTimeListeners),this}once(c,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},kt(c,d,this._oneTimeListeners),this):new Promise(_=>this.once(c,_))}fire(c,d){typeof c=="string"&&(c=new wt(c,d||{}));const _=c.type;if(this.listens(_)){c.target=this;const S=this._listeners&&this._listeners[_]?this._listeners[_].slice():[];for(const G of S)G.call(this,c);const M=this._oneTimeListeners&&this._oneTimeListeners[_]?this._oneTimeListeners[_].slice():[];for(const G of M)lt(_,G,this._oneTimeListeners),G.call(this,c);const k=this._eventedParent;k&&(Ne(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(c))}else c instanceof Oi&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,d){return this._eventedParent=c,this._eventedParentData=d,this}}var ht={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const $t=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function oi(h,c){const d={};for(const _ in h)_!=="ref"&&(d[_]=h[_]);return $t.forEach(_=>{_ in c&&(d[_]=c[_])}),d}function gi(h,c){if(Array.isArray(h)){if(!Array.isArray(c)||h.length!==c.length)return!1;for(let d=0;d<h.length;d++)if(!gi(h[d],c[d]))return!1;return!0}if(typeof h=="object"&&h!==null&&c!==null){if(typeof c!="object"||Object.keys(h).length!==Object.keys(c).length)return!1;for(const d in h)if(!gi(h[d],c[d]))return!1;return!0}return h===c}const ci={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ki(h,c,d){d.push({command:ci.addSource,args:[h,c[h]]})}function tr(h,c,d){c.push({command:ci.removeSource,args:[h]}),d[h]=!0}function pr(h,c,d,_){tr(h,d,_),Ki(h,c,d)}function Mr(h,c,d){let _;for(_ in h[d])if(Object.prototype.hasOwnProperty.call(h[d],_)&&_!=="data"&&!gi(h[d][_],c[d][_]))return!1;for(_ in c[d])if(Object.prototype.hasOwnProperty.call(c[d],_)&&_!=="data"&&!gi(h[d][_],c[d][_]))return!1;return!0}function zt(h,c,d,_,S,M){let k;for(k in c=c||{},h=h||{})Object.prototype.hasOwnProperty.call(h,k)&&(gi(h[k],c[k])||d.push({command:M,args:[_,k,c[k],S]}));for(k in c)Object.prototype.hasOwnProperty.call(c,k)&&!Object.prototype.hasOwnProperty.call(h,k)&&(gi(h[k],c[k])||d.push({command:M,args:[_,k,c[k],S]}))}function Wi(h){return h.id}function hi(h,c){return h[c.id]=c,h}class Wt{constructor(c,d,_,S){this.message=(c?`${c}: `:"")+_,S&&(this.identifier=S),d!=null&&d.__line__&&(this.line=d.__line__)}}function Ar(h){for(var c=arguments.length,d=new Array(c>1?c-1:0),_=1;_<c;_++)d[_-1]=arguments[_];for(const S of d)for(const M in S)h[M]=S[M];return h}class Qt extends Error{constructor(c,d){super(d),this.message=d,this.key=c}}class Si{constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=c,this.bindings={};for(const[_,S]of d)this.bindings[_]=S}concat(c){return new Si(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const Ii={kind:"null"},Zt={kind:"number"},bi={kind:"string"},ei={kind:"boolean"},_r={kind:"color"},Zr={kind:"object"},Qe={kind:"value"},Be={kind:"collator"},ce={kind:"formatted"},ie={kind:"padding"},ue={kind:"resolvedImage"},ge={kind:"variableAnchorOffsetCollection"};function xe(h,c){return{kind:"array",itemType:h,N:c}}function Ee(h){if(h.kind==="array"){const c=Ee(h.itemType);return typeof h.N=="number"?`array<${c}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${c}>`}return h.kind}const we=[Ii,Zt,bi,ei,_r,ce,Zr,xe(Qe),ie,ue,ge];function Fe(h,c){if(c.kind==="error")return null;if(h.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Fe(h.itemType,c.itemType))&&(typeof h.N!="number"||h.N===c.N))return null}else{if(h.kind===c.kind)return null;if(h.kind==="value"){for(const d of we)if(!Fe(d,c))return null}}return`Expected ${Ee(h)} but found ${Ee(c)} instead.`}function ze(h,c){return c.some(d=>d.kind===h.kind)}function Ge(h,c){return c.some(d=>d==="null"?h===null:d==="array"?Array.isArray(h):d==="object"?h&&!Array.isArray(h)&&typeof h=="object":d===typeof h)}function st(h,c){return h.kind==="array"&&c.kind==="array"?h.itemType.kind===c.itemType.kind&&typeof h.N=="number":h.kind===c.kind}const vt=.96422,Tt=.82521,Kt=4/29,ii=6/29,Gt=3*ii*ii,Ai=ii*ii*ii,Bi=Math.PI/180,Hi=180/Math.PI;function Ci(h){return(h%=360)<0&&(h+=360),h}function Ni(h){let[c,d,_,S]=h,M,k;const G=ri((.2225045*(c=ot(c))+.7168786*(d=ot(d))+.0606169*(_=ot(_)))/1);c===d&&d===_?M=k=G:(M=ri((.4360747*c+.3850649*d+.1430804*_)/vt),k=ri((.0139322*c+.0971045*d+.7141733*_)/Tt));const W=116*G-16;return[W<0?0:W,500*(M-G),200*(G-k),S]}function ot(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function ri(h){return h>Ai?Math.pow(h,1/3):h/Gt+Kt}function Vt(h){let[c,d,_,S]=h,M=(c+16)/116,k=isNaN(d)?M:M+d/500,G=isNaN(_)?M:M-_/200;return M=1*lr(M),k=vt*lr(k),G=Tt*lr(G),[Vi(3.1338561*k-1.6168667*M-.4906146*G),Vi(-.9787684*k+1.9161415*M+.033454*G),Vi(.0719453*k-.2289914*M+1.4052427*G),S]}function Vi(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function lr(h){return h>ii?h*h*h:Gt*(h-Kt)}function un(h){return parseInt(h.padEnd(2,h),16)/255}function wn(h,c){return gr(c?h/100:h,0,1)}function gr(h,c,d){return Math.min(Math.max(c,h),d)}function mn(h){return!h.some(Number.isNaN)}const yn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class dr{constructor(c,d,_){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=c,this.g=d,this.b=_,this.a=S,M||(this.r*=S,this.g*=S,this.b*=S,S||this.overwriteGetter("rgb",[c,d,_,S]))}static parse(c){if(c instanceof dr)return c;if(typeof c!="string")return;const d=function(_){if((_=_.toLowerCase().trim())==="transparent")return[0,0,0,0];const S=yn[_];if(S){const[k,G,W]=S;return[k/255,G/255,W/255,1]}if(_.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(_)){const k=_.length<6?1:2;let G=1;return[un(_.slice(G,G+=k)),un(_.slice(G,G+=k)),un(_.slice(G,G+=k)),un(_.slice(G,G+k)||"ff")]}if(_.startsWith("rgb")){const k=_.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke,ut]=k,tt=[ae||" ",Ce||" ",$e].join("");if(tt==="  "||tt==="  /"||tt===",,"||tt===",,,"){const rt=[Y,me,Ue].join(""),yt=rt==="%%%"?100:rt===""?255:0;if(yt){const St=[gr(+W/yt,0,1),gr(+fe/yt,0,1),gr(+Me/yt,0,1),Ke?wn(+Ke,ut):1];if(mn(St))return St}}return}}const M=_.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(M){const[k,G,W,Y,ae,fe,me,Ce,Me]=M,Ue=[W||" ",ae||" ",me].join("");if(Ue==="  "||Ue==="  /"||Ue===",,"||Ue===",,,"){const $e=[+G,gr(+Y,0,100),gr(+fe,0,100),Ce?wn(+Ce,Me):1];if(mn($e))return function(Ke){let[ut,tt,rt,yt]=Ke;function St(Jt){const wi=(Jt+ut/30)%12,ai=tt*Math.min(rt,1-rt);return rt-ai*Math.max(-1,Math.min(wi-3,9-wi,1))}return ut=Ci(ut),tt/=100,rt/=100,[St(0),St(8),St(4),yt]}($e)}}}(c);return d?new dr(...d,!1):void 0}get rgb(){const{r:c,g:d,b:_,a:S}=this,M=S||1/0;return this.overwriteGetter("rgb",[c/M,d/M,_/M,S])}get hcl(){return this.overwriteGetter("hcl",function(c){const[d,_,S,M]=Ni(c),k=Math.sqrt(_*_+S*S);return[Math.round(1e4*k)?Ci(Math.atan2(S,_)*Hi):NaN,k,d,M]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ni(this.rgb))}overwriteGetter(c,d){return Object.defineProperty(this,c,{value:d}),d}toString(){const[c,d,_,S]=this.rgb;return`rgba(${[c,d,_].map(M=>Math.round(255*M)).join(",")},${S})`}}dr.black=new dr(0,0,0,1),dr.white=new dr(1,1,1,1),dr.transparent=new dr(0,0,0,0),dr.red=new dr(1,0,0,1);class Hn{constructor(c,d,_){this.sensitivity=c?d?"variant":"case":d?"accent":"base",this.locale=_,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,d){return this.collator.compare(c,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gs{constructor(c,d,_,S,M){this.text=c,this.image=d,this.scale=_,this.fontStack=S,this.textColor=M}}class Or{constructor(c){this.sections=c}static fromString(c){return new Or([new Gs(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof Or?c:Or.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class Bn{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Bn)return c;if(typeof c=="number")return new Bn([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const d of c)if(typeof d!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new Bn(c)}}toString(){return JSON.stringify(this.values)}}const qa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Un{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Un)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let d=0;d<c.length;d+=2){const _=c[d],S=c[d+1];if(typeof _!="string"||!qa.has(_)||!Array.isArray(S)||S.length!==2||typeof S[0]!="number"||typeof S[1]!="number")return}return new Un(c)}}toString(){return JSON.stringify(this.values)}}class Zi{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new Zi({name:c,available:!1}):null}}function ao(h,c,d,_){return typeof h=="number"&&h>=0&&h<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof d=="number"&&d>=0&&d<=255?_===void 0||typeof _=="number"&&_>=0&&_<=1?null:`Invalid rgba value [${[h,c,d,_].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof _=="number"?[h,c,d,_]:[h,c,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ms(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof dr||h instanceof Hn||h instanceof Or||h instanceof Bn||h instanceof Un||h instanceof Zi)return!0;if(Array.isArray(h)){for(const c of h)if(!Ms(c))return!1;return!0}if(typeof h=="object"){for(const c in h)if(!Ms(h[c]))return!1;return!0}return!1}function vr(h){if(h===null)return Ii;if(typeof h=="string")return bi;if(typeof h=="boolean")return ei;if(typeof h=="number")return Zt;if(h instanceof dr)return _r;if(h instanceof Hn)return Be;if(h instanceof Or)return ce;if(h instanceof Bn)return ie;if(h instanceof Un)return ge;if(h instanceof Zi)return ue;if(Array.isArray(h)){const c=h.length;let d;for(const _ of h){const S=vr(_);if(d){if(d===S)continue;d=Qe;break}d=S}return xe(d||Qe,c)}return Zr}function Tr(h){const c=typeof h;return h===null?"":c==="string"||c==="number"||c==="boolean"?String(h):h instanceof dr||h instanceof Or||h instanceof Bn||h instanceof Un||h instanceof Zi?h.toString():JSON.stringify(h)}class rs{constructor(c,d){this.type=c,this.value=d}static parse(c,d){if(c.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!Ms(c[1]))return d.error("invalid value");const _=c[1];let S=vr(_);const M=d.expectedType;return S.kind!=="array"||S.N!==0||!M||M.kind!=="array"||typeof M.N=="number"&&M.N!==0||(S=M),new rs(S,_)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Gr{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const Tn={string:bi,number:Zt,boolean:ei,object:Zr};class Cn{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");let _,S=1;const M=c[0];if(M==="array"){let G,W;if(c.length>2){const Y=c[1];if(typeof Y!="string"||!(Y in Tn)||Y==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);G=Tn[Y],S++}else G=Qe;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return d.error('The length argument to "array" must be a positive integer literal',2);W=c[2],S++}_=xe(G,W)}else{if(!Tn[M])throw new Error(`Types doesn't contain name = ${M}`);_=Tn[M]}const k=[];for(;S<c.length;S++){const G=d.parse(c[S],S,Qe);if(!G)return null;k.push(G)}return new Cn(_,k)}evaluate(c){for(let d=0;d<this.args.length;d++){const _=this.args[d].evaluate(c);if(!Fe(this.type,vr(_)))return _;if(d===this.args.length-1)throw new Gr(`Expected value to be of type ${Ee(this.type)}, but found ${Ee(vr(_))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const po={"to-boolean":ei,"to-color":_r,"to-number":Zt,"to-string":bi};class Lr{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");const _=c[0];if(!po[_])throw new Error(`Can't parse ${_} as it is not part of the known types`);if((_==="to-boolean"||_==="to-string")&&c.length!==2)return d.error("Expected one argument.");const S=po[_],M=[];for(let k=1;k<c.length;k++){const G=d.parse(c[k],k,Qe);if(!G)return null;M.push(G)}return new Lr(S,M)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let d,_;for(const S of this.args){if(d=S.evaluate(c),_=null,d instanceof dr)return d;if(typeof d=="string"){const M=c.parseColor(d);if(M)return M}else if(Array.isArray(d)&&(_=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:ao(d[0],d[1],d[2],d[3]),!_))return new dr(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new Gr(_||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(const _ of this.args){d=_.evaluate(c);const S=Bn.parse(d);if(S)return S}throw new Gr(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(const _ of this.args){d=_.evaluate(c);const S=Un.parse(d);if(S)return S}throw new Gr(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(const _ of this.args){if(d=_.evaluate(c),d===null)return 0;const S=Number(d);if(!isNaN(S))return S}throw new Gr(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return Or.fromString(Tr(this.args[0].evaluate(c)));case"resolvedImage":return Zi.fromString(Tr(this.args[0].evaluate(c)));default:return Tr(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const $a=["Unknown","Point","LineString","Polygon"];class Zs{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$a[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let d=this._parseColorCache[c];return d||(d=this._parseColorCache[c]=dr.parse(c)),d}}class Ka{constructor(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],S=arguments.length>3?arguments[3]:void 0,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Si,k=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=c,this.path=_,this.key=_.map(G=>`[${G}]`).join(""),this.scope=M,this.errors=k,this.expectedType=S,this._isConstant=d}parse(c,d,_,S){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return d?this.concat(d,_,S)._parse(c,M):this._parse(c,M)}_parse(c,d){function _(S,M,k){return k==="assert"?new Cn(M,[S]):k==="coerce"?new Lr(M,[S]):S}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const S=c[0];if(typeof S!="string")return this.error(`Expression name must be a string, but found ${typeof S} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const M=this.registry[S];if(M){let k=M.parse(c,this);if(!k)return null;if(this.expectedType){const G=this.expectedType,W=k.type;if(G.kind!=="string"&&G.kind!=="number"&&G.kind!=="boolean"&&G.kind!=="object"&&G.kind!=="array"||W.kind!=="value")if(G.kind!=="color"&&G.kind!=="formatted"&&G.kind!=="resolvedImage"||W.kind!=="value"&&W.kind!=="string")if(G.kind!=="padding"||W.kind!=="value"&&W.kind!=="number"&&W.kind!=="array")if(G.kind!=="variableAnchorOffsetCollection"||W.kind!=="value"&&W.kind!=="array"){if(this.checkSubtype(G,W))return null}else k=_(k,G,d.typeAnnotation||"coerce");else k=_(k,G,d.typeAnnotation||"coerce");else k=_(k,G,d.typeAnnotation||"coerce");else k=_(k,G,d.typeAnnotation||"assert")}if(!(k instanceof rs)&&k.type.kind!=="resolvedImage"&&this._isConstant(k)){const G=new Zs;try{k=new rs(k.type,k.evaluate(G))}catch(W){return this.error(W.message),null}}return k}return this.error(`Unknown expression "${S}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,d,_){const S=typeof c=="number"?this.path.concat(c):this.path,M=_?this.scope.concat(_):this.scope;return new Ka(this.registry,this._isConstant,S,d||null,M,this.errors)}error(c){for(var d=arguments.length,_=new Array(d>1?d-1:0),S=1;S<d;S++)_[S-1]=arguments[S];const M=`${this.key}${_.map(k=>`[${k}]`).join("")}`;this.errors.push(new Qt(M,c))}checkSubtype(c,d){const _=Fe(c,d);return _&&this.error(_),_}}class He{constructor(c,d,_){this.type=Be,this.locale=_,this.caseSensitive=c,this.diacriticSensitive=d}static parse(c,d){if(c.length!==2)return d.error("Expected one argument.");const _=c[1];if(typeof _!="object"||Array.isArray(_))return d.error("Collator options argument must be an object.");const S=d.parse(_["case-sensitive"]!==void 0&&_["case-sensitive"],1,ei);if(!S)return null;const M=d.parse(_["diacritic-sensitive"]!==void 0&&_["diacritic-sensitive"],1,ei);if(!M)return null;let k=null;return _.locale&&(k=d.parse(_.locale,1,bi),!k)?null:new He(S,M,k)}evaluate(c){return new Hn(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}const Je=8192;function gt(h,c){h[0]=Math.min(h[0],c[0]),h[1]=Math.min(h[1],c[1]),h[2]=Math.max(h[2],c[0]),h[3]=Math.max(h[3],c[1])}function Ot(h,c){return!(h[0]<=c[0]||h[2]>=c[2]||h[1]<=c[1]||h[3]>=c[3])}function di(h,c){const d=(180+h[0])/360,_=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,S=Math.pow(2,c.z);return[Math.round(d*S*Je),Math.round(_*S*Je)]}function ji(h,c,d){const _=h[0]-c[0],S=h[1]-c[1],M=h[0]-d[0],k=h[1]-d[1];return _*k-M*S==0&&_*M<=0&&S*k<=0}function Br(h,c){let d=!1;for(let k=0,G=c.length;k<G;k++){const W=c[k];for(let Y=0,ae=W.length;Y<ae-1;Y++){if(ji(h,W[Y],W[Y+1]))return!1;(S=W[Y])[1]>(_=h)[1]!=(M=W[Y+1])[1]>_[1]&&_[0]<(M[0]-S[0])*(_[1]-S[1])/(M[1]-S[1])+S[0]&&(d=!d)}}var _,S,M;return d}function In(h,c){for(let d=0;d<c.length;d++)if(Br(h,c[d]))return!0;return!1}function Gn(h,c,d,_){const S=_[0]-d[0],M=_[1]-d[1],k=(h[0]-d[0])*M-S*(h[1]-d[1]),G=(c[0]-d[0])*M-S*(c[1]-d[1]);return k>0&&G<0||k<0&&G>0}function ns(h,c,d){for(const Y of d)for(let ae=0;ae<Y.length-1;++ae)if((G=[(k=Y[ae+1])[0]-(M=Y[ae])[0],k[1]-M[1]])[0]*(W=[(S=c)[0]-(_=h)[0],S[1]-_[1]])[1]-G[1]*W[0]!=0&&Gn(_,S,M,k)&&Gn(M,k,_,S))return!0;var _,S,M,k,G,W;return!1}function _n(h,c){for(let d=0;d<h.length;++d)if(!Br(h[d],c))return!1;for(let d=0;d<h.length-1;++d)if(ns(h[d],h[d+1],c))return!1;return!0}function uu(h,c){for(let d=0;d<c.length;d++)if(_n(h,c[d]))return!0;return!1}function Nl(h,c,d){const _=[];for(let S=0;S<h.length;S++){const M=[];for(let k=0;k<h[S].length;k++){const G=di(h[S][k],d);gt(c,G),M.push(G)}_.push(M)}return _}function Cr(h,c,d){const _=[];for(let S=0;S<h.length;S++){const M=Nl(h[S],c,d);_.push(M)}return _}function Wa(h,c,d,_){if(h[0]<d[0]||h[0]>d[2]){const S=.5*_;let M=h[0]-d[0]>S?-_:d[0]-h[0]>S?_:0;M===0&&(M=h[0]-d[2]>S?-_:d[2]-h[0]>S?_:0),h[0]+=M}gt(c,h)}function zl(h,c,d,_){const S=Math.pow(2,_.z)*Je,M=[_.x*Je,_.y*Je],k=[];for(const G of h)for(const W of G){const Y=[W.x+M[0],W.y+M[1]];Wa(Y,c,d,S),k.push(Y)}return k}function ss(h,c,d,_){const S=Math.pow(2,_.z)*Je,M=[_.x*Je,_.y*Je],k=[];for(const W of h){const Y=[];for(const ae of W){const fe=[ae.x+M[0],ae.y+M[1]];gt(c,fe),Y.push(fe)}k.push(Y)}if(c[2]-c[0]<=S/2){(G=c)[0]=G[1]=1/0,G[2]=G[3]=-1/0;for(const W of k)for(const Y of W)Wa(Y,c,d,S)}var G;return k}class To{constructor(c,d){this.type=ei,this.geojson=c,this.geometries=d}static parse(c,d){if(c.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(Ms(c[1])){const _=c[1];if(_.type==="FeatureCollection")for(let S=0;S<_.features.length;++S){const M=_.features[S].geometry.type;if(M==="Polygon"||M==="MultiPolygon")return new To(_,_.features[S].geometry)}else if(_.type==="Feature"){const S=_.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new To(_,_.geometry)}else if(_.type==="Polygon"||_.type==="MultiPolygon")return new To(_,_)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(d,_){const S=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],k=d.canonicalID();if(_.type==="Polygon"){const G=Nl(_.coordinates,M,k),W=zl(d.geometry(),S,M,k);if(!Ot(S,M))return!1;for(const Y of W)if(!Br(Y,G))return!1}if(_.type==="MultiPolygon"){const G=Cr(_.coordinates,M,k),W=zl(d.geometry(),S,M,k);if(!Ot(S,M))return!1;for(const Y of W)if(!In(Y,G))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(d,_){const S=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],k=d.canonicalID();if(_.type==="Polygon"){const G=Nl(_.coordinates,M,k),W=ss(d.geometry(),S,M,k);if(!Ot(S,M))return!1;for(const Y of W)if(!_n(Y,G))return!1}if(_.type==="MultiPolygon"){const G=Cr(_.coordinates,M,k),W=ss(d.geometry(),S,M,k);if(!Ot(S,M))return!1;for(const Y of W)if(!uu(Y,G))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ea{constructor(c,d){this.type=d.type,this.name=c,this.boundExpression=d}static parse(c,d){if(c.length!==2||typeof c[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const _=c[1];return d.scope.has(_)?new Ea(_,d.scope.get(_)):d.error(`Unknown variable "${_}". Make sure "${_}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class gs{constructor(c,d,_,S){this.name=c,this.type=d,this._evaluate=_,this.args=S}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,d){const _=c[0],S=gs.definitions[_];if(!S)return d.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0);const M=Array.isArray(S)?S[0]:S.type,k=Array.isArray(S)?[[S[1],S[2]]]:S.overloads,G=k.filter(Y=>{let[ae]=Y;return!Array.isArray(ae)||ae.length===c.length-1});let W=null;for(const[Y,ae]of G){W=new Ka(d.registry,Sa,d.path,null,d.scope);const fe=[];let me=!1;for(let Ce=1;Ce<c.length;Ce++){const Me=c[Ce],Ue=Array.isArray(Y)?Y[Ce-1]:Y.type,$e=W.parse(Me,1+fe.length,Ue);if(!$e){me=!0;break}fe.push($e)}if(!me)if(Array.isArray(Y)&&Y.length!==fe.length)W.error(`Expected ${Y.length} arguments, but found ${fe.length} instead.`);else{for(let Ce=0;Ce<fe.length;Ce++){const Me=Array.isArray(Y)?Y[Ce]:Y.type,Ue=fe[Ce];W.concat(Ce+1).checkSubtype(Me,Ue.type)}if(W.errors.length===0)return new gs(_,M,ae,fe)}}if(G.length===1)d.errors.push(...W.errors);else{const Y=(G.length?G:k).map(fe=>{let[me]=fe;return Ce=me,Array.isArray(Ce)?`(${Ce.map(Ee).join(", ")})`:`(${Ee(Ce.type)}...)`;var Ce}).join(" | "),ae=[];for(let fe=1;fe<c.length;fe++){const me=d.parse(c[fe],1+ae.length);if(!me)return null;ae.push(Ee(me.type))}d.error(`Expected arguments of type ${Y}, but found (${ae.join(", ")}) instead.`)}return null}static register(c,d){gs.definitions=d;for(const _ in d)c[_]=gs}}function Sa(h){if(h instanceof Ea)return Sa(h.boundExpression);if(h instanceof gs&&h.name==="error"||h instanceof He||h instanceof To)return!1;const c=h instanceof Lr||h instanceof Cn;let d=!0;return h.eachChild(_=>{d=c?d&&Sa(_):d&&_ instanceof rs}),!!d&&Za(h)&&Uc(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Za(h){if(h instanceof gs&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof To)return!1;let c=!0;return h.eachChild(d=>{c&&!Za(d)&&(c=!1)}),c}function ca(h){if(h instanceof gs&&h.name==="feature-state")return!1;let c=!0;return h.eachChild(d=>{c&&!ca(d)&&(c=!1)}),c}function Uc(h,c){if(h instanceof gs&&c.indexOf(h.name)>=0)return!1;let d=!0;return h.eachChild(_=>{d&&!Uc(_,c)&&(d=!1)}),d}function Xa(h,c){const d=h.length-1;let _,S,M=0,k=d,G=0;for(;M<=k;)if(G=Math.floor((M+k)/2),_=h[G],S=h[G+1],_<=c){if(G===d||c<S)return G;M=G+1}else{if(!(_>c))throw new Gr("Input is not a number.");k=G-1}return 0}class go{constructor(c,d,_){this.type=c,this.input=d,this.labels=[],this.outputs=[];for(const[S,M]of _)this.labels.push(S),this.outputs.push(M)}static parse(c,d){if(c.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return d.error("Expected an even number of arguments.");const _=d.parse(c[1],1,Zt);if(!_)return null;const S=[];let M=null;d.expectedType&&d.expectedType.kind!=="value"&&(M=d.expectedType);for(let k=1;k<c.length;k+=2){const G=k===1?-1/0:c[k],W=c[k+1],Y=k,ae=k+1;if(typeof G!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(S.length&&S[S.length-1][0]>=G)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Y);const fe=d.parse(W,ae,M);if(!fe)return null;M=M||fe.type,S.push([G,fe])}return new go(M,_,S)}evaluate(c){const d=this.labels,_=this.outputs;if(d.length===1)return _[0].evaluate(c);const S=this.input.evaluate(c);if(S<=d[0])return _[0].evaluate(c);const M=d.length;return S>=d[M-1]?_[M-1].evaluate(c):_[Xa(d,S)].evaluate(c)}eachChild(c){c(this.input);for(const d of this.outputs)c(d)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Pr(h,c,d){return h+d*(c-h)}function ua(h,c,d){return h.map((_,S)=>Pr(_,c[S],d))}const us={number:Pr,color:function(h,c,d){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[S,M,k,G]=ua(h.rgb,c.rgb,d);return new dr(S,M,k,G,!1)}case"hcl":{const[S,M,k,G]=h.hcl,[W,Y,ae,fe]=c.hcl;let me,Ce;if(isNaN(S)||isNaN(W))isNaN(S)?isNaN(W)?me=NaN:(me=W,k!==1&&k!==0||(Ce=Y)):(me=S,ae!==1&&ae!==0||(Ce=M));else{let ut=W-S;W>S&&ut>180?ut-=360:W<S&&S-W>180&&(ut+=360),me=S+d*ut}const[Me,Ue,$e,Ke]=function(ut){let[tt,rt,yt,St]=ut;return tt=isNaN(tt)?0:tt*Bi,Vt([yt,Math.cos(tt)*rt,Math.sin(tt)*rt,St])}([me,Ce??Pr(M,Y,d),Pr(k,ae,d),Pr(G,fe,d)]);return new dr(Me,Ue,$e,Ke,!1)}case"lab":{const[S,M,k,G]=Vt(ua(h.lab,c.lab,d));return new dr(S,M,k,G,!1)}}},array:ua,padding:function(h,c,d){return new Bn(ua(h.values,c.values,d))},variableAnchorOffsetCollection:function(h,c,d){const _=h.values,S=c.values;if(_.length!==S.length)throw new Gr(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${c.toString()}`);const M=[];for(let k=0;k<_.length;k+=2){if(_[k]!==S[k])throw new Gr(`Cannot interpolate values containing mismatched anchors. from[${k}]: ${_[k]}, to[${k}]: ${S[k]}`);M.push(_[k]);const[G,W]=_[k+1],[Y,ae]=S[k+1];M.push([Pr(G,Y,d),Pr(W,ae,d)])}return new Un(M)}};class En{constructor(c,d,_,S,M){this.type=c,this.operator=d,this.interpolation=_,this.input=S,this.labels=[],this.outputs=[];for(const[k,G]of M)this.labels.push(k),this.outputs.push(G)}static interpolationFactor(c,d,_,S){let M=0;if(c.name==="exponential")M=hs(d,c.base,_,S);else if(c.name==="linear")M=hs(d,1,_,S);else if(c.name==="cubic-bezier"){const k=c.controlPoints;M=new te(k[0],k[1],k[2],k[3]).solve(hs(d,1,_,S))}return M}static parse(c,d){let[_,S,M,...k]=c;if(!Array.isArray(S)||S.length===0)return d.error("Expected an interpolation type expression.",1);if(S[0]==="linear")S={name:"linear"};else if(S[0]==="exponential"){const Y=S[1];if(typeof Y!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);S={name:"exponential",base:Y}}else{if(S[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(S[0])}`,1,0);{const Y=S.slice(1);if(Y.length!==4||Y.some(ae=>typeof ae!="number"||ae<0||ae>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);S={name:"cubic-bezier",controlPoints:Y}}}if(c.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(M=d.parse(M,2,Zt),!M)return null;const G=[];let W=null;_==="interpolate-hcl"||_==="interpolate-lab"?W=_r:d.expectedType&&d.expectedType.kind!=="value"&&(W=d.expectedType);for(let Y=0;Y<k.length;Y+=2){const ae=k[Y],fe=k[Y+1],me=Y+3,Ce=Y+4;if(typeof ae!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',me);if(G.length&&G[G.length-1][0]>=ae)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',me);const Me=d.parse(fe,Ce,W);if(!Me)return null;W=W||Me.type,G.push([ae,Me])}return st(W,Zt)||st(W,_r)||st(W,ie)||st(W,ge)||st(W,xe(Zt))?new En(W,_,S,M,G):d.error(`Type ${Ee(W)} is not interpolatable.`)}evaluate(c){const d=this.labels,_=this.outputs;if(d.length===1)return _[0].evaluate(c);const S=this.input.evaluate(c);if(S<=d[0])return _[0].evaluate(c);const M=d.length;if(S>=d[M-1])return _[M-1].evaluate(c);const k=Xa(d,S),G=En.interpolationFactor(this.interpolation,S,d[k],d[k+1]),W=_[k].evaluate(c),Y=_[k+1].evaluate(c);switch(this.operator){case"interpolate":return us[this.type.kind](W,Y,G);case"interpolate-hcl":return us.color(W,Y,G,"hcl");case"interpolate-lab":return us.color(W,Y,G,"lab")}}eachChild(c){c(this.input);for(const d of this.outputs)c(d)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function hs(h,c,d,_){const S=_-d,M=h-d;return S===0?0:c===1?M/S:(Math.pow(c,M)-1)/(Math.pow(c,S)-1)}class ha{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expectected at least one argument.");let _=null;const S=d.expectedType;S&&S.kind!=="value"&&(_=S);const M=[];for(const G of c.slice(1)){const W=d.parse(G,1+M.length,_,void 0,{typeAnnotation:"omit"});if(!W)return null;_=_||W.type,M.push(W)}if(!_)throw new Error("No output type");const k=S&&M.some(G=>Fe(S,G.type));return new ha(k?Qe:_,M)}evaluate(c){let d,_=null,S=0;for(const M of this.args)if(S++,_=M.evaluate(c),_&&_ instanceof Zi&&!_.available&&(d||(d=_.name),_=null,S===this.args.length&&(_=d)),_!==null)break;return _}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class jr{constructor(c,d){this.type=d.type,this.bindings=[].concat(c),this.result=d}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const d of this.bindings)c(d[1]);c(this.result)}static parse(c,d){if(c.length<4)return d.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const _=[];for(let M=1;M<c.length-1;M+=2){const k=c[M];if(typeof k!="string")return d.error(`Expected string, but found ${typeof k} instead.`,M);if(/[^a-zA-Z0-9_]/.test(k))return d.error("Variable names must contain only alphanumeric characters or '_'.",M);const G=d.parse(c[M+1],M+1);if(!G)return null;_.push([k,G])}const S=d.parse(c[c.length-1],c.length-1,d.expectedType,_);return S?new jr(_,S):null}outputDefined(){return this.result.outputDefined()}}class cl{constructor(c,d,_){this.type=c,this.index=d,this.input=_}static parse(c,d){if(c.length!==3)return d.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const _=d.parse(c[1],1,Zt),S=d.parse(c[2],2,xe(d.expectedType||Qe));return _&&S?new cl(S.type.itemType,_,S):null}evaluate(c){const d=this.index.evaluate(c),_=this.input.evaluate(c);if(d<0)throw new Gr(`Array index out of bounds: ${d} < 0.`);if(d>=_.length)throw new Gr(`Array index out of bounds: ${d} > ${_.length-1}.`);if(d!==Math.floor(d))throw new Gr(`Array index must be an integer, but found ${d} instead.`);return _[d]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class Ql{constructor(c,d){this.type=ei,this.needle=c,this.haystack=d}static parse(c,d){if(c.length!==3)return d.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const _=d.parse(c[1],1,Qe),S=d.parse(c[2],2,Qe);return _&&S?ze(_.type,[ei,bi,Zt,Ii,Qe])?new Ql(_,S):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(_.type)} instead`):null}evaluate(c){const d=this.needle.evaluate(c),_=this.haystack.evaluate(c);if(!_)return!1;if(!Ge(d,["boolean","string","number","null"]))throw new Gr(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(vr(d))} instead.`);if(!Ge(_,["string","array"]))throw new Gr(`Expected second argument to be of type array or string, but found ${Ee(vr(_))} instead.`);return _.indexOf(d)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class Io{constructor(c,d,_){this.type=Zt,this.needle=c,this.haystack=d,this.fromIndex=_}static parse(c,d){if(c.length<=2||c.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const _=d.parse(c[1],1,Qe),S=d.parse(c[2],2,Qe);if(!_||!S)return null;if(!ze(_.type,[ei,bi,Zt,Ii,Qe]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(_.type)} instead`);if(c.length===4){const M=d.parse(c[3],3,Zt);return M?new Io(_,S,M):null}return new Io(_,S)}evaluate(c){const d=this.needle.evaluate(c),_=this.haystack.evaluate(c);if(!Ge(d,["boolean","string","number","null"]))throw new Gr(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(vr(d))} instead.`);if(!Ge(_,["string","array"]))throw new Gr(`Expected second argument to be of type array or string, but found ${Ee(vr(_))} instead.`);if(this.fromIndex){const S=this.fromIndex.evaluate(c);return _.indexOf(d,S)}return _.indexOf(d)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class Ko{constructor(c,d,_,S,M,k){this.inputType=c,this.type=d,this.input=_,this.cases=S,this.outputs=M,this.otherwise=k}static parse(c,d){if(c.length<5)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return d.error("Expected an even number of arguments.");let _,S;d.expectedType&&d.expectedType.kind!=="value"&&(S=d.expectedType);const M={},k=[];for(let Y=2;Y<c.length-1;Y+=2){let ae=c[Y];const fe=c[Y+1];Array.isArray(ae)||(ae=[ae]);const me=d.concat(Y);if(ae.length===0)return me.error("Expected at least one branch label.");for(const Me of ae){if(typeof Me!="number"&&typeof Me!="string")return me.error("Branch labels must be numbers or strings.");if(typeof Me=="number"&&Math.abs(Me)>Number.MAX_SAFE_INTEGER)return me.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Me=="number"&&Math.floor(Me)!==Me)return me.error("Numeric branch labels must be integer values.");if(_){if(me.checkSubtype(_,vr(Me)))return null}else _=vr(Me);if(M[String(Me)]!==void 0)return me.error("Branch labels must be unique.");M[String(Me)]=k.length}const Ce=d.parse(fe,Y,S);if(!Ce)return null;S=S||Ce.type,k.push(Ce)}const G=d.parse(c[1],1,Qe);if(!G)return null;const W=d.parse(c[c.length-1],c.length-1,S);return W?G.type.kind!=="value"&&d.concat(1).checkSubtype(_,G.type)?null:new Ko(_,S,G,M,k,W):null}evaluate(c){const d=this.input.evaluate(c);return(vr(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class mc{constructor(c,d,_){this.type=c,this.branches=d,this.otherwise=_}static parse(c,d){if(c.length<4)return d.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return d.error("Expected an odd number of arguments.");let _;d.expectedType&&d.expectedType.kind!=="value"&&(_=d.expectedType);const S=[];for(let k=1;k<c.length-1;k+=2){const G=d.parse(c[k],k,ei);if(!G)return null;const W=d.parse(c[k+1],k+1,_);if(!W)return null;S.push([G,W]),_=_||W.type}const M=d.parse(c[c.length-1],c.length-1,_);if(!M)return null;if(!_)throw new Error("Can't infer output type");return new mc(_,S,M)}evaluate(c){for(const[d,_]of this.branches)if(d.evaluate(c))return _.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[d,_]of this.branches)c(d),c(_);c(this.otherwise)}outputDefined(){return this.branches.every(c=>{let[d,_]=c;return _.outputDefined()})&&this.otherwise.outputDefined()}}class Wo{constructor(c,d,_,S){this.type=c,this.input=d,this.beginIndex=_,this.endIndex=S}static parse(c,d){if(c.length<=2||c.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const _=d.parse(c[1],1,Qe),S=d.parse(c[2],2,Zt);if(!_||!S)return null;if(!ze(_.type,[xe(Qe),bi,Qe]))return d.error(`Expected first argument to be of type array or string, but found ${Ee(_.type)} instead`);if(c.length===4){const M=d.parse(c[3],3,Zt);return M?new Wo(_.type,_,S,M):null}return new Wo(_.type,_,S)}evaluate(c){const d=this.input.evaluate(c),_=this.beginIndex.evaluate(c);if(!Ge(d,["string","array"]))throw new Gr(`Expected first argument to be of type array or string, but found ${Ee(vr(d))} instead.`);if(this.endIndex){const S=this.endIndex.evaluate(c);return d.slice(_,S)}return d.slice(_)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function mo(h,c){return h==="=="||h==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function yc(h,c,d,_){return _.compare(c,d)===0}function Zo(h,c,d){const _=h!=="=="&&h!=="!=";return class m8{constructor(M,k,G){this.type=ei,this.lhs=M,this.rhs=k,this.collator=G,this.hasUntypedArgument=M.type.kind==="value"||k.type.kind==="value"}static parse(M,k){if(M.length!==3&&M.length!==4)return k.error("Expected two or three arguments.");const G=M[0];let W=k.parse(M[1],1,Qe);if(!W)return null;if(!mo(G,W.type))return k.concat(1).error(`"${G}" comparisons are not supported for type '${Ee(W.type)}'.`);let Y=k.parse(M[2],2,Qe);if(!Y)return null;if(!mo(G,Y.type))return k.concat(2).error(`"${G}" comparisons are not supported for type '${Ee(Y.type)}'.`);if(W.type.kind!==Y.type.kind&&W.type.kind!=="value"&&Y.type.kind!=="value")return k.error(`Cannot compare types '${Ee(W.type)}' and '${Ee(Y.type)}'.`);_&&(W.type.kind==="value"&&Y.type.kind!=="value"?W=new Cn(Y.type,[W]):W.type.kind!=="value"&&Y.type.kind==="value"&&(Y=new Cn(W.type,[Y])));let ae=null;if(M.length===4){if(W.type.kind!=="string"&&Y.type.kind!=="string"&&W.type.kind!=="value"&&Y.type.kind!=="value")return k.error("Cannot use collator to compare non-string types.");if(ae=k.parse(M[3],3,Be),!ae)return null}return new m8(W,Y,ae)}evaluate(M){const k=this.lhs.evaluate(M),G=this.rhs.evaluate(M);if(_&&this.hasUntypedArgument){const W=vr(k),Y=vr(G);if(W.kind!==Y.kind||W.kind!=="string"&&W.kind!=="number")throw new Gr(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${W.kind}, ${Y.kind}) instead.`)}if(this.collator&&!_&&this.hasUntypedArgument){const W=vr(k),Y=vr(G);if(W.kind!=="string"||Y.kind!=="string")return c(M,k,G)}return this.collator?d(M,k,G,this.collator.evaluate(M)):c(M,k,G)}eachChild(M){M(this.lhs),M(this.rhs),this.collator&&M(this.collator)}outputDefined(){return!0}}}const Vl=Zo("==",function(h,c,d){return c===d},yc),Nc=Zo("!=",function(h,c,d){return c!==d},function(h,c,d,_){return!yc(0,c,d,_)}),bh=Zo("<",function(h,c,d){return c<d},function(h,c,d,_){return _.compare(c,d)<0}),hu=Zo(">",function(h,c,d){return c>d},function(h,c,d,_){return _.compare(c,d)>0}),Au=Zo("<=",function(h,c,d){return c<=d},function(h,c,d,_){return _.compare(c,d)<=0}),Ou=Zo(">=",function(h,c,d){return c>=d},function(h,c,d,_){return _.compare(c,d)>=0});class Hl{constructor(c,d,_,S,M){this.type=bi,this.number=c,this.locale=d,this.currency=_,this.minFractionDigits=S,this.maxFractionDigits=M}static parse(c,d){if(c.length!==3)return d.error("Expected two arguments.");const _=d.parse(c[1],1,Zt);if(!_)return null;const S=c[2];if(typeof S!="object"||Array.isArray(S))return d.error("NumberFormat options argument must be an object.");let M=null;if(S.locale&&(M=d.parse(S.locale,1,bi),!M))return null;let k=null;if(S.currency&&(k=d.parse(S.currency,1,bi),!k))return null;let G=null;if(S["min-fraction-digits"]&&(G=d.parse(S["min-fraction-digits"],1,Zt),!G))return null;let W=null;return S["max-fraction-digits"]&&(W=d.parse(S["max-fraction-digits"],1,Zt),!W)?null:new Hl(_,M,k,G,W)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class Ja{constructor(c){this.type=ce,this.sections=c}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");const _=c[1];if(!Array.isArray(_)&&typeof _=="object")return d.error("First argument must be an image or text section.");const S=[];let M=!1;for(let k=1;k<=c.length-1;++k){const G=c[k];if(M&&typeof G=="object"&&!Array.isArray(G)){M=!1;let W=null;if(G["font-scale"]&&(W=d.parse(G["font-scale"],1,Zt),!W))return null;let Y=null;if(G["text-font"]&&(Y=d.parse(G["text-font"],1,xe(bi)),!Y))return null;let ae=null;if(G["text-color"]&&(ae=d.parse(G["text-color"],1,_r),!ae))return null;const fe=S[S.length-1];fe.scale=W,fe.font=Y,fe.textColor=ae}else{const W=d.parse(c[k],1,Qe);if(!W)return null;const Y=W.type.kind;if(Y!=="string"&&Y!=="value"&&Y!=="null"&&Y!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");M=!0,S.push({content:W,scale:null,font:null,textColor:null})}}return new Ja(S)}evaluate(c){return new Or(this.sections.map(d=>{const _=d.content.evaluate(c);return vr(_)===ue?new Gs("",_,null,null,null):new Gs(Tr(_),null,d.scale?d.scale.evaluate(c):null,d.font?d.font.evaluate(c).join(","):null,d.textColor?d.textColor.evaluate(c):null)}))}eachChild(c){for(const d of this.sections)c(d.content),d.scale&&c(d.scale),d.font&&c(d.font),d.textColor&&c(d.textColor)}outputDefined(){return!1}}class Ya{constructor(c){this.type=ue,this.input=c}static parse(c,d){if(c.length!==2)return d.error("Expected two arguments.");const _=d.parse(c[1],1,bi);return _?new Ya(_):d.error("No image name provided.")}evaluate(c){const d=this.input.evaluate(c),_=Zi.fromString(d);return _&&c.availableImages&&(_.available=c.availableImages.indexOf(d)>-1),_}eachChild(c){c(this.input)}outputDefined(){return!1}}class Gl{constructor(c){this.type=Zt,this.input=c}static parse(c,d){if(c.length!==2)return d.error(`Expected 1 argument, but found ${c.length-1} instead.`);const _=d.parse(c[1],1);return _?_.type.kind!=="array"&&_.type.kind!=="string"&&_.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${Ee(_.type)} instead.`):new Gl(_):null}evaluate(c){const d=this.input.evaluate(c);if(typeof d=="string"||Array.isArray(d))return d.length;throw new Gr(`Expected value to be of type string or array, but found ${Ee(vr(d))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const el={"==":Vl,"!=":Nc,">":hu,"<":bh,">=":Ou,"<=":Au,array:Cn,at:cl,boolean:Cn,case:mc,coalesce:ha,collator:He,format:Ja,image:Ya,in:Ql,"index-of":Io,interpolate:En,"interpolate-hcl":En,"interpolate-lab":En,length:Gl,let:jr,literal:rs,match:Ko,number:Cn,"number-format":Hl,object:Cn,slice:Wo,step:go,string:Cn,"to-boolean":Lr,"to-color":Lr,"to-number":Lr,"to-string":Lr,var:Ea,within:To};function Aa(h,c){let[d,_,S,M]=c;d=d.evaluate(h),_=_.evaluate(h),S=S.evaluate(h);const k=M?M.evaluate(h):1,G=ao(d,_,S,k);if(G)throw new Gr(G);return new dr(d/255,_/255,S/255,k,!1)}function ul(h,c){return h in c}function jl(h,c){const d=c[h];return d===void 0?null:d}function lo(h){return{type:h}}function da(h){return{result:"success",value:h}}function ne(h){return{result:"error",value:h}}function Pe(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function ct(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function _t(h){return!!h.expression&&h.expression.interpolated}function xt(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Lt(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function pi(h){return h}function si(h,c){const d=c.type==="color",_=h.stops&&typeof h.stops[0][0]=="object",S=_||!(_||h.property!==void 0),M=h.type||(_t(c)?"exponential":"interval");if(d||c.type==="padding"){const ae=d?dr.parse:Bn.parse;(h=Ar({},h)).stops&&(h.stops=h.stops.map(fe=>[fe[0],ae(fe[1])])),h.default=ae(h.default?h.default:c.default)}if(h.colorSpace&&(k=h.colorSpace)!=="rgb"&&k!=="hcl"&&k!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var k;let G,W,Y;if(M==="exponential")G=cr;else if(M==="interval")G=Yi;else if(M==="categorical"){G=qi,W=Object.create(null);for(const ae of h.stops)W[ae[0]]=ae[1];Y=typeof h.stops[0][0]}else{if(M!=="identity")throw new Error(`Unknown function type "${M}"`);G=jn}if(_){const ae={},fe=[];for(let Me=0;Me<h.stops.length;Me++){const Ue=h.stops[Me],$e=Ue[0].zoom;ae[$e]===void 0&&(ae[$e]={zoom:$e,type:h.type,property:h.property,default:h.default,stops:[]},fe.push($e)),ae[$e].stops.push([Ue[0].value,Ue[1]])}const me=[];for(const Me of fe)me.push([ae[Me].zoom,si(ae[Me],c)]);const Ce={name:"linear"};return{kind:"composite",interpolationType:Ce,interpolationFactor:En.interpolationFactor.bind(void 0,Ce),zoomStops:me.map(Me=>Me[0]),evaluate:(Me,Ue)=>{let{zoom:$e}=Me;return cr({stops:me,base:h.base},c,$e).evaluate($e,Ue)}}}if(S){const ae=M==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:ae,interpolationFactor:En.interpolationFactor.bind(void 0,ae),zoomStops:h.stops.map(fe=>fe[0]),evaluate:fe=>{let{zoom:me}=fe;return G(h,c,me,W,Y)}}}return{kind:"source",evaluate(ae,fe){const me=fe&&fe.properties?fe.properties[h.property]:void 0;return me===void 0?nr(h.default,c.default):G(h,c,me,W,Y)}}}function nr(h,c,d){return h!==void 0?h:c!==void 0?c:d!==void 0?d:void 0}function qi(h,c,d,_,S){return nr(typeof d===S?_[d]:void 0,h.default,c.default)}function Yi(h,c,d){if(xt(d)!=="number")return nr(h.default,c.default);const _=h.stops.length;if(_===1||d<=h.stops[0][0])return h.stops[0][1];if(d>=h.stops[_-1][0])return h.stops[_-1][1];const S=Xa(h.stops.map(M=>M[0]),d);return h.stops[S][1]}function cr(h,c,d){const _=h.base!==void 0?h.base:1;if(xt(d)!=="number")return nr(h.default,c.default);const S=h.stops.length;if(S===1||d<=h.stops[0][0])return h.stops[0][1];if(d>=h.stops[S-1][0])return h.stops[S-1][1];const M=Xa(h.stops.map(ae=>ae[0]),d),k=function(ae,fe,me,Ce){const Me=Ce-me,Ue=ae-me;return Me===0?0:fe===1?Ue/Me:(Math.pow(fe,Ue)-1)/(Math.pow(fe,Me)-1)}(d,_,h.stops[M][0],h.stops[M+1][0]),G=h.stops[M][1],W=h.stops[M+1][1],Y=us[c.type]||pi;return typeof G.evaluate=="function"?{evaluate(){for(var ae=arguments.length,fe=new Array(ae),me=0;me<ae;me++)fe[me]=arguments[me];const Ce=G.evaluate.apply(void 0,fe),Me=W.evaluate.apply(void 0,fe);if(Ce!==void 0&&Me!==void 0)return Y(Ce,Me,k,h.colorSpace)}}:Y(G,W,k,h.colorSpace)}function jn(h,c,d){switch(c.type){case"color":d=dr.parse(d);break;case"formatted":d=Or.fromString(d.toString());break;case"resolvedImage":d=Zi.fromString(d.toString());break;case"padding":d=Bn.parse(d);break;default:xt(d)===c.type||c.type==="enum"&&c.values[d]||(d=void 0)}return nr(d,h.default,c.default)}gs.register(el,{error:[{kind:"error"},[bi],(h,c)=>{let[d]=c;throw new Gr(d.evaluate(h))}],typeof:[bi,[Qe],(h,c)=>{let[d]=c;return Ee(vr(d.evaluate(h)))}],"to-rgba":[xe(Zt,4),[_r],(h,c)=>{let[d]=c;const[_,S,M,k]=d.evaluate(h).rgb;return[255*_,255*S,255*M,k]}],rgb:[_r,[Zt,Zt,Zt],Aa],rgba:[_r,[Zt,Zt,Zt,Zt],Aa],has:{type:ei,overloads:[[[bi],(h,c)=>{let[d]=c;return ul(d.evaluate(h),h.properties())}],[[bi,Zr],(h,c)=>{let[d,_]=c;return ul(d.evaluate(h),_.evaluate(h))}]]},get:{type:Qe,overloads:[[[bi],(h,c)=>{let[d]=c;return jl(d.evaluate(h),h.properties())}],[[bi,Zr],(h,c)=>{let[d,_]=c;return jl(d.evaluate(h),_.evaluate(h))}]]},"feature-state":[Qe,[bi],(h,c)=>{let[d]=c;return jl(d.evaluate(h),h.featureState||{})}],properties:[Zr,[],h=>h.properties()],"geometry-type":[bi,[],h=>h.geometryType()],id:[Qe,[],h=>h.id()],zoom:[Zt,[],h=>h.globals.zoom],"heatmap-density":[Zt,[],h=>h.globals.heatmapDensity||0],"line-progress":[Zt,[],h=>h.globals.lineProgress||0],accumulated:[Qe,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Zt,lo(Zt),(h,c)=>{let d=0;for(const _ of c)d+=_.evaluate(h);return d}],"*":[Zt,lo(Zt),(h,c)=>{let d=1;for(const _ of c)d*=_.evaluate(h);return d}],"-":{type:Zt,overloads:[[[Zt,Zt],(h,c)=>{let[d,_]=c;return d.evaluate(h)-_.evaluate(h)}],[[Zt],(h,c)=>{let[d]=c;return-d.evaluate(h)}]]},"/":[Zt,[Zt,Zt],(h,c)=>{let[d,_]=c;return d.evaluate(h)/_.evaluate(h)}],"%":[Zt,[Zt,Zt],(h,c)=>{let[d,_]=c;return d.evaluate(h)%_.evaluate(h)}],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(h,c)=>{let[d,_]=c;return Math.pow(d.evaluate(h),_.evaluate(h))}],sqrt:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.sqrt(d.evaluate(h))}],log10:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.log(d.evaluate(h))/Math.LN10}],ln:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.log(d.evaluate(h))}],log2:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.log(d.evaluate(h))/Math.LN2}],sin:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.sin(d.evaluate(h))}],cos:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.cos(d.evaluate(h))}],tan:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.tan(d.evaluate(h))}],asin:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.asin(d.evaluate(h))}],acos:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.acos(d.evaluate(h))}],atan:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.atan(d.evaluate(h))}],min:[Zt,lo(Zt),(h,c)=>Math.min(...c.map(d=>d.evaluate(h)))],max:[Zt,lo(Zt),(h,c)=>Math.max(...c.map(d=>d.evaluate(h)))],abs:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.abs(d.evaluate(h))}],round:[Zt,[Zt],(h,c)=>{let[d]=c;const _=d.evaluate(h);return _<0?-Math.round(-_):Math.round(_)}],floor:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.floor(d.evaluate(h))}],ceil:[Zt,[Zt],(h,c)=>{let[d]=c;return Math.ceil(d.evaluate(h))}],"filter-==":[ei,[bi,Qe],(h,c)=>{let[d,_]=c;return h.properties()[d.value]===_.value}],"filter-id-==":[ei,[Qe],(h,c)=>{let[d]=c;return h.id()===d.value}],"filter-type-==":[ei,[bi],(h,c)=>{let[d]=c;return h.geometryType()===d.value}],"filter-<":[ei,[bi,Qe],(h,c)=>{let[d,_]=c;const S=h.properties()[d.value],M=_.value;return typeof S==typeof M&&S<M}],"filter-id-<":[ei,[Qe],(h,c)=>{let[d]=c;const _=h.id(),S=d.value;return typeof _==typeof S&&_<S}],"filter->":[ei,[bi,Qe],(h,c)=>{let[d,_]=c;const S=h.properties()[d.value],M=_.value;return typeof S==typeof M&&S>M}],"filter-id->":[ei,[Qe],(h,c)=>{let[d]=c;const _=h.id(),S=d.value;return typeof _==typeof S&&_>S}],"filter-<=":[ei,[bi,Qe],(h,c)=>{let[d,_]=c;const S=h.properties()[d.value],M=_.value;return typeof S==typeof M&&S<=M}],"filter-id-<=":[ei,[Qe],(h,c)=>{let[d]=c;const _=h.id(),S=d.value;return typeof _==typeof S&&_<=S}],"filter->=":[ei,[bi,Qe],(h,c)=>{let[d,_]=c;const S=h.properties()[d.value],M=_.value;return typeof S==typeof M&&S>=M}],"filter-id->=":[ei,[Qe],(h,c)=>{let[d]=c;const _=h.id(),S=d.value;return typeof _==typeof S&&_>=S}],"filter-has":[ei,[Qe],(h,c)=>{let[d]=c;return d.value in h.properties()}],"filter-has-id":[ei,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[ei,[xe(bi)],(h,c)=>{let[d]=c;return d.value.indexOf(h.geometryType())>=0}],"filter-id-in":[ei,[xe(Qe)],(h,c)=>{let[d]=c;return d.value.indexOf(h.id())>=0}],"filter-in-small":[ei,[bi,xe(Qe)],(h,c)=>{let[d,_]=c;return _.value.indexOf(h.properties()[d.value])>=0}],"filter-in-large":[ei,[bi,xe(Qe)],(h,c)=>{let[d,_]=c;return function(S,M,k,G){for(;k<=G;){const W=k+G>>1;if(M[W]===S)return!0;M[W]>S?G=W-1:k=W+1}return!1}(h.properties()[d.value],_.value,0,_.value.length-1)}],all:{type:ei,overloads:[[[ei,ei],(h,c)=>{let[d,_]=c;return d.evaluate(h)&&_.evaluate(h)}],[lo(ei),(h,c)=>{for(const d of c)if(!d.evaluate(h))return!1;return!0}]]},any:{type:ei,overloads:[[[ei,ei],(h,c)=>{let[d,_]=c;return d.evaluate(h)||_.evaluate(h)}],[lo(ei),(h,c)=>{for(const d of c)if(d.evaluate(h))return!0;return!1}]]},"!":[ei,[ei],(h,c)=>{let[d]=c;return!d.evaluate(h)}],"is-supported-script":[ei,[bi],(h,c)=>{let[d]=c;const _=h.globals&&h.globals.isSupportedScript;return!_||_(d.evaluate(h))}],upcase:[bi,[bi],(h,c)=>{let[d]=c;return d.evaluate(h).toUpperCase()}],downcase:[bi,[bi],(h,c)=>{let[d]=c;return d.evaluate(h).toLowerCase()}],concat:[bi,lo(Qe),(h,c)=>c.map(d=>Tr(d.evaluate(h))).join("")],"resolved-locale":[bi,[Be],(h,c)=>{let[d]=c;return d.evaluate(h).resolvedLocale()}]});class or{constructor(c,d){var _;this.expression=c,this._warningHistory={},this._evaluator=new Zs,this._defaultValue=d?(_=d).type==="color"&&Lt(_.default)?new dr(0,0,0,0):_.type==="color"?dr.parse(_.default)||null:_.type==="padding"?Bn.parse(_.default)||null:_.type==="variableAnchorOffsetCollection"?Un.parse(_.default)||null:_.default===void 0?null:_.default:null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(c,d,_,S,M,k){return this._evaluator.globals=c,this._evaluator.feature=d,this._evaluator.featureState=_,this._evaluator.canonical=S,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=k,this.expression.evaluate(this._evaluator)}evaluate(c,d,_,S,M,k){this._evaluator.globals=c,this._evaluator.feature=d||null,this._evaluator.featureState=_||null,this._evaluator.canonical=S,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=k||null;try{const G=this.expression.evaluate(this._evaluator);if(G==null||typeof G=="number"&&G!=G)return this._defaultValue;if(this._enumValues&&!(G in this._enumValues))throw new Gr(`Expected value to be one of ${Object.keys(this._enumValues).map(W=>JSON.stringify(W)).join(", ")}, but found ${JSON.stringify(G)} instead.`);return G}catch(G){return this._warningHistory[G.message]||(this._warningHistory[G.message]=!0,typeof console<"u"&&console.warn(G.message)),this._defaultValue}}}function Pn(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in el}function Fr(h,c){const d=new Ka(el,Sa,[],c?function(S){const M={color:_r,string:bi,number:Zt,enum:bi,boolean:ei,formatted:ce,padding:ie,resolvedImage:ue,variableAnchorOffsetCollection:ge};return S.type==="array"?xe(M[S.value]||Qe,S.length):M[S.type]}(c):void 0),_=d.parse(h,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?da(new or(_,c)):ne(d.errors)}class Ir{constructor(c,d){this.kind=c,this._styleExpression=d,this.isStateDependent=c!=="constant"&&!ca(d.expression)}evaluateWithoutErrorHandling(c,d,_,S,M,k){return this._styleExpression.evaluateWithoutErrorHandling(c,d,_,S,M,k)}evaluate(c,d,_,S,M,k){return this._styleExpression.evaluate(c,d,_,S,M,k)}}class Ps{constructor(c,d,_,S){this.kind=c,this.zoomStops=_,this._styleExpression=d,this.isStateDependent=c!=="camera"&&!ca(d.expression),this.interpolationType=S}evaluateWithoutErrorHandling(c,d,_,S,M,k){return this._styleExpression.evaluateWithoutErrorHandling(c,d,_,S,M,k)}evaluate(c,d,_,S,M,k){return this._styleExpression.evaluate(c,d,_,S,M,k)}interpolationFactor(c,d,_){return this.interpolationType?En.interpolationFactor(this.interpolationType,c,d,_):0}}function Xs(h,c){const d=Fr(h,c);if(d.result==="error")return d;const _=d.value.expression,S=Za(_);if(!S&&!Pe(c))return ne([new Qt("","data expressions not supported")]);const M=Uc(_,["zoom"]);if(!M&&!ct(c))return ne([new Qt("","zoom expressions not supported")]);const k=Ta(_);return k||M?k instanceof Qt?ne([k]):k instanceof En&&!_t(c)?ne([new Qt("",'"interpolate" expressions cannot be used with this property')]):da(k?new Ps(S?"camera":"composite",d.value,k.labels,k instanceof En?k.interpolation:void 0):new Ir(S?"constant":"source",d.value)):ne([new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Lo{constructor(c,d){this._parameters=c,this._specification=d,Ar(this,si(this._parameters,this._specification))}static deserialize(c){return new Lo(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function Ta(h){let c=null;if(h instanceof jr)c=Ta(h.result);else if(h instanceof ha){for(const d of h.args)if(c=Ta(d),c)break}else(h instanceof go||h instanceof En)&&h.input instanceof gs&&h.input.name==="zoom"&&(c=h);return c instanceof Qt||h.eachChild(d=>{const _=Ta(d);_ instanceof Qt?c=_:!c&&_?c=new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&_&&c!==_&&(c=new Qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function fa(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const c of h.slice(1))if(!fa(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const _c={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function hl(h){if(h==null)return{filter:()=>!0,needGeometry:!1};fa(h)||(h=Ia(h));const c=Fr(h,_c);if(c.result==="error")throw new Error(c.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,_,S)=>c.value.evaluate(d,_,{},S),needGeometry:vc(h)}}function ql(h,c){return h<c?-1:h>c?1:0}function vc(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(let c=1;c<h.length;c++)if(vc(h[c]))return!0;return!1}function Ia(h){if(!h)return!0;const c=h[0];return h.length<=1?c!=="any":c==="=="?ms(h[1],h[2],"=="):c==="!="?La(ms(h[1],h[2],"==")):c==="<"||c===">"||c==="<="||c===">="?ms(h[1],h[2],c):c==="any"?(d=h.slice(1),["any"].concat(d.map(Ia))):c==="all"?["all"].concat(h.slice(1).map(Ia)):c==="none"?["all"].concat(h.slice(1).map(Ia).map(La)):c==="in"?Al(h[1],h.slice(2)):c==="!in"?La(Al(h[1],h.slice(2))):c==="has"?$l(h[1]):c==="!has"?La($l(h[1])):c!=="within"||h;var d}function ms(h,c,d){switch(h){case"$type":return[`filter-type-${d}`,c];case"$id":return[`filter-id-${d}`,c];default:return[`filter-${d}`,h,c]}}function Al(h,c){if(c.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(d=>typeof d!=typeof c[0])?["filter-in-large",h,["literal",c.sort(ql)]]:["filter-in-small",h,["literal",c]]}}function $l(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function La(h){return["!",h]}function Ma(h){const c=typeof h;if(c==="number"||c==="boolean"||c==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let S="[";for(const M of h)S+=`${Ma(M)},`;return`${S}]`}const d=Object.keys(h).sort();let _="{";for(let S=0;S<d.length;S++)_+=`${JSON.stringify(d[S])}:${Ma(h[d[S]])},`;return`${_}}`}function Fs(h){let c="";for(const d of $t)c+=`/${Ma(h[d])}`;return c}function Uu(h){const c=h.value;return c?[new Wt(h.key,c,"constants have been deprecated as of v8")]:[]}function Ln(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function fn(h){if(Array.isArray(h))return h.map(fn);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const c={};for(const d in h)c[d]=fn(h[d]);return c}return Ln(h)}function pn(h){const c=h.key,d=h.value,_=h.valueSpec||{},S=h.objectElementValidators||{},M=h.style,k=h.styleSpec,G=h.validateSpec;let W=[];const Y=xt(d);if(Y!=="object")return[new Wt(c,d,`object expected, ${Y} found`)];for(const ae in d){const fe=ae.split(".")[0],me=_[fe]||_["*"];let Ce;if(S[fe])Ce=S[fe];else if(_[fe])Ce=G;else if(S["*"])Ce=S["*"];else{if(!_["*"]){W.push(new Wt(c,d[ae],`unknown property "${ae}"`));continue}Ce=G}W=W.concat(Ce({key:(c&&`${c}.`)+ae,value:d[ae],valueSpec:me,style:M,styleSpec:k,object:d,objectKey:ae,validateSpec:G},d))}for(const ae in _)S[ae]||_[ae].required&&_[ae].default===void 0&&d[ae]===void 0&&W.push(new Wt(c,d,`missing required property "${ae}"`));return W}function As(h){const c=h.value,d=h.valueSpec,_=h.style,S=h.styleSpec,M=h.key,k=h.arrayElementValidator||h.validateSpec;if(xt(c)!=="array")return[new Wt(M,c,`array expected, ${xt(c)} found`)];if(d.length&&c.length!==d.length)return[new Wt(M,c,`array length ${d.length} expected, length ${c.length} found`)];if(d["min-length"]&&c.length<d["min-length"])return[new Wt(M,c,`array length at least ${d["min-length"]} expected, length ${c.length} found`)];let G={type:d.value,values:d.values};S.$version<7&&(G.function=d.function),xt(d.value)==="object"&&(G=d.value);let W=[];for(let Y=0;Y<c.length;Y++)W=W.concat(k({array:c,arrayIndex:Y,value:c[Y],valueSpec:G,validateSpec:h.validateSpec,style:_,styleSpec:S,key:`${M}[${Y}]`}));return W}function pa(h){const c=h.key,d=h.value,_=h.valueSpec;let S=xt(d);return S==="number"&&d!=d&&(S="NaN"),S!=="number"?[new Wt(c,d,`number expected, ${S} found`)]:"minimum"in _&&d<_.minimum?[new Wt(c,d,`${d} is less than the minimum value ${_.minimum}`)]:"maximum"in _&&d>_.maximum?[new Wt(c,d,`${d} is greater than the maximum value ${_.maximum}`)]:[]}function Kl(h){const c=h.valueSpec,d=Ln(h.value.type);let _,S,M,k={};const G=d!=="categorical"&&h.value.property===void 0,W=!G,Y=xt(h.value.stops)==="array"&&xt(h.value.stops[0])==="array"&&xt(h.value.stops[0][0])==="object",ae=pn({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Ce){if(d==="identity")return[new Wt(Ce.key,Ce.value,'identity function may not have a "stops" property')];let Me=[];const Ue=Ce.value;return Me=Me.concat(As({key:Ce.key,value:Ue,valueSpec:Ce.valueSpec,validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec,arrayElementValidator:fe})),xt(Ue)==="array"&&Ue.length===0&&Me.push(new Wt(Ce.key,Ue,"array must have at least one stop")),Me},default:function(Ce){return Ce.validateSpec({key:Ce.key,value:Ce.value,valueSpec:c,validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec})}}});return d==="identity"&&G&&ae.push(new Wt(h.key,h.value,'missing required property "property"')),d==="identity"||h.value.stops||ae.push(new Wt(h.key,h.value,'missing required property "stops"')),d==="exponential"&&h.valueSpec.expression&&!_t(h.valueSpec)&&ae.push(new Wt(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(W&&!Pe(h.valueSpec)?ae.push(new Wt(h.key,h.value,"property functions not supported")):G&&!ct(h.valueSpec)&&ae.push(new Wt(h.key,h.value,"zoom functions not supported"))),d!=="categorical"&&!Y||h.value.property!==void 0||ae.push(new Wt(h.key,h.value,'"property" property is required')),ae;function fe(Ce){let Me=[];const Ue=Ce.value,$e=Ce.key;if(xt(Ue)!=="array")return[new Wt($e,Ue,`array expected, ${xt(Ue)} found`)];if(Ue.length!==2)return[new Wt($e,Ue,`array length 2 expected, length ${Ue.length} found`)];if(Y){if(xt(Ue[0])!=="object")return[new Wt($e,Ue,`object expected, ${xt(Ue[0])} found`)];if(Ue[0].zoom===void 0)return[new Wt($e,Ue,"object stop key must have zoom")];if(Ue[0].value===void 0)return[new Wt($e,Ue,"object stop key must have value")];if(M&&M>Ln(Ue[0].zoom))return[new Wt($e,Ue[0].zoom,"stop zoom values must appear in ascending order")];Ln(Ue[0].zoom)!==M&&(M=Ln(Ue[0].zoom),S=void 0,k={}),Me=Me.concat(pn({key:`${$e}[0]`,value:Ue[0],valueSpec:{zoom:{}},validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{zoom:pa,value:me}}))}else Me=Me.concat(me({key:`${$e}[0]`,value:Ue[0],valueSpec:{},validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec},Ue));return Pn(fn(Ue[1]))?Me.concat([new Wt(`${$e}[1]`,Ue[1],"expressions are not allowed in function stops.")]):Me.concat(Ce.validateSpec({key:`${$e}[1]`,value:Ue[1],valueSpec:c,validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec}))}function me(Ce,Me){const Ue=xt(Ce.value),$e=Ln(Ce.value),Ke=Ce.value!==null?Ce.value:Me;if(_){if(Ue!==_)return[new Wt(Ce.key,Ke,`${Ue} stop domain type must match previous stop domain type ${_}`)]}else _=Ue;if(Ue!=="number"&&Ue!=="string"&&Ue!=="boolean")return[new Wt(Ce.key,Ke,"stop domain value must be a number, string, or boolean")];if(Ue!=="number"&&d!=="categorical"){let ut=`number expected, ${Ue} found`;return Pe(c)&&d===void 0&&(ut+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Wt(Ce.key,Ke,ut)]}return d!=="categorical"||Ue!=="number"||isFinite($e)&&Math.floor($e)===$e?d!=="categorical"&&Ue==="number"&&S!==void 0&&$e<S?[new Wt(Ce.key,Ke,"stop domain values must appear in ascending order")]:(S=$e,d==="categorical"&&$e in k?[new Wt(Ce.key,Ke,"stop domain values must be unique")]:(k[$e]=!0,[])):[new Wt(Ce.key,Ke,`integer expected, found ${$e}`)]}}function co(h){const c=(h.expressionContext==="property"?Xs:Fr)(fn(h.value),h.valueSpec);if(c.result==="error")return c.value.map(_=>new Wt(`${h.key}${_.key}`,h.value,_.message));const d=c.value.expression||c.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!d.outputDefined())return[new Wt(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!ca(d))return[new Wt(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!ca(d))return[new Wt(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Uc(d,["zoom","feature-state"]))return[new Wt(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!Za(d))return[new Wt(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ys(h){const c=h.key,d=h.value,_=h.valueSpec,S=[];return Array.isArray(_.values)?_.values.indexOf(Ln(d))===-1&&S.push(new Wt(c,d,`expected one of [${_.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(_.values).indexOf(Ln(d))===-1&&S.push(new Wt(c,d,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(d)} found`)),S}function ds(h){return fa(fn(h.value))?co(Ar({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mo(h)}function Mo(h){const c=h.value,d=h.key;if(xt(c)!=="array")return[new Wt(d,c,`array expected, ${xt(c)} found`)];const _=h.styleSpec;let S,M=[];if(c.length<1)return[new Wt(d,c,"filter array must have at least 1 element")];switch(M=M.concat(ys({key:`${d}[0]`,value:c[0],valueSpec:_.filter_operator,style:h.style,styleSpec:h.styleSpec})),Ln(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Ln(c[1])==="$type"&&M.push(new Wt(d,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&M.push(new Wt(d,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(S=xt(c[1]),S!=="string"&&M.push(new Wt(`${d}[1]`,c[1],`string expected, ${S} found`)));for(let k=2;k<c.length;k++)S=xt(c[k]),Ln(c[1])==="$type"?M=M.concat(ys({key:`${d}[${k}]`,value:c[k],valueSpec:_.geometry_type,style:h.style,styleSpec:h.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&M.push(new Wt(`${d}[${k}]`,c[k],`string, number, or boolean expected, ${S} found`));break;case"any":case"all":case"none":for(let k=1;k<c.length;k++)M=M.concat(Mo({key:`${d}[${k}]`,value:c[k],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":S=xt(c[1]),c.length!==2?M.push(new Wt(d,c,`filter array for "${c[0]}" operator must have 2 elements`)):S!=="string"&&M.push(new Wt(`${d}[1]`,c[1],`string expected, ${S} found`));break;case"within":S=xt(c[1]),c.length!==2?M.push(new Wt(d,c,`filter array for "${c[0]}" operator must have 2 elements`)):S!=="object"&&M.push(new Wt(`${d}[1]`,c[1],`object expected, ${S} found`))}return M}function yo(h,c){const d=h.key,_=h.validateSpec,S=h.style,M=h.styleSpec,k=h.value,G=h.objectKey,W=M[`${c}_${h.layerType}`];if(!W)return[];const Y=G.match(/^(.*)-transition$/);if(c==="paint"&&Y&&W[Y[1]]&&W[Y[1]].transition)return _({key:d,value:k,valueSpec:M.transition,style:S,styleSpec:M});const ae=h.valueSpec||W[G];if(!ae)return[new Wt(d,k,`unknown property "${G}"`)];let fe;if(xt(k)==="string"&&Pe(ae)&&!ae.tokens&&(fe=/^{([^}]+)}$/.exec(k)))return[new Wt(d,k,`"${G}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(fe[1])} }\`.`)];const me=[];return h.layerType==="symbol"&&(G==="text-field"&&S&&!S.glyphs&&me.push(new Wt(d,k,'use of "text-field" requires a style "glyphs" property')),G==="text-font"&&Lt(fn(k))&&Ln(k.type)==="identity"&&me.push(new Wt(d,k,'"text-font" does not support identity functions'))),me.concat(_({key:h.key,value:k,valueSpec:ae,style:S,styleSpec:M,expressionContext:"property",propertyType:c,propertyKey:G}))}function ga(h){return yo(h,"paint")}function tl(h){return yo(h,"layout")}function Po(h){let c=[];const d=h.value,_=h.key,S=h.style,M=h.styleSpec;d.type||d.ref||c.push(new Wt(_,d,'either "type" or "ref" is required'));let k=Ln(d.type);const G=Ln(d.ref);if(d.id){const W=Ln(d.id);for(let Y=0;Y<h.arrayIndex;Y++){const ae=S.layers[Y];Ln(ae.id)===W&&c.push(new Wt(_,d.id,`duplicate layer id "${d.id}", previously used at line ${ae.id.__line__}`))}}if("ref"in d){let W;["type","source","source-layer","filter","layout"].forEach(Y=>{Y in d&&c.push(new Wt(_,d[Y],`"${Y}" is prohibited for ref layers`))}),S.layers.forEach(Y=>{Ln(Y.id)===G&&(W=Y)}),W?W.ref?c.push(new Wt(_,d.ref,"ref cannot reference another ref layer")):k=Ln(W.type):c.push(new Wt(_,d.ref,`ref layer "${G}" not found`))}else if(k!=="background")if(d.source){const W=S.sources&&S.sources[d.source],Y=W&&Ln(W.type);W?Y==="vector"&&k==="raster"?c.push(new Wt(_,d.source,`layer "${d.id}" requires a raster source`)):Y!=="raster-dem"&&k==="hillshade"?c.push(new Wt(_,d.source,`layer "${d.id}" requires a raster-dem source`)):Y==="raster"&&k!=="raster"?c.push(new Wt(_,d.source,`layer "${d.id}" requires a vector source`)):Y!=="vector"||d["source-layer"]?Y==="raster-dem"&&k!=="hillshade"?c.push(new Wt(_,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!d.paint||!d.paint["line-gradient"]||Y==="geojson"&&W.lineMetrics||c.push(new Wt(_,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Wt(_,d,`layer "${d.id}" must specify a "source-layer"`)):c.push(new Wt(_,d.source,`source "${d.source}" not found`))}else c.push(new Wt(_,d,'missing required property "source"'));return c=c.concat(pn({key:_,value:d,valueSpec:M.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${_}.type`,value:d.type,valueSpec:M.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:d,objectKey:"type"}),filter:ds,layout:W=>pn({layer:d,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*":Y=>tl(Ar({layerType:k},Y))}}),paint:W=>pn({layer:d,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*":Y=>ga(Ar({layerType:k},Y))}})}})),c}function Js(h){const c=h.value,d=h.key,_=xt(c);return _!=="string"?[new Wt(d,c,`string expected, ${_} found`)]:[]}const js={promoteId:function(h){let{key:c,value:d}=h;if(xt(d)==="string")return Js({key:c,value:d});{const _=[];for(const S in d)_.push(...Js({key:`${c}.${S}`,value:d[S]}));return _}}};function _s(h){const c=h.value,d=h.key,_=h.styleSpec,S=h.style,M=h.validateSpec;if(!c.type)return[new Wt(d,c,'"type" is required')];const k=Ln(c.type);let G;switch(k){case"vector":case"raster":return G=pn({key:d,value:c,valueSpec:_[`source_${k.replace("-","_")}`],style:h.style,styleSpec:_,objectElementValidators:js,validateSpec:M}),G;case"raster-dem":return G=function(W){var Y;const ae=(Y=W.sourceName)!==null&&Y!==void 0?Y:"",fe=W.value,me=W.styleSpec,Ce=me.source_raster_dem,Me=W.style;let Ue=[];const $e=xt(fe);if(fe===void 0)return Ue;if($e!=="object")return Ue.push(new Wt("source_raster_dem",fe,`object expected, ${$e} found`)),Ue;const Ke=Ln(fe.encoding)==="custom",ut=["redFactor","greenFactor","blueFactor","baseShift"],tt=W.value.encoding?`"${W.value.encoding}"`:"Default";for(const rt in fe)!Ke&&ut.includes(rt)?Ue.push(new Wt(rt,fe[rt],`In "${ae}": "${rt}" is only valid when "encoding" is set to "custom". ${tt} encoding found`)):Ce[rt]?Ue=Ue.concat(W.validateSpec({key:rt,value:fe[rt],valueSpec:Ce[rt],validateSpec:W.validateSpec,style:Me,styleSpec:me})):Ue.push(new Wt(rt,fe[rt],`unknown property "${rt}"`));return Ue}({sourceName:d,value:c,style:h.style,styleSpec:_,validateSpec:M}),G;case"geojson":if(G=pn({key:d,value:c,valueSpec:_.source_geojson,style:S,styleSpec:_,validateSpec:M,objectElementValidators:js}),c.cluster)for(const W in c.clusterProperties){const[Y,ae]=c.clusterProperties[W],fe=typeof Y=="string"?[Y,["accumulated"],["get",W]]:Y;G.push(...co({key:`${d}.${W}.map`,value:ae,validateSpec:M,expressionContext:"cluster-map"})),G.push(...co({key:`${d}.${W}.reduce`,value:fe,validateSpec:M,expressionContext:"cluster-reduce"}))}return G;case"video":return pn({key:d,value:c,valueSpec:_.source_video,style:S,validateSpec:M,styleSpec:_});case"image":return pn({key:d,value:c,valueSpec:_.source_image,style:S,validateSpec:M,styleSpec:_});case"canvas":return[new Wt(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ys({key:`${d}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:S,validateSpec:M,styleSpec:_})}}function uo(h){const c=h.value,d=h.styleSpec,_=d.light,S=h.style;let M=[];const k=xt(c);if(c===void 0)return M;if(k!=="object")return M=M.concat([new Wt("light",c,`object expected, ${k} found`)]),M;for(const G in c){const W=G.match(/^(.*)-transition$/);M=M.concat(W&&_[W[1]]&&_[W[1]].transition?h.validateSpec({key:G,value:c[G],valueSpec:d.transition,validateSpec:h.validateSpec,style:S,styleSpec:d}):_[G]?h.validateSpec({key:G,value:c[G],valueSpec:_[G],validateSpec:h.validateSpec,style:S,styleSpec:d}):[new Wt(G,c[G],`unknown property "${G}"`)])}return M}function Pa(h){const c=h.value,d=h.styleSpec,_=d.terrain,S=h.style;let M=[];const k=xt(c);if(c===void 0)return M;if(k!=="object")return M=M.concat([new Wt("terrain",c,`object expected, ${k} found`)]),M;for(const G in c)M=M.concat(_[G]?h.validateSpec({key:G,value:c[G],valueSpec:_[G],validateSpec:h.validateSpec,style:S,styleSpec:d}):[new Wt(G,c[G],`unknown property "${G}"`)]);return M}function dl(h){let c=[];const d=h.value,_=h.key;if(Array.isArray(d)){const S=[],M=[];for(const k in d)d[k].id&&S.includes(d[k].id)&&c.push(new Wt(_,d,`all the sprites' ids must be unique, but ${d[k].id} is duplicated`)),S.push(d[k].id),d[k].url&&M.includes(d[k].url)&&c.push(new Wt(_,d,`all the sprites' URLs must be unique, but ${d[k].url} is duplicated`)),M.push(d[k].url),c=c.concat(pn({key:`${_}[${k}]`,value:d[k],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return c}return Js({key:_,value:d})}const Wl={"*":()=>[],array:As,boolean:function(h){const c=h.value,d=h.key,_=xt(c);return _!=="boolean"?[new Wt(d,c,`boolean expected, ${_} found`)]:[]},number:pa,color:function(h){const c=h.key,d=h.value,_=xt(d);return _!=="string"?[new Wt(c,d,`color expected, ${_} found`)]:dr.parse(String(d))?[]:[new Wt(c,d,`color expected, "${d}" found`)]},constants:Uu,enum:ys,filter:ds,function:Kl,layer:Po,object:pn,source:_s,light:uo,terrain:Pa,string:Js,formatted:function(h){return Js(h).length===0?[]:co(h)},resolvedImage:function(h){return Js(h).length===0?[]:co(h)},padding:function(h){const c=h.key,d=h.value;if(xt(d)==="array"){if(d.length<1||d.length>4)return[new Wt(c,d,`padding requires 1 to 4 values; ${d.length} values found`)];const _={type:"number"};let S=[];for(let M=0;M<d.length;M++)S=S.concat(h.validateSpec({key:`${c}[${M}]`,value:d[M],validateSpec:h.validateSpec,valueSpec:_}));return S}return pa({key:c,value:d,valueSpec:{}})},variableAnchorOffsetCollection:function(h){const c=h.key,d=h.value,_=xt(d),S=h.styleSpec;if(_!=="array"||d.length<1||d.length%2!=0)return[new Wt(c,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let M=[];for(let k=0;k<d.length;k+=2)M=M.concat(ys({key:`${c}[${k}]`,value:d[k],valueSpec:S.layout_symbol["text-anchor"]})),M=M.concat(As({key:`${c}[${k+1}]`,value:d[k+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:S}));return M},sprite:dl};function Ds(h){const c=h.value,d=h.valueSpec,_=h.styleSpec;return h.validateSpec=Ds,d.expression&&Lt(Ln(c))?Kl(h):d.expression&&Pn(fn(c))?co(h):d.type&&Wl[d.type]?Wl[d.type](h):pn(Ar({},h,{valueSpec:d.type?_[d.type]:d}))}function Xo(h){const c=h.value,d=h.key,_=Js(h);return _.length||(c.indexOf("{fontstack}")===-1&&_.push(new Wt(d,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&_.push(new Wt(d,c,'"glyphs" url must include a "{range}" token'))),_}function ln(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ht,d=[];return d=d.concat(Ds({key:"",value:h,valueSpec:c.$root,styleSpec:c,style:h,validateSpec:Ds,objectElementValidators:{glyphs:Xo,"*":()=>[]}})),h.constants&&(d=d.concat(Uu({key:"constants",value:h.constants,style:h,styleSpec:c,validateSpec:Ds}))),os(d)}function qn(h){return function(c){return h({...c,validateSpec:Ds})}}function os(h){return[].concat(h).sort((c,d)=>c.line-d.line)}function Ur(h){return function(){for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return os(h.apply(this,d))}}ln.source=Ur(qn(_s)),ln.sprite=Ur(qn(dl)),ln.glyphs=Ur(qn(Xo)),ln.light=Ur(qn(uo)),ln.terrain=Ur(qn(Pa)),ln.layer=Ur(qn(Po)),ln.filter=Ur(qn(ds)),ln.paintProperty=Ur(qn(ga)),ln.layoutProperty=Ur(qn(tl));const en=ln,nn=en.light,Nn=en.paintProperty,ma=en.layoutProperty;function Fa(h,c){let d=!1;if(c&&c.length)for(const _ of c)h.fire(new Oi(new Error(_.message))),d=!0;return d}class Jo{constructor(c,d,_){const S=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const k=new Int32Array(this.arrayBuffer);c=k[0],this.d=(d=k[1])+2*(_=k[2]);for(let W=0;W<this.d*this.d;W++){const Y=k[3+W],ae=k[3+W+1];S.push(Y===ae?null:k.subarray(Y,ae))}const G=k[3+S.length+1];this.keys=k.subarray(k[3+S.length],G),this.bboxes=k.subarray(G),this.insert=this._insertReadonly}else{this.d=d+2*_;for(let k=0;k<this.d*this.d;k++)S.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=c,this.padding=_,this.scale=d/c,this.uid=0;const M=_/d*c;this.min=-M,this.max=c+M}insert(c,d,_,S,M){this._forEachCell(d,_,S,M,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(S),this.bboxes.push(M)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,d,_,S,M,k){this.cells[M].push(k)}query(c,d,_,S,M){const k=this.min,G=this.max;if(c<=k&&d<=k&&G<=_&&G<=S&&!M)return Array.prototype.slice.call(this.keys);{const W=[];return this._forEachCell(c,d,_,S,this._queryCell,W,{},M),W}}_queryCell(c,d,_,S,M,k,G,W){const Y=this.cells[M];if(Y!==null){const ae=this.keys,fe=this.bboxes;for(let me=0;me<Y.length;me++){const Ce=Y[me];if(G[Ce]===void 0){const Me=4*Ce;(W?W(fe[Me+0],fe[Me+1],fe[Me+2],fe[Me+3]):c<=fe[Me+2]&&d<=fe[Me+3]&&_>=fe[Me+0]&&S>=fe[Me+1])?(G[Ce]=!0,k.push(ae[Ce])):G[Ce]=!1}}}}_forEachCell(c,d,_,S,M,k,G,W){const Y=this._convertToCellCoord(c),ae=this._convertToCellCoord(d),fe=this._convertToCellCoord(_),me=this._convertToCellCoord(S);for(let Ce=Y;Ce<=fe;Ce++)for(let Me=ae;Me<=me;Me++){const Ue=this.d*Me+Ce;if((!W||W(this._convertFromCellCoord(Ce),this._convertFromCellCoord(Me),this._convertFromCellCoord(Ce+1),this._convertFromCellCoord(Me+1)))&&M.call(this,c,d,_,S,Ue,k,G,W))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,d=3+this.cells.length+1+1;let _=0;for(let k=0;k<this.cells.length;k++)_+=this.cells[k].length;const S=new Int32Array(d+_+this.keys.length+this.bboxes.length);S[0]=this.extent,S[1]=this.n,S[2]=this.padding;let M=d;for(let k=0;k<c.length;k++){const G=c[k];S[3+k]=M,S.set(G,M),M+=G.length}return S[3+c.length]=M,S.set(this.keys,M),M+=this.keys.length,S[3+c.length+1]=M,S.set(this.bboxes,M),M+=this.bboxes.length,S.buffer}static serialize(c,d){const _=c.toArrayBuffer();return d&&d.push(_),{buffer:_}}static deserialize(c){return new Jo(c.buffer)}}const Yo={};function Ui(h,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Yo[h])throw new Error(`${h} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:h,writeable:!1}),Yo[h]={klass:c,omit:d.omit||[],shallow:d.shallow||[]}}Ui("Object",Object),Ui("TransferableGridIndex",Jo),Ui("Color",dr),Ui("Error",Error),Ui("AJAXError",Dt),Ui("ResolvedImage",Zi),Ui("StylePropertyFunction",Lo),Ui("StyleExpression",or,{omit:["_evaluator"]}),Ui("ZoomDependentExpression",Ps),Ui("ZoomConstantExpression",Ir),Ui("CompoundExpression",gs,{omit:["_evaluate"]});for(const h in el)el[h]._classRegistryKey||Ui(`Expression_${h}`,el[h]);function ya(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function Di(h,c){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob)return h;if(ya(h)||Rt(h))return c&&c.push(h),h;if(ArrayBuffer.isView(h)){const d=h;return c&&c.push(d.buffer),d}if(h instanceof ImageData)return c&&c.push(h.data.buffer),h;if(Array.isArray(h)){const d=[];for(const _ of h)d.push(Di(_,c));return d}if(typeof h=="object"){const d=h.constructor,_=d._classRegistryKey;if(!_)throw new Error("can't serialize object of unregistered class");if(!Yo[_])throw new Error(`${_} is not registered.`);const S=d.serialize?d.serialize(h,c):{};if(d.serialize){if(c&&S===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const M in h){if(!h.hasOwnProperty(M)||Yo[_].omit.indexOf(M)>=0)continue;const k=h[M];S[M]=Yo[_].shallow.indexOf(M)>=0?k:Di(k,c)}h instanceof Error&&(S.message=h.message)}if(S.$name)throw new Error("$name property is reserved for worker serialization logic.");return _!=="Object"&&(S.$name=_),S}throw new Error("can't serialize object of type "+typeof h)}function fl(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||ya(h)||Rt(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(fl);if(typeof h=="object"){const c=h.$name||"Object";if(!Yo[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:d}=Yo[c];if(!d)throw new Error(`can't deserialize unregistered class ${c}`);if(d.deserialize)return d.deserialize(h);const _=Object.create(d.prototype);for(const S of Object.keys(h)){if(S==="$name")continue;const M=h[S];_[S]=Yo[c].shallow.indexOf(S)>=0?M:fl(M)}return _}throw new Error("can't deserialize object of type "+typeof h)}class pl{constructor(){this.first=!0}update(c,d){const _=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=_,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=_,!0):(this.lastFloorZoom>_?(this.lastIntegerZoom=_+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<_&&(this.lastIntegerZoom=_,this.lastIntegerZoomTime=d),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=_,!0))}}const Li={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function bc(h){for(const c of h)if(eo(c.charCodeAt(0)))return!0;return!1}function Fi(h){for(const c of h)if(!Ys(c.charCodeAt(0)))return!1;return!0}function Ys(h){return!(Li.Arabic(h)||Li["Arabic Supplement"](h)||Li["Arabic Extended-A"](h)||Li["Arabic Presentation Forms-A"](h)||Li["Arabic Presentation Forms-B"](h))}function eo(h){return!(h!==746&&h!==747&&(h<4352||!(Li["Bopomofo Extended"](h)||Li.Bopomofo(h)||Li["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||Li["CJK Compatibility Ideographs"](h)||Li["CJK Compatibility"](h)||Li["CJK Radicals Supplement"](h)||Li["CJK Strokes"](h)||!(!Li["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||Li["CJK Unified Ideographs Extension A"](h)||Li["CJK Unified Ideographs"](h)||Li["Enclosed CJK Letters and Months"](h)||Li["Hangul Compatibility Jamo"](h)||Li["Hangul Jamo Extended-A"](h)||Li["Hangul Jamo Extended-B"](h)||Li["Hangul Jamo"](h)||Li["Hangul Syllables"](h)||Li.Hiragana(h)||Li["Ideographic Description Characters"](h)||Li.Kanbun(h)||Li["Kangxi Radicals"](h)||Li["Katakana Phonetic Extensions"](h)||Li.Katakana(h)&&h!==12540||!(!Li["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!Li["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||Li["Unified Canadian Aboriginal Syllabics"](h)||Li["Unified Canadian Aboriginal Syllabics Extended"](h)||Li["Vertical Forms"](h)||Li["Yijing Hexagram Symbols"](h)||Li["Yi Syllables"](h)||Li["Yi Radicals"](h))))}function zc(h){return!(eo(h)||function(c){return!!(Li["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||Li["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||Li["Letterlike Symbols"](c)||Li["Number Forms"](c)||Li["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||Li["Control Pictures"](c)&&c!==9251||Li["Optical Character Recognition"](c)||Li["Enclosed Alphanumerics"](c)||Li["Geometric Shapes"](c)||Li["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||Li["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||Li["CJK Symbols and Punctuation"](c)||Li.Katakana(c)||Li["Private Use Area"](c)||Li["CJK Compatibility Forms"](c)||Li["Small Form Variants"](c)||Li["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(h))}function Zl(h){return h>=1424&&h<=2303||Li["Arabic Presentation Forms-A"](h)||Li["Arabic Presentation Forms-B"](h)}function du(h,c){return!(!c&&Zl(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||Li.Khmer(h))}function Qc(h){for(const c of h)if(Zl(c.charCodeAt(0)))return!0;return!1}const Xl="deferred",Vc="loading",il="loaded";let vn=null,Rs="unavailable",Fo=null;const gl=function(h){h&&typeof h=="string"&&h.indexOf("NetworkError")>-1&&(Rs="error"),vn&&vn(h)};function fu(){Hc.fire(new wt("pluginStateChange",{pluginStatus:Rs,pluginURL:Fo}))}const Hc=new ti,Nu=function(){return Rs},_a=function(){if(Rs!==Xl||!Fo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Rs=Vc,fu(),Fo&&vi({url:Fo},h=>{h?gl(h):(Rs=il,fu())})},to={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Rs===il||to.applyArabicShaping!=null,isLoading:()=>Rs===Vc,setState(h){if(!Pt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Rs=h.pluginStatus,Fo=h.pluginURL},isParsed(){if(!Pt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return to.applyArabicShaping!=null&&to.processBidirectionalText!=null&&to.processStyledBidirectionalText!=null},getPluginURL(){if(!Pt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Fo}};class Ei{constructor(c,d){this.zoom=c,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new pl,this.transition={})}isSupportedScript(c){return function(d,_){for(const S of d)if(!du(S.charCodeAt(0),_))return!1;return!0}(c,to.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,d=c-Math.floor(c),_=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*_}:{fromScale:.5,toScale:1,t:1-(1-_)*d}}}class sr{constructor(c,d){this.property=c,this.value=d,this.expression=function(_,S){if(Lt(_))return new Lo(_,S);if(Pn(_)){const M=Xs(_,S);if(M.result==="error")throw new Error(M.value.map(k=>`${k.key}: ${k.message}`).join(", "));return M.value}{let M=_;return S.type==="color"&&typeof _=="string"?M=dr.parse(_):S.type!=="padding"||typeof _!="number"&&!Array.isArray(_)?S.type==="variableAnchorOffsetCollection"&&Array.isArray(_)&&(M=Un.parse(_)):M=Bn.parse(_),{kind:"constant",evaluate:()=>M}}}(d===void 0?c.specification.default:d,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,d,_){return this.property.possiblyEvaluate(this,c,d,_)}}class ml{constructor(c){this.property=c,this.value=new sr(c,void 0)}transitioned(c,d){return new Jl(this.property,this.value,d,Ne({},c.transition,this.transition),c.now)}untransitioned(){return new Jl(this.property,this.value,null,{},0)}}class Gc{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return De(this._values[c].value.value)}setValue(c,d){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new ml(this._values[c].property)),this._values[c].value=new sr(this._values[c].property,d===null?void 0:De(d))}getTransition(c){return De(this._values[c].transition)}setTransition(c,d){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new ml(this._values[c].property)),this._values[c].transition=De(d)||void 0}serialize(){const c={};for(const d of Object.keys(this._values)){const _=this.getValue(d);_!==void 0&&(c[d]=_);const S=this.getTransition(d);S!==void 0&&(c[`${d}-transition`]=S)}return c}transitioned(c,d){const _=new ks(this._properties);for(const S of Object.keys(this._values))_._values[S]=this._values[S].transitioned(c,d._values[S]);return _}untransitioned(){const c=new ks(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].untransitioned();return c}}class Jl{constructor(c,d,_,S,M){this.property=c,this.value=d,this.begin=M+S.delay||0,this.end=this.begin+S.duration||0,c.specification.transition&&(S.delay||S.duration)&&(this.prior=_)}possiblyEvaluate(c,d,_){const S=c.now||0,M=this.value.possiblyEvaluate(c,d,_),k=this.prior;if(k){if(S>this.end)return this.prior=null,M;if(this.value.isDataDriven())return this.prior=null,M;if(S<this.begin)return k.possiblyEvaluate(c,d,_);{const G=(S-this.begin)/(this.end-this.begin);return this.property.interpolate(k.possiblyEvaluate(c,d,_),M,function(W){if(W<=0)return 0;if(W>=1)return 1;const Y=W*W,ae=Y*W;return 4*(W<.5?ae:3*(W-Y)+ae-.75)}(G))}}return M}}class ks{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,d,_){const S=new jc(this._properties);for(const M of Object.keys(this._values))S._values[M]=this._values[M].possiblyEvaluate(c,d,_);return S}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class nA{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return De(this._values[c].value)}setValue(c,d){this._values[c]=new sr(this._values[c].property,d===null?void 0:De(d))}serialize(){const c={};for(const d of Object.keys(this._values)){const _=this.getValue(d);_!==void 0&&(c[d]=_)}return c}possiblyEvaluate(c,d,_){const S=new jc(this._properties);for(const M of Object.keys(this._values))S._values[M]=this._values[M].possiblyEvaluate(c,d,_);return S}}class $n{constructor(c,d,_){this.property=c,this.value=d,this.parameters=_}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,d,_,S){return this.property.evaluate(this.value,this.parameters,c,d,_,S)}}class jc{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class $i{constructor(c){this.specification=c}possiblyEvaluate(c,d){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(d)}interpolate(c,d,_){const S=us[this.specification.type];return S?S(c,d,_):c}}class zi{constructor(c,d){this.specification=c,this.overrides=d}possiblyEvaluate(c,d,_,S){return new $n(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(d,null,{},_,S)}:c.expression,d)}interpolate(c,d,_){if(c.value.kind!=="constant"||d.value.kind!=="constant")return c;if(c.value.value===void 0||d.value.value===void 0)return new $n(this,{kind:"constant",value:void 0},c.parameters);const S=us[this.specification.type];if(S){const M=S(c.value.value,d.value.value,_);return new $n(this,{kind:"constant",value:M},c.parameters)}return c}evaluate(c,d,_,S,M,k){return c.kind==="constant"?c.value:c.evaluate(d,_,S,M,k)}}class Kn extends zi{possiblyEvaluate(c,d,_,S){if(c.value===void 0)return new $n(this,{kind:"constant",value:void 0},d);if(c.expression.kind==="constant"){const M=c.expression.evaluate(d,null,{},_,S),k=c.property.specification.type==="resolvedImage"&&typeof M!="string"?M.name:M,G=this._calculate(k,k,k,d);return new $n(this,{kind:"constant",value:G},d)}if(c.expression.kind==="camera"){const M=this._calculate(c.expression.evaluate({zoom:d.zoom-1}),c.expression.evaluate({zoom:d.zoom}),c.expression.evaluate({zoom:d.zoom+1}),d);return new $n(this,{kind:"constant",value:M},d)}return new $n(this,c.expression,d)}evaluate(c,d,_,S,M,k){if(c.kind==="source"){const G=c.evaluate(d,_,S,M,k);return this._calculate(G,G,G,d)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(d.zoom)-1},_,S),c.evaluate({zoom:Math.floor(d.zoom)},_,S),c.evaluate({zoom:Math.floor(d.zoom)+1},_,S),d):c.value}_calculate(c,d,_,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:c,to:d}:{from:_,to:d}}interpolate(c){return c}}class zu{constructor(c){this.specification=c}possiblyEvaluate(c,d,_,S){if(c.value!==void 0){if(c.expression.kind==="constant"){const M=c.expression.evaluate(d,null,{},_,S);return this._calculate(M,M,M,d)}return this._calculate(c.expression.evaluate(new Ei(Math.floor(d.zoom-1),d)),c.expression.evaluate(new Ei(Math.floor(d.zoom),d)),c.expression.evaluate(new Ei(Math.floor(d.zoom+1),d)),d)}}_calculate(c,d,_,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:c,to:d}:{from:_,to:d}}interpolate(c){return c}}class Do{constructor(c){this.specification=c}possiblyEvaluate(c,d,_,S){return!!c.expression.evaluate(d,null,{},_,S)}interpolate(){return!1}}class sn{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const d in c){const _=c[d];_.specification.overridable&&this.overridableProperties.push(d);const S=this.defaultPropertyValues[d]=new sr(_,void 0),M=this.defaultTransitionablePropertyValues[d]=new ml(_);this.defaultTransitioningPropertyValues[d]=M.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=S.possiblyEvaluate({})}}}Ui("DataDrivenProperty",zi),Ui("DataConstantProperty",$i),Ui("CrossFadedDataDrivenProperty",Kn),Ui("CrossFadedProperty",zu),Ui("ColorRampProperty",Do);const qs="-transition";class Ro extends ti{constructor(c,d){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),d.layout&&(this._unevaluatedLayout=new nA(d.layout)),d.paint)){this._transitionablePaint=new Gc(d.paint);for(const _ in c.paint)this.setPaintProperty(_,c.paint[_],{validate:!1});for(const _ in c.layout)this.setLayoutProperty(_,c.layout[_],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jc(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};d!=null&&this._validate(ma,`layers.${this.id}.layout.${c}`,c,d,_)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,d):this.visibility=d)}getPaintProperty(c){return c.endsWith(qs)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(d!=null&&this._validate(Nn,`layers.${this.id}.paint.${c}`,c,d,_))return!1;if(c.endsWith(qs))return this._transitionablePaint.setTransition(c.slice(0,-11),d||void 0),!1;{const S=this._transitionablePaint._values[c],M=S.property.specification["property-type"]==="cross-faded-data-driven",k=S.value.isDataDriven(),G=S.value;this._transitionablePaint.setValue(c,d),this._handleSpecialPaintPropertyUpdate(c);const W=this._transitionablePaint._values[c].value;return W.isDataDriven()||k||M||this._handleOverridablePaintPropertyUpdate(c,G,W)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,d,_){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,d){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,d)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),ke(c,(d,_)=>!(d===void 0||_==="layout"&&!Object.keys(d).length||_==="paint"&&!Object.keys(d).length))}_validate(c,d,_,S){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!M||M.validate!==!1)&&Fa(this,c.call(en,{key:d,layerType:this.type,objectKey:_,value:S,styleSpec:ht,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const d=this.paint.get(c);if(d instanceof $n&&Pe(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}const pu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $s{constructor(c,d){this._structArray=c,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,d){return c._trim(),d&&(c.isTransferred=!0,d.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const d=Object.create(this.prototype);return d.arrayBuffer=c.arrayBuffer,d.length=c.length,d.capacity=c.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Fn(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=0,_=0;return{members:h.map(S=>{const M=pu[S.type].BYTES_PER_ELEMENT,k=d=Yl(d,Math.max(c,M)),G=S.components||1;return _=Math.max(_,M),d+=M*G,{name:S.name,type:S.type,components:G,offset:k}}),size:Yl(d,Math.max(_,c)),alignment:c}}function Yl(h,c){return Math.ceil(h/c)*c}class ec extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d){const _=this.length;return this.resize(_+1),this.emplace(_,c,d)}emplace(c,d,_){const S=2*c;return this.int16[S+0]=d,this.int16[S+1]=_,c}}ec.prototype.bytesPerElement=4,Ui("StructArrayLayout2i4",ec);class ko extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,_){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,_)}emplace(c,d,_,S){const M=3*c;return this.int16[M+0]=d,this.int16[M+1]=_,this.int16[M+2]=S,c}}ko.prototype.bytesPerElement=6,Ui("StructArrayLayout3i6",ko);class Da extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,_,S){const M=this.length;return this.resize(M+1),this.emplace(M,c,d,_,S)}emplace(c,d,_,S,M){const k=4*c;return this.int16[k+0]=d,this.int16[k+1]=_,this.int16[k+2]=S,this.int16[k+3]=M,c}}Da.prototype.bytesPerElement=8,Ui("StructArrayLayout4i8",Da);class tc extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,_,S,M,k){const G=this.length;return this.resize(G+1),this.emplace(G,c,d,_,S,M,k)}emplace(c,d,_,S,M,k,G){const W=6*c;return this.int16[W+0]=d,this.int16[W+1]=_,this.int16[W+2]=S,this.int16[W+3]=M,this.int16[W+4]=k,this.int16[W+5]=G,c}}tc.prototype.bytesPerElement=12,Ui("StructArrayLayout2i4i12",tc);class qc extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,_,S,M,k){const G=this.length;return this.resize(G+1),this.emplace(G,c,d,_,S,M,k)}emplace(c,d,_,S,M,k,G){const W=4*c,Y=8*c;return this.int16[W+0]=d,this.int16[W+1]=_,this.uint8[Y+4]=S,this.uint8[Y+5]=M,this.uint8[Y+6]=k,this.uint8[Y+7]=G,c}}qc.prototype.bytesPerElement=8,Ui("StructArrayLayout2i4ub8",qc);class Oo extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d){const _=this.length;return this.resize(_+1),this.emplace(_,c,d)}emplace(c,d,_){const S=2*c;return this.float32[S+0]=d,this.float32[S+1]=_,c}}Oo.prototype.bytesPerElement=8,Ui("StructArrayLayout2f8",Oo);class ic extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,_,S,M,k,G,W,Y,ae){const fe=this.length;return this.resize(fe+1),this.emplace(fe,c,d,_,S,M,k,G,W,Y,ae)}emplace(c,d,_,S,M,k,G,W,Y,ae,fe){const me=10*c;return this.uint16[me+0]=d,this.uint16[me+1]=_,this.uint16[me+2]=S,this.uint16[me+3]=M,this.uint16[me+4]=k,this.uint16[me+5]=G,this.uint16[me+6]=W,this.uint16[me+7]=Y,this.uint16[me+8]=ae,this.uint16[me+9]=fe,c}}ic.prototype.bytesPerElement=20,Ui("StructArrayLayout10ui20",ic);class va extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,_,S,M,k,G,W,Y,ae,fe,me){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,c,d,_,S,M,k,G,W,Y,ae,fe,me)}emplace(c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce){const Me=12*c;return this.int16[Me+0]=d,this.int16[Me+1]=_,this.int16[Me+2]=S,this.int16[Me+3]=M,this.uint16[Me+4]=k,this.uint16[Me+5]=G,this.uint16[Me+6]=W,this.uint16[Me+7]=Y,this.int16[Me+8]=ae,this.int16[Me+9]=fe,this.int16[Me+10]=me,this.int16[Me+11]=Ce,c}}va.prototype.bytesPerElement=24,Ui("StructArrayLayout4i4ui4i24",va);class zr extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,_){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,_)}emplace(c,d,_,S){const M=3*c;return this.float32[M+0]=d,this.float32[M+1]=_,this.float32[M+2]=S,c}}zr.prototype.bytesPerElement=12,Ui("StructArrayLayout3f12",zr);class N extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.uint32[1*c+0]=d,c}}N.prototype.bytesPerElement=4,Ui("StructArrayLayout1ul4",N);class A extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,_,S,M,k,G,W,Y){const ae=this.length;return this.resize(ae+1),this.emplace(ae,c,d,_,S,M,k,G,W,Y)}emplace(c,d,_,S,M,k,G,W,Y,ae){const fe=10*c,me=5*c;return this.int16[fe+0]=d,this.int16[fe+1]=_,this.int16[fe+2]=S,this.int16[fe+3]=M,this.int16[fe+4]=k,this.int16[fe+5]=G,this.uint32[me+3]=W,this.uint16[fe+8]=Y,this.uint16[fe+9]=ae,c}}A.prototype.bytesPerElement=20,Ui("StructArrayLayout6i1ul2ui20",A);class b extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,_,S,M,k){const G=this.length;return this.resize(G+1),this.emplace(G,c,d,_,S,M,k)}emplace(c,d,_,S,M,k,G){const W=6*c;return this.int16[W+0]=d,this.int16[W+1]=_,this.int16[W+2]=S,this.int16[W+3]=M,this.int16[W+4]=k,this.int16[W+5]=G,c}}b.prototype.bytesPerElement=12,Ui("StructArrayLayout2i2i2i12",b);class L extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,_,S,M){const k=this.length;return this.resize(k+1),this.emplace(k,c,d,_,S,M)}emplace(c,d,_,S,M,k){const G=4*c,W=8*c;return this.float32[G+0]=d,this.float32[G+1]=_,this.float32[G+2]=S,this.int16[W+6]=M,this.int16[W+7]=k,c}}L.prototype.bytesPerElement=16,Ui("StructArrayLayout2f1f2i16",L);class O extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,_,S){const M=this.length;return this.resize(M+1),this.emplace(M,c,d,_,S)}emplace(c,d,_,S,M){const k=12*c,G=3*c;return this.uint8[k+0]=d,this.uint8[k+1]=_,this.float32[G+1]=S,this.float32[G+2]=M,c}}O.prototype.bytesPerElement=12,Ui("StructArrayLayout2ub2f12",O);class z extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,_){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,_)}emplace(c,d,_,S){const M=3*c;return this.uint16[M+0]=d,this.uint16[M+1]=_,this.uint16[M+2]=S,c}}z.prototype.bytesPerElement=6,Ui("StructArrayLayout3ui6",z);class X extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke){const ut=this.length;return this.resize(ut+1),this.emplace(ut,c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke)}emplace(c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke,ut){const tt=24*c,rt=12*c,yt=48*c;return this.int16[tt+0]=d,this.int16[tt+1]=_,this.uint16[tt+2]=S,this.uint16[tt+3]=M,this.uint32[rt+2]=k,this.uint32[rt+3]=G,this.uint32[rt+4]=W,this.uint16[tt+10]=Y,this.uint16[tt+11]=ae,this.uint16[tt+12]=fe,this.float32[rt+7]=me,this.float32[rt+8]=Ce,this.uint8[yt+36]=Me,this.uint8[yt+37]=Ue,this.uint8[yt+38]=$e,this.uint32[rt+10]=Ke,this.int16[tt+22]=ut,c}}X.prototype.bytesPerElement=48,Ui("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",X);class w extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke,ut,tt,rt,yt,St,Jt,wi,ai,fi,yi,Ri){const li=this.length;return this.resize(li+1),this.emplace(li,c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke,ut,tt,rt,yt,St,Jt,wi,ai,fi,yi,Ri)}emplace(c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue,$e,Ke,ut,tt,rt,yt,St,Jt,wi,ai,fi,yi,Ri,li){const Yt=32*c,Gi=16*c;return this.int16[Yt+0]=d,this.int16[Yt+1]=_,this.int16[Yt+2]=S,this.int16[Yt+3]=M,this.int16[Yt+4]=k,this.int16[Yt+5]=G,this.int16[Yt+6]=W,this.int16[Yt+7]=Y,this.uint16[Yt+8]=ae,this.uint16[Yt+9]=fe,this.uint16[Yt+10]=me,this.uint16[Yt+11]=Ce,this.uint16[Yt+12]=Me,this.uint16[Yt+13]=Ue,this.uint16[Yt+14]=$e,this.uint16[Yt+15]=Ke,this.uint16[Yt+16]=ut,this.uint16[Yt+17]=tt,this.uint16[Yt+18]=rt,this.uint16[Yt+19]=yt,this.uint16[Yt+20]=St,this.uint16[Yt+21]=Jt,this.uint16[Yt+22]=wi,this.uint32[Gi+12]=ai,this.float32[Gi+13]=fi,this.float32[Gi+14]=yi,this.uint16[Yt+30]=Ri,this.uint16[Yt+31]=li,c}}w.prototype.bytesPerElement=64,Ui("StructArrayLayout8i15ui1ul2f2ui64",w);class a extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.float32[1*c+0]=d,c}}a.prototype.bytesPerElement=4,Ui("StructArrayLayout1f4",a);class p extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,_){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,_)}emplace(c,d,_,S){const M=3*c;return this.uint16[6*c+0]=d,this.float32[M+1]=_,this.float32[M+2]=S,c}}p.prototype.bytesPerElement=12,Ui("StructArrayLayout1ui2f12",p);class x extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,_){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,_)}emplace(c,d,_,S){const M=4*c;return this.uint32[2*c+0]=d,this.uint16[M+2]=_,this.uint16[M+3]=S,c}}x.prototype.bytesPerElement=8,Ui("StructArrayLayout1ul2ui8",x);class B extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d){const _=this.length;return this.resize(_+1),this.emplace(_,c,d)}emplace(c,d,_){const S=2*c;return this.uint16[S+0]=d,this.uint16[S+1]=_,c}}B.prototype.bytesPerElement=4,Ui("StructArrayLayout2ui4",B);class I extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.uint16[1*c+0]=d,c}}I.prototype.bytesPerElement=2,Ui("StructArrayLayout1ui2",I);class j extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,_,S){const M=this.length;return this.resize(M+1),this.emplace(M,c,d,_,S)}emplace(c,d,_,S,M){const k=4*c;return this.float32[k+0]=d,this.float32[k+1]=_,this.float32[k+2]=S,this.float32[k+3]=M,c}}j.prototype.bytesPerElement=16,Ui("StructArrayLayout4f16",j);class y extends $s{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new R(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class E extends A{get(c){return new y(this,c)}}Ui("CollisionBoxArray",E);class P extends $s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}P.prototype.size=48;class V extends X{get(c){return new P(this,c)}}Ui("PlacedSymbolArray",V);class q extends $s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}q.prototype.size=64;class K extends w{get(c){return new q(this,c)}}Ui("SymbolInstanceArray",K);class ee extends a{getoffsetX(c){return this.float32[1*c+0]}}Ui("GlyphOffsetArray",ee);class se extends ko{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}Ui("SymbolLineVertexArray",se);class oe extends $s{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}oe.prototype.size=12;class le extends p{get(c){return new oe(this,c)}}Ui("TextAnchorOffsetArray",le);class _e extends $s{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}_e.prototype.size=8;class Ie extends x{get(c){return new _e(this,c)}}Ui("FeatureIndexArray",Ie);class ve extends ec{}class Se extends ec{}class et extends ec{}class Oe extends tc{}class Re extends qc{}class Ve extends Oo{}class At extends ic{}class dt extends va{}class ft extends zr{}class Nt extends N{}class It extends b{}class jt extends O{}class Ht extends z{}class Mi extends B{}const mi=Fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ti}=mi;class ui{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=c}prepareSegment(c,d,_,S){let M=this.segments[this.segments.length-1];return c>ui.MAX_VERTEX_ARRAY_LENGTH&&Ze(`Max vertices per segment is ${ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!M||M.vertexLength+c>ui.MAX_VERTEX_ARRAY_LENGTH||M.sortKey!==S)&&(M={vertexOffset:d.length,primitiveOffset:_.length,vertexLength:0,primitiveLength:0},S!==void 0&&(M.sortKey=S),this.segments.push(M)),M}get(){return this.segments}destroy(){for(const c of this.segments)for(const d in c.vaos)c.vaos[d].destroy()}static simpleSegment(c,d,_,S){return new ui([{vertexOffset:c,primitiveOffset:d,vertexLength:_,primitiveLength:S,vaos:{},sortKey:0}])}}function ar(h,c){return 256*(h=je(Math.floor(h),0,255))+je(Math.floor(c),0,255)}ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ui("SegmentVector",ui);const er=Fn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ir={exports:{}},Dr={exports:{}};Dr.exports=function(h,c){var d,_,S,M,k,G,W,Y;for(_=h.length-(d=3&h.length),S=c,k=3432918353,G=461845907,Y=0;Y<_;)W=255&h.charCodeAt(Y)|(255&h.charCodeAt(++Y))<<8|(255&h.charCodeAt(++Y))<<16|(255&h.charCodeAt(++Y))<<24,++Y,S=27492+(65535&(M=5*(65535&(S=(S^=W=(65535&(W=(W=(65535&W)*k+(((W>>>16)*k&65535)<<16)&4294967295)<<15|W>>>17))*G+(((W>>>16)*G&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(W=0,d){case 3:W^=(255&h.charCodeAt(Y+2))<<16;case 2:W^=(255&h.charCodeAt(Y+1))<<8;case 1:S^=W=(65535&(W=(W=(65535&(W^=255&h.charCodeAt(Y)))*k+(((W>>>16)*k&65535)<<16)&4294967295)<<15|W>>>17))*G+(((W>>>16)*G&65535)<<16)&4294967295}return S^=h.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0};var Rr=Dr.exports,xr={exports:{}};xr.exports=function(h,c){for(var d,_=h.length,S=c^_,M=0;_>=4;)d=1540483477*(65535&(d=255&h.charCodeAt(M)|(255&h.charCodeAt(++M))<<8|(255&h.charCodeAt(++M))<<16|(255&h.charCodeAt(++M))<<24))+((1540483477*(d>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++M;switch(_){case 3:S^=(255&h.charCodeAt(M+2))<<16;case 2:S^=(255&h.charCodeAt(M+1))<<8;case 1:S=1540483477*(65535&(S^=255&h.charCodeAt(M)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0};var $r=Rr,br=xr.exports;ir.exports=$r,ir.exports.murmur3=$r,ir.exports.murmur2=br;var Wn=v(ir.exports);class Kr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,d,_,S){this.ids.push(kr(c)),this.positions.push(d,_,S)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const d=kr(c);let _=0,S=this.ids.length-1;for(;_<S;){const k=_+S>>1;this.ids[k]>=d?S=k:_=k+1}const M=[];for(;this.ids[_]===d;)M.push({index:this.positions[3*_],start:this.positions[3*_+1],end:this.positions[3*_+2]}),_++;return M}static serialize(c,d){const _=new Float64Array(c.ids),S=new Uint32Array(c.positions);return Wr(_,S,0,_.length-1),d&&d.push(_.buffer,S.buffer),{ids:_,positions:S}}static deserialize(c){const d=new Kr;return d.ids=c.ids,d.positions=c.positions,d.indexed=!0,d}}function kr(h){const c=+h;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:Wn(String(h))}function Wr(h,c,d,_){for(;d<_;){const S=h[d+_>>1];let M=d-1,k=_+1;for(;;){do M++;while(h[M]<S);do k--;while(h[k]>S);if(M>=k)break;ur(h,M,k),ur(c,3*M,3*k),ur(c,3*M+1,3*k+1),ur(c,3*M+2,3*k+2)}k-d<_-k?(Wr(h,c,d,k),d=k+1):(Wr(h,c,k+1,_),_=k)}}function ur(h,c,d){const _=h[c];h[c]=h[d],h[d]=_}Ui("FeaturePositionMap",Kr);class Nr{constructor(c,d){this.gl=c.gl,this.location=d}}class on extends Nr{constructor(c,d){super(c,d),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class es extends Nr{constructor(c,d){super(c,d),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class an extends Nr{constructor(c,d){super(c,d),this.current=dr.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const ts=new Float32Array(16);function Bs(h){return[ar(255*h.r,255*h.g),ar(255*h.b,255*h.a)]}class mr{constructor(c,d,_){this.value=c,this.uniformNames=d.map(S=>`u_${S}`),this.type=_}setUniform(c,d,_){c.set(_.constantOr(this.value))}getBinding(c,d,_){return this.type==="color"?new an(c,d):new on(c,d)}}class bn{constructor(c,d){this.uniformNames=d.map(_=>`u_${_}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=c.tlbr}setUniform(c,d,_,S){const M=S==="u_pattern_to"?this.patternTo:S==="u_pattern_from"?this.patternFrom:S==="u_pixel_ratio_to"?this.pixelRatioTo:S==="u_pixel_ratio_from"?this.pixelRatioFrom:null;M&&c.set(M)}getBinding(c,d,_){return _.substr(0,9)==="u_pattern"?new es(c,d):new on(c,d)}}class ea{constructor(c,d,_,S){this.expression=c,this.type=_,this.maxValue=0,this.paintVertexAttributes=d.map(M=>({name:`a_${M}`,type:"Float32",components:_==="color"?2:1,offset:0})),this.paintVertexArray=new S}populatePaintArray(c,d,_,S,M){const k=this.paintVertexArray.length,G=this.expression.evaluate(new Ei(0),d,{},S,[],M);this.paintVertexArray.resize(c),this._setPaintValue(k,c,G)}updatePaintArray(c,d,_,S){const M=this.expression.evaluate({zoom:0},_,S);this._setPaintValue(c,d,M)}_setPaintValue(c,d,_){if(this.type==="color"){const S=Bs(_);for(let M=c;M<d;M++)this.paintVertexArray.emplace(M,S[0],S[1])}else{for(let S=c;S<d;S++)this.paintVertexArray.emplace(S,_);this.maxValue=Math.max(this.maxValue,Math.abs(_))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Os{constructor(c,d,_,S,M,k){this.expression=c,this.uniformNames=d.map(G=>`u_${G}_t`),this.type=_,this.useIntegerZoom=S,this.zoom=M,this.maxValue=0,this.paintVertexAttributes=d.map(G=>({name:`a_${G}`,type:"Float32",components:_==="color"?4:2,offset:0})),this.paintVertexArray=new k}populatePaintArray(c,d,_,S,M){const k=this.expression.evaluate(new Ei(this.zoom),d,{},S,[],M),G=this.expression.evaluate(new Ei(this.zoom+1),d,{},S,[],M),W=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(W,c,k,G)}updatePaintArray(c,d,_,S){const M=this.expression.evaluate({zoom:this.zoom},_,S),k=this.expression.evaluate({zoom:this.zoom+1},_,S);this._setPaintValue(c,d,M,k)}_setPaintValue(c,d,_,S){if(this.type==="color"){const M=Bs(_),k=Bs(S);for(let G=c;G<d;G++)this.paintVertexArray.emplace(G,M[0],M[1],k[0],k[1])}else{for(let M=c;M<d;M++)this.paintVertexArray.emplace(M,_,S);this.maxValue=Math.max(this.maxValue,Math.abs(_),Math.abs(S))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,d){const _=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,S=je(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);c.set(S)}getBinding(c,d,_){return new on(c,d)}}class io{constructor(c,d,_,S,M,k){this.expression=c,this.type=d,this.useIntegerZoom=_,this.zoom=S,this.layerId=k,this.zoomInPaintVertexArray=new M,this.zoomOutPaintVertexArray=new M}populatePaintArray(c,d,_){const S=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(S,c,d.patterns&&d.patterns[this.layerId],_)}updatePaintArray(c,d,_,S,M){this._setPaintValues(c,d,_.patterns&&_.patterns[this.layerId],M)}_setPaintValues(c,d,_,S){if(!S||!_)return;const{min:M,mid:k,max:G}=_,W=S[M],Y=S[k],ae=S[G];if(W&&Y&&ae)for(let fe=c;fe<d;fe++)this.zoomInPaintVertexArray.emplace(fe,Y.tl[0],Y.tl[1],Y.br[0],Y.br[1],W.tl[0],W.tl[1],W.br[0],W.br[1],Y.pixelRatio,W.pixelRatio),this.zoomOutPaintVertexArray.emplace(fe,Y.tl[0],Y.tl[1],Y.br[0],Y.br[1],ae.tl[0],ae.tl[1],ae.br[0],ae.br[1],Y.pixelRatio,ae.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,er.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,er.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class yl{constructor(c,d,_){this.binders={},this._buffers=[];const S=[];for(const M in c.paint._values){if(!_(M))continue;const k=c.paint.get(M);if(!(k instanceof $n&&Pe(k.property.specification)))continue;const G=rc(M,c.type),W=k.value,Y=k.property.specification.type,ae=k.property.useIntegerZoom,fe=k.property.specification["property-type"],me=fe==="cross-faded"||fe==="cross-faded-data-driven";if(W.kind==="constant")this.binders[M]=me?new bn(W.value,G):new mr(W.value,G,Y),S.push(`/u_${M}`);else if(W.kind==="source"||me){const Ce=Ra(M,Y,"source");this.binders[M]=me?new io(W,Y,ae,d,Ce,c.id):new ea(W,G,Y,Ce),S.push(`/a_${M}`)}else{const Ce=Ra(M,Y,"composite");this.binders[M]=new Os(W,G,Y,ae,d,Ce),S.push(`/z_${M}`)}}this.cacheKey=S.sort().join("")}getMaxValue(c){const d=this.binders[c];return d instanceof ea||d instanceof Os?d.maxValue:0}populatePaintArrays(c,d,_,S,M){for(const k in this.binders){const G=this.binders[k];(G instanceof ea||G instanceof Os||G instanceof io)&&G.populatePaintArray(c,d,_,S,M)}}setConstantPatternPositions(c,d){for(const _ in this.binders){const S=this.binders[_];S instanceof bn&&S.setConstantPatternPositions(c,d)}}updatePaintArrays(c,d,_,S,M){let k=!1;for(const G in c){const W=d.getPositions(G);for(const Y of W){const ae=_.feature(Y.index);for(const fe in this.binders){const me=this.binders[fe];if((me instanceof ea||me instanceof Os||me instanceof io)&&me.expression.isStateDependent===!0){const Ce=S.paint.get(fe);me.expression=Ce.value,me.updatePaintArray(Y.start,Y.end,ae,c[G],M),k=!0}}}}return k}defines(){const c=[];for(const d in this.binders){const _=this.binders[d];(_ instanceof mr||_ instanceof bn)&&c.push(..._.uniformNames.map(S=>`#define HAS_UNIFORM_${S}`))}return c}getBinderAttributes(){const c=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof ea||_ instanceof Os)for(let S=0;S<_.paintVertexAttributes.length;S++)c.push(_.paintVertexAttributes[S].name);else if(_ instanceof io)for(let S=0;S<er.members.length;S++)c.push(er.members[S].name)}return c}getBinderUniforms(){const c=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof mr||_ instanceof bn||_ instanceof Os)for(const S of _.uniformNames)c.push(S)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,d){const _=[];for(const S in this.binders){const M=this.binders[S];if(M instanceof mr||M instanceof bn||M instanceof Os){for(const k of M.uniformNames)if(d[k]){const G=M.getBinding(c,d[k],k);_.push({name:k,property:S,binding:G})}}}return _}setUniforms(c,d,_,S){for(const{name:M,property:k,binding:G}of d)this.binders[k].setUniform(G,S,_.get(k),M)}updatePaintBuffers(c){this._buffers=[];for(const d in this.binders){const _=this.binders[d];if(c&&_ instanceof io){const S=c.fromScale===2?_.zoomInPaintVertexBuffer:_.zoomOutPaintVertexBuffer;S&&this._buffers.push(S)}else(_ instanceof ea||_ instanceof Os)&&_.paintVertexBuffer&&this._buffers.push(_.paintVertexBuffer)}}upload(c){for(const d in this.binders){const _=this.binders[d];(_ instanceof ea||_ instanceof Os||_ instanceof io)&&_.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const d=this.binders[c];(d instanceof ea||d instanceof Os||d instanceof io)&&d.destroy()}}}class _o{constructor(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const S of c)this.programConfigurations[S.id]=new yl(S,d,_);this.needsUpload=!1,this._featureMap=new Kr,this._bufferOffset=0}populatePaintArrays(c,d,_,S,M,k){for(const G in this.programConfigurations)this.programConfigurations[G].populatePaintArrays(c,d,S,M,k);d.id!==void 0&&this._featureMap.add(d.id,_,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,d,_,S){for(const M of _)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(c,this._featureMap,d,M,S)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function rc(h,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${c}-`,"").replace(/-/g,"_")]}function Ra(h,c,d){const _={color:{source:Oo,composite:j},number:{source:a,composite:Oo}},S=function(M){return{"line-pattern":{source:At,composite:At},"fill-pattern":{source:At,composite:At},"fill-extrusion-pattern":{source:At,composite:At}}[M]}(h);return S&&S[d]||_[c][d]}Ui("ConstantBinder",mr),Ui("CrossFadedConstantBinder",bn),Ui("SourceExpressionBinder",ea),Ui("CrossFadedCompositeBinder",io),Ui("CompositeExpressionBinder",Os),Ui("ProgramConfiguration",yl,{omit:["_buffers"]}),Ui("ProgramConfigurationSet",_o);const Dn=8192,xc=Math.pow(2,14)-1,gu=-xc-1;function _l(h){const c=Dn/h.extent,d=h.loadGeometry();for(let _=0;_<d.length;_++){const S=d[_];for(let M=0;M<S.length;M++){const k=S[M],G=Math.round(k.x*c),W=Math.round(k.y*c);k.x=je(G,gu,xc),k.y=je(W,gu,xc),(G<k.x||G>k.x+1||W<k.y||W>k.y+1)&&Ze("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function rl(h,c){return{type:h.type,id:h.id,properties:h.properties,geometry:c?_l(h):[]}}function Qu(h,c,d,_,S){h.emplaceBack(2*c+(_+1)/2,2*d+(S+1)/2)}class sA{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Se,this.indexArray=new Ht,this.segments=new ui,this.programConfigurations=new _o(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,_){const S=this.layers[0],M=[];let k=null,G=!1;S.type==="circle"&&(k=S.layout.get("circle-sort-key"),G=!k.isConstant());for(const{feature:W,id:Y,index:ae,sourceLayerIndex:fe}of c){const me=this.layers[0]._featureFilter.needGeometry,Ce=rl(W,me);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),Ce,_))continue;const Me=G?k.evaluate(Ce,{},_):void 0,Ue={id:Y,properties:W.properties,type:W.type,sourceLayerIndex:fe,index:ae,geometry:me?Ce.geometry:_l(W),patterns:{},sortKey:Me};M.push(Ue)}G&&M.sort((W,Y)=>W.sortKey-Y.sortKey);for(const W of M){const{geometry:Y,index:ae,sourceLayerIndex:fe}=W,me=c[ae].feature;this.addFeature(W,Y,ae,_),d.featureIndex.insert(me,Y,ae,fe,this.index)}}update(c,d,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Ti),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,d,_,S){for(const M of d)for(const k of M){const G=k.x,W=k.y;if(G<0||G>=Dn||W<0||W>=Dn)continue;const Y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),ae=Y.vertexLength;Qu(this.layoutVertexArray,G,W,-1,-1),Qu(this.layoutVertexArray,G,W,1,-1),Qu(this.layoutVertexArray,G,W,1,1),Qu(this.layoutVertexArray,G,W,-1,1),this.indexArray.emplaceBack(ae,ae+1,ae+2),this.indexArray.emplaceBack(ae,ae+3,ae+2),Y.vertexLength+=4,Y.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,_,{},S)}}function $c(h,c){for(let d=0;d<h.length;d++)if(nc(c,h[d]))return!0;for(let d=0;d<c.length;d++)if(nc(h,c[d]))return!0;return!!Vu(h,c)}function jA(h,c,d){return!!nc(h,c)||!!Od(c,h,d)}function oA(h,c){if(h.length===1)return ta(c,h[0]);for(let d=0;d<c.length;d++){const _=c[d];for(let S=0;S<_.length;S++)if(nc(h,_[S]))return!0}for(let d=0;d<h.length;d++)if(ta(c,h[d]))return!0;for(let d=0;d<c.length;d++)if(Vu(h,c[d]))return!0;return!1}function kd(h,c,d){if(h.length>1){if(Vu(h,c))return!0;for(let _=0;_<c.length;_++)if(Od(c[_],h,d))return!0}for(let _=0;_<h.length;_++)if(Od(h[_],c,d))return!0;return!1}function Vu(h,c){if(h.length===0||c.length===0)return!1;for(let d=0;d<h.length-1;d++){const _=h[d],S=h[d+1];for(let M=0;M<c.length-1;M++)if(mu(_,S,c[M],c[M+1]))return!0}return!1}function mu(h,c,d,_){return Ct(h,d,_)!==Ct(c,d,_)&&Ct(h,c,d)!==Ct(h,c,_)}function Od(h,c,d){const _=d*d;if(c.length===1)return h.distSqr(c[0])<_;for(let S=1;S<c.length;S++)if(Am(h,c[S-1],c[S])<_)return!0;return!1}function Am(h,c,d){const _=c.distSqr(d);if(_===0)return h.distSqr(c);const S=((h.x-c.x)*(d.x-c.x)+(h.y-c.y)*(d.y-c.y))/_;return h.distSqr(S<0?c:S>1?d:d.sub(c)._mult(S)._add(c))}function ta(h,c){let d,_,S,M=!1;for(let k=0;k<h.length;k++){d=h[k];for(let G=0,W=d.length-1;G<d.length;W=G++)_=d[G],S=d[W],_.y>c.y!=S.y>c.y&&c.x<(S.x-_.x)*(c.y-_.y)/(S.y-_.y)+_.x&&(M=!M)}return M}function nc(h,c){let d=!1;for(let _=0,S=h.length-1;_<h.length;S=_++){const M=h[_],k=h[S];M.y>c.y!=k.y>c.y&&c.x<(k.x-M.x)*(c.y-M.y)/(k.y-M.y)+M.x&&(d=!d)}return d}function aA(h,c,d){const _=d[0],S=d[2];if(h.x<_.x&&c.x<_.x||h.x>S.x&&c.x>S.x||h.y<_.y&&c.y<_.y||h.y>S.y&&c.y>S.y)return!1;const M=Ct(h,c,d[0]);return M!==Ct(h,c,d[1])||M!==Ct(h,c,d[2])||M!==Ct(h,c,d[3])}function xh(h,c,d){const _=c.paint.get(h).value;return _.kind==="constant"?_.value:d.programConfigurations.get(c.id).getMaxValue(h)}function yu(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function wh(h,c,d,_,S){if(!c[0]&&!c[1])return h;const M=R.convert(c)._mult(S);d==="viewport"&&M._rotate(-_);const k=[];for(let G=0;G<h.length;G++)k.push(h[G].sub(M));return k}let Bh,lA;Ui("CircleBucket",sA,{omit:["layers"]});var Yf={get paint(){return lA=lA||new sn({"circle-radius":new zi(ht.paint_circle["circle-radius"]),"circle-color":new zi(ht.paint_circle["circle-color"]),"circle-blur":new zi(ht.paint_circle["circle-blur"]),"circle-opacity":new zi(ht.paint_circle["circle-opacity"]),"circle-translate":new $i(ht.paint_circle["circle-translate"]),"circle-translate-anchor":new $i(ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $i(ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $i(ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zi(ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zi(ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zi(ht.paint_circle["circle-stroke-opacity"])})},get layout(){return Bh=Bh||new sn({"circle-sort-key":new zi(ht.layout_circle["circle-sort-key"])})}},ia=1e-6,Kc=typeof Float32Array<"u"?Float32Array:Array;function Ud(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function cA(h,c,d){var _=c[0],S=c[1],M=c[2],k=c[3],G=c[4],W=c[5],Y=c[6],ae=c[7],fe=c[8],me=c[9],Ce=c[10],Me=c[11],Ue=c[12],$e=c[13],Ke=c[14],ut=c[15],tt=d[0],rt=d[1],yt=d[2],St=d[3];return h[0]=tt*_+rt*G+yt*fe+St*Ue,h[1]=tt*S+rt*W+yt*me+St*$e,h[2]=tt*M+rt*Y+yt*Ce+St*Ke,h[3]=tt*k+rt*ae+yt*Me+St*ut,h[4]=(tt=d[4])*_+(rt=d[5])*G+(yt=d[6])*fe+(St=d[7])*Ue,h[5]=tt*S+rt*W+yt*me+St*$e,h[6]=tt*M+rt*Y+yt*Ce+St*Ke,h[7]=tt*k+rt*ae+yt*Me+St*ut,h[8]=(tt=d[8])*_+(rt=d[9])*G+(yt=d[10])*fe+(St=d[11])*Ue,h[9]=tt*S+rt*W+yt*me+St*$e,h[10]=tt*M+rt*Y+yt*Ce+St*Ke,h[11]=tt*k+rt*ae+yt*Me+St*ut,h[12]=(tt=d[12])*_+(rt=d[13])*G+(yt=d[14])*fe+(St=d[15])*Ue,h[13]=tt*S+rt*W+yt*me+St*$e,h[14]=tt*M+rt*Y+yt*Ce+St*Ke,h[15]=tt*k+rt*ae+yt*Me+St*ut,h}Math.hypot||(Math.hypot=function(){for(var h=0,c=arguments.length;c--;)h+=arguments[c]*arguments[c];return Math.sqrt(h)});var vl,Nd=cA;function _u(h,c,d){var _=c[0],S=c[1],M=c[2],k=c[3];return h[0]=d[0]*_+d[4]*S+d[8]*M+d[12]*k,h[1]=d[1]*_+d[5]*S+d[9]*M+d[13]*k,h[2]=d[2]*_+d[6]*S+d[10]*M+d[14]*k,h[3]=d[3]*_+d[7]*S+d[11]*M+d[15]*k,h}vl=new Kc(4),Kc!=Float32Array&&(vl[0]=0,vl[1]=0,vl[2]=0,vl[3]=0);class bl extends Ro{constructor(c){super(c,Yf)}createBucket(c){return new sA(c)}queryRadius(c){const d=c;return xh("circle-radius",this,d)+xh("circle-stroke-width",this,d)+yu(this.paint.get("circle-translate"))}queryIntersectsFeature(c,d,_,S,M,k,G,W){const Y=wh(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),k.angle,G),ae=this.paint.get("circle-radius").evaluate(d,_)+this.paint.get("circle-stroke-width").evaluate(d,_),fe=this.paint.get("circle-pitch-alignment")==="map",me=fe?Y:function(Me,Ue){return Me.map($e=>zd($e,Ue))}(Y,W),Ce=fe?ae*G:ae;for(const Me of S)for(const Ue of Me){const $e=fe?Ue:zd(Ue,W);let Ke=Ce;const ut=_u([],[Ue.x,Ue.y,0,1],W);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ke*=ut[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ke*=k.cameraToCenterDistance/ut[3]),jA(me,$e,Ke))return!0}return!1}}function zd(h,c){const d=_u([],[h.x,h.y,0,1],c);return new R(d[0]/d[3],d[1]/d[3])}class Ch extends sA{}let ep;Ui("HeatmapBucket",Ch,{omit:["layers"]});var dm={get paint(){return ep=ep||new sn({"heatmap-radius":new zi(ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zi(ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $i(ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Do(ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $i(ht.paint_heatmap["heatmap-opacity"])})}};function tp(h,c,d,_){let{width:S,height:M}=c;if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==S*M*d)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${S*M*d}`)}else _=new Uint8Array(S*M*d);return h.width=S,h.height=M,h.data=_,h}function ip(h,c,d){let{width:_,height:S}=c;if(_===h.width&&S===h.height)return;const M=tp({},{width:_,height:S},d);rp(h,M,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,_),height:Math.min(h.height,S)},d),h.width=_,h.height=S,h.data=M.data}function rp(h,c,d,_,S,M){if(S.width===0||S.height===0)return c;if(S.width>h.width||S.height>h.height||d.x>h.width-S.width||d.y>h.height-S.height)throw new RangeError("out of range source coordinates for image copy");if(S.width>c.width||S.height>c.height||_.x>c.width-S.width||_.y>c.height-S.height)throw new RangeError("out of range destination coordinates for image copy");const k=h.data,G=c.data;if(k===G)throw new Error("srcData equals dstData, so image is already copied");for(let W=0;W<S.height;W++){const Y=((d.y+W)*h.width+d.x)*M,ae=((_.y+W)*c.width+_.x)*M;for(let fe=0;fe<S.width*M;fe++)G[ae+fe]=k[Y+fe]}return c}class wc{constructor(c,d){tp(this,c,1,d)}resize(c){ip(this,c,1)}clone(){return new wc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,d,_,S,M){rp(c,d,_,S,M,1)}}class Uo{constructor(c,d){tp(this,c,4,d)}resize(c){ip(this,c,4)}replace(c,d){d?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,d,_,S,M){rp(c,d,_,S,M,4)}}function uA(h){const c={},d=h.resolution||256,_=h.clips?h.clips.length:1,S=h.image||new Uo({width:d,height:_});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);const M=(k,G,W)=>{c[h.evaluationKey]=W;const Y=h.expression.evaluate(c);S.data[k+G+0]=Math.floor(255*Y.r/Y.a),S.data[k+G+1]=Math.floor(255*Y.g/Y.a),S.data[k+G+2]=Math.floor(255*Y.b/Y.a),S.data[k+G+3]=Math.floor(255*Y.a)};if(h.clips)for(let k=0,G=0;k<_;++k,G+=4*d)for(let W=0,Y=0;W<d;W++,Y+=4){const ae=W/(d-1),{start:fe,end:me}=h.clips[k];M(G,Y,fe*(1-ae)+me*ae)}else for(let k=0,G=0;k<d;k++,G+=4)M(0,G,k/(d-1));return S}Ui("AlphaImage",wc),Ui("RGBAImage",Uo);class ka extends Ro{createBucket(c){return new Ch(c)}constructor(c){super(c,dm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=uA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xl;var Hu={get paint(){return xl=xl||new sn({"hillshade-illumination-direction":new $i(ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $i(ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $i(ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $i(ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $i(ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $i(ht.paint_hillshade["hillshade-accent-color"])})}};class Qd extends Ro{constructor(c){super(c,Hu)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const np=Fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:fm}=np;var sp={exports:{}};function hA(h,c,d){d=d||2;var _,S,M,k,G,W,Y,ae=c&&c.length,fe=ae?c[0]*d:h.length,me=Vd(h,0,fe,d,!0),Ce=[];if(!me||me.next===me.prev)return Ce;if(ae&&(me=function(Ue,$e,Ke,ut){var tt,rt,yt,St=[];for(tt=0,rt=$e.length;tt<rt;tt++)(yt=Vd(Ue,$e[tt]*ut,tt<rt-1?$e[tt+1]*ut:Ue.length,ut,!1))===yt.next&&(yt.steiner=!0),St.push(ax(yt));for(St.sort(ox),tt=0;tt<St.length;tt++)Ke=gm(St[tt],Ke);return Ke}(h,c,me,d)),h.length>80*d){_=M=h[0],S=k=h[1];for(var Me=d;Me<fe;Me+=d)(G=h[Me])<_&&(_=G),(W=h[Me+1])<S&&(S=W),G>M&&(M=G),W>k&&(k=W);Y=(Y=Math.max(M-_,k-S))!==0?32767/Y:0}return op(me,Ce,d,_,S,Y,0),Ce}function Vd(h,c,d,_,S){var M,k;if(S===hp(h,c,d,_)>0)for(M=c;M<d;M+=_)k=_m(M,h[M],h[M+1],k);else for(M=d-_;M>=c;M-=_)k=_m(M,h[M],h[M+1],k);return k&&Gd(k,k.next)&&(cp(k),k=k.next),k}function Eh(h,c){if(!h)return h;c||(c=h);var d,_=h;do if(d=!1,_.steiner||!Gd(_,_.next)&&Us(_.prev,_,_.next)!==0)_=_.next;else{if(cp(_),(_=c=_.prev)===_.next)break;d=!0}while(d||_!==c);return c}function op(h,c,d,_,S,M,k){if(h){!k&&M&&function(ae,fe,me,Ce){var Me=ae;do Me.z===0&&(Me.z=qA(Me.x,Me.y,fe,me,Ce)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==ae);Me.prevZ.nextZ=null,Me.prevZ=null,function(Ue){var $e,Ke,ut,tt,rt,yt,St,Jt,wi=1;do{for(Ke=Ue,Ue=null,rt=null,yt=0;Ke;){for(yt++,ut=Ke,St=0,$e=0;$e<wi&&(St++,ut=ut.nextZ);$e++);for(Jt=wi;St>0||Jt>0&&ut;)St!==0&&(Jt===0||!ut||Ke.z<=ut.z)?(tt=Ke,Ke=Ke.nextZ,St--):(tt=ut,ut=ut.nextZ,Jt--),rt?rt.nextZ=tt:Ue=tt,tt.prevZ=rt,rt=tt;Ke=ut}rt.nextZ=null,wi*=2}while(yt>1)}(Me)}(h,_,S,M);for(var G,W,Y=h;h.prev!==h.next;)if(G=h.prev,W=h.next,M?fI(h,_,S,M):Hd(h))c.push(G.i/d|0),c.push(h.i/d|0),c.push(W.i/d|0),cp(h),h=W.next,Y=W.next;else if((h=W)===Y){k?k===1?op(h=ro(Eh(h),c,d),c,d,_,S,M,2):k===2&&pm(h,c,d,_,S,M):op(Eh(h),c,d,_,S,M,1);break}}}function Hd(h){var c=h.prev,d=h,_=h.next;if(Us(c,d,_)>=0)return!1;for(var S=c.x,M=d.x,k=_.x,G=c.y,W=d.y,Y=_.y,ae=S<M?S<k?S:k:M<k?M:k,fe=G<W?G<Y?G:Y:W<Y?W:Y,me=S>M?S>k?S:k:M>k?M:k,Ce=G>W?G>Y?G:Y:W>Y?W:Y,Me=_.next;Me!==c;){if(Me.x>=ae&&Me.x<=me&&Me.y>=fe&&Me.y<=Ce&&$A(S,G,M,W,k,Y,Me.x,Me.y)&&Us(Me.prev,Me,Me.next)>=0)return!1;Me=Me.next}return!0}function fI(h,c,d,_){var S=h.prev,M=h,k=h.next;if(Us(S,M,k)>=0)return!1;for(var G=S.x,W=M.x,Y=k.x,ae=S.y,fe=M.y,me=k.y,Ce=G<W?G<Y?G:Y:W<Y?W:Y,Me=ae<fe?ae<me?ae:me:fe<me?fe:me,Ue=G>W?G>Y?G:Y:W>Y?W:Y,$e=ae>fe?ae>me?ae:me:fe>me?fe:me,Ke=qA(Ce,Me,c,d,_),ut=qA(Ue,$e,c,d,_),tt=h.prevZ,rt=h.nextZ;tt&&tt.z>=Ke&&rt&&rt.z<=ut;){if(tt.x>=Ce&&tt.x<=Ue&&tt.y>=Me&&tt.y<=$e&&tt!==S&&tt!==k&&$A(G,ae,W,fe,Y,me,tt.x,tt.y)&&Us(tt.prev,tt,tt.next)>=0||(tt=tt.prevZ,rt.x>=Ce&&rt.x<=Ue&&rt.y>=Me&&rt.y<=$e&&rt!==S&&rt!==k&&$A(G,ae,W,fe,Y,me,rt.x,rt.y)&&Us(rt.prev,rt,rt.next)>=0))return!1;rt=rt.nextZ}for(;tt&&tt.z>=Ke;){if(tt.x>=Ce&&tt.x<=Ue&&tt.y>=Me&&tt.y<=$e&&tt!==S&&tt!==k&&$A(G,ae,W,fe,Y,me,tt.x,tt.y)&&Us(tt.prev,tt,tt.next)>=0)return!1;tt=tt.prevZ}for(;rt&&rt.z<=ut;){if(rt.x>=Ce&&rt.x<=Ue&&rt.y>=Me&&rt.y<=$e&&rt!==S&&rt!==k&&$A(G,ae,W,fe,Y,me,rt.x,rt.y)&&Us(rt.prev,rt,rt.next)>=0)return!1;rt=rt.nextZ}return!0}function ro(h,c,d){var _=h;do{var S=_.prev,M=_.next.next;!Gd(S,M)&&U0(S,_,_.next,M)&&Sh(S,M)&&Sh(M,S)&&(c.push(S.i/d|0),c.push(_.i/d|0),c.push(M.i/d|0),cp(_),cp(_.next),_=h=M),_=_.next}while(_!==h);return Eh(_)}function pm(h,c,d,_,S,M){var k=h;do{for(var G=k.next.next;G!==k.prev;){if(k.i!==G.i&&ap(k,G)){var W=lx(k,G);return k=Eh(k,k.next),W=Eh(W,W.next),op(k,c,d,_,S,M,0),void op(W,c,d,_,S,M,0)}G=G.next}k=k.next}while(k!==h)}function ox(h,c){return h.x-c.x}function gm(h,c){var d=function(S,M){var k,G=M,W=S.x,Y=S.y,ae=-1/0;do{if(Y<=G.y&&Y>=G.next.y&&G.next.y!==G.y){var fe=G.x+(Y-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(fe<=W&&fe>ae&&(ae=fe,k=G.x<G.next.x?G:G.next,fe===W))return k}G=G.next}while(G!==M);if(!k)return null;var me,Ce=k,Me=k.x,Ue=k.y,$e=1/0;G=k;do W>=G.x&&G.x>=Me&&W!==G.x&&$A(Y<Ue?W:ae,Y,Me,Ue,Y<Ue?ae:W,Y,G.x,G.y)&&(me=Math.abs(Y-G.y)/(W-G.x),Sh(G,S)&&(me<$e||me===$e&&(G.x>k.x||G.x===k.x&&mm(k,G)))&&(k=G,$e=me)),G=G.next;while(G!==Ce);return k}(h,c);if(!d)return c;var _=lx(d,h);return Eh(_,_.next),Eh(d,d.next)}function mm(h,c){return Us(h.prev,h,c.prev)<0&&Us(c.next,h,h.next)<0}function qA(h,c,d,_,S){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-d)*S|0)|h<<8))|h<<4))|h<<2))|h<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-_)*S|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function ax(h){var c=h,d=h;do(c.x<d.x||c.x===d.x&&c.y<d.y)&&(d=c),c=c.next;while(c!==h);return d}function $A(h,c,d,_,S,M,k,G){return(S-k)*(c-G)>=(h-k)*(M-G)&&(h-k)*(_-G)>=(d-k)*(c-G)&&(d-k)*(M-G)>=(S-k)*(_-G)}function ap(h,c){return h.next.i!==c.i&&h.prev.i!==c.i&&!function(d,_){var S=d;do{if(S.i!==d.i&&S.next.i!==d.i&&S.i!==_.i&&S.next.i!==_.i&&U0(S,S.next,d,_))return!0;S=S.next}while(S!==d);return!1}(h,c)&&(Sh(h,c)&&Sh(c,h)&&function(d,_){var S=d,M=!1,k=(d.x+_.x)/2,G=(d.y+_.y)/2;do S.y>G!=S.next.y>G&&S.next.y!==S.y&&k<(S.next.x-S.x)*(G-S.y)/(S.next.y-S.y)+S.x&&(M=!M),S=S.next;while(S!==d);return M}(h,c)&&(Us(h.prev,h,c.prev)||Us(h,c.prev,c))||Gd(h,c)&&Us(h.prev,h,h.next)>0&&Us(c.prev,c,c.next)>0)}function Us(h,c,d){return(c.y-h.y)*(d.x-c.x)-(c.x-h.x)*(d.y-c.y)}function Gd(h,c){return h.x===c.x&&h.y===c.y}function U0(h,c,d,_){var S=lp(Us(h,c,d)),M=lp(Us(h,c,_)),k=lp(Us(d,_,h)),G=lp(Us(d,_,c));return S!==M&&k!==G||!(S!==0||!ym(h,d,c))||!(M!==0||!ym(h,_,c))||!(k!==0||!ym(d,h,_))||!(G!==0||!ym(d,c,_))}function ym(h,c,d){return c.x<=Math.max(h.x,d.x)&&c.x>=Math.min(h.x,d.x)&&c.y<=Math.max(h.y,d.y)&&c.y>=Math.min(h.y,d.y)}function lp(h){return h>0?1:h<0?-1:0}function Sh(h,c){return Us(h.prev,h,h.next)<0?Us(h,c,h.next)>=0&&Us(h,h.prev,c)>=0:Us(h,c,h.prev)<0||Us(h,h.next,c)<0}function lx(h,c){var d=new up(h.i,h.x,h.y),_=new up(c.i,c.x,c.y),S=h.next,M=c.prev;return h.next=c,c.prev=h,d.next=S,S.prev=d,_.next=d,d.prev=_,M.next=_,_.prev=M,_}function _m(h,c,d,_){var S=new up(h,c,d);return _?(S.next=_.next,S.prev=_,_.next.prev=S,_.next=S):(S.prev=S,S.next=S),S}function cp(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function up(h,c,d){this.i=h,this.x=c,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hp(h,c,d,_){for(var S=0,M=c,k=d-_;M<d;M+=_)S+=(h[k]-h[M])*(h[M+1]+h[k+1]),k=M;return S}sp.exports=hA,sp.exports.default=hA,hA.deviation=function(h,c,d,_){var S=c&&c.length,M=Math.abs(hp(h,0,S?c[0]*d:h.length,d));if(S)for(var k=0,G=c.length;k<G;k++)M-=Math.abs(hp(h,c[k]*d,k<G-1?c[k+1]*d:h.length,d));var W=0;for(k=0;k<_.length;k+=3){var Y=_[k]*d,ae=_[k+1]*d,fe=_[k+2]*d;W+=Math.abs((h[Y]-h[fe])*(h[ae+1]-h[Y+1])-(h[Y]-h[ae])*(h[fe+1]-h[Y+1]))}return M===0&&W===0?0:Math.abs((W-M)/M)},hA.flatten=function(h){for(var c=h[0][0].length,d={vertices:[],holes:[],dimensions:c},_=0,S=0;S<h.length;S++){for(var M=0;M<h[S].length;M++)for(var k=0;k<c;k++)d.vertices.push(h[S][M][k]);S>0&&d.holes.push(_+=h[S-1].length)}return d};var vm=v(sp.exports);function cx(h,c,d,_,S){N0(h,c,d||0,_||h.length-1,S||pI)}function N0(h,c,d,_,S){for(;_>d;){if(_-d>600){var M=_-d+1,k=c-d+1,G=Math.log(M),W=.5*Math.exp(2*G/3),Y=.5*Math.sqrt(G*W*(M-W)/M)*(k-M/2<0?-1:1);N0(h,c,Math.max(d,Math.floor(c-k*W/M+Y)),Math.min(_,Math.floor(c+(M-k)*W/M+Y)),S)}var ae=h[c],fe=d,me=_;for(Ap(h,d,c),S(h[_],ae)>0&&Ap(h,d,_);fe<me;){for(Ap(h,fe,me),fe++,me--;S(h[fe],ae)<0;)fe++;for(;S(h[me],ae)>0;)me--}S(h[d],ae)===0?Ap(h,d,me):Ap(h,++me,_),me<=c&&(d=me+1),c<=me&&(_=me-1)}}function Ap(h,c,d){var _=h[c];h[c]=h[d],h[d]=_}function pI(h,c){return h<c?-1:h>c?1:0}function z0(h,c){const d=h.length;if(d<=1)return[h];const _=[];let S,M;for(let k=0;k<d;k++){const G=Et(h[k]);G!==0&&(h[k].area=Math.abs(G),M===void 0&&(M=G<0),M===G<0?(S&&_.push(S),S=[h[k]]):S.push(h[k]))}if(S&&_.push(S),c>1)for(let k=0;k<_.length;k++)_[k].length<=c||(cx(_[k],c,1,_[k].length-1,gI),_[k]=_[k].slice(0,c));return _}function gI(h,c){return c.area-h.area}function Q0(h,c,d){const _=d.patternDependencies;let S=!1;for(const M of c){const k=M.paint.get(`${h}-pattern`);k.isConstant()||(S=!0);const G=k.constantOr(null);G&&(S=!0,_[G.to]=!0,_[G.from]=!0)}return S}function Gu(h,c,d,_,S){const M=S.patternDependencies;for(const k of c){const G=k.paint.get(`${h}-pattern`).value;if(G.kind!=="constant"){let W=G.evaluate({zoom:_-1},d,{},S.availableImages),Y=G.evaluate({zoom:_},d,{},S.availableImages),ae=G.evaluate({zoom:_+1},d,{},S.availableImages);W=W&&W.name?W.name:W,Y=Y&&Y.name?Y.name:Y,ae=ae&&ae.name?ae.name:ae,M[W]=!0,M[Y]=!0,M[ae]=!0,d.patterns[k.id]={min:W,mid:Y,max:ae}}}return d}class V0{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new et,this.indexArray=new Ht,this.indexArray2=new Mi,this.programConfigurations=new _o(c.layers,c.zoom),this.segments=new ui,this.segments2=new ui,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,_){this.hasPattern=Q0("fill",this.layers,d);const S=this.layers[0].layout.get("fill-sort-key"),M=!S.isConstant(),k=[];for(const{feature:G,id:W,index:Y,sourceLayerIndex:ae}of c){const fe=this.layers[0]._featureFilter.needGeometry,me=rl(G,fe);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),me,_))continue;const Ce=M?S.evaluate(me,{},_,d.availableImages):void 0,Me={id:W,properties:G.properties,type:G.type,sourceLayerIndex:ae,index:Y,geometry:fe?me.geometry:_l(G),patterns:{},sortKey:Ce};k.push(Me)}M&&k.sort((G,W)=>G.sortKey-W.sortKey);for(const G of k){const{geometry:W,index:Y,sourceLayerIndex:ae}=G;if(this.hasPattern){const fe=Gu("fill",this.layers,G,this.zoom,d);this.patternFeatures.push(fe)}else this.addFeature(G,W,Y,_,{});d.featureIndex.insert(c[Y].feature,W,Y,ae,this.index)}}update(c,d,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,_)}addFeatures(c,d,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,d,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,fm),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,d,_,S,M){for(const k of z0(d,500)){let G=0;for(const Ce of k)G+=Ce.length;const W=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray),Y=W.vertexLength,ae=[],fe=[];for(const Ce of k){if(Ce.length===0)continue;Ce!==k[0]&&fe.push(ae.length/2);const Me=this.segments2.prepareSegment(Ce.length,this.layoutVertexArray,this.indexArray2),Ue=Me.vertexLength;this.layoutVertexArray.emplaceBack(Ce[0].x,Ce[0].y),this.indexArray2.emplaceBack(Ue+Ce.length-1,Ue),ae.push(Ce[0].x),ae.push(Ce[0].y);for(let $e=1;$e<Ce.length;$e++)this.layoutVertexArray.emplaceBack(Ce[$e].x,Ce[$e].y),this.indexArray2.emplaceBack(Ue+$e-1,Ue+$e),ae.push(Ce[$e].x),ae.push(Ce[$e].y);Me.vertexLength+=Ce.length,Me.primitiveLength+=Ce.length}const me=vm(ae,fe);for(let Ce=0;Ce<me.length;Ce+=3)this.indexArray.emplaceBack(Y+me[Ce],Y+me[Ce+1],Y+me[Ce+2]);W.vertexLength+=G,W.primitiveLength+=me.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,_,M,S)}}let H0,KA;Ui("FillBucket",V0,{omit:["layers","patternFeatures"]});var mI={get paint(){return KA=KA||new sn({"fill-antialias":new $i(ht.paint_fill["fill-antialias"]),"fill-opacity":new zi(ht.paint_fill["fill-opacity"]),"fill-color":new zi(ht.paint_fill["fill-color"]),"fill-outline-color":new zi(ht.paint_fill["fill-outline-color"]),"fill-translate":new $i(ht.paint_fill["fill-translate"]),"fill-translate-anchor":new $i(ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kn(ht.paint_fill["fill-pattern"])})},get layout(){return H0=H0||new sn({"fill-sort-key":new zi(ht.layout_fill["fill-sort-key"])})}};class yI extends Ro{constructor(c){super(c,mI)}recalculate(c,d){super.recalculate(c,d);const _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new V0(c)}queryRadius(){return yu(this.paint.get("fill-translate"))}queryIntersectsFeature(c,d,_,S,M,k,G){return oA(wh(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),k.angle,G),S)}isTileClipped(){return!0}}const _I=Fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ux=Fn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:hx}=_I;var AA={},vI=T,Ax=jd;function jd(h,c,d,_,S){this.properties={},this.extent=d,this.type=0,this._pbf=h,this._geometry=-1,this._keys=_,this._values=S,h.readFields(G0,this,c)}function G0(h,c,d){h==1?c.id=d.readVarint():h==2?function(_,S){for(var M=_.readVarint()+_.pos;_.pos<M;){var k=S._keys[_.readVarint()],G=S._values[_.readVarint()];S.properties[k]=G}}(d,c):h==3?c.type=d.readVarint():h==4&&(c._geometry=d.pos)}function dp(h){for(var c,d,_=0,S=0,M=h.length,k=M-1;S<M;k=S++)_+=((d=h[k]).x-(c=h[S]).x)*(c.y+d.y);return _}jd.types=["Unknown","Point","LineString","Polygon"],jd.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var c,d=h.readVarint()+h.pos,_=1,S=0,M=0,k=0,G=[];h.pos<d;){if(S<=0){var W=h.readVarint();_=7&W,S=W>>3}if(S--,_===1||_===2)M+=h.readSVarint(),k+=h.readSVarint(),_===1&&(c&&G.push(c),c=[]),c.push(new vI(M,k));else{if(_!==7)throw new Error("unknown command "+_);c&&c.push(c[0].clone())}}return c&&G.push(c),G},jd.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var c=h.readVarint()+h.pos,d=1,_=0,S=0,M=0,k=1/0,G=-1/0,W=1/0,Y=-1/0;h.pos<c;){if(_<=0){var ae=h.readVarint();d=7&ae,_=ae>>3}if(_--,d===1||d===2)(S+=h.readSVarint())<k&&(k=S),S>G&&(G=S),(M+=h.readSVarint())<W&&(W=M),M>Y&&(Y=M);else if(d!==7)throw new Error("unknown command "+d)}return[k,W,G,Y]},jd.prototype.toGeoJSON=function(h,c,d){var _,S,M=this.extent*Math.pow(2,d),k=this.extent*h,G=this.extent*c,W=this.loadGeometry(),Y=jd.types[this.type];function ae(Ce){for(var Me=0;Me<Ce.length;Me++){var Ue=Ce[Me];Ce[Me]=[360*(Ue.x+k)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ue.y+G)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var fe=[];for(_=0;_<W.length;_++)fe[_]=W[_][0];ae(W=fe);break;case 2:for(_=0;_<W.length;_++)ae(W[_]);break;case 3:for(W=function(Ce){var Me=Ce.length;if(Me<=1)return[Ce];for(var Ue,$e,Ke=[],ut=0;ut<Me;ut++){var tt=dp(Ce[ut]);tt!==0&&($e===void 0&&($e=tt<0),$e===tt<0?(Ue&&Ke.push(Ue),Ue=[Ce[ut]]):Ue.push(Ce[ut]))}return Ue&&Ke.push(Ue),Ke}(W),_=0;_<W.length;_++)for(S=0;S<W[_].length;S++)ae(W[_][S])}W.length===1?W=W[0]:Y="Multi"+Y;var me={type:"Feature",geometry:{type:Y,coordinates:W},properties:this.properties};return"id"in this&&(me.id=this.id),me};var j0=Ax,dx=fx;function fx(h,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(px,this,c),this.length=this._features.length}function px(h,c,d){h===15?c.version=d.readVarint():h===1?c.name=d.readString():h===5?c.extent=d.readVarint():h===2?c._features.push(d.pos):h===3?c._keys.push(d.readString()):h===4&&c._values.push(function(_){for(var S=null,M=_.readVarint()+_.pos;_.pos<M;){var k=_.readVarint()>>3;S=k===1?_.readString():k===2?_.readFloat():k===3?_.readDouble():k===4?_.readVarint64():k===5?_.readVarint():k===6?_.readSVarint():k===7?_.readBoolean():null}return S}(d))}fx.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var c=this._pbf.readVarint()+this._pbf.pos;return new j0(this._pbf,c,this.extent,this._keys,this._values)};var bI=dx;function xI(h,c,d){if(h===3){var _=new bI(d,d.readVarint()+d.pos);_.length&&(c[_.name]=_)}}AA.VectorTile=function(h,c){this.layers=h.readFields(xI,{},c)},AA.VectorTileFeature=Ax,AA.VectorTileLayer=dx;const fp=AA.VectorTileFeature.types,bm=Math.pow(2,13);function pp(h,c,d,_,S,M,k,G){h.emplaceBack(c,d,2*Math.floor(_*bm)+k,S*bm*2,M*bm*2,Math.round(G))}class q0{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Oe,this.centroidVertexArray=new ve,this.indexArray=new Ht,this.programConfigurations=new _o(c.layers,c.zoom),this.segments=new ui,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,_){this.features=[],this.hasPattern=Q0("fill-extrusion",this.layers,d);for(const{feature:S,id:M,index:k,sourceLayerIndex:G}of c){const W=this.layers[0]._featureFilter.needGeometry,Y=rl(S,W);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),Y,_))continue;const ae={id:M,sourceLayerIndex:G,index:k,geometry:W?Y.geometry:_l(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Gu("fill-extrusion",this.layers,ae,this.zoom,d)):this.addFeature(ae,ae.geometry,k,_,{}),d.featureIndex.insert(S,ae.geometry,k,G,this.index,!0)}}addFeatures(c,d,_){for(const S of this.features){const{geometry:M}=S;this.addFeature(S,M,S.index,d,_)}}update(c,d,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,_)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,hx),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,ux.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,d,_,S,M){const k={x:0,y:0,vertexCount:0};for(const G of z0(d,500)){let W=0;for(const Me of G)W+=Me.length;let Y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Me of G){if(Me.length===0||BI(Me))continue;let Ue=0;for(let $e=0;$e<Me.length;$e++){const Ke=Me[$e];if($e>=1){const ut=Me[$e-1];if(!wI(Ke,ut)){Y.vertexLength+4>ui.MAX_VERTEX_ARRAY_LENGTH&&(Y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const tt=Ke.sub(ut)._perp()._unit(),rt=ut.dist(Ke);Ue+rt>32768&&(Ue=0),pp(this.layoutVertexArray,Ke.x,Ke.y,tt.x,tt.y,0,0,Ue),pp(this.layoutVertexArray,Ke.x,Ke.y,tt.x,tt.y,0,1,Ue),k.x+=2*Ke.x,k.y+=2*Ke.y,k.vertexCount+=2,Ue+=rt,pp(this.layoutVertexArray,ut.x,ut.y,tt.x,tt.y,0,0,Ue),pp(this.layoutVertexArray,ut.x,ut.y,tt.x,tt.y,0,1,Ue),k.x+=2*ut.x,k.y+=2*ut.y,k.vertexCount+=2;const yt=Y.vertexLength;this.indexArray.emplaceBack(yt,yt+2,yt+1),this.indexArray.emplaceBack(yt+1,yt+2,yt+3),Y.vertexLength+=4,Y.primitiveLength+=2}}}}if(Y.vertexLength+W>ui.MAX_VERTEX_ARRAY_LENGTH&&(Y=this.segments.prepareSegment(W,this.layoutVertexArray,this.indexArray)),fp[c.type]!=="Polygon")continue;const ae=[],fe=[],me=Y.vertexLength;for(const Me of G)if(Me.length!==0){Me!==G[0]&&fe.push(ae.length/2);for(let Ue=0;Ue<Me.length;Ue++){const $e=Me[Ue];pp(this.layoutVertexArray,$e.x,$e.y,0,0,1,1,0),k.x+=$e.x,k.y+=$e.y,k.vertexCount+=1,ae.push($e.x),ae.push($e.y)}}const Ce=vm(ae,fe);for(let Me=0;Me<Ce.length;Me+=3)this.indexArray.emplaceBack(me+Ce[Me],me+Ce[Me+2],me+Ce[Me+1]);Y.primitiveLength+=Ce.length/3,Y.vertexLength+=W}for(let G=0;G<k.vertexCount;G++)this.centroidVertexArray.emplaceBack(Math.floor(k.x/k.vertexCount),Math.floor(k.y/k.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,_,M,S)}}function wI(h,c){return h.x===c.x&&(h.x<0||h.x>Dn)||h.y===c.y&&(h.y<0||h.y>Dn)}function BI(h){return h.every(c=>c.x<0)||h.every(c=>c.x>Dn)||h.every(c=>c.y<0)||h.every(c=>c.y>Dn)}let gx;Ui("FillExtrusionBucket",q0,{omit:["layers","features"]});var CI={get paint(){return gx=gx||new sn({"fill-extrusion-opacity":new $i(ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zi(ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $i(ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $i(ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kn(ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zi(ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zi(ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $i(ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class mx extends Ro{constructor(c){super(c,CI)}createBucket(c){return new q0(c)}queryRadius(){return yu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,d,_,S,M,k,G,W){const Y=wh(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),k.angle,G),ae=this.paint.get("fill-extrusion-height").evaluate(d,_),fe=this.paint.get("fill-extrusion-base").evaluate(d,_),me=function(Me,Ue,$e,Ke){const ut=[];for(const tt of Me){const rt=[tt.x,tt.y,0,1];_u(rt,rt,Ue),ut.push(new R(rt[0]/rt[3],rt[1]/rt[3]))}return ut}(Y,W),Ce=function(Me,Ue,$e,Ke){const ut=[],tt=[],rt=Ke[8]*Ue,yt=Ke[9]*Ue,St=Ke[10]*Ue,Jt=Ke[11]*Ue,wi=Ke[8]*$e,ai=Ke[9]*$e,fi=Ke[10]*$e,yi=Ke[11]*$e;for(const Ri of Me){const li=[],Yt=[];for(const Gi of Ri){const Qi=Gi.x,yr=Gi.y,Qr=Ke[0]*Qi+Ke[4]*yr+Ke[12],qr=Ke[1]*Qi+Ke[5]*yr+Ke[13],gn=Ke[2]*Qi+Ke[6]*yr+Ke[14],as=Ke[3]*Qi+Ke[7]*yr+Ke[15],zn=gn+St,xn=as+Jt,Rn=Qr+wi,hn=qr+ai,wr=gn+fi,Qn=as+yi,An=new R((Qr+rt)/xn,(qr+yt)/xn);An.z=zn/xn,li.push(An);const tn=new R(Rn/Qn,hn/Qn);tn.z=wr/Qn,Yt.push(tn)}ut.push(li),tt.push(Yt)}return[ut,tt]}(S,fe,ae,W);return function(Me,Ue,$e){let Ke=1/0;oA($e,Ue)&&(Ke=$0($e,Ue[0]));for(let ut=0;ut<Ue.length;ut++){const tt=Ue[ut],rt=Me[ut];for(let yt=0;yt<tt.length-1;yt++){const St=tt[yt],Jt=[St,tt[yt+1],rt[yt+1],rt[yt],St];$c($e,Jt)&&(Ke=Math.min(Ke,$0($e,Jt)))}}return Ke!==1/0&&Ke}(Ce[0],Ce[1],me)}}function WA(h,c){return h.x*c.x+h.y*c.y}function $0(h,c){if(h.length===1){let d=0;const _=c[d++];let S;for(;!S||_.equals(S);)if(S=c[d++],!S)return 1/0;for(;d<c.length;d++){const M=c[d],k=h[0],G=S.sub(_),W=M.sub(_),Y=k.sub(_),ae=WA(G,G),fe=WA(G,W),me=WA(W,W),Ce=WA(Y,G),Me=WA(Y,W),Ue=ae*me-fe*fe,$e=(me*Ce-fe*Me)/Ue,Ke=(ae*Me-fe*Ce)/Ue,ut=_.z*(1-$e-Ke)+S.z*$e+M.z*Ke;if(isFinite(ut))return ut}return 1/0}{let d=1/0;for(const _ of c)d=Math.min(d,_.z);return d}}const yx=Fn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:_x}=yx,EI=Fn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:xm}=EI,SI=AA.VectorTileFeature.types,vx=Math.cos(Math.PI/180*37.5),bx=Math.pow(2,14)/.5;class K0{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new Re,this.layoutVertexArray2=new Ve,this.indexArray=new Ht,this.programConfigurations=new _o(c.layers,c.zoom),this.segments=new ui,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,_){this.hasPattern=Q0("line",this.layers,d);const S=this.layers[0].layout.get("line-sort-key"),M=!S.isConstant(),k=[];for(const{feature:G,id:W,index:Y,sourceLayerIndex:ae}of c){const fe=this.layers[0]._featureFilter.needGeometry,me=rl(G,fe);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),me,_))continue;const Ce=M?S.evaluate(me,{},_):void 0,Me={id:W,properties:G.properties,type:G.type,sourceLayerIndex:ae,index:Y,geometry:fe?me.geometry:_l(G),patterns:{},sortKey:Ce};k.push(Me)}M&&k.sort((G,W)=>G.sortKey-W.sortKey);for(const G of k){const{geometry:W,index:Y,sourceLayerIndex:ae}=G;if(this.hasPattern){const fe=Gu("line",this.layers,G,this.zoom,d);this.patternFeatures.push(fe)}else this.addFeature(G,W,Y,_,{});d.featureIndex.insert(c[Y].feature,W,Y,ae,this.index)}}update(c,d,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,_)}addFeatures(c,d,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,d,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,xm)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,_x),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,d,_,S,M){const k=this.layers[0].layout,G=k.get("line-join").evaluate(c,{}),W=k.get("line-cap"),Y=k.get("line-miter-limit"),ae=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const fe of d)this.addLine(fe,c,G,W,Y,ae);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,_,M,S)}addLine(c,d,_,S,M,k){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ke=0;Ke<c.length-1;Ke++)this.totalDistance+=c[Ke].dist(c[Ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const G=SI[d.type]==="Polygon";let W=c.length;for(;W>=2&&c[W-1].equals(c[W-2]);)W--;let Y=0;for(;Y<W-1&&c[Y].equals(c[Y+1]);)Y++;if(W<(G?3:2))return;_==="bevel"&&(M=1.05);const ae=this.overscaling<=16?15*Dn/(512*this.overscaling):0,fe=this.segments.prepareSegment(10*W,this.layoutVertexArray,this.indexArray);let me,Ce,Me,Ue,$e;this.e1=this.e2=-1,G&&(me=c[W-2],$e=c[Y].sub(me)._unit()._perp());for(let Ke=Y;Ke<W;Ke++){if(Me=Ke===W-1?G?c[Y+1]:void 0:c[Ke+1],Me&&c[Ke].equals(Me))continue;$e&&(Ue=$e),me&&(Ce=me),me=c[Ke],$e=Me?Me.sub(me)._unit()._perp():Ue,Ue=Ue||$e;let ut=Ue.add($e);ut.x===0&&ut.y===0||ut._unit();const tt=Ue.x*$e.x+Ue.y*$e.y,rt=ut.x*$e.x+ut.y*$e.y,yt=rt!==0?1/rt:1/0,St=2*Math.sqrt(2-2*rt),Jt=rt<vx&&Ce&&Me,wi=Ue.x*$e.y-Ue.y*$e.x>0;if(Jt&&Ke>Y){const yi=me.dist(Ce);if(yi>2*ae){const Ri=me.sub(me.sub(Ce)._mult(ae/yi)._round());this.updateDistance(Ce,Ri),this.addCurrentVertex(Ri,Ue,0,0,fe),Ce=Ri}}const ai=Ce&&Me;let fi=ai?_:G?"butt":S;if(ai&&fi==="round"&&(yt<k?fi="miter":yt<=2&&(fi="fakeround")),fi==="miter"&&yt>M&&(fi="bevel"),fi==="bevel"&&(yt>2&&(fi="flipbevel"),yt<M&&(fi="miter")),Ce&&this.updateDistance(Ce,me),fi==="miter")ut._mult(yt),this.addCurrentVertex(me,ut,0,0,fe);else if(fi==="flipbevel"){if(yt>100)ut=$e.mult(-1);else{const yi=yt*Ue.add($e).mag()/Ue.sub($e).mag();ut._perp()._mult(yi*(wi?-1:1))}this.addCurrentVertex(me,ut,0,0,fe),this.addCurrentVertex(me,ut.mult(-1),0,0,fe)}else if(fi==="bevel"||fi==="fakeround"){const yi=-Math.sqrt(yt*yt-1),Ri=wi?yi:0,li=wi?0:yi;if(Ce&&this.addCurrentVertex(me,Ue,Ri,li,fe),fi==="fakeround"){const Yt=Math.round(180*St/Math.PI/20);for(let Gi=1;Gi<Yt;Gi++){let Qi=Gi/Yt;if(Qi!==.5){const Qr=Qi-.5;Qi+=Qi*Qr*(Qi-1)*((1.0904+tt*(tt*(3.55645-1.43519*tt)-3.2452))*Qr*Qr+(.848013+tt*(.215638*tt-1.06021)))}const yr=$e.sub(Ue)._mult(Qi)._add(Ue)._unit()._mult(wi?-1:1);this.addHalfVertex(me,yr.x,yr.y,!1,wi,0,fe)}}Me&&this.addCurrentVertex(me,$e,-Ri,-li,fe)}else if(fi==="butt")this.addCurrentVertex(me,ut,0,0,fe);else if(fi==="square"){const yi=Ce?1:-1;this.addCurrentVertex(me,ut,yi,yi,fe)}else fi==="round"&&(Ce&&(this.addCurrentVertex(me,Ue,0,0,fe),this.addCurrentVertex(me,Ue,1,1,fe,!0)),Me&&(this.addCurrentVertex(me,$e,-1,-1,fe,!0),this.addCurrentVertex(me,$e,0,0,fe)));if(Jt&&Ke<W-1){const yi=me.dist(Me);if(yi>2*ae){const Ri=me.add(Me.sub(me)._mult(ae/yi)._round());this.updateDistance(me,Ri),this.addCurrentVertex(Ri,$e,0,0,fe),me=Ri}}}}addCurrentVertex(c,d,_,S,M){let k=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const G=d.y*S-d.x,W=-d.y-d.x*S;this.addHalfVertex(c,d.x+d.y*_,d.y-d.x*_,k,!1,_,M),this.addHalfVertex(c,G,W,k,!0,-S,M),this.distance>bx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,d,_,S,M,k))}addHalfVertex(c,d,_,S,M,k,G){let{x:W,y:Y}=c;const ae=.5*(this.lineClips?this.scaledDistance*(bx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((W<<1)+(S?1:0),(Y<<1)+(M?1:0),Math.round(63*d)+128,Math.round(63*_)+128,1+(k===0?0:k<0?-1:1)|(63&ae)<<2,ae>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const fe=G.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,fe),G.primitiveLength++),M?this.e2=fe:this.e1=fe}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,d){this.distance+=c.dist(d),this.updateScaledDistance()}}let xx,W0;Ui("LineBucket",K0,{omit:["layers","patternFeatures"]});var wx={get paint(){return W0=W0||new sn({"line-opacity":new zi(ht.paint_line["line-opacity"]),"line-color":new zi(ht.paint_line["line-color"]),"line-translate":new $i(ht.paint_line["line-translate"]),"line-translate-anchor":new $i(ht.paint_line["line-translate-anchor"]),"line-width":new zi(ht.paint_line["line-width"]),"line-gap-width":new zi(ht.paint_line["line-gap-width"]),"line-offset":new zi(ht.paint_line["line-offset"]),"line-blur":new zi(ht.paint_line["line-blur"]),"line-dasharray":new zu(ht.paint_line["line-dasharray"]),"line-pattern":new Kn(ht.paint_line["line-pattern"]),"line-gradient":new Do(ht.paint_line["line-gradient"])})},get layout(){return xx=xx||new sn({"line-cap":new $i(ht.layout_line["line-cap"]),"line-join":new zi(ht.layout_line["line-join"]),"line-miter-limit":new $i(ht.layout_line["line-miter-limit"]),"line-round-limit":new $i(ht.layout_line["line-round-limit"]),"line-sort-key":new zi(ht.layout_line["line-sort-key"])})}};class TI extends zi{possiblyEvaluate(c,d){return d=new Ei(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(c,d)}evaluate(c,d,_,S){return d=Ne({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(c,d,_,S)}}let dA;class vo extends Ro{constructor(c){super(c,wx),this.gradientVersion=0,dA||(dA=new TI(wx.paint.properties["line-width"].specification),dA.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const d=this.gradientExpression();this.stepInterpolant=!!function(_){return _._styleExpression!==void 0}(d)&&d._styleExpression.expression instanceof go,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,d){super.recalculate(c,d),this.paint._values["line-floorwidth"]=dA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new K0(c)}queryRadius(c){const d=c,_=Z0(xh("line-width",this,d),xh("line-gap-width",this,d)),S=xh("line-offset",this,d);return _/2+Math.abs(S)+yu(this.paint.get("line-translate"))}queryIntersectsFeature(c,d,_,S,M,k,G){const W=wh(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),k.angle,G),Y=G/2*Z0(this.paint.get("line-width").evaluate(d,_),this.paint.get("line-gap-width").evaluate(d,_)),ae=this.paint.get("line-offset").evaluate(d,_);return ae&&(S=function(fe,me){const Ce=[];for(let Me=0;Me<fe.length;Me++){const Ue=fe[Me],$e=[];for(let Ke=0;Ke<Ue.length;Ke++){const ut=Ue[Ke-1],tt=Ue[Ke],rt=Ue[Ke+1],yt=Ke===0?new R(0,0):tt.sub(ut)._unit()._perp(),St=Ke===Ue.length-1?new R(0,0):rt.sub(tt)._unit()._perp(),Jt=yt._add(St)._unit(),wi=Jt.x*St.x+Jt.y*St.y;wi!==0&&Jt._mult(1/wi),$e.push(Jt._mult(me)._add(tt))}Ce.push($e)}return Ce}(S,ae*G)),function(fe,me,Ce){for(let Me=0;Me<me.length;Me++){const Ue=me[Me];if(fe.length>=3){for(let $e=0;$e<Ue.length;$e++)if(nc(fe,Ue[$e]))return!0}if(kd(fe,Ue,Ce))return!0}return!1}(W,S,Y)}isTileClipped(){return!0}}function Z0(h,c){return c>0?c+2*h:h}const Bx=Fn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cx=Fn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Fn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zn=Fn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Fn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wm=Fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ex=Fn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Sx(h,c,d){return h.sections.forEach(_=>{_.text=function(S,M,k){const G=M.layout.get("text-transform").evaluate(k,{});return G==="uppercase"?S=S.toLocaleUpperCase():G==="lowercase"&&(S=S.toLocaleLowerCase()),to.applyArabicShaping&&(S=to.applyArabicShaping(S)),S}(_.text,c,d)}),h}Fn([{name:"triangle",components:3,type:"Uint16"}]),Fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Fn([{type:"Float32",name:"offsetX"}]),Fn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Fn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Bc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Cs=24,X0=Xn,Tx=function(h,c,d,_,S){var M,k,G=8*S-_-1,W=(1<<G)-1,Y=W>>1,ae=-7,fe=d?S-1:0,me=d?-1:1,Ce=h[c+fe];for(fe+=me,M=Ce&(1<<-ae)-1,Ce>>=-ae,ae+=G;ae>0;M=256*M+h[c+fe],fe+=me,ae-=8);for(k=M&(1<<-ae)-1,M>>=-ae,ae+=_;ae>0;k=256*k+h[c+fe],fe+=me,ae-=8);if(M===0)M=1-Y;else{if(M===W)return k?NaN:1/0*(Ce?-1:1);k+=Math.pow(2,_),M-=Y}return(Ce?-1:1)*k*Math.pow(2,M-_)},Ix=function(h,c,d,_,S,M){var k,G,W,Y=8*M-S-1,ae=(1<<Y)-1,fe=ae>>1,me=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ce=_?0:M-1,Me=_?1:-1,Ue=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(G=isNaN(c)?1:0,k=ae):(k=Math.floor(Math.log(c)/Math.LN2),c*(W=Math.pow(2,-k))<1&&(k--,W*=2),(c+=k+fe>=1?me/W:me*Math.pow(2,1-fe))*W>=2&&(k++,W/=2),k+fe>=ae?(G=0,k=ae):k+fe>=1?(G=(c*W-1)*Math.pow(2,S),k+=fe):(G=c*Math.pow(2,fe-1)*Math.pow(2,S),k=0));S>=8;h[d+Ce]=255&G,Ce+=Me,G/=256,S-=8);for(k=k<<S|G,Y+=S;Y>0;h[d+Ce]=255&k,Ce+=Me,k/=256,Y-=8);h[d+Ce-Me]|=128*Ue};function Xn(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}Xn.Varint=0,Xn.Fixed64=1,Xn.Bytes=2,Xn.Fixed32=5;var J0=4294967296,Lx=1/J0,Mx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Th(h){return h.type===Xn.Bytes?h.readVarint()+h.pos:h.pos+1}function qd(h,c,d){return d?4294967296*c+(h>>>0):4294967296*(c>>>0)+(h>>>0)}function Px(h,c,d){var _=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));d.realloc(_);for(var S=d.pos-1;S>=h;S--)d.buf[S+_]=d.buf[S]}function Bm(h,c){for(var d=0;d<h.length;d++)c.writeVarint(h[d])}function $d(h,c){for(var d=0;d<h.length;d++)c.writeSVarint(h[d])}function Fx(h,c){for(var d=0;d<h.length;d++)c.writeFloat(h[d])}function Y0(h,c){for(var d=0;d<h.length;d++)c.writeDouble(h[d])}function e_(h,c){for(var d=0;d<h.length;d++)c.writeBoolean(h[d])}function II(h,c){for(var d=0;d<h.length;d++)c.writeFixed32(h[d])}function LI(h,c){for(var d=0;d<h.length;d++)c.writeSFixed32(h[d])}function MI(h,c){for(var d=0;d<h.length;d++)c.writeFixed64(h[d])}function Dx(h,c){for(var d=0;d<h.length;d++)c.writeSFixed64(h[d])}function gp(h,c){return(h[c]|h[c+1]<<8|h[c+2]<<16)+16777216*h[c+3]}function No(h,c,d){h[d]=c,h[d+1]=c>>>8,h[d+2]=c>>>16,h[d+3]=c>>>24}function Cm(h,c){return(h[c]|h[c+1]<<8|h[c+2]<<16)+(h[c+3]<<24)}Xn.prototype={destroy:function(){this.buf=null},readFields:function(h,c,d){for(d=d||this.length;this.pos<d;){var _=this.readVarint(),S=_>>3,M=this.pos;this.type=7&_,h(S,c,this),this.pos===M&&this.skip(_)}return c},readMessage:function(h,c){return this.readFields(h,c,this.readVarint()+this.pos)},readFixed32:function(){var h=gp(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=Cm(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=gp(this.buf,this.pos)+gp(this.buf,this.pos+4)*J0;return this.pos+=8,h},readSFixed64:function(){var h=gp(this.buf,this.pos)+Cm(this.buf,this.pos+4)*J0;return this.pos+=8,h},readFloat:function(){var h=Tx(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=Tx(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var c,d,_=this.buf;return c=127&(d=_[this.pos++]),d<128?c:(c|=(127&(d=_[this.pos++]))<<7,d<128?c:(c|=(127&(d=_[this.pos++]))<<14,d<128?c:(c|=(127&(d=_[this.pos++]))<<21,d<128?c:function(S,M,k){var G,W,Y=k.buf;if(G=(112&(W=Y[k.pos++]))>>4,W<128||(G|=(127&(W=Y[k.pos++]))<<3,W<128)||(G|=(127&(W=Y[k.pos++]))<<10,W<128)||(G|=(127&(W=Y[k.pos++]))<<17,W<128)||(G|=(127&(W=Y[k.pos++]))<<24,W<128)||(G|=(1&(W=Y[k.pos++]))<<31,W<128))return qd(S,G,M);throw new Error("Expected varint not more than 10 bytes")}(c|=(15&(d=_[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,c=this.pos;return this.pos=h,h-c>=12&&Mx?function(d,_,S){return Mx.decode(d.subarray(_,S))}(this.buf,c,h):function(d,_,S){for(var M="",k=_;k<S;){var G,W,Y,ae=d[k],fe=null,me=ae>239?4:ae>223?3:ae>191?2:1;if(k+me>S)break;me===1?ae<128&&(fe=ae):me===2?(192&(G=d[k+1]))==128&&(fe=(31&ae)<<6|63&G)<=127&&(fe=null):me===3?(W=d[k+2],(192&(G=d[k+1]))==128&&(192&W)==128&&((fe=(15&ae)<<12|(63&G)<<6|63&W)<=2047||fe>=55296&&fe<=57343)&&(fe=null)):me===4&&(W=d[k+2],Y=d[k+3],(192&(G=d[k+1]))==128&&(192&W)==128&&(192&Y)==128&&((fe=(15&ae)<<18|(63&G)<<12|(63&W)<<6|63&Y)<=65535||fe>=1114112)&&(fe=null)),fe===null?(fe=65533,me=1):fe>65535&&(fe-=65536,M+=String.fromCharCode(fe>>>10&1023|55296),fe=56320|1023&fe),M+=String.fromCharCode(fe),k+=me}return M}(this.buf,c,h)},readBytes:function(){var h=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,h);return this.pos=h,c},readPackedVarint:function(h,c){if(this.type!==Xn.Bytes)return h.push(this.readVarint(c));var d=Th(this);for(h=h||[];this.pos<d;)h.push(this.readVarint(c));return h},readPackedSVarint:function(h){if(this.type!==Xn.Bytes)return h.push(this.readSVarint());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==Xn.Bytes)return h.push(this.readBoolean());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==Xn.Bytes)return h.push(this.readFloat());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==Xn.Bytes)return h.push(this.readDouble());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==Xn.Bytes)return h.push(this.readFixed32());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==Xn.Bytes)return h.push(this.readSFixed32());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==Xn.Bytes)return h.push(this.readFixed64());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==Xn.Bytes)return h.push(this.readSFixed64());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readSFixed64());return h},skip:function(h){var c=7&h;if(c===Xn.Varint)for(;this.buf[this.pos++]>127;);else if(c===Xn.Bytes)this.pos=this.readVarint()+this.pos;else if(c===Xn.Fixed32)this.pos+=4;else{if(c!==Xn.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(h,c){this.writeVarint(h<<3|c)},realloc:function(h){for(var c=this.length||16;c<this.pos+h;)c*=2;if(c!==this.length){var d=new Uint8Array(c);d.set(this.buf),this.buf=d,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),No(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),No(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),No(this.buf,-1&h,this.pos),No(this.buf,Math.floor(h*Lx),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),No(this.buf,-1&h,this.pos),No(this.buf,Math.floor(h*Lx),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(c,d){var _,S;if(c>=0?(_=c%4294967296|0,S=c/4294967296|0):(S=~(-c/4294967296),4294967295^(_=~(-c%4294967296))?_=_+1|0:(_=0,S=S+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(M,k,G){G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,G.buf[G.pos]=127&(M>>>=7)}(_,0,d),function(M,k){var G=(7&M)<<4;k.buf[k.pos++]|=G|((M>>>=3)?128:0),M&&(k.buf[k.pos++]=127&M|((M>>>=7)?128:0),M&&(k.buf[k.pos++]=127&M|((M>>>=7)?128:0),M&&(k.buf[k.pos++]=127&M|((M>>>=7)?128:0),M&&(k.buf[k.pos++]=127&M|((M>>>=7)?128:0),M&&(k.buf[k.pos++]=127&M)))))}(S,d)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var c=this.pos;this.pos=function(_,S,M){for(var k,G,W=0;W<S.length;W++){if((k=S.charCodeAt(W))>55295&&k<57344){if(!G){k>56319||W+1===S.length?(_[M++]=239,_[M++]=191,_[M++]=189):G=k;continue}if(k<56320){_[M++]=239,_[M++]=191,_[M++]=189,G=k;continue}k=G-55296<<10|k-56320|65536,G=null}else G&&(_[M++]=239,_[M++]=191,_[M++]=189,G=null);k<128?_[M++]=k:(k<2048?_[M++]=k>>6|192:(k<65536?_[M++]=k>>12|224:(_[M++]=k>>18|240,_[M++]=k>>12&63|128),_[M++]=k>>6&63|128),_[M++]=63&k|128)}return M}(this.buf,h,this.pos);var d=this.pos-c;d>=128&&Px(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeFloat:function(h){this.realloc(4),Ix(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),Ix(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var c=h.length;this.writeVarint(c),this.realloc(c);for(var d=0;d<c;d++)this.buf[this.pos++]=h[d]},writeRawMessage:function(h,c){this.pos++;var d=this.pos;h(c,this);var _=this.pos-d;_>=128&&Px(d,_,this),this.pos=d-1,this.writeVarint(_),this.pos+=_},writeMessage:function(h,c,d){this.writeTag(h,Xn.Bytes),this.writeRawMessage(c,d)},writePackedVarint:function(h,c){c.length&&this.writeMessage(h,Bm,c)},writePackedSVarint:function(h,c){c.length&&this.writeMessage(h,$d,c)},writePackedBoolean:function(h,c){c.length&&this.writeMessage(h,e_,c)},writePackedFloat:function(h,c){c.length&&this.writeMessage(h,Fx,c)},writePackedDouble:function(h,c){c.length&&this.writeMessage(h,Y0,c)},writePackedFixed32:function(h,c){c.length&&this.writeMessage(h,II,c)},writePackedSFixed32:function(h,c){c.length&&this.writeMessage(h,LI,c)},writePackedFixed64:function(h,c){c.length&&this.writeMessage(h,MI,c)},writePackedSFixed64:function(h,c){c.length&&this.writeMessage(h,Dx,c)},writeBytesField:function(h,c){this.writeTag(h,Xn.Bytes),this.writeBytes(c)},writeFixed32Field:function(h,c){this.writeTag(h,Xn.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(h,c){this.writeTag(h,Xn.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(h,c){this.writeTag(h,Xn.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(h,c){this.writeTag(h,Xn.Fixed64),this.writeSFixed64(c)},writeVarintField:function(h,c){this.writeTag(h,Xn.Varint),this.writeVarint(c)},writeSVarintField:function(h,c){this.writeTag(h,Xn.Varint),this.writeSVarint(c)},writeStringField:function(h,c){this.writeTag(h,Xn.Bytes),this.writeString(c)},writeFloatField:function(h,c){this.writeTag(h,Xn.Fixed32),this.writeFloat(c)},writeDoubleField:function(h,c){this.writeTag(h,Xn.Fixed64),this.writeDouble(c)},writeBooleanField:function(h,c){this.writeVarintField(h,!!c)}};var Em=v(X0);const ju=3;function mp(h,c,d){h===1&&d.readMessage(yp,c)}function yp(h,c,d){if(h===3){const{id:_,bitmap:S,width:M,height:k,left:G,top:W,advance:Y}=d.readMessage(Kd,{});c.push({id:_,bitmap:new wc({width:M+2*ju,height:k+2*ju},S),metrics:{width:M,height:k,left:G,top:W,advance:Y}})}}function Kd(h,c,d){h===1?c.id=d.readVarint():h===2?c.bitmap=d.readBytes():h===3?c.width=d.readVarint():h===4?c.height=d.readVarint():h===5?c.left=d.readSVarint():h===6?c.top=d.readSVarint():h===7&&(c.advance=d.readVarint())}const _p=ju;function vp(h){let c=0,d=0;for(const k of h)c+=k.w*k.h,d=Math.max(d,k.w);h.sort((k,G)=>G.h-k.h);const _=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),d),h:1/0}];let S=0,M=0;for(const k of h)for(let G=_.length-1;G>=0;G--){const W=_[G];if(!(k.w>W.w||k.h>W.h)){if(k.x=W.x,k.y=W.y,M=Math.max(M,k.y+k.h),S=Math.max(S,k.x+k.w),k.w===W.w&&k.h===W.h){const Y=_.pop();G<_.length&&(_[G]=Y)}else k.h===W.h?(W.x+=k.w,W.w-=k.w):k.w===W.w?(W.y+=k.h,W.h-=k.h):(_.push({x:W.x+k.w,y:W.y,w:W.w-k.w,h:k.h}),W.y+=k.h,W.h-=k.h);break}}return{w:S,h:M,fill:c/(S*M)||0}}const wl=1;class Sm{constructor(c,d){let{pixelRatio:_,version:S,stretchX:M,stretchY:k,content:G}=d;this.paddedRect=c,this.pixelRatio=_,this.stretchX=M,this.stretchY=k,this.content=G,this.version=S}get tl(){return[this.paddedRect.x+wl,this.paddedRect.y+wl]}get br(){return[this.paddedRect.x+this.paddedRect.w-wl,this.paddedRect.y+this.paddedRect.h-wl]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*wl)/this.pixelRatio,(this.paddedRect.h-2*wl)/this.pixelRatio]}}class t_{constructor(c,d){const _={},S={};this.haveRenderCallbacks=[];const M=[];this.addImages(c,_,M),this.addImages(d,S,M);const{w:k,h:G}=vp(M),W=new Uo({width:k||1,height:G||1});for(const Y in c){const ae=c[Y],fe=_[Y].paddedRect;Uo.copy(ae.data,W,{x:0,y:0},{x:fe.x+wl,y:fe.y+wl},ae.data)}for(const Y in d){const ae=d[Y],fe=S[Y].paddedRect,me=fe.x+wl,Ce=fe.y+wl,Me=ae.data.width,Ue=ae.data.height;Uo.copy(ae.data,W,{x:0,y:0},{x:me,y:Ce},ae.data),Uo.copy(ae.data,W,{x:0,y:Ue-1},{x:me,y:Ce-1},{width:Me,height:1}),Uo.copy(ae.data,W,{x:0,y:0},{x:me,y:Ce+Ue},{width:Me,height:1}),Uo.copy(ae.data,W,{x:Me-1,y:0},{x:me-1,y:Ce},{width:1,height:Ue}),Uo.copy(ae.data,W,{x:0,y:0},{x:me+Me,y:Ce},{width:1,height:Ue})}this.image=W,this.iconPositions=_,this.patternPositions=S}addImages(c,d,_){for(const S in c){const M=c[S],k={x:0,y:0,w:M.data.width+2*wl,h:M.data.height+2*wl};_.push(k),d[S]=new Sm(k,M),M.hasRenderCallback&&this.haveRenderCallbacks.push(S)}}patchUpdatedImages(c,d){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const _ in c.updatedImages)this.patchUpdatedImage(this.iconPositions[_],c.getImage(_),d),this.patchUpdatedImage(this.patternPositions[_],c.getImage(_),d)}patchUpdatedImage(c,d,_){if(!c||!d||c.version===d.version)return;c.version=d.version;const[S,M]=c.tl;_.update(d.data,void 0,{x:S,y:M})}}var fA;Ui("ImagePosition",Sm),Ui("ImageAtlas",t_),s.ai=void 0,(fA=s.ai||(s.ai={}))[fA.none=0]="none",fA[fA.horizontal=1]="horizontal",fA[fA.vertical=2]="vertical",fA[fA.horizontalOnly=3]="horizontalOnly";const Wd=-17;class Zd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,d){const _=new Zd;return _.scale=c||1,_.fontStack=d,_}static forImage(c){const d=new Zd;return d.imageName=c,d}}class pA{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,d){const _=new pA;for(let S=0;S<c.sections.length;S++){const M=c.sections[S];M.image?_.addImageSection(M):_.addTextSection(M,d)}return _}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let d="";for(let _=0;_<c.length;_++){const S=c.charCodeAt(_+1)||null,M=c.charCodeAt(_-1)||null;d+=S&&zc(S)&&!Bc[c[_+1]]||M&&zc(M)&&!Bc[c[_-1]]||!Bc[c[_]]?c[_]:Bc[c[_]]}return d}(this.text)}trim(){let c=0;for(let _=0;_<this.text.length&&Tm[this.text.charCodeAt(_)];_++)c++;let d=this.text.length;for(let _=this.text.length-1;_>=0&&_>=c&&Tm[this.text.charCodeAt(_)];_--)d--;this.text=this.text.substring(c,d),this.sectionIndex=this.sectionIndex.slice(c,d)}substring(c,d){const _=new pA;return _.text=this.text.substring(c,d),_.sectionIndex=this.sectionIndex.slice(c,d),_.sections=this.sections,_}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,d)=>Math.max(c,this.sections[d].scale),0)}addTextSection(c,d){this.text+=c.text,this.sections.push(Zd.forText(c.scale,c.fontStack||d));const _=this.sections.length-1;for(let S=0;S<c.text.length;++S)this.sectionIndex.push(_)}addImageSection(c){const d=c.image?c.image.name:"";if(d.length===0)return void Ze("Can't add FormattedSection with an empty image.");const _=this.getNextImageSectionCharCode();_?(this.text+=String.fromCharCode(_),this.sections.push(Zd.forImage(d)),this.sectionIndex.push(this.sections.length-1)):Ze("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xd(h,c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue){const $e=pA.fromFeature(h,S);let Ke;fe===s.ai.vertical&&$e.verticalizePunctuation();const{processBidirectionalText:ut,processStyledBidirectionalText:tt}=to;if(ut&&$e.sections.length===1){Ke=[];const St=ut($e.toString(),bp($e,Y,M,c,_,Ce,Me));for(const Jt of St){const wi=new pA;wi.text=Jt,wi.sections=$e.sections;for(let ai=0;ai<Jt.length;ai++)wi.sectionIndex.push(0);Ke.push(wi)}}else if(tt){Ke=[];const St=tt($e.text,$e.sectionIndex,bp($e,Y,M,c,_,Ce,Me));for(const Jt of St){const wi=new pA;wi.text=Jt[0],wi.sectionIndex=Jt[1],wi.sections=$e.sections,Ke.push(wi)}}else Ke=function(St,Jt){const wi=[],ai=St.text;let fi=0;for(const yi of Jt)wi.push(St.substring(fi,yi)),fi=yi;return fi<ai.length&&wi.push(St.substring(fi,ai.length)),wi}($e,bp($e,Y,M,c,_,Ce,Me));const rt=[],yt={positionedLines:rt,text:$e.toString(),top:ae[1],bottom:ae[1],left:ae[0],right:ae[0],writingMode:fe,iconsInText:!1,verticalizable:!1};return function(St,Jt,wi,ai,fi,yi,Ri,li,Yt,Gi,Qi,yr){let Qr=0,qr=Wd,gn=0,as=0;const zn=li==="right"?1:li==="left"?0:.5;let xn=0;for(const An of fi){An.trim();const tn=An.getMaxScale(),fs=(tn-1)*Cs,Es={positionedGlyphs:[],lineOffset:0};St.positionedLines[xn]=Es;const vs=Es.positionedGlyphs;let no=0;if(!An.length()){qr+=yi,++xn;continue}for(let kn=0;kn<An.length();kn++){const Er=An.getSection(kn),Ns=An.getSectionIndex(kn),ho=An.getCharCode(kn);let Ao=0,oc=null,Cc=null,na=null,Zu=Cs;const Ec=!(Yt===s.ai.horizontal||!Qi&&!eo(ho)||Qi&&(Tm[ho]||(Rn=ho,Li.Arabic(Rn)||Li["Arabic Supplement"](Rn)||Li["Arabic Extended-A"](Rn)||Li["Arabic Presentation Forms-A"](Rn)||Li["Arabic Presentation Forms-B"](Rn))));if(Er.imageName){const Sc=ai[Er.imageName];if(!Sc)continue;na=Er.imageName,St.iconsInText=St.iconsInText||!0,Cc=Sc.paddedRect;const Bl=Sc.displaySize;Er.scale=Er.scale*Cs/yr,oc={width:Bl[0],height:Bl[1],left:wl,top:-_p,advance:Ec?Bl[1]:Bl[0]},Ao=fs+(Cs-Bl[1]*Er.scale),Zu=oc.advance;const Ph=Ec?Bl[0]*Er.scale-Cs*tn:Bl[1]*Er.scale-Cs*tn;Ph>0&&Ph>no&&(no=Ph)}else{const Sc=wi[Er.fontStack],Bl=Sc&&Sc[ho];if(Bl&&Bl.rect)Cc=Bl.rect,oc=Bl.metrics;else{const Ph=Jt[Er.fontStack],kp=Ph&&Ph[ho];if(!kp)continue;oc=kp.metrics}Ao=(tn-Er.scale)*Cs}Ec?(St.verticalizable=!0,vs.push({glyph:ho,imageName:na,x:Qr,y:qr+Ao,vertical:Ec,scale:Er.scale,fontStack:Er.fontStack,sectionIndex:Ns,metrics:oc,rect:Cc}),Qr+=Zu*Er.scale+Gi):(vs.push({glyph:ho,imageName:na,x:Qr,y:qr+Ao,vertical:Ec,scale:Er.scale,fontStack:Er.fontStack,sectionIndex:Ns,metrics:oc,rect:Cc}),Qr+=oc.advance*Er.scale+Gi)}vs.length!==0&&(gn=Math.max(Qr-Gi,gn),FI(vs,0,vs.length-1,zn,no)),Qr=0;const Ss=yi*tn+no;Es.lineOffset=Math.max(no,fs),qr+=Ss,as=Math.max(Ss,as),++xn}var Rn;const hn=qr-Wd,{horizontalAlign:wr,verticalAlign:Qn}=n_(Ri);(function(An,tn,fs,Es,vs,no,Ss,kn,Er){const Ns=(tn-fs)*vs;let ho=0;ho=no!==Ss?-kn*Es-Wd:(-Es*Er+.5)*Ss;for(const Ao of An)for(const oc of Ao.positionedGlyphs)oc.x+=Ns,oc.y+=ho})(St.positionedLines,zn,wr,Qn,gn,as,yi,hn,fi.length),St.top+=-Qn*hn,St.bottom=St.top+hn,St.left+=-wr*gn,St.right=St.left+gn}(yt,c,d,_,Ke,k,G,W,fe,Y,me,Ue),!function(St){for(const Jt of St)if(Jt.positionedGlyphs.length!==0)return!1;return!0}(rt)&&yt}const Tm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},PI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function i_(h,c,d,_,S,M){if(c.imageName){const k=_[c.imageName];return k?k.displaySize[0]*c.scale*Cs/M+S:0}{const k=d[c.fontStack],G=k&&k[h];return G?G.metrics.advance*c.scale+S:0}}function Jd(h,c,d,_){const S=Math.pow(h-c,2);return _?h<c?S/2:2*S:S+Math.abs(d)*d}function qu(h,c,d){let _=0;return h===10&&(_-=1e4),d&&(_+=150),h!==40&&h!==65288||(_+=50),c!==41&&c!==65289||(_+=50),_}function Ih(h,c,d,_,S,M){let k=null,G=Jd(c,d,S,M);for(const W of _){const Y=Jd(c-W.x,d,S,M)+W.badness;Y<=G&&(k=W,G=Y)}return{index:h,x:c,priorBreak:k,badness:G}}function r_(h){return h?r_(h.priorBreak).concat(h.index):[]}function bp(h,c,d,_,S,M,k){if(M!=="point")return[];if(!h)return[];const G=[],W=function(me,Ce,Me,Ue,$e,Ke){let ut=0;for(let tt=0;tt<me.length();tt++){const rt=me.getSection(tt);ut+=i_(me.getCharCode(tt),rt,Ue,$e,Ce,Ke)}return ut/Math.max(1,Math.ceil(ut/Me))}(h,c,d,_,S,k),Y=h.text.indexOf("​")>=0;let ae=0;for(let me=0;me<h.length();me++){const Ce=h.getSection(me),Me=h.getCharCode(me);if(Tm[Me]||(ae+=i_(Me,Ce,_,S,c,k)),me<h.length()-1){const Ue=!((fe=Me)<11904||!(Li["Bopomofo Extended"](fe)||Li.Bopomofo(fe)||Li["CJK Compatibility Forms"](fe)||Li["CJK Compatibility Ideographs"](fe)||Li["CJK Compatibility"](fe)||Li["CJK Radicals Supplement"](fe)||Li["CJK Strokes"](fe)||Li["CJK Symbols and Punctuation"](fe)||Li["CJK Unified Ideographs Extension A"](fe)||Li["CJK Unified Ideographs"](fe)||Li["Enclosed CJK Letters and Months"](fe)||Li["Halfwidth and Fullwidth Forms"](fe)||Li.Hiragana(fe)||Li["Ideographic Description Characters"](fe)||Li["Kangxi Radicals"](fe)||Li["Katakana Phonetic Extensions"](fe)||Li.Katakana(fe)||Li["Vertical Forms"](fe)||Li["Yi Radicals"](fe)||Li["Yi Syllables"](fe)));(PI[Me]||Ue||Ce.imageName)&&G.push(Ih(me+1,ae,W,G,qu(Me,h.getCharCode(me+1),Ue&&Y),!1))}}var fe;return r_(Ih(h.length(),ae,W,G,0,!0))}function n_(h){let c=.5,d=.5;switch(h){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:c,verticalAlign:d}}function FI(h,c,d,_,S){if(!_&&!S)return;const M=h[d],k=(h[d].x+M.metrics.advance*M.scale)*_;for(let G=c;G<=d;G++)h[G].x-=k,h[G].y+=S}function Im(h,c,d){const{horizontalAlign:_,verticalAlign:S}=n_(d),M=c[0]-h.displaySize[0]*_,k=c[1]-h.displaySize[1]*S;return{image:h,top:k,bottom:k+h.displaySize[1],left:M,right:M+h.displaySize[0]}}function Lm(h,c,d,_,S,M){const k=h.image;let G;if(k.content){const $e=k.content,Ke=k.pixelRatio||1;G=[$e[0]/Ke,$e[1]/Ke,k.displaySize[0]-$e[2]/Ke,k.displaySize[1]-$e[3]/Ke]}const W=c.left*M,Y=c.right*M;let ae,fe,me,Ce;d==="width"||d==="both"?(Ce=S[0]+W-_[3],fe=S[0]+Y+_[1]):(Ce=S[0]+(W+Y-k.displaySize[0])/2,fe=Ce+k.displaySize[0]);const Me=c.top*M,Ue=c.bottom*M;return d==="height"||d==="both"?(ae=S[1]+Me-_[0],me=S[1]+Ue+_[2]):(ae=S[1]+(Me+Ue-k.displaySize[1])/2,me=ae+k.displaySize[1]),{image:k,top:ae,right:fe,bottom:me,left:Ce,collisionPadding:G}}const xp=255,Wc=128,$u=xp*Wc;function ZA(h,c){const{expression:d}=c;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new Ei(h+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:_,interpolationType:S}=d;let M=0;for(;M<_.length&&_[M]<=h;)M++;M=Math.max(0,M-1);let k=M;for(;k<_.length&&_[k]<h+1;)k++;k=Math.min(_.length-1,k);const G=_[M],W=_[k];return d.kind==="composite"?{kind:"composite",minZoom:G,maxZoom:W,interpolationType:S}:{kind:"camera",minZoom:G,maxZoom:W,minSize:d.evaluate(new Ei(G)),maxSize:d.evaluate(new Ei(W)),interpolationType:S}}}function Mm(h,c,d){let _="never";const S=h.get(c);return S?_=S:h.get(d)&&(_="always"),_}const Rx=AA.VectorTileFeature.types,s_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wp(h,c,d,_,S,M,k,G,W,Y,ae,fe,me){const Ce=G?Math.min($u,Math.round(G[0])):0,Me=G?Math.min($u,Math.round(G[1])):0;h.emplaceBack(c,d,Math.round(32*_),Math.round(32*S),M,k,(Ce<<1)+(W?1:0),Me,16*Y,16*ae,256*fe,256*me)}function Yd(h,c,d){h.emplaceBack(c.x,c.y,d),h.emplaceBack(c.x,c.y,d),h.emplaceBack(c.x,c.y,d),h.emplaceBack(c.x,c.y,d)}function kx(h){for(const c of h.sections)if(Qc(c.text))return!0;return!1}class o_{constructor(c){this.layoutVertexArray=new dt,this.indexArray=new Ht,this.programConfigurations=c,this.segments=new ui,this.dynamicLayoutVertexArray=new ft,this.opacityVertexArray=new Nt,this.hasVisibleVertices=!1,this.placedSymbolArray=new V}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,d,_,S){this.isEmpty()||(_&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Bx.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,Cx.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,s_,!0),this.opacityVertexBuffer.itemSize=1),(_||S)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ui("SymbolBuffers",o_);class a_{constructor(c,d,_){this.layoutVertexArray=new c,this.layoutAttributes=d,this.indexArray=new _,this.segments=new ui,this.collisionVertexArray=new jt}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Zn.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ui("CollisionBuffers",a_);class XA{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(k=>k.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ud([]),this.placementViewportMatrix=Ud([]);const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ZA(this.zoom,d["text-size"]),this.iconSizeData=ZA(this.zoom,d["icon-size"]);const _=this.layers[0].layout,S=_.get("symbol-sort-key"),M=_.get("symbol-z-order");this.canOverlap=Mm(_,"text-overlap","text-allow-overlap")!=="never"||Mm(_,"icon-overlap","icon-allow-overlap")!=="never"||_.get("text-ignore-placement")||_.get("icon-ignore-placement"),this.sortFeaturesByKey=M!=="viewport-y"&&!S.isConstant(),this.sortFeaturesByY=(M==="viewport-y"||M==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,_.get("symbol-placement")==="point"&&(this.writingModes=_.get("text-writing-mode").map(k=>s.ai[k])),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.sourceID=c.sourceID}createArrays(){this.text=new o_(new _o(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new o_(new _o(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new ee,this.lineVertexArray=new se,this.symbolInstances=new K,this.textAnchorOffsets=new le}calculateGlyphDependencies(c,d,_,S,M){for(let k=0;k<c.length;k++)if(d[c.charCodeAt(k)]=!0,(_||S)&&M){const G=Bc[c.charAt(k)];G&&(d[G.charCodeAt(0)]=!0)}}populate(c,d,_){const S=this.layers[0],M=S.layout,k=M.get("text-font"),G=M.get("text-field"),W=M.get("icon-image"),Y=(G.value.kind!=="constant"||G.value.value instanceof Or&&!G.value.value.isEmpty()||G.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),ae=W.value.kind!=="constant"||!!W.value.value||Object.keys(W.parameters).length>0,fe=M.get("symbol-sort-key");if(this.features=[],!Y&&!ae)return;const me=d.iconDependencies,Ce=d.glyphDependencies,Me=d.availableImages,Ue=new Ei(this.zoom);for(const{feature:$e,id:Ke,index:ut,sourceLayerIndex:tt}of c){const rt=S._featureFilter.needGeometry,yt=rl($e,rt);if(!S._featureFilter.filter(Ue,yt,_))continue;let St,Jt;if(rt||(yt.geometry=_l($e)),Y){const ai=S.getValueAndResolveTokens("text-field",yt,_,Me),fi=Or.factory(ai);kx(fi)&&(this.hasRTLText=!0),(!this.hasRTLText||Nu()==="unavailable"||this.hasRTLText&&to.isParsed())&&(St=Sx(fi,S,yt))}if(ae){const ai=S.getValueAndResolveTokens("icon-image",yt,_,Me);Jt=ai instanceof Zi?ai:Zi.fromString(ai)}if(!St&&!Jt)continue;const wi=this.sortFeaturesByKey?fe.evaluate(yt,{},_):void 0;if(this.features.push({id:Ke,text:St,icon:Jt,index:ut,sourceLayerIndex:tt,geometry:yt.geometry,properties:$e.properties,type:Rx[$e.type],sortKey:wi}),Jt&&(me[Jt.name]=!0),St){const ai=k.evaluate(yt,{},_).join(","),fi=M.get("text-rotation-alignment")!=="viewport"&&M.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const yi of St.sections)if(yi.image)me[yi.image.name]=!0;else{const Ri=bc(St.toString()),li=yi.fontStack||ai,Yt=Ce[li]=Ce[li]||{};this.calculateGlyphDependencies(yi.text,Yt,fi,this.allowVerticalPlacement,Ri)}}}M.get("symbol-placement")==="line"&&(this.features=function($e){const Ke={},ut={},tt=[];let rt=0;function yt(ai){tt.push($e[ai]),rt++}function St(ai,fi,yi){const Ri=ut[ai];return delete ut[ai],ut[fi]=Ri,tt[Ri].geometry[0].pop(),tt[Ri].geometry[0]=tt[Ri].geometry[0].concat(yi[0]),Ri}function Jt(ai,fi,yi){const Ri=Ke[fi];return delete Ke[fi],Ke[ai]=Ri,tt[Ri].geometry[0].shift(),tt[Ri].geometry[0]=yi[0].concat(tt[Ri].geometry[0]),Ri}function wi(ai,fi,yi){const Ri=yi?fi[0][fi[0].length-1]:fi[0][0];return`${ai}:${Ri.x}:${Ri.y}`}for(let ai=0;ai<$e.length;ai++){const fi=$e[ai],yi=fi.geometry,Ri=fi.text?fi.text.toString():null;if(!Ri){yt(ai);continue}const li=wi(Ri,yi),Yt=wi(Ri,yi,!0);if(li in ut&&Yt in Ke&&ut[li]!==Ke[Yt]){const Gi=Jt(li,Yt,yi),Qi=St(li,Yt,tt[Gi].geometry);delete Ke[li],delete ut[Yt],ut[wi(Ri,tt[Qi].geometry,!0)]=Qi,tt[Gi].geometry=null}else li in ut?St(li,Yt,yi):Yt in Ke?Jt(li,Yt,yi):(yt(ai),Ke[li]=rt-1,ut[Yt]=rt-1)}return tt.filter(ai=>ai.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($e,Ke)=>$e.sortKey-Ke.sortKey)}update(c,d,_){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,d,this.layers,_),this.icon.programConfigurations.updatePaintArrays(c,d,this.layers,_))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,d){const _=this.lineVertexArray.length;if(c.segment!==void 0){let S=c.dist(d[c.segment+1]),M=c.dist(d[c.segment]);const k={};for(let G=c.segment+1;G<d.length;G++)k[G]={x:d[G].x,y:d[G].y,tileUnitDistanceFromAnchor:S},G<d.length-1&&(S+=d[G+1].dist(d[G]));for(let G=c.segment||0;G>=0;G--)k[G]={x:d[G].x,y:d[G].y,tileUnitDistanceFromAnchor:M},G>0&&(M+=d[G-1].dist(d[G]));for(let G=0;G<d.length;G++){const W=k[G];this.lineVertexArray.emplaceBack(W.x,W.y,W.tileUnitDistanceFromAnchor)}}return{lineStartIndex:_,lineLength:this.lineVertexArray.length-_}}addSymbols(c,d,_,S,M,k,G,W,Y,ae,fe,me){const Ce=c.indexArray,Me=c.layoutVertexArray,Ue=c.segments.prepareSegment(4*d.length,Me,Ce,this.canOverlap?k.sortKey:void 0),$e=this.glyphOffsetArray.length,Ke=Ue.vertexLength,ut=this.allowVerticalPlacement&&G===s.ai.vertical?Math.PI/2:0,tt=k.text&&k.text.sections;for(let rt=0;rt<d.length;rt++){const{tl:yt,tr:St,bl:Jt,br:wi,tex:ai,pixelOffsetTL:fi,pixelOffsetBR:yi,minFontScaleX:Ri,minFontScaleY:li,glyphOffset:Yt,isSDF:Gi,sectionIndex:Qi}=d[rt],yr=Ue.vertexLength,Qr=Yt[1];wp(Me,W.x,W.y,yt.x,Qr+yt.y,ai.x,ai.y,_,Gi,fi.x,fi.y,Ri,li),wp(Me,W.x,W.y,St.x,Qr+St.y,ai.x+ai.w,ai.y,_,Gi,yi.x,fi.y,Ri,li),wp(Me,W.x,W.y,Jt.x,Qr+Jt.y,ai.x,ai.y+ai.h,_,Gi,fi.x,yi.y,Ri,li),wp(Me,W.x,W.y,wi.x,Qr+wi.y,ai.x+ai.w,ai.y+ai.h,_,Gi,yi.x,yi.y,Ri,li),Yd(c.dynamicLayoutVertexArray,W,ut),Ce.emplaceBack(yr,yr+1,yr+2),Ce.emplaceBack(yr+1,yr+2,yr+3),Ue.vertexLength+=4,Ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yt[0]),rt!==d.length-1&&Qi===d[rt+1].sectionIndex||c.programConfigurations.populatePaintArrays(Me.length,k,k.index,{},me,tt&&tt[Qi])}c.placedSymbolArray.emplaceBack(W.x,W.y,$e,this.glyphOffsetArray.length-$e,Ke,Y,ae,W.segment,_?_[0]:0,_?_[1]:0,S[0],S[1],G,0,!1,0,fe)}_addCollisionDebugVertex(c,d,_,S,M,k){return d.emplaceBack(0,0),c.emplaceBack(_.x,_.y,S,M,Math.round(k.x),Math.round(k.y))}addCollisionDebugVertices(c,d,_,S,M,k,G){const W=M.segments.prepareSegment(4,M.layoutVertexArray,M.indexArray),Y=W.vertexLength,ae=M.layoutVertexArray,fe=M.collisionVertexArray,me=G.anchorX,Ce=G.anchorY;this._addCollisionDebugVertex(ae,fe,k,me,Ce,new R(c,d)),this._addCollisionDebugVertex(ae,fe,k,me,Ce,new R(_,d)),this._addCollisionDebugVertex(ae,fe,k,me,Ce,new R(_,S)),this._addCollisionDebugVertex(ae,fe,k,me,Ce,new R(c,S)),W.vertexLength+=4;const Me=M.indexArray;Me.emplaceBack(Y,Y+1),Me.emplaceBack(Y+1,Y+2),Me.emplaceBack(Y+2,Y+3),Me.emplaceBack(Y+3,Y),W.primitiveLength+=4}addDebugCollisionBoxes(c,d,_,S){for(let M=c;M<d;M++){const k=this.collisionBoxArray.get(M);this.addCollisionDebugVertices(k.x1,k.y1,k.x2,k.y2,S?this.textCollisionBox:this.iconCollisionBox,k.anchorPoint,_)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new a_(It,wm.members,Mi),this.iconCollisionBox=new a_(It,wm.members,Mi);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(c,d,_,S,M,k,G,W,Y){const ae={};for(let fe=d;fe<_;fe++){const me=c.get(fe);ae.textBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ae.textFeatureIndex=me.featureIndex;break}for(let fe=S;fe<M;fe++){const me=c.get(fe);ae.verticalTextBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ae.verticalTextFeatureIndex=me.featureIndex;break}for(let fe=k;fe<G;fe++){const me=c.get(fe);ae.iconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ae.iconFeatureIndex=me.featureIndex;break}for(let fe=W;fe<Y;fe++){const me=c.get(fe);ae.verticalIconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ae.verticalIconFeatureIndex=me.featureIndex;break}return ae}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const _=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,_.textBoxStartIndex,_.textBoxEndIndex,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_.iconBoxStartIndex,_.iconBoxEndIndex,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,d){const _=c.placedSymbolArray.get(d),S=_.vertexStartIndex+4*_.numGlyphs;for(let M=_.vertexStartIndex;M<S;M+=4)c.indexArray.emplaceBack(M,M+1,M+2),c.indexArray.emplaceBack(M+1,M+2,M+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(c),_=Math.cos(c),S=[],M=[],k=[];for(let G=0;G<this.symbolInstances.length;++G){k.push(G);const W=this.symbolInstances.get(G);S.push(0|Math.round(d*W.anchorX+_*W.anchorY)),M.push(W.featureIndex)}return k.sort((G,W)=>S[G]-S[W]||M[W]-M[G]),k}addToSortKeyRanges(c,d){const _=this.sortKeyRanges[this.sortKeyRanges.length-1];_&&_.sortKey===d?_.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const _=this.symbolInstances.get(d);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach((S,M,k)=>{S>=0&&k.indexOf(S)===M&&this.addIndicesForPlacedSymbol(this.text,S)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ox,Ux;Ui("SymbolBucket",XA,{omit:["layers","collisionBoxArray","features","compareText"]}),XA.MAX_GLYPHS=65535,XA.addDynamicAttributes=Yd;var l_={get paint(){return Ux=Ux||new sn({"icon-opacity":new zi(ht.paint_symbol["icon-opacity"]),"icon-color":new zi(ht.paint_symbol["icon-color"]),"icon-halo-color":new zi(ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new zi(ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zi(ht.paint_symbol["icon-halo-blur"]),"icon-translate":new $i(ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new $i(ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new zi(ht.paint_symbol["text-opacity"]),"text-color":new zi(ht.paint_symbol["text-color"],{runtimeType:_r,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new zi(ht.paint_symbol["text-halo-color"]),"text-halo-width":new zi(ht.paint_symbol["text-halo-width"]),"text-halo-blur":new zi(ht.paint_symbol["text-halo-blur"]),"text-translate":new $i(ht.paint_symbol["text-translate"]),"text-translate-anchor":new $i(ht.paint_symbol["text-translate-anchor"])})},get layout(){return Ox=Ox||new sn({"symbol-placement":new $i(ht.layout_symbol["symbol-placement"]),"symbol-spacing":new $i(ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $i(ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zi(ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $i(ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $i(ht.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $i(ht.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $i(ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new $i(ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $i(ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new zi(ht.layout_symbol["icon-size"]),"icon-text-fit":new $i(ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $i(ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new zi(ht.layout_symbol["icon-image"]),"icon-rotate":new zi(ht.layout_symbol["icon-rotate"]),"icon-padding":new zi(ht.layout_symbol["icon-padding"]),"icon-keep-upright":new $i(ht.layout_symbol["icon-keep-upright"]),"icon-offset":new zi(ht.layout_symbol["icon-offset"]),"icon-anchor":new zi(ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $i(ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $i(ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $i(ht.layout_symbol["text-rotation-alignment"]),"text-field":new zi(ht.layout_symbol["text-field"]),"text-font":new zi(ht.layout_symbol["text-font"]),"text-size":new zi(ht.layout_symbol["text-size"]),"text-max-width":new zi(ht.layout_symbol["text-max-width"]),"text-line-height":new $i(ht.layout_symbol["text-line-height"]),"text-letter-spacing":new zi(ht.layout_symbol["text-letter-spacing"]),"text-justify":new zi(ht.layout_symbol["text-justify"]),"text-radial-offset":new zi(ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $i(ht.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new zi(ht.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new zi(ht.layout_symbol["text-anchor"]),"text-max-angle":new $i(ht.layout_symbol["text-max-angle"]),"text-writing-mode":new $i(ht.layout_symbol["text-writing-mode"]),"text-rotate":new zi(ht.layout_symbol["text-rotate"]),"text-padding":new $i(ht.layout_symbol["text-padding"]),"text-keep-upright":new $i(ht.layout_symbol["text-keep-upright"]),"text-transform":new zi(ht.layout_symbol["text-transform"]),"text-offset":new zi(ht.layout_symbol["text-offset"]),"text-allow-overlap":new $i(ht.layout_symbol["text-allow-overlap"]),"text-overlap":new $i(ht.layout_symbol["text-overlap"]),"text-ignore-placement":new $i(ht.layout_symbol["text-ignore-placement"]),"text-optional":new $i(ht.layout_symbol["text-optional"])})}};class Nx{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:Ii,this.defaultValue=c}evaluate(c){if(c.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(c.formattedSection))return d.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ui("FormatSectionOverride",Nx,{omit:["defaultValue"]});class ef extends Ro{constructor(c){super(c,l_)}recalculate(c,d){if(super.recalculate(c,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const _=this.layout.get("text-writing-mode");if(_){const S=[];for(const M of _)S.indexOf(M)<0&&S.push(M);this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,d,_,S){const M=this.layout.get(c).evaluate(d,{},_,S),k=this._unevaluatedLayout._values[c];return k.isDataDriven()||Pn(k.value)||!M?M:function(G,W){return W.replace(/{([^{}]+)}/g,(Y,ae)=>G&&ae in G?String(G[ae]):"")}(d.properties,M)}createBucket(c){return new XA(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of l_.paint.overridableProperties){if(!ef.hasPaintOverride(this.layout,c))continue;const d=this.paint.get(c),_=new Nx(d),S=new or(_,d.property.specification);let M=null;M=d.value.kind==="constant"||d.value.kind==="source"?new Ir("source",S):new Ps("composite",S,d.value.zoomStops),this.paint._values[c]=new $n(d.property,M,d.parameters)}}_handleOverridablePaintPropertyUpdate(c,d,_){return!(!this.layout||d.isDataDriven()||_.isDataDriven())&&ef.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,d){const _=c.get("text-field"),S=l_.paint.properties[d];let M=!1;const k=G=>{for(const W of G)if(S.overrides&&S.overrides.hasOverride(W))return void(M=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Or)k(_.value.value.sections);else if(_.value.kind==="source"){const G=Y=>{M||(Y instanceof rs&&vr(Y.value)===ce?k(Y.value.sections):Y instanceof Ja?k(Y.sections):Y.eachChild(G))},W=_.value;W._styleExpression&&G(W._styleExpression.expression)}return M}}let Lh;var zx={get paint(){return Lh=Lh||new sn({"background-color":new $i(ht.paint_background["background-color"]),"background-pattern":new zu(ht.paint_background["background-pattern"]),"background-opacity":new $i(ht.paint_background["background-opacity"])})}};class Qx extends Ro{constructor(c){super(c,zx)}}let c_;var Vx={get paint(){return c_=c_||new sn({"raster-opacity":new $i(ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new $i(ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $i(ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $i(ht.paint_raster["raster-brightness-max"]),"raster-saturation":new $i(ht.paint_raster["raster-saturation"]),"raster-contrast":new $i(ht.paint_raster["raster-contrast"]),"raster-resampling":new $i(ht.paint_raster["raster-resampling"]),"raster-fade-duration":new $i(ht.paint_raster["raster-fade-duration"])})}};class Hx extends Ro{constructor(c){super(c,Vx)}}class u_ extends Ro{constructor(c){super(c,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Pm{constructor(c){this._callback=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Fm=63710088e-1;class Ku{constructor(c,d){if(isNaN(c)||isNaN(d))throw new Error(`Invalid LngLat object: (${c}, ${d})`);if(this.lng=+c,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ku(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const d=Math.PI/180,_=this.lat*d,S=c.lat*d,M=Math.sin(_)*Math.sin(S)+Math.cos(_)*Math.cos(S)*Math.cos((c.lng-this.lng)*d);return Fm*Math.acos(Math.min(M,1))}static convert(c){if(c instanceof Ku)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new Ku(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new Ku(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const h_=2*Math.PI*Fm;function sc(h){return h_*Math.cos(h*Math.PI/180)}function tf(h){return(180+h)/360}function A_(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function d_(h,c){return h/sc(c)}function f_(h){return 360*h-180}function Dm(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}class Bp{constructor(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+c,this.y=+d,this.z=+_}static fromLngLat(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const _=Ku.convert(c);return new Bp(tf(_.lng),A_(_.lat),d_(d,_.lat))}toLngLat(){return new Ku(f_(this.x),Dm(this.y))}toAltitude(){return this.z*sc(Dm(this.y))}meterInMercatorCoordinateUnits(){return 1/h_*(c=Dm(this.y),1/Math.cos(c*Math.PI/180));var c}}function p_(h,c,d){var _=2*Math.PI*6378137/256/Math.pow(2,d);return[h*_-2*Math.PI*6378137/2,c*_-2*Math.PI*6378137/2]}class g_{constructor(c,d,_){if(c<0||c>25||_<0||_>=Math.pow(2,c)||d<0||d>=Math.pow(2,c))throw new Error(`x=${d}, y=${_}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=d,this.y=_,this.key=rf(0,c,c,d,_)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,d,_){const S=(k=this.y,G=this.z,W=p_(256*(M=this.x),256*(k=Math.pow(2,G)-k-1),G),Y=p_(256*(M+1),256*(k+1),G),W[0]+","+W[1]+","+Y[0]+","+Y[1]);var M,k,G,W,Y;const ae=function(fe,me,Ce){let Me,Ue="";for(let $e=fe;$e>0;$e--)Me=1<<$e-1,Ue+=(me&Me?1:0)+(Ce&Me?2:0);return Ue}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(_==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,ae).replace(/{bbox-epsg-3857}/g,S)}isChildOf(c){const d=this.z-c.z;return d>0&&c.x===this.x>>d&&c.y===this.y>>d}getTilePoint(c){const d=Math.pow(2,this.z);return new R((c.x*d-this.x)*Dn,(c.y*d-this.y)*Dn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class m_{constructor(c,d){this.wrap=c,this.canonical=d,this.key=rf(c,d.z,d.z,d.x,d.y)}}class zo{constructor(c,d,_,S,M){if(c<_)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${_}`);this.overscaledZ=c,this.wrap=d,this.canonical=new g_(_,+S,+M),this.key=rf(d,c,_,S,M)}clone(){return new zo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-c;return c>this.canonical.z?new zo(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zo(c,this.wrap,c,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(c,d){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const _=this.canonical.z-c;return c>this.canonical.z?rf(this.wrap*+d,c,this.canonical.z,this.canonical.x,this.canonical.y):rf(this.wrap*+d,c,c,this.canonical.x>>_,this.canonical.y>>_)}isChildOf(c){if(c.wrap!==this.wrap)return!1;const d=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>d&&c.canonical.y===this.canonical.y>>d}children(c){if(this.overscaledZ>=c)return[new zo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,_=2*this.canonical.x,S=2*this.canonical.y;return[new zo(d,this.wrap,d,_,S),new zo(d,this.wrap,d,_+1,S),new zo(d,this.wrap,d,_,S+1),new zo(d,this.wrap,d,_+1,S+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new zo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new zo(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new m_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new Bp(c.x-this.wrap,c.y))}}function rf(h,c,d,_,S){(h*=2)<0&&(h=-1*h-1);const M=1<<d;return(M*M*h+M*S+_).toString(36)+d.toString(36)+c.toString(36)}Ui("CanonicalTileID",g_),Ui("OverscaledTileID",zo,{omit:["posMatrix"]});class y_{constructor(c,d,_){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,k=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,G=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=c,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(_&&!["mapbox","terrarium","custom"].includes(_))return void Ze(`"${_}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=d.height;const W=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),_){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=S,this.greenFactor=M,this.blueFactor=k,this.baseShift=G;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let Y=0;Y<W;Y++)this.data[this._idx(-1,Y)]=this.data[this._idx(0,Y)],this.data[this._idx(W,Y)]=this.data[this._idx(W-1,Y)],this.data[this._idx(Y,-1)]=this.data[this._idx(Y,0)],this.data[this._idx(Y,W)]=this.data[this._idx(Y,W-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(W,-1)]=this.data[this._idx(W-1,0)],this.data[this._idx(-1,W)]=this.data[this._idx(0,W-1)],this.data[this._idx(W,W)]=this.data[this._idx(W-1,W-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Y=0;Y<W;Y++)for(let ae=0;ae<W;ae++){const fe=this.get(Y,ae);fe>this.max&&(this.max=fe),fe<this.min&&(this.min=fe)}}get(c,d){const _=new Uint8Array(this.data.buffer),S=4*this._idx(c,d);return this.unpack(_[S],_[S+1],_[S+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,d){if(c<-1||c>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(c+1)}unpack(c,d,_){return c*this.redFactor+d*this.greenFactor+_*this.blueFactor-this.baseShift}getPixels(){return new Uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,d,_){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let S=d*this.dim,M=d*this.dim+this.dim,k=_*this.dim,G=_*this.dim+this.dim;switch(d){case-1:S=M-1;break;case 1:M=S+1}switch(_){case-1:k=G-1;break;case 1:G=k+1}const W=-d*this.dim,Y=-_*this.dim;for(let ae=k;ae<G;ae++)for(let fe=S;fe<M;fe++)this.data[this._idx(fe,ae)]=c.data[this._idx(fe+W,ae+Y)]}}Ui("DEMData",y_);class __{constructor(c){this._stringToNumber={},this._numberToString=[];for(let d=0;d<c.length;d++){const _=c[d];this._stringToNumber[_]=d,this._numberToString[d]=_}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class v_{constructor(c,d,_,S,M){this.type="Feature",this._vectorTileFeature=c,c._z=d,c._x=_,c._y=S,this.properties=c.properties,this.id=M}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(c[d]=this[d]);return c}}class Gx{constructor(c,d){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new Jo(Dn,16,0),this.grid3D=new Jo(Dn,16,0),this.featureIndexArray=new Ie,this.promoteId=d}insert(c,d,_,S,M,k){const G=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(_,S,M);const W=k?this.grid3D:this.grid;for(let Y=0;Y<d.length;Y++){const ae=d[Y],fe=[1/0,1/0,-1/0,-1/0];for(let me=0;me<ae.length;me++){const Ce=ae[me];fe[0]=Math.min(fe[0],Ce.x),fe[1]=Math.min(fe[1],Ce.y),fe[2]=Math.max(fe[2],Ce.x),fe[3]=Math.max(fe[3],Ce.y)}fe[0]<Dn&&fe[1]<Dn&&fe[2]>=0&&fe[3]>=0&&W.insert(G,fe[0],fe[1],fe[2],fe[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new AA.VectorTile(new Em(this.rawTileData)).layers,this.sourceLayerCoder=new __(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,d,_,S){this.loadVTLayers();const M=c.params||{},k=Dn/c.tileSize/c.scale,G=hl(M.filter),W=c.queryGeometry,Y=c.queryPadding*k,ae=b_(W),fe=this.grid.query(ae.minX-Y,ae.minY-Y,ae.maxX+Y,ae.maxY+Y),me=b_(c.cameraQueryGeometry),Ce=this.grid3D.query(me.minX-Y,me.minY-Y,me.maxX+Y,me.maxY+Y,($e,Ke,ut,tt)=>function(rt,yt,St,Jt,wi){for(const fi of rt)if(yt<=fi.x&&St<=fi.y&&Jt>=fi.x&&wi>=fi.y)return!0;const ai=[new R(yt,St),new R(yt,wi),new R(Jt,wi),new R(Jt,St)];if(rt.length>2){for(const fi of ai)if(nc(rt,fi))return!0}for(let fi=0;fi<rt.length-1;fi++)if(aA(rt[fi],rt[fi+1],ai))return!0;return!1}(c.cameraQueryGeometry,$e-Y,Ke-Y,ut+Y,tt+Y));for(const $e of Ce)fe.push($e);fe.sort(nf);const Me={};let Ue;for(let $e=0;$e<fe.length;$e++){const Ke=fe[$e];if(Ke===Ue)continue;Ue=Ke;const ut=this.featureIndexArray.get(Ke);let tt=null;this.loadMatchingFeature(Me,ut.bucketIndex,ut.sourceLayerIndex,ut.featureIndex,G,M.layers,M.availableImages,d,_,S,(rt,yt,St)=>(tt||(tt=_l(rt)),yt.queryIntersectsFeature(W,rt,St,tt,this.z,c.transform,k,c.pixelPosMatrix)))}return Me}loadMatchingFeature(c,d,_,S,M,k,G,W,Y,ae,fe){const me=this.bucketLayerIDs[d];if(k&&!function($e,Ke){for(let ut=0;ut<$e.length;ut++)if(Ke.indexOf($e[ut])>=0)return!0;return!1}(k,me))return;const Ce=this.sourceLayerCoder.decode(_),Me=this.vtLayers[Ce].feature(S);if(M.needGeometry){const $e=rl(Me,!0);if(!M.filter(new Ei(this.tileID.overscaledZ),$e,this.tileID.canonical))return}else if(!M.filter(new Ei(this.tileID.overscaledZ),Me))return;const Ue=this.getId(Me,Ce);for(let $e=0;$e<me.length;$e++){const Ke=me[$e];if(k&&k.indexOf(Ke)<0)continue;const ut=W[Ke];if(!ut)continue;let tt={};Ue&&ae&&(tt=ae.getState(ut.sourceLayer||"_geojsonTileLayer",Ue));const rt=Ne({},Y[Ke]);rt.paint=jx(rt.paint,ut.paint,Me,tt,G),rt.layout=jx(rt.layout,ut.layout,Me,tt,G);const yt=!fe||fe(Me,ut,tt);if(!yt)continue;const St=new v_(Me,this.z,this.x,this.y,Ue);St.layer=rt;let Jt=c[Ke];Jt===void 0&&(Jt=c[Ke]=[]),Jt.push({featureIndex:S,feature:St,intersectionZ:yt})}}lookupSymbolFeatures(c,d,_,S,M,k,G,W){const Y={};this.loadVTLayers();const ae=hl(M);for(const fe of c)this.loadMatchingFeature(Y,_,S,fe,ae,k,G,W,d);return Y}hasLayer(c){for(const d of this.bucketLayerIDs)for(const _ of d)if(c===_)return!0;return!1}getId(c,d){let _=c.id;return this.promoteId&&(_=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof _=="boolean"&&(_=Number(_))),_}}function jx(h,c,d,_,S){return nt(h,(M,k)=>{const G=c instanceof jc?c.get(k):null;return G&&G.evaluate?G.evaluate(d,_,S):G})}function b_(h){let c=1/0,d=1/0,_=-1/0,S=-1/0;for(const M of h)c=Math.min(c,M.x),d=Math.min(d,M.y),_=Math.max(_,M.x),S=Math.max(S,M.y);return{minX:c,minY:d,maxX:_,maxY:S}}function nf(h,c){return c-h}function x_(h,c,d,_,S){const M=[];for(let k=0;k<h.length;k++){const G=h[k];let W;for(let Y=0;Y<G.length-1;Y++){let ae=G[Y],fe=G[Y+1];ae.x<c&&fe.x<c||(ae.x<c?ae=new R(c,ae.y+(c-ae.x)/(fe.x-ae.x)*(fe.y-ae.y))._round():fe.x<c&&(fe=new R(c,ae.y+(c-ae.x)/(fe.x-ae.x)*(fe.y-ae.y))._round()),ae.y<d&&fe.y<d||(ae.y<d?ae=new R(ae.x+(d-ae.y)/(fe.y-ae.y)*(fe.x-ae.x),d)._round():fe.y<d&&(fe=new R(ae.x+(d-ae.y)/(fe.y-ae.y)*(fe.x-ae.x),d)._round()),ae.x>=_&&fe.x>=_||(ae.x>=_?ae=new R(_,ae.y+(_-ae.x)/(fe.x-ae.x)*(fe.y-ae.y))._round():fe.x>=_&&(fe=new R(_,ae.y+(_-ae.x)/(fe.x-ae.x)*(fe.y-ae.y))._round()),ae.y>=S&&fe.y>=S||(ae.y>=S?ae=new R(ae.x+(S-ae.y)/(fe.y-ae.y)*(fe.x-ae.x),S)._round():fe.y>=S&&(fe=new R(ae.x+(S-ae.y)/(fe.y-ae.y)*(fe.x-ae.x),S)._round()),W&&ae.equals(W[W.length-1])||(W=[ae],M.push(W)),W.push(fe)))))}}return M}Ui("FeatureIndex",Gx,{omit:["rawTileData","sourceLayerCoder"]});class vu extends R{constructor(c,d,_,S){super(c,d),this.angle=_,S!==void 0&&(this.segment=S)}clone(){return new vu(this.x,this.y,this.angle,this.segment)}}function w_(h,c,d,_,S){if(c.segment===void 0||d===0)return!0;let M=c,k=c.segment+1,G=0;for(;G>-d/2;){if(k--,k<0)return!1;G-=h[k].dist(M),M=h[k]}G+=h[k].dist(h[k+1]),k++;const W=[];let Y=0;for(;G<d/2;){const ae=h[k],fe=h[k+1];if(!fe)return!1;let me=h[k-1].angleTo(ae)-ae.angleTo(fe);for(me=Math.abs((me+3*Math.PI)%(2*Math.PI)-Math.PI),W.push({distance:G,angleDelta:me}),Y+=me;G-W[0].distance>_;)Y-=W.shift().angleDelta;if(Y>S)return!1;k++,G+=ae.dist(fe)}return!0}function Cp(h){let c=0;for(let d=0;d<h.length-1;d++)c+=h[d].dist(h[d+1]);return c}function Ep(h,c,d){return h?.6*c*d:0}function Sp(h,c){return Math.max(h?h.right-h.left:0,c?c.right-c.left:0)}function DI(h,c,d,_,S,M){const k=Ep(d,S,M),G=Sp(d,_)*M;let W=0;const Y=Cp(h)/2;for(let ae=0;ae<h.length-1;ae++){const fe=h[ae],me=h[ae+1],Ce=fe.dist(me);if(W+Ce>Y){const Me=(Y-W)/Ce,Ue=us.number(fe.x,me.x,Me),$e=us.number(fe.y,me.y,Me),Ke=new vu(Ue,$e,me.angleTo(fe),ae);return Ke._round(),!k||w_(h,Ke,G,k,c)?Ke:void 0}W+=Ce}}function RI(h,c,d,_,S,M,k,G,W){const Y=Ep(_,M,k),ae=Sp(_,S),fe=ae*k,me=h[0].x===0||h[0].x===W||h[0].y===0||h[0].y===W;return c-fe<c/4&&(c=fe+c/4),qx(h,me?c/2*G%c:(ae/2+2*M)*k*G%c,c,Y,d,fe,me,!1,W)}function qx(h,c,d,_,S,M,k,G,W){const Y=M/2,ae=Cp(h);let fe=0,me=c-d,Ce=[];for(let Me=0;Me<h.length-1;Me++){const Ue=h[Me],$e=h[Me+1],Ke=Ue.dist($e),ut=$e.angleTo(Ue);for(;me+d<fe+Ke;){me+=d;const tt=(me-fe)/Ke,rt=us.number(Ue.x,$e.x,tt),yt=us.number(Ue.y,$e.y,tt);if(rt>=0&&rt<W&&yt>=0&&yt<W&&me-Y>=0&&me+Y<=ae){const St=new vu(rt,yt,ut,Me);St._round(),_&&!w_(h,St,M,_,S)||Ce.push(St)}}fe+=Ke}return G||Ce.length||k||(Ce=qx(h,fe/2,d,_,S,M,k,!0,W)),Ce}Ui("Anchor",vu);const sf=wl;function JA(h,c,d,_){const S=[],M=h.image,k=M.pixelRatio,G=M.paddedRect.w-2*sf,W=M.paddedRect.h-2*sf,Y=h.right-h.left,ae=h.bottom-h.top,fe=M.stretchX||[[0,G]],me=M.stretchY||[[0,W]],Ce=(yi,Ri)=>yi+Ri[1]-Ri[0],Me=fe.reduce(Ce,0),Ue=me.reduce(Ce,0),$e=G-Me,Ke=W-Ue;let ut=0,tt=Me,rt=0,yt=Ue,St=0,Jt=$e,wi=0,ai=Ke;if(M.content&&_){const yi=M.content;ut=bo(fe,0,yi[0]),rt=bo(me,0,yi[1]),tt=bo(fe,yi[0],yi[2]),yt=bo(me,yi[1],yi[3]),St=yi[0]-ut,wi=yi[1]-rt,Jt=yi[2]-yi[0]-tt,ai=yi[3]-yi[1]-yt}const fi=(yi,Ri,li,Yt)=>{const Gi=of(yi.stretch-ut,tt,Y,h.left),Qi=Tp(yi.fixed-St,Jt,yi.stretch,Me),yr=of(Ri.stretch-rt,yt,ae,h.top),Qr=Tp(Ri.fixed-wi,ai,Ri.stretch,Ue),qr=of(li.stretch-ut,tt,Y,h.left),gn=Tp(li.fixed-St,Jt,li.stretch,Me),as=of(Yt.stretch-rt,yt,ae,h.top),zn=Tp(Yt.fixed-wi,ai,Yt.stretch,Ue),xn=new R(Gi,yr),Rn=new R(qr,yr),hn=new R(qr,as),wr=new R(Gi,as),Qn=new R(Qi/k,Qr/k),An=new R(gn/k,zn/k),tn=c*Math.PI/180;if(tn){const vs=Math.sin(tn),no=Math.cos(tn),Ss=[no,-vs,vs,no];xn._matMult(Ss),Rn._matMult(Ss),wr._matMult(Ss),hn._matMult(Ss)}const fs=yi.stretch+yi.fixed,Es=Ri.stretch+Ri.fixed;return{tl:xn,tr:Rn,bl:wr,br:hn,tex:{x:M.paddedRect.x+sf+fs,y:M.paddedRect.y+sf+Es,w:li.stretch+li.fixed-fs,h:Yt.stretch+Yt.fixed-Es},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qn,pixelOffsetBR:An,minFontScaleX:Jt/k/Y,minFontScaleY:ai/k/ae,isSDF:d}};if(_&&(M.stretchX||M.stretchY)){const yi=Mh(fe,$e,Me),Ri=Mh(me,Ke,Ue);for(let li=0;li<yi.length-1;li++){const Yt=yi[li],Gi=yi[li+1];for(let Qi=0;Qi<Ri.length-1;Qi++)S.push(fi(Yt,Ri[Qi],Gi,Ri[Qi+1]))}}else S.push(fi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:G+1},{fixed:0,stretch:W+1}));return S}function bo(h,c,d){let _=0;for(const S of h)_+=Math.max(c,Math.min(d,S[1]))-Math.max(c,Math.min(d,S[0]));return _}function Mh(h,c,d){const _=[{fixed:-sf,stretch:0}];for(const[S,M]of h){const k=_[_.length-1];_.push({fixed:S-k.stretch,stretch:k.stretch}),_.push({fixed:S-k.stretch,stretch:k.stretch+(M-S)})}return _.push({fixed:c+sf,stretch:d}),_}function of(h,c,d,_){return h/c*d+_}function Tp(h,c,d,_){return h-c*d/_}class Ip{constructor(c,d,_,S,M,k,G,W,Y,ae){if(this.boxStartIndex=c.length,Y){let fe=k.top,me=k.bottom;const Ce=k.collisionPadding;Ce&&(fe-=Ce[1],me+=Ce[3]);let Me=me-fe;Me>0&&(Me=Math.max(10,Me),this.circleDiameter=Me)}else{let fe=k.top*G-W[0],me=k.bottom*G+W[2],Ce=k.left*G-W[3],Me=k.right*G+W[1];const Ue=k.collisionPadding;if(Ue&&(Ce-=Ue[0]*G,fe-=Ue[1]*G,Me+=Ue[2]*G,me+=Ue[3]*G),ae){const $e=new R(Ce,fe),Ke=new R(Me,fe),ut=new R(Ce,me),tt=new R(Me,me),rt=ae*Math.PI/180;$e._rotate(rt),Ke._rotate(rt),ut._rotate(rt),tt._rotate(rt),Ce=Math.min($e.x,Ke.x,ut.x,tt.x),Me=Math.max($e.x,Ke.x,ut.x,tt.x),fe=Math.min($e.y,Ke.y,ut.y,tt.y),me=Math.max($e.y,Ke.y,ut.y,tt.y)}c.emplaceBack(d.x,d.y,Ce,fe,Me,me,_,S,M)}this.boxEndIndex=c.length}}class B_{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kI;if(this.data=c,this.length=this.data.length,this.compare=d,this.length>0)for(let _=(this.length>>1)-1;_>=0;_--)this._down(_)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const c=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:d,compare:_}=this,S=d[c];for(;c>0;){const M=c-1>>1,k=d[M];if(_(S,k)>=0)break;d[c]=k,c=M}d[c]=S}_down(c){const{data:d,compare:_}=this,S=this.length>>1,M=d[c];for(;c<S;){let k=1+(c<<1),G=d[k];const W=k+1;if(W<this.length&&_(d[W],G)<0&&(k=W,G=d[W]),_(G,M)>=0)break;d[c]=G,c=k}d[c]=M}}function kI(h,c){return h<c?-1:h>c?1:0}function $x(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,_=1/0,S=1/0,M=-1/0,k=-1/0;const G=h[0];for(let Ce=0;Ce<G.length;Ce++){const Me=G[Ce];(!Ce||Me.x<_)&&(_=Me.x),(!Ce||Me.y<S)&&(S=Me.y),(!Ce||Me.x>M)&&(M=Me.x),(!Ce||Me.y>k)&&(k=Me.y)}const W=Math.min(M-_,k-S);let Y=W/2;const ae=new B_([],Kx);if(W===0)return new R(_,S);for(let Ce=_;Ce<M;Ce+=W)for(let Me=S;Me<k;Me+=W)ae.push(new af(Ce+Y,Me+Y,Y,h));let fe=function(Ce){let Me=0,Ue=0,$e=0;const Ke=Ce[0];for(let ut=0,tt=Ke.length,rt=tt-1;ut<tt;rt=ut++){const yt=Ke[ut],St=Ke[rt],Jt=yt.x*St.y-St.x*yt.y;Ue+=(yt.x+St.x)*Jt,$e+=(yt.y+St.y)*Jt,Me+=3*Jt}return new af(Ue/Me,$e/Me,0,Ce)}(h),me=ae.length;for(;ae.length;){const Ce=ae.pop();(Ce.d>fe.d||!fe.d)&&(fe=Ce,d&&console.log("found best %d after %d probes",Math.round(1e4*Ce.d)/1e4,me)),Ce.max-fe.d<=c||(Y=Ce.h/2,ae.push(new af(Ce.p.x-Y,Ce.p.y-Y,Y,h)),ae.push(new af(Ce.p.x+Y,Ce.p.y-Y,Y,h)),ae.push(new af(Ce.p.x-Y,Ce.p.y+Y,Y,h)),ae.push(new af(Ce.p.x+Y,Ce.p.y+Y,Y,h)),me+=4)}return d&&(console.log(`num probes: ${me}`),console.log(`best distance: ${fe.d}`)),fe.p}function Kx(h,c){return c.max-h.max}function af(h,c,d,_){this.p=new R(h,c),this.h=d,this.d=function(S,M){let k=!1,G=1/0;for(let W=0;W<M.length;W++){const Y=M[W];for(let ae=0,fe=Y.length,me=fe-1;ae<fe;me=ae++){const Ce=Y[ae],Me=Y[me];Ce.y>S.y!=Me.y>S.y&&S.x<(Me.x-Ce.x)*(S.y-Ce.y)/(Me.y-Ce.y)+Ce.x&&(k=!k),G=Math.min(G,Am(S,Ce,Me))}}return(k?1:-1)*Math.sqrt(G)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}var ra;s.aq=void 0,(ra=s.aq||(s.aq={}))[ra.center=1]="center",ra[ra.left=2]="left",ra[ra.right=3]="right",ra[ra.top=4]="top",ra[ra.bottom=5]="bottom",ra[ra["top-left"]=6]="top-left",ra[ra["top-right"]=7]="top-right",ra[ra["bottom-left"]=8]="bottom-left",ra[ra["bottom-right"]=9]="bottom-right";const Wu=7,Lp=Number.POSITIVE_INFINITY;function C_(h,c){return c[1]!==Lp?function(d,_,S){let M=0,k=0;switch(_=Math.abs(_),S=Math.abs(S),d){case"top-right":case"top-left":case"top":k=S-Wu;break;case"bottom-right":case"bottom-left":case"bottom":k=-S+Wu}switch(d){case"top-right":case"bottom-right":case"right":M=-_;break;case"top-left":case"bottom-left":case"left":M=_}return[M,k]}(h,c[0],c[1]):function(d,_){let S=0,M=0;_<0&&(_=0);const k=_/Math.SQRT2;switch(d){case"top-right":case"top-left":M=k-Wu;break;case"bottom-right":case"bottom-left":M=-k+Wu;break;case"bottom":M=-_+Wu;break;case"top":M=_-Wu}switch(d){case"top-right":case"bottom-right":S=-k;break;case"top-left":case"bottom-left":S=k;break;case"left":S=_;break;case"right":S=-_}return[S,M]}(h,c[0])}function lf(h,c,d){var _;const S=h.layout,M=(_=S.get("text-variable-anchor-offset"))===null||_===void 0?void 0:_.evaluate(c,{},d);if(M){const G=M.values,W=[];for(let Y=0;Y<G.length;Y+=2){const ae=W[Y]=G[Y],fe=G[Y+1].map(me=>me*Cs);ae.startsWith("top")?fe[1]-=Wu:ae.startsWith("bottom")&&(fe[1]+=Wu),W[Y+1]=fe}return new Un(W)}const k=S.get("text-variable-anchor");if(k){let G;G=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[S.get("text-radial-offset").evaluate(c,{},d)*Cs,Lp]:S.get("text-offset").evaluate(c,{},d).map(Y=>Y*Cs);const W=[];for(const Y of k)W.push(Y,C_(Y,G));return new Un(W)}return null}function Mp(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Wx(h,c,d,_,S,M,k,G,W,Y,ae){let fe=M.textMaxSize.evaluate(c,{});fe===void 0&&(fe=k);const me=h.layers[0].layout,Ce=me.get("icon-offset").evaluate(c,{},ae),Me=Pp(d.horizontal),Ue=k/24,$e=h.tilePixelRatio*Ue,Ke=h.tilePixelRatio*fe/24,ut=h.tilePixelRatio*G,tt=h.tilePixelRatio*me.get("symbol-spacing"),rt=me.get("text-padding")*h.tilePixelRatio,yt=function(Yt,Gi,Qi){let yr=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Qr=Yt.get("icon-padding").evaluate(Gi,{},Qi),qr=Qr&&Qr.values;return[qr[0]*yr,qr[1]*yr,qr[2]*yr,qr[3]*yr]}(me,c,ae,h.tilePixelRatio),St=me.get("text-max-angle")/180*Math.PI,Jt=me.get("text-rotation-alignment")!=="viewport"&&me.get("symbol-placement")!=="point",wi=me.get("icon-rotation-alignment")==="map"&&me.get("symbol-placement")!=="point",ai=me.get("symbol-placement"),fi=tt/2,yi=me.get("icon-text-fit");let Ri;_&&yi!=="none"&&(h.allowVerticalPlacement&&d.vertical&&(Ri=Lm(_,d.vertical,yi,me.get("icon-text-fit-padding"),Ce,Ue)),Me&&(_=Lm(_,Me,yi,me.get("icon-text-fit-padding"),Ce,Ue)));const li=(Yt,Gi)=>{Gi.x<0||Gi.x>=Dn||Gi.y<0||Gi.y>=Dn||function(Qi,yr,Qr,qr,gn,as,zn,xn,Rn,hn,wr,Qn,An,tn,fs,Es,vs,no,Ss,kn,Er,Ns,ho,Ao,oc){const Cc=Qi.addToLineVertexArray(yr,Qr);let na,Zu,Ec,Sc,Bl=0,Ph=0,kp=0,Xx=0,E_=-1,S_=-1;const Fh={};let Zc=Wn("");if(Qi.allowVerticalPlacement&&qr.vertical){const Cl=xn.layout.get("text-rotate").evaluate(Er,{},Ao)+90;Ec=new Ip(Rn,yr,hn,wr,Qn,qr.vertical,An,tn,fs,Cl),zn&&(Sc=new Ip(Rn,yr,hn,wr,Qn,zn,vs,no,fs,Cl))}if(gn){const Cl=xn.layout.get("icon-rotate").evaluate(Er,{}),xu=xn.layout.get("icon-text-fit")!=="none",Up=JA(gn,Cl,ho,xu),Dh=zn?JA(zn,Cl,ho,xu):void 0;Zu=new Ip(Rn,yr,hn,wr,Qn,gn,vs,no,!1,Cl),Bl=4*Up.length;const Np=Qi.iconSizeData;let gA=null;Np.kind==="source"?(gA=[Wc*xn.layout.get("icon-size").evaluate(Er,{})],gA[0]>$u&&Ze(`${Qi.layerIds[0]}: Value for "icon-size" is >= ${xp}. Reduce your "icon-size".`)):Np.kind==="composite"&&(gA=[Wc*Ns.compositeIconSizes[0].evaluate(Er,{},Ao),Wc*Ns.compositeIconSizes[1].evaluate(Er,{},Ao)],(gA[0]>$u||gA[1]>$u)&&Ze(`${Qi.layerIds[0]}: Value for "icon-size" is >= ${xp}. Reduce your "icon-size".`)),Qi.addSymbols(Qi.icon,Up,gA,kn,Ss,Er,s.ai.none,yr,Cc.lineStartIndex,Cc.lineLength,-1,Ao),E_=Qi.icon.placedSymbolArray.length-1,Dh&&(Ph=4*Dh.length,Qi.addSymbols(Qi.icon,Dh,gA,kn,Ss,Er,s.ai.vertical,yr,Cc.lineStartIndex,Cc.lineLength,-1,Ao),S_=Qi.icon.placedSymbolArray.length-1)}const Op=Object.keys(qr.horizontal);for(const Cl of Op){const xu=qr.horizontal[Cl];if(!na){Zc=Wn(xu.text);const Dh=xn.layout.get("text-rotate").evaluate(Er,{},Ao);na=new Ip(Rn,yr,hn,wr,Qn,xu,An,tn,fs,Dh)}const Up=xu.positionedLines.length===1;if(kp+=Rm(Qi,yr,xu,as,xn,fs,Er,Es,Cc,qr.vertical?s.ai.horizontal:s.ai.horizontalOnly,Up?Op:[Cl],Fh,E_,Ns,Ao),Up)break}qr.vertical&&(Xx+=Rm(Qi,yr,qr.vertical,as,xn,fs,Er,Es,Cc,s.ai.vertical,["vertical"],Fh,S_,Ns,Ao));const Jx=na?na.boxStartIndex:Qi.collisionBoxArray.length,OI=na?na.boxEndIndex:Qi.collisionBoxArray.length,UI=Ec?Ec.boxStartIndex:Qi.collisionBoxArray.length,NI=Ec?Ec.boxEndIndex:Qi.collisionBoxArray.length,Oa=Zu?Zu.boxStartIndex:Qi.collisionBoxArray.length,Tc=Zu?Zu.boxEndIndex:Qi.collisionBoxArray.length,YA=Sc?Sc.boxStartIndex:Qi.collisionBoxArray.length,bu=Sc?Sc.boxEndIndex:Qi.collisionBoxArray.length;let Ua=-1;const Ic=(Cl,xu)=>Cl&&Cl.circleDiameter?Math.max(Cl.circleDiameter,xu):xu;Ua=Ic(na,Ua),Ua=Ic(Ec,Ua),Ua=Ic(Zu,Ua),Ua=Ic(Sc,Ua);const p8=Ua>-1?1:0;p8&&(Ua*=oc/Cs),Qi.glyphOffsetArray.length>=XA.MAX_GLYPHS&&Ze("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Er.sortKey!==void 0&&Qi.addToSortKeyRanges(Qi.symbolInstances.length,Er.sortKey);const Hve=lf(xn,Er,Ao),[Gve,jve]=function(Cl,xu){const Up=Cl.length,Dh=xu==null?void 0:xu.values;if((Dh==null?void 0:Dh.length)>0)for(let Np=0;Np<Dh.length;Np+=2){const gA=Dh[Np+1];Cl.emplaceBack(s.aq[Dh[Np]],gA[0],gA[1])}return[Up,Cl.length]}(Qi.textAnchorOffsets,Hve);Qi.symbolInstances.emplaceBack(yr.x,yr.y,Fh.right>=0?Fh.right:-1,Fh.center>=0?Fh.center:-1,Fh.left>=0?Fh.left:-1,Fh.vertical||-1,E_,S_,Zc,Jx,OI,UI,NI,Oa,Tc,YA,bu,hn,kp,Xx,Bl,Ph,p8,0,An,Ua,Gve,jve)}(h,Gi,Yt,d,_,S,Ri,h.layers[0],h.collisionBoxArray,c.index,c.sourceLayerIndex,h.index,$e,[rt,rt,rt,rt],Jt,W,ut,yt,wi,Ce,c,M,Y,ae,k)};if(ai==="line")for(const Yt of x_(c.geometry,0,0,Dn,Dn)){const Gi=RI(Yt,tt,St,d.vertical||Me,_,24,Ke,h.overscaling,Dn);for(const Qi of Gi)Me&&Fp(h,Me.text,fi,Qi)||li(Yt,Qi)}else if(ai==="line-center"){for(const Yt of c.geometry)if(Yt.length>1){const Gi=DI(Yt,St,d.vertical||Me,_,24,Ke);Gi&&li(Yt,Gi)}}else if(c.type==="Polygon")for(const Yt of z0(c.geometry,0)){const Gi=$x(Yt,16);li(Yt[0],new vu(Gi.x,Gi.y,0))}else if(c.type==="LineString")for(const Yt of c.geometry)li(Yt,new vu(Yt[0].x,Yt[0].y,0));else if(c.type==="Point")for(const Yt of c.geometry)for(const Gi of Yt)li([Gi],new vu(Gi.x,Gi.y,0))}function Rm(h,c,d,_,S,M,k,G,W,Y,ae,fe,me,Ce,Me){const Ue=function(ut,tt,rt,yt,St,Jt,wi,ai){const fi=yt.layout.get("text-rotate").evaluate(Jt,{})*Math.PI/180,yi=[];for(const Ri of tt.positionedLines)for(const li of Ri.positionedGlyphs){if(!li.rect)continue;const Yt=li.rect||{};let Gi=_p+1,Qi=!0,yr=1,Qr=0;const qr=(St||ai)&&li.vertical,gn=li.metrics.advance*li.scale/2;if(ai&&tt.verticalizable&&(Qr=Ri.lineOffset/2-(li.imageName?-(Cs-li.metrics.width*li.scale)/2:(li.scale-1)*Cs)),li.imageName){const kn=wi[li.imageName];Qi=kn.sdf,yr=kn.pixelRatio,Gi=wl/yr}const as=St?[li.x+gn,li.y]:[0,0];let zn=St?[0,0]:[li.x+gn+rt[0],li.y+rt[1]-Qr],xn=[0,0];qr&&(xn=zn,zn=[0,0]);const Rn=li.metrics.isDoubleResolution?2:1,hn=(li.metrics.left-Gi)*li.scale-gn+zn[0],wr=(-li.metrics.top-Gi)*li.scale+zn[1],Qn=hn+Yt.w/Rn*li.scale/yr,An=wr+Yt.h/Rn*li.scale/yr,tn=new R(hn,wr),fs=new R(Qn,wr),Es=new R(hn,An),vs=new R(Qn,An);if(qr){const kn=new R(-gn,gn-Wd),Er=-Math.PI/2,Ns=Cs/2-gn,ho=new R(5-Wd-Ns,-(li.imageName?Ns:0)),Ao=new R(...xn);tn._rotateAround(Er,kn)._add(ho)._add(Ao),fs._rotateAround(Er,kn)._add(ho)._add(Ao),Es._rotateAround(Er,kn)._add(ho)._add(Ao),vs._rotateAround(Er,kn)._add(ho)._add(Ao)}if(fi){const kn=Math.sin(fi),Er=Math.cos(fi),Ns=[Er,-kn,kn,Er];tn._matMult(Ns),fs._matMult(Ns),Es._matMult(Ns),vs._matMult(Ns)}const no=new R(0,0),Ss=new R(0,0);yi.push({tl:tn,tr:fs,bl:Es,br:vs,tex:Yt,writingMode:tt.writingMode,glyphOffset:as,sectionIndex:li.sectionIndex,isSDF:Qi,pixelOffsetTL:no,pixelOffsetBR:Ss,minFontScaleX:0,minFontScaleY:0})}return yi}(0,d,G,S,M,k,_,h.allowVerticalPlacement),$e=h.textSizeData;let Ke=null;$e.kind==="source"?(Ke=[Wc*S.layout.get("text-size").evaluate(k,{})],Ke[0]>$u&&Ze(`${h.layerIds[0]}: Value for "text-size" is >= ${xp}. Reduce your "text-size".`)):$e.kind==="composite"&&(Ke=[Wc*Ce.compositeTextSizes[0].evaluate(k,{},Me),Wc*Ce.compositeTextSizes[1].evaluate(k,{},Me)],(Ke[0]>$u||Ke[1]>$u)&&Ze(`${h.layerIds[0]}: Value for "text-size" is >= ${xp}. Reduce your "text-size".`)),h.addSymbols(h.text,Ue,Ke,G,M,k,Y,c,W.lineStartIndex,W.lineLength,me,Me);for(const ut of ae)fe[ut]=h.text.placedSymbolArray.length-1;return 4*Ue.length}function Pp(h){for(const c in h)return h[c];return null}function Fp(h,c,d,_){const S=h.compareText;if(c in S){const M=S[c];for(let k=M.length-1;k>=0;k--)if(_.dist(M[k])<d)return!0}else S[c]=[];return S[c].push(_),!1}const km=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Dp{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[d,_]=new Uint8Array(c,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");const S=_>>4;if(S!==1)throw new Error(`Got v${S} data when expected v1.`);const M=km[15&_];if(!M)throw new Error("Unrecognized array type.");const[k]=new Uint16Array(c,2,1),[G]=new Uint32Array(c,4,1);return new Dp(G,k,M,c)}constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,S=arguments.length>3?arguments[3]:void 0;if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=_,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const M=km.indexOf(this.ArrayType),k=2*c*this.ArrayType.BYTES_PER_ELEMENT,G=c*this.IndexArrayType.BYTES_PER_ELEMENT,W=(8-G%8)%8;if(M<0)throw new Error(`Unexpected typed array class: ${_}.`);S&&S instanceof ArrayBuffer?(this.data=S,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+G+W,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+k+G+W),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+G+W,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+M]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=c)}add(c,d){const _=this._pos>>1;return this.ids[_]=_,this.coords[this._pos++]=c,this.coords[this._pos++]=d,_}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return Rp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,d,_,S){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:M,coords:k,nodeSize:G}=this,W=[0,M.length-1,0],Y=[];for(;W.length;){const ae=W.pop()||0,fe=W.pop()||0,me=W.pop()||0;if(fe-me<=G){for(let $e=me;$e<=fe;$e++){const Ke=k[2*$e],ut=k[2*$e+1];Ke>=c&&Ke<=_&&ut>=d&&ut<=S&&Y.push(M[$e])}continue}const Ce=me+fe>>1,Me=k[2*Ce],Ue=k[2*Ce+1];Me>=c&&Me<=_&&Ue>=d&&Ue<=S&&Y.push(M[Ce]),(ae===0?c<=Me:d<=Ue)&&(W.push(me),W.push(Ce-1),W.push(1-ae)),(ae===0?_>=Me:S>=Ue)&&(W.push(Ce+1),W.push(fe),W.push(1-ae))}return Y}within(c,d,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:M,nodeSize:k}=this,G=[0,S.length-1,0],W=[],Y=_*_;for(;G.length;){const ae=G.pop()||0,fe=G.pop()||0,me=G.pop()||0;if(fe-me<=k){for(let $e=me;$e<=fe;$e++)m(M[2*$e],M[2*$e+1],c,d)<=Y&&W.push(S[$e]);continue}const Ce=me+fe>>1,Me=M[2*Ce],Ue=M[2*Ce+1];m(Me,Ue,c,d)<=Y&&W.push(S[Ce]),(ae===0?c-_<=Me:d-_<=Ue)&&(G.push(me),G.push(Ce-1),G.push(1-ae)),(ae===0?c+_>=Me:d+_>=Ue)&&(G.push(Ce+1),G.push(fe),G.push(1-ae))}return W}}function Rp(h,c,d,_,S,M){if(S-_<=d)return;const k=_+S>>1;Zx(h,c,k,_,S,M),Rp(h,c,d,_,k-1,1-M),Rp(h,c,d,k+1,S,1-M)}function Zx(h,c,d,_,S,M){for(;S>_;){if(S-_>600){const Y=S-_+1,ae=d-_+1,fe=Math.log(Y),me=.5*Math.exp(2*fe/3),Ce=.5*Math.sqrt(fe*me*(Y-me)/Y)*(ae-Y/2<0?-1:1);Zx(h,c,d,Math.max(_,Math.floor(d-ae*me/Y+Ce)),Math.min(S,Math.floor(d+(Y-ae)*me/Y+Ce)),M)}const k=c[2*d+M];let G=_,W=S;for(f(h,c,_,d),c[2*S+M]>k&&f(h,c,_,S);G<W;){for(f(h,c,G,W),G++,W--;c[2*G+M]<k;)G++;for(;c[2*W+M]>k;)W--}c[2*_+M]===k?f(h,c,_,W):(W++,f(h,c,W,S)),W<=d&&(_=W+1),d<=W&&(S=W-1)}}function f(h,c,d,_){u(h,d,_),u(c,2*d,2*_),u(c,2*d+1,2*_+1)}function u(h,c,d){const _=h[c];h[c]=h[d],h[d]=_}function m(h,c,d,_){const S=h-d,M=c-_;return S*S+M*M}var C;s.bh=void 0,(C=s.bh||(s.bh={})).create="create",C.load="load",C.fullLoad="fullLoad";let D=null,Q=[];const H=1e3/60,Z="loadTime",re="fullLoadTime",de={mark(h){performance.mark(h)},frame(h){const c=h;D!=null&&Q.push(c-D),D=c},clearMetrics(){D=null,Q=[],performance.clearMeasures(Z),performance.clearMeasures(re);for(const h in s.bh)performance.clearMarks(s.bh[h])},getPerformanceMetrics(){performance.measure(Z,s.bh.create,s.bh.load),performance.measure(re,s.bh.create,s.bh.fullLoad);const h=performance.getEntriesByName(Z)[0].duration,c=performance.getEntriesByName(re)[0].duration,d=Q.length,_=1/(Q.reduce((M,k)=>M+k,0)/d/1e3),S=Q.filter(M=>M>H).reduce((M,k)=>M+(k-H)/H,0);return{loadTime:h,fullLoadTime:c,fps:_,percentDroppedFrames:S/(d+S)*100,totalFrames:d}}};s.$=function(h,c,d){var _,S,M,k,G,W,Y,ae,fe,me,Ce,Me,Ue=d[0],$e=d[1],Ke=d[2];return c===h?(h[12]=c[0]*Ue+c[4]*$e+c[8]*Ke+c[12],h[13]=c[1]*Ue+c[5]*$e+c[9]*Ke+c[13],h[14]=c[2]*Ue+c[6]*$e+c[10]*Ke+c[14],h[15]=c[3]*Ue+c[7]*$e+c[11]*Ke+c[15]):(S=c[1],M=c[2],k=c[3],G=c[4],W=c[5],Y=c[6],ae=c[7],fe=c[8],me=c[9],Ce=c[10],Me=c[11],h[0]=_=c[0],h[1]=S,h[2]=M,h[3]=k,h[4]=G,h[5]=W,h[6]=Y,h[7]=ae,h[8]=fe,h[9]=me,h[10]=Ce,h[11]=Me,h[12]=_*Ue+G*$e+fe*Ke+c[12],h[13]=S*Ue+W*$e+me*Ke+c[13],h[14]=M*Ue+Y*$e+Ce*Ke+c[14],h[15]=k*Ue+ae*$e+Me*Ke+c[15]),h},s.A=Kc,s.B=us,s.C=class{constructor(h,c,d){this.receive=_=>{const S=_.data,M=S.id;if(M&&(!S.targetMapId||this.mapId===S.targetMapId))if(S.type==="<cancel>"){delete this.tasks[M];const k=this.cancelCallbacks[M];delete this.cancelCallbacks[M],k&&k()}else Pt()||S.mustQueue?(this.tasks[M]=S,this.taskQueue.push(M),this.invoker.trigger()):this.processTask(M,S)},this.process=()=>{if(!this.taskQueue.length)return;const _=this.taskQueue.shift(),S=this.tasks[_];delete this.tasks[_],this.taskQueue.length&&this.invoker.trigger(),S&&this.processTask(_,S)},this.target=h,this.parent=c,this.mapId=d,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Pm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Pt()?h:window}send(h,c,d,_){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const M=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(this.callbacks[M]=d);const k=[],G={id:M,type:h,hasCallback:!!d,targetMapId:_,mustQueue:S,sourceMapId:this.mapId,data:Di(c,k)};return this.target.postMessage(G,{transfer:k}),{cancel:()=>{d&&delete this.callbacks[M],this.target.postMessage({id:M,type:"<cancel>",targetMapId:_,sourceMapId:this.mapId})}}}processTask(h,c){if(c.type==="<response>"){const d=this.callbacks[h];delete this.callbacks[h],d&&(c.error?d(fl(c.error)):d(null,fl(c.data)))}else{let d=!1;const _=[],S=c.hasCallback?(G,W)=>{d=!0,delete this.cancelCallbacks[h];const Y={id:h,type:"<response>",sourceMapId:this.mapId,error:G?Di(G):null,data:Di(W,_)};this.target.postMessage(Y,{transfer:_})}:G=>{d=!0};let M=null;const k=fl(c.data);if(this.parent[c.type])M=this.parent[c.type](c.sourceMapId,k,S);else if("getWorkerSource"in this.parent){const G=c.type.split(".");M=this.parent.getWorkerSource(c.sourceMapId,G[0],k.source)[G[1]](k,S)}else S(new Error(`Could not find function ${c.type}`));!d&&M&&M.cancel&&(this.cancelCallbacks[h]=M.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=$i,s.E=ti,s.F=function(h,c){const d={};for(let _=0;_<c.length;_++){const S=c[_];S in h&&(d[S]=h[S])}return d},s.G=tf,s.H=A_,s.I=Sm,s.J=pe,s.K=be,s.L=Ku,s.M=Xt,s.N=Dn,s.O=zo,s.P=R,s.Q=Fn,s.R=Uo,s.S=ui,s.T=Gc,s.U=Bp,s.V=class extends Da{},s.W=g_,s.X=function(h,c){const d=window.document.createElement("video");d.muted=!0,d.onloadstart=function(){c(null,d)};for(let _=0;_<h.length;_++){const S=window.document.createElement("source");Pi(h[_])||(d.crossOrigin="Anonymous"),S.src=h[_],d.appendChild(S)}return{cancel:()=>{}}},s.Y=Wt,s.Z=function(){var h=new Kc(16);return Kc!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},s._=g,s.a=Rt,s.a$=class extends I{},s.a0=function(h,c,d){var _=d[0],S=d[1],M=d[2];return h[0]=c[0]*_,h[1]=c[1]*_,h[2]=c[2]*_,h[3]=c[3]*_,h[4]=c[4]*S,h[5]=c[5]*S,h[6]=c[6]*S,h[7]=c[7]*S,h[8]=c[8]*M,h[9]=c[9]*M,h[10]=c[10]*M,h[11]=c[11]*M,h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15],h},s.a1=cA,s.a2=function(){return at++},s.a3=E,s.a4=XA,s.a5=function(){to.isLoading()||to.isLoaded()||Nu()!=="deferred"||_a()},s.a6=hl,s.a7=rl,s.a8=Ei,s.a9=v_,s.aA=gl,s.aB=function(h){h=h.slice();const c=Object.create(null);for(let d=0;d<h.length;d++)c[h[d].id]=h[d];for(let d=0;d<h.length;d++)"ref"in h[d]&&(h[d]=oi(h[d],c[h[d].ref]));return h},s.aC=function(h){if(h.type==="custom")return new u_(h);switch(h.type){case"background":return new Qx(h);case"circle":return new bl(h);case"fill":return new yI(h);case"fill-extrusion":return new mx(h);case"heatmap":return new ka(h);case"hillshade":return new Qd(h);case"line":return new vo(h);case"raster":return new Hx(h);case"symbol":return new ef(h)}},s.aD=De,s.aE=function(h,c){if(!h)return[{command:ci.setStyle,args:[c]}];let d=[];try{if(!gi(h.version,c.version))return[{command:ci.setStyle,args:[c]}];gi(h.center,c.center)||d.push({command:ci.setCenter,args:[c.center]}),gi(h.zoom,c.zoom)||d.push({command:ci.setZoom,args:[c.zoom]}),gi(h.bearing,c.bearing)||d.push({command:ci.setBearing,args:[c.bearing]}),gi(h.pitch,c.pitch)||d.push({command:ci.setPitch,args:[c.pitch]}),gi(h.sprite,c.sprite)||d.push({command:ci.setSprite,args:[c.sprite]}),gi(h.glyphs,c.glyphs)||d.push({command:ci.setGlyphs,args:[c.glyphs]}),gi(h.transition,c.transition)||d.push({command:ci.setTransition,args:[c.transition]}),gi(h.light,c.light)||d.push({command:ci.setLight,args:[c.light]});const _={},S=[];(function(k,G,W,Y){let ae;for(ae in G=G||{},k=k||{})Object.prototype.hasOwnProperty.call(k,ae)&&(Object.prototype.hasOwnProperty.call(G,ae)||tr(ae,W,Y));for(ae in G)Object.prototype.hasOwnProperty.call(G,ae)&&(Object.prototype.hasOwnProperty.call(k,ae)?gi(k[ae],G[ae])||(k[ae].type==="geojson"&&G[ae].type==="geojson"&&Mr(k,G,ae)?W.push({command:ci.setGeoJSONSourceData,args:[ae,G[ae].data]}):pr(ae,G,W,Y)):Ki(ae,G,W))})(h.sources,c.sources,S,_);const M=[];h.layers&&h.layers.forEach(k=>{_[k.source]?d.push({command:ci.removeLayer,args:[k.id]}):M.push(k)}),d=d.concat(S),function(k,G,W){G=G||[];const Y=(k=k||[]).map(Wi),ae=G.map(Wi),fe=k.reduce(hi,{}),me=G.reduce(hi,{}),Ce=Y.slice(),Me=Object.create(null);let Ue,$e,Ke,ut,tt,rt,yt;for(Ue=0,$e=0;Ue<Y.length;Ue++)Ke=Y[Ue],Object.prototype.hasOwnProperty.call(me,Ke)?$e++:(W.push({command:ci.removeLayer,args:[Ke]}),Ce.splice(Ce.indexOf(Ke,$e),1));for(Ue=0,$e=0;Ue<ae.length;Ue++)Ke=ae[ae.length-1-Ue],Ce[Ce.length-1-Ue]!==Ke&&(Object.prototype.hasOwnProperty.call(fe,Ke)?(W.push({command:ci.removeLayer,args:[Ke]}),Ce.splice(Ce.lastIndexOf(Ke,Ce.length-$e),1)):$e++,rt=Ce[Ce.length-Ue],W.push({command:ci.addLayer,args:[me[Ke],rt]}),Ce.splice(Ce.length-Ue,0,Ke),Me[Ke]=!0);for(Ue=0;Ue<ae.length;Ue++)if(Ke=ae[Ue],ut=fe[Ke],tt=me[Ke],!Me[Ke]&&!gi(ut,tt))if(gi(ut.source,tt.source)&&gi(ut["source-layer"],tt["source-layer"])&&gi(ut.type,tt.type)){for(yt in zt(ut.layout,tt.layout,W,Ke,null,ci.setLayoutProperty),zt(ut.paint,tt.paint,W,Ke,null,ci.setPaintProperty),gi(ut.filter,tt.filter)||W.push({command:ci.setFilter,args:[Ke,tt.filter]}),gi(ut.minzoom,tt.minzoom)&&gi(ut.maxzoom,tt.maxzoom)||W.push({command:ci.setLayerZoomRange,args:[Ke,tt.minzoom,tt.maxzoom]}),ut)Object.prototype.hasOwnProperty.call(ut,yt)&&yt!=="layout"&&yt!=="paint"&&yt!=="filter"&&yt!=="metadata"&&yt!=="minzoom"&&yt!=="maxzoom"&&(yt.indexOf("paint.")===0?zt(ut[yt],tt[yt],W,Ke,yt.slice(6),ci.setPaintProperty):gi(ut[yt],tt[yt])||W.push({command:ci.setLayerProperty,args:[Ke,yt,tt[yt]]}));for(yt in tt)Object.prototype.hasOwnProperty.call(tt,yt)&&!Object.prototype.hasOwnProperty.call(ut,yt)&&yt!=="layout"&&yt!=="paint"&&yt!=="filter"&&yt!=="metadata"&&yt!=="minzoom"&&yt!=="maxzoom"&&(yt.indexOf("paint.")===0?zt(ut[yt],tt[yt],W,Ke,yt.slice(6),ci.setPaintProperty):gi(ut[yt],tt[yt])||W.push({command:ci.setLayerProperty,args:[Ke,yt,tt[yt]]}))}else W.push({command:ci.removeLayer,args:[Ke]}),rt=Ce[Ce.lastIndexOf(Ke)+1],W.push({command:ci.addLayer,args:[tt,rt]})}(M,c.layers,d)}catch(_){console.warn("Unable to compute style diff:",_),d=[{command:ci.setStyle,args:[c]}]}return d},s.aF=function(h){const c=[],d=h.id;return d===void 0&&c.push({message:`layers.${d}: missing required property "id"`}),h.render===void 0&&c.push({message:`layers.${d}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&c.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),c},s.aG=function h(c,d){if(Array.isArray(c)){if(!Array.isArray(d)||c.length!==d.length)return!1;for(let _=0;_<c.length;_++)if(!h(c[_],d[_]))return!1;return!0}if(typeof c=="object"&&c!==null&&d!==null){if(typeof d!="object"||Object.keys(c).length!==Object.keys(d).length)return!1;for(const _ in c)if(!h(c[_],d[_]))return!1;return!0}return c===d},s.aH=nt,s.aI=ke,s.aJ=Hc,s.aK=function(h){return h({pluginStatus:Rs,pluginURL:Fo}),Hc.on("pluginStateChange",h),h},s.aL=class extends Nr{constructor(h,c){super(h,c),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},s.aM=on,s.aN=class extends Nr{constructor(h,c){super(h,c),this.current=ts}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let c=1;c<16;c++)if(h[c]!==this.current[c]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},s.aO=es,s.aP=class extends Nr{constructor(h,c){super(h,c),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},s.aQ=class extends Nr{constructor(h,c){super(h,c),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},s.aR=an,s.aS=function(h,c,d,_,S,M,k){var G=1/(c-d),W=1/(_-S),Y=1/(M-k);return h[0]=-2*G,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*W,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*Y,h[11]=0,h[12]=(c+d)*G,h[13]=(S+_)*W,h[14]=(k+M)*Y,h[15]=1,h},s.aT=dr,s.aU=Nd,s.aV=class extends L{},s.aW=Ex,s.aX=class extends z{},s.aY=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},s.aZ=uA,s.a_=ve,s.aa=function(h){const c={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,_,S,M)=>{const k=S||M;return c[_]=!k||k.toLowerCase(),""}),c["max-age"]){const d=parseInt(c["max-age"],10);isNaN(d)?delete c["max-age"]:c["max-age"]=d}return c},s.ab=function(h,c){const d=[];for(const _ in h)_ in c||d.push(_);return d},s.ac=function(h){if(bt==null){const c=h.navigator?h.navigator.userAgent:null;bt=!!h.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return bt},s.ad=je,s.ae=function(h,c,d){var _=Math.sin(d),S=Math.cos(d),M=c[0],k=c[1],G=c[2],W=c[3],Y=c[4],ae=c[5],fe=c[6],me=c[7];return c!==h&&(h[8]=c[8],h[9]=c[9],h[10]=c[10],h[11]=c[11],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15]),h[0]=M*S+Y*_,h[1]=k*S+ae*_,h[2]=G*S+fe*_,h[3]=W*S+me*_,h[4]=Y*S-M*_,h[5]=ae*S-k*_,h[6]=fe*S-G*_,h[7]=me*S-W*_,h},s.af=function(h){var c=new Kc(16);return c[0]=h[0],c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=h[6],c[7]=h[7],c[8]=h[8],c[9]=h[9],c[10]=h[10],c[11]=h[11],c[12]=h[12],c[13]=h[13],c[14]=h[14],c[15]=h[15],c},s.ag=_u,s.ah=function(h,c){let d=0,_=0;if(h.kind==="constant")_=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:S,minZoom:M,maxZoom:k}=h,G=S?je(En.interpolationFactor(S,c,M,k),0,1):0;h.kind==="camera"?_=us.number(h.minSize,h.maxSize,G):d=G}return{uSizeT:d,uSize:_}},s.aj=function(h,c,d){let{uSize:_,uSizeT:S}=c,{lowerSize:M,upperSize:k}=d;return h.kind==="source"?M/Wc:h.kind==="composite"?us.number(M/Wc,k/Wc,S):_},s.ak=Yd,s.al=function(h,c,d,_){const S=c.y-h.y,M=c.x-h.x,k=_.y-d.y,G=_.x-d.x,W=k*M-G*S;if(W===0)return null;const Y=(G*(h.y-d.y)-k*(h.x-d.x))/W;return new R(h.x+Y*M,h.y+Y*S)},s.am=x_,s.an=$c,s.ao=Ud,s.ap=Cs,s.ar=Mm,s.as=function(h,c){var d=c[0],_=c[1],S=c[2],M=c[3],k=c[4],G=c[5],W=c[6],Y=c[7],ae=c[8],fe=c[9],me=c[10],Ce=c[11],Me=c[12],Ue=c[13],$e=c[14],Ke=c[15],ut=d*G-_*k,tt=d*W-S*k,rt=d*Y-M*k,yt=_*W-S*G,St=_*Y-M*G,Jt=S*Y-M*W,wi=ae*Ue-fe*Me,ai=ae*$e-me*Me,fi=ae*Ke-Ce*Me,yi=fe*$e-me*Ue,Ri=fe*Ke-Ce*Ue,li=me*Ke-Ce*$e,Yt=ut*li-tt*Ri+rt*yi+yt*fi-St*ai+Jt*wi;return Yt?(h[0]=(G*li-W*Ri+Y*yi)*(Yt=1/Yt),h[1]=(S*Ri-_*li-M*yi)*Yt,h[2]=(Ue*Jt-$e*St+Ke*yt)*Yt,h[3]=(me*St-fe*Jt-Ce*yt)*Yt,h[4]=(W*fi-k*li-Y*ai)*Yt,h[5]=(d*li-S*fi+M*ai)*Yt,h[6]=($e*rt-Me*Jt-Ke*tt)*Yt,h[7]=(ae*Jt-me*rt+Ce*tt)*Yt,h[8]=(k*Ri-G*fi+Y*wi)*Yt,h[9]=(_*fi-d*Ri-M*wi)*Yt,h[10]=(Me*St-Ue*rt+Ke*ut)*Yt,h[11]=(fe*rt-ae*St-Ce*ut)*Yt,h[12]=(G*ai-k*yi-W*wi)*Yt,h[13]=(d*yi-_*ai+S*wi)*Yt,h[14]=(Ue*tt-Me*yt-$e*ut)*Yt,h[15]=(ae*yt-fe*tt+me*ut)*Yt,h):null},s.at=Mp,s.au=n_,s.av=Dp,s.aw=function(){const h={},c=ht.$version;for(const d in ht.$root){const _=ht.$root[d];if(_.required){let S=null;S=d==="version"?c:_.type==="array"?[]:{},S!=null&&(h[d]=S)}}return h},s.ax=ci,s.ay=pl,s.az=Mt,s.b=function(h,c){const d=new Blob([new Uint8Array(h)],{type:"image/png"});createImageBitmap(d).then(_=>{c(null,_)}).catch(_=>{c(new Error(`Could not load image because of ${_.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=Ht,s.b1=function(h,c){var d=h[0],_=h[1],S=h[2],M=h[3],k=h[4],G=h[5],W=h[6],Y=h[7],ae=h[8],fe=h[9],me=h[10],Ce=h[11],Me=h[12],Ue=h[13],$e=h[14],Ke=h[15],ut=c[0],tt=c[1],rt=c[2],yt=c[3],St=c[4],Jt=c[5],wi=c[6],ai=c[7],fi=c[8],yi=c[9],Ri=c[10],li=c[11],Yt=c[12],Gi=c[13],Qi=c[14],yr=c[15];return Math.abs(d-ut)<=ia*Math.max(1,Math.abs(d),Math.abs(ut))&&Math.abs(_-tt)<=ia*Math.max(1,Math.abs(_),Math.abs(tt))&&Math.abs(S-rt)<=ia*Math.max(1,Math.abs(S),Math.abs(rt))&&Math.abs(M-yt)<=ia*Math.max(1,Math.abs(M),Math.abs(yt))&&Math.abs(k-St)<=ia*Math.max(1,Math.abs(k),Math.abs(St))&&Math.abs(G-Jt)<=ia*Math.max(1,Math.abs(G),Math.abs(Jt))&&Math.abs(W-wi)<=ia*Math.max(1,Math.abs(W),Math.abs(wi))&&Math.abs(Y-ai)<=ia*Math.max(1,Math.abs(Y),Math.abs(ai))&&Math.abs(ae-fi)<=ia*Math.max(1,Math.abs(ae),Math.abs(fi))&&Math.abs(fe-yi)<=ia*Math.max(1,Math.abs(fe),Math.abs(yi))&&Math.abs(me-Ri)<=ia*Math.max(1,Math.abs(me),Math.abs(Ri))&&Math.abs(Ce-li)<=ia*Math.max(1,Math.abs(Ce),Math.abs(li))&&Math.abs(Me-Yt)<=ia*Math.max(1,Math.abs(Me),Math.abs(Yt))&&Math.abs(Ue-Gi)<=ia*Math.max(1,Math.abs(Ue),Math.abs(Gi))&&Math.abs($e-Qi)<=ia*Math.max(1,Math.abs($e),Math.abs(Qi))&&Math.abs(Ke-yr)<=ia*Math.max(1,Math.abs(Ke),Math.abs(yr))},s.b2=function(h,c){return h[0]=c[0],h[1]=c[1],h[2]=c[2],h[3]=c[3],h[4]=c[4],h[5]=c[5],h[6]=c[6],h[7]=c[7],h[8]=c[8],h[9]=c[9],h[10]=c[10],h[11]=c[11],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15],h},s.b3=function(h,c,d){return h[0]=c[0]*d[0],h[1]=c[1]*d[1],h[2]=c[2]*d[2],h[3]=c[3]*d[3],h},s.b4=function(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]+h[3]*c[3]},s.b5=We,s.b6=m_,s.b7=d_,s.b8=function(h,c,d,_,S){var M,k=1/Math.tan(c/2);return h[0]=k/d,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=k,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,S!=null&&S!==1/0?(h[10]=(S+_)*(M=1/(_-S)),h[14]=2*S*_*M):(h[10]=-1,h[14]=-2*_),h},s.b9=function(h,c,d){var _=Math.sin(d),S=Math.cos(d),M=c[4],k=c[5],G=c[6],W=c[7],Y=c[8],ae=c[9],fe=c[10],me=c[11];return c!==h&&(h[0]=c[0],h[1]=c[1],h[2]=c[2],h[3]=c[3],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15]),h[4]=M*S+Y*_,h[5]=k*S+ae*_,h[6]=G*S+fe*_,h[7]=W*S+me*_,h[8]=Y*S-M*_,h[9]=ae*S-k*_,h[10]=fe*S-G*_,h[11]=me*S-W*_,h},s.bA=T,s.bB=X0,s.bC=Fr,s.bD=to,s.ba=Te,s.bb=qe,s.bc=function(h,c){return h[0]=c[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=c[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=c[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},s.bd=class extends ko{},s.be=Fm,s.bf=f_,s.bg=de,s.bi=Dt,s.bj=function(h,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(Rs===Xl||Rs===Vc||Rs===il)throw new Error("setRTLTextPlugin cannot be called multiple times.");Fo=mt.resolveURL(h),Rs=Xl,vn=c,fu(),d||_a()},s.bk=Nu,s.bl=function(h,c){const d={};for(let S=0;S<h.length;S++){const M=c&&c[h[S].id]||Fs(h[S]);c&&(c[h[S].id]=M);let k=d[M];k||(k=d[M]=[]),k.push(h[S])}const _=[];for(const S in d)_.push(d[S]);return _},s.bm=Ui,s.bn=__,s.bo=Gx,s.bp=t_,s.bq=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=Dn/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const c=h.bucket.layers[0],d=c.layout,_=c._unevaluatedLayout._values,S={layoutIconSize:_["icon-size"].possiblyEvaluate(new Ei(h.bucket.zoom+1),h.canonical),layoutTextSize:_["text-size"].possiblyEvaluate(new Ei(h.bucket.zoom+1),h.canonical),textMaxSize:_["text-size"].possiblyEvaluate(new Ei(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:Y,maxZoom:ae}=h.bucket.textSizeData;S.compositeTextSizes=[_["text-size"].possiblyEvaluate(new Ei(Y),h.canonical),_["text-size"].possiblyEvaluate(new Ei(ae),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:Y,maxZoom:ae}=h.bucket.iconSizeData;S.compositeIconSizes=[_["icon-size"].possiblyEvaluate(new Ei(Y),h.canonical),_["icon-size"].possiblyEvaluate(new Ei(ae),h.canonical)]}const M=d.get("text-line-height")*Cs,k=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",G=d.get("text-keep-upright"),W=d.get("text-size");for(const Y of h.bucket.features){const ae=d.get("text-font").evaluate(Y,{},h.canonical).join(","),fe=W.evaluate(Y,{},h.canonical),me=S.layoutTextSize.evaluate(Y,{},h.canonical),Ce=S.layoutIconSize.evaluate(Y,{},h.canonical),Me={horizontal:{},vertical:void 0},Ue=Y.text;let $e,Ke=[0,0];if(Ue){const rt=Ue.toString(),yt=d.get("text-letter-spacing").evaluate(Y,{},h.canonical)*Cs,St=Fi(rt)?yt:0,Jt=d.get("text-anchor").evaluate(Y,{},h.canonical),wi=lf(c,Y,h.canonical);if(!wi){const li=d.get("text-radial-offset").evaluate(Y,{},h.canonical);Ke=li?C_(Jt,[li*Cs,Lp]):d.get("text-offset").evaluate(Y,{},h.canonical).map(Yt=>Yt*Cs)}let ai=k?"center":d.get("text-justify").evaluate(Y,{},h.canonical);const fi=d.get("symbol-placement"),yi=fi==="point"?d.get("text-max-width").evaluate(Y,{},h.canonical)*Cs:0,Ri=()=>{h.bucket.allowVerticalPlacement&&bc(rt)&&(Me.vertical=Xd(Ue,h.glyphMap,h.glyphPositions,h.imagePositions,ae,yi,M,Jt,"left",St,Ke,s.ai.vertical,!0,fi,me,fe))};if(!k&&wi){const li=new Set;if(ai==="auto")for(let Gi=0;Gi<wi.values.length;Gi+=2)li.add(Mp(wi.values[Gi]));else li.add(ai);let Yt=!1;for(const Gi of li)if(!Me.horizontal[Gi])if(Yt)Me.horizontal[Gi]=Me.horizontal[0];else{const Qi=Xd(Ue,h.glyphMap,h.glyphPositions,h.imagePositions,ae,yi,M,"center",Gi,St,Ke,s.ai.horizontal,!1,fi,me,fe);Qi&&(Me.horizontal[Gi]=Qi,Yt=Qi.positionedLines.length===1)}Ri()}else{ai==="auto"&&(ai=Mp(Jt));const li=Xd(Ue,h.glyphMap,h.glyphPositions,h.imagePositions,ae,yi,M,Jt,ai,St,Ke,s.ai.horizontal,!1,fi,me,fe);li&&(Me.horizontal[ai]=li),Ri(),bc(rt)&&k&&G&&(Me.vertical=Xd(Ue,h.glyphMap,h.glyphPositions,h.imagePositions,ae,yi,M,Jt,ai,St,Ke,s.ai.vertical,!1,fi,me,fe))}}let ut=!1;if(Y.icon&&Y.icon.name){const rt=h.imageMap[Y.icon.name];rt&&($e=Im(h.imagePositions[Y.icon.name],d.get("icon-offset").evaluate(Y,{},h.canonical),d.get("icon-anchor").evaluate(Y,{},h.canonical)),ut=!!rt.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=ut:h.bucket.sdfIcons!==ut&&Ze("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(rt.pixelRatio!==h.bucket.pixelRatio||d.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const tt=Pp(Me.horizontal)||Me.vertical;h.bucket.iconsInText=!!tt&&tt.iconsInText,(tt||$e)&&Wx(h.bucket,Y,Me,$e,h.imageMap,S,me,Ce,Ke,ut,h.canonical)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},s.br=K0,s.bs=V0,s.bt=q0,s.bu=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},s.bv=Em,s.bw=AA,s.bx=function(h,c,d,_,S){return g(this,void 0,void 0,function*(){if(be())try{return yield Xt(h,c,d,_,S)}catch{}return function(M,k,G,W,Y){const ae=M.width,fe=M.height;Le&&Xe||(Le=new OffscreenCanvas(ae,fe),Xe=Le.getContext("2d",{willReadFrequently:!0})),Le.width=ae,Le.height=fe,Xe.drawImage(M,0,0,ae,fe);const me=Xe.getImageData(k,G,W,Y);return Xe.clearRect(0,0,ae,fe),me.data}(h,c,d,_,S)})},s.by=y_,s.bz=v,s.c=Bt,s.d=function(h,c){const d=new Image;d.onload=()=>{c(null,d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=Ft})},d.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(h)],{type:"image/png"});d.src=h.byteLength?URL.createObjectURL(_):Ft},s.e=Ne,s.f=function(h,c){return _i(Ne(h,{type:"json"}),c)},s.g=qt,s.h=mt,s.i=Pt,s.j=Oi,s.k=wt,s.l=vi,s.m=_i,s.n=function(h){return new Em(h).readFields(mp,[])},s.o=function(h,c,d){if(!h.length)return d(null,[]);let _=h.length;const S=new Array(h.length);let M=null;h.forEach((k,G)=>{c(k,(W,Y)=>{W&&(M=W),S[G]=Y,--_==0&&d(M,S)})})},s.p=vp,s.q=wc,s.r=sn,s.s=Pi,s.t=nn,s.u=Li,s.v=ht,s.w=Ze,s.x=Fa,s.y=en,s.z=function(h){let[c,d,_]=h;return d+=90,d*=Math.PI/180,_*=Math.PI/180,{x:c*Math.cos(d)*Math.sin(_),y:c*Math.sin(d)*Math.sin(_),z:c*Math.cos(_)}}}),o(["./shared"],function(s){class g{constructor(ie){this.keyCache={},ie&&this.replace(ie)}replace(ie){this._layerConfigs={},this._layers={},this.update(ie,[])}update(ie,ue){for(const xe of ie){this._layerConfigs[xe.id]=xe;const Ee=this._layers[xe.id]=s.aC(xe);Ee._featureFilter=s.a6(Ee.filter),this.keyCache[xe.id]&&delete this.keyCache[xe.id]}for(const xe of ue)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const ge=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const xe of ge){const Ee=xe.map(vt=>this._layers[vt.id]),we=Ee[0];if(we.visibility==="none")continue;const Fe=we.source||"";let ze=this.familiesBySource[Fe];ze||(ze=this.familiesBySource[Fe]={});const Ge=we.sourceLayer||"_geojsonTileLayer";let st=ze[Ge];st||(st=ze[Ge]=[]),st.push(Ee)}}}class v{constructor(ie){const ue={},ge=[];for(const Fe in ie){const ze=ie[Fe],Ge=ue[Fe]={};for(const st in ze){const vt=ze[+st];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;const Tt={x:0,y:0,w:vt.bitmap.width+2,h:vt.bitmap.height+2};ge.push(Tt),Ge[st]={rect:Tt,metrics:vt.metrics}}}const{w:xe,h:Ee}=s.p(ge),we=new s.q({width:xe||1,height:Ee||1});for(const Fe in ie){const ze=ie[Fe];for(const Ge in ze){const st=ze[+Ge];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const vt=ue[Fe][Ge].rect;s.q.copy(st.bitmap,we,{x:0,y:0},{x:vt.x+1,y:vt.y+1},st.bitmap)}}this.image=we,this.positions=ue}}s.bm("GlyphAtlas",v);class T{constructor(ie){this.tileID=new s.O(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.uid=ie.uid,this.zoom=ie.zoom,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.collectResourceTiming,this.returnDependencies=!!ie.returnDependencies,this.promoteId=ie.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(ie,ue,ge,xe,Ee){this.status="parsing",this.data=ie,this.collisionBoxArray=new s.a3;const we=new s.bn(Object.keys(ie.layers).sort()),Fe=new s.bo(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const ze={},Ge={featureIndex:Fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ge},st=ue.familiesBySource[this.source];for(const Ni in st){const ot=ie.layers[Ni];if(!ot)continue;ot.version===1&&s.w(`Vector tile source "${this.source}" layer "${Ni}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ri=we.encode(Ni),Vt=[];for(let Vi=0;Vi<ot.length;Vi++){const lr=ot.feature(Vi),un=Fe.getId(lr,Ni);Vt.push({feature:lr,id:un,index:Vi,sourceLayerIndex:ri})}for(const Vi of st[Ni]){const lr=Vi[0];lr.source!==this.source&&s.w(`layer.source = ${lr.source} does not equal this.source = ${this.source}`),lr.minzoom&&this.zoom<Math.floor(lr.minzoom)||lr.maxzoom&&this.zoom>=lr.maxzoom||lr.visibility!=="none"&&(F(Vi,this.zoom,ge),(ze[lr.id]=lr.createBucket({index:Fe.bucketLayerIDs.length,layers:Vi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source})).populate(Vt,Ge,this.tileID.canonical),Fe.bucketLayerIDs.push(Vi.map(un=>un.id)))}}let vt,Tt,Kt,ii;const Gt=s.aH(Ge.glyphDependencies,Ni=>Object.keys(Ni).map(Number));this.inFlightDependencies.forEach(Ni=>Ni==null?void 0:Ni.cancel()),this.inFlightDependencies=[];const Ai=++this.dependencySentinel;Object.keys(Gt).length?this.inFlightDependencies.push(xe.send("getGlyphs",{uid:this.uid,stacks:Gt,source:this.source,tileID:this.tileID,type:"glyphs"},(Ni,ot)=>{Ai===this.dependencySentinel&&(vt||(vt=Ni,Tt=ot,Ci.call(this)))})):Tt={};const Bi=Object.keys(Ge.iconDependencies);Bi.length?this.inFlightDependencies.push(xe.send("getImages",{icons:Bi,source:this.source,tileID:this.tileID,type:"icons"},(Ni,ot)=>{Ai===this.dependencySentinel&&(vt||(vt=Ni,Kt=ot,Ci.call(this)))})):Kt={};const Hi=Object.keys(Ge.patternDependencies);function Ci(){if(vt)return Ee(vt);if(Tt&&Kt&&ii){const Ni=new v(Tt),ot=new s.bp(Kt,ii);for(const ri in ze){const Vt=ze[ri];Vt instanceof s.a4?(F(Vt.layers,this.zoom,ge),s.bq({bucket:Vt,glyphMap:Tt,glyphPositions:Ni.positions,imageMap:Kt,imagePositions:ot.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vt.hasPattern&&(Vt instanceof s.br||Vt instanceof s.bs||Vt instanceof s.bt)&&(F(Vt.layers,this.zoom,ge),Vt.addFeatures(Ge,this.tileID.canonical,ot.patternPositions))}this.status="done",Ee(null,{buckets:Object.values(ze).filter(ri=>!ri.isEmpty()),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ni.image,imageAtlas:ot,glyphMap:this.returnDependencies?Tt:null,iconMap:this.returnDependencies?Kt:null,glyphPositions:this.returnDependencies?Ni.positions:null})}}Hi.length?this.inFlightDependencies.push(xe.send("getImages",{icons:Hi,source:this.source,tileID:this.tileID,type:"patterns"},(Ni,ot)=>{Ai===this.dependencySentinel&&(vt||(vt=Ni,ii=ot,Ci.call(this)))})):ii={},Ci.call(this)}}function F(ce,ie,ue){const ge=new s.a8(ie);for(const xe of ce)xe.recalculate(ge,ue)}function R(ce,ie){const ue=s.l(ce.request,(ge,xe,Ee,we)=>{if(ge)ie(ge);else if(xe)try{const Fe=new s.bw.VectorTile(new s.bv(xe));ie(null,{vectorTile:Fe,rawData:xe,cacheControl:Ee,expires:we})}catch(Fe){const ze=new Uint8Array(xe);let Ge=`Unable to parse the tile at ${ce.request.url}, `;Ge+=ze[0]===31&&ze[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Fe.messge}`,ie(new Error(Ge))}});return()=>{ue.cancel(),ie()}}class U{constructor(ie,ue,ge,xe){this.actor=ie,this.layerIndex=ue,this.availableImages=ge,this.loadVectorData=xe||R,this.fetching={},this.loading={},this.loaded={}}loadTile(ie,ue){const ge=ie.uid;this.loading||(this.loading={});const xe=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new s.bu(ie.request),Ee=this.loading[ge]=new T(ie);Ee.abort=this.loadVectorData(ie,(we,Fe)=>{if(delete this.loading[ge],we||!Fe)return Ee.status="done",this.loaded[ge]=Ee,ue(we);const ze=Fe.rawData,Ge={};Fe.expires&&(Ge.expires=Fe.expires),Fe.cacheControl&&(Ge.cacheControl=Fe.cacheControl);const st={};if(xe){const vt=xe.finish();vt&&(st.resourceTiming=JSON.parse(JSON.stringify(vt)))}Ee.vectorTile=Fe.vectorTile,Ee.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.actor,(vt,Tt)=>{if(delete this.fetching[ge],vt||!Tt)return ue(vt);ue(null,s.e({rawTileData:ze.slice(0)},Tt,Ge,st))}),this.loaded=this.loaded||{},this.loaded[ge]=Ee,this.fetching[ge]={rawTileData:ze,cacheControl:Ge,resourceTiming:st}})}reloadTile(ie,ue){const ge=this.loaded,xe=ie.uid;if(ge&&ge[xe]){const Ee=ge[xe];Ee.showCollisionBoxes=ie.showCollisionBoxes,Ee.status==="parsing"?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,(we,Fe)=>{if(we||!Fe)return ue(we,Fe);let ze;if(this.fetching[xe]){const{rawTileData:Ge,cacheControl:st,resourceTiming:vt}=this.fetching[xe];delete this.fetching[xe],ze=s.e({rawTileData:Ge.slice(0)},Fe,st,vt)}else ze=Fe;ue(null,ze)}):Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}}abortTile(ie,ue){const ge=this.loading,xe=ie.uid;ge&&ge[xe]&&ge[xe].abort&&(ge[xe].abort(),delete ge[xe]),ue()}removeTile(ie,ue){const ge=this.loaded,xe=ie.uid;ge&&ge[xe]&&delete ge[xe],ue()}}class J{constructor(){this.loaded={}}loadTile(ie,ue){return s._(this,void 0,void 0,function*(){const{uid:ge,encoding:xe,rawImageData:Ee,redFactor:we,greenFactor:Fe,blueFactor:ze,baseShift:Ge}=ie,st=Ee.width+2,vt=Ee.height+2,Tt=s.a(Ee)?new s.R({width:st,height:vt},yield s.bx(Ee,-1,-1,st,vt)):Ee,Kt=new s.by(ge,Tt,xe,we,Fe,ze,Ge);this.loaded=this.loaded||{},this.loaded[ge]=Kt,ue(null,Kt)})}removeTile(ie){const ue=this.loaded,ge=ie.uid;ue&&ue[ge]&&delete ue[ge]}}function te(ce,ie){if(ce.length!==0){Ae(ce[0],ie);for(var ue=1;ue<ce.length;ue++)Ae(ce[ue],!ie)}}function Ae(ce,ie){for(var ue=0,ge=0,xe=0,Ee=ce.length,we=Ee-1;xe<Ee;we=xe++){var Fe=(ce[xe][0]-ce[we][0])*(ce[we][1]+ce[xe][1]),ze=ue+Fe;ge+=Math.abs(ue)>=Math.abs(Fe)?ue-ze+Fe:Fe-ze+ue,ue=ze}ue+ge>=0!=!!ie&&ce.reverse()}var he=s.bz(function ce(ie,ue){var ge,xe=ie&&ie.type;if(xe==="FeatureCollection")for(ge=0;ge<ie.features.length;ge++)ce(ie.features[ge],ue);else if(xe==="GeometryCollection")for(ge=0;ge<ie.geometries.length;ge++)ce(ie.geometries[ge],ue);else if(xe==="Feature")ce(ie.geometry,ue);else if(xe==="Polygon")te(ie.coordinates,ue);else if(xe==="MultiPolygon")for(ge=0;ge<ie.coordinates.length;ge++)te(ie.coordinates[ge],ue);return ie});const pe=s.bw.VectorTileFeature.prototype.toGeoJSON;var be={exports:{}},Te=s.bA,qe=s.bw.VectorTileFeature,je=We;function We(ce,ie){this.options=ie||{},this.features=ce,this.length=ce.length}function Ne(ce,ie){this.id=typeof ce.id=="number"?ce.id:void 0,this.type=ce.type,this.rawGeometry=ce.type===1?[ce.geometry]:ce.geometry,this.properties=ce.tags,this.extent=ie||4096}We.prototype.feature=function(ce){return new Ne(this.features[ce],this.options.extent)},Ne.prototype.loadGeometry=function(){var ce=this.rawGeometry;this.geometry=[];for(var ie=0;ie<ce.length;ie++){for(var ue=ce[ie],ge=[],xe=0;xe<ue.length;xe++)ge.push(new Te(ue[xe][0],ue[xe][1]));this.geometry.push(ge)}return this.geometry},Ne.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ce=this.geometry,ie=1/0,ue=-1/0,ge=1/0,xe=-1/0,Ee=0;Ee<ce.length;Ee++)for(var we=ce[Ee],Fe=0;Fe<we.length;Fe++){var ze=we[Fe];ie=Math.min(ie,ze.x),ue=Math.max(ue,ze.x),ge=Math.min(ge,ze.y),xe=Math.max(xe,ze.y)}return[ie,ge,ue,xe]},Ne.prototype.toGeoJSON=qe.prototype.toGeoJSON;var at=s.bB,nt=je;function ke(ce){var ie=new at;return function(ue,ge){for(var xe in ue.layers)ge.writeMessage(3,De,ue.layers[xe])}(ce,ie),ie.finish()}function De(ce,ie){var ue;ie.writeVarintField(15,ce.version||1),ie.writeStringField(1,ce.name||""),ie.writeVarintField(5,ce.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(ue=0;ue<ce.length;ue++)ge.feature=ce.feature(ue),ie.writeMessage(2,Ye,ge);var xe=ge.keys;for(ue=0;ue<xe.length;ue++)ie.writeStringField(3,xe[ue]);var Ee=ge.values;for(ue=0;ue<Ee.length;ue++)ie.writeMessage(4,bt,Ee[ue])}function Ye(ce,ie){var ue=ce.feature;ue.id!==void 0&&ie.writeVarintField(1,ue.id),ie.writeMessage(2,Ze,ce),ie.writeVarintField(3,ue.type),ie.writeMessage(4,Pt,ue)}function Ze(ce,ie){var ue=ce.feature,ge=ce.keys,xe=ce.values,Ee=ce.keycache,we=ce.valuecache;for(var Fe in ue.properties){var ze=ue.properties[Fe],Ge=Ee[Fe];if(ze!==null){Ge===void 0&&(ge.push(Fe),Ee[Fe]=Ge=ge.length-1),ie.writeVarint(Ge);var st=typeof ze;st!=="string"&&st!=="boolean"&&st!=="number"&&(ze=JSON.stringify(ze));var vt=st+":"+ze,Tt=we[vt];Tt===void 0&&(xe.push(ze),we[vt]=Tt=xe.length-1),ie.writeVarint(Tt)}}}function Ct(ce,ie){return(ie<<3)+(7&ce)}function Et(ce){return ce<<1^ce>>31}function Pt(ce,ie){for(var ue=ce.loadGeometry(),ge=ce.type,xe=0,Ee=0,we=ue.length,Fe=0;Fe<we;Fe++){var ze=ue[Fe],Ge=1;ge===1&&(Ge=ze.length),ie.writeVarint(Ct(1,Ge));for(var st=ge===3?ze.length-1:ze.length,vt=0;vt<st;vt++){vt===1&&ge!==1&&ie.writeVarint(Ct(2,st-1));var Tt=ze[vt].x-xe,Kt=ze[vt].y-Ee;ie.writeVarint(Et(Tt)),ie.writeVarint(Et(Kt)),xe+=Tt,Ee+=Kt}ge===3&&ie.writeVarint(Ct(7,1))}}function bt(ce,ie){var ue=typeof ce;ue==="string"?ie.writeStringField(1,ce):ue==="boolean"?ie.writeBooleanField(7,ce):ue==="number"&&(ce%1!=0?ie.writeDoubleField(3,ce):ce<0?ie.writeSVarintField(6,ce):ie.writeVarintField(5,ce))}be.exports=ke,be.exports.fromVectorTileJs=ke,be.exports.fromGeojsonVt=function(ce,ie){ie=ie||{};var ue={};for(var ge in ce)ue[ge]=new nt(ce[ge].features,ie),ue[ge].name=ge,ue[ge].version=ie.version,ue[ge].extent=ie.extent;return ke({layers:ue})},be.exports.GeoJSONWrapper=nt;var Rt=s.bz(be.exports);const Ft={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},Xt=Math.fround||(Le=new Float32Array(1),ce=>(Le[0]=+ce,Le[0]));var Le;const Xe=3,it=5,pt=6;class mt{constructor(ie){this.options=Object.assign(Object.create(Ft),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:ue,minZoom:ge,maxZoom:xe}=this.options;ue&&console.time("total time");const Ee=`prepare ${ie.length} points`;ue&&console.time(Ee),this.points=ie;const we=[];for(let ze=0;ze<ie.length;ze++){const Ge=ie[ze];if(!Ge.geometry)continue;const[st,vt]=Ge.geometry.coordinates,Tt=Xt(Mt(st)),Kt=Xt(qt(vt));we.push(Tt,Kt,1/0,ze,-1,1),this.options.reduce&&we.push(0)}let Fe=this.trees[xe+1]=this._createTree(we);ue&&console.timeEnd(Ee);for(let ze=xe;ze>=ge;ze--){const Ge=+Date.now();Fe=this.trees[ze]=this._createTree(this._cluster(Fe,ze)),ue&&console.log("z%d: %d clusters in %dms",ze,Fe.numItems,+Date.now()-Ge)}return ue&&console.timeEnd("total time"),this}getClusters(ie,ue){let ge=((ie[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,ie[1]));let Ee=ie[2]===180?180:((ie[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)ge=-180,Ee=180;else if(ge>Ee){const vt=this.getClusters([ge,xe,180,we],ue),Tt=this.getClusters([-180,xe,Ee,we],ue);return vt.concat(Tt)}const Fe=this.trees[this._limitZoom(ue)],ze=Fe.range(Mt(ge),qt(we),Mt(Ee),qt(xe)),Ge=Fe.data,st=[];for(const vt of ze){const Tt=this.stride*vt;st.push(Ge[Tt+it]>1?Bt(Ge,Tt,this.clusterProps):this.points[Ge[Tt+Xe]])}return st}getChildren(ie){const ue=this._getOriginId(ie),ge=this._getOriginZoom(ie),xe="No cluster with the specified id.",Ee=this.trees[ge];if(!Ee)throw new Error(xe);const we=Ee.data;if(ue*this.stride>=we.length)throw new Error(xe);const Fe=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),ze=Ee.within(we[ue*this.stride],we[ue*this.stride+1],Fe),Ge=[];for(const st of ze){const vt=st*this.stride;we[vt+4]===ie&&Ge.push(we[vt+it]>1?Bt(we,vt,this.clusterProps):this.points[we[vt+Xe]])}if(Ge.length===0)throw new Error(xe);return Ge}getLeaves(ie,ue,ge){const xe=[];return this._appendLeaves(xe,ie,ue=ue||10,ge=ge||0,0),xe}getTile(ie,ue,ge){const xe=this.trees[this._limitZoom(ie)],Ee=Math.pow(2,ie),{extent:we,radius:Fe}=this.options,ze=Fe/we,Ge=(ge-ze)/Ee,st=(ge+1+ze)/Ee,vt={features:[]};return this._addTileFeatures(xe.range((ue-ze)/Ee,Ge,(ue+1+ze)/Ee,st),xe.data,ue,ge,Ee,vt),ue===0&&this._addTileFeatures(xe.range(1-ze/Ee,Ge,1,st),xe.data,Ee,ge,Ee,vt),ue===Ee-1&&this._addTileFeatures(xe.range(0,Ge,ze/Ee,st),xe.data,-1,ge,Ee,vt),vt.features.length?vt:null}getClusterExpansionZoom(ie){let ue=this._getOriginZoom(ie)-1;for(;ue<=this.options.maxZoom;){const ge=this.getChildren(ie);if(ue++,ge.length!==1)break;ie=ge[0].properties.cluster_id}return ue}_appendLeaves(ie,ue,ge,xe,Ee){const we=this.getChildren(ue);for(const Fe of we){const ze=Fe.properties;if(ze&&ze.cluster?Ee+ze.point_count<=xe?Ee+=ze.point_count:Ee=this._appendLeaves(ie,ze.cluster_id,ge,xe,Ee):Ee<xe?Ee++:ie.push(Fe),ie.length===ge)break}return Ee}_createTree(ie){const ue=new s.av(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ie.length;ge+=this.stride)ue.add(ie[ge],ie[ge+1]);return ue.finish(),ue.data=ie,ue}_addTileFeatures(ie,ue,ge,xe,Ee,we){for(const Fe of ie){const ze=Fe*this.stride,Ge=ue[ze+it]>1;let st,vt,Tt;if(Ge)st=Dt(ue,ze,this.clusterProps),vt=ue[ze],Tt=ue[ze+1];else{const Gt=this.points[ue[ze+Xe]];st=Gt.properties;const[Ai,Bi]=Gt.geometry.coordinates;vt=Mt(Ai),Tt=qt(Bi)}const Kt={type:1,geometry:[[Math.round(this.options.extent*(vt*Ee-ge)),Math.round(this.options.extent*(Tt*Ee-xe))]],tags:st};let ii;ii=Ge||this.options.generateId?ue[ze+Xe]:this.points[ue[ze+Xe]].id,ii!==void 0&&(Kt.id=ii),we.features.push(Kt)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,ue){const{radius:ge,extent:xe,reduce:Ee,minPoints:we}=this.options,Fe=ge/(xe*Math.pow(2,ue)),ze=ie.data,Ge=[],st=this.stride;for(let vt=0;vt<ze.length;vt+=st){if(ze[vt+2]<=ue)continue;ze[vt+2]=ue;const Tt=ze[vt],Kt=ze[vt+1],ii=ie.within(ze[vt],ze[vt+1],Fe),Gt=ze[vt+it];let Ai=Gt;for(const Bi of ii){const Hi=Bi*st;ze[Hi+2]>ue&&(Ai+=ze[Hi+it])}if(Ai>Gt&&Ai>=we){let Bi,Hi=Tt*Gt,Ci=Kt*Gt,Ni=-1;const ot=((vt/st|0)<<5)+(ue+1)+this.points.length;for(const ri of ii){const Vt=ri*st;if(ze[Vt+2]<=ue)continue;ze[Vt+2]=ue;const Vi=ze[Vt+it];Hi+=ze[Vt]*Vi,Ci+=ze[Vt+1]*Vi,ze[Vt+4]=ot,Ee&&(Bi||(Bi=this._map(ze,vt,!0),Ni=this.clusterProps.length,this.clusterProps.push(Bi)),Ee(Bi,this._map(ze,Vt)))}ze[vt+4]=ot,Ge.push(Hi/Ai,Ci/Ai,1/0,ot,-1,Ai),Ee&&Ge.push(Ni)}else{for(let Bi=0;Bi<st;Bi++)Ge.push(ze[vt+Bi]);if(Ai>1)for(const Bi of ii){const Hi=Bi*st;if(!(ze[Hi+2]<=ue)){ze[Hi+2]=ue;for(let Ci=0;Ci<st;Ci++)Ge.push(ze[Hi+Ci])}}}}return Ge}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,ue,ge){if(ie[ue+it]>1){const we=this.clusterProps[ie[ue+pt]];return ge?Object.assign({},we):we}const xe=this.points[ie[ue+Xe]].properties,Ee=this.options.map(xe);return ge&&Ee===xe?Object.assign({},Ee):Ee}}function Bt(ce,ie,ue){return{type:"Feature",id:ce[ie+Xe],properties:Dt(ce,ie,ue),geometry:{type:"Point",coordinates:[(ge=ce[ie],360*(ge-.5)),ni(ce[ie+1])]}};var ge}function Dt(ce,ie,ue){const ge=ce[ie+it],xe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Ee=ce[ie+pt],we=Ee===-1?{}:Object.assign({},ue[Ee]);return Object.assign(we,{cluster:!0,cluster_id:ce[ie+Xe],point_count:ge,point_count_abbreviated:xe})}function Mt(ce){return ce/360+.5}function qt(ce){const ie=Math.sin(ce*Math.PI/180),ue=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ue<0?0:ue>1?1:ue}function ni(ce){const ie=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function _i(ce,ie,ue,ge){for(var xe,Ee=ge,we=ue-ie>>1,Fe=ue-ie,ze=ce[ie],Ge=ce[ie+1],st=ce[ue],vt=ce[ue+1],Tt=ie+3;Tt<ue;Tt+=3){var Kt=vi(ce[Tt],ce[Tt+1],ze,Ge,st,vt);if(Kt>Ee)xe=Tt,Ee=Kt;else if(Kt===Ee){var ii=Math.abs(Tt-we);ii<Fe&&(xe=Tt,Fe=ii)}}Ee>ge&&(xe-ie>3&&_i(ce,ie,xe,ge),ce[xe+2]=Ee,ue-xe>3&&_i(ce,xe,ue,ge))}function vi(ce,ie,ue,ge,xe,Ee){var we=xe-ue,Fe=Ee-ge;if(we!==0||Fe!==0){var ze=((ce-ue)*we+(ie-ge)*Fe)/(we*we+Fe*Fe);ze>1?(ue=xe,ge=Ee):ze>0&&(ue+=we*ze,ge+=Fe*ze)}return(we=ce-ue)*we+(Fe=ie-ge)*Fe}function Pi(ce,ie,ue,ge){var xe={id:ce===void 0?null:ce,type:ie,geometry:ue,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ee){var we=Ee.geometry,Fe=Ee.type;if(Fe==="Point"||Fe==="MultiPoint"||Fe==="LineString")kt(Ee,we);else if(Fe==="Polygon"||Fe==="MultiLineString")for(var ze=0;ze<we.length;ze++)kt(Ee,we[ze]);else if(Fe==="MultiPolygon")for(ze=0;ze<we.length;ze++)for(var Ge=0;Ge<we[ze].length;Ge++)kt(Ee,we[ze][Ge])}(xe),xe}function kt(ce,ie){for(var ue=0;ue<ie.length;ue+=3)ce.minX=Math.min(ce.minX,ie[ue]),ce.minY=Math.min(ce.minY,ie[ue+1]),ce.maxX=Math.max(ce.maxX,ie[ue]),ce.maxY=Math.max(ce.maxY,ie[ue+1])}function lt(ce,ie,ue,ge){if(ie.geometry){var xe=ie.geometry.coordinates,Ee=ie.geometry.type,we=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2),Fe=[],ze=ie.id;if(ue.promoteId?ze=ie.properties[ue.promoteId]:ue.generateId&&(ze=ge||0),Ee==="Point")wt(xe,Fe);else if(Ee==="MultiPoint")for(var Ge=0;Ge<xe.length;Ge++)wt(xe[Ge],Fe);else if(Ee==="LineString")Oi(xe,Fe,we,!1);else if(Ee==="MultiLineString"){if(ue.lineMetrics){for(Ge=0;Ge<xe.length;Ge++)Oi(xe[Ge],Fe=[],we,!1),ce.push(Pi(ze,"LineString",Fe,ie.properties));return}ti(xe,Fe,we,!1)}else if(Ee==="Polygon")ti(xe,Fe,we,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(Ge=0;Ge<ie.geometry.geometries.length;Ge++)lt(ce,{id:ze,geometry:ie.geometry.geometries[Ge],properties:ie.properties},ue,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ge=0;Ge<xe.length;Ge++){var st=[];ti(xe[Ge],st,we,!0),Fe.push(st)}}ce.push(Pi(ze,Ee,Fe,ie.properties))}}function wt(ce,ie){ie.push(ht(ce[0])),ie.push($t(ce[1])),ie.push(0)}function Oi(ce,ie,ue,ge){for(var xe,Ee,we=0,Fe=0;Fe<ce.length;Fe++){var ze=ht(ce[Fe][0]),Ge=$t(ce[Fe][1]);ie.push(ze),ie.push(Ge),ie.push(0),Fe>0&&(we+=ge?(xe*Ge-ze*Ee)/2:Math.sqrt(Math.pow(ze-xe,2)+Math.pow(Ge-Ee,2))),xe=ze,Ee=Ge}var st=ie.length-3;ie[2]=1,_i(ie,0,st,ue),ie[st+2]=1,ie.size=Math.abs(we),ie.start=0,ie.end=ie.size}function ti(ce,ie,ue,ge){for(var xe=0;xe<ce.length;xe++){var Ee=[];Oi(ce[xe],Ee,ue,ge),ie.push(Ee)}}function ht(ce){return ce/360+.5}function $t(ce){var ie=Math.sin(ce*Math.PI/180),ue=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ue<0?0:ue>1?1:ue}function oi(ce,ie,ue,ge,xe,Ee,we,Fe){if(ge/=ie,Ee>=(ue/=ie)&&we<ge)return ce;if(we<ue||Ee>=ge)return null;for(var ze=[],Ge=0;Ge<ce.length;Ge++){var st=ce[Ge],vt=st.geometry,Tt=st.type,Kt=xe===0?st.minX:st.minY,ii=xe===0?st.maxX:st.maxY;if(Kt>=ue&&ii<ge)ze.push(st);else if(!(ii<ue||Kt>=ge)){var Gt=[];if(Tt==="Point"||Tt==="MultiPoint")gi(vt,Gt,ue,ge,xe);else if(Tt==="LineString")ci(vt,Gt,ue,ge,xe,!1,Fe.lineMetrics);else if(Tt==="MultiLineString")tr(vt,Gt,ue,ge,xe,!1);else if(Tt==="Polygon")tr(vt,Gt,ue,ge,xe,!0);else if(Tt==="MultiPolygon")for(var Ai=0;Ai<vt.length;Ai++){var Bi=[];tr(vt[Ai],Bi,ue,ge,xe,!0),Bi.length&&Gt.push(Bi)}if(Gt.length){if(Fe.lineMetrics&&Tt==="LineString"){for(Ai=0;Ai<Gt.length;Ai++)ze.push(Pi(st.id,Tt,Gt[Ai],st.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(Gt.length===1?(Tt="LineString",Gt=Gt[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=Gt.length===3?"Point":"MultiPoint"),ze.push(Pi(st.id,Tt,Gt,st.tags))}}}return ze.length?ze:null}function gi(ce,ie,ue,ge,xe){for(var Ee=0;Ee<ce.length;Ee+=3){var we=ce[Ee+xe];we>=ue&&we<=ge&&(ie.push(ce[Ee]),ie.push(ce[Ee+1]),ie.push(ce[Ee+2]))}}function ci(ce,ie,ue,ge,xe,Ee,we){for(var Fe,ze,Ge=Ki(ce),st=xe===0?Mr:zt,vt=ce.start,Tt=0;Tt<ce.length-3;Tt+=3){var Kt=ce[Tt],ii=ce[Tt+1],Gt=ce[Tt+2],Ai=ce[Tt+3],Bi=ce[Tt+4],Hi=xe===0?Kt:ii,Ci=xe===0?Ai:Bi,Ni=!1;we&&(Fe=Math.sqrt(Math.pow(Kt-Ai,2)+Math.pow(ii-Bi,2))),Hi<ue?Ci>ue&&(ze=st(Ge,Kt,ii,Ai,Bi,ue),we&&(Ge.start=vt+Fe*ze)):Hi>ge?Ci<ge&&(ze=st(Ge,Kt,ii,Ai,Bi,ge),we&&(Ge.start=vt+Fe*ze)):pr(Ge,Kt,ii,Gt),Ci<ue&&Hi>=ue&&(ze=st(Ge,Kt,ii,Ai,Bi,ue),Ni=!0),Ci>ge&&Hi<=ge&&(ze=st(Ge,Kt,ii,Ai,Bi,ge),Ni=!0),!Ee&&Ni&&(we&&(Ge.end=vt+Fe*ze),ie.push(Ge),Ge=Ki(ce)),we&&(vt+=Fe)}var ot=ce.length-3;Kt=ce[ot],ii=ce[ot+1],Gt=ce[ot+2],(Hi=xe===0?Kt:ii)>=ue&&Hi<=ge&&pr(Ge,Kt,ii,Gt),ot=Ge.length-3,Ee&&ot>=3&&(Ge[ot]!==Ge[0]||Ge[ot+1]!==Ge[1])&&pr(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&ie.push(Ge)}function Ki(ce){var ie=[];return ie.size=ce.size,ie.start=ce.start,ie.end=ce.end,ie}function tr(ce,ie,ue,ge,xe,Ee){for(var we=0;we<ce.length;we++)ci(ce[we],ie,ue,ge,xe,Ee,!1)}function pr(ce,ie,ue,ge){ce.push(ie),ce.push(ue),ce.push(ge)}function Mr(ce,ie,ue,ge,xe,Ee){var we=(Ee-ie)/(ge-ie);return ce.push(Ee),ce.push(ue+(xe-ue)*we),ce.push(1),we}function zt(ce,ie,ue,ge,xe,Ee){var we=(Ee-ue)/(xe-ue);return ce.push(ie+(ge-ie)*we),ce.push(Ee),ce.push(1),we}function Wi(ce,ie){for(var ue=[],ge=0;ge<ce.length;ge++){var xe,Ee=ce[ge],we=Ee.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")xe=hi(Ee.geometry,ie);else if(we==="MultiLineString"||we==="Polygon"){xe=[];for(var Fe=0;Fe<Ee.geometry.length;Fe++)xe.push(hi(Ee.geometry[Fe],ie))}else if(we==="MultiPolygon")for(xe=[],Fe=0;Fe<Ee.geometry.length;Fe++){for(var ze=[],Ge=0;Ge<Ee.geometry[Fe].length;Ge++)ze.push(hi(Ee.geometry[Fe][Ge],ie));xe.push(ze)}ue.push(Pi(Ee.id,we,xe,Ee.tags))}return ue}function hi(ce,ie){var ue=[];ue.size=ce.size,ce.start!==void 0&&(ue.start=ce.start,ue.end=ce.end);for(var ge=0;ge<ce.length;ge+=3)ue.push(ce[ge]+ie,ce[ge+1],ce[ge+2]);return ue}function Wt(ce,ie){if(ce.transformed)return ce;var ue,ge,xe,Ee=1<<ce.z,we=ce.x,Fe=ce.y;for(ue=0;ue<ce.features.length;ue++){var ze=ce.features[ue],Ge=ze.geometry,st=ze.type;if(ze.geometry=[],st===1)for(ge=0;ge<Ge.length;ge+=2)ze.geometry.push(Ar(Ge[ge],Ge[ge+1],ie,Ee,we,Fe));else for(ge=0;ge<Ge.length;ge++){var vt=[];for(xe=0;xe<Ge[ge].length;xe+=2)vt.push(Ar(Ge[ge][xe],Ge[ge][xe+1],ie,Ee,we,Fe));ze.geometry.push(vt)}}return ce.transformed=!0,ce}function Ar(ce,ie,ue,ge,xe,Ee){return[Math.round(ue*(ce*ge-xe)),Math.round(ue*(ie*ge-Ee))]}function Qt(ce,ie,ue,ge,xe){for(var Ee=ie===xe.maxZoom?0:xe.tolerance/((1<<ie)*xe.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ue,y:ge,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Fe=0;Fe<ce.length;Fe++){we.numFeatures++,Si(we,ce[Fe],Ee,xe);var ze=ce[Fe].minX,Ge=ce[Fe].minY,st=ce[Fe].maxX,vt=ce[Fe].maxY;ze<we.minX&&(we.minX=ze),Ge<we.minY&&(we.minY=Ge),st>we.maxX&&(we.maxX=st),vt>we.maxY&&(we.maxY=vt)}return we}function Si(ce,ie,ue,ge){var xe=ie.geometry,Ee=ie.type,we=[];if(Ee==="Point"||Ee==="MultiPoint")for(var Fe=0;Fe<xe.length;Fe+=3)we.push(xe[Fe]),we.push(xe[Fe+1]),ce.numPoints++,ce.numSimplified++;else if(Ee==="LineString")Ii(we,xe,ce,ue,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(Fe=0;Fe<xe.length;Fe++)Ii(we,xe[Fe],ce,ue,Ee==="Polygon",Fe===0);else if(Ee==="MultiPolygon")for(var ze=0;ze<xe.length;ze++){var Ge=xe[ze];for(Fe=0;Fe<Ge.length;Fe++)Ii(we,Ge[Fe],ce,ue,!0,Fe===0)}if(we.length){var st=ie.tags||null;if(Ee==="LineString"&&ge.lineMetrics){for(var vt in st={},ie.tags)st[vt]=ie.tags[vt];st.mapbox_clip_start=xe.start/xe.size,st.mapbox_clip_end=xe.end/xe.size}var Tt={geometry:we,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:st};ie.id!==null&&(Tt.id=ie.id),ce.features.push(Tt)}}function Ii(ce,ie,ue,ge,xe,Ee){var we=ge*ge;if(ge>0&&ie.size<(xe?we:ge))ue.numPoints+=ie.length/3;else{for(var Fe=[],ze=0;ze<ie.length;ze+=3)(ge===0||ie[ze+2]>we)&&(ue.numSimplified++,Fe.push(ie[ze]),Fe.push(ie[ze+1])),ue.numPoints++;xe&&function(Ge,st){for(var vt=0,Tt=0,Kt=Ge.length,ii=Kt-2;Tt<Kt;ii=Tt,Tt+=2)vt+=(Ge[Tt]-Ge[ii])*(Ge[Tt+1]+Ge[ii+1]);if(vt>0===st)for(Tt=0,Kt=Ge.length;Tt<Kt/2;Tt+=2){var Gt=Ge[Tt],Ai=Ge[Tt+1];Ge[Tt]=Ge[Kt-2-Tt],Ge[Tt+1]=Ge[Kt-1-Tt],Ge[Kt-2-Tt]=Gt,Ge[Kt-1-Tt]=Ai}}(Fe,Ee),ce.push(Fe)}}function Zt(ce,ie){var ue=(ie=this.options=function(xe,Ee){for(var we in Ee)xe[we]=Ee[we];return xe}(Object.create(this.options),ie)).debug;if(ue&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(xe,Ee){var we=[];if(xe.type==="FeatureCollection")for(var Fe=0;Fe<xe.features.length;Fe++)lt(we,xe.features[Fe],Ee,Fe);else lt(we,xe.type==="Feature"?xe:{geometry:xe},Ee);return we}(ce,ie);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(xe,Ee){var we=Ee.buffer/Ee.extent,Fe=xe,ze=oi(xe,1,-1-we,we,0,-1,2,Ee),Ge=oi(xe,1,1-we,2+we,0,-1,2,Ee);return(ze||Ge)&&(Fe=oi(xe,1,-we,1+we,0,-1,2,Ee)||[],ze&&(Fe=Wi(ze,1).concat(Fe)),Ge&&(Fe=Fe.concat(Wi(Ge,-1)))),Fe}(ge,ie),ge.length&&this.splitTile(ge,0,0,0),ue&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bi(ce,ie,ue){return 32*((1<<ce)*ue+ie)+ce}function ei(ce,ie){return ie?ce.properties[ie]:ce.id}function _r(ce,ie){if(ce==null)return!0;if(ce.type==="Feature")return ei(ce,ie)!=null;if(ce.type==="FeatureCollection"){const ue=new Set;for(const ge of ce.features){const xe=ei(ge,ie);if(xe==null||ue.has(xe))return!1;ue.add(xe)}return!0}return!1}function Zr(ce,ie){const ue=new Map;if(ce!=null)if(ce.type==="Feature")ue.set(ei(ce,ie),ce);else for(const ge of ce.features)ue.set(ei(ge,ie),ge);return ue}Zt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zt.prototype.splitTile=function(ce,ie,ue,ge,xe,Ee,we){for(var Fe=[ce,ie,ue,ge],ze=this.options,Ge=ze.debug;Fe.length;){ge=Fe.pop(),ue=Fe.pop(),ie=Fe.pop(),ce=Fe.pop();var st=1<<ie,vt=bi(ie,ue,ge),Tt=this.tiles[vt];if(!Tt&&(Ge>1&&console.time("creation"),Tt=this.tiles[vt]=Qt(ce,ie,ue,ge,ze),this.tileCoords.push({z:ie,x:ue,y:ge}),Ge)){Ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,ue,ge,Tt.numFeatures,Tt.numPoints,Tt.numSimplified),console.timeEnd("creation"));var Kt="z"+ie;this.stats[Kt]=(this.stats[Kt]||0)+1,this.total++}if(Tt.source=ce,xe){if(ie===ze.maxZoom||ie===xe)continue;var ii=1<<xe-ie;if(ue!==Math.floor(Ee/ii)||ge!==Math.floor(we/ii))continue}else if(ie===ze.indexMaxZoom||Tt.numPoints<=ze.indexMaxPoints)continue;if(Tt.source=null,ce.length!==0){Ge>1&&console.time("clipping");var Gt,Ai,Bi,Hi,Ci,Ni,ot=.5*ze.buffer/ze.extent,ri=.5-ot,Vt=.5+ot,Vi=1+ot;Gt=Ai=Bi=Hi=null,Ci=oi(ce,st,ue-ot,ue+Vt,0,Tt.minX,Tt.maxX,ze),Ni=oi(ce,st,ue+ri,ue+Vi,0,Tt.minX,Tt.maxX,ze),ce=null,Ci&&(Gt=oi(Ci,st,ge-ot,ge+Vt,1,Tt.minY,Tt.maxY,ze),Ai=oi(Ci,st,ge+ri,ge+Vi,1,Tt.minY,Tt.maxY,ze),Ci=null),Ni&&(Bi=oi(Ni,st,ge-ot,ge+Vt,1,Tt.minY,Tt.maxY,ze),Hi=oi(Ni,st,ge+ri,ge+Vi,1,Tt.minY,Tt.maxY,ze),Ni=null),Ge>1&&console.timeEnd("clipping"),Fe.push(Gt||[],ie+1,2*ue,2*ge),Fe.push(Ai||[],ie+1,2*ue,2*ge+1),Fe.push(Bi||[],ie+1,2*ue+1,2*ge),Fe.push(Hi||[],ie+1,2*ue+1,2*ge+1)}}},Zt.prototype.getTile=function(ce,ie,ue){var ge=this.options,xe=ge.extent,Ee=ge.debug;if(ce<0||ce>24)return null;var we=1<<ce,Fe=bi(ce,ie=(ie%we+we)%we,ue);if(this.tiles[Fe])return Wt(this.tiles[Fe],xe);Ee>1&&console.log("drilling down to z%d-%d-%d",ce,ie,ue);for(var ze,Ge=ce,st=ie,vt=ue;!ze&&Ge>0;)Ge--,st=Math.floor(st/2),vt=Math.floor(vt/2),ze=this.tiles[bi(Ge,st,vt)];return ze&&ze.source?(Ee>1&&console.log("found parent tile z%d-%d-%d",Ge,st,vt),Ee>1&&console.time("drilling down"),this.splitTile(ze.source,Ge,st,vt,ce,ie,ue),Ee>1&&console.timeEnd("drilling down"),this.tiles[Fe]?Wt(this.tiles[Fe],xe):null):null};class Qe extends U{constructor(ie,ue,ge,xe){super(ie,ue,ge),this._dataUpdateable=new Map,this.loadGeoJSON=(Ee,we)=>{const{promoteId:Fe}=Ee;if(Ee.request)return s.f(Ee.request,(ze,Ge,st,vt)=>{this._dataUpdateable=_r(Ge,Fe)?Zr(Ge,Fe):void 0,we(ze,Ge,st,vt)});if(typeof Ee.data=="string")try{const ze=JSON.parse(Ee.data);this._dataUpdateable=_r(ze,Fe)?Zr(ze,Fe):void 0,we(null,ze)}catch{we(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`))}else Ee.dataDiff?this._dataUpdateable?(function(ze,Ge,st){var vt,Tt,Kt,ii;if(Ge.removeAll&&ze.clear(),Ge.remove)for(const Gt of Ge.remove)ze.delete(Gt);if(Ge.add)for(const Gt of Ge.add){const Ai=ei(Gt,st);Ai!=null&&ze.set(Ai,Gt)}if(Ge.update)for(const Gt of Ge.update){let Ai=ze.get(Gt.id);if(Ai==null)continue;const Bi=!Gt.removeAllProperties&&(((vt=Gt.removeProperties)===null||vt===void 0?void 0:vt.length)>0||((Tt=Gt.addOrUpdateProperties)===null||Tt===void 0?void 0:Tt.length)>0);if((Gt.newGeometry||Gt.removeAllProperties||Bi)&&(Ai=Object.assign({},Ai),ze.set(Gt.id,Ai),Bi&&(Ai.properties=Object.assign({},Ai.properties))),Gt.newGeometry&&(Ai.geometry=Gt.newGeometry),Gt.removeAllProperties)Ai.properties={};else if(((Kt=Gt.removeProperties)===null||Kt===void 0?void 0:Kt.length)>0)for(const Hi of Gt.removeProperties)Object.prototype.hasOwnProperty.call(Ai.properties,Hi)&&delete Ai.properties[Hi];if(((ii=Gt.addOrUpdateProperties)===null||ii===void 0?void 0:ii.length)>0)for(const{key:Hi,value:Ci}of Gt.addOrUpdateProperties)Ai.properties[Hi]=Ci}}(this._dataUpdateable,Ee.dataDiff,Fe),we(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):we(new Error(`Cannot update existing geojson data in ${Ee.source}`)):we(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,xe&&(this.loadGeoJSON=xe)}loadGeoJSONTile(ie,ue){const ge=ie.tileID.canonical;if(!this._geoJSONIndex)return ue(null,null);const xe=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!xe)return ue(null,null);const Ee=new class{constructor(Fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=Fe.length,this._features=Fe}feature(Fe){return new class{constructor(ze){this._feature=ze,this.extent=s.N,this.type=ze.type,this.properties=ze.tags,"id"in ze&&!isNaN(ze.id)&&(this.id=parseInt(ze.id,10))}loadGeometry(){if(this._feature.type===1){const ze=[];for(const Ge of this._feature.geometry)ze.push([new s.P(Ge[0],Ge[1])]);return ze}{const ze=[];for(const Ge of this._feature.geometry){const st=[];for(const vt of Ge)st.push(new s.P(vt[0],vt[1]));ze.push(st)}return ze}}toGeoJSON(ze,Ge,st){return pe.call(this,ze,Ge,st)}}(this._features[Fe])}}(xe.features);let we=Rt(Ee);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),ue(null,{vectorTile:Ee,rawData:we.buffer})}loadData(ie,ue){var ge;(ge=this._pendingRequest)===null||ge===void 0||ge.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const xe=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new s.bu(ie.request);this._pendingCallback=ue,this._pendingRequest=this.loadGeoJSON(ie,(Ee,we)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ee||!we)return ue(Ee);if(typeof we!="object")return ue(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));{he(we,!0);try{if(ie.filter){const ze=s.bC(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(st=>`${st.key}: ${st.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(st=>ze.value.evaluate({zoom:0},st))}}this._geoJSONIndex=ie.cluster?new mt(function(ze){let{superclusterOptions:Ge,clusterProperties:st}=ze;if(!st||!Ge)return Ge;const vt={},Tt={},Kt={accumulated:null,zoom:0},ii={properties:null},Gt=Object.keys(st);for(const Ai of Gt){const[Bi,Hi]=st[Ai],Ci=s.bC(Hi),Ni=s.bC(typeof Bi=="string"?[Bi,["accumulated"],["get",Ai]]:Bi);vt[Ai]=Ci.value,Tt[Ai]=Ni.value}return Ge.map=Ai=>{ii.properties=Ai;const Bi={};for(const Hi of Gt)Bi[Hi]=vt[Hi].evaluate(Kt,ii);return Bi},Ge.reduce=(Ai,Bi)=>{ii.properties=Bi;for(const Hi of Gt)Kt.accumulated=Ai[Hi],Ai[Hi]=Tt[Hi].evaluate(Kt,ii)},Ge}(ie)).load(we.features):function(ze,Ge){return new Zt(ze,Ge)}(we,ie.geojsonVtOptions)}catch(ze){return ue(ze)}this.loaded={};const Fe={};if(xe){const ze=xe.finish();ze&&(Fe.resourceTiming={},Fe.resourceTiming[ie.source]=JSON.parse(JSON.stringify(ze)))}ue(null,Fe)}})}reloadTile(ie,ue){const ge=this.loaded;return ge&&ge[ie.uid]?super.reloadTile(ie,ue):this.loadTile(ie,ue)}removeSource(ie,ue){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ue()}getClusterExpansionZoom(ie,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(ge){ue(ge)}}getClusterChildren(ie,ue){try{ue(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(ge){ue(ge)}}getClusterLeaves(ie,ue){try{ue(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(ge){ue(ge)}}}class Be{constructor(ie){this.self=ie,this.actor=new s.C(ie,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:U,geojson:Qe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ue,ge)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=ge},this.self.registerRTLTextPlugin=ue=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=ue.applyArabicShaping,s.bD.processBidirectionalText=ue.processBidirectionalText,s.bD.processStyledBidirectionalText=ue.processStyledBidirectionalText}}setReferrer(ie,ue){this.referrer=ue}setImages(ie,ue,ge){this.availableImages[ie]=ue;for(const xe in this.workerSources[ie]){const Ee=this.workerSources[ie][xe];for(const we in Ee)Ee[we].availableImages=ue}ge()}setLayers(ie,ue,ge){this.getLayerIndex(ie).replace(ue),ge()}updateLayers(ie,ue,ge){this.getLayerIndex(ie).update(ue.layers,ue.removedIds),ge()}loadTile(ie,ue,ge){this.getWorkerSource(ie,ue.type,ue.source).loadTile(ue,ge)}loadDEMTile(ie,ue,ge){this.getDEMWorkerSource(ie,ue.source).loadTile(ue,ge)}reloadTile(ie,ue,ge){this.getWorkerSource(ie,ue.type,ue.source).reloadTile(ue,ge)}abortTile(ie,ue,ge){this.getWorkerSource(ie,ue.type,ue.source).abortTile(ue,ge)}removeTile(ie,ue,ge){this.getWorkerSource(ie,ue.type,ue.source).removeTile(ue,ge)}removeDEMTile(ie,ue){this.getDEMWorkerSource(ie,ue.source).removeTile(ue)}removeSource(ie,ue,ge){if(!this.workerSources[ie]||!this.workerSources[ie][ue.type]||!this.workerSources[ie][ue.type][ue.source])return;const xe=this.workerSources[ie][ue.type][ue.source];delete this.workerSources[ie][ue.type][ue.source],xe.removeSource!==void 0?xe.removeSource(ue,ge):ge()}loadWorkerSource(ie,ue,ge){try{this.self.importScripts(ue.url),ge()}catch(xe){ge(xe.toString())}}syncRTLPluginState(ie,ue,ge){try{s.bD.setState(ue);const xe=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&xe!=null){this.self.importScripts(xe);const Ee=s.bD.isParsed();ge(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xe}`),Ee)}}catch(xe){ge(xe.toString())}}getAvailableImages(ie){let ue=this.availableImages[ie];return ue||(ue=[]),ue}getLayerIndex(ie){let ue=this.layerIndexes[ie];return ue||(ue=this.layerIndexes[ie]=new g),ue}getWorkerSource(ie,ue,ge){return this.workerSources[ie]||(this.workerSources[ie]={}),this.workerSources[ie][ue]||(this.workerSources[ie][ue]={}),this.workerSources[ie][ue][ge]||(this.workerSources[ie][ue][ge]=new this.workerSourceTypes[ue]({send:(xe,Ee,we)=>{this.actor.send(xe,Ee,we,ie)}},this.getLayerIndex(ie),this.getAvailableImages(ie))),this.workerSources[ie][ue][ge]}getDEMWorkerSource(ie,ue){return this.demWorkerSources[ie]||(this.demWorkerSources[ie]={}),this.demWorkerSources[ie][ue]||(this.demWorkerSources[ie][ue]=new J),this.demWorkerSources[ie][ue]}}return s.i()&&(self.worker=new Be(self)),Be}),o(["./shared"],function(s){var g="3.6.2";class v{static testProp(A){if(!v.docStyle)return A[0];for(let b=0;b<A.length;b++)if(A[b]in v.docStyle)return A[b];return A[0]}static create(A,b,L){const O=window.document.createElement(A);return b!==void 0&&(O.className=b),L&&L.appendChild(O),O}static createNS(A,b){return window.document.createElementNS(A,b)}static disableDrag(){v.docStyle&&v.selectProp&&(v.userSelect=v.docStyle[v.selectProp],v.docStyle[v.selectProp]="none")}static enableDrag(){v.docStyle&&v.selectProp&&(v.docStyle[v.selectProp]=v.userSelect)}static setTransform(A,b){A.style[v.transformProp]=b}static addEventListener(A,b,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.addEventListener(b,L,"passive"in O?O:O.capture)}static removeEventListener(A,b,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.removeEventListener(b,L,"passive"in O?O:O.capture)}static suppressClickInternal(A){A.preventDefault(),A.stopPropagation(),window.removeEventListener("click",v.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",v.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",v.suppressClickInternal,!0)},0)}static mousePos(A,b){const L=A.getBoundingClientRect();return new s.P(b.clientX-L.left-A.clientLeft,b.clientY-L.top-A.clientTop)}static touchPos(A,b){const L=A.getBoundingClientRect(),O=[];for(let z=0;z<b.length;z++)O.push(new s.P(b[z].clientX-L.left-A.clientLeft,b[z].clientY-L.top-A.clientTop));return O}static mouseButton(A){return A.button}static remove(A){A.parentNode&&A.parentNode.removeChild(A)}}v.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,v.selectProp=v.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),v.transformProp=v.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(N){!U&&R&&(J?te(N):F=N)}};let F,R,U=!1,J=!1;function te(N){const A=N.createTexture();N.bindTexture(N.TEXTURE_2D,A);try{if(N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,R),N.isContextLost())return;T.supported=!0}catch{}N.deleteTexture(A),U=!0}var Ae,he;typeof document<"u"&&(R=document.createElement("img"),R.onload=function(){F&&te(F),F=null,J=!0},R.onerror=function(){U=!0,F=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(N){let A,b,L,O;N.resetRequestQueue=()=>{A=[],b=0,L=0,O={}},N.addThrottleControl=p=>{const x=L++;return O[x]=p,x},N.removeThrottleControl=p=>{delete O[p],w()},N.getImage=function(p,x){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;T.supported&&(p.headers||(p.headers={}),p.headers.accept="image/webp,*/*");const I={requestParameters:p,supportImageRefresh:B,callback:x,cancelled:!1,completed:!1,cancel:()=>{I.completed||I.cancelled||(I.cancelled=!0,I.innerRequest&&(I.innerRequest.cancel(),b--),w())}};return A.push(I),w(),I};const z=p=>{const{requestParameters:x,supportImageRefresh:B,callback:I}=p;return s.e(x,{type:"image"}),(B!==!1||s.i()||s.g(x.url)||x.headers&&!Object.keys(x.headers).reduce((j,y)=>j&&y==="accept",!0)?s.m:a)(x,(j,y,E,P)=>{X(p,I,j,y,E,P)})},X=(p,x,B,I,j,y)=>{B?x(B):I instanceof HTMLImageElement||s.a(I)?x(null,I):I&&((E,P)=>{typeof createImageBitmap=="function"?s.b(E,P):s.d(E,P)})(I,(E,P)=>{E!=null?x(E):P!=null&&x(null,P,{cacheControl:j,expires:y})}),p.cancelled||(p.completed=!0,b--,w())},w=()=>{const p=(()=>{const x=Object.keys(O);let B=!1;if(x.length>0){for(const I of x)if(B=O[I](),B)break}return B})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let x=b;x<p&&A.length>0;x++){const B=A.shift();if(B.cancelled){x--;continue}const I=z(B);b++,B.innerRequest=I}},a=(p,x)=>{const B=new Image,I=p.url;let j=!1;const y=p.credentials;return y&&y==="include"?B.crossOrigin="use-credentials":(y&&y==="same-origin"||!s.s(I))&&(B.crossOrigin="anonymous"),B.fetchPriority="high",B.onload=()=>{x(null,B),B.onerror=B.onload=null},B.onerror=()=>{j||x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),B.onerror=B.onload=null},B.src=I,{cancel:()=>{j=!0,B.src=""}}}}(Ae||(Ae={})),Ae.resetRequestQueue(),function(N){N.Glyphs="Glyphs",N.Image="Image",N.Source="Source",N.SpriteImage="SpriteImage",N.SpriteJSON="SpriteJSON",N.Style="Style",N.Tile="Tile",N.Unknown="Unknown"}(he||(he={}));class pe{constructor(A){this._transformRequestFn=A}transformRequest(A,b){return this._transformRequestFn&&this._transformRequestFn(A,b)||{url:A}}normalizeSpriteURL(A,b,L){const O=function(z){const X=z.match(be);if(!X)throw new Error(`Unable to parse URL "${z}"`);return{protocol:X[1],authority:X[2],path:X[3]||"/",params:X[4]?X[4].split("&"):[]}}(A);return O.path+=`${b}${L}`,function(z){const X=z.params.length?`?${z.params.join("&")}`:"";return`${z.protocol}://${z.authority}${z.path}${X}`}(O)}setTransformRequest(A){this._transformRequestFn=A}}const be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Te(N){var A=new s.A(3);return A[0]=N[0],A[1]=N[1],A[2]=N[2],A}var qe,je=function(N,A,b){return N[0]=A[0]-b[0],N[1]=A[1]-b[1],N[2]=A[2]-b[2],N};qe=new s.A(3),s.A!=Float32Array&&(qe[0]=0,qe[1]=0,qe[2]=0);var We=function(N){var A=N[0],b=N[1];return A*A+b*b};function Ne(N){const A=[];if(typeof N=="string")A.push({id:"default",url:N});else if(N&&N.length>0){const b=[];for(const{id:L,url:O}of N){const z=`${L}${O}`;b.indexOf(z)===-1&&(b.push(z),A.push({id:L,url:O}))}}return A}function at(N,A,b,L,O){if(L)return void N(L);if(O!==Object.values(A).length||O!==Object.values(b).length)return;const z={};for(const X in A){z[X]={};const w=s.h.getImageCanvasContext(b[X]),a=A[X];for(const p in a){const{width:x,height:B,x:I,y:j,sdf:y,pixelRatio:E,stretchX:P,stretchY:V,content:q}=a[p];z[X][p]={data:null,pixelRatio:E,sdf:y,stretchX:P,stretchY:V,content:q,spriteData:{width:x,height:B,x:I,y:j,context:w}}}}N(null,z)}(function(){var N=new s.A(2);s.A!=Float32Array&&(N[0]=0,N[1]=0)})();class nt{constructor(A,b,L,O){this.context=A,this.format=L,this.texture=A.gl.createTexture(),this.update(b,O)}update(A,b,L){const{width:O,height:z}=A,X=!(this.size&&this.size[0]===O&&this.size[1]===z||L),{context:w}=this,{gl:a}=w;if(this.useMipmap=!!(b&&b.useMipmap),a.bindTexture(a.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!b||b.premultiply!==!1)),X)this.size=[O,z],A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,A):a.texImage2D(a.TEXTURE_2D,0,this.format,O,z,0,this.format,a.UNSIGNED_BYTE,A.data);else{const{x:p,y:x}=L||{x:0,y:0};A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?a.texSubImage2D(a.TEXTURE_2D,0,p,x,a.RGBA,a.UNSIGNED_BYTE,A):a.texSubImage2D(a.TEXTURE_2D,0,p,x,O,z,a.RGBA,a.UNSIGNED_BYTE,A.data)}this.useMipmap&&this.isSizePowerOfTwo()&&a.generateMipmap(a.TEXTURE_2D)}bind(A,b,L){const{context:O}=this,{gl:z}=O;z.bindTexture(z.TEXTURE_2D,this.texture),L!==z.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(L=z.LINEAR),A!==this.filter&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,A),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,L||A),this.filter=A),b!==this.wrap&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,b),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,b),this.wrap=b)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:A}=this.context;A.deleteTexture(this.texture),this.texture=null}}function ke(N){const{userImage:A}=N;return!!(A&&A.render&&A.render())&&(N.data.replace(new Uint8Array(A.data.buffer)),!0)}class De extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(A){if(this.loaded!==A&&(this.loaded=A,A)){for(const{ids:b,callback:L}of this.requestors)this._notify(b,L);this.requestors=[]}}getImage(A){const b=this.images[A];if(b&&!b.data&&b.spriteData){const L=b.spriteData;b.data=new s.R({width:L.width,height:L.height},L.context.getImageData(L.x,L.y,L.width,L.height).data),b.spriteData=null}return b}addImage(A,b){if(this.images[A])throw new Error(`Image id ${A} already exist, use updateImage instead`);this._validate(A,b)&&(this.images[A]=b)}_validate(A,b){let L=!0;const O=b.data||b.spriteData;return this._validateStretch(b.stretchX,O&&O.width)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchX" value`))),L=!1),this._validateStretch(b.stretchY,O&&O.height)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchY" value`))),L=!1),this._validateContent(b.content,b)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "content" value`))),L=!1),L}_validateStretch(A,b){if(!A)return!0;let L=0;for(const O of A){if(O[0]<L||O[1]<O[0]||b<O[1])return!1;L=O[1]}return!0}_validateContent(A,b){if(!A)return!0;if(A.length!==4)return!1;const L=b.spriteData,O=L&&L.width||b.data.width,z=L&&L.height||b.data.height;return!(A[0]<0||O<A[0]||A[1]<0||z<A[1]||A[2]<0||O<A[2]||A[3]<0||z<A[3]||A[2]<A[0]||A[3]<A[1])}updateImage(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const O=this.getImage(A);if(L&&(O.data.width!==b.data.width||O.data.height!==b.data.height))throw new Error(`size mismatch between old image (${O.data.width}x${O.data.height}) and new image (${b.data.width}x${b.data.height}).`);b.version=O.version+1,this.images[A]=b,this.updatedImages[A]=!0}removeImage(A){const b=this.images[A];delete this.images[A],delete this.patterns[A],b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(A,b){let L=!0;if(!this.isLoaded())for(const O of A)this.images[O]||(L=!1);this.isLoaded()||L?this._notify(A,b):this.requestors.push({ids:A,callback:b})}_notify(A,b){const L={};for(const O of A){let z=this.getImage(O);z||(this.fire(new s.k("styleimagemissing",{id:O})),z=this.getImage(O)),z?L[O]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:!!(z.userImage&&z.userImage.render)}:s.w(`Image "${O}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}b(null,L)}getPixelSize(){const{width:A,height:b}=this.atlasImage;return{width:A,height:b}}getPattern(A){const b=this.patterns[A],L=this.getImage(A);if(!L)return null;if(b&&b.position.version===L.version)return b.position;if(b)b.position.version=L.version;else{const O={w:L.data.width+2,h:L.data.height+2,x:0,y:0},z=new s.I(O,L);this.patterns[A]={bin:O,position:z}}return this._updatePatternAtlas(),this.patterns[A].position}bind(A){const b=A.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new nt(A,this.atlasImage,b.RGBA),this.atlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE)}_updatePatternAtlas(){const A=[];for(const z in this.patterns)A.push(this.patterns[z].bin);const{w:b,h:L}=s.p(A),O=this.atlasImage;O.resize({width:b||1,height:L||1});for(const z in this.patterns){const{bin:X}=this.patterns[z],w=X.x+1,a=X.y+1,p=this.getImage(z).data,x=p.width,B=p.height;s.R.copy(p,O,{x:0,y:0},{x:w,y:a},{width:x,height:B}),s.R.copy(p,O,{x:0,y:B-1},{x:w,y:a-1},{width:x,height:1}),s.R.copy(p,O,{x:0,y:0},{x:w,y:a+B},{width:x,height:1}),s.R.copy(p,O,{x:x-1,y:0},{x:w-1,y:a},{width:1,height:B}),s.R.copy(p,O,{x:0,y:0},{x:w+x,y:a},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(A){for(const b of A){if(this.callbackDispatchedThisFrame[b])continue;this.callbackDispatchedThisFrame[b]=!0;const L=this.getImage(b);L||s.w(`Image with ID: "${b}" was not found`),ke(L)&&this.updateImage(b,L)}}}const Ye=1e20;function Ze(N,A,b,L,O,z,X,w,a){for(let p=A;p<A+L;p++)Ct(N,b*z+p,z,O,X,w,a);for(let p=b;p<b+O;p++)Ct(N,p*z+A,1,L,X,w,a)}function Ct(N,A,b,L,O,z,X){z[0]=0,X[0]=-Ye,X[1]=Ye,O[0]=N[A];for(let w=1,a=0,p=0;w<L;w++){O[w]=N[A+w*b];const x=w*w;do{const B=z[a];p=(O[w]-O[B]+x-B*B)/(w-B)/2}while(p<=X[a]&&--a>-1);a++,z[a]=w,X[a]=p,X[a+1]=Ye}for(let w=0,a=0;w<L;w++){for(;X[a+1]<w;)a++;const p=z[a],x=w-p;N[A+w*b]=O[p]+x*x}}class Et{constructor(A,b){this.requestManager=A,this.localIdeographFontFamily=b,this.entries={}}setURL(A){this.url=A}getGlyphs(A,b){const L=[];for(const O in A)for(const z of A[O])L.push({stack:O,id:z});s.o(L,(O,z)=>{let{stack:X,id:w}=O,a=this.entries[X];a||(a=this.entries[X]={glyphs:{},requests:{},ranges:{}});let p=a.glyphs[w];if(p!==void 0)return void z(null,{stack:X,id:w,glyph:p});if(p=this._tinySDF(a,X,w),p)return a.glyphs[w]=p,void z(null,{stack:X,id:w,glyph:p});const x=Math.floor(w/256);if(256*x>65535)return void z(new Error("glyphs > 65535 not supported"));if(a.ranges[x])return void z(null,{stack:X,id:w,glyph:p});if(!this.url)return void z(new Error("glyphsUrl is not set"));let B=a.requests[x];B||(B=a.requests[x]=[],Et.loadGlyphRange(X,x,this.url,this.requestManager,(I,j)=>{if(j){for(const y in j)this._doesCharSupportLocalGlyph(+y)||(a.glyphs[+y]=j[+y]);a.ranges[x]=!0}for(const y of B)y(I,j);delete a.requests[x]})),B.push((I,j)=>{I?z(I):j&&z(null,{stack:X,id:w,glyph:j[w]||null})})},(O,z)=>{if(O)b(O);else if(z){const X={};for(const{stack:w,id:a,glyph:p}of z)(X[w]||(X[w]={}))[a]=p&&{id:p.id,bitmap:p.bitmap.clone(),metrics:p.metrics};b(null,X)}})}_doesCharSupportLocalGlyph(A){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](A)||s.u["Hangul Syllables"](A)||s.u.Hiragana(A)||s.u.Katakana(A))}_tinySDF(A,b,L){const O=this.localIdeographFontFamily;if(!O||!this._doesCharSupportLocalGlyph(L))return;let z=A.tinySDF;if(!z){let w="400";/bold/i.test(b)?w="900":/medium/i.test(b)?w="500":/light/i.test(b)&&(w="200"),z=A.tinySDF=new Et.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:O,fontWeight:w})}const X=z.draw(String.fromCharCode(L));return{id:L,bitmap:new s.q({width:X.width||60,height:X.height||60},X.data),metrics:{width:X.glyphWidth/2||24,height:X.glyphHeight/2||24,left:X.glyphLeft/2+.5||0,top:X.glyphTop/2-27.5||-8,advance:X.glyphAdvance/2||24,isDoubleResolution:!0}}}}Et.loadGlyphRange=function(N,A,b,L,O){const z=256*A,X=z+255,w=L.transformRequest(b.replace("{fontstack}",N).replace("{range}",`${z}-${X}`),he.Glyphs);s.l(w,(a,p)=>{if(a)O(a);else if(p){const x={};for(const B of s.n(p))x[B.id]=B;O(null,x)}})},Et.TinySDF=class{constructor(){let{fontSize:N=24,buffer:A=3,radius:b=8,cutoff:L=.25,fontFamily:O="sans-serif",fontWeight:z="normal",fontStyle:X="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=A,this.cutoff=L,this.radius=b;const w=this.size=N+4*A,a=this._createCanvas(w),p=this.ctx=a.getContext("2d",{willReadFrequently:!0});p.font=`${X} ${z} ${N}px ${O}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(N){const A=document.createElement("canvas");return A.width=A.height=N,A}draw(N){const{width:A,actualBoundingBoxAscent:b,actualBoundingBoxDescent:L,actualBoundingBoxLeft:O,actualBoundingBoxRight:z}=this.ctx.measureText(N),X=Math.ceil(b),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(z-O))),a=Math.min(this.size-this.buffer,X+Math.ceil(L)),p=w+2*this.buffer,x=a+2*this.buffer,B=Math.max(p*x,0),I=new Uint8ClampedArray(B),j={data:I,width:p,height:x,glyphWidth:w,glyphHeight:a,glyphTop:X,glyphLeft:0,glyphAdvance:A};if(w===0||a===0)return j;const{ctx:y,buffer:E,gridInner:P,gridOuter:V}=this;y.clearRect(E,E,w,a),y.fillText(N,E,E+X);const q=y.getImageData(E,E,w,a);V.fill(Ye,0,B),P.fill(0,0,B);for(let K=0;K<a;K++)for(let ee=0;ee<w;ee++){const se=q.data[4*(K*w+ee)+3]/255;if(se===0)continue;const oe=(K+E)*p+ee+E;if(se===1)V[oe]=0,P[oe]=Ye;else{const le=.5-se;V[oe]=le>0?le*le:0,P[oe]=le<0?le*le:0}}Ze(V,0,0,p,x,p,this.f,this.v,this.z),Ze(P,E,E,w,a,p,this.f,this.v,this.z);for(let K=0;K<B;K++){const ee=Math.sqrt(V[K])-Math.sqrt(P[K]);I[K]=Math.round(255-255*(ee/this.radius+this.cutoff))}return j}};class Pt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(A,b){return s.z(A.expression.evaluate(b))}interpolate(A,b,L){return{x:s.B.number(A.x,b.x,L),y:s.B.number(A.y,b.y,L),z:s.B.number(A.z,b.z,L)}}}let bt;class Rt extends s.E{constructor(A){super(),bt=bt||new s.r({anchor:new s.D(s.v.light.anchor),position:new Pt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(bt),this.setLight(A),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.t,A,b))for(const L in A){const O=A[L];L.endsWith("-transition")?this._transitionable.setTransition(L.slice(0,-11),O):this._transitionable.setValue(L,O)}}updateTransitions(A){this._transitioning=this._transitionable.transitioned(A,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(A){this.properties=this._transitioning.possiblyEvaluate(A)}_validate(A,b,L){return(!L||L.validate!==!1)&&s.x(this,A.call(s.y,s.e({value:b,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class Ft{constructor(A,b){this.width=A,this.height=b,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(A,b){const L=A.join(",")+String(b);return this.dashEntry[L]||(this.dashEntry[L]=this.addDash(A,b)),this.dashEntry[L]}getDashRanges(A,b,L){const O=[];let z=A.length%2==1?-A[A.length-1]*L:0,X=A[0]*L,w=!0;O.push({left:z,right:X,isDash:w,zeroLength:A[0]===0});let a=A[0];for(let p=1;p<A.length;p++){w=!w;const x=A[p];z=a*L,a+=x,X=a*L,O.push({left:z,right:X,isDash:w,zeroLength:x===0})}return O}addRoundDash(A,b,L){const O=b/2;for(let z=-L;z<=L;z++){const X=this.width*(this.nextRow+L+z);let w=0,a=A[w];for(let p=0;p<this.width;p++){p/a.right>1&&(a=A[++w]);const x=Math.abs(p-a.left),B=Math.abs(p-a.right),I=Math.min(x,B);let j;const y=z/L*(O+1);if(a.isDash){const E=O-Math.abs(y);j=Math.sqrt(I*I+E*E)}else j=O-Math.sqrt(I*I+y*y);this.data[X+p]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(A){for(let w=A.length-1;w>=0;--w){const a=A[w],p=A[w+1];a.zeroLength?A.splice(w,1):p&&p.isDash===a.isDash&&(p.left=a.left,A.splice(w,1))}const b=A[0],L=A[A.length-1];b.isDash===L.isDash&&(b.left=L.left-this.width,L.right=b.right+this.width);const O=this.width*this.nextRow;let z=0,X=A[z];for(let w=0;w<this.width;w++){w/X.right>1&&(X=A[++z]);const a=Math.abs(w-X.left),p=Math.abs(w-X.right),x=Math.min(a,p);this.data[O+w]=Math.max(0,Math.min(255,(X.isDash?x:-x)+128))}}addDash(A,b){const L=b?7:0,O=2*L+1;if(this.nextRow+O>this.height)return s.w("LineAtlas out of space"),null;let z=0;for(let w=0;w<A.length;w++)z+=A[w];if(z!==0){const w=this.width/z,a=this.getDashRanges(A,this.width,w);b?this.addRoundDash(a,w,L):this.addRegularDash(a)}const X={y:(this.nextRow+L+.5)/this.height,height:2*L/this.height,width:z};return this.nextRow+=O,this.dirty=!0,X}bind(A){const b=A.gl;this.texture?(b.bindTexture(b.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,b.texSubImage2D(b.TEXTURE_2D,0,0,0,this.width,this.height,b.ALPHA,b.UNSIGNED_BYTE,this.data))):(this.texture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,this.texture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.ALPHA,this.width,this.height,0,b.ALPHA,b.UNSIGNED_BYTE,this.data))}}class Xt{constructor(A,b,L){this.workerPool=A,this.actors=[],this.currentActor=0,this.id=L;const O=this.workerPool.acquire(L);for(let z=0;z<O.length;z++){const X=new s.C(O[z],b,L);X.name=`Worker ${z}`,this.actors.push(X)}if(!this.actors.length)throw new Error("No actors found")}broadcast(A,b,L){s.o(this.actors,(O,z)=>{O.send(A,b,z)},L=L||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(b=>{b.remove()}),this.actors=[],A&&this.workerPool.release(this.id)}}function Le(N,A,b){const L=function(O,z){if(O)return b(O);if(z){const X=s.F(s.e(z,N),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);z.vector_layers&&(X.vectorLayers=z.vector_layers,X.vectorLayerIds=X.vectorLayers.map(w=>w.id)),b(null,X)}};return N.url?s.f(A.transformRequest(N.url,he.Source),L):s.h.frame(()=>L(null,N))}class Xe{constructor(A,b){A&&(b?this.setSouthWest(A).setNorthEast(b):Array.isArray(A)&&(A.length===4?this.setSouthWest([A[0],A[1]]).setNorthEast([A[2],A[3]]):this.setSouthWest(A[0]).setNorthEast(A[1])))}setNorthEast(A){return this._ne=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}setSouthWest(A){return this._sw=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}extend(A){const b=this._sw,L=this._ne;let O,z;if(A instanceof s.L)O=A,z=A;else{if(!(A instanceof Xe))return Array.isArray(A)?A.length===4||A.every(Array.isArray)?this.extend(Xe.convert(A)):this.extend(s.L.convert(A)):A&&("lng"in A||"lon"in A)&&"lat"in A?this.extend(s.L.convert(A)):this;if(O=A._sw,z=A._ne,!O||!z)return this}return b||L?(b.lng=Math.min(O.lng,b.lng),b.lat=Math.min(O.lat,b.lat),L.lng=Math.max(z.lng,L.lng),L.lat=Math.max(z.lat,L.lat)):(this._sw=new s.L(O.lng,O.lat),this._ne=new s.L(z.lng,z.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(A){const{lng:b,lat:L}=s.L.convert(A);let O=this._sw.lng<=b&&b<=this._ne.lng;return this._sw.lng>this._ne.lng&&(O=this._sw.lng>=b&&b>=this._ne.lng),this._sw.lat<=L&&L<=this._ne.lat&&O}static convert(A){return A instanceof Xe?A:A&&new Xe(A)}static fromLngLat(A){const L=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,O=L/Math.cos(Math.PI/180*A.lat);return new Xe(new s.L(A.lng-O,A.lat-L),new s.L(A.lng+O,A.lat+L))}}class it{constructor(A,b,L){this.bounds=Xe.convert(this.validateBounds(A)),this.minzoom=b||0,this.maxzoom=L||24}validateBounds(A){return Array.isArray(A)&&A.length===4?[Math.max(-180,A[0]),Math.max(-90,A[1]),Math.min(180,A[2]),Math.min(90,A[3])]:[-180,-90,180,90]}contains(A){const b=Math.pow(2,A.z),L=Math.floor(s.G(this.bounds.getWest())*b),O=Math.floor(s.H(this.bounds.getNorth())*b),z=Math.ceil(s.G(this.bounds.getEast())*b),X=Math.ceil(s.H(this.bounds.getSouth())*b);return A.x>=L&&A.x<z&&A.y>=O&&A.y<X}}class pt extends s.E{constructor(A,b,L,O){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Le(this._options,this.map._requestManager,(z,X)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),z?this.fire(new s.j(z)):X&&(s.e(this,X),X.bounds&&(this.tileBounds=new it(X.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=A,this.dispatcher=L,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(b,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},b),this._collectResourceTiming=b.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(O)}loaded(){return this._loaded}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}onAdd(A){this.map=A,this.load()}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}setUrl(A){return this.setSourceProperty(()=>{this.url=A,this._options.url=A}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(A,b){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),O={request:this.map._requestManager.transformRequest(L,he.Tile),uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,tileSize:this.tileSize*A.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function z(X,w){return delete A.request,A.aborted?b(null):X&&X.status!==404?b(X):(w&&w.resourceTiming&&(A.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&A.setExpiryData(w),A.loadVectorData(w,this.map.painter),b(null),void(A.reloadCallback&&(this.loadTile(A,A.reloadCallback),A.reloadCallback=null)))}O.request.collectResourceTiming=this._collectResourceTiming,A.actor&&A.state!=="expired"?A.state==="loading"?A.reloadCallback=b:A.request=A.actor.send("reloadTile",O,z.bind(this)):(A.actor=this.dispatcher.getActor(),A.request=A.actor.send("loadTile",O,z.bind(this)))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.actor&&A.actor.send("abortTile",{uid:A.uid,type:this.type,source:this.id},void 0)}unloadTile(A){A.unloadVectorData(),A.actor&&A.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class mt extends s.E{constructor(A,b,L,O){super(),this.id=A,this.dispatcher=L,this.setEventedParent(O),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},b),s.e(this,s.F(b,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Le(this._options,this.map._requestManager,(A,b)=>{this._tileJSONRequest=null,this._loaded=!0,A?this.fire(new s.j(A)):b&&(s.e(this,b),b.bounds&&(this.tileBounds=new it(b.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(A){this.map=A,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}serialize(){return s.e({},this._options)}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}loadTile(A,b){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);A.request=Ae.getImage(this.map._requestManager.transformRequest(L,he.Tile),(O,z,X)=>{if(delete A.request,A.aborted)A.state="unloaded",b(null);else if(O)A.state="errored",b(O);else if(z){this.map._refreshExpiredTiles&&X&&A.setExpiryData(X);const w=this.map.painter.context,a=w.gl;A.texture=this.map.painter.getTileTexture(z.width),A.texture?A.texture.update(z,{useMipmap:!0}):(A.texture=new nt(w,z,a.RGBA,{useMipmap:!0}),A.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),A.state="loaded",b(null)}},this.map._refreshExpiredTiles)}abortTile(A,b){A.request&&(A.request.cancel(),delete A.request),b()}unloadTile(A,b){A.texture&&this.map.painter.saveTileTexture(A.texture),b()}hasTransition(){return!1}}class Bt extends mt{constructor(A,b,L,O){super(A,b,L,O),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},b),this.encoding=b.encoding||"mapbox",this.redFactor=b.redFactor,this.greenFactor=b.greenFactor,this.blueFactor=b.blueFactor,this.baseShift=b.baseShift}loadTile(A,b){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),O=this.map._requestManager.transformRequest(L,he.Tile);function z(X,w){X&&(A.state="errored",b(X)),w&&(A.dem=w,A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0,A.state="loaded",b(null))}A.neighboringTiles=this._getNeighboringTiles(A.tileID),A.request=Ae.getImage(O,(X,w,a)=>s._(this,void 0,void 0,function*(){if(delete A.request,A.aborted)A.state="unloaded",b(null);else if(X)A.state="errored",b(X);else if(w){this.map._refreshExpiredTiles&&A.setExpiryData(a);const p=s.a(w)&&s.J()?w:yield function(B){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const I=B.width+2,j=B.height+2;try{return new s.R({width:I,height:j},yield s.M(B,-1,-1,I,j))}catch{}}return s.h.getImageData(B,1)})}(w),x={uid:A.uid,coord:A.tileID,source:this.id,rawImageData:p,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};A.actor&&A.state!=="expired"||(A.actor=this.dispatcher.getActor(),A.actor.send("loadDEMTile",x,z))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(A){const b=A.canonical,L=Math.pow(2,b.z),O=(b.x-1+L)%L,z=b.x===0?A.wrap-1:A.wrap,X=(b.x+1+L)%L,w=b.x+1===L?A.wrap+1:A.wrap,a={};return a[new s.O(A.overscaledZ,z,b.z,O,b.y).key]={backfilled:!1},a[new s.O(A.overscaledZ,w,b.z,X,b.y).key]={backfilled:!1},b.y>0&&(a[new s.O(A.overscaledZ,z,b.z,O,b.y-1).key]={backfilled:!1},a[new s.O(A.overscaledZ,A.wrap,b.z,b.x,b.y-1).key]={backfilled:!1},a[new s.O(A.overscaledZ,w,b.z,X,b.y-1).key]={backfilled:!1}),b.y+1<L&&(a[new s.O(A.overscaledZ,z,b.z,O,b.y+1).key]={backfilled:!1},a[new s.O(A.overscaledZ,A.wrap,b.z,b.x,b.y+1).key]={backfilled:!1},a[new s.O(A.overscaledZ,w,b.z,X,b.y+1).key]={backfilled:!1}),a}unloadTile(A){A.demTexture&&this.map.painter.saveTileTexture(A.demTexture),A.fbo&&(A.fbo.destroy(),delete A.fbo),A.dem&&delete A.dem,delete A.neighboringTiles,A.state="unloaded",A.actor&&A.actor.send("removeDEMTile",{uid:A.uid,source:this.id})}}class Dt extends s.E{constructor(A,b,L,O){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=A,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=L.getActor(),this.setEventedParent(O),this._data=b.data,this._options=s.e({},b),this._collectResourceTiming=b.collectResourceTiming,b.maxzoom!==void 0&&(this.maxzoom=b.maxzoom),b.type&&(this.type=b.type),b.attribution&&(this.attribution=b.attribution),this.promoteId=b.promoteId;const z=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:b.cluster||!1,geojsonVtOptions:{buffer:(b.buffer!==void 0?b.buffer:128)*z,tolerance:(b.tolerance!==void 0?b.tolerance:.375)*z,extent:s.N,maxZoom:this.maxzoom,lineMetrics:b.lineMetrics||!1,generateId:b.generateId||!1},superclusterOptions:{maxZoom:b.clusterMaxZoom!==void 0?b.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,b.clusterMinPoints||2),extent:s.N,radius:(b.clusterRadius||50)*z,log:!1,generateId:b.generateId||!1},clusterProperties:b.clusterProperties,filter:b.filter},b.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(A){this.map=A,this.load()}setData(A){return this._data=A,this._updateWorkerData(),this}updateData(A){return this._updateWorkerData(A),this}setClusterOptions(A){return this.workerOptions.cluster=A.cluster,A&&(A.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=A.clusterRadius),A.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=A.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(A,b){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:A,source:this.id},b),this}getClusterChildren(A,b){return this.actor.send("geojson.getClusterChildren",{clusterId:A,source:this.id},b),this}getClusterLeaves(A,b,L,O){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:A,limit:b,offset:L},O),this}_updateWorkerData(A){const b=s.e({},this.workerOptions);A?b.dataDiff=A:typeof this._data=="string"?(b.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),he.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,b,(L,O)=>{if(this._pendingLoads--,this._removed||O&&O.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let z=null;if(O&&O.resourceTiming&&O.resourceTiming[this.id]&&(z=O.resourceTiming[this.id].slice(0)),L)return void this.fire(new s.j(L));const X={dataType:"source"};this._collectResourceTiming&&z&&z.length>0&&s.e(X,{resourceTiming:z}),this.fire(new s.k("data",Object.assign(Object.assign({},X),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},X),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(A,b){const L=A.actor?"reloadTile":"loadTile";A.actor=this.actor;const O={type:this.type,uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};A.request=this.actor.send(L,O,(z,X)=>(delete A.request,A.unloadVectorData(),A.aborted?b(null):z?b(z):(A.loadVectorData(X,this.map.painter,L==="reloadTile"),b(null))))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.aborted=!0}unloadTile(A){A.unloadVectorData(),this.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Mt=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class qt extends s.E{constructor(A,b,L,O){super(),this.load=(z,X)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Ae.getImage(this.map._requestManager.transformRequest(this.url,he.Image),(w,a)=>{this._request=null,this._loaded=!0,w?this.fire(new s.j(w)):a&&(this.image=a,z&&(this.coordinates=z),X&&X(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const z=this.map.painter.context,X=z.gl;this.boundsBuffer||(this.boundsBuffer=z.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new nt(z,this.image,X.RGBA),this.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE));let w=!1;for(const a in this.tiles){const p=this.tiles[a];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=A,this.dispatcher=L,this.coordinates=b.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(O),this.options=b}loaded(){return this._loaded}updateImage(A){return A.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=A.url,this.load(A.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(A){this.map=A,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(A){this.coordinates=A;const b=A.map(s.U.fromLngLat);this.tileID=function(O){let z=1/0,X=1/0,w=-1/0,a=-1/0;for(const I of O)z=Math.min(z,I.x),X=Math.min(X,I.y),w=Math.max(w,I.x),a=Math.max(a,I.y);const p=Math.max(w-z,a-X),x=Math.max(0,Math.floor(-Math.log(p)/Math.LN2)),B=Math.pow(2,x);return new s.W(x,Math.floor((z+w)/2*B),Math.floor((X+a)/2*B))}(b),this.minzoom=this.maxzoom=this.tileID.z;const L=b.map(O=>this.tileID.getTilePoint(O)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(L[0].x,L[0].y,0,0),this._boundsArray.emplaceBack(L[1].x,L[1].y,s.N,0),this._boundsArray.emplaceBack(L[3].x,L[3].y,0,s.N),this._boundsArray.emplaceBack(L[2].x,L[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(A,b){this.tileID&&this.tileID.equals(A.tileID.canonical)?(this.tiles[String(A.tileID.wrap)]=A,A.buckets={},b(null)):(A.state="errored",b(null))}hasTransition(){return!1}}class ni extends qt{constructor(A,b,L,O){super(A,b,L,O),this.load=()=>{this._loaded=!1;const z=this.options;this.urls=[];for(const X of z.urls)this.urls.push(this.map._requestManager.transformRequest(X,he.Source).url);s.X(this.urls,(X,w)=>{this._loaded=!0,X?this.fire(new s.j(X)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const z=this.map.painter.context,X=z.gl;this.boundsBuffer||(this.boundsBuffer=z.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE),X.texSubImage2D(X.TEXTURE_2D,0,0,0,X.RGBA,X.UNSIGNED_BYTE,this.video)):(this.texture=new nt(z,this.video,X.RGBA),this.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE));let w=!1;for(const a in this.tiles){const p=this.tiles[a];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=b}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(A){if(this.video){const b=this.video.seekable;A<b.start(0)||A>b.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${b.start(0)} and ${b.end(0)}-second mark.`))):this.video.currentTime=A}}getVideo(){return this.video}onAdd(A){this.map||(this.map=A,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class _i extends qt{constructor(A,b,L,O){super(A,b,L,O),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let z=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,z=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,z=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const X=this.map.painter.context,w=X.gl;this.boundsBuffer||(this.boundsBuffer=X.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(z||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new nt(X,this.canvas,w.RGBA,{premultiply:!0});let a=!1;for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,a=!0)}a&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),b.coordinates?Array.isArray(b.coordinates)&&b.coordinates.length===4&&!b.coordinates.some(z=>!Array.isArray(z)||z.length!==2||z.some(X=>typeof X!="number"))||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "coordinates"'))),b.animate&&typeof b.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${A}`,null,'optional "animate" property must be a boolean value'))),b.canvas?typeof b.canvas=="string"||b.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "canvas"'))),this.options=b,this.animate=b.animate===void 0||b.animate}getCanvas(){return this.canvas}onAdd(A){this.map=A,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const A of[this.canvas.width,this.canvas.height])if(isNaN(A)||A<=0)return!0;return!1}}const vi={},Pi=N=>{switch(N){case"geojson":return Dt;case"image":return qt;case"raster":return mt;case"raster-dem":return Bt;case"vector":return pt;case"video":return ni;case"canvas":return _i}return vi[N]};function kt(N,A){const b=s.Z();return s.$(b,b,[1,1,0]),s.a0(b,b,[.5*N.width,.5*N.height,1]),s.a1(b,b,N.calculatePosMatrix(A.toUnwrapped()))}function lt(N,A,b,L,O,z){const X=function(B,I,j){if(B)for(const y of B){const E=I[y];if(E&&E.source===j&&E.type==="fill-extrusion")return!0}else for(const y in I){const E=I[y];if(E.source===j&&E.type==="fill-extrusion")return!0}return!1}(O&&O.layers,A,N.id),w=z.maxPitchScaleFactor(),a=N.tilesIn(L,w,X);a.sort(wt);const p=[];for(const B of a)p.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(A,b,N._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,O,z,w,kt(N.transform,B.tileID))});const x=function(B){const I={},j={};for(const y of B){const E=y.queryResults,P=y.wrappedTileID,V=j[P]=j[P]||{};for(const q in E){const K=E[q],ee=V[q]=V[q]||{},se=I[q]=I[q]||[];for(const oe of K)ee[oe.featureIndex]||(ee[oe.featureIndex]=!0,se.push(oe))}}return I}(p);for(const B in x)x[B].forEach(I=>{const j=I.feature,y=N.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=y});return x}function wt(N,A){const b=N.tileID,L=A.tileID;return b.overscaledZ-L.overscaledZ||b.canonical.y-L.canonical.y||b.wrap-L.wrap||b.canonical.x-L.canonical.x}class Oi{constructor(A,b){this.timeAdded=0,this.fadeEndTime=0,this.tileID=A,this.uid=s.a2(),this.uses=0,this.tileSize=b,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(A){const b=A+this.timeAdded;b<this.fadeEndTime||(this.fadeEndTime=b)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(A){this.demTexture&&A.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(A,b,L){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",A){A.featureIndex&&(this.latestFeatureIndex=A.featureIndex,A.rawTileData?(this.latestRawTileData=A.rawTileData,this.latestFeatureIndex.rawTileData=A.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=A.collisionBoxArray,this.buckets=function(O,z){const X={};if(!z)return X;for(const w of O){const a=w.layerIds.map(p=>z.getLayer(p)).filter(Boolean);if(a.length!==0){w.layers=a,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(p=>a.filter(x=>x.id===p)[0]));for(const p of a)X[p.id]=w}}return X}(A.buckets,b.style),this.hasSymbolBuckets=!1;for(const O in this.buckets){const z=this.buckets[O];if(z instanceof s.a4){if(this.hasSymbolBuckets=!0,!L)break;z.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const O in this.buckets){const z=this.buckets[O];if(z instanceof s.a4&&z.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const O in this.buckets){const z=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,b.style.getLayer(O).queryRadius(z))}A.imageAtlas&&(this.imageAtlas=A.imageAtlas),A.glyphAtlasImage&&(this.glyphAtlasImage=A.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const A in this.buckets)this.buckets[A].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(A){return this.buckets[A.id]}upload(A){for(const L in this.buckets){const O=this.buckets[L];O.uploadPending()&&O.upload(A)}const b=A.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new nt(A,this.imageAtlas.image,b.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new nt(A,this.glyphAtlasImage,b.ALPHA),this.glyphAtlasImage=null)}prepare(A){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(A,this.imageAtlasTexture)}queryRenderedFeatures(A,b,L,O,z,X,w,a,p,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:O,cameraQueryGeometry:z,scale:X,tileSize:this.tileSize,pixelPosMatrix:x,transform:a,params:w,queryPadding:this.queryPadding*p},A,b,L):{}}querySourceFeatures(A,b){const L=this.latestFeatureIndex;if(!L||!L.rawTileData)return;const O=L.loadVTLayers(),z=b&&b.sourceLayer?b.sourceLayer:"",X=O._geojsonTileLayer||O[z];if(!X)return;const w=s.a6(b&&b.filter),{z:a,x:p,y:x}=this.tileID.canonical,B={z:a,x:p,y:x};for(let I=0;I<X.length;I++){const j=X.feature(I);if(w.needGeometry){const P=s.a7(j,!0);if(!w.filter(new s.a8(this.tileID.overscaledZ),P,this.tileID.canonical))continue}else if(!w.filter(new s.a8(this.tileID.overscaledZ),j))continue;const y=L.getId(j,z),E=new s.a9(j,a,p,x,y);E.tile=B,A.push(E)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(A){const b=this.expirationTime;if(A.cacheControl){const L=s.aa(A.cacheControl);L["max-age"]&&(this.expirationTime=Date.now()+1e3*L["max-age"])}else A.expires&&(this.expirationTime=new Date(A.expires).getTime());if(this.expirationTime){const L=Date.now();let O=!1;if(this.expirationTime>L)O=!1;else if(b)if(this.expirationTime<b)O=!0;else{const z=this.expirationTime-b;z?this.expirationTime=L+Math.max(z,3e4):O=!0}else O=!0;O?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(A,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(A).length===0)return;const L=this.latestFeatureIndex.loadVTLayers();for(const O in this.buckets){if(!b.style.hasLayer(O))continue;const z=this.buckets[O],X=z.layers[0].sourceLayer||"_geojsonTileLayer",w=L[X],a=A[X];if(!w||!a||Object.keys(a).length===0)continue;z.update(a,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const p=b&&b.style&&b.style.getLayer(O);p&&(this.queryPadding=Math.max(this.queryPadding,p.queryRadius(z)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(A){this.symbolFadeHoldUntil=s.h.now()+A}setDependencies(A,b){const L={};for(const O of b)L[O]=!0;this.dependencies[A]=L}hasDependency(A,b){for(const L of A){const O=this.dependencies[L];if(O){for(const z of b)if(O[z])return!0}}return!1}}class ti{constructor(A,b){this.max=A,this.onRemove=b,this.reset()}reset(){for(const A in this.data)for(const b of this.data[A])b.timeout&&clearTimeout(b.timeout),this.onRemove(b.value);return this.data={},this.order=[],this}add(A,b,L){const O=A.wrapped().key;this.data[O]===void 0&&(this.data[O]=[]);const z={value:b,timeout:void 0};if(L!==void 0&&(z.timeout=setTimeout(()=>{this.remove(A,z)},L)),this.data[O].push(z),this.order.push(O),this.order.length>this.max){const X=this._getAndRemoveByKey(this.order[0]);X&&this.onRemove(X)}return this}has(A){return A.wrapped().key in this.data}getAndRemove(A){return this.has(A)?this._getAndRemoveByKey(A.wrapped().key):null}_getAndRemoveByKey(A){const b=this.data[A].shift();return b.timeout&&clearTimeout(b.timeout),this.data[A].length===0&&delete this.data[A],this.order.splice(this.order.indexOf(A),1),b.value}getByKey(A){const b=this.data[A];return b?b[0].value:null}get(A){return this.has(A)?this.data[A.wrapped().key][0].value:null}remove(A,b){if(!this.has(A))return this;const L=A.wrapped().key,O=b===void 0?0:this.data[L].indexOf(b),z=this.data[L][O];return this.data[L].splice(O,1),z.timeout&&clearTimeout(z.timeout),this.data[L].length===0&&delete this.data[L],this.onRemove(z.value),this.order.splice(this.order.indexOf(L),1),this}setMaxSize(A){for(this.max=A;this.order.length>this.max;){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}filter(A){const b=[];for(const L in this.data)for(const O of this.data[L])A(O.value)||b.push(O);for(const L of b)this.remove(L.value.tileID,L)}}class ht{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(A,b,L){const O=String(b);if(this.stateChanges[A]=this.stateChanges[A]||{},this.stateChanges[A][O]=this.stateChanges[A][O]||{},s.e(this.stateChanges[A][O],L),this.deletedStates[A]===null){this.deletedStates[A]={};for(const z in this.state[A])z!==O&&(this.deletedStates[A][z]=null)}else if(this.deletedStates[A]&&this.deletedStates[A][O]===null){this.deletedStates[A][O]={};for(const z in this.state[A][O])L[z]||(this.deletedStates[A][O][z]=null)}else for(const z in L)this.deletedStates[A]&&this.deletedStates[A][O]&&this.deletedStates[A][O][z]===null&&delete this.deletedStates[A][O][z]}removeFeatureState(A,b,L){if(this.deletedStates[A]===null)return;const O=String(b);if(this.deletedStates[A]=this.deletedStates[A]||{},L&&b!==void 0)this.deletedStates[A][O]!==null&&(this.deletedStates[A][O]=this.deletedStates[A][O]||{},this.deletedStates[A][O][L]=null);else if(b!==void 0)if(this.stateChanges[A]&&this.stateChanges[A][O])for(L in this.deletedStates[A][O]={},this.stateChanges[A][O])this.deletedStates[A][O][L]=null;else this.deletedStates[A][O]=null;else this.deletedStates[A]=null}getState(A,b){const L=String(b),O=s.e({},(this.state[A]||{})[L],(this.stateChanges[A]||{})[L]);if(this.deletedStates[A]===null)return{};if(this.deletedStates[A]){const z=this.deletedStates[A][b];if(z===null)return{};for(const X in z)delete O[X]}return O}initializeTileState(A,b){A.setFeatureState(this.state,b)}coalesceChanges(A,b){const L={};for(const O in this.stateChanges){this.state[O]=this.state[O]||{};const z={};for(const X in this.stateChanges[O])this.state[O][X]||(this.state[O][X]={}),s.e(this.state[O][X],this.stateChanges[O][X]),z[X]=this.state[O][X];L[O]=z}for(const O in this.deletedStates){this.state[O]=this.state[O]||{};const z={};if(this.deletedStates[O]===null)for(const X in this.state[O])z[X]={},this.state[O][X]={};else for(const X in this.deletedStates[O]){if(this.deletedStates[O][X]===null)this.state[O][X]={};else for(const w of Object.keys(this.deletedStates[O][X]))delete this.state[O][X][w];z[X]=this.state[O][X]}L[O]=L[O]||{},s.e(L[O],z)}if(this.stateChanges={},this.deletedStates={},Object.keys(L).length!==0)for(const O in A)A[O].setFeatureState(L,b)}}class $t extends s.E{constructor(A,b,L){super(),this.id=A,this.dispatcher=L,this.on("data",O=>{O.dataType==="source"&&O.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&O.dataType==="source"&&O.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((O,z,X,w)=>{const a=new(Pi(z.type))(O,z,X,w);if(a.id!==O)throw new Error(`Expected Source id to be ${O} instead of ${a.id}`);return a})(A,b,L,this),this._tiles={},this._cache=new ti(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ht,this._didEmitContent=!1,this._updated=!1}onAdd(A){this.map=A,this._maxTileCacheSize=A?A._maxTileCacheSize:null,this._maxTileCacheZoomLevels=A?A._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(A)}onRemove(A){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(A)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const A in this._tiles){const b=this._tiles[A];if(b.state!=="loaded"&&b.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const A=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,A&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(A,b){return this._source.loadTile(A,b)}_unloadTile(A){if(this._source.unloadTile)return this._source.unloadTile(A,()=>{})}_abortTile(A){this._source.abortTile&&this._source.abortTile(A,()=>{}),this._source.fire(new s.k("dataabort",{tile:A,coord:A.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(A){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const b in this._tiles){const L=this._tiles[b];L.upload(A),L.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(A=>A.tileID).sort(oi).map(A=>A.key)}getRenderableIds(A){const b=[];for(const L in this._tiles)this._isIdRenderable(L,A)&&b.push(this._tiles[L]);return A?b.sort((L,O)=>{const z=L.tileID,X=O.tileID,w=new s.P(z.canonical.x,z.canonical.y)._rotate(this.transform.angle),a=new s.P(X.canonical.x,X.canonical.y)._rotate(this.transform.angle);return z.overscaledZ-X.overscaledZ||a.y-w.y||a.x-w.x}).map(L=>L.tileID.key):b.map(L=>L.tileID).sort(oi).map(L=>L.key)}hasRenderableParent(A){const b=this.findLoadedParent(A,0);return!!b&&this._isIdRenderable(b.tileID.key)}_isIdRenderable(A,b){return this._tiles[A]&&this._tiles[A].hasData()&&!this._coveredTiles[A]&&(b||!this._tiles[A].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const A in this._tiles)this._tiles[A].state!=="errored"&&this._reloadTile(A,"reloading")}}_reloadTile(A,b){const L=this._tiles[A];L&&(L.state!=="loading"&&(L.state=b),this._loadTile(L,this._tileLoaded.bind(this,L,A,b)))}_tileLoaded(A,b,L,O){if(O)return A.state="errored",void(O.status!==404?this._source.fire(new s.j(O,{tile:A})):this.update(this.transform,this.terrain));A.timeAdded=s.h.now(),L==="expired"&&(A.refreshedUponExpiration=!0),this._setTileReloadTimer(b,A),this.getSource().type==="raster-dem"&&A.dem&&this._backfillDEM(A),this._state.initializeTileState(A,this.map?this.map.painter:null),A.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:A,coord:A.tileID}))}_backfillDEM(A){const b=this.getRenderableIds();for(let O=0;O<b.length;O++){const z=b[O];if(A.neighboringTiles&&A.neighboringTiles[z]){const X=this.getTileByID(z);L(A,X),L(X,A)}}function L(O,z){O.needsHillshadePrepare=!0,O.needsTerrainPrepare=!0;let X=z.tileID.canonical.x-O.tileID.canonical.x;const w=z.tileID.canonical.y-O.tileID.canonical.y,a=Math.pow(2,O.tileID.canonical.z),p=z.tileID.key;X===0&&w===0||Math.abs(w)>1||(Math.abs(X)>1&&(Math.abs(X+a)===1?X+=a:Math.abs(X-a)===1&&(X-=a)),z.dem&&O.dem&&(O.dem.backfillBorder(z.dem,X,w),O.neighboringTiles&&O.neighboringTiles[p]&&(O.neighboringTiles[p].backfilled=!0)))}}getTile(A){return this.getTileByID(A.key)}getTileByID(A){return this._tiles[A]}_retainLoadedChildren(A,b,L,O){for(const z in this._tiles){let X=this._tiles[z];if(O[z]||!X.hasData()||X.tileID.overscaledZ<=b||X.tileID.overscaledZ>L)continue;let w=X.tileID;for(;X&&X.tileID.overscaledZ>b+1;){const p=X.tileID.scaledTo(X.tileID.overscaledZ-1);X=this._tiles[p.key],X&&X.hasData()&&(w=p)}let a=w;for(;a.overscaledZ>b;)if(a=a.scaledTo(a.overscaledZ-1),A[a.key]){O[w.key]=w;break}}}findLoadedParent(A,b){if(A.key in this._loadedParentTiles){const L=this._loadedParentTiles[A.key];return L&&L.tileID.overscaledZ>=b?L:null}for(let L=A.overscaledZ-1;L>=b;L--){const O=A.scaledTo(L),z=this._getLoadedTile(O);if(z)return z}}_getLoadedTile(A){const b=this._tiles[A.key];return b&&b.hasData()?b:this._cache.getByKey(A.wrapped().key)}updateCacheSize(A){const b=Math.ceil(A.width/this._source.tileSize)+1,L=Math.ceil(A.height/this._source.tileSize)+1,O=Math.floor(b*L*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),z=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,O):O;this._cache.setMaxSize(z)}handleWrapJump(A){const b=Math.round((A-(this._prevLng===void 0?A:this._prevLng))/360);if(this._prevLng=A,b){const L={};for(const O in this._tiles){const z=this._tiles[O];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+b),L[z.tileID.key]=z}this._tiles=L;for(const O in this._timers)clearTimeout(this._timers[O]),delete this._timers[O];for(const O in this._tiles)this._setTileReloadTimer(O,this._tiles[O])}}update(A,b){if(this.transform=A,this.terrain=b,!this._sourceLoaded||this._paused)return;let L;this.updateCacheSize(A),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?L=A.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new s.O(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(L=A.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:b}),this._source.hasTile&&(L=L.filter(x=>this._source.hasTile(x)))):L=[];const O=A.coveringZoomLevel(this._source),z=Math.max(O-$t.maxOverzooming,this._source.minzoom),X=Math.max(O+$t.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const x={};for(const B of L)if(B.canonical.z>this._source.minzoom){const I=B.scaledTo(B.canonical.z-1);x[I.key]=I;const j=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));x[j.key]=j}L=L.concat(Object.values(x))}const w=L.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const a=this._updateRetainedTiles(L,O);if(gi(this._source.type)){const x={},B={},I=Object.keys(a),j=s.h.now();for(const y of I){const E=a[y],P=this._tiles[y];if(!P||P.fadeEndTime!==0&&P.fadeEndTime<=j)continue;const V=this.findLoadedParent(E,z);V&&(this._addTile(V.tileID),x[V.tileID.key]=V.tileID),B[y]=E}this._retainLoadedChildren(B,O,X,a);for(const y in x)a[y]||(this._coveredTiles[y]=!0,a[y]=x[y]);if(b){const y={},E={};for(const P of L)this._tiles[P.key].hasData()?y[P.key]=P:E[P.key]=P;for(const P in E){const V=E[P].children(this._source.maxzoom);this._tiles[V[0].key]&&this._tiles[V[1].key]&&this._tiles[V[2].key]&&this._tiles[V[3].key]&&(y[V[0].key]=a[V[0].key]=V[0],y[V[1].key]=a[V[1].key]=V[1],y[V[2].key]=a[V[2].key]=V[2],y[V[3].key]=a[V[3].key]=V[3],delete E[P])}for(const P in E){const V=this.findLoadedParent(E[P],this._source.minzoom);if(V){y[V.tileID.key]=a[V.tileID.key]=V.tileID;for(const q in y)y[q].isChildOf(V.tileID)&&delete y[q]}}for(const P in this._tiles)y[P]||(this._coveredTiles[P]=!0)}}for(const x in a)this._tiles[x].clearFadeHold();const p=s.ab(this._tiles,a);for(const x of p){const B=this._tiles[x];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(x)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const A in this._tiles)this._tiles[A].holdingForFade()&&this._removeTile(A)}_updateRetainedTiles(A,b){const L={},O={},z=Math.max(b-$t.maxOverzooming,this._source.minzoom),X=Math.max(b+$t.maxUnderzooming,this._source.minzoom),w={};for(const a of A){const p=this._addTile(a);L[a.key]=a,p.hasData()||b<this._source.maxzoom&&(w[a.key]=a)}this._retainLoadedChildren(w,b,X,L);for(const a of A){let p=this._tiles[a.key];if(p.hasData())continue;if(b+1>this._source.maxzoom){const B=a.children(this._source.maxzoom)[0],I=this.getTile(B);if(I&&I.hasData()){L[B.key]=B;continue}}else{const B=a.children(this._source.maxzoom);if(L[B[0].key]&&L[B[1].key]&&L[B[2].key]&&L[B[3].key])continue}let x=p.wasRequested();for(let B=a.overscaledZ-1;B>=z;--B){const I=a.scaledTo(B);if(O[I.key])break;if(O[I.key]=!0,p=this.getTile(I),!p&&x&&(p=this._addTile(I)),p){const j=p.hasData();if((x||j)&&(L[I.key]=I),x=p.wasRequested(),j)break}}}return L}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const A in this._tiles){const b=[];let L,O=this._tiles[A].tileID;for(;O.overscaledZ>0;){if(O.key in this._loadedParentTiles){L=this._loadedParentTiles[O.key];break}b.push(O.key);const z=O.scaledTo(O.overscaledZ-1);if(L=this._getLoadedTile(z),L)break;O=z}for(const z of b)this._loadedParentTiles[z]=L}}_addTile(A){let b=this._tiles[A.key];if(b)return b;b=this._cache.getAndRemove(A),b&&(this._setTileReloadTimer(A.key,b),b.tileID=A,this._state.initializeTileState(b,this.map?this.map.painter:null),this._cacheTimers[A.key]&&(clearTimeout(this._cacheTimers[A.key]),delete this._cacheTimers[A.key],this._setTileReloadTimer(A.key,b)));const L=b;return b||(b=new Oi(A,this._source.tileSize*A.overscaleFactor()),this._loadTile(b,this._tileLoaded.bind(this,b,A.key,b.state))),b.uses++,this._tiles[A.key]=b,L||this._source.fire(new s.k("dataloading",{tile:b,coord:b.tileID,dataType:"source"})),b}_setTileReloadTimer(A,b){A in this._timers&&(clearTimeout(this._timers[A]),delete this._timers[A]);const L=b.getExpiryTimeout();L&&(this._timers[A]=setTimeout(()=>{this._reloadTile(A,"expired"),delete this._timers[A]},L))}_removeTile(A){const b=this._tiles[A];b&&(b.uses--,delete this._tiles[A],this._timers[A]&&(clearTimeout(this._timers[A]),delete this._timers[A]),b.uses>0||(b.hasData()&&b.state!=="reloading"?this._cache.add(b.tileID,b,b.getExpiryTimeout()):(b.aborted=!0,this._abortTile(b),this._unloadTile(b))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const A in this._tiles)this._removeTile(A);this._cache.reset()}tilesIn(A,b,L){const O=[],z=this.transform;if(!z)return O;const X=L?z.getCameraQueryGeometry(A):A,w=A.map(y=>z.pointCoordinate(y,this.terrain)),a=X.map(y=>z.pointCoordinate(y,this.terrain)),p=this.getIds();let x=1/0,B=1/0,I=-1/0,j=-1/0;for(const y of a)x=Math.min(x,y.x),B=Math.min(B,y.y),I=Math.max(I,y.x),j=Math.max(j,y.y);for(let y=0;y<p.length;y++){const E=this._tiles[p[y]];if(E.holdingForFade())continue;const P=E.tileID,V=Math.pow(2,z.zoom-E.tileID.overscaledZ),q=b*E.queryPadding*s.N/E.tileSize/V,K=[P.getTilePoint(new s.U(x,B)),P.getTilePoint(new s.U(I,j))];if(K[0].x-q<s.N&&K[0].y-q<s.N&&K[1].x+q>=0&&K[1].y+q>=0){const ee=w.map(oe=>P.getTilePoint(oe)),se=a.map(oe=>P.getTilePoint(oe));O.push({tile:E,tileID:P,queryGeometry:ee,cameraQueryGeometry:se,scale:V})}}return O}getVisibleCoordinates(A){const b=this.getRenderableIds(A).map(L=>this._tiles[L].tileID);for(const L of b)L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped());return b}hasTransition(){if(this._source.hasTransition())return!0;if(gi(this._source.type)){const A=s.h.now();for(const b in this._tiles)if(this._tiles[b].fadeEndTime>=A)return!0}return!1}setFeatureState(A,b,L){this._state.updateState(A=A||"_geojsonTileLayer",b,L)}removeFeatureState(A,b,L){this._state.removeFeatureState(A=A||"_geojsonTileLayer",b,L)}getFeatureState(A,b){return this._state.getState(A=A||"_geojsonTileLayer",b)}setDependencies(A,b,L){const O=this._tiles[A];O&&O.setDependencies(b,L)}reloadTilesForDependencies(A,b){for(const L in this._tiles)this._tiles[L].hasDependency(A,b)&&this._reloadTile(L,"reloading");this._cache.filter(L=>!L.hasDependency(A,b))}}function oi(N,A){const b=Math.abs(2*N.wrap)-+(N.wrap<0),L=Math.abs(2*A.wrap)-+(A.wrap<0);return N.overscaledZ-A.overscaledZ||L-b||A.canonical.y-N.canonical.y||A.canonical.x-N.canonical.x}function gi(N){return N==="raster"||N==="image"||N==="video"}$t.maxOverzooming=10,$t.maxUnderzooming=3;const ci="mapboxgl_preloaded_worker_pool";class Ki{constructor(){this.active={}}acquire(A){if(!this.workers)for(this.workers=[];this.workers.length<Ki.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[A]=!0,this.workers.slice()}release(A){delete this.active[A],this.numActive()===0&&(this.workers.forEach(b=>{b.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ci]}numActive(){return Object.keys(this.active).length}}const tr=Math.floor(s.h.hardwareConcurrency/2);let pr;function Mr(){return pr||(pr=new Ki),pr}Ki.workerCount=s.ac(globalThis)?Math.max(Math.min(tr,3),1):1;class zt{constructor(A,b){this.reset(A,b)}reset(A,b){this.points=A||[],this._distances=[0];for(let L=1;L<this.points.length;L++)this._distances[L]=this._distances[L-1]+this.points[L].dist(this.points[L-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(b||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(A){if(this.points.length===1)return this.points[0];A=s.ad(A,0,1);let b=1,L=this._distances[b];const O=A*this.paddedLength+this.padding;for(;L<O&&b<this._distances.length;)L=this._distances[++b];const z=b-1,X=this._distances[z],w=L-X,a=w>0?(O-X)/w:0;return this.points[z].mult(1-a).add(this.points[b].mult(a))}}function Wi(N,A){let b=!0;return N==="always"||N!=="never"&&A!=="never"||(b=!1),b}class hi{constructor(A,b,L){const O=this.boxCells=[],z=this.circleCells=[];this.xCellCount=Math.ceil(A/L),this.yCellCount=Math.ceil(b/L);for(let X=0;X<this.xCellCount*this.yCellCount;X++)O.push([]),z.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=A,this.height=b,this.xScale=this.xCellCount/A,this.yScale=this.yCellCount/b,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(A,b,L,O,z){this._forEachCell(b,L,O,z,this._insertBoxCell,this.boxUid++),this.boxKeys.push(A),this.bboxes.push(b),this.bboxes.push(L),this.bboxes.push(O),this.bboxes.push(z)}insertCircle(A,b,L,O){this._forEachCell(b-O,L-O,b+O,L+O,this._insertCircleCell,this.circleUid++),this.circleKeys.push(A),this.circles.push(b),this.circles.push(L),this.circles.push(O)}_insertBoxCell(A,b,L,O,z,X){this.boxCells[z].push(X)}_insertCircleCell(A,b,L,O,z,X){this.circleCells[z].push(X)}_query(A,b,L,O,z,X,w){if(L<0||A>this.width||O<0||b>this.height)return[];const a=[];if(A<=0&&b<=0&&this.width<=L&&this.height<=O){if(z)return[{key:null,x1:A,y1:b,x2:L,y2:O}];for(let p=0;p<this.boxKeys.length;p++)a.push({key:this.boxKeys[p],x1:this.bboxes[4*p],y1:this.bboxes[4*p+1],x2:this.bboxes[4*p+2],y2:this.bboxes[4*p+3]});for(let p=0;p<this.circleKeys.length;p++){const x=this.circles[3*p],B=this.circles[3*p+1],I=this.circles[3*p+2];a.push({key:this.circleKeys[p],x1:x-I,y1:B-I,x2:x+I,y2:B+I})}}else this._forEachCell(A,b,L,O,this._queryCell,a,{hitTest:z,overlapMode:X,seenUids:{box:{},circle:{}}},w);return a}query(A,b,L,O){return this._query(A,b,L,O,!1,null)}hitTest(A,b,L,O,z,X){return this._query(A,b,L,O,!0,z,X).length>0}hitTestCircle(A,b,L,O,z){const X=A-L,w=A+L,a=b-L,p=b+L;if(w<0||X>this.width||p<0||a>this.height)return!1;const x=[];return this._forEachCell(X,a,w,p,this._queryCellCircle,x,{hitTest:!0,overlapMode:O,circle:{x:A,y:b,radius:L},seenUids:{box:{},circle:{}}},z),x.length>0}_queryCell(A,b,L,O,z,X,w,a){const{seenUids:p,hitTest:x,overlapMode:B}=w,I=this.boxCells[z];if(I!==null){const y=this.bboxes;for(const E of I)if(!p.box[E]){p.box[E]=!0;const P=4*E,V=this.boxKeys[E];if(A<=y[P+2]&&b<=y[P+3]&&L>=y[P+0]&&O>=y[P+1]&&(!a||a(V))&&(!x||!Wi(B,V.overlapMode))&&(X.push({key:V,x1:y[P],y1:y[P+1],x2:y[P+2],y2:y[P+3]}),x))return!0}}const j=this.circleCells[z];if(j!==null){const y=this.circles;for(const E of j)if(!p.circle[E]){p.circle[E]=!0;const P=3*E,V=this.circleKeys[E];if(this._circleAndRectCollide(y[P],y[P+1],y[P+2],A,b,L,O)&&(!a||a(V))&&(!x||!Wi(B,V.overlapMode))){const q=y[P],K=y[P+1],ee=y[P+2];if(X.push({key:V,x1:q-ee,y1:K-ee,x2:q+ee,y2:K+ee}),x)return!0}}}return!1}_queryCellCircle(A,b,L,O,z,X,w,a){const{circle:p,seenUids:x,overlapMode:B}=w,I=this.boxCells[z];if(I!==null){const y=this.bboxes;for(const E of I)if(!x.box[E]){x.box[E]=!0;const P=4*E,V=this.boxKeys[E];if(this._circleAndRectCollide(p.x,p.y,p.radius,y[P+0],y[P+1],y[P+2],y[P+3])&&(!a||a(V))&&!Wi(B,V.overlapMode))return X.push(!0),!0}}const j=this.circleCells[z];if(j!==null){const y=this.circles;for(const E of j)if(!x.circle[E]){x.circle[E]=!0;const P=3*E,V=this.circleKeys[E];if(this._circlesCollide(y[P],y[P+1],y[P+2],p.x,p.y,p.radius)&&(!a||a(V))&&!Wi(B,V.overlapMode))return X.push(!0),!0}}}_forEachCell(A,b,L,O,z,X,w,a){const p=this._convertToXCellCoord(A),x=this._convertToYCellCoord(b),B=this._convertToXCellCoord(L),I=this._convertToYCellCoord(O);for(let j=p;j<=B;j++)for(let y=x;y<=I;y++)if(z.call(this,A,b,L,O,this.xCellCount*y+j,X,w,a))return}_convertToXCellCoord(A){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(A*this.xScale)))}_convertToYCellCoord(A){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(A*this.yScale)))}_circlesCollide(A,b,L,O,z,X){const w=O-A,a=z-b,p=L+X;return p*p>w*w+a*a}_circleAndRectCollide(A,b,L,O,z,X,w){const a=(X-O)/2,p=Math.abs(A-(O+a));if(p>a+L)return!1;const x=(w-z)/2,B=Math.abs(b-(z+x));if(B>x+L)return!1;if(p<=a||B<=x)return!0;const I=p-a,j=B-x;return I*I+j*j<=L*L}}function Wt(N,A,b,L,O){const z=s.Z();return A?(s.a0(z,z,[1/O,1/O,1]),b||s.ae(z,z,L.angle)):s.a1(z,L.labelPlaneMatrix,N),z}function Ar(N,A,b,L,O){if(A){const z=s.af(N);return s.a0(z,z,[O,O,1]),b||s.ae(z,z,-L.angle),z}return L.glCoordMatrix}function Qt(N,A,b){let L;b?(L=[N.x,N.y,b(N.x,N.y),1],s.ag(L,L,A)):(L=[N.x,N.y,0,1],xe(L,L,A));const O=L[3];return{point:new s.P(L[0]/O,L[1]/O),signedDistanceFromCamera:O}}function Si(N,A){return .5+N/A*.5}function Ii(N,A){const b=N[0]/N[3],L=N[1]/N[3];return b>=-A[0]&&b<=A[0]&&L>=-A[1]&&L<=A[1]}function Zt(N,A,b,L,O,z,X,w,a,p){const x=L?N.textSizeData:N.iconSizeData,B=s.ah(x,b.transform.zoom),I=[256/b.width*2+1,256/b.height*2+1],j=L?N.text.dynamicLayoutVertexArray:N.icon.dynamicLayoutVertexArray;j.clear();const y=N.lineVertexArray,E=L?N.text.placedSymbolArray:N.icon.placedSymbolArray,P=b.transform.width/b.transform.height;let V=!1;for(let q=0;q<E.length;q++){const K=E.get(q);if(K.hidden||K.writingMode===s.ai.vertical&&!V){ge(K.numGlyphs,j);continue}let ee;if(V=!1,p?(ee=[K.anchorX,K.anchorY,p(K.anchorX,K.anchorY),1],s.ag(ee,ee,A)):(ee=[K.anchorX,K.anchorY,0,1],xe(ee,ee,A)),!Ii(ee,I)){ge(K.numGlyphs,j);continue}const se=Si(b.transform.cameraToCenterDistance,ee[3]),oe=s.aj(x,B,K),le=X?oe/se:oe*se,_e=new s.P(K.anchorX,K.anchorY),Ie=Qt(_e,O,p).point,ve={projections:{},offsets:{}},Se=_r(K,le,!1,w,A,O,z,N.glyphOffsetArray,y,j,Ie,_e,ve,P,a,p);V=Se.useVertical,(Se.notEnoughRoom||V||Se.needsFlipping&&_r(K,le,!0,w,A,O,z,N.glyphOffsetArray,y,j,Ie,_e,ve,P,a,p).notEnoughRoom)&&ge(K.numGlyphs,j)}L?N.text.dynamicLayoutVertexBuffer.updateData(j):N.icon.dynamicLayoutVertexBuffer.updateData(j)}function bi(N,A,b,L,O,z,X,w,a,p,x,B,I){const j=w.glyphStartIndex+w.numGlyphs,y=w.lineStartIndex,E=w.lineStartIndex+w.lineLength,P=A.getoffsetX(w.glyphStartIndex),V=A.getoffsetX(j-1),q=ie(N*P,b,L,O,z,X,w.segment,y,E,a,p,x,B,I);if(!q)return null;const K=ie(N*V,b,L,O,z,X,w.segment,y,E,a,p,x,B,I);return K?{first:q,last:K}:null}function ei(N,A,b,L){return N===s.ai.horizontal&&Math.abs(b.y-A.y)>Math.abs(b.x-A.x)*L?{useVertical:!0}:(N===s.ai.vertical?A.y<b.y:A.x>b.x)?{needsFlipping:!0}:null}function _r(N,A,b,L,O,z,X,w,a,p,x,B,I,j,y,E){const P=A/24,V=N.lineOffsetX*P,q=N.lineOffsetY*P;let K;if(N.numGlyphs>1){const ee=N.glyphStartIndex+N.numGlyphs,se=N.lineStartIndex,oe=N.lineStartIndex+N.lineLength,le=bi(P,w,V,q,b,x,B,N,a,z,I,y,E);if(!le)return{notEnoughRoom:!0};const _e=Qt(le.first.point,X,E).point,Ie=Qt(le.last.point,X,E).point;if(L&&!b){const ve=ei(N.writingMode,_e,Ie,j);if(ve)return ve}K=[le.first];for(let ve=N.glyphStartIndex+1;ve<ee-1;ve++)K.push(ie(P*w.getoffsetX(ve),V,q,b,x,B,N.segment,se,oe,a,z,I,y,E));K.push(le.last)}else{if(L&&!b){const se=Qt(B,O,E).point,oe=N.lineStartIndex+N.segment+1,le=new s.P(a.getx(oe),a.gety(oe)),_e=Qt(le,O,E),Ie=_e.signedDistanceFromCamera>0?_e.point:Zr(B,le,se,1,O,E),ve=ei(N.writingMode,se,Ie,j);if(ve)return ve}const ee=ie(P*w.getoffsetX(N.glyphStartIndex),V,q,b,x,B,N.segment,N.lineStartIndex,N.lineStartIndex+N.lineLength,a,z,I,y,E);if(!ee)return{notEnoughRoom:!0};K=[ee]}for(const ee of K)s.ak(p,ee.point,ee.angle);return{}}function Zr(N,A,b,L,O,z){const X=Qt(N.add(N.sub(A)._unit()),O,z).point,w=b.sub(X);return b.add(w._mult(L/w.mag()))}function Qe(N,A){const{projectionCache:b,lineVertexArray:L,labelPlaneMatrix:O,tileAnchorPoint:z,distanceFromAnchor:X,getElevation:w,previousVertex:a,direction:p,absOffsetX:x}=A;if(b.projections[N])return b.projections[N];const B=new s.P(L.getx(N),L.gety(N)),I=Qt(B,O,w);if(I.signedDistanceFromCamera>0)return b.projections[N]=I.point,I.point;const j=N-p;return Zr(X===0?z:new s.P(L.getx(j),L.gety(j)),B,a,x-X+1,O,w)}function Be(N,A,b){return N._unit()._perp()._mult(A*b)}function ce(N,A,b,L,O,z,X,w){const{projectionCache:a,direction:p}=w;if(a.offsets[N])return a.offsets[N];const x=b.add(A);if(N+p<L||N+p>=O)return a.offsets[N]=x,x;const B=Qe(N+p,w),I=Be(B.sub(b),X,p),j=b.add(I),y=B.add(I);return a.offsets[N]=s.al(z,x,j,y)||x,a.offsets[N]}function ie(N,A,b,L,O,z,X,w,a,p,x,B,I,j){const y=L?N-A:N+A;let E=y>0?1:-1,P=0;L&&(E*=-1,P=Math.PI),E<0&&(P+=Math.PI);let V,q,K=E>0?w+X:w+X+1,ee=O,se=O,oe=0,le=0;const _e=Math.abs(y),Ie=[];let ve;for(;oe+le<=_e;){if(K+=E,K<w||K>=a)return null;oe+=le,se=ee,q=V;const Oe={projectionCache:B,lineVertexArray:p,labelPlaneMatrix:x,tileAnchorPoint:z,distanceFromAnchor:oe,getElevation:j,previousVertex:se,direction:E,absOffsetX:_e};if(ee=Qe(K,Oe),b===0)Ie.push(se),ve=ee.sub(se);else{let Re;const Ve=ee.sub(se);Re=Ve.mag()===0?Be(Qe(K+E,Oe).sub(ee),b,E):Be(Ve,b,E),q||(q=se.add(Re)),V=ce(K,Re,ee,w,a,q,b,Oe),Ie.push(q),ve=V.sub(q)}le=ve.mag()}const Se=ve._mult((_e-oe)/le)._add(q||se),et=P+Math.atan2(ee.y-se.y,ee.x-se.x);return Ie.push(Se),{point:Se,angle:I?et:0,path:Ie}}const ue=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ge(N,A){for(let b=0;b<N;b++){const L=A.length;A.resize(L+4),A.float32.set(ue,3*L)}}function xe(N,A,b){const L=A[0],O=A[1];return N[0]=b[0]*L+b[4]*O+b[12],N[1]=b[1]*L+b[5]*O+b[13],N[3]=b[3]*L+b[7]*O+b[15],N}const Ee=100;class we{constructor(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new hi(A.width+200,A.height+200,25),L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new hi(A.width+200,A.height+200,25);this.transform=A,this.grid=b,this.ignoredGrid=L,this.pitchfactor=Math.cos(A._pitch)*A.cameraToCenterDistance,this.screenRightBoundary=A.width+Ee,this.screenBottomBoundary=A.height+Ee,this.gridRightBoundary=A.width+200,this.gridBottomBoundary=A.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(A,b,L,O,z,X){const w=this.projectAndGetPerspectiveRatio(O,A.anchorPointX,A.anchorPointY,X),a=L*w.perspectiveRatio,p=A.x1*a+w.point.x,x=A.y1*a+w.point.y,B=A.x2*a+w.point.x,I=A.y2*a+w.point.y;return!this.isInsideGrid(p,x,B,I)||b!=="always"&&this.grid.hitTest(p,x,B,I,b,z)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[p,x,B,I],offscreen:this.isOffscreen(p,x,B,I)}}placeCollisionCircles(A,b,L,O,z,X,w,a,p,x,B,I,j,y){const E=[],P=new s.P(b.anchorX,b.anchorY),V=Qt(P,X,y),q=Si(this.transform.cameraToCenterDistance,V.signedDistanceFromCamera),K=(x?z/q:z*q)/s.ap,ee=Qt(P,w,y).point,se=bi(K,O,b.lineOffsetX*K,b.lineOffsetY*K,!1,ee,P,b,L,w,{projections:{},offsets:{}},!1,y);let oe=!1,le=!1,_e=!0;if(se){const Ie=.5*I*q+j,ve=new s.P(-100,-100),Se=new s.P(this.screenRightBoundary,this.screenBottomBoundary),et=new zt,Oe=se.first,Re=se.last;let Ve=[];for(let ft=Oe.path.length-1;ft>=1;ft--)Ve.push(Oe.path[ft]);for(let ft=1;ft<Re.path.length;ft++)Ve.push(Re.path[ft]);const At=2.5*Ie;if(a){const ft=Ve.map(Nt=>Qt(Nt,a,y));Ve=ft.some(Nt=>Nt.signedDistanceFromCamera<=0)?[]:ft.map(Nt=>Nt.point)}let dt=[];if(Ve.length>0){const ft=Ve[0].clone(),Nt=Ve[0].clone();for(let It=1;It<Ve.length;It++)ft.x=Math.min(ft.x,Ve[It].x),ft.y=Math.min(ft.y,Ve[It].y),Nt.x=Math.max(Nt.x,Ve[It].x),Nt.y=Math.max(Nt.y,Ve[It].y);dt=ft.x>=ve.x&&Nt.x<=Se.x&&ft.y>=ve.y&&Nt.y<=Se.y?[Ve]:Nt.x<ve.x||ft.x>Se.x||Nt.y<ve.y||ft.y>Se.y?[]:s.am([Ve],ve.x,ve.y,Se.x,Se.y)}for(const ft of dt){et.reset(ft,.25*Ie);let Nt=0;Nt=et.length<=.5*Ie?1:Math.ceil(et.paddedLength/At)+1;for(let It=0;It<Nt;It++){const jt=It/Math.max(Nt-1,1),Ht=et.lerp(jt),Mi=Ht.x+Ee,mi=Ht.y+Ee;E.push(Mi,mi,Ie,0);const Ti=Mi-Ie,ui=mi-Ie,ar=Mi+Ie,er=mi+Ie;if(_e=_e&&this.isOffscreen(Ti,ui,ar,er),le=le||this.isInsideGrid(Ti,ui,ar,er),A!=="always"&&this.grid.hitTestCircle(Mi,mi,Ie,A,B)&&(oe=!0,!p))return{circles:[],offscreen:!1,collisionDetected:oe}}}}return{circles:!p&&oe||!le||q<this.perspectiveRatioCutoff?[]:E,offscreen:_e,collisionDetected:oe}}queryRenderedSymbols(A){if(A.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const b=[];let L=1/0,O=1/0,z=-1/0,X=-1/0;for(const x of A){const B=new s.P(x.x+Ee,x.y+Ee);L=Math.min(L,B.x),O=Math.min(O,B.y),z=Math.max(z,B.x),X=Math.max(X,B.y),b.push(B)}const w=this.grid.query(L,O,z,X).concat(this.ignoredGrid.query(L,O,z,X)),a={},p={};for(const x of w){const B=x.key;if(a[B.bucketInstanceId]===void 0&&(a[B.bucketInstanceId]={}),a[B.bucketInstanceId][B.featureIndex])continue;const I=[new s.P(x.x1,x.y1),new s.P(x.x2,x.y1),new s.P(x.x2,x.y2),new s.P(x.x1,x.y2)];s.an(b,I)&&(a[B.bucketInstanceId][B.featureIndex]=!0,p[B.bucketInstanceId]===void 0&&(p[B.bucketInstanceId]=[]),p[B.bucketInstanceId].push(B.featureIndex))}return p}insertCollisionBox(A,b,L,O,z,X){(L?this.ignoredGrid:this.grid).insert({bucketInstanceId:O,featureIndex:z,collisionGroupID:X,overlapMode:b},A[0],A[1],A[2],A[3])}insertCollisionCircles(A,b,L,O,z,X){const w=L?this.ignoredGrid:this.grid,a={bucketInstanceId:O,featureIndex:z,collisionGroupID:X,overlapMode:b};for(let p=0;p<A.length;p+=4)w.insertCircle(a,A[p],A[p+1],A[p+2])}projectAndGetPerspectiveRatio(A,b,L,O){let z;return O?(z=[b,L,O(b,L),1],s.ag(z,z,A)):(z=[b,L,0,1],xe(z,z,A)),{point:new s.P((z[0]/z[3]+1)/2*this.transform.width+Ee,(-z[1]/z[3]+1)/2*this.transform.height+Ee),perspectiveRatio:.5+this.transform.cameraToCenterDistance/z[3]*.5}}isOffscreen(A,b,L,O){return L<Ee||A>=this.screenRightBoundary||O<Ee||b>this.screenBottomBoundary}isInsideGrid(A,b,L,O){return L>=0&&A<this.gridRightBoundary&&O>=0&&b<this.gridBottomBoundary}getViewportMatrix(){const A=s.ao([]);return s.$(A,A,[-100,-100,0]),A}}function Fe(N,A,b){return A*(s.N/(N.tileSize*Math.pow(2,b-N.tileID.overscaledZ)))}class ze{constructor(A,b,L,O){this.opacity=A?Math.max(0,Math.min(1,A.opacity+(A.placed?b:-b))):O&&L?1:0,this.placed=L}isHidden(){return this.opacity===0&&!this.placed}}class Ge{constructor(A,b,L,O,z){this.text=new ze(A?A.text:null,b,L,z),this.icon=new ze(A?A.icon:null,b,O,z)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class st{constructor(A,b,L){this.text=A,this.icon=b,this.skipFade=L}}class vt{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class Tt{constructor(A,b,L,O,z){this.bucketInstanceId=A,this.featureIndex=b,this.sourceLayerIndex=L,this.bucketIndex=O,this.tileID=z}}class Kt{constructor(A){this.crossSourceCollisions=A,this.maxGroupID=0,this.collisionGroups={}}get(A){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[A]){const b=++this.maxGroupID;this.collisionGroups[A]={ID:b,predicate:L=>L.collisionGroupID===b}}return this.collisionGroups[A]}}function ii(N,A,b,L,O){const{horizontalAlign:z,verticalAlign:X}=s.au(N);return new s.P(-(z-.5)*A+L[0]*O,-(X-.5)*b+L[1]*O)}function Gt(N,A,b,L,O,z){const{x1:X,x2:w,y1:a,y2:p,anchorPointX:x,anchorPointY:B}=N,I=new s.P(A,b);return L&&I._rotate(O?z:-z),{x1:X+I.x,y1:a+I.y,x2:w+I.x,y2:p+I.y,anchorPointX:x,anchorPointY:B}}class Ai{constructor(A,b,L,O,z){this.transform=A.clone(),this.terrain=b,this.collisionIndex=new we(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=L,this.retainedQueryData={},this.collisionGroups=new Kt(O),this.collisionCircleArrays={},this.prevPlacement=z,z&&(z.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(A,b,L,O){const z=L.getBucket(b),X=L.latestFeatureIndex;if(!z||!X||b.id!==z.layerIds[0])return;const w=L.collisionBoxArray,a=z.layers[0].layout,p=Math.pow(2,this.transform.zoom-L.tileID.overscaledZ),x=L.tileSize/s.N,B=this.transform.calculatePosMatrix(L.tileID.toUnwrapped()),I=a.get("text-pitch-alignment")==="map",j=a.get("text-rotation-alignment")==="map",y=Fe(L,1,this.transform.zoom),E=Wt(B,I,j,this.transform,y);let P=null;if(I){const q=Ar(B,I,j,this.transform,y);P=s.a1([],this.transform.labelPlaneMatrix,q)}this.retainedQueryData[z.bucketInstanceId]=new Tt(z.bucketInstanceId,X,z.sourceLayerIndex,z.index,L.tileID);const V={bucket:z,layout:a,posMatrix:B,textLabelPlaneMatrix:E,labelToScreenMatrix:P,scale:p,textPixelRatio:x,holdingForFade:L.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:s.ah(z.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(z.sourceID)};if(O)for(const q of z.sortKeyRanges){const{sortKey:K,symbolInstanceStart:ee,symbolInstanceEnd:se}=q;A.push({sortKey:K,symbolInstanceStart:ee,symbolInstanceEnd:se,parameters:V})}else A.push({symbolInstanceStart:0,symbolInstanceEnd:z.symbolInstances.length,parameters:V})}attemptAnchorPlacement(A,b,L,O,z,X,w,a,p,x,B,I,j,y,E,P){const V=s.aq[A.textAnchor],q=[A.textOffset0,A.textOffset1],K=ii(V,L,O,q,z),ee=this.collisionIndex.placeCollisionBox(Gt(b,K.x,K.y,X,w,this.transform.angle),B,a,p,x.predicate,P);if((!E||this.collisionIndex.placeCollisionBox(Gt(E,K.x,K.y,X,w,this.transform.angle),B,a,p,x.predicate,P).box.length!==0)&&ee.box.length>0){let se;if(this.prevPlacement&&this.prevPlacement.variableOffsets[I.crossTileID]&&this.prevPlacement.placements[I.crossTileID]&&this.prevPlacement.placements[I.crossTileID].text&&(se=this.prevPlacement.variableOffsets[I.crossTileID].anchor),I.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[I.crossTileID]={textOffset:q,width:L,height:O,anchor:V,textBoxScale:z,prevAnchor:se},this.markUsedJustification(j,V,I,y),j.allowVerticalPlacement&&(this.markUsedOrientation(j,y,I),this.placedOrientations[I.crossTileID]=y),{shift:K,placedGlyphBoxes:ee}}}placeLayerBucketPart(A,b,L){const{bucket:O,layout:z,posMatrix:X,textLabelPlaneMatrix:w,labelToScreenMatrix:a,textPixelRatio:p,holdingForFade:x,collisionBoxArray:B,partiallyEvaluatedTextSize:I,collisionGroup:j}=A.parameters,y=z.get("text-optional"),E=z.get("icon-optional"),P=s.ar(z,"text-overlap","text-allow-overlap"),V=P==="always",q=s.ar(z,"icon-overlap","icon-allow-overlap"),K=q==="always",ee=z.get("text-rotation-alignment")==="map",se=z.get("text-pitch-alignment")==="map",oe=z.get("icon-text-fit")!=="none",le=z.get("symbol-z-order")==="viewport-y",_e=V&&(K||!O.hasIconData()||E),Ie=K&&(V||!O.hasTextData()||y);!O.collisionArrays&&B&&O.deserializeCollisionBoxes(B);const ve=this.retainedQueryData[O.bucketInstanceId].tileID,Se=this.terrain?(Oe,Re)=>this.terrain.getElevation(ve,Oe,Re):null,et=(Oe,Re)=>{var Ve,At;if(b[Oe.crossTileID])return;if(x)return void(this.placements[Oe.crossTileID]=new st(!1,!1,!1));let dt=!1,ft=!1,Nt=!0,It=null,jt={box:null,offscreen:null},Ht={box:null,offscreen:null},Mi=null,mi=null,Ti=null,ui=0,ar=0,er=0;Re.textFeatureIndex?ui=Re.textFeatureIndex:Oe.useRuntimeCollisionCircles&&(ui=Oe.featureIndex),Re.verticalTextFeatureIndex&&(ar=Re.verticalTextFeatureIndex);const ir=Re.textBox;if(ir){const xr=Kr=>{let kr=s.ai.horizontal;if(O.allowVerticalPlacement&&!Kr&&this.prevPlacement){const Wr=this.prevPlacement.placedOrientations[Oe.crossTileID];Wr&&(this.placedOrientations[Oe.crossTileID]=Wr,kr=Wr,this.markUsedOrientation(O,kr,Oe))}return kr},$r=(Kr,kr)=>{if(O.allowVerticalPlacement&&Oe.numVerticalGlyphVertices>0&&Re.verticalTextBox){for(const Wr of O.writingModes)if(Wr===s.ai.vertical?(jt=kr(),Ht=jt):jt=Kr(),jt&&jt.box&&jt.box.length)break}else jt=Kr()},br=Oe.textAnchorOffsetStartIndex,Wn=Oe.textAnchorOffsetEndIndex;if(Wn===br){const Kr=(kr,Wr)=>{const ur=this.collisionIndex.placeCollisionBox(kr,P,p,X,j.predicate,Se);return ur&&ur.box&&ur.box.length&&(this.markUsedOrientation(O,Wr,Oe),this.placedOrientations[Oe.crossTileID]=Wr),ur};$r(()=>Kr(ir,s.ai.horizontal),()=>{const kr=Re.verticalTextBox;return O.allowVerticalPlacement&&Oe.numVerticalGlyphVertices>0&&kr?Kr(kr,s.ai.vertical):{box:null,offscreen:null}}),xr(jt&&jt.box&&jt.box.length)}else{let Kr=s.aq[(At=(Ve=this.prevPlacement)===null||Ve===void 0?void 0:Ve.variableOffsets[Oe.crossTileID])===null||At===void 0?void 0:At.anchor];const kr=(ur,Nr,on)=>{const es=ur.x2-ur.x1,an=ur.y2-ur.y1,ts=Oe.textBoxScale,Bs=oe&&q==="never"?Nr:null;let mr={box:[],offscreen:!1},bn=P==="never"?1:2,ea="never";Kr&&bn++;for(let Os=0;Os<bn;Os++){for(let io=br;io<Wn;io++){const yl=O.textAnchorOffsets.get(io);if(Kr&&yl.textAnchor!==Kr)continue;const _o=this.attemptAnchorPlacement(yl,ur,es,an,ts,ee,se,p,X,j,ea,Oe,O,on,Bs,Se);if(_o&&(mr=_o.placedGlyphBoxes,mr&&mr.box&&mr.box.length))return dt=!0,It=_o.shift,mr}Kr?Kr=null:ea=P}return mr};$r(()=>kr(ir,Re.iconBox,s.ai.horizontal),()=>{const ur=Re.verticalTextBox;return O.allowVerticalPlacement&&!(jt&&jt.box&&jt.box.length)&&Oe.numVerticalGlyphVertices>0&&ur?kr(ur,Re.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),jt&&(dt=jt.box,Nt=jt.offscreen);const Wr=xr(jt&&jt.box);if(!dt&&this.prevPlacement){const ur=this.prevPlacement.variableOffsets[Oe.crossTileID];ur&&(this.variableOffsets[Oe.crossTileID]=ur,this.markUsedJustification(O,ur.anchor,Oe,Wr))}}}if(Mi=jt,dt=Mi&&Mi.box&&Mi.box.length>0,Nt=Mi&&Mi.offscreen,Oe.useRuntimeCollisionCircles){const xr=O.text.placedSymbolArray.get(Oe.centerJustifiedTextSymbolIndex),$r=s.aj(O.textSizeData,I,xr),br=z.get("text-padding");mi=this.collisionIndex.placeCollisionCircles(P,xr,O.lineVertexArray,O.glyphOffsetArray,$r,X,w,a,L,se,j.predicate,Oe.collisionCircleDiameter,br,Se),mi.circles.length&&mi.collisionDetected&&!L&&s.w("Collisions detected, but collision boxes are not shown"),dt=V||mi.circles.length>0&&!mi.collisionDetected,Nt=Nt&&mi.offscreen}if(Re.iconFeatureIndex&&(er=Re.iconFeatureIndex),Re.iconBox){const xr=$r=>{const br=oe&&It?Gt($r,It.x,It.y,ee,se,this.transform.angle):$r;return this.collisionIndex.placeCollisionBox(br,q,p,X,j.predicate,Se)};Ht&&Ht.box&&Ht.box.length&&Re.verticalIconBox?(Ti=xr(Re.verticalIconBox),ft=Ti.box.length>0):(Ti=xr(Re.iconBox),ft=Ti.box.length>0),Nt=Nt&&Ti.offscreen}const Dr=y||Oe.numHorizontalGlyphVertices===0&&Oe.numVerticalGlyphVertices===0,Rr=E||Oe.numIconVertices===0;if(Dr||Rr?Rr?Dr||(ft=ft&&dt):dt=ft&&dt:ft=dt=ft&&dt,dt&&Mi&&Mi.box&&this.collisionIndex.insertCollisionBox(Mi.box,P,z.get("text-ignore-placement"),O.bucketInstanceId,Ht&&Ht.box&&ar?ar:ui,j.ID),ft&&Ti&&this.collisionIndex.insertCollisionBox(Ti.box,q,z.get("icon-ignore-placement"),O.bucketInstanceId,er,j.ID),mi&&(dt&&this.collisionIndex.insertCollisionCircles(mi.circles,P,z.get("text-ignore-placement"),O.bucketInstanceId,ui,j.ID),L)){const xr=O.bucketInstanceId;let $r=this.collisionCircleArrays[xr];$r===void 0&&($r=this.collisionCircleArrays[xr]=new vt);for(let br=0;br<mi.circles.length;br+=4)$r.circles.push(mi.circles[br+0]),$r.circles.push(mi.circles[br+1]),$r.circles.push(mi.circles[br+2]),$r.circles.push(mi.collisionDetected?1:0)}if(Oe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(O.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Oe.crossTileID]=new st(dt||_e,ft||Ie,Nt||O.justReloaded),b[Oe.crossTileID]=!0};if(le){if(A.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Oe=O.getSortedSymbolIndexes(this.transform.angle);for(let Re=Oe.length-1;Re>=0;--Re){const Ve=Oe[Re];et(O.symbolInstances.get(Ve),O.collisionArrays[Ve])}}else for(let Oe=A.symbolInstanceStart;Oe<A.symbolInstanceEnd;Oe++)et(O.symbolInstances.get(Oe),O.collisionArrays[Oe]);if(L&&O.bucketInstanceId in this.collisionCircleArrays){const Oe=this.collisionCircleArrays[O.bucketInstanceId];s.as(Oe.invProjMatrix,X),Oe.viewportMatrix=this.collisionIndex.getViewportMatrix()}O.justReloaded=!1}markUsedJustification(A,b,L,O){let z;z=O===s.ai.vertical?L.verticalPlacedTextSymbolIndex:{left:L.leftJustifiedTextSymbolIndex,center:L.centerJustifiedTextSymbolIndex,right:L.rightJustifiedTextSymbolIndex}[s.at(b)];const X=[L.leftJustifiedTextSymbolIndex,L.centerJustifiedTextSymbolIndex,L.rightJustifiedTextSymbolIndex,L.verticalPlacedTextSymbolIndex];for(const w of X)w>=0&&(A.text.placedSymbolArray.get(w).crossTileID=z>=0&&w!==z?0:L.crossTileID)}markUsedOrientation(A,b,L){const O=b===s.ai.horizontal||b===s.ai.horizontalOnly?b:0,z=b===s.ai.vertical?b:0,X=[L.leftJustifiedTextSymbolIndex,L.centerJustifiedTextSymbolIndex,L.rightJustifiedTextSymbolIndex];for(const w of X)A.text.placedSymbolArray.get(w).placedOrientation=O;L.verticalPlacedTextSymbolIndex&&(A.text.placedSymbolArray.get(L.verticalPlacedTextSymbolIndex).placedOrientation=z)}commit(A){this.commitTime=A,this.zoomAtLastRecencyCheck=this.transform.zoom;const b=this.prevPlacement;let L=!1;this.prevZoomAdjustment=b?b.zoomAdjustment(this.transform.zoom):0;const O=b?b.symbolFadeChange(A):1,z=b?b.opacities:{},X=b?b.variableOffsets:{},w=b?b.placedOrientations:{};for(const a in this.placements){const p=this.placements[a],x=z[a];x?(this.opacities[a]=new Ge(x,O,p.text,p.icon),L=L||p.text!==x.text.placed||p.icon!==x.icon.placed):(this.opacities[a]=new Ge(null,O,p.text,p.icon,p.skipFade),L=L||p.text||p.icon)}for(const a in z){const p=z[a];if(!this.opacities[a]){const x=new Ge(p,O,!1,!1);x.isHidden()||(this.opacities[a]=x,L=L||p.text.placed||p.icon.placed)}}for(const a in X)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=X[a]);for(const a in w)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=w[a]);if(b&&b.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");L?this.lastPlacementChangeTime=A:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=b?b.lastPlacementChangeTime:A)}updateLayerOpacities(A,b){const L={};for(const O of b){const z=O.getBucket(A);z&&O.latestFeatureIndex&&A.id===z.layerIds[0]&&this.updateBucketOpacities(z,L,O.collisionBoxArray)}}updateBucketOpacities(A,b,L){A.hasTextData()&&(A.text.opacityVertexArray.clear(),A.text.hasVisibleVertices=!1),A.hasIconData()&&(A.icon.opacityVertexArray.clear(),A.icon.hasVisibleVertices=!1),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexArray.clear(),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexArray.clear();const O=A.layers[0],z=O.layout,X=new Ge(null,0,!1,!1,!0),w=z.get("text-allow-overlap"),a=z.get("icon-allow-overlap"),p=O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"),x=z.get("text-rotation-alignment")==="map",B=z.get("text-pitch-alignment")==="map",I=z.get("icon-text-fit")!=="none",j=new Ge(null,0,w&&(a||!A.hasIconData()||z.get("icon-optional")),a&&(w||!A.hasTextData()||z.get("text-optional")),!0);!A.collisionArrays&&L&&(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData())&&A.deserializeCollisionBoxes(L);const y=(E,P,V)=>{for(let q=0;q<P/4;q++)E.opacityVertexArray.emplaceBack(V);E.hasVisibleVertices=E.hasVisibleVertices||V!==un};for(let E=0;E<A.symbolInstances.length;E++){const P=A.symbolInstances.get(E),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:q,crossTileID:K}=P;let ee=this.opacities[K];b[K]?ee=X:ee||(ee=j,this.opacities[K]=ee),b[K]=!0;const se=P.numIconVertices>0,oe=this.placedOrientations[P.crossTileID],le=oe===s.ai.vertical,_e=oe===s.ai.horizontal||oe===s.ai.horizontalOnly;if(V>0||q>0){const Ie=lr(ee.text);y(A.text,V,le?un:Ie),y(A.text,q,_e?un:Ie);const ve=ee.text.isHidden();[P.rightJustifiedTextSymbolIndex,P.centerJustifiedTextSymbolIndex,P.leftJustifiedTextSymbolIndex].forEach(Oe=>{Oe>=0&&(A.text.placedSymbolArray.get(Oe).hidden=ve||le?1:0)}),P.verticalPlacedTextSymbolIndex>=0&&(A.text.placedSymbolArray.get(P.verticalPlacedTextSymbolIndex).hidden=ve||_e?1:0);const Se=this.variableOffsets[P.crossTileID];Se&&this.markUsedJustification(A,Se.anchor,P,oe);const et=this.placedOrientations[P.crossTileID];et&&(this.markUsedJustification(A,"left",P,et),this.markUsedOrientation(A,et,P))}if(se){const Ie=lr(ee.icon),ve=!(I&&P.verticalPlacedIconSymbolIndex&&le);P.placedIconSymbolIndex>=0&&(y(A.icon,P.numIconVertices,ve?Ie:un),A.icon.placedSymbolArray.get(P.placedIconSymbolIndex).hidden=ee.icon.isHidden()),P.verticalPlacedIconSymbolIndex>=0&&(y(A.icon,P.numVerticalIconVertices,ve?un:Ie),A.icon.placedSymbolArray.get(P.verticalPlacedIconSymbolIndex).hidden=ee.icon.isHidden())}if(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData()){const Ie=A.collisionArrays[E];if(Ie){let ve=new s.P(0,0);if(Ie.textBox||Ie.verticalTextBox){let et=!0;if(p){const Oe=this.variableOffsets[K];Oe?(ve=ii(Oe.anchor,Oe.width,Oe.height,Oe.textOffset,Oe.textBoxScale),x&&ve._rotate(B?this.transform.angle:-this.transform.angle)):et=!1}Ie.textBox&&Bi(A.textCollisionBox.collisionVertexArray,ee.text.placed,!et||le,ve.x,ve.y),Ie.verticalTextBox&&Bi(A.textCollisionBox.collisionVertexArray,ee.text.placed,!et||_e,ve.x,ve.y)}const Se=!!(!_e&&Ie.verticalIconBox);Ie.iconBox&&Bi(A.iconCollisionBox.collisionVertexArray,ee.icon.placed,Se,I?ve.x:0,I?ve.y:0),Ie.verticalIconBox&&Bi(A.iconCollisionBox.collisionVertexArray,ee.icon.placed,!Se,I?ve.x:0,I?ve.y:0)}}}if(A.sortFeatures(this.transform.angle),this.retainedQueryData[A.bucketInstanceId]&&(this.retainedQueryData[A.bucketInstanceId].featureSortOrder=A.featureSortOrder),A.hasTextData()&&A.text.opacityVertexBuffer&&A.text.opacityVertexBuffer.updateData(A.text.opacityVertexArray),A.hasIconData()&&A.icon.opacityVertexBuffer&&A.icon.opacityVertexBuffer.updateData(A.icon.opacityVertexArray),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexBuffer&&A.iconCollisionBox.collisionVertexBuffer.updateData(A.iconCollisionBox.collisionVertexArray),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexBuffer&&A.textCollisionBox.collisionVertexBuffer.updateData(A.textCollisionBox.collisionVertexArray),A.text.opacityVertexArray.length!==A.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${A.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${A.text.layoutVertexArray.length}) / 4`);if(A.icon.opacityVertexArray.length!==A.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${A.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${A.icon.layoutVertexArray.length}) / 4`);if(A.bucketInstanceId in this.collisionCircleArrays){const E=this.collisionCircleArrays[A.bucketInstanceId];A.placementInvProjMatrix=E.invProjMatrix,A.placementViewportMatrix=E.viewportMatrix,A.collisionCircleArray=E.circles,delete this.collisionCircleArrays[A.bucketInstanceId]}}symbolFadeChange(A){return this.fadeDuration===0?1:(A-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(A){return Math.max(0,(this.transform.zoom-A)/1.5)}hasTransitions(A){return this.stale||A-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(A,b){const L=this.zoomAtLastRecencyCheck===b?1-this.zoomAdjustment(b):1;return this.zoomAtLastRecencyCheck=b,this.commitTime+this.fadeDuration*L>A}setStale(){this.stale=!0}}function Bi(N,A,b,L,O){N.emplaceBack(A?1:0,b?1:0,L||0,O||0),N.emplaceBack(A?1:0,b?1:0,L||0,O||0),N.emplaceBack(A?1:0,b?1:0,L||0,O||0),N.emplaceBack(A?1:0,b?1:0,L||0,O||0)}const Hi=Math.pow(2,25),Ci=Math.pow(2,24),Ni=Math.pow(2,17),ot=Math.pow(2,16),ri=Math.pow(2,9),Vt=Math.pow(2,8),Vi=Math.pow(2,1);function lr(N){if(N.opacity===0&&!N.placed)return 0;if(N.opacity===1&&N.placed)return 4294967295;const A=N.placed?1:0,b=Math.floor(127*N.opacity);return b*Hi+A*Ci+b*Ni+A*ot+b*ri+A*Vt+b*Vi+A}const un=0;class wn{constructor(A){this._sortAcrossTiles=A.layout.get("symbol-z-order")!=="viewport-y"&&!A.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(A,b,L,O,z){const X=this._bucketParts;for(;this._currentTileIndex<A.length;)if(b.getBucketParts(X,O,A[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,z())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,X.sort((w,a)=>w.sortKey-a.sortKey));this._currentPartIndex<X.length;)if(b.placeLayerBucketPart(X[this._currentPartIndex],this._seenCrossTileIDs,L),this._currentPartIndex++,z())return!0;return!1}}class gr{constructor(A,b,L,O,z,X,w,a){this.placement=new Ai(A,b,X,w,a),this._currentPlacementIndex=L.length-1,this._forceFullPlacement=O,this._showCollisionBoxes=z,this._done=!1}isDone(){return this._done}continuePlacement(A,b,L){const O=s.h.now(),z=()=>!this._forceFullPlacement&&s.h.now()-O>2;for(;this._currentPlacementIndex>=0;){const X=b[A[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(X.type==="symbol"&&(!X.minzoom||X.minzoom<=w)&&(!X.maxzoom||X.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new wn(X)),this._inProgressLayer.continuePlacement(L[X.source],this.placement,this._showCollisionBoxes,X,z))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(A){return this.placement.commit(A),this.placement}}const mn=512/s.N/2;class yn{constructor(A,b,L){this.tileID=A,this.bucketInstanceId=L,this._symbolsByKey={};const O=new Map;for(let z=0;z<b.length;z++){const X=b.get(z),w=X.key,a=O.get(w);a?a.push(X):O.set(w,[X])}for(const[z,X]of O){const w={positions:X.map(a=>({x:Math.floor(a.anchorX*mn),y:Math.floor(a.anchorY*mn)})),crossTileIDs:X.map(a=>a.crossTileID)};if(w.positions.length>128){const a=new s.av(w.positions.length,16,Uint16Array);for(const{x:p,y:x}of w.positions)a.add(p,x);a.finish(),delete w.positions,w.index=a}this._symbolsByKey[z]=w}}getScaledCoordinates(A,b){const{x:L,y:O,z}=this.tileID.canonical,{x:X,y:w,z:a}=b.canonical,p=mn/Math.pow(2,a-z),x=(w*s.N+A.anchorY)*p,B=O*s.N*mn;return{x:Math.floor((X*s.N+A.anchorX)*p-L*s.N*mn),y:Math.floor(x-B)}}findMatches(A,b,L){const O=this.tileID.canonical.z<b.canonical.z?1:Math.pow(2,this.tileID.canonical.z-b.canonical.z);for(let z=0;z<A.length;z++){const X=A.get(z);if(X.crossTileID)continue;const w=this._symbolsByKey[X.key];if(!w)continue;const a=this.getScaledCoordinates(X,b);if(w.index){const p=w.index.range(a.x-O,a.y-O,a.x+O,a.y+O).sort();for(const x of p){const B=w.crossTileIDs[x];if(!L[B]){L[B]=!0,X.crossTileID=B;break}}}else if(w.positions)for(let p=0;p<w.positions.length;p++){const x=w.positions[p],B=w.crossTileIDs[p];if(Math.abs(x.x-a.x)<=O&&Math.abs(x.y-a.y)<=O&&!L[B]){L[B]=!0,X.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(A=>{let{crossTileIDs:b}=A;return b})}}class dr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Hn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(A){const b=Math.round((A-this.lng)/360);if(b!==0)for(const L in this.indexes){const O=this.indexes[L],z={};for(const X in O){const w=O[X];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+b),z[w.tileID.key]=w}this.indexes[L]=z}this.lng=A}addBucket(A,b,L){if(this.indexes[A.overscaledZ]&&this.indexes[A.overscaledZ][A.key]){if(this.indexes[A.overscaledZ][A.key].bucketInstanceId===b.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(A.overscaledZ,this.indexes[A.overscaledZ][A.key])}for(let z=0;z<b.symbolInstances.length;z++)b.symbolInstances.get(z).crossTileID=0;this.usedCrossTileIDs[A.overscaledZ]||(this.usedCrossTileIDs[A.overscaledZ]={});const O=this.usedCrossTileIDs[A.overscaledZ];for(const z in this.indexes){const X=this.indexes[z];if(Number(z)>A.overscaledZ)for(const w in X){const a=X[w];a.tileID.isChildOf(A)&&a.findMatches(b.symbolInstances,A,O)}else{const w=X[A.scaledTo(Number(z)).key];w&&w.findMatches(b.symbolInstances,A,O)}}for(let z=0;z<b.symbolInstances.length;z++){const X=b.symbolInstances.get(z);X.crossTileID||(X.crossTileID=L.generate(),O[X.crossTileID]=!0)}return this.indexes[A.overscaledZ]===void 0&&(this.indexes[A.overscaledZ]={}),this.indexes[A.overscaledZ][A.key]=new yn(A,b.symbolInstances,b.bucketInstanceId),!0}removeBucketCrossTileIDs(A,b){for(const L of b.getCrossTileIDsLists())for(const O of L)delete this.usedCrossTileIDs[A][O]}removeStaleBuckets(A){let b=!1;for(const L in this.indexes){const O=this.indexes[L];for(const z in O)A[O[z].bucketInstanceId]||(this.removeBucketCrossTileIDs(L,O[z]),delete O[z],b=!0)}return b}}class Gs{constructor(){this.layerIndexes={},this.crossTileIDs=new dr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(A,b,L){let O=this.layerIndexes[A.id];O===void 0&&(O=this.layerIndexes[A.id]=new Hn);let z=!1;const X={};O.handleWrapJump(L);for(const w of b){const a=w.getBucket(A);a&&A.id===a.layerIds[0]&&(a.bucketInstanceId||(a.bucketInstanceId=++this.maxBucketInstanceId),O.addBucket(w.tileID,a,this.crossTileIDs)&&(z=!0),X[a.bucketInstanceId]=!0)}return O.removeStaleBuckets(X)&&(z=!0),z}pruneUnusedLayers(A){const b={};A.forEach(L=>{b[L]=!0});for(const L in this.layerIndexes)b[L]||delete this.layerIndexes[L]}}const Or=(N,A)=>s.x(N,A&&A.filter(b=>b.identifier!=="source.canvas")),Bn=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),qa=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),Un=s.aw();class Zi extends s.E{constructor(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.map=A,this.dispatcher=new Xt(Mr(),this,A._getMapId()),this.imageManager=new De,this.imageManager.setEventedParent(this),this.glyphManager=new Et(A._requestManager,b.localIdeographFontFamily),this.lineAtlas=new Ft(256,512),this.crossTileSymbolIndex=new Gs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const L=this;this._rtlTextPluginCallback=Zi.registerForPluginStateChange(O=>{L.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:O.pluginStatus,pluginURL:O.pluginURL},(z,X)=>{if(s.aA(z),X&&X.every(w=>w))for(const w in L.sourceCaches){const a=L.sourceCaches[w].getSource().type;a!=="vector"&&a!=="geojson"||L.sourceCaches[w].reload()}})}),this.on("data",O=>{if(O.dataType!=="source"||O.sourceDataType!=="metadata")return;const z=this.sourceCaches[O.sourceId];if(!z)return;const X=z.getSource();if(X&&X.vectorLayerIds)for(const w in this._layers){const a=this._layers[w];a.source===X.id&&this._validateLayer(a)}})}loadURL(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),b.validate=typeof b.validate!="boolean"||b.validate;const O=this.map._requestManager.transformRequest(A,he.Style);this._request=s.f(O,(z,X)=>{this._request=null,z?this.fire(new s.j(z)):X&&this._load(X,b,L)})}loadJSON(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,b.validate=b.validate!==!1,this._load(A,b,L)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(Un,{validate:!1})}_load(A,b,L){var O;const z=b.transformStyle?b.transformStyle(L,A):A;if(!b.validate||!Or(this,s.y(z))){this._loaded=!0,this.stylesheet=z;for(const X in z.sources)this.addSource(X,z.sources[X],{validate:!1});z.sprite?this._loadSprite(z.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(z.glyphs),this._createLayers(),this.light=new Rt(this.stylesheet.light),this.map.setTerrain((O=this.stylesheet.terrain)!==null&&O!==void 0?O:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const A=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",A),this._order=A.map(b=>b.id),this._layers={},this._serializedLayers=null;for(const b of A){const L=s.aC(b);L.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=L}}_loadSprite(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this.imageManager.setLoaded(!1),this._spriteRequest=function(O,z,X,w){const a=Ne(O),p=a.length,x=X>1?"@2x":"",B={},I={},j={};for(const{id:y,url:E}of a){const P=z.transformRequest(z.normalizeSpriteURL(E,x,".json"),he.SpriteJSON),V=`${y}_${P.url}`;B[V]=s.f(P,(ee,se)=>{delete B[V],I[y]=se,at(w,I,j,ee,p)});const q=z.transformRequest(z.normalizeSpriteURL(E,x,".png"),he.SpriteImage),K=`${y}_${q.url}`;B[K]=Ae.getImage(q,(ee,se)=>{delete B[K],j[y]=se,at(w,I,j,ee,p)})}return{cancel(){for(const y of Object.values(B))y.cancel()}}}(A,this.map._requestManager,this.map.getPixelRatio(),(O,z)=>{if(this._spriteRequest=null,O)this.fire(new s.j(O));else if(z)for(const X in z){this._spritesImagesIds[X]=[];const w=this._spritesImagesIds[X]?this._spritesImagesIds[X].filter(a=>!(a in z)):[];for(const a of w)this.imageManager.removeImage(a),this._changedImages[a]=!0;for(const a in z[X]){const p=X==="default"?a:`${X}:${a}`;this._spritesImagesIds[X].push(p),p in this.imageManager.images?this.imageManager.updateImage(p,z[X][a],!1):this.imageManager.addImage(p,z[X][a]),b&&(this._changedImages[p]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),b&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),L&&L(O)})}_unloadSprite(){for(const A of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(A),this._changedImages[A]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(A){const b=this.sourceCaches[A.source];if(!b)return;const L=A.sourceLayer;if(!L)return;const O=b.getSource();(O.type==="geojson"||O.vectorLayerIds&&O.vectorLayerIds.indexOf(L)===-1)&&this.fire(new s.j(new Error(`Source layer "${L}" does not exist on source "${O.id}" as specified by style layer "${A.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const A in this.sourceCaches)if(!this.sourceCaches[A].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(A){const b=this._serializedAllLayers();if(!A||A.length===0)return Object.values(b);const L=[];for(const O of A)b[O]&&L.push(b[O]);return L}_serializedAllLayers(){let A=this._serializedLayers;if(A)return A;A=this._serializedLayers={};const b=Object.keys(this._layers);for(const L of b){const O=this._layers[L];O.type!=="custom"&&(A[L]=O.serialize())}return A}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const A in this.sourceCaches)if(this.sourceCaches[A].hasTransition())return!0;for(const A in this._layers)if(this._layers[A].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(A){if(!this._loaded)return;const b=this._changed;if(this._changed){const O=Object.keys(this._updatedLayers),z=Object.keys(this._removedLayers);(O.length||z.length)&&this._updateWorkerLayers(O,z);for(const X in this._updatedSources){const w=this._updatedSources[X];if(w==="reload")this._reloadSource(X);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(X)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const X in this._updatedPaintProps)this._layers[X].updateTransitions(A);this.light.updateTransitions(A),this._resetUpdates()}const L={};for(const O in this.sourceCaches){const z=this.sourceCaches[O];L[O]=z.used,z.used=!1}for(const O of this._order){const z=this._layers[O];z.recalculate(A,this._availableImages),!z.isHidden(A.zoom)&&z.source&&(this.sourceCaches[z.source].used=!0)}for(const O in L){const z=this.sourceCaches[O];L[O]!==z.used&&z.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:O}))}this.light.recalculate(A),this.z=A.zoom,b&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const A=Object.keys(this._changedImages);if(A.length){for(const b in this.sourceCaches)this.sourceCaches[b].reloadTilesForDependencies(["icons","patterns"],A);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const A in this.sourceCaches)this.sourceCaches[A].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(A,b){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(A),removedIds:b})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const L=this.serialize();if(A=b.transformStyle?b.transformStyle(L,A):A,Or(this,s.y(A)))return!1;(A=s.aD(A)).layers=s.aB(A.layers);const O=s.aE(L,A).filter(X=>!(X.command in qa));if(O.length===0)return!1;const z=O.filter(X=>!(X.command in Bn));if(z.length>0)throw new Error(`Unimplemented: ${z.map(X=>X.command).join(", ")}.`);for(const X of O)X.command!=="setTransition"&&this[X.command].apply(this,X.args);return this.stylesheet=A,this._serializedLayers=null,!0}addImage(A,b){if(this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" already exists.`)));this.imageManager.addImage(A,b),this._afterImageUpdated(A)}updateImage(A,b){this.imageManager.updateImage(A,b)}getImage(A){return this.imageManager.getImage(A)}removeImage(A){if(!this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" does not exist.`)));this.imageManager.removeImage(A),this._afterImageUpdated(A)}_afterImageUpdated(A){this._availableImages=this.imageManager.listImages(),this._changedImages[A]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[A]!==void 0)throw new Error(`Source "${A}" already exists.`);if(!b.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(b).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(b.type)>=0&&this._validate(s.y.source,`sources.${A}`,b,null,L))return;this.map&&this.map._collectResourceTiming&&(b.collectResourceTiming=!0);const O=this.sourceCaches[A]=new $t(A,b,this.dispatcher);O.style=this,O.setEventedParent(this,()=>({isSourceLoaded:O.loaded(),source:O.serialize(),sourceId:A})),O.onAdd(this.map),this._changed=!0}removeSource(A){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error("There is no source with this ID");for(const L in this._layers)if(this._layers[L].source===A)return this.fire(new s.j(new Error(`Source "${A}" cannot be removed while layer "${L}" is using it.`)));const b=this.sourceCaches[A];delete this.sourceCaches[A],delete this._updatedSources[A],b.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:A})),b.setEventedParent(null),b.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(A,b){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error(`There is no source with this ID=${A}`);const L=this.sourceCaches[A].getSource();if(L.type!=="geojson")throw new Error(`geojsonSource.type is ${L.type}, which is !== 'geojson`);L.setData(b),this._changed=!0}getSource(A){return this.sourceCaches[A]&&this.sourceCaches[A].getSource()}addLayer(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const O=A.id;if(this.getLayer(O))return void this.fire(new s.j(new Error(`Layer "${O}" already exists on this map.`)));let z;if(A.type==="custom"){if(Or(this,s.aF(A)))return;z=s.aC(A)}else{if("source"in A&&typeof A.source=="object"&&(this.addSource(O,A.source),A=s.aD(A),A=s.e(A,{source:O})),this._validate(s.y.layer,`layers.${O}`,A,{arrayIndex:-1},L))return;z=s.aC(A),this._validateLayer(z),z.setEventedParent(this,{layer:{id:O}})}const X=b?this._order.indexOf(b):this._order.length;if(b&&X===-1)this.fire(new s.j(new Error(`Cannot add layer "${O}" before non-existing layer "${b}".`)));else{if(this._order.splice(X,0,O),this._layerOrderChanged=!0,this._layers[O]=z,this._removedLayers[O]&&z.source&&z.type!=="custom"){const w=this._removedLayers[O];delete this._removedLayers[O],w.type!==z.type?this._updatedSources[z.source]="clear":(this._updatedSources[z.source]="reload",this.sourceCaches[z.source].pause())}this._updateLayer(z),z.onAdd&&z.onAdd(this.map)}}moveLayer(A,b){if(this._checkLoaded(),this._changed=!0,!this._layers[A])return void this.fire(new s.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be moved.`)));if(A===b)return;const L=this._order.indexOf(A);this._order.splice(L,1);const O=b?this._order.indexOf(b):this._order.length;b&&O===-1?this.fire(new s.j(new Error(`Cannot move layer "${A}" before non-existing layer "${b}".`))):(this._order.splice(O,0,A),this._layerOrderChanged=!0)}removeLayer(A){this._checkLoaded();const b=this._layers[A];if(!b)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${A}".`)));b.setEventedParent(null);const L=this._order.indexOf(A);this._order.splice(L,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[A]=b,delete this._layers[A],this._serializedLayers&&delete this._serializedLayers[A],delete this._updatedLayers[A],delete this._updatedPaintProps[A],b.onRemove&&b.onRemove(this.map)}getLayer(A){return this._layers[A]}getLayersOrder(){return[...this._order]}hasLayer(A){return A in this._layers}setLayerZoomRange(A,b,L){this._checkLoaded();const O=this.getLayer(A);O?O.minzoom===b&&O.maxzoom===L||(b!=null&&(O.minzoom=b),L!=null&&(O.maxzoom=L),this._updateLayer(O)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${A}".`)))}setFilter(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const O=this.getLayer(A);if(O){if(!s.aG(O.filter,b))return b==null?(O.filter=void 0,void this._updateLayer(O)):void(this._validate(s.y.filter,`layers.${O.id}.filter`,b,null,L)||(O.filter=s.aD(b),this._updateLayer(O)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${A}".`)))}getFilter(A){return s.aD(this.getLayer(A).filter)}setLayoutProperty(A,b,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const z=this.getLayer(A);z?s.aG(z.getLayoutProperty(b),L)||(z.setLayoutProperty(b,L,O),this._updateLayer(z)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getLayoutProperty(A,b){const L=this.getLayer(A);if(L)return L.getLayoutProperty(b);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${A}".`)))}setPaintProperty(A,b,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const z=this.getLayer(A);z?s.aG(z.getPaintProperty(b),L)||(z.setPaintProperty(b,L,O)&&this._updateLayer(z),this._changed=!0,this._updatedPaintProps[A]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getPaintProperty(A,b){return this.getLayer(A).getPaintProperty(b)}setFeatureState(A,b){this._checkLoaded();const L=A.source,O=A.sourceLayer,z=this.sourceCaches[L];if(z===void 0)return void this.fire(new s.j(new Error(`The source '${L}' does not exist in the map's style.`)));const X=z.getSource().type;X==="geojson"&&O?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):X!=="vector"||O?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),z.setFeatureState(O,A.id,b)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(A,b){this._checkLoaded();const L=A.source,O=this.sourceCaches[L];if(O===void 0)return void this.fire(new s.j(new Error(`The source '${L}' does not exist in the map's style.`)));const z=O.getSource().type,X=z==="vector"?A.sourceLayer:void 0;z!=="vector"||X?b&&typeof A.id!="string"&&typeof A.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):O.removeFeatureState(X,A.id,b):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(A){this._checkLoaded();const b=A.source,L=A.sourceLayer,O=this.sourceCaches[b];if(O!==void 0)return O.getSource().type!=="vector"||L?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),O.getFeatureState(L,A.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${b}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const A=s.aH(this.sourceCaches,z=>z.serialize()),b=this._serializeByIds(this._order),L=this.map.getTerrain()||void 0,O=this.stylesheet;return s.aI({version:O.version,name:O.name,metadata:O.metadata,light:O.light,center:O.center,zoom:O.zoom,bearing:O.bearing,pitch:O.pitch,sprite:O.sprite,glyphs:O.glyphs,transition:O.transition,sources:A,layers:b,terrain:L},z=>z!==void 0)}_updateLayer(A){this._updatedLayers[A.id]=!0,A.source&&!this._updatedSources[A.source]&&this.sourceCaches[A.source].getSource().type!=="raster"&&(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(A){const b=X=>this._layers[X].type==="fill-extrusion",L={},O=[];for(let X=this._order.length-1;X>=0;X--){const w=this._order[X];if(b(w)){L[w]=X;for(const a of A){const p=a[w];if(p)for(const x of p)O.push(x)}}}O.sort((X,w)=>w.intersectionZ-X.intersectionZ);const z=[];for(let X=this._order.length-1;X>=0;X--){const w=this._order[X];if(b(w))for(let a=O.length-1;a>=0;a--){const p=O[a].feature;if(L[p.layer.id]<X)break;z.push(p),O.pop()}else for(const a of A){const p=a[w];if(p)for(const x of p)z.push(x.feature)}}return z}queryRenderedFeatures(A,b,L){b&&b.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",b.filter,null,b);const O={};if(b&&b.layers){if(!Array.isArray(b.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const w of b.layers){const a=this._layers[w];if(!a)return this.fire(new s.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];O[a.source]=!0}}const z=[];b.availableImages=this._availableImages;const X=this._serializedAllLayers();for(const w in this.sourceCaches)b.layers&&!O[w]||z.push(lt(this.sourceCaches[w],this._layers,X,A,b,L));return this.placement&&z.push(function(w,a,p,x,B,I,j){const y={},E=I.queryRenderedSymbols(x),P=[];for(const V of Object.keys(E).map(Number))P.push(j[V]);P.sort(wt);for(const V of P){const q=V.featureIndex.lookupSymbolFeatures(E[V.bucketInstanceId],a,V.bucketIndex,V.sourceLayerIndex,B.filter,B.layers,B.availableImages,w);for(const K in q){const ee=y[K]=y[K]||[],se=q[K];se.sort((oe,le)=>{const _e=V.featureSortOrder;if(_e){const Ie=_e.indexOf(oe.featureIndex);return _e.indexOf(le.featureIndex)-Ie}return le.featureIndex-oe.featureIndex});for(const oe of se)ee.push(oe)}}for(const V in y)y[V].forEach(q=>{const K=q.feature,ee=p[w[V].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=ee});return y}(this._layers,X,this.sourceCaches,A,b,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(z)}querySourceFeatures(A,b){b&&b.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",b.filter,null,b);const L=this.sourceCaches[A];return L?function(O,z){const X=O.getRenderableIds().map(p=>O.getTileByID(p)),w=[],a={};for(let p=0;p<X.length;p++){const x=X[p],B=x.tileID.canonical.key;a[B]||(a[B]=!0,x.querySourceFeatures(w,z))}return w}(L,b):[]}addSourceType(A,b,L){return Pi(A)?L(new Error(`A source type called "${A}" already exists.`)):(((O,z)=>{vi[O]=z})(A,b),b.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:A,url:b.workerSourceURL},L):L(null,null))}getLight(){return this.light.getLight()}setLight(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const L=this.light.getLight();let O=!1;for(const X in A)if(!s.aG(A[X],L[X])){O=!0;break}if(!O)return;const z={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(A,b),this.light.updateTransitions(z)}_validate(A,b,L,O){let z=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!z||z.validate!==!1)&&Or(this,A.call(s.y,s.e({key:b,style:this.serialize(),value:L,styleSpec:s.v},O)))}_remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const b in this._layers)this._layers[b].setEventedParent(null);for(const b in this.sourceCaches){const L=this.sourceCaches[b];L.setEventedParent(null),L.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(A)}_clearSource(A){this.sourceCaches[A].clearTiles()}_reloadSource(A){this.sourceCaches[A].resume(),this.sourceCaches[A].reload()}_updateSources(A){for(const b in this.sourceCaches)this.sourceCaches[b].update(A,this.map.terrain)}_generateCollisionBoxes(){for(const A in this.sourceCaches)this._reloadSource(A)}_updatePlacement(A,b,L,O){let z=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,X=!1,w=!1;const a={};for(const p of this._order){const x=this._layers[p];if(x.type!=="symbol")continue;if(!a[x.source]){const I=this.sourceCaches[x.source];a[x.source]=I.getRenderableIds(!0).map(j=>I.getTileByID(j)).sort((j,y)=>y.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(y.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(x,a[x.source],A.center.lng);X=X||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((z=z||this._layerOrderChanged||L===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),A.zoom))&&(this.pauseablePlacement=new gr(A,this.map.terrain,this._order,z,b,L,O,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,a),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),w=!0),X&&this.pauseablePlacement.placement.setStale()),w||X)for(const p of this._order){const x=this._layers[p];x.type==="symbol"&&this.placement.updateLayerOpacities(x,a[x.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const A in this.sourceCaches)this.sourceCaches[A].releaseSymbolFadeTiles()}getImages(A,b,L){this.imageManager.getImages(b.icons,L),this._updateTilesForChangedImages();const O=this.sourceCaches[b.source];O&&O.setDependencies(b.tileID.key,b.type,b.icons)}getGlyphs(A,b,L){this.glyphManager.getGlyphs(b.stacks,L);const O=this.sourceCaches[b.source];O&&O.setDependencies(b.tileID.key,b.type,[""])}getResource(A,b,L){return s.m(b,L)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),A&&this._validate(s.y.glyphs,"glyphs",A,null,b)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=A,this.glyphManager.entries={},this.glyphManager.setURL(A))}addSprite(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},O=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const z=[{id:A,url:b}],X=[...Ne(this.stylesheet.sprite),...z];this._validate(s.y.sprite,"sprite",X,null,L)||(this.stylesheet.sprite=X,this._loadSprite(z,!0,O))}removeSprite(A){this._checkLoaded();const b=Ne(this.stylesheet.sprite);if(b.find(L=>L.id===A)){if(this._spritesImagesIds[A])for(const L of this._spritesImagesIds[A])this.imageManager.removeImage(L),this._changedImages[L]=!0;b.splice(b.findIndex(L=>L.id===A),1),this.stylesheet.sprite=b.length>0?b:void 0,delete this._spritesImagesIds[A],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${A}" doesn't exists on this map.`)))}getSprite(){return Ne(this.stylesheet.sprite)}setSprite(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),A&&this._validate(s.y.sprite,"sprite",A,null,b)||(this.stylesheet.sprite=A,A?this._loadSprite(A,!0,L):(this._unloadSprite(),L&&L(null)))}}Zi.registerForPluginStateChange=s.aK;var ao=s.Q([{name:"a_pos",type:"Int16",components:2}]),Ms="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const vr={prelude:Tr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Tr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Tr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Tr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Tr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Tr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Tr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Tr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Tr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Tr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Tr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Tr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Tr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Tr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Tr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Tr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Tr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Tr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Tr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Tr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Tr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Tr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Tr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Tr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Tr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ms),terrainDepth:Tr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ms),terrainCoords:Tr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ms)};function Tr(N,A){const b=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,L=A.match(/attribute ([\w]+) ([\w]+)/g),O=N.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),z=A.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),X=z?z.concat(O):O,w={};return{fragmentSource:N=N.replace(b,(a,p,x,B,I)=>(w[I]=!0,p==="define"?`
#ifndef HAS_UNIFORM_u_${I}
varying ${x} ${B} ${I};
#else
uniform ${x} ${B} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${x} ${B} ${I} = u_${I};
#endif
`)),vertexSource:A=A.replace(b,(a,p,x,B,I)=>{const j=B==="float"?"vec2":"vec4",y=I.match(/color/)?"color":j;return w[I]?p==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${x} ${j} a_${I};
varying ${x} ${B} ${I};
#else
uniform ${x} ${B} u_${I};
#endif
`:y==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${x} ${B} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${y}(a_${I}, u_${I}_t);
#else
    ${x} ${B} ${I} = u_${I};
#endif
`:p==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${x} ${j} a_${I};
#else
uniform ${x} ${B} u_${I};
#endif
`:y==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${x} ${B} ${I} = a_${I};
#else
    ${x} ${B} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${x} ${B} ${I} = unpack_mix_${y}(a_${I}, u_${I}_t);
#else
    ${x} ${B} ${I} = u_${I};
#endif
`}),staticAttributes:L,staticUniforms:X}}class rs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(A,b,L,O,z,X,w,a,p){this.context=A;let x=this.boundPaintVertexBuffers.length!==O.length;for(let B=0;!x&&B<O.length;B++)this.boundPaintVertexBuffers[B]!==O[B]&&(x=!0);!this.vao||this.boundProgram!==b||this.boundLayoutVertexBuffer!==L||x||this.boundIndexBuffer!==z||this.boundVertexOffset!==X||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==p?this.freshBind(b,L,O,z,X,w,a,p):(A.bindVertexArray.set(this.vao),w&&w.bind(),z&&z.dynamicDraw&&z.bind(),a&&a.bind(),p&&p.bind())}freshBind(A,b,L,O,z,X,w,a){const p=A.numAttributes,x=this.context,B=x.gl;this.vao&&this.destroy(),this.vao=x.createVertexArray(),x.bindVertexArray.set(this.vao),this.boundProgram=A,this.boundLayoutVertexBuffer=b,this.boundPaintVertexBuffers=L,this.boundIndexBuffer=O,this.boundVertexOffset=z,this.boundDynamicVertexBuffer=X,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=a,b.enableAttributes(B,A);for(const I of L)I.enableAttributes(B,A);X&&X.enableAttributes(B,A),w&&w.enableAttributes(B,A),a&&a.enableAttributes(B,A),b.bind(),b.setVertexAttribPointers(B,A,z);for(const I of L)I.bind(),I.setVertexAttribPointers(B,A,z);X&&(X.bind(),X.setVertexAttribPointers(B,A,z)),O&&O.bind(),w&&(w.bind(),w.setVertexAttribPointers(B,A,z)),a&&(a.bind(),a.setVertexAttribPointers(B,A,z)),x.currentNumAttributes=p}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Gr(N){const A=[];for(let b=0;b<N.length;b++){if(N[b]===null)continue;const L=N[b].split(" ");A.push(L.pop())}return A}class Tn{constructor(A,b,L,O,z,X){const w=A.gl;this.program=w.createProgram();const a=Gr(b.staticAttributes),p=L?L.getBinderAttributes():[],x=a.concat(p),B=vr.prelude.staticUniforms?Gr(vr.prelude.staticUniforms):[],I=b.staticUniforms?Gr(b.staticUniforms):[],j=L?L.getBinderUniforms():[],y=B.concat(I).concat(j),E=[];for(const oe of y)E.indexOf(oe)<0&&E.push(oe);const P=L?L.defines():[];z&&P.push("#define OVERDRAW_INSPECTOR;"),X&&P.push("#define TERRAIN3D;");const V=P.concat(vr.prelude.fragmentSource,b.fragmentSource).join(`
`),q=P.concat(vr.prelude.vertexSource,b.vertexSource).join(`
`),K=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(K,V),w.compileShader(K),!w.getShaderParameter(K,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(K)}`);w.attachShader(this.program,K);const ee=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ee,q),w.compileShader(ee),!w.getShaderParameter(ee,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ee)}`);w.attachShader(this.program,ee),this.attributes={};const se={};this.numAttributes=x.length;for(let oe=0;oe<this.numAttributes;oe++)x[oe]&&(w.bindAttribLocation(this.program,oe,x[oe]),this.attributes[x[oe]]=oe);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ee),w.deleteShader(K);for(let oe=0;oe<E.length;oe++){const le=E[oe];if(le&&!se[le]){const _e=w.getUniformLocation(this.program,le);_e&&(se[le]=_e)}}this.fixedUniforms=O(A,se),this.terrainUniforms=((oe,le)=>({u_depth:new s.aL(oe,le.u_depth),u_terrain:new s.aL(oe,le.u_terrain),u_terrain_dim:new s.aM(oe,le.u_terrain_dim),u_terrain_matrix:new s.aN(oe,le.u_terrain_matrix),u_terrain_unpack:new s.aO(oe,le.u_terrain_unpack),u_terrain_exaggeration:new s.aM(oe,le.u_terrain_exaggeration)}))(A,se),this.binderUniforms=L?L.getUniforms(A,se):[]}draw(A,b,L,O,z,X,w,a,p,x,B,I,j,y,E,P,V,q){const K=A.gl;if(this.failedToCreate)return;if(A.program.set(this.program),A.setDepthMode(L),A.setStencilMode(O),A.setColorMode(z),A.setCullFace(X),a){A.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,a.depthTexture),A.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,a.texture);for(const se in this.terrainUniforms)this.terrainUniforms[se].set(a[se])}for(const se in this.fixedUniforms)this.fixedUniforms[se].set(w[se]);E&&E.setUniforms(A,this.binderUniforms,j,{zoom:y});let ee=0;switch(b){case K.LINES:ee=2;break;case K.TRIANGLES:ee=3;break;case K.LINE_STRIP:ee=1}for(const se of I.get()){const oe=se.vaos||(se.vaos={});(oe[p]||(oe[p]=new rs)).bind(A,this,x,E?E.getPaintVertexBuffers():[],B,se.vertexOffset,P,V,q),K.drawElements(b,se.primitiveLength*ee,K.UNSIGNED_SHORT,se.primitiveOffset*ee*2)}}}function Cn(N,A,b){const L=1/Fe(b,1,A.transform.tileZoom),O=Math.pow(2,b.tileID.overscaledZ),z=b.tileSize*Math.pow(2,A.transform.tileZoom)/O,X=z*(b.tileID.canonical.x+b.tileID.wrap*O),w=z*b.tileID.canonical.y;return{u_image:0,u_texsize:b.imageAtlasTexture.size,u_scale:[L,N.fromScale,N.toScale],u_fade:N.t,u_pixel_coord_upper:[X>>16,w>>16],u_pixel_coord_lower:[65535&X,65535&w]}}const po=(N,A,b,L)=>{const O=A.style.light,z=O.properties.get("position"),X=[z.x,z.y,z.z],w=function(){var p=new s.A(9);return s.A!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[5]=0,p[6]=0,p[7]=0),p[0]=1,p[4]=1,p[8]=1,p}();O.properties.get("anchor")==="viewport"&&function(p,x){var B=Math.sin(x),I=Math.cos(x);p[0]=I,p[1]=B,p[2]=0,p[3]=-B,p[4]=I,p[5]=0,p[6]=0,p[7]=0,p[8]=1}(w,-A.transform.angle),function(p,x,B){var I=x[0],j=x[1],y=x[2];p[0]=I*B[0]+j*B[3]+y*B[6],p[1]=I*B[1]+j*B[4]+y*B[7],p[2]=I*B[2]+j*B[5]+y*B[8]}(X,X,w);const a=O.properties.get("color");return{u_matrix:N,u_lightpos:X,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[a.r,a.g,a.b],u_vertical_gradient:+b,u_opacity:L}},Lr=(N,A,b,L,O,z,X)=>s.e(po(N,A,b,L),Cn(z,A,X),{u_height_factor:-Math.pow(2,O.overscaledZ)/X.tileSize/8}),$a=N=>({u_matrix:N}),Zs=(N,A,b,L)=>s.e($a(N),Cn(b,A,L)),Ka=(N,A)=>({u_matrix:N,u_world:A}),He=(N,A,b,L,O)=>s.e(Zs(N,A,b,L),{u_world:O}),Je=(N,A,b,L)=>{const O=N.transform;let z,X;if(L.paint.get("circle-pitch-alignment")==="map"){const w=Fe(b,1,O.zoom);z=!0,X=[w,w]}else z=!1,X=O.pixelsToGLUnits;return{u_camera_to_center_distance:O.cameraToCenterDistance,u_scale_with_map:+(L.paint.get("circle-pitch-scale")==="map"),u_matrix:N.translatePosMatrix(A.posMatrix,b,L.paint.get("circle-translate"),L.paint.get("circle-translate-anchor")),u_pitch_with_map:+z,u_device_pixel_ratio:N.pixelRatio,u_extrude_scale:X}},gt=(N,A,b)=>{const L=Fe(b,1,A.zoom),O=Math.pow(2,A.zoom-b.tileID.overscaledZ),z=b.tileID.overscaleFactor();return{u_matrix:N,u_camera_to_center_distance:A.cameraToCenterDistance,u_pixels_to_tile_units:L,u_extrude_scale:[A.pixelsToGLUnits[0]/(L*O),A.pixelsToGLUnits[1]/(L*O)],u_overscale_factor:z}},Ot=function(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:N,u_color:A,u_overlay:0,u_overlay_scale:b}},di=N=>({u_matrix:N}),ji=(N,A,b,L)=>({u_matrix:N,u_extrude_scale:Fe(A,1,b),u_intensity:L});function Br(N,A){const b=Math.pow(2,A.canonical.z),L=A.canonical.y;return[new s.U(0,L/b).toLngLat().lat,new s.U(0,(L+1)/b).toLngLat().lat]}const In=(N,A,b,L)=>{const O=N.transform;return{u_matrix:Nl(N,A,b,L),u_ratio:1/Fe(A,1,O.zoom),u_device_pixel_ratio:N.pixelRatio,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]]}},Gn=(N,A,b,L,O)=>s.e(In(N,A,b,O),{u_image:0,u_image_height:L}),ns=(N,A,b,L,O)=>{const z=N.transform,X=uu(A,z);return{u_matrix:Nl(N,A,b,O),u_texsize:A.imageAtlasTexture.size,u_ratio:1/Fe(A,1,z.zoom),u_device_pixel_ratio:N.pixelRatio,u_image:0,u_scale:[X,L.fromScale,L.toScale],u_fade:L.t,u_units_to_pixels:[1/z.pixelsToGLUnits[0],1/z.pixelsToGLUnits[1]]}},_n=(N,A,b,L,O,z)=>{const X=N.lineAtlas,w=uu(A,N.transform),a=b.layout.get("line-cap")==="round",p=X.getDash(L.from,a),x=X.getDash(L.to,a),B=p.width*O.fromScale,I=x.width*O.toScale;return s.e(In(N,A,b,z),{u_patternscale_a:[w/B,-p.height/2],u_patternscale_b:[w/I,-x.height/2],u_sdfgamma:X.width/(256*Math.min(B,I)*N.pixelRatio)/2,u_image:0,u_tex_y_a:p.y,u_tex_y_b:x.y,u_mix:O.t})};function uu(N,A){return 1/Fe(N,1,A.tileZoom)}function Nl(N,A,b,L){return N.translatePosMatrix(L?L.posMatrix:A.tileID.posMatrix,A,b.paint.get("line-translate"),b.paint.get("line-translate-anchor"))}const Cr=(N,A,b,L,O)=>{return{u_matrix:N,u_tl_parent:A,u_scale_parent:b,u_buffer_scale:1,u_fade_t:L.mix,u_opacity:L.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:(X=O.paint.get("raster-saturation"),X>0?1-1/(1.001-X):-X),u_contrast_factor:(z=O.paint.get("raster-contrast"),z>0?1/(1-z):1+z),u_spin_weights:Wa(O.paint.get("raster-hue-rotate"))};var z,X};function Wa(N){N*=Math.PI/180;const A=Math.sin(N),b=Math.cos(N);return[(2*b+1)/3,(-Math.sqrt(3)*A-b+1)/3,(Math.sqrt(3)*A-b+1)/3]}const zl=(N,A,b,L,O,z,X,w,a,p)=>{const x=O.transform;return{u_is_size_zoom_constant:+(N==="constant"||N==="source"),u_is_size_feature_constant:+(N==="constant"||N==="camera"),u_size_t:A?A.uSizeT:0,u_size:A?A.uSize:0,u_camera_to_center_distance:x.cameraToCenterDistance,u_pitch:x.pitch/360*2*Math.PI,u_rotate_symbol:+b,u_aspect_ratio:x.width/x.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_matrix:z,u_label_plane_matrix:X,u_coord_matrix:w,u_is_text:+a,u_pitch_with_map:+L,u_texsize:p,u_texture:0}},ss=(N,A,b,L,O,z,X,w,a,p,x)=>{const B=O.transform;return s.e(zl(N,A,b,L,O,z,X,w,a,p),{u_gamma_scale:L?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:O.pixelRatio,u_is_halo:+x})},To=(N,A,b,L,O,z,X,w,a,p)=>s.e(ss(N,A,b,L,O,z,X,w,!0,a,!0),{u_texsize_icon:p,u_texture_icon:1}),Ea=(N,A,b)=>({u_matrix:N,u_opacity:A,u_color:b}),gs=(N,A,b,L,O,z)=>s.e(function(X,w,a,p){const x=a.imageManager.getPattern(X.from.toString()),B=a.imageManager.getPattern(X.to.toString()),{width:I,height:j}=a.imageManager.getPixelSize(),y=Math.pow(2,p.tileID.overscaledZ),E=p.tileSize*Math.pow(2,a.transform.tileZoom)/y,P=E*(p.tileID.canonical.x+p.tileID.wrap*y),V=E*p.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:x.tl,u_pattern_br_a:x.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[I,j],u_mix:w.t,u_pattern_size_a:x.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/Fe(p,1,a.transform.tileZoom),u_pixel_coord_upper:[P>>16,V>>16],u_pixel_coord_lower:[65535&P,65535&V]}}(L,z,b,O),{u_matrix:N,u_opacity:A}),Sa={fillExtrusion:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_lightpos:new s.aP(N,A.u_lightpos),u_lightintensity:new s.aM(N,A.u_lightintensity),u_lightcolor:new s.aP(N,A.u_lightcolor),u_vertical_gradient:new s.aM(N,A.u_vertical_gradient),u_opacity:new s.aM(N,A.u_opacity)}),fillExtrusionPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_lightpos:new s.aP(N,A.u_lightpos),u_lightintensity:new s.aM(N,A.u_lightintensity),u_lightcolor:new s.aP(N,A.u_lightcolor),u_vertical_gradient:new s.aM(N,A.u_vertical_gradient),u_height_factor:new s.aM(N,A.u_height_factor),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade),u_opacity:new s.aM(N,A.u_opacity)}),fill:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix)}),fillPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),fillOutline:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world)}),fillOutlinePattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),circle:(N,A)=>({u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_scale_with_map:new s.aL(N,A.u_scale_with_map),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_extrude_scale:new s.aQ(N,A.u_extrude_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_matrix:new s.aN(N,A.u_matrix)}),collisionBox:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(N,A.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(N,A.u_extrude_scale),u_overscale_factor:new s.aM(N,A.u_overscale_factor)}),collisionCircle:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_inv_matrix:new s.aN(N,A.u_inv_matrix),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_viewport_size:new s.aQ(N,A.u_viewport_size)}),debug:(N,A)=>({u_color:new s.aR(N,A.u_color),u_matrix:new s.aN(N,A.u_matrix),u_overlay:new s.aL(N,A.u_overlay),u_overlay_scale:new s.aM(N,A.u_overlay_scale)}),clippingMask:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix)}),heatmap:(N,A)=>({u_extrude_scale:new s.aM(N,A.u_extrude_scale),u_intensity:new s.aM(N,A.u_intensity),u_matrix:new s.aN(N,A.u_matrix)}),heatmapTexture:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world),u_image:new s.aL(N,A.u_image),u_color_ramp:new s.aL(N,A.u_color_ramp),u_opacity:new s.aM(N,A.u_opacity)}),hillshade:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_latrange:new s.aQ(N,A.u_latrange),u_light:new s.aQ(N,A.u_light),u_shadow:new s.aR(N,A.u_shadow),u_highlight:new s.aR(N,A.u_highlight),u_accent:new s.aR(N,A.u_accent)}),hillshadePrepare:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_dimension:new s.aQ(N,A.u_dimension),u_zoom:new s.aM(N,A.u_zoom),u_unpack:new s.aO(N,A.u_unpack)}),line:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels)}),lineGradient:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_image:new s.aL(N,A.u_image),u_image_height:new s.aM(N,A.u_image_height)}),linePattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texsize:new s.aQ(N,A.u_texsize),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_image:new s.aL(N,A.u_image),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),lineSDF:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_patternscale_a:new s.aQ(N,A.u_patternscale_a),u_patternscale_b:new s.aQ(N,A.u_patternscale_b),u_sdfgamma:new s.aM(N,A.u_sdfgamma),u_image:new s.aL(N,A.u_image),u_tex_y_a:new s.aM(N,A.u_tex_y_a),u_tex_y_b:new s.aM(N,A.u_tex_y_b),u_mix:new s.aM(N,A.u_mix)}),raster:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_tl_parent:new s.aQ(N,A.u_tl_parent),u_scale_parent:new s.aM(N,A.u_scale_parent),u_buffer_scale:new s.aM(N,A.u_buffer_scale),u_fade_t:new s.aM(N,A.u_fade_t),u_opacity:new s.aM(N,A.u_opacity),u_image0:new s.aL(N,A.u_image0),u_image1:new s.aL(N,A.u_image1),u_brightness_low:new s.aM(N,A.u_brightness_low),u_brightness_high:new s.aM(N,A.u_brightness_high),u_saturation_factor:new s.aM(N,A.u_saturation_factor),u_contrast_factor:new s.aM(N,A.u_contrast_factor),u_spin_weights:new s.aP(N,A.u_spin_weights)}),symbolIcon:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texture:new s.aL(N,A.u_texture)}),symbolSDF:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texture:new s.aL(N,A.u_texture),u_gamma_scale:new s.aM(N,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_is_halo:new s.aL(N,A.u_is_halo)}),symbolTextAndIcon:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texsize_icon:new s.aQ(N,A.u_texsize_icon),u_texture:new s.aL(N,A.u_texture),u_texture_icon:new s.aL(N,A.u_texture_icon),u_gamma_scale:new s.aM(N,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_is_halo:new s.aL(N,A.u_is_halo)}),background:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_opacity:new s.aM(N,A.u_opacity),u_color:new s.aR(N,A.u_color)}),backgroundPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_opacity:new s.aM(N,A.u_opacity),u_image:new s.aL(N,A.u_image),u_pattern_tl_a:new s.aQ(N,A.u_pattern_tl_a),u_pattern_br_a:new s.aQ(N,A.u_pattern_br_a),u_pattern_tl_b:new s.aQ(N,A.u_pattern_tl_b),u_pattern_br_b:new s.aQ(N,A.u_pattern_br_b),u_texsize:new s.aQ(N,A.u_texsize),u_mix:new s.aM(N,A.u_mix),u_pattern_size_a:new s.aQ(N,A.u_pattern_size_a),u_pattern_size_b:new s.aQ(N,A.u_pattern_size_b),u_scale_a:new s.aM(N,A.u_scale_a),u_scale_b:new s.aM(N,A.u_scale_b),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(N,A.u_tile_units_to_pixels)}),terrain:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texture:new s.aL(N,A.u_texture),u_ele_delta:new s.aM(N,A.u_ele_delta)}),terrainDepth:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ele_delta:new s.aM(N,A.u_ele_delta)}),terrainCoords:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texture:new s.aL(N,A.u_texture),u_terrain_coords_id:new s.aM(N,A.u_terrain_coords_id),u_ele_delta:new s.aM(N,A.u_ele_delta)})};class Za{constructor(A,b,L){this.context=A;const O=A.gl;this.buffer=O.createBuffer(),this.dynamicDraw=!!L,this.context.unbindVAO(),A.bindElementBuffer.set(this.buffer),O.bufferData(O.ELEMENT_ARRAY_BUFFER,b.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||delete b.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(A){const b=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),b.bufferSubData(b.ELEMENT_ARRAY_BUFFER,0,A.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ca={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Uc{constructor(A,b,L,O){this.length=b.length,this.attributes=L,this.itemSize=b.bytesPerElement,this.dynamicDraw=O,this.context=A;const z=A.gl;this.buffer=z.createBuffer(),A.bindVertexBuffer.set(this.buffer),z.bufferData(z.ARRAY_BUFFER,b.arrayBuffer,this.dynamicDraw?z.DYNAMIC_DRAW:z.STATIC_DRAW),this.dynamicDraw||delete b.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(A){if(A.length!==this.length)throw new Error(`Length of new data is ${A.length}, which doesn't match current length of ${this.length}`);const b=this.context.gl;this.bind(),b.bufferSubData(b.ARRAY_BUFFER,0,A.arrayBuffer)}enableAttributes(A,b){for(let L=0;L<this.attributes.length;L++){const O=b.attributes[this.attributes[L].name];O!==void 0&&A.enableVertexAttribArray(O)}}setVertexAttribPointers(A,b,L){for(let O=0;O<this.attributes.length;O++){const z=this.attributes[O],X=b.attributes[z.name];X!==void 0&&A.vertexAttribPointer(X,z.components,A[ca[z.type]],!1,this.itemSize,z.offset+this.itemSize*(L||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xa=new WeakMap;function go(N){var A;if(Xa.has(N))return Xa.get(N);{const b=(A=N.getParameter(N.VERSION))===null||A===void 0?void 0:A.startsWith("WebGL 2.0");return Xa.set(N,b),b}}class Pr{constructor(A){this.gl=A.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(A){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ua extends Pr{getDefault(){return s.aT.transparent}set(A){const b=this.current;(A.r!==b.r||A.g!==b.g||A.b!==b.b||A.a!==b.a||this.dirty)&&(this.gl.clearColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class us extends Pr{getDefault(){return 1}set(A){(A!==this.current||this.dirty)&&(this.gl.clearDepth(A),this.current=A,this.dirty=!1)}}class En extends Pr{getDefault(){return 0}set(A){(A!==this.current||this.dirty)&&(this.gl.clearStencil(A),this.current=A,this.dirty=!1)}}class hs extends Pr{getDefault(){return[!0,!0,!0,!0]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||A[3]!==b[3]||this.dirty)&&(this.gl.colorMask(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class ha extends Pr{getDefault(){return!0}set(A){(A!==this.current||this.dirty)&&(this.gl.depthMask(A),this.current=A,this.dirty=!1)}}class jr extends Pr{getDefault(){return 255}set(A){(A!==this.current||this.dirty)&&(this.gl.stencilMask(A),this.current=A,this.dirty=!1)}}class cl extends Pr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(A){const b=this.current;(A.func!==b.func||A.ref!==b.ref||A.mask!==b.mask||this.dirty)&&(this.gl.stencilFunc(A.func,A.ref,A.mask),this.current=A,this.dirty=!1)}}class Ql extends Pr{getDefault(){const A=this.gl;return[A.KEEP,A.KEEP,A.KEEP]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||this.dirty)&&(this.gl.stencilOp(A[0],A[1],A[2]),this.current=A,this.dirty=!1)}}class Io extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST),this.current=A,this.dirty=!1}}class Ko extends Pr{getDefault(){return[0,1]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||this.dirty)&&(this.gl.depthRange(A[0],A[1]),this.current=A,this.dirty=!1)}}class mc extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),this.current=A,this.dirty=!1}}class Wo extends Pr{getDefault(){return this.gl.LESS}set(A){(A!==this.current||this.dirty)&&(this.gl.depthFunc(A),this.current=A,this.dirty=!1)}}class mo extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.BLEND):b.disable(b.BLEND),this.current=A,this.dirty=!1}}class yc extends Pr{getDefault(){const A=this.gl;return[A.ONE,A.ZERO]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||this.dirty)&&(this.gl.blendFunc(A[0],A[1]),this.current=A,this.dirty=!1)}}class Zo extends Pr{getDefault(){return s.aT.transparent}set(A){const b=this.current;(A.r!==b.r||A.g!==b.g||A.b!==b.b||A.a!==b.a||this.dirty)&&(this.gl.blendColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class Vl extends Pr{getDefault(){return this.gl.FUNC_ADD}set(A){(A!==this.current||this.dirty)&&(this.gl.blendEquation(A),this.current=A,this.dirty=!1)}}class Nc extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE),this.current=A,this.dirty=!1}}class bh extends Pr{getDefault(){return this.gl.BACK}set(A){(A!==this.current||this.dirty)&&(this.gl.cullFace(A),this.current=A,this.dirty=!1)}}class hu extends Pr{getDefault(){return this.gl.CCW}set(A){(A!==this.current||this.dirty)&&(this.gl.frontFace(A),this.current=A,this.dirty=!1)}}class Au extends Pr{getDefault(){return null}set(A){(A!==this.current||this.dirty)&&(this.gl.useProgram(A),this.current=A,this.dirty=!1)}}class Ou extends Pr{getDefault(){return this.gl.TEXTURE0}set(A){(A!==this.current||this.dirty)&&(this.gl.activeTexture(A),this.current=A,this.dirty=!1)}}class Hl extends Pr{getDefault(){const A=this.gl;return[0,0,A.drawingBufferWidth,A.drawingBufferHeight]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||A[3]!==b[3]||this.dirty)&&(this.gl.viewport(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class Ja extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,A),this.current=A,this.dirty=!1}}class Ya extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindRenderbuffer(b.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class Gl extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindTexture(b.TEXTURE_2D,A),this.current=A,this.dirty=!1}}class el extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindBuffer(b.ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class Aa extends Pr{getDefault(){return null}set(A){const b=this.gl;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class ul extends Pr{getDefault(){return null}set(A){var b;if(A===this.current&&!this.dirty)return;const L=this.gl;go(L)?L.bindVertexArray(A):(b=L.getExtension("OES_vertex_array_object"))===null||b===void 0||b.bindVertexArrayOES(A),this.current=A,this.dirty=!1}}class jl extends Pr{getDefault(){return 4}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.pixelStorei(b.UNPACK_ALIGNMENT,A),this.current=A,this.dirty=!1}}class lo extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A),this.current=A,this.dirty=!1}}class da extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,A),this.current=A,this.dirty=!1}}class ne extends Pr{constructor(A,b){super(A),this.context=A,this.parent=b}getDefault(){return null}}class Pe extends ne{setDirty(){this.dirty=!0}set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const b=this.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,A,0),this.current=A,this.dirty=!1}}class ct extends ne{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class _t extends ne{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class xt{constructor(A,b,L,O,z){this.context=A,this.width=b,this.height=L;const X=A.gl,w=this.framebuffer=X.createFramebuffer();if(this.colorAttachment=new Pe(A,w),O)this.depthAttachment=z?new _t(A,w):new ct(A,w);else if(z)throw new Error("Stencil cannot be setted without depth");if(X.checkFramebufferStatus(X.FRAMEBUFFER)!==X.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const A=this.context.gl,b=this.colorAttachment.get();if(b&&A.deleteTexture(b),this.depthAttachment){const L=this.depthAttachment.get();L&&A.deleteRenderbuffer(L)}A.deleteFramebuffer(this.framebuffer)}}class Lt{constructor(A,b,L){this.blendFunction=A,this.blendColor=b,this.mask=L}}Lt.Replace=[1,0],Lt.disabled=new Lt(Lt.Replace,s.aT.transparent,[!1,!1,!1,!1]),Lt.unblended=new Lt(Lt.Replace,s.aT.transparent,[!0,!0,!0,!0]),Lt.alphaBlended=new Lt([1,771],s.aT.transparent,[!0,!0,!0,!0]);class pi{constructor(A){var b,L;if(this.gl=A,this.clearColor=new ua(this),this.clearDepth=new us(this),this.clearStencil=new En(this),this.colorMask=new hs(this),this.depthMask=new ha(this),this.stencilMask=new jr(this),this.stencilFunc=new cl(this),this.stencilOp=new Ql(this),this.stencilTest=new Io(this),this.depthRange=new Ko(this),this.depthTest=new mc(this),this.depthFunc=new Wo(this),this.blend=new mo(this),this.blendFunc=new yc(this),this.blendColor=new Zo(this),this.blendEquation=new Vl(this),this.cullFace=new Nc(this),this.cullFaceSide=new bh(this),this.frontFace=new hu(this),this.program=new Au(this),this.activeTexture=new Ou(this),this.viewport=new Hl(this),this.bindFramebuffer=new Ja(this),this.bindRenderbuffer=new Ya(this),this.bindTexture=new Gl(this),this.bindVertexBuffer=new el(this),this.bindElementBuffer=new Aa(this),this.bindVertexArray=new ul(this),this.pixelStoreUnpack=new jl(this),this.pixelStoreUnpackPremultiplyAlpha=new lo(this),this.pixelStoreUnpackFlipY=new da(this),this.extTextureFilterAnisotropic=A.getExtension("EXT_texture_filter_anisotropic")||A.getExtension("MOZ_EXT_texture_filter_anisotropic")||A.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=A.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=A.getParameter(A.MAX_TEXTURE_SIZE),go(A)){this.HALF_FLOAT=A.HALF_FLOAT;const O=A.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(b=A.RGBA16F)!==null&&b!==void 0?b:O==null?void 0:O.RGBA16F_EXT,this.RGB16F=(L=A.RGB16F)!==null&&L!==void 0?L:O==null?void 0:O.RGB16F_EXT,A.getExtension("EXT_color_buffer_float")}else{A.getExtension("EXT_color_buffer_half_float"),A.getExtension("OES_texture_half_float_linear");const O=A.getExtension("OES_texture_half_float");this.HALF_FLOAT=O==null?void 0:O.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(A,b){return new Za(this,A,b)}createVertexBuffer(A,b,L){return new Uc(this,A,b,L)}createRenderbuffer(A,b,L){const O=this.gl,z=O.createRenderbuffer();return this.bindRenderbuffer.set(z),O.renderbufferStorage(O.RENDERBUFFER,A,b,L),this.bindRenderbuffer.set(null),z}createFramebuffer(A,b,L,O){return new xt(this,A,b,L,O)}clear(A){let{color:b,depth:L,stencil:O}=A;const z=this.gl;let X=0;b&&(X|=z.COLOR_BUFFER_BIT,this.clearColor.set(b),this.colorMask.set([!0,!0,!0,!0])),L!==void 0&&(X|=z.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(L),this.depthMask.set(!0)),O!==void 0&&(X|=z.STENCIL_BUFFER_BIT,this.clearStencil.set(O),this.stencilMask.set(255)),z.clear(X)}setCullFace(A){A.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(A.mode),this.frontFace.set(A.frontFace))}setDepthMode(A){A.func!==this.gl.ALWAYS||A.mask?(this.depthTest.set(!0),this.depthFunc.set(A.func),this.depthMask.set(A.mask),this.depthRange.set(A.range)):this.depthTest.set(!1)}setStencilMode(A){A.test.func!==this.gl.ALWAYS||A.mask?(this.stencilTest.set(!0),this.stencilMask.set(A.mask),this.stencilOp.set([A.fail,A.depthFail,A.pass]),this.stencilFunc.set({func:A.test.func,ref:A.ref,mask:A.test.mask})):this.stencilTest.set(!1)}setColorMode(A){s.aG(A.blendFunction,Lt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(A.blendFunction),this.blendColor.set(A.blendColor)),this.colorMask.set(A.mask)}createVertexArray(){var A;return go(this.gl)?this.gl.createVertexArray():(A=this.gl.getExtension("OES_vertex_array_object"))===null||A===void 0?void 0:A.createVertexArrayOES()}deleteVertexArray(A){var b;return go(this.gl)?this.gl.deleteVertexArray(A):(b=this.gl.getExtension("OES_vertex_array_object"))===null||b===void 0?void 0:b.deleteVertexArrayOES(A)}unbindVAO(){this.bindVertexArray.set(null)}}class si{constructor(A,b,L){this.func=A,this.mask=b,this.range=L}}si.ReadOnly=!1,si.ReadWrite=!0,si.disabled=new si(519,si.ReadOnly,[0,1]);const nr=7680;class qi{constructor(A,b,L,O,z,X){this.test=A,this.ref=b,this.mask=L,this.fail=O,this.depthFail=z,this.pass=X}}qi.disabled=new qi({func:519,mask:0},0,0,nr,nr,nr);class Yi{constructor(A,b,L){this.enable=A,this.mode=b,this.frontFace=L}}let cr;function jn(N,A,b,L,O,z,X){const w=N.context,a=w.gl,p=N.useProgram("collisionBox"),x=[];let B=0,I=0;for(let K=0;K<L.length;K++){const ee=L[K],se=A.getTile(ee),oe=se.getBucket(b);if(!oe)continue;let le=ee.posMatrix;O[0]===0&&O[1]===0||(le=N.translatePosMatrix(ee.posMatrix,se,O,z));const _e=X?oe.textCollisionBox:oe.iconCollisionBox,Ie=oe.collisionCircleArray;if(Ie.length>0){const ve=s.Z(),Se=le;s.aU(ve,oe.placementInvProjMatrix,N.transform.glCoordMatrix),s.aU(ve,ve,oe.placementViewportMatrix),x.push({circleArray:Ie,circleOffset:I,transform:Se,invTransform:ve,coord:ee}),B+=Ie.length/4,I=B}_e&&p.draw(w,a.LINES,si.disabled,qi.disabled,N.colorModeForRenderPass(),Yi.disabled,gt(le,N.transform,se),N.style.map.terrain&&N.style.map.terrain.getTerrainData(ee),b.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,N.transform.zoom,null,null,_e.collisionVertexBuffer)}if(!X||!x.length)return;const j=N.useProgram("collisionCircle"),y=new s.aV;y.resize(4*B),y._trim();let E=0;for(const K of x)for(let ee=0;ee<K.circleArray.length/4;ee++){const se=4*ee,oe=K.circleArray[se+0],le=K.circleArray[se+1],_e=K.circleArray[se+2],Ie=K.circleArray[se+3];y.emplace(E++,oe,le,_e,Ie,0),y.emplace(E++,oe,le,_e,Ie,1),y.emplace(E++,oe,le,_e,Ie,2),y.emplace(E++,oe,le,_e,Ie,3)}(!cr||cr.length<2*B)&&(cr=function(K){const ee=2*K,se=new s.aX;se.resize(ee),se._trim();for(let oe=0;oe<ee;oe++){const le=6*oe;se.uint16[le+0]=4*oe+0,se.uint16[le+1]=4*oe+1,se.uint16[le+2]=4*oe+2,se.uint16[le+3]=4*oe+2,se.uint16[le+4]=4*oe+3,se.uint16[le+5]=4*oe+0}return se}(B));const P=w.createIndexBuffer(cr,!0),V=w.createVertexBuffer(y,s.aW.members,!0);for(const K of x){const ee={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(q=N.transform).cameraToCenterDistance,u_viewport_size:[q.width,q.height]};j.draw(w,a.TRIANGLES,si.disabled,qi.disabled,N.colorModeForRenderPass(),Yi.disabled,ee,N.style.map.terrain&&N.style.map.terrain.getTerrainData(K.coord),b.id,V,P,s.S.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,N.transform.zoom,null,null,null)}var q;V.destroy(),P.destroy()}Yi.disabled=new Yi(!1,1029,2305),Yi.backCCW=new Yi(!0,1029,2305);const or=s.ao(new Float32Array(16));function Pn(N,A,b,L,O,z){const{horizontalAlign:X,verticalAlign:w}=s.au(N);return new s.P((-(X-.5)*A/O+L[0])*z,(-(w-.5)*b/O+L[1])*z)}function Fr(N,A,b,L,O,z,X,w,a,p,x){const B=N.text.placedSymbolArray,I=N.text.dynamicLayoutVertexArray,j=N.icon.dynamicLayoutVertexArray,y={};I.clear();for(let E=0;E<B.length;E++){const P=B.get(E),V=P.hidden||!P.crossTileID||N.allowVerticalPlacement&&!P.placedOrientation?null:L[P.crossTileID];if(V){const q=new s.P(P.anchorX,P.anchorY),K=Qt(q,b?X:z,x),ee=Si(O.cameraToCenterDistance,K.signedDistanceFromCamera);let se=s.aj(N.textSizeData,a,P)*ee/s.ap;b&&(se*=N.tilePixelRatio/w);const{width:oe,height:le,anchor:_e,textOffset:Ie,textBoxScale:ve}=V,Se=Pn(_e,oe,le,Ie,ve,se),et=b?Qt(q.add(Se),z,x).point:K.point.add(A?Se.rotate(-O.angle):Se),Oe=N.allowVerticalPlacement&&P.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let Re=0;Re<P.numGlyphs;Re++)s.ak(I,et,Oe);p&&P.associatedIconIndex>=0&&(y[P.associatedIconIndex]={shiftedAnchor:et,angle:Oe})}else ge(P.numGlyphs,I)}if(p){j.clear();const E=N.icon.placedSymbolArray;for(let P=0;P<E.length;P++){const V=E.get(P);if(V.hidden)ge(V.numGlyphs,j);else{const q=y[P];if(q)for(let K=0;K<V.numGlyphs;K++)s.ak(j,q.shiftedAnchor,q.angle);else ge(V.numGlyphs,j)}}N.icon.dynamicLayoutVertexBuffer.updateData(j)}N.text.dynamicLayoutVertexBuffer.updateData(I)}function Ir(N,A,b){return b.iconsInText&&A?"symbolTextAndIcon":N?"symbolSDF":"symbolIcon"}function Ps(N,A,b,L,O,z,X,w,a,p,x,B){const I=N.context,j=I.gl,y=N.transform,E=w==="map",P=a==="map",V=w!=="viewport"&&b.layout.get("symbol-placement")!=="point",q=E&&!P&&!V,K=!b.layout.get("symbol-sort-key").isConstant();let ee=!1;const se=N.depthModeForSublayer(0,si.ReadOnly),oe=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),le=[];for(const _e of L){const Ie=A.getTile(_e),ve=Ie.getBucket(b);if(!ve)continue;const Se=O?ve.text:ve.icon;if(!Se||!Se.segments.get().length||!Se.hasVisibleVertices)continue;const et=Se.programConfigurations.get(b.id),Oe=O||ve.sdfIcons,Re=O?ve.textSizeData:ve.iconSizeData,Ve=P||y.pitch!==0,At=N.useProgram(Ir(Oe,O,ve),et),dt=s.ah(Re,y.zoom),ft=N.style.map.terrain&&N.style.map.terrain.getTerrainData(_e);let Nt,It,jt,Ht,Mi=[0,0],mi=null;if(O)It=Ie.glyphAtlasTexture,jt=j.LINEAR,Nt=Ie.glyphAtlasTexture.size,ve.iconsInText&&(Mi=Ie.imageAtlasTexture.size,mi=Ie.imageAtlasTexture,Ht=Ve||N.options.rotating||N.options.zooming||Re.kind==="composite"||Re.kind==="camera"?j.LINEAR:j.NEAREST);else{const Kr=b.layout.get("icon-size").constantOr(0)!==1||ve.iconsNeedLinear;It=Ie.imageAtlasTexture,jt=Oe||N.options.rotating||N.options.zooming||Kr||Ve?j.LINEAR:j.NEAREST,Nt=Ie.imageAtlasTexture.size}const Ti=Fe(Ie,1,N.transform.zoom),ui=Wt(_e.posMatrix,P,E,N.transform,Ti),ar=Ar(_e.posMatrix,P,E,N.transform,Ti),er=oe&&ve.hasTextData(),ir=b.layout.get("icon-text-fit")!=="none"&&er&&ve.hasIconData();if(V){const Kr=N.style.map.terrain?(Wr,ur)=>N.style.map.terrain.getElevation(_e,Wr,ur):null,kr=b.layout.get("text-rotation-alignment")==="map";Zt(ve,_e.posMatrix,N,O,ui,ar,P,p,kr,Kr)}const Dr=N.translatePosMatrix(_e.posMatrix,Ie,z,X),Rr=V||O&&oe||ir?or:ui,xr=N.translatePosMatrix(ar,Ie,z,X,!0),$r=Oe&&b.paint.get(O?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let br;br=Oe?ve.iconsInText?To(Re.kind,dt,q,P,N,Dr,Rr,xr,Nt,Mi):ss(Re.kind,dt,q,P,N,Dr,Rr,xr,O,Nt,!0):zl(Re.kind,dt,q,P,N,Dr,Rr,xr,O,Nt);const Wn={program:At,buffers:Se,uniformValues:br,atlasTexture:It,atlasTextureIcon:mi,atlasInterpolation:jt,atlasInterpolationIcon:Ht,isSDF:Oe,hasHalo:$r};if(K&&ve.canOverlap){ee=!0;const Kr=Se.segments.get();for(const kr of Kr)le.push({segments:new s.S([kr]),sortKey:kr.sortKey,state:Wn,terrainData:ft})}else le.push({segments:Se.segments,sortKey:0,state:Wn,terrainData:ft})}ee&&le.sort((_e,Ie)=>_e.sortKey-Ie.sortKey);for(const _e of le){const Ie=_e.state;if(I.activeTexture.set(j.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,j.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(I.activeTexture.set(j.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),Ie.isSDF){const ve=Ie.uniformValues;Ie.hasHalo&&(ve.u_is_halo=1,Xs(Ie.buffers,_e.segments,b,N,Ie.program,se,x,B,ve,_e.terrainData)),ve.u_is_halo=0}Xs(Ie.buffers,_e.segments,b,N,Ie.program,se,x,B,Ie.uniformValues,_e.terrainData)}}function Xs(N,A,b,L,O,z,X,w,a,p){const x=L.context;O.draw(x,x.gl.TRIANGLES,z,X,w,Yi.disabled,a,p,b.id,N.layoutVertexBuffer,N.indexBuffer,A,b.paint,L.transform.zoom,N.programConfigurations.get(b.id),N.dynamicLayoutVertexBuffer,N.opacityVertexBuffer)}function Lo(N,A,b,L,O){if(!b||!L||!L.imageAtlas)return;const z=L.imageAtlas.patternPositions;let X=z[b.to.toString()],w=z[b.from.toString()];if(!X&&w&&(X=w),!w&&X&&(w=X),!X||!w){const a=O.getPaintProperty(A);X=z[a],w=z[a]}X&&w&&N.setConstantPatternPositions(X,w)}function Ta(N,A,b,L,O,z,X){const w=N.context.gl,a="fill-pattern",p=b.paint.get(a),x=p&&p.constantOr(1),B=b.getCrossfadeParameters();let I,j,y,E,P;X?(j=x&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=w.LINES):(j=x?"fillPattern":"fill",I=w.TRIANGLES);const V=p.constantOr(null);for(const q of L){const K=A.getTile(q);if(x&&!K.patternsLoaded())continue;const ee=K.getBucket(b);if(!ee)continue;const se=ee.programConfigurations.get(b.id),oe=N.useProgram(j,se),le=N.style.map.terrain&&N.style.map.terrain.getTerrainData(q);x&&(N.context.activeTexture.set(w.TEXTURE0),K.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),se.updatePaintBuffers(B)),Lo(se,a,V,K,b);const _e=le?q:null,Ie=N.translatePosMatrix(_e?_e.posMatrix:q.posMatrix,K,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));if(X){E=ee.indexBuffer2,P=ee.segments2;const ve=[w.drawingBufferWidth,w.drawingBufferHeight];y=j==="fillOutlinePattern"&&x?He(Ie,N,B,K,ve):Ka(Ie,ve)}else E=ee.indexBuffer,P=ee.segments,y=x?Zs(Ie,N,B,K):$a(Ie);oe.draw(N.context,I,O,N.stencilModeForClipping(q),z,Yi.disabled,y,le,b.id,ee.layoutVertexBuffer,E,P,b.paint,N.transform.zoom,se)}}function fa(N,A,b,L,O,z,X){const w=N.context,a=w.gl,p="fill-extrusion-pattern",x=b.paint.get(p),B=x.constantOr(1),I=b.getCrossfadeParameters(),j=b.paint.get("fill-extrusion-opacity"),y=x.constantOr(null);for(const E of L){const P=A.getTile(E),V=P.getBucket(b);if(!V)continue;const q=N.style.map.terrain&&N.style.map.terrain.getTerrainData(E),K=V.programConfigurations.get(b.id),ee=N.useProgram(B?"fillExtrusionPattern":"fillExtrusion",K);B&&(N.context.activeTexture.set(a.TEXTURE0),P.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),K.updatePaintBuffers(I)),Lo(K,p,y,P,b);const se=N.translatePosMatrix(E.posMatrix,P,b.paint.get("fill-extrusion-translate"),b.paint.get("fill-extrusion-translate-anchor")),oe=b.paint.get("fill-extrusion-vertical-gradient"),le=B?Lr(se,N,oe,j,E,I,P):po(se,N,oe,j);ee.draw(w,w.gl.TRIANGLES,O,z,X,Yi.backCCW,le,q,b.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,b.paint,N.transform.zoom,K,N.style.map.terrain&&V.centroidVertexBuffer)}}function _c(N,A,b,L,O,z,X){const w=N.context,a=w.gl,p=b.fbo;if(!p)return;const x=N.useProgram("hillshade"),B=N.style.map.terrain&&N.style.map.terrain.getTerrainData(A);w.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,p.colorAttachment.get()),x.draw(w,a.TRIANGLES,O,z,X,Yi.disabled,((I,j,y,E)=>{const P=y.paint.get("hillshade-shadow-color"),V=y.paint.get("hillshade-highlight-color"),q=y.paint.get("hillshade-accent-color");let K=y.paint.get("hillshade-illumination-direction")*(Math.PI/180);y.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=I.transform.angle);const ee=!I.options.moving;return{u_matrix:E?E.posMatrix:I.transform.calculatePosMatrix(j.tileID.toUnwrapped(),ee),u_image:0,u_latrange:Br(0,j.tileID),u_light:[y.paint.get("hillshade-exaggeration"),K],u_shadow:P,u_highlight:V,u_accent:q}})(N,b,L,B?A:null),B,L.id,N.rasterBoundsBuffer,N.quadTriangleIndexBuffer,N.rasterBoundsSegments)}function hl(N,A,b,L,O,z){const X=N.context,w=X.gl,a=A.dem;if(a&&a.data){const p=a.dim,x=a.stride,B=a.getPixels();if(X.activeTexture.set(w.TEXTURE1),X.pixelStoreUnpackPremultiplyAlpha.set(!1),A.demTexture=A.demTexture||N.getTileTexture(x),A.demTexture){const j=A.demTexture;j.update(B,{premultiply:!1}),j.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else A.demTexture=new nt(X,B,w.RGBA,{premultiply:!1}),A.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);X.activeTexture.set(w.TEXTURE0);let I=A.fbo;if(!I){const j=new nt(X,{width:p,height:p,data:null},w.RGBA);j.bind(w.LINEAR,w.CLAMP_TO_EDGE),I=A.fbo=X.createFramebuffer(p,p,!0,!1),I.colorAttachment.set(j.texture)}X.bindFramebuffer.set(I.framebuffer),X.viewport.set([0,0,p,p]),N.useProgram("hillshadePrepare").draw(X,w.TRIANGLES,L,O,z,Yi.disabled,((j,y)=>{const E=y.stride,P=s.Z();return s.aS(P,0,s.N,-s.N,0,0,1),s.$(P,P,[0,-s.N,0]),{u_matrix:P,u_image:1,u_dimension:[E,E],u_zoom:j.overscaledZ,u_unpack:y.getUnpackVector()}})(A.tileID,a),null,b.id,N.rasterBoundsBuffer,N.quadTriangleIndexBuffer,N.rasterBoundsSegments),A.needsHillshadePrepare=!1}}function ql(N,A,b,L,O,z){const X=L.paint.get("raster-fade-duration");if(!z&&X>0){const w=s.h.now(),a=(w-N.timeAdded)/X,p=A?(w-A.timeAdded)/X:-1,x=b.getSource(),B=O.coveringZoomLevel({tileSize:x.tileSize,roundZoom:x.roundZoom}),I=!A||Math.abs(A.tileID.overscaledZ-B)>Math.abs(N.tileID.overscaledZ-B),j=I&&N.refreshedUponExpiration?1:s.ad(I?a:1-p,0,1);return N.refreshedUponExpiration&&a>=1&&(N.refreshedUponExpiration=!1),A?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const vc=new s.aT(1,0,0,1),Ia=new s.aT(0,1,0,1),ms=new s.aT(0,0,1,1),Al=new s.aT(1,0,1,1),$l=new s.aT(0,1,1,1);function La(N,A,b,L){Fs(N,0,A+b/2,N.transform.width,b,L)}function Ma(N,A,b,L){Fs(N,A-b/2,0,b,N.transform.height,L)}function Fs(N,A,b,L,O,z){const X=N.context,w=X.gl;w.enable(w.SCISSOR_TEST),w.scissor(A*N.pixelRatio,b*N.pixelRatio,L*N.pixelRatio,O*N.pixelRatio),X.clear({color:z}),w.disable(w.SCISSOR_TEST)}function Uu(N,A,b){const L=N.context,O=L.gl,z=b.posMatrix,X=N.useProgram("debug"),w=si.disabled,a=qi.disabled,p=N.colorModeForRenderPass(),x="$debug",B=N.style.map.terrain&&N.style.map.terrain.getTerrainData(b);L.activeTexture.set(O.TEXTURE0);const I=A.getTileByID(b.key).latestRawTileData,j=Math.floor((I&&I.byteLength||0)/1024),y=A.getTile(b).tileSize,E=512/Math.min(y,512)*(b.overscaledZ/N.transform.zoom)*.5;let P=b.canonical.toString();b.overscaledZ!==b.canonical.z&&(P+=` => ${b.overscaledZ}`),function(V,q){V.initDebugOverlayCanvas();const K=V.debugOverlayCanvas,ee=V.context.gl,se=V.debugOverlayCanvas.getContext("2d");se.clearRect(0,0,K.width,K.height),se.shadowColor="white",se.shadowBlur=2,se.lineWidth=1.5,se.strokeStyle="white",se.textBaseline="top",se.font="bold 36px Open Sans, sans-serif",se.fillText(q,5,5),se.strokeText(q,5,5),V.debugOverlayTexture.update(K),V.debugOverlayTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}(N,`${P} ${j}kB`),X.draw(L,O.TRIANGLES,w,a,Lt.alphaBlended,Yi.disabled,Ot(z,s.aT.transparent,E),null,x,N.debugBuffer,N.quadTriangleIndexBuffer,N.debugSegments),X.draw(L,O.LINE_STRIP,w,a,p,Yi.disabled,Ot(z,s.aT.red),B,x,N.debugBuffer,N.tileBorderIndexBuffer,N.debugSegments)}function Ln(N,A,b){const L=N.context,O=L.gl,z=N.colorModeForRenderPass(),X=new si(O.LEQUAL,si.ReadWrite,N.depthRangeFor3D),w=N.useProgram("terrain"),a=A.getTerrainMesh();L.bindFramebuffer.set(null),L.viewport.set([0,0,N.width,N.height]);for(const p of b){const x=N.renderToTexture.getTexture(p),B=A.getTerrainData(p.tileID);L.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,x.texture);const I={u_matrix:N.transform.calculatePosMatrix(p.tileID.toUnwrapped()),u_texture:0,u_ele_delta:A.getMeshFrameDelta(N.transform.zoom)};w.draw(L,O.TRIANGLES,X,qi.disabled,z,Yi.backCCW,I,B,"terrain",a.vertexBuffer,a.indexBuffer,a.segments)}}class fn{constructor(A,b){this.context=new pi(A),this.transform=b,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=$t.maxUnderzooming+$t.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Gs}resize(A,b,L){if(this.width=Math.floor(A*L),this.height=Math.floor(b*L),this.pixelRatio=L,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const O of this.style._order)this.style._layers[O].resize()}setup(){const A=this.context,b=new s.a_;b.emplaceBack(0,0),b.emplaceBack(s.N,0),b.emplaceBack(0,s.N),b.emplaceBack(s.N,s.N),this.tileExtentBuffer=A.createVertexBuffer(b,ao.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const L=new s.a_;L.emplaceBack(0,0),L.emplaceBack(s.N,0),L.emplaceBack(0,s.N),L.emplaceBack(s.N,s.N),this.debugBuffer=A.createVertexBuffer(L,ao.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const O=new s.V;O.emplaceBack(0,0,0,0),O.emplaceBack(s.N,0,s.N,0),O.emplaceBack(0,s.N,0,s.N),O.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=A.createVertexBuffer(O,Mt.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const z=new s.a_;z.emplaceBack(0,0),z.emplaceBack(1,0),z.emplaceBack(0,1),z.emplaceBack(1,1),this.viewportBuffer=A.createVertexBuffer(z,ao.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const X=new s.a$;X.emplaceBack(0),X.emplaceBack(1),X.emplaceBack(3),X.emplaceBack(2),X.emplaceBack(0),this.tileBorderIndexBuffer=A.createIndexBuffer(X);const w=new s.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=A.createIndexBuffer(w);const a=this.context.gl;this.stencilClearMode=new qi({func:a.ALWAYS,mask:0},0,255,a.ZERO,a.ZERO,a.ZERO)}clearStencil(){const A=this.context,b=A.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const L=s.Z();s.aS(L,0,this.width,this.height,0,0,1),s.a0(L,L,[b.drawingBufferWidth,b.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(A,b.TRIANGLES,si.disabled,this.stencilClearMode,Lt.disabled,Yi.disabled,di(L),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(A,b){if(this.currentStencilSource===A.source||!A.isTileClipped()||!b||!b.length)return;this.currentStencilSource=A.source;const L=this.context,O=L.gl;this.nextStencilID+b.length>256&&this.clearStencil(),L.setColorMode(Lt.disabled),L.setDepthMode(si.disabled);const z=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const X of b){const w=this._tileClippingMaskIDs[X.key]=this.nextStencilID++,a=this.style.map.terrain&&this.style.map.terrain.getTerrainData(X);z.draw(L,O.TRIANGLES,si.disabled,new qi({func:O.ALWAYS,mask:0},w,255,O.KEEP,O.KEEP,O.REPLACE),Lt.disabled,Yi.disabled,di(X.posMatrix),a,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const A=this.nextStencilID++,b=this.context.gl;return new qi({func:b.NOTEQUAL,mask:255},A,255,b.KEEP,b.KEEP,b.REPLACE)}stencilModeForClipping(A){const b=this.context.gl;return new qi({func:b.EQUAL,mask:255},this._tileClippingMaskIDs[A.key],0,b.KEEP,b.KEEP,b.REPLACE)}stencilConfigForOverlap(A){const b=this.context.gl,L=A.sort((X,w)=>w.overscaledZ-X.overscaledZ),O=L[L.length-1].overscaledZ,z=L[0].overscaledZ-O+1;if(z>1){this.currentStencilSource=void 0,this.nextStencilID+z>256&&this.clearStencil();const X={};for(let w=0;w<z;w++)X[w+O]=new qi({func:b.GEQUAL,mask:255},w+this.nextStencilID,255,b.KEEP,b.KEEP,b.REPLACE);return this.nextStencilID+=z,[X,L]}return[{[O]:qi.disabled},L]}colorModeForRenderPass(){const A=this.context.gl;return this._showOverdrawInspector?new Lt([A.CONSTANT_COLOR,A.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Lt.unblended:Lt.alphaBlended}depthModeForSublayer(A,b,L){if(!this.opaquePassEnabledForLayer())return si.disabled;const O=1-((1+this.currentLayer)*this.numSublayers+A)*this.depthEpsilon;return new si(L||this.context.gl.LEQUAL,b,[O,O])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(A,b){this.style=A,this.options=b,this.lineAtlas=A.lineAtlas,this.imageManager=A.imageManager,this.glyphManager=A.glyphManager,this.symbolFadeChange=A.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const L=this.style._order,O=this.style.sourceCaches,z={},X={},w={};for(const a in O){const p=O[a];p.used&&p.prepare(this.context),z[a]=p.getVisibleCoordinates(),X[a]=z[a].slice().reverse(),w[a]=p.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let a=0;a<L.length;a++)if(this.style._layers[L[a]].is3D()){this.opaquePassCutoff=a;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const a=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||a.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,x){const B=p.context,I=B.gl,j=Lt.unblended,y=new si(I.LEQUAL,si.ReadWrite,[0,1]),E=x.getTerrainMesh(),P=x.sourceCache.getRenderableTiles(),V=p.useProgram("terrainDepth");B.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),B.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),B.clear({color:s.aT.transparent,depth:1});for(const q of P){const K=x.getTerrainData(q.tileID),ee={u_matrix:p.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};V.draw(B,I.TRIANGLES,y,qi.disabled,j,Yi.backCCW,ee,K,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}B.bindFramebuffer.set(null),B.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,x){const B=p.context,I=B.gl,j=Lt.unblended,y=new si(I.LEQUAL,si.ReadWrite,[0,1]),E=x.getTerrainMesh(),P=x.getCoordsTexture(),V=x.sourceCache.getRenderableTiles(),q=p.useProgram("terrainCoords");B.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),B.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),B.clear({color:s.aT.transparent,depth:1}),x.coordsIndex=[];for(const K of V){const ee=x.getTerrainData(K.tileID);B.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.texture);const se={u_matrix:p.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};q.draw(B,I.TRIANGLES,y,qi.disabled,j,Yi.backCCW,se,ee,"terrain",E.vertexBuffer,E.indexBuffer,E.segments),x.coordsIndex.push(K.tileID.key)}B.bindFramebuffer.set(null),B.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const a of L){const p=this.style._layers[a];if(!p.hasOffscreenPass()||p.isHidden(this.transform.zoom))continue;const x=X[p.source];(p.type==="custom"||x.length)&&this.renderLayer(this,O[p.source],p,x)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:b.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=b.showOverdrawInspector,this.depthRangeFor3D=[0,1-(A._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=L.length-1;this.currentLayer>=0;this.currentLayer--){const a=this.style._layers[L[this.currentLayer]],p=O[a.source],x=z[a.source];this._renderTileClippingMasks(a,x),this.renderLayer(this,p,a,x)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const a=this.style._layers[L[this.currentLayer]],p=O[a.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(a))continue;const x=(a.type==="symbol"?w:X)[a.source];this._renderTileClippingMasks(a,z[a.source]),this.renderLayer(this,p,a,x)}if(this.options.showTileBoundaries){const a=function(p,x){let B=null;const I=Object.values(p._layers).flatMap(P=>P.source&&!P.isHidden(x)?[p.sourceCaches[P.source]]:[]),j=I.filter(P=>P.getSource().type==="vector"),y=I.filter(P=>P.getSource().type!=="vector"),E=P=>{(!B||B.getSource().maxzoom<P.getSource().maxzoom)&&(B=P)};return j.forEach(P=>E(P)),B||y.forEach(P=>E(P)),B}(this.style,this.transform.zoom);a&&function(p,x,B){for(let I=0;I<B.length;I++)Uu(p,x,B[I])}(this,a,a.getVisibleCoordinates())}this.options.showPadding&&function(a){const p=a.transform.padding;La(a,a.transform.height-(p.top||0),3,vc),La(a,p.bottom||0,3,Ia),Ma(a,p.left||0,3,ms),Ma(a,a.transform.width-(p.right||0),3,Al);const x=a.transform.centerPoint;(function(B,I,j,y){Fs(B,I-1,j-10,2,20,y),Fs(B,I-10,j-1,20,2,y)})(a,x.x,a.transform.height-x.y,$l)}(this),this.context.setDefault()}renderLayer(A,b,L,O){if(!L.isHidden(this.transform.zoom)&&(L.type==="background"||L.type==="custom"||(O||[]).length))switch(this.id=L.id,L.type){case"symbol":(function(z,X,w,a,p){if(z.renderPass!=="translucent")return;const x=qi.disabled,B=z.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(I,j,y,E,P,V,q){const K=j.transform,ee=P==="map",se=V==="map";for(const oe of I){const le=E.getTile(oe),_e=le.getBucket(y);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const Ie=s.ah(_e.textSizeData,K.zoom),ve=Fe(le,1,j.transform.zoom),Se=Wt(oe.posMatrix,se,ee,j.transform,ve),et=y.layout.get("icon-text-fit")!=="none"&&_e.hasIconData();if(Ie){const Oe=Math.pow(2,K.zoom-le.tileID.overscaledZ);Fr(_e,ee,se,q,K,Se,oe.posMatrix,Oe,Ie,et,j.style.map.terrain?(Re,Ve)=>j.style.map.terrain.getElevation(oe,Re,Ve):null)}}}(a,z,w,X,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),p),w.paint.get("icon-opacity").constantOr(1)!==0&&Ps(z,X,w,a,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),x,B),w.paint.get("text-opacity").constantOr(1)!==0&&Ps(z,X,w,a,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),x,B),X.map.showCollisionBoxes&&(jn(z,X,w,a,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),jn(z,X,w,a,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(A,b,L,O,this.style.placement.variableOffsets);break;case"circle":(function(z,X,w,a){if(z.renderPass!=="translucent")return;const p=w.paint.get("circle-opacity"),x=w.paint.get("circle-stroke-width"),B=w.paint.get("circle-stroke-opacity"),I=!w.layout.get("circle-sort-key").isConstant();if(p.constantOr(1)===0&&(x.constantOr(1)===0||B.constantOr(1)===0))return;const j=z.context,y=j.gl,E=z.depthModeForSublayer(0,si.ReadOnly),P=qi.disabled,V=z.colorModeForRenderPass(),q=[];for(let K=0;K<a.length;K++){const ee=a[K],se=X.getTile(ee),oe=se.getBucket(w);if(!oe)continue;const le=oe.programConfigurations.get(w.id),_e=z.useProgram("circle",le),Ie=oe.layoutVertexBuffer,ve=oe.indexBuffer,Se=z.style.map.terrain&&z.style.map.terrain.getTerrainData(ee),et={programConfiguration:le,program:_e,layoutVertexBuffer:Ie,indexBuffer:ve,uniformValues:Je(z,ee,se,w),terrainData:Se};if(I){const Oe=oe.segments.get();for(const Re of Oe)q.push({segments:new s.S([Re]),sortKey:Re.sortKey,state:et})}else q.push({segments:oe.segments,sortKey:0,state:et})}I&&q.sort((K,ee)=>K.sortKey-ee.sortKey);for(const K of q){const{programConfiguration:ee,program:se,layoutVertexBuffer:oe,indexBuffer:le,uniformValues:_e,terrainData:Ie}=K.state;se.draw(j,y.TRIANGLES,E,P,V,Yi.disabled,_e,Ie,w.id,oe,le,K.segments,w.paint,z.transform.zoom,ee)}})(A,b,L,O);break;case"heatmap":(function(z,X,w,a){if(w.paint.get("heatmap-opacity")!==0)if(z.renderPass==="offscreen"){const p=z.context,x=p.gl,B=qi.disabled,I=new Lt([x.ONE,x.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(j,y,E){const P=j.gl;j.activeTexture.set(P.TEXTURE1),j.viewport.set([0,0,y.width/4,y.height/4]);let V=E.heatmapFbo;if(V)P.bindTexture(P.TEXTURE_2D,V.colorAttachment.get()),j.bindFramebuffer.set(V.framebuffer);else{const q=P.createTexture();P.bindTexture(P.TEXTURE_2D,q),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.LINEAR),V=E.heatmapFbo=j.createFramebuffer(y.width/4,y.height/4,!1,!1),function(K,ee,se,oe){var le,_e;const Ie=K.gl,ve=(le=K.HALF_FLOAT)!==null&&le!==void 0?le:Ie.UNSIGNED_BYTE,Se=(_e=K.RGBA16F)!==null&&_e!==void 0?_e:Ie.RGBA;Ie.texImage2D(Ie.TEXTURE_2D,0,Se,ee.width/4,ee.height/4,0,Ie.RGBA,ve,null),oe.colorAttachment.set(se)}(j,y,q,V)}})(p,z,w),p.clear({color:s.aT.transparent});for(let j=0;j<a.length;j++){const y=a[j];if(X.hasRenderableParent(y))continue;const E=X.getTile(y),P=E.getBucket(w);if(!P)continue;const V=P.programConfigurations.get(w.id),q=z.useProgram("heatmap",V),{zoom:K}=z.transform;q.draw(p,x.TRIANGLES,si.disabled,B,I,Yi.disabled,ji(y.posMatrix,E,K,w.paint.get("heatmap-intensity")),null,w.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,w.paint,z.transform.zoom,V)}p.viewport.set([0,0,z.width,z.height])}else z.renderPass==="translucent"&&(z.context.setColorMode(z.colorModeForRenderPass()),function(p,x){const B=p.context,I=B.gl,j=x.heatmapFbo;if(!j)return;B.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,j.colorAttachment.get()),B.activeTexture.set(I.TEXTURE1);let y=x.colorRampTexture;y||(y=x.colorRampTexture=new nt(B,x.colorRamp,I.RGBA)),y.bind(I.LINEAR,I.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(B,I.TRIANGLES,si.disabled,qi.disabled,p.colorModeForRenderPass(),Yi.disabled,((E,P,V,q)=>{const K=s.Z();s.aS(K,0,E.width,E.height,0,0,1);const ee=E.context.gl;return{u_matrix:K,u_world:[ee.drawingBufferWidth,ee.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")}})(p,x),null,x.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,x.paint,p.transform.zoom)}(z,w))})(A,b,L,O);break;case"line":(function(z,X,w,a){if(z.renderPass!=="translucent")return;const p=w.paint.get("line-opacity"),x=w.paint.get("line-width");if(p.constantOr(1)===0||x.constantOr(1)===0)return;const B=z.depthModeForSublayer(0,si.ReadOnly),I=z.colorModeForRenderPass(),j=w.paint.get("line-dasharray"),y=w.paint.get("line-pattern"),E=y.constantOr(1),P=w.paint.get("line-gradient"),V=w.getCrossfadeParameters(),q=E?"linePattern":j?"lineSDF":P?"lineGradient":"line",K=z.context,ee=K.gl;let se=!0;for(const oe of a){const le=X.getTile(oe);if(E&&!le.patternsLoaded())continue;const _e=le.getBucket(w);if(!_e)continue;const Ie=_e.programConfigurations.get(w.id),ve=z.context.program.get(),Se=z.useProgram(q,Ie),et=se||Se.program!==ve,Oe=z.style.map.terrain&&z.style.map.terrain.getTerrainData(oe),Re=y.constantOr(null);if(Re&&le.imageAtlas){const dt=le.imageAtlas,ft=dt.patternPositions[Re.to.toString()],Nt=dt.patternPositions[Re.from.toString()];ft&&Nt&&Ie.setConstantPatternPositions(ft,Nt)}const Ve=Oe?oe:null,At=E?ns(z,le,w,V,Ve):j?_n(z,le,w,j,V,Ve):P?Gn(z,le,w,_e.lineClipsArray.length,Ve):In(z,le,w,Ve);if(E)K.activeTexture.set(ee.TEXTURE0),le.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Ie.updatePaintBuffers(V);else if(j&&(et||z.lineAtlas.dirty))K.activeTexture.set(ee.TEXTURE0),z.lineAtlas.bind(K);else if(P){const dt=_e.gradients[w.id];let ft=dt.texture;if(w.gradientVersion!==dt.version){let Nt=256;if(w.stepInterpolant){const It=X.getSource().maxzoom,jt=oe.canonical.z===It?Math.ceil(1<<z.transform.maxZoom-oe.canonical.z):1;Nt=s.ad(s.aY(_e.maxLineLength/s.N*1024*jt),256,K.maxTextureSize)}dt.gradient=s.aZ({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Nt,image:dt.gradient||void 0,clips:_e.lineClipsArray}),dt.texture?dt.texture.update(dt.gradient):dt.texture=new nt(K,dt.gradient,ee.RGBA),dt.version=w.gradientVersion,ft=dt.texture}K.activeTexture.set(ee.TEXTURE0),ft.bind(w.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}Se.draw(K,ee.TRIANGLES,B,z.stencilModeForClipping(oe),I,Yi.disabled,At,Oe,w.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,w.paint,z.transform.zoom,Ie,_e.layoutVertexBuffer2),se=!1}})(A,b,L,O);break;case"fill":(function(z,X,w,a){const p=w.paint.get("fill-color"),x=w.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const B=z.colorModeForRenderPass(),I=w.paint.get("fill-pattern"),j=z.opaquePassEnabledForLayer()&&!I.constantOr(1)&&p.constantOr(s.aT.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(z.renderPass===j){const y=z.depthModeForSublayer(1,z.renderPass==="opaque"?si.ReadWrite:si.ReadOnly);Ta(z,X,w,a,y,B,!1)}if(z.renderPass==="translucent"&&w.paint.get("fill-antialias")){const y=z.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,si.ReadOnly);Ta(z,X,w,a,y,B,!0)}})(A,b,L,O);break;case"fill-extrusion":(function(z,X,w,a){const p=w.paint.get("fill-extrusion-opacity");if(p!==0&&z.renderPass==="translucent"){const x=new si(z.context.gl.LEQUAL,si.ReadWrite,z.depthRangeFor3D);if(p!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))fa(z,X,w,a,x,qi.disabled,Lt.disabled),fa(z,X,w,a,x,z.stencilModeFor3D(),z.colorModeForRenderPass());else{const B=z.colorModeForRenderPass();fa(z,X,w,a,x,qi.disabled,B)}}})(A,b,L,O);break;case"hillshade":(function(z,X,w,a){if(z.renderPass!=="offscreen"&&z.renderPass!=="translucent")return;const p=z.context,x=z.depthModeForSublayer(0,si.ReadOnly),B=z.colorModeForRenderPass(),[I,j]=z.renderPass==="translucent"?z.stencilConfigForOverlap(a):[{},a];for(const y of j){const E=X.getTile(y);E.needsHillshadePrepare!==void 0&&E.needsHillshadePrepare&&z.renderPass==="offscreen"?hl(z,E,w,x,qi.disabled,B):z.renderPass==="translucent"&&_c(z,y,E,w,x,I[y.overscaledZ],B)}p.viewport.set([0,0,z.width,z.height])})(A,b,L,O);break;case"raster":(function(z,X,w,a){if(z.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!a.length)return;const p=z.context,x=p.gl,B=X.getSource(),I=z.useProgram("raster"),j=z.colorModeForRenderPass(),[y,E]=B instanceof qt?[{},a]:z.stencilConfigForOverlap(a),P=E[E.length-1].overscaledZ,V=!z.options.moving;for(const q of E){const K=z.depthModeForSublayer(q.overscaledZ-P,w.paint.get("raster-opacity")===1?si.ReadWrite:si.ReadOnly,x.LESS),ee=X.getTile(q);ee.registerFadeDuration(w.paint.get("raster-fade-duration"));const se=X.findLoadedParent(q,0),oe=ql(ee,se,X,w,z.transform,z.style.map.terrain);let le,_e;const Ie=w.paint.get("raster-resampling")==="nearest"?x.NEAREST:x.LINEAR;p.activeTexture.set(x.TEXTURE0),ee.texture.bind(Ie,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(x.TEXTURE1),se?(se.texture.bind(Ie,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),le=Math.pow(2,se.tileID.overscaledZ-ee.tileID.overscaledZ),_e=[ee.tileID.canonical.x*le%1,ee.tileID.canonical.y*le%1]):ee.texture.bind(Ie,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const ve=z.style.map.terrain&&z.style.map.terrain.getTerrainData(q),Se=ve?q:null,et=Se?Se.posMatrix:z.transform.calculatePosMatrix(q.toUnwrapped(),V),Oe=Cr(et,_e||[0,0],le||1,oe,w);B instanceof qt?I.draw(p,x.TRIANGLES,K,qi.disabled,j,Yi.disabled,Oe,ve,w.id,B.boundsBuffer,z.quadTriangleIndexBuffer,B.boundsSegments):I.draw(p,x.TRIANGLES,K,y[q.overscaledZ],j,Yi.disabled,Oe,ve,w.id,z.rasterBoundsBuffer,z.quadTriangleIndexBuffer,z.rasterBoundsSegments)}})(A,b,L,O);break;case"background":(function(z,X,w,a){const p=w.paint.get("background-color"),x=w.paint.get("background-opacity");if(x===0)return;const B=z.context,I=B.gl,j=z.transform,y=j.tileSize,E=w.paint.get("background-pattern");if(z.isPatternMissing(E))return;const P=!E&&p.a===1&&x===1&&z.opaquePassEnabledForLayer()?"opaque":"translucent";if(z.renderPass!==P)return;const V=qi.disabled,q=z.depthModeForSublayer(0,P==="opaque"?si.ReadWrite:si.ReadOnly),K=z.colorModeForRenderPass(),ee=z.useProgram(E?"backgroundPattern":"background"),se=a||j.coveringTiles({tileSize:y,terrain:z.style.map.terrain});E&&(B.activeTexture.set(I.TEXTURE0),z.imageManager.bind(z.context));const oe=w.getCrossfadeParameters();for(const le of se){const _e=a?le.posMatrix:z.transform.calculatePosMatrix(le.toUnwrapped()),Ie=E?gs(_e,x,z,E,{tileID:le,tileSize:y},oe):Ea(_e,x,p),ve=z.style.map.terrain&&z.style.map.terrain.getTerrainData(le);ee.draw(B,I.TRIANGLES,q,V,K,Yi.disabled,Ie,ve,w.id,z.tileExtentBuffer,z.quadTriangleIndexBuffer,z.tileExtentSegments)}})(A,0,L,O);break;case"custom":(function(z,X,w){const a=z.context,p=w.implementation;if(z.renderPass==="offscreen"){const x=p.prerender;x&&(z.setCustomLayerDefaults(),a.setColorMode(z.colorModeForRenderPass()),x.call(p,a.gl,z.transform.customLayerMatrix()),a.setDirty(),z.setBaseState())}else if(z.renderPass==="translucent"){z.setCustomLayerDefaults(),a.setColorMode(z.colorModeForRenderPass()),a.setStencilMode(qi.disabled);const x=p.renderingMode==="3d"?new si(z.context.gl.LEQUAL,si.ReadWrite,z.depthRangeFor3D):z.depthModeForSublayer(0,si.ReadOnly);a.setDepthMode(x),p.render(a.gl,z.transform.customLayerMatrix()),a.setDirty(),z.setBaseState(),a.bindFramebuffer.set(null)}})(A,0,L)}}translatePosMatrix(A,b,L,O,z){if(!L[0]&&!L[1])return A;const X=z?O==="map"?this.transform.angle:0:O==="viewport"?-this.transform.angle:0;if(X){const p=Math.sin(X),x=Math.cos(X);L=[L[0]*x-L[1]*p,L[0]*p+L[1]*x]}const w=[z?L[0]:Fe(b,L[0],this.transform.zoom),z?L[1]:Fe(b,L[1],this.transform.zoom),0],a=new Float32Array(16);return s.$(a,A,w),a}saveTileTexture(A){const b=this._tileTextures[A.size[0]];b?b.push(A):this._tileTextures[A.size[0]]=[A]}getTileTexture(A){const b=this._tileTextures[A];return b&&b.length>0?b.pop():null}isPatternMissing(A){if(!A)return!1;if(!A.from||!A.to)return!0;const b=this.imageManager.getPattern(A.from.toString()),L=this.imageManager.getPattern(A.to.toString());return!b||!L}useProgram(A,b){this.cache=this.cache||{};const L=A+(b?b.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[L]||(this.cache[L]=new Tn(this.context,vr[A],b,Sa[A],this._showOverdrawInspector,this.style.map.terrain)),this.cache[L]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const A=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(A.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new nt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:A,drawingBufferHeight:b}=this.context.gl;return this.width!==A||this.height!==b}}class pn{constructor(A,b){this.points=A,this.planes=b}static fromInvProjectionMatrix(A,b,L){const O=Math.pow(2,L),z=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const a=1/(w=s.ag([],w,A))[3]/b*O;return s.b3(w,w,[a,a,1/w[3],a])}),X=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const a=function(I,j){var y=j[0],E=j[1],P=j[2],V=y*y+E*E+P*P;return V>0&&(V=1/Math.sqrt(V)),I[0]=j[0]*V,I[1]=j[1]*V,I[2]=j[2]*V,I}([],function(I,j,y){var E=j[0],P=j[1],V=j[2],q=y[0],K=y[1],ee=y[2];return I[0]=P*ee-V*K,I[1]=V*q-E*ee,I[2]=E*K-P*q,I}([],je([],z[w[0]],z[w[1]]),je([],z[w[2]],z[w[1]]))),p=-((x=a)[0]*(B=z[w[1]])[0]+x[1]*B[1]+x[2]*B[2]);var x,B;return a.concat(p)});return new pn(z,X)}}class As{constructor(A,b){this.min=A,this.max=b,this.center=function(L,O,z){return L[0]=.5*O[0],L[1]=.5*O[1],L[2]=.5*O[2],L}([],function(L,O,z){return L[0]=O[0]+z[0],L[1]=O[1]+z[1],L[2]=O[2]+z[2],L}([],this.min,this.max))}quadrant(A){const b=[A%2==0,A<2],L=Te(this.min),O=Te(this.max);for(let z=0;z<b.length;z++)L[z]=b[z]?this.min[z]:this.center[z],O[z]=b[z]?this.center[z]:this.max[z];return O[2]=this.max[2],new As(L,O)}distanceX(A){return Math.max(Math.min(this.max[0],A[0]),this.min[0])-A[0]}distanceY(A){return Math.max(Math.min(this.max[1],A[1]),this.min[1])-A[1]}intersects(A){const b=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let L=!0;for(let O=0;O<A.planes.length;O++){const z=A.planes[O];let X=0;for(let w=0;w<b.length;w++)s.b4(z,b[w])>=0&&X++;if(X===0)return 0;X!==b.length&&(L=!1)}if(L)return 2;for(let O=0;O<3;O++){let z=Number.MAX_VALUE,X=-Number.MAX_VALUE;for(let w=0;w<A.points.length;w++){const a=A.points[w][O]-this.min[O];z=Math.min(z,a),X=Math.max(X,a)}if(X<0||z>this.max[O]-this.min[O])return 0}return 1}}class pa{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(A)||A<0||isNaN(b)||b<0||isNaN(L)||L<0||isNaN(O)||O<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=A,this.bottom=b,this.left=L,this.right=O}interpolate(A,b,L){return b.top!=null&&A.top!=null&&(this.top=s.B.number(A.top,b.top,L)),b.bottom!=null&&A.bottom!=null&&(this.bottom=s.B.number(A.bottom,b.bottom,L)),b.left!=null&&A.left!=null&&(this.left=s.B.number(A.left,b.left,L)),b.right!=null&&A.right!=null&&(this.right=s.B.number(A.right,b.right,L)),this}getCenter(A,b){const L=s.ad((this.left+A-this.right)/2,0,A),O=s.ad((this.top+b-this.bottom)/2,0,b);return new s.P(L,O)}equals(A){return this.top===A.top&&this.bottom===A.bottom&&this.left===A.left&&this.right===A.right}clone(){return new pa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Kl{constructor(A,b,L,O,z){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=z===void 0||!!z,this._minZoom=A||0,this._maxZoom=b||22,this._minPitch=L??0,this._maxPitch=O??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new pa,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const A=new Kl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return A.apply(this),A}apply(A){this.tileSize=A.tileSize,this.latRange=A.latRange,this.width=A.width,this.height=A.height,this._center=A._center,this._elevation=A._elevation,this._minEleveationForCurrentTile=A._minEleveationForCurrentTile,this.zoom=A.zoom,this.angle=A.angle,this._fov=A._fov,this._pitch=A._pitch,this._unmodified=A._unmodified,this._edgeInsets=A._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(A){this._minZoom!==A&&(this._minZoom=A,this.zoom=Math.max(this.zoom,A))}get maxZoom(){return this._maxZoom}set maxZoom(A){this._maxZoom!==A&&(this._maxZoom=A,this.zoom=Math.min(this.zoom,A))}get minPitch(){return this._minPitch}set minPitch(A){this._minPitch!==A&&(this._minPitch=A,this.pitch=Math.max(this.pitch,A))}get maxPitch(){return this._maxPitch}set maxPitch(A){this._maxPitch!==A&&(this._maxPitch=A,this.pitch=Math.min(this.pitch,A))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(A){A===void 0?A=!0:A===null&&(A=!1),this._renderWorldCopies=A}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(A){const b=-s.b5(A,-180,180)*Math.PI/180;this.angle!==b&&(this._unmodified=!1,this.angle=b,this._calcMatrices(),this.rotationMatrix=function(){var L=new s.A(4);return s.A!=Float32Array&&(L[1]=0,L[2]=0),L[0]=1,L[3]=1,L}(),function(L,O,z){var X=O[0],w=O[1],a=O[2],p=O[3],x=Math.sin(z),B=Math.cos(z);L[0]=X*B+a*x,L[1]=w*B+p*x,L[2]=X*-x+a*B,L[3]=w*-x+p*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(A){const b=s.ad(A,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==b&&(this._unmodified=!1,this._pitch=b,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(A){A=Math.max(.01,Math.min(60,A)),this._fov!==A&&(this._unmodified=!1,this._fov=A/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(A){const b=Math.min(Math.max(A,this.minZoom),this.maxZoom);this._zoom!==b&&(this._unmodified=!1,this._zoom=b,this.tileZoom=Math.max(0,Math.floor(b)),this.scale=this.zoomScale(b),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(A){A.lat===this._center.lat&&A.lng===this._center.lng||(this._unmodified=!1,this._center=A,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(A){A!==this._elevation&&(this._elevation=A,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(A){this._edgeInsets.equals(A)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,A,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(A){return this._edgeInsets.equals(A)}interpolatePadding(A,b,L){this._unmodified=!1,this._edgeInsets.interpolate(A,b,L),this._constrain(),this._calcMatrices()}coveringZoomLevel(A){const b=(A.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/A.tileSize));return Math.max(0,b)}getVisibleUnwrappedCoordinates(A){const b=[new s.b6(0,A)];if(this._renderWorldCopies){const L=this.pointCoordinate(new s.P(0,0)),O=this.pointCoordinate(new s.P(this.width,0)),z=this.pointCoordinate(new s.P(this.width,this.height)),X=this.pointCoordinate(new s.P(0,this.height)),w=Math.floor(Math.min(L.x,O.x,z.x,X.x)),a=Math.floor(Math.max(L.x,O.x,z.x,X.x)),p=1;for(let x=w-p;x<=a+p;x++)x!==0&&b.push(new s.b6(x,A))}return b}coveringTiles(A){var b,L;let O=this.coveringZoomLevel(A);const z=O;if(A.minzoom!==void 0&&O<A.minzoom)return[];A.maxzoom!==void 0&&O>A.maxzoom&&(O=A.maxzoom);const X=this.pointCoordinate(this.getCameraPoint()),w=s.U.fromLngLat(this.center),a=Math.pow(2,O),p=[a*X.x,a*X.y,0],x=[a*w.x,a*w.y,0],B=pn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,O);let I=A.minzoom||0;!A.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(I=O);const j=A.terrain?2/Math.min(this.tileSize,A.tileSize)*this.tileSize:3,y=K=>({aabb:new As([K*a,0,0],[(K+1)*a,a,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),E=[],P=[],V=O,q=A.reparseOverscaled?z:O;if(this._renderWorldCopies)for(let K=1;K<=3;K++)E.push(y(-K)),E.push(y(K));for(E.push(y(0));E.length>0;){const K=E.pop(),ee=K.x,se=K.y;let oe=K.fullyVisible;if(!oe){const Se=K.aabb.intersects(B);if(Se===0)continue;oe=Se===2}const le=A.terrain?p:x,_e=K.aabb.distanceX(le),Ie=K.aabb.distanceY(le),ve=Math.max(Math.abs(_e),Math.abs(Ie));if(K.zoom===V||ve>j+(1<<V-K.zoom)-2&&K.zoom>=I){const Se=V-K.zoom,et=p[0]-.5-(ee<<Se),Oe=p[1]-.5-(se<<Se);P.push({tileID:new s.O(K.zoom===V?q:K.zoom,K.wrap,K.zoom,ee,se),distanceSq:We([x[0]-.5-ee,x[1]-.5-se]),tileDistanceToCamera:Math.sqrt(et*et+Oe*Oe)})}else for(let Se=0;Se<4;Se++){const et=(ee<<1)+Se%2,Oe=(se<<1)+(Se>>1),Re=K.zoom+1;let Ve=K.aabb.quadrant(Se);if(A.terrain){const At=new s.O(Re,K.wrap,Re,et,Oe),dt=A.terrain.getMinMaxElevation(At),ft=(b=dt.minElevation)!==null&&b!==void 0?b:this.elevation,Nt=(L=dt.maxElevation)!==null&&L!==void 0?L:this.elevation;Ve=new As([Ve.min[0],Ve.min[1],ft],[Ve.max[0],Ve.max[1],Nt])}E.push({aabb:Ve,zoom:Re,x:et,y:Oe,wrap:K.wrap,fullyVisible:oe})}}return P.sort((K,ee)=>K.distanceSq-ee.distanceSq).map(K=>K.tileID)}resize(A,b){this.width=A,this.height=b,this.pixelsToGLUnits=[2/A,-2/b],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(A){return Math.pow(2,A)}scaleZoom(A){return Math.log(A)/Math.LN2}project(A){const b=s.ad(A.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(A.lng)*this.worldSize,s.H(b)*this.worldSize)}unproject(A){return new s.U(A.x/this.worldSize,A.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(A){const b=this.pointLocation(this.centerPoint,A),L=A.getElevationForLngLatZoom(b,this.tileZoom);if(!(this.elevation-L))return;const O=this.getCameraPosition(),z=s.U.fromLngLat(O.lngLat,O.altitude),X=s.U.fromLngLat(b,L),w=z.x-X.x,a=z.y-X.y,p=z.z-X.z,x=Math.sqrt(w*w+a*a+p*p),B=this.scaleZoom(this.cameraToCenterDistance/x/this.tileSize);this._elevation=L,this._center=b,this.zoom=B}setLocationAtPoint(A,b){const L=this.pointCoordinate(b),O=this.pointCoordinate(this.centerPoint),z=this.locationCoordinate(A),X=new s.U(z.x-(L.x-O.x),z.y-(L.y-O.y));this.center=this.coordinateLocation(X),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(A,b){return b?this.coordinatePoint(this.locationCoordinate(A),b.getElevationForLngLatZoom(A,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(A))}pointLocation(A,b){return this.coordinateLocation(this.pointCoordinate(A,b))}locationCoordinate(A){return s.U.fromLngLat(A)}coordinateLocation(A){return A&&A.toLngLat()}pointCoordinate(A,b){if(b){const I=b.pointCoordinate(A);if(I!=null)return I}const L=[A.x,A.y,0,1],O=[A.x,A.y,1,1];s.ag(L,L,this.pixelMatrixInverse),s.ag(O,O,this.pixelMatrixInverse);const z=L[3],X=O[3],w=L[1]/z,a=O[1]/X,p=L[2]/z,x=O[2]/X,B=p===x?0:(0-p)/(x-p);return new s.U(s.B.number(L[0]/z,O[0]/X,B)/this.worldSize,s.B.number(w,a,B)/this.worldSize)}coordinatePoint(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const O=[A.x*this.worldSize,A.y*this.worldSize,b,1];return s.ag(O,O,L),new s.P(O[0]/O[3],O[1]/O[3])}getBounds(){const A=Math.max(0,this.height/2-this.getHorizon());return new Xe().extend(this.pointLocation(new s.P(0,A))).extend(this.pointLocation(new s.P(this.width,A))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Xe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(A){A?(this.lngRange=[A.getWest(),A.getEast()],this.latRange=[A.getSouth(),A.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const L=A.key,O=b?this._alignedPosMatrixCache:this._posMatrixCache;if(O[L])return O[L];const z=A.canonical,X=this.worldSize/this.zoomScale(z.z),w=z.x+Math.pow(2,z.z)*A.wrap,a=s.ao(new Float64Array(16));return s.$(a,a,[w*X,z.y*X,0]),s.a0(a,a,[X/s.N,X/s.N,1]),s.a1(a,b?this.alignedProjMatrix:this.projMatrix,a),O[L]=new Float32Array(a),O[L]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let A,b,L,O,z=-90,X=90,w=-180,a=180;const p=this.size,x=this._unmodified;if(this.latRange){const j=this.latRange;z=s.H(j[1])*this.worldSize,X=s.H(j[0])*this.worldSize,A=X-z<p.y?p.y/(X-z):0}if(this.lngRange){const j=this.lngRange;w=s.b5(s.G(j[0])*this.worldSize,0,this.worldSize),a=s.b5(s.G(j[1])*this.worldSize,0,this.worldSize),a<w&&(a+=this.worldSize),b=a-w<p.x?p.x/(a-w):0}const B=this.point,I=Math.max(b||0,A||0);if(I)return this.center=this.unproject(new s.P(b?(a+w)/2:B.x,A?(X+z)/2:B.y)),this.zoom+=this.scaleZoom(I),this._unmodified=x,void(this._constraining=!1);if(this.latRange){const j=B.y,y=p.y/2;j-y<z&&(O=z+y),j+y>X&&(O=X-y)}if(this.lngRange){const j=(w+a)/2,y=s.b5(B.x,j-this.worldSize/2,j+this.worldSize/2),E=p.x/2;y-E<w&&(L=w+E),y+E>a&&(L=a-E)}L===void 0&&O===void 0||(this.center=this.unproject(new s.P(L!==void 0?L:B.x,O!==void 0?O:B.y)).wrap()),this._unmodified=x,this._constraining=!1}_calcMatrices(){if(!this.height)return;const A=this.centerOffset,b=this.point.x,L=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let O=s.ao(new Float64Array(16));s.a0(O,O,[this.width/2,-this.height/2,1]),s.$(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=s.ao(new Float64Array(16)),s.a0(O,O,[1,-1,1]),s.$(O,O,[-1,-1,0]),s.a0(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O;const z=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),X=Math.min(this.elevation,this._minEleveationForCurrentTile),w=z-X*this._pixelPerMeter/Math.cos(this._pitch),a=X<0?w:z,p=Math.PI/2+this._pitch,x=this._fov*(.5+A.y/this.height),B=Math.sin(x)*a/Math.sin(s.ad(Math.PI-p-x,.01,Math.PI-.01)),I=this.getHorizon(),j=2*Math.atan(I/this.cameraToCenterDistance)*(.5+A.y/(2*I)),y=Math.sin(j)*a/Math.sin(s.ad(Math.PI-p-j,.01,Math.PI-.01)),E=Math.min(B,y),P=1.01*(Math.cos(Math.PI/2-this._pitch)*E+a),V=this.height/50;O=new Float64Array(16),s.b8(O,this._fov,this.width/this.height,V,P),O[8]=2*-A.x/this.width,O[9]=2*A.y/this.height,s.a0(O,O,[1,-1,1]),s.$(O,O,[0,0,-this.cameraToCenterDistance]),s.b9(O,O,this._pitch),s.ae(O,O,this.angle),s.$(O,O,[-b,-L,0]),this.mercatorMatrix=s.a0([],O,[this.worldSize,this.worldSize,this.worldSize]),s.a0(O,O,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,O),s.$(O,O,[0,0,-this.elevation]),this.projMatrix=O,this.invProjMatrix=s.as([],O),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,O);const q=this.width%2/2,K=this.height%2/2,ee=Math.cos(this.angle),se=Math.sin(this.angle),oe=b-Math.round(b)+ee*q+se*K,le=L-Math.round(L)+ee*K+se*q,_e=new Float64Array(O);if(s.$(_e,_e,[oe>.5?oe-1:oe,le>.5?le-1:le,0]),this.alignedProjMatrix=_e,O=s.as(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");this.pixelMatrixInverse=O,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const A=this.pointCoordinate(new s.P(0,0)),b=[A.x*this.worldSize,A.y*this.worldSize,0,1];return s.ag(b,b,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const A=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,A))}getCameraQueryGeometry(A){const b=this.getCameraPoint();if(A.length===1)return[A[0],b];{let L=b.x,O=b.y,z=b.x,X=b.y;for(const w of A)L=Math.min(L,w.x),O=Math.min(O,w.y),z=Math.max(z,w.x),X=Math.max(X,w.y);return[new s.P(L,O),new s.P(z,O),new s.P(z,X),new s.P(L,X),new s.P(L,O)]}}}function co(N,A){var b=this;let L,O=!1,z=null,X=null;const w=()=>{z=null,O&&(N.apply(X,L),z=setTimeout(w,A),O=!1)};return function(){for(var a=arguments.length,p=new Array(a),x=0;x<a;x++)p[x]=arguments[x];return O=!0,X=b,L=p,z||w(),z}}class ys{constructor(A){this._getCurrentHash=()=>{const b=window.location.hash.replace("#","");if(this._hashName){let L;return b.split("&").map(O=>O.split("=")).forEach(O=>{O[0]===this._hashName&&(L=O)}),(L&&L[1]||"").split("/")}return b.split("/")},this._onHashChange=()=>{const b=this._getCurrentHash();if(b.length>=3&&!b.some(L=>isNaN(L))){const L=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(b[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+b[2],+b[1]],zoom:+b[0],bearing:L,pitch:+(b[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const b=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,b)}catch{}},this._updateHash=co(this._updateHashUnthrottled,300),this._hashName=A&&encodeURIComponent(A)}addTo(A){return this._map=A,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(A){const b=this._map.getCenter(),L=Math.round(100*this._map.getZoom())/100,O=Math.ceil((L*Math.LN2+Math.log(512/360/.5))/Math.LN10),z=Math.pow(10,O),X=Math.round(b.lng*z)/z,w=Math.round(b.lat*z)/z,a=this._map.getBearing(),p=this._map.getPitch();let x="";if(x+=A?`/${X}/${w}/${L}`:`${L}/${w}/${X}`,(a||p)&&(x+="/"+Math.round(10*a)/10),p&&(x+=`/${Math.round(p)}`),this._hashName){const B=this._hashName;let I=!1;const j=window.location.hash.slice(1).split("&").map(y=>{const E=y.split("=")[0];return E===B?(I=!0,`${E}=${x}`):y}).filter(y=>y);return I||j.push(`${B}=${x}`),`#${j.join("&")}`}return`#${x}`}}const ds={linearity:.3,easing:s.ba(0,0,.3,1)},Mo=s.e({deceleration:2500,maxSpeed:1400},ds),yo=s.e({deceleration:20,maxSpeed:1400},ds),ga=s.e({deceleration:1e3,maxSpeed:360},ds),tl=s.e({deceleration:1e3,maxSpeed:90},ds);class Po{constructor(A){this._map=A,this.clear()}clear(){this._inertiaBuffer=[]}record(A){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:A})}_drainInertiaBuffer(){const A=this._inertiaBuffer,b=s.h.now();for(;A.length>0&&b-A[0].time>160;)A.shift()}_onMoveEnd(A){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const b={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:z}of this._inertiaBuffer)b.zoom+=z.zoomDelta||0,b.bearing+=z.bearingDelta||0,b.pitch+=z.pitchDelta||0,z.panDelta&&b.pan._add(z.panDelta),z.around&&(b.around=z.around),z.pinchAround&&(b.pinchAround=z.pinchAround);const L=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,O={};if(b.pan.mag()){const z=js(b.pan.mag(),L,s.e({},Mo,A||{}));O.offset=b.pan.mult(z.amount/b.pan.mag()),O.center=this._map.transform.center,Js(O,z)}if(b.zoom){const z=js(b.zoom,L,yo);O.zoom=this._map.transform.zoom+z.amount,Js(O,z)}if(b.bearing){const z=js(b.bearing,L,ga);O.bearing=this._map.transform.bearing+s.ad(z.amount,-179,179),Js(O,z)}if(b.pitch){const z=js(b.pitch,L,tl);O.pitch=this._map.transform.pitch+z.amount,Js(O,z)}if(O.zoom||O.bearing){const z=b.pinchAround===void 0?b.around:b.pinchAround;O.around=z?this._map.unproject(z):this._map.getCenter()}return this.clear(),s.e(O,{noMoveStart:!0})}}function Js(N,A){(!N.duration||N.duration<A.duration)&&(N.duration=A.duration,N.easing=A.easing)}function js(N,A,b){const{maxSpeed:L,linearity:O,deceleration:z}=b,X=s.ad(N*O/(A/1e3),-L,L),w=Math.abs(X)/(z*O);return{easing:b.easing,duration:1e3*w,amount:X*(w/2)}}class _s extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,b,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const z=v.mousePos(b.getCanvasContainer(),L),X=b.unproject(z);super(A,s.e({point:z,lngLat:X,originalEvent:L},O)),this._defaultPrevented=!1,this.target=b}}class uo extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,b,L){const O=A==="touchend"?L.changedTouches:L.touches,z=v.touchPos(b.getCanvasContainer(),O),X=z.map(a=>b.unproject(a)),w=z.reduce((a,p,x,B)=>a.add(p.div(B.length)),new s.P(0,0));super(A,{points:z,point:w,lngLats:X,lngLat:b.unproject(w),originalEvent:L}),this._defaultPrevented=!1}}class Pa extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,b,L){super(A,{originalEvent:L}),this._defaultPrevented=!1}}class dl{constructor(A,b){this._map=A,this._clickTolerance=b.clickTolerance}reset(){delete this._mousedownPos}wheel(A){return this._firePreventable(new Pa(A.type,this._map,A))}mousedown(A,b){return this._mousedownPos=b,this._firePreventable(new _s(A.type,this._map,A))}mouseup(A){this._map.fire(new _s(A.type,this._map,A))}click(A,b){this._mousedownPos&&this._mousedownPos.dist(b)>=this._clickTolerance||this._map.fire(new _s(A.type,this._map,A))}dblclick(A){return this._firePreventable(new _s(A.type,this._map,A))}mouseover(A){this._map.fire(new _s(A.type,this._map,A))}mouseout(A){this._map.fire(new _s(A.type,this._map,A))}touchstart(A){return this._firePreventable(new uo(A.type,this._map,A))}touchmove(A){this._map.fire(new uo(A.type,this._map,A))}touchend(A){this._map.fire(new uo(A.type,this._map,A))}touchcancel(A){this._map.fire(new uo(A.type,this._map,A))}_firePreventable(A){if(this._map.fire(A),A.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wl{constructor(A){this._map=A}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(A){this._map.fire(new _s(A.type,this._map,A))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _s("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(A){this._delayContextMenu?this._contextMenuEvent=A:this._ignoreContextMenu||this._map.fire(new _s(A.type,this._map,A)),this._map.listens("contextmenu")&&A.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ds{constructor(A){this._map=A}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(A){return this.transform.pointLocation(s.P.convert(A),this._map.terrain)}}class Xo{constructor(A,b){this._map=A,this._tr=new Ds(A),this._el=A.getCanvasContainer(),this._container=A.getContainer(),this._clickTolerance=b.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(A,b){this.isEnabled()&&A.shiftKey&&A.button===0&&(v.disableDrag(),this._startPos=this._lastPos=b,this._active=!0)}mousemoveWindow(A,b){if(!this._active)return;const L=b;if(this._lastPos.equals(L)||!this._box&&L.dist(this._startPos)<this._clickTolerance)return;const O=this._startPos;this._lastPos=L,this._box||(this._box=v.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",A));const z=Math.min(O.x,L.x),X=Math.max(O.x,L.x),w=Math.min(O.y,L.y),a=Math.max(O.y,L.y);v.setTransform(this._box,`translate(${z}px,${w}px)`),this._box.style.width=X-z+"px",this._box.style.height=a-w+"px"}mouseupWindow(A,b){if(!this._active||A.button!==0)return;const L=this._startPos,O=b;if(this.reset(),v.suppressClick(),L.x!==O.x||L.y!==O.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:A})),{cameraAnimation:z=>z.fitScreenCoordinates(L,O,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",A)}keydown(A){this._active&&A.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",A))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(v.remove(this._box),this._box=null),v.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(A,b){return this._map.fire(new s.k(A,{originalEvent:b}))}}function ln(N,A){if(N.length!==A.length)throw new Error(`The number of touches and points are not equal - touches ${N.length}, points ${A.length}`);const b={};for(let L=0;L<N.length;L++)b[N[L].identifier]=A[L];return b}class qn{constructor(A){this.reset(),this.numTouches=A.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(A,b,L){(this.centroid||L.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=A.timeStamp),L.length===this.numTouches&&(this.centroid=function(O){const z=new s.P(0,0);for(const X of O)z._add(X);return z.div(O.length)}(b),this.touches=ln(L,b)))}touchmove(A,b,L){if(this.aborted||!this.centroid)return;const O=ln(L,b);for(const z in this.touches){const X=O[z];(!X||X.dist(this.touches[z])>30)&&(this.aborted=!0)}}touchend(A,b,L){if((!this.centroid||A.timeStamp-this.startTime>500)&&(this.aborted=!0),L.length===0){const O=!this.aborted&&this.centroid;if(this.reset(),O)return O}}}class os{constructor(A){this.singleTap=new qn(A),this.numTaps=A.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(A,b,L){this.singleTap.touchstart(A,b,L)}touchmove(A,b,L){this.singleTap.touchmove(A,b,L)}touchend(A,b,L){const O=this.singleTap.touchend(A,b,L);if(O){const z=A.timeStamp-this.lastTime<500,X=!this.lastTap||this.lastTap.dist(O)<30;if(z&&X||this.reset(),this.count++,this.lastTime=A.timeStamp,this.lastTap=O,this.count===this.numTaps)return this.reset(),O}}}class Ur{constructor(A){this._tr=new Ds(A),this._zoomIn=new os({numTouches:1,numTaps:2}),this._zoomOut=new os({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(A,b,L){this._zoomIn.touchstart(A,b,L),this._zoomOut.touchstart(A,b,L)}touchmove(A,b,L){this._zoomIn.touchmove(A,b,L),this._zoomOut.touchmove(A,b,L)}touchend(A,b,L){const O=this._zoomIn.touchend(A,b,L),z=this._zoomOut.touchend(A,b,L),X=this._tr;return O?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:X.zoom+1,around:X.unproject(O)},{originalEvent:A})}):z?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:X.zoom-1,around:X.unproject(z)},{originalEvent:A})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class en{constructor(A){this._enabled=!!A.enable,this._moveStateManager=A.moveStateManager,this._clickTolerance=A.clickTolerance||1,this._moveFunction=A.move,this._activateOnStart=!!A.activateOnStart,A.assignEvents(this),this.reset()}reset(A){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(A)}_move(){const A=this._moveFunction(...arguments);if(A.bearingDelta||A.pitchDelta||A.around||A.panDelta)return this._active=!0,A}dragStart(A,b){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(A)&&(this._moveStateManager.startMove(A),this._lastPoint=b.length?b[0]:b,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(A,b){if(!this.isEnabled())return;const L=this._lastPoint;if(!L)return;if(A.preventDefault(),!this._moveStateManager.isValidMoveEvent(A))return void this.reset(A);const O=b.length?b[0]:b;return!this._moved&&O.dist(L)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=O,this._move(L,O))}dragEnd(A){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(A)&&(this._moved&&v.suppressClick(),this.reset(A))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const nn={0:1,2:2};class Nn{constructor(A){this._correctEvent=A.checkCorrectEvent}startMove(A){const b=v.mouseButton(A);this._eventButton=b}endMove(A){delete this._eventButton}isValidStartEvent(A){return this._correctEvent(A)}isValidMoveEvent(A){return!function(b,L){const O=nn[L];return b.buttons===void 0||(b.buttons&O)!==O}(A,this._eventButton)}isValidEndEvent(A){return v.mouseButton(A)===this._eventButton}}class ma{constructor(){this._firstTouch=void 0}_isOneFingerTouch(A){return A.targetTouches.length===1}_isSameTouchEvent(A){return A.targetTouches[0].identifier===this._firstTouch}startMove(A){this._firstTouch=A.targetTouches[0].identifier}endMove(A){delete this._firstTouch}isValidStartEvent(A){return this._isOneFingerTouch(A)}isValidMoveEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}isValidEndEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}}const Fa=N=>{N.mousedown=N.dragStart,N.mousemoveWindow=N.dragMove,N.mouseup=N.dragEnd,N.contextmenu=function(A){A.preventDefault()}},Jo=N=>{let{enable:A,clickTolerance:b,bearingDegreesPerPixelMoved:L=.8}=N;const O=new Nn({checkCorrectEvent:z=>v.mouseButton(z)===0&&z.ctrlKey||v.mouseButton(z)===2});return new en({clickTolerance:b,move:(z,X)=>({bearingDelta:(X.x-z.x)*L}),moveStateManager:O,enable:A,assignEvents:Fa})},Yo=N=>{let{enable:A,clickTolerance:b,pitchDegreesPerPixelMoved:L=-.5}=N;const O=new Nn({checkCorrectEvent:z=>v.mouseButton(z)===0&&z.ctrlKey||v.mouseButton(z)===2});return new en({clickTolerance:b,move:(z,X)=>({pitchDelta:(X.y-z.y)*L}),moveStateManager:O,enable:A,assignEvents:Fa})};class Ui{constructor(A,b){this._minTouches=A.cooperativeGestures?2:1,this._clickTolerance=A.clickTolerance||1,this._map=b,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(A,b,L){return this._calculateTransform(A,b,L)}touchmove(A,b,L){if(this._map._cooperativeGestures&&(this._minTouches===2&&L.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(A,!1,L.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(L.length<this._minTouches))return A.preventDefault(),this._calculateTransform(A,b,L)}touchend(A,b,L){this._calculateTransform(A,b,L),this._active&&L.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(A,b,L){L.length>0&&(this._active=!0);const O=ln(L,b),z=new s.P(0,0),X=new s.P(0,0);let w=0;for(const p in O){const x=O[p],B=this._touches[p];B&&(z._add(x),X._add(x.sub(B)),w++,O[p]=x)}if(this._touches=O,w<this._minTouches||!X.mag())return;const a=X.div(w);return this._sum._add(a),this._sum.mag()<this._clickTolerance?void 0:{around:z.div(w),panDelta:a}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ya{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(A,b,L){this._firstTwoTouches||L.length<2||(this._firstTwoTouches=[L[0].identifier,L[1].identifier],this._start([b[0],b[1]]))}touchmove(A,b,L){if(!this._firstTwoTouches)return;A.preventDefault();const[O,z]=this._firstTwoTouches,X=Di(L,b,O),w=Di(L,b,z);if(!X||!w)return;const a=this._aroundCenter?null:X.add(w).div(2);return this._move([X,w],a,A)}touchend(A,b,L){if(!this._firstTwoTouches)return;const[O,z]=this._firstTwoTouches,X=Di(L,b,O),w=Di(L,b,z);X&&w||(this._active&&v.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(A){this._enabled=!0,this._aroundCenter=!!A&&A.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Di(N,A,b){for(let L=0;L<N.length;L++)if(N[L].identifier===b)return A[L]}function fl(N,A){return Math.log(N/A)/Math.LN2}class pl extends ya{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(A){this._startDistance=this._distance=A[0].dist(A[1])}_move(A,b){const L=this._distance;if(this._distance=A[0].dist(A[1]),this._active||!(Math.abs(fl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fl(this._distance,L),pinchAround:b}}}function Li(N,A){return 180*N.angleWith(A)/Math.PI}class bc extends ya{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(A){this._startVector=this._vector=A[0].sub(A[1]),this._minDiameter=A[0].dist(A[1])}_move(A,b){const L=this._vector;if(this._vector=A[0].sub(A[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Li(this._vector,L),pinchAround:b}}_isBelowThreshold(A){this._minDiameter=Math.min(this._minDiameter,A.mag());const b=25/(Math.PI*this._minDiameter)*360,L=Li(A,this._startVector);return Math.abs(L)<b}}function Fi(N){return Math.abs(N.y)>Math.abs(N.x)}class Ys extends ya{constructor(A){super(),this._map=A}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(A,b,L){super.touchstart(A,b,L),this._currentTouchCount=L.length}_start(A){this._lastPoints=A,Fi(A[0].sub(A[1]))&&(this._valid=!1)}_move(A,b,L){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const O=A[0].sub(this._lastPoints[0]),z=A[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(O,z,L.timeStamp),this._valid?(this._lastPoints=A,this._active=!0,{pitchDelta:(O.y+z.y)/2*-.5}):void 0}gestureBeginsVertically(A,b,L){if(this._valid!==void 0)return this._valid;const O=A.mag()>=2,z=b.mag()>=2;if(!O&&!z)return;if(!O||!z)return this._firstMove===void 0&&(this._firstMove=L),L-this._firstMove<100&&void 0;const X=A.y>0==b.y>0;return Fi(A)&&Fi(b)&&X}}const eo={panStep:100,bearingStep:15,pitchStep:10};class zc{constructor(A){this._tr=new Ds(A);const b=eo;this._panStep=b.panStep,this._bearingStep=b.bearingStep,this._pitchStep=b.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(A){if(A.altKey||A.ctrlKey||A.metaKey)return;let b=0,L=0,O=0,z=0,X=0;switch(A.keyCode){case 61:case 107:case 171:case 187:b=1;break;case 189:case 109:case 173:b=-1;break;case 37:A.shiftKey?L=-1:(A.preventDefault(),z=-1);break;case 39:A.shiftKey?L=1:(A.preventDefault(),z=1);break;case 38:A.shiftKey?O=1:(A.preventDefault(),X=-1);break;case 40:A.shiftKey?O=-1:(A.preventDefault(),X=1);break;default:return}return this._rotationDisabled&&(L=0,O=0),{cameraAnimation:w=>{const a=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Zl,zoom:b?Math.round(a.zoom)+b*(A.shiftKey?2:1):a.zoom,bearing:a.bearing+L*this._bearingStep,pitch:a.pitch+O*this._pitchStep,offset:[-z*this._panStep,-X*this._panStep],center:a.center},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zl(N){return N*(2-N)}const du=4.000244140625;class Qc{constructor(A,b){this._onTimeout=L=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(L)},this._map=A,this._tr=new Ds(A),this._el=A.getCanvasContainer(),this._triggerRenderFrame=b,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(A){this._defaultZoomRate=A}setWheelZoomRate(A){this._wheelZoomRate=A}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(A){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!A&&A.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(A){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!A[this._map._metaKey])return;A.preventDefault()}let b=A.deltaMode===WheelEvent.DOM_DELTA_LINE?40*A.deltaY:A.deltaY;const L=s.h.now(),O=L-(this._lastWheelEventTime||0);this._lastWheelEventTime=L,b!==0&&b%du==0?this._type="wheel":b!==0&&Math.abs(b)<4?this._type="trackpad":O>400?(this._type=null,this._lastValue=b,this._timeout=setTimeout(this._onTimeout,40,A)):this._type||(this._type=Math.abs(O*b)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,b+=this._lastValue)),A.shiftKey&&b&&(b/=4),this._type&&(this._lastWheelEvent=A,this._delta-=b,this._active||this._start(A)),A.preventDefault()}_start(A){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const b=v.mousePos(this._el,A),L=this._tr;this._around=s.L.convert(this._aroundCenter?L.center:L.unproject(b)),this._aroundPoint=L.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const A=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>du?this._wheelZoomRate:this._defaultZoomRate;let a=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&a!==0&&(a=1/a);const p=typeof this._targetZoom=="number"?A.zoomScale(this._targetZoom):A.scale;this._targetZoom=Math.min(A.maxZoom,Math.max(A.minZoom,A.scaleZoom(p*a))),this._type==="wheel"&&(this._startZoom=A.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const b=typeof this._targetZoom=="number"?this._targetZoom:A.zoom,L=this._startZoom,O=this._easing;let z,X=!1;if(this._type==="wheel"&&L&&O){const w=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),a=O(w);z=s.B.number(L,b,a),w<1?this._frameId||(this._frameId=!0):X=!0}else z=b,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:z-A.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(A){let b=s.bb;if(this._prevEase){const L=this._prevEase,O=(s.h.now()-L.start)/L.duration,z=L.easing(O+.01)-L.easing(O),X=.27/Math.sqrt(z*z+1e-4)*.01,w=Math.sqrt(.0729-X*X);b=s.ba(X,w,.25,1)}return this._prevEase={start:s.h.now(),duration:A,easing:b},b}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Xl{constructor(A,b){this._clickZoom=A,this._tapZoom=b}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vc{constructor(A){this._tr=new Ds(A),this.reset()}reset(){this._active=!1}dblclick(A,b){return A.preventDefault(),{cameraAnimation:L=>{L.easeTo({duration:300,zoom:this._tr.zoom+(A.shiftKey?-1:1),around:this._tr.unproject(b)},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class il{constructor(){this._tap=new os({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(A,b,L){if(!this._swipePoint)if(this._tapTime){const O=b[0],z=A.timeStamp-this._tapTime<500,X=this._tapPoint.dist(O)<30;z&&X?L.length>0&&(this._swipePoint=O,this._swipeTouch=L[0].identifier):this.reset()}else this._tap.touchstart(A,b,L)}touchmove(A,b,L){if(this._tapTime){if(this._swipePoint){if(L[0].identifier!==this._swipeTouch)return;const O=b[0],z=O.y-this._swipePoint.y;return this._swipePoint=O,A.preventDefault(),this._active=!0,{zoomDelta:z/128}}}else this._tap.touchmove(A,b,L)}touchend(A,b,L){if(this._tapTime)this._swipePoint&&L.length===0&&this.reset();else{const O=this._tap.touchend(A,b,L);O&&(this._tapTime=A.timeStamp,this._tapPoint=O)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vn{constructor(A,b,L){this._el=A,this._mousePan=b,this._touchPan=L}enable(A){this._inertiaOptions=A||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rs{constructor(A,b,L){this._pitchWithRotate=A.pitchWithRotate,this._mouseRotate=b,this._mousePitch=L}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fo{constructor(A,b,L,O){this._el=A,this._touchZoom=b,this._touchRotate=L,this._tapDragZoom=O,this._rotationDisabled=!1,this._enabled=!0}enable(A){this._touchZoom.enable(A),this._rotationDisabled||this._touchRotate.enable(A),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gl=N=>N.zoom||N.drag||N.pitch||N.rotate;class fu extends s.k{}function Hc(N){return N.panDelta&&N.panDelta.mag()||N.zoomDelta||N.bearingDelta||N.pitchDelta}class Nu{constructor(A,b){this.handleWindowEvent=O=>{this.handleEvent(O,`${O.type}Window`)},this.handleEvent=(O,z)=>{if(O.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const X=O.type==="renderFrame"?void 0:O,w={needsRenderFrame:!1},a={},p={},x=O.touches,B=x?this._getMapTouches(x):void 0,I=B?v.touchPos(this._el,B):v.mousePos(this._el,O);for(const{handlerName:E,handler:P,allowed:V}of this._handlers){if(!P.isEnabled())continue;let q;this._blockedByActive(p,V,E)?P.reset():P[z||O.type]&&(q=P[z||O.type](O,I,B),this.mergeHandlerResult(w,a,q,E,X),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||P.isActive())&&(p[E]=P)}const j={};for(const E in this._previousActiveHandlers)p[E]||(j[E]=X);this._previousActiveHandlers=p,(Object.keys(j).length||Hc(w))&&(this._changes.push([w,a,j]),this._triggerRenderFrame()),(Object.keys(p).length||Hc(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:y}=w;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))},this._map=A,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Po(A),this._bearingSnap=b.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(b);const L=this._el;this._listeners=[[L,"touchstart",{passive:!0}],[L,"touchmove",{passive:!1}],[L,"touchend",void 0],[L,"touchcancel",void 0],[L,"mousedown",void 0],[L,"mousemove",void 0],[L,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[L,"mouseover",void 0],[L,"mouseout",void 0],[L,"dblclick",void 0],[L,"click",void 0],[L,"keydown",{capture:!1}],[L,"keyup",void 0],[L,"wheel",{passive:!1}],[L,"contextmenu",void 0],[window,"blur",void 0]];for(const[O,z,X]of this._listeners)v.addEventListener(O,z,O===document?this.handleWindowEvent:this.handleEvent,X)}destroy(){for(const[A,b,L]of this._listeners)v.removeEventListener(A,b,A===document?this.handleWindowEvent:this.handleEvent,L)}_addDefaultHandlers(A){const b=this._map,L=b.getCanvasContainer();this._add("mapEvent",new dl(b,A));const O=b.boxZoom=new Xo(b,A);this._add("boxZoom",O),A.interactive&&A.boxZoom&&O.enable();const z=new Ur(b),X=new Vc(b);b.doubleClickZoom=new Xl(X,z),this._add("tapZoom",z),this._add("clickZoom",X),A.interactive&&A.doubleClickZoom&&b.doubleClickZoom.enable();const w=new il;this._add("tapDragZoom",w);const a=b.touchPitch=new Ys(b);this._add("touchPitch",a),A.interactive&&A.touchPitch&&b.touchPitch.enable(A.touchPitch);const p=Jo(A),x=Yo(A);b.dragRotate=new Rs(A,p,x),this._add("mouseRotate",p,["mousePitch"]),this._add("mousePitch",x,["mouseRotate"]),A.interactive&&A.dragRotate&&b.dragRotate.enable();const B=(V=>{let{enable:q,clickTolerance:K}=V;const ee=new Nn({checkCorrectEvent:se=>v.mouseButton(se)===0&&!se.ctrlKey});return new en({clickTolerance:K,move:(se,oe)=>({around:oe,panDelta:oe.sub(se)}),activateOnStart:!0,moveStateManager:ee,enable:q,assignEvents:Fa})})(A),I=new Ui(A,b);b.dragPan=new vn(L,B,I),this._add("mousePan",B),this._add("touchPan",I,["touchZoom","touchRotate"]),A.interactive&&A.dragPan&&b.dragPan.enable(A.dragPan);const j=new bc,y=new pl;b.touchZoomRotate=new Fo(L,y,j,w),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",y,["touchPan","touchRotate"]),A.interactive&&A.touchZoomRotate&&b.touchZoomRotate.enable(A.touchZoomRotate);const E=b.scrollZoom=new Qc(b,()=>this._triggerRenderFrame());this._add("scrollZoom",E,["mousePan"]),A.interactive&&A.scrollZoom&&b.scrollZoom.enable(A.scrollZoom);const P=b.keyboard=new zc(b);this._add("keyboard",P),A.interactive&&A.keyboard&&b.keyboard.enable(),this._add("blockableMapEvent",new Wl(b))}_add(A,b,L){this._handlers.push({handlerName:A,handler:b,allowed:L}),this._handlersById[A]=b}stop(A){if(!this._updatingCamera){for(const{handler:b}of this._handlers)b.reset();this._inertia.clear(),this._fireEvents({},{},A),this._changes=[]}}isActive(){for(const{handler:A}of this._handlers)if(A.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gl(this._eventsInProgress)||this.isZooming()}_blockedByActive(A,b,L){for(const O in A)if(O!==L&&(!b||b.indexOf(O)<0))return!0;return!1}_getMapTouches(A){const b=[];for(const L of A)this._el.contains(L.target)&&b.push(L);return b}mergeHandlerResult(A,b,L,O,z){if(!L)return;s.e(A,L);const X={handlerName:O,originalEvent:L.originalEvent||z};L.zoomDelta!==void 0&&(b.zoom=X),L.panDelta!==void 0&&(b.drag=X),L.pitchDelta!==void 0&&(b.pitch=X),L.bearingDelta!==void 0&&(b.rotate=X)}_applyChanges(){const A={},b={},L={};for(const[O,z,X]of this._changes)O.panDelta&&(A.panDelta=(A.panDelta||new s.P(0,0))._add(O.panDelta)),O.zoomDelta&&(A.zoomDelta=(A.zoomDelta||0)+O.zoomDelta),O.bearingDelta&&(A.bearingDelta=(A.bearingDelta||0)+O.bearingDelta),O.pitchDelta&&(A.pitchDelta=(A.pitchDelta||0)+O.pitchDelta),O.around!==void 0&&(A.around=O.around),O.pinchAround!==void 0&&(A.pinchAround=O.pinchAround),O.noInertia&&(A.noInertia=O.noInertia),s.e(b,z),s.e(L,X);this._updateMapTransform(A,b,L),this._changes=[]}_updateMapTransform(A,b,L){const O=this._map,z=O._getTransformForUpdate(),X=O.terrain;if(!(Hc(A)||X&&this._terrainMovement))return this._fireEvents(b,L,!0);let{panDelta:w,zoomDelta:a,bearingDelta:p,pitchDelta:x,around:B,pinchAround:I}=A;I!==void 0&&(B=I),O._stop(!0),B=B||O.transform.centerPoint;const j=z.pointLocation(w?B.sub(w):B);p&&(z.bearing+=p),x&&(z.pitch+=x),a&&(z.zoom+=a),X?this._terrainMovement||!b.drag&&!b.zoom?b.drag&&this._terrainMovement?z.center=z.pointLocation(z.centerPoint.sub(w)):z.setLocationAtPoint(j,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,z.setLocationAtPoint(j,B),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,z.recalculateZoom(O.terrain)})):z.setLocationAtPoint(j,B),O._applyUpdatedTransform(z),this._map._update(),A.noInertia||this._inertia.record(A),this._fireEvents(b,L,!0)}_fireEvents(A,b,L){const O=gl(this._eventsInProgress),z=gl(A),X={};for(const x in A){const{originalEvent:B}=A[x];this._eventsInProgress[x]||(X[`${x}start`]=B),this._eventsInProgress[x]=A[x]}!O&&z&&this._fireEvent("movestart",z.originalEvent);for(const x in X)this._fireEvent(x,X[x]);z&&this._fireEvent("move",z.originalEvent);for(const x in A){const{originalEvent:B}=A[x];this._fireEvent(x,B)}const w={};let a;for(const x in this._eventsInProgress){const{handlerName:B,originalEvent:I}=this._eventsInProgress[x];this._handlersById[B].isActive()||(delete this._eventsInProgress[x],a=b[B]||I,w[`${x}end`]=a)}for(const x in w)this._fireEvent(x,w[x]);const p=gl(this._eventsInProgress);if(L&&(O||z)&&!p){this._updatingCamera=!0;const x=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=I=>I!==0&&-this._bearingSnap<I&&I<this._bearingSnap;!x||!x.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:a})),B(this._map.getBearing())&&this._map.resetNorth()):(B(x.bearing||this._map.getBearing())&&(x.bearing=0),x.freezeElevation=!0,this._map.easeTo(x,{originalEvent:a})),this._updatingCamera=!1}}_fireEvent(A,b){this._map.fire(new s.k(A,b?{originalEvent:b}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(A=>{delete this._frameId,this.handleEvent(new fu("renderFrame",{timeStamp:A})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class _a extends s.E{constructor(A,b){super(),this._renderFrameCallback=()=>{const L=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(L)),L<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=A,this._bearingSnap=b.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(A,b){return this.jumpTo({center:A},b)}panBy(A,b,L){return A=s.P.convert(A).mult(-1),this.panTo(this.transform.center,s.e({offset:A},b),L)}panTo(A,b,L){return this.easeTo(s.e({center:A},b),L)}getZoom(){return this.transform.zoom}setZoom(A,b){return this.jumpTo({zoom:A},b),this}zoomTo(A,b,L){return this.easeTo(s.e({zoom:A},b),L)}zoomIn(A,b){return this.zoomTo(this.getZoom()+1,A,b),this}zoomOut(A,b){return this.zoomTo(this.getZoom()-1,A,b),this}getBearing(){return this.transform.bearing}setBearing(A,b){return this.jumpTo({bearing:A},b),this}getPadding(){return this.transform.padding}setPadding(A,b){return this.jumpTo({padding:A},b),this}rotateTo(A,b,L){return this.easeTo(s.e({bearing:A},b),L)}resetNorth(A,b){return this.rotateTo(0,s.e({duration:1e3},A),b),this}resetNorthPitch(A,b){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},A),b),this}snapToNorth(A,b){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(A,b):this}getPitch(){return this.transform.pitch}setPitch(A,b){return this.jumpTo({pitch:A},b),this}cameraForBounds(A,b){A=Xe.convert(A);const L=b&&b.bearing||0;return this._cameraForBoxAndBearing(A.getNorthWest(),A.getSouthEast(),L,b)}_cameraForBoxAndBearing(A,b,L,O){const z={top:0,bottom:0,right:0,left:0};if(typeof(O=s.e({padding:z,offset:[0,0],maxZoom:this.transform.maxZoom},O)).padding=="number"){const se=O.padding;O.padding={top:se,bottom:se,right:se,left:se}}O.padding=s.e(z,O.padding);const X=this.transform,w=X.padding,a=X.project(s.L.convert(A)),p=X.project(s.L.convert(b)),x=a.rotate(-L*Math.PI/180),B=p.rotate(-L*Math.PI/180),I=new s.P(Math.max(x.x,B.x),Math.max(x.y,B.y)),j=new s.P(Math.min(x.x,B.x),Math.min(x.y,B.y)),y=I.sub(j),E=(X.width-(w.left+w.right+O.padding.left+O.padding.right))/y.x,P=(X.height-(w.top+w.bottom+O.padding.top+O.padding.bottom))/y.y;if(P<0||E<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const V=Math.min(X.scaleZoom(X.scale*Math.min(E,P)),O.maxZoom),q=s.P.convert(O.offset),K=new s.P((O.padding.left-O.padding.right)/2,(O.padding.top-O.padding.bottom)/2).rotate(L*Math.PI/180),ee=q.add(K).mult(X.scale/X.zoomScale(V));return{center:X.unproject(a.add(p).div(2).sub(ee)),zoom:V,bearing:L}}fitBounds(A,b,L){return this._fitInternal(this.cameraForBounds(A,b),b,L)}fitScreenCoordinates(A,b,L,O,z){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(A)),this.transform.pointLocation(s.P.convert(b)),L,O),O,z)}_fitInternal(A,b,L){return A?(delete(b=s.e(A,b)).padding,b.linear?this.easeTo(b,L):this.flyTo(b,L)):this}jumpTo(A,b){this.stop();const L=this._getTransformForUpdate();let O=!1,z=!1,X=!1;return"zoom"in A&&L.zoom!==+A.zoom&&(O=!0,L.zoom=+A.zoom),A.center!==void 0&&(L.center=s.L.convert(A.center)),"bearing"in A&&L.bearing!==+A.bearing&&(z=!0,L.bearing=+A.bearing),"pitch"in A&&L.pitch!==+A.pitch&&(X=!0,L.pitch=+A.pitch),A.padding==null||L.isPaddingEqual(A.padding)||(L.padding=A.padding),this._applyUpdatedTransform(L),this.fire(new s.k("movestart",b)).fire(new s.k("move",b)),O&&this.fire(new s.k("zoomstart",b)).fire(new s.k("zoom",b)).fire(new s.k("zoomend",b)),z&&this.fire(new s.k("rotatestart",b)).fire(new s.k("rotate",b)).fire(new s.k("rotateend",b)),X&&this.fire(new s.k("pitchstart",b)).fire(new s.k("pitch",b)).fire(new s.k("pitchend",b)),this.fire(new s.k("moveend",b))}calculateCameraOptionsFromTo(A,b,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const z=s.U.fromLngLat(A,b),X=s.U.fromLngLat(L,O),w=X.x-z.x,a=X.y-z.y,p=X.z-z.z,x=Math.hypot(w,a,p);if(x===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(w,a),I=this.transform.scaleZoom(this.transform.cameraToCenterDistance/x/this.transform.tileSize),j=180*Math.atan2(w,-a)/Math.PI;let y=180*Math.acos(B/x)/Math.PI;return y=p<0?90-y:90+y,{center:X.toLngLat(),zoom:I,pitch:y,bearing:j}}easeTo(A,b){this._stop(!1,A.easeId),((A=s.e({offset:[0,0],duration:500,easing:s.bb},A)).animate===!1||!A.essential&&s.h.prefersReducedMotion)&&(A.duration=0);const L=this._getTransformForUpdate(),O=this.getZoom(),z=this.getBearing(),X=this.getPitch(),w=this.getPadding(),a="zoom"in A?+A.zoom:O,p="bearing"in A?this._normalizeBearing(A.bearing,z):z,x="pitch"in A?+A.pitch:X,B="padding"in A?A.padding:L.padding,I=s.P.convert(A.offset);let j=L.centerPoint.add(I);const y=L.pointLocation(j),E=s.L.convert(A.center||y);this._normalizeCenter(E);const P=L.project(y),V=L.project(E).sub(P),q=L.zoomScale(a-O);let K,ee;A.around&&(K=s.L.convert(A.around),ee=L.locationPoint(K));const se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||a!==O,this._rotating=this._rotating||z!==p,this._pitching=this._pitching||x!==X,this._padding=!L.isPaddingEqual(B),this._easeId=A.easeId,this._prepareEase(b,A.noMoveStart,se),this.terrain&&this._prepareElevation(E),this._ease(oe=>{if(this._zooming&&(L.zoom=s.B.number(O,a,oe)),this._rotating&&(L.bearing=s.B.number(z,p,oe)),this._pitching&&(L.pitch=s.B.number(X,x,oe)),this._padding&&(L.interpolatePadding(w,B,oe),j=L.centerPoint.add(I)),this.terrain&&!A.freezeElevation&&this._updateElevation(oe),K)L.setLocationAtPoint(K,ee);else{const le=L.zoomScale(L.zoom-O),_e=a>O?Math.min(2,q):Math.max(.5,q),Ie=Math.pow(_e,1-oe),ve=L.unproject(P.add(V.mult(oe*Ie)).mult(le));L.setLocationAtPoint(L.renderWorldCopies?ve.wrap():ve,j)}this._applyUpdatedTransform(L),this._fireMoveEvents(b)},oe=>{this.terrain&&this._finalizeElevation(),this._afterEase(b,oe)},A),this}_prepareEase(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,b||L.moving||this.fire(new s.k("movestart",A)),this._zooming&&!L.zooming&&this.fire(new s.k("zoomstart",A)),this._rotating&&!L.rotating&&this.fire(new s.k("rotatestart",A)),this._pitching&&!L.pitching&&this.fire(new s.k("pitchstart",A))}_prepareElevation(A){this._elevationCenter=A,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(A,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(A){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const b=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(A<1&&b!==this._elevationTarget){const L=this._elevationTarget-this._elevationStart;this._elevationStart+=A*(L-(b-(L*A+this._elevationStart))/(1-A)),this._elevationTarget=b}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,A)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(A){if(!this.transformCameraUpdate)return;const b=A.clone(),{center:L,zoom:O,pitch:z,bearing:X,elevation:w}=this.transformCameraUpdate(b);L&&(b.center=L),O!==void 0&&(b.zoom=O),z!==void 0&&(b.pitch=z),X!==void 0&&(b.bearing=X),w!==void 0&&(b.elevation=w),this.transform.apply(b)}_fireMoveEvents(A){this.fire(new s.k("move",A)),this._zooming&&this.fire(new s.k("zoom",A)),this._rotating&&this.fire(new s.k("rotate",A)),this._pitching&&this.fire(new s.k("pitch",A))}_afterEase(A,b){if(this._easeId&&b&&this._easeId===b)return;delete this._easeId;const L=this._zooming,O=this._rotating,z=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,L&&this.fire(new s.k("zoomend",A)),O&&this.fire(new s.k("rotateend",A)),z&&this.fire(new s.k("pitchend",A)),this.fire(new s.k("moveend",A))}flyTo(A,b){if(!A.essential&&s.h.prefersReducedMotion){const Ve=s.F(A,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ve,b)}this.stop(),A=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},A);const L=this._getTransformForUpdate(),O=this.getZoom(),z=this.getBearing(),X=this.getPitch(),w=this.getPadding(),a="zoom"in A?s.ad(+A.zoom,L.minZoom,L.maxZoom):O,p="bearing"in A?this._normalizeBearing(A.bearing,z):z,x="pitch"in A?+A.pitch:X,B="padding"in A?A.padding:L.padding,I=L.zoomScale(a-O),j=s.P.convert(A.offset);let y=L.centerPoint.add(j);const E=L.pointLocation(y),P=s.L.convert(A.center||E);this._normalizeCenter(P);const V=L.project(E),q=L.project(P).sub(V);let K=A.curve;const ee=Math.max(L.width,L.height),se=ee/I,oe=q.mag();if("minZoom"in A){const Ve=s.ad(Math.min(A.minZoom,O,a),L.minZoom,L.maxZoom),At=ee/L.zoomScale(Ve-O);K=Math.sqrt(At/oe*2)}const le=K*K;function _e(Ve){const At=(se*se-ee*ee+(Ve?-1:1)*le*le*oe*oe)/(2*(Ve?se:ee)*le*oe);return Math.log(Math.sqrt(At*At+1)-At)}function Ie(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function ve(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const Se=_e(!1);let et=function(Ve){return ve(Se)/ve(Se+K*Ve)},Oe=function(Ve){return ee*((ve(Se)*(Ie(At=Se+K*Ve)/ve(At))-Ie(Se))/le)/oe;var At},Re=(_e(!0)-Se)/K;if(Math.abs(oe)<1e-6||!isFinite(Re)){if(Math.abs(ee-se)<1e-6)return this.easeTo(A,b);const Ve=se<ee?-1:1;Re=Math.abs(Math.log(se/ee))/K,Oe=function(){return 0},et=function(At){return Math.exp(Ve*K*At)}}return A.duration="duration"in A?+A.duration:1e3*Re/("screenSpeed"in A?+A.screenSpeed/K:+A.speed),A.maxDuration&&A.duration>A.maxDuration&&(A.duration=0),this._zooming=!0,this._rotating=z!==p,this._pitching=x!==X,this._padding=!L.isPaddingEqual(B),this._prepareEase(b,!1),this.terrain&&this._prepareElevation(P),this._ease(Ve=>{const At=Ve*Re,dt=1/et(At);L.zoom=Ve===1?a:O+L.scaleZoom(dt),this._rotating&&(L.bearing=s.B.number(z,p,Ve)),this._pitching&&(L.pitch=s.B.number(X,x,Ve)),this._padding&&(L.interpolatePadding(w,B,Ve),y=L.centerPoint.add(j)),this.terrain&&!A.freezeElevation&&this._updateElevation(Ve);const ft=Ve===1?P:L.unproject(V.add(q.mult(Oe(At))).mult(dt));L.setLocationAtPoint(L.renderWorldCopies?ft.wrap():ft,y),this._applyUpdatedTransform(L),this._fireMoveEvents(b)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(b)},A),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(A,b){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const L=this._onEaseEnd;delete this._onEaseEnd,L.call(this,b)}if(!A){const L=this.handlers;L&&L.stop(!1)}return this}_ease(A,b,L){L.animate===!1||L.duration===0?(A(1),b()):(this._easeStart=s.h.now(),this._easeOptions=L,this._onEaseFrame=A,this._onEaseEnd=b,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(A,b){A=s.b5(A,-180,180);const L=Math.abs(A-b);return Math.abs(A-360-b)<L&&(A-=360),Math.abs(A+360-b)<L&&(A+=360),A}_normalizeCenter(A){const b=this.transform;if(!b.renderWorldCopies||b.lngRange)return;const L=A.lng-b.center.lng;A.lng+=L>180?-360:L<-180?360:0}queryTerrainElevation(A){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(A),this.transform.tileZoom)-this.transform.elevation:null}}class to{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=b=>{!b||b.sourceDataType!=="metadata"&&b.sourceDataType!=="visibility"&&b.dataType!=="style"&&b.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=A}getDefaultPosition(){return"bottom-right"}onAdd(A){return this._map=A,this._compact=this.options&&this.options.compact,this._container=v.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=v.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=v.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){v.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(A,b){const L=this._map._getUIString(`AttributionControl.${b}`);A.title=L,A.setAttribute("aria-label",L)}_updateAttributions(){if(!this._map.style)return;let A=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?A=A.concat(this.options.customAttribution.map(O=>typeof O!="string"?"":O)):typeof this.options.customAttribution=="string"&&A.push(this.options.customAttribution)),this._map.style.stylesheet){const O=this._map.style.stylesheet;this.styleOwner=O.owner,this.styleId=O.id}const b=this._map.style.sourceCaches;for(const O in b){const z=b[O];if(z.used||z.usedForTerrain){const X=z.getSource();X.attribution&&A.indexOf(X.attribution)<0&&A.push(X.attribution)}}A=A.filter(O=>String(O).trim()),A.sort((O,z)=>O.length-z.length),A=A.filter((O,z)=>{for(let X=z+1;X<A.length;X++)if(A[X].indexOf(O)>=0)return!1;return!0});const L=A.join(" | ");L!==this._attribHTML&&(this._attribHTML=L,A.length?(this._innerContainer.innerHTML=L,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ei{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const b=this._container.children;if(b.length){const L=b[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&L.classList.add("maplibregl-compact"):L.classList.remove("maplibregl-compact")}},this.options=A}getDefaultPosition(){return"bottom-left"}onAdd(A){this._map=A,this._compact=this.options&&this.options.compact,this._container=v.create("div","maplibregl-ctrl");const b=v.create("a","maplibregl-ctrl-logo");return b.target="_blank",b.rel="noopener nofollow",b.href="https://maplibre.org/",b.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),b.setAttribute("rel","noopener nofollow"),this._container.appendChild(b),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){v.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class sr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(A){const b=++this._id;return this._queue.push({callback:A,id:b,cancelled:!1}),b}remove(A){const b=this._currentlyRunning,L=b?this._queue.concat(b):this._queue;for(const O of L)if(O.id===A)return void(O.cancelled=!0)}run(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const b=this._currentlyRunning=this._queue;this._queue=[];for(const L of b)if(!L.cancelled&&(L.callback(A),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ml={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Gc=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Jl extends s.E{constructor(A){super(),this.sourceCache=A,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,A.usedForTerrain=!0,A.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(A,b){this.sourceCache.update(A,b),this._renderableTilesKeys=[];const L={};for(const O of A.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:b}))L[O.key]=!0,this._renderableTilesKeys.push(O.key),this._tiles[O.key]||(O.posMatrix=new Float64Array(16),s.aS(O.posMatrix,0,s.N,0,s.N,0,1),this._tiles[O.key]=new Oi(O,this.tileSize));for(const O in this._tiles)L[O]||delete this._tiles[O]}freeRtt(A){for(const b in this._tiles){const L=this._tiles[b];(!A||L.tileID.equals(A)||L.tileID.isChildOf(A)||A.isChildOf(L.tileID))&&(L.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(A=>this.getTileByID(A))}getTileByID(A){return this._tiles[A]}getTerrainCoords(A){const b={};for(const L of this._renderableTilesKeys){const O=this._tiles[L].tileID;if(O.canonical.equals(A.canonical)){const z=A.clone();z.posMatrix=new Float64Array(16),s.aS(z.posMatrix,0,s.N,0,s.N,0,1),b[L]=z}else if(O.canonical.isChildOf(A.canonical)){const z=A.clone();z.posMatrix=new Float64Array(16);const X=O.canonical.z-A.canonical.z,w=O.canonical.x-(O.canonical.x>>X<<X),a=O.canonical.y-(O.canonical.y>>X<<X),p=s.N>>X;s.aS(z.posMatrix,0,p,0,p,0,1),s.$(z.posMatrix,z.posMatrix,[-w*p,-a*p,0]),b[L]=z}else if(A.canonical.isChildOf(O.canonical)){const z=A.clone();z.posMatrix=new Float64Array(16);const X=A.canonical.z-O.canonical.z,w=A.canonical.x-(A.canonical.x>>X<<X),a=A.canonical.y-(A.canonical.y>>X<<X),p=s.N>>X;s.aS(z.posMatrix,0,s.N,0,s.N,0,1),s.$(z.posMatrix,z.posMatrix,[w*p,a*p,0]),s.a0(z.posMatrix,z.posMatrix,[1/2**X,1/2**X,0]),b[L]=z}}return b}getSourceTile(A,b){const L=this.sourceCache._source;let O=A.overscaledZ-this.deltaZoom;if(O>L.maxzoom&&(O=L.maxzoom),O<L.minzoom)return null;this._sourceTileCache[A.key]||(this._sourceTileCache[A.key]=A.scaledTo(O).key);let z=this.sourceCache.getTileByID(this._sourceTileCache[A.key]);if((!z||!z.dem)&&b)for(;O>=L.minzoom&&(!z||!z.dem);)z=this.sourceCache.getTileByID(A.scaledTo(O--).key);return z}tilesAfterTime(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(b=>b.timeAdded>=A)}}class ks{constructor(A,b,L){this.painter=A,this.sourceCache=new Jl(b),this.options=L,this.exaggeration=typeof L.exaggeration=="number"?L.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(A,b,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;var z;if(!(b>=0&&b<O&&L>=0&&L<O))return 0;const X=this.getTerrainData(A),w=(z=X.tile)===null||z===void 0?void 0:z.dem;if(!w)return 0;const a=function(y,E,P){var V=E[0],q=E[1];return y[0]=P[0]*V+P[4]*q+P[12],y[1]=P[1]*V+P[5]*q+P[13],y}([],[b/O*s.N,L/O*s.N],X.u_terrain_matrix),p=[a[0]*w.dim,a[1]*w.dim],x=Math.floor(p[0]),B=Math.floor(p[1]),I=p[0]-x,j=p[1]-B;return w.get(x,B)*(1-I)*(1-j)+w.get(x+1,B)*I*(1-j)+w.get(x,B+1)*(1-I)*j+w.get(x+1,B+1)*I*j}getElevationForLngLatZoom(A,b){const{tileID:L,mercatorX:O,mercatorY:z}=this._getOverscaledTileIDFromLngLatZoom(A,b);return this.getElevation(L,O%s.N,z%s.N,s.N)}getElevation(A,b,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;return this.getDEMElevation(A,b,L,O)*this.exaggeration}getTerrainData(A){if(!this._emptyDemTexture){const O=this.painter.context,z=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new nt(O,z,O.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new nt(O,new s.R({width:1,height:1}),O.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(O.gl.NEAREST,O.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const b=this.sourceCache.getSourceTile(A,!0);if(b&&b.dem&&(!b.demTexture||b.needsTerrainPrepare)){const O=this.painter.context;b.demTexture=this.painter.getTileTexture(b.dem.stride),b.demTexture?b.demTexture.update(b.dem.getPixels(),{premultiply:!1}):b.demTexture=new nt(O,b.dem.getPixels(),O.gl.RGBA,{premultiply:!1}),b.demTexture.bind(O.gl.NEAREST,O.gl.CLAMP_TO_EDGE),b.needsTerrainPrepare=!1}const L=b&&b+b.tileID.key+A.key;if(L&&!this._demMatrixCache[L]){const O=this.sourceCache.sourceCache._source.maxzoom;let z=A.canonical.z-b.tileID.canonical.z;A.overscaledZ>A.canonical.z&&(A.canonical.z>=O?z=A.canonical.z-O:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const X=A.canonical.x-(A.canonical.x>>z<<z),w=A.canonical.y-(A.canonical.y>>z<<z),a=s.bc(new Float64Array(16),[1/(s.N<<z),1/(s.N<<z),0]);s.$(a,a,[X*s.N,w*s.N,0]),this._demMatrixCache[A.key]={matrix:a,coord:A}}return{u_depth:2,u_terrain:3,u_terrain_dim:b&&b.dem&&b.dem.dim||1,u_terrain_matrix:L?this._demMatrixCache[A.key].matrix:this._emptyDemMatrix,u_terrain_unpack:b&&b.dem&&b.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(b&&b.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:b}}getFramebuffer(A){const b=this.painter,L=b.width/devicePixelRatio,O=b.height/devicePixelRatio;return!this._fbo||this._fbo.width===L&&this._fbo.height===O||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new nt(b.context,{width:L,height:O,data:null},b.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(b.context.gl.NEAREST,b.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new nt(b.context,{width:L,height:O,data:null},b.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(b.context.gl.NEAREST,b.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=b.context.createFramebuffer(L,O,!0,!1),this._fbo.depthAttachment.set(b.context.createRenderbuffer(b.context.gl.DEPTH_COMPONENT16,L,O))),this._fbo.colorAttachment.set(A==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const A=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const b=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let z=0,X=0;z<this._coordsTextureSize;z++)for(let w=0;w<this._coordsTextureSize;w++,X+=4)b[X+0]=255&w,b[X+1]=255&z,b[X+2]=w>>8<<4|z>>8,b[X+3]=0;const L=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(b.buffer)),O=new nt(A,L,A.gl.RGBA,{premultiply:!1});return O.bind(A.gl.NEAREST,A.gl.CLAMP_TO_EDGE),this._coordsTexture=O,O}pointCoordinate(A){const b=new Uint8Array(4),L=this.painter.context,O=L.gl;L.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),O.readPixels(A.x,this.painter.height/devicePixelRatio-A.y-1,1,1,O.RGBA,O.UNSIGNED_BYTE,b),L.bindFramebuffer.set(null);const z=b[0]+(b[2]>>4<<8),X=b[1]+((15&b[2])<<8),w=this.coordsIndex[255-b[3]],a=w&&this.sourceCache.getTileByID(w);if(!a)return null;const p=this._coordsTextureSize,x=(1<<a.tileID.canonical.z)*p;return new s.U(this._allowMercatorOverflow(A,(a.tileID.canonical.x*p+z)/x),(a.tileID.canonical.y*p+X)/x,this.getElevation(a.tileID,z,X,p))}getTerrainMesh(){if(this._mesh)return this._mesh;const A=this.painter.context,b=new s.bd,L=new s.b0,O=this.meshSize,z=s.N/O,X=O*O;for(let B=0;B<=O;B++)for(let I=0;I<=O;I++)b.emplaceBack(I*z,B*z,0);for(let B=0;B<X;B+=O+1)for(let I=0;I<O;I++)L.emplaceBack(I+B,O+I+B+1,O+I+B+2),L.emplaceBack(I+B,O+I+B+2,I+B+1);const w=b.length,a=w+2*(O+1);for(const B of[0,1])for(let I=0;I<=O;I++)for(const j of[0,1])b.emplaceBack(I*z,B*s.N,j);for(let B=0;B<2*O;B+=2)L.emplaceBack(a+B,a+B+1,a+B+3),L.emplaceBack(a+B,a+B+3,a+B+2),L.emplaceBack(w+B,w+B+3,w+B+1),L.emplaceBack(w+B,w+B+2,w+B+3);const p=b.length,x=p+2*(O+1);for(const B of[0,1])for(let I=0;I<=O;I++)for(const j of[0,1])b.emplaceBack(B*s.N,I*z,j);for(let B=0;B<2*O;B+=2)L.emplaceBack(p+B,p+B+1,p+B+3),L.emplaceBack(p+B,p+B+3,p+B+2),L.emplaceBack(x+B,x+B+3,x+B+1),L.emplaceBack(x+B,x+B+2,x+B+3);return this._mesh={indexBuffer:A.createIndexBuffer(L),vertexBuffer:A.createVertexBuffer(b,Gc.members),segments:s.S.simpleSegment(0,0,b.length,L.length)},this._mesh}getMeshFrameDelta(A){return 2*Math.PI*s.be/Math.pow(2,A)/5}getMinTileElevationForLngLatZoom(A,b){var L;const{tileID:O}=this._getOverscaledTileIDFromLngLatZoom(A,b);return(L=this.getMinMaxElevation(O).minElevation)!==null&&L!==void 0?L:0}getMinMaxElevation(A){const b=this.getTerrainData(A).tile,L={minElevation:null,maxElevation:null};return b&&b.dem&&(L.minElevation=b.dem.min*this.exaggeration,L.maxElevation=b.dem.max*this.exaggeration),L}_getOverscaledTileIDFromLngLatZoom(A,b){const L=s.U.fromLngLat(A.wrap()),O=(1<<b)*s.N,z=L.x*O,X=L.y*O,w=Math.floor(z/s.N),a=Math.floor(X/s.N);return{tileID:new s.O(b,0,b,w,a),mercatorX:z,mercatorY:X}}_allowMercatorOverflow(A,b){const L=A.x<this.painter.width/2;let O=s.bf(b);const z=this.painter.transform.center.lng;return L&&Math.sign(O)>0&&Math.sign(z)<0||!L&&Math.sign(O)<0&&Math.sign(z)>0?(O=360*Math.sign(z)+O,s.G(O)):b}}class nA{constructor(A,b,L){this._context=A,this._size=b,this._tileSize=L,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const A of this._objects)A.texture.destroy(),A.fbo.destroy()}_createObject(A){const b=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),L=new nt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return L.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),b.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),b.colorAttachment.set(L.texture),{id:A,fbo:b,texture:L,stamp:-1,inUse:!1}}getObjectForId(A){return this._objects[A]}useObject(A){A.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(b=>A.id!==b),this._recentlyUsed.push(A.id)}stampObject(A){A.stamp=++this._stamp}getOrCreateFreeObject(){for(const b of this._recentlyUsed)if(!this._objects[b].inUse)return this._objects[b];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const A=this._createObject(this._objects.length);return this._objects.push(A),A}freeObject(A){A.inUse=!1}freeAllObjects(){for(const A of this._objects)this.freeObject(A)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(A=>!A.inUse)===!1}}const $n={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class jc{constructor(A,b){this.painter=A,this.terrain=b,this.pool=new nA(A.context,30,b.sourceCache.tileSize*b.qualityFactor)}destruct(){this.pool.destruct()}getTexture(A){return this.pool.getObjectForId(A.rtt[this._stacks.length-1].id).texture}prepareForRender(A,b){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=A._order.filter(L=>!A._layers[L].isHidden(b)),this._coordsDescendingInv={};for(const L in A.sourceCaches){this._coordsDescendingInv[L]={};const O=A.sourceCaches[L].getVisibleCoordinates();for(const z of O){const X=this.terrain.sourceCache.getTerrainCoords(z);for(const w in X)this._coordsDescendingInv[L][w]||(this._coordsDescendingInv[L][w]=[]),this._coordsDescendingInv[L][w].push(X[w])}}this._coordsDescendingInvStr={};for(const L of A._order){const O=A._layers[L],z=O.source;if($n[O.type]&&!this._coordsDescendingInvStr[z]){this._coordsDescendingInvStr[z]={};for(const X in this._coordsDescendingInv[z])this._coordsDescendingInvStr[z][X]=this._coordsDescendingInv[z][X].map(w=>w.key).sort().join()}}for(const L of this._renderableTiles)for(const O in this._coordsDescendingInvStr){const z=this._coordsDescendingInvStr[O][L.tileID.key];z&&z!==L.rttCoords[O]&&(L.rtt=[])}}renderLayer(A){if(A.isHidden(this.painter.transform.zoom))return!1;const b=A.type,L=this.painter,O=this._renderableLayerIds[this._renderableLayerIds.length-1]===A.id;if($n[b]&&(this._prevType&&$n[this._prevType]||this._stacks.push([]),this._prevType=b,this._stacks[this._stacks.length-1].push(A.id),!O))return!0;if($n[this._prevType]||$n[b]&&O){this._prevType=b;const z=this._stacks.length-1,X=this._stacks[z]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(Ln(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[z]){const p=this.pool.getObjectForId(w.rtt[z].id);if(p.stamp===w.rtt[z].stamp){this.pool.useObject(p);continue}}const a=this.pool.getOrCreateFreeObject();this.pool.useObject(a),this.pool.stampObject(a),w.rtt[z]={id:a.id,stamp:a.stamp},L.context.bindFramebuffer.set(a.fbo.framebuffer),L.context.clear({color:s.aT.transparent,stencil:0}),L.currentStencilSource=void 0;for(let p=0;p<X.length;p++){const x=L.style._layers[X[p]],B=x.source?this._coordsDescendingInv[x.source][w.tileID.key]:[w.tileID];L.context.viewport.set([0,0,a.fbo.width,a.fbo.height]),L._renderTileClippingMasks(x,B),L.renderLayer(L,L.style.sourceCaches[x.source],x,B),x.source&&(w.rttCoords[x.source]=this._coordsDescendingInvStr[x.source][w.tileID.key])}}return Ln(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),$n[b]}return!1}}const $i=g,zi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Kn=N=>{N.touchstart=N.dragStart,N.touchmoveWindow=N.dragMove,N.touchend=N.dragEnd},zu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Do{constructor(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=X=>{this.startMouse(s.e({},X,{ctrlKey:!0,preventDefault:()=>X.preventDefault()}),v.mousePos(this.element,X)),v.addEventListener(window,"mousemove",this.mousemove),v.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=X=>{this.moveMouse(X,v.mousePos(this.element,X))},this.mouseup=X=>{this.mouseRotate.dragEnd(X),this.mousePitch&&this.mousePitch.dragEnd(X),this.offTemp()},this.touchstart=X=>{X.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=v.touchPos(this.element,X.targetTouches)[0],this.startTouch(X,this._startPos),v.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.addEventListener(window,"touchend",this.touchend))},this.touchmove=X=>{X.targetTouches.length!==1?this.reset():(this._lastPos=v.touchPos(this.element,X.targetTouches)[0],this.moveTouch(X,this._lastPos))},this.touchend=X=>{X.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const O=A.dragRotate._mouseRotate.getClickTolerance(),z=A.dragRotate._mousePitch.getClickTolerance();this.element=b,this.mouseRotate=Jo({clickTolerance:O,enable:!0}),this.touchRotate=(X=>{let{enable:w,clickTolerance:a,bearingDegreesPerPixelMoved:p=.8}=X;const x=new ma;return new en({clickTolerance:a,move:(B,I)=>({bearingDelta:(I.x-B.x)*p}),moveStateManager:x,enable:w,assignEvents:Kn})})({clickTolerance:O,enable:!0}),this.map=A,L&&(this.mousePitch=Yo({clickTolerance:z,enable:!0}),this.touchPitch=(X=>{let{enable:w,clickTolerance:a,pitchDegreesPerPixelMoved:p=-.5}=X;const x=new ma;return new en({clickTolerance:a,move:(B,I)=>({pitchDelta:(I.y-B.y)*p}),moveStateManager:x,enable:w,assignEvents:Kn})})({clickTolerance:z,enable:!0})),v.addEventListener(b,"mousedown",this.mousedown),v.addEventListener(b,"touchstart",this.touchstart,{passive:!1}),v.addEventListener(b,"touchcancel",this.reset)}startMouse(A,b){this.mouseRotate.dragStart(A,b),this.mousePitch&&this.mousePitch.dragStart(A,b),v.disableDrag()}startTouch(A,b){this.touchRotate.dragStart(A,b),this.touchPitch&&this.touchPitch.dragStart(A,b),v.disableDrag()}moveMouse(A,b){const L=this.map,{bearingDelta:O}=this.mouseRotate.dragMove(A,b)||{};if(O&&L.setBearing(L.getBearing()+O),this.mousePitch){const{pitchDelta:z}=this.mousePitch.dragMove(A,b)||{};z&&L.setPitch(L.getPitch()+z)}}moveTouch(A,b){const L=this.map,{bearingDelta:O}=this.touchRotate.dragMove(A,b)||{};if(O&&L.setBearing(L.getBearing()+O),this.touchPitch){const{pitchDelta:z}=this.touchPitch.dragMove(A,b)||{};z&&L.setPitch(L.getPitch()+z)}}off(){const A=this.element;v.removeEventListener(A,"mousedown",this.mousedown),v.removeEventListener(A,"touchstart",this.touchstart,{passive:!1}),v.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.removeEventListener(window,"touchend",this.touchend),v.removeEventListener(A,"touchcancel",this.reset),this.offTemp()}offTemp(){v.enableDrag(),v.removeEventListener(window,"mousemove",this.mousemove),v.removeEventListener(window,"mouseup",this.mouseup),v.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.removeEventListener(window,"touchend",this.touchend)}}let sn;function qs(N,A,b){if(N=new s.L(N.lng,N.lat),A){const L=new s.L(N.lng-360,N.lat),O=new s.L(N.lng+360,N.lat),z=b.locationPoint(N).distSqr(A);b.locationPoint(L).distSqr(A)<z?N=L:b.locationPoint(O).distSqr(A)<z&&(N=O)}for(;Math.abs(N.lng-b.center.lng)>180;){const L=b.locationPoint(N);if(L.x>=0&&L.y>=0&&L.x<=b.width&&L.y<=b.height)break;N.lng>b.center.lng?N.lng-=360:N.lng+=360}return N}const Ro={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pu(N,A,b){const L=N.classList;for(const O in Ro)L.remove(`maplibregl-${b}-anchor-${O}`);L.add(`maplibregl-${b}-anchor-${A}`)}class $s extends s.E{constructor(A){if(super(),this._onKeyPress=b=>{const L=b.code,O=b.charCode||b.keyCode;L!=="Space"&&L!=="Enter"&&O!==32&&O!==13||this.togglePopup()},this._onMapClick=b=>{const L=b.originalEvent.target,O=this._element;this._popup&&(L===O||O.contains(L))&&this.togglePopup()},this._update=b=>{if(!this._map)return;const L=this._map.loaded()&&!this._map.isMoving();((b==null?void 0:b.type)==="terrain"||(b==null?void 0:b.type)==="render"&&!L)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=qs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let O="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?O=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(O=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let z="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?z="rotateX(0deg)":this._pitchAlignment==="map"&&(z=`rotateX(${this._map.getPitch()}deg)`),b&&b.type!=="moveend"||(this._pos=this._pos.round()),v.setTransform(this._element,`${Ro[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${z} ${O}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const X=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=X.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=b=>{if(!this._isDragging){const L=this._clickTolerance||this._map._clickTolerance;this._isDragging=b.point.dist(this._pointerdownPos)>=L}this._isDragging&&(this._pos=b.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=b=>{this._element.contains(b.originalEvent.target)&&(b.preventDefault(),this._positionDelta=b.point.sub(this._pos).add(this._offset),this._pointerdownPos=b.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=A&&A.anchor||"center",this._color=A&&A.color||"#3FB1CE",this._scale=A&&A.scale||1,this._draggable=A&&A.draggable||!1,this._clickTolerance=A&&A.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=A&&A.rotation||0,this._rotationAlignment=A&&A.rotationAlignment||"auto",this._pitchAlignment=A&&A.pitchAlignment&&A.pitchAlignment!=="auto"?A.pitchAlignment:this._rotationAlignment,A&&A.element)this._element=A.element,this._offset=s.P.convert(A&&A.offset||[0,0]);else{this._defaultMarker=!0,this._element=v.create("div"),this._element.setAttribute("aria-label","Map marker");const b=v.createNS("http://www.w3.org/2000/svg","svg"),L=41,O=27;b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height",`${L}px`),b.setAttributeNS(null,"width",`${O}px`),b.setAttributeNS(null,"viewBox",`0 0 ${O} ${L}`);const z=v.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"stroke","none"),z.setAttributeNS(null,"stroke-width","1"),z.setAttributeNS(null,"fill","none"),z.setAttributeNS(null,"fill-rule","evenodd");const X=v.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"fill-rule","nonzero");const w=v.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const a=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const V of a){const q=v.createNS("http://www.w3.org/2000/svg","ellipse");q.setAttributeNS(null,"opacity","0.04"),q.setAttributeNS(null,"cx","10.5"),q.setAttributeNS(null,"cy","5.80029008"),q.setAttributeNS(null,"rx",V.rx),q.setAttributeNS(null,"ry",V.ry),w.appendChild(q)}const p=v.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"fill",this._color);const x=v.createNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),p.appendChild(x);const B=v.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const I=v.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(I);const j=v.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const y=v.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");const E=v.createNS("http://www.w3.org/2000/svg","circle");E.setAttributeNS(null,"fill","#000000"),E.setAttributeNS(null,"opacity","0.25"),E.setAttributeNS(null,"cx","5.5"),E.setAttributeNS(null,"cy","5.5"),E.setAttributeNS(null,"r","5.4999962");const P=v.createNS("http://www.w3.org/2000/svg","circle");P.setAttributeNS(null,"fill","#FFFFFF"),P.setAttributeNS(null,"cx","5.5"),P.setAttributeNS(null,"cy","5.5"),P.setAttributeNS(null,"r","5.4999962"),y.appendChild(E),y.appendChild(P),X.appendChild(w),X.appendChild(p),X.appendChild(B),X.appendChild(j),X.appendChild(y),b.appendChild(X),b.setAttributeNS(null,"height",L*this._scale+"px"),b.setAttributeNS(null,"width",O*this._scale+"px"),this._element.appendChild(b),this._offset=s.P.convert(A&&A.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()}),pu(this._element,this._anchor,"marker"),A&&A.className)for(const b of A.className.split(" "))this._element.classList.add(b);this._popup=null}addTo(A){return this.remove(),this._map=A,A.getCanvasContainer().appendChild(this._element),A.on("move",this._update),A.on("moveend",this._update),A.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),v.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(A){return this._lngLat=s.L.convert(A),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(A){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),A){if(!("offset"in A.options)){const O=Math.abs(13.5)/Math.SQRT2;A.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[O,-1*(38.1-13.5+O)],"bottom-right":[-O,-1*(38.1-13.5+O)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=A,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const A=this._popup;return A?(A.isOpen()?A.remove():A.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(A){return this._offset=s.P.convert(A),this._update(),this}addClassName(A){this._element.classList.add(A)}removeClassName(A){this._element.classList.remove(A)}toggleClassName(A){return this._element.classList.toggle(A)}setDraggable(A){return this._draggable=!!A,this._map&&(A?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(A){return this._rotation=A||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(A){return this._rotationAlignment=A||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(A){return this._pitchAlignment=A&&A!=="auto"?A:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Jr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Fn=0,Yl=!1;const ec={maxWidth:100,unit:"metric"};function ko(N,A,b){const L=b&&b.maxWidth||100,O=N._container.clientHeight/2,z=N.unproject([0,O]),X=N.unproject([L,O]),w=z.distanceTo(X);if(b&&b.unit==="imperial"){const a=3.2808*w;a>5280?Da(A,L,a/5280,N._getUIString("ScaleControl.Miles")):Da(A,L,a,N._getUIString("ScaleControl.Feet"))}else b&&b.unit==="nautical"?Da(A,L,w/1852,N._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Da(A,L,w/1e3,N._getUIString("ScaleControl.Kilometers")):Da(A,L,w,N._getUIString("ScaleControl.Meters"))}function Da(N,A,b,L){const O=function(z){const X=Math.pow(10,`${Math.floor(z)}`.length-1);let w=z/X;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(a){const p=Math.pow(10,Math.ceil(-Math.log(a)/Math.LN10));return Math.round(a*p)/p}(w),X*w}(b);N.style.width=A*(O/b)+"px",N.innerHTML=`${O}&nbsp;${L}`}const tc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Oo(N){if(N){if(typeof N=="number"){const A=Math.round(Math.abs(N)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,N),"top-left":new s.P(A,A),"top-right":new s.P(-A,A),bottom:new s.P(0,-N),"bottom-left":new s.P(A,-A),"bottom-right":new s.P(-A,-A),left:new s.P(N,0),right:new s.P(-N,0)}}if(N instanceof s.P||Array.isArray(N)){const A=s.P.convert(N);return{center:A,top:A,"top-left":A,"top-right":A,bottom:A,"bottom-left":A,"bottom-right":A,left:A,right:A}}return{center:s.P.convert(N.center||[0,0]),top:s.P.convert(N.top||[0,0]),"top-left":s.P.convert(N["top-left"]||[0,0]),"top-right":s.P.convert(N["top-right"]||[0,0]),bottom:s.P.convert(N.bottom||[0,0]),"bottom-left":s.P.convert(N["bottom-left"]||[0,0]),"bottom-right":s.P.convert(N["bottom-right"]||[0,0]),left:s.P.convert(N.left||[0,0]),right:s.P.convert(N.right||[0,0])}}return Oo(new s.P(0,0))}const ic={extend:function(N){for(var A=arguments.length,b=new Array(A>1?A-1:0),L=1;L<A;L++)b[L-1]=arguments[L];return s.e(N,...b)},run(N){N()},logToElement(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"log";const L=window.document.getElementById(b);L&&(A&&(L.innerHTML=""),L.innerHTML+=`<br>${N}`)}},va=g;class zr{static get version(){return va}static get workerCount(){return Ki.workerCount}static set workerCount(A){Ki.workerCount=A}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(A){s.c.MAX_PARALLEL_IMAGE_REQUESTS=A}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(A){s.c.WORKER_URL=A}static addProtocol(A,b){s.c.REGISTERED_PROTOCOLS[A]=b}static removeProtocol(A){delete s.c.REGISTERED_PROTOCOLS[A]}}return zr.Map=class extends _a{constructor(N){if(s.bg.mark(s.bh.create),(N=s.e({},zi,N)).minZoom!=null&&N.maxZoom!=null&&N.minZoom>N.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(N.minPitch!=null&&N.maxPitch!=null&&N.minPitch>N.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(N.minPitch!=null&&N.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(N.maxPitch!=null&&N.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Kl(N.minZoom,N.maxZoom,N.minPitch,N.maxPitch,N.renderWorldCopies),{bearingSnap:N.bearingSnap}),this._cooperativeGesturesOnWheel=A=>{this._onCooperativeGesture(A,A[this._metaKey],1)},this._contextLost=A=>{A.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:A}))},this._contextRestored=A=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:A}))},this._onMapScroll=A=>{if(A.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=N.interactive,this._cooperativeGestures=N.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=N.maxTileCacheSize,this._maxTileCacheZoomLevels=N.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=N.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=N.preserveDrawingBuffer,this._antialias=N.antialias,this._trackResize=N.trackResize,this._bearingSnap=N.bearingSnap,this._refreshExpiredTiles=N.refreshExpiredTiles,this._fadeDuration=N.fadeDuration,this._crossSourceCollisions=N.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=N.collectResourceTiming,this._renderTaskQueue=new sr,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},ml,N.locale),this._clickTolerance=N.clickTolerance,this._overridePixelRatio=N.pixelRatio,this._maxCanvasSize=N.maxCanvasSize,this.transformCameraUpdate=N.transformCameraUpdate,this._imageQueueHandle=Ae.addThrottleControl(()=>this.isMoving()),this._requestManager=new pe(N.transformRequest),typeof N.container=="string"){if(this._container=document.getElementById(N.container),!this._container)throw new Error(`Container '${N.container}' not found.`)}else{if(!(N.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=N.container}if(N.maxBounds&&this.setMaxBounds(N.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let A=!1;const b=co(L=>{this._trackResize&&!this._removed&&this.resize(L)._update()},50);this._resizeObserver=new ResizeObserver(L=>{A?b(L):A=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Nu(this,N),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=N.hash&&new ys(typeof N.hash=="string"&&N.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:N.center,zoom:N.zoom,bearing:N.bearing,pitch:N.pitch}),N.bounds&&(this.resize(),this.fitBounds(N.bounds,s.e({},N.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=N.localIdeographFontFamily,this._validateStyle=N.validateStyle,N.style&&this.setStyle(N.style,{localIdeographFontFamily:N.localIdeographFontFamily}),N.attributionControl&&this.addControl(new to({customAttribution:N.customAttribution})),N.maplibreLogo&&this.addControl(new Ei,N.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",A=>{this._update(A.dataType==="style"),this.fire(new s.k(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new s.k(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new s.k("sourcedataabort",A))})}_getMapId(){return this._mapId}addControl(N,A){if(A===void 0&&(A=N.getDefaultPosition?N.getDefaultPosition():"top-right"),!N||!N.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const b=N.onAdd(this);this._controls.push(N);const L=this._controlPositions[A];return A.indexOf("bottom")!==-1?L.insertBefore(b,L.firstChild):L.appendChild(b),this}removeControl(N){if(!N||!N.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const A=this._controls.indexOf(N);return A>-1&&this._controls.splice(A,1),N.onRemove(this),this}hasControl(N){return this._controls.indexOf(N)>-1}calculateCameraOptionsFromTo(N,A,b,L){return L==null&&this.terrain&&(L=this.terrain.getElevationForLngLatZoom(b,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(N,A,b,L)}resize(N){var A;const b=this._containerDimensions(),L=b[0],O=b[1],z=this._getClampedPixelRatio(L,O);if(this._resizeCanvas(L,O,z),this.painter.resize(L,O,z),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const a=this._getClampedPixelRatio(L,O);this._resizeCanvas(L,O,a),this.painter.resize(L,O,a)}this.transform.resize(L,O),(A=this._requestedCameraState)===null||A===void 0||A.resize(L,O);const X=!this._moving;return X&&(this.stop(),this.fire(new s.k("movestart",N)).fire(new s.k("move",N))),this.fire(new s.k("resize",N)),X&&this.fire(new s.k("moveend",N)),this}_getClampedPixelRatio(N,A){const{0:b,1:L}=this._maxCanvasSize,O=this.getPixelRatio(),z=N*O,X=A*O;return Math.min(z>b?b/z:1,X>L?L/X:1)*O}getPixelRatio(){var N;return(N=this._overridePixelRatio)!==null&&N!==void 0?N:devicePixelRatio}setPixelRatio(N){this._overridePixelRatio=N,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(N){return this.transform.setMaxBounds(Xe.convert(N)),this._update()}setMinZoom(N){if((N=N??-2)>=-2&&N<=this.transform.maxZoom)return this.transform.minZoom=N,this._update(),this.getZoom()<N&&this.setZoom(N),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(N){if((N=N??22)>=this.transform.minZoom)return this.transform.maxZoom=N,this._update(),this.getZoom()>N&&this.setZoom(N),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(N){if((N=N??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(N>=0&&N<=this.transform.maxPitch)return this.transform.minPitch=N,this._update(),this.getPitch()<N&&this.setPitch(N),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(N){if((N=N??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(N>=this.transform.minPitch)return this.transform.maxPitch=N,this._update(),this.getPitch()>N&&this.setPitch(N),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(N){return this.transform.renderWorldCopies=N,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(N){return this._cooperativeGestures=N,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(N){return this.transform.locationPoint(s.L.convert(N),this.style&&this.terrain)}unproject(N){return this.transform.pointLocation(s.P.convert(N),this.terrain)}isMoving(){var N;return this._moving||((N=this.handlers)===null||N===void 0?void 0:N.isMoving())}isZooming(){var N;return this._zooming||((N=this.handlers)===null||N===void 0?void 0:N.isZooming())}isRotating(){var N;return this._rotating||((N=this.handlers)===null||N===void 0?void 0:N.isRotating())}_createDelegatedListener(N,A,b){if(N==="mouseenter"||N==="mouseover"){let L=!1;return{layer:A,listener:b,delegates:{mousemove:z=>{const X=this.getLayer(A)?this.queryRenderedFeatures(z.point,{layers:[A]}):[];X.length?L||(L=!0,b.call(this,new _s(N,this,z.originalEvent,{features:X}))):L=!1},mouseout:()=>{L=!1}}}}if(N==="mouseleave"||N==="mouseout"){let L=!1;return{layer:A,listener:b,delegates:{mousemove:X=>{(this.getLayer(A)?this.queryRenderedFeatures(X.point,{layers:[A]}):[]).length?L=!0:L&&(L=!1,b.call(this,new _s(N,this,X.originalEvent)))},mouseout:X=>{L&&(L=!1,b.call(this,new _s(N,this,X.originalEvent)))}}}}{const L=O=>{const z=this.getLayer(A)?this.queryRenderedFeatures(O.point,{layers:[A]}):[];z.length&&(O.features=z,b.call(this,O),delete O.features)};return{layer:A,listener:b,delegates:{[N]:L}}}}on(N,A,b){if(b===void 0)return super.on(N,A);const L=this._createDelegatedListener(N,A,b);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[N]=this._delegatedListeners[N]||[],this._delegatedListeners[N].push(L);for(const O in L.delegates)this.on(O,L.delegates[O]);return this}once(N,A,b){if(b===void 0)return super.once(N,A);const L=this._createDelegatedListener(N,A,b);for(const O in L.delegates)this.once(O,L.delegates[O]);return this}off(N,A,b){return b===void 0?super.off(N,A):(this._delegatedListeners&&this._delegatedListeners[N]&&(L=>{const O=this._delegatedListeners[N];for(let z=0;z<O.length;z++){const X=O[z];if(X.layer===A&&X.listener===b){for(const w in X.delegates)this.off(w,X.delegates[w]);return O.splice(z,1),this}}})(),this)}queryRenderedFeatures(N,A){if(!this.style)return[];let b;const L=N instanceof s.P||Array.isArray(N),O=L?N:[[0,0],[this.transform.width,this.transform.height]];if(A=A||(L?{}:N)||{},O instanceof s.P||typeof O[0]=="number")b=[s.P.convert(O)];else{const z=s.P.convert(O[0]),X=s.P.convert(O[1]);b=[z,new s.P(X.x,z.y),X,new s.P(z.x,X.y),z]}return this.style.queryRenderedFeatures(b,A,this.transform)}querySourceFeatures(N,A){return this.style.querySourceFeatures(N,A)}setStyle(N,A){return(A=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},A)).diff!==!1&&A.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&N?(this._diffStyle(N,A),this):(this._localIdeographFontFamily=A.localIdeographFontFamily,this._updateStyle(N,A))}setTransformRequest(N){return this._requestManager.setTransformRequest(N),this}_getUIString(N){const A=this._locale[N];if(A==null)throw new Error(`Missing UI string '${N}'`);return A}_updateStyle(N,A){if(A.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(N,A));const b=this.style&&A.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!N)),N?(this.style=new Zi(this,A||{}),this.style.setEventedParent(this,{style:this.style}),typeof N=="string"?this.style.loadURL(N,A,b):this.style.loadJSON(N,A,b),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Zi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(N,A){if(typeof N=="string"){const b=this._requestManager.transformRequest(N,he.Style);s.f(b,(L,O)=>{L?this.fire(new s.j(L)):O&&this._updateDiff(O,A)})}else typeof N=="object"&&this._updateDiff(N,A)}_updateDiff(N,A){try{this.style.setState(N,A)&&this._update(!0)}catch(b){s.w(`Unable to perform style diff: ${b.message||b.error||b}.  Rebuilding the style from scratch.`),this._updateStyle(N,A)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(N,A){return this._lazyInitEmptyStyle(),this.style.addSource(N,A),this._update(!0)}isSourceLoaded(N){const A=this.style&&this.style.sourceCaches[N];if(A!==void 0)return A.loaded();this.fire(new s.j(new Error(`There is no source with ID '${N}'`)))}setTerrain(N){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),N){const A=this.style.sourceCaches[N.source];if(!A)throw new Error(`cannot load terrain, because there exists no source with ID: ${N.source}`);for(const b in this.style._layers){const L=this.style._layers[b];L.type==="hillshade"&&L.source===N.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ks(this.painter,A,N),this.painter.renderToTexture=new jc(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=b=>{b.dataType==="style"?this.terrain.sourceCache.freeRtt():b.dataType==="source"&&b.tile&&(b.sourceId!==N.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(b.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:N})),this}getTerrain(){var N,A;return(A=(N=this.terrain)===null||N===void 0?void 0:N.options)!==null&&A!==void 0?A:null}areTilesLoaded(){const N=this.style&&this.style.sourceCaches;for(const A in N){const b=N[A]._tiles;for(const L in b){const O=b[L];if(O.state!=="loaded"&&O.state!=="errored")return!1}}return!0}addSourceType(N,A,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(N,A,b)}removeSource(N){return this.style.removeSource(N),this._update(!0)}getSource(N){return this.style.getSource(N)}addImage(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:L=1,sdf:O=!1,stretchX:z,stretchY:X,content:w}=b;if(this._lazyInitEmptyStyle(),!(A instanceof HTMLImageElement||s.a(A))){if(A.width===void 0||A.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:a,height:p,data:x}=A,B=A;return this.style.addImage(N,{data:new s.R({width:a,height:p},new Uint8Array(x)),pixelRatio:L,stretchX:z,stretchY:X,content:w,sdf:O,version:0,userImage:B}),B.onAdd&&B.onAdd(this,N),this}}{const{width:a,height:p,data:x}=s.h.getImageData(A);this.style.addImage(N,{data:new s.R({width:a,height:p},x),pixelRatio:L,stretchX:z,stretchY:X,content:w,sdf:O,version:0})}}updateImage(N,A){const b=this.style.getImage(N);if(!b)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const L=A instanceof HTMLImageElement||s.a(A)?s.h.getImageData(A):A,{width:O,height:z,data:X}=L;if(O===void 0||z===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(O!==b.data.width||z!==b.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(A instanceof HTMLImageElement||s.a(A));return b.data.replace(X,w),this.style.updateImage(N,b),this}getImage(N){return this.style.getImage(N)}hasImage(N){return N?!!this.style.getImage(N):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(N){this.style.removeImage(N)}loadImage(N,A){Ae.getImage(this._requestManager.transformRequest(N,he.Image),A)}listImages(){return this.style.listImages()}addLayer(N,A){return this._lazyInitEmptyStyle(),this.style.addLayer(N,A),this._update(!0)}moveLayer(N,A){return this.style.moveLayer(N,A),this._update(!0)}removeLayer(N){return this.style.removeLayer(N),this._update(!0)}getLayer(N){return this.style.getLayer(N)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(N,A,b){return this.style.setLayerZoomRange(N,A,b),this._update(!0)}setFilter(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(N,A,b),this._update(!0)}getFilter(N){return this.style.getFilter(N)}setPaintProperty(N,A,b){let L=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(N,A,b,L),this._update(!0)}getPaintProperty(N,A){return this.style.getPaintProperty(N,A)}setLayoutProperty(N,A,b){let L=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(N,A,b,L),this._update(!0)}getLayoutProperty(N,A){return this.style.getLayoutProperty(N,A)}setGlyphs(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(N,A),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(N,A,b,L=>{L||this._update(!0)}),this}removeSprite(N){return this._lazyInitEmptyStyle(),this.style.removeSprite(N),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(N,A,b=>{b||this._update(!0)}),this}setLight(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(N,A),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(N,A){return this.style.setFeatureState(N,A),this._update()}removeFeatureState(N,A){return this.style.removeFeatureState(N,A),this._update()}getFeatureState(N){return this.style.getFeatureState(N)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let N=0,A=0;return this._container&&(N=this._container.clientWidth||400,A=this._container.clientHeight||300),[N,A]}_setupContainer(){const N=this._container;N.classList.add("maplibregl-map");const A=this._canvasContainer=v.create("div","maplibregl-canvas-container",N);this._interactive&&A.classList.add("maplibregl-interactive"),this._canvas=v.create("canvas","maplibregl-canvas",A),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const b=this._containerDimensions(),L=this._getClampedPixelRatio(b[0],b[1]);this._resizeCanvas(b[0],b[1],L);const O=this._controlContainer=v.create("div","maplibregl-control-container",N),z=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(X=>{z[X]=v.create("div",`maplibregl-ctrl-${X} `,O)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=v.create("div","maplibregl-cooperative-gesture-screen",this._container);let N=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(N=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${N}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){v.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(N,A,b){this._canvas.width=Math.floor(b*N),this._canvas.height=Math.floor(b*A),this._canvas.style.width=`${N}px`,this._canvas.style.height=`${A}px`}_setupPainter(){const N={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let A=null;this._canvas.addEventListener("webglcontextcreationerror",L=>{A={requestedAttributes:N},L&&(A.statusMessage=L.statusMessage,A.type=L.type)},{once:!0});const b=this._canvas.getContext("webgl2",N)||this._canvas.getContext("webgl",N);if(!b){const L="Failed to initialize WebGL";throw A?(A.message=L,new Error(JSON.stringify(A))):new Error(L)}this.painter=new fn(b,this.transform),T.testSupport(b)}_onCooperativeGesture(N,A,b){return!A&&b<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(N){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||N,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(N){return this._update(),this._renderTaskQueue.add(N)}_cancelRenderFrame(N){this._renderTaskQueue.remove(N)}_render(N){const A=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(N),this._removed)return;let b=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,z=s.h.now();this.style.zoomHistory.update(O,z);const X=new s.a8(O,{now:z,fadeDuration:A,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=X.crossFadingFactor();w===1&&w===this._crossFadingFactor||(b=!0,this._crossFadingFactor=w),this.style.update(X)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,A,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const L=this._sourcesDirty||this._styleDirty||this._placementDirty;return L||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var N;this._hash&&this._hash.remove();for(const b of this._controls)b.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ae.removeThrottleControl(this._imageQueueHandle),(N=this._resizeObserver)===null||N===void 0||N.disconnect();const A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),v.remove(this._canvasContainer),v.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(N=>{s.bg.frame(N),this._frame=null,this._render(N)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(N){this._showTileBoundaries!==N&&(this._showTileBoundaries=N,this._update())}get showPadding(){return!!this._showPadding}set showPadding(N){this._showPadding!==N&&(this._showPadding=N,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(N){this._showCollisionBoxes!==N&&(this._showCollisionBoxes=N,N?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(N){this._showOverdrawInspector!==N&&(this._showOverdrawInspector=N,this._update())}get repaint(){return!!this._repaint}set repaint(N){this._repaint!==N&&(this._repaint=N,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(N){this._vertices=N,this._update()}get version(){return $i}getCameraTargetElevation(){return this.transform.elevation}},zr.NavigationControl=class{constructor(N){this._updateZoomButtons=()=>{const A=this._map.getZoom(),b=A===this._map.getMaxZoom(),L=A===this._map.getMinZoom();this._zoomInButton.disabled=b,this._zoomOutButton.disabled=L,this._zoomInButton.setAttribute("aria-disabled",b.toString()),this._zoomOutButton.setAttribute("aria-disabled",L.toString())},this._rotateCompassArrow=()=>{const A=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=A},this._setButtonTitle=(A,b)=>{const L=this._map._getUIString(`NavigationControl.${b}`);A.title=L,A.setAttribute("aria-label",L)},this.options=s.e({},zu,N),this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",A=>A.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",A=>this._map.zoomIn({},{originalEvent:A})),v.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",A=>this._map.zoomOut({},{originalEvent:A})),v.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",A=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:A}):this._map.resetNorth({},{originalEvent:A})}),this._compassIcon=v.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(N){return this._map=N,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Do(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){v.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(N,A){const b=v.create("button",N,this._container);return b.type="button",b.addEventListener("click",A),b}},zr.GeolocateControl=class extends s.E{constructor(N){super(),this._onSuccess=A=>{if(this._map){if(this._isOutOfMapMaxBounds(A))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",A)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=A,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(A),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(A),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",A)),this._finish()}},this._updateCamera=A=>{const b=new s.L(A.coords.longitude,A.coords.latitude),L=A.coords.accuracy,O=this._map.getBearing(),z=s.e({bearing:O},this.options.fitBoundsOptions),X=Xe.fromLngLat(b,L);this._map.fitBounds(X,z,{geolocateSource:!0})},this._updateMarker=A=>{if(A){const b=new s.L(A.coords.longitude,A.coords.latitude);this._accuracyCircleMarker.setLngLat(b).addTo(this._map),this._userLocationDotMarker.setLngLat(b).addTo(this._map),this._accuracy=A.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=A=>{if(this._map){if(this.options.trackUserLocation)if(A.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(A.code===3&&Yl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",A)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=A=>{if(this._map){if(this._container.addEventListener("contextmenu",b=>b.preventDefault()),this._geolocateButton=v.create("button","maplibregl-ctrl-geolocate",this._container),v.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",A===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{const b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=v.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new $s({element:this._dotElement}),this._circleElement=v.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $s({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",b=>{b.geolocateSource||this._watchState!=="ACTIVE_LOCK"||b.originalEvent&&b.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},Jr,N)}onAdd(N){return this._map=N,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;sn===void 0||b?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(L=>{sn=L.state!=="denied",A(sn)}).catch(()=>{sn=!!window.navigator.geolocation,A(sn)}):(sn=!!window.navigator.geolocation,A(sn)):A(sn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),v.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fn=0,Yl=!1}_isOutOfMapMaxBounds(N){const A=this._map.getMaxBounds(),b=N.coords;return A&&(b.longitude<A.getWest()||b.longitude>A.getEast()||b.latitude<A.getSouth()||b.latitude>A.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const N=this._map.getBounds(),A=N.getSouthEast(),b=N.getNorthEast(),L=A.distanceTo(b),O=Math.ceil(this._accuracy/(L/this._map._container.clientHeight)*2);this._circleElement.style.width=`${O}px`,this._circleElement.style.height=`${O}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fn--,Yl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let N;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Fn++,Fn>1?(N={maximumAge:6e5,timeout:0},Yl=!0):(N=this.options.positionOptions,Yl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,N)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},zr.AttributionControl=to,zr.LogoControl=Ei,zr.ScaleControl=class{constructor(N){this._onMove=()=>{ko(this._map,this._container,this.options)},this.setUnit=A=>{this.options.unit=A,ko(this._map,this._container,this.options)},this.options=s.e({},ec,N)}getDefaultPosition(){return"bottom-left"}onAdd(N){return this._map=N,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-scale",N.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){v.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},zr.FullscreenControl=class extends s.E{constructor(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,N&&N.container&&(N.container instanceof HTMLElement?this._container=N.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(N){return this._map=N,this._container||(this._container=this._map.getContainer()),this._controlContainer=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){v.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const N=this._fullscreenButton=v.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);v.create("span","maplibregl-ctrl-icon",N).setAttribute("aria-hidden","true"),N.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const N=this._getTitle();this._fullscreenButton.setAttribute("aria-label",N),this._fullscreenButton.title=N}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},zr.TerrainControl=class{constructor(N){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=N}onAdd(N){return this._map=N,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=v.create("button","maplibregl-ctrl-terrain",this._container),v.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){v.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},zr.Popup=class extends s.E{constructor(N){super(),this.remove=()=>(this._content&&v.remove(this._content),this._container&&(v.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=A=>{this._update(A.point)},this._onMouseMove=A=>{this._update(A.point)},this._onDrag=A=>{this._update(A.point)},this._update=A=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=v.create("div","maplibregl-popup",this._map.getContainer()),this._tip=v.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const X of this.options.className.split(" "))this._container.classList.add(X);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=qs(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!A)return;const b=this._pos=this._trackPointer&&A?A:this._map.project(this._lngLat);let L=this.options.anchor;const O=Oo(this.options.offset);if(!L){const X=this._container.offsetWidth,w=this._container.offsetHeight;let a;a=b.y+O.bottom.y<w?["top"]:b.y>this._map.transform.height-w?["bottom"]:[],b.x<X/2?a.push("left"):b.x>this._map.transform.width-X/2&&a.push("right"),L=a.length===0?"bottom":a.join("-")}const z=b.add(O[L]).round();v.setTransform(this._container,`${Ro[L]} translate(${z.x}px,${z.y}px)`),pu(this._container,L,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(tc),N)}addTo(N){return this._map&&this.remove(),this._map=N,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(N){return this._lngLat=s.L.convert(N),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(N){return this.setDOMContent(document.createTextNode(N))}setHTML(N){const A=document.createDocumentFragment(),b=document.createElement("body");let L;for(b.innerHTML=N;L=b.firstChild,L;)A.appendChild(L);return this.setDOMContent(A)}getMaxWidth(){var N;return(N=this._container)===null||N===void 0?void 0:N.style.maxWidth}setMaxWidth(N){return this.options.maxWidth=N,this._update(),this}setDOMContent(N){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=v.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(N),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(N){this._container&&this._container.classList.add(N)}removeClassName(N){this._container&&this._container.classList.remove(N)}setOffset(N){return this.options.offset=N,this._update(),this}toggleClassName(N){if(this._container)return this._container.classList.toggle(N)}_createCloseButton(){this.options.closeButton&&(this._closeButton=v.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const N=this._container.querySelector(qc);N&&N.focus()}},zr.Marker=$s,zr.Style=Zi,zr.LngLat=s.L,zr.LngLatBounds=Xe,zr.Point=s.P,zr.MercatorCoordinate=s.U,zr.Evented=s.E,zr.AJAXError=s.bi,zr.config=s.c,zr.CanvasSource=_i,zr.GeoJSONSource=Dt,zr.ImageSource=qt,zr.RasterDEMTileSource=Bt,zr.RasterTileSource=mt,zr.VectorTileSource=pt,zr.VideoSource=ni,zr.setRTLTextPlugin=s.bj,zr.getRTLTextPluginStatus=s.bk,zr.prewarm=function(){Mr().acquire(ci)},zr.clearPrewarmedResources=function(){const N=pr;N&&(N.isPreloaded()&&N.numActive()===1?(N.release(ci),pr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},ic.extend(zr,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),zr});var l=n;return l})})(d4);var Sie=d4.exports,Tie=Object.defineProperty,Iie=(i,e,t)=>e in i?Tie(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Is=(i,e,t)=>(Iie(i,typeof e!="symbol"?e+"":e,t),t);let Lie=class{constructor(e){Is(this,"map"),Is(this,"width"),Is(this,"height"),Is(this,"svgCanvas"),Is(this,"xLine"),Is(this,"yLine"),Is(this,"color","#535353"),this.map=e,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var e,t;this.width=(e=this.map)==null?void 0:e.getCanvas().clientWidth,this.height=(t=this.map)==null?void 0:t.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const e=this.width/2,t=this.height/2;this.yLine.setAttribute("x1",`${e}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${e}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${t}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${t}px`)}else console.error("element value is null")}createCanvas(e){if(this.width!==void 0&&this.height!==void 0){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="relative",t.setAttribute("width",`${this.width}px`),t.setAttribute("height",`${this.height}px`);const r=this.width/2,n=this.height/2;this.yLine=t.appendChild(this.createLine(r,0,r,this.height,this.color,"2px")),this.xLine=t.appendChild(this.createLine(0,n,this.width,n,this.color,"2px")),e==null||e.appendChild(t),this.svgCanvas=t}}createLine(e,t,r,n,o,l){const s=document.createElementNS("http://www.w3.org/2000/svg","line");return s.setAttribute("x1",e),s.setAttribute("y1",t),s.setAttribute("x2",r),s.setAttribute("y2",n),s.setAttribute("stroke-dasharray","5,5"),s.setAttribute("stroke",o),s.setAttribute("stroke-width",l),s}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};function Yn(i){"@babel/helpers - typeof";return Yn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yn(i)}var cc=Uint8Array,uc=Uint16Array,Uy=Uint32Array,W1=new cc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Z1=new cc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fC=new cc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f4=function(i,e){for(var t=new uc(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];for(var n=new Uy(t[30]),r=1;r<30;++r)for(var o=t[r];o<t[r+1];++o)n[o]=o-t[r]<<5|r;return[t,n]},p4=f4(W1,2),g4=p4[0],pC=p4[1];g4[28]=258,pC[258]=28;for(var m4=f4(Z1,0),Mie=m4[0],y4=m4[1],gC=new uc(32768),Ws=0;Ws<32768;++Ws){var gd=(Ws&43690)>>>1|(Ws&21845)<<1;gd=(gd&52428)>>>2|(gd&13107)<<2,gd=(gd&61680)>>>4|(gd&3855)<<4,gC[Ws]=((gd&65280)>>>8|(gd&255)<<8)>>>1}for(var qh=function(i,e,t){for(var r=i.length,n=0,o=new uc(e);n<r;++n)++o[i[n]-1];var l=new uc(e);for(n=0;n<e;++n)l[n]=l[n-1]+o[n-1]<<1;var s;if(t){s=new uc(1<<e);var g=15-e;for(n=0;n<r;++n)if(i[n])for(var v=n<<4|i[n],T=e-i[n],F=l[i[n]-1]++<<T,R=F|(1<<T)-1;F<=R;++F)s[gC[F]>>>g]=v}else for(s=new uc(r),n=0;n<r;++n)s[n]=gC[l[i[n]-1]++]>>>15-i[n];return s},md=new cc(288),Ws=0;Ws<144;++Ws)md[Ws]=8;for(var Ws=144;Ws<256;++Ws)md[Ws]=9;for(var Ws=256;Ws<280;++Ws)md[Ws]=7;for(var Ws=280;Ws<288;++Ws)md[Ws]=8;for(var Ny=new cc(32),Ws=0;Ws<32;++Ws)Ny[Ws]=5;var Pie=qh(md,9,0),Fie=qh(md,9,1),Die=qh(Ny,5,0),Rie=qh(Ny,5,1),mC=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},lh=function(i,e,t){var r=e/8>>0;return(i[r]|i[r+1]<<8)>>>(e&7)&t},yC=function(i,e){var t=e/8>>0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>>(e&7)},_C=function(i){return(i/8>>0)+(i&7&&1)},_4=function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var r=new(i instanceof uc?uc:i instanceof Uy?Uy:cc)(t-e);return r.set(i.subarray(e,t)),r},kie=function(i,e,t){var r=i.length,n=!e||t,o=!t||t.i;t||(t={}),e||(e=new cc(r*3));var l=function(mt){var Bt=e.length;if(mt>Bt){var Dt=new cc(Math.max(Bt*2,mt));Dt.set(e),e=Dt}},s=t.f||0,g=t.p||0,v=t.b||0,T=t.l,F=t.d,R=t.m,U=t.n,J=r*8;do{if(!T){t.f=s=lh(i,g,1);var te=lh(i,g+1,3);if(g+=3,te)if(te==1)T=Fie,F=Rie,R=9,U=5;else if(te==2){var Ae=lh(i,g,31)+257,he=lh(i,g+10,15)+4,pe=Ae+lh(i,g+5,31)+1;g+=14;for(var be=new cc(pe),Te=new cc(19),qe=0;qe<he;++qe)Te[fC[qe]]=lh(i,g+qe*3,7);g+=he*3;var je=mC(Te),We=(1<<je)-1;if(!o&&g+pe*(je+7)>J)break;for(var Ne=qh(Te,je,1),qe=0;qe<pe;){var at=Ne[lh(i,g,We)];g+=at&15;var nt=at>>>4;if(nt<16)be[qe++]=nt;else{var ke=0,De=0;for(nt==16?(De=3+lh(i,g,3),g+=2,ke=be[qe-1]):nt==17?(De=3+lh(i,g,7),g+=3):nt==18&&(De=11+lh(i,g,127),g+=7);De--;)be[qe++]=ke}}var Ye=be.subarray(0,Ae),Ze=be.subarray(Ae);R=mC(Ye),U=mC(Ze),T=qh(Ye,R,1),F=qh(Ze,U,1)}else throw"invalid block type";else{var nt=_C(g)+4,Ct=i[nt-4]|i[nt-3]<<8,Et=nt+Ct;if(Et>r){if(o)throw"unexpected EOF";break}n&&l(v+Ct),e.set(i.subarray(nt,Et),v),t.b=v+=Ct,t.p=g=Et*8;continue}if(g>J)throw"unexpected EOF"}n&&l(v+131072);for(var Pt=(1<<R)-1,bt=(1<<U)-1,Rt=R+U+18;o||g+Rt<J;){var ke=T[yC(i,g)&Pt],Ft=ke>>>4;if(g+=ke&15,g>J)throw"unexpected EOF";if(!ke)throw"invalid length/literal";if(Ft<256)e[v++]=Ft;else if(Ft==256){T=null;break}else{var Xt=Ft-254;if(Ft>264){var qe=Ft-257,Le=W1[qe];Xt=lh(i,g,(1<<Le)-1)+g4[qe],g+=Le}var Xe=F[yC(i,g)&bt],it=Xe>>>4;if(!Xe)throw"invalid distance";g+=Xe&15;var Ze=Mie[it];if(it>3){var Le=Z1[it];Ze+=yC(i,g)&(1<<Le)-1,g+=Le}if(g>J)throw"unexpected EOF";n&&l(v+131072);for(var pt=v+Xt;v<pt;v+=4)e[v]=e[v-Ze],e[v+1]=e[v+1-Ze],e[v+2]=e[v+2-Ze],e[v+3]=e[v+3-Ze];v=pt}}t.l=T,t.p=g,t.b=v,T&&(s=1,t.m=R,t.d=F,t.n=U)}while(!s);return v==e.length?e:_4(e,0,v)},PA=function(i,e,t){t<<=e&7;var r=e/8>>0;i[r]|=t,i[r+1]|=t>>>8},zy=function(i,e,t){t<<=e&7;var r=e/8>>0;i[r]|=t,i[r+1]|=t>>>8,i[r+2]|=t>>>16},vC=function(i,e){for(var t=[],r=0;r<i.length;++r)i[r]&&t.push({s:r,f:i[r]});var n=t.length,o=t.slice();if(!n)return[new cc(0),0];if(n==1){var l=new cc(t[0].s+1);return l[t[0].s]=1,[l,1]}t.sort(function(qe,je){return qe.f-je.f}),t.push({s:-1,f:25001});var s=t[0],g=t[1],v=0,T=1,F=2;for(t[0]={s:-1,f:s.f+g.f,l:s,r:g};T!=n-1;)s=t[t[v].f<t[F].f?v++:F++],g=t[v!=T&&t[v].f<t[F].f?v++:F++],t[T++]={s:-1,f:s.f+g.f,l:s,r:g};for(var R=o[0].s,r=1;r<n;++r)o[r].s>R&&(R=o[r].s);var U=new uc(R+1),J=bC(t[T-1],U,0);if(J>e){var r=0,te=0,Ae=J-e,he=1<<Ae;for(o.sort(function(je,We){return U[We.s]-U[je.s]||je.f-We.f});r<n;++r){var pe=o[r].s;if(U[pe]>e)te+=he-(1<<J-U[pe]),U[pe]=e;else break}for(te>>>=Ae;te>0;){var be=o[r].s;U[be]<e?te-=1<<e-U[be]++-1:++r}for(;r>=0&&te;--r){var Te=o[r].s;U[Te]==e&&(--U[Te],++te)}J=e}return[new cc(U),J]},bC=function(i,e,t){return i.s==-1?Math.max(bC(i.l,e,t+1),bC(i.r,e,t+1)):e[i.s]=t},v4=function(i){for(var e=i.length;e&&!i[--e];);for(var t=new uc(++e),r=0,n=i[0],o=1,l=function(g){t[r++]=g},s=1;s<=e;++s)if(i[s]==n&&s!=e)++o;else{if(!n&&o>2){for(;o>138;o-=138)l(32754);o>2&&(l(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(l(n),--o;o>6;o-=6)l(8304);o>2&&(l(o-3<<5|8208),o=0)}for(;o--;)l(n);o=1,n=i[s]}return[t.subarray(0,r),e]},Qy=function(i,e){for(var t=0,r=0;r<e.length;++r)t+=i[r]*e[r];return t},X1=function(i,e,t){var r=t.length,n=_C(e+2);i[n]=r&255,i[n+1]=r>>>8,i[n+2]=i[n]^255,i[n+3]=i[n+1]^255;for(var o=0;o<r;++o)i[n+o+4]=t[o];return(n+4+r)*8},b4=function(i,e,t,r,n,o,l,s,g,v,T){PA(e,T++,t),++n[256];for(var F=vC(n,15),R=F[0],U=F[1],J=vC(o,15),te=J[0],Ae=J[1],he=v4(R),pe=he[0],be=he[1],Te=v4(te),qe=Te[0],je=Te[1],We=new uc(19),Ne=0;Ne<pe.length;++Ne)We[pe[Ne]&31]++;for(var Ne=0;Ne<qe.length;++Ne)We[qe[Ne]&31]++;for(var at=vC(We,7),nt=at[0],ke=at[1],De=19;De>4&&!nt[fC[De-1]];--De);var Ye=v+5<<3,Ze=Qy(n,md)+Qy(o,Ny)+l,Ct=Qy(n,R)+Qy(o,te)+l+14+3*De+Qy(We,nt)+(2*We[16]+3*We[17]+7*We[18]);if(Ye<=Ze&&Ye<=Ct)return X1(e,T,i.subarray(g,g+v));var Et,Pt,bt,Rt;if(PA(e,T,1+(Ct<Ze)),T+=2,Ct<Ze){Et=qh(R,U,0),Pt=R,bt=qh(te,Ae,0),Rt=te;var Ft=qh(nt,ke,0);PA(e,T,be-257),PA(e,T+5,je-1),PA(e,T+10,De-4),T+=14;for(var Ne=0;Ne<De;++Ne)PA(e,T+3*Ne,nt[fC[Ne]]);T+=3*De;for(var Xt=[pe,qe],Le=0;Le<2;++Le)for(var Xe=Xt[Le],Ne=0;Ne<Xe.length;++Ne){var it=Xe[Ne]&31;PA(e,T,Ft[it]),T+=nt[it],it>15&&(PA(e,T,Xe[Ne]>>>5&127),T+=Xe[Ne]>>>12)}}else Et=Pie,Pt=md,bt=Die,Rt=Ny;for(var Ne=0;Ne<s;++Ne)if(r[Ne]>255){var it=r[Ne]>>>18&31;zy(e,T,Et[it+257]),T+=Pt[it+257],it>7&&(PA(e,T,r[Ne]>>>23&31),T+=W1[it]);var pt=r[Ne]&31;zy(e,T,bt[pt]),T+=Rt[pt],pt>3&&(zy(e,T,r[Ne]>>>5&8191),T+=Z1[pt])}else zy(e,T,Et[r[Ne]]),T+=Pt[r[Ne]];return zy(e,T,Et[256]),T+Pt[256]},Oie=new Uy([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Uie=new cc(0),Nie=function(i,e,t,r,n,o){var l=i.length,s=new cc(r+l+5*(1+Math.floor(l/7e3))+n),g=s.subarray(r,s.length-n),v=0;if(!e||l<8)for(var T=0;T<=l;T+=65535){var F=T+65535;F<l?v=X1(g,v,i.subarray(T,F)):(g[T]=o,v=X1(g,v,i.subarray(T,l)))}else{for(var R=Oie[e-1],U=R>>>13,J=R&8191,te=(1<<t)-1,Ae=new uc(32768),he=new uc(te+1),pe=Math.ceil(t/3),be=2*pe,Te=function(Pi){return(i[Pi]^i[Pi+1]<<pe^i[Pi+2]<<be)&te},qe=new Uy(25e3),je=new uc(288),We=new uc(32),Ne=0,at=0,T=0,nt=0,ke=0,De=0;T<l;++T){var Ye=Te(T),Ze=T&32767,Ct=he[Ye];if(Ae[Ze]=Ct,he[Ye]=Ze,ke<=T){var Et=l-T;if((Ne>7e3||nt>24576)&&Et>423){v=b4(i,g,0,qe,je,We,at,nt,De,T-De,v),nt=Ne=at=0,De=T;for(var Pt=0;Pt<286;++Pt)je[Pt]=0;for(var Pt=0;Pt<30;++Pt)We[Pt]=0}var bt=2,Rt=0,Ft=J,Xt=Ze-Ct&32767;if(Et>2&&Ye==Te(T-Xt))for(var Le=Math.min(U,Et)-1,Xe=Math.min(32767,T),it=Math.min(258,Et);Xt<=Xe&&--Ft&&Ze!=Ct;){if(i[T+bt]==i[T+bt-Xt]){for(var pt=0;pt<it&&i[T+pt]==i[T+pt-Xt];++pt);if(pt>bt){if(bt=pt,Rt=Xt,pt>Le)break;for(var mt=Math.min(Xt,pt-2),Bt=0,Pt=0;Pt<mt;++Pt){var Dt=T-Xt+Pt+32768&32767,Mt=Ae[Dt],qt=Dt-Mt+32768&32767;qt>Bt&&(Bt=qt,Ct=Dt)}}}Ze=Ct,Ct=Ae[Ze],Xt+=Ze-Ct+32768&32767}if(Rt){qe[nt++]=268435456|pC[bt]<<18|y4[Rt];var ni=pC[bt]&31,_i=y4[Rt]&31;at+=W1[ni]+Z1[_i],++je[257+ni],++We[_i],ke=T+bt,++Ne}else qe[nt++]=i[T],++je[i[T]]}}v=b4(i,g,o,qe,je,We,at,nt,De,T-De,v),o||(v=X1(g,v,Uie))}return _4(s,0,r+_C(v)+n)},zie=function(){var i=1,e=0;return{p:function(t){for(var r=i,n=e,o=t.length,l=0;l!=o;){for(var s=Math.min(l+5552,o);l<s;++l)r+=t[l],n+=r;r%=65521,n%=65521}i=r,e=n},d:function(){return(i>>>8<<16|(e&255)<<8|e>>>8)+((i&255)<<23)*2}}},Qie=function(i,e,t,r,n){return Nie(i,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):12+e.mem,t,r,!n)},Vie=function(i,e,t){for(;t;++e)i[e]=t,t>>>=8},Hie=function(i,e){var t=e.level,r=t==0?0:t<6?1:t==9?3:2;i[0]=120,i[1]=r<<6|(r?32-2*r:1)},Gie=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function xC(i,e){e===void 0&&(e={});var t=zie();t.p(i);var r=Qie(i,e,2,4);return Hie(r,e),Vie(r,r.length-4,t.d()),r}function jie(i,e){return kie((Gie(i),i.subarray(2,-4)),e)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Vr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function wC(){Vr.console&&typeof Vr.console.log=="function"&&Vr.console.log.apply(Vr.console,arguments)}var Ls={log:wC,warn:function(i){Vr.console&&(typeof Vr.console.warn=="function"?Vr.console.warn.apply(Vr.console,arguments):wC.call(null,arguments))},error:function(i){Vr.console&&(typeof Vr.console.error=="function"?Vr.console.error.apply(Vr.console,arguments):wC(i))}};function BC(i,e,t){var r=new XMLHttpRequest;r.open("GET",i),r.responseType="blob",r.onload=function(){If(r.response,e,t)},r.onerror=function(){Ls.error("could not download file")},r.send()}function x4(i){var e=new XMLHttpRequest;e.open("HEAD",i,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function J1(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(e)}}var Vy,CC,If=Vr.saveAs||((typeof window>"u"?"undefined":Yn(window))!=="object"||window!==Vr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(i,e,t){var r=Vr.URL||Vr.webkitURL,n=document.createElement("a");e=e||i.name||"download",n.download=e,n.rel="noopener",typeof i=="string"?(n.href=i,n.origin!==location.origin?x4(n.href)?BC(i,e,t):J1(n,n.target="_blank"):J1(n)):(n.href=r.createObjectURL(i),setTimeout(function(){r.revokeObjectURL(n.href)},4e4),setTimeout(function(){J1(n)},0))}:"msSaveOrOpenBlob"in navigator?function(i,e,t){if(e=e||i.name||"download",typeof i=="string")if(x4(i))BC(i,e,t);else{var r=document.createElement("a");r.href=i,r.target="_blank",setTimeout(function(){J1(r)})}else navigator.msSaveOrOpenBlob(function(n,o){return o===void 0?o={autoBom:!1}:Yn(o)!=="object"&&(Ls.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}(i,t),e)}:function(i,e,t,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof i=="string")return BC(i,e,t);var n=i.type==="application/octet-stream",o=/constructor/i.test(Vr.HTMLElement)||Vr.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||n&&o)&&(typeof FileReader>"u"?"undefined":Yn(FileReader))==="object"){var s=new FileReader;s.onloadend=function(){var T=s.result;T=l?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=T:location=T,r=null},s.readAsDataURL(i)}else{var g=Vr.URL||Vr.webkitURL,v=g.createObjectURL(i);r?r.location=v:location.href=v,r=null,setTimeout(function(){g.revokeObjectURL(v)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function w4(i){var e;i=i||"",this.ok=!1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[i=(i=i.replace(/ /g,"")).toLowerCase()]||i;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(s){return[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(s){return[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(s){return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)]}}],r=0;r<t.length;r++){var n=t[r].re,o=t[r].process,l=n.exec(i);l&&(e=o(l),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var s=this.r.toString(16),g=this.g.toString(16),v=this.b.toString(16);return s.length==1&&(s="0"+s),g.length==1&&(g="0"+g),v.length==1&&(v="0"+v),"#"+s+g+v}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function EC(i,e){var t=i[0],r=i[1],n=i[2],o=i[3];t=Ml(t,r,n,o,e[0],7,-680876936),o=Ml(o,t,r,n,e[1],12,-389564586),n=Ml(n,o,t,r,e[2],17,606105819),r=Ml(r,n,o,t,e[3],22,-1044525330),t=Ml(t,r,n,o,e[4],7,-176418897),o=Ml(o,t,r,n,e[5],12,1200080426),n=Ml(n,o,t,r,e[6],17,-1473231341),r=Ml(r,n,o,t,e[7],22,-45705983),t=Ml(t,r,n,o,e[8],7,1770035416),o=Ml(o,t,r,n,e[9],12,-1958414417),n=Ml(n,o,t,r,e[10],17,-42063),r=Ml(r,n,o,t,e[11],22,-1990404162),t=Ml(t,r,n,o,e[12],7,1804603682),o=Ml(o,t,r,n,e[13],12,-40341101),n=Ml(n,o,t,r,e[14],17,-1502002290),t=Pl(t,r=Ml(r,n,o,t,e[15],22,1236535329),n,o,e[1],5,-165796510),o=Pl(o,t,r,n,e[6],9,-1069501632),n=Pl(n,o,t,r,e[11],14,643717713),r=Pl(r,n,o,t,e[0],20,-373897302),t=Pl(t,r,n,o,e[5],5,-701558691),o=Pl(o,t,r,n,e[10],9,38016083),n=Pl(n,o,t,r,e[15],14,-660478335),r=Pl(r,n,o,t,e[4],20,-405537848),t=Pl(t,r,n,o,e[9],5,568446438),o=Pl(o,t,r,n,e[14],9,-1019803690),n=Pl(n,o,t,r,e[3],14,-187363961),r=Pl(r,n,o,t,e[8],20,1163531501),t=Pl(t,r,n,o,e[13],5,-1444681467),o=Pl(o,t,r,n,e[2],9,-51403784),n=Pl(n,o,t,r,e[7],14,1735328473),t=Fl(t,r=Pl(r,n,o,t,e[12],20,-1926607734),n,o,e[5],4,-378558),o=Fl(o,t,r,n,e[8],11,-2022574463),n=Fl(n,o,t,r,e[11],16,1839030562),r=Fl(r,n,o,t,e[14],23,-35309556),t=Fl(t,r,n,o,e[1],4,-1530992060),o=Fl(o,t,r,n,e[4],11,1272893353),n=Fl(n,o,t,r,e[7],16,-155497632),r=Fl(r,n,o,t,e[10],23,-1094730640),t=Fl(t,r,n,o,e[13],4,681279174),o=Fl(o,t,r,n,e[0],11,-358537222),n=Fl(n,o,t,r,e[3],16,-722521979),r=Fl(r,n,o,t,e[6],23,76029189),t=Fl(t,r,n,o,e[9],4,-640364487),o=Fl(o,t,r,n,e[12],11,-421815835),n=Fl(n,o,t,r,e[15],16,530742520),t=Dl(t,r=Fl(r,n,o,t,e[2],23,-995338651),n,o,e[0],6,-198630844),o=Dl(o,t,r,n,e[7],10,1126891415),n=Dl(n,o,t,r,e[14],15,-1416354905),r=Dl(r,n,o,t,e[5],21,-57434055),t=Dl(t,r,n,o,e[12],6,1700485571),o=Dl(o,t,r,n,e[3],10,-1894986606),n=Dl(n,o,t,r,e[10],15,-1051523),r=Dl(r,n,o,t,e[1],21,-2054922799),t=Dl(t,r,n,o,e[8],6,1873313359),o=Dl(o,t,r,n,e[15],10,-30611744),n=Dl(n,o,t,r,e[6],15,-1560198380),r=Dl(r,n,o,t,e[13],21,1309151649),t=Dl(t,r,n,o,e[4],6,-145523070),o=Dl(o,t,r,n,e[11],10,-1120210379),n=Dl(n,o,t,r,e[2],15,718787259),r=Dl(r,n,o,t,e[9],21,-343485551),i[0]=yd(t,i[0]),i[1]=yd(r,i[1]),i[2]=yd(n,i[2]),i[3]=yd(o,i[3])}function Y1(i,e,t,r,n,o){return e=yd(yd(e,i),yd(r,o)),yd(e<<n|e>>>32-n,t)}function Ml(i,e,t,r,n,o,l){return Y1(e&t|~e&r,i,e,n,o,l)}function Pl(i,e,t,r,n,o,l){return Y1(e&r|t&~r,i,e,n,o,l)}function Fl(i,e,t,r,n,o,l){return Y1(e^t^r,i,e,n,o,l)}function Dl(i,e,t,r,n,o,l){return Y1(t^(e|~r),i,e,n,o,l)}function B4(i){var e,t=i.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=i.length;e+=64)EC(r,qie(i.substring(e-64,e)));i=i.substring(e-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i.length;e++)n[e>>2]|=i.charCodeAt(e)<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(EC(r,n),e=0;e<16;e++)n[e]=0;return n[14]=8*t,EC(r,n),r}function qie(i){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=i.charCodeAt(e)+(i.charCodeAt(e+1)<<8)+(i.charCodeAt(e+2)<<16)+(i.charCodeAt(e+3)<<24);return t}Vy=Vr.atob.bind(Vr),CC=Vr.btoa.bind(Vr);var C4="0123456789abcdef".split("");function $ie(i){for(var e="",t=0;t<4;t++)e+=C4[i>>8*t+4&15]+C4[i>>8*t&15];return e}function Kie(i){return String.fromCharCode((255&i)>>0,(65280&i)>>8,(16711680&i)>>16,(4278190080&i)>>24)}function SC(i){return B4(i).map(Kie).join("")}var Wie=function(i){for(var e=0;e<i.length;e++)i[e]=$ie(i[e]);return i.join("")}(B4("hello"))!="5d41402abc4b2a76b9719d911017c592";function yd(i,e){if(Wie){var t=(65535&i)+(65535&e);return(i>>16)+(e>>16)+(t>>16)<<16|65535&t}return i+e&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function TC(i,e){var t,r,n,o;if(i!==t){for(var l=(n=i,o=1+(256/i.length>>0),new Array(o+1).join(n)),s=[],g=0;g<256;g++)s[g]=g;var v=0;for(g=0;g<256;g++){var T=s[g];v=(v+T+l.charCodeAt(g))%256,s[g]=s[v],s[v]=T}t=i,r=s}else s=r;var F=e.length,R=0,U=0,J="";for(g=0;g<F;g++)U=(U+(T=s[R=(R+1)%256]))%256,s[R]=s[U],s[U]=T,l=s[(s[R]+s[U])%256],J+=String.fromCharCode(e.charCodeAt(g)^l);return J}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var E4={print:4,modify:8,copy:16,"annot-forms":32};function xg(i,e,t,r){this.v=1,this.r=2;var n=192;i.forEach(function(s){if(E4.perm!==void 0)throw new Error("Invalid permission: "+s);n+=E4[s]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var o=(e+this.padding).substr(0,32),l=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,l),this.P=-(1+(255^n)),this.encryptionKey=SC(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=TC(this.encryptionKey,this.padding)}function wg(i){if(/[^\u0000-\u00ff]/.test(i))throw new Error("Invalid PDF Name Object: "+i+", Only accept ASCII characters.");for(var e="",t=i.length,r=0;r<t;r++){var n=i.charCodeAt(r);n<33||n===35||n===37||n===40||n===41||n===47||n===60||n===62||n===91||n===93||n===123||n===125||n>126?e+="#"+("0"+n.toString(16)).slice(-2):e+=i[r]}return e}function S4(i){if(Yn(i)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,r,n){if(n=n||!1,typeof t!="string"||typeof r!="function"||typeof n!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var o=Math.random().toString(35);return e[t][o]=[r,!!n],o},this.unsubscribe=function(t){for(var r in e)if(e[r][t])return delete e[r][t],Object.keys(e[r]).length===0&&delete e[r],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var r=Array.prototype.slice.call(arguments,1),n=[];for(var o in e[t]){var l=e[t][o];try{l[0].apply(i,r)}catch(s){Vr.console&&Ls.error("jsPDF PubSub Error",s.message,s)}l[1]&&n.push(o)}n.length&&n.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function ev(i){if(!(this instanceof ev))return new ev(i);var e="opacity,stroke-opacity".split(",");for(var t in i)i.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=i[t]);this.id="",this.objectNumber=-1}function T4(i,e){this.gState=i,this.matrix=e,this.id="",this.objectNumber=-1}function Lf(i,e,t,r,n){if(!(this instanceof Lf))return new Lf(i,e,t,r,n);this.type=i==="axial"?2:3,this.coords=e,this.colors=t,T4.call(this,r,n)}function Bg(i,e,t,r,n){if(!(this instanceof Bg))return new Bg(i,e,t,r,n);this.boundingBox=i,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,T4.call(this,r,n)}function Hr(i){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],n=arguments[2],o=arguments[3],l=[],s=1,g=16,v="S",T=null;Yn(i=i||{})==="object"&&(t=i.orientation,r=i.unit||r,n=i.format||n,o=i.compress||i.compressPdf||o,(T=i.encryption||null)!==null&&(T.userPassword=T.userPassword||"",T.ownerPassword=T.ownerPassword||"",T.userPermissions=T.userPermissions||[]),s=typeof i.userUnit=="number"?Math.abs(i.userUnit):1,i.precision!==void 0&&(e=i.precision),i.floatPrecision!==void 0&&(g=i.floatPrecision),v=i.defaultPathOperation||"S"),l=i.filters||(o===!0?["FlateEncode"]:l),r=r||"mm",t=(""+(t||"P")).toLowerCase();var F=i.putOnlyUsedFonts||!1,R={},U={internal:{},__private__:{}};U.__private__.PubSub=S4;var J="1.3",te=U.__private__.getPdfVersion=function(){return J};U.__private__.setPdfVersion=function(ne){J=ne};var Ae={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};U.__private__.getPageFormats=function(){return Ae};var he=U.__private__.getPageFormat=function(ne){return Ae[ne]};n=n||"a4";var pe={COMPAT:"compat",ADVANCED:"advanced"},be=pe.COMPAT;function Te(){this.saveGraphicsState(),lt(new we(hi,0,0,-hi,0,lo()*hi).toString()+" cm"),this.setFontSize(this.getFontSize()/hi),v="n",be=pe.ADVANCED}function qe(){this.restoreGraphicsState(),v="S",be=pe.COMPAT}var je=U.__private__.combineFontStyleAndFontWeight=function(ne,Pe){if(ne=="bold"&&Pe=="normal"||ne=="bold"&&Pe==400||ne=="normal"&&Pe=="italic"||ne=="bold"&&Pe=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Pe&&(ne=Pe==400||Pe==="normal"?ne==="italic"?"italic":"normal":Pe!=700&&Pe!=="bold"||ne!=="normal"?(Pe==700?"bold":Pe)+""+ne:"bold"),ne};U.advancedAPI=function(ne){var Pe=be===pe.COMPAT;return Pe&&Te.call(this),typeof ne!="function"||(ne(this),Pe&&qe.call(this)),this},U.compatAPI=function(ne){var Pe=be===pe.ADVANCED;return Pe&&qe.call(this),typeof ne!="function"||(ne(this),Pe&&Te.call(this)),this},U.isAdvancedAPI=function(){return be===pe.ADVANCED};var We,Ne=function(ne){if(be!==pe.ADVANCED)throw new Error(ne+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},at=U.roundToPrecision=U.__private__.roundToPrecision=function(ne,Pe){var ct=e||Pe;if(isNaN(ne)||isNaN(ct))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return ne.toFixed(ct).replace(/0+$/,"")};We=U.hpf=U.__private__.hpf=typeof g=="number"?function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return at(ne,g)}:g==="smart"?function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return at(ne,ne>-1&&ne<1?16:5)}:function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return at(ne,16)};var nt=U.f2=U.__private__.f2=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.f2");return at(ne,2)},ke=U.__private__.f3=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.f3");return at(ne,3)},De=U.scale=U.__private__.scale=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.scale");return be===pe.COMPAT?ne*hi:be===pe.ADVANCED?ne:void 0},Ye=function(ne){return be===pe.COMPAT?lo()-ne:be===pe.ADVANCED?ne:void 0},Ze=function(ne){return De(Ye(ne))};U.__private__.setPrecision=U.setPrecision=function(ne){typeof parseInt(ne,10)=="number"&&(e=parseInt(ne,10))};var Ct,Et="00000000000000000000000000000000",Pt=U.__private__.getFileId=function(){return Et},bt=U.__private__.setFileId=function(ne){return Et=ne!==void 0&&/^[a-fA-F0-9]{32}$/.test(ne)?ne.toUpperCase():Et.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),T!==null&&(_n=new xg(T.userPermissions,T.userPassword,T.ownerPassword,Et)),Et};U.setFileId=function(ne){return bt(ne),this},U.getFileId=function(){return Pt()};var Rt=U.__private__.convertDateToPDFDate=function(ne){var Pe=ne.getTimezoneOffset(),ct=Pe<0?"+":"-",_t=Math.floor(Math.abs(Pe/60)),xt=Math.abs(Pe%60),Lt=[ct,it(_t),"'",it(xt),"'"].join("");return["D:",ne.getFullYear(),it(ne.getMonth()+1),it(ne.getDate()),it(ne.getHours()),it(ne.getMinutes()),it(ne.getSeconds()),Lt].join("")},Ft=U.__private__.convertPDFDateToDate=function(ne){var Pe=parseInt(ne.substr(2,4),10),ct=parseInt(ne.substr(6,2),10)-1,_t=parseInt(ne.substr(8,2),10),xt=parseInt(ne.substr(10,2),10),Lt=parseInt(ne.substr(12,2),10),pi=parseInt(ne.substr(14,2),10);return new Date(Pe,ct,_t,xt,Lt,pi,0)},Xt=U.__private__.setCreationDate=function(ne){var Pe;if(ne===void 0&&(ne=new Date),ne instanceof Date)Pe=Rt(ne);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(ne))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Pe=ne}return Ct=Pe},Le=U.__private__.getCreationDate=function(ne){var Pe=Ct;return ne==="jsDate"&&(Pe=Ft(Ct)),Pe};U.setCreationDate=function(ne){return Xt(ne),this},U.getCreationDate=function(ne){return Le(ne)};var Xe,it=U.__private__.padd2=function(ne){return("0"+parseInt(ne)).slice(-2)},pt=U.__private__.padd2Hex=function(ne){return("00"+(ne=ne.toString())).substr(ne.length)},mt=0,Bt=[],Dt=[],Mt=0,qt=[],ni=[],_i=!1,vi=Dt,Pi=function(){mt=0,Mt=0,Dt=[],Bt=[],qt=[],ii=vt(),Gt=vt()};U.__private__.setCustomOutputDestination=function(ne){_i=!0,vi=ne};var kt=function(ne){_i||(vi=ne)};U.__private__.resetCustomOutputDestination=function(){_i=!1,vi=Dt};var lt=U.__private__.out=function(ne){return ne=ne.toString(),Mt+=ne.length+1,vi.push(ne),vi},wt=U.__private__.write=function(ne){return lt(arguments.length===1?ne.toString():Array.prototype.join.call(arguments," "))},Oi=U.__private__.getArrayBuffer=function(ne){for(var Pe=ne.length,ct=new ArrayBuffer(Pe),_t=new Uint8Array(ct);Pe--;)_t[Pe]=ne.charCodeAt(Pe);return ct},ti=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];U.__private__.getStandardFonts=function(){return ti};var ht=i.fontSize||16;U.__private__.setFontSize=U.setFontSize=function(ne){return ht=be===pe.ADVANCED?ne/hi:ne,this};var $t,oi=U.__private__.getFontSize=U.getFontSize=function(){return be===pe.COMPAT?ht:ht*hi},gi=i.R2L||!1;U.__private__.setR2L=U.setR2L=function(ne){return gi=ne,this},U.__private__.getR2L=U.getR2L=function(){return gi};var ci,Ki=U.__private__.setZoomMode=function(ne){var Pe=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(ne))$t=ne;else if(isNaN(ne)){if(Pe.indexOf(ne)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+ne+'" is not recognized.');$t=ne}else $t=parseInt(ne,10)};U.__private__.getZoomMode=function(){return $t};var tr,pr=U.__private__.setPageMode=function(ne){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(ne)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+ne+'" is not recognized.');ci=ne};U.__private__.getPageMode=function(){return ci};var Mr=U.__private__.setLayoutMode=function(ne){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(ne)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+ne+'" is not recognized.');tr=ne};U.__private__.getLayoutMode=function(){return tr},U.__private__.setDisplayMode=U.setDisplayMode=function(ne,Pe,ct){return Ki(ne),Mr(Pe),pr(ct),this};var zt={title:"",subject:"",author:"",keywords:"",creator:""};U.__private__.getDocumentProperty=function(ne){if(Object.keys(zt).indexOf(ne)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return zt[ne]},U.__private__.getDocumentProperties=function(){return zt},U.__private__.setDocumentProperties=U.setProperties=U.setDocumentProperties=function(ne){for(var Pe in zt)zt.hasOwnProperty(Pe)&&ne[Pe]&&(zt[Pe]=ne[Pe]);return this},U.__private__.setDocumentProperty=function(ne,Pe){if(Object.keys(zt).indexOf(ne)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return zt[ne]=Pe};var Wi,hi,Wt,Ar,Qt,Si={},Ii={},Zt=[],bi={},ei={},_r={},Zr={},Qe=null,Be=0,ce=[],ie=new S4(U),ue=i.hotfixes||[],ge={},xe={},Ee=[],we=function ne(Pe,ct,_t,xt,Lt,pi){if(!(this instanceof ne))return new ne(Pe,ct,_t,xt,Lt,pi);isNaN(Pe)&&(Pe=1),isNaN(ct)&&(ct=0),isNaN(_t)&&(_t=0),isNaN(xt)&&(xt=1),isNaN(Lt)&&(Lt=0),isNaN(pi)&&(pi=0),this._matrix=[Pe,ct,_t,xt,Lt,pi]};Object.defineProperty(we.prototype,"sx",{get:function(){return this._matrix[0]},set:function(ne){this._matrix[0]=ne}}),Object.defineProperty(we.prototype,"shy",{get:function(){return this._matrix[1]},set:function(ne){this._matrix[1]=ne}}),Object.defineProperty(we.prototype,"shx",{get:function(){return this._matrix[2]},set:function(ne){this._matrix[2]=ne}}),Object.defineProperty(we.prototype,"sy",{get:function(){return this._matrix[3]},set:function(ne){this._matrix[3]=ne}}),Object.defineProperty(we.prototype,"tx",{get:function(){return this._matrix[4]},set:function(ne){this._matrix[4]=ne}}),Object.defineProperty(we.prototype,"ty",{get:function(){return this._matrix[5]},set:function(ne){this._matrix[5]=ne}}),Object.defineProperty(we.prototype,"a",{get:function(){return this._matrix[0]},set:function(ne){this._matrix[0]=ne}}),Object.defineProperty(we.prototype,"b",{get:function(){return this._matrix[1]},set:function(ne){this._matrix[1]=ne}}),Object.defineProperty(we.prototype,"c",{get:function(){return this._matrix[2]},set:function(ne){this._matrix[2]=ne}}),Object.defineProperty(we.prototype,"d",{get:function(){return this._matrix[3]},set:function(ne){this._matrix[3]=ne}}),Object.defineProperty(we.prototype,"e",{get:function(){return this._matrix[4]},set:function(ne){this._matrix[4]=ne}}),Object.defineProperty(we.prototype,"f",{get:function(){return this._matrix[5]},set:function(ne){this._matrix[5]=ne}}),Object.defineProperty(we.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(we.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(we.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(we.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),we.prototype.join=function(ne){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(We).join(ne)},we.prototype.multiply=function(ne){var Pe=ne.sx*this.sx+ne.shy*this.shx,ct=ne.sx*this.shy+ne.shy*this.sy,_t=ne.shx*this.sx+ne.sy*this.shx,xt=ne.shx*this.shy+ne.sy*this.sy,Lt=ne.tx*this.sx+ne.ty*this.shx+this.tx,pi=ne.tx*this.shy+ne.ty*this.sy+this.ty;return new we(Pe,ct,_t,xt,Lt,pi)},we.prototype.decompose=function(){var ne=this.sx,Pe=this.shy,ct=this.shx,_t=this.sy,xt=this.tx,Lt=this.ty,pi=Math.sqrt(ne*ne+Pe*Pe),si=(ne/=pi)*ct+(Pe/=pi)*_t;ct-=ne*si,_t-=Pe*si;var nr=Math.sqrt(ct*ct+_t*_t);return si/=nr,ne*(_t/=nr)<Pe*(ct/=nr)&&(ne=-ne,Pe=-Pe,si=-si,pi=-pi),{scale:new we(pi,0,0,nr,0,0),translate:new we(1,0,0,1,xt,Lt),rotate:new we(ne,Pe,-Pe,ne,0,0),skew:new we(1,0,si,1,0,0)}},we.prototype.toString=function(ne){return this.join(" ")},we.prototype.inversed=function(){var ne=this.sx,Pe=this.shy,ct=this.shx,_t=this.sy,xt=this.tx,Lt=this.ty,pi=1/(ne*_t-Pe*ct),si=_t*pi,nr=-Pe*pi,qi=-ct*pi,Yi=ne*pi;return new we(si,nr,qi,Yi,-si*xt-qi*Lt,-nr*xt-Yi*Lt)},we.prototype.applyToPoint=function(ne){var Pe=ne.x*this.sx+ne.y*this.shx+this.tx,ct=ne.x*this.shy+ne.y*this.sy+this.ty;return new Hl(Pe,ct)},we.prototype.applyToRectangle=function(ne){var Pe=this.applyToPoint(ne),ct=this.applyToPoint(new Hl(ne.x+ne.w,ne.y+ne.h));return new Ja(Pe.x,Pe.y,ct.x-Pe.x,ct.y-Pe.y)},we.prototype.clone=function(){var ne=this.sx,Pe=this.shy,ct=this.shx,_t=this.sy,xt=this.tx,Lt=this.ty;return new we(ne,Pe,ct,_t,xt,Lt)},U.Matrix=we;var Fe=U.matrixMult=function(ne,Pe){return Pe.multiply(ne)},ze=new we(1,0,0,1,0,0);U.unitMatrix=U.identityMatrix=ze;var Ge=function(ne,Pe){if(!ei[ne]){var ct=(Pe instanceof Lf?"Sh":"P")+(Object.keys(bi).length+1).toString(10);Pe.id=ct,ei[ne]=ct,bi[ct]=Pe,ie.publish("addPattern",Pe)}};U.ShadingPattern=Lf,U.TilingPattern=Bg,U.addShadingPattern=function(ne,Pe){return Ne("addShadingPattern()"),Ge(ne,Pe),this},U.beginTilingPattern=function(ne){Ne("beginTilingPattern()"),Gl(ne.boundingBox[0],ne.boundingBox[1],ne.boundingBox[2]-ne.boundingBox[0],ne.boundingBox[3]-ne.boundingBox[1],ne.matrix)},U.endTilingPattern=function(ne,Pe){Ne("endTilingPattern()"),Pe.stream=ni[Xe].join(`
`),Ge(ne,Pe),ie.publish("endTilingPattern",Pe),Ee.pop().restore()};var st=U.__private__.newObject=function(){var ne=vt();return Tt(ne,!0),ne},vt=U.__private__.newObjectDeferred=function(){return mt++,Bt[mt]=function(){return Mt},mt},Tt=function(ne,Pe){return Pe=typeof Pe=="boolean"&&Pe,Bt[ne]=Mt,Pe&&lt(ne+" 0 obj"),ne},Kt=U.__private__.newAdditionalObject=function(){var ne={objId:vt(),content:""};return qt.push(ne),ne},ii=vt(),Gt=vt(),Ai=U.__private__.decodeColorString=function(ne){var Pe=ne.split(" ");if(Pe.length!==2||Pe[1]!=="g"&&Pe[1]!=="G")Pe.length===5&&(Pe[4]==="k"||Pe[4]==="K")&&(Pe=[(1-Pe[0])*(1-Pe[3]),(1-Pe[1])*(1-Pe[3]),(1-Pe[2])*(1-Pe[3]),"r"]);else{var ct=parseFloat(Pe[0]);Pe=[ct,ct,ct,"r"]}for(var _t="#",xt=0;xt<3;xt++)_t+=("0"+Math.floor(255*parseFloat(Pe[xt])).toString(16)).slice(-2);return _t},Bi=U.__private__.encodeColorString=function(ne){var Pe;typeof ne=="string"&&(ne={ch1:ne});var ct=ne.ch1,_t=ne.ch2,xt=ne.ch3,Lt=ne.ch4,pi=ne.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof ct=="string"&&ct.charAt(0)!=="#"){var si=new w4(ct);if(si.ok)ct=si.toHex();else if(!/^\d*\.?\d*$/.test(ct))throw new Error('Invalid color "'+ct+'" passed to jsPDF.encodeColorString.')}if(typeof ct=="string"&&/^#[0-9A-Fa-f]{3}$/.test(ct)&&(ct="#"+ct[1]+ct[1]+ct[2]+ct[2]+ct[3]+ct[3]),typeof ct=="string"&&/^#[0-9A-Fa-f]{6}$/.test(ct)){var nr=parseInt(ct.substr(1),16);ct=nr>>16&255,_t=nr>>8&255,xt=255&nr}if(_t===void 0||Lt===void 0&&ct===_t&&_t===xt)if(typeof ct=="string")Pe=ct+" "+pi[0];else switch(ne.precision){case 2:Pe=nt(ct/255)+" "+pi[0];break;case 3:default:Pe=ke(ct/255)+" "+pi[0]}else if(Lt===void 0||Yn(Lt)==="object"){if(Lt&&!isNaN(Lt.a)&&Lt.a===0)return Pe=["1.","1.","1.",pi[1]].join(" ");if(typeof ct=="string")Pe=[ct,_t,xt,pi[1]].join(" ");else switch(ne.precision){case 2:Pe=[nt(ct/255),nt(_t/255),nt(xt/255),pi[1]].join(" ");break;default:case 3:Pe=[ke(ct/255),ke(_t/255),ke(xt/255),pi[1]].join(" ")}}else if(typeof ct=="string")Pe=[ct,_t,xt,Lt,pi[2]].join(" ");else switch(ne.precision){case 2:Pe=[nt(ct),nt(_t),nt(xt),nt(Lt),pi[2]].join(" ");break;case 3:default:Pe=[ke(ct),ke(_t),ke(xt),ke(Lt),pi[2]].join(" ")}return Pe},Hi=U.__private__.getFilters=function(){return l},Ci=U.__private__.putStream=function(ne){var Pe=(ne=ne||{}).data||"",ct=ne.filters||Hi(),_t=ne.alreadyAppliedFilters||[],xt=ne.addLength1||!1,Lt=Pe.length,pi=ne.objectId,si=function(Fr){return Fr};if(T!==null&&pi===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");T!==null&&(si=_n.encryptor(pi,0));var nr={};ct===!0&&(ct=["FlateEncode"]);var qi=ne.additionalKeyValues||[],Yi=(nr=Hr.API.processDataByFilters!==void 0?Hr.API.processDataByFilters(Pe,ct):{data:Pe,reverseChain:[]}).reverseChain+(Array.isArray(_t)?_t.join(" "):_t.toString());if(nr.data.length!==0&&(qi.push({key:"Length",value:nr.data.length}),xt===!0&&qi.push({key:"Length1",value:Lt})),Yi.length!=0)if(Yi.split("/").length-1==1)qi.push({key:"Filter",value:Yi});else{qi.push({key:"Filter",value:"["+Yi+"]"});for(var cr=0;cr<qi.length;cr+=1)if(qi[cr].key==="DecodeParms"){for(var jn=[],or=0;or<nr.reverseChain.split("/").length-1;or+=1)jn.push("null");jn.push(qi[cr].value),qi[cr].value="["+jn.join(" ")+"]"}}lt("<<");for(var Pn=0;Pn<qi.length;Pn++)lt("/"+qi[Pn].key+" "+qi[Pn].value);lt(">>"),nr.data.length!==0&&(lt("stream"),lt(si(nr.data)),lt("endstream"))},Ni=U.__private__.putPage=function(ne){var Pe=ne.number,ct=ne.data,_t=ne.objId,xt=ne.contentsObjId;Tt(_t,!0),lt("<</Type /Page"),lt("/Parent "+ne.rootDictionaryObjId+" 0 R"),lt("/Resources "+ne.resourceDictionaryObjId+" 0 R"),lt("/MediaBox ["+parseFloat(We(ne.mediaBox.bottomLeftX))+" "+parseFloat(We(ne.mediaBox.bottomLeftY))+" "+We(ne.mediaBox.topRightX)+" "+We(ne.mediaBox.topRightY)+"]"),ne.cropBox!==null&&lt("/CropBox ["+We(ne.cropBox.bottomLeftX)+" "+We(ne.cropBox.bottomLeftY)+" "+We(ne.cropBox.topRightX)+" "+We(ne.cropBox.topRightY)+"]"),ne.bleedBox!==null&&lt("/BleedBox ["+We(ne.bleedBox.bottomLeftX)+" "+We(ne.bleedBox.bottomLeftY)+" "+We(ne.bleedBox.topRightX)+" "+We(ne.bleedBox.topRightY)+"]"),ne.trimBox!==null&&lt("/TrimBox ["+We(ne.trimBox.bottomLeftX)+" "+We(ne.trimBox.bottomLeftY)+" "+We(ne.trimBox.topRightX)+" "+We(ne.trimBox.topRightY)+"]"),ne.artBox!==null&&lt("/ArtBox ["+We(ne.artBox.bottomLeftX)+" "+We(ne.artBox.bottomLeftY)+" "+We(ne.artBox.topRightX)+" "+We(ne.artBox.topRightY)+"]"),typeof ne.userUnit=="number"&&ne.userUnit!==1&&lt("/UserUnit "+ne.userUnit),ie.publish("putPage",{objId:_t,pageContext:ce[Pe],pageNumber:Pe,page:ct}),lt("/Contents "+xt+" 0 R"),lt(">>"),lt("endobj");var Lt=ct.join(`
`);return be===pe.ADVANCED&&(Lt+=`
Q`),Tt(xt,!0),Ci({data:Lt,filters:Hi(),objectId:xt}),lt("endobj"),_t},ot=U.__private__.putPages=function(){var ne,Pe,ct=[];for(ne=1;ne<=Be;ne++)ce[ne].objId=vt(),ce[ne].contentsObjId=vt();for(ne=1;ne<=Be;ne++)ct.push(Ni({number:ne,data:ni[ne],objId:ce[ne].objId,contentsObjId:ce[ne].contentsObjId,mediaBox:ce[ne].mediaBox,cropBox:ce[ne].cropBox,bleedBox:ce[ne].bleedBox,trimBox:ce[ne].trimBox,artBox:ce[ne].artBox,userUnit:ce[ne].userUnit,rootDictionaryObjId:ii,resourceDictionaryObjId:Gt}));Tt(ii,!0),lt("<</Type /Pages");var _t="/Kids [";for(Pe=0;Pe<Be;Pe++)_t+=ct[Pe]+" 0 R ";lt(_t+"]"),lt("/Count "+Be),lt(">>"),lt("endobj"),ie.publish("postPutPages")},ri=function(ne){ie.publish("putFont",{font:ne,out:lt,newObject:st,putStream:Ci}),ne.isAlreadyPutted!==!0&&(ne.objectNumber=st(),lt("<<"),lt("/Type /Font"),lt("/BaseFont /"+wg(ne.postScriptName)),lt("/Subtype /Type1"),typeof ne.encoding=="string"&&lt("/Encoding /"+ne.encoding),lt("/FirstChar 32"),lt("/LastChar 255"),lt(">>"),lt("endobj"))},Vt=function(){for(var ne in Si)Si.hasOwnProperty(ne)&&(F===!1||F===!0&&R.hasOwnProperty(ne))&&ri(Si[ne])},Vi=function(ne){ne.objectNumber=st();var Pe=[];Pe.push({key:"Type",value:"/XObject"}),Pe.push({key:"Subtype",value:"/Form"}),Pe.push({key:"BBox",value:"["+[We(ne.x),We(ne.y),We(ne.x+ne.width),We(ne.y+ne.height)].join(" ")+"]"}),Pe.push({key:"Matrix",value:"["+ne.matrix.toString()+"]"});var ct=ne.pages[1].join(`
`);Ci({data:ct,additionalKeyValues:Pe,objectId:ne.objectNumber}),lt("endobj")},lr=function(){for(var ne in ge)ge.hasOwnProperty(ne)&&Vi(ge[ne])},un=function(ne,Pe){var ct,_t=[],xt=1/(Pe-1);for(ct=0;ct<1;ct+=xt)_t.push(ct);if(_t.push(1),ne[0].offset!=0){var Lt={offset:0,color:ne[0].color};ne.unshift(Lt)}if(ne[ne.length-1].offset!=1){var pi={offset:1,color:ne[ne.length-1].color};ne.push(pi)}for(var si="",nr=0,qi=0;qi<_t.length;qi++){for(ct=_t[qi];ct>ne[nr+1].offset;)nr++;var Yi=ne[nr].offset,cr=(ct-Yi)/(ne[nr+1].offset-Yi),jn=ne[nr].color,or=ne[nr+1].color;si+=pt(Math.round((1-cr)*jn[0]+cr*or[0]).toString(16))+pt(Math.round((1-cr)*jn[1]+cr*or[1]).toString(16))+pt(Math.round((1-cr)*jn[2]+cr*or[2]).toString(16))}return si.trim()},wn=function(ne,Pe){Pe||(Pe=21);var ct=st(),_t=un(ne.colors,Pe),xt=[];xt.push({key:"FunctionType",value:"0"}),xt.push({key:"Domain",value:"[0.0 1.0]"}),xt.push({key:"Size",value:"["+Pe+"]"}),xt.push({key:"BitsPerSample",value:"8"}),xt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),xt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ci({data:_t,additionalKeyValues:xt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:ct}),lt("endobj"),ne.objectNumber=st(),lt("<< /ShadingType "+ne.type),lt("/ColorSpace /DeviceRGB");var Lt="/Coords ["+We(parseFloat(ne.coords[0]))+" "+We(parseFloat(ne.coords[1]))+" ";ne.type===2?Lt+=We(parseFloat(ne.coords[2]))+" "+We(parseFloat(ne.coords[3])):Lt+=We(parseFloat(ne.coords[2]))+" "+We(parseFloat(ne.coords[3]))+" "+We(parseFloat(ne.coords[4]))+" "+We(parseFloat(ne.coords[5])),lt(Lt+="]"),ne.matrix&&lt("/Matrix ["+ne.matrix.toString()+"]"),lt("/Function "+ct+" 0 R"),lt("/Extend [true true]"),lt(">>"),lt("endobj")},gr=function(ne,Pe){var ct=vt(),_t=st();Pe.push({resourcesOid:ct,objectOid:_t}),ne.objectNumber=_t;var xt=[];xt.push({key:"Type",value:"/Pattern"}),xt.push({key:"PatternType",value:"1"}),xt.push({key:"PaintType",value:"1"}),xt.push({key:"TilingType",value:"1"}),xt.push({key:"BBox",value:"["+ne.boundingBox.map(We).join(" ")+"]"}),xt.push({key:"XStep",value:We(ne.xStep)}),xt.push({key:"YStep",value:We(ne.yStep)}),xt.push({key:"Resources",value:ct+" 0 R"}),ne.matrix&&xt.push({key:"Matrix",value:"["+ne.matrix.toString()+"]"}),Ci({data:ne.stream,additionalKeyValues:xt,objectId:ne.objectNumber}),lt("endobj")},mn=function(ne){var Pe;for(Pe in bi)bi.hasOwnProperty(Pe)&&(bi[Pe]instanceof Lf?wn(bi[Pe]):bi[Pe]instanceof Bg&&gr(bi[Pe],ne))},yn=function(ne){for(var Pe in ne.objectNumber=st(),lt("<<"),ne)switch(Pe){case"opacity":lt("/ca "+nt(ne[Pe]));break;case"stroke-opacity":lt("/CA "+nt(ne[Pe]))}lt(">>"),lt("endobj")},dr=function(){var ne;for(ne in _r)_r.hasOwnProperty(ne)&&yn(_r[ne])},Hn=function(){for(var ne in lt("/XObject <<"),ge)ge.hasOwnProperty(ne)&&ge[ne].objectNumber>=0&&lt("/"+ne+" "+ge[ne].objectNumber+" 0 R");ie.publish("putXobjectDict"),lt(">>")},Gs=function(){_n.oid=st(),lt("<<"),lt("/Filter /Standard"),lt("/V "+_n.v),lt("/R "+_n.r),lt("/U <"+_n.toHexString(_n.U)+">"),lt("/O <"+_n.toHexString(_n.O)+">"),lt("/P "+_n.P),lt(">>"),lt("endobj")},Or=function(){for(var ne in lt("/Font <<"),Si)Si.hasOwnProperty(ne)&&(F===!1||F===!0&&R.hasOwnProperty(ne))&&lt("/"+ne+" "+Si[ne].objectNumber+" 0 R");lt(">>")},Bn=function(){if(Object.keys(bi).length>0){for(var ne in lt("/Shading <<"),bi)bi.hasOwnProperty(ne)&&bi[ne]instanceof Lf&&bi[ne].objectNumber>=0&&lt("/"+ne+" "+bi[ne].objectNumber+" 0 R");ie.publish("putShadingPatternDict"),lt(">>")}},qa=function(ne){if(Object.keys(bi).length>0){for(var Pe in lt("/Pattern <<"),bi)bi.hasOwnProperty(Pe)&&bi[Pe]instanceof U.TilingPattern&&bi[Pe].objectNumber>=0&&bi[Pe].objectNumber<ne&&lt("/"+Pe+" "+bi[Pe].objectNumber+" 0 R");ie.publish("putTilingPatternDict"),lt(">>")}},Un=function(){if(Object.keys(_r).length>0){var ne;for(ne in lt("/ExtGState <<"),_r)_r.hasOwnProperty(ne)&&_r[ne].objectNumber>=0&&lt("/"+ne+" "+_r[ne].objectNumber+" 0 R");ie.publish("putGStateDict"),lt(">>")}},Zi=function(ne){Tt(ne.resourcesOid,!0),lt("<<"),lt("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Or(),Bn(),qa(ne.objectOid),Un(),Hn(),lt(">>"),lt("endobj")},ao=function(){var ne=[];Vt(),dr(),lr(),mn(ne),ie.publish("putResources"),ne.forEach(Zi),Zi({resourcesOid:Gt,objectOid:Number.MAX_SAFE_INTEGER}),ie.publish("postPutResources")},Ms=function(){ie.publish("putAdditionalObjects");for(var ne=0;ne<qt.length;ne++){var Pe=qt[ne];Tt(Pe.objId,!0),lt(Pe.content),lt("endobj")}ie.publish("postPutAdditionalObjects")},vr=function(ne){Ii[ne.fontName]=Ii[ne.fontName]||{},Ii[ne.fontName][ne.fontStyle]=ne.id},Tr=function(ne,Pe,ct,_t,xt){var Lt={id:"F"+(Object.keys(Si).length+1).toString(10),postScriptName:ne,fontName:Pe,fontStyle:ct,encoding:_t,isStandardFont:xt||!1,metadata:{}};return ie.publish("addFont",{font:Lt,instance:this}),Si[Lt.id]=Lt,vr(Lt),Lt.id},rs=function(ne){for(var Pe=0,ct=ti.length;Pe<ct;Pe++){var _t=Tr.call(this,ne[Pe][0],ne[Pe][1],ne[Pe][2],ti[Pe][3],!0);F===!1&&(R[_t]=!0);var xt=ne[Pe][0].split("-");vr({id:_t,fontName:xt[0],fontStyle:xt[1]||""})}ie.publish("addFonts",{fonts:Si,dictionary:Ii})},Gr=function(ne){return ne.foo=function(){try{return ne.apply(this,arguments)}catch(_t){var Pe=_t.stack||"";~Pe.indexOf(" at ")&&(Pe=Pe.split(" at ")[1]);var ct="Error in function "+Pe.split(`
`)[0].split("<")[0]+": "+_t.message;if(!Vr.console)throw new Error(ct);Vr.console.error(ct,_t),Vr.alert&&alert(ct)}},ne.foo.bar=ne,ne.foo},Tn=function(ne,Pe){var ct,_t,xt,Lt,pi,si,nr,qi,Yi;if(xt=(Pe=Pe||{}).sourceEncoding||"Unicode",pi=Pe.outputEncoding,(Pe.autoencode||pi)&&Si[Wi].metadata&&Si[Wi].metadata[xt]&&Si[Wi].metadata[xt].encoding&&(Lt=Si[Wi].metadata[xt].encoding,!pi&&Si[Wi].encoding&&(pi=Si[Wi].encoding),!pi&&Lt.codePages&&(pi=Lt.codePages[0]),typeof pi=="string"&&(pi=Lt[pi]),pi)){for(nr=!1,si=[],ct=0,_t=ne.length;ct<_t;ct++)(qi=pi[ne.charCodeAt(ct)])?si.push(String.fromCharCode(qi)):si.push(ne[ct]),si[ct].charCodeAt(0)>>8&&(nr=!0);ne=si.join("")}for(ct=ne.length;nr===void 0&&ct!==0;)ne.charCodeAt(ct-1)>>8&&(nr=!0),ct--;if(!nr)return ne;for(si=Pe.noBOM?[]:[254,255],ct=0,_t=ne.length;ct<_t;ct++){if((Yi=(qi=ne.charCodeAt(ct))>>8)>>8)throw new Error("Character at position "+ct+" of string '"+ne+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");si.push(Yi),si.push(qi-(Yi<<8))}return String.fromCharCode.apply(void 0,si)},Cn=U.__private__.pdfEscape=U.pdfEscape=function(ne,Pe){return Tn(ne,Pe).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},po=U.__private__.beginPage=function(ne){ni[++Be]=[],ce[Be]={objId:0,contentsObjId:0,userUnit:Number(s),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(ne[0]),topRightY:Number(ne[1])}},Zs(Be),kt(ni[Xe])},Lr=function(ne,Pe){var ct,_t,xt;switch(t=Pe||t,typeof ne=="string"&&(ct=he(ne.toLowerCase()),Array.isArray(ct)&&(_t=ct[0],xt=ct[1])),Array.isArray(ne)&&(_t=ne[0]*hi,xt=ne[1]*hi),isNaN(_t)&&(_t=n[0],xt=n[1]),(_t>14400||xt>14400)&&(Ls.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),_t=Math.min(14400,_t),xt=Math.min(14400,xt)),n=[_t,xt],t.substr(0,1)){case"l":xt>_t&&(n=[xt,_t]);break;case"p":_t>xt&&(n=[xt,_t])}po(n),ha(En),lt(mo),hu!==0&&lt(hu+" J"),Au!==0&&lt(Au+" j"),ie.publish("addPage",{pageNumber:Be})},$a=function(ne){ne>0&&ne<=Be&&(ni.splice(ne,1),ce.splice(ne,1),Be--,Xe>Be&&(Xe=Be),this.setPage(Xe))},Zs=function(ne){ne>0&&ne<=Be&&(Xe=ne)},Ka=U.__private__.getNumberOfPages=U.getNumberOfPages=function(){return ni.length-1},He=function(ne,Pe,ct){var _t,xt=void 0;return ct=ct||{},ne=ne!==void 0?ne:Si[Wi].fontName,Pe=Pe!==void 0?Pe:Si[Wi].fontStyle,_t=ne.toLowerCase(),Ii[_t]!==void 0&&Ii[_t][Pe]!==void 0?xt=Ii[_t][Pe]:Ii[ne]!==void 0&&Ii[ne][Pe]!==void 0?xt=Ii[ne][Pe]:ct.disableWarning===!1&&Ls.warn("Unable to look up font label for font '"+ne+"', '"+Pe+"'. Refer to getFontList() for available fonts."),xt||ct.noFallback||(xt=Ii.times[Pe])==null&&(xt=Ii.times.normal),xt},Je=U.__private__.putInfo=function(){var ne=st(),Pe=function(_t){return _t};for(var ct in T!==null&&(Pe=_n.encryptor(ne,0)),lt("<<"),lt("/Producer ("+Cn(Pe("jsPDF "+Hr.version))+")"),zt)zt.hasOwnProperty(ct)&&zt[ct]&&lt("/"+ct.substr(0,1).toUpperCase()+ct.substr(1)+" ("+Cn(Pe(zt[ct]))+")");lt("/CreationDate ("+Cn(Pe(Ct))+")"),lt(">>"),lt("endobj")},gt=U.__private__.putCatalog=function(ne){var Pe=(ne=ne||{}).rootDictionaryObjId||ii;switch(st(),lt("<<"),lt("/Type /Catalog"),lt("/Pages "+Pe+" 0 R"),$t||($t="fullwidth"),$t){case"fullwidth":lt("/OpenAction [3 0 R /FitH null]");break;case"fullheight":lt("/OpenAction [3 0 R /FitV null]");break;case"fullpage":lt("/OpenAction [3 0 R /Fit]");break;case"original":lt("/OpenAction [3 0 R /XYZ null null 1]");break;default:var ct=""+$t;ct.substr(ct.length-1)==="%"&&($t=parseInt($t)/100),typeof $t=="number"&&lt("/OpenAction [3 0 R /XYZ null null "+nt($t)+"]")}switch(tr||(tr="continuous"),tr){case"continuous":lt("/PageLayout /OneColumn");break;case"single":lt("/PageLayout /SinglePage");break;case"two":case"twoleft":lt("/PageLayout /TwoColumnLeft");break;case"tworight":lt("/PageLayout /TwoColumnRight")}ci&&lt("/PageMode /"+ci),ie.publish("putCatalog"),lt(">>"),lt("endobj")},Ot=U.__private__.putTrailer=function(){lt("trailer"),lt("<<"),lt("/Size "+(mt+1)),lt("/Root "+mt+" 0 R"),lt("/Info "+(mt-1)+" 0 R"),T!==null&&lt("/Encrypt "+_n.oid+" 0 R"),lt("/ID [ <"+Et+"> <"+Et+"> ]"),lt(">>")},di=U.__private__.putHeader=function(){lt("%PDF-"+J),lt("%ºß¬à")},ji=U.__private__.putXRef=function(){var ne="0000000000";lt("xref"),lt("0 "+(mt+1)),lt("0000000000 65535 f ");for(var Pe=1;Pe<=mt;Pe++)typeof Bt[Pe]=="function"?lt((ne+Bt[Pe]()).slice(-10)+" 00000 n "):Bt[Pe]!==void 0?lt((ne+Bt[Pe]).slice(-10)+" 00000 n "):lt("0000000000 00000 n ")},Br=U.__private__.buildDocument=function(){Pi(),kt(Dt),ie.publish("buildDocument"),di(),ot(),Ms(),ao(),T!==null&&Gs(),Je(),gt();var ne=Mt;return ji(),Ot(),lt("startxref"),lt(""+ne),lt("%%EOF"),kt(ni[Xe]),Dt.join(`
`)},In=U.__private__.getBlob=function(ne){return new Blob([Oi(ne)],{type:"application/pdf"})},Gn=U.output=U.__private__.output=Gr(function(ne,Pe){switch(typeof(Pe=Pe||{})=="string"?Pe={filename:Pe}:Pe.filename=Pe.filename||"generated.pdf",ne){case void 0:return Br();case"save":U.save(Pe.filename);break;case"arraybuffer":return Oi(Br());case"blob":return In(Br());case"bloburi":case"bloburl":if(Vr.URL!==void 0&&typeof Vr.URL.createObjectURL=="function")return Vr.URL&&Vr.URL.createObjectURL(In(Br()))||void 0;Ls.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var ct="",_t=Br();try{ct=CC(_t)}catch{ct=CC(unescape(encodeURIComponent(_t)))}return"data:application/pdf;filename="+Pe.filename+";base64,"+ct;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Vr)==="[object Window]"){var xt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Lt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Pe.pdfObjectUrl&&(xt=Pe.pdfObjectUrl,Lt="");var pi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+xt+'"'+Lt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Pe)+");<\/script></body></html>",si=Vr.open();return si!==null&&si.document.write(pi),si}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Vr)==="[object Window]"){var nr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Pe.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Pe.filename+'" width="500px" height="400px" /></body></html>',qi=Vr.open();if(qi!==null){qi.document.write(nr);var Yi=this;qi.document.documentElement.querySelector("#pdfViewer").onload=function(){qi.document.title=Pe.filename,qi.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Yi.output("bloburl"))}}return qi}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Vr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var cr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Pe)+'"></iframe></body></html>',jn=Vr.open();if(jn!==null&&(jn.document.write(cr),jn.document.title=Pe.filename),jn||typeof safari>"u")return jn;break;case"datauri":case"dataurl":return Vr.document.location.href=this.output("datauristring",Pe);default:return null}}),ns=function(ne){return Array.isArray(ue)===!0&&ue.indexOf(ne)>-1};switch(r){case"pt":hi=1;break;case"mm":hi=72/25.4;break;case"cm":hi=72/2.54;break;case"in":hi=72;break;case"px":hi=ns("px_scaling")==1?.75:96/72;break;case"pc":case"em":hi=12;break;case"ex":hi=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);hi=r}var _n=null;Xt(),bt();var uu=function(ne){return T!==null?_n.encryptor(ne,0):function(Pe){return Pe}},Nl=U.__private__.getPageInfo=U.getPageInfo=function(ne){if(isNaN(ne)||ne%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ce[ne].objId,pageNumber:ne,pageContext:ce[ne]}},Cr=U.__private__.getPageInfoByObjId=function(ne){if(isNaN(ne)||ne%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Pe in ce)if(ce[Pe].objId===ne)break;return Nl(Pe)},Wa=U.__private__.getCurrentPageInfo=U.getCurrentPageInfo=function(){return{objId:ce[Xe].objId,pageNumber:Xe,pageContext:ce[Xe]}};U.addPage=function(){return Lr.apply(this,arguments),this},U.setPage=function(){return Zs.apply(this,arguments),kt.call(this,ni[Xe]),this},U.insertPage=function(ne){return this.addPage(),this.movePage(Xe,ne),this},U.movePage=function(ne,Pe){var ct,_t;if(ne>Pe){ct=ni[ne],_t=ce[ne];for(var xt=ne;xt>Pe;xt--)ni[xt]=ni[xt-1],ce[xt]=ce[xt-1];ni[Pe]=ct,ce[Pe]=_t,this.setPage(Pe)}else if(ne<Pe){ct=ni[ne],_t=ce[ne];for(var Lt=ne;Lt<Pe;Lt++)ni[Lt]=ni[Lt+1],ce[Lt]=ce[Lt+1];ni[Pe]=ct,ce[Pe]=_t,this.setPage(Pe)}return this},U.deletePage=function(){return $a.apply(this,arguments),this},U.__private__.text=U.text=function(ne,Pe,ct,_t,xt){var Lt,pi,si,nr,qi,Yi,cr,jn,or,Pn=(_t=_t||{}).scope||this;if(typeof ne=="number"&&typeof Pe=="number"&&(typeof ct=="string"||Array.isArray(ct))){var Fr=ct;ct=Pe,Pe=ne,ne=Fr}if(arguments[3]instanceof we?(Ne("The transform parameter of text() with a Matrix value"),or=xt):(si=arguments[4],nr=arguments[5],Yn(cr=arguments[3])==="object"&&cr!==null||(typeof si=="string"&&(nr=si,si=null),typeof cr=="string"&&(nr=cr,cr=null),typeof cr=="number"&&(si=cr,cr=null),_t={flags:cr,angle:si,align:nr})),isNaN(Pe)||isNaN(ct)||ne==null)throw new Error("Invalid arguments passed to jsPDF.text");if(ne.length===0)return Pn;var Ir="",Ps=!1,Xs=typeof _t.lineHeightFactor=="number"?_t.lineHeightFactor:us,Lo=Pn.internal.scaleFactor;function Ta(Ur){return Ur=Ur.split("	").join(Array(_t.TabLen||9).join(" ")),Cn(Ur,cr)}function fa(Ur){for(var en,nn=Ur.concat(),Nn=[],ma=nn.length;ma--;)typeof(en=nn.shift())=="string"?Nn.push(en):Array.isArray(Ur)&&(en.length===1||en[1]===void 0&&en[2]===void 0)?Nn.push(en[0]):Nn.push([en[0],en[1],en[2]]);return Nn}function _c(Ur,en){var nn;if(typeof Ur=="string")nn=en(Ur)[0];else if(Array.isArray(Ur)){for(var Nn,ma,Fa=Ur.concat(),Jo=[],Yo=Fa.length;Yo--;)typeof(Nn=Fa.shift())=="string"?Jo.push(en(Nn)[0]):Array.isArray(Nn)&&typeof Nn[0]=="string"&&(ma=en(Nn[0],Nn[1],Nn[2]),Jo.push([ma[0],ma[1],ma[2]]));nn=Jo}return nn}var hl=!1,ql=!0;if(typeof ne=="string")hl=!0;else if(Array.isArray(ne)){var vc=ne.concat();pi=[];for(var Ia,ms=vc.length;ms--;)(typeof(Ia=vc.shift())!="string"||Array.isArray(Ia)&&typeof Ia[0]!="string")&&(ql=!1);hl=ql}if(hl===!1)throw new Error('Type of text must be string or Array. "'+ne+'" is not recognized.');typeof ne=="string"&&(ne=ne.match(/[\r?\n]/)?ne.split(/\r\n|\r|\n/g):[ne]);var Al=ht/Pn.internal.scaleFactor,$l=Al*(Xs-1);switch(_t.baseline){case"bottom":ct-=$l;break;case"top":ct+=Al-$l;break;case"hanging":ct+=Al-2*$l;break;case"middle":ct+=Al/2-$l}if((Yi=_t.maxWidth||0)>0&&(typeof ne=="string"?ne=Pn.splitTextToSize(ne,Yi):Object.prototype.toString.call(ne)==="[object Array]"&&(ne=ne.reduce(function(Ur,en){return Ur.concat(Pn.splitTextToSize(en,Yi))},[]))),Lt={text:ne,x:Pe,y:ct,options:_t,mutex:{pdfEscape:Cn,activeFontKey:Wi,fonts:Si,activeFontSize:ht}},ie.publish("preProcessText",Lt),ne=Lt.text,si=(_t=Lt.options).angle,!(or instanceof we)&&si&&typeof si=="number"){si*=Math.PI/180,_t.rotationDirection===0&&(si=-si),be===pe.ADVANCED&&(si=-si);var La=Math.cos(si),Ma=Math.sin(si);or=new we(La,Ma,-Ma,La,0,0)}else si&&si instanceof we&&(or=si);be!==pe.ADVANCED||or||(or=ze),(qi=_t.charSpace||Nc)!==void 0&&(Ir+=We(De(qi))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(jn=_t.horizontalScale)!==void 0&&(Ir+=We(100*jn)+` Tz
`),_t.lang;var Fs=-1,Uu=_t.renderingMode!==void 0?_t.renderingMode:_t.stroke,Ln=Pn.internal.getCurrentPageInfo().pageContext;switch(Uu){case 0:case!1:case"fill":Fs=0;break;case 1:case!0:case"stroke":Fs=1;break;case 2:case"fillThenStroke":Fs=2;break;case 3:case"invisible":Fs=3;break;case 4:case"fillAndAddForClipping":Fs=4;break;case 5:case"strokeAndAddPathForClipping":Fs=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Fs=6;break;case 7:case"addToPathForClipping":Fs=7}var fn=Ln.usedRenderingMode!==void 0?Ln.usedRenderingMode:-1;Fs!==-1?Ir+=Fs+` Tr
`:fn!==-1&&(Ir+=`0 Tr
`),Fs!==-1&&(Ln.usedRenderingMode=Fs),nr=_t.align||"left";var pn,As=ht*Xs,pa=Pn.internal.pageSize.getWidth(),Kl=Si[Wi];qi=_t.charSpace||Nc,Yi=_t.maxWidth||0,cr=Object.assign({autoencode:!0,noBOM:!0},_t.flags);var co=[];if(Object.prototype.toString.call(ne)==="[object Array]"){var ys;pi=fa(ne),nr!=="left"&&(pn=pi.map(function(Ur){return Pn.getStringUnitWidth(Ur,{font:Kl,charSpace:qi,fontSize:ht,doKerning:!1})*ht/Lo}));var ds,Mo=0;if(nr==="right"){Pe-=pn[0],ne=[],ms=pi.length;for(var yo=0;yo<ms;yo++)yo===0?(ds=Io(Pe),ys=Ko(ct)):(ds=De(Mo-pn[yo]),ys=-As),ne.push([pi[yo],ds,ys]),Mo=pn[yo]}else if(nr==="center"){Pe-=pn[0]/2,ne=[],ms=pi.length;for(var ga=0;ga<ms;ga++)ga===0?(ds=Io(Pe),ys=Ko(ct)):(ds=De((Mo-pn[ga])/2),ys=-As),ne.push([pi[ga],ds,ys]),Mo=pn[ga]}else if(nr==="left"){ne=[],ms=pi.length;for(var tl=0;tl<ms;tl++)ne.push(pi[tl])}else{if(nr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');ne=[],ms=pi.length,Yi=Yi!==0?Yi:pa;for(var Po=0;Po<ms;Po++)ys=Po===0?Ko(ct):-As,ds=Po===0?Io(Pe):0,Po<ms-1?co.push(We(De((Yi-pn[Po])/(pi[Po].split(" ").length-1)))):co.push(0),ne.push([pi[Po],ds,ys])}}var Js=typeof _t.R2L=="boolean"?_t.R2L:gi;Js===!0&&(ne=_c(ne,function(Ur,en,nn){return[Ur.split("").reverse().join(""),en,nn]})),Lt={text:ne,x:Pe,y:ct,options:_t,mutex:{pdfEscape:Cn,activeFontKey:Wi,fonts:Si,activeFontSize:ht}},ie.publish("postProcessText",Lt),ne=Lt.text,Ps=Lt.mutex.isHex||!1;var js=Si[Wi].encoding;js!=="WinAnsiEncoding"&&js!=="StandardEncoding"||(ne=_c(ne,function(Ur,en,nn){return[Ta(Ur),en,nn]})),pi=fa(ne),ne=[];for(var _s,uo,Pa,dl=0,Wl=1,Ds=Array.isArray(pi[0])?Wl:dl,Xo="",ln=function(Ur,en,nn){var Nn="";return nn instanceof we?(nn=typeof _t.angle=="number"?Fe(nn,new we(1,0,0,1,Ur,en)):Fe(new we(1,0,0,1,Ur,en),nn),be===pe.ADVANCED&&(nn=Fe(new we(1,0,0,-1,0,0),nn)),Nn=nn.join(" ")+` Tm
`):Nn=We(Ur)+" "+We(en)+` Td
`,Nn},qn=0;qn<pi.length;qn++){switch(Xo="",Ds){case Wl:Pa=(Ps?"<":"(")+pi[qn][0]+(Ps?">":")"),_s=parseFloat(pi[qn][1]),uo=parseFloat(pi[qn][2]);break;case dl:Pa=(Ps?"<":"(")+pi[qn]+(Ps?">":")"),_s=Io(Pe),uo=Ko(ct)}co!==void 0&&co[qn]!==void 0&&(Xo=co[qn]+` Tw
`),qn===0?ne.push(Xo+ln(_s,uo,or)+Pa):Ds===dl?ne.push(Xo+Pa):Ds===Wl&&ne.push(Xo+ln(_s,uo,or)+Pa)}ne=Ds===dl?ne.join(` Tj
T* `):ne.join(` Tj
`),ne+=` Tj
`;var os=`BT
/`;return os+=Wi+" "+ht+` Tf
`,os+=We(ht*Xs)+` TL
`,os+=Zo+`
`,os+=Ir,os+=ne,lt(os+="ET"),R[Wi]=!0,Pn};var zl=U.__private__.clip=U.clip=function(ne){return lt(ne==="evenodd"?"W*":"W"),this};U.clipEvenOdd=function(){return zl("evenodd")},U.__private__.discardPath=U.discardPath=function(){return lt("n"),this};var ss=U.__private__.isValidStyle=function(ne){var Pe=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(ne)!==-1&&(Pe=!0),Pe};U.__private__.setDefaultPathOperation=U.setDefaultPathOperation=function(ne){return ss(ne)&&(v=ne),this};var To=U.__private__.getStyle=U.getStyle=function(ne){var Pe=v;switch(ne){case"D":case"S":Pe="S";break;case"F":Pe="f";break;case"FD":case"DF":Pe="B";break;case"f":case"f*":case"B":case"B*":Pe=ne}return Pe},Ea=U.close=function(){return lt("h"),this};U.stroke=function(){return lt("S"),this},U.fill=function(ne){return gs("f",ne),this},U.fillEvenOdd=function(ne){return gs("f*",ne),this},U.fillStroke=function(ne){return gs("B",ne),this},U.fillStrokeEvenOdd=function(ne){return gs("B*",ne),this};var gs=function(ne,Pe){Yn(Pe)==="object"?ca(Pe,ne):lt(ne)},Sa=function(ne){ne===null||be===pe.ADVANCED&&ne===void 0||(ne=To(ne),lt(ne))};function Za(ne,Pe,ct,_t,xt){var Lt=new Bg(Pe||this.boundingBox,ct||this.xStep,_t||this.yStep,this.gState,xt||this.matrix);Lt.stream=this.stream;var pi=ne+"$$"+this.cloneIndex+++"$$";return Ge(pi,Lt),Lt}var ca=function(ne,Pe){var ct=ei[ne.key],_t=bi[ct];if(_t instanceof Lf)lt("q"),lt(Uc(Pe)),_t.gState&&U.setGState(_t.gState),lt(ne.matrix.toString()+" cm"),lt("/"+ct+" sh"),lt("Q");else if(_t instanceof Bg){var xt=new we(1,0,0,-1,0,lo());ne.matrix&&(xt=xt.multiply(ne.matrix||ze),ct=Za.call(_t,ne.key,ne.boundingBox,ne.xStep,ne.yStep,xt).id),lt("q"),lt("/Pattern cs"),lt("/"+ct+" scn"),_t.gState&&U.setGState(_t.gState),lt(Pe),lt("Q")}},Uc=function(ne){switch(ne){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},Xa=U.moveTo=function(ne,Pe){return lt(We(De(ne))+" "+We(Ze(Pe))+" m"),this},go=U.lineTo=function(ne,Pe){return lt(We(De(ne))+" "+We(Ze(Pe))+" l"),this},Pr=U.curveTo=function(ne,Pe,ct,_t,xt,Lt){return lt([We(De(ne)),We(Ze(Pe)),We(De(ct)),We(Ze(_t)),We(De(xt)),We(Ze(Lt)),"c"].join(" ")),this};U.__private__.line=U.line=function(ne,Pe,ct,_t,xt){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||!ss(xt))throw new Error("Invalid arguments passed to jsPDF.line");return be===pe.COMPAT?this.lines([[ct-ne,_t-Pe]],ne,Pe,[1,1],xt||"S"):this.lines([[ct-ne,_t-Pe]],ne,Pe,[1,1]).stroke()},U.__private__.lines=U.lines=function(ne,Pe,ct,_t,xt,Lt){var pi,si,nr,qi,Yi,cr,jn,or,Pn,Fr,Ir,Ps;if(typeof ne=="number"&&(Ps=ct,ct=Pe,Pe=ne,ne=Ps),_t=_t||[1,1],Lt=Lt||!1,isNaN(Pe)||isNaN(ct)||!Array.isArray(ne)||!Array.isArray(_t)||!ss(xt)||typeof Lt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Xa(Pe,ct),pi=_t[0],si=_t[1],qi=ne.length,Fr=Pe,Ir=ct,nr=0;nr<qi;nr++)(Yi=ne[nr]).length===2?(Fr=Yi[0]*pi+Fr,Ir=Yi[1]*si+Ir,go(Fr,Ir)):(cr=Yi[0]*pi+Fr,jn=Yi[1]*si+Ir,or=Yi[2]*pi+Fr,Pn=Yi[3]*si+Ir,Fr=Yi[4]*pi+Fr,Ir=Yi[5]*si+Ir,Pr(cr,jn,or,Pn,Fr,Ir));return Lt&&Ea(),Sa(xt),this},U.path=function(ne){for(var Pe=0;Pe<ne.length;Pe++){var ct=ne[Pe],_t=ct.c;switch(ct.op){case"m":Xa(_t[0],_t[1]);break;case"l":go(_t[0],_t[1]);break;case"c":Pr.apply(this,_t);break;case"h":Ea()}}return this},U.__private__.rect=U.rect=function(ne,Pe,ct,_t,xt){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||!ss(xt))throw new Error("Invalid arguments passed to jsPDF.rect");return be===pe.COMPAT&&(_t=-_t),lt([We(De(ne)),We(Ze(Pe)),We(De(ct)),We(De(_t)),"re"].join(" ")),Sa(xt),this},U.__private__.triangle=U.triangle=function(ne,Pe,ct,_t,xt,Lt,pi){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||isNaN(xt)||isNaN(Lt)||!ss(pi))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[ct-ne,_t-Pe],[xt-ct,Lt-_t],[ne-xt,Pe-Lt]],ne,Pe,[1,1],pi,!0),this},U.__private__.roundedRect=U.roundedRect=function(ne,Pe,ct,_t,xt,Lt,pi){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||isNaN(xt)||isNaN(Lt)||!ss(pi))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var si=4/3*(Math.SQRT2-1);return xt=Math.min(xt,.5*ct),Lt=Math.min(Lt,.5*_t),this.lines([[ct-2*xt,0],[xt*si,0,xt,Lt-Lt*si,xt,Lt],[0,_t-2*Lt],[0,Lt*si,-xt*si,Lt,-xt,Lt],[2*xt-ct,0],[-xt*si,0,-xt,-Lt*si,-xt,-Lt],[0,2*Lt-_t],[0,-Lt*si,xt*si,-Lt,xt,-Lt]],ne+xt,Pe,[1,1],pi,!0),this},U.__private__.ellipse=U.ellipse=function(ne,Pe,ct,_t,xt){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||!ss(xt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Lt=4/3*(Math.SQRT2-1)*ct,pi=4/3*(Math.SQRT2-1)*_t;return Xa(ne+ct,Pe),Pr(ne+ct,Pe-pi,ne+Lt,Pe-_t,ne,Pe-_t),Pr(ne-Lt,Pe-_t,ne-ct,Pe-pi,ne-ct,Pe),Pr(ne-ct,Pe+pi,ne-Lt,Pe+_t,ne,Pe+_t),Pr(ne+Lt,Pe+_t,ne+ct,Pe+pi,ne+ct,Pe),Sa(xt),this},U.__private__.circle=U.circle=function(ne,Pe,ct,_t){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||!ss(_t))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(ne,Pe,ct,ct,_t)},U.setFont=function(ne,Pe,ct){return ct&&(Pe=je(Pe,ct)),Wi=He(ne,Pe,{disableWarning:!1}),this};var ua=U.__private__.getFont=U.getFont=function(){return Si[He.apply(U,arguments)]};U.__private__.getFontList=U.getFontList=function(){var ne,Pe,ct={};for(ne in Ii)if(Ii.hasOwnProperty(ne))for(Pe in ct[ne]=[],Ii[ne])Ii[ne].hasOwnProperty(Pe)&&ct[ne].push(Pe);return ct},U.addFont=function(ne,Pe,ct,_t,xt){var Lt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Lt.indexOf(arguments[3])!==-1?xt=arguments[3]:arguments[3]&&Lt.indexOf(arguments[3])==-1&&(ct=je(ct,_t)),xt=xt||"Identity-H",Tr.call(this,ne,Pe,ct,xt)};var us,En=i.lineWidth||.200025,hs=U.__private__.getLineWidth=U.getLineWidth=function(){return En},ha=U.__private__.setLineWidth=U.setLineWidth=function(ne){return En=ne,lt(We(De(ne))+" w"),this};U.__private__.setLineDash=Hr.API.setLineDash=Hr.API.setLineDashPattern=function(ne,Pe){if(ne=ne||[],Pe=Pe||0,isNaN(Pe)||!Array.isArray(ne))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return ne=ne.map(function(ct){return We(De(ct))}).join(" "),Pe=We(De(Pe)),lt("["+ne+"] "+Pe+" d"),this};var jr=U.__private__.getLineHeight=U.getLineHeight=function(){return ht*us};U.__private__.getLineHeight=U.getLineHeight=function(){return ht*us};var cl=U.__private__.setLineHeightFactor=U.setLineHeightFactor=function(ne){return typeof(ne=ne||1.15)=="number"&&(us=ne),this},Ql=U.__private__.getLineHeightFactor=U.getLineHeightFactor=function(){return us};cl(i.lineHeight);var Io=U.__private__.getHorizontalCoordinate=function(ne){return De(ne)},Ko=U.__private__.getVerticalCoordinate=function(ne){return be===pe.ADVANCED?ne:ce[Xe].mediaBox.topRightY-ce[Xe].mediaBox.bottomLeftY-De(ne)},mc=U.__private__.getHorizontalCoordinateString=U.getHorizontalCoordinateString=function(ne){return We(Io(ne))},Wo=U.__private__.getVerticalCoordinateString=U.getVerticalCoordinateString=function(ne){return We(Ko(ne))},mo=i.strokeColor||"0 G";U.__private__.getStrokeColor=U.getDrawColor=function(){return Ai(mo)},U.__private__.setStrokeColor=U.setDrawColor=function(ne,Pe,ct,_t){return mo=Bi({ch1:ne,ch2:Pe,ch3:ct,ch4:_t,pdfColorType:"draw",precision:2}),lt(mo),this};var yc=i.fillColor||"0 g";U.__private__.getFillColor=U.getFillColor=function(){return Ai(yc)},U.__private__.setFillColor=U.setFillColor=function(ne,Pe,ct,_t){return yc=Bi({ch1:ne,ch2:Pe,ch3:ct,ch4:_t,pdfColorType:"fill",precision:2}),lt(yc),this};var Zo=i.textColor||"0 g",Vl=U.__private__.getTextColor=U.getTextColor=function(){return Ai(Zo)};U.__private__.setTextColor=U.setTextColor=function(ne,Pe,ct,_t){return Zo=Bi({ch1:ne,ch2:Pe,ch3:ct,ch4:_t,pdfColorType:"text",precision:3}),this};var Nc=i.charSpace,bh=U.__private__.getCharSpace=U.getCharSpace=function(){return parseFloat(Nc||0)};U.__private__.setCharSpace=U.setCharSpace=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Nc=ne,this};var hu=0;U.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},U.__private__.setLineCap=U.setLineCap=function(ne){var Pe=U.CapJoinStyles[ne];if(Pe===void 0)throw new Error("Line cap style of '"+ne+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return hu=Pe,lt(Pe+" J"),this};var Au=0;U.__private__.setLineJoin=U.setLineJoin=function(ne){var Pe=U.CapJoinStyles[ne];if(Pe===void 0)throw new Error("Line join style of '"+ne+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Au=Pe,lt(Pe+" j"),this},U.__private__.setLineMiterLimit=U.__private__.setMiterLimit=U.setLineMiterLimit=U.setMiterLimit=function(ne){if(ne=ne||0,isNaN(ne))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return lt(We(De(ne))+" M"),this},U.GState=ev,U.setGState=function(ne){(ne=typeof ne=="string"?_r[Zr[ne]]:Ou(null,ne)).equals(Qe)||(lt("/"+ne.id+" gs"),Qe=ne)};var Ou=function(ne,Pe){if(!ne||!Zr[ne]){var ct=!1;for(var _t in _r)if(_r.hasOwnProperty(_t)&&_r[_t].equals(Pe)){ct=!0;break}if(ct)Pe=_r[_t];else{var xt="GS"+(Object.keys(_r).length+1).toString(10);_r[xt]=Pe,Pe.id=xt}return ne&&(Zr[ne]=Pe.id),ie.publish("addGState",Pe),Pe}};U.addGState=function(ne,Pe){return Ou(ne,Pe),this},U.saveGraphicsState=function(){return lt("q"),Zt.push({key:Wi,size:ht,color:Zo}),this},U.restoreGraphicsState=function(){lt("Q");var ne=Zt.pop();return Wi=ne.key,ht=ne.size,Zo=ne.color,Qe=null,this},U.setCurrentTransformationMatrix=function(ne){return lt(ne.toString()+" cm"),this},U.comment=function(ne){return lt("#"+ne),this};var Hl=function(ne,Pe){var ct=ne||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return ct},set:function(Lt){isNaN(Lt)||(ct=parseFloat(Lt))}});var _t=Pe||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return _t},set:function(Lt){isNaN(Lt)||(_t=parseFloat(Lt))}});var xt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return xt},set:function(Lt){xt=Lt.toString()}}),this},Ja=function(ne,Pe,ct,_t){Hl.call(this,ne,Pe),this.type="rect";var xt=ct||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return xt},set:function(pi){isNaN(pi)||(xt=parseFloat(pi))}});var Lt=_t||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Lt},set:function(pi){isNaN(pi)||(Lt=parseFloat(pi))}}),this},Ya=function(){this.page=Be,this.currentPage=Xe,this.pages=ni.slice(0),this.pagesContext=ce.slice(0),this.x=Wt,this.y=Ar,this.matrix=Qt,this.width=ul(Xe),this.height=lo(Xe),this.outputDestination=vi,this.id="",this.objectNumber=-1};Ya.prototype.restore=function(){Be=this.page,Xe=this.currentPage,ce=this.pagesContext,ni=this.pages,Wt=this.x,Ar=this.y,Qt=this.matrix,jl(Xe,this.width),da(Xe,this.height),vi=this.outputDestination};var Gl=function(ne,Pe,ct,_t,xt){Ee.push(new Ya),Be=Xe=0,ni=[],Wt=ne,Ar=Pe,Qt=xt,po([ct,_t])},el=function(ne){if(xe[ne])Ee.pop().restore();else{var Pe=new Ya,ct="Xo"+(Object.keys(ge).length+1).toString(10);Pe.id=ct,xe[ne]=ct,ge[ct]=Pe,ie.publish("addFormObject",Pe),Ee.pop().restore()}};for(var Aa in U.beginFormObject=function(ne,Pe,ct,_t,xt){return Gl(ne,Pe,ct,_t,xt),this},U.endFormObject=function(ne){return el(ne),this},U.doFormObject=function(ne,Pe){var ct=ge[xe[ne]];return lt("q"),lt(Pe.toString()+" cm"),lt("/"+ct.id+" Do"),lt("Q"),this},U.getFormObject=function(ne){var Pe=ge[xe[ne]];return{x:Pe.x,y:Pe.y,width:Pe.width,height:Pe.height,matrix:Pe.matrix}},U.save=function(ne,Pe){return ne=ne||"generated.pdf",(Pe=Pe||{}).returnPromise=Pe.returnPromise||!1,Pe.returnPromise===!1?(If(In(Br()),ne),typeof If.unload=="function"&&Vr.setTimeout&&setTimeout(If.unload,911),this):new Promise(function(ct,_t){try{var xt=If(In(Br()),ne);typeof If.unload=="function"&&Vr.setTimeout&&setTimeout(If.unload,911),ct(xt)}catch(Lt){_t(Lt.message)}})},Hr.API)Hr.API.hasOwnProperty(Aa)&&(Aa==="events"&&Hr.API.events.length?function(ne,Pe){var ct,_t,xt;for(xt=Pe.length-1;xt!==-1;xt--)ct=Pe[xt][0],_t=Pe[xt][1],ne.subscribe.apply(ne,[ct].concat(typeof _t=="function"?[_t]:_t))}(ie,Hr.API.events):U[Aa]=Hr.API[Aa]);var ul=U.getPageWidth=function(ne){return(ce[ne=ne||Xe].mediaBox.topRightX-ce[ne].mediaBox.bottomLeftX)/hi},jl=U.setPageWidth=function(ne,Pe){ce[ne].mediaBox.topRightX=Pe*hi+ce[ne].mediaBox.bottomLeftX},lo=U.getPageHeight=function(ne){return(ce[ne=ne||Xe].mediaBox.topRightY-ce[ne].mediaBox.bottomLeftY)/hi},da=U.setPageHeight=function(ne,Pe){ce[ne].mediaBox.topRightY=Pe*hi+ce[ne].mediaBox.bottomLeftY};return U.internal={pdfEscape:Cn,getStyle:To,getFont:ua,getFontSize:oi,getCharSpace:bh,getTextColor:Vl,getLineHeight:jr,getLineHeightFactor:Ql,getLineWidth:hs,write:wt,getHorizontalCoordinate:Io,getVerticalCoordinate:Ko,getCoordinateString:mc,getVerticalCoordinateString:Wo,collections:{},newObject:st,newAdditionalObject:Kt,newObjectDeferred:vt,newObjectDeferredBegin:Tt,getFilters:Hi,putStream:Ci,events:ie,scaleFactor:hi,pageSize:{getWidth:function(){return ul(Xe)},setWidth:function(ne){jl(Xe,ne)},getHeight:function(){return lo(Xe)},setHeight:function(ne){da(Xe,ne)}},encryptionOptions:T,encryption:_n,getEncryptor:uu,output:Gn,getNumberOfPages:Ka,pages:ni,out:lt,f2:nt,f3:ke,getPageInfo:Nl,getPageInfoByObjId:Cr,getCurrentPageInfo:Wa,getPDFVersion:te,Point:Hl,Rectangle:Ja,Matrix:we,hasHotfix:ns},Object.defineProperty(U.internal.pageSize,"width",{get:function(){return ul(Xe)},set:function(ne){jl(Xe,ne)},enumerable:!0,configurable:!0}),Object.defineProperty(U.internal.pageSize,"height",{get:function(){return lo(Xe)},set:function(ne){da(Xe,ne)},enumerable:!0,configurable:!0}),rs.call(U,ti),Wi="F1",Lr(n,t),ie.publish("initialized"),U}xg.prototype.lsbFirstWord=function(i){return String.fromCharCode(i>>0&255,i>>8&255,i>>16&255,i>>24&255)},xg.prototype.toHexString=function(i){return i.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},xg.prototype.hexToBytes=function(i){for(var e=[],t=0;t<i.length;t+=2)e.push(String.fromCharCode(parseInt(i.substr(t,2),16)));return e.join("")},xg.prototype.processOwnerPassword=function(i,e){return TC(SC(e).substr(0,5),i)},xg.prototype.encryptor=function(i,e){var t=SC(this.encryptionKey+String.fromCharCode(255&i,i>>8&255,i>>16&255,255&e,e>>8&255)).substr(0,10);return function(r){return TC(t,r)}},ev.prototype.equals=function(i){var e,t="id,objectNumber,equals";if(!i||Yn(i)!==Yn(this))return!1;var r=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!i.hasOwnProperty(e)||this[e]!==i[e])return!1;r++}for(e in i)i.hasOwnProperty(e)&&t.indexOf(e)<0&&r--;return r===0},Hr.API={events:[]},Hr.version="2.5.1";var Co=Hr.API,IC=1,Mf=function(i){return i.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Cg=function(i){return i.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Xr=function(i){return i.toFixed(2)},_d=function(i){return i.toFixed(5)};Co.__acroform__={};var Dc=function(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i},I4=function(i){return i*IC},$h=function(i){var e=new M4,t=fr.internal.getHeight(i)||0,r=fr.internal.getWidth(i)||0;return e.BBox=[0,0,Number(Xr(r)),Number(Xr(t))],e},Zie=Co.__acroform__.setBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return i|=1<<e},Xie=Co.__acroform__.clearBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return i&=~(1<<e)},Jie=Co.__acroform__.getBit=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return i&1<<e?1:0},Qo=Co.__acroform__.getBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Jie(i,e-1)},Vo=Co.__acroform__.setBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Zie(i,e-1)},Ho=Co.__acroform__.clearBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Xie(i,e-1)},Yie=Co.__acroform__.calculateCoordinates=function(i,e){var t=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,n=i[0],o=i[1],l=i[2],s=i[3],g={};return g.lowerLeft_X=t(n)||0,g.lowerLeft_Y=r(o+s)||0,g.upperRight_X=t(n+l)||0,g.upperRight_Y=r(o)||0,[Number(Xr(g.lowerLeft_X)),Number(Xr(g.lowerLeft_Y)),Number(Xr(g.upperRight_X)),Number(Xr(g.upperRight_Y))]},ere=function(i){if(i.appearanceStreamContent)return i.appearanceStreamContent;if(i.V||i.DV){var e=[],t=i._V||i.DV,r=LC(i,t),n=i.scope.internal.getFont(i.fontName,i.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(i.scope.__private__.encodeColorString(i.color)),e.push("/"+n+" "+Xr(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var o=$h(i);return o.scope=i.scope,o.stream=e.join(`
`),o}},LC=function(i,e){var t=i.fontSize===0?i.maxFontSize:i.fontSize,r={text:"",fontSize:""},n=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");n=i.multiline?n.map(function(ke){return ke.split(`
`)}):n.map(function(ke){return[ke]});var o=t,l=fr.internal.getHeight(i)||0;l=l<0?-l:l;var s=fr.internal.getWidth(i)||0;s=s<0?-s:s;var g=function(ke,De,Ye){if(ke+1<n.length){var Ze=De+" "+n[ke+1][0];return tv(Ze,i,Ye).width<=s-4}return!1};o++;e:for(;o>0;){e="",o--;var v,T,F=tv("3",i,o).height,R=i.multiline?l-o:(l-F)/2,U=R+=2,J=0,te=0,Ae=0;if(o<=0){e=`(...) Tj
`,e+="% Width of Text: "+tv(e,i,o=12).width+", FieldWidth:"+s+`
`;break}for(var he="",pe=0,be=0;be<n.length;be++)if(n.hasOwnProperty(be)){var Te=!1;if(n[be].length!==1&&Ae!==n[be].length-1){if((F+2)*(pe+2)+2>l)continue e;he+=n[be][Ae],Te=!0,te=be,be--}else{he=(he+=n[be][Ae]+" ").substr(he.length-1)==" "?he.substr(0,he.length-1):he;var qe=parseInt(be),je=g(qe,he,o),We=be>=n.length-1;if(je&&!We){he+=" ",Ae=0;continue}if(je||We){if(We)te=qe;else if(i.multiline&&(F+2)*(pe+2)+2>l)continue e}else{if(!i.multiline||(F+2)*(pe+2)+2>l)continue e;te=qe}}for(var Ne="",at=J;at<=te;at++){var nt=n[at];if(i.multiline){if(at===te){Ne+=nt[Ae]+" ",Ae=(Ae+1)%nt.length;continue}if(at===J){Ne+=nt[nt.length-1]+" ";continue}}Ne+=nt[0]+" "}switch(Ne=Ne.substr(Ne.length-1)==" "?Ne.substr(0,Ne.length-1):Ne,T=tv(Ne,i,o).width,i.textAlign){case"right":v=s-T-2;break;case"center":v=(s-T)/2;break;case"left":default:v=2}e+=Xr(v)+" "+Xr(U)+` Td
`,e+="("+Mf(Ne)+`) Tj
`,e+=-Xr(v)+` 0 Td
`,U=-(o+2),T=0,J=Te?te:te+1,pe++,he=""}break}return r.text=e,r.fontSize=o,r},tv=function(i,e,t){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),n=e.scope.getStringUnitWidth(i,{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:n}},tre={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},ire=function(i,e){var t={type:"reference",object:i};e.internal.getPageInfo(i.page).pageContext.annotations.find(function(r){return r.type===t.type&&r.object===t.object})===void 0&&e.internal.getPageInfo(i.page).pageContext.annotations.push(t)},rre=function(i,e){for(var t in i)if(i.hasOwnProperty(t)){var r=t,n=i[t];e.internal.newObjectDeferredBegin(n.objId,!0),Yn(n)==="object"&&typeof n.putStream=="function"&&n.putStream(),delete i[r]}},nre=function(i,e){if(e.scope=i,i.internal!==void 0&&(i.internal.acroformPlugin===void 0||i.internal.acroformPlugin.isInitialized===!1)){if(ch.FieldNum=0,i.internal.acroformPlugin=JSON.parse(JSON.stringify(tre)),i.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");IC=i.internal.scaleFactor,i.internal.acroformPlugin.acroFormDictionaryRoot=new P4,i.internal.acroformPlugin.acroFormDictionaryRoot.scope=i,i.internal.acroformPlugin.acroFormDictionaryRoot._eventID=i.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(i)}),i.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];o.objId=void 0,o.hasAnnotation&&ire(o,t)}})(i)}),i.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(i)}),i.internal.events.subscribe("postPutPages",function(t){(function(r,n){var o=!r;for(var l in r||(n.internal.newObjectDeferredBegin(n.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),n.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||n.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(l)){var s=r[l],g=[],v=s.Rect;if(s.Rect&&(s.Rect=Yie(s.Rect,n)),n.internal.newObjectDeferredBegin(s.objId,!0),s.DA=fr.createDefaultAppearanceStream(s),Yn(s)==="object"&&typeof s.getKeyValueListForStream=="function"&&(g=s.getKeyValueListForStream()),s.Rect=v,s.hasAppearanceStream&&!s.appearanceStreamContent){var T=ere(s);g.push({key:"AP",value:"<</N "+T+">>"}),n.internal.acroformPlugin.xForms.push(T)}if(s.appearanceStreamContent){var F="";for(var R in s.appearanceStreamContent)if(s.appearanceStreamContent.hasOwnProperty(R)){var U=s.appearanceStreamContent[R];if(F+="/"+R+" ",F+="<<",Object.keys(U).length>=1||Array.isArray(U)){for(var l in U)if(U.hasOwnProperty(l)){var J=U[l];typeof J=="function"&&(J=J.call(n,s)),F+="/"+l+" "+J+" ",n.internal.acroformPlugin.xForms.indexOf(J)>=0||n.internal.acroformPlugin.xForms.push(J)}}else typeof(J=U)=="function"&&(J=J.call(n,s)),F+="/"+l+" "+J,n.internal.acroformPlugin.xForms.indexOf(J)>=0||n.internal.acroformPlugin.xForms.push(J);F+=">>"}g.push({key:"AP",value:`<<
`+F+">>"})}n.internal.putStream({additionalKeyValues:g,objectId:s.objId}),n.internal.out("endobj")}o&&rre(n.internal.acroformPlugin.xForms,n)})(t,i)}),i.internal.acroformPlugin.isInitialized=!0}},L4=Co.__acroform__.arrayToPdfArray=function(i,e,t){var r=function(l){return l};if(Array.isArray(i)){for(var n="[",o=0;o<i.length;o++)switch(o!==0&&(n+=" "),Yn(i[o])){case"boolean":case"number":case"object":n+=i[o].toString();break;case"string":i[o].substr(0,1)!=="/"?(e!==void 0&&t&&(r=t.internal.getEncryptor(e)),n+="("+Mf(r(i[o].toString()))+")"):n+=i[o].toString()}return n+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},MC=function(i,e,t){var r=function(n){return n};return e!==void 0&&t&&(r=t.internal.getEncryptor(e)),(i=i||"").toString(),i="("+Mf(r(i))+")"},Kh=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(i){this._objId=i}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Kh.prototype.toString=function(){return this.objId+" 0 R"},Kh.prototype.putStream=function(){var i=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:i,objectId:this.objId}),this.scope.internal.out("endobj")},Kh.prototype.getKeyValueListForStream=function(){var i=[],e=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var r=e[t],n=this[r];n&&(Array.isArray(n)?i.push({key:r,value:L4(n,this.objId,this.scope)}):n instanceof Kh?(n.scope=this.scope,i.push({key:r,value:n.objId+" 0 R"})):typeof n!="function"&&i.push({key:r,value:n}))}return i};var M4=function(){Kh.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var i,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){i=t.trim()},get:function(){return i||null}})};Dc(M4,Kh);var P4=function(){Kh.call(this);var i,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(i){var t=function(r){return r};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Mf(t(i))+")"}},set:function(t){i=t}})};Dc(P4,Kh);var ch=function i(){Kh.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(he){if(isNaN(he))throw new Error('Invalid value "'+he+'" for attribute F supplied.');e=he}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Qo(e,3)},set:function(he){he?this.F=Vo(e,3):this.F=Ho(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(he){if(isNaN(he))throw new Error('Invalid value "'+he+'" for attribute Ff supplied.');t=he}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(he){r=he!==void 0?he:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(he){r[0]=he}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(he){r[1]=he}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(he){r[2]=he}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(he){r[3]=he}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(he){switch(he){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=he;break;default:throw new Error('Invalid value "'+he+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof nv)return;o="FieldObject"+i.FieldNum++}var he=function(pe){return pe};return this.scope&&(he=this.scope.internal.getEncryptor(this.objId)),"("+Mf(he(o))+")"},set:function(he){o=he.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(he){o=he}});var l="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return l},set:function(he){l=he}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(he){s=he}});var g=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return g},set:function(he){g=he}});var v=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return v===void 0?50/IC:v},set:function(he){v=he}});var T="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return T},set:function(he){T=he}});var F="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!F||this instanceof nv||this instanceof Pf))return MC(F,this.objId,this.scope)},set:function(he){he=he.toString(),F=he}});var R=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(R)return this instanceof Ha?R:MC(R,this.objId,this.scope)},set:function(he){he=he.toString(),R=this instanceof Ha?he:he.substr(0,1)==="("?Cg(he.substr(1,he.length-2)):Cg(he)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ha?Cg(R.substr(1,R.length-1)):R},set:function(he){he=he.toString(),R=this instanceof Ha?"/"+he:he}});var U=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(U)return U},set:function(he){this.V=he}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(U)return this instanceof Ha?U:MC(U,this.objId,this.scope)},set:function(he){he=he.toString(),U=this instanceof Ha?he:he.substr(0,1)==="("?Cg(he.substr(1,he.length-2)):Cg(he)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ha?Cg(U.substr(1,U.length-1)):U},set:function(he){he=he.toString(),U=this instanceof Ha?"/"+he:he}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var J,te=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return te},set:function(he){he=!!he,te=he}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(J)return J},set:function(he){J=he}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,1)},set:function(he){he?this.Ff=Vo(this.Ff,1):this.Ff=Ho(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,2)},set:function(he){he?this.Ff=Vo(this.Ff,2):this.Ff=Ho(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,3)},set:function(he){he?this.Ff=Vo(this.Ff,3):this.Ff=Ho(this.Ff,3)}});var Ae=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(Ae!==null)return Ae},set:function(he){if([0,1,2].indexOf(he)===-1)throw new Error('Invalid value "'+he+'" for attribute Q supplied.');Ae=he}}),Object.defineProperty(this,"textAlign",{get:function(){var he;switch(Ae){case 0:default:he="left";break;case 1:he="center";break;case 2:he="right"}return he},configurable:!0,enumerable:!0,set:function(he){switch(he){case"right":case 2:Ae=2;break;case"center":case 1:Ae=1;break;case"left":case 0:default:Ae=0}}})};Dc(ch,Kh);var Eg=function(){ch.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var i=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){i=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return L4(e,this.objId,this.scope)},set:function(t){var r,n;n=[],typeof(r=t)=="string"&&(n=function(o,l,s){s||(s=1);for(var g,v=[];g=l.exec(o);)v.push(g[s]);return v}(r,/\((.*?)\)/g)),e=n}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,r){for(r=r||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,18)},set:function(t){t?this.Ff=Vo(this.Ff,18):this.Ff=Ho(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Vo(this.Ff,19):this.Ff=Ho(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,20)},set:function(t){t?(this.Ff=Vo(this.Ff,20),e.sort()):this.Ff=Ho(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,22)},set:function(t){t?this.Ff=Vo(this.Ff,22):this.Ff=Ho(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,23)},set:function(t){t?this.Ff=Vo(this.Ff,23):this.Ff=Ho(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,27)},set:function(t){t?this.Ff=Vo(this.Ff,27):this.Ff=Ho(this.Ff,27)}}),this.hasAppearanceStream=!1};Dc(Eg,ch);var Sg=function(){Eg.call(this),this.fontName="helvetica",this.combo=!1};Dc(Sg,Eg);var Tg=function(){Sg.call(this),this.combo=!0};Dc(Tg,Sg);var iv=function(){Tg.call(this),this.edit=!0};Dc(iv,Tg);var Ha=function(){ch.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,15)},set:function(t){t?this.Ff=Vo(this.Ff,15):this.Ff=Ho(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,16)},set:function(t){t?this.Ff=Vo(this.Ff,16):this.Ff=Ho(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,17)},set:function(t){t?this.Ff=Vo(this.Ff,17):this.Ff=Ho(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,26)},set:function(t){t?this.Ff=Vo(this.Ff,26):this.Ff=Ho(this.Ff,26)}});var i,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(o){return o};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var r,n=[];for(r in n.push("<<"),e)n.push("/"+r+" ("+Mf(t(e[r]))+")");return n.push(">>"),n.join(`
`)}},set:function(t){Yn(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(t){i="/"+t}})};Dc(Ha,ch);var rv=function(){Ha.call(this),this.pushButton=!0};Dc(rv,Ha);var Ig=function(){Ha.call(this),this.radio=!0,this.pushButton=!1;var i=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e!==void 0?e:[]}})};Dc(Ig,Ha);var nv=function(){var i,e;ch.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return i},set:function(n){i=n}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(n){e=n}});var t,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(s){return s};this.scope&&(n=this.scope.internal.getEncryptor(this.objId));var o,l=[];for(o in l.push("<<"),r)l.push("/"+o+" ("+Mf(n(r[o]))+")");return l.push(">>"),l.join(`
`)},set:function(n){Yn(n)==="object"&&(r=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(n){typeof n=="string"&&(r.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(n){t="/"+n}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=fr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Dc(nv,ch),Ig.prototype.setAppearance=function(i){if(!("createAppearanceStream"in i)||!("getCA"in i))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=i.createAppearanceStream(t.optionName),t.caption=i.getCA()}},Ig.prototype.createOption=function(i){var e=new nv;return e.Parent=this,e.optionName=i,this.Kids.push(e),sre.call(this.scope,e),e};var sv=function(){Ha.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=fr.CheckBox.createAppearanceStream()};Dc(sv,Ha);var Pf=function(){ch.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,13)},set:function(e){e?this.Ff=Vo(this.Ff,13):this.Ff=Ho(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,21)},set:function(e){e?this.Ff=Vo(this.Ff,21):this.Ff=Ho(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,23)},set:function(e){e?this.Ff=Vo(this.Ff,23):this.Ff=Ho(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,24)},set:function(e){e?this.Ff=Vo(this.Ff,24):this.Ff=Ho(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,25)},set:function(e){e?this.Ff=Vo(this.Ff,25):this.Ff=Ho(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,26)},set:function(e){e?this.Ff=Vo(this.Ff,26):this.Ff=Ho(this.Ff,26)}});var i=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){Number.isInteger(e)&&(i=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Dc(Pf,ch);var ov=function(){Pf.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,14)},set:function(i){i?this.Ff=Vo(this.Ff,14):this.Ff=Ho(this.Ff,14)}}),this.password=!0};Dc(ov,Pf);var fr={CheckBox:{createAppearanceStream:function(){return{N:{On:fr.CheckBox.YesNormal},D:{On:fr.CheckBox.YesPushDown,Off:fr.CheckBox.OffPushDown}}},YesPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=i.scope.internal.getFont(i.fontName,i.fontStyle).id,n=i.scope.__private__.encodeColorString(i.color),o=LC(i,i.caption);return t.push("0.749023 g"),t.push("0 0 "+Xr(fr.internal.getWidth(i))+" "+Xr(fr.internal.getHeight(i))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+r+" "+Xr(o.fontSize)+" Tf "+n),t.push("BT"),t.push(o.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(i){var e=$h(i);e.scope=i.scope;var t=i.scope.internal.getFont(i.fontName,i.fontStyle).id,r=i.scope.__private__.encodeColorString(i.color),n=[],o=fr.internal.getHeight(i),l=fr.internal.getWidth(i),s=LC(i,i.caption);return n.push("1 g"),n.push("0 0 "+Xr(l)+" "+Xr(o)+" re"),n.push("f"),n.push("q"),n.push("0 0 1 rg"),n.push("0 0 "+Xr(l-1)+" "+Xr(o-1)+" re"),n.push("W"),n.push("n"),n.push("0 g"),n.push("BT"),n.push("/"+t+" "+Xr(s.fontSize)+" Tf "+r),n.push(s.text),n.push("ET"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Xr(fr.internal.getWidth(i))+" "+Xr(fr.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(i){var e={D:{Off:fr.RadioButton.Circle.OffPushDown},N:{}};return e.N[i]=fr.RadioButton.Circle.YesNormal,e.D[i]=fr.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=fr.internal.getWidth(i)<=fr.internal.getHeight(i)?fr.internal.getWidth(i)/4:fr.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=fr.internal.Bezier_C,o=Number((r*n).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+_d(fr.internal.getWidth(i)/2)+" "+_d(fr.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),t.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),t.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),t.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=fr.internal.getWidth(i)<=fr.internal.getHeight(i)?fr.internal.getWidth(i)/4:fr.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*fr.internal.Bezier_C).toFixed(5)),l=Number((r*fr.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+_d(fr.internal.getWidth(i)/2)+" "+_d(fr.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+_d(fr.internal.getWidth(i)/2)+" "+_d(fr.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+l+" "+l+" "+r+" 0 "+r+" c"),t.push("-"+l+" "+r+" -"+r+" "+l+" -"+r+" 0 c"),t.push("-"+r+" -"+l+" -"+l+" -"+r+" 0 -"+r+" c"),t.push(l+" -"+r+" "+r+" -"+l+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=fr.internal.getWidth(i)<=fr.internal.getHeight(i)?fr.internal.getWidth(i)/4:fr.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*fr.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+_d(fr.internal.getWidth(i)/2)+" "+_d(fr.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(i){var e={D:{Off:fr.RadioButton.Cross.OffPushDown},N:{}};return e.N[i]=fr.RadioButton.Cross.YesNormal,e.D[i]=fr.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=fr.internal.calculateCross(i);return t.push("q"),t.push("1 1 "+Xr(fr.internal.getWidth(i)-2)+" "+Xr(fr.internal.getHeight(i)-2)+" re"),t.push("W"),t.push("n"),t.push(Xr(r.x1.x)+" "+Xr(r.x1.y)+" m"),t.push(Xr(r.x2.x)+" "+Xr(r.x2.y)+" l"),t.push(Xr(r.x4.x)+" "+Xr(r.x4.y)+" m"),t.push(Xr(r.x3.x)+" "+Xr(r.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=fr.internal.calculateCross(i),r=[];return r.push("0.749023 g"),r.push("0 0 "+Xr(fr.internal.getWidth(i))+" "+Xr(fr.internal.getHeight(i))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Xr(fr.internal.getWidth(i)-2)+" "+Xr(fr.internal.getHeight(i)-2)+" re"),r.push("W"),r.push("n"),r.push(Xr(t.x1.x)+" "+Xr(t.x1.y)+" m"),r.push(Xr(t.x2.x)+" "+Xr(t.x2.y)+" l"),r.push(Xr(t.x4.x)+" "+Xr(t.x4.y)+" m"),r.push(Xr(t.x3.x)+" "+Xr(t.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Xr(fr.internal.getWidth(i))+" "+Xr(fr.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(i){var e=i.scope.internal.getFont(i.fontName,i.fontStyle).id,t=i.scope.__private__.encodeColorString(i.color);return"/"+e+" "+i.fontSize+" Tf "+t}};fr.internal={Bezier_C:.551915024494,calculateCross:function(i){var e=fr.internal.getWidth(i),t=fr.internal.getHeight(i),r=Math.min(e,t);return{x1:{x:(e-r)/2,y:(t-r)/2+r},x2:{x:(e-r)/2+r,y:(t-r)/2},x3:{x:(e-r)/2,y:(t-r)/2},x4:{x:(e-r)/2+r,y:(t-r)/2+r}}}},fr.internal.getWidth=function(i){var e=0;return Yn(i)==="object"&&(e=I4(i.Rect[2])),e},fr.internal.getHeight=function(i){var e=0;return Yn(i)==="object"&&(e=I4(i.Rect[3])),e};var sre=Co.addField=function(i){if(nre(this,i),!(i instanceof ch))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=i).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),i.page=i.scope.internal.getCurrentPageInfo().pageNumber,this};Co.AcroFormChoiceField=Eg,Co.AcroFormListBox=Sg,Co.AcroFormComboBox=Tg,Co.AcroFormEditBox=iv,Co.AcroFormButton=Ha,Co.AcroFormPushButton=rv,Co.AcroFormRadioButton=Ig,Co.AcroFormCheckBox=sv,Co.AcroFormTextField=Pf,Co.AcroFormPasswordField=ov,Co.AcroFormAppearance=fr,Co.AcroForm={ChoiceField:Eg,ListBox:Sg,ComboBox:Tg,EditBox:iv,Button:Ha,PushButton:rv,RadioButton:Ig,CheckBox:sv,TextField:Pf,PasswordField:ov,Appearance:fr},Hr.AcroForm={ChoiceField:Eg,ListBox:Sg,ComboBox:Tg,EditBox:iv,Button:Ha,PushButton:rv,RadioButton:Ig,CheckBox:sv,TextField:Pf,PasswordField:ov,Appearance:fr};function F4(i){return i.reduce(function(e,t,r){return e[t]=r,e},{})}(function(i){i.__addimage__={};var e="UNKNOWN",t={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=i.__addimage__.getImageFileTypeByImageData=function(ke,De){var Ye,Ze,Ct,Et,Pt,bt=e;if((De=De||e)==="RGBA"||ke.data!==void 0&&ke.data instanceof Uint8ClampedArray&&"height"in ke&&"width"in ke)return"RGBA";if(je(ke))for(Pt in t)for(Ct=t[Pt],Ye=0;Ye<Ct.length;Ye+=1){for(Et=!0,Ze=0;Ze<Ct[Ye].length;Ze+=1)if(Ct[Ye][Ze]!==void 0&&Ct[Ye][Ze]!==ke[Ze]){Et=!1;break}if(Et===!0){bt=Pt;break}}else for(Pt in t)for(Ct=t[Pt],Ye=0;Ye<Ct.length;Ye+=1){for(Et=!0,Ze=0;Ze<Ct[Ye].length;Ze+=1)if(Ct[Ye][Ze]!==void 0&&Ct[Ye][Ze]!==ke.charCodeAt(Ze)){Et=!1;break}if(Et===!0){bt=Pt;break}}return bt===e&&De!==e&&(bt=De),bt},n=function ke(De){for(var Ye=this.internal.write,Ze=this.internal.putStream,Ct=(0,this.internal.getFilters)();Ct.indexOf("FlateEncode")!==-1;)Ct.splice(Ct.indexOf("FlateEncode"),1);De.objectId=this.internal.newObject();var Et=[];if(Et.push({key:"Type",value:"/XObject"}),Et.push({key:"Subtype",value:"/Image"}),Et.push({key:"Width",value:De.width}),Et.push({key:"Height",value:De.height}),De.colorSpace===Ae.INDEXED?Et.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(De.palette.length/3-1)+" "+("sMask"in De&&De.sMask!==void 0?De.objectId+2:De.objectId+1)+" 0 R]"}):(Et.push({key:"ColorSpace",value:"/"+De.colorSpace}),De.colorSpace===Ae.DEVICE_CMYK&&Et.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Et.push({key:"BitsPerComponent",value:De.bitsPerComponent}),"decodeParameters"in De&&De.decodeParameters!==void 0&&Et.push({key:"DecodeParms",value:"<<"+De.decodeParameters+">>"}),"transparency"in De&&Array.isArray(De.transparency)){for(var Pt="",bt=0,Rt=De.transparency.length;bt<Rt;bt++)Pt+=De.transparency[bt]+" "+De.transparency[bt]+" ";Et.push({key:"Mask",value:"["+Pt+"]"})}De.sMask!==void 0&&Et.push({key:"SMask",value:De.objectId+1+" 0 R"});var Ft=De.filter!==void 0?["/"+De.filter]:void 0;if(Ze({data:De.data,additionalKeyValues:Et,alreadyAppliedFilters:Ft,objectId:De.objectId}),Ye("endobj"),"sMask"in De&&De.sMask!==void 0){var Xt="/Predictor "+De.predictor+" /Colors 1 /BitsPerComponent "+De.bitsPerComponent+" /Columns "+De.width,Le={width:De.width,height:De.height,colorSpace:"DeviceGray",bitsPerComponent:De.bitsPerComponent,decodeParameters:Xt,data:De.sMask};"filter"in De&&(Le.filter=De.filter),ke.call(this,Le)}if(De.colorSpace===Ae.INDEXED){var Xe=this.internal.newObject();Ze({data:Ne(new Uint8Array(De.palette)),objectId:Xe}),Ye("endobj")}},o=function(){var ke=this.internal.collections.addImage_images;for(var De in ke)n.call(this,ke[De])},l=function(){var ke,De=this.internal.collections.addImage_images,Ye=this.internal.write;for(var Ze in De)Ye("/I"+(ke=De[Ze]).index,ke.objectId,"0","R")},s=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",l))},g=function(){var ke=this.internal.collections.addImage_images;return s.call(this),ke},v=function(){return Object.keys(this.internal.collections.addImage_images).length},T=function(ke){return typeof i["process"+ke.toUpperCase()]=="function"},F=function(ke){return Yn(ke)==="object"&&ke.nodeType===1},R=function(ke,De){if(ke.nodeName==="IMG"&&ke.hasAttribute("src")){var Ye=""+ke.getAttribute("src");if(Ye.indexOf("data:image/")===0)return Vy(unescape(Ye).split("base64,").pop());var Ze=i.loadFile(Ye,!0);if(Ze!==void 0)return Ze}if(ke.nodeName==="CANVAS"){if(ke.width===0||ke.height===0)throw new Error("Given canvas must have data. Canvas width: "+ke.width+", height: "+ke.height);var Ct;switch(De){case"PNG":Ct="image/png";break;case"WEBP":Ct="image/webp";break;case"JPEG":case"JPG":default:Ct="image/jpeg"}return Vy(ke.toDataURL(Ct,1).split("base64,").pop())}},U=function(ke){var De=this.internal.collections.addImage_images;if(De){for(var Ye in De)if(ke===De[Ye].alias)return De[Ye]}},J=function(ke,De,Ye){return ke||De||(ke=-96,De=-96),ke<0&&(ke=-1*Ye.width*72/ke/this.internal.scaleFactor),De<0&&(De=-1*Ye.height*72/De/this.internal.scaleFactor),ke===0&&(ke=De*Ye.width/Ye.height),De===0&&(De=ke*Ye.height/Ye.width),[ke,De]},te=function(ke,De,Ye,Ze,Ct,Et){var Pt=J.call(this,Ye,Ze,Ct),bt=this.internal.getCoordinateString,Rt=this.internal.getVerticalCoordinateString,Ft=g.call(this);if(Ye=Pt[0],Ze=Pt[1],Ft[Ct.index]=Ct,Et){Et*=Math.PI/180;var Xt=Math.cos(Et),Le=Math.sin(Et),Xe=function(pt){return pt.toFixed(4)},it=[Xe(Xt),Xe(Le),Xe(-1*Le),Xe(Xt),0,0,"cm"]}this.internal.write("q"),Et?(this.internal.write([1,"0","0",1,bt(ke),Rt(De+Ze),"cm"].join(" ")),this.internal.write(it.join(" ")),this.internal.write([bt(Ye),"0","0",bt(Ze),"0","0","cm"].join(" "))):this.internal.write([bt(Ye),"0","0",bt(Ze),bt(ke),Rt(De+Ze),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Ct.index+" Do"),this.internal.write("Q")},Ae=i.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};i.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var he=i.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},pe=i.__addimage__.sHashCode=function(ke){var De,Ye,Ze=0;if(typeof ke=="string")for(Ye=ke.length,De=0;De<Ye;De++)Ze=(Ze<<5)-Ze+ke.charCodeAt(De),Ze|=0;else if(je(ke))for(Ye=ke.byteLength/2,De=0;De<Ye;De++)Ze=(Ze<<5)-Ze+ke[De],Ze|=0;return Ze},be=i.__addimage__.validateStringAsBase64=function(ke){(ke=ke||"").toString().trim();var De=!0;return ke.length===0&&(De=!1),ke.length%4!=0&&(De=!1),/^[A-Za-z0-9+/]+$/.test(ke.substr(0,ke.length-2))===!1&&(De=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(ke.substr(-2))===!1&&(De=!1),De},Te=i.__addimage__.extractImageFromDataUrl=function(ke){var De=(ke=ke||"").split("base64,"),Ye=null;if(De.length===2){var Ze=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(De[0]);Array.isArray(Ze)&&(Ye={mimeType:Ze[1],charset:Ze[2],data:De[1]})}return Ye},qe=i.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};i.__addimage__.isArrayBuffer=function(ke){return qe()&&ke instanceof ArrayBuffer};var je=i.__addimage__.isArrayBufferView=function(ke){return qe()&&typeof Uint32Array<"u"&&(ke instanceof Int8Array||ke instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&ke instanceof Uint8ClampedArray||ke instanceof Int16Array||ke instanceof Uint16Array||ke instanceof Int32Array||ke instanceof Uint32Array||ke instanceof Float32Array||ke instanceof Float64Array)},We=i.__addimage__.binaryStringToUint8Array=function(ke){for(var De=ke.length,Ye=new Uint8Array(De),Ze=0;Ze<De;Ze++)Ye[Ze]=ke.charCodeAt(Ze);return Ye},Ne=i.__addimage__.arrayBufferToBinaryString=function(ke){for(var De="",Ye=je(ke)?ke:new Uint8Array(ke),Ze=0;Ze<Ye.length;Ze+=8192)De+=String.fromCharCode.apply(null,Ye.subarray(Ze,Ze+8192));return De};i.addImage=function(){var ke,De,Ye,Ze,Ct,Et,Pt,bt,Rt;if(typeof arguments[1]=="number"?(De=e,Ye=arguments[1],Ze=arguments[2],Ct=arguments[3],Et=arguments[4],Pt=arguments[5],bt=arguments[6],Rt=arguments[7]):(De=arguments[1],Ye=arguments[2],Ze=arguments[3],Ct=arguments[4],Et=arguments[5],Pt=arguments[6],bt=arguments[7],Rt=arguments[8]),Yn(ke=arguments[0])==="object"&&!F(ke)&&"imageData"in ke){var Ft=ke;ke=Ft.imageData,De=Ft.format||De||e,Ye=Ft.x||Ye||0,Ze=Ft.y||Ze||0,Ct=Ft.w||Ft.width||Ct,Et=Ft.h||Ft.height||Et,Pt=Ft.alias||Pt,bt=Ft.compression||bt,Rt=Ft.rotation||Ft.angle||Rt}var Xt=this.internal.getFilters();if(bt===void 0&&Xt.indexOf("FlateEncode")!==-1&&(bt="SLOW"),isNaN(Ye)||isNaN(Ze))throw new Error("Invalid coordinates passed to jsPDF.addImage");s.call(this);var Le=at.call(this,ke,De,Pt,bt);return te.call(this,Ye,Ze,Ct,Et,Le,Rt),this};var at=function(ke,De,Ye,Ze){var Ct,Et,Pt;if(typeof ke=="string"&&r(ke)===e){ke=unescape(ke);var bt=nt(ke,!1);(bt!==""||(bt=i.loadFile(ke,!0))!==void 0)&&(ke=bt)}if(F(ke)&&(ke=R(ke,De)),De=r(ke,De),!T(De))throw new Error("addImage does not support files of type '"+De+"', please ensure that a plugin for '"+De+"' support is added.");if(((Pt=Ye)==null||Pt.length===0)&&(Ye=function(Rt){return typeof Rt=="string"||je(Rt)?pe(Rt):je(Rt.data)?pe(Rt.data):null}(ke)),(Ct=U.call(this,Ye))||(qe()&&(ke instanceof Uint8Array||De==="RGBA"||(Et=ke,ke=We(ke))),Ct=this["process"+De.toUpperCase()](ke,v.call(this),Ye,function(Rt){return Rt&&typeof Rt=="string"&&(Rt=Rt.toUpperCase()),Rt in i.image_compression?Rt:he.NONE}(Ze),Et)),!Ct)throw new Error("An unknown error occurred whilst processing the image.");return Ct},nt=i.__addimage__.convertBase64ToBinaryString=function(ke,De){var Ye;De=typeof De!="boolean"||De;var Ze,Ct="";if(typeof ke=="string"){Ze=(Ye=Te(ke))!==null?Ye.data:ke;try{Ct=Vy(Ze)}catch(Et){if(De)throw be(Ze)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Et.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Ct};i.getImageProperties=function(ke){var De,Ye,Ze="";if(F(ke)&&(ke=R(ke)),typeof ke=="string"&&r(ke)===e&&((Ze=nt(ke,!1))===""&&(Ze=i.loadFile(ke)||""),ke=Ze),Ye=r(ke),!T(Ye))throw new Error("addImage does not support files of type '"+Ye+"', please ensure that a plugin for '"+Ye+"' support is added.");if(!qe()||ke instanceof Uint8Array||(ke=We(ke)),!(De=this["process"+Ye.toUpperCase()](ke)))throw new Error("An unknown error occurred whilst processing the image");return De.fileType=Ye,De}})(Hr.API),function(i){var e=function(t){if(t!==void 0&&t!="")return!0};Hr.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),i.events.push(["putPage",function(t){for(var r,n,o,l=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,g=this.internal.getPageInfoByObjId(t.objId),v=t.pageContext.annotations,T=!1,F=0;F<v.length&&!T;F++)switch((r=v[F]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(T=!0);break;case"reference":case"text":case"freetext":T=!0}if(T!=0){this.internal.write("/Annots [");for(var R=0;R<v.length;R++){r=v[R];var U=this.internal.pdfEscape,J=this.internal.getEncryptor(t.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var te=this.internal.newAdditionalObject(),Ae=this.internal.newAdditionalObject(),he=this.internal.getEncryptor(te.objId),pe=r.title||"Note";o="<</Type /Annot /Subtype /Text "+(n="/Rect ["+l(r.bounds.x)+" "+s(r.bounds.y+r.bounds.h)+" "+l(r.bounds.x+r.bounds.w)+" "+s(r.bounds.y)+"] ")+"/Contents ("+U(he(r.contents))+")",o+=" /Popup "+Ae.objId+" 0 R",o+=" /P "+g.objId+" 0 R",o+=" /T ("+U(he(pe))+") >>",te.content=o;var be=te.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+l(r.bounds.x+30)+" "+s(r.bounds.y+r.bounds.h)+" "+l(r.bounds.x+r.bounds.w+30)+" "+s(r.bounds.y)+"] ")+" /Parent "+be,r.open&&(o+=" /Open true"),o+=" >>",Ae.content=o,this.internal.write(te.objId,"0 R",Ae.objId,"0 R");break;case"freetext":n="/Rect ["+l(r.bounds.x)+" "+s(r.bounds.y)+" "+l(r.bounds.x+r.bounds.w)+" "+s(r.bounds.y+r.bounds.h)+"] ";var Te=r.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+U(J(r.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+Te+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(r.options.name){var qe=this.annotations._nameMap[r.options.name];r.options.pageNumber=qe.page,r.options.top=qe.y}else r.options.top||(r.options.top=0);if(n="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",o="",r.options.url)o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+U(J(r.options.url))+") >>";else if(r.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,o+=" /FitV "+r.options.left+"]";break;case"XYZ":default:var je=s(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),o+=" /XYZ "+r.options.left+" "+je+" "+r.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),i.createAnnotation=function(t){var r=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":r.pageContext.annotations.push(t)}},i.link=function(t,r,n,o,l){var s=this.internal.getCurrentPageInfo(),g=this.internal.getCoordinateString,v=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:g(t),y:v(r),w:g(t+n),h:v(r+o)},options:l,type:"link"})},i.textWithLink=function(t,r,n,o){var l,s,g=this.getTextWidth(t),v=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){s=o.maxWidth;var T=this.splitTextToSize(t,s).length;l=Math.ceil(v*T)}else s=g,l=v;return this.text(t,r,n,o),n+=.2*v,o.align==="center"&&(r-=g/2),o.align==="right"&&(r-=g),this.link(r,n-v,s,l,o),g},i.getTextWidth=function(t){var r=this.internal.getFontSize();return this.getStringUnitWidth(t)*r/this.internal.scaleFactor}}(Hr.API),function(i){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},n=[1570,1571,1573,1575];i.__arabicParser__={};var o=i.__arabicParser__.isInArabicSubstitutionA=function(te){return e[te.charCodeAt(0)]!==void 0},l=i.__arabicParser__.isArabicLetter=function(te){return typeof te=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(te)},s=i.__arabicParser__.isArabicEndLetter=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length<=2},g=i.__arabicParser__.isArabicAlfLetter=function(te){return l(te)&&n.indexOf(te.charCodeAt(0))>=0};i.__arabicParser__.arabicLetterHasIsolatedForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length>=1};var v=i.__arabicParser__.arabicLetterHasFinalForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length>=2};i.__arabicParser__.arabicLetterHasInitialForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length>=3};var T=i.__arabicParser__.arabicLetterHasMedialForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length==4},F=i.__arabicParser__.resolveLigatures=function(te){var Ae=0,he=t,pe="",be=0;for(Ae=0;Ae<te.length;Ae+=1)he[te.charCodeAt(Ae)]!==void 0?(be++,typeof(he=he[te.charCodeAt(Ae)])=="number"&&(pe+=String.fromCharCode(he),he=t,be=0),Ae===te.length-1&&(he=t,pe+=te.charAt(Ae-(be-1)),Ae-=be-1,be=0)):(he=t,pe+=te.charAt(Ae-be),Ae-=be,be=0);return pe};i.__arabicParser__.isArabicDiacritic=function(te){return te!==void 0&&r[te.charCodeAt(0)]!==void 0};var R=i.__arabicParser__.getCorrectForm=function(te,Ae,he){return l(te)?o(te)===!1?-1:!v(te)||!l(Ae)&&!l(he)||!l(he)&&s(Ae)||s(te)&&!l(Ae)||s(te)&&g(Ae)||s(te)&&s(Ae)?0:T(te)&&l(Ae)&&!s(Ae)&&l(he)&&v(he)?3:s(te)||!l(he)?1:2:-1},U=function(te){var Ae=0,he=0,pe=0,be="",Te="",qe="",je=(te=te||"").split("\\s+"),We=[];for(Ae=0;Ae<je.length;Ae+=1){for(We.push(""),he=0;he<je[Ae].length;he+=1)be=je[Ae][he],Te=je[Ae][he-1],qe=je[Ae][he+1],l(be)?(pe=R(be,Te,qe),We[Ae]+=pe!==-1?String.fromCharCode(e[be.charCodeAt(0)][pe]):be):We[Ae]+=be;We[Ae]=F(We[Ae])}return We.join(" ")},J=i.__arabicParser__.processArabic=i.processArabic=function(){var te,Ae=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,he=[];if(Array.isArray(Ae)){var pe=0;for(he=[],pe=0;pe<Ae.length;pe+=1)Array.isArray(Ae[pe])?he.push([U(Ae[pe][0]),Ae[pe][1],Ae[pe][2]]):he.push([U(Ae[pe])]);te=he}else te=U(Ae);return typeof arguments[0]=="string"?te:(arguments[0].text=te,arguments[0])};i.events.push(["preProcessText",J])}(Hr.API),Hr.API.autoPrint=function(i){var e;switch((i=i||{}).variant=i.variant||"non-conform",i.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(i){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(s){t=s}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(s){r=isNaN(s)||Number.isInteger(s)===!1||s<0?150:s,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(s){n=isNaN(s)||Number.isInteger(s)===!1||s<0?300:s,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(s){o=s}});var l={};Object.defineProperty(this,"style",{get:function(){return l},set:function(s){l=s}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,r){var n;if((t=t||"2d")!=="2d")return null;for(n in r)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=r[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},i.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(Hr.API),function(i){var e={left:0,top:0,bottom:0,right:0},t=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),n.call(this))},n=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var g=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return g},set:function(te){g=te}});var v=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return v},set:function(te){v=te}});var T=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return T},set:function(te){T=te}});var F=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return F},set:function(te){F=te}});var R=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return R},set:function(te){R=te}});var U=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return U},set:function(te){U=te}});var J=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return J},set:function(te){J=te}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},i.setHeaderFunction=function(g){return r.call(this),this.internal.__cell__.headerFunction=typeof g=="function"?g:void 0,this},i.getTextDimensions=function(g,v){r.call(this);var T=(v=v||{}).fontSize||this.getFontSize(),F=v.font||this.getFont(),R=v.scaleFactor||this.internal.scaleFactor,U=0,J=0,te=0,Ae=this;if(!Array.isArray(g)&&typeof g!="string"){if(typeof g!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");g=String(g)}var he=v.maxWidth;he>0?typeof g=="string"?g=this.splitTextToSize(g,he):Object.prototype.toString.call(g)==="[object Array]"&&(g=g.reduce(function(be,Te){return be.concat(Ae.splitTextToSize(Te,he))},[])):g=Array.isArray(g)?g:[g];for(var pe=0;pe<g.length;pe++)U<(te=this.getStringUnitWidth(g[pe],{font:F})*T)&&(U=te);return U!==0&&(J=g.length),{w:U/=R,h:Math.max((J*T*this.getLineHeightFactor()-T*(this.getLineHeightFactor()-1))/R,0)}},i.cellAddPage=function(){r.call(this),this.addPage();var g=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new o(g.left,g.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var l=i.cell=function(){var g;g=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var v=this.internal.__cell__.lastCell,T=this.internal.__cell__.padding,F=this.internal.__cell__.margins||e,R=this.internal.__cell__.tableHeaderRow,U=this.internal.__cell__.printHeaders;return v.lineNumber!==void 0&&(v.lineNumber===g.lineNumber?(g.x=(v.x||0)+(v.width||0),g.y=v.y||0):v.y+v.height+g.height+F.bottom>this.getPageHeight()?(this.cellAddPage(),g.y=F.top,U&&R&&(this.printHeaderRow(g.lineNumber,!0),g.y+=R[0].height)):g.y=v.y+v.height||g.y),g.text[0]!==void 0&&(this.rect(g.x,g.y,g.width,g.height,t===!0?"FD":void 0),g.align==="right"?this.text(g.text,g.x+g.width-T,g.y+T,{align:"right",baseline:"top"}):g.align==="center"?this.text(g.text,g.x+g.width/2,g.y+T,{align:"center",baseline:"top",maxWidth:g.width-T-T}):this.text(g.text,g.x+T,g.y+T,{align:"left",baseline:"top",maxWidth:g.width-T-T})),this.internal.__cell__.lastCell=g,this};i.table=function(g,v,T,F,R){if(r.call(this),!T)throw new Error("No data for PDF table.");var U,J,te,Ae,he=[],pe=[],be=[],Te={},qe={},je=[],We=[],Ne=(R=R||{}).autoSize||!1,at=R.printHeaders!==!1,nt=R.css&&R.css["font-size"]!==void 0?16*R.css["font-size"]:R.fontSize||12,ke=R.margins||Object.assign({width:this.getPageWidth()},e),De=typeof R.padding=="number"?R.padding:3,Ye=R.headerBackgroundColor||"#c8c8c8",Ze=R.headerTextColor||"#000";if(n.call(this),this.internal.__cell__.printHeaders=at,this.internal.__cell__.margins=ke,this.internal.__cell__.table_font_size=nt,this.internal.__cell__.padding=De,this.internal.__cell__.headerBackgroundColor=Ye,this.internal.__cell__.headerTextColor=Ze,this.setFontSize(nt),F==null)pe=he=Object.keys(T[0]),be=he.map(function(){return"left"});else if(Array.isArray(F)&&Yn(F[0])==="object")for(he=F.map(function(Ft){return Ft.name}),pe=F.map(function(Ft){return Ft.prompt||Ft.name||""}),be=F.map(function(Ft){return Ft.align||"left"}),U=0;U<F.length;U+=1)qe[F[U].name]=F[U].width*(19.049976/25.4);else Array.isArray(F)&&typeof F[0]=="string"&&(pe=he=F,be=he.map(function(){return"left"}));if(Ne||Array.isArray(F)&&typeof F[0]=="string")for(U=0;U<he.length;U+=1){for(Te[Ae=he[U]]=T.map(function(Ft){return Ft[Ae]}),this.setFont(void 0,"bold"),je.push(this.getTextDimensions(pe[U],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),J=Te[Ae],this.setFont(void 0,"normal"),te=0;te<J.length;te+=1)je.push(this.getTextDimensions(J[te],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);qe[Ae]=Math.max.apply(null,je)+De+De,je=[]}if(at){var Ct={};for(U=0;U<he.length;U+=1)Ct[he[U]]={},Ct[he[U]].text=pe[U],Ct[he[U]].align=be[U];var Et=s.call(this,Ct,qe);We=he.map(function(Ft){return new o(g,v,qe[Ft],Et,Ct[Ft].text,void 0,Ct[Ft].align)}),this.setTableHeaderRow(We),this.printHeaderRow(1,!1)}var Pt=F.reduce(function(Ft,Xt){return Ft[Xt.name]=Xt.align,Ft},{});for(U=0;U<T.length;U+=1){"rowStart"in R&&R.rowStart instanceof Function&&R.rowStart({row:U,data:T[U]},this);var bt=s.call(this,T[U],qe);for(te=0;te<he.length;te+=1){var Rt=T[U][he[te]];"cellStart"in R&&R.cellStart instanceof Function&&R.cellStart({row:U,col:te,data:Rt},this),l.call(this,new o(g,v,qe[he[te]],bt,Rt,U+2,Pt[he[te]]))}}return this.internal.__cell__.table_x=g,this.internal.__cell__.table_y=v,this};var s=function(g,v){var T=this.internal.__cell__.padding,F=this.internal.__cell__.table_font_size,R=this.internal.scaleFactor;return Object.keys(g).map(function(U){var J=g[U];return this.splitTextToSize(J.hasOwnProperty("text")?J.text:J,v[U]-T-T)},this).map(function(U){return this.getLineHeightFactor()*U.length*F/R+T+T},this).reduce(function(U,J){return Math.max(U,J)},0)};i.setTableHeaderRow=function(g){r.call(this),this.internal.__cell__.tableHeaderRow=g},i.printHeaderRow=function(g,v){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var T;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var F=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(F[0],F[1],F[2],F[3],void 0,-1)}this.setFont(void 0,"bold");for(var R=[],U=0;U<this.internal.__cell__.tableHeaderRow.length;U+=1){T=this.internal.__cell__.tableHeaderRow[U].clone(),v&&(T.y=this.internal.__cell__.margins.top||0,R.push(T)),T.lineNumber=g;var J=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),l.call(this,T),this.setTextColor(J)}R.length>0&&this.setTableHeaderRow(R),this.setFont(void 0,"normal"),t=!1}}(Hr.API);var D4={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},R4=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],PC=F4(R4),k4=[100,200,300,400,500,600,700,800,900],ore=F4(k4);function FC(i){var e=i.family.replace(/"|'/g,"").toLowerCase(),t=function(o){return D4[o=o||"normal"]?o:"normal"}(i.style),r=function(o){if(!o)return 400;if(typeof o=="number")return o>=100&&o<=900&&o%100==0?o:400;if(/^\d00$/.test(o))return parseInt(o);switch(o){case"bold":return 700;case"normal":default:return 400}}(i.weight),n=function(o){return typeof PC[o=o||"normal"]=="number"?o:"normal"}(i.stretch);return{family:e,style:t,weight:r,stretch:n,src:i.src||[],ref:i.ref||{name:e,style:[n,t,r].join(" ")}}}function O4(i,e,t,r){var n;for(n=t;n>=0&&n<e.length;n+=r)if(i[e[n]])return i[e[n]];for(n=t;n>=0&&n<e.length;n-=r)if(i[e[n]])return i[e[n]]}var are={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},U4={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function N4(i){return[i.stretch,i.style,i.weight,i.family].join(" ")}function lre(i,e,t){for(var r=(t=t||{}).defaultFontFamily||"times",n=Object.assign({},are,t.genericFontFamilies||{}),o=null,l=null,s=0;s<e.length;++s)if(n[(o=FC(e[s])).family]&&(o.family=n[o.family]),i.hasOwnProperty(o.family)){l=i[o.family];break}if(!(l=l||i[r]))throw new Error("Could not find a font-family for the rule '"+N4(o)+"' and default family '"+r+"'.");if(l=function(g,v){if(v[g])return v[g];var T=PC[g],F=T<=PC.normal?-1:1,R=O4(v,R4,T,F);if(!R)throw new Error("Could not find a matching font-stretch value for "+g);return R}(o.stretch,l),l=function(g,v){if(v[g])return v[g];for(var T=D4[g],F=0;F<T.length;++F)if(v[T[F]])return v[T[F]];throw new Error("Could not find a matching font-style for "+g)}(o.style,l),!(l=function(g,v){if(v[g])return v[g];if(g===400&&v[500])return v[500];if(g===500&&v[400])return v[400];var T=ore[g],F=O4(v,k4,T,g<400?-1:1);if(!F)throw new Error("Could not find a matching font-weight for value "+g);return F}(o.weight,l)))throw new Error("Failed to resolve a font for the rule '"+N4(o)+"'.");return l}function z4(i){return i.trimLeft()}function cre(i,e){for(var t=0;t<i.length;){if(i.charAt(t)===e)return[i.substring(0,t),i.substring(t+1)];t+=1}return null}function ure(i){var e=i.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],i.substring(e[0].length)]}var av,Q4,V4,H4=["times"];(function(i){var e,t,r,n,o,l,s,g,v,T=function(Le){return Le=Le||{},this.isStrokeTransparent=Le.isStrokeTransparent||!1,this.strokeOpacity=Le.strokeOpacity||1,this.strokeStyle=Le.strokeStyle||"#000000",this.fillStyle=Le.fillStyle||"#000000",this.isFillTransparent=Le.isFillTransparent||!1,this.fillOpacity=Le.fillOpacity||1,this.font=Le.font||"10px sans-serif",this.textBaseline=Le.textBaseline||"alphabetic",this.textAlign=Le.textAlign||"left",this.lineWidth=Le.lineWidth||1,this.lineJoin=Le.lineJoin||"miter",this.lineCap=Le.lineCap||"butt",this.path=Le.path||[],this.transform=Le.transform!==void 0?Le.transform.clone():new g,this.globalCompositeOperation=Le.globalCompositeOperation||"normal",this.globalAlpha=Le.globalAlpha||1,this.clip_path=Le.clip_path||[],this.currentPoint=Le.currentPoint||new l,this.miterLimit=Le.miterLimit||10,this.lastPoint=Le.lastPoint||new l,this.lineDashOffset=Le.lineDashOffset||0,this.lineDash=Le.lineDash||[],this.margin=Le.margin||[0,0,0,0],this.prevPageLastElemOffset=Le.prevPageLastElemOffset||0,this.ignoreClearRect=typeof Le.ignoreClearRect!="boolean"||Le.ignoreClearRect,this};i.events.push(["initialized",function(){this.context2d=new F(this),e=this.internal.f2,t=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,n=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,l=this.internal.Point,s=this.internal.Rectangle,g=this.internal.Matrix,v=new T}]);var F=function(Le){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Xe=Le;Object.defineProperty(this,"pdf",{get:function(){return Xe}});var it=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return it},set:function(kt){it=!!kt}});var pt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return pt},set:function(kt){pt=!!kt}});var mt=0;Object.defineProperty(this,"posX",{get:function(){return mt},set:function(kt){isNaN(kt)||(mt=kt)}});var Bt=0;Object.defineProperty(this,"posY",{get:function(){return Bt},set:function(kt){isNaN(kt)||(Bt=kt)}}),Object.defineProperty(this,"margin",{get:function(){return v.margin},set:function(kt){var lt;typeof kt=="number"?lt=[kt,kt,kt,kt]:((lt=new Array(4))[0]=kt[0],lt[1]=kt.length>=2?kt[1]:lt[0],lt[2]=kt.length>=3?kt[2]:lt[0],lt[3]=kt.length>=4?kt[3]:lt[1]),v.margin=lt}});var Dt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Dt},set:function(kt){Dt=kt}});var Mt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Mt},set:function(kt){Mt=kt}});var qt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return qt},set:function(kt){qt=kt}}),Object.defineProperty(this,"ctx",{get:function(){return v},set:function(kt){kt instanceof T&&(v=kt)}}),Object.defineProperty(this,"path",{get:function(){return v.path},set:function(kt){v.path=kt}});var ni=[];Object.defineProperty(this,"ctxStack",{get:function(){return ni},set:function(kt){ni=kt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(kt){var lt;lt=R(kt),this.ctx.fillStyle=lt.style,this.ctx.isFillTransparent=lt.a===0,this.ctx.fillOpacity=lt.a,this.pdf.setFillColor(lt.r,lt.g,lt.b,{a:lt.a}),this.pdf.setTextColor(lt.r,lt.g,lt.b,{a:lt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(kt){var lt=R(kt);this.ctx.strokeStyle=lt.style,this.ctx.isStrokeTransparent=lt.a===0,this.ctx.strokeOpacity=lt.a,lt.a===0?this.pdf.setDrawColor(255,255,255):(lt.a,this.pdf.setDrawColor(lt.r,lt.g,lt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(kt){["butt","round","square"].indexOf(kt)!==-1&&(this.ctx.lineCap=kt,this.pdf.setLineCap(kt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(kt){isNaN(kt)||(this.ctx.lineWidth=kt,this.pdf.setLineWidth(kt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(kt){["bevel","round","miter"].indexOf(kt)!==-1&&(this.ctx.lineJoin=kt,this.pdf.setLineJoin(kt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(kt){isNaN(kt)||(this.ctx.miterLimit=kt,this.pdf.setMiterLimit(kt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(kt){this.ctx.textBaseline=kt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(kt){["right","end","center","left","start"].indexOf(kt)!==-1&&(this.ctx.textAlign=kt)}});var _i=null;function vi(kt,lt){if(_i===null){var wt=function(Oi){var ti=[];return Object.keys(Oi).forEach(function(ht){Oi[ht].forEach(function($t){var oi=null;switch($t){case"bold":oi={family:ht,weight:"bold"};break;case"italic":oi={family:ht,style:"italic"};break;case"bolditalic":oi={family:ht,weight:"bold",style:"italic"};break;case"":case"normal":oi={family:ht}}oi!==null&&(oi.ref={name:ht,style:$t},ti.push(oi))})}),ti}(kt.getFontList());_i=function(Oi){for(var ti={},ht=0;ht<Oi.length;++ht){var $t=FC(Oi[ht]),oi=$t.family,gi=$t.stretch,ci=$t.style,Ki=$t.weight;ti[oi]=ti[oi]||{},ti[oi][gi]=ti[oi][gi]||{},ti[oi][gi][ci]=ti[oi][gi][ci]||{},ti[oi][gi][ci][Ki]=$t}return ti}(wt.concat(lt))}return _i}var Pi=null;Object.defineProperty(this,"fontFaces",{get:function(){return Pi},set:function(kt){_i=null,Pi=kt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(kt){var lt;if(this.ctx.font=kt,(lt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(kt))!==null){var wt=lt[1],Oi=(lt[2],lt[3]),ti=lt[4],ht=(lt[5],lt[6]),$t=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(ti)[2];ti=Math.floor($t==="px"?parseFloat(ti)*this.pdf.internal.scaleFactor:$t==="em"?parseFloat(ti)*this.pdf.getFontSize():parseFloat(ti)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(ti);var oi=function(zt){var Wi,hi,Wt=[],Ar=zt.trim();if(Ar==="")return H4;if(Ar in U4)return[U4[Ar]];for(;Ar!=="";){switch(hi=null,Wi=(Ar=z4(Ar)).charAt(0)){case'"':case"'":hi=cre(Ar.substring(1),Wi);break;default:hi=ure(Ar)}if(hi===null||(Wt.push(hi[0]),(Ar=z4(hi[1]))!==""&&Ar.charAt(0)!==","))return H4;Ar=Ar.replace(/^,/,"")}return Wt}(ht);if(this.fontFaces){var gi=lre(vi(this.pdf,this.fontFaces),oi.map(function(zt){return{family:zt,stretch:"normal",weight:Oi,style:wt}}));this.pdf.setFont(gi.ref.name,gi.ref.style)}else{var ci="";(Oi==="bold"||parseInt(Oi,10)>=700||wt==="bold")&&(ci="bold"),wt==="italic"&&(ci+="italic"),ci.length===0&&(ci="normal");for(var Ki="",tr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},pr=0;pr<oi.length;pr++){if(this.pdf.internal.getFont(oi[pr],ci,{noFallback:!0,disableWarning:!0})!==void 0){Ki=oi[pr];break}if(ci==="bolditalic"&&this.pdf.internal.getFont(oi[pr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ki=oi[pr],ci="bold";else if(this.pdf.internal.getFont(oi[pr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ki=oi[pr],ci="normal";break}}if(Ki===""){for(var Mr=0;Mr<oi.length;Mr++)if(tr[oi[Mr]]){Ki=tr[oi[Mr]];break}}Ki=Ki===""?"Times":Ki,this.pdf.setFont(Ki,ci)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(kt){this.ctx.globalCompositeOperation=kt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(kt){this.ctx.globalAlpha=kt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(kt){this.ctx.lineDashOffset=kt,Xt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(kt){this.ctx.lineDash=kt,Xt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(kt){this.ctx.ignoreClearRect=!!kt}})};F.prototype.setLineDash=function(Le){this.lineDash=Le},F.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},F.prototype.fill=function(){Te.call(this,"fill",!1)},F.prototype.stroke=function(){Te.call(this,"stroke",!1)},F.prototype.beginPath=function(){this.path=[{type:"begin"}]},F.prototype.moveTo=function(Le,Xe){if(isNaN(Le)||isNaN(Xe))throw Ls.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var it=this.ctx.transform.applyToPoint(new l(Le,Xe));this.path.push({type:"mt",x:it.x,y:it.y}),this.ctx.lastPoint=new l(Le,Xe)},F.prototype.closePath=function(){var Le=new l(0,0),Xe=0;for(Xe=this.path.length-1;Xe!==-1;Xe--)if(this.path[Xe].type==="begin"&&Yn(this.path[Xe+1])==="object"&&typeof this.path[Xe+1].x=="number"){Le=new l(this.path[Xe+1].x,this.path[Xe+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new l(Le.x,Le.y)},F.prototype.lineTo=function(Le,Xe){if(isNaN(Le)||isNaN(Xe))throw Ls.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var it=this.ctx.transform.applyToPoint(new l(Le,Xe));this.path.push({type:"lt",x:it.x,y:it.y}),this.ctx.lastPoint=new l(it.x,it.y)},F.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),Te.call(this,null,!0)},F.prototype.quadraticCurveTo=function(Le,Xe,it,pt){if(isNaN(it)||isNaN(pt)||isNaN(Le)||isNaN(Xe))throw Ls.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var mt=this.ctx.transform.applyToPoint(new l(it,pt)),Bt=this.ctx.transform.applyToPoint(new l(Le,Xe));this.path.push({type:"qct",x1:Bt.x,y1:Bt.y,x:mt.x,y:mt.y}),this.ctx.lastPoint=new l(mt.x,mt.y)},F.prototype.bezierCurveTo=function(Le,Xe,it,pt,mt,Bt){if(isNaN(mt)||isNaN(Bt)||isNaN(Le)||isNaN(Xe)||isNaN(it)||isNaN(pt))throw Ls.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Dt=this.ctx.transform.applyToPoint(new l(mt,Bt)),Mt=this.ctx.transform.applyToPoint(new l(Le,Xe)),qt=this.ctx.transform.applyToPoint(new l(it,pt));this.path.push({type:"bct",x1:Mt.x,y1:Mt.y,x2:qt.x,y2:qt.y,x:Dt.x,y:Dt.y}),this.ctx.lastPoint=new l(Dt.x,Dt.y)},F.prototype.arc=function(Le,Xe,it,pt,mt,Bt){if(isNaN(Le)||isNaN(Xe)||isNaN(it)||isNaN(pt)||isNaN(mt))throw Ls.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Bt=!!Bt,!this.ctx.transform.isIdentity){var Dt=this.ctx.transform.applyToPoint(new l(Le,Xe));Le=Dt.x,Xe=Dt.y;var Mt=this.ctx.transform.applyToPoint(new l(0,it)),qt=this.ctx.transform.applyToPoint(new l(0,0));it=Math.sqrt(Math.pow(Mt.x-qt.x,2)+Math.pow(Mt.y-qt.y,2))}Math.abs(mt-pt)>=2*Math.PI&&(pt=0,mt=2*Math.PI),this.path.push({type:"arc",x:Le,y:Xe,radius:it,startAngle:pt,endAngle:mt,counterclockwise:Bt})},F.prototype.arcTo=function(Le,Xe,it,pt,mt){throw new Error("arcTo not implemented.")},F.prototype.rect=function(Le,Xe,it,pt){if(isNaN(Le)||isNaN(Xe)||isNaN(it)||isNaN(pt))throw Ls.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(Le,Xe),this.lineTo(Le+it,Xe),this.lineTo(Le+it,Xe+pt),this.lineTo(Le,Xe+pt),this.lineTo(Le,Xe),this.lineTo(Le+it,Xe),this.lineTo(Le,Xe)},F.prototype.fillRect=function(Le,Xe,it,pt){if(isNaN(Le)||isNaN(Xe)||isNaN(it)||isNaN(pt))throw Ls.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!U.call(this)){var mt={};this.lineCap!=="butt"&&(mt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(mt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(Le,Xe,it,pt),this.fill(),mt.hasOwnProperty("lineCap")&&(this.lineCap=mt.lineCap),mt.hasOwnProperty("lineJoin")&&(this.lineJoin=mt.lineJoin)}},F.prototype.strokeRect=function(Le,Xe,it,pt){if(isNaN(Le)||isNaN(Xe)||isNaN(it)||isNaN(pt))throw Ls.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");J.call(this)||(this.beginPath(),this.rect(Le,Xe,it,pt),this.stroke())},F.prototype.clearRect=function(Le,Xe,it,pt){if(isNaN(Le)||isNaN(Xe)||isNaN(it)||isNaN(pt))throw Ls.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(Le,Xe,it,pt))},F.prototype.save=function(Le){Le=typeof Le!="boolean"||Le;for(var Xe=this.pdf.internal.getCurrentPageInfo().pageNumber,it=0;it<this.pdf.internal.getNumberOfPages();it++)this.pdf.setPage(it+1),this.pdf.internal.out("q");if(this.pdf.setPage(Xe),Le){this.ctx.fontSize=this.pdf.internal.getFontSize();var pt=new T(this.ctx);this.ctxStack.push(this.ctx),this.ctx=pt}},F.prototype.restore=function(Le){Le=typeof Le!="boolean"||Le;for(var Xe=this.pdf.internal.getCurrentPageInfo().pageNumber,it=0;it<this.pdf.internal.getNumberOfPages();it++)this.pdf.setPage(it+1),this.pdf.internal.out("Q");this.pdf.setPage(Xe),Le&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},F.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var R=function(Le){var Xe,it,pt,mt;if(Le.isCanvasGradient===!0&&(Le=Le.getColor()),!Le)return{r:0,g:0,b:0,a:0,style:Le};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(Le))Xe=0,it=0,pt=0,mt=0;else{var Bt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(Le);if(Bt!==null)Xe=parseInt(Bt[1]),it=parseInt(Bt[2]),pt=parseInt(Bt[3]),mt=1;else if((Bt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(Le))!==null)Xe=parseInt(Bt[1]),it=parseInt(Bt[2]),pt=parseInt(Bt[3]),mt=parseFloat(Bt[4]);else{if(mt=1,typeof Le=="string"&&Le.charAt(0)!=="#"){var Dt=new w4(Le);Le=Dt.ok?Dt.toHex():"#000000"}Le.length===4?(Xe=Le.substring(1,2),Xe+=Xe,it=Le.substring(2,3),it+=it,pt=Le.substring(3,4),pt+=pt):(Xe=Le.substring(1,3),it=Le.substring(3,5),pt=Le.substring(5,7)),Xe=parseInt(Xe,16),it=parseInt(it,16),pt=parseInt(pt,16)}}return{r:Xe,g:it,b:pt,a:mt,style:Le}},U=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},J=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};F.prototype.fillText=function(Le,Xe,it,pt){if(isNaN(Xe)||isNaN(it)||typeof Le!="string")throw Ls.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(pt=isNaN(pt)?void 0:pt,!U.call(this)){var mt=bt(this.ctx.transform.rotation),Bt=this.ctx.transform.scaleX;De.call(this,{text:Le,x:Xe,y:it,scale:Bt,angle:mt,align:this.textAlign,maxWidth:pt})}},F.prototype.strokeText=function(Le,Xe,it,pt){if(isNaN(Xe)||isNaN(it)||typeof Le!="string")throw Ls.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!J.call(this)){pt=isNaN(pt)?void 0:pt;var mt=bt(this.ctx.transform.rotation),Bt=this.ctx.transform.scaleX;De.call(this,{text:Le,x:Xe,y:it,scale:Bt,renderingMode:"stroke",angle:mt,align:this.textAlign,maxWidth:pt})}},F.prototype.measureText=function(Le){if(typeof Le!="string")throw Ls.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Xe=this.pdf,it=this.pdf.internal.scaleFactor,pt=Xe.internal.getFontSize(),mt=Xe.getStringUnitWidth(Le)*pt/Xe.internal.scaleFactor,Bt=function(Dt){var Mt=(Dt=Dt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Mt}}),this};return new Bt({width:mt*=Math.round(96*it/72*1e4)/1e4})},F.prototype.scale=function(Le,Xe){if(isNaN(Le)||isNaN(Xe))throw Ls.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var it=new g(Le,0,0,Xe,0,0);this.ctx.transform=this.ctx.transform.multiply(it)},F.prototype.rotate=function(Le){if(isNaN(Le))throw Ls.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Xe=new g(Math.cos(Le),Math.sin(Le),-Math.sin(Le),Math.cos(Le),0,0);this.ctx.transform=this.ctx.transform.multiply(Xe)},F.prototype.translate=function(Le,Xe){if(isNaN(Le)||isNaN(Xe))throw Ls.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var it=new g(1,0,0,1,Le,Xe);this.ctx.transform=this.ctx.transform.multiply(it)},F.prototype.transform=function(Le,Xe,it,pt,mt,Bt){if(isNaN(Le)||isNaN(Xe)||isNaN(it)||isNaN(pt)||isNaN(mt)||isNaN(Bt))throw Ls.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Dt=new g(Le,Xe,it,pt,mt,Bt);this.ctx.transform=this.ctx.transform.multiply(Dt)},F.prototype.setTransform=function(Le,Xe,it,pt,mt,Bt){Le=isNaN(Le)?1:Le,Xe=isNaN(Xe)?0:Xe,it=isNaN(it)?0:it,pt=isNaN(pt)?1:pt,mt=isNaN(mt)?0:mt,Bt=isNaN(Bt)?0:Bt,this.ctx.transform=new g(Le,Xe,it,pt,mt,Bt)};var te=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};F.prototype.drawImage=function(Le,Xe,it,pt,mt,Bt,Dt,Mt,qt){var ni=this.pdf.getImageProperties(Le),_i=1,vi=1,Pi=1,kt=1;pt!==void 0&&Mt!==void 0&&(Pi=Mt/pt,kt=qt/mt,_i=ni.width/pt*Mt/pt,vi=ni.height/mt*qt/mt),Bt===void 0&&(Bt=Xe,Dt=it,Xe=0,it=0),pt!==void 0&&Mt===void 0&&(Mt=pt,qt=mt),pt===void 0&&Mt===void 0&&(Mt=ni.width,qt=ni.height);for(var lt,wt=this.ctx.transform.decompose(),Oi=bt(wt.rotate.shx),ti=new g,ht=(ti=(ti=(ti=ti.multiply(wt.translate)).multiply(wt.skew)).multiply(wt.scale)).applyToRectangle(new s(Bt-Xe*Pi,Dt-it*kt,pt*_i,mt*vi)),$t=Ae.call(this,ht),oi=[],gi=0;gi<$t.length;gi+=1)oi.indexOf($t[gi])===-1&&oi.push($t[gi]);if(be(oi),this.autoPaging)for(var ci=oi[0],Ki=oi[oi.length-1],tr=ci;tr<Ki+1;tr++){this.pdf.setPage(tr);var pr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Mr=tr===1?this.posY+this.margin[0]:this.margin[0],zt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Wi=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],hi=tr===1?0:zt+(tr-2)*Wi;if(this.ctx.clip_path.length!==0){var Wt=this.path;lt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=pe(lt,this.posX+this.margin[3],-hi+Mr+this.ctx.prevPageLastElemOffset),qe.call(this,"fill",!0),this.path=Wt}var Ar=JSON.parse(JSON.stringify(ht));Ar=pe([Ar],this.posX+this.margin[3],-hi+Mr+this.ctx.prevPageLastElemOffset)[0];var Qt=(tr>ci||tr<Ki)&&te.call(this);Qt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],pr,Wi,null).clip().discardPath()),this.pdf.addImage(Le,"JPEG",Ar.x,Ar.y,Ar.w,Ar.h,null,null,Oi),Qt&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(Le,"JPEG",ht.x,ht.y,ht.w,ht.h,null,null,Oi)};var Ae=function(Le,Xe,it){var pt=[];Xe=Xe||this.pdf.internal.pageSize.width,it=it||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var mt=this.posY+this.ctx.prevPageLastElemOffset;switch(Le.type){default:case"mt":case"lt":pt.push(Math.floor((Le.y+mt)/it)+1);break;case"arc":pt.push(Math.floor((Le.y+mt-Le.radius)/it)+1),pt.push(Math.floor((Le.y+mt+Le.radius)/it)+1);break;case"qct":var Bt=Rt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Le.x1,Le.y1,Le.x,Le.y);pt.push(Math.floor((Bt.y+mt)/it)+1),pt.push(Math.floor((Bt.y+Bt.h+mt)/it)+1);break;case"bct":var Dt=Ft(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Le.x1,Le.y1,Le.x2,Le.y2,Le.x,Le.y);pt.push(Math.floor((Dt.y+mt)/it)+1),pt.push(Math.floor((Dt.y+Dt.h+mt)/it)+1);break;case"rect":pt.push(Math.floor((Le.y+mt)/it)+1),pt.push(Math.floor((Le.y+Le.h+mt)/it)+1)}for(var Mt=0;Mt<pt.length;Mt+=1)for(;this.pdf.internal.getNumberOfPages()<pt[Mt];)he.call(this);return pt},he=function(){var Le=this.fillStyle,Xe=this.strokeStyle,it=this.font,pt=this.lineCap,mt=this.lineWidth,Bt=this.lineJoin;this.pdf.addPage(),this.fillStyle=Le,this.strokeStyle=Xe,this.font=it,this.lineCap=pt,this.lineWidth=mt,this.lineJoin=Bt},pe=function(Le,Xe,it){for(var pt=0;pt<Le.length;pt++)switch(Le[pt].type){case"bct":Le[pt].x2+=Xe,Le[pt].y2+=it;case"qct":Le[pt].x1+=Xe,Le[pt].y1+=it;case"mt":case"lt":case"arc":default:Le[pt].x+=Xe,Le[pt].y+=it}return Le},be=function(Le){return Le.sort(function(Xe,it){return Xe-it})},Te=function(Le,Xe){for(var it,pt,mt=this.fillStyle,Bt=this.strokeStyle,Dt=this.lineCap,Mt=this.lineWidth,qt=Math.abs(Mt*this.ctx.transform.scaleX),ni=this.lineJoin,_i=JSON.parse(JSON.stringify(this.path)),vi=JSON.parse(JSON.stringify(this.path)),Pi=[],kt=0;kt<vi.length;kt++)if(vi[kt].x!==void 0)for(var lt=Ae.call(this,vi[kt]),wt=0;wt<lt.length;wt+=1)Pi.indexOf(lt[wt])===-1&&Pi.push(lt[wt]);for(var Oi=0;Oi<Pi.length;Oi++)for(;this.pdf.internal.getNumberOfPages()<Pi[Oi];)he.call(this);if(be(Pi),this.autoPaging)for(var ti=Pi[0],ht=Pi[Pi.length-1],$t=ti;$t<ht+1;$t++){this.pdf.setPage($t),this.fillStyle=mt,this.strokeStyle=Bt,this.lineCap=Dt,this.lineWidth=qt,this.lineJoin=ni;var oi=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],gi=$t===1?this.posY+this.margin[0]:this.margin[0],ci=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ki=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],tr=$t===1?0:ci+($t-2)*Ki;if(this.ctx.clip_path.length!==0){var pr=this.path;it=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=pe(it,this.posX+this.margin[3],-tr+gi+this.ctx.prevPageLastElemOffset),qe.call(this,Le,!0),this.path=pr}if(pt=JSON.parse(JSON.stringify(_i)),this.path=pe(pt,this.posX+this.margin[3],-tr+gi+this.ctx.prevPageLastElemOffset),Xe===!1||$t===0){var Mr=($t>ti||$t<ht)&&te.call(this);Mr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],oi,Ki,null).clip().discardPath()),qe.call(this,Le,Xe),Mr&&this.pdf.restoreGraphicsState()}this.lineWidth=Mt}else this.lineWidth=qt,qe.call(this,Le,Xe),this.lineWidth=Mt;this.path=_i},qe=function(Le,Xe){if((Le!=="stroke"||Xe||!J.call(this))&&(Le==="stroke"||Xe||!U.call(this))){for(var it,pt,mt=[],Bt=this.path,Dt=0;Dt<Bt.length;Dt++){var Mt=Bt[Dt];switch(Mt.type){case"begin":mt.push({begin:!0});break;case"close":mt.push({close:!0});break;case"mt":mt.push({start:Mt,deltas:[],abs:[]});break;case"lt":var qt=mt.length;if(Bt[Dt-1]&&!isNaN(Bt[Dt-1].x)&&(it=[Mt.x-Bt[Dt-1].x,Mt.y-Bt[Dt-1].y],qt>0)){for(;qt>=0;qt--)if(mt[qt-1].close!==!0&&mt[qt-1].begin!==!0){mt[qt-1].deltas.push(it),mt[qt-1].abs.push(Mt);break}}break;case"bct":it=[Mt.x1-Bt[Dt-1].x,Mt.y1-Bt[Dt-1].y,Mt.x2-Bt[Dt-1].x,Mt.y2-Bt[Dt-1].y,Mt.x-Bt[Dt-1].x,Mt.y-Bt[Dt-1].y],mt[mt.length-1].deltas.push(it);break;case"qct":var ni=Bt[Dt-1].x+2/3*(Mt.x1-Bt[Dt-1].x),_i=Bt[Dt-1].y+2/3*(Mt.y1-Bt[Dt-1].y),vi=Mt.x+2/3*(Mt.x1-Mt.x),Pi=Mt.y+2/3*(Mt.y1-Mt.y),kt=Mt.x,lt=Mt.y;it=[ni-Bt[Dt-1].x,_i-Bt[Dt-1].y,vi-Bt[Dt-1].x,Pi-Bt[Dt-1].y,kt-Bt[Dt-1].x,lt-Bt[Dt-1].y],mt[mt.length-1].deltas.push(it);break;case"arc":mt.push({deltas:[],abs:[],arc:!0}),Array.isArray(mt[mt.length-1].abs)&&mt[mt.length-1].abs.push(Mt)}}pt=Xe?null:Le==="stroke"?"stroke":"fill";for(var wt=!1,Oi=0;Oi<mt.length;Oi++)if(mt[Oi].arc)for(var ti=mt[Oi].abs,ht=0;ht<ti.length;ht++){var $t=ti[ht];$t.type==="arc"?Ne.call(this,$t.x,$t.y,$t.radius,$t.startAngle,$t.endAngle,$t.counterclockwise,void 0,Xe,!wt):Ye.call(this,$t.x,$t.y),wt=!0}else if(mt[Oi].close===!0)this.pdf.internal.out("h"),wt=!1;else if(mt[Oi].begin!==!0){var oi=mt[Oi].start.x,gi=mt[Oi].start.y;Ze.call(this,mt[Oi].deltas,oi,gi),wt=!0}pt&&at.call(this,pt),Xe&&nt.call(this)}},je=function(Le){var Xe=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,it=Xe*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return Le-it;case"top":return Le+Xe-it;case"hanging":return Le+Xe-2*it;case"middle":return Le+Xe/2-it;case"ideographic":return Le;case"alphabetic":default:return Le}},We=function(Le){return Le+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};F.prototype.createLinearGradient=function(){var Le=function(){};return Le.colorStops=[],Le.addColorStop=function(Xe,it){this.colorStops.push([Xe,it])},Le.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},Le.isCanvasGradient=!0,Le},F.prototype.createPattern=function(){return this.createLinearGradient()},F.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Ne=function(Le,Xe,it,pt,mt,Bt,Dt,Mt,qt){for(var ni=Et.call(this,it,pt,mt,Bt),_i=0;_i<ni.length;_i++){var vi=ni[_i];_i===0&&(qt?ke.call(this,vi.x1+Le,vi.y1+Xe):Ye.call(this,vi.x1+Le,vi.y1+Xe)),Ct.call(this,Le,Xe,vi.x2,vi.y2,vi.x3,vi.y3,vi.x4,vi.y4)}Mt?nt.call(this):at.call(this,Dt)},at=function(Le){switch(Le){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},nt=function(){this.pdf.clip(),this.pdf.discardPath()},ke=function(Le,Xe){this.pdf.internal.out(t(Le)+" "+r(Xe)+" m")},De=function(Le){var Xe;switch(Le.align){case"right":case"end":Xe="right";break;case"center":Xe="center";break;case"left":case"start":default:Xe="left"}var it=this.pdf.getTextDimensions(Le.text),pt=je.call(this,Le.y),mt=We.call(this,pt)-it.h,Bt=this.ctx.transform.applyToPoint(new l(Le.x,pt)),Dt=this.ctx.transform.decompose(),Mt=new g;Mt=(Mt=(Mt=Mt.multiply(Dt.translate)).multiply(Dt.skew)).multiply(Dt.scale);for(var qt,ni,_i,vi=this.ctx.transform.applyToRectangle(new s(Le.x,pt,it.w,it.h)),Pi=Mt.applyToRectangle(new s(Le.x,mt,it.w,it.h)),kt=Ae.call(this,Pi),lt=[],wt=0;wt<kt.length;wt+=1)lt.indexOf(kt[wt])===-1&&lt.push(kt[wt]);if(be(lt),this.autoPaging)for(var Oi=lt[0],ti=lt[lt.length-1],ht=Oi;ht<ti+1;ht++){this.pdf.setPage(ht);var $t=ht===1?this.posY+this.margin[0]:this.margin[0],oi=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],gi=this.pdf.internal.pageSize.height-this.margin[2],ci=gi-this.margin[0],Ki=this.pdf.internal.pageSize.width-this.margin[1],tr=Ki-this.margin[3],pr=ht===1?0:oi+(ht-2)*ci;if(this.ctx.clip_path.length!==0){var Mr=this.path;qt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=pe(qt,this.posX+this.margin[3],-1*pr+$t),qe.call(this,"fill",!0),this.path=Mr}var zt=pe([JSON.parse(JSON.stringify(Pi))],this.posX+this.margin[3],-pr+$t+this.ctx.prevPageLastElemOffset)[0];Le.scale>=.01&&(ni=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ni*Le.scale),_i=this.lineWidth,this.lineWidth=_i*Le.scale);var Wi=this.autoPaging!=="text";if(Wi||zt.y+zt.h<=gi){if(Wi||zt.y>=$t&&zt.x<=Ki){var hi=Wi?Le.text:this.pdf.splitTextToSize(Le.text,Le.maxWidth||Ki-zt.x)[0],Wt=pe([JSON.parse(JSON.stringify(vi))],this.posX+this.margin[3],-pr+$t+this.ctx.prevPageLastElemOffset)[0],Ar=Wi&&(ht>Oi||ht<ti)&&te.call(this);Ar&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],tr,ci,null).clip().discardPath()),this.pdf.text(hi,Wt.x,Wt.y,{angle:Le.angle,align:Xe,renderingMode:Le.renderingMode}),Ar&&this.pdf.restoreGraphicsState()}}else zt.y<gi&&(this.ctx.prevPageLastElemOffset+=gi-zt.y);Le.scale>=.01&&(this.pdf.setFontSize(ni),this.lineWidth=_i)}else Le.scale>=.01&&(ni=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ni*Le.scale),_i=this.lineWidth,this.lineWidth=_i*Le.scale),this.pdf.text(Le.text,Bt.x+this.posX,Bt.y+this.posY,{angle:Le.angle,align:Xe,renderingMode:Le.renderingMode,maxWidth:Le.maxWidth}),Le.scale>=.01&&(this.pdf.setFontSize(ni),this.lineWidth=_i)},Ye=function(Le,Xe,it,pt){it=it||0,pt=pt||0,this.pdf.internal.out(t(Le+it)+" "+r(Xe+pt)+" l")},Ze=function(Le,Xe,it){return this.pdf.lines(Le,Xe,it,null,null)},Ct=function(Le,Xe,it,pt,mt,Bt,Dt,Mt){this.pdf.internal.out([e(n(it+Le)),e(o(pt+Xe)),e(n(mt+Le)),e(o(Bt+Xe)),e(n(Dt+Le)),e(o(Mt+Xe)),"c"].join(" "))},Et=function(Le,Xe,it,pt){for(var mt=2*Math.PI,Bt=Math.PI/2;Xe>it;)Xe-=mt;var Dt=Math.abs(it-Xe);Dt<mt&&pt&&(Dt=mt-Dt);for(var Mt=[],qt=pt?-1:1,ni=Xe;Dt>1e-5;){var _i=ni+qt*Math.min(Dt,Bt);Mt.push(Pt.call(this,Le,ni,_i)),Dt-=Math.abs(_i-ni),ni=_i}return Mt},Pt=function(Le,Xe,it){var pt=(it-Xe)/2,mt=Le*Math.cos(pt),Bt=Le*Math.sin(pt),Dt=mt,Mt=-Bt,qt=Dt*Dt+Mt*Mt,ni=qt+Dt*mt+Mt*Bt,_i=4/3*(Math.sqrt(2*qt*ni)-ni)/(Dt*Bt-Mt*mt),vi=Dt-_i*Mt,Pi=Mt+_i*Dt,kt=vi,lt=-Pi,wt=pt+Xe,Oi=Math.cos(wt),ti=Math.sin(wt);return{x1:Le*Math.cos(Xe),y1:Le*Math.sin(Xe),x2:vi*Oi-Pi*ti,y2:vi*ti+Pi*Oi,x3:kt*Oi-lt*ti,y3:kt*ti+lt*Oi,x4:Le*Math.cos(it),y4:Le*Math.sin(it)}},bt=function(Le){return 180*Le/Math.PI},Rt=function(Le,Xe,it,pt,mt,Bt){var Dt=Le+.5*(it-Le),Mt=Xe+.5*(pt-Xe),qt=mt+.5*(it-mt),ni=Bt+.5*(pt-Bt),_i=Math.min(Le,mt,Dt,qt),vi=Math.max(Le,mt,Dt,qt),Pi=Math.min(Xe,Bt,Mt,ni),kt=Math.max(Xe,Bt,Mt,ni);return new s(_i,Pi,vi-_i,kt-Pi)},Ft=function(Le,Xe,it,pt,mt,Bt,Dt,Mt){var qt,ni,_i,vi,Pi,kt,lt,wt,Oi,ti,ht,$t,oi,gi,ci=it-Le,Ki=pt-Xe,tr=mt-it,pr=Bt-pt,Mr=Dt-mt,zt=Mt-Bt;for(ni=0;ni<41;ni++)Oi=(lt=(_i=Le+(qt=ni/40)*ci)+qt*((Pi=it+qt*tr)-_i))+qt*(Pi+qt*(mt+qt*Mr-Pi)-lt),ti=(wt=(vi=Xe+qt*Ki)+qt*((kt=pt+qt*pr)-vi))+qt*(kt+qt*(Bt+qt*zt-kt)-wt),ni==0?(ht=Oi,$t=ti,oi=Oi,gi=ti):(ht=Math.min(ht,Oi),$t=Math.min($t,ti),oi=Math.max(oi,Oi),gi=Math.max(gi,ti));return new s(Math.round(ht),Math.round($t),Math.round(oi-ht),Math.round(gi-$t))},Xt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var Le,Xe,it=(Le=this.ctx.lineDash,Xe=this.ctx.lineDashOffset,JSON.stringify({lineDash:Le,lineDashOffset:Xe}));this.prevLineDash!==it&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=it)}}})(Hr.API),function(i){var e=function(o){var l,s,g,v,T,F,R,U,J,te;for(s=[],g=0,v=(o+=l="\0\0\0\0".slice(o.length%4||4)).length;v>g;g+=4)(T=(o.charCodeAt(g)<<24)+(o.charCodeAt(g+1)<<16)+(o.charCodeAt(g+2)<<8)+o.charCodeAt(g+3))!==0?(F=(T=((T=((T=((T=(T-(te=T%85))/85)-(J=T%85))/85)-(U=T%85))/85)-(R=T%85))/85)%85,s.push(F+33,R+33,U+33,J+33,te+33)):s.push(122);return function(Ae,he){for(var pe=he;pe>0;pe--)Ae.pop()}(s,l.length),String.fromCharCode.apply(String,s)+"~>"},t=function(o){var l,s,g,v,T,F=String,R="length",U=255,J="charCodeAt",te="slice",Ae="replace";for(o[te](-2),o=o[te](0,-2)[Ae](/\s/g,"")[Ae]("z","!!!!!"),g=[],v=0,T=(o+=l="uuuuu"[te](o[R]%5||5))[R];T>v;v+=5)s=52200625*(o[J](v)-33)+614125*(o[J](v+1)-33)+7225*(o[J](v+2)-33)+85*(o[J](v+3)-33)+(o[J](v+4)-33),g.push(U&s>>24,U&s>>16,U&s>>8,U&s);return function(he,pe){for(var be=pe;be>0;be--)he.pop()}(g,l[R]),F.fromCharCode.apply(F,g)},r=function(o){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),l.test(o)===!1)return"";for(var s="",g=0;g<o.length;g+=2)s+=String.fromCharCode("0x"+(o[g]+o[g+1]));return s},n=function(o){for(var l=new Uint8Array(o.length),s=o.length;s--;)l[s]=o.charCodeAt(s);return o=(l=xC(l)).reduce(function(g,v){return g+String.fromCharCode(v)},"")};i.processDataByFilters=function(o,l){var s=0,g=o||"",v=[];for(typeof(l=l||[])=="string"&&(l=[l]),s=0;s<l.length;s+=1)switch(l[s]){case"ASCII85Decode":case"/ASCII85Decode":g=t(g),v.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":g=e(g),v.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":g=r(g),v.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":g=g.split("").map(function(T){return("0"+T.charCodeAt().toString(16)).slice(-2)}).join("")+">",v.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":g=n(g),v.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[s]+'" is not implemented')}return{data:g,reverseChain:v.reverse().join(" ")}}}(Hr.API),function(i){i.loadFile=function(e,t,r){return function(n,o,l){o=o!==!1,l=typeof l=="function"?l:function(){};var s=void 0;try{s=function(g,v,T){var F=new XMLHttpRequest,R=0,U=function(J){var te=J.length,Ae=[],he=String.fromCharCode;for(R=0;R<te;R+=1)Ae.push(he(255&J.charCodeAt(R)));return Ae.join("")};if(F.open("GET",g,!v),F.overrideMimeType("text/plain; charset=x-user-defined"),v===!1&&(F.onload=function(){F.status===200?T(U(this.responseText)):T(void 0)}),F.send(null),v&&F.status===200)return U(F.responseText)}(n,o,l)}catch{}return s}(e,t,r)},i.loadImageFile=i.loadFile}(Hr.API),function(i){function e(){return(Vr.html2canvas?Promise.resolve(Vr.html2canvas):Promise.resolve().then(()=>due)).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function t(){return(Vr.DOMPurify?Promise.resolve(Vr.DOMPurify):Promise.resolve().then(()=>Hue)).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var r=function(l){var s=Yn(l);return s==="undefined"?"undefined":s==="string"||l instanceof String?"string":s==="number"||l instanceof Number?"number":s==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":s==="object"?"object":"unknown"},n=function(l,s){var g=document.createElement(l);for(var v in s.className&&(g.className=s.className),s.innerHTML&&s.dompurify&&(g.innerHTML=s.dompurify.sanitize(s.innerHTML)),s.style)g.style[v]=s.style[v];return g},o=function l(s){var g=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),v=l.convert(Promise.resolve(),g);return v=(v=v.setProgress(1,l,1,[l])).set(s)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(l,s){return l.__proto__=s||o.prototype,l},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(l,s){return this.then(function(){switch(s=s||function(g){switch(r(g)){case"string":return"string";case"element":return g.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(l)){case"string":return this.then(t).then(function(g){return this.set({src:n("div",{innerHTML:l,dompurify:g})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},o.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},s=function g(v,T){for(var F=v.nodeType===3?document.createTextNode(v.nodeValue):v.cloneNode(!1),R=v.firstChild;R;R=R.nextSibling)T!==!0&&R.nodeType===1&&R.nodeName==="SCRIPT"||F.appendChild(g(R,T));return v.nodeType===1&&(v.nodeName==="CANVAS"?(F.width=v.width,F.height=v.height,F.getContext("2d").drawImage(v,0,0)):v.nodeName!=="TEXTAREA"&&v.nodeName!=="SELECT"||(F.value=v.value),F.addEventListener("load",function(){F.scrollTop=v.scrollTop,F.scrollLeft=v.scrollLeft},!0)),F}(this.prop.src,this.opt.html2canvas.javascriptEnabled);s.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=n("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=n("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(s),this.prop.container.firstChild.appendChild(n("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(s){var g=Object.assign({},this.opt.html2canvas);return delete g.onrendered,s(this.prop.container,g)}).then(function(s){(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(s){var g=this.opt.jsPDF,v=this.opt.fontFaces,T=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,F=Object.assign({async:!0,allowTaint:!0,scale:T,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete F.onrendered,g.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,g.context2d.posX=this.opt.x,g.context2d.posY=this.opt.y,g.context2d.margin=this.opt.margin,g.context2d.fontFaces=v,v)for(var R=0;R<v.length;++R){var U=v[R],J=U.src.find(function(te){return te.format==="truetype"});J&&g.addFont(J.url,U.ref.name,U.ref.style)}return F.windowHeight=F.windowHeight||0,F.windowHeight=F.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):F.windowHeight,g.context2d.save(!0),s(this.prop.container,F)}).then(function(s){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(l,s,g){return(g=g||"pdf").toLowerCase()==="img"||g.toLowerCase()==="image"?this.outputImg(l,s):this.outputPdf(l,s)},o.prototype.outputPdf=function(l,s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,s)})},o.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},o.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(l){if(r(l)!=="object")return this;var s=Object.keys(l||{}).map(function(g){if(g in o.template.prop)return function(){this.prop[g]=l[g]};switch(g){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[g]=l[g]}}},this);return this.then(function(){return this.thenList(s)})},o.prototype.get=function(l,s){return this.then(function(){var g=l in o.template.prop?this.prop[l]:this.opt[l];return s?s(g):g})},o.prototype.setMargin=function(l){return this.then(function(){switch(r(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},o.prototype.setPageSize=function(l){function s(g,v){return Math.floor(g*v/72*96)}return this.then(function(){(l=l||Hr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:s(l.inner.width,l.k),height:s(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},o.prototype.setProgress=function(l,s,g,v){return l!=null&&(this.progress.val=l),s!=null&&(this.progress.state=s),g!=null&&(this.progress.n=g),v!=null&&(this.progress.stack=v),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(l,s,g,v){return this.setProgress(l?this.progress.val+l:null,s||null,g?this.progress.n+g:null,v?this.progress.stack.concat(v):null)},o.prototype.then=function(l,s){var g=this;return this.thenCore(l,s,function(v,T){return g.updateProgress(null,null,1,[v]),Promise.prototype.then.call(this,function(F){return g.updateProgress(null,v),F}).then(v,T).then(function(F){return g.updateProgress(1),F})})},o.prototype.thenCore=function(l,s,g){g=g||Promise.prototype.then,l&&(l=l.bind(this)),s&&(s=s.bind(this));var v=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:o.convert(Object.assign({},this),Promise.prototype),T=g.call(v,l,s);return o.convert(T,this.__proto__)},o.prototype.thenExternal=function(l,s){return Promise.prototype.then.call(this,l,s)},o.prototype.thenList=function(l){var s=this;return l.forEach(function(g){s=s.thenCore(g)}),s},o.prototype.catch=function(l){l&&(l=l.bind(this));var s=Promise.prototype.catch.call(this,l);return o.convert(s,this)},o.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},o.prototype.error=function(l){return this.then(function(){throw new Error(l)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Hr.getPageSize=function(l,s,g){if(Yn(l)==="object"){var v=l;l=v.orientation,s=v.unit||s,g=v.format||g}s=s||"mm",g=g||"a4",l=(""+(l||"P")).toLowerCase();var T,F=(""+g).toLowerCase(),R={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(s){case"pt":T=1;break;case"mm":T=72/25.4;break;case"cm":T=72/2.54;break;case"in":T=72;break;case"px":T=.75;break;case"pc":case"em":T=12;break;case"ex":T=6;break;default:throw"Invalid unit: "+s}var U,J=0,te=0;if(R.hasOwnProperty(F))J=R[F][1]/T,te=R[F][0]/T;else try{J=g[1],te=g[0]}catch{throw new Error("Invalid format: "+g)}if(l==="p"||l==="portrait")l="p",te>J&&(U=te,te=J,J=U);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",J>te&&(U=te,te=J,J=U)}return{width:te,height:J,unit:s,k:T,orientation:l}},i.html=function(l,s){(s=s||{}).callback=s.callback||function(){},s.html2canvas=s.html2canvas||{},s.html2canvas.canvas=s.html2canvas.canvas||this.canvas,s.jsPDF=s.jsPDF||this,s.fontFaces=s.fontFaces?s.fontFaces.map(FC):null;var g=new o(s);return s.worker?g:g.from(l).doCallback()}}(Hr.API),Hr.API.addJS=function(i){return V4=i,this.internal.events.subscribe("postPutResources",function(){av=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(av+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Q4=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+V4+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){av!==void 0&&Q4!==void 0&&this.internal.out("/Names <</JavaScript "+av+" 0 R>>")}),this},function(i){var e;i.events.push(["postPutResources",function(){var t=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=t.outline.render().split(/\r\n/),o=0;o<n.length;o++){var l=n[o],s=r.exec(l);if(s!=null){var g=s[1];t.internal.newObjectDeferredBegin(g,!1)}t.internal.write(l)}if(this.outline.createNamedDestinations){var v=this.internal.pages.length,T=[];for(o=0;o<v;o++){var F=t.internal.newObject();T.push(F);var R=t.internal.getPageInfo(o+1);t.internal.write("<< /D["+R.objId+" 0 R /XYZ null null null]>> endobj")}var U=t.internal.newObject();for(t.internal.write("<< /Names [ "),o=0;o<T.length;o++)t.internal.write("(page_"+(o+1)+")"+T[o]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+U+" 0 R"),t.internal.write(">>","endobj")}}]),i.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),i.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(r,n,o){var l={title:n,options:o,children:[]};return r==null&&(r=this.root),r.children.push(l),l},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(r){r.id=t.internal.newObjectDeferred();for(var n=0;n<r.children.length;n++)this.genIds_r(r.children[n])},t.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},t.outline.renderItems=function(r){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<r.children.length;o++){var l=r.children[o];this.objStart(l),this.line("/Title "+this.makeString(l.title)),this.line("/Parent "+this.makeRef(r)),o>0&&this.line("/Prev "+this.makeRef(r.children[o-1])),o<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[o+1])),l.children.length>0&&(this.line("/First "+this.makeRef(l.children[0])),this.line("/Last "+this.makeRef(l.children[l.children.length-1])));var s=this.count=this.count_r({count:0},l);if(s>0&&this.line("/Count "+s),l.options&&l.options.pageNumber){var g=t.internal.getPageInfo(l.options.pageNumber);this.line("/Dest ["+g.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var v=0;v<r.children.length;v++)this.renderItems(r.children[v])},t.outline.line=function(r){this.ctx.val+=r+`\r
`},t.outline.makeRef=function(r){return r.id+" 0 R"},t.outline.makeString=function(r){return"("+t.internal.pdfEscape(r)+")"},t.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(r,n){for(var o=0;o<n.children.length;o++)r.count++,this.count_r(r,n.children[o]);return r.count}}])}(Hr.API),function(i){var e=[192,193,194,195,196,197,198,199];i.processJPEG=function(t,r,n,o,l,s){var g,v=this.decode.DCT_DECODE,T=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=l||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,(g=function(F){for(var R,U=256*F.charCodeAt(4)+F.charCodeAt(5),J=F.length,te={width:0,height:0,numcomponents:1},Ae=4;Ae<J;Ae+=2){if(Ae+=U,e.indexOf(F.charCodeAt(Ae+1))!==-1){R=256*F.charCodeAt(Ae+5)+F.charCodeAt(Ae+6),te={width:256*F.charCodeAt(Ae+7)+F.charCodeAt(Ae+8),height:R,numcomponents:F.charCodeAt(Ae+9)};break}U=256*F.charCodeAt(Ae+2)+F.charCodeAt(Ae+3)}return te}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t)).numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}T={data:t,width:g.width,height:g.height,colorSpace:s,bitsPerComponent:8,filter:v,index:r,alias:n}}return T}}(Hr.API);var Lg,lv,G4,j4,q4,hre=function(){var i,e,t;function r(o){var l,s,g,v,T,F,R,U,J,te,Ae,he,pe,be;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},F=null;;){switch(l=this.readUInt32(),J=(function(){var Te,qe;for(qe=[],Te=0;Te<4;++Te)qe.push(String.fromCharCode(this.data[this.pos++]));return qe}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(l);break;case"fcTL":F&&this.animation.frames.push(F),this.pos+=4,F={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},T=this.readUInt16(),v=this.readUInt16()||100,F.delay=1e3*T/v,F.disposeOp=this.data[this.pos++],F.blendOp=this.data[this.pos++],F.data=[];break;case"IDAT":case"fdAT":for(J==="fdAT"&&(this.pos+=4,l-=4),o=(F!=null?F.data:void 0)||this.imgData,he=0;0<=l?he<l:he>l;0<=l?++he:--he)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(g=this.palette.length/3,this.transparency.indexed=this.read(l),this.transparency.indexed.length>g)throw new Error("More transparent colors than palette size");if((te=g-this.transparency.indexed.length)>0)for(pe=0;0<=te?pe<te:pe>te;0<=te?++pe:--pe)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(l)[0];break;case 2:this.transparency.rgb=this.read(l)}break;case"tEXt":R=(Ae=this.read(l)).indexOf(0),U=String.fromCharCode.apply(String,Ae.slice(0,R)),this.text[U]=String.fromCharCode.apply(String,Ae.slice(R+1));break;case"IEND":return F&&this.animation.frames.push(F),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(be=this.colorType)===4||be===6,s=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*s,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=l}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(o){var l,s;for(s=[],l=0;0<=o?l<o:l>o;0<=o?++l:--l)s.push(this.data[this.pos++]);return s},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(o){var l=this.pixelBitlength/8,s=new Uint8Array(this.width*this.height*l),g=0,v=this;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);function T(F,R,U,J){var te,Ae,he,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Ze,Ct,Et,Pt,bt,Rt,Ft=Math.ceil((v.width-F)/U),Xt=Math.ceil((v.height-R)/J),Le=v.width==Ft&&v.height==Xt;for(De=l*Ft,nt=Le?s:new Uint8Array(De*Xt),Te=o.length,ke=0,Ae=0;ke<Xt&&g<Te;){switch(o[g++]){case 0:for(pe=Ct=0;Ct<De;pe=Ct+=1)nt[Ae++]=o[g++];break;case 1:for(pe=Et=0;Et<De;pe=Et+=1)te=o[g++],be=pe<l?0:nt[Ae-l],nt[Ae++]=(te+be)%256;break;case 2:for(pe=Pt=0;Pt<De;pe=Pt+=1)te=o[g++],he=(pe-pe%l)/l,Ye=ke&&nt[(ke-1)*De+he*l+pe%l],nt[Ae++]=(Ye+te)%256;break;case 3:for(pe=bt=0;bt<De;pe=bt+=1)te=o[g++],he=(pe-pe%l)/l,be=pe<l?0:nt[Ae-l],Ye=ke&&nt[(ke-1)*De+he*l+pe%l],nt[Ae++]=(te+Math.floor((be+Ye)/2))%256;break;case 4:for(pe=Rt=0;Rt<De;pe=Rt+=1)te=o[g++],he=(pe-pe%l)/l,be=pe<l?0:nt[Ae-l],ke===0?Ye=Ze=0:(Ye=nt[(ke-1)*De+he*l+pe%l],Ze=he&&nt[(ke-1)*De+(he-1)*l+pe%l]),qe=be+Ye-Ze,je=Math.abs(qe-be),Ne=Math.abs(qe-Ye),at=Math.abs(qe-Ze),We=je<=Ne&&je<=at?be:Ne<=at?Ye:Ze,nt[Ae++]=(te+We)%256;break;default:throw new Error("Invalid filter algorithm: "+o[g-1])}if(!Le){var Xe=((R+ke*J)*v.width+F)*l,it=ke*De;for(pe=0;pe<Ft;pe+=1){for(var pt=0;pt<l;pt+=1)s[Xe++]=nt[it++];Xe+=(U-1)*l}}ke++}}return o=jie(o),v.interlaceMethod==1?(T(0,0,8,8),T(4,0,8,8),T(0,4,4,8),T(2,0,4,4),T(0,2,2,4),T(1,0,2,2),T(0,1,1,2)):T(0,0,1,1),s},r.prototype.decodePalette=function(){var o,l,s,g,v,T,F,R,U;for(s=this.palette,T=this.transparency.indexed||[],v=new Uint8Array((T.length||0)+s.length),g=0,o=0,l=F=0,R=s.length;F<R;l=F+=3)v[g++]=s[l],v[g++]=s[l+1],v[g++]=s[l+2],v[g++]=(U=T[o++])!=null?U:255;return v},r.prototype.copyToImageData=function(o,l){var s,g,v,T,F,R,U,J,te,Ae,he;if(g=this.colors,te=null,s=this.hasAlphaChannel,this.palette.length&&(te=(he=this._decodedPalette)!=null?he:this._decodedPalette=this.decodePalette(),g=4,s=!0),J=(v=o.data||o).length,F=te||l,T=R=0,g===1)for(;T<J;)U=te?4*l[T/4]:R,Ae=F[U++],v[T++]=Ae,v[T++]=Ae,v[T++]=Ae,v[T++]=s?F[U++]:255,R=U;else for(;T<J;)U=te?4*l[T/4]:R,v[T++]=F[U++],v[T++]=F[U++],v[T++]=F[U++],v[T++]=s?F[U++]:255,R=U},r.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o};var n=function(){if(Object.prototype.toString.call(Vr)==="[object Window]"){try{e=Vr.document.createElement("canvas"),t=e.getContext("2d")}catch{return!1}return!0}return!1};return n(),i=function(o){var l;if(n()===!0)return t.width=o.width,t.height=o.height,t.clearRect(0,0,o.width,o.height),t.putImageData(o,0,0),(l=new Image).src=e.toDataURL(),l;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(o){var l,s,g,v,T,F,R,U;if(this.animation){for(U=[],s=T=0,F=(R=this.animation.frames).length;T<F;s=++T)l=R[s],g=o.createImageData(l.width,l.height),v=this.decodePixels(new Uint8Array(l.data)),this.copyToImageData(g,v),l.imageData=g,U.push(l.image=i(g));return U}},r.prototype.renderFrame=function(o,l){var s,g,v;return s=(g=this.animation.frames)[l],v=g[l-1],l===0&&o.clearRect(0,0,this.width,this.height),(v!=null?v.disposeOp:void 0)===1?o.clearRect(v.xOffset,v.yOffset,v.width,v.height):(v!=null?v.disposeOp:void 0)===2&&o.putImageData(v.imageData,v.xOffset,v.yOffset),s.blendOp===0&&o.clearRect(s.xOffset,s.yOffset,s.width,s.height),o.drawImage(s.image,s.xOffset,s.yOffset)},r.prototype.animate=function(o){var l,s,g,v,T,F,R=this;return s=0,F=this.animation,v=F.numFrames,g=F.frames,T=F.numPlays,(l=function(){var U,J;if(U=s++%v,J=g[U],R.renderFrame(o,U),v>1&&s/v<T)return R.animation._timeout=setTimeout(l,J.delay)})()},r.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},r.prototype.render=function(o){var l,s;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,l=o.getContext("2d"),this.animation?(this.decodeFrames(l),this.animate(l)):(s=l.createImageData(this.width,this.height),this.copyToImageData(s,this.decodePixels()),l.putImageData(s,0,0))},r}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function Are(i){var e=0;if(i[e++]!==71||i[e++]!==73||i[e++]!==70||i[e++]!==56||(i[e++]+1&253)!=56||i[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=i[e++]|i[e++]<<8,r=i[e++]|i[e++]<<8,n=i[e++],o=n>>7,l=1<<(7&n)+1;i[e++],i[e++];var s=null,g=null;o&&(s=e,g=l,e+=3*l);var v=!0,T=[],F=0,R=null,U=0,J=null;for(this.width=t,this.height=r;v&&e<i.length;)switch(i[e++]){case 33:switch(i[e++]){case 255:if(i[e]!==11||i[e+1]==78&&i[e+2]==69&&i[e+3]==84&&i[e+4]==83&&i[e+5]==67&&i[e+6]==65&&i[e+7]==80&&i[e+8]==69&&i[e+9]==50&&i[e+10]==46&&i[e+11]==48&&i[e+12]==3&&i[e+13]==1&&i[e+16]==0)e+=14,J=i[e++]|i[e++]<<8,e++;else for(e+=12;;){if(!((ke=i[e++])>=0))throw Error("Invalid block size");if(ke===0)break;e+=ke}break;case 249:if(i[e++]!==4||i[e+4]!==0)throw new Error("Invalid graphics extension block.");var te=i[e++];F=i[e++]|i[e++]<<8,R=i[e++],!(1&te)&&(R=null),U=te>>2&7,e++;break;case 254:for(;;){if(!((ke=i[e++])>=0))throw Error("Invalid block size");if(ke===0)break;e+=ke}break;default:throw new Error("Unknown graphic control label: 0x"+i[e-1].toString(16))}break;case 44:var Ae=i[e++]|i[e++]<<8,he=i[e++]|i[e++]<<8,pe=i[e++]|i[e++]<<8,be=i[e++]|i[e++]<<8,Te=i[e++],qe=Te>>6&1,je=1<<(7&Te)+1,We=s,Ne=g,at=!1;Te>>7&&(at=!0,We=e,Ne=je,e+=3*je);var nt=e;for(e++;;){var ke;if(!((ke=i[e++])>=0))throw Error("Invalid block size");if(ke===0)break;e+=ke}T.push({x:Ae,y:he,width:pe,height:be,has_local_palette:at,palette_offset:We,palette_size:Ne,data_offset:nt,data_length:e-nt,transparent_index:R,interlaced:!!qe,delay:F,disposal:U});break;case 59:v=!1;break;default:throw new Error("Unknown gif block: 0x"+i[e-1].toString(16))}this.numFrames=function(){return T.length},this.loopCount=function(){return J},this.frameInfo=function(De){if(De<0||De>=T.length)throw new Error("Frame index out of range.");return T[De]},this.decodeAndBlitFrameBGRA=function(De,Ye){var Ze=this.frameInfo(De),Ct=Ze.width*Ze.height,Et=new Uint8Array(Ct);$4(i,Ze.data_offset,Et,Ct);var Pt=Ze.palette_offset,bt=Ze.transparent_index;bt===null&&(bt=256);var Rt=Ze.width,Ft=t-Rt,Xt=Rt,Le=4*(Ze.y*t+Ze.x),Xe=4*((Ze.y+Ze.height)*t+Ze.x),it=Le,pt=4*Ft;Ze.interlaced===!0&&(pt+=4*t*7);for(var mt=8,Bt=0,Dt=Et.length;Bt<Dt;++Bt){var Mt=Et[Bt];if(Xt===0&&(Xt=Rt,(it+=pt)>=Xe&&(pt=4*Ft+4*t*(mt-1),it=Le+(Rt+Ft)*(mt<<1),mt>>=1)),Mt===bt)it+=4;else{var qt=i[Pt+3*Mt],ni=i[Pt+3*Mt+1],_i=i[Pt+3*Mt+2];Ye[it++]=_i,Ye[it++]=ni,Ye[it++]=qt,Ye[it++]=255}--Xt}},this.decodeAndBlitFrameRGBA=function(De,Ye){var Ze=this.frameInfo(De),Ct=Ze.width*Ze.height,Et=new Uint8Array(Ct);$4(i,Ze.data_offset,Et,Ct);var Pt=Ze.palette_offset,bt=Ze.transparent_index;bt===null&&(bt=256);var Rt=Ze.width,Ft=t-Rt,Xt=Rt,Le=4*(Ze.y*t+Ze.x),Xe=4*((Ze.y+Ze.height)*t+Ze.x),it=Le,pt=4*Ft;Ze.interlaced===!0&&(pt+=4*t*7);for(var mt=8,Bt=0,Dt=Et.length;Bt<Dt;++Bt){var Mt=Et[Bt];if(Xt===0&&(Xt=Rt,(it+=pt)>=Xe&&(pt=4*Ft+4*t*(mt-1),it=Le+(Rt+Ft)*(mt<<1),mt>>=1)),Mt===bt)it+=4;else{var qt=i[Pt+3*Mt],ni=i[Pt+3*Mt+1],_i=i[Pt+3*Mt+2];Ye[it++]=qt,Ye[it++]=ni,Ye[it++]=_i,Ye[it++]=255}--Xt}}}function $4(i,e,t,r){for(var n=i[e++],o=1<<n,l=o+1,s=l+1,g=n+1,v=(1<<g)-1,T=0,F=0,R=0,U=i[e++],J=new Int32Array(4096),te=null;;){for(;T<16&&U!==0;)F|=i[e++]<<T,T+=8,U===1?U=i[e++]:--U;if(T<g)break;var Ae=F&v;if(F>>=g,T-=g,Ae!==o){if(Ae===l)break;for(var he=Ae<s?Ae:te,pe=0,be=he;be>o;)be=J[be]>>8,++pe;var Te=be;if(R+pe+(he!==Ae?1:0)>r)return void Ls.log("Warning, gif stream longer than expected.");t[R++]=Te;var qe=R+=pe;for(he!==Ae&&(t[R++]=Te),be=he;pe--;)be=J[be],t[--qe]=255&be,be>>=8;te!==null&&s<4096&&(J[s++]=te<<8|Te,s>=v+1&&g<12&&(++g,v=v<<1|1)),te=Ae}else s=l+1,v=(1<<(g=n+1))-1,te=null}return R!==r&&Ls.log("Warning, gif stream shorter than expected."),t}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function DC(i){var e,t,r,n,o,l=Math.floor,s=new Array(64),g=new Array(64),v=new Array(64),T=new Array(64),F=new Array(65535),R=new Array(65535),U=new Array(64),J=new Array(64),te=[],Ae=0,he=7,pe=new Array(64),be=new Array(64),Te=new Array(64),qe=new Array(256),je=new Array(2048),We=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ne=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],at=[0,1,2,3,4,5,6,7,8,9,10,11],nt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ke=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],De=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ye=[0,1,2,3,4,5,6,7,8,9,10,11],Ze=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Ct=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Et(Le,Xe){for(var it=0,pt=0,mt=new Array,Bt=1;Bt<=16;Bt++){for(var Dt=1;Dt<=Le[Bt];Dt++)mt[Xe[pt]]=[],mt[Xe[pt]][0]=it,mt[Xe[pt]][1]=Bt,pt++,it++;it*=2}return mt}function Pt(Le){for(var Xe=Le[0],it=Le[1]-1;it>=0;)Xe&1<<it&&(Ae|=1<<he),it--,--he<0&&(Ae==255?(bt(255),bt(0)):bt(Ae),he=7,Ae=0)}function bt(Le){te.push(Le)}function Rt(Le){bt(Le>>8&255),bt(255&Le)}function Ft(Le,Xe,it,pt,mt){for(var Bt,Dt=mt[0],Mt=mt[240],qt=function(ti,ht){var $t,oi,gi,ci,Ki,tr,pr,Mr,zt,Wi,hi=0;for(zt=0;zt<8;++zt){$t=ti[hi],oi=ti[hi+1],gi=ti[hi+2],ci=ti[hi+3],Ki=ti[hi+4],tr=ti[hi+5],pr=ti[hi+6];var Wt=$t+(Mr=ti[hi+7]),Ar=$t-Mr,Qt=oi+pr,Si=oi-pr,Ii=gi+tr,Zt=gi-tr,bi=ci+Ki,ei=ci-Ki,_r=Wt+bi,Zr=Wt-bi,Qe=Qt+Ii,Be=Qt-Ii;ti[hi]=_r+Qe,ti[hi+4]=_r-Qe;var ce=.707106781*(Be+Zr);ti[hi+2]=Zr+ce,ti[hi+6]=Zr-ce;var ie=.382683433*((_r=ei+Zt)-(Be=Si+Ar)),ue=.5411961*_r+ie,ge=1.306562965*Be+ie,xe=.707106781*(Qe=Zt+Si),Ee=Ar+xe,we=Ar-xe;ti[hi+5]=we+ue,ti[hi+3]=we-ue,ti[hi+1]=Ee+ge,ti[hi+7]=Ee-ge,hi+=8}for(hi=0,zt=0;zt<8;++zt){$t=ti[hi],oi=ti[hi+8],gi=ti[hi+16],ci=ti[hi+24],Ki=ti[hi+32],tr=ti[hi+40],pr=ti[hi+48];var Fe=$t+(Mr=ti[hi+56]),ze=$t-Mr,Ge=oi+pr,st=oi-pr,vt=gi+tr,Tt=gi-tr,Kt=ci+Ki,ii=ci-Ki,Gt=Fe+Kt,Ai=Fe-Kt,Bi=Ge+vt,Hi=Ge-vt;ti[hi]=Gt+Bi,ti[hi+32]=Gt-Bi;var Ci=.707106781*(Hi+Ai);ti[hi+16]=Ai+Ci,ti[hi+48]=Ai-Ci;var Ni=.382683433*((Gt=ii+Tt)-(Hi=st+ze)),ot=.5411961*Gt+Ni,ri=1.306562965*Hi+Ni,Vt=.707106781*(Bi=Tt+st),Vi=ze+Vt,lr=ze-Vt;ti[hi+40]=lr+ot,ti[hi+24]=lr-ot,ti[hi+8]=Vi+ri,ti[hi+56]=Vi-ri,hi++}for(zt=0;zt<64;++zt)Wi=ti[zt]*ht[zt],U[zt]=Wi>0?Wi+.5|0:Wi-.5|0;return U}(Le,Xe),ni=0;ni<64;++ni)J[We[ni]]=qt[ni];var _i=J[0]-it;it=J[0],_i==0?Pt(pt[0]):(Pt(pt[R[Bt=32767+_i]]),Pt(F[Bt]));for(var vi=63;vi>0&&J[vi]==0;)vi--;if(vi==0)return Pt(Dt),it;for(var Pi,kt=1;kt<=vi;){for(var lt=kt;J[kt]==0&&kt<=vi;)++kt;var wt=kt-lt;if(wt>=16){Pi=wt>>4;for(var Oi=1;Oi<=Pi;++Oi)Pt(Mt);wt&=15}Bt=32767+J[kt],Pt(mt[(wt<<4)+R[Bt]]),Pt(F[Bt]),kt++}return vi!=63&&Pt(Dt),it}function Xt(Le){Le=Math.min(Math.max(Le,1),100),o!=Le&&(function(Xe){for(var it=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],pt=0;pt<64;pt++){var mt=l((it[pt]*Xe+50)/100);mt=Math.min(Math.max(mt,1),255),s[We[pt]]=mt}for(var Bt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Dt=0;Dt<64;Dt++){var Mt=l((Bt[Dt]*Xe+50)/100);Mt=Math.min(Math.max(Mt,1),255),g[We[Dt]]=Mt}for(var qt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ni=0,_i=0;_i<8;_i++)for(var vi=0;vi<8;vi++)v[ni]=1/(s[We[ni]]*qt[_i]*qt[vi]*8),T[ni]=1/(g[We[ni]]*qt[_i]*qt[vi]*8),ni++}(Le<50?Math.floor(5e3/Le):Math.floor(200-2*Le)),o=Le)}this.encode=function(Le,Xe){Xe&&Xt(Xe),te=new Array,Ae=0,he=7,Rt(65496),Rt(65504),Rt(16),bt(74),bt(70),bt(73),bt(70),bt(0),bt(1),bt(1),bt(0),Rt(1),Rt(1),bt(0),bt(0),function(){Rt(65499),Rt(132),bt(0);for(var oi=0;oi<64;oi++)bt(s[oi]);bt(1);for(var gi=0;gi<64;gi++)bt(g[gi])}(),function(oi,gi){Rt(65472),Rt(17),bt(8),Rt(gi),Rt(oi),bt(3),bt(1),bt(17),bt(0),bt(2),bt(17),bt(1),bt(3),bt(17),bt(1)}(Le.width,Le.height),function(){Rt(65476),Rt(418),bt(0);for(var oi=0;oi<16;oi++)bt(Ne[oi+1]);for(var gi=0;gi<=11;gi++)bt(at[gi]);bt(16);for(var ci=0;ci<16;ci++)bt(nt[ci+1]);for(var Ki=0;Ki<=161;Ki++)bt(ke[Ki]);bt(1);for(var tr=0;tr<16;tr++)bt(De[tr+1]);for(var pr=0;pr<=11;pr++)bt(Ye[pr]);bt(17);for(var Mr=0;Mr<16;Mr++)bt(Ze[Mr+1]);for(var zt=0;zt<=161;zt++)bt(Ct[zt])}(),Rt(65498),Rt(12),bt(3),bt(1),bt(0),bt(2),bt(17),bt(3),bt(17),bt(0),bt(63),bt(0);var it=0,pt=0,mt=0;Ae=0,he=7,this.encode.displayName="_encode_";for(var Bt,Dt,Mt,qt,ni,_i,vi,Pi,kt,lt=Le.data,wt=Le.width,Oi=Le.height,ti=4*wt,ht=0;ht<Oi;){for(Bt=0;Bt<ti;){for(ni=ti*ht+Bt,vi=-1,Pi=0,kt=0;kt<64;kt++)_i=ni+(Pi=kt>>3)*ti+(vi=4*(7&kt)),ht+Pi>=Oi&&(_i-=ti*(ht+1+Pi-Oi)),Bt+vi>=ti&&(_i-=Bt+vi-ti+4),Dt=lt[_i++],Mt=lt[_i++],qt=lt[_i++],pe[kt]=(je[Dt]+je[Mt+256>>0]+je[qt+512>>0]>>16)-128,be[kt]=(je[Dt+768>>0]+je[Mt+1024>>0]+je[qt+1280>>0]>>16)-128,Te[kt]=(je[Dt+1280>>0]+je[Mt+1536>>0]+je[qt+1792>>0]>>16)-128;it=Ft(pe,v,it,e,r),pt=Ft(be,T,pt,t,n),mt=Ft(Te,T,mt,t,n),Bt+=32}ht+=8}if(he>=0){var $t=[];$t[1]=he+1,$t[0]=(1<<he+1)-1,Pt($t)}return Rt(65497),new Uint8Array(te)},i=i||50,function(){for(var Le=String.fromCharCode,Xe=0;Xe<256;Xe++)qe[Xe]=Le(Xe)}(),e=Et(Ne,at),t=Et(De,Ye),r=Et(nt,ke),n=Et(Ze,Ct),function(){for(var Le=1,Xe=2,it=1;it<=15;it++){for(var pt=Le;pt<Xe;pt++)R[32767+pt]=it,F[32767+pt]=[],F[32767+pt][1]=it,F[32767+pt][0]=pt;for(var mt=-(Xe-1);mt<=-Le;mt++)R[32767+mt]=it,F[32767+mt]=[],F[32767+mt][1]=it,F[32767+mt][0]=Xe-1+mt;Le<<=1,Xe<<=1}}(),function(){for(var Le=0;Le<256;Le++)je[Le]=19595*Le,je[Le+256>>0]=38470*Le,je[Le+512>>0]=7471*Le+32768,je[Le+768>>0]=-11059*Le,je[Le+1024>>0]=-21709*Le,je[Le+1280>>0]=32768*Le+8421375,je[Le+1536>>0]=-27439*Le,je[Le+1792>>0]=-5329*Le}(),Xt(i)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function uh(i,e){if(this.pos=0,this.buffer=i,this.datav=new DataView(i.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function K4(i){function e(Ne){if(!Ne)throw Error("assert :P")}function t(Ne,at,nt){for(var ke=0;4>ke;ke++)if(Ne[at+ke]!=nt.charCodeAt(ke))return!0;return!1}function r(Ne,at,nt,ke,De){for(var Ye=0;Ye<De;Ye++)Ne[at+Ye]=nt[ke+Ye]}function n(Ne,at,nt,ke){for(var De=0;De<ke;De++)Ne[at+De]=nt}function o(Ne){return new Int32Array(Ne)}function l(Ne,at){for(var nt=[],ke=0;ke<Ne;ke++)nt.push(new at);return nt}function s(Ne,at){var nt=[];return function ke(De,Ye,Ze){for(var Ct=Ze[Ye],Et=0;Et<Ct&&(De.push(Ze.length>Ye+1?[]:new at),!(Ze.length<Ye+1));Et++)ke(De[Et],Ye+1,Ze)}(nt,0,Ne),nt}var g=function(){var Ne=this;function at(y,E){for(var P=1<<E-1>>>0;y&P;)P>>>=1;return P?(y&P-1)+P:y}function nt(y,E,P,V,q){e(!(V%P));do y[E+(V-=P)]=q;while(0<V)}function ke(y,E,P,V,q){if(e(2328>=q),512>=q)var K=o(512);else if((K=o(q))==null)return 0;return function(ee,se,oe,le,_e,Ie){var ve,Se,et=se,Oe=1<<oe,Re=o(16),Ve=o(16);for(e(_e!=0),e(le!=null),e(ee!=null),e(0<oe),Se=0;Se<_e;++Se){if(15<le[Se])return 0;++Re[le[Se]]}if(Re[0]==_e)return 0;for(Ve[1]=0,ve=1;15>ve;++ve){if(Re[ve]>1<<ve)return 0;Ve[ve+1]=Ve[ve]+Re[ve]}for(Se=0;Se<_e;++Se)ve=le[Se],0<le[Se]&&(Ie[Ve[ve]++]=Se);if(Ve[15]==1)return(le=new De).g=0,le.value=Ie[0],nt(ee,et,1,Oe,le),Oe;var At,dt=-1,ft=Oe-1,Nt=0,It=1,jt=1,Ht=1<<oe;for(Se=0,ve=1,_e=2;ve<=oe;++ve,_e<<=1){if(It+=jt<<=1,0>(jt-=Re[ve]))return 0;for(;0<Re[ve];--Re[ve])(le=new De).g=ve,le.value=Ie[Se++],nt(ee,et+Nt,_e,Ht,le),Nt=at(Nt,ve)}for(ve=oe+1,_e=2;15>=ve;++ve,_e<<=1){if(It+=jt<<=1,0>(jt-=Re[ve]))return 0;for(;0<Re[ve];--Re[ve]){if(le=new De,(Nt&ft)!=dt){for(et+=Ht,At=1<<(dt=ve)-oe;15>dt&&!(0>=(At-=Re[dt]));)++dt,At<<=1;Oe+=Ht=1<<(At=dt-oe),ee[se+(dt=Nt&ft)].g=At+oe,ee[se+dt].value=et-se-dt}le.g=ve-oe,le.value=Ie[Se++],nt(ee,et+(Nt>>oe),_e,Ht,le),Nt=at(Nt,ve)}}return It!=2*Ve[15]-1?0:Oe}(y,E,P,V,q,K)}function De(){this.value=this.g=0}function Ye(){this.value=this.g=0}function Ze(){this.G=l(5,De),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=l(ms,Ye)}function Ct(y,E,P,V){e(y!=null),e(E!=null),e(2147483648>V),y.Ca=254,y.I=0,y.b=-8,y.Ka=0,y.oa=E,y.pa=P,y.Jd=E,y.Yc=P+V,y.Zc=4<=V?P+V-4+1:P,Bt(y)}function Et(y,E){for(var P=0;0<E--;)P|=Mt(y,128)<<E;return P}function Pt(y,E){var P=Et(y,E);return Dt(y)?-P:P}function bt(y,E,P,V){var q,K=0;for(e(y!=null),e(E!=null),e(4294967288>V),y.Sb=V,y.Ra=0,y.u=0,y.h=0,4<V&&(V=4),q=0;q<V;++q)K+=E[P+q]<<8*q;y.Ra=K,y.bb=V,y.oa=E,y.pa=P}function Rt(y){for(;8<=y.u&&y.bb<y.Sb;)y.Ra>>>=8,y.Ra+=y.oa[y.pa+y.bb]<<La-8>>>0,++y.bb,y.u-=8;it(y)&&(y.h=1,y.u=0)}function Ft(y,E){if(e(0<=E),!y.h&&E<=$l){var P=Xe(y)&Al[E];return y.u+=E,Rt(y),P}return y.h=1,y.u=0}function Xt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Le(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Xe(y){return y.Ra>>>(y.u&La-1)>>>0}function it(y){return e(y.bb<=y.Sb),y.h||y.bb==y.Sb&&y.u>La}function pt(y,E){y.u=E,y.h=it(y)}function mt(y){y.u>=Ma&&(e(y.u>=Ma),Rt(y))}function Bt(y){e(y!=null&&y.oa!=null),y.pa<y.Zc?(y.I=(y.oa[y.pa++]|y.I<<8)>>>0,y.b+=8):(e(y!=null&&y.oa!=null),y.pa<y.Yc?(y.b+=8,y.I=y.oa[y.pa++]|y.I<<8):y.Ka?y.b=0:(y.I<<=8,y.b+=8,y.Ka=1))}function Dt(y){return Et(y,1)}function Mt(y,E){var P=y.Ca;0>y.b&&Bt(y);var V=y.b,q=P*E>>>8,K=(y.I>>>V>q)+0;for(K?(P-=q,y.I-=q+1<<V>>>0):P=q+1,V=P,q=0;256<=V;)q+=8,V>>=8;return V=7^q+Fs[V],y.b-=V,y.Ca=(P<<V)-1,K}function qt(y,E,P){y[E+0]=P>>24&255,y[E+1]=P>>16&255,y[E+2]=P>>8&255,y[E+3]=P>>0&255}function ni(y,E){return y[E+0]<<0|y[E+1]<<8}function _i(y,E){return ni(y,E)|y[E+2]<<16}function vi(y,E){return ni(y,E)|ni(y,E+2)<<16}function Pi(y,E){var P=1<<E;return e(y!=null),e(0<E),y.X=o(P),y.X==null?0:(y.Mb=32-E,y.Xa=E,1)}function kt(y,E){e(y!=null),e(E!=null),e(y.Xa==E.Xa),r(E.X,0,y.X,0,1<<E.Xa)}function lt(){this.X=[],this.Xa=this.Mb=0}function wt(y,E,P,V){e(P!=null),e(V!=null);var q=P[0],K=V[0];return q==0&&(q=(y*K+E/2)/E),K==0&&(K=(E*q+y/2)/y),0>=q||0>=K?0:(P[0]=q,V[0]=K,1)}function Oi(y,E){return y+(1<<E)-1>>>E}function ti(y,E){return((4278255360&y)+(4278255360&E)>>>0&4278255360)+((16711935&y)+(16711935&E)>>>0&16711935)>>>0}function ht(y,E){Ne[E]=function(P,V,q,K,ee,se,oe){var le;for(le=0;le<ee;++le){var _e=Ne[y](se[oe+le-1],q,K+le);se[oe+le]=ti(P[V+le],_e)}}}function $t(){this.ud=this.hd=this.jd=0}function oi(y,E){return((4278124286&(y^E))>>>1)+(y&E)>>>0}function gi(y){return 0<=y&&256>y?y:0>y?0:255<y?255:void 0}function ci(y,E){return gi(y+(y-E+.5>>1))}function Ki(y,E,P){return Math.abs(E-P)-Math.abs(y-P)}function tr(y,E,P,V,q,K,ee){for(V=K[ee-1],P=0;P<q;++P)K[ee+P]=V=ti(y[E+P],V)}function pr(y,E,P,V,q){var K;for(K=0;K<P;++K){var ee=y[E+K],se=ee>>8&255,oe=16711935&(oe=(oe=16711935&ee)+((se<<16)+se));V[q+K]=(4278255360&ee)+oe>>>0}}function Mr(y,E){E.jd=y>>0&255,E.hd=y>>8&255,E.ud=y>>16&255}function zt(y,E,P,V,q,K){var ee;for(ee=0;ee<V;++ee){var se=E[P+ee],oe=se>>>8,le=se,_e=255&(_e=(_e=se>>>16)+((y.jd<<24>>24)*(oe<<24>>24)>>>5));le=255&(le=(le=le+((y.hd<<24>>24)*(oe<<24>>24)>>>5))+((y.ud<<24>>24)*(_e<<24>>24)>>>5)),q[K+ee]=(4278255360&se)+(_e<<16)+le}}function Wi(y,E,P,V,q){Ne[E]=function(K,ee,se,oe,le,_e,Ie,ve,Se){for(oe=Ie;oe<ve;++oe)for(Ie=0;Ie<Se;++Ie)le[_e++]=q(se[V(K[ee++])])},Ne[y]=function(K,ee,se,oe,le,_e,Ie){var ve=8>>K.b,Se=K.Ea,et=K.K[0],Oe=K.w;if(8>ve)for(K=(1<<K.b)-1,Oe=(1<<ve)-1;ee<se;++ee){var Re,Ve=0;for(Re=0;Re<Se;++Re)Re&K||(Ve=V(oe[le++])),_e[Ie++]=q(et[Ve&Oe]),Ve>>=ve}else Ne["VP8LMapColor"+P](oe,le,et,Oe,_e,Ie,ee,se,Se)}}function hi(y,E,P,V,q){for(P=E+P;E<P;){var K=y[E++];V[q++]=K>>16&255,V[q++]=K>>8&255,V[q++]=K>>0&255}}function Wt(y,E,P,V,q){for(P=E+P;E<P;){var K=y[E++];V[q++]=K>>16&255,V[q++]=K>>8&255,V[q++]=K>>0&255,V[q++]=K>>24&255}}function Ar(y,E,P,V,q){for(P=E+P;E<P;){var K=(ee=y[E++])>>16&240|ee>>12&15,ee=ee>>0&240|ee>>28&15;V[q++]=K,V[q++]=ee}}function Qt(y,E,P,V,q){for(P=E+P;E<P;){var K=(ee=y[E++])>>16&248|ee>>13&7,ee=ee>>5&224|ee>>3&31;V[q++]=K,V[q++]=ee}}function Si(y,E,P,V,q){for(P=E+P;E<P;){var K=y[E++];V[q++]=K>>0&255,V[q++]=K>>8&255,V[q++]=K>>16&255}}function Ii(y,E,P,V,q,K){if(K==0)for(P=E+P;E<P;)qt(V,((K=y[E++])[0]>>24|K[1]>>8&65280|K[2]<<8&16711680|K[3]<<24)>>>0),q+=32;else r(V,q,y,E,P)}function Zt(y,E){Ne[E][0]=Ne[y+"0"],Ne[E][1]=Ne[y+"1"],Ne[E][2]=Ne[y+"2"],Ne[E][3]=Ne[y+"3"],Ne[E][4]=Ne[y+"4"],Ne[E][5]=Ne[y+"5"],Ne[E][6]=Ne[y+"6"],Ne[E][7]=Ne[y+"7"],Ne[E][8]=Ne[y+"8"],Ne[E][9]=Ne[y+"9"],Ne[E][10]=Ne[y+"10"],Ne[E][11]=Ne[y+"11"],Ne[E][12]=Ne[y+"12"],Ne[E][13]=Ne[y+"13"],Ne[E][14]=Ne[y+"0"],Ne[E][15]=Ne[y+"0"]}function bi(y){return y==vn||y==Rs||y==Fo||y==gl}function ei(){this.eb=[],this.size=this.A=this.fb=0}function _r(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Zr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ei,this.f.kb=new _r,this.sd=null}function Qe(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Be(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ce(y){return alert("todo:WebPSamplerProcessPlane"),y.T}function ie(y,E){var P=y.T,V=E.ba.f.RGBA,q=V.eb,K=V.fb+y.ka*V.A,ee=Jr[E.ba.S],se=y.y,oe=y.O,le=y.f,_e=y.N,Ie=y.ea,ve=y.W,Se=E.cc,et=E.dc,Oe=E.Mc,Re=E.Nc,Ve=y.ka,At=y.ka+y.T,dt=y.U,ft=dt+1>>1;for(Ve==0?ee(se,oe,null,null,le,_e,Ie,ve,le,_e,Ie,ve,q,K,null,null,dt):(ee(E.ec,E.fc,se,oe,Se,et,Oe,Re,le,_e,Ie,ve,q,K-V.A,q,K,dt),++P);Ve+2<At;Ve+=2)Se=le,et=_e,Oe=Ie,Re=ve,_e+=y.Rc,ve+=y.Rc,K+=2*V.A,ee(se,(oe+=2*y.fa)-y.fa,se,oe,Se,et,Oe,Re,le,_e,Ie,ve,q,K-V.A,q,K,dt);return oe+=y.fa,y.j+At<y.o?(r(E.ec,E.fc,se,oe,dt),r(E.cc,E.dc,le,_e,ft),r(E.Mc,E.Nc,Ie,ve,ft),P--):1&At||ee(se,oe,null,null,le,_e,Ie,ve,le,_e,Ie,ve,q,K+V.A,null,null,dt),P}function ue(y,E,P){var V=y.F,q=[y.J];if(V!=null){var K=y.U,ee=E.ba.S,se=ee==Xl||ee==Fo;E=E.ba.f.RGBA;var oe=[0],le=y.ka;oe[0]=y.T,y.Kb&&(le==0?--oe[0]:(--le,q[0]-=y.width),y.j+y.ka+y.T==y.o&&(oe[0]=y.o-y.j-le));var _e=E.eb;le=E.fb+le*E.A,y=Yo(V,q[0],y.width,K,oe,_e,le+(se?0:3),E.A),e(P==oe),y&&bi(ee)&&Fa(_e,le,se,K,oe,E.A)}return 0}function ge(y){var E=y.ma,P=E.ba.S,V=11>P,q=P==Zl||P==Qc||P==Xl||P==Vc||P==12||bi(P);if(E.memory=null,E.Ib=null,E.Jb=null,E.Nd=null,!ql(E.Oa,y,q?11:12))return 0;if(q&&bi(P)&&pi(),y.da)alert("todo:use_scaling");else{if(V){if(E.Ib=ce,y.Kb){if(P=y.U+1>>1,E.memory=o(y.U+2*P),E.memory==null)return 0;E.ec=E.memory,E.fc=0,E.cc=E.ec,E.dc=E.fc+y.U,E.Mc=E.cc,E.Nc=E.dc+P,E.Ib=ie,pi()}}else alert("todo:EmitYUV");q&&(E.Jb=ue,V&&xt())}if(V&&!b){for(y=0;256>y;++y)L[y]=89858*(y-128)+ic>>Oo,X[y]=-22014*(y-128)+ic,z[y]=-45773*(y-128),O[y]=113618*(y-128)+ic>>Oo;for(y=va;y<zr;++y)E=76283*(y-16)+ic>>Oo,w[y-va]=Xs(E,255),a[y-va]=Xs(E+8>>4,15);b=1}return 1}function xe(y){var E=y.ma,P=y.U,V=y.T;return e(!(1&y.ka)),0>=P||0>=V?0:(P=E.Ib(y,E),E.Jb!=null&&E.Jb(y,E,P),E.Dc+=P,1)}function Ee(y){y.ma.memory=null}function we(y,E,P,V){return Ft(y,8)!=47?0:(E[0]=Ft(y,14)+1,P[0]=Ft(y,14)+1,V[0]=Ft(y,1),Ft(y,3)!=0?0:!y.h)}function Fe(y,E){if(4>y)return y+1;var P=y-2>>1;return(2+(1&y)<<P)+Ft(E,P)+1}function ze(y,E){return 120<E?E-120:1<=(P=((P=Ei[E-1])>>4)*y+(8-(15&P)))?P:1;var P}function Ge(y,E,P){var V=Xe(P),q=y[E+=255&V].g-8;return 0<q&&(pt(P,P.u+8),V=Xe(P),E+=y[E].value,E+=V&(1<<q)-1),pt(P,P.u+y[E].g),y[E].value}function st(y,E,P){return P.g+=y.g,P.value+=y.value<<E>>>0,e(8>=P.g),y.g}function vt(y,E,P){var V=y.xc;return e((E=V==0?0:y.vc[y.md*(P>>V)+(E>>V)])<y.Wb),y.Ya[E]}function Tt(y,E,P,V){var q=y.ab,K=y.c*E,ee=y.C;E=ee+E;var se=P,oe=V;for(V=y.Ta,P=y.Ua;0<q--;){var le=y.gc[q],_e=ee,Ie=E,ve=se,Se=oe,et=(oe=V,se=P,le.Ea);switch(e(_e<Ie),e(Ie<=le.nc),le.hc){case 2:fn(ve,Se,(Ie-_e)*et,oe,se);break;case 0:var Oe=_e,Re=Ie,Ve=oe,At=se,dt=(Ht=le).Ea;Oe==0&&(Uu(ve,Se,null,null,1,Ve,At),tr(ve,Se+1,0,0,dt-1,Ve,At+1),Se+=dt,At+=dt,++Oe);for(var ft=1<<Ht.b,Nt=ft-1,It=Oi(dt,Ht.b),jt=Ht.K,Ht=Ht.w+(Oe>>Ht.b)*It;Oe<Re;){var Mi=jt,mi=Ht,Ti=1;for(Ln(ve,Se,Ve,At-dt,1,Ve,At);Ti<dt;){var ui=(Ti&~Nt)+ft;ui>dt&&(ui=dt),(0,co[Mi[mi++]>>8&15])(ve,Se+ +Ti,Ve,At+Ti-dt,ui-Ti,Ve,At+Ti),Ti=ui}Se+=dt,At+=dt,++Oe&Nt||(Ht+=It)}Ie!=le.nc&&r(oe,se-et,oe,se+(Ie-_e-1)*et,et);break;case 1:for(et=ve,Re=Se,dt=(ve=le.Ea)-(At=ve&~(Ve=(Se=1<<le.b)-1)),Oe=Oi(ve,le.b),ft=le.K,le=le.w+(_e>>le.b)*Oe;_e<Ie;){for(Nt=ft,It=le,jt=new $t,Ht=Re+At,Mi=Re+ve;Re<Ht;)Mr(Nt[It++],jt),ys(jt,et,Re,Se,oe,se),Re+=Se,se+=Se;Re<Mi&&(Mr(Nt[It++],jt),ys(jt,et,Re,dt,oe,se),Re+=dt,se+=dt),++_e&Ve||(le+=Oe)}break;case 3:if(ve==oe&&Se==se&&0<le.b){for(Re=oe,ve=et=se+(Ie-_e)*et-(At=(Ie-_e)*Oi(le.Ea,le.b)),Se=oe,Ve=se,Oe=[],At=(dt=At)-1;0<=At;--At)Oe[At]=Se[Ve+At];for(At=dt-1;0<=At;--At)Re[ve+At]=Oe[At];pn(le,_e,Ie,oe,et,oe,se)}else pn(le,_e,Ie,ve,Se,oe,se)}se=V,oe=P}oe!=P&&r(V,P,se,oe,K)}function Kt(y,E){var P=y.V,V=y.Ba+y.c*y.C,q=E-y.C;if(e(E<=y.l.o),e(16>=q),0<q){var K=y.l,ee=y.Ta,se=y.Ua,oe=K.width;if(Tt(y,q,P,V),q=se=[se],e((P=y.C)<(V=E)),e(K.v<K.va),V>K.o&&(V=K.o),P<K.j){var le=K.j-P;P=K.j,q[0]+=le*oe}if(P>=V?P=0:(q[0]+=4*K.v,K.ka=P-K.j,K.U=K.va-K.v,K.T=V-P,P=1),P){if(se=se[0],11>(P=y.ca).S){var _e=P.f.RGBA,Ie=(V=P.S,q=K.U,K=K.T,le=_e.eb,_e.A),ve=K;for(_e=_e.fb+y.Ma*_e.A;0<ve--;){var Se=ee,et=se,Oe=q,Re=le,Ve=_e;switch(V){case zc:ds(Se,et,Oe,Re,Ve);break;case Zl:Mo(Se,et,Oe,Re,Ve);break;case vn:Mo(Se,et,Oe,Re,Ve),Fa(Re,Ve,0,Oe,1,0);break;case du:tl(Se,et,Oe,Re,Ve);break;case Qc:Ii(Se,et,Oe,Re,Ve,1);break;case Rs:Ii(Se,et,Oe,Re,Ve,1),Fa(Re,Ve,0,Oe,1,0);break;case Xl:Ii(Se,et,Oe,Re,Ve,0);break;case Fo:Ii(Se,et,Oe,Re,Ve,0),Fa(Re,Ve,1,Oe,1,0);break;case Vc:yo(Se,et,Oe,Re,Ve);break;case gl:yo(Se,et,Oe,Re,Ve),Jo(Re,Ve,Oe,1,0);break;case il:ga(Se,et,Oe,Re,Ve);break;default:e(0)}se+=oe,_e+=Ie}y.Ma+=K}else alert("todo:EmitRescaledRowsYUVA");e(y.Ma<=P.height)}}y.C=E,e(y.C<=y.i)}function ii(y){var E;if(0<y.ua)return 0;for(E=0;E<y.Wb;++E){var P=y.Ya[E].G,V=y.Ya[E].H;if(0<P[1][V[1]+0].g||0<P[2][V[2]+0].g||0<P[3][V[3]+0].g)return 0}return 1}function Gt(y,E,P,V,q,K){if(y.Z!=0){var ee=y.qd,se=y.rd;for(e($s[y.Z]!=null);E<P;++E)$s[y.Z](ee,se,V,q,V,q,K),ee=V,se=q,q+=K;y.qd=ee,y.rd=se}}function Ai(y,E){var P=y.l.ma,V=P.Z==0||P.Z==1?y.l.j:y.C;if(V=y.C<V?V:y.C,e(E<=y.l.o),E>V){var q=y.l.width,K=P.ca,ee=P.tb+q*V,se=y.V,oe=y.Ba+y.c*V,le=y.gc;e(y.ab==1),e(le[0].hc==3),pa(le[0],V,E,se,oe,K,ee),Gt(P,V,E,K,ee,q)}y.C=y.Ma=E}function Bi(y,E,P,V,q,K,ee){var se=y.$/V,oe=y.$%V,le=y.m,_e=y.s,Ie=P+y.$,ve=Ie;q=P+V*q;var Se=P+V*K,et=280+_e.ua,Oe=y.Pb?se:16777216,Re=0<_e.ua?_e.Wa:null,Ve=_e.wc,At=Ie<Se?vt(_e,oe,se):null;e(y.C<K),e(Se<=q);var dt=!1;e:for(;;){for(;dt||Ie<Se;){var ft=0;if(se>=Oe){var Nt=Ie-P;e((Oe=y).Pb),Oe.wd=Oe.m,Oe.xd=Nt,0<Oe.s.ua&&kt(Oe.s.Wa,Oe.s.vb),Oe=se+ml}if(oe&Ve||(At=vt(_e,oe,se)),e(At!=null),At.Qb&&(E[Ie]=At.qb,dt=!0),!dt)if(mt(le),At.jc){ft=le,Nt=E;var It=Ie,jt=At.pd[Xe(ft)&ms-1];e(At.jc),256>jt.g?(pt(ft,ft.u+jt.g),Nt[It]=jt.value,ft=0):(pt(ft,ft.u+jt.g-256),e(256<=jt.value),ft=jt.value),ft==0&&(dt=!0)}else ft=Ge(At.G[0],At.H[0],le);if(le.h)break;if(dt||256>ft){if(!dt)if(At.nd)E[Ie]=(At.qb|ft<<8)>>>0;else{if(mt(le),dt=Ge(At.G[1],At.H[1],le),mt(le),Nt=Ge(At.G[2],At.H[2],le),It=Ge(At.G[3],At.H[3],le),le.h)break;E[Ie]=(It<<24|dt<<16|ft<<8|Nt)>>>0}if(dt=!1,++Ie,++oe>=V&&(oe=0,++se,ee!=null&&se<=K&&!(se%16)&&ee(y,se),Re!=null))for(;ve<Ie;)ft=E[ve++],Re.X[(506832829*ft&4294967295)>>>Re.Mb]=ft}else if(280>ft){if(ft=Fe(ft-256,le),Nt=Ge(At.G[4],At.H[4],le),mt(le),Nt=ze(V,Nt=Fe(Nt,le)),le.h)break;if(Ie-P<Nt||q-Ie<ft)break e;for(It=0;It<ft;++It)E[Ie+It]=E[Ie+It-Nt];for(Ie+=ft,oe+=ft;oe>=V;)oe-=V,++se,ee!=null&&se<=K&&!(se%16)&&ee(y,se);if(e(Ie<=q),oe&Ve&&(At=vt(_e,oe,se)),Re!=null)for(;ve<Ie;)ft=E[ve++],Re.X[(506832829*ft&4294967295)>>>Re.Mb]=ft}else{if(!(ft<et))break e;for(dt=ft-280,e(Re!=null);ve<Ie;)ft=E[ve++],Re.X[(506832829*ft&4294967295)>>>Re.Mb]=ft;ft=Ie,e(!(dt>>>(Nt=Re).Xa)),E[ft]=Nt.X[dt],dt=!0}dt||e(le.h==it(le))}if(y.Pb&&le.h&&Ie<q)e(y.m.h),y.a=5,y.m=y.wd,y.$=y.xd,0<y.s.ua&&kt(y.s.vb,y.s.Wa);else{if(le.h)break e;ee!=null&&ee(y,se>K?K:se),y.a=0,y.$=Ie-P}return 1}return y.a=3,0}function Hi(y){e(y!=null),y.vc=null,y.yc=null,y.Ya=null;var E=y.Wa;E!=null&&(E.X=null),y.vb=null,e(y!=null)}function Ci(){var y=new el;return y==null?null:(y.a=0,y.xb=pu,Zt("Predictor","VP8LPredictors"),Zt("Predictor","VP8LPredictors_C"),Zt("PredictorAdd","VP8LPredictorsAdd"),Zt("PredictorAdd","VP8LPredictorsAdd_C"),fn=pr,ys=zt,ds=hi,Mo=Wt,yo=Ar,ga=Qt,tl=Si,Ne.VP8LMapColor32b=As,Ne.VP8LMapColor8b=Kl,y)}function Ni(y,E,P,V,q){var K=1,ee=[y],se=[E],oe=V.m,le=V.s,_e=null,Ie=0;e:for(;;){if(P)for(;K&&Ft(oe,1);){var ve=ee,Se=se,et=V,Oe=1,Re=et.m,Ve=et.gc[et.ab],At=Ft(Re,2);if(et.Oc&1<<At)K=0;else{switch(et.Oc|=1<<At,Ve.hc=At,Ve.Ea=ve[0],Ve.nc=Se[0],Ve.K=[null],++et.ab,e(4>=et.ab),At){case 0:case 1:Ve.b=Ft(Re,3)+2,Oe=Ni(Oi(Ve.Ea,Ve.b),Oi(Ve.nc,Ve.b),0,et,Ve.K),Ve.K=Ve.K[0];break;case 3:var dt,ft=Ft(Re,8)+1,Nt=16<ft?0:4<ft?1:2<ft?2:3;if(ve[0]=Oi(Ve.Ea,Nt),Ve.b=Nt,dt=Oe=Ni(ft,1,0,et,Ve.K)){var It,jt=ft,Ht=Ve,Mi=1<<(8>>Ht.b),mi=o(Mi);if(mi==null)dt=0;else{var Ti=Ht.K[0],ui=Ht.w;for(mi[0]=Ht.K[0][0],It=1;It<1*jt;++It)mi[It]=ti(Ti[ui+It],mi[It-1]);for(;It<4*Mi;++It)mi[It]=0;Ht.K[0]=null,Ht.K[0]=mi,dt=1}}Oe=dt;break;case 2:break;default:e(0)}K=Oe}}if(ee=ee[0],se=se[0],K&&Ft(oe,1)&&!(K=1<=(Ie=Ft(oe,4))&&11>=Ie)){V.a=3;break e}var ar;if(ar=K)t:{var er,ir,Dr,Rr=V,xr=ee,$r=se,br=Ie,Wn=P,Kr=Rr.m,kr=Rr.s,Wr=[null],ur=1,Nr=0,on=sr[br];i:for(;;){if(Wn&&Ft(Kr,1)){var es=Ft(Kr,3)+2,an=Oi(xr,es),ts=Oi($r,es),Bs=an*ts;if(!Ni(an,ts,0,Rr,Wr))break i;for(Wr=Wr[0],kr.xc=es,er=0;er<Bs;++er){var mr=Wr[er]>>8&65535;Wr[er]=mr,mr>=ur&&(ur=mr+1)}}if(Kr.h)break i;for(ir=0;5>ir;++ir){var bn=Nu[ir];!ir&&0<br&&(bn+=1<<br),Nr<bn&&(Nr=bn)}var ea=l(ur*on,De),Os=ur,io=l(Os,Ze);if(io==null)var yl=null;else e(65536>=Os),yl=io;var _o=o(Nr);if(yl==null||_o==null||ea==null){Rr.a=1;break i}var rc=ea;for(er=Dr=0;er<ur;++er){var Ra=yl[er],Dn=Ra.G,xc=Ra.H,gu=0,_l=1,rl=0;for(ir=0;5>ir;++ir){bn=Nu[ir],Dn[ir]=rc,xc[ir]=Dr,!ir&&0<br&&(bn+=1<<br);n:{var Qu,sA=bn,$c=Rr,jA=_o,oA=rc,kd=Dr,Vu=0,mu=$c.m,Od=Ft(mu,1);if(n(jA,0,0,sA),Od){var Am=Ft(mu,1)+1,ta=Ft(mu,1),nc=Ft(mu,ta==0?1:8);jA[nc]=1,Am==2&&(jA[nc=Ft(mu,8)]=1);var aA=1}else{var xh=o(19),yu=Ft(mu,4)+4;if(19<yu){$c.a=3;var wh=0;break n}for(Qu=0;Qu<yu;++Qu)xh[to[Qu]]=Ft(mu,3);var Bh=void 0,lA=void 0,Yf=$c,ia=xh,Kc=sA,Ud=jA,cA=0,vl=Yf.m,Nd=8,_u=l(128,De);r:for(;ke(_u,0,7,ia,19);){if(Ft(vl,1)){var bl=2+2*Ft(vl,3);if((Bh=2+Ft(vl,bl))>Kc)break r}else Bh=Kc;for(lA=0;lA<Kc&&Bh--;){mt(vl);var zd=_u[0+(127&Xe(vl))];pt(vl,vl.u+zd.g);var Ch=zd.value;if(16>Ch)Ud[lA++]=Ch,Ch!=0&&(Nd=Ch);else{var ep=Ch==16,dm=Ch-16,tp=Hc[dm],ip=Ft(vl,fu[dm])+tp;if(lA+ip>Kc)break r;for(var rp=ep?Nd:0;0<ip--;)Ud[lA++]=rp}}cA=1;break r}cA||(Yf.a=3),aA=cA}(aA=aA&&!mu.h)&&(Vu=ke(oA,kd,8,jA,sA)),aA&&Vu!=0?wh=Vu:($c.a=3,wh=0)}if(wh==0)break i;if(_l&&_a[ir]==1&&(_l=rc[Dr].g==0),gu+=rc[Dr].g,Dr+=wh,3>=ir){var wc,Uo=_o[0];for(wc=1;wc<bn;++wc)_o[wc]>Uo&&(Uo=_o[wc]);rl+=Uo}}if(Ra.nd=_l,Ra.Qb=0,_l&&(Ra.qb=(Dn[3][xc[3]+0].value<<24|Dn[1][xc[1]+0].value<<16|Dn[2][xc[2]+0].value)>>>0,gu==0&&256>Dn[0][xc[0]+0].value&&(Ra.Qb=1,Ra.qb+=Dn[0][xc[0]+0].value<<8)),Ra.jc=!Ra.Qb&&6>rl,Ra.jc){var uA,ka=Ra;for(uA=0;uA<ms;++uA){var xl=uA,Hu=ka.pd[xl],Qd=ka.G[0][ka.H[0]+xl];256<=Qd.value?(Hu.g=Qd.g+256,Hu.value=Qd.value):(Hu.g=0,Hu.value=0,xl>>=st(Qd,8,Hu),xl>>=st(ka.G[1][ka.H[1]+xl],16,Hu),xl>>=st(ka.G[2][ka.H[2]+xl],0,Hu),st(ka.G[3][ka.H[3]+xl],24,Hu))}}}kr.vc=Wr,kr.Wb=ur,kr.Ya=yl,kr.yc=ea,ar=1;break t}ar=0}if(!(K=ar)){V.a=3;break e}if(0<Ie){if(le.ua=1<<Ie,!Pi(le.Wa,Ie)){V.a=1,K=0;break e}}else le.ua=0;var np=V,fm=ee,sp=se,hA=np.s,Vd=hA.xc;if(np.c=fm,np.i=sp,hA.md=Oi(fm,Vd),hA.wc=Vd==0?-1:(1<<Vd)-1,P){V.xb=Ro;break e}if((_e=o(ee*se))==null){V.a=1,K=0;break e}K=(K=Bi(V,_e,0,ee,se,se,null))&&!oe.h;break e}return K?(q!=null?q[0]=_e:(e(_e==null),e(P)),V.$=0,P||Hi(le)):Hi(le),K}function ot(y,E){var P=y.c*y.i,V=P+E+16*E;return e(y.c<=E),y.V=o(V),y.V==null?(y.Ta=null,y.Ua=0,y.a=1,0):(y.Ta=y.V,y.Ua=y.Ba+P+E,1)}function ri(y,E){var P=y.C,V=E-P,q=y.V,K=y.Ba+y.c*P;for(e(E<=y.l.o);0<V;){var ee=16<V?16:V,se=y.l.ma,oe=y.l.width,le=oe*ee,_e=se.ca,Ie=se.tb+oe*P,ve=y.Ta,Se=y.Ua;Tt(y,ee,q,K),Ui(ve,Se,_e,Ie,le),Gt(se,P,P+ee,_e,Ie,oe),V-=ee,q+=ee*y.c,P+=ee}e(P==E),y.C=y.Ma=E}function Vt(){this.ub=this.yd=this.td=this.Rb=0}function Vi(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function lr(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function un(){this.Yb=function(){var y=[];return function E(P,V,q){for(var K=q[V],ee=0;ee<K&&(P.push(q.length>V+1?[]:0),!(q.length<V+1));ee++)E(P[ee],V+1,q)}(y,0,[3,11]),y}()}function wn(){this.jb=o(3),this.Wc=s([4,8],un),this.Xc=s([4,17],un)}function gr(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function mn(){this.ld=this.La=this.dd=this.tc=0}function yn(){this.Na=this.la=0}function dr(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Hn(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Gs(){this.uc=this.M=this.Nb=0,this.wa=Array(new mn),this.Y=0,this.ya=Array(new Hn),this.aa=0,this.l=new qa}function Or(){this.y=o(16),this.f=o(8),this.ea=o(8)}function Bn(){this.cb=this.a=0,this.sc="",this.m=new Xt,this.Od=new Vt,this.Kc=new Vi,this.ed=new gr,this.Qa=new lr,this.Ic=this.$c=this.Aa=0,this.D=new Gs,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=l(8,Xt),this.ia=0,this.pb=l(4,dr),this.Pa=new wn,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Or),this.Hd=0,this.rb=Array(new yn),this.sb=0,this.wa=Array(new mn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Hn),this.L=this.aa=0,this.gd=s([4,2],mn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function qa(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Un(){var y=new Bn;return y!=null&&(y.a=0,y.sc="OK",y.cb=0,y.Xb=0,ks||(ks=vr)),y}function Zi(y,E,P){return y.a==0&&(y.a=E,y.sc=P,y.cb=0),0}function ao(y,E,P){return 3<=P&&y[E+0]==157&&y[E+1]==1&&y[E+2]==42}function Ms(y,E){if(y==null)return 0;if(y.a=0,y.sc="OK",E==null)return Zi(y,2,"null VP8Io passed to VP8GetHeaders()");var P=E.data,V=E.w,q=E.ha;if(4>q)return Zi(y,7,"Truncated header.");var K=P[V+0]|P[V+1]<<8|P[V+2]<<16,ee=y.Od;if(ee.Rb=!(1&K),ee.td=K>>1&7,ee.yd=K>>4&1,ee.ub=K>>5,3<ee.td)return Zi(y,3,"Incorrect keyframe parameters.");if(!ee.yd)return Zi(y,4,"Frame not displayable.");V+=3,q-=3;var se=y.Kc;if(ee.Rb){if(7>q)return Zi(y,7,"cannot parse picture header");if(!ao(P,V,q))return Zi(y,3,"Bad code word");se.c=16383&(P[V+4]<<8|P[V+3]),se.Td=P[V+4]>>6,se.i=16383&(P[V+6]<<8|P[V+5]),se.Ud=P[V+6]>>6,V+=7,q-=7,y.za=se.c+15>>4,y.Ub=se.i+15>>4,E.width=se.c,E.height=se.i,E.Da=0,E.j=0,E.v=0,E.va=E.width,E.o=E.height,E.da=0,E.ib=E.width,E.hb=E.height,E.U=E.width,E.T=E.height,n((K=y.Pa).jb,0,255,K.jb.length),e((K=y.Qa)!=null),K.Cb=0,K.Bb=0,K.Fb=1,n(K.Zb,0,0,K.Zb.length),n(K.Lb,0,0,K.Lb)}if(ee.ub>q)return Zi(y,7,"bad partition length");Ct(K=y.m,P,V,ee.ub),V+=ee.ub,q-=ee.ub,ee.Rb&&(se.Ld=Dt(K),se.Kd=Dt(K)),se=y.Qa;var oe,le=y.Pa;if(e(K!=null),e(se!=null),se.Cb=Dt(K),se.Cb){if(se.Bb=Dt(K),Dt(K)){for(se.Fb=Dt(K),oe=0;4>oe;++oe)se.Zb[oe]=Dt(K)?Pt(K,7):0;for(oe=0;4>oe;++oe)se.Lb[oe]=Dt(K)?Pt(K,6):0}if(se.Bb)for(oe=0;3>oe;++oe)le.jb[oe]=Dt(K)?Et(K,8):255}else se.Bb=0;if(K.Ka)return Zi(y,3,"cannot parse segment header");if((se=y.ed).zd=Dt(K),se.Tb=Et(K,6),se.wb=Et(K,3),se.Pc=Dt(K),se.Pc&&Dt(K)){for(le=0;4>le;++le)Dt(K)&&(se.vd[le]=Pt(K,6));for(le=0;4>le;++le)Dt(K)&&(se.od[le]=Pt(K,6))}if(y.L=se.Tb==0?0:se.zd?1:2,K.Ka)return Zi(y,3,"cannot parse filter header");var _e=q;if(q=oe=V,V=oe+_e,se=_e,y.Xb=(1<<Et(y.m,2))-1,_e<3*(le=y.Xb))P=7;else{for(oe+=3*le,se-=3*le,_e=0;_e<le;++_e){var Ie=P[q+0]|P[q+1]<<8|P[q+2]<<16;Ie>se&&(Ie=se),Ct(y.Jc[+_e],P,oe,Ie),oe+=Ie,se-=Ie,q+=3}Ct(y.Jc[+le],P,oe,se),P=oe<V?0:5}if(P!=0)return Zi(y,P,"cannot parse partitions");for(P=Et(oe=y.m,7),q=Dt(oe)?Pt(oe,4):0,V=Dt(oe)?Pt(oe,4):0,se=Dt(oe)?Pt(oe,4):0,le=Dt(oe)?Pt(oe,4):0,oe=Dt(oe)?Pt(oe,4):0,_e=y.Qa,Ie=0;4>Ie;++Ie){if(_e.Cb){var ve=_e.Zb[Ie];_e.Fb||(ve+=P)}else{if(0<Ie){y.pb[Ie]=y.pb[0];continue}ve=P}var Se=y.pb[Ie];Se.Sc[0]=Gc[Xs(ve+q,127)],Se.Sc[1]=Jl[Xs(ve+0,127)],Se.Eb[0]=2*Gc[Xs(ve+V,127)],Se.Eb[1]=101581*Jl[Xs(ve+se,127)]>>16,8>Se.Eb[1]&&(Se.Eb[1]=8),Se.Qc[0]=Gc[Xs(ve+le,117)],Se.Qc[1]=Jl[Xs(ve+oe,127)],Se.lc=ve+oe}if(!ee.Rb)return Zi(y,4,"Not a key frame.");for(Dt(K),ee=y.Pa,P=0;4>P;++P){for(q=0;8>q;++q)for(V=0;3>V;++V)for(se=0;11>se;++se)le=Mt(K,Kn[P][q][V][se])?Et(K,8):$i[P][q][V][se],ee.Wc[P][q].Yb[V][se]=le;for(q=0;17>q;++q)ee.Xc[P][q]=ee.Wc[P][zu[q]]}return y.kc=Dt(K),y.kc&&(y.Bd=Et(K,8)),y.cb=1}function vr(y,E,P,V,q,K,ee){var se=E[q].Yb[P];for(P=0;16>q;++q){if(!Mt(y,se[P+0]))return q;for(;!Mt(y,se[P+1]);)if(se=E[++q].Yb[0],P=0,q==16)return 16;var oe=E[q+1].Yb;if(Mt(y,se[P+2])){var le=y,_e=0;if(Mt(le,(ve=se)[(Ie=P)+3]))if(Mt(le,ve[Ie+6])){for(se=0,Ie=2*(_e=Mt(le,ve[Ie+8]))+(ve=Mt(le,ve[Ie+9+_e])),_e=0,ve=nA[Ie];ve[se];++se)_e+=_e+Mt(le,ve[se]);_e+=3+(8<<Ie)}else Mt(le,ve[Ie+7])?(_e=7+2*Mt(le,165),_e+=Mt(le,145)):_e=5+Mt(le,159);else _e=Mt(le,ve[Ie+4])?3+Mt(le,ve[Ie+5]):2;se=oe[2]}else _e=1,se=oe[1];oe=ee+$n[q],0>(le=y).b&&Bt(le);var Ie,ve=le.b,Se=(Ie=le.Ca>>1)-(le.I>>ve)>>31;--le.b,le.Ca+=Se,le.Ca|=1,le.I-=(Ie+1&Se)<<ve,K[oe]=((_e^Se)-Se)*V[(0<q)+0]}return 16}function Tr(y){var E=y.rb[y.sb-1];E.la=0,E.Na=0,n(y.zc,0,0,y.zc.length),y.ja=0}function rs(y,E){if(y==null)return 0;if(E==null)return Zi(y,2,"NULL VP8Io parameter in VP8Decode().");if(!y.cb&&!Ms(y,E))return 0;if(e(y.cb),E.ac==null||E.ac(E)){E.ob&&(y.L=0);var P=x[y.L];if(y.L==2?(y.yb=0,y.zb=0):(y.yb=E.v-P>>4,y.zb=E.j-P>>4,0>y.yb&&(y.yb=0),0>y.zb&&(y.zb=0)),y.Va=E.o+15+P>>4,y.Hb=E.va+15+P>>4,y.Hb>y.za&&(y.Hb=y.za),y.Va>y.Ub&&(y.Va=y.Ub),0<y.L){var V=y.ed;for(P=0;4>P;++P){var q;if(y.Qa.Cb){var K=y.Qa.Lb[P];y.Qa.Fb||(K+=V.Tb)}else K=V.Tb;for(q=0;1>=q;++q){var ee=y.gd[P][q],se=K;if(V.Pc&&(se+=V.vd[0],q&&(se+=V.od[0])),0<(se=0>se?0:63<se?63:se)){var oe=se;0<V.wb&&(oe=4<V.wb?oe>>2:oe>>1)>9-V.wb&&(oe=9-V.wb),1>oe&&(oe=1),ee.dd=oe,ee.tc=2*se+oe,ee.ld=40<=se?2:15<=se?1:0}else ee.tc=0;ee.La=q}}}P=0}else Zi(y,6,"Frame setup failed"),P=y.a;if(P=P==0){if(P){y.$c=0,0<y.Aa||(y.Ic=I);e:{P=y.Ic,V=4*(oe=y.za);var le=32*oe,_e=oe+1,Ie=0<y.L?oe*(0<y.Aa?2:1):0,ve=(y.Aa==2?2:1)*oe;if((ee=V+832+(q=3*(16*P+x[y.L])/2*le)+(K=y.Fa!=null&&0<y.Fa.length?y.Kc.c*y.Kc.i:0))!=ee)P=0;else{if(ee>y.Vb){if(y.Vb=0,y.Ec=o(ee),y.Fc=0,y.Ec==null){P=Zi(y,1,"no memory during frame initialization.");break e}y.Vb=ee}ee=y.Ec,se=y.Fc,y.Ac=ee,y.Bc=se,se+=V,y.Gd=l(le,Or),y.Hd=0,y.rb=l(_e+1,yn),y.sb=1,y.wa=Ie?l(Ie,mn):null,y.Y=0,y.D.Nb=0,y.D.wa=y.wa,y.D.Y=y.Y,0<y.Aa&&(y.D.Y+=oe),e(!0),y.oc=ee,y.pc=se,se+=832,y.ya=l(ve,Hn),y.aa=0,y.D.ya=y.ya,y.D.aa=y.aa,y.Aa==2&&(y.D.aa+=oe),y.R=16*oe,y.B=8*oe,oe=(le=x[y.L])*y.R,le=le/2*y.B,y.sa=ee,y.ta=se+oe,y.qa=y.sa,y.ra=y.ta+16*P*y.R+le,y.Ha=y.qa,y.Ia=y.ra+8*P*y.B+le,y.$c=0,se+=q,y.mb=K?ee:null,y.nb=K?se:null,e(se+K<=y.Fc+y.Vb),Tr(y),n(y.Ac,y.Bc,0,V),P=1}}if(P){if(E.ka=0,E.y=y.sa,E.O=y.ta,E.f=y.qa,E.N=y.ra,E.ea=y.Ha,E.Vd=y.Ia,E.fa=y.R,E.Rc=y.B,E.F=null,E.J=0,!Li){for(P=-255;255>=P;++P)ya[255+P]=0>P?-P:P;for(P=-1020;1020>=P;++P)Di[1020+P]=-128>P?-128:127<P?127:P;for(P=-112;112>=P;++P)fl[112+P]=-16>P?-16:15<P?15:P;for(P=-255;510>=P;++P)pl[255+P]=0>P?0:255<P?255:P;Li=1}Po=Je,Js=$a,_s=Zs,uo=Ka,Pa=He,js=Lr,dl=yc,Wl=Zo,Ds=bh,Xo=hu,ln=Vl,qn=Nc,os=Au,Ur=Ou,en=Ql,nn=Io,Nn=Ko,ma=mc,sn[0]=ss,sn[1]=Ot,sn[2]=Wa,sn[3]=zl,sn[4]=To,sn[5]=gs,sn[6]=Ea,sn[7]=Sa,sn[8]=ca,sn[9]=Za,Do[0]=ns,Do[1]=ji,Do[2]=Br,Do[3]=In,Do[4]=_n,Do[5]=uu,Do[6]=Nl,qs[0]=Pr,qs[1]=di,qs[2]=Uc,qs[3]=Xa,qs[4]=us,qs[5]=ua,qs[6]=En,P=1}else P=0}P&&(P=function(Se,et){for(Se.M=0;Se.M<Se.Va;++Se.M){var Oe,Re=Se.Jc[Se.M&Se.Xb],Ve=Se.m,At=Se;for(Oe=0;Oe<At.za;++Oe){var dt=Ve,ft=At,Nt=ft.Ac,It=ft.Bc+4*Oe,jt=ft.zc,Ht=ft.ya[ft.aa+Oe];if(ft.Qa.Bb?Ht.$b=Mt(dt,ft.Pa.jb[0])?2+Mt(dt,ft.Pa.jb[2]):Mt(dt,ft.Pa.jb[1]):Ht.$b=0,ft.kc&&(Ht.Ad=Mt(dt,ft.Bd)),Ht.Za=!Mt(dt,145)+0,Ht.Za){var Mi=Ht.Ob,mi=0;for(ft=0;4>ft;++ft){var Ti,ui=jt[0+ft];for(Ti=0;4>Ti;++Ti){ui=zi[Nt[It+Ti]][ui];for(var ar=jc[Mt(dt,ui[0])];0<ar;)ar=jc[2*ar+Mt(dt,ui[ar])];ui=-ar,Nt[It+Ti]=ui}r(Mi,mi,Nt,It,4),mi+=4,jt[0+ft]=ui}}else ui=Mt(dt,156)?Mt(dt,128)?1:3:Mt(dt,163)?2:0,Ht.Ob[0]=ui,n(Nt,It,ui,4),n(jt,0,ui,4);Ht.Dd=Mt(dt,142)?Mt(dt,114)?Mt(dt,183)?1:3:2:0}if(At.m.Ka)return Zi(Se,7,"Premature end-of-partition0 encountered.");for(;Se.ja<Se.za;++Se.ja){if(At=Re,dt=(Ve=Se).rb[Ve.sb-1],Nt=Ve.rb[Ve.sb+Ve.ja],Oe=Ve.ya[Ve.aa+Ve.ja],It=Ve.kc?Oe.Ad:0)dt.la=Nt.la=0,Oe.Za||(dt.Na=Nt.Na=0),Oe.Hc=0,Oe.Gc=0,Oe.ia=0;else{var er,ir;if(dt=Nt,Nt=At,It=Ve.Pa.Xc,jt=Ve.ya[Ve.aa+Ve.ja],Ht=Ve.pb[jt.$b],ft=jt.ad,Mi=0,mi=Ve.rb[Ve.sb-1],ui=Ti=0,n(ft,Mi,0,384),jt.Za)var Dr=0,Rr=It[3];else{ar=o(16);var xr=dt.Na+mi.Na;if(xr=ks(Nt,It[1],xr,Ht.Eb,0,ar,0),dt.Na=mi.Na=(0<xr)+0,1<xr)Po(ar,0,ft,Mi);else{var $r=ar[0]+3>>3;for(ar=0;256>ar;ar+=16)ft[Mi+ar]=$r}Dr=1,Rr=It[0]}var br=15&dt.la,Wn=15&mi.la;for(ar=0;4>ar;++ar){var Kr=1&Wn;for($r=ir=0;4>$r;++$r)br=br>>1|(Kr=(xr=ks(Nt,Rr,xr=Kr+(1&br),Ht.Sc,Dr,ft,Mi))>Dr)<<7,ir=ir<<2|(3<xr?3:1<xr?2:ft[Mi+0]!=0),Mi+=16;br>>=4,Wn=Wn>>1|Kr<<7,Ti=(Ti<<8|ir)>>>0}for(Rr=br,Dr=Wn>>4,er=0;4>er;er+=2){for(ir=0,br=dt.la>>4+er,Wn=mi.la>>4+er,ar=0;2>ar;++ar){for(Kr=1&Wn,$r=0;2>$r;++$r)xr=Kr+(1&br),br=br>>1|(Kr=0<(xr=ks(Nt,It[2],xr,Ht.Qc,0,ft,Mi)))<<3,ir=ir<<2|(3<xr?3:1<xr?2:ft[Mi+0]!=0),Mi+=16;br>>=2,Wn=Wn>>1|Kr<<5}ui|=ir<<4*er,Rr|=br<<4<<er,Dr|=(240&Wn)<<er}dt.la=Rr,mi.la=Dr,jt.Hc=Ti,jt.Gc=ui,jt.ia=43690&ui?0:Ht.ia,It=!(Ti|ui)}if(0<Ve.L&&(Ve.wa[Ve.Y+Ve.ja]=Ve.gd[Oe.$b][Oe.Za],Ve.wa[Ve.Y+Ve.ja].La|=!It),At.Ka)return Zi(Se,7,"Premature end-of-file encountered.")}if(Tr(Se),Ve=et,At=1,Oe=(Re=Se).D,dt=0<Re.L&&Re.M>=Re.zb&&Re.M<=Re.Va,Re.Aa==0)e:{if(Oe.M=Re.M,Oe.uc=dt,_c(Re,Oe),At=1,Oe=(ir=Re.D).Nb,dt=(ui=x[Re.L])*Re.R,Nt=ui/2*Re.B,ar=16*Oe*Re.R,$r=8*Oe*Re.B,It=Re.sa,jt=Re.ta-dt+ar,Ht=Re.qa,ft=Re.ra-Nt+$r,Mi=Re.Ha,mi=Re.Ia-Nt+$r,Wn=(br=ir.M)==0,Ti=br>=Re.Va-1,Re.Aa==2&&_c(Re,ir),ir.uc)for(Kr=(xr=Re).D.M,e(xr.D.uc),ir=xr.yb;ir<xr.Hb;++ir){Dr=ir,Rr=Kr;var kr=(Wr=(bn=xr).D).Nb;er=bn.R;var Wr=Wr.wa[Wr.Y+Dr],ur=bn.sa,Nr=bn.ta+16*kr*er+16*Dr,on=Wr.dd,es=Wr.tc;if(es!=0)if(e(3<=es),bn.L==1)0<Dr&&nn(ur,Nr,er,es+4),Wr.La&&ma(ur,Nr,er,es),0<Rr&&en(ur,Nr,er,es+4),Wr.La&&Nn(ur,Nr,er,es);else{var an=bn.B,ts=bn.qa,Bs=bn.ra+8*kr*an+8*Dr,mr=bn.Ha,bn=bn.Ia+8*kr*an+8*Dr;kr=Wr.ld,0<Dr&&(Wl(ur,Nr,er,es+4,on,kr),Xo(ts,Bs,mr,bn,an,es+4,on,kr)),Wr.La&&(qn(ur,Nr,er,es,on,kr),Ur(ts,Bs,mr,bn,an,es,on,kr)),0<Rr&&(dl(ur,Nr,er,es+4,on,kr),Ds(ts,Bs,mr,bn,an,es+4,on,kr)),Wr.La&&(ln(ur,Nr,er,es,on,kr),os(ts,Bs,mr,bn,an,es,on,kr))}}if(Re.ia&&alert("todo:DitherRow"),Ve.put!=null){if(ir=16*br,br=16*(br+1),Wn?(Ve.y=Re.sa,Ve.O=Re.ta+ar,Ve.f=Re.qa,Ve.N=Re.ra+$r,Ve.ea=Re.Ha,Ve.W=Re.Ia+$r):(ir-=ui,Ve.y=It,Ve.O=jt,Ve.f=Ht,Ve.N=ft,Ve.ea=Mi,Ve.W=mi),Ti||(br-=ui),br>Ve.o&&(br=Ve.o),Ve.F=null,Ve.J=null,Re.Fa!=null&&0<Re.Fa.length&&ir<br&&(Ve.J=da(Re,Ve,ir,br-ir),Ve.F=Re.mb,Ve.F==null&&Ve.F.length==0)){At=Zi(Re,3,"Could not decode alpha data.");break e}ir<Ve.j&&(ui=Ve.j-ir,ir=Ve.j,e(!(1&ui)),Ve.O+=Re.R*ui,Ve.N+=Re.B*(ui>>1),Ve.W+=Re.B*(ui>>1),Ve.F!=null&&(Ve.J+=Ve.width*ui)),ir<br&&(Ve.O+=Ve.v,Ve.N+=Ve.v>>1,Ve.W+=Ve.v>>1,Ve.F!=null&&(Ve.J+=Ve.v),Ve.ka=ir-Ve.j,Ve.U=Ve.va-Ve.v,Ve.T=br-ir,At=Ve.put(Ve))}Oe+1!=Re.Ic||Ti||(r(Re.sa,Re.ta-dt,It,jt+16*Re.R,dt),r(Re.qa,Re.ra-Nt,Ht,ft+8*Re.B,Nt),r(Re.Ha,Re.Ia-Nt,Mi,mi+8*Re.B,Nt))}if(!At)return Zi(Se,6,"Output aborted.")}return 1}(y,E)),E.bc!=null&&E.bc(E),P&=1}return P?(y.cb=0,P):0}function Gr(y,E,P,V,q){q=y[E+P+32*V]+(q>>3),y[E+P+32*V]=-256&q?0>q?0:255:q}function Tn(y,E,P,V,q,K){Gr(y,E,0,P,V+q),Gr(y,E,1,P,V+K),Gr(y,E,2,P,V-K),Gr(y,E,3,P,V-q)}function Cn(y){return(20091*y>>16)+y}function po(y,E,P,V){var q,K=0,ee=o(16);for(q=0;4>q;++q){var se=y[E+0]+y[E+8],oe=y[E+0]-y[E+8],le=(35468*y[E+4]>>16)-Cn(y[E+12]),_e=Cn(y[E+4])+(35468*y[E+12]>>16);ee[K+0]=se+_e,ee[K+1]=oe+le,ee[K+2]=oe-le,ee[K+3]=se-_e,K+=4,E++}for(q=K=0;4>q;++q)se=(y=ee[K+0]+4)+ee[K+8],oe=y-ee[K+8],le=(35468*ee[K+4]>>16)-Cn(ee[K+12]),Gr(P,V,0,0,se+(_e=Cn(ee[K+4])+(35468*ee[K+12]>>16))),Gr(P,V,1,0,oe+le),Gr(P,V,2,0,oe-le),Gr(P,V,3,0,se-_e),K++,V+=32}function Lr(y,E,P,V){var q=y[E+0]+4,K=35468*y[E+4]>>16,ee=Cn(y[E+4]),se=35468*y[E+1]>>16;Tn(P,V,0,q+ee,y=Cn(y[E+1]),se),Tn(P,V,1,q+K,y,se),Tn(P,V,2,q-K,y,se),Tn(P,V,3,q-ee,y,se)}function $a(y,E,P,V,q){po(y,E,P,V),q&&po(y,E+16,P,V+4)}function Zs(y,E,P,V){Js(y,E+0,P,V,1),Js(y,E+32,P,V+128,1)}function Ka(y,E,P,V){var q;for(y=y[E+0]+4,q=0;4>q;++q)for(E=0;4>E;++E)Gr(P,V,E,q,y)}function He(y,E,P,V){y[E+0]&&uo(y,E+0,P,V),y[E+16]&&uo(y,E+16,P,V+4),y[E+32]&&uo(y,E+32,P,V+128),y[E+48]&&uo(y,E+48,P,V+128+4)}function Je(y,E,P,V){var q,K=o(16);for(q=0;4>q;++q){var ee=y[E+0+q]+y[E+12+q],se=y[E+4+q]+y[E+8+q],oe=y[E+4+q]-y[E+8+q],le=y[E+0+q]-y[E+12+q];K[0+q]=ee+se,K[8+q]=ee-se,K[4+q]=le+oe,K[12+q]=le-oe}for(q=0;4>q;++q)ee=(y=K[0+4*q]+3)+K[3+4*q],se=K[1+4*q]+K[2+4*q],oe=K[1+4*q]-K[2+4*q],le=y-K[3+4*q],P[V+0]=ee+se>>3,P[V+16]=le+oe>>3,P[V+32]=ee-se>>3,P[V+48]=le-oe>>3,V+=64}function gt(y,E,P){var V,q=E-32,K=Ys,ee=255-y[q-1];for(V=0;V<P;++V){var se,oe=K,le=ee+y[E-1];for(se=0;se<P;++se)y[E+se]=oe[le+y[q+se]];E+=32}}function Ot(y,E){gt(y,E,4)}function di(y,E){gt(y,E,8)}function ji(y,E){gt(y,E,16)}function Br(y,E){var P;for(P=0;16>P;++P)r(y,E+32*P,y,E-32,16)}function In(y,E){var P;for(P=16;0<P;--P)n(y,E,y[E-1],16),E+=32}function Gn(y,E,P){var V;for(V=0;16>V;++V)n(E,P+32*V,y,16)}function ns(y,E){var P,V=16;for(P=0;16>P;++P)V+=y[E-1+32*P]+y[E+P-32];Gn(V>>5,y,E)}function _n(y,E){var P,V=8;for(P=0;16>P;++P)V+=y[E-1+32*P];Gn(V>>4,y,E)}function uu(y,E){var P,V=8;for(P=0;16>P;++P)V+=y[E+P-32];Gn(V>>4,y,E)}function Nl(y,E){Gn(128,y,E)}function Cr(y,E,P){return y+2*E+P+2>>2}function Wa(y,E){var P,V=E-32;for(V=new Uint8Array([Cr(y[V-1],y[V+0],y[V+1]),Cr(y[V+0],y[V+1],y[V+2]),Cr(y[V+1],y[V+2],y[V+3]),Cr(y[V+2],y[V+3],y[V+4])]),P=0;4>P;++P)r(y,E+32*P,V,0,V.length)}function zl(y,E){var P=y[E-1],V=y[E-1+32],q=y[E-1+64],K=y[E-1+96];qt(y,E+0,16843009*Cr(y[E-1-32],P,V)),qt(y,E+32,16843009*Cr(P,V,q)),qt(y,E+64,16843009*Cr(V,q,K)),qt(y,E+96,16843009*Cr(q,K,K))}function ss(y,E){var P,V=4;for(P=0;4>P;++P)V+=y[E+P-32]+y[E-1+32*P];for(V>>=3,P=0;4>P;++P)n(y,E+32*P,V,4)}function To(y,E){var P=y[E-1+0],V=y[E-1+32],q=y[E-1+64],K=y[E-1-32],ee=y[E+0-32],se=y[E+1-32],oe=y[E+2-32],le=y[E+3-32];y[E+0+96]=Cr(V,q,y[E-1+96]),y[E+1+96]=y[E+0+64]=Cr(P,V,q),y[E+2+96]=y[E+1+64]=y[E+0+32]=Cr(K,P,V),y[E+3+96]=y[E+2+64]=y[E+1+32]=y[E+0+0]=Cr(ee,K,P),y[E+3+64]=y[E+2+32]=y[E+1+0]=Cr(se,ee,K),y[E+3+32]=y[E+2+0]=Cr(oe,se,ee),y[E+3+0]=Cr(le,oe,se)}function Ea(y,E){var P=y[E+1-32],V=y[E+2-32],q=y[E+3-32],K=y[E+4-32],ee=y[E+5-32],se=y[E+6-32],oe=y[E+7-32];y[E+0+0]=Cr(y[E+0-32],P,V),y[E+1+0]=y[E+0+32]=Cr(P,V,q),y[E+2+0]=y[E+1+32]=y[E+0+64]=Cr(V,q,K),y[E+3+0]=y[E+2+32]=y[E+1+64]=y[E+0+96]=Cr(q,K,ee),y[E+3+32]=y[E+2+64]=y[E+1+96]=Cr(K,ee,se),y[E+3+64]=y[E+2+96]=Cr(ee,se,oe),y[E+3+96]=Cr(se,oe,oe)}function gs(y,E){var P=y[E-1+0],V=y[E-1+32],q=y[E-1+64],K=y[E-1-32],ee=y[E+0-32],se=y[E+1-32],oe=y[E+2-32],le=y[E+3-32];y[E+0+0]=y[E+1+64]=K+ee+1>>1,y[E+1+0]=y[E+2+64]=ee+se+1>>1,y[E+2+0]=y[E+3+64]=se+oe+1>>1,y[E+3+0]=oe+le+1>>1,y[E+0+96]=Cr(q,V,P),y[E+0+64]=Cr(V,P,K),y[E+0+32]=y[E+1+96]=Cr(P,K,ee),y[E+1+32]=y[E+2+96]=Cr(K,ee,se),y[E+2+32]=y[E+3+96]=Cr(ee,se,oe),y[E+3+32]=Cr(se,oe,le)}function Sa(y,E){var P=y[E+0-32],V=y[E+1-32],q=y[E+2-32],K=y[E+3-32],ee=y[E+4-32],se=y[E+5-32],oe=y[E+6-32],le=y[E+7-32];y[E+0+0]=P+V+1>>1,y[E+1+0]=y[E+0+64]=V+q+1>>1,y[E+2+0]=y[E+1+64]=q+K+1>>1,y[E+3+0]=y[E+2+64]=K+ee+1>>1,y[E+0+32]=Cr(P,V,q),y[E+1+32]=y[E+0+96]=Cr(V,q,K),y[E+2+32]=y[E+1+96]=Cr(q,K,ee),y[E+3+32]=y[E+2+96]=Cr(K,ee,se),y[E+3+64]=Cr(ee,se,oe),y[E+3+96]=Cr(se,oe,le)}function Za(y,E){var P=y[E-1+0],V=y[E-1+32],q=y[E-1+64],K=y[E-1+96];y[E+0+0]=P+V+1>>1,y[E+2+0]=y[E+0+32]=V+q+1>>1,y[E+2+32]=y[E+0+64]=q+K+1>>1,y[E+1+0]=Cr(P,V,q),y[E+3+0]=y[E+1+32]=Cr(V,q,K),y[E+3+32]=y[E+1+64]=Cr(q,K,K),y[E+3+64]=y[E+2+64]=y[E+0+96]=y[E+1+96]=y[E+2+96]=y[E+3+96]=K}function ca(y,E){var P=y[E-1+0],V=y[E-1+32],q=y[E-1+64],K=y[E-1+96],ee=y[E-1-32],se=y[E+0-32],oe=y[E+1-32],le=y[E+2-32];y[E+0+0]=y[E+2+32]=P+ee+1>>1,y[E+0+32]=y[E+2+64]=V+P+1>>1,y[E+0+64]=y[E+2+96]=q+V+1>>1,y[E+0+96]=K+q+1>>1,y[E+3+0]=Cr(se,oe,le),y[E+2+0]=Cr(ee,se,oe),y[E+1+0]=y[E+3+32]=Cr(P,ee,se),y[E+1+32]=y[E+3+64]=Cr(V,P,ee),y[E+1+64]=y[E+3+96]=Cr(q,V,P),y[E+1+96]=Cr(K,q,V)}function Uc(y,E){var P;for(P=0;8>P;++P)r(y,E+32*P,y,E-32,8)}function Xa(y,E){var P;for(P=0;8>P;++P)n(y,E,y[E-1],8),E+=32}function go(y,E,P){var V;for(V=0;8>V;++V)n(E,P+32*V,y,8)}function Pr(y,E){var P,V=8;for(P=0;8>P;++P)V+=y[E+P-32]+y[E-1+32*P];go(V>>4,y,E)}function ua(y,E){var P,V=4;for(P=0;8>P;++P)V+=y[E+P-32];go(V>>3,y,E)}function us(y,E){var P,V=4;for(P=0;8>P;++P)V+=y[E-1+32*P];go(V>>3,y,E)}function En(y,E){go(128,y,E)}function hs(y,E,P){var V=y[E-P],q=y[E+0],K=3*(q-V)+bc[1020+y[E-2*P]-y[E+P]],ee=Fi[112+(K+4>>3)];y[E-P]=Ys[255+V+Fi[112+(K+3>>3)]],y[E+0]=Ys[255+q-ee]}function ha(y,E,P,V){var q=y[E+0],K=y[E+P];return eo[255+y[E-2*P]-y[E-P]]>V||eo[255+K-q]>V}function jr(y,E,P,V){return 4*eo[255+y[E-P]-y[E+0]]+eo[255+y[E-2*P]-y[E+P]]<=V}function cl(y,E,P,V,q){var K=y[E-3*P],ee=y[E-2*P],se=y[E-P],oe=y[E+0],le=y[E+P],_e=y[E+2*P],Ie=y[E+3*P];return 4*eo[255+se-oe]+eo[255+ee-le]>V?0:eo[255+y[E-4*P]-K]<=q&&eo[255+K-ee]<=q&&eo[255+ee-se]<=q&&eo[255+Ie-_e]<=q&&eo[255+_e-le]<=q&&eo[255+le-oe]<=q}function Ql(y,E,P,V){var q=2*V+1;for(V=0;16>V;++V)jr(y,E+V,P,q)&&hs(y,E+V,P)}function Io(y,E,P,V){var q=2*V+1;for(V=0;16>V;++V)jr(y,E+V*P,1,q)&&hs(y,E+V*P,1)}function Ko(y,E,P,V){var q;for(q=3;0<q;--q)Ql(y,E+=4*P,P,V)}function mc(y,E,P,V){var q;for(q=3;0<q;--q)Io(y,E+=4,P,V)}function Wo(y,E,P,V,q,K,ee,se){for(K=2*K+1;0<q--;){if(cl(y,E,P,K,ee))if(ha(y,E,P,se))hs(y,E,P);else{var oe=y,le=E,_e=P,Ie=oe[le-2*_e],ve=oe[le-_e],Se=oe[le+0],et=oe[le+_e],Oe=oe[le+2*_e],Re=27*(At=bc[1020+3*(Se-ve)+bc[1020+Ie-et]])+63>>7,Ve=18*At+63>>7,At=9*At+63>>7;oe[le-3*_e]=Ys[255+oe[le-3*_e]+At],oe[le-2*_e]=Ys[255+Ie+Ve],oe[le-_e]=Ys[255+ve+Re],oe[le+0]=Ys[255+Se-Re],oe[le+_e]=Ys[255+et-Ve],oe[le+2*_e]=Ys[255+Oe-At]}E+=V}}function mo(y,E,P,V,q,K,ee,se){for(K=2*K+1;0<q--;){if(cl(y,E,P,K,ee))if(ha(y,E,P,se))hs(y,E,P);else{var oe=y,le=E,_e=P,Ie=oe[le-_e],ve=oe[le+0],Se=oe[le+_e],et=Fi[112+((Oe=3*(ve-Ie))+4>>3)],Oe=Fi[112+(Oe+3>>3)],Re=et+1>>1;oe[le-2*_e]=Ys[255+oe[le-2*_e]+Re],oe[le-_e]=Ys[255+Ie+Oe],oe[le+0]=Ys[255+ve-et],oe[le+_e]=Ys[255+Se-Re]}E+=V}}function yc(y,E,P,V,q,K){Wo(y,E,P,1,16,V,q,K)}function Zo(y,E,P,V,q,K){Wo(y,E,1,P,16,V,q,K)}function Vl(y,E,P,V,q,K){var ee;for(ee=3;0<ee;--ee)mo(y,E+=4*P,P,1,16,V,q,K)}function Nc(y,E,P,V,q,K){var ee;for(ee=3;0<ee;--ee)mo(y,E+=4,1,P,16,V,q,K)}function bh(y,E,P,V,q,K,ee,se){Wo(y,E,q,1,8,K,ee,se),Wo(P,V,q,1,8,K,ee,se)}function hu(y,E,P,V,q,K,ee,se){Wo(y,E,1,q,8,K,ee,se),Wo(P,V,1,q,8,K,ee,se)}function Au(y,E,P,V,q,K,ee,se){mo(y,E+4*q,q,1,8,K,ee,se),mo(P,V+4*q,q,1,8,K,ee,se)}function Ou(y,E,P,V,q,K,ee,se){mo(y,E+4,1,q,8,K,ee,se),mo(P,V+4,1,q,8,K,ee,se)}function Hl(){this.ba=new Zr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Be,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ja(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Ya(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Gl(){this.ua=0,this.Wa=new lt,this.vb=new lt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Ze,this.yc=new De}function el(){this.xb=this.a=0,this.l=new qa,this.ca=new Zr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Le,this.Pb=0,this.wd=new Le,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Gl,this.ab=0,this.gc=l(4,Ya),this.Oc=0}function Aa(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new qa,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ul(y,E,P,V,q,K,ee){for(y=y==null?0:y[E+0],E=0;E<ee;++E)q[K+E]=y+P[V+E]&255,y=q[K+E]}function jl(y,E,P,V,q,K,ee){var se;if(y==null)ul(null,null,P,V,q,K,ee);else for(se=0;se<ee;++se)q[K+se]=y[E+se]+P[V+se]&255}function lo(y,E,P,V,q,K,ee){if(y==null)ul(null,null,P,V,q,K,ee);else{var se,oe=y[E+0],le=oe,_e=oe;for(se=0;se<ee;++se)le=_e+(oe=y[E+se])-le,_e=P[V+se]+(-256&le?0>le?0:255:le)&255,le=oe,q[K+se]=_e}}function da(y,E,P,V){var q=E.width,K=E.o;if(e(y!=null&&E!=null),0>P||0>=V||P+V>K)return null;if(!y.Cc){if(y.ga==null){var ee;if(y.ga=new Aa,(ee=y.ga==null)||(ee=E.width*E.o,e(y.Gb.length==0),y.Gb=o(ee),y.Uc=0,y.Gb==null?ee=0:(y.mb=y.Gb,y.nb=y.Uc,y.rc=null,ee=1),ee=!ee),!ee){ee=y.ga;var se=y.Fa,oe=y.P,le=y.qc,_e=y.mb,Ie=y.nb,ve=oe+1,Se=le-1,et=ee.l;if(e(se!=null&&_e!=null&&E!=null),$s[0]=null,$s[1]=ul,$s[2]=jl,$s[3]=lo,ee.ca=_e,ee.tb=Ie,ee.c=E.width,ee.i=E.height,e(0<ee.c&&0<ee.i),1>=le)E=0;else if(ee.$a=se[oe+0]>>0&3,ee.Z=se[oe+0]>>2&3,ee.Lc=se[oe+0]>>4&3,oe=se[oe+0]>>6&3,0>ee.$a||1<ee.$a||4<=ee.Z||1<ee.Lc||oe)E=0;else if(et.put=xe,et.ac=ge,et.bc=Ee,et.ma=ee,et.width=E.width,et.height=E.height,et.Da=E.Da,et.v=E.v,et.va=E.va,et.j=E.j,et.o=E.o,ee.$a)e:{e(ee.$a==1),E=Ci();t:for(;;){if(E==null){E=0;break e}if(e(ee!=null),ee.mc=E,E.c=ee.c,E.i=ee.i,E.l=ee.l,E.l.ma=ee,E.l.width=ee.c,E.l.height=ee.i,E.a=0,bt(E.m,se,ve,Se),!Ni(ee.c,ee.i,1,E,null)||(E.ab==1&&E.gc[0].hc==3&&ii(E.s)?(ee.ic=1,se=E.c*E.i,E.Ta=null,E.Ua=0,E.V=o(se),E.Ba=0,E.V==null?(E.a=1,E=0):E=1):(ee.ic=0,E=ot(E,ee.c)),!E))break t;E=1;break e}ee.mc=null,E=0}else E=Se>=ee.c*ee.i;ee=!E}if(ee)return null;y.ga.Lc!=1?y.Ga=0:V=K-P}e(y.ga!=null),e(P+V<=K);e:{if(E=(se=y.ga).c,K=se.l.o,se.$a==0){if(ve=y.rc,Se=y.Vc,et=y.Fa,oe=y.P+1+P*E,le=y.mb,_e=y.nb+P*E,e(oe<=y.P+y.qc),se.Z!=0)for(e($s[se.Z]!=null),ee=0;ee<V;++ee)$s[se.Z](ve,Se,et,oe,le,_e,E),ve=le,Se=_e,_e+=E,oe+=E;else for(ee=0;ee<V;++ee)r(le,_e,et,oe,E),ve=le,Se=_e,_e+=E,oe+=E;y.rc=ve,y.Vc=Se}else{if(e(se.mc!=null),E=P+V,e((ee=se.mc)!=null),e(E<=ee.i),ee.C>=E)E=1;else if(se.ic||xt(),se.ic){se=ee.V,ve=ee.Ba,Se=ee.c;var Oe=ee.i,Re=(et=1,oe=ee.$/Se,le=ee.$%Se,_e=ee.m,Ie=ee.s,ee.$),Ve=Se*Oe,At=Se*E,dt=Ie.wc,ft=Re<At?vt(Ie,le,oe):null;e(Re<=Ve),e(E<=Oe),e(ii(Ie));t:for(;;){for(;!_e.h&&Re<At;){if(le&dt||(ft=vt(Ie,le,oe)),e(ft!=null),mt(_e),256>(Oe=Ge(ft.G[0],ft.H[0],_e)))se[ve+Re]=Oe,++Re,++le>=Se&&(le=0,++oe<=E&&!(oe%16)&&Ai(ee,oe));else{if(!(280>Oe)){et=0;break t}Oe=Fe(Oe-256,_e);var Nt,It=Ge(ft.G[4],ft.H[4],_e);if(mt(_e),!(Re>=(It=ze(Se,It=Fe(It,_e)))&&Ve-Re>=Oe)){et=0;break t}for(Nt=0;Nt<Oe;++Nt)se[ve+Re+Nt]=se[ve+Re+Nt-It];for(Re+=Oe,le+=Oe;le>=Se;)le-=Se,++oe<=E&&!(oe%16)&&Ai(ee,oe);Re<At&&le&dt&&(ft=vt(Ie,le,oe))}e(_e.h==it(_e))}Ai(ee,oe>E?E:oe);break t}!et||_e.h&&Re<Ve?(et=0,ee.a=_e.h?5:3):ee.$=Re,E=et}else E=Bi(ee,ee.V,ee.Ba,ee.c,ee.i,E,ri);if(!E){V=0;break e}}P+V>=K&&(y.Cc=1),V=1}if(!V)return null;if(y.Cc&&((V=y.ga)!=null&&(V.mc=null),y.ga=null,0<y.Ga))return alert("todo:WebPDequantizeLevels"),null}return y.nb+P*q}function ne(y,E,P,V,q,K){for(;0<q--;){var ee,se=y,oe=E+(P?1:0),le=y,_e=E+(P?0:3);for(ee=0;ee<V;++ee){var Ie=le[_e+4*ee];Ie!=255&&(Ie*=32897,se[oe+4*ee+0]=se[oe+4*ee+0]*Ie>>23,se[oe+4*ee+1]=se[oe+4*ee+1]*Ie>>23,se[oe+4*ee+2]=se[oe+4*ee+2]*Ie>>23)}E+=K}}function Pe(y,E,P,V,q){for(;0<V--;){var K;for(K=0;K<P;++K){var ee=y[E+2*K+0],se=15&(le=y[E+2*K+1]),oe=4369*se,le=(240&le|le>>4)*oe>>16;y[E+2*K+0]=(240&ee|ee>>4)*oe>>16&240|(15&ee|ee<<4)*oe>>16>>4&15,y[E+2*K+1]=240&le|se}E+=q}}function ct(y,E,P,V,q,K,ee,se){var oe,le,_e=255;for(le=0;le<q;++le){for(oe=0;oe<V;++oe){var Ie=y[E+oe];K[ee+4*oe]=Ie,_e&=Ie}E+=P,ee+=se}return _e!=255}function _t(y,E,P,V,q){var K;for(K=0;K<q;++K)P[V+K]=y[E+K]>>8}function xt(){Fa=ne,Jo=Pe,Yo=ct,Ui=_t}function Lt(y,E,P){Ne[y]=function(V,q,K,ee,se,oe,le,_e,Ie,ve,Se,et,Oe,Re,Ve,At,dt){var ft,Nt=dt-1>>1,It=se[oe+0]|le[_e+0]<<16,jt=Ie[ve+0]|Se[et+0]<<16;e(V!=null);var Ht=3*It+jt+131074>>2;for(E(V[q+0],255&Ht,Ht>>16,Oe,Re),K!=null&&(Ht=3*jt+It+131074>>2,E(K[ee+0],255&Ht,Ht>>16,Ve,At)),ft=1;ft<=Nt;++ft){var Mi=se[oe+ft]|le[_e+ft]<<16,mi=Ie[ve+ft]|Se[et+ft]<<16,Ti=It+Mi+jt+mi+524296,ui=Ti+2*(Mi+jt)>>3;Ht=ui+It>>1,It=(Ti=Ti+2*(It+mi)>>3)+Mi>>1,E(V[q+2*ft-1],255&Ht,Ht>>16,Oe,Re+(2*ft-1)*P),E(V[q+2*ft-0],255&It,It>>16,Oe,Re+(2*ft-0)*P),K!=null&&(Ht=Ti+jt>>1,It=ui+mi>>1,E(K[ee+2*ft-1],255&Ht,Ht>>16,Ve,At+(2*ft-1)*P),E(K[ee+2*ft+0],255&It,It>>16,Ve,At+(2*ft+0)*P)),It=Mi,jt=mi}1&dt||(Ht=3*It+jt+131074>>2,E(V[q+dt-1],255&Ht,Ht>>16,Oe,Re+(dt-1)*P),K!=null&&(Ht=3*jt+It+131074>>2,E(K[ee+dt-1],255&Ht,Ht>>16,Ve,At+(dt-1)*P)))}}function pi(){Jr[zc]=Fn,Jr[Zl]=ec,Jr[du]=Yl,Jr[Qc]=ko,Jr[Xl]=Da,Jr[Vc]=tc,Jr[il]=qc,Jr[vn]=ec,Jr[Rs]=ko,Jr[Fo]=Da,Jr[gl]=tc}function si(y){return y&~A?0>y?0:255:y>>N}function nr(y,E){return si((19077*y>>8)+(26149*E>>8)-14234)}function qi(y,E,P){return si((19077*y>>8)-(6419*E>>8)-(13320*P>>8)+8708)}function Yi(y,E){return si((19077*y>>8)+(33050*E>>8)-17685)}function cr(y,E,P,V,q){V[q+0]=nr(y,P),V[q+1]=qi(y,E,P),V[q+2]=Yi(y,E)}function jn(y,E,P,V,q){V[q+0]=Yi(y,E),V[q+1]=qi(y,E,P),V[q+2]=nr(y,P)}function or(y,E,P,V,q){var K=qi(y,E,P);E=K<<3&224|Yi(y,E)>>3,V[q+0]=248&nr(y,P)|K>>5,V[q+1]=E}function Pn(y,E,P,V,q){var K=240&Yi(y,E)|15;V[q+0]=240&nr(y,P)|qi(y,E,P)>>4,V[q+1]=K}function Fr(y,E,P,V,q){V[q+0]=255,cr(y,E,P,V,q+1)}function Ir(y,E,P,V,q){jn(y,E,P,V,q),V[q+3]=255}function Ps(y,E,P,V,q){cr(y,E,P,V,q),V[q+3]=255}function Xs(y,E){return 0>y?0:y>E?E:y}function Lo(y,E,P){Ne[y]=function(V,q,K,ee,se,oe,le,_e,Ie){for(var ve=_e+(-2&Ie)*P;_e!=ve;)E(V[q+0],K[ee+0],se[oe+0],le,_e),E(V[q+1],K[ee+0],se[oe+0],le,_e+P),q+=2,++ee,++oe,_e+=2*P;1&Ie&&E(V[q+0],K[ee+0],se[oe+0],le,_e)}}function Ta(y,E,P){return P==0?y==0?E==0?6:5:E==0?4:0:P}function fa(y,E,P,V,q){switch(y>>>30){case 3:Js(E,P,V,q,0);break;case 2:js(E,P,V,q);break;case 1:uo(E,P,V,q)}}function _c(y,E){var P,V,q=E.M,K=E.Nb,ee=y.oc,se=y.pc+40,oe=y.oc,le=y.pc+584,_e=y.oc,Ie=y.pc+600;for(P=0;16>P;++P)ee[se+32*P-1]=129;for(P=0;8>P;++P)oe[le+32*P-1]=129,_e[Ie+32*P-1]=129;for(0<q?ee[se-1-32]=oe[le-1-32]=_e[Ie-1-32]=129:(n(ee,se-32-1,127,21),n(oe,le-32-1,127,9),n(_e,Ie-32-1,127,9)),V=0;V<y.za;++V){var ve=E.ya[E.aa+V];if(0<V){for(P=-1;16>P;++P)r(ee,se+32*P-4,ee,se+32*P+12,4);for(P=-1;8>P;++P)r(oe,le+32*P-4,oe,le+32*P+4,4),r(_e,Ie+32*P-4,_e,Ie+32*P+4,4)}var Se=y.Gd,et=y.Hd+V,Oe=ve.ad,Re=ve.Hc;if(0<q&&(r(ee,se-32,Se[et].y,0,16),r(oe,le-32,Se[et].f,0,8),r(_e,Ie-32,Se[et].ea,0,8)),ve.Za){var Ve=ee,At=se-32+16;for(0<q&&(V>=y.za-1?n(Ve,At,Se[et].y[15],4):r(Ve,At,Se[et+1].y,0,4)),P=0;4>P;P++)Ve[At+128+P]=Ve[At+256+P]=Ve[At+384+P]=Ve[At+0+P];for(P=0;16>P;++P,Re<<=2)Ve=ee,At=se+p[P],sn[ve.Ob[P]](Ve,At),fa(Re,Oe,16*+P,Ve,At)}else if(Ve=Ta(V,q,ve.Ob[0]),Do[Ve](ee,se),Re!=0)for(P=0;16>P;++P,Re<<=2)fa(Re,Oe,16*+P,ee,se+p[P]);for(P=ve.Gc,Ve=Ta(V,q,ve.Dd),qs[Ve](oe,le),qs[Ve](_e,Ie),Re=Oe,Ve=oe,At=le,255&(ve=P>>0)&&(170&ve?_s(Re,256,Ve,At):Pa(Re,256,Ve,At)),ve=_e,Re=Ie,255&(P>>=8)&&(170&P?_s(Oe,320,ve,Re):Pa(Oe,320,ve,Re)),q<y.Ub-1&&(r(Se[et].y,0,ee,se+480,16),r(Se[et].f,0,oe,le+224,8),r(Se[et].ea,0,_e,Ie+224,8)),P=8*K*y.B,Se=y.sa,et=y.ta+16*V+16*K*y.R,Oe=y.qa,ve=y.ra+8*V+P,Re=y.Ha,Ve=y.Ia+8*V+P,P=0;16>P;++P)r(Se,et+P*y.R,ee,se+32*P,16);for(P=0;8>P;++P)r(Oe,ve+P*y.B,oe,le+32*P,8),r(Re,Ve+P*y.B,_e,Ie+32*P,8)}}function hl(y,E,P,V,q,K,ee,se,oe){var le=[0],_e=[0],Ie=0,ve=oe!=null?oe.kd:0,Se=oe??new Ja;if(y==null||12>P)return 7;Se.data=y,Se.w=E,Se.ha=P,E=[E],P=[P],Se.gb=[Se.gb];e:{var et=E,Oe=P,Re=Se.gb;if(e(y!=null),e(Oe!=null),e(Re!=null),Re[0]=0,12<=Oe[0]&&!t(y,et[0],"RIFF")){if(t(y,et[0]+8,"WEBP")){Re=3;break e}var Ve=vi(y,et[0]+4);if(12>Ve||4294967286<Ve){Re=3;break e}if(ve&&Ve>Oe[0]-8){Re=7;break e}Re[0]=Ve,et[0]+=12,Oe[0]-=12}Re=0}if(Re!=0)return Re;for(Ve=0<Se.gb[0],P=P[0];;){e:{var At=y;Oe=E,Re=P;var dt=le,ft=_e,Nt=et=[0];if((Ht=Ie=[Ie])[0]=0,8>Re[0])Re=7;else{if(!t(At,Oe[0],"VP8X")){if(vi(At,Oe[0]+4)!=10){Re=3;break e}if(18>Re[0]){Re=7;break e}var It=vi(At,Oe[0]+8),jt=1+_i(At,Oe[0]+12);if(2147483648<=jt*(At=1+_i(At,Oe[0]+15))){Re=3;break e}Nt!=null&&(Nt[0]=It),dt!=null&&(dt[0]=jt),ft!=null&&(ft[0]=At),Oe[0]+=18,Re[0]-=18,Ht[0]=1}Re=0}}if(Ie=Ie[0],et=et[0],Re!=0)return Re;if(Oe=!!(2&et),!Ve&&Ie)return 3;if(K!=null&&(K[0]=!!(16&et)),ee!=null&&(ee[0]=Oe),se!=null&&(se[0]=0),ee=le[0],et=_e[0],Ie&&Oe&&oe==null){Re=0;break}if(4>P){Re=7;break}if(Ve&&Ie||!Ve&&!Ie&&!t(y,E[0],"ALPH")){P=[P],Se.na=[Se.na],Se.P=[Se.P],Se.Sa=[Se.Sa];e:{It=y,Re=E,Ve=P;var Ht=Se.gb;dt=Se.na,ft=Se.P,Nt=Se.Sa,jt=22,e(It!=null),e(Ve!=null),At=Re[0];var Mi=Ve[0];for(e(dt!=null),e(Nt!=null),dt[0]=null,ft[0]=null,Nt[0]=0;;){if(Re[0]=At,Ve[0]=Mi,8>Mi){Re=7;break e}var mi=vi(It,At+4);if(4294967286<mi){Re=3;break e}var Ti=8+mi+1&-2;if(jt+=Ti,0<Ht&&jt>Ht){Re=3;break e}if(!t(It,At,"VP8 ")||!t(It,At,"VP8L")){Re=0;break e}if(Mi[0]<Ti){Re=7;break e}t(It,At,"ALPH")||(dt[0]=It,ft[0]=At+8,Nt[0]=mi),At+=Ti,Mi-=Ti}}if(P=P[0],Se.na=Se.na[0],Se.P=Se.P[0],Se.Sa=Se.Sa[0],Re!=0)break}P=[P],Se.Ja=[Se.Ja],Se.xa=[Se.xa];e:if(Ht=y,Re=E,Ve=P,dt=Se.gb[0],ft=Se.Ja,Nt=Se.xa,It=Re[0],At=!t(Ht,It,"VP8 "),jt=!t(Ht,It,"VP8L"),e(Ht!=null),e(Ve!=null),e(ft!=null),e(Nt!=null),8>Ve[0])Re=7;else{if(At||jt){if(Ht=vi(Ht,It+4),12<=dt&&Ht>dt-12){Re=3;break e}if(ve&&Ht>Ve[0]-8){Re=7;break e}ft[0]=Ht,Re[0]+=8,Ve[0]-=8,Nt[0]=jt}else Nt[0]=5<=Ve[0]&&Ht[It+0]==47&&!(Ht[It+4]>>5),ft[0]=Ve[0];Re=0}if(P=P[0],Se.Ja=Se.Ja[0],Se.xa=Se.xa[0],E=E[0],Re!=0)break;if(4294967286<Se.Ja)return 3;if(se==null||Oe||(se[0]=Se.xa?2:1),ee=[ee],et=[et],Se.xa){if(5>P){Re=7;break}se=ee,ve=et,Oe=K,y==null||5>P?y=0:5<=P&&y[E+0]==47&&!(y[E+4]>>5)?(Ve=[0],Ht=[0],dt=[0],bt(ft=new Le,y,E,P),we(ft,Ve,Ht,dt)?(se!=null&&(se[0]=Ve[0]),ve!=null&&(ve[0]=Ht[0]),Oe!=null&&(Oe[0]=dt[0]),y=1):y=0):y=0}else{if(10>P){Re=7;break}se=et,y==null||10>P||!ao(y,E+3,P-3)?y=0:(ve=y[E+0]|y[E+1]<<8|y[E+2]<<16,Oe=16383&(y[E+7]<<8|y[E+6]),y=16383&(y[E+9]<<8|y[E+8]),1&ve||3<(ve>>1&7)||!(ve>>4&1)||ve>>5>=Se.Ja||!Oe||!y?y=0:(ee&&(ee[0]=Oe),se&&(se[0]=y),y=1))}if(!y||(ee=ee[0],et=et[0],Ie&&(le[0]!=ee||_e[0]!=et)))return 3;oe!=null&&(oe[0]=Se,oe.offset=E-oe.w,e(4294967286>E-oe.w),e(oe.offset==oe.ha-P));break}return Re==0||Re==7&&Ie&&oe==null?(K!=null&&(K[0]|=Se.na!=null&&0<Se.na.length),V!=null&&(V[0]=ee),q!=null&&(q[0]=et),0):Re}function ql(y,E,P){var V=E.width,q=E.height,K=0,ee=0,se=V,oe=q;if(E.Da=y!=null&&0<y.Da,E.Da&&(se=y.cd,oe=y.bd,K=y.v,ee=y.j,11>P||(K&=-2,ee&=-2),0>K||0>ee||0>=se||0>=oe||K+se>V||ee+oe>q))return 0;if(E.v=K,E.j=ee,E.va=K+se,E.o=ee+oe,E.U=se,E.T=oe,E.da=y!=null&&0<y.da,E.da){if(!wt(se,oe,P=[y.ib],K=[y.hb]))return 0;E.ib=P[0],E.hb=K[0]}return E.ob=y!=null&&y.ob,E.Kb=y==null||!y.Sd,E.da&&(E.ob=E.ib<3*V/4&&E.hb<3*q/4,E.Kb=0),1}function vc(y){if(y==null)return 2;if(11>y.S){var E=y.f.RGBA;E.fb+=(y.height-1)*E.A,E.A=-E.A}else E=y.f.kb,y=y.height,E.O+=(y-1)*E.fa,E.fa=-E.fa,E.N+=(y-1>>1)*E.Ab,E.Ab=-E.Ab,E.W+=(y-1>>1)*E.Db,E.Db=-E.Db,E.F!=null&&(E.J+=(y-1)*E.lb,E.lb=-E.lb);return 0}function Ia(y,E,P,V){if(V==null||0>=y||0>=E)return 2;if(P!=null){if(P.Da){var q=P.cd,K=P.bd,ee=-2&P.v,se=-2&P.j;if(0>ee||0>se||0>=q||0>=K||ee+q>y||se+K>E)return 2;y=q,E=K}if(P.da){if(!wt(y,E,q=[P.ib],K=[P.hb]))return 2;y=q[0],E=K[0]}}V.width=y,V.height=E;e:{var oe=V.width,le=V.height;if(y=V.S,0>=oe||0>=le||!(y>=zc&&13>y))y=2;else{if(0>=V.Rd&&V.sd==null){ee=K=q=E=0;var _e=(se=oe*j[y])*le;if(11>y||(K=(le+1)/2*(E=(oe+1)/2),y==12&&(ee=(q=oe)*le)),(le=o(_e+2*K+ee))==null){y=1;break e}V.sd=le,11>y?((oe=V.f.RGBA).eb=le,oe.fb=0,oe.A=se,oe.size=_e):((oe=V.f.kb).y=le,oe.O=0,oe.fa=se,oe.Fd=_e,oe.f=le,oe.N=0+_e,oe.Ab=E,oe.Cd=K,oe.ea=le,oe.W=0+_e+K,oe.Db=E,oe.Ed=K,y==12&&(oe.F=le,oe.J=0+_e+2*K),oe.Tc=ee,oe.lb=q)}if(E=1,q=V.S,K=V.width,ee=V.height,q>=zc&&13>q)if(11>q)y=V.f.RGBA,E&=(se=Math.abs(y.A))*(ee-1)+K<=y.size,E&=se>=K*j[q],E&=y.eb!=null;else{y=V.f.kb,se=(K+1)/2,_e=(ee+1)/2,oe=Math.abs(y.fa),le=Math.abs(y.Ab);var Ie=Math.abs(y.Db),ve=Math.abs(y.lb),Se=ve*(ee-1)+K;E&=oe*(ee-1)+K<=y.Fd,E&=le*(_e-1)+se<=y.Cd,E=(E&=Ie*(_e-1)+se<=y.Ed)&oe>=K&le>=se&Ie>=se,E&=y.y!=null,E&=y.f!=null,E&=y.ea!=null,q==12&&(E&=ve>=K,E&=Se<=y.Tc,E&=y.F!=null)}else E=0;y=E?0:2}}return y!=0||P!=null&&P.fd&&(y=vc(V)),y}var ms=64,Al=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],$l=24,La=32,Ma=8,Fs=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ht("Predictor0","PredictorAdd0"),Ne.Predictor0=function(){return 4278190080},Ne.Predictor1=function(y){return y},Ne.Predictor2=function(y,E,P){return E[P+0]},Ne.Predictor3=function(y,E,P){return E[P+1]},Ne.Predictor4=function(y,E,P){return E[P-1]},Ne.Predictor5=function(y,E,P){return oi(oi(y,E[P+1]),E[P+0])},Ne.Predictor6=function(y,E,P){return oi(y,E[P-1])},Ne.Predictor7=function(y,E,P){return oi(y,E[P+0])},Ne.Predictor8=function(y,E,P){return oi(E[P-1],E[P+0])},Ne.Predictor9=function(y,E,P){return oi(E[P+0],E[P+1])},Ne.Predictor10=function(y,E,P){return oi(oi(y,E[P-1]),oi(E[P+0],E[P+1]))},Ne.Predictor11=function(y,E,P){var V=E[P+0];return 0>=Ki(V>>24&255,y>>24&255,(E=E[P-1])>>24&255)+Ki(V>>16&255,y>>16&255,E>>16&255)+Ki(V>>8&255,y>>8&255,E>>8&255)+Ki(255&V,255&y,255&E)?V:y},Ne.Predictor12=function(y,E,P){var V=E[P+0];return(gi((y>>24&255)+(V>>24&255)-((E=E[P-1])>>24&255))<<24|gi((y>>16&255)+(V>>16&255)-(E>>16&255))<<16|gi((y>>8&255)+(V>>8&255)-(E>>8&255))<<8|gi((255&y)+(255&V)-(255&E)))>>>0},Ne.Predictor13=function(y,E,P){var V=E[P-1];return(ci((y=oi(y,E[P+0]))>>24&255,V>>24&255)<<24|ci(y>>16&255,V>>16&255)<<16|ci(y>>8&255,V>>8&255)<<8|ci(y>>0&255,V>>0&255))>>>0};var Uu=Ne.PredictorAdd0;Ne.PredictorAdd1=tr,ht("Predictor2","PredictorAdd2"),ht("Predictor3","PredictorAdd3"),ht("Predictor4","PredictorAdd4"),ht("Predictor5","PredictorAdd5"),ht("Predictor6","PredictorAdd6"),ht("Predictor7","PredictorAdd7"),ht("Predictor8","PredictorAdd8"),ht("Predictor9","PredictorAdd9"),ht("Predictor10","PredictorAdd10"),ht("Predictor11","PredictorAdd11"),ht("Predictor12","PredictorAdd12"),ht("Predictor13","PredictorAdd13");var Ln=Ne.PredictorAdd2;Wi("ColorIndexInverseTransform","MapARGB","32b",function(y){return y>>8&255},function(y){return y}),Wi("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(y){return y},function(y){return y>>8&255});var fn,pn=Ne.ColorIndexInverseTransform,As=Ne.MapARGB,pa=Ne.VP8LColorIndexInverseTransformAlpha,Kl=Ne.MapAlpha,co=Ne.VP8LPredictorsAdd=[];co.length=16,(Ne.VP8LPredictors=[]).length=16,(Ne.VP8LPredictorsAdd_C=[]).length=16,(Ne.VP8LPredictors_C=[]).length=16;var ys,ds,Mo,yo,ga,tl,Po,Js,js,_s,uo,Pa,dl,Wl,Ds,Xo,ln,qn,os,Ur,en,nn,Nn,ma,Fa,Jo,Yo,Ui,ya=o(511),Di=o(2041),fl=o(225),pl=o(767),Li=0,bc=Di,Fi=fl,Ys=pl,eo=ya,zc=0,Zl=1,du=2,Qc=3,Xl=4,Vc=5,il=6,vn=7,Rs=8,Fo=9,gl=10,fu=[2,3,7],Hc=[3,3,11],Nu=[280,256,256,256,40],_a=[0,1,1,1,0],to=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Ei=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],sr=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ml=8,Gc=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Jl=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ks=null,nA=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],$n=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],jc=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],$i=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],zi=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Kn=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],zu=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Do=[],sn=[],qs=[],Ro=1,pu=2,$s=[],Jr=[];Lt("UpsampleRgbLinePair",cr,3),Lt("UpsampleBgrLinePair",jn,3),Lt("UpsampleRgbaLinePair",Ps,4),Lt("UpsampleBgraLinePair",Ir,4),Lt("UpsampleArgbLinePair",Fr,4),Lt("UpsampleRgba4444LinePair",Pn,2),Lt("UpsampleRgb565LinePair",or,2);var Fn=Ne.UpsampleRgbLinePair,Yl=Ne.UpsampleBgrLinePair,ec=Ne.UpsampleRgbaLinePair,ko=Ne.UpsampleBgraLinePair,Da=Ne.UpsampleArgbLinePair,tc=Ne.UpsampleRgba4444LinePair,qc=Ne.UpsampleRgb565LinePair,Oo=16,ic=1<<Oo-1,va=-227,zr=482,N=6,A=(256<<N)-1,b=0,L=o(256),O=o(256),z=o(256),X=o(256),w=o(zr-va),a=o(zr-va);Lo("YuvToRgbRow",cr,3),Lo("YuvToBgrRow",jn,3),Lo("YuvToRgbaRow",Ps,4),Lo("YuvToBgraRow",Ir,4),Lo("YuvToArgbRow",Fr,4),Lo("YuvToRgba4444Row",Pn,2),Lo("YuvToRgb565Row",or,2);var p=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],x=[0,2,8],B=[8,7,6,4,4,2,2,2,1,1,1,1],I=1;this.WebPDecodeRGBA=function(y,E,P,V,q){var K=Zl,ee=new Hl,se=new Zr;ee.ba=se,se.S=K,se.width=[se.width],se.height=[se.height];var oe=se.width,le=se.height,_e=new Qe;if(_e==null||y==null)var Ie=2;else e(_e!=null),Ie=hl(y,E,P,_e.width,_e.height,_e.Pd,_e.Qd,_e.format,null);if(Ie!=0?oe=0:(oe!=null&&(oe[0]=_e.width[0]),le!=null&&(le[0]=_e.height[0]),oe=1),oe){se.width=se.width[0],se.height=se.height[0],V!=null&&(V[0]=se.width),q!=null&&(q[0]=se.height);e:{if(V=new qa,(q=new Ja).data=y,q.w=E,q.ha=P,q.kd=1,E=[0],e(q!=null),((y=hl(q.data,q.w,q.ha,null,null,null,E,null,q))==0||y==7)&&E[0]&&(y=4),(E=y)==0){if(e(ee!=null),V.data=q.data,V.w=q.w+q.offset,V.ha=q.ha-q.offset,V.put=xe,V.ac=ge,V.bc=Ee,V.ma=ee,q.xa){if((y=Ci())==null){ee=1;break e}if(function(ve,Se){var et=[0],Oe=[0],Re=[0];t:for(;;){if(ve==null)return 0;if(Se==null)return ve.a=2,0;if(ve.l=Se,ve.a=0,bt(ve.m,Se.data,Se.w,Se.ha),!we(ve.m,et,Oe,Re)){ve.a=3;break t}if(ve.xb=pu,Se.width=et[0],Se.height=Oe[0],!Ni(et[0],Oe[0],1,ve,null))break t;return 1}return e(ve.a!=0),0}(y,V)){if(V=(E=Ia(V.width,V.height,ee.Oa,ee.ba))==0){t:{V=y;i:for(;;){if(V==null){V=0;break t}if(e(V.s.yc!=null),e(V.s.Ya!=null),e(0<V.s.Wb),e((P=V.l)!=null),e((q=P.ma)!=null),V.xb!=0){if(V.ca=q.ba,V.tb=q.tb,e(V.ca!=null),!ql(q.Oa,P,Qc)){V.a=2;break i}if(!ot(V,P.width)||P.da)break i;if((P.da||bi(V.ca.S))&&xt(),11>V.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),V.ca.f.kb.F!=null&&xt()),V.Pb&&0<V.s.ua&&V.s.vb.X==null&&!Pi(V.s.vb,V.s.Wa.Xa)){V.a=1;break i}V.xb=0}if(!Bi(V,V.V,V.Ba,V.c,V.i,P.o,Kt))break i;q.Dc=V.Ma,V=1;break t}e(V.a!=0),V=0}V=!V}V&&(E=y.a)}else E=y.a}else{if((y=new Un)==null){ee=1;break e}if(y.Fa=q.na,y.P=q.P,y.qc=q.Sa,Ms(y,V)){if((E=Ia(V.width,V.height,ee.Oa,ee.ba))==0){if(y.Aa=0,P=ee.Oa,e((q=y)!=null),P!=null){if(0<(oe=0>(oe=P.Md)?0:100<oe?255:255*oe/100)){for(le=_e=0;4>le;++le)12>(Ie=q.pb[le]).lc&&(Ie.ia=oe*B[0>Ie.lc?0:Ie.lc]>>3),_e|=Ie.ia;_e&&(alert("todo:VP8InitRandom"),q.ia=1)}q.Ga=P.Id,100<q.Ga?q.Ga=100:0>q.Ga&&(q.Ga=0)}rs(y,V)||(E=y.a)}}else E=y.a}E==0&&ee.Oa!=null&&ee.Oa.fd&&(E=vc(ee.ba))}ee=E}K=ee!=0?null:11>K?se.f.RGBA.eb:se.f.kb.y}else K=null;return K};var j=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function v(Ne,at){for(var nt="",ke=0;ke<4;ke++)nt+=String.fromCharCode(Ne[at++]);return nt}function T(Ne,at){return(Ne[at+0]<<0|Ne[at+1]<<8|Ne[at+2]<<16)>>>0}function F(Ne,at){return(Ne[at+0]<<0|Ne[at+1]<<8|Ne[at+2]<<16|Ne[at+3]<<24)>>>0}new g;var R=[0],U=[0],J=[],te=new g,Ae=i,he=function(Ne,at){var nt={},ke=0,De=!1,Ye=0,Ze=0;if(nt.frames=[],!function(Xe,it,pt,mt){for(var Bt=0;Bt<mt;Bt++)if(Xe[it+Bt]!=pt.charCodeAt(Bt))return!0;return!1}(Ne,at,"RIFF",4)){var Ct,Et;for(F(Ne,at+=4),at+=8;at<Ne.length;){var Pt=v(Ne,at),bt=F(Ne,at+=4);at+=4;var Rt=bt+(1&bt);switch(Pt){case"VP8 ":case"VP8L":nt.frames[ke]===void 0&&(nt.frames[ke]={}),(Le=nt.frames[ke]).src_off=De?Ze:at-8,Le.src_size=Ye+bt+8,ke++,De&&(De=!1,Ye=0,Ze=0);break;case"VP8X":(Le=nt.header={}).feature_flags=Ne[at];var Ft=at+4;Le.canvas_width=1+T(Ne,Ft),Ft+=3,Le.canvas_height=1+T(Ne,Ft),Ft+=3;break;case"ALPH":De=!0,Ye=Rt+8,Ze=at-8;break;case"ANIM":(Le=nt.header).bgcolor=F(Ne,at),Ft=at+4,Le.loop_count=(Ct=Ne)[(Et=Ft)+0]<<0|Ct[Et+1]<<8,Ft+=2;break;case"ANMF":var Xt,Le;(Le=nt.frames[ke]={}).offset_x=2*T(Ne,at),at+=3,Le.offset_y=2*T(Ne,at),at+=3,Le.width=1+T(Ne,at),at+=3,Le.height=1+T(Ne,at),at+=3,Le.duration=T(Ne,at),at+=3,Xt=Ne[at++],Le.dispose=1&Xt,Le.blend=Xt>>1&1}Pt!="ANMF"&&(at+=Rt)}return nt}}(Ae,0);he.response=Ae,he.rgbaoutput=!0,he.dataurl=!1;var pe=he.header?he.header:null,be=he.frames?he.frames:null;if(pe){pe.loop_counter=pe.loop_count,R=[pe.canvas_height],U=[pe.canvas_width];for(var Te=0;Te<be.length&&be[Te].blend!=0;Te++);}var qe=be[0],je=te.WebPDecodeRGBA(Ae,qe.src_off,qe.src_size,U,R);qe.rgba=je,qe.imgwidth=U[0],qe.imgheight=R[0];for(var We=0;We<U[0]*R[0]*4;We++)J[We]=je[We];return this.width=U,this.height=R,this.data=J,this}(function(i){var e=function(){return typeof xC=="function"},t=function(R,U,J,te){var Ae=4,he=l;switch(te){case i.image_compression.FAST:Ae=1,he=o;break;case i.image_compression.MEDIUM:Ae=6,he=s;break;case i.image_compression.SLOW:Ae=9,he=g}R=r(R,U,J,he);var pe=xC(R,{level:Ae});return i.__addimage__.arrayBufferToBinaryString(pe)},r=function(R,U,J,te){for(var Ae,he,pe,be=R.length/U,Te=new Uint8Array(R.length+be),qe=T(),je=0;je<be;je+=1){if(pe=je*U,Ae=R.subarray(pe,pe+U),te)Te.set(te(Ae,J,he),pe+je);else{for(var We,Ne=qe.length,at=[];We<Ne;We+=1)at[We]=qe[We](Ae,J,he);var nt=F(at.concat());Te.set(at[nt],pe+je)}he=Ae}return Te},n=function(R){var U=Array.apply([],R);return U.unshift(0),U},o=function(R,U){var J,te=[],Ae=R.length;te[0]=1;for(var he=0;he<Ae;he+=1)J=R[he-U]||0,te[he+1]=R[he]-J+256&255;return te},l=function(R,U,J){var te,Ae=[],he=R.length;Ae[0]=2;for(var pe=0;pe<he;pe+=1)te=J&&J[pe]||0,Ae[pe+1]=R[pe]-te+256&255;return Ae},s=function(R,U,J){var te,Ae,he=[],pe=R.length;he[0]=3;for(var be=0;be<pe;be+=1)te=R[be-U]||0,Ae=J&&J[be]||0,he[be+1]=R[be]+256-(te+Ae>>>1)&255;return he},g=function(R,U,J){var te,Ae,he,pe,be=[],Te=R.length;be[0]=4;for(var qe=0;qe<Te;qe+=1)te=R[qe-U]||0,Ae=J&&J[qe]||0,he=J&&J[qe-U]||0,pe=v(te,Ae,he),be[qe+1]=R[qe]-pe+256&255;return be},v=function(R,U,J){if(R===U&&U===J)return R;var te=Math.abs(U-J),Ae=Math.abs(R-J),he=Math.abs(R+U-J-J);return te<=Ae&&te<=he?R:Ae<=he?U:J},T=function(){return[n,o,l,s,g]},F=function(R){var U=R.map(function(J){return J.reduce(function(te,Ae){return te+Math.abs(Ae)},0)});return U.indexOf(Math.min.apply(null,U))};i.processPNG=function(R,U,J,te){var Ae,he,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Ze,Ct=this.decode.FLATE_DECODE,Et="";if(this.__addimage__.isArrayBuffer(R)&&(R=new Uint8Array(R)),this.__addimage__.isArrayBufferView(R)){if(R=(pe=new hre(R)).imgData,he=pe.bits,Ae=pe.colorSpace,Te=pe.colors,[4,6].indexOf(pe.colorType)!==-1){if(pe.bits===8){Ne=(We=pe.pixelBitlength==32?new Uint32Array(pe.decodePixels().buffer):pe.pixelBitlength==16?new Uint16Array(pe.decodePixels().buffer):new Uint8Array(pe.decodePixels().buffer)).length,nt=new Uint8Array(Ne*pe.colors),at=new Uint8Array(Ne);var Pt,bt=pe.pixelBitlength-pe.bits;for(Ye=0,Ze=0;Ye<Ne;Ye++){for(De=We[Ye],Pt=0;Pt<bt;)nt[Ze++]=De>>>Pt&255,Pt+=pe.bits;at[Ye]=De>>>Pt&255}}if(pe.bits===16){Ne=(We=new Uint32Array(pe.decodePixels().buffer)).length,nt=new Uint8Array(Ne*(32/pe.pixelBitlength)*pe.colors),at=new Uint8Array(Ne*(32/pe.pixelBitlength)),ke=pe.colors>1,Ye=0,Ze=0;for(var Rt=0;Ye<Ne;)De=We[Ye++],nt[Ze++]=De>>>0&255,ke&&(nt[Ze++]=De>>>16&255,De=We[Ye++],nt[Ze++]=De>>>0&255),at[Rt++]=De>>>16&255;he=8}te!==i.image_compression.NONE&&e()?(R=t(nt,pe.width*pe.colors,pe.colors,te),je=t(at,pe.width,1,te)):(R=nt,je=at,Ct=void 0)}if(pe.colorType===3&&(Ae=this.color_spaces.INDEXED,qe=pe.palette,pe.transparency.indexed)){var Ft=pe.transparency.indexed,Xt=0;for(Ye=0,Ne=Ft.length;Ye<Ne;++Ye)Xt+=Ft[Ye];if((Xt/=255)===Ne-1&&Ft.indexOf(0)!==-1)be=[Ft.indexOf(0)];else if(Xt!==Ne){for(We=pe.decodePixels(),at=new Uint8Array(We.length),Ye=0,Ne=We.length;Ye<Ne;Ye++)at[Ye]=Ft[We[Ye]];je=t(at,pe.width,1)}}var Le=function(Xe){var it;switch(Xe){case i.image_compression.FAST:it=11;break;case i.image_compression.MEDIUM:it=13;break;case i.image_compression.SLOW:it=14;break;default:it=12}return it}(te);return Ct===this.decode.FLATE_DECODE&&(Et="/Predictor "+Le+" "),Et+="/Colors "+Te+" /BitsPerComponent "+he+" /Columns "+pe.width,(this.__addimage__.isArrayBuffer(R)||this.__addimage__.isArrayBufferView(R))&&(R=this.__addimage__.arrayBufferToBinaryString(R)),(je&&this.__addimage__.isArrayBuffer(je)||this.__addimage__.isArrayBufferView(je))&&(je=this.__addimage__.arrayBufferToBinaryString(je)),{alias:J,data:R,index:U,filter:Ct,decodeParameters:Et,transparency:be,palette:qe,sMask:je,predictor:Le,width:pe.width,height:pe.height,bitsPerComponent:he,colorSpace:Ae}}}})(Hr.API),function(i){i.processGIF89A=function(e,t,r,n){var o=new Are(e),l=o.width,s=o.height,g=[];o.decodeAndBlitFrameRGBA(0,g);var v={data:g,width:l,height:s},T=new DC(100).encode(v,100);return i.processJPEG.call(this,T,t,r,n)},i.processGIF87A=i.processGIF89A}(Hr.API),uh.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var i=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(i);for(var e=0;e<i;e++){var t=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:n,green:r,blue:t,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},uh.prototype.parseBGR=function(){this.pos=this.offset;try{var i="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[i]()}catch(t){Ls.log("bit decode error:"+t)}},uh.prototype.bit1=function(){var i,e=Math.ceil(this.width/8),t=e%4;for(i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,n=0;n<e;n++)for(var o=this.datav.getUint8(this.pos++,!0),l=r*this.width*4+8*n*4,s=0;s<8&&8*n+s<this.width;s++){var g=this.palette[o>>7-s&1];this.data[l+4*s]=g.blue,this.data[l+4*s+1]=g.green,this.data[l+4*s+2]=g.red,this.data[l+4*s+3]=255}t!==0&&(this.pos+=4-t)}},uh.prototype.bit4=function(){for(var i=Math.ceil(this.width/2),e=i%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<i;n++){var o=this.datav.getUint8(this.pos++,!0),l=r*this.width*4+2*n*4,s=o>>4,g=15&o,v=this.palette[s];if(this.data[l]=v.blue,this.data[l+1]=v.green,this.data[l+2]=v.red,this.data[l+3]=255,2*n+1>=this.width)break;v=this.palette[g],this.data[l+4]=v.blue,this.data[l+4+1]=v.green,this.data[l+4+2]=v.red,this.data[l+4+3]=255}e!==0&&(this.pos+=4-e)}},uh.prototype.bit8=function(){for(var i=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*r;if(n<this.palette.length){var l=this.palette[n];this.data[o]=l.red,this.data[o+1]=l.green,this.data[o+2]=l.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}i!==0&&(this.pos+=4-i)}},uh.prototype.bit15=function(){for(var i=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&e)/e*255|0,s=(o>>5&e)/e*255|0,g=(o>>10&e)/e*255|0,v=o>>15?255:0,T=r*this.width*4+4*n;this.data[T]=g,this.data[T+1]=s,this.data[T+2]=l,this.data[T+3]=v}this.pos+=i}},uh.prototype.bit16=function(){for(var i=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,o=0;o<this.width;o++){var l=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(l&e)/e*255|0,g=(l>>5&t)/t*255|0,v=(l>>11)/e*255|0,T=n*this.width*4+4*o;this.data[T]=v,this.data[T+1]=g,this.data[T+2]=s,this.data[T+3]=255}this.pos+=i}},uh.prototype.bit24=function(){for(var i=this.height-1;i>=0;i--){for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*t;this.data[l]=o,this.data[l+1]=n,this.data[l+2]=r,this.data[l+3]=255}this.pos+=this.width%4}},uh.prototype.bit32=function(){for(var i=this.height-1;i>=0;i--)for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*t;this.data[s]=o,this.data[s+1]=n,this.data[s+2]=r,this.data[s+3]=l}},uh.prototype.getData=function(){return this.data},function(i){i.processBMP=function(e,t,r,n){var o=new uh(e,!1),l=o.width,s=o.height,g={data:o.getData(),width:l,height:s},v=new DC(100).encode(g,100);return i.processJPEG.call(this,v,t,r,n)}}(Hr.API),K4.prototype.getData=function(){return this.data},function(i){i.processWEBP=function(e,t,r,n){var o=new K4(e),l=o.width,s=o.height,g={data:o.getData(),width:l,height:s},v=new DC(100).encode(g,100);return i.processJPEG.call(this,v,t,r,n)}}(Hr.API),Hr.API.processRGBA=function(i,e,t){for(var r=i.data,n=r.length,o=new Uint8Array(n/4*3),l=new Uint8Array(n/4),s=0,g=0,v=0;v<n;v+=4){var T=r[v],F=r[v+1],R=r[v+2],U=r[v+3];o[s++]=T,o[s++]=F,o[s++]=R,l[g++]=U}var J=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(l),data:J,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:i.width,height:i.height}},Hr.API.setLanguage=function(i){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[i]!==void 0&&(this.internal.languageSettings.languageCode=i,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Lg=Hr.API,lv=Lg.getCharWidthsArray=function(i,e){var t,r,n=(e=e||{}).font||this.internal.getFont(),o=e.fontSize||this.internal.getFontSize(),l=e.charSpace||this.internal.getCharSpace(),s=e.widths?e.widths:n.metadata.Unicode.widths,g=s.fof?s.fof:1,v=e.kerning?e.kerning:n.metadata.Unicode.kerning,T=v.fof?v.fof:1,F=e.doKerning!==!1,R=0,U=i.length,J=0,te=s[0]||g,Ae=[];for(t=0;t<U;t++)r=i.charCodeAt(t),typeof n.metadata.widthOfString=="function"?Ae.push((n.metadata.widthOfGlyph(n.metadata.characterToGlyph(r))+l*(1e3/o)||0)/1e3):(R=F&&Yn(v[r])==="object"&&!isNaN(parseInt(v[r][J],10))?v[r][J]/T:0,Ae.push((s[r]||te)/g+R)),J=r;return Ae},G4=Lg.getStringUnitWidth=function(i,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),n=e.charSpace||this.internal.getCharSpace();return Lg.processArabic&&(i=Lg.processArabic(i)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(i,t,n)/t:lv.apply(this,arguments).reduce(function(o,l){return o+l},0)},j4=function(i,e,t,r){for(var n=[],o=0,l=i.length,s=0;o!==l&&s+e[o]<t;)s+=e[o],o++;n.push(i.slice(0,o));var g=o;for(s=0;o!==l;)s+e[o]>r&&(n.push(i.slice(g,o)),s=0,g=o),s+=e[o],o++;return g!==o&&n.push(i.slice(g,o)),n},q4=function(i,e,t){t||(t={});var r,n,o,l,s,g,v,T=[],F=[T],R=t.textIndent||0,U=0,J=0,te=i.split(" "),Ae=lv.apply(this,[" ",t])[0];if(g=t.lineIndent===-1?te[0].length+2:t.lineIndent||0){var he=Array(g).join(" "),pe=[];te.map(function(Te){(Te=Te.split(/\s*\n/)).length>1?pe=pe.concat(Te.map(function(qe,je){return(je&&qe.length?`
`:"")+qe})):pe.push(Te[0])}),te=pe,g=G4.apply(this,[he,t])}for(o=0,l=te.length;o<l;o++){var be=0;if(r=te[o],g&&r[0]==`
`&&(r=r.substr(1),be=1),R+U+(J=(n=lv.apply(this,[r,t])).reduce(function(Te,qe){return Te+qe},0))>e||be){if(J>e){for(s=j4.apply(this,[r,n,e-(R+U),e]),T.push(s.shift()),T=[s.pop()];s.length;)F.push([s.shift()]);J=n.slice(r.length-(T[0]?T[0].length:0)).reduce(function(Te,qe){return Te+qe},0)}else T=[r];F.push(T),R=J+g,U=Ae}else T.push(r),R+=U+J,U=Ae}return v=g?function(Te,qe){return(qe?he:"")+Te.join(" ")}:function(Te){return Te.join(" ")},F.map(v)},Lg.splitTextToSize=function(i,e,t){var r,n=(t=t||{}).fontSize||this.internal.getFontSize(),o=(function(T){if(T.widths&&T.kerning)return{widths:T.widths,kerning:T.kerning};var F=this.internal.getFont(T.fontName,T.fontStyle);return F.metadata.Unicode?{widths:F.metadata.Unicode.widths||{0:1},kerning:F.metadata.Unicode.kerning||{}}:{font:F.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);r=Array.isArray(i)?i:String(i).split(/\r?\n/);var l=1*this.internal.scaleFactor*e/n;o.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/n:0,o.lineIndent=t.lineIndent;var s,g,v=[];for(s=0,g=r.length;s<g;s++)v=v.concat(q4.apply(this,[r[s],l,o]));return v},function(i){i.__fontmetrics__=i.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",t={},r={},n=0;n<e.length;n++)t[e[n]]="0123456789abcdef"[n],r["0123456789abcdef"[n]]=e[n];var o=function(F){return"0x"+parseInt(F,10).toString(16)},l=i.__fontmetrics__.compress=function(F){var R,U,J,te,Ae=["{"];for(var he in F){if(R=F[he],isNaN(parseInt(he,10))?U="'"+he+"'":(he=parseInt(he,10),U=(U=o(he).slice(2)).slice(0,-1)+r[U.slice(-1)]),typeof R=="number")R<0?(J=o(R).slice(3),te="-"):(J=o(R).slice(2),te=""),J=te+J.slice(0,-1)+r[J.slice(-1)];else{if(Yn(R)!=="object")throw new Error("Don't know what to do with value type "+Yn(R)+".");J=l(R)}Ae.push(U+J)}return Ae.push("}"),Ae.join("")},s=i.__fontmetrics__.uncompress=function(F){if(typeof F!="string")throw new Error("Invalid argument passed to uncompress.");for(var R,U,J,te,Ae={},he=1,pe=Ae,be=[],Te="",qe="",je=F.length-1,We=1;We<je;We+=1)(te=F[We])=="'"?R?(J=R.join(""),R=void 0):R=[]:R?R.push(te):te=="{"?(be.push([pe,J]),pe={},J=void 0):te=="}"?((U=be.pop())[0][U[1]]=pe,J=void 0,pe=U[0]):te=="-"?he=-1:J===void 0?t.hasOwnProperty(te)?(Te+=t[te],J=parseInt(Te,16)*he,he=1,Te=""):Te+=te:t.hasOwnProperty(te)?(qe+=t[te],pe[J]=parseInt(qe,16)*he,he=1,J=void 0,qe=""):qe+=te;return Ae},g={codePages:["WinAnsiEncoding"],WinAnsiEncoding:s("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},v={Unicode:{Courier:g,"Courier-Bold":g,"Courier-BoldOblique":g,"Courier-Oblique":g,Helvetica:g,"Helvetica-Bold":g,"Helvetica-BoldOblique":g,"Helvetica-Oblique":g,"Times-Roman":g,"Times-Bold":g,"Times-BoldItalic":g,"Times-Italic":g}},T={Unicode:{"Courier-Oblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":s("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":s("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:s("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:s("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":s("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":s("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};i.events.push(["addFont",function(F){var R=F.font,U=T.Unicode[R.postScriptName];U&&(R.metadata.Unicode={},R.metadata.Unicode.widths=U.widths,R.metadata.Unicode.kerning=U.kerning);var J=v.Unicode[R.postScriptName];J&&(R.metadata.Unicode.encoding=J,R.encoding=J.codePages[0])}])}(Hr.API),function(i){var e=function(t){for(var r=t.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=t.charCodeAt(o);return n};i.API.events.push(["addFont",function(t){var r=void 0,n=t.font,o=t.instance;if(!n.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");if(typeof(r=o.existsFileInVFS(n.postScriptName)===!1?o.loadFile(n.postScriptName):o.getFileFromVFS(n.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");(function(l,s){s=/^\x00\x01\x00\x00/.test(s)?e(s):e(Vy(s)),l.metadata=i.API.TTFFont.open(s),l.metadata.Unicode=l.metadata.Unicode||{encoding:{},kerning:{},widths:[]},l.metadata.glyIdsUsed=[0]})(n,r)}}])}(Hr),function(i){function e(){return(Vr.canvg?Promise.resolve(Vr.canvg):Promise.resolve().then(()=>Vve)).catch(function(t){return Promise.reject(new Error("Could not load canvg: "+t))}).then(function(t){return t.default?t.default:t})}Hr.API.addSvgAsImage=function(t,r,n,o,l,s,g,v){if(isNaN(r)||isNaN(n))throw Ls.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(l))throw Ls.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var T=document.createElement("canvas");T.width=o,T.height=l;var F=T.getContext("2d");F.fillStyle="#fff",F.fillRect(0,0,T.width,T.height);var R={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},U=this;return e().then(function(J){return J.fromString(F,t,R)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(J){return J.render(R)}).then(function(){U.addImage(T.toDataURL("image/jpeg",1),r,n,o,l,g,v)})}}(),Hr.API.putTotalPages=function(i){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(i,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(i,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var n=0;n<this.internal.pages[r].length;n++)this.internal.pages[r][n]=this.internal.pages[r][n].replace(e,t);return this},Hr.API.viewerPreferences=function(i,e){var t;i=i||{},e=e||!1;var r,n,o,l={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(l),g=[],v=0,T=0,F=0;function R(J,te){var Ae,he=!1;for(Ae=0;Ae<J.length;Ae+=1)J[Ae]===te&&(he=!0);return he}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(l)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,i==="reset"||e===!0){var U=s.length;for(F=0;F<U;F+=1)t[s[F]].value=t[s[F]].defaultValue,t[s[F]].explicitSet=!1}if(Yn(i)==="object"){for(n in i)if(o=i[n],R(s,n)&&o!==void 0){if(t[n].type==="boolean"&&typeof o=="boolean")t[n].value=o;else if(t[n].type==="name"&&R(t[n].valueSet,o))t[n].value=o;else if(t[n].type==="integer"&&Number.isInteger(o))t[n].value=o;else if(t[n].type==="array"){for(v=0;v<o.length;v+=1)if(r=!0,o[v].length===1&&typeof o[v][0]=="number")g.push(String(o[v]-1));else if(o[v].length>1){for(T=0;T<o[v].length;T+=1)typeof o[v][T]!="number"&&(r=!1);r===!0&&g.push([o[v][0]-1,o[v][1]-1].join(" "))}t[n].value="["+g.join(" ")+"]"}else t[n].value=t[n].defaultValue;t[n].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var J,te=[];for(J in t)t[J].explicitSet===!0&&(t[J].type==="name"?te.push("/"+J+" /"+t[J].value):te.push("/"+J+" "+t[J].value));te.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+te.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},function(i){var e=function(){var r='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',n=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(r)),l=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),g=unescape(encodeURIComponent("</x:xmpmeta>")),v=o.length+l.length+s.length+n.length+g.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+v+" >>"),this.internal.write("stream"),this.internal.write(n+o+l+s+g),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};i.addMetadata=function(r,n){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:r,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}}(Hr.API),function(i){var e=i.API,t=e.pdfEscape16=function(o,l){for(var s,g=l.metadata.Unicode.widths,v=["","0","00","000","0000"],T=[""],F=0,R=o.length;F<R;++F){if(s=l.metadata.characterToGlyph(o.charCodeAt(F)),l.metadata.glyIdsUsed.push(s),l.metadata.toUnicode[s]=o.charCodeAt(F),g.indexOf(s)==-1&&(g.push(s),g.push([parseInt(l.metadata.widthOfGlyph(s),10)])),s=="0")return T.join("");s=s.toString(16),T.push(v[4-s.length],s)}return T.join("")},r=function(o){var l,s,g,v,T,F,R;for(T=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,g=[],F=0,R=(s=Object.keys(o).sort(function(U,J){return U-J})).length;F<R;F++)l=s[F],g.length>=100&&(T+=`
`+g.length+` beginbfchar
`+g.join(`
`)+`
endbfchar`,g=[]),o[l]!==void 0&&o[l]!==null&&typeof o[l].toString=="function"&&(v=("0000"+o[l].toString(16)).slice(-4),l=("0000"+(+l).toString(16)).slice(-4),g.push("<"+l+"><"+v+">"));return g.length&&(T+=`
`+g.length+` beginbfchar
`+g.join(`
`)+`
endbfchar
`),T+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(o){(function(l){var s=l.font,g=l.out,v=l.newObject,T=l.putStream;if(s.metadata instanceof i.API.TTFFont&&s.encoding==="Identity-H"){for(var F=s.metadata.Unicode.widths,R=s.metadata.subset.encode(s.metadata.glyIdsUsed,1),U="",J=0;J<R.length;J++)U+=String.fromCharCode(R[J]);var te=v();T({data:U,addLength1:!0,objectId:te}),g("endobj");var Ae=v();T({data:r(s.metadata.toUnicode),addLength1:!0,objectId:Ae}),g("endobj");var he=v();g("<<"),g("/Type /FontDescriptor"),g("/FontName /"+wg(s.fontName)),g("/FontFile2 "+te+" 0 R"),g("/FontBBox "+i.API.PDFObject.convert(s.metadata.bbox)),g("/Flags "+s.metadata.flags),g("/StemV "+s.metadata.stemV),g("/ItalicAngle "+s.metadata.italicAngle),g("/Ascent "+s.metadata.ascender),g("/Descent "+s.metadata.decender),g("/CapHeight "+s.metadata.capHeight),g(">>"),g("endobj");var pe=v();g("<<"),g("/Type /Font"),g("/BaseFont /"+wg(s.fontName)),g("/FontDescriptor "+he+" 0 R"),g("/W "+i.API.PDFObject.convert(F)),g("/CIDToGIDMap /Identity"),g("/DW 1000"),g("/Subtype /CIDFontType2"),g("/CIDSystemInfo"),g("<<"),g("/Supplement 0"),g("/Registry (Adobe)"),g("/Ordering ("+s.encoding+")"),g(">>"),g(">>"),g("endobj"),s.objectNumber=v(),g("<<"),g("/Type /Font"),g("/Subtype /Type0"),g("/ToUnicode "+Ae+" 0 R"),g("/BaseFont /"+wg(s.fontName)),g("/Encoding /"+s.encoding),g("/DescendantFonts ["+pe+" 0 R]"),g(">>"),g("endobj"),s.isAlreadyPutted=!0}})(o)}]),e.events.push(["putFont",function(o){(function(l){var s=l.font,g=l.out,v=l.newObject,T=l.putStream;if(s.metadata instanceof i.API.TTFFont&&s.encoding==="WinAnsiEncoding"){for(var F=s.metadata.rawData,R="",U=0;U<F.length;U++)R+=String.fromCharCode(F[U]);var J=v();T({data:R,addLength1:!0,objectId:J}),g("endobj");var te=v();T({data:r(s.metadata.toUnicode),addLength1:!0,objectId:te}),g("endobj");var Ae=v();g("<<"),g("/Descent "+s.metadata.decender),g("/CapHeight "+s.metadata.capHeight),g("/StemV "+s.metadata.stemV),g("/Type /FontDescriptor"),g("/FontFile2 "+J+" 0 R"),g("/Flags 96"),g("/FontBBox "+i.API.PDFObject.convert(s.metadata.bbox)),g("/FontName /"+wg(s.fontName)),g("/ItalicAngle "+s.metadata.italicAngle),g("/Ascent "+s.metadata.ascender),g(">>"),g("endobj"),s.objectNumber=v();for(var he=0;he<s.metadata.hmtx.widths.length;he++)s.metadata.hmtx.widths[he]=parseInt(s.metadata.hmtx.widths[he]*(1e3/s.metadata.head.unitsPerEm));g("<</Subtype/TrueType/Type/Font/ToUnicode "+te+" 0 R/BaseFont/"+wg(s.fontName)+"/FontDescriptor "+Ae+" 0 R/Encoding/"+s.encoding+" /FirstChar 29 /LastChar 255 /Widths "+i.API.PDFObject.convert(s.metadata.hmtx.widths)+">>"),g("endobj"),s.isAlreadyPutted=!0}})(o)}]);var n=function(o){var l,s=o.text||"",g=o.x,v=o.y,T=o.options||{},F=o.mutex||{},R=F.pdfEscape,U=F.activeFontKey,J=F.fonts,te=U,Ae="",he=0,pe="",be=J[te].encoding;if(J[te].encoding!=="Identity-H")return{text:s,x:g,y:v,options:T,mutex:F};for(pe=s,te=U,Array.isArray(s)&&(pe=s[0]),he=0;he<pe.length;he+=1)J[te].metadata.hasOwnProperty("cmap")&&(l=J[te].metadata.cmap.unicode.codeMap[pe[he].charCodeAt(0)]),l||pe[he].charCodeAt(0)<256&&J[te].metadata.hasOwnProperty("Unicode")?Ae+=pe[he]:Ae+="";var Te="";return parseInt(te.slice(1))<14||be==="WinAnsiEncoding"?Te=R(Ae,te).split("").map(function(qe){return qe.charCodeAt(0).toString(16)}).join(""):be==="Identity-H"&&(Te=t(Ae,J[te])),F.isHex=!0,{text:Te,x:g,y:v,options:T,mutex:F}};e.events.push(["postProcessText",function(o){var l=o.text||"",s=[],g={text:l,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(l)){var v=0;for(v=0;v<l.length;v+=1)Array.isArray(l[v])&&l[v].length===3?s.push([n(Object.assign({},g,{text:l[v][0]})).text,l[v][1],l[v][2]]):s.push(n(Object.assign({},g,{text:l[v]})).text);o.text=s}else o.text=n(Object.assign({},g,{text:l})).text}])}(Hr),function(i){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};i.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},i.addFileToVFS=function(t,r){return e.call(this),this.internal.vFS[t]=r,this},i.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}}(Hr.API),function(i){i.__bidiEngine__=i.prototype.__bidiEngine__=function(r){var n,o,l,s,g,v,T,F=e,R=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],U=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],J={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},te={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},Ae=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],he=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),pe=!1,be=0;this.__bidiEngine__={};var Te=function(ke){var De=ke.charCodeAt(),Ye=De>>8,Ze=te[Ye];return Ze!==void 0?F[256*Ze+(255&De)]:Ye===252||Ye===253?"AL":he.test(Ye)?"L":Ye===8?"R":"N"},qe=function(ke){for(var De,Ye=0;Ye<ke.length;Ye++){if((De=Te(ke.charAt(Ye)))==="L")return!1;if(De==="R")return!0}return!1},je=function(ke,De,Ye,Ze){var Ct,Et,Pt,bt,Rt=De[Ze];switch(Rt){case"L":case"R":pe=!1;break;case"N":case"AN":break;case"EN":pe&&(Rt="AN");break;case"AL":pe=!0,Rt="R";break;case"WS":Rt="N";break;case"CS":Ze<1||Ze+1>=De.length||(Ct=Ye[Ze-1])!=="EN"&&Ct!=="AN"||(Et=De[Ze+1])!=="EN"&&Et!=="AN"?Rt="N":pe&&(Et="AN"),Rt=Et===Ct?Et:"N";break;case"ES":Rt=(Ct=Ze>0?Ye[Ze-1]:"B")==="EN"&&Ze+1<De.length&&De[Ze+1]==="EN"?"EN":"N";break;case"ET":if(Ze>0&&Ye[Ze-1]==="EN"){Rt="EN";break}if(pe){Rt="N";break}for(Pt=Ze+1,bt=De.length;Pt<bt&&De[Pt]==="ET";)Pt++;Rt=Pt<bt&&De[Pt]==="EN"?"EN":"N";break;case"NSM":if(l&&!s){for(bt=De.length,Pt=Ze+1;Pt<bt&&De[Pt]==="NSM";)Pt++;if(Pt<bt){var Ft=ke[Ze],Xt=Ft>=1425&&Ft<=2303||Ft===64286;if(Ct=De[Pt],Xt&&(Ct==="R"||Ct==="AL")){Rt="R";break}}}Rt=Ze<1||(Ct=De[Ze-1])==="B"?"N":Ye[Ze-1];break;case"B":pe=!1,n=!0,Rt=be;break;case"S":o=!0,Rt="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":pe=!1;break;case"BN":Rt="N"}return Rt},We=function(ke,De,Ye){var Ze=ke.split("");return Ye&&Ne(Ze,Ye,{hiLevel:be}),Ze.reverse(),De&&De.reverse(),Ze.join("")},Ne=function(ke,De,Ye){var Ze,Ct,Et,Pt,bt,Rt=-1,Ft=ke.length,Xt=0,Le=[],Xe=be?U:R,it=[];for(pe=!1,n=!1,o=!1,Ct=0;Ct<Ft;Ct++)it[Ct]=Te(ke[Ct]);for(Et=0;Et<Ft;Et++){if(bt=Xt,Le[Et]=je(ke,it,Le,Et),Ze=240&(Xt=Xe[bt][J[Le[Et]]]),Xt&=15,De[Et]=Pt=Xe[Xt][5],Ze>0)if(Ze===16){for(Ct=Rt;Ct<Et;Ct++)De[Ct]=1;Rt=-1}else Rt=-1;if(Xe[Xt][6])Rt===-1&&(Rt=Et);else if(Rt>-1){for(Ct=Rt;Ct<Et;Ct++)De[Ct]=Pt;Rt=-1}it[Et]==="B"&&(De[Et]=0),Ye.hiLevel|=Pt}o&&function(pt,mt,Bt){for(var Dt=0;Dt<Bt;Dt++)if(pt[Dt]==="S"){mt[Dt]=be;for(var Mt=Dt-1;Mt>=0&&pt[Mt]==="WS";Mt--)mt[Mt]=be}}(it,De,Ft)},at=function(ke,De,Ye,Ze,Ct){if(!(Ct.hiLevel<ke)){if(ke===1&&be===1&&!n)return De.reverse(),void(Ye&&Ye.reverse());for(var Et,Pt,bt,Rt,Ft=De.length,Xt=0;Xt<Ft;){if(Ze[Xt]>=ke){for(bt=Xt+1;bt<Ft&&Ze[bt]>=ke;)bt++;for(Rt=Xt,Pt=bt-1;Rt<Pt;Rt++,Pt--)Et=De[Rt],De[Rt]=De[Pt],De[Pt]=Et,Ye&&(Et=Ye[Rt],Ye[Rt]=Ye[Pt],Ye[Pt]=Et);Xt=bt}Xt++}}},nt=function(ke,De,Ye){var Ze=ke.split(""),Ct={hiLevel:be};return Ye||(Ye=[]),Ne(Ze,Ye,Ct),function(Et,Pt,bt){if(bt.hiLevel!==0&&T)for(var Rt,Ft=0;Ft<Et.length;Ft++)Pt[Ft]===1&&(Rt=Ae.indexOf(Et[Ft]))>=0&&(Et[Ft]=Ae[Rt+1])}(Ze,Ye,Ct),at(2,Ze,De,Ye,Ct),at(1,Ze,De,Ye,Ct),Ze.join("")};return this.__bidiEngine__.doBidiReorder=function(ke,De,Ye){if(function(Ct,Et){if(Et)for(var Pt=0;Pt<Ct.length;Pt++)Et[Pt]=Pt;s===void 0&&(s=qe(Ct)),v===void 0&&(v=qe(Ct))}(ke,De),l||!g||v)if(l&&g&&s^v)be=s?1:0,ke=We(ke,De,Ye);else if(!l&&g&&v)be=s?1:0,ke=nt(ke,De,Ye),ke=We(ke,De);else if(!l||s||g||v){if(l&&!g&&s^v)ke=We(ke,De),s?(be=0,ke=nt(ke,De,Ye)):(be=1,ke=nt(ke,De,Ye),ke=We(ke,De));else if(l&&s&&!g&&v)be=1,ke=nt(ke,De,Ye),ke=We(ke,De);else if(!l&&!g&&s^v){var Ze=T;s?(be=1,ke=nt(ke,De,Ye),be=0,T=!1,ke=nt(ke,De,Ye),T=Ze):(be=0,ke=nt(ke,De,Ye),ke=We(ke,De),be=1,T=!1,ke=nt(ke,De,Ye),T=Ze,ke=We(ke,De))}}else be=0,ke=nt(ke,De,Ye);else be=s?1:0,ke=nt(ke,De,Ye);return ke},this.__bidiEngine__.setOptions=function(ke){ke&&(l=ke.isInputVisual,g=ke.isOutputVisual,s=ke.isInputRtl,v=ke.isOutputRtl,T=ke.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new i.__bidiEngine__({isInputVisual:!0});i.API.events.push(["postProcessText",function(r){var n=r.text,o=(r.x,r.y,r.options||{}),l=(r.mutex,o.lang,[]);if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,t.setOptions(o),Object.prototype.toString.call(n)==="[object Array]"){var s=0;for(l=[],s=0;s<n.length;s+=1)Object.prototype.toString.call(n[s])==="[object Array]"?l.push([t.doBidiReorder(n[s][0]),n[s][1],n[s][2]]):l.push([t.doBidiReorder(n[s])]);r.text=l}else r.text=t.doBidiReorder(n);t.setOptions({isInputVisual:!0})}])}(Hr),Hr.API.TTFFont=function(){function i(e){var t;if(this.rawData=e,t=this.contents=new vd(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Sre(this),this.registerTTF()}return i.open=function(e){return new i(e)},i.prototype.parse=function(){return this.directory=new dre(this.contents),this.head=new pre(this),this.name=new vre(this),this.cmap=new Z4(this),this.toUnicode={},this.hhea=new gre(this),this.maxp=new bre(this),this.hmtx=new xre(this),this.post=new yre(this),this.os2=new mre(this),this.loca=new Ere(this),this.glyf=new wre(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},i.prototype.registerTTF=function(){var e,t,r,n,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var l,s,g,v;for(v=[],l=0,s=(g=this.bbox).length;l<s;l++)e=g[l],v.push(Math.round(e*this.scaleFactor));return v}).call(this),this.stemV=0,this.post.exists?(r=255&(n=this.post.italic_angle),32768&(t=n>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},i.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},i.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},i.prototype.widthOfString=function(e,t,r){var n,o,l,s;for(l=0,o=0,s=(e=""+e).length;0<=s?o<s:o>s;o=0<=s?++o:--o)n=e.charCodeAt(o),l+=this.widthOfGlyph(this.characterToGlyph(n))+r*(1e3/t)||0;return l*(t/1e3)},i.prototype.lineHeight=function(e,t){var r;return t==null&&(t=!1),r=t?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},i}();var hh,vd=function(){function i(e){this.data=e??[],this.pos=0,this.length=this.data.length}return i.prototype.readByte=function(){return this.data[this.pos++]},i.prototype.writeByte=function(e){return this.data[this.pos++]=e},i.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},i.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},i.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},i.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},i.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},i.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},i.prototype.readString=function(e){var t,r;for(r=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)r[t]=String.fromCharCode(this.readByte());return r.join("")},i.prototype.writeString=function(e){var t,r,n;for(n=[],t=0,r=e.length;0<=r?t<r:t>r;t=0<=r?++t:--t)n.push(this.writeByte(e.charCodeAt(t)));return n},i.prototype.readShort=function(){return this.readInt16()},i.prototype.writeShort=function(e){return this.writeInt16(e)},i.prototype.readLongLong=function(){var e,t,r,n,o,l,s,g;return e=this.readByte(),t=this.readByte(),r=this.readByte(),n=this.readByte(),o=this.readByte(),l=this.readByte(),s=this.readByte(),g=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^r)+4294967296*(255^n)+16777216*(255^o)+65536*(255^l)+256*(255^s)+(255^g)+1):72057594037927940*e+281474976710656*t+1099511627776*r+4294967296*n+16777216*o+65536*l+256*s+g},i.prototype.writeLongLong=function(e){var t,r;return t=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},i.prototype.readInt=function(){return this.readInt32()},i.prototype.writeInt=function(e){return this.writeInt32(e)},i.prototype.read=function(e){var t,r;for(t=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)t.push(this.readByte());return t},i.prototype.write=function(e){var t,r,n,o;for(o=[],r=0,n=e.length;r<n;r++)t=e[r],o.push(this.writeByte(t));return o},i}(),dre=function(){var i;function e(t){var r,n,o;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},n=0,o=this.tableCount;0<=o?n<o:n>o;n=0<=o?++n:--n)r={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[r.tag]=r}return e.prototype.encode=function(t){var r,n,o,l,s,g,v,T,F,R,U,J,te;for(te in U=Object.keys(t).length,g=Math.log(2),F=16*Math.floor(Math.log(U)/g),l=Math.floor(F/g),T=16*U-F,(n=new vd).writeInt(this.scalarType),n.writeShort(U),n.writeShort(F),n.writeShort(l),n.writeShort(T),o=16*U,v=n.pos+o,s=null,J=[],t)for(R=t[te],n.writeString(te),n.writeInt(i(R)),n.writeInt(v),n.writeInt(R.length),J=J.concat(R),te==="head"&&(s=v),v+=R.length;v%4;)J.push(0),v++;return n.write(J),r=2981146554-i(n.data),n.pos=s+8,n.writeUInt32(r),n.data},i=function(t){var r,n,o,l;for(t=X4.call(t);t.length%4;)t.push(0);for(o=new vd(t),n=0,r=0,l=t.length;r<l;r=r+=4)n+=o.readUInt32();return 4294967295&n},e}(),fre={}.hasOwnProperty,Wh=function(i,e){for(var t in e)fre.call(e,t)&&(i[t]=e[t]);function r(){this.constructor=i}return r.prototype=e.prototype,i.prototype=new r,i.__super__=e.prototype,i};hh=function(){function i(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return i.prototype.parse=function(){},i.prototype.encode=function(){},i.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},i}();var pre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var r;return(r=new vd).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(t),r.writeShort(this.glyphDataFormat),r.data},e}(),W4=function(){function i(e,t){var r,n,o,l,s,g,v,T,F,R,U,J,te,Ae,he,pe,be;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),F=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(g=0;g<256;++g)this.codeMap[g]=e.readByte();break;case 4:for(U=e.readUInt16(),R=U/2,e.pos+=6,o=function(){var Te,qe;for(qe=[],g=Te=0;0<=R?Te<R:Te>R;g=0<=R?++Te:--Te)qe.push(e.readUInt16());return qe}(),e.pos+=2,te=function(){var Te,qe;for(qe=[],g=Te=0;0<=R?Te<R:Te>R;g=0<=R?++Te:--Te)qe.push(e.readUInt16());return qe}(),v=function(){var Te,qe;for(qe=[],g=Te=0;0<=R?Te<R:Te>R;g=0<=R?++Te:--Te)qe.push(e.readUInt16());return qe}(),T=function(){var Te,qe;for(qe=[],g=Te=0;0<=R?Te<R:Te>R;g=0<=R?++Te:--Te)qe.push(e.readUInt16());return qe}(),n=(this.length-e.pos+this.offset)/2,s=function(){var Te,qe;for(qe=[],g=Te=0;0<=n?Te<n:Te>n;g=0<=n?++Te:--Te)qe.push(e.readUInt16());return qe}(),g=he=0,be=o.length;he<be;g=++he)for(Ae=o[g],r=pe=J=te[g];J<=Ae?pe<=Ae:pe>=Ae;r=J<=Ae?++pe:--pe)T[g]===0?l=r+v[g]:(l=s[T[g]/2+(r-J)-(R-g)]||0)!==0&&(l+=v[g]),this.codeMap[r]=65535&l}e.pos=F}return i.encode=function(e,t){var r,n,o,l,s,g,v,T,F,R,U,J,te,Ae,he,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Ze,Ct,Et,Pt,bt,Rt,Ft,Xt,Le,Xe,it,pt,mt,Bt,Dt,Mt,qt,ni,_i;switch(Ze=new vd,l=Object.keys(e).sort(function(vi,Pi){return vi-Pi}),t){case"macroman":for(te=0,Ae=function(){var vi=[];for(J=0;J<256;++J)vi.push(0);return vi}(),pe={0:0},o={},Ct=0,Rt=l.length;Ct<Rt;Ct++)pe[Mt=e[n=l[Ct]]]==null&&(pe[Mt]=++te),o[n]={old:e[n],new:pe[e[n]]},Ae[n]=pe[e[n]];return Ze.writeUInt16(1),Ze.writeUInt16(0),Ze.writeUInt32(12),Ze.writeUInt16(0),Ze.writeUInt16(262),Ze.writeUInt16(0),Ze.write(Ae),{charMap:o,subtable:Ze.data,maxGlyphID:te+1};case"unicode":for(De=[],F=[],be=0,pe={},r={},he=v=null,Et=0,Ft=l.length;Et<Ft;Et++)pe[qe=e[n=l[Et]]]==null&&(pe[qe]=++be),r[n]={old:qe,new:pe[qe]},s=pe[qe]-n,he!=null&&s===v||(he&&F.push(he),De.push(n),v=s),he=n;for(he&&F.push(he),F.push(65535),De.push(65535),nt=2*(at=De.length),Ne=2*Math.pow(Math.log(at)/Math.LN2,2),R=Math.log(Ne/2)/Math.LN2,We=2*at-Ne,g=[],je=[],U=[],J=Pt=0,Xt=De.length;Pt<Xt;J=++Pt){if(ke=De[J],T=F[J],ke===65535){g.push(0),je.push(0);break}if(ke-(Ye=r[ke].new)>=32768)for(g.push(0),je.push(2*(U.length+at-J)),n=bt=ke;ke<=T?bt<=T:bt>=T;n=ke<=T?++bt:--bt)U.push(r[n].new);else g.push(Ye-ke),je.push(0)}for(Ze.writeUInt16(3),Ze.writeUInt16(1),Ze.writeUInt32(12),Ze.writeUInt16(4),Ze.writeUInt16(16+8*at+2*U.length),Ze.writeUInt16(0),Ze.writeUInt16(nt),Ze.writeUInt16(Ne),Ze.writeUInt16(R),Ze.writeUInt16(We),Bt=0,Le=F.length;Bt<Le;Bt++)n=F[Bt],Ze.writeUInt16(n);for(Ze.writeUInt16(0),Dt=0,Xe=De.length;Dt<Xe;Dt++)n=De[Dt],Ze.writeUInt16(n);for(qt=0,it=g.length;qt<it;qt++)s=g[qt],Ze.writeUInt16(s);for(ni=0,pt=je.length;ni<pt;ni++)Te=je[ni],Ze.writeUInt16(Te);for(_i=0,mt=U.length;_i<mt;_i++)te=U[_i],Ze.writeUInt16(te);return{charMap:r,subtable:Ze.data,maxGlyphID:be+1}}},i}(),Z4=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="cmap",e.prototype.parse=function(t){var r,n,o;for(t.pos=this.offset,this.version=t.readUInt16(),o=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=o?n<o:n>o;n=0<=o?++n:--n)r=new W4(t,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},e.encode=function(t,r){var n,o;return r==null&&(r="macroman"),n=W4.encode(t,r),(o=new vd).writeUInt16(0),o.writeUInt16(1),n.table=o.data.concat(n.subtable),n},e}(),gre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),mre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var r,n;for(n=[],r=0;r<10;++r)n.push(t.readByte());return n}(),this.charRange=function(){var r,n;for(n=[],r=0;r<4;++r)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var r,n;for(n=[],r=0;r<2;r=++r)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),yre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="post",e.prototype.parse=function(t){var r,n,o;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:break;case 131072:var l;for(n=t.readUInt16(),this.glyphNameIndex=[],l=0;0<=n?l<n:l>n;l=0<=n?++l:--l)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],o=[];t.pos<this.offset+this.length;)r=t.readByte(),o.push(this.names.push(t.readString(r)));return o;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 196608:break;case 262144:return this.map=(function(){var s,g,v;for(v=[],l=s=0,g=this.file.maxp.numGlyphs;0<=g?s<g:s>g;l=0<=g?++s:--s)v.push(t.readUInt32());return v}).call(this)}},e}(),_re=function(i,e){this.raw=i,this.length=i.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},vre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="name",e.prototype.parse=function(t){var r,n,o,l,s,g,v,T,F,R,U;for(t.pos=this.offset,t.readShort(),r=t.readShort(),g=t.readShort(),n=[],l=0;0<=r?l<r:l>r;l=0<=r?++l:--l)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+g+t.readShort()});for(v={},l=F=0,R=n.length;F<R;l=++F)o=n[l],t.pos=o.offset,T=t.readString(o.length),s=new _re(T,o),v[U=o.nameID]==null&&(v[U]=[]),v[o.nameID].push(s);this.strings=v,this.copyright=v[0],this.fontFamily=v[1],this.fontSubfamily=v[2],this.uniqueSubfamily=v[3],this.fontName=v[4],this.version=v[5];try{this.postscriptName=v[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=v[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=v[7],this.manufacturer=v[8],this.designer=v[9],this.description=v[10],this.vendorUrl=v[11],this.designerUrl=v[12],this.license=v[13],this.licenseUrl=v[14],this.preferredFamily=v[15],this.preferredSubfamily=v[17],this.compatibleFull=v[18],this.sampleText=v[19]},e}(),bre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),xre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="hmtx",e.prototype.parse=function(t){var r,n,o,l,s,g,v;for(t.pos=this.offset,this.metrics=[],r=0,g=this.file.hhea.numberOfMetrics;0<=g?r<g:r>g;r=0<=g?++r:--r)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var T,F;for(F=[],r=T=0;0<=o?T<o:T>o;r=0<=o?++T:--T)F.push(t.readInt16());return F}(),this.widths=(function(){var T,F,R,U;for(U=[],T=0,F=(R=this.metrics).length;T<F;T++)l=R[T],U.push(l.advance);return U}).call(this),n=this.widths[this.widths.length-1],v=[],r=s=0;0<=o?s<o:s>o;r=0<=o?++s:--s)v.push(this.widths.push(n));return v},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),X4=[].slice,wre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var r,n,o,l,s,g,v,T,F,R;return t in this.cache?this.cache[t]:(l=this.file.loca,r=this.file.contents,n=l.indexOf(t),(o=l.lengthOf(t))===0?this.cache[t]=null:(r.pos=this.offset+n,s=(g=new vd(r.read(o))).readShort(),T=g.readShort(),R=g.readShort(),v=g.readShort(),F=g.readShort(),this.cache[t]=s===-1?new Cre(g,T,R,v,F):new Bre(g,s,T,R,v,F),this.cache[t]))},e.prototype.encode=function(t,r,n){var o,l,s,g,v;for(s=[],l=[],g=0,v=r.length;g<v;g++)o=t[r[g]],l.push(s.length),o&&(s=s.concat(o.encode(n)));return l.push(s.length),{table:s,offsets:l}},e}(),Bre=function(){function i(e,t,r,n,o,l){this.raw=e,this.numberOfContours=t,this.xMin=r,this.yMin=n,this.xMax=o,this.yMax=l,this.compound=!1}return i.prototype.encode=function(){return this.raw.data},i}(),Cre=function(){function i(e,t,r,n,o){var l,s;for(this.raw=e,this.xMin=t,this.yMin=r,this.xMax=n,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],l=this.raw;s=l.readShort(),this.glyphOffsets.push(l.pos),this.glyphIDs.push(l.readUInt16()),32&s;)l.pos+=1&s?4:2,128&s?l.pos+=8:64&s?l.pos+=4:8&s&&(l.pos+=2)}return i.prototype.encode=function(){var e,t,r;for(t=new vd(X4.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)t.pos=this.glyphOffsets[e];return t.data},i}(),Ere=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,hh),e.prototype.tag="loca",e.prototype.parse=function(t){var r,n;return t.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?(function(){var o,l;for(l=[],n=0,o=this.length;n<o;n+=2)l.push(2*t.readUInt16());return l}).call(this):(function(){var o,l;for(l=[],n=0,o=this.length;n<o;n+=4)l.push(t.readUInt32());return l}).call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,r){for(var n=new Uint32Array(this.offsets.length),o=0,l=0,s=0;s<n.length;++s)if(n[s]=o,l<r.length&&r[l]==s){++l,n[s]=o;var g=this.offsets[s],v=this.offsets[s+1]-g;v>0&&(o+=v)}for(var T=new Array(4*n.length),F=0;F<n.length;++F)T[4*F+3]=255&n[F],T[4*F+2]=(65280&n[F])>>8,T[4*F+1]=(16711680&n[F])>>16,T[4*F]=(4278190080&n[F])>>24;return T},e}(),Sre=function(){function i(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return i.prototype.generateCmap=function(){var e,t,r,n,o;for(t in n=this.font.cmap.tables[0].codeMap,e={},o=this.subset)r=o[t],e[t]=n[r];return e},i.prototype.glyphsFor=function(e){var t,r,n,o,l,s,g;for(n={},l=0,s=e.length;l<s;l++)n[o=e[l]]=this.font.glyf.glyphFor(o);for(o in t=[],n)(r=n[o])!=null&&r.compound&&t.push.apply(t,r.glyphIDs);if(t.length>0)for(o in g=this.glyphsFor(t))r=g[o],n[o]=r;return n},i.prototype.encode=function(e,t){var r,n,o,l,s,g,v,T,F,R,U,J,te,Ae,he;for(n in r=Z4.encode(this.generateCmap(),"unicode"),l=this.glyphsFor(e),U={0:0},he=r.charMap)U[(g=he[n]).old]=g.new;for(J in R=r.maxGlyphID,l)J in U||(U[J]=R++);return T=function(pe){var be,Te;for(be in Te={},pe)Te[pe[be]]=be;return Te}(U),F=Object.keys(T).sort(function(pe,be){return pe-be}),te=function(){var pe,be,Te;for(Te=[],pe=0,be=F.length;pe<be;pe++)s=F[pe],Te.push(T[s]);return Te}(),o=this.font.glyf.encode(l,te,U),v=this.font.loca.encode(o.offsets,te),Ae={cmap:this.font.cmap.raw(),glyf:o.table,loca:v,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(Ae["OS/2"]=this.font.os2.raw()),this.font.directory.encode(Ae)},i}();Hr.API.PDFObject=function(){var i;function e(){}return i=function(t,r){return(Array(r+1).join("0")+t).slice(-r)},e.convert=function(t){var r,n,o,l;if(Array.isArray(t))return"["+function(){var s,g,v;for(v=[],s=0,g=t.length;s<g;s++)r=t[s],v.push(e.convert(r));return v}().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t!=null&&t.isString)return"("+t+")";if(t instanceof Date)return"(D:"+i(t.getUTCFullYear(),4)+i(t.getUTCMonth(),2)+i(t.getUTCDate(),2)+i(t.getUTCHours(),2)+i(t.getUTCMinutes(),2)+i(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(n in o=["<<"],t)l=t[n],o.push("/"+n+" "+e.convert(l));return o.push(">>"),o.join(`
`)}return""+t},e}(),function(i){var e={};function t(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return i[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=i,t.c=e,t.d=function(r,n,o){t.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:o})},t.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,n){if(1&n&&(r=t(r)),8&n||4&n&&typeof r=="object"&&r&&r.__esModule)return r;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&n&&typeof r!="string")for(var l in r)t.d(o,l,(function(s){return r[s]}).bind(null,l));return o},t.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(n,"a",n),n},t.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},t.p="",t(t.s=0)}([function(i,e,t){i.exports=t(1)},function(i,e){function t(n,o){for(var l=0;l<o.length;l++){var s=o[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}var r=function(){function n(){(function(s,g){if(!(s instanceof g))throw new TypeError("Cannot call a class as a function")})(this,n),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var o,l;return o=n,(l=[{key:"show",value:function(s){this.setOptions(s),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var s=document.getElementById("loading-overlay-stylesheet");s&&(s.disabled=!0,s.parentNode.removeChild(s),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(s){if(s!==void 0)for(var g in s)this.options[g]=s[g]}},{key:"generateAndAddOverlayElement",value:function(){var s="50%";this.options.offsetX!==0&&(s="calc(50% + "+this.options.offsetX+")");var g="50%";if(this.options.offsetY!==0&&(g="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var v='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(g,"; left: ").concat(s,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),T=document.getElementById(this.options.containerID);return T.style.position="relative",void T.insertAdjacentHTML("beforeend",v)}var F='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(g,"; left: ").concat(s,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",F)}},{key:"generateSpinnerElement",value:function(){var s=this,g=Object.keys(this.numberOfEmptyDivForSpinner).find(function(T){return T===s.options.spinnerIcon}),v=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[g]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(v,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var s=document.createElement("link");s.setAttribute("id","loading-overlay-stylesheet"),s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(s)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(s){for(var g="",v=1;v<=s;v++)g+="<div></div>";return g}}])&&t(o.prototype,l),n}();window.JsLoadingOverlay=new r,i.exports=JsLoadingOverlay}]);const bd={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Hy={in:"in",mm:"mm"},Mg={A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},Gy={Landscape:"landscape",Portrait:"portrait"},RC={72:72,96:96,200:200,300:300,400:400};let Tre=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Mg.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:bd.PNG.toString(),o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Hy.mm,l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map";Is(this,"map"),Is(this,"width"),Is(this,"height"),Is(this,"dpi"),Is(this,"format"),Is(this,"unit"),Is(this,"fileName"),this.map=e,this.width=t[0],this.height=t[1],this.dpi=r,this.format=n,this.unit=o,this.fileName=l}generate(){const e=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const t=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return e.dpi/96}});const r=document.createElement("div");r.className="hidden-map",document.body.appendChild(r);const n=document.createElement("div");n.style.width=this.toPixels(this.width),n.style.height=this.toPixels(this.height),r.appendChild(n);const o=this.map.getStyle();if(o&&o.sources){const s=o.sources;Object.keys(s).forEach(g=>{const v=s[g];Object.keys(v).forEach(T=>{v[T]||delete v[T]})})}const l=new Sie.Map({container:n,style:o,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn});l.once("idle",()=>{var s;const g=l.getCanvas(),v=`${this.fileName}.${e.format}`;switch(e.format){case bd.PNG:e.toPNG(g,v);break;case bd.JPEG:e.toJPEG(g,v);break;case bd.PDF:e.toPDF(l,v);break;case bd.SVG:e.toSVG(g,v);break;default:console.error(`Invalid file format: ${e.format}`);break}l.remove(),(s=r.parentNode)==null||s.removeChild(r),Object.defineProperty(window,"devicePixelRatio",{get(){return t}}),r.remove(),JsLoadingOverlay.hide()})}toPNG(e,t){const r=document.createElement("a");r.href=e.toDataURL(),r.download=t,r.click(),r.remove()}toJPEG(e,t){const r=e.toDataURL("image/jpeg",.85);if(e.msToBlob){const n=this.toBlob(r);window.navigator.msSaveBlob(n,t)}else{const n=document.createElement("a");n.href=r,n.download=t,n.click(),n.remove()}}toPDF(e,t){const r=e.getCanvas(),n=new Hr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});n.addImage(r.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:o,lat:l}=e.getCenter();n.setProperties({title:e.getStyle().name,subject:`center: [${o}, ${l}], zoom: ${e.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),n.save(t)}toSVG(e,t){const r=e.toDataURL("image/png"),n=Number(this.toPixels(this.width,this.dpi).replace("px","")),o=Number(this.toPixels(this.height,this.dpi).replace("px","")),l=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${n}" 
      height="${o}" 
      viewBox="0 0 ${n} ${o}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${r}" width="${n}" height="${o}"></image>
    </svg>`,s=document.createElement("a");s.href=`data:application/xml,${encodeURIComponent(l)}`,s.download=t,s.click(),s.remove()}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Hy.mm&&(t/=25.4),`${t*e}px`}toBlob(e){const t=atob(e.replace(/^.*,/,"")),r=new Uint8Array(t.length);for(let n=0;n<t.length;n+=1)r[n]=t.charCodeAt(n);return new Blob([r.buffer],{type:"image/png"})}},Ire=class{constructor(e){Is(this,"map"),Is(this,"width"),Is(this,"height"),Is(this,"unit"),Is(this,"svgCanvas"),Is(this,"svgPath");var t,r,n;if(this.map=e,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const o=(t=this.map)==null?void 0:t.getCanvas().clientWidth,l=(r=this.map)==null?void 0:r.getCanvas().clientHeight,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.setAttribute("width",`${o}px`),s.setAttribute("height",`${l}px`);const g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("style","fill:#888888;stroke-width:0"),g.setAttribute("fill-opacity","0.5"),s.append(g),(n=this.map)==null||n.getCanvasContainer().appendChild(s),this.svgCanvas=s,this.svgPath=g}mapResize(){this.generateCutOut()}updateArea(e,t){this.width=e,this.height=t,this.unit=Hy.mm,this.generateCutOut()}generateCutOut(){var e,t;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const r=this.toPixels(this.width),n=this.toPixels(this.height),o=(e=this.map)==null?void 0:e.getCanvas().clientWidth,l=(t=this.map)==null?void 0:t.getCanvas().clientHeight,s=o/2-r/2,g=s+r,v=l/2-n/2,T=v+n;this.svgCanvas.setAttribute("width",`${o}px`),this.svgCanvas.setAttribute("height",`${l}px`),this.svgPath.setAttribute("d",`M 0 0 L ${o} 0 L ${o} ${l} L 0 ${l} M ${s} ${v} L ${s} ${T} L ${g} ${T} L ${g} ${v}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Hy.mm&&(t/=25.4),t*e}};const J4={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate"},Lre={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer"},Mre={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi"},Pre={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen"},Fre={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera"},Dre={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar"},Rre={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo"},kre={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати"},Ore={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出"},Ure={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出"},Nre={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力"};let zre=class{constructor(e){Is(this,"controlContainer"),Is(this,"exportContainer"),Is(this,"crosshair"),Is(this,"printableArea"),Is(this,"map"),Is(this,"exportButton"),Is(this,"options",{PageSize:Mg.A4,PageOrientation:Gy.Landscape,Format:bd.PDF,DPI:RC[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(Mg),Filename:"map"}),e&&(this.options=Object.assign(this.options,e)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){switch(this.options.Local){case"de":return Pre;case"en":return J4;case"fr":return Lre;case"fi":return Mre;case"sv":return Fre;case"es":return Dre;case"vi":return Rre;case"uk":return kre;case"zhHans":return Ore;case"zhHant":return Ure;case"ja":return Nre;default:return J4}}onAdd(e){var t;this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add("maplibregl-export-list"),this.exportButton=document.createElement("button"),this.exportButton.classList.add("maplibregl-ctrl-icon"),this.exportButton.classList.add("maplibregl-export-control"),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const r=document.createElement("TABLE");r.className="print-table";const n={};(t=this.options.AllowedSizes)==null||t.forEach(T=>{Mg[T]&&(n[T]=Mg[T])});const o=this.createSelection(n,this.getTranslation().PageSize,"page-size",this.options.PageSize,(T,F)=>JSON.stringify(T[F]));r.appendChild(o);const l=this.createSelection(Gy,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(T,F)=>T[F]);r.appendChild(l);const s=this.createSelection(bd,this.getTranslation().Format,"format-type",this.options.Format,(T,F)=>T[F]);r.appendChild(s);const g=this.createSelection(RC,this.getTranslation().DPI,"dpi-type",this.options.DPI,(T,F)=>T[F]);r.appendChild(g),this.exportContainer.appendChild(r);const v=document.createElement("button");return v.type="button",v.textContent=this.getTranslation().Generate,v.classList.add("generate-button"),v.addEventListener("click",()=>{const T=document.getElementById("mapbox-gl-export-page-size"),F=document.getElementById("mapbox-gl-export-page-orientation"),R=document.getElementById("mapbox-gl-export-format-type"),U=document.getElementById("mapbox-gl-export-dpi-type"),J=F.value;let te=JSON.parse(T.value);J===Gy.Portrait&&(te=te.reverse()),new Tre(e,te,Number(U.value),R.value,Hy.mm,this.options.Filename).generate()}),this.exportContainer.appendChild(v),this.controlContainer}createSelection(e,t,r,n,o){const l=document.createElement("label");l.textContent=t;const s=document.createElement("select");s.setAttribute("id",`mapbox-gl-export-${r}`),s.style.width="100%",Object.keys(e).forEach(F=>{const R=document.createElement("option");R.setAttribute("value",o(e,F)),R.appendChild(document.createTextNode(F)),R.setAttribute("name",r),n===e[F]&&(R.selected=!0),s.appendChild(R)}),s.addEventListener("change",()=>{this.updatePrintableArea()});const g=document.createElement("TR"),v=document.createElement("TD"),T=document.createElement("TD");return v.appendChild(l),T.appendChild(s),g.appendChild(v),g.appendChild(T),g}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}onDocumentClick(e){this.controlContainer&&!this.controlContainer.contains(e.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(e){this.options.Crosshair===!0&&(e===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new Lie(this.map),this.crosshair.create()))}togglePrintableArea(e){this.options.PrintableArea===!0&&(e===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new Ire(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const e=document.getElementById("mapbox-gl-export-page-size"),t=document.getElementById("mapbox-gl-export-page-orientation").value;let r=JSON.parse(e.value);t===Gy.Portrait&&(r=r.reverse()),this.printableArea.updateArea(r[0],r[1])}};var Y4=Vre,Qre=Object.prototype.hasOwnProperty;function Vre(){for(var i={},e=0;e<arguments.length;e++){var t=arguments[e];for(var r in t)Qre.call(t,r)&&(i[r]=t[r])}return i}var eD={exports:{}};(function(i,e){(function(){var t={};i.exports=t,t.simpleFilter=function(r,n){return n.filter(function(o){return t.test(r,o)})},t.test=function(r,n){return t.match(r,n)!==null},t.match=function(r,n,o){o=o||{};var l=0,s=[],g=n.length,v=0,T=0,F=o.pre||"",R=o.post||"",U=o.caseSensitive&&n||n.toLowerCase(),J;r=o.caseSensitive&&r||r.toLowerCase();for(var te=0;te<g;te++)J=n[te],U[te]===r[l]?(J=F+J+R,l+=1,T+=1+T):T=0,v+=T,s[s.length]=J;return l===r.length?(v=U===r?1/0:v,{rendered:s.join(""),score:v}):null},t.filter=function(r,n,o){return!n||n.length===0?[]:typeof r!="string"?n:(o=o||{},n.reduce(function(l,s,g,v){var T=s;o.extract&&(T=o.extract(s));var F=t.match(r,T,o);return F!=null&&(l[l.length]={string:F.rendered,score:F.score,index:g,original:s}),l},[]).sort(function(l,s){var g=s.score-l.score;return g||l.index-s.index}))}})()})(eD);var Hre=eD.exports,Rc=function(i){return this.component=i,this.items=[],this.active=i.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,i.el.parentNode.insertBefore(this.wrapper,i.el.nextSibling),this};Rc.prototype.show=function(){this.element.style.display="block"},Rc.prototype.hide=function(){this.element.style.display="none"},Rc.prototype.add=function(i){this.items.push(i)},Rc.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},Rc.prototype.isEmpty=function(){return!this.items.length},Rc.prototype.isVisible=function(){return this.element.style.display==="block"},Rc.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var i=0;i<this.items.length;i++)this.drawItem(this.items[i],this.active===i);this.show()},Rc.prototype.drawItem=function(i,e){var t=document.createElement("li"),r=document.createElement("a");e&&(t.className+=" active"),r.innerHTML=i.string,t.appendChild(r),this.element.appendChild(t),t.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),t.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,i)}).bind(this))},Rc.prototype.handleMouseUp=function(i){this.selectingListItem=!1,this.component.value(i.original),this.clear(),this.draw()},Rc.prototype.move=function(i){this.active=i,this.draw()},Rc.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},Rc.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},Rc.prototype.drawError=function(i){var e=document.createElement("li");e.innerHTML=i,this.element.appendChild(e),this.show()};var Gre=Rc,jre=Y4,qre=Hre,$re=Gre,Rl=function(i,e,t){return t=t||{},this.options=jre({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},t),this.el=i,this.data=e||[],this.list=new $re(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(r){this.handleKeyUp(r.keyCode,r)}).bind(this),!1),this.el.addEventListener("keydown",(function(r){this.handleKeyDown(r)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(r){this.handlePaste(r)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Rl.prototype.handleKeyUp=function(i,e){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),e.stopPropagation());return}this.handleInputChange(this.el.value)}},Rl.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},Rl.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},Rl.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(i.target.value)},100)}},Rl.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}).bind(this))},Rl.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},Rl.prototype.update=function(i){this.data=i,this.handleKeyUp()},Rl.prototype.clear=function(){this.data=[],this.list.clear()},Rl.prototype.normalize=function(i){return i=i.toLowerCase(),i},Rl.prototype.match=function(i,e){return i.indexOf(e)>-1},Rl.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")},Rl.prototype.getCandidates=function(i){var e={pre:"<strong>",post:"</strong>",extract:(function(r){return this.getItemValue(r)}).bind(this)},t;this.options.filter?(t=qre.filter(this.query,this.data,e),t=t.map((function(r){return{original:r.original,string:this.render(r.original,r.string)}}).bind(this))):t=this.data.map((function(r){var n=this.render(r);return{original:r,string:n}}).bind(this)),i(t)},Rl.prototype.getItemValue=function(i){return i},Rl.prototype.render=function(i,e){if(e)return e;for(var t=i.original?this.getItemValue(i.original):this.getItemValue(i),r=this.normalize(t),n=r.lastIndexOf(this.query);n>-1;){var o=n+this.query.length;t=t.slice(0,n)+"<strong>"+t.slice(n,o)+"</strong>"+t.slice(o),n=r.slice(0,n).lastIndexOf(this.query)}return t},Rl.prototype.renderError=function(i){this.list.drawError(i)};var Kre=Rl,tD=Kre,Wre=tD;typeof window<"u"&&(window.Suggestions=tD);var Zre="Expected a function",iD=NaN,Xre="[object Symbol]",Jre=/^\s+|\s+$/g,Yre=/^[-+]0x[0-9a-f]+$/i,ene=/^0b[01]+$/i,tne=/^0o[0-7]+$/i,ine=parseInt,rne=typeof cf=="object"&&cf&&cf.Object===Object&&cf,nne=typeof self=="object"&&self&&self.Object===Object&&self,sne=rne||nne||Function("return this")(),one=Object.prototype,ane=one.toString,lne=Math.max,cne=Math.min,kC=function(){return sne.Date.now()};function une(i,e,t){var r,n,o,l,s,g,v=0,T=!1,F=!1,R=!0;if(typeof i!="function")throw new TypeError(Zre);e=rD(e)||0,OC(t)&&(T=!!t.leading,F="maxWait"in t,o=F?lne(rD(t.maxWait)||0,e):o,R="trailing"in t?!!t.trailing:R);function U(je){var We=r,Ne=n;return r=n=void 0,v=je,l=i.apply(Ne,We),l}function J(je){return v=je,s=setTimeout(he,e),T?U(je):l}function te(je){var We=je-g,Ne=je-v,at=e-We;return F?cne(at,o-Ne):at}function Ae(je){var We=je-g,Ne=je-v;return g===void 0||We>=e||We<0||F&&Ne>=o}function he(){var je=kC();if(Ae(je))return pe(je);s=setTimeout(he,te(je))}function pe(je){return s=void 0,R&&r?U(je):(r=n=void 0,l)}function be(){s!==void 0&&clearTimeout(s),v=0,r=g=n=s=void 0}function Te(){return s===void 0?l:pe(kC())}function qe(){var je=kC(),We=Ae(je);if(r=arguments,n=this,g=je,We){if(s===void 0)return J(g);if(F)return s=setTimeout(he,e),U(g)}return s===void 0&&(s=setTimeout(he,e)),l}return qe.cancel=be,qe.flush=Te,qe}function OC(i){var e=typeof i;return!!i&&(e=="object"||e=="function")}function hne(i){return!!i&&typeof i=="object"}function Ane(i){return typeof i=="symbol"||hne(i)&&ane.call(i)==Xre}function rD(i){if(typeof i=="number")return i;if(Ane(i))return iD;if(OC(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=OC(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=i.replace(Jre,"");var t=ene.test(i);return t||tne.test(i)?ine(i.slice(2),t?2:8):Yre.test(i)?iD:+i}var dne=une,UC={exports:{}},Pg=typeof Reflect=="object"?Reflect:null,nD=Pg&&typeof Pg.apply=="function"?Pg.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},cv;Pg&&typeof Pg.ownKeys=="function"?cv=Pg.ownKeys:Object.getOwnPropertySymbols?cv=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:cv=function(e){return Object.getOwnPropertyNames(e)};function fne(i){console&&console.warn&&console.warn(i)}var sD=Number.isNaN||function(e){return e!==e};function xs(){xs.init.call(this)}UC.exports=xs,UC.exports.once=yne,xs.EventEmitter=xs,xs.prototype._events=void 0,xs.prototype._eventsCount=0,xs.prototype._maxListeners=void 0;var oD=10;function uv(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(xs,"defaultMaxListeners",{enumerable:!0,get:function(){return oD},set:function(i){if(typeof i!="number"||i<0||sD(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");oD=i}}),xs.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},xs.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||sD(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function aD(i){return i._maxListeners===void 0?xs.defaultMaxListeners:i._maxListeners}xs.prototype.getMaxListeners=function(){return aD(this)},xs.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",o=this._events;if(o!==void 0)n=n&&o.error===void 0;else if(!n)return!1;if(n){var l;if(t.length>0&&(l=t[0]),l instanceof Error)throw l;var s=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw s.context=l,s}var g=o[e];if(g===void 0)return!1;if(typeof g=="function")nD(g,this,t);else for(var v=g.length,T=AD(g,v),r=0;r<v;++r)nD(T[r],this,t);return!0};function lD(i,e,t,r){var n,o,l;if(uv(t),o=i._events,o===void 0?(o=i._events=Object.create(null),i._eventsCount=0):(o.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),o=i._events),l=o[e]),l===void 0)l=o[e]=t,++i._eventsCount;else if(typeof l=="function"?l=o[e]=r?[t,l]:[l,t]:r?l.unshift(t):l.push(t),n=aD(i),n>0&&l.length>n&&!l.warned){l.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=i,s.type=e,s.count=l.length,fne(s)}return i}xs.prototype.addListener=function(e,t){return lD(this,e,t,!1)},xs.prototype.on=xs.prototype.addListener,xs.prototype.prependListener=function(e,t){return lD(this,e,t,!0)};function pne(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function cD(i,e,t){var r={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},n=pne.bind(r);return n.listener=t,r.wrapFn=n,n}xs.prototype.once=function(e,t){return uv(t),this.on(e,cD(this,e,t)),this},xs.prototype.prependOnceListener=function(e,t){return uv(t),this.prependListener(e,cD(this,e,t)),this},xs.prototype.removeListener=function(e,t){var r,n,o,l,s;if(uv(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(o=-1,l=r.length-1;l>=0;l--)if(r[l]===t||r[l].listener===t){s=r[l].listener,o=l;break}if(o<0)return this;o===0?r.shift():gne(r,o),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,s||t)}return this},xs.prototype.off=xs.prototype.removeListener,xs.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),l;for(n=0;n<o.length;++n)l=o[n],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function uD(i,e,t){var r=i._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?mne(n):AD(n,n.length)}xs.prototype.listeners=function(e){return uD(this,e,!0)},xs.prototype.rawListeners=function(e){return uD(this,e,!1)},xs.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):hD.call(i,e)},xs.prototype.listenerCount=hD;function hD(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}xs.prototype.eventNames=function(){return this._eventsCount>0?cv(this._events):[]};function AD(i,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=i[r];return t}function gne(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function mne(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function yne(i,e){return new Promise(function(t,r){function n(l){i.removeListener(e,o),r(l)}function o(){typeof i.removeListener=="function"&&i.removeListener("error",n),t([].slice.call(arguments))}dD(i,e,o,{once:!0}),e!=="error"&&_ne(i,n,{once:!0})})}function _ne(i,e,t){typeof i.on=="function"&&dD(i,"error",e,t)}function dD(i,e,t,r){if(typeof i.on=="function")r.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function n(o){r.once&&i.removeEventListener(e,n),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var fD=UC.exports,vne={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},bne={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},xne={placeholder:bne},pD={exports:{}};(function(i){(function(e,t,r){i.exports?i.exports=r():e[t]=r()})(cf,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(g){return g.match(t)||[]}function n(g){return r(g).filter(function(v,T){return v&&T})}function o(g){return g=r(g),{language:g[1]||e,extlang:g[2]||e,script:g[3]||e,region:g[4]||e}}function l(g,v,T){Object.defineProperty(g,v,{value:T,enumerable:!0})}function s(g,v,T){function F(R){return r(R)[g]||e}l(F,"pattern",v),l(o,T,F)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),l(o,"split",n),o})})(pD);var wne=pD.exports,Bne=Wre,Cne=dne,au=Y4,Ene=fD.EventEmitter,gD=vne,Sne=xne,Tne=wne;function mD(i,e){this._eventEmitter=new Ene,this.options=au({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=i}mD.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(i){return i.text!==void 0?i.text:i.place_name},render:function(i){if(i.geometry){var s=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+s.splice(1,s.length).join(",")+"</div></div></div>"}else{var e=i.text,t=e.toLowerCase().indexOf(this.query.toLowerCase()),r=this.query.length,n=e.substring(0,t),o=e.substring(t,t+r),l=e.substring(t+r);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+n+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+o+"</span>"+l+"</div></div></div>"}},popupRender:function(i){var e=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(i){function e(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var o=r.onAdd();n.appendChild(o)}if(i._controlContainer)i.addControl(this);else if(i instanceof HTMLElement)e(this,i);else if(typeof i=="string"){var t=document.querySelectorAll(i);if(t.length===0)throw new Error("Element ",i,"not found.");if(t.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,t[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(i){if(i&&typeof i!="string"&&(this._map=i),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var t=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Cne(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var n=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(n),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),e.appendChild(t),e.appendChild(this._inputEl),e.appendChild(r),this._typeahead=new Bne(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),e},createIcon:function(i,e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+i+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+i),t.setAttribute("viewBox","0 0 18 18"),t.setAttribute("xml:space","preserve"),t.setAttribute("width",18),t.setAttribute("height",18),"innerHTML"in t)t.innerHTML=e;else{var r=document.createElement("div");r.innerHTML="<svg>"+e.valueOf().toString()+"</svg>";var n=r.firstChild,o=n.firstChild;t.appendChild(o)}return t},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(i){var e=(i.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e)},_onKeyDown:function(i){var e=27,t=9;if(i.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(i),this._inputEl.blur();var r=i.target&&i.target.shadowRoot?i.target.shadowRoot.activeElement:i.target,n=r?r.value:"";if(!n)return this.fresh=!0,i.keyCode!==t&&this.clear(i),this._clearEl.style.display="none";if(!(i.metaKey||[t,e,37,39,38,40].indexOf(i.keyCode)!==-1)){if(i.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(r.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(r.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}r.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(i){this.options.clearOnBlur&&this._clearOnBlur(i),this.options.collapsed&&this._collapse()},_onChange:function(){var i=this._typeahead.selected;if(i&&!i.geometry)i.placeId?this._geocode(i.placeId,!0,!0):this._geocode(i.text,!0);else if(i&&JSON.stringify(i)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var e;if(this._removeResultMarkers(),i.properties&&gD[i.properties.short_code])e=au({},this.options.flyTo),this._map&&this._map.fitBounds(gD[i.properties.short_code].bbox,e);else if(i.bbox){var t=i.bbox;e=au({},this.options.flyTo),this._map&&this._map.fitBounds([[t[0],t[1]],[t[2],t[3]]],e)}else{var r={zoom:this.options.zoom};e=au({},r,this.options.flyTo),i.center?e.center=i.center:i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(e.center=i.geometry.coordinates),this._map&&this._map.flyTo(e)}}this.options.marker&&this._maplibregl&&this._handleMarker(i),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(i),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:i})}},_getConfigForRequest:function(){var i=["bbox","limit","proximity","countries","types","language","reverseMode"],e=this,t=i.reduce(function(r,n){return e.options[n]&&(["countries","types","language"].indexOf(n)>-1?r[n]=e.options[n].split(/[\s,]+/):r[n]=e.options[n],n==="proximity"&&e.options[n]&&typeof e.options[n].longitude=="number"&&typeof e.options[n].latitude=="number"&&(r[n]=[e.options[n].longitude,e.options[n].latitude])),r},{});return t},_geocode:function(i,e,t){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:i}),this.inputString=i;var r=null,n=this._getConfigForRequest(),o;if(this.options.localGeocoderOnly)o=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(i)){var l=i.split(/[\s(,)?]+/).map(function(v){return parseFloat(v,10)}).reverse();n.types&&n.types[0],n=au(n,{query:l,limit:1}),"proximity"in n&&delete n.proximity,o=this.geocoderApi.reverseGeocode(n)}else n=au(n,{query:i}),this.geocoderApi.getSuggestions?e?this.geocoderApi.searchByPlaceId&&t?o=this.geocoderApi.searchByPlaceId(n):o=this.geocoderApi.forwardGeocode(n):o=this.geocoderApi.getSuggestions(n):o=this.geocoderApi.forwardGeocode(n);var s=[];this.options.localGeocoder&&(s=this.options.localGeocoder(i),s||(s=[]));var g=[];return o.catch((function(v){r=v}).bind(this)).then((function(v){this._loadingEl.style.display="none";var T={};return v?T=v:T={type:"FeatureCollection",features:[]},T.config=n,this.fresh&&(this.fresh=!1),T.features=T.features?s.concat(T.features):s,this.options.externalGeocoder?(g=this.options.externalGeocoder(i,T.features,n)||[],g.then(function(F){return T.features=T.features?F.concat(T.features):F,T},function(){return T})):T}).bind(this)).then((function(v){if(r)throw r;this.options.filter&&v.features.length&&(v.features=v.features.filter(this.options.filter));var T=[];v.suggestions?T=v.suggestions:v.place?T=[v.place]:T=v.features,T.length?(this._clearEl.style.display="block",this._typeahead.update(T),(!this.options.showResultsWhileTyping||e)&&this.options.showResultMarkers&&(v.features.length>0||v.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",v)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",v))}).bind(this)).catch((function(v){this._loadingEl.style.display="none",s.length&&this.options.localGeocoder||g.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(s)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:s}),this._eventEmitter.emit("error",{error:v})}).bind(this)),o},_clear:function(i){i&&i.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(i){this._clear(i),this._inputEl.focus()},_clearOnBlur:function(i){var e=this;i.relatedTarget&&e._clear(i)},_onQueryResult:function(i){var e=i;if(e.features.length){var t=e.features[0];this._typeahead.selected=t,this._inputEl.value=t.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var i=this._map.getCenter().wrap();this.setProximity({longitude:i.lng,latitude:i.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(i){return this._geocode(i).then(this._onQueryResult),this},_renderError:function(){var i="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(i)},_renderNoResults:function(){var i="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(i)},_renderMessage:function(i){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(i)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var i=this.options.language.split(",")[0],e=Tne.language(i),t=Sne.placeholder[e];if(t)return t}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var i=this._typeahead.data.filter(function(n){return typeof n!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var e={padding:100},t=au({},e,this.options.flyTo),r=new this._maplibregl.LngLatBounds;i.forEach(function(n){r.extend(n.geometry.coordinates)}),this._map.fitBounds(r.toArray(),t)}return i.length>0&&this._maplibregl&&this._handleResultMarkers(i),this}},setInput:function(i){return this._inputEl.value=i,this._typeahead.selected=null,this._typeahead.clear(),i.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i),this},setProximity:function(i){return this.options.proximity=i,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(i){return i&&typeof i=="function"&&(this._typeahead.render=i),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(i){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=i||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(i){return this.options.zoom=i,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(i){return this.options.flyTo=i,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(i){return this.placeholder=i||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(i){return this.options.bbox=i,this},getCountries:function(){return this.options.countries},setCountries:function(i){return this.options.countries=i,this},getTypes:function(){return this.options.types},setTypes:function(i){return this.options.types=i,this},getMinLength:function(){return this.options.minLength},setMinLength:function(i){return this.options.minLength=i,this._typeahead&&(this._typeahead.options.minLength=i),this},getLimit:function(){return this.options.limit},setLimit:function(i){return this.options.limit=i,this._typeahead&&(this._typeahead.options.limit=i),this},getFilter:function(){return this.options.filter},setFilter:function(i){return this.options.filter=i,this},setGeocoderApi:function(i){return this.geocoderApi=i,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(i){if(this._map){this._removeMarker();var e={color:"#4668F2"},t=au({},e,this.options.marker);this.mapMarker=new this._maplibregl.Marker(t);var r;if(this.options.popup){var n={},o=au({},n,this.options.popup);r=new this._maplibregl.Popup(o).setHTML(this.options.popupRender(i))}return i.center?(this.mapMarker.setLngLat(i.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(this.mapMarker.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(i){if(this._map){this._removeResultMarkers();var e={color:"#4668F2"},t=au({},e,this.options.showResultMarkers);return i.forEach((function(r){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var n=this.options.showResultMarkers.element.cloneNode(!0);t=au(t,{element:n})}var o=new this._maplibregl.Marker(au({},t,{element:n})),l;if(this.options.popup){var s={},g=au({},s,this.options.popup);l=new this._maplibregl.Popup(g).setHTML(this.options.popupRender(r))}r.center?(o.setLngLat(r.center).addTo(this._map),this.options.popup&&o.setPopup(l)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(o.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&o.setPopup(l)),this.resultMarkers.push(o)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(i){i.remove()}),this.resultMarkers=[])},on:function(i,e){return this._eventEmitter.on(i,e),this},off:function(i,e){return this._eventEmitter.removeListener(i,e),this}};var Ine=mD;const Lne=Um(Ine),rn={limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogràfic i Geològic de Catalunya",logoWidth:100},logoGencatOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:{0:{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},1:{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},2:{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},3:{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},4:{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},5:{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},6:{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}},urlTerrainICGC:{0:{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},1:{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}},ortoLayersICGC:{0:{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},1:{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},2:{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},3:{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},4:{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},5:{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},6:{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},7:{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},8:{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},9:{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},10:{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},11:{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},12:{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},13:{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},14:{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},15:{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},16:{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},17:{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},18:{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},19:{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},20:{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},21:{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},22:{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},23:{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},24:{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},25:{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},26:{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},27:{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},28:{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},29:{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},30:{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},31:{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},32:{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},33:{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},34:{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},35:{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},36:{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},37:{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},38:{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},39:{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},40:{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},41:{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},42:{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},43:{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},44:{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},45:{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}},vectorLayersICGC:{0:{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},1:{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},2:{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},3:{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},4:{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},5:{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},6:{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},7:{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},8:{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},9:{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},10:{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},11:{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},12:{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},13:{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},14:{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},15:{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},16:{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},17:{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},18:{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},19:{name:"catalunyaVigent",key:"catalunya_vigent"},20:{name:"catalunyaVigentText",key:"catalunya_vigent_text"},21:{name:"comarques2022",key:"comarques_2022"},22:{name:"comarquesVigent",key:"comarques_vigent"},23:{name:"comarquesVigentText",key:"comarques_vigent_text"},24:{name:"districtesCensals2015",key:"districtes_censals_2015"},25:{name:"districtesCensals2016",key:"districtes_censals_2016"},26:{name:"districtesCensals2017",key:"districtes_censals_2017"},27:{name:"districtesCensals2018",key:"districtes_censals_2018"},28:{name:"districtesCensals2019",key:"districtes_censals_2019"},29:{name:"districtesCensals2020",key:"districtes_censals_2020"},30:{name:"districtesCensals2021",key:"districtes_censals_2021"},31:{name:"districtesCensals2022",key:"districtes_censals_2022"},32:{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},33:{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},34:{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},35:{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},36:{name:"municipis2022",key:"municipis_2022"},37:{name:"municipis2022Text",key:"municipis_2022_text"},38:{name:"municipisVigent",key:"municipis_vigent"},39:{name:"municipisVigentText",key:"municipis_vigent_text"},40:{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},41:{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},42:{name:"plaTerritorial2015",key:"pla_territorial_2015"},43:{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},44:{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},45:{name:"provinciesVigent",key:"provincies_vigent"},46:{name:"provinciesVigentText",key:"provincies_vigent_text"},47:{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},48:{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},49:{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},50:{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},51:{name:"seccionsCensals2015",key:"seccions_censals_2015"},52:{name:"seccionsCensals2016",key:"seccions_censals_2016"},53:{name:"seccionsCensals2017",key:"seccions_censals_2017"},54:{name:"seccionsCensals2018",key:"seccions_censals_2018"},55:{name:"seccionsCensals2019",key:"seccions_censals_2019"},56:{name:"seccionsCensals2020",key:"seccions_censals_2020"},57:{name:"seccionsCensals2021",key:"seccions_censals_2021"},58:{name:"seccionsCensals2022",key:"seccions_censals_2022"},59:{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},60:{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},61:{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},62:{name:"vegueriesVigent",key:"vegueries_vigent"},63:{name:"vegueriesVigentText",key:"vegueries_vigent_text"}},vectorLayers:{0:{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://tilemaps.icgc.cat/cdn/images/llegendaCobertesSol2018.jpg"}},wmsLayers:{0:{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},1:{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},2:{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},3:{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},4:{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},5:{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},6:{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}},fgbLayers:{0:{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},1:{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},2:{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},3:{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},4:{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},5:{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},6:{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},7:{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},8:{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},9:{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},10:{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},11:{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},12:{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},13:{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},14:{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},15:{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},16:{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},17:{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},18:{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},19:{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},20:{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},21:{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},22:{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},23:{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},24:{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},25:{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},26:{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},27:{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},28:{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},29:{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},30:{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},31:{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},32:{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},33:{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}}};class Mne{constructor(e){this.options=e}onAdd(e){return this._map=e,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?rn.logoIcgcOptions.logoUrlColor:rn.logoIcgcOptions.logoUrlWhite,this._img1.width=rn.logoIcgcOptions.logoWidth,this._img1.title=rn.logoIcgcOptions.logoTitle,this.link1=document.createElement("a"),this.link1.href=rn.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${rn.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?rn.logoGencatOptions.logoUrlColor:rn.logoGencatOptions.logoUrlWhite,this._img2.width=rn.logoGencatOptions.logoWidth,this._img2.title=rn.logoGencatOptions.logoTitle,this.link2=document.createElement("a"),this.link2.href=rn.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${rn.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}var Fg=yD.prototype,NC="WGS 84";function yD(i){i!==void 0&&(NC=i),this.setEllipsoid(NC)}Fg.convertLatLngToUtm=function(i,e,t){var r;if(this.status)return"No ecclipsoid data associated with unknown datum: "+NC;if(!Number.isInteger(t))return"Precision is not integer number.";i=parseFloat(i),e=parseFloat(e);var n=e,o=this.toRadians(i),l=this.toRadians(n);n>=8&&n<=13&&i>54.5&&i<58||i>=56&&i<64&&n>=3&&n<12?r=32:(r=(n+180)/6+1,i>=72&&i<84&&(n>=0&&n<9?r=31:n>=9&&n<21?r=33:n>=21&&n<33?r=35:n>=33&&n<42&&(r=37))),r=parseInt(r);var s=(r-1)*6-180+3,g=this.toRadians(s),v=this.getUtmLetterDesignator(i),T=this.eccSquared/(1-this.eccSquared),F=this.a/Math.sqrt(1-this.eccSquared*Math.sin(o)*Math.sin(o)),R=Math.tan(o)*Math.tan(o),U=T*Math.cos(o)*Math.cos(o),J=Math.cos(o)*(l-g),te=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*o-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*o)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*o)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*o)),Ae=parseFloat(.9996*F*(J+(1-R+U)*J*J*J/6+(5-18*R+R*R+72*U-58*T)*J*J*J*J*J/120)+5e5),he=parseFloat(.9996*(te+F*Math.tan(o)*(J*J/2+(5-R+9*U+4*U*U)*J*J*J*J/24+(61-58*R+R*R+600*U-330*T)*J*J*J*J*J*J/720)));return i<0&&(he+=1e7),he=_D(he,t),Ae=_D(Ae,t),{Easting:Ae,Northing:he,ZoneNumber:parseInt(r),ZoneLetter:v}},Fg.convertUtmToLatLng=function(i,e,t,r){var n=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),o=i-5e5,l=e,s=t,g=r;if(i===void 0)return"Please pass the UTMEasting!";if(e===void 0)return"Please pass the UTMNorthing!";if(t===void 0)return"Please pass the UTMZoneNumber!";if(r===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(g)!==-1||(l-=1e7);var v=(s-1)*6-180+3,T=this.eccSquared/(1-this.eccSquared),F=l/.9996,R=F/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),U=R+(3*n/2-27*n*n*n/32)*Math.sin(2*R)+(21*n*n/16-55*n*n*n*n/32)*Math.sin(4*R)+151*n*n*n/96*Math.sin(6*R);this.toDegrees(U);var J=this.a/Math.sqrt(1-this.eccSquared*Math.sin(U)*Math.sin(U)),te=Math.tan(U)*Math.tan(U),Ae=T*Math.cos(U)*Math.cos(U),he=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(U)*Math.sin(U),1.5),pe=o/(J*.9996),be=U-J*Math.tan(U)/he*(pe*pe/2-(5+3*te+10*Ae-4*Ae*Ae-9*T)*pe*pe*pe*pe/24+(61+90*te+298*Ae+45*te*te-252*T-3*Ae*Ae)*pe*pe*pe*pe*pe*pe/720);be=this.toDegrees(be);var Te=(pe-(1+2*te+Ae)*pe*pe*pe/6+(5-2*Ae+28*te-3*Ae*Ae+8*T+24*te*te)*pe*pe*pe*pe*pe/120)/Math.cos(U);return Te=v+this.toDegrees(Te),{lat:be,lng:Te}},Fg.getUtmLetterDesignator=function(i){return i=parseFloat(i),84>=i&&i>=72?"X":72>i&&i>=64?"W":64>i&&i>=56?"V":56>i&&i>=48?"U":48>i&&i>=40?"T":40>i&&i>=32?"S":32>i&&i>=24?"R":24>i&&i>=16?"Q":16>i&&i>=8?"P":8>i&&i>=0?"N":0>i&&i>=-8?"M":-8>i&&i>=-16?"L":-16>i&&i>=-24?"K":-24>i&&i>=-32?"J":-32>i&&i>=-40?"H":-40>i&&i>=-48?"G":-48>i&&i>=-56?"F":-56>i&&i>=-64?"E":-64>i&&i>=-72?"D":-72>i&&i>=-80?"C":"Z"},Fg.setEllipsoid=function(i){switch(i){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}},Fg.toDegrees=function(i){return i/Math.PI*180},Fg.toRadians=function(i){return i*Math.PI/180};function _D(i,e){var t=Math.pow(10,e);return Math.round(i*t)/t}var Pne=yD;const Fne=Um(Pne);class Dne{constructor(e){this.options=e||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(e){const t=new Fne;return this._map=e,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",r=>{const n=r.lngLat.lat,o=r.lngLat.lng;let l="",s="";const g=t.convertLatLngToUtm(n,o,2),v=n>0?"N":"S";this.options.utm&&(l=`ETRS89 UTM ${g.ZoneNumber}${v} X:<b> ${g.Easting}</b> Y:<b> ${g.Northing}</b> <br>`),this.options.lonlat&&(s=`WGS 84 Lon:<b> ${o.toFixed(5)}</b>  Lat:<b> ${n.toFixed(5)}</b>`);const T=`${l}${s}`;this._container.innerHTML=T}),this._container}_lookUTM31(e,t){var r=0,n=0,o=6,l=84;return e>=r&&e<=o&&t>=n&&t<=l}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const hv={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Dg={TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},so={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"}};let Rne=class{constructor(e){if(!e)e=rn.mapOptions;else for(const t in rn.mapOptions){let r=[rn.mapOptions.center[0],rn.mapOptions.center[1]];rn.mapOptions.center=r,e.hasOwnProperty(t)||(e[t]=rn.mapOptions[t])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1,this.map=new El.Map(e),this.map.options=e,this.map.addControl(new El.AttributionControl({compact:!0})),this.map.on("load",async()=>{const t=this.map.getStyle().name,r=this.map.options.style;if(window.document.querySelector(".maplibregl-compact-show")){var n=window.document.querySelector(".maplibregl-compact-show");n.classList.remove("maplibregl-compact-show")}this.map.addControl(new Mne({color:r.indexOf("orto")===-1}),"bottom-left"),this._dealOrto3dStyle(t)})}addGeocoderICGC(e){try{e===void 0&&(e="top-right");let t={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:El,showResultsWhileTyping:!0,minLength:2};const r={forwardGeocode:async o=>{const l=[];try{const s=rn.geocoder.peliasUrl1+encodeURIComponent(o.query)+rn.geocoder.peliasUrl2,v=await(await fetch(s)).json();for(const T of v.features){const F=T.geometry.coordinates,R={type:"Feature",geometry:{type:"Point",coordinates:F},place_name:T.properties.label,properties:T.properties,text:T.properties.label,place_type:["place"],center:F};l.push(R)}}catch(s){console.error(`Failed to forwardGeocode with error: ${s}`)}return{features:l}}};this.map.addControl(new Lne(r,t),e);let n=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");n[0].attributes[2].nodeValue="Cerca...",n[0].addEventListener("input",function(o){o.target.value.length>3})}catch(t){console.error(`Error adding ICGC geocoder: ${t.message}`)}}getStyle(){try{return this.map.getStyle()}catch(e){console.error(`Error getting style: ${e.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}addImage(e,t){try{return this.map.addImage(e,t)}catch(r){console.error(`Error getting addImage: ${r.message}`)}}getConfigStyles(){try{let e=[];for(const t of Dg)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in so.WMS)so.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in so.Orto)so.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in so.Vector)so.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in so.VectorAdmin)so.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}getConfigFGBAdminLayers(){try{let e=[];for(const t in so.FGBAdmin)so.FGBAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving FGBAdmin layers: ${e.message}`)}}async fetchData(e,t,r,n){try{if(e.includes(".fgb"))this.addFGBLayerICGC(e,r,null,n);else{const l=await(await fetch(e)).json();let s=t,g="";r==="labels"&&(g=this._firstSymbolLayer()),r==="lines"&&(g=this._firstLineLayer());let v=l.features[0].geometry.type;v.includes("ine")&&(n!==void 0?map.addLayer({id:s,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:n},g):map.addLayer({id:s,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},g)),v.includes("olygon")&&(n!==void 0?map.addLayer({id:s,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:n},g):map.addLayer({id:s,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},g)),v.includes("oint")&&(n!==void 0?map.addLayer({id:s,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:n},g):map.addLayer({id:s,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},g))}}catch(o){console.error(`Error fetching data: ${o.message}`)}}async fetchDataAndMenu(e,t,r,n,o){try{const l=document.getElementById("menu-group");let s="visible",g="";n==="labels"&&(g=this._firstSymbolLayer()),n==="lines"&&(g=this._firstLineLayer());let v;if(e.includes(".fgb")){let R=function(U){for(const J in so.FGBAdmin)if(so.FGBAdmin.hasOwnProperty(J)&&so.FGBAdmin[J]===U)return J;return null}(e);if(R===null)console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",R,"font-weight: bold; font-style: italic;");else{const U=await fetch(e),J={type:"FeatureCollection",features:[]};for await(const Ae of ZI(U.body))J.features.push(Ae);v=J;let te=R;if(this.map.addSource(te,{type:"geojson",data:J}),e.includes("text"))this.map.addLayer({id:R,type:"symbol",source:te,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:s,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},g);else{let Ae=R+"Text";this.map.addLayer({id:Ae,type:"symbol",source:te,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:s,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},g)}}}else v=await(await fetch(e)).json();if(r!=="all"){const F=document.createElement("div");F.id="titleDivMenu",F.textContent=t,l.appendChild(F);const R=document.createElement("div");R.id="titleDivMenuSub",R.textContent=`📂 ${r}`,l.appendChild(R)}let T=v.features[0].geometry.type;if(r==="all")T.includes("ine")&&(o!==void 0?map.addLayer({id:t,type:"line",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:o},g):map.addLayer({id:t,type:"line",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},g)),T.includes("olygon")&&(o!==void 0?map.addLayer({id:t,type:"fill",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:o},g):map.addLayer({id:t,type:"fill",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},g)),T.includes("oint")&&(o!==void 0?map.addLayer({id:t,type:"circle",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:o},g):map.addLayer({id:t,type:"circle",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},g)),console.log("itemSensefiltre",t),map.addMenuItem(t);else{let F=r;const R={};v.features.forEach(U=>{const J=U.properties[F],te=J+"-userFieldFilter-"+t;J!==null&&(R[te]||(T.includes("ine")&&(o!==void 0?map.addLayer({id:te,type:"line",source:{type:"geojson",data:v},layout:{visibility:"visible"},filter:["==",`${F}`,J],paint:o},g):map.addLayer({id:te,type:"line",source:{type:"geojson",data:v},layout:{visibility:"visible"},filter:["==",`${F}`,J],paint:{"line-color":"black","line-width":2,"line-opacity":1}},g)),T.includes("olygon")&&(o!==void 0?map.addLayer({id:te,type:"fill",source:{type:"geojson",data:v},layout:{visibility:"visible"},filter:["==",`${F}`,J],paint:o},g):map.addLayer({id:te,type:"fill",source:{type:"geojson",data:v},layout:{visibility:"visible"},filter:["==",`${F}`,J],paint:{"fill-color":"blue","fill-opacity":.6}},g)),T.includes("oint")&&(o!==void 0?map.addLayer({id:te,type:"circle",source:{type:"geojson",data:v},layout:{visibility:"visible"},filter:["==",`${F}`,J],paint:o},g):map.addLayer({id:te,type:"circle",source:{type:"geojson",data:v},layout:{visibility:"visible"},filter:["==",`${F}`,J],paint:{"circle-color":"red","circle-opacity":.85}},g)),R[te]=!0,map.addMenuItem(te)))})}}catch(l){console.error(`Error fetching data: ${l.message}`)}}on(e,t){try{this.map.on(e,t)}catch(r){console.error(`Error adding event listener: ${r.message}`)}}getSource(e){try{return this.map.getSource(e)}catch(t){console.error(`Error getting source: ${t.message}`)}}addSource(e,t){try{this.map.addSource(e,t)}catch(r){console.error(`Error adding source: ${r.message}`)}}setStyle(e,t){try{t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(r){console.error(`Error setting style: ${r.message}`)}}getLayer(e){try{return this.map.getLayer(e)}catch(t){console.error(`Error getting layer: ${t.message}`)}}setFilter(e,t,r){try{return this.map.setFilter(e,t,r)}catch(n){console.error(`Error setting filter: ${n.message}`)}}jumpTo(e){try{this.map.jumpTo(e)}catch(t){console.error(`Error jumping to ${e}: ${t.message}`)}}setLayoutProperty(e,t,r){try{this.map.setLayoutProperty(e,t,r)}catch(n){console.error(`Error setting layout property: ${n.message}`)}}setPaintProperty(e,t,r){try{this.map.setPaintProperty(e,t,r)}catch(n){console.error(`Error setting paint property: ${n.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(r){console.error(`Error adding control: ${r.message}`)}}getZoom(){try{return this.map.getZoom()}catch(e){console.error(`Error getting zoom level: ${e.message}`)}}addMouseCoordControl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new Dne(e),t)}catch(r){console.error(`Error adding mouse coordinate control: ${r.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new El.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new El.GeolocateControl(e),t)}catch(r){console.error(`Error adding geolocate control: ${r.message}`)}}addFullscreenControl(){try{this.map.addControl(new El.FullscreenControl)}catch(e){console.error(`Error adding fullscreen control: ${e.message}`)}}getBounds(){try{return this.map.getBounds()}catch(e){console.error(`Error getting bounds: ${e.message}`)}}getCenter(){try{return this.map.getCenter()}catch(e){console.error(`Error getting center: ${e.message}`)}}setTerrain(e){try{return this.map.setTerrain(e)}catch(t){console.error(`Error setting terrain: ${t.message}`)}}setLayerZoomRange(e,t,r){try{return this.map.setLayerZoomRange(e,t,r)}catch(n){console.error(`Error setting terrain: ${n.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(e){console.error(`Error getting canvas: ${e.message}`)}}setCenter(e){try{return this.map.setCenter(e)}catch(t){console.error(`Error setting center: ${t.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(r){console.error(`Error adding layer: ${r.message}`)}}addLayerGeoJSON(e){try{this.map.addSource(`${e.id}`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.layerType,source:`${e.id}`,layout:e.layout,paint:e.paint},this._firstSymbolLayer())}catch(t){console.error(`Error adding GeoJSON layer: ${t.message}`)}}addLayerWMS(e,t){try{let r="";t==="labels"&&(r=this._firstSymbolLayer()),t==="lines"&&(r=this._firstLineLayer()),this.map.addSource(`${e.id}`,{type:"raster",tiles:[e.tiles],tileSize:256},r),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:"raster",source:`${e.id}`,paint:{}},r)}catch(r){console.error(`Error adding WMS layer: ${r.message}`)}}removeControl(e){try{this.map.removeControl(e)}catch(t){console.error(`Error removing control: ${t.message}`)}}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}addLogo(e){try{const t=document.createElement("img");t.src=e.url,t.style.height="62px";const r=document.getElementById("logos"),n=document.createElement("a");n.id=e.id,n.href=e.href,n.target="_blank",n.style.position="relative",n.style.bottom="1px",n.appendChild(t),r.appendChild(n)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(e){try{const t=n=>{map.setStyle(n)},r=document.getElementById("basemap-group");for(const n of e)for(const o of Object.keys(rn.baseStyles)){const l=rn.baseStyles[o];if(n===l.url){const s=document.createElement("div");s.className="basemap-item",s.title=l.key,s.style.backgroundImage=`url('${l.image}')`,r.appendChild(s),s.addEventListener("click",()=>t(l.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=n=>{console.log("base",n),map.setStyle(n.url)},r=document.getElementById("basemap-group");e.forEach(n=>{const o=document.createElement("div");o.className="basemap-item",o.title=n.label,o.style.backgroundImage=`url('${n.image}')`,r.appendChild(o),o.addEventListener("click",()=>t(n))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t){try{let r;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",n=>{let o=this.map.queryRenderedFeatures(n.point);if(o&&o[0].source.includes(e)){let l=[n.lngLat.lng,n.lngLat.lat];if(t!==void 0&&t.length>0){if(t!==null){let s="";t.forEach(g=>{let v=o[0].properties[g];s=s+`<h4>${v}</h4>`}),r=s,map.addPopup(l,r)}}else{let s="";for(const g in o[0].properties)s+="<b>"+g+"</b>:"+o[0].properties[g]+"<br>";r=s,map.addPopup(l,r)}}})}catch(r){console.error(`Error adding feature query: ${r.message}`)}}addScaleControl(e,t){try{var r=new El.ScaleControl(e);this.map.addControl(r,t)}catch(n){console.error(`Error adding scale: ${n.message}`)}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:Mg.A4,PageOrientation:Gy.Landscape,Format:bd.PNG,DPI:RC[300],Crosshair:!0,PrintableArea:!0},t="top-right"),map.addControl(new zre(e),t)}catch(r){console.error(`Error adding export control: ${r.message}`)}}addPopup(e,t){try{new El.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch{}}addMarker(e){try{let t,r;return e.text===void 0?t=new El.Marker(e.options).setLngLat(e.coord).addTo(this.map):(r=new El.Popup({offset:e.textOffset}).setText(e.text),t=new El.Marker().setLngLat(e.coord).setPopup(r).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t){try{return new El.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch(r){return console.error(`Error adding popup: ${r.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new El.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{let t;if(e.includes("-userFieldFilter-")?t=e.split("-userFieldFilter-")[0]:t=e,e.length>0){const r=document.getElementById("menu-group"),n=document.createElement("input");n.type="checkbox",n.id=e,n.checked=!0,r.appendChild(n);const o=document.createElement("label");o.setAttribute("for",e),o.textContent=t,r.appendChild(o),n.addEventListener("change",l=>{this.map.setLayoutProperty(e,"visibility",l.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features;const r=document.getElementById("filter-group");this.map.addSource(`${e.id}`,{type:e.type,data:t}),t.features.forEach(n=>{const o=n.properties.icon,l=`poi-${o}`;if(!this.map.getLayer(l)){this.map.addLayer({id:l,type:"circle",source:`${e.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",o]},this._firstSymbolLayer());const s=document.createElement("input");s.type="checkbox",s.id=l,s.checked=!0,r.appendChild(s);const g=document.createElement("label");g.setAttribute("for",l),g.textContent=o,r.appendChild(g),s.addEventListener("change",v=>{this.map.setLayoutProperty(l,"visibility",v.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new El.NavigationControl(e),t)}catch(r){return console.error(`Error creating navigation control: ${r.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new El.NavigationControl(e),t)}catch(r){console.error(`Error adding navigation control: ${r.message}`)}}addAttributionControl(e){try{this.map.addControl(new El.AttributionControl(e.options),e.position)}catch(t){console.error(`Error adding attribution control: ${t.message}`)}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in Dg)if(Dg.hasOwnProperty(t)){const r=Dg[t];if(t===e)return r}return Dg[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}addImageLayerICGC(e,t){try{let n=function(l,s,g,v,T){const F=[s,g,v,T];for(const R of F)for(const[U,J]of Object.entries(R))if(J===l)return U;return null},r=null;r=n(e,so.Orto,so.VectorAdmin,so.WMS,so.Vector),r||console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let o={id:r,tiles:e};this.addLayerWMS(o,t)}catch(r){console.error(`Error adding ICGC image layer: ${r.message}`)}}async addVectorLayerICGC(e,t,r,n){try{let o="";t==="labels"&&(o=this._firstSymbolLayer()),t==="lines"&&(o=this._firstLineLayer());let l=e;if(l===null)console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",l,"font-weight: bold; font-style: italic;");else if(e.includes("https")){let s=function(F){for(const R in so.Vector)if(so.Vector.hasOwnProperty(R)&&so.Vector[R]===F)return R;return null},v=function(F){for(const R in rn.vectorLayers){const U=rn.vectorLayers[R];if(U.key===F)return U.legend}return null},g=s(e);this.map.addSource(g,{type:"vector",url:e}),g==="cobertes2018"&&map.addLayer({id:g,type:"fill",source:g,"source-layer":"cobertes",maxzoom:18,layout:{visibility:"visible"},paint:{"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]}},o);let T=v(g);r==="visible"&&map.addLegend(g,T)}else{let s="limitsSource";this.map.addSource(s,{type:"vector",url:rn.limitsUrl}),this.map.addLayer({id:l+"-fill",type:"fill",source:s,"source-layer":l,layout:{visibility:r},paint:{"fill-color":"#0000FF","fill-opacity":0}},o),this.map.addLayer({id:l+"-underline",type:"line",source:s,"source-layer":l,layout:{visibility:r},paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}},o),n?this.map.addLayer({id:l+"-line",type:"line",source:s,"source-layer":l,layout:{visibility:r},paint:n},o):this.map.addLayer({id:l+"-line",type:"line",source:s,layout:{visibility:r},"source-layer":l,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}},o)}}catch(o){console.error(`Error adding ICGC vector layer: ${o.message}`)}}async addFGBLayerICGC(e,t,r){try{let l=function(g){for(const v in so.FGBAdmin)if(so.FGBAdmin.hasOwnProperty(v)&&so.FGBAdmin[v]===g)return v;return null},n="visible",o="";t==="labels"&&(o=this._firstSymbolLayer()),t==="lines"&&(o=this._firstLineLayer());let s=l(e);if(s===null)console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",s,"font-weight: bold; font-style: italic;");else{const g=await fetch(e),v={type:"FeatureCollection",features:[]};for await(const F of ZI(g.body))v.features.push(F);let T=s;if(this.map.addSource(T,{type:"geojson",data:v}),e.includes("text"))this.map.addLayer({id:s,type:"symbol",source:T,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},o);else{this.map.addLayer({id:s+"-fill",type:"fill",source:T,paint:{"fill-color":"#0000FF","fill-opacity":0}},o),this.map.addLayer({id:s+"-underline",type:"line",source:T,paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}},o),r?this.map.addLayer({id:s+"-line",type:"line",source:T,paint:r},o):this.map.addLayer({id:s+"-line",type:"line",source:T,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}},o);let F=s+"Text";this.map.addLayer({id:F,type:"symbol",source:T,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},o)}}}catch(n){console.error(`Error adding ICGC FGB layer: ${n.message}`)}}addTerrainICGC(e,t){try{let r;for(const o in hv)if(hv.hasOwnProperty(o)){const l=hv[o];l===e&&(r=l)}let n=r;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(l=>{l.source==="terrainICGC"&&this.removeLayer(l.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(e.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[n],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[n],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t===void 0&&(t="top-right"),this.map.addControl(new q8({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(r){console.error(`Error adding 3D terrain: ${r.message}`)}}addLegend(e,t){try{(function(){var n=document.createElement("link");n.rel="stylesheet",n.href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css";var o=document.createElement("script");o.src="https://code.jquery.com/jquery-3.6.0.min.js";var l=document.createElement("script");l.src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js";var s=document.head||document.getElementsByTagName("head")[0];s.appendChild(n),o.onload=function(){s.appendChild(l),$(document).ready(function(){const g=document.createElement("div");g.id="legendContainer",g.innerHTML=`<img src=${t} alt="Legend" >`,g.style.display="none",document.body.appendChild(g),l.onload=function(){$(function(){$("#legendContainer").draggable(),$("#legendContainer").resizable()})},s.appendChild(o);const v=document.createElement("div");v.id="toggleLegend",v.innerHTML="<span>&#x2630;</span>",document.body.appendChild(v),v.addEventListener("click",function(){g.style.display==="none"?g.style.display="block":g.style.display="none"})})},s.appendChild(o)})()}catch(r){console.error(`Error adding legend: ${r.message}`)}}async _raiseText3DStyle(){try{const e=await this.map.loadImage(rn.map3dOptions.imageIcon);this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===rn.map3dOptions.sourceLayerFilterId&&t.minzoom>=rn.map3dOptions.minZoomFilter&&e){const r=t.id;this.map.setLayoutProperty(r,"icon-image","stick"),this.map.setLayoutProperty(r,"text-offset",[0,-9]),this.map.setLayoutProperty(r,"symbol-placement","point"),this.map.setLayoutProperty(r,"symbol-avoid-edges",!1),this.map.setLayoutProperty(r,"text-allow-overlap",!0),this.map.setLayoutProperty(r,"text-ignore-placement",!1),this.map.setLayoutProperty(r,"text-pitch-alignment","auto"),this.map.setLayoutProperty(r,"text-rotation-alignment","auto"),this.map.setLayoutProperty(r,"text-justify","center"),this.map.setLayoutProperty(r,"text-anchor","bottom"),this.map.setLayoutProperty(r,"icon-anchor","bottom"),this.map.setPaintProperty(r,"text-color","#ffffff"),this.map.setPaintProperty(r,"text-halo-color","#000000"),this.map.setPaintProperty(r,"text-halo-width",2)}})}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealOrto3dStyle(e){try{if(e=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new zL({intensity:4}),r=new H2({ambientLight:t});this.map.setTerrain({source:rn.map3dOptions.terrainSource,exaggeration:rn.map3dOptions.exaggeration});const n=this._createCitiesMapboxLayer();this.map.getLayer(rn.map3dOptions.layerId3d)||(this.map.addLayer(n,rn.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(rn.map3dOptions.layerId3d,rn.map3dOptions.minZoomRange,rn.map3dOptions.maxZoomRange),n.deck.setProps({effects:[r]}),this._raiseText3DStyle())}else this.map.getLayer(rn.map3dOptions.layerId3d)&&(this.map.removeLayer(rn.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_firstSymbolLayer(){try{const e=this.map.getStyle().layers;let t;for(let r=0;r<e.length;r++)if(e[r].type==="symbol"){t=e[r].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_firstLineLayer(){try{const e=this.map.getStyle().layers;let t;for(let r=0;r<e.length;r++)if(e[r].type==="line"){t=e[r].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_createCitiesMapboxLayer(){try{return new wZ({id:rn.map3dOptions.layerId3d,type:dC,data:rn.map3dOptions.urlTilesetCities,loader:AC,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:rn.map3dOptions.spaceErrorFactor}},onTilesetLoad:t=>{t.options.maximumScreenSpaceError=rn.map3dOptions.spaceErrorFactor},onTileLoad:t=>{t.content.cartographicOrigin.z-=rn.map3dOptions.zfactor},operation:"terrain+draw"})}catch(e){return console.error(`Error adding MapboxLayer: ${e.message}`),null}}};var vD={exports:{}};function kne(i,e){var t=i.getCenter(),r=i.getZoom(),n=i.getBearing(),o=i.getPitch();e.forEach(function(l){l.jumpTo({center:t,zoom:r,bearing:n,pitch:o})})}function One(){var i,e=arguments.length;if(e===1)i=arguments[0];else{i=[];for(var t=0;t<e;t++)i.push(arguments[t])}var r=[];i.forEach(function(s,g){r[g]=l.bind(null,s,i.filter(function(v,T){return T!==g}))});function n(){i.forEach(function(s,g){s.on("move",r[g])})}function o(){i.forEach(function(s,g){s.off("move",r[g])})}function l(s,g){o(),kne(s,g),n()}return n(),function(){o(),r=[],i=[]}}var Une=One;(function(i){var e=Une,t=fD.EventEmitter;function r(n,o,l,s){if(this.options=s||{},this._mapA=n,this._mapB=o,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new t,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof l=="string"&&document.body.querySelectorAll){var g=document.body.querySelectorAll(l)[0];if(!g)throw new Error("Cannot find element with specified container selector.");g.appendChild(this._controlContainer)}else if(l instanceof Element&&l.appendChild)l.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=o.getContainer().getBoundingClientRect();var v=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(v),this._clearSync=e(n,o),this._onResize=(function(){this._bounds=o.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),o.on("resize",this._onResize),this.options&&this.options.mousemove&&(n.getContainer().addEventListener("mousemove",this._onMove),o.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}r.prototype={_setPointerEvents:function(n){this._controlContainer.style.pointerEvents=n,this._swiper.style.pointerEvents=n},_onDown:function(n){n.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(n){n=Math.min(n,this._horizontal?this._bounds.height:this._bounds.width);var o=this._horizontal?"translate(0, "+n+"px)":"translate("+n+"px, 0)";this._controlContainer.style.transform=o,this._controlContainer.style.WebkitTransform=o;var l=this._horizontal?"rect(0, 999em, "+n+"px, 0)":"rect(0, "+n+"px, "+this._bounds.height+"px, 0)",s=this._horizontal?"rect("+n+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+n+"px)";this._mapA.getContainer().style.clip=l,this._mapB.getContainer().style.clip=s,this.currentPosition=n},_onMove:function(n){this.options&&this.options.mousemove&&this._setPointerEvents(n.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(n)):this._setPosition(this._getX(n))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(n){n=n.touches?n.touches[0]:n;var o=n.clientX-this._bounds.left;return o<0&&(o=0),o>this._bounds.width&&(o=this._bounds.width),o},_getY:function(n){n=n.touches?n.touches[0]:n;var o=n.clientY-this._bounds.top;return o<0&&(o=0),o>this._bounds.height&&(o=this._bounds.height),o},setSlider:function(n){this._setPosition(n)},on:function(n,o){return this._ev.on(n,o),this},fire:function(n,o){return this._ev.emit(n,o),this},off:function(n,o){return this._ev.removeListener(n,o),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var n=this._mapA.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove));var o=this._mapB.getContainer();o&&(o.style.clip=null,o.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=r:i.exports=r})(vD);var Nne=vD.exports;const zne=Um(Nne);class Qne{constructor(e,t,r,n){this.mapCompare=new zne(e.map,t.map,r,{})}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var zC=function(i,e){return zC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},zC(i,e)};function Ah(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");zC(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var QC=function(){return QC=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i},QC.apply(this,arguments)};function hc(i,e,t,r){function n(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function s(T){try{v(r.next(T))}catch(F){l(F)}}function g(T){try{v(r.throw(T))}catch(F){l(F)}}function v(T){T.done?o(T.value):n(T.value).then(s,g)}v((r=r.apply(i,e||[])).next())})}function kl(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(v){return function(T){return g([v,T])}}function g(v){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,n&&(o=v[0]&2?n.return:v[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,v[1])).done)return o;switch(n=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,n=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=e.call(i,t)}catch(T){v=[6,T],n=0}finally{r=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function Av(i,e,t){if(t||arguments.length===2)for(var r=0,n=e.length,o;r<n;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return i.concat(o||e)}for(var FA=function(){function i(e,t,r,n){this.left=e,this.top=t,this.width=r,this.height=n}return i.prototype.add=function(e,t,r,n){return new i(this.left+e,this.top+t,this.width+r,this.height+n)},i.fromClientRect=function(e,t){return new i(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)},i.fromDOMRectList=function(e,t){var r=Array.from(t).find(function(n){return n.width!==0});return r?new i(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height):i.EMPTY},i.EMPTY=new i(0,0,0,0),i}(),dv=function(i,e){return FA.fromClientRect(i,e.getBoundingClientRect())},Vne=function(i){var e=i.body,t=i.documentElement;if(!e||!t)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),n=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new FA(0,0,r,n)},fv=function(i){for(var e=[],t=0,r=i.length;t<r;){var n=i.charCodeAt(t++);if(n>=55296&&n<=56319&&t<r){var o=i.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},Go=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,i);var t=i.length;if(!t)return"";for(var r=[],n=-1,o="";++n<t;){var l=i[n];l<=65535?r.push(l):(l-=65536,r.push((l>>10)+55296,l%1024+56320)),(n+1===t||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},bD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hne=typeof Uint8Array>"u"?[]:new Uint8Array(256),pv=0;pv<bD.length;pv++)Hne[bD.charCodeAt(pv)]=pv;for(var xD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jy=typeof Uint8Array>"u"?[]:new Uint8Array(256),gv=0;gv<xD.length;gv++)jy[xD.charCodeAt(gv)]=gv;for(var Gne=function(i){var e=i.length*.75,t=i.length,r,n=0,o,l,s,g;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);var v=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),T=Array.isArray(v)?v:new Uint8Array(v);for(r=0;r<t;r+=4)o=jy[i.charCodeAt(r)],l=jy[i.charCodeAt(r+1)],s=jy[i.charCodeAt(r+2)],g=jy[i.charCodeAt(r+3)],T[n++]=o<<2|l>>4,T[n++]=(l&15)<<4|s>>2,T[n++]=(s&3)<<6|g&63;return v},jne=function(i){for(var e=i.length,t=[],r=0;r<e;r+=2)t.push(i[r+1]<<8|i[r]);return t},qne=function(i){for(var e=i.length,t=[],r=0;r<e;r+=4)t.push(i[r+3]<<24|i[r+2]<<16|i[r+1]<<8|i[r]);return t},Ff=5,VC=11,HC=2,$ne=VC-Ff,wD=65536>>Ff,Kne=1<<Ff,GC=Kne-1,Wne=1024>>Ff,Zne=wD+Wne,Xne=Zne,Jne=32,Yne=Xne+Jne,ese=65536>>VC,tse=1<<$ne,ise=tse-1,BD=function(i,e,t){return i.slice?i.slice(e,t):new Uint16Array(Array.prototype.slice.call(i,e,t))},rse=function(i,e,t){return i.slice?i.slice(e,t):new Uint32Array(Array.prototype.slice.call(i,e,t))},nse=function(i,e){var t=Gne(i),r=Array.isArray(t)?qne(t):new Uint32Array(t),n=Array.isArray(t)?jne(t):new Uint16Array(t),o=24,l=BD(n,o/2,r[4]/2),s=r[5]===2?BD(n,(o+r[4])/2):rse(r,Math.ceil((o+r[4])/4));return new sse(r[0],r[1],r[2],r[3],l,s)},sse=function(){function i(e,t,r,n,o,l){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=o,this.data=l}return i.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>Ff],t=(t<<HC)+(e&GC),this.data[t];if(e<=65535)return t=this.index[wD+(e-55296>>Ff)],t=(t<<HC)+(e&GC),this.data[t];if(e<this.highStart)return t=Yne-ese+(e>>VC),t=this.index[t],t+=e>>Ff&ise,t=this.index[t],t=(t<<HC)+(e&GC),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},i}(),CD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ose=typeof Uint8Array>"u"?[]:new Uint8Array(256),mv=0;mv<CD.length;mv++)ose[CD.charCodeAt(mv)]=mv;var ase="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",ED=50,lse=1,SD=2,TD=3,cse=4,use=5,ID=7,LD=8,MD=9,xd=10,jC=11,PD=12,qC=13,hse=14,qy=15,$C=16,yv=17,$y=18,Ase=19,FD=20,KC=21,Ky=22,WC=23,Rg=24,lu=25,Wy=26,Zy=27,kg=28,dse=29,Og=30,fse=31,_v=32,vv=33,ZC=34,XC=35,JC=36,Xy=37,YC=38,bv=39,xv=40,eE=41,DD=42,pse=43,gse=[9001,65288],RD="!",Ac="×",wv="÷",tE=nse(ase),DA=[Og,JC],iE=[lse,SD,TD,use],kD=[xd,LD],OD=[Zy,Wy],mse=iE.concat(kD),UD=[YC,bv,xv,ZC,XC],yse=[qy,qC],_se=function(i,e){e===void 0&&(e="strict");var t=[],r=[],n=[];return i.forEach(function(o,l){var s=tE.get(o);if(s>ED?(n.push(!0),s-=ED):n.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(o)!==-1)return r.push(l),t.push($C);if(s===cse||s===jC){if(l===0)return r.push(l),t.push(Og);var g=t[l-1];return mse.indexOf(g)===-1?(r.push(r[l-1]),t.push(g)):(r.push(l),t.push(Og))}if(r.push(l),s===fse)return t.push(e==="strict"?KC:Xy);if(s===DD||s===dse)return t.push(Og);if(s===pse)return o>=131072&&o<=196605||o>=196608&&o<=262141?t.push(Xy):t.push(Og);t.push(s)}),[r,t,n]},rE=function(i,e,t,r){var n=r[t];if(Array.isArray(i)?i.indexOf(n)!==-1:i===n)for(var o=t;o<=r.length;){o++;var l=r[o];if(l===e)return!0;if(l!==xd)break}if(n===xd)for(var o=t;o>0;){o--;var s=r[o];if(Array.isArray(i)?i.indexOf(s)!==-1:i===s)for(var g=t;g<=r.length;){g++;var l=r[g];if(l===e)return!0;if(l!==xd)break}if(s!==xd)break}return!1},ND=function(i,e){for(var t=i;t>=0;){var r=e[t];if(r===xd)t--;else return r}return 0},vse=function(i,e,t,r,n){if(t[r]===0)return Ac;var o=r-1;if(Array.isArray(n)&&n[o]===!0)return Ac;var l=o-1,s=o+1,g=e[o],v=l>=0?e[l]:0,T=e[s];if(g===SD&&T===TD)return Ac;if(iE.indexOf(g)!==-1)return RD;if(iE.indexOf(T)!==-1||kD.indexOf(T)!==-1)return Ac;if(ND(o,e)===LD)return wv;if(tE.get(i[o])===jC||(g===_v||g===vv)&&tE.get(i[s])===jC||g===ID||T===ID||g===MD||[xd,qC,qy].indexOf(g)===-1&&T===MD||[yv,$y,Ase,Rg,kg].indexOf(T)!==-1||ND(o,e)===Ky||rE(WC,Ky,o,e)||rE([yv,$y],KC,o,e)||rE(PD,PD,o,e))return Ac;if(g===xd)return wv;if(g===WC||T===WC)return Ac;if(T===$C||g===$C)return wv;if([qC,qy,KC].indexOf(T)!==-1||g===hse||v===JC&&yse.indexOf(g)!==-1||g===kg&&T===JC||T===FD||DA.indexOf(T)!==-1&&g===lu||DA.indexOf(g)!==-1&&T===lu||g===Zy&&[Xy,_v,vv].indexOf(T)!==-1||[Xy,_v,vv].indexOf(g)!==-1&&T===Wy||DA.indexOf(g)!==-1&&OD.indexOf(T)!==-1||OD.indexOf(g)!==-1&&DA.indexOf(T)!==-1||[Zy,Wy].indexOf(g)!==-1&&(T===lu||[Ky,qy].indexOf(T)!==-1&&e[s+1]===lu)||[Ky,qy].indexOf(g)!==-1&&T===lu||g===lu&&[lu,kg,Rg].indexOf(T)!==-1)return Ac;if([lu,kg,Rg,yv,$y].indexOf(T)!==-1)for(var F=o;F>=0;){var R=e[F];if(R===lu)return Ac;if([kg,Rg].indexOf(R)!==-1)F--;else break}if([Zy,Wy].indexOf(T)!==-1)for(var F=[yv,$y].indexOf(g)!==-1?l:o;F>=0;){var R=e[F];if(R===lu)return Ac;if([kg,Rg].indexOf(R)!==-1)F--;else break}if(YC===g&&[YC,bv,ZC,XC].indexOf(T)!==-1||[bv,ZC].indexOf(g)!==-1&&[bv,xv].indexOf(T)!==-1||[xv,XC].indexOf(g)!==-1&&T===xv||UD.indexOf(g)!==-1&&[FD,Wy].indexOf(T)!==-1||UD.indexOf(T)!==-1&&g===Zy||DA.indexOf(g)!==-1&&DA.indexOf(T)!==-1||g===Rg&&DA.indexOf(T)!==-1||DA.concat(lu).indexOf(g)!==-1&&T===Ky&&gse.indexOf(i[s])===-1||DA.concat(lu).indexOf(T)!==-1&&g===$y)return Ac;if(g===eE&&T===eE){for(var U=t[o],J=1;U>0&&(U--,e[U]===eE);)J++;if(J%2!==0)return Ac}return g===_v&&T===vv?Ac:wv},bse=function(i,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var t=_se(i,e.lineBreak),r=t[0],n=t[1],o=t[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(n=n.map(function(s){return[lu,Og,DD].indexOf(s)!==-1?Xy:s}));var l=e.wordBreak==="keep-all"?o.map(function(s,g){return s&&i[g]>=19968&&i[g]<=40959}):void 0;return[r,n,l]},xse=function(){function i(e,t,r,n){this.codePoints=e,this.required=t===RD,this.start=r,this.end=n}return i.prototype.slice=function(){return Go.apply(void 0,this.codePoints.slice(this.start,this.end))},i}(),wse=function(i,e){var t=fv(i),r=bse(t,e),n=r[0],o=r[1],l=r[2],s=t.length,g=0,v=0;return{next:function(){if(v>=s)return{done:!0,value:null};for(var T=Ac;v<s&&(T=vse(t,o,n,++v,l))===Ac;);if(T!==Ac||v===s){var F=new xse(t,T,g,v);return g=v,{value:F,done:!1}}return{done:!0,value:null}}}},Bse=1,Cse=2,Jy=4,zD=8,Bv=10,QD=47,Yy=92,Ese=9,Sse=32,Cv=34,e0=61,Tse=35,Ise=36,Lse=37,Ev=39,Sv=40,t0=41,Mse=95,kc=45,Pse=33,Fse=60,Dse=62,Rse=64,kse=91,Ose=93,Use=61,Nse=123,Tv=63,zse=125,VD=124,Qse=126,Vse=128,HD=65533,nE=42,Df=43,Hse=44,Gse=58,jse=59,i0=46,qse=0,$se=8,Kse=11,Wse=14,Zse=31,Xse=127,Zh=-1,GD=48,jD=97,qD=101,Jse=102,Yse=117,eoe=122,$D=65,KD=69,WD=70,toe=85,ioe=90,dc=function(i){return i>=GD&&i<=57},roe=function(i){return i>=55296&&i<=57343},Ug=function(i){return dc(i)||i>=$D&&i<=WD||i>=jD&&i<=Jse},noe=function(i){return i>=jD&&i<=eoe},soe=function(i){return i>=$D&&i<=ioe},ooe=function(i){return noe(i)||soe(i)},aoe=function(i){return i>=Vse},Iv=function(i){return i===Bv||i===Ese||i===Sse},Lv=function(i){return ooe(i)||aoe(i)||i===Mse},ZD=function(i){return Lv(i)||dc(i)||i===kc},loe=function(i){return i>=qse&&i<=$se||i===Kse||i>=Wse&&i<=Zse||i===Xse},wd=function(i,e){return i!==Yy?!1:e!==Bv},Mv=function(i,e,t){return i===kc?Lv(e)||wd(e,t):Lv(i)?!0:!!(i===Yy&&wd(i,e))},sE=function(i,e,t){return i===Df||i===kc?dc(e)?!0:e===i0&&dc(t):dc(i===i0?e:i)},coe=function(i){var e=0,t=1;(i[e]===Df||i[e]===kc)&&(i[e]===kc&&(t=-1),e++);for(var r=[];dc(i[e]);)r.push(i[e++]);var n=r.length?parseInt(Go.apply(void 0,r),10):0;i[e]===i0&&e++;for(var o=[];dc(i[e]);)o.push(i[e++]);var l=o.length,s=l?parseInt(Go.apply(void 0,o),10):0;(i[e]===KD||i[e]===qD)&&e++;var g=1;(i[e]===Df||i[e]===kc)&&(i[e]===kc&&(g=-1),e++);for(var v=[];dc(i[e]);)v.push(i[e++]);var T=v.length?parseInt(Go.apply(void 0,v),10):0;return t*(n+s*Math.pow(10,-l))*Math.pow(10,g*T)},uoe={type:2},hoe={type:3},Aoe={type:4},doe={type:13},foe={type:8},poe={type:21},goe={type:9},moe={type:10},yoe={type:11},_oe={type:12},voe={type:14},Pv={type:23},boe={type:1},xoe={type:25},woe={type:24},Boe={type:26},Coe={type:27},Eoe={type:28},Soe={type:29},Toe={type:31},oE={type:32},XD=function(){function i(){this._value=[]}return i.prototype.write=function(e){this._value=this._value.concat(fv(e))},i.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==oE;)e.push(t),t=this.consumeToken();return e},i.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Cv:return this.consumeStringToken(Cv);case Tse:var t=this.peekCodePoint(0),r=this.peekCodePoint(1),n=this.peekCodePoint(2);if(ZD(t)||wd(r,n)){var o=Mv(t,r,n)?Cse:Bse,l=this.consumeName();return{type:5,value:l,flags:o}}break;case Ise:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),doe;break;case Ev:return this.consumeStringToken(Ev);case Sv:return uoe;case t0:return hoe;case nE:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),voe;break;case Df:if(sE(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Hse:return Aoe;case kc:var s=e,g=this.peekCodePoint(0),v=this.peekCodePoint(1);if(sE(s,g,v))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(Mv(s,g,v))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(g===kc&&v===Dse)return this.consumeCodePoint(),this.consumeCodePoint(),woe;break;case i0:if(sE(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case QD:if(this.peekCodePoint(0)===nE)for(this.consumeCodePoint();;){var T=this.consumeCodePoint();if(T===nE&&(T=this.consumeCodePoint(),T===QD))return this.consumeToken();if(T===Zh)return this.consumeToken()}break;case Gse:return Boe;case jse:return Coe;case Fse:if(this.peekCodePoint(0)===Pse&&this.peekCodePoint(1)===kc&&this.peekCodePoint(2)===kc)return this.consumeCodePoint(),this.consumeCodePoint(),xoe;break;case Rse:var F=this.peekCodePoint(0),R=this.peekCodePoint(1),U=this.peekCodePoint(2);if(Mv(F,R,U)){var l=this.consumeName();return{type:7,value:l}}break;case kse:return Eoe;case Yy:if(wd(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case Ose:return Soe;case Use:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),foe;break;case Nse:return yoe;case zse:return _oe;case Yse:case toe:var J=this.peekCodePoint(0),te=this.peekCodePoint(1);return J===Df&&(Ug(te)||te===Tv)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case VD:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),goe;if(this.peekCodePoint(0)===VD)return this.consumeCodePoint(),poe;break;case Qse:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),moe;break;case Zh:return oE}return Iv(e)?(this.consumeWhiteSpace(),Toe):dc(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):Lv(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:Go(e)}},i.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},i.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},i.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},i.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();Ug(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var r=!1;t===Tv&&e.length<6;)e.push(t),t=this.consumeCodePoint(),r=!0;if(r){var n=parseInt(Go.apply(void 0,e.map(function(g){return g===Tv?GD:g})),16),o=parseInt(Go.apply(void 0,e.map(function(g){return g===Tv?WD:g})),16);return{type:30,start:n,end:o}}var l=parseInt(Go.apply(void 0,e),16);if(this.peekCodePoint(0)===kc&&Ug(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var s=[];Ug(t)&&s.length<6;)s.push(t),t=this.consumeCodePoint();var o=parseInt(Go.apply(void 0,s),16);return{type:30,start:l,end:o}}else return{type:30,start:l,end:l}},i.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===Sv?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Sv?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},i.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Zh)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===Ev||t===Cv){var r=this.consumeStringToken(this.consumeCodePoint());return r.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Zh||this.peekCodePoint(0)===t0)?(this.consumeCodePoint(),{type:22,value:r.value}):(this.consumeBadUrlRemnants(),Pv)}for(;;){var n=this.consumeCodePoint();if(n===Zh||n===t0)return{type:22,value:Go.apply(void 0,e)};if(Iv(n))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Zh||this.peekCodePoint(0)===t0?(this.consumeCodePoint(),{type:22,value:Go.apply(void 0,e)}):(this.consumeBadUrlRemnants(),Pv);if(n===Cv||n===Ev||n===Sv||loe(n))return this.consumeBadUrlRemnants(),Pv;if(n===Yy)if(wd(n,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),Pv;else e.push(n)}},i.prototype.consumeWhiteSpace=function(){for(;Iv(this.peekCodePoint(0));)this.consumeCodePoint()},i.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===t0||e===Zh)return;wd(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},i.prototype.consumeStringSlice=function(e){for(var t=5e4,r="";e>0;){var n=Math.min(t,e);r+=Go.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),r},i.prototype.consumeStringToken=function(e){var t="",r=0;do{var n=this._value[r];if(n===Zh||n===void 0||n===e)return t+=this.consumeStringSlice(r),{type:0,value:t};if(n===Bv)return this._value.splice(0,r),boe;if(n===Yy){var o=this._value[r+1];o!==Zh&&o!==void 0&&(o===Bv?(t+=this.consumeStringSlice(r),r=-1,this._value.shift()):wd(n,o)&&(t+=this.consumeStringSlice(r),t+=Go(this.consumeEscapedCodePoint()),r=-1))}r++}while(!0)},i.prototype.consumeNumber=function(){var e=[],t=Jy,r=this.peekCodePoint(0);for((r===Df||r===kc)&&e.push(this.consumeCodePoint());dc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0);var n=this.peekCodePoint(1);if(r===i0&&dc(n))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=zD;dc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0),n=this.peekCodePoint(1);var o=this.peekCodePoint(2);if((r===KD||r===qD)&&((n===Df||n===kc)&&dc(o)||dc(n)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=zD;dc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[coe(e),t]},i.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],r=e[1],n=this.peekCodePoint(0),o=this.peekCodePoint(1),l=this.peekCodePoint(2);if(Mv(n,o,l)){var s=this.consumeName();return{type:15,number:t,flags:r,unit:s}}return n===Lse?(this.consumeCodePoint(),{type:16,number:t,flags:r}):{type:17,number:t,flags:r}},i.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Ug(e)){for(var t=Go(e);Ug(this.peekCodePoint(0))&&t.length<6;)t+=Go(this.consumeCodePoint());Iv(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return r===0||roe(r)||r>1114111?HD:r}return e===Zh?HD:e},i.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(ZD(t))e+=Go(t);else if(wd(t,this.peekCodePoint(0)))e+=Go(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(t),e}},i}(),JD=function(){function i(e){this._tokens=e}return i.create=function(e){var t=new XD;return t.write(e),new i(t.read())},i.parseValue=function(e){return i.create(e).parseComponentValue()},i.parseValues=function(e){return i.create(e).parseComponentValues()},i.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},i.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t),e.push()}},i.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},i.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},r=this.consumeToken();;){if(r.type===32||Loe(r,e))return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue()),r=this.consumeToken()}},i.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var r=this.consumeToken();if(r.type===32||r.type===3)return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue())}},i.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?oE:e},i.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},i}(),r0=function(i){return i.type===15},Ng=function(i){return i.type===17},ws=function(i){return i.type===20},Ioe=function(i){return i.type===0},aE=function(i,e){return ws(i)&&i.value===e},YD=function(i){return i.type!==31},zg=function(i){return i.type!==31&&i.type!==4},Xh=function(i){var e=[],t=[];return i.forEach(function(r){if(r.type===4){if(t.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(t),t=[];return}r.type!==31&&t.push(r)}),t.length&&e.push(t),e},Loe=function(i,e){return e===11&&i.type===12||e===28&&i.type===29?!0:e===2&&i.type===3},Bd=function(i){return i.type===17||i.type===15},oa=function(i){return i.type===16||Bd(i)},eR=function(i){return i.length>1?[i[0],i[1]]:[i[0]]},ol={type:17,number:0,flags:Jy},lE={type:16,number:50,flags:Jy},Cd={type:16,number:100,flags:Jy},n0=function(i,e,t){var r=i[0],n=i[1];return[Vs(r,e),Vs(typeof n<"u"?n:r,t)]},Vs=function(i,e){if(i.type===16)return i.number/100*e;if(r0(i))switch(i.unit){case"rem":case"em":return 16*i.number;case"px":default:return i.number}return i.number},tR="deg",iR="grad",rR="rad",nR="turn",Fv={name:"angle",parse:function(i,e){if(e.type===15)switch(e.unit){case tR:return Math.PI*e.number/180;case iR:return Math.PI/200*e.number;case rR:return e.number;case nR:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},sR=function(i){return i.type===15&&(i.unit===tR||i.unit===iR||i.unit===rR||i.unit===nR)},oR=function(i){var e=i.filter(ws).map(function(t){return t.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ol,ol];case"to top":case"bottom":return Pu(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ol,Cd];case"to right":case"left":return Pu(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Cd,Cd];case"to bottom":case"top":return Pu(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Cd,ol];case"to left":case"right":return Pu(270)}return 0},Pu=function(i){return Math.PI*i/180},Ed={name:"color",parse:function(i,e){if(e.type===18){var t=Moe[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(i,e.values)}if(e.type===5){if(e.value.length===3){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);return Td(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(e.value.length===4){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3),l=e.value.substring(3,4);return Td(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(l+l,16)/255)}if(e.value.length===6){var r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6);return Td(parseInt(r,16),parseInt(n,16),parseInt(o,16),1)}if(e.value.length===8){var r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),l=e.value.substring(6,8);return Td(parseInt(r,16),parseInt(n,16),parseInt(o,16),parseInt(l,16)/255)}}if(e.type===20){var s=RA[e.value.toUpperCase()];if(typeof s<"u")return s}return RA.TRANSPARENT}},Sd=function(i){return(255&i)===0},Ga=function(i){var e=255&i,t=255&i>>8,r=255&i>>16,n=255&i>>24;return e<255?"rgba("+n+","+r+","+t+","+e/255+")":"rgb("+n+","+r+","+t+")"},Td=function(i,e,t,r){return(i<<24|e<<16|t<<8|Math.round(r*255)<<0)>>>0},aR=function(i,e){if(i.type===17)return i.number;if(i.type===16){var t=e===3?1:255;return e===3?i.number/100*t:Math.round(i.number/100*t)}return 0},lR=function(i,e){var t=e.filter(zg);if(t.length===3){var r=t.map(aR),n=r[0],o=r[1],l=r[2];return Td(n,o,l,1)}if(t.length===4){var s=t.map(aR),n=s[0],o=s[1],l=s[2],g=s[3];return Td(n,o,l,g)}return 0};function cE(i,e,t){return t<0&&(t+=1),t>=1&&(t-=1),t<1/6?(e-i)*t*6+i:t<1/2?e:t<2/3?(e-i)*6*(2/3-t)+i:i}var cR=function(i,e){var t=e.filter(zg),r=t[0],n=t[1],o=t[2],l=t[3],s=(r.type===17?Pu(r.number):Fv.parse(i,r))/(Math.PI*2),g=oa(n)?n.number/100:0,v=oa(o)?o.number/100:0,T=typeof l<"u"&&oa(l)?Vs(l,1):1;if(g===0)return Td(v*255,v*255,v*255,1);var F=v<=.5?v*(g+1):v+g-v*g,R=v*2-F,U=cE(R,F,s+1/3),J=cE(R,F,s),te=cE(R,F,s-1/3);return Td(U*255,J*255,te*255,T)},Moe={hsl:cR,hsla:cR,rgb:lR,rgba:lR},s0=function(i,e){return Ed.parse(i,JD.create(e).parseComponentValue())},RA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Poe={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(i,e){return e.map(function(t){if(ws(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Foe={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Dv=function(i,e){var t=Ed.parse(i,e[0]),r=e[1];return r&&oa(r)?{color:t,stop:r}:{color:t,stop:null}},uR=function(i,e){var t=i[0],r=i[i.length-1];t.stop===null&&(t.stop=ol),r.stop===null&&(r.stop=Cd);for(var n=[],o=0,l=0;l<i.length;l++){var s=i[l].stop;if(s!==null){var g=Vs(s,e);g>o?n.push(g):n.push(o),o=g}else n.push(null)}for(var v=null,l=0;l<n.length;l++){var T=n[l];if(T===null)v===null&&(v=l);else if(v!==null){for(var F=l-v,R=n[v-1],U=(T-R)/(F+1),J=1;J<=F;J++)n[v+J-1]=U*J;v=null}}return i.map(function(te,Ae){var he=te.color;return{color:he,stop:Math.max(Math.min(1,n[Ae]/e),0)}})},Doe=function(i,e,t){var r=e/2,n=t/2,o=Vs(i[0],e)-r,l=n-Vs(i[1],t);return(Math.atan2(l,o)+Math.PI*2)%(Math.PI*2)},Roe=function(i,e,t){var r=typeof i=="number"?i:Doe(i,e,t),n=Math.abs(e*Math.sin(r))+Math.abs(t*Math.cos(r)),o=e/2,l=t/2,s=n/2,g=Math.sin(r-Math.PI/2)*s,v=Math.cos(r-Math.PI/2)*s;return[n,o-v,o+v,l-g,l+g]},dh=function(i,e){return Math.sqrt(i*i+e*e)},hR=function(i,e,t,r,n){var o=[[0,0],[0,e],[i,0],[i,e]];return o.reduce(function(l,s){var g=s[0],v=s[1],T=dh(t-g,r-v);return(n?T<l.optimumDistance:T>l.optimumDistance)?{optimumCorner:s,optimumDistance:T}:l},{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},koe=function(i,e,t,r,n){var o=0,l=0;switch(i.size){case 0:i.shape===0?o=l=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):i.shape===1&&(o=Math.min(Math.abs(e),Math.abs(e-r)),l=Math.min(Math.abs(t),Math.abs(t-n)));break;case 2:if(i.shape===0)o=l=Math.min(dh(e,t),dh(e,t-n),dh(e-r,t),dh(e-r,t-n));else if(i.shape===1){var s=Math.min(Math.abs(t),Math.abs(t-n))/Math.min(Math.abs(e),Math.abs(e-r)),g=hR(r,n,e,t,!0),v=g[0],T=g[1];o=dh(v-e,(T-t)/s),l=s*o}break;case 1:i.shape===0?o=l=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):i.shape===1&&(o=Math.max(Math.abs(e),Math.abs(e-r)),l=Math.max(Math.abs(t),Math.abs(t-n)));break;case 3:if(i.shape===0)o=l=Math.max(dh(e,t),dh(e,t-n),dh(e-r,t),dh(e-r,t-n));else if(i.shape===1){var s=Math.max(Math.abs(t),Math.abs(t-n))/Math.max(Math.abs(e),Math.abs(e-r)),F=hR(r,n,e,t,!1),v=F[0],T=F[1];o=dh(v-e,(T-t)/s),l=s*o}break}return Array.isArray(i.size)&&(o=Vs(i.size[0],r),l=i.size.length===2?Vs(i.size[1],n):o),[o,l]},Ooe=function(i,e){var t=Pu(180),r=[];return Xh(e).forEach(function(n,o){if(o===0){var l=n[0];if(l.type===20&&l.value==="to"){t=oR(n);return}else if(sR(l)){t=Fv.parse(i,l);return}}var s=Dv(i,n);r.push(s)}),{angle:t,stops:r,type:1}},Rv=function(i,e){var t=Pu(180),r=[];return Xh(e).forEach(function(n,o){if(o===0){var l=n[0];if(l.type===20&&["top","left","right","bottom"].indexOf(l.value)!==-1){t=oR(n);return}else if(sR(l)){t=(Fv.parse(i,l)+Pu(270))%Pu(360);return}}var s=Dv(i,n);r.push(s)}),{angle:t,stops:r,type:1}},Uoe=function(i,e){var t=Pu(180),r=[],n=1,o=0,l=3,s=[];return Xh(e).forEach(function(g,v){var T=g[0];if(v===0){if(ws(T)&&T.value==="linear"){n=1;return}else if(ws(T)&&T.value==="radial"){n=2;return}}if(T.type===18){if(T.name==="from"){var F=Ed.parse(i,T.values[0]);r.push({stop:ol,color:F})}else if(T.name==="to"){var F=Ed.parse(i,T.values[0]);r.push({stop:Cd,color:F})}else if(T.name==="color-stop"){var R=T.values.filter(zg);if(R.length===2){var F=Ed.parse(i,R[1]),U=R[0];Ng(U)&&r.push({stop:{type:16,number:U.number*100,flags:U.flags},color:F})}}}}),n===1?{angle:(t+Pu(180))%Pu(360),stops:r,type:n}:{size:l,shape:o,stops:r,position:s,type:n}},AR="closest-side",dR="farthest-side",fR="closest-corner",pR="farthest-corner",gR="circle",mR="ellipse",yR="cover",_R="contain",Noe=function(i,e){var t=0,r=3,n=[],o=[];return Xh(e).forEach(function(l,s){var g=!0;if(s===0){var v=!1;g=l.reduce(function(F,R){if(v)if(ws(R))switch(R.value){case"center":return o.push(lE),F;case"top":case"left":return o.push(ol),F;case"right":case"bottom":return o.push(Cd),F}else(oa(R)||Bd(R))&&o.push(R);else if(ws(R))switch(R.value){case gR:return t=0,!1;case mR:return t=1,!1;case"at":return v=!0,!1;case AR:return r=0,!1;case yR:case dR:return r=1,!1;case _R:case fR:return r=2,!1;case pR:return r=3,!1}else if(Bd(R)||oa(R))return Array.isArray(r)||(r=[]),r.push(R),!1;return F},g)}if(g){var T=Dv(i,l);n.push(T)}}),{size:r,shape:t,stops:n,position:o,type:2}},kv=function(i,e){var t=0,r=3,n=[],o=[];return Xh(e).forEach(function(l,s){var g=!0;if(s===0?g=l.reduce(function(T,F){if(ws(F))switch(F.value){case"center":return o.push(lE),!1;case"top":case"left":return o.push(ol),!1;case"right":case"bottom":return o.push(Cd),!1}else if(oa(F)||Bd(F))return o.push(F),!1;return T},g):s===1&&(g=l.reduce(function(T,F){if(ws(F))switch(F.value){case gR:return t=0,!1;case mR:return t=1,!1;case _R:case AR:return r=0,!1;case dR:return r=1,!1;case fR:return r=2,!1;case yR:case pR:return r=3,!1}else if(Bd(F)||oa(F))return Array.isArray(r)||(r=[]),r.push(F),!1;return T},g)),g){var v=Dv(i,l);n.push(v)}}),{size:r,shape:t,stops:n,position:o,type:2}},zoe=function(i){return i.type===1},Qoe=function(i){return i.type===2},uE={name:"image",parse:function(i,e){if(e.type===22){var t={url:e.value,type:0};return i.cache.addImage(e.value),t}if(e.type===18){var r=vR[e.name];if(typeof r>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(i,e.values)}throw new Error("Unsupported image type "+e.type)}};function Voe(i){return!(i.type===20&&i.value==="none")&&(i.type!==18||!!vR[i.name])}var vR={"linear-gradient":Ooe,"-moz-linear-gradient":Rv,"-ms-linear-gradient":Rv,"-o-linear-gradient":Rv,"-webkit-linear-gradient":Rv,"radial-gradient":Noe,"-moz-radial-gradient":kv,"-ms-radial-gradient":kv,"-o-radial-gradient":kv,"-webkit-radial-gradient":kv,"-webkit-gradient":Uoe},Hoe={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(i,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e.filter(function(r){return zg(r)&&Voe(r)}).map(function(r){return uE.parse(i,r)})}},Goe={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(i,e){return e.map(function(t){if(ws(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},joe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(i,e){return Xh(e).map(function(t){return t.filter(oa)}).map(eR)}},qoe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(i,e){return Xh(e).map(function(t){return t.filter(ws).map(function(r){return r.value}).join(" ")}).map($oe)}},$oe=function(i){switch(i){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Qg;(function(i){i.AUTO="auto",i.CONTAIN="contain",i.COVER="cover"})(Qg||(Qg={}));var Koe={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(i,e){return Xh(e).map(function(t){return t.filter(Woe)})}},Woe=function(i){return ws(i)||oa(i)},Ov=function(i){return{name:"border-"+i+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Zoe=Ov("top"),Xoe=Ov("right"),Joe=Ov("bottom"),Yoe=Ov("left"),Uv=function(i){return{name:"border-radius-"+i,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return eR(t.filter(oa))}}},eae=Uv("top-left"),tae=Uv("top-right"),iae=Uv("bottom-right"),rae=Uv("bottom-left"),Nv=function(i){return{name:"border-"+i+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},nae=Nv("top"),sae=Nv("right"),oae=Nv("bottom"),aae=Nv("left"),zv=function(i){return{name:"border-"+i+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return r0(t)?t.number:0}}},lae=zv("top"),cae=zv("right"),uae=zv("bottom"),hae=zv("left"),Aae={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},dae={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(i,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},fae={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(i,e){return e.filter(ws).reduce(function(t,r){return t|pae(r.value)},0)}},pae=function(i){switch(i){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},gae={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},mae={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(i,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},Qv;(function(i){i.NORMAL="normal",i.STRICT="strict"})(Qv||(Qv={}));var yae={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"strict":return Qv.STRICT;case"normal":default:return Qv.NORMAL}}},_ae={name:"line-height",initialValue:"normal",prefix:!1,type:4},bR=function(i,e){return ws(i)&&i.value==="normal"?1.2*e:i.type===17?e*i.number:oa(i)?Vs(i,e):e},vae={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(i,e){return e.type===20&&e.value==="none"?null:uE.parse(i,e)}},bae={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(i,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},hE={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Vv=function(i){return{name:"margin-"+i,initialValue:"0",prefix:!1,type:4}},xae=Vv("top"),wae=Vv("right"),Bae=Vv("bottom"),Cae=Vv("left"),Eae={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(i,e){return e.filter(ws).map(function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Sae={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},Hv=function(i){return{name:"padding-"+i,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Tae=Hv("top"),Iae=Hv("right"),Lae=Hv("bottom"),Mae=Hv("left"),Pae={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(i,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Fae={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(i,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Dae={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.length===1&&aE(e[0],"none")?[]:Xh(e).map(function(t){for(var r={color:RA.TRANSPARENT,offsetX:ol,offsetY:ol,blur:ol},n=0,o=0;o<t.length;o++){var l=t[o];Bd(l)?(n===0?r.offsetX=l:n===1?r.offsetY=l:r.blur=l,n++):r.color=Ed.parse(i,l)}return r})}},Rae={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},kae={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(i,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var t=Nae[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},Oae=function(i){var e=i.filter(function(t){return t.type===17}).map(function(t){return t.number});return e.length===6?e:null},Uae=function(i){var e=i.filter(function(g){return g.type===17}).map(function(g){return g.number}),t=e[0],r=e[1];e[2],e[3];var n=e[4],o=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var l=e[12],s=e[13];return e[14],e[15],e.length===16?[t,r,n,o,l,s]:null},Nae={matrix:Oae,matrix3d:Uae},xR={type:16,number:50,flags:Jy},zae=[xR,xR],Qae={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(i,e){var t=e.filter(oa);return t.length!==2?zae:[t[0],t[1]]}},Vae={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},o0;(function(i){i.NORMAL="normal",i.BREAK_ALL="break-all",i.KEEP_ALL="keep-all"})(o0||(o0={}));for(var Hae={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"break-all":return o0.BREAK_ALL;case"keep-all":return o0.KEEP_ALL;case"normal":default:return o0.NORMAL}}},Gae={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(i,e){if(e.type===20)return{auto:!0,order:0};if(Ng(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},wR={name:"time",parse:function(i,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},jae={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(i,e){return Ng(e)?e.number:1}},qae={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},$ae={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(i,e){return e.filter(ws).map(function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(t){return t!==0})}},Kae={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(i,e){var t=[],r=[];return e.forEach(function(n){switch(n.type){case 20:case 0:t.push(n.value);break;case 17:t.push(n.number.toString());break;case 4:r.push(t.join(" ")),t.length=0;break}}),t.length&&r.push(t.join(" ")),r.map(function(n){return n.indexOf(" ")===-1?n:"'"+n+"'"})}},Wae={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},Zae={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(i,e){if(Ng(e))return e.number;if(ws(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},Xae={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.filter(ws).map(function(t){return t.value})}},Jae={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Ba=function(i,e){return(i&e)!==0},Yae={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(i,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e}},ele={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;for(var r=[],n=e.filter(YD),o=0;o<n.length;o++){var l=n[o],s=n[o+1];if(l.type===20){var g=s&&Ng(s)?s.number:1;r.push({counter:l.value,increment:g})}}return r}},tle={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return[];for(var t=[],r=e.filter(YD),n=0;n<r.length;n++){var o=r[n],l=r[n+1];if(ws(o)&&o.value!=="none"){var s=l&&Ng(l)?l.number:0;t.push({counter:o.value,reset:s})}}return t}},ile={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(i,e){return e.filter(r0).map(function(t){return wR.parse(i,t)})}},rle={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;var r=[],n=e.filter(Ioe);if(n.length%2!==0)return null;for(var o=0;o<n.length;o+=2){var l=n[o].value,s=n[o+1].value;r.push({open:l,close:s})}return r}},BR=function(i,e,t){if(!i)return"";var r=i[Math.min(e,i.length-1)];return r?t?r.open:r.close:""},nle={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.length===1&&aE(e[0],"none")?[]:Xh(e).map(function(t){for(var r={color:255,offsetX:ol,offsetY:ol,blur:ol,spread:ol,inset:!1},n=0,o=0;o<t.length;o++){var l=t[o];aE(l,"inset")?r.inset=!0:Bd(l)?(n===0?r.offsetX=l:n===1?r.offsetY=l:n===2?r.blur=l:r.spread=l,n++):r.color=Ed.parse(i,l)}return r})}},sle={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(i,e){var t=[0,1,2],r=[];return e.filter(ws).forEach(function(n){switch(n.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2);break}}),t.forEach(function(n){r.indexOf(n)===-1&&r.push(n)}),r}},ole={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},ale={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(i,e){return r0(e)?e.number:0}},lle=function(){function i(e,t){var r,n;this.animationDuration=rr(e,ile,t.animationDuration),this.backgroundClip=rr(e,Poe,t.backgroundClip),this.backgroundColor=rr(e,Foe,t.backgroundColor),this.backgroundImage=rr(e,Hoe,t.backgroundImage),this.backgroundOrigin=rr(e,Goe,t.backgroundOrigin),this.backgroundPosition=rr(e,joe,t.backgroundPosition),this.backgroundRepeat=rr(e,qoe,t.backgroundRepeat),this.backgroundSize=rr(e,Koe,t.backgroundSize),this.borderTopColor=rr(e,Zoe,t.borderTopColor),this.borderRightColor=rr(e,Xoe,t.borderRightColor),this.borderBottomColor=rr(e,Joe,t.borderBottomColor),this.borderLeftColor=rr(e,Yoe,t.borderLeftColor),this.borderTopLeftRadius=rr(e,eae,t.borderTopLeftRadius),this.borderTopRightRadius=rr(e,tae,t.borderTopRightRadius),this.borderBottomRightRadius=rr(e,iae,t.borderBottomRightRadius),this.borderBottomLeftRadius=rr(e,rae,t.borderBottomLeftRadius),this.borderTopStyle=rr(e,nae,t.borderTopStyle),this.borderRightStyle=rr(e,sae,t.borderRightStyle),this.borderBottomStyle=rr(e,oae,t.borderBottomStyle),this.borderLeftStyle=rr(e,aae,t.borderLeftStyle),this.borderTopWidth=rr(e,lae,t.borderTopWidth),this.borderRightWidth=rr(e,cae,t.borderRightWidth),this.borderBottomWidth=rr(e,uae,t.borderBottomWidth),this.borderLeftWidth=rr(e,hae,t.borderLeftWidth),this.boxShadow=rr(e,nle,t.boxShadow),this.color=rr(e,Aae,t.color),this.direction=rr(e,dae,t.direction),this.display=rr(e,fae,t.display),this.float=rr(e,gae,t.cssFloat),this.fontFamily=rr(e,Kae,t.fontFamily),this.fontSize=rr(e,Wae,t.fontSize),this.fontStyle=rr(e,Jae,t.fontStyle),this.fontVariant=rr(e,Xae,t.fontVariant),this.fontWeight=rr(e,Zae,t.fontWeight),this.letterSpacing=rr(e,mae,t.letterSpacing),this.lineBreak=rr(e,yae,t.lineBreak),this.lineHeight=rr(e,_ae,t.lineHeight),this.listStyleImage=rr(e,vae,t.listStyleImage),this.listStylePosition=rr(e,bae,t.listStylePosition),this.listStyleType=rr(e,hE,t.listStyleType),this.marginTop=rr(e,xae,t.marginTop),this.marginRight=rr(e,wae,t.marginRight),this.marginBottom=rr(e,Bae,t.marginBottom),this.marginLeft=rr(e,Cae,t.marginLeft),this.opacity=rr(e,jae,t.opacity);var o=rr(e,Eae,t.overflow);this.overflowX=o[0],this.overflowY=o[o.length>1?1:0],this.overflowWrap=rr(e,Sae,t.overflowWrap),this.paddingTop=rr(e,Tae,t.paddingTop),this.paddingRight=rr(e,Iae,t.paddingRight),this.paddingBottom=rr(e,Lae,t.paddingBottom),this.paddingLeft=rr(e,Mae,t.paddingLeft),this.paintOrder=rr(e,sle,t.paintOrder),this.position=rr(e,Fae,t.position),this.textAlign=rr(e,Pae,t.textAlign),this.textDecorationColor=rr(e,qae,(r=t.textDecorationColor)!==null&&r!==void 0?r:t.color),this.textDecorationLine=rr(e,$ae,(n=t.textDecorationLine)!==null&&n!==void 0?n:t.textDecoration),this.textShadow=rr(e,Dae,t.textShadow),this.textTransform=rr(e,Rae,t.textTransform),this.transform=rr(e,kae,t.transform),this.transformOrigin=rr(e,Qae,t.transformOrigin),this.visibility=rr(e,Vae,t.visibility),this.webkitTextStrokeColor=rr(e,ole,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=rr(e,ale,t.webkitTextStrokeWidth),this.wordBreak=rr(e,Hae,t.wordBreak),this.zIndex=rr(e,Gae,t.zIndex)}return i.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},i.prototype.isTransparent=function(){return Sd(this.backgroundColor)},i.prototype.isTransformed=function(){return this.transform!==null},i.prototype.isPositioned=function(){return this.position!==0},i.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},i.prototype.isFloating=function(){return this.float!==0},i.prototype.isInlineLevel=function(){return Ba(this.display,4)||Ba(this.display,33554432)||Ba(this.display,268435456)||Ba(this.display,536870912)||Ba(this.display,67108864)||Ba(this.display,134217728)},i}(),cle=function(){function i(e,t){this.content=rr(e,Yae,t.content),this.quotes=rr(e,rle,t.quotes)}return i}(),CR=function(){function i(e,t){this.counterIncrement=rr(e,ele,t.counterIncrement),this.counterReset=rr(e,tle,t.counterReset)}return i}(),rr=function(i,e,t){var r=new XD,n=t!==null&&typeof t<"u"?t.toString():e.initialValue;r.write(n);var o=new JD(r.read());switch(e.type){case 2:var l=o.parseComponentValue();return e.parse(i,ws(l)?l.value:e.initialValue);case 0:return e.parse(i,o.parseComponentValue());case 1:return e.parse(i,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(e.format){case"angle":return Fv.parse(i,o.parseComponentValue());case"color":return Ed.parse(i,o.parseComponentValue());case"image":return uE.parse(i,o.parseComponentValue());case"length":var s=o.parseComponentValue();return Bd(s)?s:ol;case"length-percentage":var g=o.parseComponentValue();return oa(g)?g:ol;case"time":return wR.parse(i,o.parseComponentValue())}break}},ule="data-html2canvas-debug",hle=function(i){var e=i.getAttribute(ule);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},AE=function(i,e){var t=hle(i);return t===1||e===t},Jh=function(){function i(e,t){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,AE(t,3))debugger;this.styles=new lle(e,window.getComputedStyle(t,null)),CE(t)&&(this.styles.animationDuration.some(function(r){return r>0})&&(t.style.animationDuration="0s"),this.styles.transform!==null&&(t.style.transform="none")),this.bounds=dv(this.context,t),AE(t,4)&&(this.flags|=16)}return i}(),Ale="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",ER="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a0=typeof Uint8Array>"u"?[]:new Uint8Array(256),Gv=0;Gv<ER.length;Gv++)a0[ER.charCodeAt(Gv)]=Gv;for(var dle=function(i){var e=i.length*.75,t=i.length,r,n=0,o,l,s,g;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);var v=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),T=Array.isArray(v)?v:new Uint8Array(v);for(r=0;r<t;r+=4)o=a0[i.charCodeAt(r)],l=a0[i.charCodeAt(r+1)],s=a0[i.charCodeAt(r+2)],g=a0[i.charCodeAt(r+3)],T[n++]=o<<2|l>>4,T[n++]=(l&15)<<4|s>>2,T[n++]=(s&3)<<6|g&63;return v},fle=function(i){for(var e=i.length,t=[],r=0;r<e;r+=2)t.push(i[r+1]<<8|i[r]);return t},ple=function(i){for(var e=i.length,t=[],r=0;r<e;r+=4)t.push(i[r+3]<<24|i[r+2]<<16|i[r+1]<<8|i[r]);return t},Rf=5,dE=11,fE=2,gle=dE-Rf,SR=65536>>Rf,mle=1<<Rf,pE=mle-1,yle=1024>>Rf,_le=SR+yle,vle=_le,ble=32,xle=vle+ble,wle=65536>>dE,Ble=1<<gle,Cle=Ble-1,TR=function(i,e,t){return i.slice?i.slice(e,t):new Uint16Array(Array.prototype.slice.call(i,e,t))},Ele=function(i,e,t){return i.slice?i.slice(e,t):new Uint32Array(Array.prototype.slice.call(i,e,t))},Sle=function(i,e){var t=dle(i),r=Array.isArray(t)?ple(t):new Uint32Array(t),n=Array.isArray(t)?fle(t):new Uint16Array(t),o=24,l=TR(n,o/2,r[4]/2),s=r[5]===2?TR(n,(o+r[4])/2):Ele(r,Math.ceil((o+r[4])/4));return new Tle(r[0],r[1],r[2],r[3],l,s)},Tle=function(){function i(e,t,r,n,o,l){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=o,this.data=l}return i.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>Rf],t=(t<<fE)+(e&pE),this.data[t];if(e<=65535)return t=this.index[SR+(e-55296>>Rf)],t=(t<<fE)+(e&pE),this.data[t];if(e<this.highStart)return t=xle-wle+(e>>dE),t=this.index[t],t+=e>>Rf&Cle,t=this.index[t],t=(t<<fE)+(e&pE),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},i}(),IR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ile=typeof Uint8Array>"u"?[]:new Uint8Array(256),jv=0;jv<IR.length;jv++)Ile[IR.charCodeAt(jv)]=jv;var Lle=1,gE=2,mE=3,LR=4,MR=5,Mle=7,PR=8,yE=9,_E=10,FR=11,DR=12,RR=13,kR=14,vE=15,Ple=function(i){for(var e=[],t=0,r=i.length;t<r;){var n=i.charCodeAt(t++);if(n>=55296&&n<=56319&&t<r){var o=i.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},Fle=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,i);var t=i.length;if(!t)return"";for(var r=[],n=-1,o="";++n<t;){var l=i[n];l<=65535?r.push(l):(l-=65536,r.push((l>>10)+55296,l%1024+56320)),(n+1===t||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},Dle=Sle(Ale),kf="×",OR="÷",Rle=function(i){return Dle.get(i)},kle=function(i,e,t){var r=t-2,n=e[r],o=e[t-1],l=e[t];if(o===gE&&l===mE)return kf;if(o===gE||o===mE||o===LR||l===gE||l===mE||l===LR)return OR;if(o===PR&&[PR,yE,FR,DR].indexOf(l)!==-1||(o===FR||o===yE)&&(l===yE||l===_E)||(o===DR||o===_E)&&l===_E||l===RR||l===MR||l===Mle||o===Lle)return kf;if(o===RR&&l===kR){for(;n===MR;)n=e[--r];if(n===kR)return kf}if(o===vE&&l===vE){for(var s=0;n===vE;)s++,n=e[--r];if(s%2===0)return kf}return OR},Ole=function(i){var e=Ple(i),t=e.length,r=0,n=0,o=e.map(Rle);return{next:function(){if(r>=t)return{done:!0,value:null};for(var l=kf;r<t&&(l=kle(e,o,++r))===kf;);if(l!==kf||r===t){var s=Fle.apply(null,e.slice(n,r));return n=r,{value:s,done:!1}}return{done:!0,value:null}}}},Ule=function(i){for(var e=Ole(i),t=[],r;!(r=e.next()).done;)r.value&&t.push(r.value.slice());return t},Nle=function(i){var e=123;if(i.createRange){var t=i.createRange();if(t.getBoundingClientRect){var r=i.createElement("boundtest");r.style.height=e+"px",r.style.display="block",i.body.appendChild(r),t.selectNode(r);var n=t.getBoundingClientRect(),o=Math.round(n.height);if(i.body.removeChild(r),o===e)return!0}}return!1},zle=function(i){var e=i.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",i.body.appendChild(e);var t=i.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var r=e.firstChild,n=fv(r.data).map(function(g){return Go(g)}),o=0,l={},s=n.every(function(g,v){t.setStart(r,o),t.setEnd(r,o+g.length);var T=t.getBoundingClientRect();o+=g.length;var F=T.x>l.x||T.y>l.y;return l=T,v===0?!0:F});return i.body.removeChild(e),s},Qle=function(){return typeof new Image().crossOrigin<"u"},Vle=function(){return typeof new XMLHttpRequest().responseType=="string"},Hle=function(i){var e=new Image,t=i.createElement("canvas"),r=t.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),t.toDataURL()}catch{return!1}return!0},UR=function(i){return i[0]===0&&i[1]===255&&i[2]===0&&i[3]===255},Gle=function(i){var e=i.createElement("canvas"),t=100;e.width=t,e.height=t;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,t,t);var n=new Image,o=e.toDataURL();n.src=o;var l=bE(t,t,0,0,n);return r.fillStyle="red",r.fillRect(0,0,t,t),NR(l).then(function(s){r.drawImage(s,0,0);var g=r.getImageData(0,0,t,t).data;r.fillStyle="red",r.fillRect(0,0,t,t);var v=i.createElement("div");return v.style.backgroundImage="url("+o+")",v.style.height=t+"px",UR(g)?NR(bE(t,t,0,0,v)):Promise.reject(!1)}).then(function(s){return r.drawImage(s,0,0),UR(r.getImageData(0,0,t,t).data)}).catch(function(){return!1})},bE=function(i,e,t,r,n){var o="http://www.w3.org/2000/svg",l=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return l.setAttributeNS(null,"width",i.toString()),l.setAttributeNS(null,"height",e.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",t.toString()),s.setAttributeNS(null,"y",r.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),l.appendChild(s),s.appendChild(n),l},NR=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(i))})},al={get SUPPORT_RANGE_BOUNDS(){var i=Nle(document);return Object.defineProperty(al,"SUPPORT_RANGE_BOUNDS",{value:i}),i},get SUPPORT_WORD_BREAKING(){var i=al.SUPPORT_RANGE_BOUNDS&&zle(document);return Object.defineProperty(al,"SUPPORT_WORD_BREAKING",{value:i}),i},get SUPPORT_SVG_DRAWING(){var i=Hle(document);return Object.defineProperty(al,"SUPPORT_SVG_DRAWING",{value:i}),i},get SUPPORT_FOREIGNOBJECT_DRAWING(){var i=typeof Array.from=="function"&&typeof window.fetch=="function"?Gle(document):Promise.resolve(!1);return Object.defineProperty(al,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:i}),i},get SUPPORT_CORS_IMAGES(){var i=Qle();return Object.defineProperty(al,"SUPPORT_CORS_IMAGES",{value:i}),i},get SUPPORT_RESPONSE_TYPE(){var i=Vle();return Object.defineProperty(al,"SUPPORT_RESPONSE_TYPE",{value:i}),i},get SUPPORT_CORS_XHR(){var i="withCredentials"in new XMLHttpRequest;return Object.defineProperty(al,"SUPPORT_CORS_XHR",{value:i}),i},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var i=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(al,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:i}),i}},l0=function(){function i(e,t){this.text=e,this.bounds=t}return i}(),jle=function(i,e,t,r){var n=Kle(e,t),o=[],l=0;return n.forEach(function(s){if(t.textDecorationLine.length||s.trim().length>0)if(al.SUPPORT_RANGE_BOUNDS){var g=zR(r,l,s.length).getClientRects();if(g.length>1){var v=xE(s),T=0;v.forEach(function(R){o.push(new l0(R,FA.fromDOMRectList(i,zR(r,T+l,R.length).getClientRects()))),T+=R.length})}else o.push(new l0(s,FA.fromDOMRectList(i,g)))}else{var F=r.splitText(s.length);o.push(new l0(s,qle(i,r))),r=F}else al.SUPPORT_RANGE_BOUNDS||(r=r.splitText(s.length));l+=s.length}),o},qle=function(i,e){var t=e.ownerDocument;if(t){var r=t.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var n=e.parentNode;if(n){n.replaceChild(r,e);var o=dv(i,r);return r.firstChild&&n.replaceChild(r.firstChild,r),o}}return FA.EMPTY},zR=function(i,e,t){var r=i.ownerDocument;if(!r)throw new Error("Node has no owner document");var n=r.createRange();return n.setStart(i,e),n.setEnd(i,e+t),n},xE=function(i){if(al.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(i)).map(function(t){return t.segment})}return Ule(i)},$le=function(i,e){if(al.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(i)).map(function(r){return r.segment})}return Zle(i,e)},Kle=function(i,e){return e.letterSpacing!==0?xE(i):$le(i,e)},Wle=[32,160,4961,65792,65793,4153,4241],Zle=function(i,e){for(var t=wse(i,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),r=[],n,o=function(){if(n.value){var l=n.value.slice(),s=fv(l),g="";s.forEach(function(v){Wle.indexOf(v)===-1?g+=Go(v):(g.length&&r.push(g),r.push(Go(v)),g="")}),g.length&&r.push(g)}};!(n=t.next()).done;)o();return r},Xle=function(){function i(e,t,r){this.text=Jle(t.data,r.textTransform),this.textBounds=jle(e,this.text,r,t)}return i}(),Jle=function(i,e){switch(e){case 1:return i.toLowerCase();case 3:return i.replace(Yle,ece);case 2:return i.toUpperCase();default:return i}},Yle=/(^|\s|:|-|\(|\))([a-z])/g,ece=function(i,e,t){return i.length>0?e+t.toUpperCase():i},QR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.src=r.currentSrc||r.src,n.intrinsicWidth=r.naturalWidth,n.intrinsicHeight=r.naturalHeight,n.context.cache.addImage(n.src),n}return e}(Jh),VR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.canvas=r,n.intrinsicWidth=r.width,n.intrinsicHeight=r.height,n}return e}(Jh),HR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this,o=new XMLSerializer,l=dv(t,r);return r.setAttribute("width",l.width+"px"),r.setAttribute("height",l.height+"px"),n.svg="data:image/svg+xml,"+encodeURIComponent(o.serializeToString(r)),n.intrinsicWidth=r.width.baseVal.value,n.intrinsicHeight=r.height.baseVal.value,n.context.cache.addImage(n.svg),n}return e}(Jh),GR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.value=r.value,n}return e}(Jh),wE=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.start=r.start,n.reversed=typeof r.reversed=="boolean"&&r.reversed===!0,n}return e}(Jh),tce=[{type:15,flags:0,unit:"px",number:3}],ice=[{type:16,flags:0,number:50}],rce=function(i){return i.width>i.height?new FA(i.left+(i.width-i.height)/2,i.top,i.height,i.height):i.width<i.height?new FA(i.left,i.top+(i.height-i.width)/2,i.width,i.width):i},nce=function(i){var e=i.type===sce?new Array(i.value.length+1).join("•"):i.value;return e.length===0?i.placeholder||"":e},qv="checkbox",$v="radio",sce="password",jR=707406591,BE=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;switch(n.type=r.type.toLowerCase(),n.checked=r.checked,n.value=nce(r),(n.type===qv||n.type===$v)&&(n.styles.backgroundColor=3739148031,n.styles.borderTopColor=n.styles.borderRightColor=n.styles.borderBottomColor=n.styles.borderLeftColor=2779096575,n.styles.borderTopWidth=n.styles.borderRightWidth=n.styles.borderBottomWidth=n.styles.borderLeftWidth=1,n.styles.borderTopStyle=n.styles.borderRightStyle=n.styles.borderBottomStyle=n.styles.borderLeftStyle=1,n.styles.backgroundClip=[0],n.styles.backgroundOrigin=[0],n.bounds=rce(n.bounds)),n.type){case qv:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=tce;break;case $v:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=ice;break}return n}return e}(Jh),qR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this,o=r.options[r.selectedIndex||0];return n.value=o&&o.text||"",n}return e}(Jh),$R=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.value=r.value,n}return e}(Jh),KR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;n.src=r.src,n.width=parseInt(r.width,10)||0,n.height=parseInt(r.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{if(r.contentWindow&&r.contentWindow.document&&r.contentWindow.document.documentElement){n.tree=ZR(t,r.contentWindow.document.documentElement);var o=r.contentWindow.document.documentElement?s0(t,getComputedStyle(r.contentWindow.document.documentElement).backgroundColor):RA.TRANSPARENT,l=r.contentWindow.document.body?s0(t,getComputedStyle(r.contentWindow.document.body).backgroundColor):RA.TRANSPARENT;n.backgroundColor=Sd(o)?Sd(l)?n.styles.backgroundColor:l:o}}catch{}return n}return e}(Jh),oce=["OL","UL","MENU"],Kv=function(i,e,t,r){for(var n=e.firstChild,o=void 0;n;n=o)if(o=n.nextSibling,XR(n)&&n.data.trim().length>0)t.textNodes.push(new Xle(i,n,t.styles));else if(Vg(n))if(rk(n)&&n.assignedNodes)n.assignedNodes().forEach(function(s){return Kv(i,s,t,r)});else{var l=WR(i,n);l.styles.isVisible()&&(ace(n,l,r)?l.flags|=4:lce(l.styles)&&(l.flags|=2),oce.indexOf(n.tagName)!==-1&&(l.flags|=8),t.elements.push(l),n.slot,n.shadowRoot?Kv(i,n.shadowRoot,l,r):!Zv(n)&&!JR(n)&&!Xv(n)&&Kv(i,n,l,r))}},WR=function(i,e){return SE(e)?new QR(i,e):YR(e)?new VR(i,e):JR(e)?new HR(i,e):cce(e)?new GR(i,e):uce(e)?new wE(i,e):hce(e)?new BE(i,e):Xv(e)?new qR(i,e):Zv(e)?new $R(i,e):tk(e)?new KR(i,e):new Jh(i,e)},ZR=function(i,e){var t=WR(i,e);return t.flags|=4,Kv(i,e,t,t),t},ace=function(i,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||EE(i)&&t.styles.isTransparent()},lce=function(i){return i.isPositioned()||i.isFloating()},XR=function(i){return i.nodeType===Node.TEXT_NODE},Vg=function(i){return i.nodeType===Node.ELEMENT_NODE},CE=function(i){return Vg(i)&&typeof i.style<"u"&&!Wv(i)},Wv=function(i){return typeof i.className=="object"},cce=function(i){return i.tagName==="LI"},uce=function(i){return i.tagName==="OL"},hce=function(i){return i.tagName==="INPUT"},Ace=function(i){return i.tagName==="HTML"},JR=function(i){return i.tagName==="svg"},EE=function(i){return i.tagName==="BODY"},YR=function(i){return i.tagName==="CANVAS"},ek=function(i){return i.tagName==="VIDEO"},SE=function(i){return i.tagName==="IMG"},tk=function(i){return i.tagName==="IFRAME"},ik=function(i){return i.tagName==="STYLE"},dce=function(i){return i.tagName==="SCRIPT"},Zv=function(i){return i.tagName==="TEXTAREA"},Xv=function(i){return i.tagName==="SELECT"},rk=function(i){return i.tagName==="SLOT"},nk=function(i){return i.tagName.indexOf("-")>0},fce=function(){function i(){this.counters={}}return i.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},i.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},i.prototype.pop=function(e){var t=this;e.forEach(function(r){return t.counters[r].pop()})},i.prototype.parse=function(e){var t=this,r=e.counterIncrement,n=e.counterReset,o=!0;r!==null&&r.forEach(function(s){var g=t.counters[s.counter];g&&s.increment!==0&&(o=!1,g.length||g.push(1),g[Math.max(0,g.length-1)]+=s.increment)});var l=[];return o&&n.forEach(function(s){var g=t.counters[s.counter];l.push(s.counter),g||(g=t.counters[s.counter]=[]),g.push(s.reset)}),l},i}(),sk={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},ok={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},pce={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},gce={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},Hg=function(i,e,t,r,n,o){return i<e||i>t?u0(i,n,o.length>0):r.integers.reduce(function(l,s,g){for(;i>=s;)i-=s,l+=r.values[g];return l},"")+o},ak=function(i,e,t,r){var n="";do t||i--,n=r(i)+n,i/=e;while(i*e>=e);return n},jo=function(i,e,t,r,n){var o=t-e+1;return(i<0?"-":"")+(ak(Math.abs(i),o,r,function(l){return Go(Math.floor(l%o)+e)})+n)},Of=function(i,e,t){t===void 0&&(t=". ");var r=e.length;return ak(Math.abs(i),r,!1,function(n){return e[Math.floor(n%r)]})+t},Gg=1,Id=2,Ld=4,c0=8,kA=function(i,e,t,r,n,o){if(i<-9999||i>9999)return u0(i,4,n.length>0);var l=Math.abs(i),s=n;if(l===0)return e[0]+s;for(var g=0;l>0&&g<=4;g++){var v=l%10;v===0&&Ba(o,Gg)&&s!==""?s=e[v]+s:v>1||v===1&&g===0||v===1&&g===1&&Ba(o,Id)||v===1&&g===1&&Ba(o,Ld)&&i>100||v===1&&g>1&&Ba(o,c0)?s=e[v]+(g>0?t[g-1]:"")+s:v===1&&g>0&&(s=t[g-1]+s),l=Math.floor(l/10)}return(i<0?r:"")+s},lk="十百千萬",ck="拾佰仟萬",uk="マイナス",TE="마이너스",u0=function(i,e,t){var r=t?". ":"",n=t?"、":"",o=t?", ":"",l=t?" ":"";switch(e){case 0:return"•"+l;case 1:return"◦"+l;case 2:return"◾"+l;case 5:var s=jo(i,48,57,!0,r);return s.length<4?"0"+s:s;case 4:return Of(i,"〇一二三四五六七八九",n);case 6:return Hg(i,1,3999,sk,3,r).toLowerCase();case 7:return Hg(i,1,3999,sk,3,r);case 8:return jo(i,945,969,!1,r);case 9:return jo(i,97,122,!1,r);case 10:return jo(i,65,90,!1,r);case 11:return jo(i,1632,1641,!0,r);case 12:case 49:return Hg(i,1,9999,ok,3,r);case 35:return Hg(i,1,9999,ok,3,r).toLowerCase();case 13:return jo(i,2534,2543,!0,r);case 14:case 30:return jo(i,6112,6121,!0,r);case 15:return Of(i,"子丑寅卯辰巳午未申酉戌亥",n);case 16:return Of(i,"甲乙丙丁戊己庚辛壬癸",n);case 17:case 48:return kA(i,"零一二三四五六七八九",lk,"負",n,Id|Ld|c0);case 47:return kA(i,"零壹貳參肆伍陸柒捌玖",ck,"負",n,Gg|Id|Ld|c0);case 42:return kA(i,"零一二三四五六七八九",lk,"负",n,Id|Ld|c0);case 41:return kA(i,"零壹贰叁肆伍陆柒捌玖",ck,"负",n,Gg|Id|Ld|c0);case 26:return kA(i,"〇一二三四五六七八九","十百千万",uk,n,0);case 25:return kA(i,"零壱弐参四伍六七八九","拾百千万",uk,n,Gg|Id|Ld);case 31:return kA(i,"영일이삼사오육칠팔구","십백천만",TE,o,Gg|Id|Ld);case 33:return kA(i,"零一二三四五六七八九","十百千萬",TE,o,0);case 32:return kA(i,"零壹貳參四五六七八九","拾百千",TE,o,Gg|Id|Ld);case 18:return jo(i,2406,2415,!0,r);case 20:return Hg(i,1,19999,gce,3,r);case 21:return jo(i,2790,2799,!0,r);case 22:return jo(i,2662,2671,!0,r);case 22:return Hg(i,1,10999,pce,3,r);case 23:return Of(i,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return Of(i,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return jo(i,3302,3311,!0,r);case 28:return Of(i,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",n);case 29:return Of(i,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",n);case 34:return jo(i,3792,3801,!0,r);case 37:return jo(i,6160,6169,!0,r);case 38:return jo(i,4160,4169,!0,r);case 39:return jo(i,2918,2927,!0,r);case 40:return jo(i,1776,1785,!0,r);case 43:return jo(i,3046,3055,!0,r);case 44:return jo(i,3174,3183,!0,r);case 45:return jo(i,3664,3673,!0,r);case 46:return jo(i,3872,3881,!0,r);case 3:default:return jo(i,48,57,!0,r)}},hk="data-html2canvas-ignore",Ak=function(){function i(e,t,r){if(this.context=e,this.options=r,this.scrolledElements=[],this.referenceElement=t,this.counters=new fce,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return i.prototype.toIFrame=function(e,t){var r=this,n=mce(e,t);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var o=e.defaultView.pageXOffset,l=e.defaultView.pageYOffset,s=n.contentWindow,g=s.document,v=vce(n).then(function(){return hc(r,void 0,void 0,function(){var T,F;return kl(this,function(R){switch(R.label){case 0:return this.scrolledElements.forEach(Bce),s&&(s.scrollTo(t.left,t.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(s.scrollY!==t.top||s.scrollX!==t.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-t.left,s.scrollY-t.top,0,0))),T=this.options.onclone,F=this.clonedReferenceElement,typeof F>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:g.fonts&&g.fonts.ready?[4,g.fonts.ready]:[3,2];case 1:R.sent(),R.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,_ce(g)]:[3,4];case 3:R.sent(),R.label=4;case 4:return typeof T=="function"?[2,Promise.resolve().then(function(){return T(g,F)}).then(function(){return n})]:[2,n]}})})});return g.open(),g.write(xce(document.doctype)+"<html></html>"),wce(this.referenceElement.ownerDocument,o,l),g.replaceChild(g.adoptNode(this.documentElement),g.documentElement),g.close(),v},i.prototype.createElementClone=function(e){if(AE(e,2))debugger;if(YR(e))return this.createCanvasClone(e);if(ek(e))return this.createVideoClone(e);if(ik(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return SE(t)&&(SE(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager")),nk(t)?this.createCustomElementClone(t):t},i.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return IE(e.style,t),t},i.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var r=[].slice.call(t.cssRules,0).reduce(function(o,l){return l&&typeof l.cssText=="string"?o+l.cssText:o},""),n=e.cloneNode(!1);return n.textContent=r,n}}catch(o){if(this.context.logger.error("Unable to access cssRules property",o),o.name!=="SecurityError")throw o}return e.cloneNode(!1)},i.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var r=e.ownerDocument.createElement("img");try{return r.src=e.toDataURL(),r}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var n=e.cloneNode(!1);try{n.width=e.width,n.height=e.height;var o=e.getContext("2d"),l=n.getContext("2d");if(l)if(!this.options.allowTaint&&o)l.putImageData(o.getImageData(0,0,e.width,e.height),0,0);else{var s=(t=e.getContext("webgl2"))!==null&&t!==void 0?t:e.getContext("webgl");if(s){var g=s.getContextAttributes();(g==null?void 0:g.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}l.drawImage(e,0,0)}return n}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return n},i.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var r=t.getContext("2d");try{return r&&(r.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||r.getImageData(0,0,t.width,t.height)),t}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var n=e.ownerDocument.createElement("canvas");return n.width=e.offsetWidth,n.height=e.offsetHeight,n},i.prototype.appendChildNode=function(e,t,r){(!Vg(t)||!dce(t)&&!t.hasAttribute(hk)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(t)))&&(!this.options.copyStyles||!Vg(t)||!ik(t))&&e.appendChild(this.cloneNode(t,r))},i.prototype.cloneChildNodes=function(e,t,r){for(var n=this,o=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;o;o=o.nextSibling)if(Vg(o)&&rk(o)&&typeof o.assignedNodes=="function"){var l=o.assignedNodes();l.length&&l.forEach(function(s){return n.appendChildNode(t,s,r)})}else this.appendChildNode(t,o,r)},i.prototype.cloneNode=function(e,t){if(XR(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var r=e.ownerDocument.defaultView;if(r&&Vg(e)&&(CE(e)||Wv(e))){var n=this.createElementClone(e);n.style.transitionProperty="none";var o=r.getComputedStyle(e),l=r.getComputedStyle(e,":before"),s=r.getComputedStyle(e,":after");this.referenceElement===e&&CE(n)&&(this.clonedReferenceElement=n),EE(n)&&Sce(n);var g=this.counters.parse(new CR(this.context,o)),v=this.resolvePseudoContent(e,n,l,h0.BEFORE);nk(e)&&(t=!0),ek(e)||this.cloneChildNodes(e,n,t),v&&n.insertBefore(v,n.firstChild);var T=this.resolvePseudoContent(e,n,s,h0.AFTER);return T&&n.appendChild(T),this.counters.pop(g),(o&&(this.options.copyStyles||Wv(e))&&!tk(e)||t)&&IE(o,n),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(Zv(e)||Xv(e))&&(Zv(n)||Xv(n))&&(n.value=e.value),n}return e.cloneNode(!1)},i.prototype.resolvePseudoContent=function(e,t,r,n){var o=this;if(r){var l=r.content,s=t.ownerDocument;if(!(!s||!l||l==="none"||l==="-moz-alt-content"||r.display==="none")){this.counters.parse(new CR(this.context,r));var g=new cle(this.context,r),v=s.createElement("html2canvaspseudoelement");IE(r,v),g.content.forEach(function(F){if(F.type===0)v.appendChild(s.createTextNode(F.value));else if(F.type===22){var R=s.createElement("img");R.src=F.value,R.style.opacity="1",v.appendChild(R)}else if(F.type===18){if(F.name==="attr"){var U=F.values.filter(ws);U.length&&v.appendChild(s.createTextNode(e.getAttribute(U[0].value)||""))}else if(F.name==="counter"){var J=F.values.filter(zg),te=J[0],Ae=J[1];if(te&&ws(te)){var he=o.counters.getCounterValue(te.value),pe=Ae&&ws(Ae)?hE.parse(o.context,Ae.value):3;v.appendChild(s.createTextNode(u0(he,pe,!1)))}}else if(F.name==="counters"){var be=F.values.filter(zg),te=be[0],Te=be[1],Ae=be[2];if(te&&ws(te)){var qe=o.counters.getCounterValues(te.value),je=Ae&&ws(Ae)?hE.parse(o.context,Ae.value):3,We=Te&&Te.type===0?Te.value:"",Ne=qe.map(function(ke){return u0(ke,je,!1)}).join(We);v.appendChild(s.createTextNode(Ne))}}}else if(F.type===20)switch(F.value){case"open-quote":v.appendChild(s.createTextNode(BR(g.quotes,o.quoteDepth++,!0)));break;case"close-quote":v.appendChild(s.createTextNode(BR(g.quotes,--o.quoteDepth,!1)));break;default:v.appendChild(s.createTextNode(F.value))}}),v.className=LE+" "+ME;var T=n===h0.BEFORE?" "+LE:" "+ME;return Wv(t)?t.className.baseValue+=T:t.className+=T,v}}},i.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},i}(),h0;(function(i){i[i.BEFORE=0]="BEFORE",i[i.AFTER=1]="AFTER"})(h0||(h0={}));var mce=function(i,e){var t=i.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(hk,"true"),i.body.appendChild(t),t},yce=function(i){return new Promise(function(e){if(i.complete){e();return}if(!i.src){e();return}i.onload=e,i.onerror=e})},_ce=function(i){return Promise.all([].slice.call(i.images,0).map(yce))},vce=function(i){return new Promise(function(e,t){var r=i.contentWindow;if(!r)return t("No window assigned for iframe");var n=r.document;r.onload=i.onload=function(){r.onload=i.onload=null;var o=setInterval(function(){n.body.childNodes.length>0&&n.readyState==="complete"&&(clearInterval(o),e(i))},50)}})},bce=["all","d","content"],IE=function(i,e){for(var t=i.length-1;t>=0;t--){var r=i.item(t);bce.indexOf(r)===-1&&e.style.setProperty(r,i.getPropertyValue(r))}return e},xce=function(i){var e="";return i&&(e+="<!DOCTYPE ",i.name&&(e+=i.name),i.internalSubset&&(e+=i.internalSubset),i.publicId&&(e+='"'+i.publicId+'"'),i.systemId&&(e+='"'+i.systemId+'"'),e+=">"),e},wce=function(i,e,t){i&&i.defaultView&&(e!==i.defaultView.pageXOffset||t!==i.defaultView.pageYOffset)&&i.defaultView.scrollTo(e,t)},Bce=function(i){var e=i[0],t=i[1],r=i[2];e.scrollLeft=t,e.scrollTop=r},Cce=":before",Ece=":after",LE="___html2canvas___pseudoelement_before",ME="___html2canvas___pseudoelement_after",dk=`{
    content: "" !important;
    display: none !important;
}`,Sce=function(i){Tce(i,"."+LE+Cce+dk+`
         .`+ME+Ece+dk)},Tce=function(i,e){var t=i.ownerDocument;if(t){var r=t.createElement("style");r.textContent=e,i.appendChild(r)}},fk=function(){function i(){}return i.getOrigin=function(e){var t=i._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},i.isSameOrigin=function(e){return i.getOrigin(e)===i._origin},i.setContext=function(e){i._link=e.document.createElement("a"),i._origin=i.getOrigin(e.location.href)},i._origin="about:blank",i}(),Ice=function(){function i(e,t){this.context=e,this._options=t,this._cache={}}return i.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(FE(e)||Fce(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),t},i.prototype.match=function(e){return this._cache[e]},i.prototype.loadImage=function(e){return hc(this,void 0,void 0,function(){var t,r,n,o,l=this;return kl(this,function(s){switch(s.label){case 0:return t=fk.isSameOrigin(e),r=!PE(e)&&this._options.useCORS===!0&&al.SUPPORT_CORS_IMAGES&&!t,n=!PE(e)&&!t&&!FE(e)&&typeof this._options.proxy=="string"&&al.SUPPORT_CORS_XHR&&!r,!t&&this._options.allowTaint===!1&&!PE(e)&&!FE(e)&&!n&&!r?[2]:(o=e,n?[4,this.proxy(o)]:[3,2]);case 1:o=s.sent(),s.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(g,v){var T=new Image;T.onload=function(){return g(T)},T.onerror=v,(Dce(o)||r)&&(T.crossOrigin="anonymous"),T.src=o,T.complete===!0&&setTimeout(function(){return g(T)},500),l._options.imageTimeout>0&&setTimeout(function(){return v("Timed out ("+l._options.imageTimeout+"ms) loading image")},l._options.imageTimeout)})];case 3:return[2,s.sent()]}})})},i.prototype.has=function(e){return typeof this._cache[e]<"u"},i.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},i.prototype.proxy=function(e){var t=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var n=e.substring(0,256);return new Promise(function(o,l){var s=al.SUPPORT_RESPONSE_TYPE?"blob":"text",g=new XMLHttpRequest;g.onload=function(){if(g.status===200)if(s==="text")o(g.response);else{var F=new FileReader;F.addEventListener("load",function(){return o(F.result)},!1),F.addEventListener("error",function(R){return l(R)},!1),F.readAsDataURL(g.response)}else l("Failed to proxy resource "+n+" with status code "+g.status)},g.onerror=l;var v=r.indexOf("?")>-1?"&":"?";if(g.open("GET",""+r+v+"url="+encodeURIComponent(e)+"&responseType="+s),s!=="text"&&g instanceof XMLHttpRequest&&(g.responseType=s),t._options.imageTimeout){var T=t._options.imageTimeout;g.timeout=T,g.ontimeout=function(){return l("Timed out ("+T+"ms) proxying "+n)}}g.send()})},i}(),Lce=/^data:image\/svg\+xml/i,Mce=/^data:image\/.*;base64,/i,Pce=/^data:image\/.*/i,Fce=function(i){return al.SUPPORT_SVG_DRAWING||!Rce(i)},PE=function(i){return Pce.test(i)},Dce=function(i){return Mce.test(i)},FE=function(i){return i.substr(0,4)==="blob"},Rce=function(i){return i.substr(-3).toLowerCase()==="svg"||Lce.test(i)},Ji=function(){function i(e,t){this.type=0,this.x=e,this.y=t}return i.prototype.add=function(e,t){return new i(this.x+e,this.y+t)},i}(),jg=function(i,e,t){return new Ji(i.x+(e.x-i.x)*t,i.y+(e.y-i.y)*t)},Jv=function(){function i(e,t,r,n){this.type=1,this.start=e,this.startControl=t,this.endControl=r,this.end=n}return i.prototype.subdivide=function(e,t){var r=jg(this.start,this.startControl,e),n=jg(this.startControl,this.endControl,e),o=jg(this.endControl,this.end,e),l=jg(r,n,e),s=jg(n,o,e),g=jg(l,s,e);return t?new i(this.start,r,l,g):new i(g,s,o,this.end)},i.prototype.add=function(e,t){return new i(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},i.prototype.reverse=function(){return new i(this.end,this.endControl,this.startControl,this.start)},i}(),Fu=function(i){return i.type===1},kce=function(){function i(e){var t=e.styles,r=e.bounds,n=n0(t.borderTopLeftRadius,r.width,r.height),o=n[0],l=n[1],s=n0(t.borderTopRightRadius,r.width,r.height),g=s[0],v=s[1],T=n0(t.borderBottomRightRadius,r.width,r.height),F=T[0],R=T[1],U=n0(t.borderBottomLeftRadius,r.width,r.height),J=U[0],te=U[1],Ae=[];Ae.push((o+g)/r.width),Ae.push((J+F)/r.width),Ae.push((l+te)/r.height),Ae.push((v+R)/r.height);var he=Math.max.apply(Math,Ae);he>1&&(o/=he,l/=he,g/=he,v/=he,F/=he,R/=he,J/=he,te/=he);var pe=r.width-g,be=r.height-R,Te=r.width-F,qe=r.height-te,je=t.borderTopWidth,We=t.borderRightWidth,Ne=t.borderBottomWidth,at=t.borderLeftWidth,nt=Vs(t.paddingTop,e.bounds.width),ke=Vs(t.paddingRight,e.bounds.width),De=Vs(t.paddingBottom,e.bounds.width),Ye=Vs(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=o>0||l>0?oo(r.left+at/3,r.top+je/3,o-at/3,l-je/3,ls.TOP_LEFT):new Ji(r.left+at/3,r.top+je/3),this.topRightBorderDoubleOuterBox=o>0||l>0?oo(r.left+pe,r.top+je/3,g-We/3,v-je/3,ls.TOP_RIGHT):new Ji(r.left+r.width-We/3,r.top+je/3),this.bottomRightBorderDoubleOuterBox=F>0||R>0?oo(r.left+Te,r.top+be,F-We/3,R-Ne/3,ls.BOTTOM_RIGHT):new Ji(r.left+r.width-We/3,r.top+r.height-Ne/3),this.bottomLeftBorderDoubleOuterBox=J>0||te>0?oo(r.left+at/3,r.top+qe,J-at/3,te-Ne/3,ls.BOTTOM_LEFT):new Ji(r.left+at/3,r.top+r.height-Ne/3),this.topLeftBorderDoubleInnerBox=o>0||l>0?oo(r.left+at*2/3,r.top+je*2/3,o-at*2/3,l-je*2/3,ls.TOP_LEFT):new Ji(r.left+at*2/3,r.top+je*2/3),this.topRightBorderDoubleInnerBox=o>0||l>0?oo(r.left+pe,r.top+je*2/3,g-We*2/3,v-je*2/3,ls.TOP_RIGHT):new Ji(r.left+r.width-We*2/3,r.top+je*2/3),this.bottomRightBorderDoubleInnerBox=F>0||R>0?oo(r.left+Te,r.top+be,F-We*2/3,R-Ne*2/3,ls.BOTTOM_RIGHT):new Ji(r.left+r.width-We*2/3,r.top+r.height-Ne*2/3),this.bottomLeftBorderDoubleInnerBox=J>0||te>0?oo(r.left+at*2/3,r.top+qe,J-at*2/3,te-Ne*2/3,ls.BOTTOM_LEFT):new Ji(r.left+at*2/3,r.top+r.height-Ne*2/3),this.topLeftBorderStroke=o>0||l>0?oo(r.left+at/2,r.top+je/2,o-at/2,l-je/2,ls.TOP_LEFT):new Ji(r.left+at/2,r.top+je/2),this.topRightBorderStroke=o>0||l>0?oo(r.left+pe,r.top+je/2,g-We/2,v-je/2,ls.TOP_RIGHT):new Ji(r.left+r.width-We/2,r.top+je/2),this.bottomRightBorderStroke=F>0||R>0?oo(r.left+Te,r.top+be,F-We/2,R-Ne/2,ls.BOTTOM_RIGHT):new Ji(r.left+r.width-We/2,r.top+r.height-Ne/2),this.bottomLeftBorderStroke=J>0||te>0?oo(r.left+at/2,r.top+qe,J-at/2,te-Ne/2,ls.BOTTOM_LEFT):new Ji(r.left+at/2,r.top+r.height-Ne/2),this.topLeftBorderBox=o>0||l>0?oo(r.left,r.top,o,l,ls.TOP_LEFT):new Ji(r.left,r.top),this.topRightBorderBox=g>0||v>0?oo(r.left+pe,r.top,g,v,ls.TOP_RIGHT):new Ji(r.left+r.width,r.top),this.bottomRightBorderBox=F>0||R>0?oo(r.left+Te,r.top+be,F,R,ls.BOTTOM_RIGHT):new Ji(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=J>0||te>0?oo(r.left,r.top+qe,J,te,ls.BOTTOM_LEFT):new Ji(r.left,r.top+r.height),this.topLeftPaddingBox=o>0||l>0?oo(r.left+at,r.top+je,Math.max(0,o-at),Math.max(0,l-je),ls.TOP_LEFT):new Ji(r.left+at,r.top+je),this.topRightPaddingBox=g>0||v>0?oo(r.left+Math.min(pe,r.width-We),r.top+je,pe>r.width+We?0:Math.max(0,g-We),Math.max(0,v-je),ls.TOP_RIGHT):new Ji(r.left+r.width-We,r.top+je),this.bottomRightPaddingBox=F>0||R>0?oo(r.left+Math.min(Te,r.width-at),r.top+Math.min(be,r.height-Ne),Math.max(0,F-We),Math.max(0,R-Ne),ls.BOTTOM_RIGHT):new Ji(r.left+r.width-We,r.top+r.height-Ne),this.bottomLeftPaddingBox=J>0||te>0?oo(r.left+at,r.top+Math.min(qe,r.height-Ne),Math.max(0,J-at),Math.max(0,te-Ne),ls.BOTTOM_LEFT):new Ji(r.left+at,r.top+r.height-Ne),this.topLeftContentBox=o>0||l>0?oo(r.left+at+Ye,r.top+je+nt,Math.max(0,o-(at+Ye)),Math.max(0,l-(je+nt)),ls.TOP_LEFT):new Ji(r.left+at+Ye,r.top+je+nt),this.topRightContentBox=g>0||v>0?oo(r.left+Math.min(pe,r.width+at+Ye),r.top+je+nt,pe>r.width+at+Ye?0:g-at+Ye,v-(je+nt),ls.TOP_RIGHT):new Ji(r.left+r.width-(We+ke),r.top+je+nt),this.bottomRightContentBox=F>0||R>0?oo(r.left+Math.min(Te,r.width-(at+Ye)),r.top+Math.min(be,r.height+je+nt),Math.max(0,F-(We+ke)),R-(Ne+De),ls.BOTTOM_RIGHT):new Ji(r.left+r.width-(We+ke),r.top+r.height-(Ne+De)),this.bottomLeftContentBox=J>0||te>0?oo(r.left+at+Ye,r.top+qe,Math.max(0,J-(at+Ye)),te-(Ne+De),ls.BOTTOM_LEFT):new Ji(r.left+at+Ye,r.top+r.height-(Ne+De))}return i}(),ls;(function(i){i[i.TOP_LEFT=0]="TOP_LEFT",i[i.TOP_RIGHT=1]="TOP_RIGHT",i[i.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",i[i.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(ls||(ls={}));var oo=function(i,e,t,r,n){var o=4*((Math.sqrt(2)-1)/3),l=t*o,s=r*o,g=i+t,v=e+r;switch(n){case ls.TOP_LEFT:return new Jv(new Ji(i,v),new Ji(i,v-s),new Ji(g-l,e),new Ji(g,e));case ls.TOP_RIGHT:return new Jv(new Ji(i,e),new Ji(i+l,e),new Ji(g,v-s),new Ji(g,v));case ls.BOTTOM_RIGHT:return new Jv(new Ji(g,e),new Ji(g,e+s),new Ji(i+l,v),new Ji(i,v));case ls.BOTTOM_LEFT:default:return new Jv(new Ji(g,v),new Ji(g-l,v),new Ji(i,e+s),new Ji(i,e))}},Yv=function(i){return[i.topLeftBorderBox,i.topRightBorderBox,i.bottomRightBorderBox,i.bottomLeftBorderBox]},Oce=function(i){return[i.topLeftContentBox,i.topRightContentBox,i.bottomRightContentBox,i.bottomLeftContentBox]},eb=function(i){return[i.topLeftPaddingBox,i.topRightPaddingBox,i.bottomRightPaddingBox,i.bottomLeftPaddingBox]},Uce=function(){function i(e,t,r){this.offsetX=e,this.offsetY=t,this.matrix=r,this.type=0,this.target=6}return i}(),tb=function(){function i(e,t){this.path=e,this.target=t,this.type=1}return i}(),Nce=function(){function i(e){this.opacity=e,this.type=2,this.target=6}return i}(),zce=function(i){return i.type===0},pk=function(i){return i.type===1},Qce=function(i){return i.type===2},gk=function(i,e){return i.length===e.length?i.some(function(t,r){return t===e[r]}):!1},Vce=function(i,e,t,r,n){return i.map(function(o,l){switch(l){case 0:return o.add(e,t);case 1:return o.add(e+r,t);case 2:return o.add(e+r,t+n);case 3:return o.add(e,t+n)}return o})},mk=function(){function i(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return i}(),yk=function(){function i(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new kce(this.container),this.container.styles.opacity<1&&this.effects.push(new Nce(this.container.styles.opacity)),this.container.styles.transform!==null){var r=this.container.bounds.left+this.container.styles.transformOrigin[0].number,n=this.container.bounds.top+this.container.styles.transformOrigin[1].number,o=this.container.styles.transform;this.effects.push(new Uce(r,n,o))}if(this.container.styles.overflowX!==0){var l=Yv(this.curves),s=eb(this.curves);gk(l,s)?this.effects.push(new tb(l,6)):(this.effects.push(new tb(l,2)),this.effects.push(new tb(s,4)))}}return i.prototype.getEffects=function(e){for(var t=[2,3].indexOf(this.container.styles.position)===-1,r=this.parent,n=this.effects.slice(0);r;){var o=r.effects.filter(function(g){return!pk(g)});if(t||r.container.styles.position!==0||!r.parent){if(n.unshift.apply(n,o),t=[2,3].indexOf(r.container.styles.position)===-1,r.container.styles.overflowX!==0){var l=Yv(r.curves),s=eb(r.curves);gk(l,s)||n.unshift(new tb(s,6))}}else n.unshift.apply(n,o);r=r.parent}return n.filter(function(g){return Ba(g.target,e)})},i}(),DE=function(i,e,t,r){i.container.elements.forEach(function(n){var o=Ba(n.flags,4),l=Ba(n.flags,2),s=new yk(n,i);Ba(n.styles.display,2048)&&r.push(s);var g=Ba(n.flags,8)?[]:r;if(o||l){var v=o||n.styles.isPositioned()?t:e,T=new mk(s);if(n.styles.isPositioned()||n.styles.opacity<1||n.styles.isTransformed()){var F=n.styles.zIndex.order;if(F<0){var R=0;v.negativeZIndex.some(function(J,te){return F>J.element.container.styles.zIndex.order?(R=te,!1):R>0}),v.negativeZIndex.splice(R,0,T)}else if(F>0){var U=0;v.positiveZIndex.some(function(J,te){return F>=J.element.container.styles.zIndex.order?(U=te+1,!1):U>0}),v.positiveZIndex.splice(U,0,T)}else v.zeroOrAutoZIndexOrTransformedOrOpacity.push(T)}else n.styles.isFloating()?v.nonPositionedFloats.push(T):v.nonPositionedInlineLevel.push(T);DE(s,T,o?T:t,g)}else n.styles.isInlineLevel()?e.inlineLevel.push(s):e.nonInlineLevel.push(s),DE(s,e,t,g);Ba(n.flags,8)&&_k(n,g)})},_k=function(i,e){for(var t=i instanceof wE?i.start:1,r=i instanceof wE?i.reversed:!1,n=0;n<e.length;n++){var o=e[n];o.container instanceof GR&&typeof o.container.value=="number"&&o.container.value!==0&&(t=o.container.value),o.listValue=u0(t,o.container.styles.listStyleType,!0),t+=r?-1:1}},Hce=function(i){var e=new yk(i,null),t=new mk(e),r=[];return DE(e,t,t,r),_k(e.container,r),t},vk=function(i,e){switch(e){case 0:return Du(i.topLeftBorderBox,i.topLeftPaddingBox,i.topRightBorderBox,i.topRightPaddingBox);case 1:return Du(i.topRightBorderBox,i.topRightPaddingBox,i.bottomRightBorderBox,i.bottomRightPaddingBox);case 2:return Du(i.bottomRightBorderBox,i.bottomRightPaddingBox,i.bottomLeftBorderBox,i.bottomLeftPaddingBox);case 3:default:return Du(i.bottomLeftBorderBox,i.bottomLeftPaddingBox,i.topLeftBorderBox,i.topLeftPaddingBox)}},Gce=function(i,e){switch(e){case 0:return Du(i.topLeftBorderBox,i.topLeftBorderDoubleOuterBox,i.topRightBorderBox,i.topRightBorderDoubleOuterBox);case 1:return Du(i.topRightBorderBox,i.topRightBorderDoubleOuterBox,i.bottomRightBorderBox,i.bottomRightBorderDoubleOuterBox);case 2:return Du(i.bottomRightBorderBox,i.bottomRightBorderDoubleOuterBox,i.bottomLeftBorderBox,i.bottomLeftBorderDoubleOuterBox);case 3:default:return Du(i.bottomLeftBorderBox,i.bottomLeftBorderDoubleOuterBox,i.topLeftBorderBox,i.topLeftBorderDoubleOuterBox)}},jce=function(i,e){switch(e){case 0:return Du(i.topLeftBorderDoubleInnerBox,i.topLeftPaddingBox,i.topRightBorderDoubleInnerBox,i.topRightPaddingBox);case 1:return Du(i.topRightBorderDoubleInnerBox,i.topRightPaddingBox,i.bottomRightBorderDoubleInnerBox,i.bottomRightPaddingBox);case 2:return Du(i.bottomRightBorderDoubleInnerBox,i.bottomRightPaddingBox,i.bottomLeftBorderDoubleInnerBox,i.bottomLeftPaddingBox);case 3:default:return Du(i.bottomLeftBorderDoubleInnerBox,i.bottomLeftPaddingBox,i.topLeftBorderDoubleInnerBox,i.topLeftPaddingBox)}},qce=function(i,e){switch(e){case 0:return ib(i.topLeftBorderStroke,i.topRightBorderStroke);case 1:return ib(i.topRightBorderStroke,i.bottomRightBorderStroke);case 2:return ib(i.bottomRightBorderStroke,i.bottomLeftBorderStroke);case 3:default:return ib(i.bottomLeftBorderStroke,i.topLeftBorderStroke)}},ib=function(i,e){var t=[];return Fu(i)?t.push(i.subdivide(.5,!1)):t.push(i),Fu(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},Du=function(i,e,t,r){var n=[];return Fu(i)?n.push(i.subdivide(.5,!1)):n.push(i),Fu(t)?n.push(t.subdivide(.5,!0)):n.push(t),Fu(r)?n.push(r.subdivide(.5,!0).reverse()):n.push(r),Fu(e)?n.push(e.subdivide(.5,!1).reverse()):n.push(e),n},bk=function(i){var e=i.bounds,t=i.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))},rb=function(i){var e=i.styles,t=i.bounds,r=Vs(e.paddingLeft,t.width),n=Vs(e.paddingRight,t.width),o=Vs(e.paddingTop,t.width),l=Vs(e.paddingBottom,t.width);return t.add(r+e.borderLeftWidth,o+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+n),-(e.borderTopWidth+e.borderBottomWidth+o+l))},$ce=function(i,e){return i===0?e.bounds:i===2?rb(e):bk(e)},Kce=function(i,e){return i===0?e.bounds:i===2?rb(e):bk(e)},RE=function(i,e,t){var r=$ce($g(i.styles.backgroundOrigin,e),i),n=Kce($g(i.styles.backgroundClip,e),i),o=Wce($g(i.styles.backgroundSize,e),t,r),l=o[0],s=o[1],g=n0($g(i.styles.backgroundPosition,e),r.width-l,r.height-s),v=Zce($g(i.styles.backgroundRepeat,e),g,o,r,n),T=Math.round(r.left+g[0]),F=Math.round(r.top+g[1]);return[v,T,F,l,s]},qg=function(i){return ws(i)&&i.value===Qg.AUTO},nb=function(i){return typeof i=="number"},Wce=function(i,e,t){var r=e[0],n=e[1],o=e[2],l=i[0],s=i[1];if(!l)return[0,0];if(oa(l)&&s&&oa(s))return[Vs(l,t.width),Vs(s,t.height)];var g=nb(o);if(ws(l)&&(l.value===Qg.CONTAIN||l.value===Qg.COVER)){if(nb(o)){var v=t.width/t.height;return v<o!=(l.value===Qg.COVER)?[t.width,t.width/o]:[t.height*o,t.height]}return[t.width,t.height]}var T=nb(r),F=nb(n),R=T||F;if(qg(l)&&(!s||qg(s))){if(T&&F)return[r,n];if(!g&&!R)return[t.width,t.height];if(R&&g){var U=T?r:n*o,J=F?n:r/o;return[U,J]}var te=T?r:t.width,Ae=F?n:t.height;return[te,Ae]}if(g){var he=0,pe=0;return oa(l)?he=Vs(l,t.width):oa(s)&&(pe=Vs(s,t.height)),qg(l)?he=pe*o:(!s||qg(s))&&(pe=he/o),[he,pe]}var be=null,Te=null;if(oa(l)?be=Vs(l,t.width):s&&oa(s)&&(Te=Vs(s,t.height)),be!==null&&(!s||qg(s))&&(Te=T&&F?be/r*n:t.height),Te!==null&&qg(l)&&(be=T&&F?Te/n*r:t.width),be!==null&&Te!==null)return[be,Te];throw new Error("Unable to calculate background-size for element")},$g=function(i,e){var t=i[e];return typeof t>"u"?i[0]:t},Zce=function(i,e,t,r,n){var o=e[0],l=e[1],s=t[0],g=t[1];switch(i){case 2:return[new Ji(Math.round(r.left),Math.round(r.top+l)),new Ji(Math.round(r.left+r.width),Math.round(r.top+l)),new Ji(Math.round(r.left+r.width),Math.round(g+r.top+l)),new Ji(Math.round(r.left),Math.round(g+r.top+l))];case 3:return[new Ji(Math.round(r.left+o),Math.round(r.top)),new Ji(Math.round(r.left+o+s),Math.round(r.top)),new Ji(Math.round(r.left+o+s),Math.round(r.height+r.top)),new Ji(Math.round(r.left+o),Math.round(r.height+r.top))];case 1:return[new Ji(Math.round(r.left+o),Math.round(r.top+l)),new Ji(Math.round(r.left+o+s),Math.round(r.top+l)),new Ji(Math.round(r.left+o+s),Math.round(r.top+l+g)),new Ji(Math.round(r.left+o),Math.round(r.top+l+g))];default:return[new Ji(Math.round(n.left),Math.round(n.top)),new Ji(Math.round(n.left+n.width),Math.round(n.top)),new Ji(Math.round(n.left+n.width),Math.round(n.height+n.top)),new Ji(Math.round(n.left),Math.round(n.height+n.top))]}},Xce="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",xk="Hidden Text",Jce=function(){function i(e){this._data={},this._document=e}return i.prototype.parseMetrics=function(e,t){var r=this._document.createElement("div"),n=this._document.createElement("img"),o=this._document.createElement("span"),l=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",r.style.whiteSpace="nowrap",l.appendChild(r),n.src=Xce,n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",o.style.fontFamily=e,o.style.fontSize=t,o.style.margin="0",o.style.padding="0",o.appendChild(this._document.createTextNode(xk)),r.appendChild(o),r.appendChild(n);var s=n.offsetTop-o.offsetTop+2;r.removeChild(o),r.appendChild(this._document.createTextNode(xk)),r.style.lineHeight="normal",n.style.verticalAlign="super";var g=n.offsetTop-r.offsetTop+2;return l.removeChild(r),{baseline:s,middle:g}},i.prototype.getMetrics=function(e,t){var r=e+" "+t;return typeof this._data[r]>"u"&&(this._data[r]=this.parseMetrics(e,t)),this._data[r]},i}(),wk=function(){function i(e,t){this.context=e,this.options=t}return i}(),Yce=1e4,eue=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n._activeEffects=[],n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),r.canvas||(n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px"),n.fontMetrics=new Jce(document),n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.ctx.textBaseline="bottom",n._activeEffects=[],n.context.logger.debug("Canvas renderer initialized ("+r.width+"x"+r.height+") with scale "+r.scale),n}return e.prototype.applyEffects=function(t){for(var r=this;this._activeEffects.length;)this.popEffect();t.forEach(function(n){return r.applyEffect(n)})},e.prototype.applyEffect=function(t){this.ctx.save(),Qce(t)&&(this.ctx.globalAlpha=t.opacity),zce(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),pk(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(t){return hc(this,void 0,void 0,function(){var r;return kl(this,function(n){switch(n.label){case 0:return r=t.element.container.styles,r.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(t){return hc(this,void 0,void 0,function(){return kl(this,function(r){switch(r.label){case 0:if(Ba(t.container.flags,16))debugger;return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return r.sent(),[4,this.renderNodeContent(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(t,r,n){var o=this;if(r===0)this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+n);else{var l=xE(t.text);l.reduce(function(s,g){return o.ctx.fillText(g,s,t.bounds.top+n),s+o.ctx.measureText(g).width},t.bounds.left)}},e.prototype.createFontStyle=function(t){var r=t.fontVariant.filter(function(l){return l==="normal"||l==="small-caps"}).join(""),n=sue(t.fontFamily).join(", "),o=r0(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,r,t.fontWeight,o,n].join(" "),n,o]},e.prototype.renderTextNode=function(t,r){return hc(this,void 0,void 0,function(){var n,o,l,s,g,v,T,F,R=this;return kl(this,function(U){return n=this.createFontStyle(r),o=n[0],l=n[1],s=n[2],this.ctx.font=o,this.ctx.direction=r.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",g=this.fontMetrics.getMetrics(l,s),v=g.baseline,T=g.middle,F=r.paintOrder,t.textBounds.forEach(function(J){F.forEach(function(te){switch(te){case 0:R.ctx.fillStyle=Ga(r.color),R.renderTextWithLetterSpacing(J,r.letterSpacing,v);var Ae=r.textShadow;Ae.length&&J.text.trim().length&&(Ae.slice(0).reverse().forEach(function(he){R.ctx.shadowColor=Ga(he.color),R.ctx.shadowOffsetX=he.offsetX.number*R.options.scale,R.ctx.shadowOffsetY=he.offsetY.number*R.options.scale,R.ctx.shadowBlur=he.blur.number,R.renderTextWithLetterSpacing(J,r.letterSpacing,v)}),R.ctx.shadowColor="",R.ctx.shadowOffsetX=0,R.ctx.shadowOffsetY=0,R.ctx.shadowBlur=0),r.textDecorationLine.length&&(R.ctx.fillStyle=Ga(r.textDecorationColor||r.color),r.textDecorationLine.forEach(function(he){switch(he){case 1:R.ctx.fillRect(J.bounds.left,Math.round(J.bounds.top+v),J.bounds.width,1);break;case 2:R.ctx.fillRect(J.bounds.left,Math.round(J.bounds.top),J.bounds.width,1);break;case 3:R.ctx.fillRect(J.bounds.left,Math.ceil(J.bounds.top+T),J.bounds.width,1);break}}));break;case 1:r.webkitTextStrokeWidth&&J.text.trim().length&&(R.ctx.strokeStyle=Ga(r.webkitTextStrokeColor),R.ctx.lineWidth=r.webkitTextStrokeWidth,R.ctx.lineJoin=window.chrome?"miter":"round",R.ctx.strokeText(J.text,J.bounds.left,J.bounds.top+v)),R.ctx.strokeStyle="",R.ctx.lineWidth=0,R.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(t,r,n){if(n&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var o=rb(t),l=eb(r);this.path(l),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,t.intrinsicWidth,t.intrinsicHeight,o.left,o.top,o.width,o.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return hc(this,void 0,void 0,function(){var r,n,o,l,s,g,pe,pe,v,T,F,R,Te,U,J,qe,te,Ae,he,pe,be,Te,qe;return kl(this,function(je){switch(je.label){case 0:this.applyEffects(t.getEffects(4)),r=t.container,n=t.curves,o=r.styles,l=0,s=r.textNodes,je.label=1;case 1:return l<s.length?(g=s[l],[4,this.renderTextNode(g,o)]):[3,4];case 2:je.sent(),je.label=3;case 3:return l++,[3,1];case 4:if(!(r instanceof QR))return[3,8];je.label=5;case 5:return je.trys.push([5,7,,8]),[4,this.context.cache.match(r.src)];case 6:return pe=je.sent(),this.renderReplacedElement(r,n,pe),[3,8];case 7:return je.sent(),this.context.logger.error("Error loading image "+r.src),[3,8];case 8:if(r instanceof VR&&this.renderReplacedElement(r,n,r.canvas),!(r instanceof HR))return[3,12];je.label=9;case 9:return je.trys.push([9,11,,12]),[4,this.context.cache.match(r.svg)];case 10:return pe=je.sent(),this.renderReplacedElement(r,n,pe),[3,12];case 11:return je.sent(),this.context.logger.error("Error loading svg "+r.svg.substring(0,255)),[3,12];case 12:return r instanceof KR&&r.tree?(v=new e(this.context,{scale:this.options.scale,backgroundColor:r.backgroundColor,x:0,y:0,width:r.width,height:r.height}),[4,v.render(r.tree)]):[3,14];case 13:T=je.sent(),r.width&&r.height&&this.ctx.drawImage(T,0,0,r.width,r.height,r.bounds.left,r.bounds.top,r.bounds.width,r.bounds.height),je.label=14;case 14:if(r instanceof BE&&(F=Math.min(r.bounds.width,r.bounds.height),r.type===qv?r.checked&&(this.ctx.save(),this.path([new Ji(r.bounds.left+F*.39363,r.bounds.top+F*.79),new Ji(r.bounds.left+F*.16,r.bounds.top+F*.5549),new Ji(r.bounds.left+F*.27347,r.bounds.top+F*.44071),new Ji(r.bounds.left+F*.39694,r.bounds.top+F*.5649),new Ji(r.bounds.left+F*.72983,r.bounds.top+F*.23),new Ji(r.bounds.left+F*.84,r.bounds.top+F*.34085),new Ji(r.bounds.left+F*.39363,r.bounds.top+F*.79)]),this.ctx.fillStyle=Ga(jR),this.ctx.fill(),this.ctx.restore()):r.type===$v&&r.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.bounds.left+F/2,r.bounds.top+F/2,F/4,0,Math.PI*2,!0),this.ctx.fillStyle=Ga(jR),this.ctx.fill(),this.ctx.restore())),tue(r)&&r.value.length){switch(R=this.createFontStyle(o),Te=R[0],U=R[1],J=this.fontMetrics.getMetrics(Te,U).baseline,this.ctx.font=Te,this.ctx.fillStyle=Ga(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=rue(r.styles.textAlign),qe=rb(r),te=0,r.styles.textAlign){case 1:te+=qe.width/2;break;case 2:te+=qe.width;break}Ae=qe.add(te,0,0,-qe.height/2+1),this.ctx.save(),this.path([new Ji(qe.left,qe.top),new Ji(qe.left+qe.width,qe.top),new Ji(qe.left+qe.width,qe.top+qe.height),new Ji(qe.left,qe.top+qe.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new l0(r.value,Ae),o.letterSpacing,J),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ba(r.styles.display,2048))return[3,20];if(r.styles.listStyleImage===null)return[3,19];if(he=r.styles.listStyleImage,he.type!==0)return[3,18];pe=void 0,be=he.url,je.label=15;case 15:return je.trys.push([15,17,,18]),[4,this.context.cache.match(be)];case 16:return pe=je.sent(),this.ctx.drawImage(pe,r.bounds.left-(pe.width+10),r.bounds.top),[3,18];case 17:return je.sent(),this.context.logger.error("Error loading list-style-image "+be),[3,18];case 18:return[3,20];case 19:t.listValue&&r.styles.listStyleType!==-1&&(Te=this.createFontStyle(o)[0],this.ctx.font=Te,this.ctx.fillStyle=Ga(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",qe=new FA(r.bounds.left,r.bounds.top+Vs(r.styles.paddingTop,r.bounds.width),r.bounds.width,bR(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new l0(t.listValue,qe),o.letterSpacing,bR(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),je.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(t){return hc(this,void 0,void 0,function(){var r,n,he,o,l,he,s,g,he,v,T,he,F,R,he,U,J,he,te,Ae,he;return kl(this,function(pe){switch(pe.label){case 0:if(Ba(t.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:pe.sent(),r=0,n=t.negativeZIndex,pe.label=2;case 2:return r<n.length?(he=n[r],[4,this.renderStack(he)]):[3,5];case 3:pe.sent(),pe.label=4;case 4:return r++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:pe.sent(),o=0,l=t.nonInlineLevel,pe.label=7;case 7:return o<l.length?(he=l[o],[4,this.renderNode(he)]):[3,10];case 8:pe.sent(),pe.label=9;case 9:return o++,[3,7];case 10:s=0,g=t.nonPositionedFloats,pe.label=11;case 11:return s<g.length?(he=g[s],[4,this.renderStack(he)]):[3,14];case 12:pe.sent(),pe.label=13;case 13:return s++,[3,11];case 14:v=0,T=t.nonPositionedInlineLevel,pe.label=15;case 15:return v<T.length?(he=T[v],[4,this.renderStack(he)]):[3,18];case 16:pe.sent(),pe.label=17;case 17:return v++,[3,15];case 18:F=0,R=t.inlineLevel,pe.label=19;case 19:return F<R.length?(he=R[F],[4,this.renderNode(he)]):[3,22];case 20:pe.sent(),pe.label=21;case 21:return F++,[3,19];case 22:U=0,J=t.zeroOrAutoZIndexOrTransformedOrOpacity,pe.label=23;case 23:return U<J.length?(he=J[U],[4,this.renderStack(he)]):[3,26];case 24:pe.sent(),pe.label=25;case 25:return U++,[3,23];case 26:te=0,Ae=t.positiveZIndex,pe.label=27;case 27:return te<Ae.length?(he=Ae[te],[4,this.renderStack(he)]):[3,30];case 28:pe.sent(),pe.label=29;case 29:return te++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},e.prototype.formatPath=function(t){var r=this;t.forEach(function(n,o){var l=Fu(n)?n.start:n;o===0?r.ctx.moveTo(l.x,l.y):r.ctx.lineTo(l.x,l.y),Fu(n)&&r.ctx.bezierCurveTo(n.startControl.x,n.startControl.y,n.endControl.x,n.endControl.y,n.end.x,n.end.y)})},e.prototype.renderRepeat=function(t,r,n,o){this.path(t),this.ctx.fillStyle=r,this.ctx.translate(n,o),this.ctx.fill(),this.ctx.translate(-n,-o)},e.prototype.resizeImage=function(t,r,n){var o;if(t.width===r&&t.height===n)return t;var l=(o=this.canvas.ownerDocument)!==null&&o!==void 0?o:document,s=l.createElement("canvas");s.width=Math.max(1,r),s.height=Math.max(1,n);var g=s.getContext("2d");return g.drawImage(t,0,0,t.width,t.height,0,0,r,n),s},e.prototype.renderBackgroundImage=function(t){return hc(this,void 0,void 0,function(){var r,n,o,l,s,g;return kl(this,function(v){switch(v.label){case 0:r=t.styles.backgroundImage.length-1,n=function(T){var F,R,U,nt,Et,Pt,Ye,Ze,Ne,J,nt,Et,Pt,Ye,Ze,te,Ae,he,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Ze,Ct,Et,Pt,bt,Rt,Ft,Xt,Le,Xe,it,pt;return kl(this,function(mt){switch(mt.label){case 0:if(T.type!==0)return[3,5];F=void 0,R=T.url,mt.label=1;case 1:return mt.trys.push([1,3,,4]),[4,o.context.cache.match(R)];case 2:return F=mt.sent(),[3,4];case 3:return mt.sent(),o.context.logger.error("Error loading background-image "+R),[3,4];case 4:return F&&(U=RE(t,r,[F.width,F.height,F.width/F.height]),nt=U[0],Et=U[1],Pt=U[2],Ye=U[3],Ze=U[4],Ne=o.ctx.createPattern(o.resizeImage(F,Ye,Ze),"repeat"),o.renderRepeat(nt,Ne,Et,Pt)),[3,6];case 5:zoe(T)?(J=RE(t,r,[null,null,null]),nt=J[0],Et=J[1],Pt=J[2],Ye=J[3],Ze=J[4],te=Roe(T.angle,Ye,Ze),Ae=te[0],he=te[1],pe=te[2],be=te[3],Te=te[4],qe=document.createElement("canvas"),qe.width=Ye,qe.height=Ze,je=qe.getContext("2d"),We=je.createLinearGradient(he,be,pe,Te),uR(T.stops,Ae).forEach(function(Bt){return We.addColorStop(Bt.stop,Ga(Bt.color))}),je.fillStyle=We,je.fillRect(0,0,Ye,Ze),Ye>0&&Ze>0&&(Ne=o.ctx.createPattern(qe,"repeat"),o.renderRepeat(nt,Ne,Et,Pt))):Qoe(T)&&(at=RE(t,r,[null,null,null]),nt=at[0],ke=at[1],De=at[2],Ye=at[3],Ze=at[4],Ct=T.position.length===0?[lE]:T.position,Et=Vs(Ct[0],Ye),Pt=Vs(Ct[Ct.length-1],Ze),bt=koe(T,Et,Pt,Ye,Ze),Rt=bt[0],Ft=bt[1],Rt>0&&Ft>0&&(Xt=o.ctx.createRadialGradient(ke+Et,De+Pt,0,ke+Et,De+Pt,Rt),uR(T.stops,Rt*2).forEach(function(Bt){return Xt.addColorStop(Bt.stop,Ga(Bt.color))}),o.path(nt),o.ctx.fillStyle=Xt,Rt!==Ft?(Le=t.bounds.left+.5*t.bounds.width,Xe=t.bounds.top+.5*t.bounds.height,it=Ft/Rt,pt=1/it,o.ctx.save(),o.ctx.translate(Le,Xe),o.ctx.transform(1,0,0,it,0,0),o.ctx.translate(-Le,-Xe),o.ctx.fillRect(ke,pt*(De-Xe)+Xe,Ye,Ze*pt),o.ctx.restore()):o.ctx.fill())),mt.label=6;case 6:return r--,[2]}})},o=this,l=0,s=t.styles.backgroundImage.slice(0).reverse(),v.label=1;case 1:return l<s.length?(g=s[l],[5,n(g)]):[3,4];case 2:v.sent(),v.label=3;case 3:return l++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(t,r,n){return hc(this,void 0,void 0,function(){return kl(this,function(o){return this.path(vk(n,r)),this.ctx.fillStyle=Ga(t),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(t,r,n,o){return hc(this,void 0,void 0,function(){var l,s;return kl(this,function(g){switch(g.label){case 0:return r<3?[4,this.renderSolidBorder(t,n,o)]:[3,2];case 1:return g.sent(),[2];case 2:return l=Gce(o,n),this.path(l),this.ctx.fillStyle=Ga(t),this.ctx.fill(),s=jce(o,n),this.path(s),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(t){return hc(this,void 0,void 0,function(){var r,n,o,l,s,g,v,T,F=this;return kl(this,function(R){switch(R.label){case 0:return this.applyEffects(t.getEffects(2)),r=t.container.styles,n=!Sd(r.backgroundColor)||r.backgroundImage.length,o=[{style:r.borderTopStyle,color:r.borderTopColor,width:r.borderTopWidth},{style:r.borderRightStyle,color:r.borderRightColor,width:r.borderRightWidth},{style:r.borderBottomStyle,color:r.borderBottomColor,width:r.borderBottomWidth},{style:r.borderLeftStyle,color:r.borderLeftColor,width:r.borderLeftWidth}],l=iue($g(r.backgroundClip,0),t.curves),n||r.boxShadow.length?(this.ctx.save(),this.path(l),this.ctx.clip(),Sd(r.backgroundColor)||(this.ctx.fillStyle=Ga(r.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:R.sent(),this.ctx.restore(),r.boxShadow.slice(0).reverse().forEach(function(U){F.ctx.save();var J=Yv(t.curves),te=U.inset?0:Yce,Ae=Vce(J,-te+(U.inset?1:-1)*U.spread.number,(U.inset?1:-1)*U.spread.number,U.spread.number*(U.inset?-2:2),U.spread.number*(U.inset?-2:2));U.inset?(F.path(J),F.ctx.clip(),F.mask(Ae)):(F.mask(J),F.ctx.clip(),F.path(Ae)),F.ctx.shadowOffsetX=U.offsetX.number+te,F.ctx.shadowOffsetY=U.offsetY.number,F.ctx.shadowColor=Ga(U.color),F.ctx.shadowBlur=U.blur.number,F.ctx.fillStyle=U.inset?Ga(U.color):"rgba(0,0,0,1)",F.ctx.fill(),F.ctx.restore()}),R.label=2;case 2:s=0,g=0,v=o,R.label=3;case 3:return g<v.length?(T=v[g],T.style!==0&&!Sd(T.color)&&T.width>0?T.style!==2?[3,5]:[4,this.renderDashedDottedBorder(T.color,T.width,s,t.curves,2)]:[3,11]):[3,13];case 4:return R.sent(),[3,11];case 5:return T.style!==3?[3,7]:[4,this.renderDashedDottedBorder(T.color,T.width,s,t.curves,3)];case 6:return R.sent(),[3,11];case 7:return T.style!==4?[3,9]:[4,this.renderDoubleBorder(T.color,T.width,s,t.curves)];case 8:return R.sent(),[3,11];case 9:return[4,this.renderSolidBorder(T.color,s,t.curves)];case 10:R.sent(),R.label=11;case 11:s++,R.label=12;case 12:return g++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(t,r,n,o,l){return hc(this,void 0,void 0,function(){var s,g,v,T,F,R,U,J,te,Ae,he,pe,be,Te,qe,je,qe,je;return kl(this,function(We){return this.ctx.save(),s=qce(o,n),g=vk(o,n),l===2&&(this.path(g),this.ctx.clip()),Fu(g[0])?(v=g[0].start.x,T=g[0].start.y):(v=g[0].x,T=g[0].y),Fu(g[1])?(F=g[1].end.x,R=g[1].end.y):(F=g[1].x,R=g[1].y),n===0||n===2?U=Math.abs(v-F):U=Math.abs(T-R),this.ctx.beginPath(),l===3?this.formatPath(s):this.formatPath(g.slice(0,2)),J=r<3?r*3:r*2,te=r<3?r*2:r,l===3&&(J=r,te=r),Ae=!0,U<=J*2?Ae=!1:U<=J*2+te?(he=U/(2*J+te),J*=he,te*=he):(pe=Math.floor((U+te)/(J+te)),be=(U-pe*J)/(pe-1),Te=(U-(pe+1)*J)/pe,te=Te<=0||Math.abs(te-be)<Math.abs(te-Te)?be:Te),Ae&&(l===3?this.ctx.setLineDash([0,J+te]):this.ctx.setLineDash([J,te])),l===3?(this.ctx.lineCap="round",this.ctx.lineWidth=r):this.ctx.lineWidth=r*2+1.1,this.ctx.strokeStyle=Ga(t),this.ctx.stroke(),this.ctx.setLineDash([]),l===2&&(Fu(g[0])&&(qe=g[3],je=g[0],this.ctx.beginPath(),this.formatPath([new Ji(qe.end.x,qe.end.y),new Ji(je.start.x,je.start.y)]),this.ctx.stroke()),Fu(g[1])&&(qe=g[1],je=g[2],this.ctx.beginPath(),this.formatPath([new Ji(qe.end.x,qe.end.y),new Ji(je.start.x,je.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(t){return hc(this,void 0,void 0,function(){var r;return kl(this,function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Ga(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),r=Hce(t),[4,this.renderStack(r)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(wk),tue=function(i){return i instanceof $R||i instanceof qR?!0:i instanceof BE&&i.type!==$v&&i.type!==qv},iue=function(i,e){switch(i){case 0:return Yv(e);case 2:return Oce(e);case 1:default:return eb(e)}},rue=function(i){switch(i){case 1:return"center";case 2:return"right";case 0:default:return"left"}},nue=["-apple-system","system-ui"],sue=function(i){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?i.filter(function(e){return nue.indexOf(e)===-1}):i},oue=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),n.options=r,n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px",n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+r.width+"x"+r.height+" at "+r.x+","+r.y+") with scale "+r.scale),n}return e.prototype.render=function(t){return hc(this,void 0,void 0,function(){var r,n;return kl(this,function(o){switch(o.label){case 0:return r=bE(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,aue(r)];case 1:return n=o.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Ga(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(wk),aue=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(i))})},lue=function(){function i(e){var t=e.id,r=e.enabled;this.id=t,this.enabled=r,this.start=Date.now()}return i.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,Av([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.prototype.getTime=function(){return Date.now()-this.start},i.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,Av([this.id,this.getTime()+"ms"],e))},i.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,Av([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,Av([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.instances={},i}(),cue=function(){function i(e,t){var r;this.windowBounds=t,this.instanceName="#"+i.instanceCount++,this.logger=new lue({id:this.instanceName,enabled:e.logging}),this.cache=(r=e.cache)!==null&&r!==void 0?r:new Ice(this,e)}return i.instanceCount=1,i}(),uue=function(i,e){return e===void 0&&(e={}),hue(i,e)};typeof window<"u"&&fk.setContext(window);var hue=function(i,e){return hc(void 0,void 0,void 0,function(){var t,r,n,o,l,s,g,v,T,F,R,U,J,te,Ae,he,pe,be,Te,qe,We,je,We,Ne,at,nt,ke,De,Ye,Ze,Ct,Et,Pt,bt,Rt,Ft,Xt,Le,Xe,it;return kl(this,function(pt){switch(pt.label){case 0:if(!i||typeof i!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(t=i.ownerDocument,!t)throw new Error("Element is not attached to a Document");if(r=t.defaultView,!r)throw new Error("Document is not attached to a Window");return n={allowTaint:(Ne=e.allowTaint)!==null&&Ne!==void 0?Ne:!1,imageTimeout:(at=e.imageTimeout)!==null&&at!==void 0?at:15e3,proxy:e.proxy,useCORS:(nt=e.useCORS)!==null&&nt!==void 0?nt:!1},o=QC({logging:(ke=e.logging)!==null&&ke!==void 0?ke:!0,cache:e.cache},n),l={windowWidth:(De=e.windowWidth)!==null&&De!==void 0?De:r.innerWidth,windowHeight:(Ye=e.windowHeight)!==null&&Ye!==void 0?Ye:r.innerHeight,scrollX:(Ze=e.scrollX)!==null&&Ze!==void 0?Ze:r.pageXOffset,scrollY:(Ct=e.scrollY)!==null&&Ct!==void 0?Ct:r.pageYOffset},s=new FA(l.scrollX,l.scrollY,l.windowWidth,l.windowHeight),g=new cue(o,s),v=(Et=e.foreignObjectRendering)!==null&&Et!==void 0?Et:!1,T={allowTaint:(Pt=e.allowTaint)!==null&&Pt!==void 0?Pt:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:v,copyStyles:v},g.logger.debug("Starting document clone with size "+s.width+"x"+s.height+" scrolled to "+-s.left+","+-s.top),F=new Ak(g,i,T),R=F.clonedReferenceElement,R?[4,F.toIFrame(t,s)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return U=pt.sent(),J=EE(R)||Ace(R)?Vne(R.ownerDocument):dv(g,R),te=J.width,Ae=J.height,he=J.left,pe=J.top,be=Aue(g,R,e.backgroundColor),Te={canvas:e.canvas,backgroundColor:be,scale:(Rt=(bt=e.scale)!==null&&bt!==void 0?bt:r.devicePixelRatio)!==null&&Rt!==void 0?Rt:1,x:((Ft=e.x)!==null&&Ft!==void 0?Ft:0)+he,y:((Xt=e.y)!==null&&Xt!==void 0?Xt:0)+pe,width:(Le=e.width)!==null&&Le!==void 0?Le:Math.ceil(te),height:(Xe=e.height)!==null&&Xe!==void 0?Xe:Math.ceil(Ae)},v?(g.logger.debug("Document cloned, using foreign object rendering"),We=new oue(g,Te),[4,We.render(R)]):[3,3];case 2:return qe=pt.sent(),[3,5];case 3:return g.logger.debug("Document cloned, element located at "+he+","+pe+" with size "+te+"x"+Ae+" using computed rendering"),g.logger.debug("Starting DOM parsing"),je=ZR(g,R),be===je.styles.backgroundColor&&(je.styles.backgroundColor=RA.TRANSPARENT),g.logger.debug("Starting renderer for element at "+Te.x+","+Te.y+" with size "+Te.width+"x"+Te.height),We=new eue(g,Te),[4,We.render(je)];case 4:qe=pt.sent(),pt.label=5;case 5:return(!((it=e.removeContainer)!==null&&it!==void 0)||it)&&(Ak.destroy(U)||g.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),g.logger.debug("Finished rendering"),[2,qe]}})})},Aue=function(i,e,t){var r=e.ownerDocument,n=r.documentElement?s0(i,getComputedStyle(r.documentElement).backgroundColor):RA.TRANSPARENT,o=r.body?s0(i,getComputedStyle(r.body).backgroundColor):RA.TRANSPARENT,l=typeof t=="string"?s0(i,t):t===null?RA.TRANSPARENT:4294967295;return e===r.documentElement?Sd(n)?Sd(o)?l:o:n:l};const due=Object.freeze(Object.defineProperty({__proto__:null,default:uue},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.4.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.5/LICENSE */function Md(i){"@babel/helpers - typeof";return Md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Md(i)}function kE(i,e){return kE=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t},kE(i,e)}function fue(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function sb(i,e,t){return fue()?sb=Reflect.construct:sb=function(r,n,o){var l=[null];l.push.apply(l,n);var s=Function.bind.apply(r,l),g=new s;return o&&kE(g,o.prototype),g},sb.apply(null,arguments)}function fh(i){return pue(i)||gue(i)||mue(i)||yue()}function pue(i){if(Array.isArray(i))return OE(i)}function gue(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function mue(i,e){if(i){if(typeof i=="string")return OE(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return OE(i,e)}}function OE(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=i[t];return r}function yue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _ue=Object.hasOwnProperty,Bk=Object.setPrototypeOf,vue=Object.isFrozen,bue=Object.getPrototypeOf,xue=Object.getOwnPropertyDescriptor,fc=Object.freeze,ph=Object.seal,wue=Object.create,Ck=typeof Reflect<"u"&&Reflect,ob=Ck.apply,UE=Ck.construct;ob||(ob=function(i,e,t){return i.apply(e,t)}),fc||(fc=function(i){return i}),ph||(ph=function(i){return i}),UE||(UE=function(i,e){return sb(i,fh(e))});var Bue=Ru(Array.prototype.forEach),Ek=Ru(Array.prototype.pop),A0=Ru(Array.prototype.push),ab=Ru(String.prototype.toLowerCase),NE=Ru(String.prototype.toString),Cue=Ru(String.prototype.match),gh=Ru(String.prototype.replace),Eue=Ru(String.prototype.indexOf),Sue=Ru(String.prototype.trim),pc=Ru(RegExp.prototype.test),zE=Tue(TypeError);function Ru(i){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return ob(i,e,r)}}function Tue(i){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return UE(i,t)}}function cn(i,e,t){t=t||ab,Bk&&Bk(i,null);for(var r=e.length;r--;){var n=e[r];if(typeof n=="string"){var o=t(n);o!==n&&(vue(e)||(e[r]=o),n=o)}i[n]=!0}return i}function Uf(i){var e=wue(null),t;for(t in i)ob(_ue,i,[t])===!0&&(e[t]=i[t]);return e}function lb(i,e){for(;i!==null;){var t=xue(i,e);if(t){if(t.get)return Ru(t.get);if(typeof t.value=="function")return Ru(t.value)}i=bue(i)}function r(n){return console.warn("fallback value for",n),null}return r}var Sk=fc(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),QE=fc(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),VE=fc(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Iue=fc(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),HE=fc(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),Lue=fc(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Tk=fc(["#text"]),Ik=fc(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),GE=fc(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Lk=fc(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),cb=fc(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Mue=ph(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Pue=ph(/<%[\w\W]*|[\w\W]*%>/gm),Fue=ph(/\${[\w\W]*}/gm),Due=ph(/^data-[\-\w.\u00B7-\uFFFF]/),Rue=ph(/^aria-[\-\w]+$/),kue=ph(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Oue=ph(/^(?:\w+script|data):/i),Uue=ph(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Nue=ph(/^html$/i),zue=function(){return typeof window>"u"?null:window},Que=function(i,e){if(Md(i)!=="object"||typeof i.createPolicy!="function")return null;var t=null,r="data-tt-policy-suffix";e.currentScript&&e.currentScript.hasAttribute(r)&&(t=e.currentScript.getAttribute(r));var n="dompurify"+(t?"#"+t:"");try{return i.createPolicy(n,{createHTML:function(o){return o},createScriptURL:function(o){return o}})}catch{return console.warn("TrustedTypes policy "+n+" could not be created."),null}};function Mk(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:zue(),e=function(ot){return Mk(ot)};if(e.version="2.4.5",e.removed=[],!i||!i.document||i.document.nodeType!==9)return e.isSupported=!1,e;var t=i.document,r=i.document,n=i.DocumentFragment,o=i.HTMLTemplateElement,l=i.Node,s=i.Element,g=i.NodeFilter,v=i.NamedNodeMap,T=v===void 0?i.NamedNodeMap||i.MozNamedAttrMap:v,F=i.HTMLFormElement,R=i.DOMParser,U=i.trustedTypes,J=s.prototype,te=lb(J,"cloneNode"),Ae=lb(J,"nextSibling"),he=lb(J,"childNodes"),pe=lb(J,"parentNode");if(typeof o=="function"){var be=r.createElement("template");be.content&&be.content.ownerDocument&&(r=be.content.ownerDocument)}var Te=Que(U,t),qe=Te?Te.createHTML(""):"",je=r,We=je.implementation,Ne=je.createNodeIterator,at=je.createDocumentFragment,nt=je.getElementsByTagName,ke=t.importNode,De={};try{De=Uf(r).documentMode?r.documentMode:{}}catch{}var Ye={};e.isSupported=typeof pe=="function"&&We&&typeof We.createHTMLDocument<"u"&&De!==9;var Ze=Mue,Ct=Pue,Et=Fue,Pt=Due,bt=Rue,Rt=Oue,Ft=Uue,Xt=kue,Le=null,Xe=cn({},[].concat(fh(Sk),fh(QE),fh(VE),fh(HE),fh(Tk))),it=null,pt=cn({},[].concat(fh(Ik),fh(GE),fh(Lk),fh(cb))),mt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Bt=null,Dt=null,Mt=!0,qt=!0,ni=!1,_i=!0,vi=!1,Pi=!1,kt=!1,lt=!1,wt=!1,Oi=!1,ti=!1,ht=!0,$t=!1,oi="user-content-",gi=!0,ci=!1,Ki={},tr=null,pr=cn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Mr=null,zt=cn({},["audio","video","img","source","image","track"]),Wi=null,hi=cn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Wt="http://www.w3.org/1998/Math/MathML",Ar="http://www.w3.org/2000/svg",Qt="http://www.w3.org/1999/xhtml",Si=Qt,Ii=!1,Zt=null,bi=cn({},[Wt,Ar,Qt],NE),ei,_r=["application/xhtml+xml","text/html"],Zr="text/html",Qe,Be=null,ce=r.createElement("form"),ie=function(ot){return ot instanceof RegExp||ot instanceof Function},ue=function(ot){Be&&Be===ot||((!ot||Md(ot)!=="object")&&(ot={}),ot=Uf(ot),ei=_r.indexOf(ot.PARSER_MEDIA_TYPE)===-1?ei=Zr:ei=ot.PARSER_MEDIA_TYPE,Qe=ei==="application/xhtml+xml"?NE:ab,Le="ALLOWED_TAGS"in ot?cn({},ot.ALLOWED_TAGS,Qe):Xe,it="ALLOWED_ATTR"in ot?cn({},ot.ALLOWED_ATTR,Qe):pt,Zt="ALLOWED_NAMESPACES"in ot?cn({},ot.ALLOWED_NAMESPACES,NE):bi,Wi="ADD_URI_SAFE_ATTR"in ot?cn(Uf(hi),ot.ADD_URI_SAFE_ATTR,Qe):hi,Mr="ADD_DATA_URI_TAGS"in ot?cn(Uf(zt),ot.ADD_DATA_URI_TAGS,Qe):zt,tr="FORBID_CONTENTS"in ot?cn({},ot.FORBID_CONTENTS,Qe):pr,Bt="FORBID_TAGS"in ot?cn({},ot.FORBID_TAGS,Qe):{},Dt="FORBID_ATTR"in ot?cn({},ot.FORBID_ATTR,Qe):{},Ki="USE_PROFILES"in ot?ot.USE_PROFILES:!1,Mt=ot.ALLOW_ARIA_ATTR!==!1,qt=ot.ALLOW_DATA_ATTR!==!1,ni=ot.ALLOW_UNKNOWN_PROTOCOLS||!1,_i=ot.ALLOW_SELF_CLOSE_IN_ATTR!==!1,vi=ot.SAFE_FOR_TEMPLATES||!1,Pi=ot.WHOLE_DOCUMENT||!1,wt=ot.RETURN_DOM||!1,Oi=ot.RETURN_DOM_FRAGMENT||!1,ti=ot.RETURN_TRUSTED_TYPE||!1,lt=ot.FORCE_BODY||!1,ht=ot.SANITIZE_DOM!==!1,$t=ot.SANITIZE_NAMED_PROPS||!1,gi=ot.KEEP_CONTENT!==!1,ci=ot.IN_PLACE||!1,Xt=ot.ALLOWED_URI_REGEXP||Xt,Si=ot.NAMESPACE||Qt,mt=ot.CUSTOM_ELEMENT_HANDLING||{},ot.CUSTOM_ELEMENT_HANDLING&&ie(ot.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(mt.tagNameCheck=ot.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ot.CUSTOM_ELEMENT_HANDLING&&ie(ot.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(mt.attributeNameCheck=ot.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ot.CUSTOM_ELEMENT_HANDLING&&typeof ot.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(mt.allowCustomizedBuiltInElements=ot.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),vi&&(qt=!1),Oi&&(wt=!0),Ki&&(Le=cn({},fh(Tk)),it=[],Ki.html===!0&&(cn(Le,Sk),cn(it,Ik)),Ki.svg===!0&&(cn(Le,QE),cn(it,GE),cn(it,cb)),Ki.svgFilters===!0&&(cn(Le,VE),cn(it,GE),cn(it,cb)),Ki.mathMl===!0&&(cn(Le,HE),cn(it,Lk),cn(it,cb))),ot.ADD_TAGS&&(Le===Xe&&(Le=Uf(Le)),cn(Le,ot.ADD_TAGS,Qe)),ot.ADD_ATTR&&(it===pt&&(it=Uf(it)),cn(it,ot.ADD_ATTR,Qe)),ot.ADD_URI_SAFE_ATTR&&cn(Wi,ot.ADD_URI_SAFE_ATTR,Qe),ot.FORBID_CONTENTS&&(tr===pr&&(tr=Uf(tr)),cn(tr,ot.FORBID_CONTENTS,Qe)),gi&&(Le["#text"]=!0),Pi&&cn(Le,["html","head","body"]),Le.table&&(cn(Le,["tbody"]),delete Bt.tbody),fc&&fc(ot),Be=ot)},ge=cn({},["mi","mo","mn","ms","mtext"]),xe=cn({},["foreignobject","desc","title","annotation-xml"]),Ee=cn({},["title","style","font","a","script"]),we=cn({},QE);cn(we,VE),cn(we,Iue);var Fe=cn({},HE);cn(Fe,Lue);var ze=function(ot){var ri=pe(ot);(!ri||!ri.tagName)&&(ri={namespaceURI:Si,tagName:"template"});var Vt=ab(ot.tagName),Vi=ab(ri.tagName);return Zt[ot.namespaceURI]?ot.namespaceURI===Ar?ri.namespaceURI===Qt?Vt==="svg":ri.namespaceURI===Wt?Vt==="svg"&&(Vi==="annotation-xml"||ge[Vi]):!!we[Vt]:ot.namespaceURI===Wt?ri.namespaceURI===Qt?Vt==="math":ri.namespaceURI===Ar?Vt==="math"&&xe[Vi]:!!Fe[Vt]:ot.namespaceURI===Qt?ri.namespaceURI===Ar&&!xe[Vi]||ri.namespaceURI===Wt&&!ge[Vi]?!1:!Fe[Vt]&&(Ee[Vt]||!we[Vt]):!!(ei==="application/xhtml+xml"&&Zt[ot.namespaceURI]):!1},Ge=function(ot){A0(e.removed,{element:ot});try{ot.parentNode.removeChild(ot)}catch{try{ot.outerHTML=qe}catch{ot.remove()}}},st=function(ot,ri){try{A0(e.removed,{attribute:ri.getAttributeNode(ot),from:ri})}catch{A0(e.removed,{attribute:null,from:ri})}if(ri.removeAttribute(ot),ot==="is"&&!it[ot])if(wt||Oi)try{Ge(ri)}catch{}else try{ri.setAttribute(ot,"")}catch{}},vt=function(ot){var ri,Vt;if(lt)ot="<remove></remove>"+ot;else{var Vi=Cue(ot,/^[\r\n\t ]+/);Vt=Vi&&Vi[0]}ei==="application/xhtml+xml"&&Si===Qt&&(ot='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ot+"</body></html>");var lr=Te?Te.createHTML(ot):ot;if(Si===Qt)try{ri=new R().parseFromString(lr,ei)}catch{}if(!ri||!ri.documentElement){ri=We.createDocument(Si,"template",null);try{ri.documentElement.innerHTML=Ii?qe:lr}catch{}}var un=ri.body||ri.documentElement;return ot&&Vt&&un.insertBefore(r.createTextNode(Vt),un.childNodes[0]||null),Si===Qt?nt.call(ri,Pi?"html":"body")[0]:Pi?ri.documentElement:un},Tt=function(ot){return Ne.call(ot.ownerDocument||ot,ot,g.SHOW_ELEMENT|g.SHOW_COMMENT|g.SHOW_TEXT,null,!1)},Kt=function(ot){return ot instanceof F&&(typeof ot.nodeName!="string"||typeof ot.textContent!="string"||typeof ot.removeChild!="function"||!(ot.attributes instanceof T)||typeof ot.removeAttribute!="function"||typeof ot.setAttribute!="function"||typeof ot.namespaceURI!="string"||typeof ot.insertBefore!="function"||typeof ot.hasChildNodes!="function")},ii=function(ot){return Md(l)==="object"?ot instanceof l:ot&&Md(ot)==="object"&&typeof ot.nodeType=="number"&&typeof ot.nodeName=="string"},Gt=function(ot,ri,Vt){Ye[ot]&&Bue(Ye[ot],function(Vi){Vi.call(e,ri,Vt,Be)})},Ai=function(ot){var ri;if(Gt("beforeSanitizeElements",ot,null),Kt(ot)||pc(/[\u0080-\uFFFF]/,ot.nodeName))return Ge(ot),!0;var Vt=Qe(ot.nodeName);if(Gt("uponSanitizeElement",ot,{tagName:Vt,allowedTags:Le}),ot.hasChildNodes()&&!ii(ot.firstElementChild)&&(!ii(ot.content)||!ii(ot.content.firstElementChild))&&pc(/<[/\w]/g,ot.innerHTML)&&pc(/<[/\w]/g,ot.textContent)||Vt==="select"&&pc(/<template/i,ot.innerHTML))return Ge(ot),!0;if(!Le[Vt]||Bt[Vt]){if(!Bt[Vt]&&Hi(Vt)&&(mt.tagNameCheck instanceof RegExp&&pc(mt.tagNameCheck,Vt)||mt.tagNameCheck instanceof Function&&mt.tagNameCheck(Vt)))return!1;if(gi&&!tr[Vt]){var Vi=pe(ot)||ot.parentNode,lr=he(ot)||ot.childNodes;if(lr&&Vi)for(var un=lr.length,wn=un-1;wn>=0;--wn)Vi.insertBefore(te(lr[wn],!0),Ae(ot))}return Ge(ot),!0}return ot instanceof s&&!ze(ot)||(Vt==="noscript"||Vt==="noembed")&&pc(/<\/no(script|embed)/i,ot.innerHTML)?(Ge(ot),!0):(vi&&ot.nodeType===3&&(ri=ot.textContent,ri=gh(ri,Ze," "),ri=gh(ri,Ct," "),ri=gh(ri,Et," "),ot.textContent!==ri&&(A0(e.removed,{element:ot.cloneNode()}),ot.textContent=ri)),Gt("afterSanitizeElements",ot,null),!1)},Bi=function(ot,ri,Vt){if(ht&&(ri==="id"||ri==="name")&&(Vt in r||Vt in ce))return!1;if(!(qt&&!Dt[ri]&&pc(Pt,ri))&&!(Mt&&pc(bt,ri))){if(!it[ri]||Dt[ri]){if(!(Hi(ot)&&(mt.tagNameCheck instanceof RegExp&&pc(mt.tagNameCheck,ot)||mt.tagNameCheck instanceof Function&&mt.tagNameCheck(ot))&&(mt.attributeNameCheck instanceof RegExp&&pc(mt.attributeNameCheck,ri)||mt.attributeNameCheck instanceof Function&&mt.attributeNameCheck(ri))||ri==="is"&&mt.allowCustomizedBuiltInElements&&(mt.tagNameCheck instanceof RegExp&&pc(mt.tagNameCheck,Vt)||mt.tagNameCheck instanceof Function&&mt.tagNameCheck(Vt))))return!1}else if(!Wi[ri]&&!pc(Xt,gh(Vt,Ft,""))&&!((ri==="src"||ri==="xlink:href"||ri==="href")&&ot!=="script"&&Eue(Vt,"data:")===0&&Mr[ot])&&!(ni&&!pc(Rt,gh(Vt,Ft,"")))&&Vt)return!1}return!0},Hi=function(ot){return ot.indexOf("-")>0},Ci=function(ot){var ri,Vt,Vi,lr;Gt("beforeSanitizeAttributes",ot,null);var un=ot.attributes;if(un){var wn={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:it};for(lr=un.length;lr--;){ri=un[lr];var gr=ri,mn=gr.name,yn=gr.namespaceURI;if(Vt=mn==="value"?ri.value:Sue(ri.value),Vi=Qe(mn),wn.attrName=Vi,wn.attrValue=Vt,wn.keepAttr=!0,wn.forceKeepAttr=void 0,Gt("uponSanitizeAttribute",ot,wn),Vt=wn.attrValue,!wn.forceKeepAttr&&(st(mn,ot),!!wn.keepAttr)){if(!_i&&pc(/\/>/i,Vt)){st(mn,ot);continue}vi&&(Vt=gh(Vt,Ze," "),Vt=gh(Vt,Ct," "),Vt=gh(Vt,Et," "));var dr=Qe(ot.nodeName);if(Bi(dr,Vi,Vt)){if($t&&(Vi==="id"||Vi==="name")&&(st(mn,ot),Vt=oi+Vt),Te&&Md(U)==="object"&&typeof U.getAttributeType=="function"&&!yn)switch(U.getAttributeType(dr,Vi)){case"TrustedHTML":Vt=Te.createHTML(Vt);break;case"TrustedScriptURL":Vt=Te.createScriptURL(Vt);break}try{yn?ot.setAttributeNS(yn,mn,Vt):ot.setAttribute(mn,Vt),Ek(e.removed)}catch{}}}}Gt("afterSanitizeAttributes",ot,null)}},Ni=function ot(ri){var Vt,Vi=Tt(ri);for(Gt("beforeSanitizeShadowDOM",ri,null);Vt=Vi.nextNode();)Gt("uponSanitizeShadowNode",Vt,null),!Ai(Vt)&&(Vt.content instanceof n&&ot(Vt.content),Ci(Vt));Gt("afterSanitizeShadowDOM",ri,null)};return e.sanitize=function(ot){var ri=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Vt,Vi,lr,un,wn;if(Ii=!ot,Ii&&(ot="<!-->"),typeof ot!="string"&&!ii(ot)){if(typeof ot.toString!="function")throw zE("toString is not a function");if(ot=ot.toString(),typeof ot!="string")throw zE("dirty is not a string, aborting")}if(!e.isSupported){if(Md(i.toStaticHTML)==="object"||typeof i.toStaticHTML=="function"){if(typeof ot=="string")return i.toStaticHTML(ot);if(ii(ot))return i.toStaticHTML(ot.outerHTML)}return ot}if(kt||ue(ri),e.removed=[],typeof ot=="string"&&(ci=!1),ci){if(ot.nodeName){var gr=Qe(ot.nodeName);if(!Le[gr]||Bt[gr])throw zE("root node is forbidden and cannot be sanitized in-place")}}else if(ot instanceof l)Vt=vt("<!---->"),Vi=Vt.ownerDocument.importNode(ot,!0),Vi.nodeType===1&&Vi.nodeName==="BODY"||Vi.nodeName==="HTML"?Vt=Vi:Vt.appendChild(Vi);else{if(!wt&&!vi&&!Pi&&ot.indexOf("<")===-1)return Te&&ti?Te.createHTML(ot):ot;if(Vt=vt(ot),!Vt)return wt?null:ti?qe:""}Vt&&lt&&Ge(Vt.firstChild);for(var mn=Tt(ci?ot:Vt);lr=mn.nextNode();)lr.nodeType===3&&lr===un||Ai(lr)||(lr.content instanceof n&&Ni(lr.content),Ci(lr),un=lr);if(un=null,ci)return ot;if(wt){if(Oi)for(wn=at.call(Vt.ownerDocument);Vt.firstChild;)wn.appendChild(Vt.firstChild);else wn=Vt;return(it.shadowroot||it.shadowrootmod)&&(wn=ke.call(t,wn,!0)),wn}var yn=Pi?Vt.outerHTML:Vt.innerHTML;return Pi&&Le["!doctype"]&&Vt.ownerDocument&&Vt.ownerDocument.doctype&&Vt.ownerDocument.doctype.name&&pc(Nue,Vt.ownerDocument.doctype.name)&&(yn="<!DOCTYPE "+Vt.ownerDocument.doctype.name+`>
`+yn),vi&&(yn=gh(yn,Ze," "),yn=gh(yn,Ct," "),yn=gh(yn,Et," ")),Te&&ti?Te.createHTML(yn):yn},e.setConfig=function(ot){ue(ot),kt=!0},e.clearConfig=function(){Be=null,kt=!1},e.isValidAttribute=function(ot,ri,Vt){Be||ue({});var Vi=Qe(ot),lr=Qe(ri);return Bi(Vi,lr,Vt)},e.addHook=function(ot,ri){typeof ri=="function"&&(Ye[ot]=Ye[ot]||[],A0(Ye[ot],ri))},e.removeHook=function(ot){if(Ye[ot])return Ek(Ye[ot])},e.removeHooks=function(ot){Ye[ot]&&(Ye[ot]=[])},e.removeAllHooks=function(){Ye={}},e}var Vue=Mk();const Hue=Object.freeze(Object.defineProperty({__proto__:null,default:Vue},Symbol.toStringTag,{value:"Module"}));var d0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pk(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ub=function(i){return i&&i.Math==Math&&i},Ca=ub(typeof globalThis=="object"&&globalThis)||ub(typeof window=="object"&&window)||ub(typeof self=="object"&&self)||ub(typeof d0=="object"&&d0)||function(){return this}()||d0||Function("return this")(),Kg={},qo=function(i){try{return!!i()}catch{return!0}},Gue=qo,Yh=!Gue(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),jue=qo,hb=!jue(function(){var i=(function(){}).bind();return typeof i!="function"||i.hasOwnProperty("prototype")}),que=hb,Ab=Function.prototype.call,ll=que?Ab.bind(Ab):function(){return Ab.apply(Ab,arguments)},Fk={},Dk={}.propertyIsEnumerable,Rk=Object.getOwnPropertyDescriptor,$ue=Rk&&!Dk.call({1:2},1);Fk.f=$ue?function(i){var e=Rk(this,i);return!!e&&e.enumerable}:Dk;var db=function(i,e){return{enumerable:!(i&1),configurable:!(i&2),writable:!(i&4),value:e}},kk=hb,Ok=Function.prototype,jE=Ok.call,Kue=kk&&Ok.bind.bind(jE,jE),$o=kk?Kue:function(i){return function(){return jE.apply(i,arguments)}},Uk=$o,Wue=Uk({}.toString),Zue=Uk("".slice),Nf=function(i){return Zue(Wue(i),8,-1)},Xue=$o,Jue=qo,Yue=Nf,qE=Object,ehe=Xue("".split),Nk=Jue(function(){return!qE("z").propertyIsEnumerable(0)})?function(i){return Yue(i)=="String"?ehe(i,""):qE(i)}:qE,zf=function(i){return i==null},the=zf,ihe=TypeError,eA=function(i){if(the(i))throw ihe("Can't call method on "+i);return i},rhe=Nk,nhe=eA,f0=function(i){return rhe(nhe(i))},$E=typeof document=="object"&&document.all,she=typeof $E>"u"&&$E!==void 0,zk={all:$E,IS_HTMLDDA:she},Qk=zk,ohe=Qk.all,Eo=Qk.IS_HTMLDDA?function(i){return typeof i=="function"||i===ohe}:function(i){return typeof i=="function"},Vk=Eo,Hk=zk,ahe=Hk.all,OA=Hk.IS_HTMLDDA?function(i){return typeof i=="object"?i!==null:Vk(i)||i===ahe}:function(i){return typeof i=="object"?i!==null:Vk(i)},KE=Ca,lhe=Eo,che=function(i){return lhe(i)?i:void 0},Qf=function(i,e){return arguments.length<2?che(KE[i]):KE[i]&&KE[i][e]},uhe=$o,fb=uhe({}.isPrototypeOf),pb=typeof navigator<"u"&&String(navigator.userAgent)||"",Gk=Ca,WE=pb,jk=Gk.process,qk=Gk.Deno,$k=jk&&jk.versions||qk&&qk.version,Kk=$k&&$k.v8,mh,gb;Kk&&(mh=Kk.split("."),gb=mh[0]>0&&mh[0]<4?1:+(mh[0]+mh[1])),!gb&&WE&&(mh=WE.match(/Edge\/(\d+)/),(!mh||mh[1]>=74)&&(mh=WE.match(/Chrome\/(\d+)/),mh&&(gb=+mh[1])));var ZE=gb,Wk=ZE,hhe=qo,Ahe=Ca,dhe=Ahe.String,Zk=!!Object.getOwnPropertySymbols&&!hhe(function(){var i=Symbol();return!dhe(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&Wk&&Wk<41}),fhe=Zk,Xk=fhe&&!Symbol.sham&&typeof Symbol.iterator=="symbol",phe=Qf,ghe=Eo,mhe=fb,yhe=Xk,_he=Object,Jk=yhe?function(i){return typeof i=="symbol"}:function(i){var e=phe("Symbol");return ghe(e)&&mhe(e.prototype,_he(i))},vhe=String,mb=function(i){try{return vhe(i)}catch{return"Object"}},bhe=Eo,xhe=mb,whe=TypeError,UA=function(i){if(bhe(i))return i;throw whe(xhe(i)+" is not a function")},Bhe=UA,Che=zf,Wg=function(i,e){var t=i[e];return Che(t)?void 0:Bhe(t)},XE=ll,JE=Eo,YE=OA,Ehe=TypeError,She=function(i,e){var t,r;if(e==="string"&&JE(t=i.toString)&&!YE(r=XE(t,i))||JE(t=i.valueOf)&&!YE(r=XE(t,i))||e!=="string"&&JE(t=i.toString)&&!YE(r=XE(t,i)))return r;throw Ehe("Can't convert object to primitive value")},Yk={exports:{}},eO=Ca,The=Object.defineProperty,eS=function(i,e){try{The(eO,i,{value:e,configurable:!0,writable:!0})}catch{eO[i]=e}return e},Ihe=Ca,Lhe=eS,tO="__core-js_shared__",Mhe=Ihe[tO]||Lhe(tO,{}),tS=Mhe,iO=tS;(Yk.exports=function(i,e){return iO[i]||(iO[i]=e!==void 0?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"});var iS=Yk.exports,Phe=eA,Fhe=Object,yb=function(i){return Fhe(Phe(i))},Dhe=$o,Rhe=yb,khe=Dhe({}.hasOwnProperty),yh=Object.hasOwn||function(i,e){return khe(Rhe(i),e)},Ohe=$o,Uhe=0,Nhe=Math.random(),zhe=Ohe(1 .toString),rO=function(i){return"Symbol("+(i===void 0?"":i)+")_"+zhe(++Uhe+Nhe,36)},Qhe=Ca,Vhe=iS,nO=yh,Hhe=rO,Ghe=Zk,jhe=Xk,Zg=Qhe.Symbol,rS=Vhe("wks"),qhe=jhe?Zg.for||Zg:Zg&&Zg.withoutSetter||Hhe,ja=function(i){return nO(rS,i)||(rS[i]=Ghe&&nO(Zg,i)?Zg[i]:qhe("Symbol."+i)),rS[i]},$he=ll,sO=OA,oO=Jk,Khe=Wg,Whe=She,Zhe=ja,Xhe=TypeError,Jhe=Zhe("toPrimitive"),Yhe=function(i,e){if(!sO(i)||oO(i))return i;var t=Khe(i,Jhe),r;if(t){if(e===void 0&&(e="default"),r=$he(t,i,e),!sO(r)||oO(r))return r;throw Xhe("Can't convert object to primitive value")}return e===void 0&&(e="number"),Whe(i,e)},eAe=Yhe,tAe=Jk,nS=function(i){var e=eAe(i,"string");return tAe(e)?e:e+""},iAe=Ca,aO=OA,sS=iAe.document,rAe=aO(sS)&&aO(sS.createElement),_b=function(i){return rAe?sS.createElement(i):{}},nAe=Yh,sAe=qo,oAe=_b,lO=!nAe&&!sAe(function(){return Object.defineProperty(oAe("div"),"a",{get:function(){return 7}}).a!=7}),aAe=Yh,lAe=ll,cAe=Fk,uAe=db,hAe=f0,AAe=nS,dAe=yh,fAe=lO,cO=Object.getOwnPropertyDescriptor;Kg.f=aAe?cO:function(i,e){if(i=hAe(i),e=AAe(e),fAe)try{return cO(i,e)}catch{}if(dAe(i,e))return uAe(!lAe(cAe.f,i,e),i[e])};var tA={},pAe=Yh,gAe=qo,uO=pAe&&gAe(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),mAe=OA,yAe=String,_Ae=TypeError,Ol=function(i){if(mAe(i))return i;throw _Ae(yAe(i)+" is not an object")},vAe=Yh,bAe=lO,xAe=uO,vb=Ol,hO=nS,wAe=TypeError,oS=Object.defineProperty,BAe=Object.getOwnPropertyDescriptor,aS="enumerable",lS="configurable",cS="writable";tA.f=vAe?xAe?function(i,e,t){if(vb(i),e=hO(e),vb(t),typeof i=="function"&&e==="prototype"&&"value"in t&&cS in t&&!t[cS]){var r=BAe(i,e);r&&r[cS]&&(i[e]=t.value,t={configurable:lS in t?t[lS]:r[lS],enumerable:aS in t?t[aS]:r[aS],writable:!1})}return oS(i,e,t)}:oS:function(i,e,t){if(vb(i),e=hO(e),vb(t),bAe)try{return oS(i,e,t)}catch{}if("get"in t||"set"in t)throw wAe("Accessors not supported");return"value"in t&&(i[e]=t.value),i};var CAe=Yh,EAe=tA,SAe=db,p0=CAe?function(i,e,t){return EAe.f(i,e,SAe(1,t))}:function(i,e,t){return i[e]=t,i},AO={exports:{}},uS=Yh,TAe=yh,dO=Function.prototype,IAe=uS&&Object.getOwnPropertyDescriptor,hS=TAe(dO,"name"),LAe=hS&&(function(){}).name==="something",MAe=hS&&(!uS||uS&&IAe(dO,"name").configurable),bb={EXISTS:hS,PROPER:LAe,CONFIGURABLE:MAe},PAe=$o,FAe=Eo,AS=tS,DAe=PAe(Function.toString);FAe(AS.inspectSource)||(AS.inspectSource=function(i){return DAe(i)});var dS=AS.inspectSource,RAe=Ca,kAe=Eo,fO=RAe.WeakMap,OAe=kAe(fO)&&/native code/.test(String(fO)),UAe=iS,NAe=rO,pO=UAe("keys"),fS=function(i){return pO[i]||(pO[i]=NAe(i))},pS={},zAe=OAe,gO=Ca,QAe=OA,VAe=p0,gS=yh,mS=tS,HAe=fS,GAe=pS,mO="Object already initialized",yS=gO.TypeError,jAe=gO.WeakMap,xb,g0,wb,qAe=function(i){return wb(i)?g0(i):xb(i,{})},$Ae=function(i){return function(e){var t;if(!QAe(e)||(t=g0(e)).type!==i)throw yS("Incompatible receiver, "+i+" required");return t}};if(zAe||mS.state){var iA=mS.state||(mS.state=new jAe);iA.get=iA.get,iA.has=iA.has,iA.set=iA.set,xb=function(i,e){if(iA.has(i))throw yS(mO);return e.facade=i,iA.set(i,e),e},g0=function(i){return iA.get(i)||{}},wb=function(i){return iA.has(i)}}else{var Xg=HAe("state");GAe[Xg]=!0,xb=function(i,e){if(gS(i,Xg))throw yS(mO);return e.facade=i,VAe(i,Xg,e),e},g0=function(i){return gS(i,Xg)?i[Xg]:{}},wb=function(i){return gS(i,Xg)}}var Bb={set:xb,get:g0,has:wb,enforce:qAe,getterFor:$Ae},_S=$o,KAe=qo,WAe=Eo,Cb=yh,vS=Yh,ZAe=bb.CONFIGURABLE,XAe=dS,yO=Bb,JAe=yO.enforce,YAe=yO.get,_O=String,Eb=Object.defineProperty,ede=_S("".slice),tde=_S("".replace),ide=_S([].join),rde=vS&&!KAe(function(){return Eb(function(){},"length",{value:8}).length!==8}),nde=String(String).split("String"),sde=AO.exports=function(i,e,t){ede(_O(e),0,7)==="Symbol("&&(e="["+tde(_O(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!Cb(i,"name")||ZAe&&i.name!==e)&&(vS?Eb(i,"name",{value:e,configurable:!0}):i.name=e),rde&&t&&Cb(t,"arity")&&i.length!==t.arity&&Eb(i,"length",{value:t.arity});try{t&&Cb(t,"constructor")&&t.constructor?vS&&Eb(i,"prototype",{writable:!1}):i.prototype&&(i.prototype=void 0)}catch{}var r=JAe(i);return Cb(r,"source")||(r.source=ide(nde,typeof e=="string"?e:"")),i};Function.prototype.toString=sde(function(){return WAe(this)&&YAe(this).source||XAe(this)},"toString");var vO=AO.exports,ode=Eo,ade=tA,lde=vO,cde=eS,Vf=function(i,e,t,r){r||(r={});var n=r.enumerable,o=r.name!==void 0?r.name:e;if(ode(t)&&lde(t,o,r),r.global)n?i[e]=t:cde(e,t);else{try{r.unsafe?i[e]&&(n=!0):delete i[e]}catch{}n?i[e]=t:ade.f(i,e,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return i},bO={},ude=Math.ceil,hde=Math.floor,Ade=Math.trunc||function(i){var e=+i;return(e>0?hde:ude)(e)},dde=Ade,Sb=function(i){var e=+i;return e!==e||e===0?0:dde(e)},fde=Sb,pde=Math.max,gde=Math.min,xO=function(i,e){var t=fde(i);return t<0?pde(t+e,0):gde(t,e)},mde=Sb,yde=Math.min,Jg=function(i){return i>0?yde(mde(i),9007199254740991):0},_de=Jg,Tb=function(i){return _de(i.length)},vde=f0,bde=xO,xde=Tb,wO=function(i){return function(e,t,r){var n=vde(e),o=xde(n),l=bde(r,o),s;if(i&&t!=t){for(;o>l;)if(s=n[l++],s!=s)return!0}else for(;o>l;l++)if((i||l in n)&&n[l]===t)return i||l||0;return!i&&-1}},BO={includes:wO(!0),indexOf:wO(!1)},wde=$o,bS=yh,Bde=f0,Cde=BO.indexOf,Ede=pS,CO=wde([].push),EO=function(i,e){var t=Bde(i),r=0,n=[],o;for(o in t)!bS(Ede,o)&&bS(t,o)&&CO(n,o);for(;e.length>r;)bS(t,o=e[r++])&&(~Cde(n,o)||CO(n,o));return n},xS=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Sde=EO,Tde=xS,Ide=Tde.concat("length","prototype");bO.f=Object.getOwnPropertyNames||function(i){return Sde(i,Ide)};var SO={};SO.f=Object.getOwnPropertySymbols;var Lde=Qf,Mde=$o,Pde=bO,Fde=SO,Dde=Ol,Rde=Mde([].concat),kde=Lde("Reflect","ownKeys")||function(i){var e=Pde.f(Dde(i)),t=Fde.f;return t?Rde(e,t(i)):e},TO=yh,Ode=kde,Ude=Kg,Nde=tA,zde=function(i,e,t){for(var r=Ode(e),n=Nde.f,o=Ude.f,l=0;l<r.length;l++){var s=r[l];!TO(i,s)&&!(t&&TO(t,s))&&n(i,s,o(e,s))}},Qde=qo,Vde=Eo,Hde=/#|\.prototype\./,m0=function(i,e){var t=jde[Gde(i)];return t==$de?!0:t==qde?!1:Vde(e)?Qde(e):!!e},Gde=m0.normalize=function(i){return String(i).replace(Hde,".").toLowerCase()},jde=m0.data={},qde=m0.NATIVE="N",$de=m0.POLYFILL="P",IO=m0,wS=Ca,Kde=Kg.f,Wde=p0,Zde=Vf,Xde=eS,Jde=zde,Yde=IO,gc=function(i,e){var t=i.target,r=i.global,n=i.stat,o,l,s,g,v,T;if(r?l=wS:n?l=wS[t]||Xde(t,{}):l=(wS[t]||{}).prototype,l)for(s in e){if(v=e[s],i.dontCallGetSet?(T=Kde(l,s),g=T&&T.value):g=l[s],o=Yde(r?s:t+(n?".":"#")+s,i.forced),!o&&g!==void 0){if(typeof v==typeof g)continue;Jde(v,g)}(i.sham||g&&g.sham)&&Wde(v,"sham",!0),Zde(l,s,v,i)}},efe=Nf,y0=typeof process<"u"&&efe(process)=="process",tfe=$o,ife=UA,rfe=function(i,e,t){try{return tfe(ife(Object.getOwnPropertyDescriptor(i,e)[t]))}catch{}},nfe=Eo,sfe=String,ofe=TypeError,afe=function(i){if(typeof i=="object"||nfe(i))return i;throw ofe("Can't set "+sfe(i)+" as a prototype")},lfe=rfe,cfe=Ol,ufe=afe,LO=Object.setPrototypeOf||("__proto__"in{}?function(){var i=!1,e={},t;try{t=lfe(Object.prototype,"__proto__","set"),t(e,[]),i=e instanceof Array}catch{}return function(r,n){return cfe(r),ufe(n),i?t(r,n):r.__proto__=n,r}}():void 0),hfe=tA.f,Afe=yh,dfe=ja,MO=dfe("toStringTag"),BS=function(i,e,t){i&&!t&&(i=i.prototype),i&&!Afe(i,MO)&&hfe(i,MO,{configurable:!0,value:e})},PO=vO,ffe=tA,pfe=function(i,e,t){return t.get&&PO(t.get,e,{getter:!0}),t.set&&PO(t.set,e,{setter:!0}),ffe.f(i,e,t)},gfe=Qf,mfe=pfe,yfe=ja,_fe=Yh,FO=yfe("species"),vfe=function(i){var e=gfe(i);_fe&&e&&!e[FO]&&mfe(e,FO,{configurable:!0,get:function(){return this}})},bfe=fb,xfe=TypeError,wfe=function(i,e){if(bfe(e,i))return i;throw xfe("Incorrect invocation")},Bfe=ja,Cfe=Bfe("toStringTag"),DO={};DO[Cfe]="z";var Efe=String(DO)==="[object z]",Sfe=Efe,Tfe=Eo,Ib=Nf,Ife=ja,Lfe=Ife("toStringTag"),Mfe=Object,Pfe=Ib(function(){return arguments}())=="Arguments",Ffe=function(i,e){try{return i[e]}catch{}},CS=Sfe?Ib:function(i){var e,t,r;return i===void 0?"Undefined":i===null?"Null":typeof(t=Ffe(e=Mfe(i),Lfe))=="string"?t:Pfe?Ib(e):(r=Ib(e))=="Object"&&Tfe(e.callee)?"Arguments":r},Dfe=$o,Rfe=qo,RO=Eo,kfe=CS,Ofe=Qf,Ufe=dS,kO=function(){},Nfe=[],OO=Ofe("Reflect","construct"),ES=/^\s*(?:class|function)\b/,zfe=Dfe(ES.exec),Qfe=!ES.exec(kO),_0=function(i){if(!RO(i))return!1;try{return OO(kO,Nfe,i),!0}catch{return!1}},UO=function(i){if(!RO(i))return!1;switch(kfe(i)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Qfe||!!zfe(ES,Ufe(i))}catch{return!0}};UO.sham=!0;var Vfe=!OO||Rfe(function(){var i;return _0(_0.call)||!_0(Object)||!_0(function(){i=!0})||i})?UO:_0,Hfe=Vfe,Gfe=mb,jfe=TypeError,qfe=function(i){if(Hfe(i))return i;throw jfe(Gfe(i)+" is not a constructor")},NO=Ol,$fe=qfe,Kfe=zf,Wfe=ja,Zfe=Wfe("species"),zO=function(i,e){var t=NO(i).constructor,r;return t===void 0||Kfe(r=NO(t)[Zfe])?e:$fe(r)},Xfe=hb,QO=Function.prototype,VO=QO.apply,HO=QO.call,SS=typeof Reflect=="object"&&Reflect.apply||(Xfe?HO.bind(VO):function(){return HO.apply(VO,arguments)}),Jfe=Nf,Yfe=$o,v0=function(i){if(Jfe(i)==="Function")return Yfe(i)},GO=v0,epe=UA,tpe=hb,ipe=GO(GO.bind),TS=function(i,e){return epe(i),e===void 0?i:tpe?ipe(i,e):function(){return i.apply(e,arguments)}},rpe=Qf,jO=rpe("document","documentElement"),npe=$o,spe=npe([].slice),ope=TypeError,ape=function(i,e){if(i<e)throw ope("Not enough arguments");return i},lpe=pb,qO=/(?:ipad|iphone|ipod).*applewebkit/i.test(lpe),cu=Ca,cpe=SS,upe=TS,$O=Eo,hpe=yh,KO=qo,WO=jO,Ape=spe,ZO=_b,dpe=ape,fpe=qO,ppe=y0,IS=cu.setImmediate,LS=cu.clearImmediate,gpe=cu.process,MS=cu.Dispatch,mpe=cu.Function,XO=cu.MessageChannel,ype=cu.String,PS=0,b0={},JO="onreadystatechange",x0,Hf,FS,DS;KO(function(){x0=cu.location});var RS=function(i){if(hpe(b0,i)){var e=b0[i];delete b0[i],e()}},kS=function(i){return function(){RS(i)}},YO=function(i){RS(i.data)},eU=function(i){cu.postMessage(ype(i),x0.protocol+"//"+x0.host)};(!IS||!LS)&&(IS=function(i){dpe(arguments.length,1);var e=$O(i)?i:mpe(i),t=Ape(arguments,1);return b0[++PS]=function(){cpe(e,void 0,t)},Hf(PS),PS},LS=function(i){delete b0[i]},ppe?Hf=function(i){gpe.nextTick(kS(i))}:MS&&MS.now?Hf=function(i){MS.now(kS(i))}:XO&&!fpe?(FS=new XO,DS=FS.port2,FS.port1.onmessage=YO,Hf=upe(DS.postMessage,DS)):cu.addEventListener&&$O(cu.postMessage)&&!cu.importScripts&&x0&&x0.protocol!=="file:"&&!KO(eU)?(Hf=eU,cu.addEventListener("message",YO,!1)):JO in ZO("script")?Hf=function(i){WO.appendChild(ZO("script"))[JO]=function(){WO.removeChild(this),RS(i)}}:Hf=function(i){setTimeout(kS(i),0)});var tU={set:IS,clear:LS},iU=function(){this.head=null,this.tail=null};iU.prototype={add:function(i){var e={item:i,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var i=this.head;if(i){var e=this.head=i.next;return e===null&&(this.tail=null),i.item}}};var rU=iU,_pe=pb,vpe=/ipad|iphone|ipod/i.test(_pe)&&typeof Pebble<"u",bpe=pb,xpe=/web0s(?!.*chrome)/i.test(bpe),Gf=Ca,nU=TS,wpe=Kg.f,OS=tU.set,Bpe=rU,Cpe=qO,Epe=vpe,Spe=xpe,US=y0,sU=Gf.MutationObserver||Gf.WebKitMutationObserver,oU=Gf.document,aU=Gf.process,Lb=Gf.Promise,lU=wpe(Gf,"queueMicrotask"),NS=lU&&lU.value,Yg,zS,QS,Mb,cU;if(!NS){var Pb=new Bpe,Fb=function(){var i,e;for(US&&(i=aU.domain)&&i.exit();e=Pb.get();)try{e()}catch(t){throw Pb.head&&Yg(),t}i&&i.enter()};!Cpe&&!US&&!Spe&&sU&&oU?(zS=!0,QS=oU.createTextNode(""),new sU(Fb).observe(QS,{characterData:!0}),Yg=function(){QS.data=zS=!zS}):!Epe&&Lb&&Lb.resolve?(Mb=Lb.resolve(void 0),Mb.constructor=Lb,cU=nU(Mb.then,Mb),Yg=function(){cU(Fb)}):US?Yg=function(){aU.nextTick(Fb)}:(OS=nU(OS,Gf),Yg=function(){OS(Fb)}),NS=function(i){Pb.head||Yg(),Pb.add(i)}}var Tpe=NS,Ipe=function(i,e){try{arguments.length==1?console.error(i):console.error(i,e)}catch{}},VS=function(i){try{return{error:!1,value:i()}}catch(e){return{error:!0,value:e}}},Lpe=Ca,Db=Lpe.Promise,uU=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Mpe=uU,Ppe=y0,Fpe=!Mpe&&!Ppe&&typeof window=="object"&&typeof document=="object",Dpe=Ca,w0=Db,Rpe=Eo,kpe=IO,Ope=dS,Upe=ja,Npe=Fpe,zpe=uU,HS=ZE;w0&&w0.prototype;var Qpe=Upe("species"),GS=!1,hU=Rpe(Dpe.PromiseRejectionEvent),Vpe=kpe("Promise",function(){var i=Ope(w0),e=i!==String(w0);if(!e&&HS===66)return!0;if(!HS||HS<51||!/native code/.test(i)){var t=new w0(function(o){o(1)}),r=function(o){o(function(){},function(){})},n=t.constructor={};if(n[Qpe]=r,GS=t.then(function(){})instanceof r,!GS)return!0}return!e&&(Npe||zpe)&&!hU}),B0={CONSTRUCTOR:Vpe,REJECTION_EVENT:hU,SUBCLASSING:GS},em={},AU=UA,Hpe=TypeError,Gpe=function(i){var e,t;this.promise=new i(function(r,n){if(e!==void 0||t!==void 0)throw Hpe("Bad Promise constructor");e=r,t=n}),this.resolve=AU(e),this.reject=AU(t)};em.f=function(i){return new Gpe(i)};var jpe=gc,Rb=y0,Pd=Ca,tm=ll,dU=Vf,fU=LO,qpe=BS,$pe=vfe,Kpe=UA,kb=Eo,Wpe=OA,Zpe=wfe,Xpe=zO,pU=tU.set,jS=Tpe,Jpe=Ipe,Ype=VS,ege=rU,gU=Bb,Ob=Db,qS=B0,mU=em,Ub="Promise",yU=qS.CONSTRUCTOR,tge=qS.REJECTION_EVENT,ige=qS.SUBCLASSING,$S=gU.getterFor(Ub),rge=gU.set,im=Ob&&Ob.prototype,jf=Ob,Nb=im,_U=Pd.TypeError,KS=Pd.document,WS=Pd.process,ZS=mU.f,nge=ZS,sge=!!(KS&&KS.createEvent&&Pd.dispatchEvent),vU="unhandledrejection",oge="rejectionhandled",bU=0,xU=1,age=2,XS=1,wU=2,zb,BU,lge,CU,EU=function(i){var e;return Wpe(i)&&kb(e=i.then)?e:!1},SU=function(i,e){var t=e.value,r=e.state==xU,n=r?i.ok:i.fail,o=i.resolve,l=i.reject,s=i.domain,g,v,T;try{n?(r||(e.rejection===wU&&uge(e),e.rejection=XS),n===!0?g=t:(s&&s.enter(),g=n(t),s&&(s.exit(),T=!0)),g===i.promise?l(_U("Promise-chain cycle")):(v=EU(g))?tm(v,g,o,l):o(g)):l(t)}catch(F){s&&!T&&s.exit(),l(F)}},TU=function(i,e){i.notified||(i.notified=!0,jS(function(){for(var t=i.reactions,r;r=t.get();)SU(r,i);i.notified=!1,e&&!i.rejection&&cge(i)}))},IU=function(i,e,t){var r,n;sge?(r=KS.createEvent("Event"),r.promise=e,r.reason=t,r.initEvent(i,!1,!0),Pd.dispatchEvent(r)):r={promise:e,reason:t},!tge&&(n=Pd["on"+i])?n(r):i===vU&&Jpe("Unhandled promise rejection",t)},cge=function(i){tm(pU,Pd,function(){var e=i.facade,t=i.value,r=LU(i),n;if(r&&(n=Ype(function(){Rb?WS.emit("unhandledRejection",t,e):IU(vU,e,t)}),i.rejection=Rb||LU(i)?wU:XS,n.error))throw n.value})},LU=function(i){return i.rejection!==XS&&!i.parent},uge=function(i){tm(pU,Pd,function(){var e=i.facade;Rb?WS.emit("rejectionHandled",e):IU(oge,e,i.value)})},rm=function(i,e,t){return function(r){i(e,r,t)}},nm=function(i,e,t){i.done||(i.done=!0,t&&(i=t),i.value=e,i.state=age,TU(i,!0))},JS=function(i,e,t){if(!i.done){i.done=!0,t&&(i=t);try{if(i.facade===e)throw _U("Promise can't be resolved itself");var r=EU(e);r?jS(function(){var n={done:!1};try{tm(r,e,rm(JS,n,i),rm(nm,n,i))}catch(o){nm(n,o,i)}}):(i.value=e,i.state=xU,TU(i,!1))}catch(n){nm({done:!1},n,i)}}};if(yU&&(jf=function(i){Zpe(this,Nb),Kpe(i),tm(zb,this);var e=$S(this);try{i(rm(JS,e),rm(nm,e))}catch(t){nm(e,t)}},Nb=jf.prototype,zb=function(i){rge(this,{type:Ub,done:!1,notified:!1,parent:!1,reactions:new ege,rejection:!1,state:bU,value:void 0})},zb.prototype=dU(Nb,"then",function(i,e){var t=$S(this),r=ZS(Xpe(this,jf));return t.parent=!0,r.ok=kb(i)?i:!0,r.fail=kb(e)&&e,r.domain=Rb?WS.domain:void 0,t.state==bU?t.reactions.add(r):jS(function(){SU(r,t)}),r.promise}),BU=function(){var i=new zb,e=$S(i);this.promise=i,this.resolve=rm(JS,e),this.reject=rm(nm,e)},mU.f=ZS=function(i){return i===jf||i===lge?new BU(i):nge(i)},kb(Ob)&&im!==Object.prototype)){CU=im.then,ige||dU(im,"then",function(i,e){var t=this;return new jf(function(r,n){tm(CU,t,r,n)}).then(i,e)},{unsafe:!0});try{delete im.constructor}catch{}fU&&fU(im,Nb)}jpe({global:!0,constructor:!0,wrap:!0,forced:yU},{Promise:jf}),qpe(jf,Ub,!1),$pe(Ub);var C0={},hge=ja,Age=C0,dge=hge("iterator"),fge=Array.prototype,pge=function(i){return i!==void 0&&(Age.Array===i||fge[dge]===i)},gge=CS,MU=Wg,mge=zf,yge=C0,_ge=ja,vge=_ge("iterator"),PU=function(i){if(!mge(i))return MU(i,vge)||MU(i,"@@iterator")||yge[gge(i)]},bge=ll,xge=UA,wge=Ol,Bge=mb,Cge=PU,Ege=TypeError,Sge=function(i,e){var t=arguments.length<2?Cge(i):e;if(xge(t))return wge(bge(t,i));throw Ege(Bge(i)+" is not iterable")},Tge=ll,FU=Ol,Ige=Wg,Lge=function(i,e,t){var r,n;FU(i);try{if(r=Ige(i,"return"),!r){if(e==="throw")throw t;return t}r=Tge(r,i)}catch(o){n=!0,r=o}if(e==="throw")throw t;if(n)throw r;return FU(r),t},Mge=TS,Pge=ll,Fge=Ol,Dge=mb,Rge=pge,kge=Tb,DU=fb,Oge=Sge,Uge=PU,RU=Lge,Nge=TypeError,Qb=function(i,e){this.stopped=i,this.result=e},kU=Qb.prototype,OU=function(i,e,t){var r=t&&t.that,n=!!(t&&t.AS_ENTRIES),o=!!(t&&t.IS_RECORD),l=!!(t&&t.IS_ITERATOR),s=!!(t&&t.INTERRUPTED),g=Mge(e,r),v,T,F,R,U,J,te,Ae=function(pe){return v&&RU(v,"normal",pe),new Qb(!0,pe)},he=function(pe){return n?(Fge(pe),s?g(pe[0],pe[1],Ae):g(pe[0],pe[1])):s?g(pe,Ae):g(pe)};if(o)v=i.iterator;else if(l)v=i;else{if(T=Uge(i),!T)throw Nge(Dge(i)+" is not iterable");if(Rge(T)){for(F=0,R=kge(i);R>F;F++)if(U=he(i[F]),U&&DU(kU,U))return U;return new Qb(!1)}v=Oge(i,T)}for(J=o?i.next:v.next;!(te=Pge(J,v)).done;){try{U=he(te.value)}catch(pe){RU(v,"throw",pe)}if(typeof U=="object"&&U&&DU(kU,U))return U}return new Qb(!1)},zge=ja,UU=zge("iterator"),NU=!1;try{var Qge=0,zU={next:function(){return{done:!!Qge++}},return:function(){NU=!0}};zU[UU]=function(){return this},Array.from(zU,function(){throw 2})}catch{}var Vge=function(i,e){if(!e&&!NU)return!1;var t=!1;try{var r={};r[UU]=function(){return{next:function(){return{done:t=!0}}}},i(r)}catch{}return t},Hge=Db,Gge=Vge,jge=B0.CONSTRUCTOR,QU=jge||!Gge(function(i){Hge.all(i).then(void 0,function(){})}),qge=gc,$ge=ll,Kge=UA,Wge=em,Zge=VS,Xge=OU,Jge=QU;qge({target:"Promise",stat:!0,forced:Jge},{all:function(i){var e=this,t=Wge.f(e),r=t.resolve,n=t.reject,o=Zge(function(){var l=Kge(e.resolve),s=[],g=0,v=1;Xge(i,function(T){var F=g++,R=!1;v++,$ge(l,e,T).then(function(U){R||(R=!0,s[F]=U,--v||r(s))},n)}),--v||r(s)});return o.error&&n(o.value),t.promise}});var Yge=gc,eme=B0.CONSTRUCTOR,YS=Db,tme=Qf,ime=Eo,rme=Vf,VU=YS&&YS.prototype;if(Yge({target:"Promise",proto:!0,forced:eme,real:!0},{catch:function(i){return this.then(void 0,i)}}),ime(YS)){var HU=tme("Promise").prototype.catch;VU.catch!==HU&&rme(VU,"catch",HU,{unsafe:!0})}var nme=gc,sme=ll,ome=UA,ame=em,lme=VS,cme=OU,ume=QU;nme({target:"Promise",stat:!0,forced:ume},{race:function(i){var e=this,t=ame.f(e),r=t.reject,n=lme(function(){var o=ome(e.resolve);cme(i,function(l){sme(o,e,l).then(t.resolve,r)})});return n.error&&r(n.value),t.promise}});var hme=gc,Ame=ll,dme=em,fme=B0.CONSTRUCTOR;hme({target:"Promise",stat:!0,forced:fme},{reject:function(i){var e=dme.f(this);return Ame(e.reject,void 0,i),e.promise}});var pme=Ol,gme=OA,mme=em,yme=function(i,e){if(pme(i),gme(e)&&e.constructor===i)return e;var t=mme.f(i),r=t.resolve;return r(e),t.promise},_me=gc,vme=Qf,bme=B0.CONSTRUCTOR,xme=yme;vme("Promise"),_me({target:"Promise",stat:!0,forced:bme},{resolve:function(i){return xme(this,i)}});function GU(i,e,t,r,n,o,l){try{var s=i[o](l),g=s.value}catch(v){t(v);return}s.done?e(g):Promise.resolve(g).then(r,n)}function NA(i){return function(){var e=this,t=arguments;return new Promise(function(r,n){var o=i.apply(e,t);function l(g){GU(o,r,n,l,s,"next",g)}function s(g){GU(o,r,n,l,s,"throw",g)}l(void 0)})}}var wme=CS,Bme=String,rA=function(i){if(wme(i)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Bme(i)},Cme=Ol,jU=function(){var i=Cme(this),e="";return i.hasIndices&&(e+="d"),i.global&&(e+="g"),i.ignoreCase&&(e+="i"),i.multiline&&(e+="m"),i.dotAll&&(e+="s"),i.unicode&&(e+="u"),i.unicodeSets&&(e+="v"),i.sticky&&(e+="y"),e},eT=qo,Eme=Ca,tT=Eme.RegExp,iT=eT(function(){var i=tT("a","y");return i.lastIndex=2,i.exec("abcd")!=null}),Sme=iT||eT(function(){return!tT("a","y").sticky}),Tme=iT||eT(function(){var i=tT("^r","gy");return i.lastIndex=2,i.exec("str")!=null}),qU={BROKEN_CARET:Tme,MISSED_STICKY:Sme,UNSUPPORTED_Y:iT},$U={},Ime=EO,Lme=xS,Mme=Object.keys||function(i){return Ime(i,Lme)},Pme=Yh,Fme=uO,Dme=tA,Rme=Ol,kme=f0,Ome=Mme;$U.f=Pme&&!Fme?Object.defineProperties:function(i,e){Rme(i);for(var t=kme(e),r=Ome(e),n=r.length,o=0,l;n>o;)Dme.f(i,l=r[o++],t[l]);return i};var Ume=Ol,Nme=$U,KU=xS,zme=pS,Qme=jO,Vme=_b,Hme=fS,WU=">",ZU="<",rT="prototype",nT="script",XU=Hme("IE_PROTO"),sT=function(){},JU=function(i){return ZU+nT+WU+i+ZU+"/"+nT+WU},YU=function(i){i.write(JU("")),i.close();var e=i.parentWindow.Object;return i=null,e},Gme=function(){var i=Vme("iframe"),e="java"+nT+":",t;return i.style.display="none",Qme.appendChild(i),i.src=String(e),t=i.contentWindow.document,t.open(),t.write(JU("document.F=Object")),t.close(),t.F},Vb,Hb=function(){try{Vb=new ActiveXObject("htmlfile")}catch{}Hb=typeof document<"u"?document.domain&&Vb?YU(Vb):Gme():YU(Vb);for(var i=KU.length;i--;)delete Hb[rT][KU[i]];return Hb()};zme[XU]=!0;var oT=Object.create||function(i,e){var t;return i!==null?(sT[rT]=Ume(i),t=new sT,sT[rT]=null,t[XU]=i):t=Hb(),e===void 0?t:Nme.f(t,e)},jme=qo,qme=Ca,$me=qme.RegExp,Kme=jme(function(){var i=$me(".","s");return!(i.dotAll&&i.exec(`
`)&&i.flags==="s")}),Wme=qo,Zme=Ca,Xme=Zme.RegExp,Jme=Wme(function(){var i=Xme("(?<a>b)","g");return i.exec("b").groups.a!=="b"||"b".replace(i,"$<a>c")!=="bc"}),sm=ll,Gb=$o,Yme=rA,eye=jU,tye=qU,iye=iS,rye=oT,nye=Bb.get,sye=Kme,oye=Jme,aye=iye("native-string-replace",String.prototype.replace),jb=RegExp.prototype.exec,aT=jb,lye=Gb("".charAt),cye=Gb("".indexOf),uye=Gb("".replace),lT=Gb("".slice),cT=function(){var i=/a/,e=/b*/g;return sm(jb,i,"a"),sm(jb,e,"a"),i.lastIndex!==0||e.lastIndex!==0}(),e6=tye.BROKEN_CARET,uT=/()??/.exec("")[1]!==void 0,hye=cT||uT||e6||sye||oye;hye&&(aT=function(i){var e=this,t=nye(e),r=Yme(i),n=t.raw,o,l,s,g,v,T,F;if(n)return n.lastIndex=e.lastIndex,o=sm(aT,n,r),e.lastIndex=n.lastIndex,o;var R=t.groups,U=e6&&e.sticky,J=sm(eye,e),te=e.source,Ae=0,he=r;if(U&&(J=uye(J,"y",""),cye(J,"g")===-1&&(J+="g"),he=lT(r,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&lye(r,e.lastIndex-1)!==`
`)&&(te="(?: "+te+")",he=" "+he,Ae++),l=new RegExp("^(?:"+te+")",J)),uT&&(l=new RegExp("^"+te+"$(?!\\s)",J)),cT&&(s=e.lastIndex),g=sm(jb,U?l:e,he),U?g?(g.input=lT(g.input,Ae),g[0]=lT(g[0],Ae),g.index=e.lastIndex,e.lastIndex+=g[0].length):e.lastIndex=0:cT&&g&&(e.lastIndex=e.global?g.index+g[0].length:s),uT&&g&&g.length>1&&sm(aye,g[0],l,function(){for(v=1;v<arguments.length-2;v++)arguments[v]===void 0&&(g[v]=void 0)}),g&&R)for(g.groups=T=rye(null),v=0;v<R.length;v++)F=R[v],T[F[0]]=g[F[1]];return g});var qb=aT,Aye=gc,t6=qb;Aye({target:"RegExp",proto:!0,forced:/./.exec!==t6},{exec:t6});var i6=v0,r6=Vf,dye=qb,n6=qo,s6=ja,fye=p0,pye=s6("species"),hT=RegExp.prototype,AT=function(i,e,t,r){var n=s6(i),o=!n6(function(){var v={};return v[n]=function(){return 7},""[i](v)!=7}),l=o&&!n6(function(){var v=!1,T=/a/;return i==="split"&&(T={},T.constructor={},T.constructor[pye]=function(){return T},T.flags="",T[n]=/./[n]),T.exec=function(){return v=!0,null},T[n](""),!v});if(!o||!l||t){var s=i6(/./[n]),g=e(n,""[i],function(v,T,F,R,U){var J=i6(v),te=T.exec;return te===dye||te===hT.exec?o&&!U?{done:!0,value:s(T,F,R)}:{done:!0,value:J(F,T,R)}:{done:!1}});r6(String.prototype,i,g[0]),r6(hT,n,g[1])}r&&fye(hT[n],"sham",!0)},dT=$o,gye=Sb,mye=rA,yye=eA,_ye=dT("".charAt),o6=dT("".charCodeAt),vye=dT("".slice),a6=function(i){return function(e,t){var r=mye(yye(e)),n=gye(t),o=r.length,l,s;return n<0||n>=o?i?"":void 0:(l=o6(r,n),l<55296||l>56319||n+1===o||(s=o6(r,n+1))<56320||s>57343?i?_ye(r,n):l:i?vye(r,n,n+2):(l-55296<<10)+(s-56320)+65536)}},bye={codeAt:a6(!1),charAt:a6(!0)},xye=bye.charAt,fT=function(i,e,t){return e+(t?xye(i,e).length:1)},l6=ll,wye=Ol,Bye=Eo,Cye=Nf,Eye=qb,Sye=TypeError,pT=function(i,e){var t=i.exec;if(Bye(t)){var r=l6(t,i,e);return r!==null&&wye(r),r}if(Cye(i)==="RegExp")return l6(Eye,i,e);throw Sye("RegExp#exec called on incompatible receiver")},Tye=ll,Iye=AT,Lye=Ol,Mye=zf,Pye=Jg,gT=rA,Fye=eA,Dye=Wg,Rye=fT,c6=pT;Iye("match",function(i,e,t){return[function(r){var n=Fye(this),o=Mye(r)?void 0:Dye(r,i);return o?Tye(o,r,n):new RegExp(r)[i](gT(n))},function(r){var n=Lye(this),o=gT(r),l=t(e,n,o);if(l.done)return l.value;if(!n.global)return c6(n,o);var s=n.unicode;n.lastIndex=0;for(var g=[],v=0,T;(T=c6(n,o))!==null;){var F=gT(T[0]);g[v]=F,F===""&&(n.lastIndex=Rye(o,Pye(n.lastIndex),s)),v++}return v===0?null:g}]});var mT=$o,kye=yb,Oye=Math.floor,yT=mT("".charAt),Uye=mT("".replace),_T=mT("".slice),Nye=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,zye=/\$([$&'`]|\d{1,2})/g,Qye=function(i,e,t,r,n,o){var l=t+i.length,s=r.length,g=zye;return n!==void 0&&(n=kye(n),g=Nye),Uye(o,g,function(v,T){var F;switch(yT(T,0)){case"$":return"$";case"&":return i;case"`":return _T(e,0,t);case"'":return _T(e,l);case"<":F=n[_T(T,1,-1)];break;default:var R=+T;if(R===0)return v;if(R>s){var U=Oye(R/10);return U===0?v:U<=s?r[U-1]===void 0?yT(T,1):r[U-1]+yT(T,1):v}F=r[R-1]}return F===void 0?"":F})},Vye=SS,u6=ll,$b=$o,Hye=AT,Gye=qo,jye=Ol,qye=Eo,$ye=zf,Kye=Sb,Wye=Jg,om=rA,Zye=eA,Xye=fT,Jye=Wg,Yye=Qye,e0e=pT,t0e=ja,vT=t0e("replace"),i0e=Math.max,r0e=Math.min,n0e=$b([].concat),bT=$b([].push),h6=$b("".indexOf),A6=$b("".slice),s0e=function(i){return i===void 0?i:String(i)},o0e=function(){return"a".replace(/./,"$0")==="$0"}(),d6=function(){return/./[vT]?/./[vT]("a","$0")==="":!1}(),a0e=!Gye(function(){var i=/./;return i.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(i,"$<a>")!=="7"});Hye("replace",function(i,e,t){var r=d6?"$":"$0";return[function(n,o){var l=Zye(this),s=$ye(n)?void 0:Jye(n,vT);return s?u6(s,n,l,o):u6(e,om(l),n,o)},function(n,o){var l=jye(this),s=om(n);if(typeof o=="string"&&h6(o,r)===-1&&h6(o,"$<")===-1){var g=t(e,l,s,o);if(g.done)return g.value}var v=qye(o);v||(o=om(o));var T=l.global;if(T){var F=l.unicode;l.lastIndex=0}for(var R=[];;){var U=e0e(l,s);if(U===null||(bT(R,U),!T))break;var J=om(U[0]);J===""&&(l.lastIndex=Xye(s,Wye(l.lastIndex),F))}for(var te="",Ae=0,he=0;he<R.length;he++){U=R[he];for(var pe=om(U[0]),be=i0e(r0e(Kye(U.index),s.length),0),Te=[],qe=1;qe<U.length;qe++)bT(Te,s0e(U[qe]));var je=U.groups;if(v){var We=n0e([pe],Te,be,s);je!==void 0&&bT(We,je);var Ne=om(Vye(o,void 0,We))}else Ne=Yye(pe,s,be,Te,je,o);be>=Ae&&(te+=A6(s,Ae,be)+Ne,Ae=be+pe.length)}return te+A6(s,Ae)}]},!a0e||!o0e||d6);var l0e=OA,c0e=Nf,u0e=ja,h0e=u0e("match"),f6=function(i){var e;return l0e(i)&&((e=i[h0e])!==void 0?!!e:c0e(i)=="RegExp")},A0e=f6,d0e=TypeError,xT=function(i){if(A0e(i))throw d0e("The method doesn't accept regular expressions");return i},f0e=ja,p0e=f0e("match"),wT=function(i){var e=/./;try{"/./"[i](e)}catch{try{return e[p0e]=!1,"/./"[i](e)}catch{}}return!1},g0e=gc,p6=v0,m0e=Kg.f,y0e=Jg,g6=rA,_0e=xT,v0e=eA,b0e=wT,m6=p6("".startsWith),x0e=p6("".slice),w0e=Math.min,y6=b0e("startsWith"),B0e=!y6&&!!function(){var i=m0e(String.prototype,"startsWith");return i&&!i.writable}();g0e({target:"String",proto:!0,forced:!B0e&&!y6},{startsWith:function(i){var e=g6(v0e(this));_0e(i);var t=y0e(w0e(arguments.length>1?arguments[1]:void 0,e.length)),r=g6(i);return m6?m6(e,r,t):x0e(e,t,t+r.length)===r}});var C0e=ja,E0e=oT,S0e=tA.f,BT=C0e("unscopables"),CT=Array.prototype;CT[BT]==null&&S0e(CT,BT,{configurable:!0,value:E0e(null)});var T0e=function(i){CT[BT][i]=!0},I0e=qo,L0e=!I0e(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype}),M0e=yh,P0e=Eo,F0e=yb,D0e=fS,R0e=L0e,_6=D0e("IE_PROTO"),ET=Object,k0e=ET.prototype,v6=R0e?ET.getPrototypeOf:function(i){var e=F0e(i);if(M0e(e,_6))return e[_6];var t=e.constructor;return P0e(t)&&e instanceof t?t.prototype:e instanceof ET?k0e:null},O0e=qo,U0e=Eo,N0e=OA,b6=v6,z0e=Vf,Q0e=ja,ST=Q0e("iterator"),x6=!1,qf,TT,IT;[].keys&&(IT=[].keys(),"next"in IT?(TT=b6(b6(IT)),TT!==Object.prototype&&(qf=TT)):x6=!0);var V0e=!N0e(qf)||O0e(function(){var i={};return qf[ST].call(i)!==i});V0e&&(qf={}),U0e(qf[ST])||z0e(qf,ST,function(){return this});var w6={IteratorPrototype:qf,BUGGY_SAFARI_ITERATORS:x6},H0e=w6.IteratorPrototype,G0e=oT,j0e=db,q0e=BS,$0e=C0,K0e=function(){return this},W0e=function(i,e,t,r){var n=e+" Iterator";return i.prototype=G0e(H0e,{next:j0e(+!r,t)}),q0e(i,n,!1),$0e[n]=K0e,i},Z0e=gc,X0e=ll,B6=bb,J0e=Eo,Y0e=W0e,C6=v6,E6=LO,e_e=BS,t_e=p0,LT=Vf,i_e=ja,r_e=C0,S6=w6,n_e=B6.PROPER,s_e=B6.CONFIGURABLE,T6=S6.IteratorPrototype,Kb=S6.BUGGY_SAFARI_ITERATORS,E0=i_e("iterator"),I6="keys",S0="values",L6="entries",o_e=function(){return this},a_e=function(i,e,t,r,n,o,l){Y0e(t,e,r);var s=function(he){if(he===n&&R)return R;if(!Kb&&he in T)return T[he];switch(he){case I6:return function(){return new t(this,he)};case S0:return function(){return new t(this,he)};case L6:return function(){return new t(this,he)}}return function(){return new t(this)}},g=e+" Iterator",v=!1,T=i.prototype,F=T[E0]||T["@@iterator"]||n&&T[n],R=!Kb&&F||s(n),U=e=="Array"&&T.entries||F,J,te,Ae;if(U&&(J=C6(U.call(new i)),J!==Object.prototype&&J.next&&(C6(J)!==T6&&(E6?E6(J,T6):J0e(J[E0])||LT(J,E0,o_e)),e_e(J,g,!0))),n_e&&n==S0&&F&&F.name!==S0&&(s_e?t_e(T,"name",S0):(v=!0,R=function(){return X0e(F,this)})),n)if(te={values:s(S0),keys:o?R:s(I6),entries:s(L6)},l)for(Ae in te)(Kb||v||!(Ae in T))&&LT(T,Ae,te[Ae]);else Z0e({target:e,proto:!0,forced:Kb||v},te);return T[E0]!==R&&LT(T,E0,R,{name:n}),r_e[e]=R,te},l_e=function(i,e){return{value:i,done:e}},c_e=f0,MT=T0e,M6=C0,P6=Bb,u_e=tA.f,h_e=a_e,Wb=l_e,A_e=Yh,F6="Array Iterator",d_e=P6.set,f_e=P6.getterFor(F6),p_e=h_e(Array,"Array",function(i,e){d_e(this,{type:F6,target:c_e(i),index:0,kind:e})},function(){var i=f_e(this),e=i.target,t=i.kind,r=i.index++;return!e||r>=e.length?(i.target=void 0,Wb(void 0,!0)):t=="keys"?Wb(r,!1):t=="values"?Wb(e[r],!1):Wb([r,e[r]],!1)},"values"),D6=M6.Arguments=M6.Array;if(MT("keys"),MT("values"),MT("entries"),A_e&&D6.name!=="values")try{u_e(D6,"name",{value:"values"})}catch{}var g_e={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},m_e=_b,PT=m_e("span").classList,R6=PT&&PT.constructor&&PT.constructor.prototype,y_e=R6===Object.prototype?void 0:R6,k6=Ca,O6=g_e,__e=y_e,T0=p_e,FT=p0,U6=ja,DT=U6("iterator"),N6=U6("toStringTag"),RT=T0.values,z6=function(i,e){if(i){if(i[DT]!==RT)try{FT(i,DT,RT)}catch{i[DT]=RT}if(i[N6]||FT(i,N6,e),O6[e]){for(var t in T0)if(i[t]!==T0[t])try{FT(i,t,T0[t])}catch{i[t]=T0[t]}}}};for(var kT in O6)z6(k6[kT]&&k6[kT].prototype,kT);z6(__e,"DOMTokenList");function v_e(i,e){if(Yn(i)!=="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(Yn(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function b_e(i){var e=v_e(i,"string");return Yn(e)==="symbol"?e:String(e)}function OT(i,e,t){return e=b_e(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var x_e=UA,w_e=yb,B_e=Nk,C_e=Tb,E_e=TypeError,Q6=function(i){return function(e,t,r,n){x_e(t);var o=w_e(e),l=B_e(o),s=C_e(o),g=i?s-1:0,v=i?-1:1;if(r<2)for(;;){if(g in l){n=l[g],g+=v;break}if(g+=v,i?g<0:s<=g)throw E_e("Reduce of empty array with no initial value")}for(;i?g>=0:s>g;g+=v)g in l&&(n=t(n,l[g],g,o));return n}},S_e={left:Q6(!1),right:Q6(!0)},T_e=qo,V6=function(i,e){var t=[][i];return!!t&&T_e(function(){t.call(null,e||function(){return 1},1)})},I_e=gc,L_e=S_e.left,M_e=V6,H6=ZE,P_e=y0,F_e=!P_e&&H6>79&&H6<83,D_e=F_e||!M_e("reduce");I_e({target:"Array",proto:!0,forced:D_e},{reduce:function(i){var e=arguments.length;return L_e(this,i,e,e>1?arguments[1]:void 0)}});var R_e=gc,G6=v0,k_e=Kg.f,O_e=Jg,j6=rA,U_e=xT,N_e=eA,z_e=wT,q6=G6("".endsWith),Q_e=G6("".slice),V_e=Math.min,$6=z_e("endsWith"),H_e=!$6&&!!function(){var i=k_e(String.prototype,"endsWith");return i&&!i.writable}();R_e({target:"String",proto:!0,forced:!H_e&&!$6},{endsWith:function(i){var e=j6(N_e(this));U_e(i);var t=arguments.length>1?arguments[1]:void 0,r=e.length,n=t===void 0?r:V_e(O_e(t),r),o=j6(i);return q6?q6(e,o,n):Q_e(e,n-o.length,n)===o}});var G_e=nS,j_e=tA,q_e=db,$_e=function(i,e,t){var r=G_e(e);r in i?j_e.f(i,r,q_e(0,t)):i[r]=t},K6=xO,K_e=Tb,W_e=$_e,Z_e=Array,X_e=Math.max,J_e=function(i,e,t){for(var r=K_e(i),n=K6(e,r),o=K6(t===void 0?r:t,r),l=Z_e(X_e(o-n,0)),s=0;n<o;n++,s++)W_e(l,s,i[n]);return l.length=s,l},Y_e=SS,I0=ll,UT=$o,e1e=AT,t1e=Ol,i1e=zf,r1e=f6,W6=eA,n1e=zO,s1e=fT,o1e=Jg,NT=rA,a1e=Wg,Z6=J_e,X6=pT,l1e=qb,c1e=qU,u1e=qo,am=c1e.UNSUPPORTED_Y,J6=4294967295,h1e=Math.min,Y6=[].push,A1e=UT(/./.exec),lm=UT(Y6),L0=UT("".slice),d1e=!u1e(function(){var i=/(?:)/,e=i.exec;i.exec=function(){return e.apply(this,arguments)};var t="ab".split(i);return t.length!==2||t[0]!=="a"||t[1]!=="b"});e1e("split",function(i,e,t){var r;return"abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?r=function(n,o){var l=NT(W6(this)),s=o===void 0?J6:o>>>0;if(s===0)return[];if(n===void 0)return[l];if(!r1e(n))return I0(e,l,n,s);for(var g=[],v=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),T=0,F=new RegExp(n.source,v+"g"),R,U,J;(R=I0(l1e,F,l))&&(U=F.lastIndex,!(U>T&&(lm(g,L0(l,T,R.index)),R.length>1&&R.index<l.length&&Y_e(Y6,g,Z6(R,1)),J=R[0].length,T=U,g.length>=s)));)F.lastIndex===R.index&&F.lastIndex++;return T===l.length?(J||!A1e(F,""))&&lm(g,""):lm(g,L0(l,T)),g.length>s?Z6(g,0,s):g}:"0".split(void 0,0).length?r=function(n,o){return n===void 0&&o===0?[]:I0(e,this,n,o)}:r=e,[function(n,o){var l=W6(this),s=i1e(n)?void 0:a1e(n,i);return s?I0(s,n,l,o):I0(r,NT(l),n,o)},function(n,o){var l=t1e(this),s=NT(n),g=t(r,l,s,o,r!==e);if(g.done)return g.value;var v=n1e(l,RegExp),T=l.unicode,F=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.unicode?"u":"")+(am?"g":"y"),R=new v(am?"^(?:"+l.source+")":l,F),U=o===void 0?J6:o>>>0;if(U===0)return[];if(s.length===0)return X6(R,s)===null?[s]:[];for(var J=0,te=0,Ae=[];te<s.length;){R.lastIndex=am?0:te;var he=X6(R,am?L0(s,te):s),pe;if(he===null||(pe=h1e(o1e(R.lastIndex+(am?te:0)),s.length))===J)te=s1e(s,te,T);else{if(lm(Ae,L0(s,J,te)),Ae.length===U)return Ae;for(var be=1;be<=he.length-1;be++)if(lm(Ae,he[be]),Ae.length===U)return Ae;te=J=pe}}return lm(Ae,L0(s,J)),Ae}]},!d1e,am);var Zb={exports:{}},M0={exports:{}};(function(){var i,e,t,r,n,o;typeof performance<"u"&&performance!==null&&performance.now?M0.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(M0.exports=function(){return(i()-n)/1e6},e=process.hrtime,i=function(){var l;return l=e(),l[0]*1e9+l[1]},r=i(),o=process.uptime()*1e9,n=r-o):Date.now?(M0.exports=function(){return Date.now()-t},t=Date.now()):(M0.exports=function(){return new Date().getTime()-t},t=new Date().getTime())}).call(d0);for(var f1e=M0.exports,p1e=f1e,zA=typeof window>"u"?d0:window,Xb=["moz","webkit"],cm="AnimationFrame",um=zA["request"+cm],P0=zA["cancel"+cm]||zA["cancelRequest"+cm],F0=0;!um&&F0<Xb.length;F0++)um=zA[Xb[F0]+"Request"+cm],P0=zA[Xb[F0]+"Cancel"+cm]||zA[Xb[F0]+"CancelRequest"+cm];if(!um||!P0){var zT=0,eN=0,$f=[],g1e=1e3/60;um=function(i){if($f.length===0){var e=p1e(),t=Math.max(0,g1e-(e-zT));zT=t+e,setTimeout(function(){var r=$f.slice(0);$f.length=0;for(var n=0;n<r.length;n++)if(!r[n].cancelled)try{r[n].callback(zT)}catch(o){setTimeout(function(){throw o},0)}},Math.round(t))}return $f.push({handle:++eN,callback:i,cancelled:!1}),eN},P0=function(i){for(var e=0;e<$f.length;e++)$f[e].handle===i&&($f[e].cancelled=!0)}}Zb.exports=function(i){return um.call(zA,i)},Zb.exports.cancel=function(){P0.apply(zA,arguments)},Zb.exports.polyfill=function(i){i||(i=zA),i.requestAnimationFrame=um,i.cancelAnimationFrame=P0};var m1e=Zb.exports;const QT=Pk(m1e);var tN=`	
\v\f\r                　\u2028\u2029\uFEFF`,y1e=$o,_1e=eA,v1e=rA,VT=tN,iN=y1e("".replace),b1e=RegExp("^["+VT+"]+"),x1e=RegExp("(^|[^"+VT+"])["+VT+"]+$"),HT=function(i){return function(e){var t=v1e(_1e(e));return i&1&&(t=iN(t,b1e,"")),i&2&&(t=iN(t,x1e,"$1")),t}},w1e={start:HT(1),end:HT(2),trim:HT(3)},B1e=bb.PROPER,C1e=qo,rN=tN,nN="​᠎",E1e=function(i){return C1e(function(){return!!rN[i]()||nN[i]()!==nN||B1e&&rN[i].name!==i})},S1e=gc,T1e=w1e.trim,I1e=E1e;S1e({target:"String",proto:!0,forced:I1e("trim")},{trim:function(){return T1e(this)}});var L1e=function(i){this.ok=!1,this.alpha=1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i=i.replace(/ /g,""),i=i.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};i=e[i]||i;for(var t=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(g){return[parseInt(g[1]),parseInt(g[2]),parseInt(g[3]),parseFloat(g[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(g){return[parseInt(g[1]),parseInt(g[2]),parseInt(g[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(g){return[parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(g){return[parseInt(g[1]+g[1],16),parseInt(g[2]+g[2],16),parseInt(g[3]+g[3],16)]}}],r=0;r<t.length;r++){var n=t[r].re,o=t[r].process,l=n.exec(i);if(l){var s=o(l);this.r=s[0],this.g=s[1],this.b=s[2],s.length>3&&(this.alpha=s[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var g=this.r.toString(16),v=this.g.toString(16),T=this.b.toString(16);return g.length==1&&(g="0"+g),v.length==1&&(v="0"+v),T.length==1&&(T="0"+T),"#"+g+v+T},this.getHelpXML=function(){for(var g=new Array,v=0;v<t.length;v++)for(var T=t[v].example,F=0;F<T.length;F++)g[g.length]=T[F];for(var R in e)g[g.length]=R;var U=document.createElement("ul");U.setAttribute("id","rgbcolor-examples");for(var v=0;v<g.length;v++)try{var J=document.createElement("li"),te=new RGBColor(g[v]),Ae=document.createElement("div");Ae.style.cssText="margin: 3px; border: 1px solid black; background:"+te.toHex()+"; color:"+te.toHex(),Ae.appendChild(document.createTextNode("test"));var he=document.createTextNode(" "+g[v]+" -> "+te.toRGB()+" -> "+te.toHex());J.appendChild(Ae),J.appendChild(he),U.appendChild(J)}catch{}return U}};const GT=Pk(L1e);var M1e=gc,P1e=v0,F1e=BO.indexOf,D1e=V6,jT=P1e([].indexOf),sN=!!jT&&1/jT([1],1,-0)<0,R1e=sN||!D1e("indexOf");M1e({target:"Array",proto:!0,forced:R1e},{indexOf:function(i){var e=arguments.length>1?arguments[1]:void 0;return sN?jT(this,i,e)||0:F1e(this,i,e)}});var k1e=gc,O1e=$o,U1e=xT,N1e=eA,oN=rA,z1e=wT,Q1e=O1e("".indexOf);k1e({target:"String",proto:!0,forced:!z1e("includes")},{includes:function(i){return!!~Q1e(oN(N1e(this)),oN(U1e(i)),arguments.length>1?arguments[1]:void 0)}});var V1e=Nf,H1e=Array.isArray||function(i){return V1e(i)=="Array"},G1e=gc,j1e=$o,q1e=H1e,$1e=j1e([].reverse),aN=[1,2];G1e({target:"Array",proto:!0,forced:String(aN)===String(aN.reverse())},{reverse:function(){return q1e(this)&&(this.length=this.length),$1e(this)}});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var lN=function(i,e){return(lN=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)};function cN(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}lN(i,e),i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function K1e(i){var e="";Array.isArray(i)||(i=[i]);for(var t=0;t<i.length;t++){var r=i[t];if(r.type===xi.CLOSE_PATH)e+="z";else if(r.type===xi.HORIZ_LINE_TO)e+=(r.relative?"h":"H")+r.x;else if(r.type===xi.VERT_LINE_TO)e+=(r.relative?"v":"V")+r.y;else if(r.type===xi.MOVE_TO)e+=(r.relative?"m":"M")+r.x+" "+r.y;else if(r.type===xi.LINE_TO)e+=(r.relative?"l":"L")+r.x+" "+r.y;else if(r.type===xi.CURVE_TO)e+=(r.relative?"c":"C")+r.x1+" "+r.y1+" "+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===xi.SMOOTH_CURVE_TO)e+=(r.relative?"s":"S")+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===xi.QUAD_TO)e+=(r.relative?"q":"Q")+r.x1+" "+r.y1+" "+r.x+" "+r.y;else if(r.type===xi.SMOOTH_QUAD_TO)e+=(r.relative?"t":"T")+r.x+" "+r.y;else{if(r.type!==xi.ARC)throw new Error('Unexpected command type "'+r.type+'" at index '+t+".");e+=(r.relative?"a":"A")+r.rX+" "+r.rY+" "+r.xRot+" "+ +r.lArcFlag+" "+ +r.sweepFlag+" "+r.x+" "+r.y}}return e}function qT(i,e){var t=i[0],r=i[1];return[t*Math.cos(e)-r*Math.sin(e),t*Math.sin(e)+r*Math.cos(e)]}function _h(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];for(var t=0;t<i.length;t++)if(typeof i[t]!="number")throw new Error("assertNumbers arguments["+t+"] is not a number. "+typeof i[t]+" == typeof "+i[t]);return!0}var Fd=Math.PI;function $T(i,e,t){i.lArcFlag=i.lArcFlag===0?0:1,i.sweepFlag=i.sweepFlag===0?0:1;var r=i.rX,n=i.rY,o=i.x,l=i.y;r=Math.abs(i.rX),n=Math.abs(i.rY);var s=qT([(e-o)/2,(t-l)/2],-i.xRot/180*Fd),g=s[0],v=s[1],T=Math.pow(g,2)/Math.pow(r,2)+Math.pow(v,2)/Math.pow(n,2);1<T&&(r*=Math.sqrt(T),n*=Math.sqrt(T)),i.rX=r,i.rY=n;var F=Math.pow(r,2)*Math.pow(v,2)+Math.pow(n,2)*Math.pow(g,2),R=(i.lArcFlag!==i.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(r,2)*Math.pow(n,2)-F)/F)),U=r*v/n*R,J=-n*g/r*R,te=qT([U,J],i.xRot/180*Fd);i.cX=te[0]+(e+o)/2,i.cY=te[1]+(t+l)/2,i.phi1=Math.atan2((v-J)/n,(g-U)/r),i.phi2=Math.atan2((-v-J)/n,(-g-U)/r),i.sweepFlag===0&&i.phi2>i.phi1&&(i.phi2-=2*Fd),i.sweepFlag===1&&i.phi2<i.phi1&&(i.phi2+=2*Fd),i.phi1*=180/Fd,i.phi2*=180/Fd}function uN(i,e,t){_h(i,e,t);var r=i*i+e*e-t*t;if(0>r)return[];if(r===0)return[[i*t/(i*i+e*e),e*t/(i*i+e*e)]];var n=Math.sqrt(r);return[[(i*t+e*n)/(i*i+e*e),(e*t-i*n)/(i*i+e*e)],[(i*t-e*n)/(i*i+e*e),(e*t+i*n)/(i*i+e*e)]]}var aa,QA=Math.PI/180;function hN(i,e,t){return(1-t)*i+t*e}function AN(i,e,t,r){return i+Math.cos(r/180*Fd)*e+Math.sin(r/180*Fd)*t}function dN(i,e,t,r){var n=1e-6,o=e-i,l=t-e,s=3*o+3*(r-t)-6*l,g=6*(l-o),v=3*o;return Math.abs(s)<n?[-v/g]:function(T,F,R){R===void 0&&(R=1e-6);var U=T*T/4-F;if(U<-R)return[];if(U<=R)return[-T/2];var J=Math.sqrt(U);return[-T/2-J,-T/2+J]}(g/s,v/s,n)}function fN(i,e,t,r,n){var o=1-n;return i*(o*o*o)+e*(3*o*o*n)+t*(3*o*n*n)+r*(n*n*n)}(function(i){function e(){return n(function(s,g,v){return s.relative&&(s.x1!==void 0&&(s.x1+=g),s.y1!==void 0&&(s.y1+=v),s.x2!==void 0&&(s.x2+=g),s.y2!==void 0&&(s.y2+=v),s.x!==void 0&&(s.x+=g),s.y!==void 0&&(s.y+=v),s.relative=!1),s})}function t(){var s=NaN,g=NaN,v=NaN,T=NaN;return n(function(F,R,U){return F.type&xi.SMOOTH_CURVE_TO&&(F.type=xi.CURVE_TO,s=isNaN(s)?R:s,g=isNaN(g)?U:g,F.x1=F.relative?R-s:2*R-s,F.y1=F.relative?U-g:2*U-g),F.type&xi.CURVE_TO?(s=F.relative?R+F.x2:F.x2,g=F.relative?U+F.y2:F.y2):(s=NaN,g=NaN),F.type&xi.SMOOTH_QUAD_TO&&(F.type=xi.QUAD_TO,v=isNaN(v)?R:v,T=isNaN(T)?U:T,F.x1=F.relative?R-v:2*R-v,F.y1=F.relative?U-T:2*U-T),F.type&xi.QUAD_TO?(v=F.relative?R+F.x1:F.x1,T=F.relative?U+F.y1:F.y1):(v=NaN,T=NaN),F})}function r(){var s=NaN,g=NaN;return n(function(v,T,F){if(v.type&xi.SMOOTH_QUAD_TO&&(v.type=xi.QUAD_TO,s=isNaN(s)?T:s,g=isNaN(g)?F:g,v.x1=v.relative?T-s:2*T-s,v.y1=v.relative?F-g:2*F-g),v.type&xi.QUAD_TO){s=v.relative?T+v.x1:v.x1,g=v.relative?F+v.y1:v.y1;var R=v.x1,U=v.y1;v.type=xi.CURVE_TO,v.x1=((v.relative?0:T)+2*R)/3,v.y1=((v.relative?0:F)+2*U)/3,v.x2=(v.x+2*R)/3,v.y2=(v.y+2*U)/3}else s=NaN,g=NaN;return v})}function n(s){var g=0,v=0,T=NaN,F=NaN;return function(R){if(isNaN(T)&&!(R.type&xi.MOVE_TO))throw new Error("path must start with moveto");var U=s(R,g,v,T,F);return R.type&xi.CLOSE_PATH&&(g=T,v=F),R.x!==void 0&&(g=R.relative?g+R.x:R.x),R.y!==void 0&&(v=R.relative?v+R.y:R.y),R.type&xi.MOVE_TO&&(T=g,F=v),U}}function o(s,g,v,T,F,R){return _h(s,g,v,T,F,R),n(function(U,J,te,Ae){var he=U.x1,pe=U.x2,be=U.relative&&!isNaN(Ae),Te=U.x!==void 0?U.x:be?0:J,qe=U.y!==void 0?U.y:be?0:te;function je(Le){return Le*Le}U.type&xi.HORIZ_LINE_TO&&g!==0&&(U.type=xi.LINE_TO,U.y=U.relative?0:te),U.type&xi.VERT_LINE_TO&&v!==0&&(U.type=xi.LINE_TO,U.x=U.relative?0:J),U.x!==void 0&&(U.x=U.x*s+qe*v+(be?0:F)),U.y!==void 0&&(U.y=Te*g+U.y*T+(be?0:R)),U.x1!==void 0&&(U.x1=U.x1*s+U.y1*v+(be?0:F)),U.y1!==void 0&&(U.y1=he*g+U.y1*T+(be?0:R)),U.x2!==void 0&&(U.x2=U.x2*s+U.y2*v+(be?0:F)),U.y2!==void 0&&(U.y2=pe*g+U.y2*T+(be?0:R));var We=s*T-g*v;if(U.xRot!==void 0&&(s!==1||g!==0||v!==0||T!==1))if(We===0)delete U.rX,delete U.rY,delete U.xRot,delete U.lArcFlag,delete U.sweepFlag,U.type=xi.LINE_TO;else{var Ne=U.xRot*Math.PI/180,at=Math.sin(Ne),nt=Math.cos(Ne),ke=1/je(U.rX),De=1/je(U.rY),Ye=je(nt)*ke+je(at)*De,Ze=2*at*nt*(ke-De),Ct=je(at)*ke+je(nt)*De,Et=Ye*T*T-Ze*g*T+Ct*g*g,Pt=Ze*(s*T+g*v)-2*(Ye*v*T+Ct*s*g),bt=Ye*v*v-Ze*s*v+Ct*s*s,Rt=(Math.atan2(Pt,Et-bt)+Math.PI)%Math.PI/2,Ft=Math.sin(Rt),Xt=Math.cos(Rt);U.rX=Math.abs(We)/Math.sqrt(Et*je(Xt)+Pt*Ft*Xt+bt*je(Ft)),U.rY=Math.abs(We)/Math.sqrt(Et*je(Ft)-Pt*Ft*Xt+bt*je(Xt)),U.xRot=180*Rt/Math.PI}return U.sweepFlag!==void 0&&0>We&&(U.sweepFlag=+!U.sweepFlag),U})}function l(){return function(s){var g={};for(var v in s)g[v]=s[v];return g}}i.ROUND=function(s){function g(v){return Math.round(v*s)/s}return s===void 0&&(s=1e13),_h(s),function(v){return v.x1!==void 0&&(v.x1=g(v.x1)),v.y1!==void 0&&(v.y1=g(v.y1)),v.x2!==void 0&&(v.x2=g(v.x2)),v.y2!==void 0&&(v.y2=g(v.y2)),v.x!==void 0&&(v.x=g(v.x)),v.y!==void 0&&(v.y=g(v.y)),v.rX!==void 0&&(v.rX=g(v.rX)),v.rY!==void 0&&(v.rY=g(v.rY)),v}},i.TO_ABS=e,i.TO_REL=function(){return n(function(s,g,v){return s.relative||(s.x1!==void 0&&(s.x1-=g),s.y1!==void 0&&(s.y1-=v),s.x2!==void 0&&(s.x2-=g),s.y2!==void 0&&(s.y2-=v),s.x!==void 0&&(s.x-=g),s.y!==void 0&&(s.y-=v),s.relative=!0),s})},i.NORMALIZE_HVZ=function(s,g,v){return s===void 0&&(s=!0),g===void 0&&(g=!0),v===void 0&&(v=!0),n(function(T,F,R,U,J){if(isNaN(U)&&!(T.type&xi.MOVE_TO))throw new Error("path must start with moveto");return g&&T.type&xi.HORIZ_LINE_TO&&(T.type=xi.LINE_TO,T.y=T.relative?0:R),v&&T.type&xi.VERT_LINE_TO&&(T.type=xi.LINE_TO,T.x=T.relative?0:F),s&&T.type&xi.CLOSE_PATH&&(T.type=xi.LINE_TO,T.x=T.relative?U-F:U,T.y=T.relative?J-R:J),T.type&xi.ARC&&(T.rX===0||T.rY===0)&&(T.type=xi.LINE_TO,delete T.rX,delete T.rY,delete T.xRot,delete T.lArcFlag,delete T.sweepFlag),T})},i.NORMALIZE_ST=t,i.QT_TO_C=r,i.INFO=n,i.SANITIZE=function(s){s===void 0&&(s=0),_h(s);var g=NaN,v=NaN,T=NaN,F=NaN;return n(function(R,U,J,te,Ae){var he=Math.abs,pe=!1,be=0,Te=0;if(R.type&xi.SMOOTH_CURVE_TO&&(be=isNaN(g)?0:U-g,Te=isNaN(v)?0:J-v),R.type&(xi.CURVE_TO|xi.SMOOTH_CURVE_TO)?(g=R.relative?U+R.x2:R.x2,v=R.relative?J+R.y2:R.y2):(g=NaN,v=NaN),R.type&xi.SMOOTH_QUAD_TO?(T=isNaN(T)?U:2*U-T,F=isNaN(F)?J:2*J-F):R.type&xi.QUAD_TO?(T=R.relative?U+R.x1:R.x1,F=R.relative?J+R.y1:R.y2):(T=NaN,F=NaN),R.type&xi.LINE_COMMANDS||R.type&xi.ARC&&(R.rX===0||R.rY===0||!R.lArcFlag)||R.type&xi.CURVE_TO||R.type&xi.SMOOTH_CURVE_TO||R.type&xi.QUAD_TO||R.type&xi.SMOOTH_QUAD_TO){var qe=R.x===void 0?0:R.relative?R.x:R.x-U,je=R.y===void 0?0:R.relative?R.y:R.y-J;be=isNaN(T)?R.x1===void 0?be:R.relative?R.x:R.x1-U:T-U,Te=isNaN(F)?R.y1===void 0?Te:R.relative?R.y:R.y1-J:F-J;var We=R.x2===void 0?0:R.relative?R.x:R.x2-U,Ne=R.y2===void 0?0:R.relative?R.y:R.y2-J;he(qe)<=s&&he(je)<=s&&he(be)<=s&&he(Te)<=s&&he(We)<=s&&he(Ne)<=s&&(pe=!0)}return R.type&xi.CLOSE_PATH&&he(U-te)<=s&&he(J-Ae)<=s&&(pe=!0),pe?[]:R})},i.MATRIX=o,i.ROTATE=function(s,g,v){g===void 0&&(g=0),v===void 0&&(v=0),_h(s,g,v);var T=Math.sin(s),F=Math.cos(s);return o(F,T,-T,F,g-g*F+v*T,v-g*T-v*F)},i.TRANSLATE=function(s,g){return g===void 0&&(g=0),_h(s,g),o(1,0,0,1,s,g)},i.SCALE=function(s,g){return g===void 0&&(g=s),_h(s,g),o(s,0,0,g,0,0)},i.SKEW_X=function(s){return _h(s),o(1,0,Math.atan(s),1,0,0)},i.SKEW_Y=function(s){return _h(s),o(1,Math.atan(s),0,1,0,0)},i.X_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),_h(s),o(-1,0,0,1,s,0)},i.Y_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),_h(s),o(1,0,0,-1,0,s)},i.A_TO_C=function(){return n(function(s,g,v){return xi.ARC===s.type?function(T,F,R){var U,J,te,Ae;T.cX||$T(T,F,R);for(var he=Math.min(T.phi1,T.phi2),pe=Math.max(T.phi1,T.phi2)-he,be=Math.ceil(pe/90),Te=new Array(be),qe=F,je=R,We=0;We<be;We++){var Ne=hN(T.phi1,T.phi2,We/be),at=hN(T.phi1,T.phi2,(We+1)/be),nt=at-Ne,ke=4/3*Math.tan(nt*QA/4),De=[Math.cos(Ne*QA)-ke*Math.sin(Ne*QA),Math.sin(Ne*QA)+ke*Math.cos(Ne*QA)],Ye=De[0],Ze=De[1],Ct=[Math.cos(at*QA),Math.sin(at*QA)],Et=Ct[0],Pt=Ct[1],bt=[Et+ke*Math.sin(at*QA),Pt-ke*Math.cos(at*QA)],Rt=bt[0],Ft=bt[1];Te[We]={relative:T.relative,type:xi.CURVE_TO};var Xt=function(Le,Xe){var it=qT([Le*T.rX,Xe*T.rY],T.xRot),pt=it[0],mt=it[1];return[T.cX+pt,T.cY+mt]};U=Xt(Ye,Ze),Te[We].x1=U[0],Te[We].y1=U[1],J=Xt(Rt,Ft),Te[We].x2=J[0],Te[We].y2=J[1],te=Xt(Et,Pt),Te[We].x=te[0],Te[We].y=te[1],T.relative&&(Te[We].x1-=qe,Te[We].y1-=je,Te[We].x2-=qe,Te[We].y2-=je,Te[We].x-=qe,Te[We].y-=je),qe=(Ae=[Te[We].x,Te[We].y])[0],je=Ae[1]}return Te}(s,s.relative?0:g,s.relative?0:v):s})},i.ANNOTATE_ARCS=function(){return n(function(s,g,v){return s.relative&&(g=0,v=0),xi.ARC===s.type&&$T(s,g,v),s})},i.CLONE=l,i.CALCULATE_BOUNDS=function(){var s=function(R){var U={};for(var J in R)U[J]=R[J];return U},g=e(),v=r(),T=t(),F=n(function(R,U,J){var te=T(v(g(s(R))));function Ae(Ft){Ft>F.maxX&&(F.maxX=Ft),Ft<F.minX&&(F.minX=Ft)}function he(Ft){Ft>F.maxY&&(F.maxY=Ft),Ft<F.minY&&(F.minY=Ft)}if(te.type&xi.DRAWING_COMMANDS&&(Ae(U),he(J)),te.type&xi.HORIZ_LINE_TO&&Ae(te.x),te.type&xi.VERT_LINE_TO&&he(te.y),te.type&xi.LINE_TO&&(Ae(te.x),he(te.y)),te.type&xi.CURVE_TO){Ae(te.x),he(te.y);for(var pe=0,be=dN(U,te.x1,te.x2,te.x);pe<be.length;pe++)0<(Rt=be[pe])&&1>Rt&&Ae(fN(U,te.x1,te.x2,te.x,Rt));for(var Te=0,qe=dN(J,te.y1,te.y2,te.y);Te<qe.length;Te++)0<(Rt=qe[Te])&&1>Rt&&he(fN(J,te.y1,te.y2,te.y,Rt))}if(te.type&xi.ARC){Ae(te.x),he(te.y),$T(te,U,J);for(var je=te.xRot/180*Math.PI,We=Math.cos(je)*te.rX,Ne=Math.sin(je)*te.rX,at=-Math.sin(je)*te.rY,nt=Math.cos(je)*te.rY,ke=te.phi1<te.phi2?[te.phi1,te.phi2]:-180>te.phi2?[te.phi2+360,te.phi1+360]:[te.phi2,te.phi1],De=ke[0],Ye=ke[1],Ze=function(Ft){var Xt=Ft[0],Le=Ft[1],Xe=180*Math.atan2(Le,Xt)/Math.PI;return Xe<De?Xe+360:Xe},Ct=0,Et=uN(at,-We,0).map(Ze);Ct<Et.length;Ct++)(Rt=Et[Ct])>De&&Rt<Ye&&Ae(AN(te.cX,We,at,Rt));for(var Pt=0,bt=uN(nt,-Ne,0).map(Ze);Pt<bt.length;Pt++){var Rt;(Rt=bt[Pt])>De&&Rt<Ye&&he(AN(te.cY,Ne,nt,Rt))}}return R});return F.minX=1/0,F.maxX=-1/0,F.minY=1/0,F.maxY=-1/0,F}})(aa||(aa={}));var vh,pN=function(){function i(){}return i.prototype.round=function(e){return this.transform(aa.ROUND(e))},i.prototype.toAbs=function(){return this.transform(aa.TO_ABS())},i.prototype.toRel=function(){return this.transform(aa.TO_REL())},i.prototype.normalizeHVZ=function(e,t,r){return this.transform(aa.NORMALIZE_HVZ(e,t,r))},i.prototype.normalizeST=function(){return this.transform(aa.NORMALIZE_ST())},i.prototype.qtToC=function(){return this.transform(aa.QT_TO_C())},i.prototype.aToC=function(){return this.transform(aa.A_TO_C())},i.prototype.sanitize=function(e){return this.transform(aa.SANITIZE(e))},i.prototype.translate=function(e,t){return this.transform(aa.TRANSLATE(e,t))},i.prototype.scale=function(e,t){return this.transform(aa.SCALE(e,t))},i.prototype.rotate=function(e,t,r){return this.transform(aa.ROTATE(e,t,r))},i.prototype.matrix=function(e,t,r,n,o,l){return this.transform(aa.MATRIX(e,t,r,n,o,l))},i.prototype.skewX=function(e){return this.transform(aa.SKEW_X(e))},i.prototype.skewY=function(e){return this.transform(aa.SKEW_Y(e))},i.prototype.xSymmetry=function(e){return this.transform(aa.X_AXIS_SYMMETRY(e))},i.prototype.ySymmetry=function(e){return this.transform(aa.Y_AXIS_SYMMETRY(e))},i.prototype.annotateArcs=function(){return this.transform(aa.ANNOTATE_ARCS())},i}(),W1e=function(i){return i===" "||i==="	"||i==="\r"||i===`
`},gN=function(i){return 48<=i.charCodeAt(0)&&i.charCodeAt(0)<=57},Z1e=function(i){function e(){var t=i.call(this)||this;return t.curNumber="",t.curCommandType=-1,t.curCommandRelative=!1,t.canParseCommandOrComma=!0,t.curNumberHasExp=!1,t.curNumberHasExpDigits=!1,t.curNumberHasDecimal=!1,t.curArgs=[],t}return cN(e,i),e.prototype.finish=function(t){if(t===void 0&&(t=[]),this.parse(" ",t),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t},e.prototype.parse=function(t,r){var n=this;r===void 0&&(r=[]);for(var o=function(F){r.push(F),n.curArgs.length=0,n.canParseCommandOrComma=!0},l=0;l<t.length;l++){var s=t[l],g=!(this.curCommandType!==xi.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),v=gN(s)&&(this.curNumber==="0"&&s==="0"||g);if(!gN(s)||v)if(s!=="e"&&s!=="E")if(s!=="-"&&s!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(s!=="."||this.curNumberHasExp||this.curNumberHasDecimal||g){if(this.curNumber&&this.curCommandType!==-1){var T=Number(this.curNumber);if(isNaN(T))throw new SyntaxError("Invalid number ending at "+l);if(this.curCommandType===xi.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>T)throw new SyntaxError('Expected positive number, got "'+T+'" at index "'+l+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+l+'"')}this.curArgs.push(T),this.curArgs.length===X1e[this.curCommandType]&&(xi.HORIZ_LINE_TO===this.curCommandType?o({type:xi.HORIZ_LINE_TO,relative:this.curCommandRelative,x:T}):xi.VERT_LINE_TO===this.curCommandType?o({type:xi.VERT_LINE_TO,relative:this.curCommandRelative,y:T}):this.curCommandType===xi.MOVE_TO||this.curCommandType===xi.LINE_TO||this.curCommandType===xi.SMOOTH_QUAD_TO?(o({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),xi.MOVE_TO===this.curCommandType&&(this.curCommandType=xi.LINE_TO)):this.curCommandType===xi.CURVE_TO?o({type:xi.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===xi.SMOOTH_CURVE_TO?o({type:xi.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===xi.QUAD_TO?o({type:xi.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===xi.ARC&&o({type:xi.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!W1e(s))if(s===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(s!=="+"&&s!=="-"&&s!==".")if(v)this.curNumber=s,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+l+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+s+'" at index '+l+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,s!=="z"&&s!=="Z")if(s==="h"||s==="H")this.curCommandType=xi.HORIZ_LINE_TO,this.curCommandRelative=s==="h";else if(s==="v"||s==="V")this.curCommandType=xi.VERT_LINE_TO,this.curCommandRelative=s==="v";else if(s==="m"||s==="M")this.curCommandType=xi.MOVE_TO,this.curCommandRelative=s==="m";else if(s==="l"||s==="L")this.curCommandType=xi.LINE_TO,this.curCommandRelative=s==="l";else if(s==="c"||s==="C")this.curCommandType=xi.CURVE_TO,this.curCommandRelative=s==="c";else if(s==="s"||s==="S")this.curCommandType=xi.SMOOTH_CURVE_TO,this.curCommandRelative=s==="s";else if(s==="q"||s==="Q")this.curCommandType=xi.QUAD_TO,this.curCommandRelative=s==="q";else if(s==="t"||s==="T")this.curCommandType=xi.SMOOTH_QUAD_TO,this.curCommandRelative=s==="t";else{if(s!=="a"&&s!=="A")throw new SyntaxError('Unexpected character "'+s+'" at index '+l+".");this.curCommandType=xi.ARC,this.curCommandRelative=s==="a"}else r.push({type:xi.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=s,this.curNumberHasDecimal=s==="."}else this.curNumber+=s,this.curNumberHasDecimal=!0;else this.curNumber+=s;else this.curNumber+=s,this.curNumberHasExp=!0;else this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp}return r},e.prototype.transform=function(t){return Object.create(this,{parse:{value:function(r,n){n===void 0&&(n=[]);for(var o=0,l=Object.getPrototypeOf(this).parse.call(this,r);o<l.length;o++){var s=l[o],g=t(s);Array.isArray(g)?n.push.apply(n,g):n.push(g)}return n}}})},e}(pN),xi=function(i){function e(t){var r=i.call(this)||this;return r.commands=typeof t=="string"?e.parse(t):t,r}return cN(e,i),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=aa.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var r=[],n=0,o=this.commands;n<o.length;n++){var l=t(o[n]);Array.isArray(l)?r.push.apply(r,l):r.push(l)}return this.commands=r,this},e.encode=function(t){return K1e(t)},e.parse=function(t){var r=new Z1e,n=[];return r.parse(t,n),r.finish(n),n},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(pN),X1e=((vh={})[xi.MOVE_TO]=2,vh[xi.LINE_TO]=2,vh[xi.HORIZ_LINE_TO]=1,vh[xi.VERT_LINE_TO]=1,vh[xi.CLOSE_PATH]=0,vh[xi.QUAD_TO]=4,vh[xi.SMOOTH_QUAD_TO]=2,vh[xi.CURVE_TO]=6,vh[xi.SMOOTH_CURVE_TO]=4,vh[xi.ARC]=7,vh),J1e=ll,Y1e=yh,eve=fb,tve=jU,mN=RegExp.prototype,ive=function(i){var e=i.flags;return e===void 0&&!("flags"in mN)&&!Y1e(i,"flags")&&eve(mN,i)?J1e(tve,i):e},rve=bb.PROPER,nve=Vf,sve=Ol,yN=rA,ove=qo,ave=ive,KT="toString",lve=RegExp.prototype,_N=lve[KT],cve=ove(function(){return _N.call({source:"a",flags:"b"})!="/a/b"}),uve=rve&&_N.name!=KT;(cve||uve)&&nve(RegExp.prototype,KT,function(){var i=sve(this),e=yN(i.source),t=yN(ave(i));return"/"+e+"/"+t},{unsafe:!0});function Jb(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Jb=function(e){return typeof e}:Jb=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jb(i)}function hve(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var Ave=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],dve=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function fve(i,e,t,r,n){if(typeof i=="string"&&(i=document.getElementById(i)),!i||Jb(i)!=="object"||!("getContext"in i))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var o=i.getContext("2d");try{return o.getImageData(e,t,r,n)}catch(l){throw new Error("unable to access image data: "+l)}}function pve(i,e,t,r,n,o){if(!(isNaN(o)||o<1)){o|=0;var l=fve(i,e,t,r,n);l=gve(l,e,t,r,n,o),i.getContext("2d").putImageData(l,e,t)}}function gve(i,e,t,r,n,o){for(var l=i.data,s=2*o+1,g=r-1,v=n-1,T=o+1,F=T*(T+1)/2,R=new vN,U=R,J,te=1;te<s;te++)U=U.next=new vN,te===T&&(J=U);U.next=R;for(var Ae=null,he=null,pe=0,be=0,Te=Ave[o],qe=dve[o],je=0;je<n;je++){U=R;for(var We=l[be],Ne=l[be+1],at=l[be+2],nt=l[be+3],ke=0;ke<T;ke++)U.r=We,U.g=Ne,U.b=at,U.a=nt,U=U.next;for(var De=0,Ye=0,Ze=0,Ct=0,Et=T*We,Pt=T*Ne,bt=T*at,Rt=T*nt,Ft=F*We,Xt=F*Ne,Le=F*at,Xe=F*nt,it=1;it<T;it++){var pt=be+((g<it?g:it)<<2),mt=l[pt],Bt=l[pt+1],Dt=l[pt+2],Mt=l[pt+3],qt=T-it;Ft+=(U.r=mt)*qt,Xt+=(U.g=Bt)*qt,Le+=(U.b=Dt)*qt,Xe+=(U.a=Mt)*qt,De+=mt,Ye+=Bt,Ze+=Dt,Ct+=Mt,U=U.next}Ae=R,he=J;for(var ni=0;ni<r;ni++){var _i=Xe*Te>>qe;if(l[be+3]=_i,_i!==0){var vi=255/_i;l[be]=(Ft*Te>>qe)*vi,l[be+1]=(Xt*Te>>qe)*vi,l[be+2]=(Le*Te>>qe)*vi}else l[be]=l[be+1]=l[be+2]=0;Ft-=Et,Xt-=Pt,Le-=bt,Xe-=Rt,Et-=Ae.r,Pt-=Ae.g,bt-=Ae.b,Rt-=Ae.a;var Pi=ni+o+1;Pi=pe+(Pi<g?Pi:g)<<2,De+=Ae.r=l[Pi],Ye+=Ae.g=l[Pi+1],Ze+=Ae.b=l[Pi+2],Ct+=Ae.a=l[Pi+3],Ft+=De,Xt+=Ye,Le+=Ze,Xe+=Ct,Ae=Ae.next;var kt=he,lt=kt.r,wt=kt.g,Oi=kt.b,ti=kt.a;Et+=lt,Pt+=wt,bt+=Oi,Rt+=ti,De-=lt,Ye-=wt,Ze-=Oi,Ct-=ti,he=he.next,be+=4}pe+=r}for(var ht=0;ht<r;ht++){be=ht<<2;var $t=l[be],oi=l[be+1],gi=l[be+2],ci=l[be+3],Ki=T*$t,tr=T*oi,pr=T*gi,Mr=T*ci,zt=F*$t,Wi=F*oi,hi=F*gi,Wt=F*ci;U=R;for(var Ar=0;Ar<T;Ar++)U.r=$t,U.g=oi,U.b=gi,U.a=ci,U=U.next;for(var Qt=r,Si=0,Ii=0,Zt=0,bi=0,ei=1;ei<=o;ei++){be=Qt+ht<<2;var _r=T-ei;zt+=(U.r=$t=l[be])*_r,Wi+=(U.g=oi=l[be+1])*_r,hi+=(U.b=gi=l[be+2])*_r,Wt+=(U.a=ci=l[be+3])*_r,bi+=$t,Si+=oi,Ii+=gi,Zt+=ci,U=U.next,ei<v&&(Qt+=r)}be=ht,Ae=R,he=J;for(var Zr=0;Zr<n;Zr++){var Qe=be<<2;l[Qe+3]=ci=Wt*Te>>qe,ci>0?(ci=255/ci,l[Qe]=(zt*Te>>qe)*ci,l[Qe+1]=(Wi*Te>>qe)*ci,l[Qe+2]=(hi*Te>>qe)*ci):l[Qe]=l[Qe+1]=l[Qe+2]=0,zt-=Ki,Wi-=tr,hi-=pr,Wt-=Mr,Ki-=Ae.r,tr-=Ae.g,pr-=Ae.b,Mr-=Ae.a,Qe=ht+((Qe=Zr+T)<v?Qe:v)*r<<2,zt+=bi+=Ae.r=l[Qe],Wi+=Si+=Ae.g=l[Qe+1],hi+=Ii+=Ae.b=l[Qe+2],Wt+=Zt+=Ae.a=l[Qe+3],Ae=Ae.next,Ki+=$t=he.r,tr+=oi=he.g,pr+=gi=he.b,Mr+=ci=he.a,bi-=$t,Si-=oi,Ii-=gi,Zt-=ci,he=he.next,be+=r}}return i}var vN=function i(){hve(this,i),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function mve(){var{DOMParser:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:i,createCanvas(t,r){return new OffscreenCanvas(t,r)},createImage(t){return NA(function*(){var r=yield fetch(t),n=yield r.blob(),o=yield createImageBitmap(n);return o})()}};return(typeof DOMParser<"u"||typeof i>"u")&&Reflect.deleteProperty(e,"DOMParser"),e}function yve(i){var{DOMParser:e,canvas:t,fetch:r}=i;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:e,fetch:r,createCanvas:t.createCanvas,createImage:t.loadImage}}var _ve=Object.freeze({__proto__:null,offscreen:mve,node:yve});function Kf(i){return i.replace(/(?!\u3000)\s+/gm," ")}function bN(i){return i.replace(/^[\n \t]+/,"")}function xN(i){return i.replace(/[\n \t]+$/,"")}function Oc(i){var e=(i||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return e.map(parseFloat)}var vve=/^[A-Z-]+$/;function wN(i){return vve.test(i)?i.toLowerCase():i}function WT(i){var e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(i)||[];return e[2]||e[3]||e[4]}function BN(i){if(!i.startsWith("rgb"))return i;var e=3,t=i.replace(/\d+(\.\d+)?/g,(r,n)=>e--&&n?String(Math.round(parseFloat(r))):r);return t}var bve=/(\[[^\]]+\])/g,xve=/(#[^\s+>~.[:]+)/g,wve=/(\.[^\s+>~.[:]+)/g,Bve=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,Cve=/(:[\w-]+\([^)]*\))/gi,Eve=/(:[^\s+>~.[:]+)/g,Sve=/([^\s+>~.[:]+)/g;function Wf(i,e){var t=e.exec(i);return t?[i.replace(e," "),t.length]:[i,0]}function CN(i){var e=[0,0,0],t=i.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),r=0;return[t,r]=Wf(t,bve),e[1]+=r,[t,r]=Wf(t,xve),e[0]+=r,[t,r]=Wf(t,wve),e[1]+=r,[t,r]=Wf(t,Bve),e[2]+=r,[t,r]=Wf(t,Cve),e[1]+=r,[t,r]=Wf(t,Eve),e[1]+=r,t=t.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[t,r]=Wf(t,Sve),e[2]+=r,e.join("")}var Zf=1e-8;function ZT(i){return Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2))}function Yb(i,e){return(i[0]*e[0]+i[1]*e[1])/(ZT(i)*ZT(e))}function XT(i,e){return(i[0]*e[1]<i[1]*e[0]?-1:1)*Math.acos(Yb(i,e))}function JT(i){return i*i*i}function YT(i){return 3*i*i*(1-i)}function eI(i){return 3*i*(1-i)*(1-i)}function tI(i){return(1-i)*(1-i)*(1-i)}function iI(i){return i*i}function rI(i){return 2*i*(1-i)}function nI(i){return(1-i)*(1-i)}class Sr{constructor(e,t,r){this.document=e,this.name=t,this.value=r,this.isNormalizedColor=!1}static empty(e){return new Sr(e,"EMPTY","")}split(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:t,name:r}=this;return Kf(this.getString()).trim().split(e).map(n=>new Sr(t,r,n))}hasValue(e){var{value:t}=this;return t!==null&&t!==""&&(e||t!==0)&&typeof t<"u"}isString(e){var{value:t}=this,r=typeof t=="string";return!r||!e?r:e.test(t)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var e=this.getString();switch(!0){case e.endsWith("px"):case/^[0-9]+$/.test(e):return!0;default:return!1}}setValue(e){return this.value=e,this}getValue(e){return typeof e>"u"||this.hasValue()?this.value:e}getNumber(e){if(!this.hasValue())return typeof e>"u"?0:parseFloat(e);var{value:t}=this,r=parseFloat(t);return this.isString(/%$/)&&(r/=100),r}getString(e){return typeof e>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(e)}getColor(e){var t=this.getString(e);return this.isNormalizedColor||(this.isNormalizedColor=!0,t=BN(t),this.value=t),t}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[r,n]=typeof e=="boolean"?[void 0,e]:[e],{viewPort:o}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(o.computeSize("x"),o.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(o.computeSize("x"),o.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*o.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*o.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&n):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*o.computeSize(r);default:{var l=this.getNumber();return t&&l<1?l*o.computeSize(r):l}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var e=this.getString(),t=/#([^)'"]+)/.exec(e);return t&&(t=t[1]),t||(t=e),this.document.definitions[t]}getFillStyleDefinition(e,t){var r=this.getDefinition();if(!r)return null;if(typeof r.createGradient=="function")return r.createGradient(this.document.ctx,e,t);if(typeof r.createPattern=="function"){if(r.getHrefAttribute().hasValue()){var n=r.getAttribute("patternTransform");r=r.getHrefAttribute().getDefinition(),n.hasValue()&&r.getAttribute("patternTransform",!0).setValue(n.value)}return r.createPattern(this.document.ctx,e,t)}return null}getTextBaseline(){return this.hasValue()?Sr.textBaselineMapping[this.getString()]:null}addOpacity(e){for(var t=this.getColor(),r=t.length,n=0,o=0;o<r&&(t[o]===","&&n++,n!==3);o++);if(e.hasValue()&&this.isString()&&n!==3){var l=new GT(t);l.ok&&(l.alpha=e.getNumber(),t=l.toRGBA())}return new Sr(this.document,this.name,t)}}Sr.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class EN{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(e,t){this.viewPorts.push({width:e,height:t})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:e}=this;return e[e.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(e){return typeof e=="number"?e:e==="x"?this.width:e==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class So{constructor(e,t){this.x=e,this.y=t}static parse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[r=t,n=t]=Oc(e);return new So(r,n)}static parseScale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[r=t,n=r]=Oc(e);return new So(r,n)}static parsePath(e){for(var t=Oc(e),r=t.length,n=[],o=0;o<r;o+=2)n.push(new So(t[o],t[o+1]));return n}angleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}applyTransform(e){var{x:t,y:r}=this,n=t*e[0]+r*e[2]+e[4],o=t*e[1]+r*e[3]+e[5];this.x=n,this.y=o}}class SN{constructor(e){this.screen=e,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:e,onClick:t,onMouseMove:r}=this,n=e.ctx.canvas;n.onclick=t,n.onmousemove=r,this.working=!0}}stop(){if(this.working){var e=this.screen.ctx.canvas;this.working=!1,e.onclick=null,e.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:e,events:t,eventElements:r}=this,{style:n}=e.ctx.canvas;n&&(n.cursor=""),t.forEach((o,l)=>{for(var{run:s}=o,g=r[l];g;)s(g),g=g.parent}),this.events=[],this.eventElements=[]}}checkPath(e,t){if(!(!this.working||!t)){var{events:r,eventElements:n}=this;r.forEach((o,l)=>{var{x:s,y:g}=o;!n[l]&&t.isPointInPath&&t.isPointInPath(s,g)&&(n[l]=e)})}}checkBoundingBox(e,t){if(!(!this.working||!t)){var{events:r,eventElements:n}=this;r.forEach((o,l)=>{var{x:s,y:g}=o;!n[l]&&t.isPointInBox(s,g)&&(n[l]=e)})}}mapXY(e,t){for(var{window:r,ctx:n}=this.screen,o=new So(e,t),l=n.canvas;l;)o.x-=l.offsetLeft,o.y-=l.offsetTop,l=l.offsetParent;return r.scrollX&&(o.x+=r.scrollX),r.scrollY&&(o.y+=r.scrollY),o}onClick(e){var{x:t,y:r}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onclick",x:t,y:r,run(n){n.onClick&&n.onClick()}})}onMouseMove(e){var{x:t,y:r}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onmousemove",x:t,y:r,run(n){n.onMouseMove&&n.onMouseMove()}})}}var TN=typeof window<"u"?window:null,IN=typeof fetch<"u"?fetch.bind(void 0):null;class D0{constructor(e){var{fetch:t=IN,window:r=TN}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=e,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new EN,this.mouse=new SN(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=r,this.fetch=t}wait(e){this.waits.push(e)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var e=this.waits.every(t=>t());return e&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=e,e}setDefaults(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4}setViewBox(e){var{document:t,ctx:r,aspectRatio:n,width:o,desiredWidth:l,height:s,desiredHeight:g,minX:v=0,minY:T=0,refX:F,refY:R,clip:U=!1,clipX:J=0,clipY:te=0}=e,Ae=Kf(n).replace(/^defer\s/,""),[he,pe]=Ae.split(" "),be=he||"xMidYMid",Te=pe||"meet",qe=o/l,je=s/g,We=Math.min(qe,je),Ne=Math.max(qe,je),at=l,nt=g;Te==="meet"&&(at*=We,nt*=We),Te==="slice"&&(at*=Ne,nt*=Ne);var ke=new Sr(t,"refX",F),De=new Sr(t,"refY",R),Ye=ke.hasValue()&&De.hasValue();if(Ye&&r.translate(-We*ke.getPixels("x"),-We*De.getPixels("y")),U){var Ze=We*J,Ct=We*te;r.beginPath(),r.moveTo(Ze,Ct),r.lineTo(o,Ct),r.lineTo(o,s),r.lineTo(Ze,s),r.closePath(),r.clip()}if(!Ye){var Et=Te==="meet"&&We===je,Pt=Te==="slice"&&Ne===je,bt=Te==="meet"&&We===qe,Rt=Te==="slice"&&Ne===qe;be.startsWith("xMid")&&(Et||Pt)&&r.translate(o/2-at/2,0),be.endsWith("YMid")&&(bt||Rt)&&r.translate(0,s/2-nt/2),be.startsWith("xMax")&&(Et||Pt)&&r.translate(o-at,0),be.endsWith("YMax")&&(bt||Rt)&&r.translate(0,s-nt)}switch(!0){case be==="none":r.scale(qe,je);break;case Te==="meet":r.scale(We,We);break;case Te==="slice":r.scale(Ne,Ne);break}r.translate(-v,-T)}start(e){var{enableRedraw:t=!1,ignoreMouse:r=!1,ignoreAnimation:n=!1,ignoreDimensions:o=!1,ignoreClear:l=!1,forceRedraw:s,scaleWidth:g,scaleHeight:v,offsetX:T,offsetY:F}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:R,mouse:U}=this,J=1e3/R;if(this.frameDuration=J,this.readyPromise=new Promise(be=>{this.resolveReady=be}),this.isReady()&&this.render(e,o,l,g,v,T,F),!!t){var te=Date.now(),Ae=te,he=0,pe=()=>{te=Date.now(),he=te-Ae,he>=J&&(Ae=te-he%J,this.shouldUpdate(n,s)&&(this.render(e,o,l,g,v,T,F),U.runEvents())),this.intervalId=QT(pe)};r||U.start(),this.intervalId=QT(pe)}}stop(){this.intervalId&&(QT.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(e,t){if(!e){var{frameDuration:r}=this,n=this.animations.reduce((o,l)=>l.update(r)||o,!1);if(n)return!0}return!!(typeof t=="function"&&t()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(e,t,r,n,o,l,s){var{CLIENT_WIDTH:g,CLIENT_HEIGHT:v,viewPort:T,ctx:F,isFirstRender:R}=this,U=F.canvas;T.clear(),U.width&&U.height?T.setCurrent(U.width,U.height):T.setCurrent(g,v);var J=e.getStyle("width"),te=e.getStyle("height");!t&&(R||typeof n!="number"&&typeof o!="number")&&(J.hasValue()&&(U.width=J.getPixels("x"),U.style&&(U.style.width="".concat(U.width,"px"))),te.hasValue()&&(U.height=te.getPixels("y"),U.style&&(U.style.height="".concat(U.height,"px"))));var Ae=U.clientWidth||U.width,he=U.clientHeight||U.height;if(t&&J.hasValue()&&te.hasValue()&&(Ae=J.getPixels("x"),he=te.getPixels("y")),T.setCurrent(Ae,he),typeof l=="number"&&e.getAttribute("x",!0).setValue(l),typeof s=="number"&&e.getAttribute("y",!0).setValue(s),typeof n=="number"||typeof o=="number"){var pe=Oc(e.getAttribute("viewBox").getString()),be=0,Te=0;if(typeof n=="number"){var qe=e.getStyle("width");qe.hasValue()?be=qe.getPixels("x")/n:isNaN(pe[2])||(be=pe[2]/n)}if(typeof o=="number"){var je=e.getStyle("height");je.hasValue()?Te=je.getPixels("y")/o:isNaN(pe[3])||(Te=pe[3]/o)}be||(be=Te),Te||(Te=be),e.getAttribute("width",!0).setValue(n),e.getAttribute("height",!0).setValue(o);var We=e.getStyle("transform",!0,!0);We.setValue("".concat(We.getString()," scale(").concat(1/be,", ").concat(1/Te,")"))}r||F.clearRect(0,0,Ae,he),e.render(F),R&&(this.isFirstRender=!1)}}D0.defaultWindow=TN,D0.defaultFetch=IN;var{defaultFetch:Tve}=D0,Ive=typeof DOMParser<"u"?DOMParser:null;class ex{constructor(){var{fetch:e=Tve,DOMParser:t=Ive}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=e,this.DOMParser=t}parse(e){var t=this;return NA(function*(){return e.startsWith("<")?t.parseFromString(e):t.load(e)})()}parseFromString(e){var t=new this.DOMParser;try{return this.checkDocument(t.parseFromString(e,"image/svg+xml"))}catch{return this.checkDocument(t.parseFromString(e,"text/xml"))}}checkDocument(e){var t=e.getElementsByTagName("parsererror")[0];if(t)throw new Error(t.textContent);return e}load(e){var t=this;return NA(function*(){var r=yield t.fetch(e),n=yield r.text();return t.parseFromString(n)})()}}class LN{constructor(e,t){this.type="translate",this.point=null,this.point=So.parse(t)}apply(e){var{x:t,y:r}=this.point;e.translate(t||0,r||0)}unapply(e){var{x:t,y:r}=this.point;e.translate(-1*t||0,-1*r||0)}applyToPoint(e){var{x:t,y:r}=this.point;e.applyTransform([1,0,0,1,t||0,r||0])}}class MN{constructor(e,t,r){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var n=Oc(t);this.angle=new Sr(e,"angle",n[0]),this.originX=r[0],this.originY=r[1],this.cx=n[1]||0,this.cy=n[2]||0}apply(e){var{cx:t,cy:r,originX:n,originY:o,angle:l}=this,s=t+n.getPixels("x"),g=r+o.getPixels("y");e.translate(s,g),e.rotate(l.getRadians()),e.translate(-s,-g)}unapply(e){var{cx:t,cy:r,originX:n,originY:o,angle:l}=this,s=t+n.getPixels("x"),g=r+o.getPixels("y");e.translate(s,g),e.rotate(-1*l.getRadians()),e.translate(-s,-g)}applyToPoint(e){var{cx:t,cy:r,angle:n}=this,o=n.getRadians();e.applyTransform([1,0,0,1,t||0,r||0]),e.applyTransform([Math.cos(o),Math.sin(o),-Math.sin(o),Math.cos(o),0,0]),e.applyTransform([1,0,0,1,-t||0,-r||0])}}class PN{constructor(e,t,r){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var n=So.parseScale(t);(n.x===0||n.y===0)&&(n.x=Zf,n.y=Zf),this.scale=n,this.originX=r[0],this.originY=r[1]}apply(e){var{scale:{x:t,y:r},originX:n,originY:o}=this,l=n.getPixels("x"),s=o.getPixels("y");e.translate(l,s),e.scale(t,r||t),e.translate(-l,-s)}unapply(e){var{scale:{x:t,y:r},originX:n,originY:o}=this,l=n.getPixels("x"),s=o.getPixels("y");e.translate(l,s),e.scale(1/t,1/r||t),e.translate(-l,-s)}applyToPoint(e){var{x:t,y:r}=this.scale;e.applyTransform([t||0,0,0,r||0,0,0])}}class sI{constructor(e,t,r){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=Oc(t),this.originX=r[0],this.originY=r[1]}apply(e){var{originX:t,originY:r,matrix:n}=this,o=t.getPixels("x"),l=r.getPixels("y");e.translate(o,l),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),e.translate(-o,-l)}unapply(e){var{originX:t,originY:r,matrix:n}=this,o=n[0],l=n[2],s=n[4],g=n[1],v=n[3],T=n[5],F=0,R=0,U=1,J=1/(o*(v*U-T*R)-l*(g*U-T*F)+s*(g*R-v*F)),te=t.getPixels("x"),Ae=r.getPixels("y");e.translate(te,Ae),e.transform(J*(v*U-T*R),J*(T*F-g*U),J*(s*R-l*U),J*(o*U-s*F),J*(l*T-s*v),J*(s*g-o*T)),e.translate(-te,-Ae)}applyToPoint(e){e.applyTransform(this.matrix)}}class oI extends sI{constructor(e,t,r){super(e,t,r),this.type="skew",this.angle=null,this.angle=new Sr(e,"angle",t)}}class FN extends oI{constructor(e,t,r){super(e,t,r),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class DN extends oI{constructor(e,t,r){super(e,t,r),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function Lve(i){return Kf(i).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function Mve(i){var[e,t]=i.split("(");return[e.trim(),t.trim().replace(")","")]}class Dd{constructor(e,t,r){this.document=e,this.transforms=[];var n=Lve(t);n.forEach(o=>{if(o!=="none"){var[l,s]=Mve(o),g=Dd.transformTypes[l];typeof g<"u"&&this.transforms.push(new g(this.document,s,r))}})}static fromElement(e,t){var r=t.getStyle("transform",!1,!0),[n,o=n]=t.getStyle("transform-origin",!1,!0).split(),l=[n,o];return r.hasValue()?new Dd(e,r.getString(),l):null}apply(e){for(var{transforms:t}=this,r=t.length,n=0;n<r;n++)t[n].apply(e)}unapply(e){for(var{transforms:t}=this,r=t.length,n=r-1;n>=0;n--)t[n].unapply(e)}applyToPoint(e){for(var{transforms:t}=this,r=t.length,n=0;n<r;n++)t[n].applyToPoint(e)}}Dd.transformTypes={translate:LN,rotate:MN,scale:PN,matrix:sI,skewX:FN,skewY:DN};class Hs{constructor(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=e,this.node=t,this.captureTextNodes=r,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!t||t.nodeType!==1)){if(Array.from(t.attributes).forEach(s=>{var g=wN(s.nodeName);this.attributes[g]=new Sr(e,g,s.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var n=this.getAttribute("style").getString().split(";").map(s=>s.trim());n.forEach(s=>{if(s){var[g,v]=s.split(":").map(T=>T.trim());this.styles[g]=new Sr(e,g,v)}})}var{definitions:o}=e,l=this.getAttribute("id");l.hasValue()&&(o[l.getString()]||(o[l.getString()]=this)),Array.from(t.childNodes).forEach(s=>{if(s.nodeType===1)this.addChild(s);else if(r&&(s.nodeType===3||s.nodeType===4)){var g=e.createTextNode(s);g.getText().length>0&&this.addChild(g)}})}}getAttribute(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.attributes[e];if(!r&&t){var n=new Sr(this.document,e,"");return this.attributes[e]=n,n}return r||Sr.empty(this.document)}getHrefAttribute(){for(var e in this.attributes)if(e==="href"||e.endsWith(":href"))return this.attributes[e];return Sr.empty(this.document)}getStyle(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.styles[e];if(n)return n;var o=this.getAttribute(e);if(o!=null&&o.hasValue())return this.styles[e]=o,o;if(!r){var{parent:l}=this;if(l){var s=l.getStyle(e);if(s!=null&&s.hasValue())return s}}if(t){var g=new Sr(this.document,e,"");return this.styles[e]=g,g}return n||Sr.empty(this.document)}render(e){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(e.save(),this.getStyle("mask").hasValue()){var t=this.getStyle("mask").getDefinition();t&&(this.applyEffects(e),t.apply(e,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var r=this.getStyle("filter").getDefinition();r&&(this.applyEffects(e),r.apply(e,this))}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}}setContext(e){}applyEffects(e){var t=Dd.fromElement(this.document,this);t&&t.apply(e);var r=this.getStyle("clip-path",!1,!0);if(r.hasValue()){var n=r.getDefinition();n&&n.apply(e)}}clearContext(e){}renderChildren(e){this.children.forEach(t=>{t.render(e)})}addChild(e){var t=e instanceof Hs?e:this.document.createElement(e);t.parent=this,Hs.ignoreChildTypes.includes(t.type)||this.children.push(t)}matchesSelector(e){var t,{node:r}=this;if(typeof r.matches=="function")return r.matches(e);var n=(t=r.getAttribute)===null||t===void 0?void 0:t.call(r,"class");return!n||n===""?!1:n.split(" ").some(o=>".".concat(o)===e)}addStylesFromStyleDefinition(){var{styles:e,stylesSpecificity:t}=this.document;for(var r in e)if(!r.startsWith("@")&&this.matchesSelector(r)){var n=e[r],o=t[r];if(n)for(var l in n){var s=this.stylesSpecificity[l];typeof s>"u"&&(s="000"),o>=s&&(this.styles[l]=n[l],this.stylesSpecificity[l]=o)}}}removeStyles(e,t){var r=t.reduce((n,o)=>{var l=e.getStyle(o);if(!l.hasValue())return n;var s=l.getString();return l.setValue(""),[...n,[o,s]]},[]);return r}restoreStyles(e,t){t.forEach(r=>{var[n,o]=r;e.getStyle(n,!0).setValue(o)})}isFirstChild(){var e;return((e=this.parent)===null||e===void 0?void 0:e.children.indexOf(this))===0}}Hs.ignoreChildTypes=["title"];class RN extends Hs{constructor(e,t,r){super(e,t,r)}}function Pve(i){var e=i.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function Fve(i){return typeof process>"u"?i:i.trim().split(",").map(Pve).join(",")}function Dve(i){if(!i)return"";var e=i.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}function Rve(i){if(!i)return"";var e=i.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class Ul{constructor(e,t,r,n,o,l){var s=l?typeof l=="string"?Ul.parse(l):l:{};this.fontFamily=o||s.fontFamily,this.fontSize=n||s.fontSize,this.fontStyle=e||s.fontStyle,this.fontWeight=r||s.fontWeight,this.fontVariant=t||s.fontVariant}static parse(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,r="",n="",o="",l="",s="",g=Kf(e).trim().split(" "),v={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return g.forEach(T=>{switch(!0){case(!v.fontStyle&&Ul.styles.includes(T)):T!=="inherit"&&(r=T),v.fontStyle=!0;break;case(!v.fontVariant&&Ul.variants.includes(T)):T!=="inherit"&&(n=T),v.fontStyle=!0,v.fontVariant=!0;break;case(!v.fontWeight&&Ul.weights.includes(T)):T!=="inherit"&&(o=T),v.fontStyle=!0,v.fontVariant=!0,v.fontWeight=!0;break;case!v.fontSize:T!=="inherit"&&([l]=T.split("/")),v.fontStyle=!0,v.fontVariant=!0,v.fontWeight=!0,v.fontSize=!0;break;default:T!=="inherit"&&(s+=T)}}),new Ul(r,n,o,l,s,t)}toString(){return[Dve(this.fontStyle),this.fontVariant,Rve(this.fontWeight),this.fontSize,Fve(this.fontFamily)].join(" ").trim()}}Ul.styles="normal|italic|oblique|inherit",Ul.variants="normal|small-caps|inherit",Ul.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class ku{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=e,this.y1=t,this.x2=r,this.y2=n,this.addPoint(e,t),this.addPoint(r,n)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(e,t){typeof e<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))}addX(e){this.addPoint(e,null)}addY(e){this.addPoint(null,e)}addBoundingBox(e){if(e){var{x1:t,y1:r,x2:n,y2:o}=e;this.addPoint(t,r),this.addPoint(n,o)}}sumCubic(e,t,r,n,o){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*r+3*(1-e)*Math.pow(e,2)*n+Math.pow(e,3)*o}bezierCurveAdd(e,t,r,n,o){var l=6*t-12*r+6*n,s=-3*t+9*r-9*n+3*o,g=3*r-3*t;if(s===0){if(l===0)return;var v=-g/l;0<v&&v<1&&(e?this.addX(this.sumCubic(v,t,r,n,o)):this.addY(this.sumCubic(v,t,r,n,o)));return}var T=Math.pow(l,2)-4*g*s;if(!(T<0)){var F=(-l+Math.sqrt(T))/(2*s);0<F&&F<1&&(e?this.addX(this.sumCubic(F,t,r,n,o)):this.addY(this.sumCubic(F,t,r,n,o)));var R=(-l-Math.sqrt(T))/(2*s);0<R&&R<1&&(e?this.addX(this.sumCubic(R,t,r,n,o)):this.addY(this.sumCubic(R,t,r,n,o)))}}addBezierCurve(e,t,r,n,o,l,s,g){this.addPoint(e,t),this.addPoint(s,g),this.bezierCurveAdd(!0,e,r,o,s),this.bezierCurveAdd(!1,t,n,l,g)}addQuadraticCurve(e,t,r,n,o,l){var s=e+.6666666666666666*(r-e),g=t+2/3*(n-t),v=s+1/3*(o-e),T=g+1/3*(l-t);this.addBezierCurve(e,t,s,v,g,T,o,l)}isPointInBox(e,t){var{x1:r,y1:n,x2:o,y2:l}=this;return r<=e&&e<=o&&n<=t&&t<=l}}class Yr extends xi{constructor(e){super(e.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new So(0,0),this.control=new So(0,0),this.current=new So(0,0),this.points=[],this.angles=[]}isEnd(){var{i:e,commands:t}=this;return e>=t.length-1}next(){var e=this.commands[++this.i];return this.previousCommand=this.command,this.command=e,e}getPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",r=new So(this.command[e],this.command[t]);return this.makeAbsolute(r)}getAsControlPoint(e,t){var r=this.getPoint(e,t);return this.control=r,r}getAsCurrentPoint(e,t){var r=this.getPoint(e,t);return this.current=r,r}getReflectedControlPoint(){var e=this.previousCommand.type;if(e!==xi.CURVE_TO&&e!==xi.SMOOTH_CURVE_TO&&e!==xi.QUAD_TO&&e!==xi.SMOOTH_QUAD_TO)return this.current;var{current:{x:t,y:r},control:{x:n,y:o}}=this,l=new So(2*t-n,2*r-o);return l}makeAbsolute(e){if(this.command.relative){var{x:t,y:r}=this.current;e.x+=t,e.y+=r}return e}addMarker(e,t,r){var{points:n,angles:o}=this;r&&o.length>0&&!o[o.length-1]&&(o[o.length-1]=n[n.length-1].angleTo(r)),this.addMarkerAngle(e,t?t.angleTo(e):null)}addMarkerAngle(e,t){this.points.push(e),this.angles.push(t)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:e}=this,t=e.length,r=0;r<t;r++)if(!e[r]){for(var n=r+1;n<t;n++)if(e[n]){e[r]=e[n];break}}return e}}class Rd extends Hs{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var e=1,t=this;t;){var r=t.getStyle("opacity",!1,!0);r.hasValue(!0)&&(e*=r.getNumber()),t=t.parent}return e}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!t){var r=this.getStyle("fill"),n=this.getStyle("fill-opacity"),o=this.getStyle("stroke"),l=this.getStyle("stroke-opacity");if(r.isUrlDefinition()){var s=r.getFillStyleDefinition(this,n);s&&(e.fillStyle=s)}else if(r.hasValue()){r.getString()==="currentColor"&&r.setValue(this.getStyle("color").getColor());var g=r.getColor();g!=="inherit"&&(e.fillStyle=g==="none"?"rgba(0,0,0,0)":g)}if(n.hasValue()){var v=new Sr(this.document,"fill",e.fillStyle).addOpacity(n).getColor();e.fillStyle=v}if(o.isUrlDefinition()){var T=o.getFillStyleDefinition(this,l);T&&(e.strokeStyle=T)}else if(o.hasValue()){o.getString()==="currentColor"&&o.setValue(this.getStyle("color").getColor());var F=o.getString();F!=="inherit"&&(e.strokeStyle=F==="none"?"rgba(0,0,0,0)":F)}if(l.hasValue()){var R=new Sr(this.document,"stroke",e.strokeStyle).addOpacity(l).getString();e.strokeStyle=R}var U=this.getStyle("stroke-width");if(U.hasValue()){var J=U.getPixels();e.lineWidth=J||Zf}var te=this.getStyle("stroke-linecap"),Ae=this.getStyle("stroke-linejoin"),he=this.getStyle("stroke-miterlimit"),pe=this.getStyle("stroke-dasharray"),be=this.getStyle("stroke-dashoffset");if(te.hasValue()&&(e.lineCap=te.getString()),Ae.hasValue()&&(e.lineJoin=Ae.getString()),he.hasValue()&&(e.miterLimit=he.getNumber()),pe.hasValue()&&pe.getString()!=="none"){var Te=Oc(pe.getString());typeof e.setLineDash<"u"?e.setLineDash(Te):typeof e.webkitLineDash<"u"?e.webkitLineDash=Te:typeof e.mozDash<"u"&&!(Te.length===1&&Te[0]===0)&&(e.mozDash=Te);var qe=be.getPixels();typeof e.lineDashOffset<"u"?e.lineDashOffset=qe:typeof e.webkitLineDashOffset<"u"?e.webkitLineDashOffset=qe:typeof e.mozDashOffset<"u"&&(e.mozDashOffset=qe)}}if(this.modifiedEmSizeStack=!1,typeof e.font<"u"){var je=this.getStyle("font"),We=this.getStyle("font-style"),Ne=this.getStyle("font-variant"),at=this.getStyle("font-weight"),nt=this.getStyle("font-size"),ke=this.getStyle("font-family"),De=new Ul(We.getString(),Ne.getString(),at.getString(),nt.hasValue()?"".concat(nt.getPixels(!0),"px"):"",ke.getString(),Ul.parse(je.getString(),e.font));We.setValue(De.fontStyle),Ne.setValue(De.fontVariant),at.setValue(De.fontWeight),nt.setValue(De.fontSize),ke.setValue(De.fontFamily),e.font=De.toString(),nt.isPixels()&&(this.document.emSize=nt.getPixels(),this.modifiedEmSizeStack=!0)}t||(this.applyEffects(e),e.globalAlpha=this.calculateOpacity())}clearContext(e){super.clearContext(e),this.modifiedEmSizeStack&&this.document.popEmSize()}}class cs extends Rd{constructor(e,t,r){super(e,t,r),this.type="path",this.pathParser=null,this.pathParser=new Yr(this.getAttribute("d").getString())}path(e){var{pathParser:t}=this,r=new ku;for(t.reset(),e&&e.beginPath();!t.isEnd();)switch(t.next().type){case Yr.MOVE_TO:this.pathM(e,r);break;case Yr.LINE_TO:this.pathL(e,r);break;case Yr.HORIZ_LINE_TO:this.pathH(e,r);break;case Yr.VERT_LINE_TO:this.pathV(e,r);break;case Yr.CURVE_TO:this.pathC(e,r);break;case Yr.SMOOTH_CURVE_TO:this.pathS(e,r);break;case Yr.QUAD_TO:this.pathQ(e,r);break;case Yr.SMOOTH_QUAD_TO:this.pathT(e,r);break;case Yr.ARC:this.pathA(e,r);break;case Yr.CLOSE_PATH:this.pathZ(e,r);break}return r}getBoundingBox(e){return this.path()}getMarkers(){var{pathParser:e}=this,t=e.getMarkerPoints(),r=e.getMarkerAngles(),n=t.map((o,l)=>[o,r[l]]);return n}renderChildren(e){this.path(e),this.document.screen.mouse.checkPath(this,e);var t=this.getStyle("fill-rule");e.fillStyle!==""&&(t.getString("inherit")!=="inherit"?e.fill(t.getString()):e.fill()),e.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(e.save(),e.setTransform(1,0,0,1,0,0),e.stroke(),e.restore()):e.stroke());var r=this.getMarkers();if(r){var n=r.length-1,o=this.getStyle("marker-start"),l=this.getStyle("marker-mid"),s=this.getStyle("marker-end");if(o.isUrlDefinition()){var g=o.getDefinition(),[v,T]=r[0];g.render(e,v,T)}if(l.isUrlDefinition())for(var F=l.getDefinition(),R=1;R<n;R++){var[U,J]=r[R];F.render(e,U,J)}if(s.isUrlDefinition()){var te=s.getDefinition(),[Ae,he]=r[n];te.render(e,Ae,he)}}}static pathM(e){var t=e.getAsCurrentPoint();return e.start=e.current,{point:t}}pathM(e,t){var{pathParser:r}=this,{point:n}=cs.pathM(r),{x:o,y:l}=n;r.addMarker(n),t.addPoint(o,l),e&&e.moveTo(o,l)}static pathL(e){var{current:t}=e,r=e.getAsCurrentPoint();return{current:t,point:r}}pathL(e,t){var{pathParser:r}=this,{current:n,point:o}=cs.pathL(r),{x:l,y:s}=o;r.addMarker(o,n),t.addPoint(l,s),e&&e.lineTo(l,s)}static pathH(e){var{current:t,command:r}=e,n=new So((r.relative?t.x:0)+r.x,t.y);return e.current=n,{current:t,point:n}}pathH(e,t){var{pathParser:r}=this,{current:n,point:o}=cs.pathH(r),{x:l,y:s}=o;r.addMarker(o,n),t.addPoint(l,s),e&&e.lineTo(l,s)}static pathV(e){var{current:t,command:r}=e,n=new So(t.x,(r.relative?t.y:0)+r.y);return e.current=n,{current:t,point:n}}pathV(e,t){var{pathParser:r}=this,{current:n,point:o}=cs.pathV(r),{x:l,y:s}=o;r.addMarker(o,n),t.addPoint(l,s),e&&e.lineTo(l,s)}static pathC(e){var{current:t}=e,r=e.getPoint("x1","y1"),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:r,controlPoint:n,currentPoint:o}}pathC(e,t){var{pathParser:r}=this,{current:n,point:o,controlPoint:l,currentPoint:s}=cs.pathC(r);r.addMarker(s,l,o),t.addBezierCurve(n.x,n.y,o.x,o.y,l.x,l.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,l.x,l.y,s.x,s.y)}static pathS(e){var{current:t}=e,r=e.getReflectedControlPoint(),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:r,controlPoint:n,currentPoint:o}}pathS(e,t){var{pathParser:r}=this,{current:n,point:o,controlPoint:l,currentPoint:s}=cs.pathS(r);r.addMarker(s,l,o),t.addBezierCurve(n.x,n.y,o.x,o.y,l.x,l.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,l.x,l.y,s.x,s.y)}static pathQ(e){var{current:t}=e,r=e.getAsControlPoint("x1","y1"),n=e.getAsCurrentPoint();return{current:t,controlPoint:r,currentPoint:n}}pathQ(e,t){var{pathParser:r}=this,{current:n,controlPoint:o,currentPoint:l}=cs.pathQ(r);r.addMarker(l,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,l.x,l.y),e&&e.quadraticCurveTo(o.x,o.y,l.x,l.y)}static pathT(e){var{current:t}=e,r=e.getReflectedControlPoint();e.control=r;var n=e.getAsCurrentPoint();return{current:t,controlPoint:r,currentPoint:n}}pathT(e,t){var{pathParser:r}=this,{current:n,controlPoint:o,currentPoint:l}=cs.pathT(r);r.addMarker(l,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,l.x,l.y),e&&e.quadraticCurveTo(o.x,o.y,l.x,l.y)}static pathA(e){var{current:t,command:r}=e,{rX:n,rY:o,xRot:l,lArcFlag:s,sweepFlag:g}=r,v=l*(Math.PI/180),T=e.getAsCurrentPoint(),F=new So(Math.cos(v)*(t.x-T.x)/2+Math.sin(v)*(t.y-T.y)/2,-Math.sin(v)*(t.x-T.x)/2+Math.cos(v)*(t.y-T.y)/2),R=Math.pow(F.x,2)/Math.pow(n,2)+Math.pow(F.y,2)/Math.pow(o,2);R>1&&(n*=Math.sqrt(R),o*=Math.sqrt(R));var U=(s===g?-1:1)*Math.sqrt((Math.pow(n,2)*Math.pow(o,2)-Math.pow(n,2)*Math.pow(F.y,2)-Math.pow(o,2)*Math.pow(F.x,2))/(Math.pow(n,2)*Math.pow(F.y,2)+Math.pow(o,2)*Math.pow(F.x,2)));isNaN(U)&&(U=0);var J=new So(U*n*F.y/o,U*-o*F.x/n),te=new So((t.x+T.x)/2+Math.cos(v)*J.x-Math.sin(v)*J.y,(t.y+T.y)/2+Math.sin(v)*J.x+Math.cos(v)*J.y),Ae=XT([1,0],[(F.x-J.x)/n,(F.y-J.y)/o]),he=[(F.x-J.x)/n,(F.y-J.y)/o],pe=[(-F.x-J.x)/n,(-F.y-J.y)/o],be=XT(he,pe);return Yb(he,pe)<=-1&&(be=Math.PI),Yb(he,pe)>=1&&(be=0),{currentPoint:T,rX:n,rY:o,sweepFlag:g,xAxisRotation:v,centp:te,a1:Ae,ad:be}}pathA(e,t){var{pathParser:r}=this,{currentPoint:n,rX:o,rY:l,sweepFlag:s,xAxisRotation:g,centp:v,a1:T,ad:F}=cs.pathA(r),R=1-s?1:-1,U=T+R*(F/2),J=new So(v.x+o*Math.cos(U),v.y+l*Math.sin(U));if(r.addMarkerAngle(J,U-R*Math.PI/2),r.addMarkerAngle(n,U-R*Math.PI),t.addPoint(n.x,n.y),e&&!isNaN(T)&&!isNaN(F)){var te=o>l?o:l,Ae=o>l?1:o/l,he=o>l?l/o:1;e.translate(v.x,v.y),e.rotate(g),e.scale(Ae,he),e.arc(0,0,te,T,T+F,!!(1-s)),e.scale(1/Ae,1/he),e.rotate(-g),e.translate(-v.x,-v.y)}}static pathZ(e){e.current=e.start}pathZ(e,t){cs.pathZ(this.pathParser),e&&t.x1!==t.x2&&t.y1!==t.y2&&e.closePath()}}class aI extends cs{constructor(e,t,r){super(e,t,r),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class VA extends Rd{constructor(e,t,r){super(e,t,new.target===VA?!0:r),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(e,t);var r=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();r&&(e.textBaseline=r)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(e){if(this.type!=="text")return this.getTElementBoundingBox(e);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e);var t=null;return this.children.forEach((r,n)=>{var o=this.getChildBoundingBox(e,this,this,n);t?t.addBoundingBox(o):t=o}),t}getFontSize(){var{document:e,parent:t}=this,r=Ul.parse(e.ctx.font).fontSize,n=t.getStyle("font-size").getNumber(r);return n}getTElementBoundingBox(e){var t=this.getFontSize();return new ku(this.x,this.y-t,this.x+this.measureText(e),this.y)}getGlyph(e,t,r){var n=t[r],o=null;if(e.isArabic){var l=t.length,s=t[r-1],g=t[r+1],v="isolated";if((r===0||s===" ")&&r<l-1&&g!==" "&&(v="terminal"),r>0&&s!==" "&&r<l-1&&g!==" "&&(v="medial"),r>0&&s!==" "&&(r===l-1||g===" ")&&(v="initial"),typeof e.glyphs[n]<"u"){var T=e.glyphs[n];o=T instanceof aI?T:T[v]}}else o=e.glyphs[n];return o||(o=e.missingGlyph),o}getText(){return""}getTextFromNode(e){var t=e||this.node,r=Array.from(t.parentNode.childNodes),n=r.indexOf(t),o=r.length-1,l=Kf(t.textContent||"");return n===0&&(l=bN(l)),n===o&&(l=xN(l)),l}renderChildren(e){if(this.type!=="text"){this.renderTElementChildren(e);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e),this.children.forEach((r,n)=>{this.renderChild(e,this,this,n)});var{mouse:t}=this.document.screen;t.isWorking()&&t.checkBoundingBox(this,this.getBoundingBox(e))}renderTElementChildren(e){var{document:t,parent:r}=this,n=this.getText(),o=r.getStyle("font-family").getDefinition();if(o){for(var{unitsPerEm:l}=o.fontFace,s=Ul.parse(t.ctx.font),g=r.getStyle("font-size").getNumber(s.fontSize),v=r.getStyle("font-style").getString(s.fontStyle),T=g/l,F=o.isRTL?n.split("").reverse().join(""):n,R=Oc(r.getAttribute("dx").getString()),U=F.length,J=0;J<U;J++){var te=this.getGlyph(o,F,J);e.translate(this.x,this.y),e.scale(T,-T);var Ae=e.lineWidth;e.lineWidth=e.lineWidth*l/g,v==="italic"&&e.transform(1,0,.4,1,0,0),te.render(e),v==="italic"&&e.transform(1,0,-.4,1,0,0),e.lineWidth=Ae,e.scale(1/T,-1/T),e.translate(-this.x,-this.y),this.x+=g*(te.horizAdvX||o.horizAdvX)/l,typeof R[J]<"u"&&!isNaN(R[J])&&(this.x+=R[J])}return}var{x:he,y:pe}=this;e.fillStyle&&e.fillText(n,he,pe),e.strokeStyle&&e.strokeText(n,he,pe)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var e=this.leafTexts[this.textChunkStart],t=e.getStyle("text-anchor").getString("start"),r=!1,n=0;t==="start"&&!r||t==="end"&&r?n=e.x-this.minX:t==="end"&&!r||t==="start"&&r?n=e.x-this.maxX:n=e.x-(this.minX+this.maxX)/2;for(var o=this.textChunkStart;o<this.leafTexts.length;o++)this.leafTexts[o].x+=n;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(e){this.children.forEach((t,r)=>{this.adjustChildCoordinatesRecursiveCore(e,this,this,r)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(e,t,r,n){var o=r.children[n];o.children.length>0?o.children.forEach((l,s)=>{t.adjustChildCoordinatesRecursiveCore(e,t,o,s)}):this.adjustChildCoordinates(e,t,r,n)}adjustChildCoordinates(e,t,r,n){var o=r.children[n];if(typeof o.measureText!="function")return o;e.save(),o.setContext(e,!0);var l=o.getAttribute("x"),s=o.getAttribute("y"),g=o.getAttribute("dx"),v=o.getAttribute("dy"),T=o.getStyle("font-family").getDefinition(),F=!!T&&T.isRTL;n===0&&(l.hasValue()||l.setValue(o.getInheritedAttribute("x")),s.hasValue()||s.setValue(o.getInheritedAttribute("y")),g.hasValue()||g.setValue(o.getInheritedAttribute("dx")),v.hasValue()||v.setValue(o.getInheritedAttribute("dy")));var R=o.measureText(e);return F&&(t.x-=R),l.hasValue()?(t.applyAnchoring(),o.x=l.getPixels("x"),g.hasValue()&&(o.x+=g.getPixels("x"))):(g.hasValue()&&(t.x+=g.getPixels("x")),o.x=t.x),t.x=o.x,F||(t.x+=R),s.hasValue()?(o.y=s.getPixels("y"),v.hasValue()&&(o.y+=v.getPixels("y"))):(v.hasValue()&&(t.y+=v.getPixels("y")),o.y=t.y),t.y=o.y,t.leafTexts.push(o),t.minX=Math.min(t.minX,o.x,o.x+R),t.maxX=Math.max(t.maxX,o.x,o.x+R),o.clearContext(e),e.restore(),o}getChildBoundingBox(e,t,r,n){var o=r.children[n];if(typeof o.getBoundingBox!="function")return null;var l=o.getBoundingBox(e);return l?(o.children.forEach((s,g)=>{var v=t.getChildBoundingBox(e,t,o,g);l.addBoundingBox(v)}),l):null}renderChild(e,t,r,n){var o=r.children[n];o.render(e),o.children.forEach((l,s)=>{t.renderChild(e,t,o,s)})}measureText(e){var{measureCache:t}=this;if(~t)return t;var r=this.getText(),n=this.measureTargetText(e,r);return this.measureCache=n,n}measureTargetText(e,t){if(!t.length)return 0;var{parent:r}=this,n=r.getStyle("font-family").getDefinition();if(n){for(var o=this.getFontSize(),l=n.isRTL?t.split("").reverse().join(""):t,s=Oc(r.getAttribute("dx").getString()),g=l.length,v=0,T=0;T<g;T++){var F=this.getGlyph(n,l,T);v+=(F.horizAdvX||n.horizAdvX)*o/n.fontFace.unitsPerEm,typeof s[T]<"u"&&!isNaN(s[T])&&(v+=s[T])}return v}if(!e.measureText)return t.length*10;e.save(),this.setContext(e,!0);var{width:R}=e.measureText(t);return this.clearContext(e),e.restore(),R}getInheritedAttribute(e){for(var t=this;t instanceof VA&&t.isFirstChild();){var r=t.parent.getAttribute(e);if(r.hasValue(!0))return r.getValue("0");t=t.parent}return null}}class R0 extends VA{constructor(e,t,r){super(e,t,new.target===R0?!0:r),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class kve extends R0{constructor(){super(...arguments),this.type="textNode"}}class hm extends Rd{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(e){var t,{document:r}=this,{screen:n,window:o}=r,l=e.canvas;if(n.setDefaults(e),l.style&&typeof e.font<"u"&&o&&typeof o.getComputedStyle<"u"){e.font=o.getComputedStyle(l).getPropertyValue("font");var s=new Sr(r,"fontSize",Ul.parse(e.font).fontSize);s.hasValue()&&(r.rootEmSize=s.getPixels("y"),r.emSize=r.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:g,height:v}=n.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var T=this.getAttribute("refX"),F=this.getAttribute("refY"),R=this.getAttribute("viewBox"),U=R.hasValue()?Oc(R.getString()):null,J=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",te=0,Ae=0,he=0,pe=0;U&&(te=U[0],Ae=U[1]),this.root||(g=this.getStyle("width").getPixels("x"),v=this.getStyle("height").getPixels("y"),this.type==="marker"&&(he=te,pe=Ae,te=0,Ae=0)),n.viewPort.setCurrent(g,v),this.node&&(!this.parent||((t=this.node.parentNode)===null||t===void 0?void 0:t.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(e),e.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),U&&(g=U[2],v=U[3]),r.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:n.viewPort.width,desiredWidth:g,height:n.viewPort.height,desiredHeight:v,minX:te,minY:Ae,refX:T.getValue(),refY:F.getValue(),clip:J,clipX:he,clipY:pe}),U&&(n.viewPort.removeCurrent(),n.viewPort.setCurrent(g,v))}clearContext(e){super.clearContext(e),this.document.screen.viewPort.removeCurrent()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.getAttribute("width",!0),o=this.getAttribute("height",!0),l=this.getAttribute("viewBox"),s=this.getAttribute("style"),g=n.getNumber(0),v=o.getNumber(0);if(r)if(typeof r=="string")this.getAttribute("preserveAspectRatio",!0).setValue(r);else{var T=this.getAttribute("preserveAspectRatio");T.hasValue()&&T.setValue(T.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(n.setValue(e),o.setValue(t),l.hasValue()||l.setValue("0 0 ".concat(g||e," ").concat(v||t)),s.hasValue()){var F=this.getStyle("width"),R=this.getStyle("height");F.hasValue()&&F.setValue("".concat(e,"px")),R.hasValue()&&R.setValue("".concat(t,"px"))}}}class lI extends cs{constructor(){super(...arguments),this.type="rect"}path(e){var t=this.getAttribute("x").getPixels("x"),r=this.getAttribute("y").getPixels("y"),n=this.getStyle("width",!1,!0).getPixels("x"),o=this.getStyle("height",!1,!0).getPixels("y"),l=this.getAttribute("rx"),s=this.getAttribute("ry"),g=l.getPixels("x"),v=s.getPixels("y");if(l.hasValue()&&!s.hasValue()&&(v=g),s.hasValue()&&!l.hasValue()&&(g=v),g=Math.min(g,n/2),v=Math.min(v,o/2),e){var T=4*((Math.sqrt(2)-1)/3);e.beginPath(),o>0&&n>0&&(e.moveTo(t+g,r),e.lineTo(t+n-g,r),e.bezierCurveTo(t+n-g+T*g,r,t+n,r+v-T*v,t+n,r+v),e.lineTo(t+n,r+o-v),e.bezierCurveTo(t+n,r+o-v+T*v,t+n-g+T*g,r+o,t+n-g,r+o),e.lineTo(t+g,r+o),e.bezierCurveTo(t+g-T*g,r+o,t,r+o-v+T*v,t,r+o-v),e.lineTo(t,r+v),e.bezierCurveTo(t,r+v-T*v,t+g-T*g,r,t+g,r),e.closePath())}return new ku(t,r,t+n,r+o)}getMarkers(){return null}}class kN extends cs{constructor(){super(...arguments),this.type="circle"}path(e){var t=this.getAttribute("cx").getPixels("x"),r=this.getAttribute("cy").getPixels("y"),n=this.getAttribute("r").getPixels();return e&&n>0&&(e.beginPath(),e.arc(t,r,n,0,Math.PI*2,!1),e.closePath()),new ku(t-n,r-n,t+n,r+n)}getMarkers(){return null}}class ON extends cs{constructor(){super(...arguments),this.type="ellipse"}path(e){var t=4*((Math.sqrt(2)-1)/3),r=this.getAttribute("rx").getPixels("x"),n=this.getAttribute("ry").getPixels("y"),o=this.getAttribute("cx").getPixels("x"),l=this.getAttribute("cy").getPixels("y");return e&&r>0&&n>0&&(e.beginPath(),e.moveTo(o+r,l),e.bezierCurveTo(o+r,l+t*n,o+t*r,l+n,o,l+n),e.bezierCurveTo(o-t*r,l+n,o-r,l+t*n,o-r,l),e.bezierCurveTo(o-r,l-t*n,o-t*r,l-n,o,l-n),e.bezierCurveTo(o+t*r,l-n,o+r,l-t*n,o+r,l),e.closePath()),new ku(o-r,l-n,o+r,l+n)}getMarkers(){return null}}class UN extends cs{constructor(){super(...arguments),this.type="line"}getPoints(){return[new So(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new So(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(e){var[{x:t,y:r},{x:n,y:o}]=this.getPoints();return e&&(e.beginPath(),e.moveTo(t,r),e.lineTo(n,o)),new ku(t,r,n,o)}getMarkers(){var[e,t]=this.getPoints(),r=e.angleTo(t);return[[e,r],[t,r]]}}class cI extends cs{constructor(e,t,r){super(e,t,r),this.type="polyline",this.points=[],this.points=So.parsePath(this.getAttribute("points").getString())}path(e){var{points:t}=this,[{x:r,y:n}]=t,o=new ku(r,n);return e&&(e.beginPath(),e.moveTo(r,n)),t.forEach(l=>{var{x:s,y:g}=l;o.addPoint(s,g),e&&e.lineTo(s,g)}),o}getMarkers(){var{points:e}=this,t=e.length-1,r=[];return e.forEach((n,o)=>{o!==t&&r.push([n,n.angleTo(e[o+1])])}),r.length>0&&r.push([e[e.length-1],r[r.length-1][1]]),r}}class NN extends cI{constructor(){super(...arguments),this.type="polygon"}path(e){var t=super.path(e),[{x:r,y:n}]=this.points;return e&&(e.lineTo(r,n),e.closePath()),t}}class zN extends Hs{constructor(){super(...arguments),this.type="pattern"}createPattern(e,t,r){var n=this.getStyle("width").getPixels("x",!0),o=this.getStyle("height").getPixels("y",!0),l=new hm(this.document,null);l.attributes.viewBox=new Sr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),l.attributes.width=new Sr(this.document,"width","".concat(n,"px")),l.attributes.height=new Sr(this.document,"height","".concat(o,"px")),l.attributes.transform=new Sr(this.document,"transform",this.getAttribute("patternTransform").getValue()),l.children=this.children;var s=this.document.createCanvas(n,o),g=s.getContext("2d"),v=this.getAttribute("x"),T=this.getAttribute("y");v.hasValue()&&T.hasValue()&&g.translate(v.getPixels("x",!0),T.getPixels("y",!0)),r.hasValue()?this.styles["fill-opacity"]=r:Reflect.deleteProperty(this.styles,"fill-opacity");for(var F=-1;F<=1;F++)for(var R=-1;R<=1;R++)g.save(),l.attributes.x=new Sr(this.document,"x",F*s.width),l.attributes.y=new Sr(this.document,"y",R*s.height),l.render(g),g.restore();var U=e.createPattern(s,"repeat");return U}}class QN extends Hs{constructor(){super(...arguments),this.type="marker"}render(e,t,r){if(t){var{x:n,y:o}=t,l=this.getAttribute("orient").getString("auto"),s=this.getAttribute("markerUnits").getString("strokeWidth");e.translate(n,o),l==="auto"&&e.rotate(r),s==="strokeWidth"&&e.scale(e.lineWidth,e.lineWidth),e.save();var g=new hm(this.document,null);g.type=this.type,g.attributes.viewBox=new Sr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),g.attributes.refX=new Sr(this.document,"refX",this.getAttribute("refX").getValue()),g.attributes.refY=new Sr(this.document,"refY",this.getAttribute("refY").getValue()),g.attributes.width=new Sr(this.document,"width",this.getAttribute("markerWidth").getValue()),g.attributes.height=new Sr(this.document,"height",this.getAttribute("markerHeight").getValue()),g.attributes.overflow=new Sr(this.document,"overflow",this.getAttribute("overflow").getValue()),g.attributes.fill=new Sr(this.document,"fill",this.getAttribute("fill").getColor("black")),g.attributes.stroke=new Sr(this.document,"stroke",this.getAttribute("stroke").getValue("none")),g.children=this.children,g.render(e),e.restore(),s==="strokeWidth"&&e.scale(1/e.lineWidth,1/e.lineWidth),l==="auto"&&e.rotate(-r),e.translate(-n,-o)}}}class VN extends Hs{constructor(){super(...arguments),this.type="defs"}render(){}}class tx extends Rd{constructor(){super(...arguments),this.type="g"}getBoundingBox(e){var t=new ku;return this.children.forEach(r=>{t.addBoundingBox(r.getBoundingBox(e))}),t}}class uI extends Hs{constructor(e,t,r){super(e,t,r),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:n,children:o}=this;o.forEach(l=>{l.type==="stop"&&n.push(l)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(e,t,r){var n=this;this.getHrefAttribute().hasValue()&&(n=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(n));var{stops:o}=n,l=this.getGradient(e,t);if(!l)return this.addParentOpacity(r,o[o.length-1].color);if(o.forEach(Ae=>{l.addColorStop(Ae.offset,this.addParentOpacity(r,Ae.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:s}=this,{MAX_VIRTUAL_PIXELS:g,viewPort:v}=s.screen,[T]=v.viewPorts,F=new lI(s,null);F.attributes.x=new Sr(s,"x",-g/3),F.attributes.y=new Sr(s,"y",-g/3),F.attributes.width=new Sr(s,"width",g),F.attributes.height=new Sr(s,"height",g);var R=new tx(s,null);R.attributes.transform=new Sr(s,"transform",this.getAttribute("gradientTransform").getValue()),R.children=[F];var U=new hm(s,null);U.attributes.x=new Sr(s,"x",0),U.attributes.y=new Sr(s,"y",0),U.attributes.width=new Sr(s,"width",T.width),U.attributes.height=new Sr(s,"height",T.height),U.children=[R];var J=s.createCanvas(T.width,T.height),te=J.getContext("2d");return te.fillStyle=l,U.render(te),te.createPattern(J,"no-repeat")}return l}inheritStopContainer(e){this.attributesToInherit.forEach(t=>{!this.getAttribute(t).hasValue()&&e.getAttribute(t).hasValue()&&this.getAttribute(t,!0).setValue(e.getAttribute(t).getValue())})}addParentOpacity(e,t){if(e.hasValue()){var r=new Sr(this.document,"color",t);return r.addOpacity(e).getColor()}return t}}class HN extends uI{constructor(e,t,r){super(e,t,r),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(e,t){var r=this.getGradientUnits()==="objectBoundingBox",n=r?t.getBoundingBox(e):null;if(r&&!n)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var o=r?n.x+n.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),l=r?n.y+n.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),s=r?n.x+n.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),g=r?n.y+n.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return o===s&&l===g?null:e.createLinearGradient(o,l,s,g)}}class GN extends uI{constructor(e,t,r){super(e,t,r),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(e,t){var r=this.getGradientUnits()==="objectBoundingBox",n=t.getBoundingBox(e);if(r&&!n)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var o=r?n.x+n.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),l=r?n.y+n.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),s=o,g=l;this.getAttribute("fx").hasValue()&&(s=r?n.x+n.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(g=r?n.y+n.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var v=r?(n.width+n.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),T=this.getAttribute("fr").getPixels();return e.createRadialGradient(s,g,T,o,l,v)}}class jN extends Hs{constructor(e,t,r){super(e,t,r),this.type="stop";var n=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),o=this.getStyle("stop-opacity"),l=this.getStyle("stop-color",!0);l.getString()===""&&l.setValue("#000"),o.hasValue()&&(l=l.addOpacity(o)),this.offset=n,this.color=l.getColor()}}class ix extends Hs{constructor(e,t,r){super(e,t,r),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,e.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new Sr(e,"values",null);var n=this.getAttribute("values");n.hasValue()&&this.values.setValue(n.getString().split(";"))}getProperty(){var e=this.getAttribute("attributeType").getString(),t=this.getAttribute("attributeName").getString();return e==="CSS"?this.parent.getStyle(t,!0):this.parent.getAttribute(t,!0)}calcValue(){var{initialUnits:e}=this,{progress:t,from:r,to:n}=this.getProgress(),o=r.getNumber()+(n.getNumber()-r.getNumber())*t;return e==="%"&&(o*=100),"".concat(o).concat(e)}update(e){var{parent:t}=this,r=this.getProperty();if(this.initialValue||(this.initialValue=r.getString(),this.initialUnits=r.getUnits()),this.duration>this.maxDuration){var n=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(n==="freeze"&&!this.frozen)this.frozen=!0,t.animationFrozen=!0,t.animationFrozenValue=r.getString();else if(n==="remove"&&!this.removed)return this.removed=!0,r.setValue(t.animationFrozen?t.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=e;var o=!1;if(this.begin<this.duration){var l=this.calcValue(),s=this.getAttribute("type");if(s.hasValue()){var g=s.getString();l="".concat(g,"(").concat(l,")")}r.setValue(l),o=!0}return o}getProgress(){var{document:e,values:t}=this,r={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(t.hasValue()){var n=r.progress*(t.getValue().length-1),o=Math.floor(n),l=Math.ceil(n);r.from=new Sr(e,"from",parseFloat(t.getValue()[o])),r.to=new Sr(e,"to",parseFloat(t.getValue()[l])),r.progress=(n-o)/(l-o)}else r.from=this.from,r.to=this.to;return r}}class qN extends ix{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:e,from:t,to:r}=this.getProgress(),n=new GT(t.getColor()),o=new GT(r.getColor());if(n.ok&&o.ok){var l=n.r+(o.r-n.r)*e,s=n.g+(o.g-n.g)*e,g=n.b+(o.b-n.b)*e;return"rgb(".concat(Math.floor(l),", ").concat(Math.floor(s),", ").concat(Math.floor(g),")")}return this.getAttribute("from").getColor()}}class $N extends ix{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:e,from:t,to:r}=this.getProgress(),n=Oc(t.getString()),o=Oc(r.getString()),l=n.map((s,g)=>{var v=o[g];return s+(v-s)*e}).join(" ");return l}}class KN extends Hs{constructor(e,t,r){super(e,t,r),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:n}=e,{children:o}=this;for(var l of o)switch(l.type){case"font-face":{this.fontFace=l;var s=l.getStyle("font-family");s.hasValue()&&(n[s.getString()]=this);break}case"missing-glyph":this.missingGlyph=l;break;case"glyph":{var g=l;g.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[g.unicode]>"u"&&(this.glyphs[g.unicode]={}),this.glyphs[g.unicode][g.arabicForm]=g):this.glyphs[g.unicode]=g;break}}}render(){}}class WN extends Hs{constructor(e,t,r){super(e,t,r),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class ZN extends cs{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class XN extends VA{constructor(){super(...arguments),this.type="tref"}getText(){var e=this.getHrefAttribute().getDefinition();if(e){var t=e.children[0];if(t)return t.getText()}return""}}class JN extends VA{constructor(e,t,r){super(e,t,r),this.type="a";var{childNodes:n}=t,o=n[0],l=n.length>0&&Array.from(n).every(s=>s.nodeType===3);this.hasText=l,this.text=l?this.getTextFromNode(o):""}getText(){return this.text}renderChildren(e){if(this.hasText){super.renderChildren(e);var{document:t,x:r,y:n}=this,{mouse:o}=t.screen,l=new Sr(t,"fontSize",Ul.parse(t.ctx.font).fontSize);o.isWorking()&&o.checkBoundingBox(this,new ku(r,n-l.getPixels("y"),r+this.measureText(e),n))}else if(this.children.length>0){var s=new tx(this.document,null);s.children=this.children,s.parent=this,s.render(e)}}onClick(){var{window:e}=this.document;e&&e.open(this.getHrefAttribute().getString())}onMouseMove(){var e=this.document.ctx;e.canvas.style.cursor="pointer"}}function YN(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function rx(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?YN(Object(t),!0).forEach(function(r){OT(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):YN(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class e8 extends VA{constructor(e,t,r){super(e,t,r),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var n=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(n)}getText(){return this.text}path(e){var{dataArray:t}=this;e&&e.beginPath(),t.forEach(r=>{var{type:n,points:o}=r;switch(n){case Yr.LINE_TO:e&&e.lineTo(o[0],o[1]);break;case Yr.MOVE_TO:e&&e.moveTo(o[0],o[1]);break;case Yr.CURVE_TO:e&&e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case Yr.QUAD_TO:e&&e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case Yr.ARC:{var[l,s,g,v,T,F,R,U]=o,J=g>v?g:v,te=g>v?1:g/v,Ae=g>v?v/g:1;e&&(e.translate(l,s),e.rotate(R),e.scale(te,Ae),e.arc(0,0,J,T,T+F,!!(1-U)),e.scale(1/te,1/Ae),e.rotate(-R),e.translate(-l,-s));break}case Yr.CLOSE_PATH:e&&e.closePath();break}})}renderChildren(e){this.setTextData(e),e.save();var t=this.parent.getStyle("text-decoration").getString(),r=this.getFontSize(),{glyphInfo:n}=this,o=e.fillStyle;t==="underline"&&e.beginPath(),n.forEach((l,s)=>{var{p0:g,p1:v,rotation:T,text:F}=l;e.save(),e.translate(g.x,g.y),e.rotate(T),e.fillStyle&&e.fillText(F,0,0),e.strokeStyle&&e.strokeText(F,0,0),e.restore(),t==="underline"&&(s===0&&e.moveTo(g.x,g.y+r/8),e.lineTo(v.x,v.y+r/5))}),t==="underline"&&(e.lineWidth=r/20,e.strokeStyle=o,e.stroke(),e.closePath()),e.restore()}getLetterSpacingAt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[e]||0}findSegmentToFitChar(e,t,r,n,o,l,s,g,v){var T=l,F=this.measureText(e,g);g===" "&&t==="justify"&&r<n&&(F+=(n-r)/o),v>-1&&(T+=this.getLetterSpacingAt(v));var R=this.textHeight/20,U=this.getEquidistantPointOnPath(T,R,0),J=this.getEquidistantPointOnPath(T+F,R,0),te={p0:U,p1:J},Ae=U&&J?Math.atan2(J.y-U.y,J.x-U.x):0;if(s){var he=Math.cos(Math.PI/2+Ae)*s,pe=Math.cos(-Ae)*s;te.p0=rx(rx({},U),{},{x:U.x+he,y:U.y+pe}),te.p1=rx(rx({},J),{},{x:J.x+he,y:J.y+pe})}return T+=F,{offset:T,segment:te,rotation:Ae}}measureText(e,t){var{measuresCache:r}=this,n=t||this.getText();if(r.has(n))return r.get(n);var o=this.measureTargetText(e,n);return r.set(n,o),o}setTextData(e){if(!this.glyphInfo){var t=this.getText(),r=t.split(""),n=t.split(" ").length-1,o=this.parent.getAttribute("dx").split().map(Te=>Te.getPixels("x")),l=this.parent.getAttribute("dy").getPixels("y"),s=this.parent.getStyle("text-anchor").getString("start"),g=this.getStyle("letter-spacing"),v=this.parent.getStyle("letter-spacing"),T=0;!g.hasValue()||g.getValue()==="inherit"?T=v.getPixels():g.hasValue()&&g.getValue()!=="initial"&&g.getValue()!=="unset"&&(T=g.getPixels());var F=[],R=t.length;this.letterSpacingCache=F;for(var U=0;U<R;U++)F.push(typeof o[U]<"u"?o[U]:T);var J=F.reduce((Te,qe,je)=>je===0?0:Te+qe||0,0),te=this.measureText(e),Ae=Math.max(te+J,0);this.textWidth=te,this.textHeight=this.getFontSize(),this.glyphInfo=[];var he=this.getPathLength(),pe=this.getStyle("startOffset").getNumber(0)*he,be=0;(s==="middle"||s==="center")&&(be=-Ae/2),(s==="end"||s==="right")&&(be=-Ae),be+=pe,r.forEach((Te,qe)=>{var{offset:je,segment:We,rotation:Ne}=this.findSegmentToFitChar(e,s,Ae,he,n,be,l,Te,qe);be=je,!(!We.p0||!We.p1)&&this.glyphInfo.push({text:r[qe],p0:We.p0,p1:We.p1,rotation:Ne})})}}parsePathData(e){if(this.pathLength=-1,!e)return[];var t=[],{pathParser:r}=e;for(r.reset();!r.isEnd();){var{current:n}=r,o=n?n.x:0,l=n?n.y:0,s=r.next(),g=s.type,v=[];switch(s.type){case Yr.MOVE_TO:this.pathM(r,v);break;case Yr.LINE_TO:g=this.pathL(r,v);break;case Yr.HORIZ_LINE_TO:g=this.pathH(r,v);break;case Yr.VERT_LINE_TO:g=this.pathV(r,v);break;case Yr.CURVE_TO:this.pathC(r,v);break;case Yr.SMOOTH_CURVE_TO:g=this.pathS(r,v);break;case Yr.QUAD_TO:this.pathQ(r,v);break;case Yr.SMOOTH_QUAD_TO:g=this.pathT(r,v);break;case Yr.ARC:v=this.pathA(r);break;case Yr.CLOSE_PATH:cs.pathZ(r);break}s.type!==Yr.CLOSE_PATH?t.push({type:g,points:v,start:{x:o,y:l},pathLength:this.calcLength(o,l,g,v)}):t.push({type:Yr.CLOSE_PATH,points:[],pathLength:0})}return t}pathM(e,t){var{x:r,y:n}=cs.pathM(e).point;t.push(r,n)}pathL(e,t){var{x:r,y:n}=cs.pathL(e).point;return t.push(r,n),Yr.LINE_TO}pathH(e,t){var{x:r,y:n}=cs.pathH(e).point;return t.push(r,n),Yr.LINE_TO}pathV(e,t){var{x:r,y:n}=cs.pathV(e).point;return t.push(r,n),Yr.LINE_TO}pathC(e,t){var{point:r,controlPoint:n,currentPoint:o}=cs.pathC(e);t.push(r.x,r.y,n.x,n.y,o.x,o.y)}pathS(e,t){var{point:r,controlPoint:n,currentPoint:o}=cs.pathS(e);return t.push(r.x,r.y,n.x,n.y,o.x,o.y),Yr.CURVE_TO}pathQ(e,t){var{controlPoint:r,currentPoint:n}=cs.pathQ(e);t.push(r.x,r.y,n.x,n.y)}pathT(e,t){var{controlPoint:r,currentPoint:n}=cs.pathT(e);return t.push(r.x,r.y,n.x,n.y),Yr.QUAD_TO}pathA(e){var{rX:t,rY:r,sweepFlag:n,xAxisRotation:o,centp:l,a1:s,ad:g}=cs.pathA(e);return n===0&&g>0&&(g-=2*Math.PI),n===1&&g<0&&(g+=2*Math.PI),[l.x,l.y,t,r,s,g,o,n]}calcLength(e,t,r,n){var o=0,l=null,s=null,g=0;switch(r){case Yr.LINE_TO:return this.getLineLength(e,t,n[0],n[1]);case Yr.CURVE_TO:for(o=0,l=this.getPointOnCubicBezier(0,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),g=.01;g<=1;g+=.01)s=this.getPointOnCubicBezier(g,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;return o;case Yr.QUAD_TO:for(o=0,l=this.getPointOnQuadraticBezier(0,e,t,n[0],n[1],n[2],n[3]),g=.01;g<=1;g+=.01)s=this.getPointOnQuadraticBezier(g,e,t,n[0],n[1],n[2],n[3]),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;return o;case Yr.ARC:{o=0;var v=n[4],T=n[5],F=n[4]+T,R=Math.PI/180;if(Math.abs(v-F)<R&&(R=Math.abs(v-F)),l=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],v,0),T<0)for(g=v-R;g>F;g-=R)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],g,0),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;else for(g=v+R;g<F;g+=R)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],g,0),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;return s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],F,0),o+=this.getLineLength(l.x,l.y,s.x,s.y),o}}return 0}getPointOnLine(e,t,r,n,o){var l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:t,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:r,g=(o-r)/(n-t+Zf),v=Math.sqrt(e*e/(1+g*g));n<t&&(v*=-1);var T=g*v,F=null;if(n===t)F={x:l,y:s+T};else if((s-r)/(l-t+Zf)===g)F={x:l+v,y:s+T};else{var R=0,U=0,J=this.getLineLength(t,r,n,o);if(J<Zf)return null;var te=(l-t)*(n-t)+(s-r)*(o-r);te/=J*J,R=t+te*(n-t),U=r+te*(o-r);var Ae=this.getLineLength(l,s,R,U),he=Math.sqrt(e*e-Ae*Ae);v=Math.sqrt(he*he/(1+g*g)),n<t&&(v*=-1),T=g*v,F={x:R+v,y:U+T}}return F}getPointOnPath(e){var t=this.getPathLength(),r=0,n=null;if(e<-5e-5||e-5e-5>t)return null;var{dataArray:o}=this;for(var l of o){if(l&&(l.pathLength<5e-5||r+l.pathLength+5e-5<e)){r+=l.pathLength;continue}var s=e-r,g=0;switch(l.type){case Yr.LINE_TO:n=this.getPointOnLine(s,l.start.x,l.start.y,l.points[0],l.points[1],l.start.x,l.start.y);break;case Yr.ARC:{var v=l.points[4],T=l.points[5],F=l.points[4]+T;if(g=v+s/l.pathLength*T,T<0&&g<F||T>=0&&g>F)break;n=this.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],g,l.points[6]);break}case Yr.CURVE_TO:g=s/l.pathLength,g>1&&(g=1),n=this.getPointOnCubicBezier(g,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3],l.points[4],l.points[5]);break;case Yr.QUAD_TO:g=s/l.pathLength,g>1&&(g=1),n=this.getPointOnQuadraticBezier(g,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3]);break}if(n)return n;break}return null}getLineLength(e,t,r,n){return Math.sqrt((r-e)*(r-e)+(n-t)*(n-t))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((e,t)=>t.pathLength>0?e+t.pathLength:e,0)),this.pathLength}getPointOnCubicBezier(e,t,r,n,o,l,s,g,v){var T=g*JT(e)+l*YT(e)+n*eI(e)+t*tI(e),F=v*JT(e)+s*YT(e)+o*eI(e)+r*tI(e);return{x:T,y:F}}getPointOnQuadraticBezier(e,t,r,n,o,l,s){var g=l*iI(e)+n*rI(e)+t*nI(e),v=s*iI(e)+o*rI(e)+r*nI(e);return{x:g,y:v}}getPointOnEllipticalArc(e,t,r,n,o,l){var s=Math.cos(l),g=Math.sin(l),v={x:r*Math.cos(o),y:n*Math.sin(o)};return{x:e+(v.x*s-v.y*g),y:t+(v.x*g+v.y*s)}}buildEquidistantCache(e,t){var r=this.getPathLength(),n=t||.25,o=e||r/100;if(!this.equidistantCache||this.equidistantCache.step!==o||this.equidistantCache.precision!==n){this.equidistantCache={step:o,precision:n,points:[]};for(var l=0,s=0;s<=r;s+=n){var g=this.getPointOnPath(s),v=this.getPointOnPath(s+n);!g||!v||(l+=this.getLineLength(g.x,g.y,v.x,v.y),l>=o&&(this.equidistantCache.points.push({x:g.x,y:g.y,distance:s}),l-=o))}}}getEquidistantPointOnPath(e,t,r){if(this.buildEquidistantCache(t,r),e<0||e-this.getPathLength()>5e-5)return null;var n=Math.round(e/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[n]||null}}var Ove=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class t8 extends Rd{constructor(e,t,r){super(e,t,r),this.type="image",this.loaded=!1;var n=this.getHrefAttribute().getString();if(n){var o=n.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(n);e.images.push(this),o?this.loadSvg(n):this.loadImage(n),this.isSvg=o}}loadImage(e){var t=this;return NA(function*(){try{var r=yield t.document.createImage(e);t.image=r}catch(n){console.error('Error while loading image "'.concat(e,'":'),n)}t.loaded=!0})()}loadSvg(e){var t=this;return NA(function*(){var r=Ove.exec(e);if(r){var n=r[5];r[4]==="base64"?t.image=atob(n):t.image=decodeURIComponent(n)}else try{var o=yield t.document.fetch(e),l=yield o.text();t.image=l}catch(s){console.error('Error while loading image "'.concat(e,'":'),s)}t.loaded=!0})()}renderChildren(e){var{document:t,image:r,loaded:n}=this,o=this.getAttribute("x").getPixels("x"),l=this.getAttribute("y").getPixels("y"),s=this.getStyle("width").getPixels("x"),g=this.getStyle("height").getPixels("y");if(!(!n||!r||!s||!g)){if(e.save(),e.translate(o,l),this.isSvg){var v=t.canvg.forkString(e,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:s,scaleHeight:g});v.document.documentElement.parent=this,v.render()}else{var T=this.image;t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:s,desiredWidth:T.width,height:g,desiredHeight:T.height}),this.loaded&&(typeof T.complete>"u"||T.complete)&&e.drawImage(T,0,0)}e.restore()}}getBoundingBox(){var e=this.getAttribute("x").getPixels("x"),t=this.getAttribute("y").getPixels("y"),r=this.getStyle("width").getPixels("x"),n=this.getStyle("height").getPixels("y");return new ku(e,t,e+r,t+n)}}class i8 extends Rd{constructor(){super(...arguments),this.type="symbol"}render(e){}}class r8{constructor(e){this.document=e,this.loaded=!1,e.fonts.push(this)}load(e,t){var r=this;return NA(function*(){try{var{document:n}=r,o=yield n.canvg.parser.load(t),l=o.getElementsByTagName("font");Array.from(l).forEach(s=>{var g=n.createElement(s);n.definitions[e]=g})}catch(s){console.error('Error while loading font "'.concat(t,'":'),s)}r.loaded=!0})()}}class hI extends Hs{constructor(e,t,r){super(e,t,r),this.type="style";var n=Kf(Array.from(t.childNodes).map(l=>l.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),o=n.split("}");o.forEach(l=>{var s=l.trim();if(s){var g=s.split("{"),v=g[0].split(","),T=g[1].split(";");v.forEach(F=>{var R=F.trim();if(R){var U=e.styles[R]||{};if(T.forEach(Ae=>{var he=Ae.indexOf(":"),pe=Ae.substr(0,he).trim(),be=Ae.substr(he+1,Ae.length-he).trim();pe&&be&&(U[pe]=new Sr(e,pe,be))}),e.styles[R]=U,e.stylesSpecificity[R]=CN(R),R==="@font-face"){var J=U["font-family"].getString().replace(/"|'/g,""),te=U.src.getString().split(",");te.forEach(Ae=>{if(Ae.indexOf('format("svg")')>0){var he=WT(Ae);he&&new r8(e).load(J,he)}})}}})}})}}hI.parseExternalUrl=WT;class n8 extends Rd{constructor(){super(...arguments),this.type="use"}setContext(e){super.setContext(e);var t=this.getAttribute("x"),r=this.getAttribute("y");t.hasValue()&&e.translate(t.getPixels("x"),0),r.hasValue()&&e.translate(0,r.getPixels("y"))}path(e){var{element:t}=this;t&&t.path(e)}renderChildren(e){var{document:t,element:r}=this;if(r){var n=r;if(r.type==="symbol"&&(n=new hm(t,null),n.attributes.viewBox=new Sr(t,"viewBox",r.getAttribute("viewBox").getString()),n.attributes.preserveAspectRatio=new Sr(t,"preserveAspectRatio",r.getAttribute("preserveAspectRatio").getString()),n.attributes.overflow=new Sr(t,"overflow",r.getAttribute("overflow").getString()),n.children=r.children,r.styles.opacity=new Sr(t,"opacity",this.calculateOpacity())),n.type==="svg"){var o=this.getStyle("width",!1,!0),l=this.getStyle("height",!1,!0);o.hasValue()&&(n.attributes.width=new Sr(t,"width",o.getString())),l.hasValue()&&(n.attributes.height=new Sr(t,"height",l.getString()))}var s=n.parent;n.parent=this,n.render(e),n.parent=s}}getBoundingBox(e){var{element:t}=this;return t?t.getBoundingBox(e):null}elementTransform(){var{document:e,element:t}=this;return Dd.fromElement(e,t)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function nx(i,e,t,r,n,o){return i[t*r*4+e*4+o]}function sx(i,e,t,r,n,o,l){i[t*r*4+e*4+o]=l}function la(i,e,t){var r=i[e];return r*t}function HA(i,e,t,r){return e+Math.cos(i)*t+Math.sin(i)*r}class AI extends Hs{constructor(e,t,r){super(e,t,r),this.type="feColorMatrix";var n=Oc(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var o=n[0];n=[.213+.787*o,.715-.715*o,.072-.072*o,0,0,.213-.213*o,.715+.285*o,.072-.072*o,0,0,.213-.213*o,.715-.715*o,.072+.928*o,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var l=n[0]*Math.PI/180;n=[HA(l,.213,.787,-.213),HA(l,.715,-.715,-.715),HA(l,.072,-.072,.928),0,0,HA(l,.213,-.213,.143),HA(l,.715,.285,.14),HA(l,.072,-.072,-.283),0,0,HA(l,.213,-.213,-.787),HA(l,.715,-.715,.715),HA(l,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=n,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(e,t,r,n,o){for(var{includeOpacity:l,matrix:s}=this,g=e.getImageData(0,0,n,o),v=0;v<o;v++)for(var T=0;T<n;T++){var F=nx(g.data,T,v,n,o,0),R=nx(g.data,T,v,n,o,1),U=nx(g.data,T,v,n,o,2),J=nx(g.data,T,v,n,o,3),te=la(s,0,F)+la(s,1,R)+la(s,2,U)+la(s,3,J)+la(s,4,1),Ae=la(s,5,F)+la(s,6,R)+la(s,7,U)+la(s,8,J)+la(s,9,1),he=la(s,10,F)+la(s,11,R)+la(s,12,U)+la(s,13,J)+la(s,14,1),pe=la(s,15,F)+la(s,16,R)+la(s,17,U)+la(s,18,J)+la(s,19,1);l&&(te=0,Ae=0,he=0,pe*=J/255),sx(g.data,T,v,n,o,0,te),sx(g.data,T,v,n,o,1,Ae),sx(g.data,T,v,n,o,2,he),sx(g.data,T,v,n,o,3,pe)}e.clearRect(0,0,n,o),e.putImageData(g,0,0)}}class k0 extends Hs{constructor(){super(...arguments),this.type="mask"}apply(e,t){var{document:r}=this,n=this.getAttribute("x").getPixels("x"),o=this.getAttribute("y").getPixels("y"),l=this.getStyle("width").getPixels("x"),s=this.getStyle("height").getPixels("y");if(!l&&!s){var g=new ku;this.children.forEach(J=>{g.addBoundingBox(J.getBoundingBox(e))}),n=Math.floor(g.x1),o=Math.floor(g.y1),l=Math.floor(g.width),s=Math.floor(g.height)}var v=this.removeStyles(t,k0.ignoreStyles),T=r.createCanvas(n+l,o+s),F=T.getContext("2d");r.screen.setDefaults(F),this.renderChildren(F),new AI(r,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(F,0,0,n+l,o+s);var R=r.createCanvas(n+l,o+s),U=R.getContext("2d");r.screen.setDefaults(U),t.render(U),U.globalCompositeOperation="destination-in",U.fillStyle=F.createPattern(T,"no-repeat"),U.fillRect(0,0,n+l,o+s),e.fillStyle=U.createPattern(R,"no-repeat"),e.fillRect(0,0,n+l,o+s),this.restoreStyles(t,v)}render(e){}}k0.ignoreStyles=["mask","transform","clip-path"];var s8=()=>{};class o8 extends Hs{constructor(){super(...arguments),this.type="clipPath"}apply(e){var{document:t}=this,r=Reflect.getPrototypeOf(e),{beginPath:n,closePath:o}=e;r&&(r.beginPath=s8,r.closePath=s8),Reflect.apply(n,e,[]),this.children.forEach(l=>{if(!(typeof l.path>"u")){var s=typeof l.elementTransform<"u"?l.elementTransform():null;s||(s=Dd.fromElement(t,l)),s&&s.apply(e),l.path(e),r&&(r.closePath=o),s&&s.unapply(e)}}),Reflect.apply(o,e,[]),e.clip(),r&&(r.beginPath=n,r.closePath=o)}render(e){}}class O0 extends Hs{constructor(){super(...arguments),this.type="filter"}apply(e,t){var{document:r,children:n}=this,o=t.getBoundingBox(e);if(o){var l=0,s=0;n.forEach(he=>{var pe=he.extraFilterDistance||0;l=Math.max(l,pe),s=Math.max(s,pe)});var g=Math.floor(o.width),v=Math.floor(o.height),T=g+2*l,F=v+2*s;if(!(T<1||F<1)){var R=Math.floor(o.x),U=Math.floor(o.y),J=this.removeStyles(t,O0.ignoreStyles),te=r.createCanvas(T,F),Ae=te.getContext("2d");r.screen.setDefaults(Ae),Ae.translate(-R+l,-U+s),t.render(Ae),n.forEach(he=>{typeof he.apply=="function"&&he.apply(Ae,0,0,T,F)}),e.drawImage(te,0,0,T,F,R-l,U-s,T,F),this.restoreStyles(t,J)}}}render(e){}}O0.ignoreStyles=["filter","transform","clip-path"];class a8 extends Hs{constructor(e,t,r){super(e,t,r),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(e,t,r,n,o){}}class l8 extends Hs{constructor(){super(...arguments),this.type="feMorphology"}apply(e,t,r,n,o){}}class c8 extends Hs{constructor(){super(...arguments),this.type="feComposite"}apply(e,t,r,n,o){}}class u8 extends Hs{constructor(e,t,r){super(e,t,r),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(e,t,r,n,o){var{document:l,blurRadius:s}=this,g=l.window?l.window.document.body:null,v=e.canvas;v.id=l.getUniqueId(),g&&(v.style.display="none",g.appendChild(v)),pve(v,t,r,n,o,s),g&&g.removeChild(v)}}class h8 extends Hs{constructor(){super(...arguments),this.type="title"}}class A8 extends Hs{constructor(){super(...arguments),this.type="desc"}}var Uve={svg:hm,rect:lI,circle:kN,ellipse:ON,line:UN,polyline:cI,polygon:NN,path:cs,pattern:zN,marker:QN,defs:VN,linearGradient:HN,radialGradient:GN,stop:jN,animate:ix,animateColor:qN,animateTransform:$N,font:KN,"font-face":WN,"missing-glyph":ZN,glyph:aI,text:VA,tspan:R0,tref:XN,a:JN,textPath:e8,image:t8,g:tx,symbol:i8,style:hI,use:n8,mask:k0,clipPath:o8,filter:O0,feDropShadow:a8,feMorphology:l8,feComposite:c8,feColorMatrix:AI,feGaussianBlur:u8,title:h8,desc:A8};function d8(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Nve(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?d8(Object(t),!0).forEach(function(r){OT(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):d8(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function zve(i,e){var t=document.createElement("canvas");return t.width=i,t.height=e,t}function Qve(i){return dI.apply(this,arguments)}function dI(){return dI=NA(function*(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=document.createElement("img");return e&&(t.crossOrigin="Anonymous"),new Promise((r,n)=>{t.onload=()=>{r(t)},t.onerror=(o,l,s,g,v)=>{n(v)},t.src=i})}),dI.apply(this,arguments)}class GA{constructor(e){var{rootEmSize:t=12,emSize:r=12,createCanvas:n=GA.createCanvas,createImage:o=GA.createImage,anonymousCrossOrigin:l}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=e,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=e.screen,this.rootEmSize=t,this.emSize=r,this.createCanvas=n,this.createImage=this.bindCreateImage(o,l),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(e,t){return typeof t=="boolean"?(r,n)=>e(r,typeof n=="boolean"?n:t):e}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:e}=this;return e[e.length-1]}set emSize(e){var{emSizeStack:t}=this;t.push(e)}popEmSize(){var{emSizeStack:e}=this;e.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(e=>e.loaded)}isFontsLoaded(){return this.fonts.every(e=>e.loaded)}createDocumentElement(e){var t=this.createElement(e.documentElement);return t.root=!0,t.addStylesFromStyleDefinition(),this.documentElement=t,t}createElement(e){var t=e.nodeName.replace(/^[^:]+:/,""),r=GA.elementTypes[t];return typeof r<"u"?new r(this,e):new RN(this,e)}createTextNode(e){return new kve(this,e)}setViewBox(e){this.screen.setViewBox(Nve({document:this},e))}}GA.createCanvas=zve,GA.createImage=Qve,GA.elementTypes=Uve;function f8(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Xf(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?f8(Object(t),!0).forEach(function(r){OT(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):f8(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class Jf{constructor(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new ex(r),this.screen=new D0(e,r),this.options=r;var n=new GA(this,r),o=n.createDocumentElement(t);this.document=n,this.documentElement=o}static from(e,t){var r=arguments;return NA(function*(){var n=r.length>2&&r[2]!==void 0?r[2]:{},o=new ex(n),l=yield o.parse(t);return new Jf(e,l,n)})()}static fromString(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=new ex(r),o=n.parseFromString(t);return new Jf(e,o,r)}fork(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Jf.from(e,t,Xf(Xf({},this.options),r))}forkString(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Jf.fromString(e,t,Xf(Xf({},this.options),r))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var e=arguments,t=this;return NA(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};t.start(Xf({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},r)),yield t.ready(),t.stop()})()}start(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:t,screen:r,options:n}=this;r.start(t,Xf(Xf({enableRedraw:!0},n),e))}stop(){this.screen.stop()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(e,t,r)}}const Vve=Object.freeze(Object.defineProperty({__proto__:null,AElement:JN,AnimateColorElement:qN,AnimateElement:ix,AnimateTransformElement:$N,BoundingBox:ku,CB1:JT,CB2:YT,CB3:eI,CB4:tI,Canvg:Jf,CircleElement:kN,ClipPathElement:o8,DefsElement:VN,DescElement:A8,Document:GA,Element:Hs,EllipseElement:ON,FeColorMatrixElement:AI,FeCompositeElement:c8,FeDropShadowElement:a8,FeGaussianBlurElement:u8,FeMorphologyElement:l8,FilterElement:O0,Font:Ul,FontElement:KN,FontFaceElement:WN,GElement:tx,GlyphElement:aI,GradientElement:uI,ImageElement:t8,LineElement:UN,LinearGradientElement:HN,MarkerElement:QN,MaskElement:k0,Matrix:sI,MissingGlyphElement:ZN,Mouse:SN,PSEUDO_ZERO:Zf,Parser:ex,PathElement:cs,PathParser:Yr,PatternElement:zN,Point:So,PolygonElement:NN,PolylineElement:cI,Property:Sr,QB1:iI,QB2:rI,QB3:nI,RadialGradientElement:GN,RectElement:lI,RenderedElement:Rd,Rotate:MN,SVGElement:hm,SVGFontLoader:r8,Scale:PN,Screen:D0,Skew:oI,SkewX:FN,SkewY:DN,StopElement:jN,StyleElement:hI,SymbolElement:i8,TRefElement:XN,TSpanElement:R0,TextElement:VA,TextPathElement:e8,TitleElement:h8,Transform:Dd,Translate:LN,UnknownElement:RN,UseElement:n8,ViewPort:EN,compressSpaces:Kf,default:Jf,getSelectorSpecificity:CN,normalizeAttributeName:wN,normalizeColor:BN,parseExternalUrl:WT,presets:_ve,toNumbers:Oc,trimLeft:bN,trimRight:xN,vectorMagnitude:ZT,vectorsAngle:XT,vectorsRatio:Yb},Symbol.toStringTag,{value:"Module"}));Rh.CompareMaps=Qne,Rh.Layers=so,Rh.Map=Rne,Rh.Styles=Dg,Rh.Terrains=hv,Object.defineProperty(Rh,Symbol.toStringTag,{value:"Module"})});
