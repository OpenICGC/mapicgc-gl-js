(function(EA,Op){typeof exports=="object"&&typeof module<"u"?Op(exports):typeof define=="function"&&define.amd?define(["exports"],Op):(EA=typeof globalThis<"u"?globalThis:EA||self,Op(EA.mapicgcgl={}))})(this,function(EA){"use strict";function Op(r,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var qd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dp(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var BS={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(qd,function(){var e={},n={};function i(a,o,h){if(n[a]=h,a==="index"){var f="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",m={};return n.shared(m),n.index(e,m),typeof window<"u"&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([f],{type:"text/javascript"}))),e}}i("shared",["exports"],function(a){function o(u,l,A,p){return new(A||(A=Promise))(function(v,E){function I(H){try{O(p.next(H))}catch(q){E(q)}}function L(H){try{O(p.throw(H))}catch(q){E(q)}}function O(H){var q;H.done?v(H.value):(q=H.value,q instanceof A?q:new A(function($){$(q)})).then(I,L)}O((p=p.apply(u,l||[])).next())})}function h(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var f=m;function m(u,l){this.x=u,this.y=l}m.prototype={clone:function(){return new m(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,l){return this.clone()._rotateAround(u,l)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var l=u.x-this.x,A=u.y-this.y;return l*l+A*A},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,l){return Math.atan2(this.x*l-this.y*u,this.x*u+this.y*l)},_matMult:function(u){var l=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=l,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var l=Math.cos(u),A=Math.sin(u),p=A*this.x+l*this.y;return this.x=l*this.x-A*this.y,this.y=p,this},_rotateAround:function(u,l){var A=Math.cos(u),p=Math.sin(u),v=l.y+p*(this.x-l.x)+A*(this.y-l.y);return this.x=l.x+A*(this.x-l.x)-p*(this.y-l.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},m.convert=function(u){return u instanceof m?u:Array.isArray(u)?new m(u[0],u[1]):u};var b=h(f),x=B;function B(u,l,A,p){this.cx=3*u,this.bx=3*(A-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=l,this.p2x=A,this.p2y=p}B.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,l){if(l===void 0&&(l=1e-6),u<0)return 0;if(u>1)return 1;for(var A=u,p=0;p<8;p++){var v=this.sampleCurveX(A)-u;if(Math.abs(v)<l)return A;var E=this.sampleCurveDerivativeX(A);if(Math.abs(E)<1e-6)break;A-=v/E}var I=0,L=1;for(A=u,p=0;p<20&&(v=this.sampleCurveX(A),!(Math.abs(v-u)<l));p++)u>v?I=A:L=A,A=.5*(L-I)+I;return A},solve:function(u,l){return this.sampleCurveY(this.solveCurveX(u,l))}};var P=h(x);let R,Q;function z(){return R==null&&(R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),R}function G(){if(Q==null&&(Q=!1,z())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let p=0;p<5*5;p++){const v=4*p;l.fillStyle=`rgb(${v},${v+1},${v+2})`,l.fillRect(p%5,Math.floor(p/5),1,1)}const A=l.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&A[p]!==p){Q=!0;break}}}return Q||!1}function X(u,l,A,p){const v=new P(u,l,A,p);return E=>v.solve(E)}const et=X(.25,.1,.25,1);function pt(u,l,A){return Math.min(A,Math.max(l,u))}function gt(u,l,A){const p=A-l,v=((u-l)%p+p)%p+l;return v===l?A:v}function mt(u){for(var l=arguments.length,A=new Array(l>1?l-1:0),p=1;p<l;p++)A[p-1]=arguments[p];for(const v of A)for(const E in v)u[E]=v[E];return u}let ft=1;function Mt(u,l,A){const p={};for(const v in u)p[v]=l.call(this,u[v],v,u);return p}function Lt(u,l,A){const p={};for(const v in u)l.call(this,u[v],v,u)&&(p[v]=u[v]);return p}function at(u){return Array.isArray(u)?u.map(at):typeof u=="object"&&u?Mt(u,at):u}const ct={};function wt(u){ct[u]||(typeof console<"u"&&console.warn(u),ct[u]=!0)}function _t(u,l,A){return(A.y-u.y)*(l.x-u.x)>(l.y-u.y)*(A.x-u.x)}function Jt(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let Yt=null;function ee(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ne(u,l,A,p,v){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(u,{timestamp:0});try{const I=E==null?void 0:E.format;if(!I||!I.startsWith("BGR")&&!I.startsWith("RGB"))throw new Error(`Unrecognized format ${I}`);const L=I.startsWith("BGR"),O=new Uint8ClampedArray(p*v*4);if(yield E.copyTo(O,function(H,q,$,Y,ot){const ut=4*Math.max(-q,0),vt=(Math.max(0,$)-$)*Y*4+ut,It=4*Y,Dt=Math.max(0,q),te=Math.max(0,$);return{rect:{x:Dt,y:te,width:Math.min(H.width,q+Y)-Dt,height:Math.min(H.height,$+ot)-te},layout:[{offset:vt,stride:It}]}}(u,l,A,p,v)),L)for(let H=0;H<O.length;H+=4){const q=O[H];O[H]=O[H+2],O[H+2]=q}return O}finally{E.close()}})}let re,Be;const it="AbortError";function bt(){return new Error(it)}const Pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ot(u){return Pt.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const qt="global-dispatcher";class Gt extends Error{constructor(l,A,p,v){super(`AJAXError: ${A} (${l}): ${p}`),this.status=l,this.statusText=A,this.url=p,this.body=v}}const oe=()=>Jt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ie=function(u,l){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const p=Ot(u.url);if(p)return p(u,l);if(Jt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:qt},l)}if(!(/^file:/.test(A=u.url)||/^file:/.test(oe())&&!/^\w+:/.test(A))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,v){return o(this,void 0,void 0,function*(){const E=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:oe(),signal:v.signal});p.type==="json"&&E.headers.set("Accept","application/json");const I=yield fetch(E);if(!I.ok){const H=yield I.blob();throw new Gt(I.status,I.statusText,p.url,H)}let L;L=p.type==="arrayBuffer"||p.type==="image"?I.arrayBuffer():p.type==="json"?I.json():I.text();const O=yield L;if(v.signal.aborted)throw bt();return{data:O,cacheControl:I.headers.get("Cache-Control"),expires:I.headers.get("Expires")}})}(u,l);if(Jt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:qt},l)}var A;return function(p,v){return new Promise((E,I)=>{const L=new XMLHttpRequest;L.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(L.responseType="arraybuffer");for(const O in p.headers)L.setRequestHeader(O,p.headers[O]);p.type==="json"&&(L.responseType="text",L.setRequestHeader("Accept","application/json")),L.withCredentials=p.credentials==="include",L.onerror=()=>{I(new Error(L.statusText))},L.onload=()=>{if(!v.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let O=L.response;if(p.type==="json")try{O=JSON.parse(L.response)}catch(H){return void I(H)}E({data:O,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const O=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});I(new Gt(L.status,L.statusText,p.url,O))}},v.signal.addEventListener("abort",()=>{L.abort(),I(bt())}),L.send(p.body)})}(u,l)};function Ce(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const l=new URL(u),A=window.location;return l.protocol===A.protocol&&l.host===A.host}function Fe(u,l,A){A[u]&&A[u].indexOf(l)!==-1||(A[u]=A[u]||[],A[u].push(l))}function Re(u,l,A){if(A&&A[u]){const p=A[u].indexOf(l);p!==-1&&A[u].splice(p,1)}}class Ne{constructor(l){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mt(this,A),this.type=l}}class ke extends Ne{constructor(l){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",mt({error:l},A))}}class fe{on(l,A){return this._listeners=this._listeners||{},Fe(l,A,this._listeners),this}off(l,A){return Re(l,A,this._listeners),Re(l,A,this._oneTimeListeners),this}once(l,A){return A?(this._oneTimeListeners=this._oneTimeListeners||{},Fe(l,A,this._oneTimeListeners),this):new Promise(p=>this.once(l,p))}fire(l,A){typeof l=="string"&&(l=new Ne(l,A||{}));const p=l.type;if(this.listens(p)){l.target=this;const v=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const L of v)L.call(this,l);const E=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const L of E)Re(p,L,this._oneTimeListeners),L.call(this,l);const I=this._eventedParent;I&&(mt(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),I.fire(l))}else l instanceof ke&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,A){return this._eventedParent=l,this._eventedParentData=A,this}}var lt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const pr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function er(u,l){const A={};for(const p in u)p!=="ref"&&(A[p]=u[p]);return pr.forEach(p=>{p in l&&(A[p]=l[p])}),A}function pe(u,l){if(Array.isArray(u)){if(!Array.isArray(l)||u.length!==l.length)return!1;for(let A=0;A<u.length;A++)if(!pe(u[A],l[A]))return!1;return!0}if(typeof u=="object"&&u!==null&&l!==null){if(typeof l!="object"||Object.keys(u).length!==Object.keys(l).length)return!1;for(const A in u)if(!pe(u[A],l[A]))return!1;return!0}return u===l}function we(u,l){u.push(l)}function Ie(u,l,A){we(A,{command:"addSource",args:[u,l[u]]})}function Oe(u,l,A){we(l,{command:"removeSource",args:[u]}),A[u]=!0}function nr(u,l,A,p){Oe(u,A,p),Ie(u,l,A)}function hr(u,l,A){let p;for(p in u[A])if(Object.prototype.hasOwnProperty.call(u[A],p)&&p!=="data"&&!pe(u[A][p],l[A][p]))return!1;for(p in l[A])if(Object.prototype.hasOwnProperty.call(l[A],p)&&p!=="data"&&!pe(u[A][p],l[A][p]))return!1;return!0}function Sr(u,l,A,p,v,E){u=u||{},l=l||{};for(const I in u)Object.prototype.hasOwnProperty.call(u,I)&&(pe(u[I],l[I])||A.push({command:E,args:[p,I,l[I],v]}));for(const I in l)Object.prototype.hasOwnProperty.call(l,I)&&!Object.prototype.hasOwnProperty.call(u,I)&&(pe(u[I],l[I])||A.push({command:E,args:[p,I,l[I],v]}))}function Mr(u){return u.id}function kr(u,l){return u[l.id]=l,u}class ye{constructor(l,A,p,v){this.message=(l?`${l}: `:"")+p,v&&(this.identifier=v),A!=null&&A.__line__&&(this.line=A.__line__)}}function or(u){for(var l=arguments.length,A=new Array(l>1?l-1:0),p=1;p<l;p++)A[p-1]=arguments[p];for(const v of A)for(const E in v)u[E]=v[E];return u}class xr extends Error{constructor(l,A){super(A),this.message=A,this.key=l}}class De{constructor(l){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=l,this.bindings={};for(const[p,v]of A)this.bindings[p]=v}concat(l){return new De(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const pn={kind:"null"},ge={kind:"number"},yr={kind:"string"},je={kind:"boolean"},Rr={kind:"color"},cn={kind:"object"},He={kind:"value"},Kn={kind:"collator"},sn={kind:"formatted"},Jr={kind:"padding"},Bt={kind:"resolvedImage"},Z={kind:"variableAnchorOffsetCollection"};function J(u,l){return{kind:"array",itemType:u,N:l}}function st(u){if(u.kind==="array"){const l=st(u.itemType);return typeof u.N=="number"?`array<${l}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${l}>`}return u.kind}const Ft=[pn,ge,yr,je,Rr,sn,cn,J(He),Jr,Bt,Z];function Nt(u,l){if(l.kind==="error")return null;if(u.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Nt(u.itemType,l.itemType))&&(typeof u.N!="number"||u.N===l.N))return null}else{if(u.kind===l.kind)return null;if(u.kind==="value"){for(const A of Ft)if(!Nt(A,l))return null}}return`Expected ${st(u)} but found ${st(l)} instead.`}function Ht(u,l){return l.some(A=>A.kind===u.kind)}function jt(u,l){return l.some(A=>A==="null"?u===null:A==="array"?Array.isArray(u):A==="object"?u&&!Array.isArray(u)&&typeof u=="object":A===typeof u)}function Tt(u,l){return u.kind==="array"&&l.kind==="array"?u.itemType.kind===l.itemType.kind&&typeof u.N=="number":u.kind===l.kind}const Xt=.96422,_e=.82521,ue=4/29,Ae=6/29,ze=3*Ae*Ae,Ve=Ae*Ae*Ae,Er=Math.PI/180,_r=180/Math.PI;function Ur(u){return(u%=360)<0&&(u+=360),u}function Vr(u){let[l,A,p,v]=u,E,I;const L=Zr((.2225045*(l=Gr(l))+.7168786*(A=Gr(A))+.0606169*(p=Gr(p)))/1);l===A&&A===p?E=I=L:(E=Zr((.4360747*l+.3850649*A+.1430804*p)/Xt),I=Zr((.0139322*l+.0971045*A+.7141733*p)/_e));const O=116*L-16;return[O<0?0:O,500*(E-L),200*(L-I),v]}function Gr(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Zr(u){return u>Ve?Math.pow(u,1/3):u/ze+ue}function vr(u){let[l,A,p,v]=u,E=(l+16)/116,I=isNaN(A)?E:E+A/500,L=isNaN(p)?E:E-p/200;return E=1*_n(E),I=Xt*_n(I),L=_e*_n(L),[Wr(3.1338561*I-1.6168667*E-.4906146*L),Wr(-.9787684*I+1.9161415*E+.033454*L),Wr(.0719453*I-.2289914*E+1.4052427*L),v]}function Wr(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function _n(u){return u>Ae?u*u*u:ze*(u-ue)}function Rn(u){return parseInt(u.padEnd(2,u),16)/255}function Zn(u,l){return Rt(l?u/100:u,0,1)}function Rt(u,l,A){return Math.min(Math.max(l,u),A)}function qe(u){return!u.some(Number.isNaN)}const Te={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class lr{constructor(l,A,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=l,this.g=A,this.b=p,this.a=v,E||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[l,A,p,v]))}static parse(l){if(l instanceof lr)return l;if(typeof l!="string")return;const A=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Te[p];if(v){const[I,L,O]=v;return[I/255,L/255,O/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const I=p.length<6?1:2;let L=1;return[Rn(p.slice(L,L+=I)),Rn(p.slice(L,L+=I)),Rn(p.slice(L,L+=I)),Rn(p.slice(L,L+I)||"ff")]}if(p.startsWith("rgb")){const I=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(I){const[L,O,H,q,$,Y,ot,ut,vt,It,Dt,te]=I,Qt=[q||" ",ot||" ",It].join("");if(Qt==="  "||Qt==="  /"||Qt===",,"||Qt===",,,"){const Kt=[H,Y,vt].join(""),ve=Kt==="%%%"?100:Kt===""?255:0;if(ve){const be=[Rt(+O/ve,0,1),Rt(+$/ve,0,1),Rt(+ut/ve,0,1),Dt?Zn(+Dt,te):1];if(qe(be))return be}}return}}const E=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[I,L,O,H,q,$,Y,ot,ut]=E,vt=[O||" ",q||" ",Y].join("");if(vt==="  "||vt==="  /"||vt===",,"||vt===",,,"){const It=[+L,Rt(+H,0,100),Rt(+$,0,100),ot?Zn(+ot,ut):1];if(qe(It))return function(Dt){let[te,Qt,Kt,ve]=Dt;function be(Ye){const cr=(Ye+te/30)%12,We=Qt*Math.min(Kt,1-Kt);return Kt-We*Math.max(-1,Math.min(cr-3,9-cr,1))}return te=Ur(te),Qt/=100,Kt/=100,[be(0),be(8),be(4),ve]}(It)}}}(l);return A?new lr(...A,!1):void 0}get rgb(){const{r:l,g:A,b:p,a:v}=this,E=v||1/0;return this.overwriteGetter("rgb",[l/E,A/E,p/E,v])}get hcl(){return this.overwriteGetter("hcl",function(l){const[A,p,v,E]=Vr(l),I=Math.sqrt(p*p+v*v);return[Math.round(1e4*I)?Ur(Math.atan2(v,p)*_r):NaN,I,A,E]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Vr(this.rgb))}overwriteGetter(l,A){return Object.defineProperty(this,l,{value:A}),A}toString(){const[l,A,p,v]=this.rgb;return`rgba(${[l,A,p].map(E=>Math.round(255*E)).join(",")},${v})`}}lr.black=new lr(0,0,0,1),lr.white=new lr(1,1,1,1),lr.transparent=new lr(0,0,0,0),lr.red=new lr(1,0,0,1);class Or{constructor(l,A,p){this.sensitivity=l?A?"variant":"case":A?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,A){return this.collator.compare(l,A)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fn{constructor(l,A,p,v,E){this.text=l,this.image=A,this.scale=p,this.fontStack=v,this.textColor=E}}class jr{constructor(l){this.sections=l}static fromString(l){return new jr([new Fn(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof jr?l:jr.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class gn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof gn)return l;if(typeof l=="number")return new gn([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const A of l)if(typeof A!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new gn(l)}}toString(){return JSON.stringify(this.values)}}const Wn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class mn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof mn)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let A=0;A<l.length;A+=2){const p=l[A],v=l[A+1];if(typeof p!="string"||!Wn.has(p)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new mn(l)}}toString(){return JSON.stringify(this.values)}}class on{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new on({name:l,available:!1}):null}}function Bc(u,l,A,p){return typeof u=="number"&&u>=0&&u<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof A=="number"&&A>=0&&A<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,l,A,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,l,A,p]:[u,l,A]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function os(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof lr||u instanceof Or||u instanceof jr||u instanceof gn||u instanceof mn||u instanceof on)return!0;if(Array.isArray(u)){for(const l of u)if(!os(l))return!1;return!0}if(typeof u=="object"){for(const l in u)if(!os(u[l]))return!1;return!0}return!1}function Qn(u){if(u===null)return pn;if(typeof u=="string")return yr;if(typeof u=="boolean")return je;if(typeof u=="number")return ge;if(u instanceof lr)return Rr;if(u instanceof Or)return Kn;if(u instanceof jr)return sn;if(u instanceof gn)return Jr;if(u instanceof mn)return Z;if(u instanceof on)return Bt;if(Array.isArray(u)){const l=u.length;let A;for(const p of u){const v=Qn(p);if(A){if(A===v)continue;A=He;break}A=v}return J(A||He,l)}return cn}function un(u){const l=typeof u;return u===null?"":l==="string"||l==="number"||l==="boolean"?String(u):u instanceof lr||u instanceof jr||u instanceof gn||u instanceof mn||u instanceof on?u.toString():JSON.stringify(u)}class Cs{constructor(l,A){this.type=l,this.value=A}static parse(l,A){if(l.length!==2)return A.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!os(l[1]))return A.error("invalid value");const p=l[1];let v=Qn(p);const E=A.expectedType;return v.kind!=="array"||v.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(v=E),new Cs(v,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ln{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const Os={string:yr,number:ge,boolean:je,object:cn};class Mi{constructor(l,A){this.type=l,this.args=A}static parse(l,A){if(l.length<2)return A.error("Expected at least one argument.");let p,v=1;const E=l[0];if(E==="array"){let L,O;if(l.length>2){const H=l[1];if(typeof H!="string"||!(H in Os)||H==="object")return A.error('The item type argument of "array" must be one of string, number, boolean',1);L=Os[H],v++}else L=He;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return A.error('The length argument to "array" must be a positive integer literal',2);O=l[2],v++}p=J(L,O)}else{if(!Os[E])throw new Error(`Types doesn't contain name = ${E}`);p=Os[E]}const I=[];for(;v<l.length;v++){const L=A.parse(l[v],v,He);if(!L)return null;I.push(L)}return new Mi(p,I)}evaluate(l){for(let A=0;A<this.args.length;A++){const p=this.args[A].evaluate(l);if(!Nt(this.type,Qn(p)))return p;if(A===this.args.length-1)throw new Ln(`Expected value to be of type ${st(this.type)}, but found ${st(Qn(p))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const ga={"to-boolean":je,"to-color":Rr,"to-number":ge,"to-string":yr};class ti{constructor(l,A){this.type=l,this.args=A}static parse(l,A){if(l.length<2)return A.error("Expected at least one argument.");const p=l[0];if(!ga[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&l.length!==2)return A.error("Expected one argument.");const v=ga[p],E=[];for(let I=1;I<l.length;I++){const L=A.parse(l[I],I,He);if(!L)return null;E.push(L)}return new ti(v,E)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let A,p;for(const v of this.args){if(A=v.evaluate(l),p=null,A instanceof lr)return A;if(typeof A=="string"){const E=l.parseColor(A);if(E)return E}else if(Array.isArray(A)&&(p=A.length<3||A.length>4?`Invalid rbga value ${JSON.stringify(A)}: expected an array containing either three or four numeric values.`:Bc(A[0],A[1],A[2],A[3]),!p))return new lr(A[0]/255,A[1]/255,A[2]/255,A[3])}throw new Ln(p||`Could not parse color from value '${typeof A=="string"?A:JSON.stringify(A)}'`)}case"padding":{let A;for(const p of this.args){A=p.evaluate(l);const v=gn.parse(A);if(v)return v}throw new Ln(`Could not parse padding from value '${typeof A=="string"?A:JSON.stringify(A)}'`)}case"variableAnchorOffsetCollection":{let A;for(const p of this.args){A=p.evaluate(l);const v=mn.parse(A);if(v)return v}throw new Ln(`Could not parse variableAnchorOffsetCollection from value '${typeof A=="string"?A:JSON.stringify(A)}'`)}case"number":{let A=null;for(const p of this.args){if(A=p.evaluate(l),A===null)return 0;const v=Number(A);if(!isNaN(v))return v}throw new Ln(`Could not convert ${JSON.stringify(A)} to number.`)}case"formatted":return jr.fromString(un(this.args[0].evaluate(l)));case"resolvedImage":return on.fromString(un(this.args[0].evaluate(l)));default:return un(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const as=["Unknown","Point","LineString","Polygon"];class wi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?as[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let A=this._parseColorCache[l];return A||(A=this._parseColorCache[l]=lr.parse(l)),A}}class an{constructor(l,A){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],v=arguments.length>3?arguments[3]:void 0,E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new De,I=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=l,this.path=p,this.key=p.map(L=>`[${L}]`).join(""),this.scope=E,this.errors=I,this.expectedType=v,this._isConstant=A}parse(l,A,p,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return A?this.concat(A,p,v)._parse(l,E):this._parse(l,E)}_parse(l,A){function p(v,E,I){return I==="assert"?new Mi(E,[v]):I==="coerce"?new ti(E,[v]):v}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=l[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[v];if(E){let I=E.parse(l,this);if(!I)return null;if(this.expectedType){const L=this.expectedType,O=I.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||O.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string")if(L.kind!=="padding"||O.kind!=="value"&&O.kind!=="number"&&O.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||O.kind!=="value"&&O.kind!=="array"){if(this.checkSubtype(L,O))return null}else I=p(I,L,A.typeAnnotation||"coerce");else I=p(I,L,A.typeAnnotation||"coerce");else I=p(I,L,A.typeAnnotation||"coerce");else I=p(I,L,A.typeAnnotation||"assert")}if(!(I instanceof Cs)&&I.type.kind!=="resolvedImage"&&this._isConstant(I)){const L=new wi;try{I=new Cs(I.type,I.evaluate(L))}catch(O){return this.error(O.message),null}}return I}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,A,p){const v=typeof l=="number"?this.path.concat(l):this.path,E=p?this.scope.concat(p):this.scope;return new an(this.registry,this._isConstant,v,A||null,E,this.errors)}error(l){for(var A=arguments.length,p=new Array(A>1?A-1:0),v=1;v<A;v++)p[v-1]=arguments[v];const E=`${this.key}${p.map(I=>`[${I}]`).join("")}`;this.errors.push(new xr(E,l))}checkSubtype(l,A){const p=Nt(l,A);return p&&this.error(p),p}}class jo{constructor(l,A){this.type=A.type,this.bindings=[].concat(l),this.result=A}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const A of this.bindings)l(A[1]);l(this.result)}static parse(l,A){if(l.length<4)return A.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const p=[];for(let E=1;E<l.length-1;E+=2){const I=l[E];if(typeof I!="string")return A.error(`Expected string, but found ${typeof I} instead.`,E);if(/[^a-zA-Z0-9_]/.test(I))return A.error("Variable names must contain only alphanumeric characters or '_'.",E);const L=A.parse(l[E+1],E+1);if(!L)return null;p.push([I,L])}const v=A.parse(l[l.length-1],l.length-1,A.expectedType,p);return v?new jo(p,v):null}outputDefined(){return this.result.outputDefined()}}class qo{constructor(l,A){this.type=A.type,this.name=l,this.boundExpression=A}static parse(l,A){if(l.length!==2||typeof l[1]!="string")return A.error("'var' expression requires exactly one string literal argument.");const p=l[1];return A.scope.has(p)?new qo(p,A.scope.get(p)):A.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class Il{constructor(l,A,p){this.type=l,this.index=A,this.input=p}static parse(l,A){if(l.length!==3)return A.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const p=A.parse(l[1],1,ge),v=A.parse(l[2],2,J(A.expectedType||He));return p&&v?new Il(v.type.itemType,p,v):null}evaluate(l){const A=this.index.evaluate(l),p=this.input.evaluate(l);if(A<0)throw new Ln(`Array index out of bounds: ${A} < 0.`);if(A>=p.length)throw new Ln(`Array index out of bounds: ${A} > ${p.length-1}.`);if(A!==Math.floor(A))throw new Ln(`Array index must be an integer, but found ${A} instead.`);return p[A]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Fl{constructor(l,A){this.type=je,this.needle=l,this.haystack=A}static parse(l,A){if(l.length!==3)return A.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const p=A.parse(l[1],1,He),v=A.parse(l[2],2,He);return p&&v?Ht(p.type,[je,yr,ge,pn,He])?new Fl(p,v):A.error(`Expected first argument to be of type boolean, string, number or null, but found ${st(p.type)} instead`):null}evaluate(l){const A=this.needle.evaluate(l),p=this.haystack.evaluate(l);if(!p)return!1;if(!jt(A,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${st(Qn(A))} instead.`);if(!jt(p,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${st(Qn(p))} instead.`);return p.indexOf(A)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class dt{constructor(l,A,p){this.type=ge,this.needle=l,this.haystack=A,this.fromIndex=p}static parse(l,A){if(l.length<=2||l.length>=5)return A.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const p=A.parse(l[1],1,He),v=A.parse(l[2],2,He);if(!p||!v)return null;if(!Ht(p.type,[je,yr,ge,pn,He]))return A.error(`Expected first argument to be of type boolean, string, number or null, but found ${st(p.type)} instead`);if(l.length===4){const E=A.parse(l[3],3,ge);return E?new dt(p,v,E):null}return new dt(p,v)}evaluate(l){const A=this.needle.evaluate(l),p=this.haystack.evaluate(l);if(!jt(A,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${st(Qn(A))} instead.`);if(!jt(p,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${st(Qn(p))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(l);return p.indexOf(A,v)}return p.indexOf(A)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class xt{constructor(l,A,p,v,E,I){this.inputType=l,this.type=A,this.input=p,this.cases=v,this.outputs=E,this.otherwise=I}static parse(l,A){if(l.length<5)return A.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return A.error("Expected an even number of arguments.");let p,v;A.expectedType&&A.expectedType.kind!=="value"&&(v=A.expectedType);const E={},I=[];for(let H=2;H<l.length-1;H+=2){let q=l[H];const $=l[H+1];Array.isArray(q)||(q=[q]);const Y=A.concat(H);if(q.length===0)return Y.error("Expected at least one branch label.");for(const ut of q){if(typeof ut!="number"&&typeof ut!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof ut=="number"&&Math.abs(ut)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ut=="number"&&Math.floor(ut)!==ut)return Y.error("Numeric branch labels must be integer values.");if(p){if(Y.checkSubtype(p,Qn(ut)))return null}else p=Qn(ut);if(E[String(ut)]!==void 0)return Y.error("Branch labels must be unique.");E[String(ut)]=I.length}const ot=A.parse($,H,v);if(!ot)return null;v=v||ot.type,I.push(ot)}const L=A.parse(l[1],1,He);if(!L)return null;const O=A.parse(l[l.length-1],l.length-1,v);return O?L.type.kind!=="value"&&A.concat(1).checkSubtype(p,L.type)?null:new xt(p,v,L,E,I,O):null}evaluate(l){const A=this.input.evaluate(l);return(Qn(A)===this.inputType&&this.outputs[this.cases[A]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class kt{constructor(l,A,p){this.type=l,this.branches=A,this.otherwise=p}static parse(l,A){if(l.length<4)return A.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return A.error("Expected an odd number of arguments.");let p;A.expectedType&&A.expectedType.kind!=="value"&&(p=A.expectedType);const v=[];for(let I=1;I<l.length-1;I+=2){const L=A.parse(l[I],I,je);if(!L)return null;const O=A.parse(l[I+1],I+1,p);if(!O)return null;v.push([L,O]),p=p||O.type}const E=A.parse(l[l.length-1],l.length-1,p);if(!E)return null;if(!p)throw new Error("Can't infer output type");return new kt(p,v,E)}evaluate(l){for(const[A,p]of this.branches)if(A.evaluate(l))return p.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[A,p]of this.branches)l(A),l(p);l(this.otherwise)}outputDefined(){return this.branches.every(l=>{let[A,p]=l;return p.outputDefined()})&&this.otherwise.outputDefined()}}class he{constructor(l,A,p,v){this.type=l,this.input=A,this.beginIndex=p,this.endIndex=v}static parse(l,A){if(l.length<=2||l.length>=5)return A.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const p=A.parse(l[1],1,He),v=A.parse(l[2],2,ge);if(!p||!v)return null;if(!Ht(p.type,[J(He),yr,He]))return A.error(`Expected first argument to be of type array or string, but found ${st(p.type)} instead`);if(l.length===4){const E=A.parse(l[3],3,ge);return E?new he(p.type,p,v,E):null}return new he(p.type,p,v)}evaluate(l){const A=this.input.evaluate(l),p=this.beginIndex.evaluate(l);if(!jt(A,["string","array"]))throw new Ln(`Expected first argument to be of type array or string, but found ${st(Qn(A))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(l);return A.slice(p,v)}return A.slice(p)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Le(u,l){const A=u.length-1;let p,v,E=0,I=A,L=0;for(;E<=I;)if(L=Math.floor((E+I)/2),p=u[L],v=u[L+1],p<=l){if(L===A||l<v)return L;E=L+1}else{if(!(p>l))throw new Ln("Input is not a number.");I=L-1}return 0}class Ze{constructor(l,A,p){this.type=l,this.input=A,this.labels=[],this.outputs=[];for(const[v,E]of p)this.labels.push(v),this.outputs.push(E)}static parse(l,A){if(l.length-1<4)return A.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return A.error("Expected an even number of arguments.");const p=A.parse(l[1],1,ge);if(!p)return null;const v=[];let E=null;A.expectedType&&A.expectedType.kind!=="value"&&(E=A.expectedType);for(let I=1;I<l.length;I+=2){const L=I===1?-1/0:l[I],O=l[I+1],H=I,q=I+1;if(typeof L!="number")return A.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(v.length&&v[v.length-1][0]>=L)return A.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',H);const $=A.parse(O,q,E);if(!$)return null;E=E||$.type,v.push([L,$])}return new Ze(E,p,v)}evaluate(l){const A=this.labels,p=this.outputs;if(A.length===1)return p[0].evaluate(l);const v=this.input.evaluate(l);if(v<=A[0])return p[0].evaluate(l);const E=A.length;return v>=A[E-1]?p[E-1].evaluate(l):p[Le(A,v)].evaluate(l)}eachChild(l){l(this.input);for(const A of this.outputs)l(A)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Qr(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var ei=$n;function $n(u,l,A,p){this.cx=3*u,this.bx=3*(A-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=l,this.p2x=A,this.p2y=p}$n.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,l){if(l===void 0&&(l=1e-6),u<0)return 0;if(u>1)return 1;for(var A=u,p=0;p<8;p++){var v=this.sampleCurveX(A)-u;if(Math.abs(v)<l)return A;var E=this.sampleCurveDerivativeX(A);if(Math.abs(E)<1e-6)break;A-=v/E}var I=0,L=1;for(A=u,p=0;p<20&&(v=this.sampleCurveX(A),!(Math.abs(v-u)<l));p++)u>v?I=A:L=A,A=.5*(L-I)+I;return A},solve:function(u,l){return this.sampleCurveY(this.solveCurveX(u,l))}};var xi=Qr(ei);function vn(u,l,A){return u+A*(l-u)}function au(u,l,A){return u.map((p,v)=>vn(p,l[v],A))}const zi={number:vn,color:function(u,l,A){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[v,E,I,L]=au(u.rgb,l.rgb,A);return new lr(v,E,I,L,!1)}case"hcl":{const[v,E,I,L]=u.hcl,[O,H,q,$]=l.hcl;let Y,ot;if(isNaN(v)||isNaN(O))isNaN(v)?isNaN(O)?Y=NaN:(Y=O,I!==1&&I!==0||(ot=H)):(Y=v,q!==1&&q!==0||(ot=E));else{let te=O-v;O>v&&te>180?te-=360:O<v&&v-O>180&&(te+=360),Y=v+A*te}const[ut,vt,It,Dt]=function(te){let[Qt,Kt,ve,be]=te;return Qt=isNaN(Qt)?0:Qt*Er,vr([ve,Math.cos(Qt)*Kt,Math.sin(Qt)*Kt,be])}([Y,ot??vn(E,H,A),vn(I,q,A),vn(L,$,A)]);return new lr(ut,vt,It,Dt,!1)}case"lab":{const[v,E,I,L]=vr(au(u.lab,l.lab,A));return new lr(v,E,I,L,!1)}}},array:au,padding:function(u,l,A){return new gn(au(u.values,l.values,A))},variableAnchorOffsetCollection:function(u,l,A){const p=u.values,v=l.values;if(p.length!==v.length)throw new Ln(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${l.toString()}`);const E=[];for(let I=0;I<p.length;I+=2){if(p[I]!==v[I])throw new Ln(`Cannot interpolate values containing mismatched anchors. from[${I}]: ${p[I]}, to[${I}]: ${v[I]}`);E.push(p[I]);const[L,O]=p[I+1],[H,q]=v[I+1];E.push([vn(L,H,A),vn(O,q,A)])}return new mn(E)}};class Ir{constructor(l,A,p,v,E){this.type=l,this.operator=A,this.interpolation=p,this.input=v,this.labels=[],this.outputs=[];for(const[I,L]of E)this.labels.push(I),this.outputs.push(L)}static interpolationFactor(l,A,p,v){let E=0;if(l.name==="exponential")E=aA(A,l.base,p,v);else if(l.name==="linear")E=aA(A,1,p,v);else if(l.name==="cubic-bezier"){const I=l.controlPoints;E=new xi(I[0],I[1],I[2],I[3]).solve(aA(A,1,p,v))}return E}static parse(l,A){let[p,v,E,...I]=l;if(!Array.isArray(v)||v.length===0)return A.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const H=v[1];if(typeof H!="number")return A.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:H}}else{if(v[0]!=="cubic-bezier")return A.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const H=v.slice(1);if(H.length!==4||H.some(q=>typeof q!="number"||q<0||q>1))return A.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:H}}}if(l.length-1<4)return A.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return A.error("Expected an even number of arguments.");if(E=A.parse(E,2,ge),!E)return null;const L=[];let O=null;p==="interpolate-hcl"||p==="interpolate-lab"?O=Rr:A.expectedType&&A.expectedType.kind!=="value"&&(O=A.expectedType);for(let H=0;H<I.length;H+=2){const q=I[H],$=I[H+1],Y=H+3,ot=H+4;if(typeof q!="number")return A.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(L.length&&L[L.length-1][0]>=q)return A.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const ut=A.parse($,ot,O);if(!ut)return null;O=O||ut.type,L.push([q,ut])}return Tt(O,ge)||Tt(O,Rr)||Tt(O,Jr)||Tt(O,Z)||Tt(O,J(ge))?new Ir(O,p,v,E,L):A.error(`Type ${st(O)} is not interpolatable.`)}evaluate(l){const A=this.labels,p=this.outputs;if(A.length===1)return p[0].evaluate(l);const v=this.input.evaluate(l);if(v<=A[0])return p[0].evaluate(l);const E=A.length;if(v>=A[E-1])return p[E-1].evaluate(l);const I=Le(A,v),L=Ir.interpolationFactor(this.interpolation,v,A[I],A[I+1]),O=p[I].evaluate(l),H=p[I+1].evaluate(l);switch(this.operator){case"interpolate":return zi[this.type.kind](O,H,L);case"interpolate-hcl":return zi.color(O,H,L,"hcl");case"interpolate-lab":return zi.color(O,H,L,"lab")}}eachChild(l){l(this.input);for(const A of this.outputs)l(A)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function aA(u,l,A,p){const v=p-A,E=u-A;return v===0?0:l===1?E/v:(Math.pow(l,E)-1)/(Math.pow(l,v)-1)}class lu{constructor(l,A){this.type=l,this.args=A}static parse(l,A){if(l.length<2)return A.error("Expectected at least one argument.");let p=null;const v=A.expectedType;v&&v.kind!=="value"&&(p=v);const E=[];for(const L of l.slice(1)){const O=A.parse(L,1+E.length,p,void 0,{typeAnnotation:"omit"});if(!O)return null;p=p||O.type,E.push(O)}if(!p)throw new Error("No output type");const I=v&&E.some(L=>Nt(v,L.type));return new lu(I?He:p,E)}evaluate(l){let A,p=null,v=0;for(const E of this.args)if(v++,p=E.evaluate(l),p&&p instanceof on&&!p.available&&(A||(A=p.name),p=null,v===this.args.length&&(p=A)),p!==null)break;return p}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function wo(u,l){return u==="=="||u==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function cu(u,l,A,p){return p.compare(l,A)===0}function ja(u,l,A){const p=u!=="=="&&u!=="!=";return class zk{constructor(E,I,L){this.type=je,this.lhs=E,this.rhs=I,this.collator=L,this.hasUntypedArgument=E.type.kind==="value"||I.type.kind==="value"}static parse(E,I){if(E.length!==3&&E.length!==4)return I.error("Expected two or three arguments.");const L=E[0];let O=I.parse(E[1],1,He);if(!O)return null;if(!wo(L,O.type))return I.concat(1).error(`"${L}" comparisons are not supported for type '${st(O.type)}'.`);let H=I.parse(E[2],2,He);if(!H)return null;if(!wo(L,H.type))return I.concat(2).error(`"${L}" comparisons are not supported for type '${st(H.type)}'.`);if(O.type.kind!==H.type.kind&&O.type.kind!=="value"&&H.type.kind!=="value")return I.error(`Cannot compare types '${st(O.type)}' and '${st(H.type)}'.`);p&&(O.type.kind==="value"&&H.type.kind!=="value"?O=new Mi(H.type,[O]):O.type.kind!=="value"&&H.type.kind==="value"&&(H=new Mi(O.type,[H])));let q=null;if(E.length===4){if(O.type.kind!=="string"&&H.type.kind!=="string"&&O.type.kind!=="value"&&H.type.kind!=="value")return I.error("Cannot use collator to compare non-string types.");if(q=I.parse(E[3],3,Kn),!q)return null}return new zk(O,H,q)}evaluate(E){const I=this.lhs.evaluate(E),L=this.rhs.evaluate(E);if(p&&this.hasUntypedArgument){const O=Qn(I),H=Qn(L);if(O.kind!==H.kind||O.kind!=="string"&&O.kind!=="number")throw new Ln(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${O.kind}, ${H.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const O=Qn(I),H=Qn(L);if(O.kind!=="string"||H.kind!=="string")return l(E,I,L)}return this.collator?A(E,I,L,this.collator.evaluate(E)):l(E,I,L)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const uu=ja("==",function(u,l,A){return l===A},cu),Au=ja("!=",function(u,l,A){return l!==A},function(u,l,A,p){return!cu(0,l,A,p)}),ch=ja("<",function(u,l,A){return l<A},function(u,l,A,p){return p.compare(l,A)<0}),xd=ja(">",function(u,l,A){return l>A},function(u,l,A,p){return p.compare(l,A)>0}),Bd=ja("<=",function(u,l,A){return l<=A},function(u,l,A,p){return p.compare(l,A)<=0}),lA=ja(">=",function(u,l,A){return l>=A},function(u,l,A,p){return p.compare(l,A)>=0});class ma{constructor(l,A,p){this.type=Kn,this.locale=p,this.caseSensitive=l,this.diacriticSensitive=A}static parse(l,A){if(l.length!==2)return A.error("Expected one argument.");const p=l[1];if(typeof p!="object"||Array.isArray(p))return A.error("Collator options argument must be an object.");const v=A.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,je);if(!v)return null;const E=A.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,je);if(!E)return null;let I=null;return p.locale&&(I=A.parse(p.locale,1,yr),!I)?null:new ma(v,E,I)}evaluate(l){return new Or(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class ya{constructor(l,A,p,v,E){this.type=yr,this.number=l,this.locale=A,this.currency=p,this.minFractionDigits=v,this.maxFractionDigits=E}static parse(l,A){if(l.length!==3)return A.error("Expected two arguments.");const p=A.parse(l[1],1,ge);if(!p)return null;const v=l[2];if(typeof v!="object"||Array.isArray(v))return A.error("NumberFormat options argument must be an object.");let E=null;if(v.locale&&(E=A.parse(v.locale,1,yr),!E))return null;let I=null;if(v.currency&&(I=A.parse(v.currency,1,yr),!I))return null;let L=null;if(v["min-fraction-digits"]&&(L=A.parse(v["min-fraction-digits"],1,ge),!L))return null;let O=null;return v["max-fraction-digits"]&&(O=A.parse(v["max-fraction-digits"],1,ge),!O)?null:new ya(p,E,I,L,O)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class hu{constructor(l){this.type=sn,this.sections=l}static parse(l,A){if(l.length<2)return A.error("Expected at least one argument.");const p=l[1];if(!Array.isArray(p)&&typeof p=="object")return A.error("First argument must be an image or text section.");const v=[];let E=!1;for(let I=1;I<=l.length-1;++I){const L=l[I];if(E&&typeof L=="object"&&!Array.isArray(L)){E=!1;let O=null;if(L["font-scale"]&&(O=A.parse(L["font-scale"],1,ge),!O))return null;let H=null;if(L["text-font"]&&(H=A.parse(L["text-font"],1,J(yr)),!H))return null;let q=null;if(L["text-color"]&&(q=A.parse(L["text-color"],1,Rr),!q))return null;const $=v[v.length-1];$.scale=O,$.font=H,$.textColor=q}else{const O=A.parse(l[I],1,He);if(!O)return null;const H=O.type.kind;if(H!=="string"&&H!=="value"&&H!=="null"&&H!=="resolvedImage")return A.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,v.push({content:O,scale:null,font:null,textColor:null})}}return new hu(v)}evaluate(l){return new jr(this.sections.map(A=>{const p=A.content.evaluate(l);return Qn(p)===Bt?new Fn("",p,null,null,null):new Fn(un(p),null,A.scale?A.scale.evaluate(l):null,A.font?A.font.evaluate(l).join(","):null,A.textColor?A.textColor.evaluate(l):null)}))}eachChild(l){for(const A of this.sections)l(A.content),A.scale&&l(A.scale),A.font&&l(A.font),A.textColor&&l(A.textColor)}outputDefined(){return!1}}class qa{constructor(l){this.type=Bt,this.input=l}static parse(l,A){if(l.length!==2)return A.error("Expected two arguments.");const p=A.parse(l[1],1,yr);return p?new qa(p):A.error("No image name provided.")}evaluate(l){const A=this.input.evaluate(l),p=on.fromString(A);return p&&l.availableImages&&(p.available=l.availableImages.indexOf(A)>-1),p}eachChild(l){l(this.input)}outputDefined(){return!1}}class Ka{constructor(l){this.type=ge,this.input=l}static parse(l,A){if(l.length!==2)return A.error(`Expected 1 argument, but found ${l.length-1} instead.`);const p=A.parse(l[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?A.error(`Expected argument of type string or array, but found ${st(p.type)} instead.`):new Ka(p):null}evaluate(l){const A=this.input.evaluate(l);if(typeof A=="string"||Array.isArray(A))return A.length;throw new Ln(`Expected value to be of type string or array, but found ${st(Qn(A))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Vi=8192;function yn(u,l){const A=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,v=Math.pow(2,l.z);return[Math.round(A*v*Vi),Math.round(p*v*Vi)]}function du(u,l){const A=Math.pow(2,l.z);return[(v=(u[0]/Vi+l.x)/A,360*v-180),(p=(u[1]/Vi+l.y)/A,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,v}function Ll(u,l){u[0]=Math.min(u[0],l[0]),u[1]=Math.min(u[1],l[1]),u[2]=Math.max(u[2],l[0]),u[3]=Math.max(u[3],l[1])}function Pl(u,l){return!(u[0]<=l[0]||u[2]>=l[2]||u[1]<=l[1]||u[3]>=l[3])}function Wa(u,l,A){const p=u[0]-l[0],v=u[1]-l[1],E=u[0]-A[0],I=u[1]-A[1];return p*I-E*v==0&&p*E<=0&&v*I<=0}function Ko(u,l,A,p){return(v=[p[0]-A[0],p[1]-A[1]])[0]*(E=[l[0]-u[0],l[1]-u[1]])[1]-v[1]*E[0]!=0&&!(!uh(u,l,A,p)||!uh(A,p,u,l));var v,E}function Cd(u,l,A){for(const p of A)for(let v=0;v<p.length-1;++v)if(Ko(u,l,p[v],p[v+1]))return!0;return!1}function Zs(u,l){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=!1;for(const L of l)for(let O=0;O<L.length-1;O++){if(Wa(u,L[O],L[O+1]))return A;(E=L[O])[1]>(v=u)[1]!=(I=L[O+1])[1]>v[1]&&v[0]<(I[0]-E[0])*(v[1]-E[1])/(I[1]-E[1])+E[0]&&(p=!p)}var v,E,I;return p}function Wo(u,l){for(const A of l)if(Zs(u,A))return!0;return!1}function fu(u,l){for(const A of u)if(!Zs(A,l))return!1;for(let A=0;A<u.length-1;++A)if(Cd(u[A],u[A+1],l))return!1;return!0}function Cc(u,l){for(const A of l)if(fu(u,A))return!0;return!1}function uh(u,l,A,p){const v=p[0]-A[0],E=p[1]-A[1],I=(u[0]-A[0])*E-v*(u[1]-A[1]),L=(l[0]-A[0])*E-v*(l[1]-A[1]);return I>0&&L<0||I<0&&L>0}function Ml(u,l,A){const p=[];for(let v=0;v<u.length;v++){const E=[];for(let I=0;I<u[v].length;I++){const L=yn(u[v][I],A);Ll(l,L),E.push(L)}p.push(E)}return p}function Ah(u,l,A){const p=[];for(let v=0;v<u.length;v++){const E=Ml(u[v],l,A);p.push(E)}return p}function pu(u,l,A,p){if(u[0]<A[0]||u[0]>A[2]){const v=.5*p;let E=u[0]-A[0]>v?-p:A[0]-u[0]>v?p:0;E===0&&(E=u[0]-A[2]>v?-p:A[2]-u[0]>v?p:0),u[0]+=E}Ll(l,u)}function gu(u,l,A,p){const v=Math.pow(2,p.z)*Vi,E=[p.x*Vi,p.y*Vi],I=[];for(const L of u)for(const O of L){const H=[O.x+E[0],O.y+E[1]];pu(H,l,A,v),I.push(H)}return I}function cA(u,l,A,p){const v=Math.pow(2,p.z)*Vi,E=[p.x*Vi,p.y*Vi],I=[];for(const O of u){const H=[];for(const q of O){const $=[q.x+E[0],q.y+E[1]];Ll(l,$),H.push($)}I.push(H)}if(l[2]-l[0]<=v/2){(L=l)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const O of I)for(const H of O)pu(H,l,A,v)}var L;return I}class xo{constructor(l,A){this.type=je,this.geojson=l,this.geometries=A}static parse(l,A){if(l.length!==2)return A.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(os(l[1])){const p=l[1];if(p.type==="FeatureCollection"){const v=[];for(const E of p.features){const{type:I,coordinates:L}=E.geometry;I==="Polygon"&&v.push(L),I==="MultiPolygon"&&v.push(...L)}if(v.length)return new xo(p,{type:"MultiPolygon",coordinates:v})}else if(p.type==="Feature"){const v=p.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new xo(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new xo(p,p)}return A.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(A,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],I=A.canonicalID();if(p.type==="Polygon"){const L=Ml(p.coordinates,E,I),O=gu(A.geometry(),v,E,I);if(!Pl(v,E))return!1;for(const H of O)if(!Zs(H,L))return!1}if(p.type==="MultiPolygon"){const L=Ah(p.coordinates,E,I),O=gu(A.geometry(),v,E,I);if(!Pl(v,E))return!1;for(const H of O)if(!Wo(H,L))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(A,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],I=A.canonicalID();if(p.type==="Polygon"){const L=Ml(p.coordinates,E,I),O=cA(A.geometry(),v,E,I);if(!Pl(v,E))return!1;for(const H of O)if(!fu(H,L))return!1}if(p.type==="MultiPolygon"){const L=Ah(p.coordinates,E,I),O=cA(A.geometry(),v,E,I);if(!Pl(v,E))return!1;for(const H of O)if(!Cc(H,L))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let mu=class{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:uA;if(this.data=u,this.length=this.data.length,this.compare=l,this.length>0)for(let A=(this.length>>1)-1;A>=0;A--)this._down(A)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const u=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:l,compare:A}=this,p=l[u];for(;u>0;){const v=u-1>>1,E=l[v];if(A(p,E)>=0)break;l[u]=E,u=v}l[u]=p}_down(u){const{data:l,compare:A}=this,p=this.length>>1,v=l[u];for(;u<p;){let E=1+(u<<1),I=l[E];const L=E+1;if(L<this.length&&A(l[L],I)<0&&(E=L,I=l[L]),A(I,v)>=0)break;l[u]=I,u=E}l[u]=v}};function uA(u,l){return u<l?-1:u>l?1:0}function hh(u,l,A,p,v){dh(u,l,A,p||u.length-1,v||Ec)}function dh(u,l,A,p,v){for(;p>A;){if(p-A>600){var E=p-A+1,I=l-A+1,L=Math.log(E),O=.5*Math.exp(2*L/3),H=.5*Math.sqrt(L*O*(E-O)/E)*(I-E/2<0?-1:1);dh(u,l,Math.max(A,Math.floor(l-I*O/E+H)),Math.min(p,Math.floor(l+(E-I)*O/E+H)),v)}var q=u[l],$=A,Y=p;for(_a(u,A,l),v(u[p],q)>0&&_a(u,A,p);$<Y;){for(_a(u,$,Y),$++,Y--;v(u[$],q)<0;)$++;for(;v(u[Y],q)>0;)Y--}v(u[A],q)===0?_a(u,A,Y):_a(u,++Y,p),Y<=l&&(A=Y+1),l<=Y&&(p=Y-1)}}function _a(u,l,A){var p=u[l];u[l]=u[A],u[A]=p}function Ec(u,l){return u<l?-1:u>l?1:0}function Ul(u,l){if(u.length<=1)return[u];const A=[];let p,v;for(const E of u){const I=AA(E);I!==0&&(E.area=Math.abs(I),v===void 0&&(v=I<0),v===I<0?(p&&A.push(p),p=[E]):p.push(E))}if(p&&A.push(p),l>1)for(let E=0;E<A.length;E++)A[E].length<=l||(hh(A[E],l,1,A[E].length-1,Rl),A[E]=A[E].slice(0,l));return A}function Rl(u,l){return l.area-u.area}function AA(u){let l=0;for(let A,p,v=0,E=u.length,I=E-1;v<E;I=v++)A=u[v],p=u[I],l+=(p.x-A.x)*(A.y+p.y);return l}const D=1/298.257223563,nt=D*(2-D),Ut=Math.PI/180;class Vt{constructor(l){const A=6378.137*Ut*1e3,p=Math.cos(l*Ut),v=1/(1-nt*(1-p*p)),E=Math.sqrt(v);this.kx=A*E*p,this.ky=A*E*v*(1-nt)}distance(l,A){const p=this.wrap(l[0]-A[0])*this.kx,v=(l[1]-A[1])*this.ky;return Math.sqrt(p*p+v*v)}pointOnLine(l,A){let p,v,E,I,L=1/0;for(let O=0;O<l.length-1;O++){let H=l[O][0],q=l[O][1],$=this.wrap(l[O+1][0]-H)*this.kx,Y=(l[O+1][1]-q)*this.ky,ot=0;$===0&&Y===0||(ot=(this.wrap(A[0]-H)*this.kx*$+(A[1]-q)*this.ky*Y)/($*$+Y*Y),ot>1?(H=l[O+1][0],q=l[O+1][1]):ot>0&&(H+=$/this.kx*ot,q+=Y/this.ky*ot)),$=this.wrap(A[0]-H)*this.kx,Y=(A[1]-q)*this.ky;const ut=$*$+Y*Y;ut<L&&(L=ut,p=H,v=q,E=O,I=ot)}return{point:[p,v],index:E,t:Math.max(0,Math.min(1,I))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function se(u,l){return l[0]-u[0]}function me(u){return u[1]-u[0]+1}function Pe(u,l){return u[1]>=u[0]&&u[1]<l}function rr(u,l){if(u[0]>u[1])return[null,null];const A=me(u);if(l){if(A===2)return[u,null];const v=Math.floor(A/2);return[[u[0],u[0]+v],[u[0]+v,u[1]]]}if(A===1)return[u,null];const p=Math.floor(A/2)-1;return[[u[0],u[0]+p],[u[0]+p+1,u[1]]]}function Pr(u,l){if(!Pe(l,u.length))return[1/0,1/0,-1/0,-1/0];const A=[1/0,1/0,-1/0,-1/0];for(let p=l[0];p<=l[1];++p)Ll(A,u[p]);return A}function qr(u){const l=[1/0,1/0,-1/0,-1/0];for(const A of u)for(const p of A)Ll(l,p);return l}function Br(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function dn(u,l,A){if(!Br(u)||!Br(l))return NaN;let p=0,v=0;return u[2]<l[0]&&(p=l[0]-u[2]),u[0]>l[2]&&(p=u[0]-l[2]),u[1]>l[3]&&(v=u[1]-l[3]),u[3]<l[1]&&(v=l[1]-u[3]),A.distance([0,0],[p,v])}function gr(u,l,A){const p=A.pointOnLine(l,u);return A.distance(u,p.point)}function ri(u,l,A,p,v){const E=Math.min(gr(u,[A,p],v),gr(l,[A,p],v)),I=Math.min(gr(A,[u,l],v),gr(p,[u,l],v));return Math.min(E,I)}function Yr(u,l,A,p,v){if(!Pe(l,u.length)||!Pe(p,A.length))return 1/0;let E=1/0;for(let I=l[0];I<l[1];++I){const L=u[I],O=u[I+1];for(let H=p[0];H<p[1];++H){const q=A[H],$=A[H+1];if(Ko(L,O,q,$))return 0;E=Math.min(E,ri(L,O,q,$,v))}}return E}function en(u,l,A,p,v){if(!Pe(l,u.length)||!Pe(p,A.length))return NaN;let E=1/0;for(let I=l[0];I<=l[1];++I)for(let L=p[0];L<=p[1];++L)if(E=Math.min(E,v.distance(u[I],A[L])),E===0)return E;return E}function Bi(u,l,A){if(Zs(u,l,!0))return 0;let p=1/0;for(const v of l){const E=v[0],I=v[v.length-1];if(E!==I&&(p=Math.min(p,gr(u,[I,E],A)),p===0))return p;const L=A.pointOnLine(v,u);if(p=Math.min(p,A.distance(u,L.point)),p===0)return p}return p}function Bo(u,l,A,p){if(!Pe(l,u.length))return NaN;for(let E=l[0];E<=l[1];++E)if(Zs(u[E],A,!0))return 0;let v=1/0;for(let E=l[0];E<l[1];++E){const I=u[E],L=u[E+1];for(const O of A)for(let H=0,q=O.length,$=q-1;H<q;$=H++){const Y=O[$],ot=O[H];if(Ko(I,L,Y,ot))return 0;v=Math.min(v,ri(I,L,Y,ot,p))}}return v}function Ds(u,l){for(const A of u)for(const p of A)if(Zs(p,l,!0))return!0;return!1}function $a(u,l,A){let p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/0;const v=qr(u),E=qr(l);if(p!==1/0&&dn(v,E,A)>=p)return p;if(Pl(v,E)){if(Ds(u,l))return 0}else if(Ds(l,u))return 0;let I=1/0;for(const L of u)for(let O=0,H=L.length,q=H-1;O<H;q=O++){const $=L[q],Y=L[O];for(const ot of l)for(let ut=0,vt=ot.length,It=vt-1;ut<vt;It=ut++){const Dt=ot[It],te=ot[ut];if(Ko($,Y,Dt,te))return 0;I=Math.min(I,ri($,Y,Dt,te,A))}}return I}function hA(u,l,A,p,v,E){if(!E)return;const I=dn(Pr(p,E),v,A);I<l&&u.push([I,E,[0,0]])}function Ol(u,l,A,p,v,E,I){if(!E||!I)return;const L=dn(Pr(p,E),Pr(v,I),A);L<l&&u.push([L,E,I])}function Dl(u,l,A,p){let v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1/0,E=Math.min(p.distance(u[0],A[0][0]),v);if(E===0)return E;const I=new mu([[0,[0,u.length-1],[0,0]]],se),L=qr(A);for(;I.length>0;){const O=I.pop();if(O[0]>=E)continue;const H=O[1],q=l?50:100;if(me(H)<=q){if(!Pe(H,u.length))return NaN;if(l){const $=Bo(u,H,A,p);if(isNaN($)||$===0)return $;E=Math.min(E,$)}else for(let $=H[0];$<=H[1];++$){const Y=Bi(u[$],A,p);if(E=Math.min(E,Y),E===0)return 0}}else{const $=rr(H,l);hA(I,E,p,u,L,$[0]),hA(I,E,p,u,L,$[1])}}return E}function va(u,l,A,p,v){let E=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,I=Math.min(E,v.distance(u[0],A[0]));if(I===0)return I;const L=new mu([[0,[0,u.length-1],[0,A.length-1]]],se);for(;L.length>0;){const O=L.pop();if(O[0]>=I)continue;const H=O[1],q=O[2],$=l?50:100,Y=p?50:100;if(me(H)<=$&&me(q)<=Y){if(!Pe(H,u.length)&&Pe(q,A.length))return NaN;let ot;if(l&&p)ot=Yr(u,H,A,q,v),I=Math.min(I,ot);else if(l&&!p){const ut=u.slice(H[0],H[1]+1);for(let vt=q[0];vt<=q[1];++vt)if(ot=gr(A[vt],ut,v),I=Math.min(I,ot),I===0)return I}else if(!l&&p){const ut=A.slice(q[0],q[1]+1);for(let vt=H[0];vt<=H[1];++vt)if(ot=gr(u[vt],ut,v),I=Math.min(I,ot),I===0)return I}else ot=en(u,H,A,q,v),I=Math.min(I,ot)}else{const ot=rr(H,l),ut=rr(q,p);Ol(L,I,v,u,A,ot[0],ut[0]),Ol(L,I,v,u,A,ot[0],ut[1]),Ol(L,I,v,u,A,ot[1],ut[0]),Ol(L,I,v,u,A,ot[1],ut[1])}}return I}function Nl(u){return u.type==="MultiPolygon"?u.coordinates.map(l=>({type:"Polygon",coordinates:l})):u.type==="MultiLineString"?u.coordinates.map(l=>({type:"LineString",coordinates:l})):u.type==="MultiPoint"?u.coordinates.map(l=>({type:"Point",coordinates:l})):[u]}class Co{constructor(l,A){this.type=ge,this.geojson=l,this.geometries=A}static parse(l,A){if(l.length!==2)return A.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(os(l[1])){const p=l[1];if(p.type==="FeatureCollection")return new Co(p,p.features.map(v=>Nl(v.geometry)).flat());if(p.type==="Feature")return new Co(p,Nl(p.geometry));if("type"in p&&"coordinates"in p)return new Co(p,Nl(p))}return A.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(A,p){const v=A.geometry(),E=v.flat().map(O=>du([O.x,O.y],A.canonical));if(v.length===0)return NaN;const I=new Vt(E[0][1]);let L=1/0;for(const O of p){switch(O.type){case"Point":L=Math.min(L,va(E,!1,[O.coordinates],!1,I,L));break;case"LineString":L=Math.min(L,va(E,!1,O.coordinates,!0,I,L));break;case"Polygon":L=Math.min(L,Dl(E,!1,O.coordinates,I,L))}if(L===0)return L}return L}(l,this.geometries);if(l.geometryType()==="LineString")return function(A,p){const v=A.geometry(),E=v.flat().map(O=>du([O.x,O.y],A.canonical));if(v.length===0)return NaN;const I=new Vt(E[0][1]);let L=1/0;for(const O of p){switch(O.type){case"Point":L=Math.min(L,va(E,!0,[O.coordinates],!1,I,L));break;case"LineString":L=Math.min(L,va(E,!0,O.coordinates,!0,I,L));break;case"Polygon":L=Math.min(L,Dl(E,!0,O.coordinates,I,L))}if(L===0)return L}return L}(l,this.geometries);if(l.geometryType()==="Polygon")return function(A,p){const v=A.geometry();if(v.length===0||v[0].length===0)return NaN;const E=Ul(v,0).map(O=>O.map(H=>H.map(q=>du([q.x,q.y],A.canonical)))),I=new Vt(E[0][0][0][1]);let L=1/0;for(const O of p)for(const H of E){switch(O.type){case"Point":L=Math.min(L,Dl([O.coordinates],!1,H,I,L));break;case"LineString":L=Math.min(L,Dl(O.coordinates,!0,H,I,L));break;case"Polygon":L=Math.min(L,$a(H,O.coordinates,I,L))}if(L===0)return L}return L}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Eo={"==":uu,"!=":Au,">":xd,"<":ch,">=":lA,"<=":Bd,array:Mi,at:Il,boolean:Mi,case:kt,coalesce:lu,collator:ma,format:hu,image:qa,in:Fl,"index-of":dt,interpolate:Ir,"interpolate-hcl":Ir,"interpolate-lab":Ir,length:Ka,let:jo,literal:Cs,match:xt,number:Mi,"number-format":ya,object:Mi,slice:he,step:Ze,string:Mi,"to-boolean":ti,"to-color":ti,"to-number":ti,"to-string":ti,var:qo,within:xo,distance:Co};class Hn{constructor(l,A,p,v){this.name=l,this.type=A,this._evaluate=p,this.args=v}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,A){const p=l[0],v=Hn.definitions[p];if(!v)return A.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(v)?v[0]:v.type,I=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,L=I.filter(H=>{let[q]=H;return!Array.isArray(q)||q.length===l.length-1});let O=null;for(const[H,q]of L){O=new an(A.registry,ls,A.path,null,A.scope);const $=[];let Y=!1;for(let ot=1;ot<l.length;ot++){const ut=l[ot],vt=Array.isArray(H)?H[ot-1]:H.type,It=O.parse(ut,1+$.length,vt);if(!It){Y=!0;break}$.push(It)}if(!Y)if(Array.isArray(H)&&H.length!==$.length)O.error(`Expected ${H.length} arguments, but found ${$.length} instead.`);else{for(let ot=0;ot<$.length;ot++){const ut=Array.isArray(H)?H[ot]:H.type,vt=$[ot];O.concat(ot+1).checkSubtype(ut,vt.type)}if(O.errors.length===0)return new Hn(p,E,q,$)}}if(L.length===1)A.errors.push(...O.errors);else{const H=(L.length?L:I).map($=>{let[Y]=$;return ot=Y,Array.isArray(ot)?`(${ot.map(st).join(", ")})`:`(${st(ot.type)}...)`;var ot}).join(" | "),q=[];for(let $=1;$<l.length;$++){const Y=A.parse(l[$],1+q.length);if(!Y)return null;q.push(st(Y.type))}A.error(`Expected arguments of type ${H}, but found (${q.join(", ")}) instead.`)}return null}static register(l,A){Hn.definitions=A;for(const p in A)l[p]=Hn}}function Sc(u,l){let[A,p,v,E]=l;A=A.evaluate(u),p=p.evaluate(u),v=v.evaluate(u);const I=E?E.evaluate(u):1,L=Bc(A,p,v,I);if(L)throw new Ln(L);return new lr(A/255,p/255,v/255,I,!1)}function Tc(u,l){return u in l}function kl(u,l){const A=l[u];return A===void 0?null:A}function $o(u){return{type:u}}function ls(u){if(u instanceof qo)return ls(u.boundExpression);if(u instanceof Hn&&u.name==="error"||u instanceof ma||u instanceof xo||u instanceof Co)return!1;const l=u instanceof ti||u instanceof Mi;let A=!0;return u.eachChild(p=>{A=l?A&&ls(p):A&&p instanceof Cs}),!!A&&yu(u)&&Ic(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function yu(u){if(u instanceof Hn&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof xo||u instanceof Co)return!1;let l=!0;return u.eachChild(A=>{l&&!yu(A)&&(l=!1)}),l}function Xa(u){if(u instanceof Hn&&u.name==="feature-state")return!1;let l=!0;return u.eachChild(A=>{l&&!Xa(A)&&(l=!1)}),l}function Ic(u,l){if(u instanceof Hn&&l.indexOf(u.name)>=0)return!1;let A=!0;return u.eachChild(p=>{A&&!Ic(p,l)&&(A=!1)}),A}function to(u){return{result:"success",value:u}}function Xo(u){return{result:"error",value:u}}function Jo(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function fh(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Yo(u){return!!u.expression&&u.expression.interpolated}function $r(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function ys(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Zo(u){return u}function Ns(u,l){const A=l.type==="color",p=u.stops&&typeof u.stops[0][0]=="object",v=p||!(p||u.property!==void 0),E=u.type||(Yo(l)?"exponential":"interval");if(A||l.type==="padding"){const q=A?lr.parse:gn.parse;(u=or({},u)).stops&&(u.stops=u.stops.map($=>[$[0],q($[1])])),u.default=q(u.default?u.default:l.default)}if(u.colorSpace&&(I=u.colorSpace)!=="rgb"&&I!=="hcl"&&I!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var I;let L,O,H;if(E==="exponential")L=Hl;else if(E==="interval")L=So;else if(E==="categorical"){L=Ql,O=Object.create(null);for(const q of u.stops)O[q[0]]=q[1];H=typeof u.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);L=zl}if(p){const q={},$=[];for(let ut=0;ut<u.stops.length;ut++){const vt=u.stops[ut],It=vt[0].zoom;q[It]===void 0&&(q[It]={zoom:It,type:u.type,property:u.property,default:u.default,stops:[]},$.push(It)),q[It].stops.push([vt[0].value,vt[1]])}const Y=[];for(const ut of $)Y.push([q[ut].zoom,Ns(q[ut],l)]);const ot={name:"linear"};return{kind:"composite",interpolationType:ot,interpolationFactor:Ir.interpolationFactor.bind(void 0,ot),zoomStops:Y.map(ut=>ut[0]),evaluate:(ut,vt)=>{let{zoom:It}=ut;return Hl({stops:Y,base:u.base},l,It).evaluate(It,vt)}}}if(v){const q=E==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:q,interpolationFactor:Ir.interpolationFactor.bind(void 0,q),zoomStops:u.stops.map($=>$[0]),evaluate:$=>{let{zoom:Y}=$;return L(u,l,Y,O,H)}}}return{kind:"source",evaluate(q,$){const Y=$&&$.properties?$.properties[u.property]:void 0;return Y===void 0?ks(u.default,l.default):L(u,l,Y,O,H)}}}function ks(u,l,A){return u!==void 0?u:l!==void 0?l:A!==void 0?A:void 0}function Ql(u,l,A,p,v){return ks(typeof A===v?p[A]:void 0,u.default,l.default)}function So(u,l,A){if($r(A)!=="number")return ks(u.default,l.default);const p=u.stops.length;if(p===1||A<=u.stops[0][0])return u.stops[0][1];if(A>=u.stops[p-1][0])return u.stops[p-1][1];const v=Le(u.stops.map(E=>E[0]),A);return u.stops[v][1]}function Hl(u,l,A){const p=u.base!==void 0?u.base:1;if($r(A)!=="number")return ks(u.default,l.default);const v=u.stops.length;if(v===1||A<=u.stops[0][0])return u.stops[0][1];if(A>=u.stops[v-1][0])return u.stops[v-1][1];const E=Le(u.stops.map(q=>q[0]),A),I=function(q,$,Y,ot){const ut=ot-Y,vt=q-Y;return ut===0?0:$===1?vt/ut:(Math.pow($,vt)-1)/(Math.pow($,ut)-1)}(A,p,u.stops[E][0],u.stops[E+1][0]),L=u.stops[E][1],O=u.stops[E+1][1],H=zi[l.type]||Zo;return typeof L.evaluate=="function"?{evaluate(){for(var q=arguments.length,$=new Array(q),Y=0;Y<q;Y++)$[Y]=arguments[Y];const ot=L.evaluate.apply(void 0,$),ut=O.evaluate.apply(void 0,$);if(ot!==void 0&&ut!==void 0)return H(ot,ut,I,u.colorSpace)}}:H(L,O,I,u.colorSpace)}function zl(u,l,A){switch(l.type){case"color":A=lr.parse(A);break;case"formatted":A=jr.fromString(A.toString());break;case"resolvedImage":A=on.fromString(A.toString());break;case"padding":A=gn.parse(A);break;default:$r(A)===l.type||l.type==="enum"&&l.values[A]||(A=void 0)}return ks(A,u.default,l.default)}Hn.register(Eo,{error:[{kind:"error"},[yr],(u,l)=>{let[A]=l;throw new Ln(A.evaluate(u))}],typeof:[yr,[He],(u,l)=>{let[A]=l;return st(Qn(A.evaluate(u)))}],"to-rgba":[J(ge,4),[Rr],(u,l)=>{let[A]=l;const[p,v,E,I]=A.evaluate(u).rgb;return[255*p,255*v,255*E,I]}],rgb:[Rr,[ge,ge,ge],Sc],rgba:[Rr,[ge,ge,ge,ge],Sc],has:{type:je,overloads:[[[yr],(u,l)=>{let[A]=l;return Tc(A.evaluate(u),u.properties())}],[[yr,cn],(u,l)=>{let[A,p]=l;return Tc(A.evaluate(u),p.evaluate(u))}]]},get:{type:He,overloads:[[[yr],(u,l)=>{let[A]=l;return kl(A.evaluate(u),u.properties())}],[[yr,cn],(u,l)=>{let[A,p]=l;return kl(A.evaluate(u),p.evaluate(u))}]]},"feature-state":[He,[yr],(u,l)=>{let[A]=l;return kl(A.evaluate(u),u.featureState||{})}],properties:[cn,[],u=>u.properties()],"geometry-type":[yr,[],u=>u.geometryType()],id:[He,[],u=>u.id()],zoom:[ge,[],u=>u.globals.zoom],"heatmap-density":[ge,[],u=>u.globals.heatmapDensity||0],"line-progress":[ge,[],u=>u.globals.lineProgress||0],accumulated:[He,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[ge,$o(ge),(u,l)=>{let A=0;for(const p of l)A+=p.evaluate(u);return A}],"*":[ge,$o(ge),(u,l)=>{let A=1;for(const p of l)A*=p.evaluate(u);return A}],"-":{type:ge,overloads:[[[ge,ge],(u,l)=>{let[A,p]=l;return A.evaluate(u)-p.evaluate(u)}],[[ge],(u,l)=>{let[A]=l;return-A.evaluate(u)}]]},"/":[ge,[ge,ge],(u,l)=>{let[A,p]=l;return A.evaluate(u)/p.evaluate(u)}],"%":[ge,[ge,ge],(u,l)=>{let[A,p]=l;return A.evaluate(u)%p.evaluate(u)}],ln2:[ge,[],()=>Math.LN2],pi:[ge,[],()=>Math.PI],e:[ge,[],()=>Math.E],"^":[ge,[ge,ge],(u,l)=>{let[A,p]=l;return Math.pow(A.evaluate(u),p.evaluate(u))}],sqrt:[ge,[ge],(u,l)=>{let[A]=l;return Math.sqrt(A.evaluate(u))}],log10:[ge,[ge],(u,l)=>{let[A]=l;return Math.log(A.evaluate(u))/Math.LN10}],ln:[ge,[ge],(u,l)=>{let[A]=l;return Math.log(A.evaluate(u))}],log2:[ge,[ge],(u,l)=>{let[A]=l;return Math.log(A.evaluate(u))/Math.LN2}],sin:[ge,[ge],(u,l)=>{let[A]=l;return Math.sin(A.evaluate(u))}],cos:[ge,[ge],(u,l)=>{let[A]=l;return Math.cos(A.evaluate(u))}],tan:[ge,[ge],(u,l)=>{let[A]=l;return Math.tan(A.evaluate(u))}],asin:[ge,[ge],(u,l)=>{let[A]=l;return Math.asin(A.evaluate(u))}],acos:[ge,[ge],(u,l)=>{let[A]=l;return Math.acos(A.evaluate(u))}],atan:[ge,[ge],(u,l)=>{let[A]=l;return Math.atan(A.evaluate(u))}],min:[ge,$o(ge),(u,l)=>Math.min(...l.map(A=>A.evaluate(u)))],max:[ge,$o(ge),(u,l)=>Math.max(...l.map(A=>A.evaluate(u)))],abs:[ge,[ge],(u,l)=>{let[A]=l;return Math.abs(A.evaluate(u))}],round:[ge,[ge],(u,l)=>{let[A]=l;const p=A.evaluate(u);return p<0?-Math.round(-p):Math.round(p)}],floor:[ge,[ge],(u,l)=>{let[A]=l;return Math.floor(A.evaluate(u))}],ceil:[ge,[ge],(u,l)=>{let[A]=l;return Math.ceil(A.evaluate(u))}],"filter-==":[je,[yr,He],(u,l)=>{let[A,p]=l;return u.properties()[A.value]===p.value}],"filter-id-==":[je,[He],(u,l)=>{let[A]=l;return u.id()===A.value}],"filter-type-==":[je,[yr],(u,l)=>{let[A]=l;return u.geometryType()===A.value}],"filter-<":[je,[yr,He],(u,l)=>{let[A,p]=l;const v=u.properties()[A.value],E=p.value;return typeof v==typeof E&&v<E}],"filter-id-<":[je,[He],(u,l)=>{let[A]=l;const p=u.id(),v=A.value;return typeof p==typeof v&&p<v}],"filter->":[je,[yr,He],(u,l)=>{let[A,p]=l;const v=u.properties()[A.value],E=p.value;return typeof v==typeof E&&v>E}],"filter-id->":[je,[He],(u,l)=>{let[A]=l;const p=u.id(),v=A.value;return typeof p==typeof v&&p>v}],"filter-<=":[je,[yr,He],(u,l)=>{let[A,p]=l;const v=u.properties()[A.value],E=p.value;return typeof v==typeof E&&v<=E}],"filter-id-<=":[je,[He],(u,l)=>{let[A]=l;const p=u.id(),v=A.value;return typeof p==typeof v&&p<=v}],"filter->=":[je,[yr,He],(u,l)=>{let[A,p]=l;const v=u.properties()[A.value],E=p.value;return typeof v==typeof E&&v>=E}],"filter-id->=":[je,[He],(u,l)=>{let[A]=l;const p=u.id(),v=A.value;return typeof p==typeof v&&p>=v}],"filter-has":[je,[He],(u,l)=>{let[A]=l;return A.value in u.properties()}],"filter-has-id":[je,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[je,[J(yr)],(u,l)=>{let[A]=l;return A.value.indexOf(u.geometryType())>=0}],"filter-id-in":[je,[J(He)],(u,l)=>{let[A]=l;return A.value.indexOf(u.id())>=0}],"filter-in-small":[je,[yr,J(He)],(u,l)=>{let[A,p]=l;return p.value.indexOf(u.properties()[A.value])>=0}],"filter-in-large":[je,[yr,J(He)],(u,l)=>{let[A,p]=l;return function(v,E,I,L){for(;I<=L;){const O=I+L>>1;if(E[O]===v)return!0;E[O]>v?L=O-1:I=O+1}return!1}(u.properties()[A.value],p.value,0,p.value.length-1)}],all:{type:je,overloads:[[[je,je],(u,l)=>{let[A,p]=l;return A.evaluate(u)&&p.evaluate(u)}],[$o(je),(u,l)=>{for(const A of l)if(!A.evaluate(u))return!1;return!0}]]},any:{type:je,overloads:[[[je,je],(u,l)=>{let[A,p]=l;return A.evaluate(u)||p.evaluate(u)}],[$o(je),(u,l)=>{for(const A of l)if(A.evaluate(u))return!0;return!1}]]},"!":[je,[je],(u,l)=>{let[A]=l;return!A.evaluate(u)}],"is-supported-script":[je,[yr],(u,l)=>{let[A]=l;const p=u.globals&&u.globals.isSupportedScript;return!p||p(A.evaluate(u))}],upcase:[yr,[yr],(u,l)=>{let[A]=l;return A.evaluate(u).toUpperCase()}],downcase:[yr,[yr],(u,l)=>{let[A]=l;return A.evaluate(u).toLowerCase()}],concat:[yr,$o(He),(u,l)=>l.map(A=>un(A.evaluate(u))).join("")],"resolved-locale":[yr,[Kn],(u,l)=>{let[A]=l;return A.evaluate(u).resolvedLocale()}]});class ba{constructor(l,A){var p;this.expression=l,this._warningHistory={},this._evaluator=new wi,this._defaultValue=A?(p=A).type==="color"&&ys(p.default)?new lr(0,0,0,0):p.type==="color"?lr.parse(p.default)||null:p.type==="padding"?gn.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?mn.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=A&&A.type==="enum"?A.values:null}evaluateWithoutErrorHandling(l,A,p,v,E,I){return this._evaluator.globals=l,this._evaluator.feature=A,this._evaluator.featureState=p,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)}evaluate(l,A,p,v,E,I){this._evaluator.globals=l,this._evaluator.feature=A||null,this._evaluator.featureState=p||null,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=I||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new Ln(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function Qs(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Eo}function To(u,l){const A=new an(Eo,ls,[],l?function(v){const E={color:Rr,string:yr,number:ge,enum:yr,boolean:je,formatted:sn,padding:Jr,resolvedImage:Bt,variableAnchorOffsetCollection:Z};return v.type==="array"?J(E[v.value]||He,v.length):E[v.type]}(l):void 0),p=A.parse(u,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?to(new ba(p,l)):Xo(A.errors)}class Ja{constructor(l,A){this.kind=l,this._styleExpression=A,this.isStateDependent=l!=="constant"&&!Xa(A.expression)}evaluateWithoutErrorHandling(l,A,p,v,E,I){return this._styleExpression.evaluateWithoutErrorHandling(l,A,p,v,E,I)}evaluate(l,A,p,v,E,I){return this._styleExpression.evaluate(l,A,p,v,E,I)}}class Vl{constructor(l,A,p,v){this.kind=l,this.zoomStops=p,this._styleExpression=A,this.isStateDependent=l!=="camera"&&!Xa(A.expression),this.interpolationType=v}evaluateWithoutErrorHandling(l,A,p,v,E,I){return this._styleExpression.evaluateWithoutErrorHandling(l,A,p,v,E,I)}evaluate(l,A,p,v,E,I){return this._styleExpression.evaluate(l,A,p,v,E,I)}interpolationFactor(l,A,p){return this.interpolationType?Ir.interpolationFactor(this.interpolationType,l,A,p):0}}function ta(u,l){const A=To(u,l);if(A.result==="error")return A;const p=A.value.expression,v=yu(p);if(!v&&!Jo(l))return Xo([new xr("","data expressions not supported")]);const E=Ic(p,["zoom"]);if(!E&&!fh(l))return Xo([new xr("","zoom expressions not supported")]);const I=Ei(p);return I||E?I instanceof xr?Xo([I]):I instanceof Ir&&!Yo(l)?Xo([new xr("",'"interpolate" expressions cannot be used with this property')]):to(I?new Vl(v?"camera":"composite",A.value,I.labels,I instanceof Ir?I.interpolation:void 0):new Ja(v?"constant":"source",A.value)):Xo([new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Hs{constructor(l,A){this._parameters=l,this._specification=A,or(this,Ns(this._parameters,this._specification))}static deserialize(l){return new Hs(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function Ei(u){let l=null;if(u instanceof jo)l=Ei(u.result);else if(u instanceof lu){for(const A of u.args)if(l=Ei(A),l)break}else(u instanceof Ze||u instanceof Ir)&&u.input instanceof Hn&&u.input.name==="zoom"&&(l=u);return l instanceof xr||u.eachChild(A=>{const p=Ei(A);p instanceof xr?l=p:!l&&p?l=new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&p&&l!==p&&(l=new xr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function Gi(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const l of u.slice(1))if(!Gi(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const wa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function On(u){if(u==null)return{filter:()=>!0,needGeometry:!1};Gi(u)||(u=hi(u));const l=To(u,wa);if(l.result==="error")throw new Error(l.value.map(A=>`${A.key}: ${A.message}`).join(", "));return{filter:(A,p,v)=>l.value.evaluate(A,p,{},v),needGeometry:Jn(u)}}function Xn(u,l){return u<l?-1:u>l?1:0}function Jn(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let l=1;l<u.length;l++)if(Jn(u[l]))return!0;return!1}function hi(u){if(!u)return!0;const l=u[0];return u.length<=1?l!=="any":l==="=="?eo(u[1],u[2],"=="):l==="!="?Fc(eo(u[1],u[2],"==")):l==="<"||l===">"||l==="<="||l===">="?eo(u[1],u[2],l):l==="any"?(A=u.slice(1),["any"].concat(A.map(hi))):l==="all"?["all"].concat(u.slice(1).map(hi)):l==="none"?["all"].concat(u.slice(1).map(hi).map(Fc)):l==="in"?Ya(u[1],u.slice(2)):l==="!in"?Fc(Ya(u[1],u.slice(2))):l==="has"?Za(u[1]):l!=="!has"||Fc(Za(u[1]));var A}function eo(u,l,A){switch(u){case"$type":return[`filter-type-${A}`,l];case"$id":return[`filter-id-${A}`,l];default:return[`filter-${A}`,u,l]}}function Ya(u,l){if(l.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(A=>typeof A!=typeof l[0])?["filter-in-large",u,["literal",l.sort(Xn)]]:["filter-in-small",u,["literal",l]]}}function Za(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Fc(u){return["!",u]}function Gl(u){const l=typeof u;if(l==="number"||l==="boolean"||l==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let v="[";for(const E of u)v+=`${Gl(E)},`;return`${v}]`}const A=Object.keys(u).sort();let p="{";for(let v=0;v<A.length;v++)p+=`${JSON.stringify(A[v])}:${Gl(u[A[v]])},`;return`${p}}`}function _p(u){let l="";for(const A of pr)l+=`/${Gl(u[A])}`;return l}function dA(u){const l=u.value;return l?[new ye(u.key,l,"constants have been deprecated as of v8")]:[]}function li(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function xa(u){if(Array.isArray(u))return u.map(xa);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const l={};for(const A in u)l[A]=xa(u[A]);return l}return li(u)}function zs(u){const l=u.key,A=u.value,p=u.valueSpec||{},v=u.objectElementValidators||{},E=u.style,I=u.styleSpec,L=u.validateSpec;let O=[];const H=$r(A);if(H!=="object")return[new ye(l,A,`object expected, ${H} found`)];for(const q in A){const $=q.split(".")[0],Y=p[$]||p["*"];let ot;if(v[$])ot=v[$];else if(p[$])ot=L;else if(v["*"])ot=v["*"];else{if(!p["*"]){O.push(new ye(l,A[q],`unknown property "${q}"`));continue}ot=L}O=O.concat(ot({key:(l&&`${l}.`)+q,value:A[q],valueSpec:Y,style:E,styleSpec:I,object:A,objectKey:q,validateSpec:L},A))}for(const q in p)v[q]||p[q].required&&p[q].default===void 0&&A[q]===void 0&&O.push(new ye(l,A,`missing required property "${q}"`));return O}function _u(u){const l=u.value,A=u.valueSpec,p=u.style,v=u.styleSpec,E=u.key,I=u.arrayElementValidator||u.validateSpec;if($r(l)!=="array")return[new ye(E,l,`array expected, ${$r(l)} found`)];if(A.length&&l.length!==A.length)return[new ye(E,l,`array length ${A.length} expected, length ${l.length} found`)];if(A["min-length"]&&l.length<A["min-length"])return[new ye(E,l,`array length at least ${A["min-length"]} expected, length ${l.length} found`)];let L={type:A.value,values:A.values};v.$version<7&&(L.function=A.function),$r(A.value)==="object"&&(L=A.value);let O=[];for(let H=0;H<l.length;H++)O=O.concat(I({array:l,arrayIndex:H,value:l[H],valueSpec:L,validateSpec:u.validateSpec,style:p,styleSpec:v,key:`${E}[${H}]`}));return O}function vu(u){const l=u.key,A=u.value,p=u.valueSpec;let v=$r(A);return v==="number"&&A!=A&&(v="NaN"),v!=="number"?[new ye(l,A,`number expected, ${v} found`)]:"minimum"in p&&A<p.minimum?[new ye(l,A,`${A} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&A>p.maximum?[new ye(l,A,`${A} is greater than the maximum value ${p.maximum}`)]:[]}function _s(u){const l=u.valueSpec,A=li(u.value.type);let p,v,E,I={};const L=A!=="categorical"&&u.value.property===void 0,O=!L,H=$r(u.value.stops)==="array"&&$r(u.value.stops[0])==="array"&&$r(u.value.stops[0][0])==="object",q=zs({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(ot){if(A==="identity")return[new ye(ot.key,ot.value,'identity function may not have a "stops" property')];let ut=[];const vt=ot.value;return ut=ut.concat(_u({key:ot.key,value:vt,valueSpec:ot.valueSpec,validateSpec:ot.validateSpec,style:ot.style,styleSpec:ot.styleSpec,arrayElementValidator:$})),$r(vt)==="array"&&vt.length===0&&ut.push(new ye(ot.key,vt,"array must have at least one stop")),ut},default:function(ot){return ot.validateSpec({key:ot.key,value:ot.value,valueSpec:l,validateSpec:ot.validateSpec,style:ot.style,styleSpec:ot.styleSpec})}}});return A==="identity"&&L&&q.push(new ye(u.key,u.value,'missing required property "property"')),A==="identity"||u.value.stops||q.push(new ye(u.key,u.value,'missing required property "stops"')),A==="exponential"&&u.valueSpec.expression&&!Yo(u.valueSpec)&&q.push(new ye(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(O&&!Jo(u.valueSpec)?q.push(new ye(u.key,u.value,"property functions not supported")):L&&!fh(u.valueSpec)&&q.push(new ye(u.key,u.value,"zoom functions not supported"))),A!=="categorical"&&!H||u.value.property!==void 0||q.push(new ye(u.key,u.value,'"property" property is required')),q;function $(ot){let ut=[];const vt=ot.value,It=ot.key;if($r(vt)!=="array")return[new ye(It,vt,`array expected, ${$r(vt)} found`)];if(vt.length!==2)return[new ye(It,vt,`array length 2 expected, length ${vt.length} found`)];if(H){if($r(vt[0])!=="object")return[new ye(It,vt,`object expected, ${$r(vt[0])} found`)];if(vt[0].zoom===void 0)return[new ye(It,vt,"object stop key must have zoom")];if(vt[0].value===void 0)return[new ye(It,vt,"object stop key must have value")];if(E&&E>li(vt[0].zoom))return[new ye(It,vt[0].zoom,"stop zoom values must appear in ascending order")];li(vt[0].zoom)!==E&&(E=li(vt[0].zoom),v=void 0,I={}),ut=ut.concat(zs({key:`${It}[0]`,value:vt[0],valueSpec:{zoom:{}},validateSpec:ot.validateSpec,style:ot.style,styleSpec:ot.styleSpec,objectElementValidators:{zoom:vu,value:Y}}))}else ut=ut.concat(Y({key:`${It}[0]`,value:vt[0],valueSpec:{},validateSpec:ot.validateSpec,style:ot.style,styleSpec:ot.styleSpec},vt));return Qs(xa(vt[1]))?ut.concat([new ye(`${It}[1]`,vt[1],"expressions are not allowed in function stops.")]):ut.concat(ot.validateSpec({key:`${It}[1]`,value:vt[1],valueSpec:l,validateSpec:ot.validateSpec,style:ot.style,styleSpec:ot.styleSpec}))}function Y(ot,ut){const vt=$r(ot.value),It=li(ot.value),Dt=ot.value!==null?ot.value:ut;if(p){if(vt!==p)return[new ye(ot.key,Dt,`${vt} stop domain type must match previous stop domain type ${p}`)]}else p=vt;if(vt!=="number"&&vt!=="string"&&vt!=="boolean")return[new ye(ot.key,Dt,"stop domain value must be a number, string, or boolean")];if(vt!=="number"&&A!=="categorical"){let te=`number expected, ${vt} found`;return Jo(l)&&A===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ye(ot.key,Dt,te)]}return A!=="categorical"||vt!=="number"||isFinite(It)&&Math.floor(It)===It?A!=="categorical"&&vt==="number"&&v!==void 0&&It<v?[new ye(ot.key,Dt,"stop domain values must appear in ascending order")]:(v=It,A==="categorical"&&It in I?[new ye(ot.key,Dt,"stop domain values must be unique")]:(I[It]=!0,[])):[new ye(ot.key,Dt,`integer expected, found ${It}`)]}}function Si(u){const l=(u.expressionContext==="property"?ta:To)(xa(u.value),u.valueSpec);if(l.result==="error")return l.value.map(p=>new ye(`${u.key}${p.key}`,u.value,p.message));const A=l.value.expression||l.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!A.outputDefined())return[new ye(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!Xa(A))return[new ye(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!Xa(A))return[new ye(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Ic(A,["zoom","feature-state"]))return[new ye(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!yu(A))return[new ye(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tl(u){const l=u.key,A=u.value,p=u.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(li(A))===-1&&v.push(new ye(l,A,`expected one of [${p.values.join(", ")}], ${JSON.stringify(A)} found`)):Object.keys(p.values).indexOf(li(A))===-1&&v.push(new ye(l,A,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(A)} found`)),v}function Lc(u){return Gi(xa(u.value))?Si(or({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ph(u)}function ph(u){const l=u.value,A=u.key;if($r(l)!=="array")return[new ye(A,l,`array expected, ${$r(l)} found`)];const p=u.styleSpec;let v,E=[];if(l.length<1)return[new ye(A,l,"filter array must have at least 1 element")];switch(E=E.concat(tl({key:`${A}[0]`,value:l[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),li(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&li(l[1])==="$type"&&E.push(new ye(A,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&E.push(new ye(A,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(v=$r(l[1]),v!=="string"&&E.push(new ye(`${A}[1]`,l[1],`string expected, ${v} found`)));for(let I=2;I<l.length;I++)v=$r(l[I]),li(l[1])==="$type"?E=E.concat(tl({key:`${A}[${I}]`,value:l[I],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&E.push(new ye(`${A}[${I}]`,l[I],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let I=1;I<l.length;I++)E=E.concat(ph({key:`${A}[${I}]`,value:l[I],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":v=$r(l[1]),l.length!==2?E.push(new ye(A,l,`filter array for "${l[0]}" operator must have 2 elements`)):v!=="string"&&E.push(new ye(`${A}[1]`,l[1],`string expected, ${v} found`))}return E}function bu(u,l){const A=u.key,p=u.validateSpec,v=u.style,E=u.styleSpec,I=u.value,L=u.objectKey,O=E[`${l}_${u.layerType}`];if(!O)return[];const H=L.match(/^(.*)-transition$/);if(l==="paint"&&H&&O[H[1]]&&O[H[1]].transition)return p({key:A,value:I,valueSpec:E.transition,style:v,styleSpec:E});const q=u.valueSpec||O[L];if(!q)return[new ye(A,I,`unknown property "${L}"`)];let $;if($r(I)==="string"&&Jo(q)&&!q.tokens&&($=/^{([^}]+)}$/.exec(I)))return[new ye(A,I,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify($[1])} }\`.`)];const Y=[];return u.layerType==="symbol"&&(L==="text-field"&&v&&!v.glyphs&&Y.push(new ye(A,I,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&ys(xa(I))&&li(I.type)==="identity"&&Y.push(new ye(A,I,'"text-font" does not support identity functions'))),Y.concat(p({key:u.key,value:I,valueSpec:q,style:v,styleSpec:E,expressionContext:"property",propertyType:l,propertyKey:L}))}function Pc(u){return bu(u,"paint")}function fA(u){return bu(u,"layout")}function Ed(u){let l=[];const A=u.value,p=u.key,v=u.style,E=u.styleSpec;A.type||A.ref||l.push(new ye(p,A,'either "type" or "ref" is required'));let I=li(A.type);const L=li(A.ref);if(A.id){const O=li(A.id);for(let H=0;H<u.arrayIndex;H++){const q=v.layers[H];li(q.id)===O&&l.push(new ye(p,A.id,`duplicate layer id "${A.id}", previously used at line ${q.id.__line__}`))}}if("ref"in A){let O;["type","source","source-layer","filter","layout"].forEach(H=>{H in A&&l.push(new ye(p,A[H],`"${H}" is prohibited for ref layers`))}),v.layers.forEach(H=>{li(H.id)===L&&(O=H)}),O?O.ref?l.push(new ye(p,A.ref,"ref cannot reference another ref layer")):I=li(O.type):l.push(new ye(p,A.ref,`ref layer "${L}" not found`))}else if(I!=="background")if(A.source){const O=v.sources&&v.sources[A.source],H=O&&li(O.type);O?H==="vector"&&I==="raster"?l.push(new ye(p,A.source,`layer "${A.id}" requires a raster source`)):H!=="raster-dem"&&I==="hillshade"?l.push(new ye(p,A.source,`layer "${A.id}" requires a raster-dem source`)):H==="raster"&&I!=="raster"?l.push(new ye(p,A.source,`layer "${A.id}" requires a vector source`)):H!=="vector"||A["source-layer"]?H==="raster-dem"&&I!=="hillshade"?l.push(new ye(p,A.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!A.paint||!A.paint["line-gradient"]||H==="geojson"&&O.lineMetrics||l.push(new ye(p,A,`layer "${A.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new ye(p,A,`layer "${A.id}" must specify a "source-layer"`)):l.push(new ye(p,A.source,`source "${A.source}" not found`))}else l.push(new ye(p,A,'missing required property "source"'));return l=l.concat(zs({key:p,value:A,valueSpec:E.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:A.type,valueSpec:E.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:A,objectKey:"type"}),filter:Lc,layout:O=>zs({layer:A,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*":H=>fA(or({layerType:I},H))}}),paint:O=>zs({layer:A,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*":H=>Pc(or({layerType:I},H))}})}})),l}function Ba(u){const l=u.value,A=u.key,p=$r(l);return p!=="string"?[new ye(A,l,`string expected, ${p} found`)]:[]}const gh={promoteId:function(u){let{key:l,value:A}=u;if($r(A)==="string")return Ba({key:l,value:A});{const p=[];for(const v in A)p.push(...Ba({key:`${l}.${v}`,value:A[v]}));return p}}};function wu(u){const l=u.value,A=u.key,p=u.styleSpec,v=u.style,E=u.validateSpec;if(!l.type)return[new ye(A,l,'"type" is required')];const I=li(l.type);let L;switch(I){case"vector":case"raster":return L=zs({key:A,value:l,valueSpec:p[`source_${I.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:gh,validateSpec:E}),L;case"raster-dem":return L=function(O){var H;const q=(H=O.sourceName)!==null&&H!==void 0?H:"",$=O.value,Y=O.styleSpec,ot=Y.source_raster_dem,ut=O.style;let vt=[];const It=$r($);if($===void 0)return vt;if(It!=="object")return vt.push(new ye("source_raster_dem",$,`object expected, ${It} found`)),vt;const Dt=li($.encoding)==="custom",te=["redFactor","greenFactor","blueFactor","baseShift"],Qt=O.value.encoding?`"${O.value.encoding}"`:"Default";for(const Kt in $)!Dt&&te.includes(Kt)?vt.push(new ye(Kt,$[Kt],`In "${q}": "${Kt}" is only valid when "encoding" is set to "custom". ${Qt} encoding found`)):ot[Kt]?vt=vt.concat(O.validateSpec({key:Kt,value:$[Kt],valueSpec:ot[Kt],validateSpec:O.validateSpec,style:ut,styleSpec:Y})):vt.push(new ye(Kt,$[Kt],`unknown property "${Kt}"`));return vt}({sourceName:A,value:l,style:u.style,styleSpec:p,validateSpec:E}),L;case"geojson":if(L=zs({key:A,value:l,valueSpec:p.source_geojson,style:v,styleSpec:p,validateSpec:E,objectElementValidators:gh}),l.cluster)for(const O in l.clusterProperties){const[H,q]=l.clusterProperties[O],$=typeof H=="string"?[H,["accumulated"],["get",O]]:H;L.push(...Si({key:`${A}.${O}.map`,value:q,validateSpec:E,expressionContext:"cluster-map"})),L.push(...Si({key:`${A}.${O}.reduce`,value:$,validateSpec:E,expressionContext:"cluster-reduce"}))}return L;case"video":return zs({key:A,value:l,valueSpec:p.source_video,style:v,validateSpec:E,styleSpec:p});case"image":return zs({key:A,value:l,valueSpec:p.source_image,style:v,validateSpec:E,styleSpec:p});case"canvas":return[new ye(A,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tl({key:`${A}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:E,styleSpec:p})}}function pA(u){const l=u.value,A=u.styleSpec,p=A.light,v=u.style;let E=[];const I=$r(l);if(l===void 0)return E;if(I!=="object")return E=E.concat([new ye("light",l,`object expected, ${I} found`)]),E;for(const L in l){const O=L.match(/^(.*)-transition$/);E=E.concat(O&&p[O[1]]&&p[O[1]].transition?u.validateSpec({key:L,value:l[L],valueSpec:A.transition,validateSpec:u.validateSpec,style:v,styleSpec:A}):p[L]?u.validateSpec({key:L,value:l[L],valueSpec:p[L],validateSpec:u.validateSpec,style:v,styleSpec:A}):[new ye(L,l[L],`unknown property "${L}"`)])}return E}function Sd(u){const l=u.value,A=u.styleSpec,p=A.sky,v=u.style,E=$r(l);if(l===void 0)return[];if(E!=="object")return[new ye("sky",l,`object expected, ${E} found`)];let I=[];for(const L in l)I=I.concat(p[L]?u.validateSpec({key:L,value:l[L],valueSpec:p[L],style:v,styleSpec:A}):[new ye(L,l[L],`unknown property "${L}"`)]);return I}function vp(u){const l=u.value,A=u.styleSpec,p=A.terrain,v=u.style;let E=[];const I=$r(l);if(l===void 0)return E;if(I!=="object")return E=E.concat([new ye("terrain",l,`object expected, ${I} found`)]),E;for(const L in l)E=E.concat(p[L]?u.validateSpec({key:L,value:l[L],valueSpec:p[L],validateSpec:u.validateSpec,style:v,styleSpec:A}):[new ye(L,l[L],`unknown property "${L}"`)]);return E}function Td(u){let l=[];const A=u.value,p=u.key;if(Array.isArray(A)){const v=[],E=[];for(const I in A)A[I].id&&v.includes(A[I].id)&&l.push(new ye(p,A,`all the sprites' ids must be unique, but ${A[I].id} is duplicated`)),v.push(A[I].id),A[I].url&&E.includes(A[I].url)&&l.push(new ye(p,A,`all the sprites' URLs must be unique, but ${A[I].url} is duplicated`)),E.push(A[I].url),l=l.concat(zs({key:`${p}[${I}]`,value:A[I],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return l}return Ba({key:p,value:A})}const Id={"*":()=>[],array:_u,boolean:function(u){const l=u.value,A=u.key,p=$r(l);return p!=="boolean"?[new ye(A,l,`boolean expected, ${p} found`)]:[]},number:vu,color:function(u){const l=u.key,A=u.value,p=$r(A);return p!=="string"?[new ye(l,A,`color expected, ${p} found`)]:lr.parse(String(A))?[]:[new ye(l,A,`color expected, "${A}" found`)]},constants:dA,enum:tl,filter:Lc,function:_s,layer:Ed,object:zs,source:wu,light:pA,sky:Sd,terrain:vp,string:Ba,formatted:function(u){return Ba(u).length===0?[]:Si(u)},resolvedImage:function(u){return Ba(u).length===0?[]:Si(u)},padding:function(u){const l=u.key,A=u.value;if($r(A)==="array"){if(A.length<1||A.length>4)return[new ye(l,A,`padding requires 1 to 4 values; ${A.length} values found`)];const p={type:"number"};let v=[];for(let E=0;E<A.length;E++)v=v.concat(u.validateSpec({key:`${l}[${E}]`,value:A[E],validateSpec:u.validateSpec,valueSpec:p}));return v}return vu({key:l,value:A,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const l=u.key,A=u.value,p=$r(A),v=u.styleSpec;if(p!=="array"||A.length<1||A.length%2!=0)return[new ye(l,A,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let I=0;I<A.length;I+=2)E=E.concat(tl({key:`${l}[${I}]`,value:A[I],valueSpec:v.layout_symbol["text-anchor"]})),E=E.concat(_u({key:`${l}[${I+1}]`,value:A[I+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:v}));return E},sprite:Td};function xu(u){const l=u.value,A=u.valueSpec,p=u.styleSpec;return u.validateSpec=xu,A.expression&&ys(li(l))?_s(u):A.expression&&Qs(xa(l))?Si(u):A.type&&Id[A.type]?Id[A.type](u):zs(or({},u,{valueSpec:A.type?p[A.type]:A}))}function Fd(u){const l=u.value,A=u.key,p=Ba(u);return p.length||(l.indexOf("{fontstack}")===-1&&p.push(new ye(A,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&p.push(new ye(A,l,'"glyphs" url must include a "{range}" token'))),p}function Io(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:lt,A=[];return A=A.concat(xu({key:"",value:u,valueSpec:l.$root,styleSpec:l,style:u,validateSpec:xu,objectElementValidators:{glyphs:Fd,"*":()=>[]}})),u.constants&&(A=A.concat(dA({key:"constants",value:u.constants,style:u,styleSpec:l,validateSpec:xu}))),mh(A)}function ro(u){return function(l){return u({...l,validateSpec:xu})}}function mh(u){return[].concat(u).sort((l,A)=>l.line-A.line)}function Vs(u){return function(){for(var l=arguments.length,A=new Array(l),p=0;p<l;p++)A[p]=arguments[p];return mh(u.apply(this,A))}}Io.source=Vs(ro(wu)),Io.sprite=Vs(ro(Td)),Io.glyphs=Vs(ro(Fd)),Io.light=Vs(ro(pA)),Io.sky=Vs(ro(Sd)),Io.terrain=Vs(ro(vp)),Io.layer=Vs(ro(Ed)),Io.filter=Vs(ro(Lc)),Io.paintProperty=Vs(ro(Pc)),Io.layoutProperty=Vs(ro(fA));const el=Io,Qm=el.light,bp=el.paintProperty,Ld=el.layoutProperty;function Pd(u,l){let A=!1;if(l&&l.length)for(const p of l)u.fire(new ke(new Error(p.message))),A=!0;return A}class gA{constructor(l,A,p){const v=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const I=new Int32Array(this.arrayBuffer);l=I[0],this.d=(A=I[1])+2*(p=I[2]);for(let O=0;O<this.d*this.d;O++){const H=I[3+O],q=I[3+O+1];v.push(H===q?null:I.subarray(H,q))}const L=I[3+v.length+1];this.keys=I.subarray(I[3+v.length],L),this.bboxes=I.subarray(L),this.insert=this._insertReadonly}else{this.d=A+2*p;for(let I=0;I<this.d*this.d;I++)v.push([]);this.keys=[],this.bboxes=[]}this.n=A,this.extent=l,this.padding=p,this.scale=A/l,this.uid=0;const E=p/A*l;this.min=-E,this.max=l+E}insert(l,A,p,v,E){this._forEachCell(A,p,v,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(A),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,A,p,v,E,I){this.cells[E].push(I)}query(l,A,p,v,E){const I=this.min,L=this.max;if(l<=I&&A<=I&&L<=p&&L<=v&&!E)return Array.prototype.slice.call(this.keys);{const O=[];return this._forEachCell(l,A,p,v,this._queryCell,O,{},E),O}}_queryCell(l,A,p,v,E,I,L,O){const H=this.cells[E];if(H!==null){const q=this.keys,$=this.bboxes;for(let Y=0;Y<H.length;Y++){const ot=H[Y];if(L[ot]===void 0){const ut=4*ot;(O?O($[ut+0],$[ut+1],$[ut+2],$[ut+3]):l<=$[ut+2]&&A<=$[ut+3]&&p>=$[ut+0]&&v>=$[ut+1])?(L[ot]=!0,I.push(q[ot])):L[ot]=!1}}}}_forEachCell(l,A,p,v,E,I,L,O){const H=this._convertToCellCoord(l),q=this._convertToCellCoord(A),$=this._convertToCellCoord(p),Y=this._convertToCellCoord(v);for(let ot=H;ot<=$;ot++)for(let ut=q;ut<=Y;ut++){const vt=this.d*ut+ot;if((!O||O(this._convertFromCellCoord(ot),this._convertFromCellCoord(ut),this._convertFromCellCoord(ot+1),this._convertFromCellCoord(ut+1)))&&E.call(this,l,A,p,v,vt,I,L,O))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,A=3+this.cells.length+1+1;let p=0;for(let I=0;I<this.cells.length;I++)p+=this.cells[I].length;const v=new Int32Array(A+p+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let E=A;for(let I=0;I<l.length;I++){const L=l[I];v[3+I]=E,v.set(L,E),E+=L.length}return v[3+l.length]=E,v.set(this.keys,E),E+=this.keys.length,v[3+l.length+1]=E,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer}static serialize(l,A){const p=l.toArrayBuffer();return A&&A.push(p),{buffer:p}}static deserialize(l){return new gA(l.buffer)}}const jl={};function tr(u,l){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(jl[u])throw new Error(`${u} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:u,writeable:!1}),jl[u]={klass:l,omit:A.omit||[],shallow:A.shallow||[]}}tr("Object",Object),tr("TransferableGridIndex",gA),tr("Color",lr),tr("Error",Error),tr("AJAXError",Gt),tr("ResolvedImage",on),tr("StylePropertyFunction",Hs),tr("StyleExpression",ba,{omit:["_evaluator"]}),tr("ZoomDependentExpression",Vl),tr("ZoomConstantExpression",Ja),tr("CompoundExpression",Hn,{omit:["_evaluate"]});for(const u in Eo)Eo[u]._classRegistryKey||tr(`Expression_${u}`,Eo[u]);function rl(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Es(u,l){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(rl(u)||ee(u))return l&&l.push(u),u;if(ArrayBuffer.isView(u)){const A=u;return l&&l.push(A.buffer),A}if(u instanceof ImageData)return l&&l.push(u.data.buffer),u;if(Array.isArray(u)){const A=[];for(const p of u)A.push(Es(p,l));return A}if(typeof u=="object"){const A=u.constructor,p=A._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${A.name}`);if(!jl[p])throw new Error(`${p} is not registered.`);const v=A.serialize?A.serialize(u,l):{};if(A.serialize){if(l&&v===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in u){if(!u.hasOwnProperty(E)||jl[p].omit.indexOf(E)>=0)continue;const I=u[E];v[E]=jl[p].shallow.indexOf(E)>=0?I:Es(I,l)}u instanceof Error&&(v.message=u.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(v.$name=p),v}throw new Error("can't serialize object of type "+typeof u)}function ji(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||rl(u)||ee(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(ji);if(typeof u=="object"){const l=u.$name||"Object";if(!jl[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:A}=jl[l];if(!A)throw new Error(`can't deserialize unregistered class ${l}`);if(A.deserialize)return A.deserialize(u);const p=Object.create(A.prototype);for(const v of Object.keys(u)){if(v==="$name")continue;const E=u[v];p[v]=jl[l].shallow.indexOf(v)>=0?E:ji(E)}return p}throw new Error("can't deserialize object of type "+typeof u)}class wp{constructor(){this.first=!0}update(l,A){const p=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=A):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=A),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=p,!0))}}const Ke={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Ca(u){for(const l of u)if(Md(l.charCodeAt(0)))return!0;return!1}function Fo(u){for(const l of u)if(!xp(l.charCodeAt(0)))return!1;return!0}function xp(u){return!(Ke.Arabic(u)||Ke["Arabic Supplement"](u)||Ke["Arabic Extended-A"](u)||Ke["Arabic Presentation Forms-A"](u)||Ke["Arabic Presentation Forms-B"](u))}function Md(u){return!(u!==746&&u!==747&&(u<4352||!(Ke["Bopomofo Extended"](u)||Ke.Bopomofo(u)||Ke["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Ke["CJK Compatibility Ideographs"](u)||Ke["CJK Compatibility"](u)||Ke["CJK Radicals Supplement"](u)||Ke["CJK Strokes"](u)||!(!Ke["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Ke["CJK Unified Ideographs Extension A"](u)||Ke["CJK Unified Ideographs"](u)||Ke["Enclosed CJK Letters and Months"](u)||Ke["Hangul Compatibility Jamo"](u)||Ke["Hangul Jamo Extended-A"](u)||Ke["Hangul Jamo Extended-B"](u)||Ke["Hangul Jamo"](u)||Ke["Hangul Syllables"](u)||Ke.Hiragana(u)||Ke["Ideographic Description Characters"](u)||Ke.Kanbun(u)||Ke["Kangxi Radicals"](u)||Ke["Katakana Phonetic Extensions"](u)||Ke.Katakana(u)&&u!==12540||!(!Ke["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Ke["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Ke["Unified Canadian Aboriginal Syllabics"](u)||Ke["Unified Canadian Aboriginal Syllabics Extended"](u)||Ke["Vertical Forms"](u)||Ke["Yijing Hexagram Symbols"](u)||Ke["Yi Syllables"](u)||Ke["Yi Radicals"](u))))}function Ud(u){return!(Md(u)||function(l){return!!(Ke["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Ke["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Ke["Letterlike Symbols"](l)||Ke["Number Forms"](l)||Ke["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Ke["Control Pictures"](l)&&l!==9251||Ke["Optical Character Recognition"](l)||Ke["Enclosed Alphanumerics"](l)||Ke["Geometric Shapes"](l)||Ke["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Ke["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Ke["CJK Symbols and Punctuation"](l)||Ke.Katakana(l)||Ke["Private Use Area"](l)||Ke["CJK Compatibility Forms"](l)||Ke["Small Form Variants"](l)||Ke["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(u))}function nl(u){return u>=1424&&u<=2303||Ke["Arabic Presentation Forms-A"](u)||Ke["Arabic Presentation Forms-B"](u)}function Rd(u,l){return!(!l&&nl(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Ke.Khmer(u))}function yh(u){for(const l of u)if(nl(l.charCodeAt(0)))return!0;return!1}const ql=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class En{constructor(l,A){this.zoom=l,A?(this.now=A.now,this.fadeDuration=A.fadeDuration,this.zoomHistory=A.zoomHistory,this.transition=A.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wp,this.transition={})}isSupportedScript(l){return function(A,p){for(const v of A)if(!Rd(v.charCodeAt(0),p))return!1;return!0}(l,ql.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,A=l-Math.floor(l),p=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:A+(1-A)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*A}}}class Mc{constructor(l,A){this.property=l,this.value=A,this.expression=function(p,v){if(ys(p))return new Hs(p,v);if(Qs(p)){const E=ta(p,v);if(E.result==="error")throw new Error(E.value.map(I=>`${I.key}: ${I.message}`).join(", "));return E.value}{let E=p;return v.type==="color"&&typeof p=="string"?E=lr.parse(p):v.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(E=mn.parse(p)):E=gn.parse(p),{kind:"constant",evaluate:()=>E}}}(A===void 0?l.specification.default:A,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,A,p){return this.property.possiblyEvaluate(this,l,A,p)}}class Ea{constructor(l){this.property=l,this.value=new Mc(l,void 0)}transitioned(l,A){return new Od(this.property,this.value,A,mt({},l.transition,this.transition),l.now)}untransitioned(){return new Od(this.property,this.value,null,{},0)}}class Kl{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return at(this._values[l].value.value)}setValue(l,A){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Ea(this._values[l].property)),this._values[l].value=new Mc(this._values[l].property,A===null?void 0:at(A))}getTransition(l){return at(this._values[l].transition)}setTransition(l,A){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Ea(this._values[l].property)),this._values[l].transition=at(A)||void 0}serialize(){const l={};for(const A of Object.keys(this._values)){const p=this.getValue(A);p!==void 0&&(l[A]=p);const v=this.getTransition(A);v!==void 0&&(l[`${A}-transition`]=v)}return l}transitioned(l,A){const p=new Dd(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].transitioned(l,A._values[v]);return p}untransitioned(){const l=new Dd(this._properties);for(const A of Object.keys(this._values))l._values[A]=this._values[A].untransitioned();return l}}class Od{constructor(l,A,p,v,E){this.property=l,this.value=A,this.begin=E+v.delay||0,this.end=this.begin+v.duration||0,l.specification.transition&&(v.delay||v.duration)&&(this.prior=p)}possiblyEvaluate(l,A,p){const v=l.now||0,E=this.value.possiblyEvaluate(l,A,p),I=this.prior;if(I){if(v>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(v<this.begin)return I.possiblyEvaluate(l,A,p);{const L=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(l,A,p),E,function(O){if(O<=0)return 0;if(O>=1)return 1;const H=O*O,q=H*O;return 4*(O<.5?q:3*(O-H)+q-.75)}(L))}}return E}}class Dd{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,A,p){const v=new _h(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(l,A,p);return v}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Bu{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return at(this._values[l].value)}setValue(l,A){this._values[l]=new Mc(this._values[l].property,A===null?void 0:at(A))}serialize(){const l={};for(const A of Object.keys(this._values)){const p=this.getValue(A);p!==void 0&&(l[A]=p)}return l}possiblyEvaluate(l,A,p){const v=new _h(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(l,A,p);return v}}class Sa{constructor(l,A,p){this.property=l,this.value=A,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,A,p,v){return this.property.evaluate(this.value,this.parameters,l,A,p,v)}}class _h{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class dr{constructor(l){this.specification=l}possiblyEvaluate(l,A){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(A)}interpolate(l,A,p){const v=zi[this.specification.type];return v?v(l,A,p):l}}class Fr{constructor(l,A){this.specification=l,this.overrides=A}possiblyEvaluate(l,A,p,v){return new Sa(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(A,null,{},p,v)}:l.expression,A)}interpolate(l,A,p){if(l.value.kind!=="constant"||A.value.kind!=="constant")return l;if(l.value.value===void 0||A.value.value===void 0)return new Sa(this,{kind:"constant",value:void 0},l.parameters);const v=zi[this.specification.type];if(v){const E=v(l.value.value,A.value.value,p);return new Sa(this,{kind:"constant",value:E},l.parameters)}return l}evaluate(l,A,p,v,E,I){return l.kind==="constant"?l.value:l.evaluate(A,p,v,E,I)}}class C extends Fr{possiblyEvaluate(l,A,p,v){if(l.value===void 0)return new Sa(this,{kind:"constant",value:void 0},A);if(l.expression.kind==="constant"){const E=l.expression.evaluate(A,null,{},p,v),I=l.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,L=this._calculate(I,I,I,A);return new Sa(this,{kind:"constant",value:L},A)}if(l.expression.kind==="camera"){const E=this._calculate(l.expression.evaluate({zoom:A.zoom-1}),l.expression.evaluate({zoom:A.zoom}),l.expression.evaluate({zoom:A.zoom+1}),A);return new Sa(this,{kind:"constant",value:E},A)}return new Sa(this,l.expression,A)}evaluate(l,A,p,v,E,I){if(l.kind==="source"){const L=l.evaluate(A,p,v,E,I);return this._calculate(L,L,L,A)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(A.zoom)-1},p,v),l.evaluate({zoom:Math.floor(A.zoom)},p,v),l.evaluate({zoom:Math.floor(A.zoom)+1},p,v),A):l.value}_calculate(l,A,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:l,to:A}:{from:p,to:A}}interpolate(l){return l}}class c{constructor(l){this.specification=l}possiblyEvaluate(l,A,p,v){if(l.value!==void 0){if(l.expression.kind==="constant"){const E=l.expression.evaluate(A,null,{},p,v);return this._calculate(E,E,E,A)}return this._calculate(l.expression.evaluate(new En(Math.floor(A.zoom-1),A)),l.expression.evaluate(new En(Math.floor(A.zoom),A)),l.expression.evaluate(new En(Math.floor(A.zoom+1),A)),A)}}_calculate(l,A,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:l,to:A}:{from:p,to:A}}interpolate(l){return l}}class d{constructor(l){this.specification=l}possiblyEvaluate(l,A,p,v){return!!l.expression.evaluate(A,null,{},p,v)}interpolate(){return!1}}class _{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const A in l){const p=l[A];p.specification.overridable&&this.overridableProperties.push(A);const v=this.defaultPropertyValues[A]=new Mc(p,void 0),E=this.defaultTransitionablePropertyValues[A]=new Ea(p);this.defaultTransitioningPropertyValues[A]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[A]=v.possiblyEvaluate({})}}}tr("DataDrivenProperty",Fr),tr("DataConstantProperty",dr),tr("CrossFadedDataDrivenProperty",C),tr("CrossFadedProperty",c),tr("ColorRampProperty",d);const w="-transition";class T extends fe{constructor(l,A){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),A.layout&&(this._unevaluatedLayout=new Bu(A.layout)),A.paint)){this._transitionablePaint=new Kl(A.paint);for(const p in l.paint)this.setPaintProperty(p,l.paint[p],{validate:!1});for(const p in l.layout)this.setLayoutProperty(p,l.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _h(A.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,A){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};A!=null&&this._validate(Ld,`layers.${this.id}.layout.${l}`,l,A,p)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,A):this.visibility=A)}getPaintProperty(l){return l.endsWith(w)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,A){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(A!=null&&this._validate(bp,`layers.${this.id}.paint.${l}`,l,A,p))return!1;if(l.endsWith(w))return this._transitionablePaint.setTransition(l.slice(0,-11),A||void 0),!1;{const v=this._transitionablePaint._values[l],E=v.property.specification["property-type"]==="cross-faded-data-driven",I=v.value.isDataDriven(),L=v.value;this._transitionablePaint.setValue(l,A),this._handleSpecialPaintPropertyUpdate(l);const O=this._transitionablePaint._values[l].value;return O.isDataDriven()||I||E||this._handleOverridablePaintPropertyUpdate(l,L,O)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,A,p){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,A){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,A)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,A)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Lt(l,(A,p)=>!(A===void 0||p==="layout"&&!Object.keys(A).length||p==="paint"&&!Object.keys(A).length))}_validate(l,A,p,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!E||E.validate!==!1)&&Pd(this,l.call(el,{key:A,layerType:this.type,objectKey:p,value:v,styleSpec:lt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const A=this.paint.get(l);if(A instanceof Sa&&Jo(A.property.specification)&&(A.value.kind==="source"||A.value.kind==="composite")&&A.value.isStateDependent)return!0}return!1}}const U={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class g{constructor(l,A){this._structArray=l,this._pos1=A*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class y{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,A){return l._trim(),A&&(l.isTransferred=!0,A.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const A=Object.create(this.prototype);return A.arrayBuffer=l.arrayBuffer,A.length=l.length,A.capacity=l.arrayBuffer.byteLength/A.bytesPerElement,A._refreshViews(),A}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const A=this.uint8;this._refreshViews(),A&&this.uint8.set(A)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function S(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,A=0,p=0;return{members:u.map(v=>{const E=U[v.type].BYTES_PER_ELEMENT,I=A=F(A,Math.max(l,E)),L=v.components||1;return p=Math.max(p,E),A+=E*L,{name:v.name,type:v.type,components:L,offset:I}}),size:F(A,Math.max(p,l)),alignment:l}}function F(u,l){return Math.ceil(u/l)*l}class M extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,A){const p=this.length;return this.resize(p+1),this.emplace(p,l,A)}emplace(l,A,p){const v=2*l;return this.int16[v+0]=A,this.int16[v+1]=p,l}}M.prototype.bytesPerElement=4,tr("StructArrayLayout2i4",M);class N extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,A,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,A,p)}emplace(l,A,p,v){const E=3*l;return this.int16[E+0]=A,this.int16[E+1]=p,this.int16[E+2]=v,l}}N.prototype.bytesPerElement=6,tr("StructArrayLayout3i6",N);class k extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,A,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,A,p,v)}emplace(l,A,p,v,E){const I=4*l;return this.int16[I+0]=A,this.int16[I+1]=p,this.int16[I+2]=v,this.int16[I+3]=E,l}}k.prototype.bytesPerElement=8,tr("StructArrayLayout4i8",k);class V extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E,I){const L=this.length;return this.resize(L+1),this.emplace(L,l,A,p,v,E,I)}emplace(l,A,p,v,E,I,L){const O=6*l;return this.int16[O+0]=A,this.int16[O+1]=p,this.int16[O+2]=v,this.int16[O+3]=E,this.int16[O+4]=I,this.int16[O+5]=L,l}}V.prototype.bytesPerElement=12,tr("StructArrayLayout2i4i12",V);class j extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E,I){const L=this.length;return this.resize(L+1),this.emplace(L,l,A,p,v,E,I)}emplace(l,A,p,v,E,I,L){const O=4*l,H=8*l;return this.int16[O+0]=A,this.int16[O+1]=p,this.uint8[H+4]=v,this.uint8[H+5]=E,this.uint8[H+6]=I,this.uint8[H+7]=L,l}}j.prototype.bytesPerElement=8,tr("StructArrayLayout2i4ub8",j);class K extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,A){const p=this.length;return this.resize(p+1),this.emplace(p,l,A)}emplace(l,A,p){const v=2*l;return this.float32[v+0]=A,this.float32[v+1]=p,l}}K.prototype.bytesPerElement=8,tr("StructArrayLayout2f8",K);class tt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E,I,L,O,H,q){const $=this.length;return this.resize($+1),this.emplace($,l,A,p,v,E,I,L,O,H,q)}emplace(l,A,p,v,E,I,L,O,H,q,$){const Y=10*l;return this.uint16[Y+0]=A,this.uint16[Y+1]=p,this.uint16[Y+2]=v,this.uint16[Y+3]=E,this.uint16[Y+4]=I,this.uint16[Y+5]=L,this.uint16[Y+6]=O,this.uint16[Y+7]=H,this.uint16[Y+8]=q,this.uint16[Y+9]=$,l}}tt.prototype.bytesPerElement=20,tr("StructArrayLayout10ui20",tt);class ht extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E,I,L,O,H,q,$,Y){const ot=this.length;return this.resize(ot+1),this.emplace(ot,l,A,p,v,E,I,L,O,H,q,$,Y)}emplace(l,A,p,v,E,I,L,O,H,q,$,Y,ot){const ut=12*l;return this.int16[ut+0]=A,this.int16[ut+1]=p,this.int16[ut+2]=v,this.int16[ut+3]=E,this.uint16[ut+4]=I,this.uint16[ut+5]=L,this.uint16[ut+6]=O,this.uint16[ut+7]=H,this.int16[ut+8]=q,this.int16[ut+9]=$,this.int16[ut+10]=Y,this.int16[ut+11]=ot,l}}ht.prototype.bytesPerElement=24,tr("StructArrayLayout4i4ui4i24",ht);class rt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,A,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,A,p)}emplace(l,A,p,v){const E=3*l;return this.float32[E+0]=A,this.float32[E+1]=p,this.float32[E+2]=v,l}}rt.prototype.bytesPerElement=12,tr("StructArrayLayout3f12",rt);class At extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const A=this.length;return this.resize(A+1),this.emplace(A,l)}emplace(l,A){return this.uint32[1*l+0]=A,l}}At.prototype.bytesPerElement=4,tr("StructArrayLayout1ul4",At);class St extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E,I,L,O,H){const q=this.length;return this.resize(q+1),this.emplace(q,l,A,p,v,E,I,L,O,H)}emplace(l,A,p,v,E,I,L,O,H,q){const $=10*l,Y=5*l;return this.int16[$+0]=A,this.int16[$+1]=p,this.int16[$+2]=v,this.int16[$+3]=E,this.int16[$+4]=I,this.int16[$+5]=L,this.uint32[Y+3]=O,this.uint16[$+8]=H,this.uint16[$+9]=q,l}}St.prototype.bytesPerElement=20,tr("StructArrayLayout6i1ul2ui20",St);class Ct extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E,I){const L=this.length;return this.resize(L+1),this.emplace(L,l,A,p,v,E,I)}emplace(l,A,p,v,E,I,L){const O=6*l;return this.int16[O+0]=A,this.int16[O+1]=p,this.int16[O+2]=v,this.int16[O+3]=E,this.int16[O+4]=I,this.int16[O+5]=L,l}}Ct.prototype.bytesPerElement=12,tr("StructArrayLayout2i2i2i12",Ct);class yt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E){const I=this.length;return this.resize(I+1),this.emplace(I,l,A,p,v,E)}emplace(l,A,p,v,E,I){const L=4*l,O=8*l;return this.float32[L+0]=A,this.float32[L+1]=p,this.float32[L+2]=v,this.int16[O+6]=E,this.int16[O+7]=I,l}}yt.prototype.bytesPerElement=16,tr("StructArrayLayout2f1f2i16",yt);class Et extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E,I){const L=this.length;return this.resize(L+1),this.emplace(L,l,A,p,v,E,I)}emplace(l,A,p,v,E,I,L){const O=16*l,H=4*l,q=8*l;return this.uint8[O+0]=A,this.uint8[O+1]=p,this.float32[H+1]=v,this.float32[H+2]=E,this.int16[q+6]=I,this.int16[q+7]=L,l}}Et.prototype.bytesPerElement=16,tr("StructArrayLayout2ub2f2i16",Et);class Wt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,A,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,A,p)}emplace(l,A,p,v){const E=3*l;return this.uint16[E+0]=A,this.uint16[E+1]=p,this.uint16[E+2]=v,l}}Wt.prototype.bytesPerElement=6,tr("StructArrayLayout3ui6",Wt);class Zt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E,I,L,O,H,q,$,Y,ot,ut,vt,It,Dt){const te=this.length;return this.resize(te+1),this.emplace(te,l,A,p,v,E,I,L,O,H,q,$,Y,ot,ut,vt,It,Dt)}emplace(l,A,p,v,E,I,L,O,H,q,$,Y,ot,ut,vt,It,Dt,te){const Qt=24*l,Kt=12*l,ve=48*l;return this.int16[Qt+0]=A,this.int16[Qt+1]=p,this.uint16[Qt+2]=v,this.uint16[Qt+3]=E,this.uint32[Kt+2]=I,this.uint32[Kt+3]=L,this.uint32[Kt+4]=O,this.uint16[Qt+10]=H,this.uint16[Qt+11]=q,this.uint16[Qt+12]=$,this.float32[Kt+7]=Y,this.float32[Kt+8]=ot,this.uint8[ve+36]=ut,this.uint8[ve+37]=vt,this.uint8[ve+38]=It,this.uint32[Kt+10]=Dt,this.int16[Qt+22]=te,l}}Zt.prototype.bytesPerElement=48,tr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Zt);class zt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,A,p,v,E,I,L,O,H,q,$,Y,ot,ut,vt,It,Dt,te,Qt,Kt,ve,be,Ye,cr,We,Ge,ir,br){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,l,A,p,v,E,I,L,O,H,q,$,Y,ot,ut,vt,It,Dt,te,Qt,Kt,ve,be,Ye,cr,We,Ge,ir,br)}emplace(l,A,p,v,E,I,L,O,H,q,$,Y,ot,ut,vt,It,Dt,te,Qt,Kt,ve,be,Ye,cr,We,Ge,ir,br,Xe){const xe=32*l,ur=16*l;return this.int16[xe+0]=A,this.int16[xe+1]=p,this.int16[xe+2]=v,this.int16[xe+3]=E,this.int16[xe+4]=I,this.int16[xe+5]=L,this.int16[xe+6]=O,this.int16[xe+7]=H,this.uint16[xe+8]=q,this.uint16[xe+9]=$,this.uint16[xe+10]=Y,this.uint16[xe+11]=ot,this.uint16[xe+12]=ut,this.uint16[xe+13]=vt,this.uint16[xe+14]=It,this.uint16[xe+15]=Dt,this.uint16[xe+16]=te,this.uint16[xe+17]=Qt,this.uint16[xe+18]=Kt,this.uint16[xe+19]=ve,this.uint16[xe+20]=be,this.uint16[xe+21]=Ye,this.uint16[xe+22]=cr,this.uint32[ur+12]=We,this.float32[ur+13]=Ge,this.float32[ur+14]=ir,this.uint16[xe+30]=br,this.uint16[xe+31]=Xe,l}}zt.prototype.bytesPerElement=64,tr("StructArrayLayout8i15ui1ul2f2ui64",zt);class ae extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const A=this.length;return this.resize(A+1),this.emplace(A,l)}emplace(l,A){return this.float32[1*l+0]=A,l}}ae.prototype.bytesPerElement=4,tr("StructArrayLayout1f4",ae);class de extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,A,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,A,p)}emplace(l,A,p,v){const E=3*l;return this.uint16[6*l+0]=A,this.float32[E+1]=p,this.float32[E+2]=v,l}}de.prototype.bytesPerElement=12,tr("StructArrayLayout1ui2f12",de);class Me extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,A,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,A,p)}emplace(l,A,p,v){const E=4*l;return this.uint32[2*l+0]=A,this.uint16[E+2]=p,this.uint16[E+3]=v,l}}Me.prototype.bytesPerElement=8,tr("StructArrayLayout1ul2ui8",Me);class le extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,A){const p=this.length;return this.resize(p+1),this.emplace(p,l,A)}emplace(l,A,p){const v=2*l;return this.uint16[v+0]=A,this.uint16[v+1]=p,l}}le.prototype.bytesPerElement=4,tr("StructArrayLayout2ui4",le);class Ee extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const A=this.length;return this.resize(A+1),this.emplace(A,l)}emplace(l,A){return this.uint16[1*l+0]=A,l}}Ee.prototype.bytesPerElement=2,tr("StructArrayLayout1ui2",Ee);class $e extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,A,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,A,p,v)}emplace(l,A,p,v,E){const I=4*l;return this.float32[I+0]=A,this.float32[I+1]=p,this.float32[I+2]=v,this.float32[I+3]=E,l}}$e.prototype.bytesPerElement=16,tr("StructArrayLayout4f16",$e);class Tr extends g{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new b(this.anchorPointX,this.anchorPointY)}}Tr.prototype.size=20;class Je extends St{get(l){return new Tr(this,l)}}tr("CollisionBoxArray",Je);class mr extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}mr.prototype.size=48;class Dr extends Zt{get(l){return new mr(this,l)}}tr("PlacedSymbolArray",Dr);class Lr extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Lr.prototype.size=64;class Sn extends zt{get(l){return new Lr(this,l)}}tr("SymbolInstanceArray",Sn);class ln extends ae{getoffsetX(l){return this.float32[1*l+0]}}tr("GlyphOffsetArray",ln);class bn extends N{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}tr("SymbolLineVertexArray",bn);class Dn extends g{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Dn.prototype.size=12;class Xr extends de{get(l){return new Dn(this,l)}}tr("TextAnchorOffsetArray",Xr);class Nn extends g{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Nn.prototype.size=8;class di extends Me{get(l){return new Nn(this,l)}}tr("FeatureIndexArray",di);class ci extends M{}class Ti extends M{}class Ii extends M{}class qi extends V{}class no extends j{}class Fi extends K{}class ni extends tt{}class cs extends ht{}class io extends rt{}class so extends At{}class An extends Ct{}class Ki extends Et{}class Ui extends Wt{}class ii extends le{}const il=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:Uc}=il;class yi{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=l}prepareSegment(l,A,p,v){let E=this.segments[this.segments.length-1];return l>yi.MAX_VERTEX_ARRAY_LENGTH&&wt(`Max vertices per segment is ${yi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!E||E.vertexLength+l>yi.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==v)&&(E={vertexOffset:A.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},v!==void 0&&(E.sortKey=v),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const l of this.segments)for(const A in l.vaos)l.vaos[A].destroy()}static simpleSegment(l,A,p,v){return new yi([{vertexOffset:l,primitiveOffset:A,vertexLength:p,primitiveLength:v,vaos:{},sortKey:0}])}}function Lo(u,l){return 256*(u=pt(Math.floor(u),0,255))+pt(Math.floor(l),0,255)}yi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tr("SegmentVector",yi);const sl=S([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ol={exports:{}},al={exports:{}};al.exports=function(u,l){var A,p,v,E,I,L,O,H;for(p=u.length-(A=3&u.length),v=l,I=3432918353,L=461845907,H=0;H<p;)O=255&u.charCodeAt(H)|(255&u.charCodeAt(++H))<<8|(255&u.charCodeAt(++H))<<16|(255&u.charCodeAt(++H))<<24,++H,v=27492+(65535&(E=5*(65535&(v=(v^=O=(65535&(O=(O=(65535&O)*I+(((O>>>16)*I&65535)<<16)&4294967295)<<15|O>>>17))*L+(((O>>>16)*L&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(O=0,A){case 3:O^=(255&u.charCodeAt(H+2))<<16;case 2:O^=(255&u.charCodeAt(H+1))<<8;case 1:v^=O=(65535&(O=(O=(65535&(O^=255&u.charCodeAt(H)))*I+(((O>>>16)*I&65535)<<16)&4294967295)<<15|O>>>17))*L+(((O>>>16)*L&65535)<<16)&4294967295}return v^=u.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var mA=al.exports,vh={exports:{}};vh.exports=function(u,l){for(var A,p=u.length,v=l^p,E=0;p>=4;)A=1540483477*(65535&(A=255&u.charCodeAt(E)|(255&u.charCodeAt(++E))<<8|(255&u.charCodeAt(++E))<<16|(255&u.charCodeAt(++E))<<24))+((1540483477*(A>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(A=1540483477*(65535&(A^=A>>>24))+((1540483477*(A>>>16)&65535)<<16)),p-=4,++E;switch(p){case 3:v^=(255&u.charCodeAt(E+2))<<16;case 2:v^=(255&u.charCodeAt(E+1))<<8;case 1:v=1540483477*(65535&(v^=255&u.charCodeAt(E)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var Cu=mA,yA=vh.exports;ol.exports=Cu,ol.exports.murmur3=Cu,ol.exports.murmur2=yA;var Rc=h(ol.exports);class Ta{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,A,p,v){this.ids.push(H_(l)),this.positions.push(A,p,v)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const A=H_(l);let p=0,v=this.ids.length-1;for(;p<v;){const I=p+v>>1;this.ids[I]>=A?v=I:p=I+1}const E=[];for(;this.ids[p]===A;)E.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return E}static serialize(l,A){const p=new Float64Array(l.ids),v=new Uint32Array(l.positions);return Hm(p,v,0,p.length-1),A&&A.push(p.buffer,v.buffer),{ids:p,positions:v}}static deserialize(l){const A=new Ta;return A.ids=l.ids,A.positions=l.positions,A.indexed=!0,A}}function H_(u){const l=+u;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:Rc(String(u))}function Hm(u,l,A,p){for(;A<p;){const v=u[A+p>>1];let E=A-1,I=p+1;for(;;){do E++;while(u[E]<v);do I--;while(u[I]>v);if(E>=I)break;bh(u,E,I),bh(l,3*E,3*I),bh(l,3*E+1,3*I+1),bh(l,3*E+2,3*I+2)}I-A<p-I?(Hm(u,l,A,I),A=I+1):(Hm(u,l,I+1,p),p=I)}}function bh(u,l,A){const p=u[l];u[l]=u[A],u[A]=p}tr("FeaturePositionMap",Ta);class Po{constructor(l,A){this.gl=l.gl,this.location=A}}class Bp extends Po{constructor(l,A){super(l,A),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class z_ extends Po{constructor(l,A){super(l,A),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class V_ extends Po{constructor(l,A){super(l,A),this.current=lr.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const G_=new Float32Array(16);function wh(u){return[Lo(255*u.r,255*u.g),Lo(255*u.b,255*u.a)]}class xh{constructor(l,A,p){this.value=l,this.uniformNames=A.map(v=>`u_${v}`),this.type=p}setUniform(l,A,p){l.set(p.constantOr(this.value))}getBinding(l,A,p){return this.type==="color"?new V_(l,A):new Bp(l,A)}}class _A{constructor(l,A){this.uniformNames=A.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,A){this.pixelRatioFrom=A.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=A.tlbr,this.patternTo=l.tlbr}setUniform(l,A,p,v){const E=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&l.set(E)}getBinding(l,A,p){return p.substr(0,9)==="u_pattern"?new z_(l,A):new Bp(l,A)}}class Ia{constructor(l,A,p,v){this.expression=l,this.type=p,this.maxValue=0,this.paintVertexAttributes=A.map(E=>({name:`a_${E}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(l,A,p,v,E){const I=this.paintVertexArray.length,L=this.expression.evaluate(new En(0),A,{},v,[],E);this.paintVertexArray.resize(l),this._setPaintValue(I,l,L)}updatePaintArray(l,A,p,v){const E=this.expression.evaluate({zoom:0},p,v);this._setPaintValue(l,A,E)}_setPaintValue(l,A,p){if(this.type==="color"){const v=wh(p);for(let E=l;E<A;E++)this.paintVertexArray.emplace(E,v[0],v[1])}else{for(let v=l;v<A;v++)this.paintVertexArray.emplace(v,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ea{constructor(l,A,p,v,E,I){this.expression=l,this.uniformNames=A.map(L=>`u_${L}_t`),this.type=p,this.useIntegerZoom=v,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=A.map(L=>({name:`a_${L}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new I}populatePaintArray(l,A,p,v,E){const I=this.expression.evaluate(new En(this.zoom),A,{},v,[],E),L=this.expression.evaluate(new En(this.zoom+1),A,{},v,[],E),O=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(O,l,I,L)}updatePaintArray(l,A,p,v){const E=this.expression.evaluate({zoom:this.zoom},p,v),I=this.expression.evaluate({zoom:this.zoom+1},p,v);this._setPaintValue(l,A,E,I)}_setPaintValue(l,A,p,v){if(this.type==="color"){const E=wh(p),I=wh(v);for(let L=l;L<A;L++)this.paintVertexArray.emplace(L,E[0],E[1],I[0],I[1])}else{for(let E=l;E<A;E++)this.paintVertexArray.emplace(E,p,v);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(v))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,A){const p=this.useIntegerZoom?Math.floor(A.zoom):A.zoom,v=pt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);l.set(v)}getBinding(l,A,p){return new Bp(l,A)}}class Fa{constructor(l,A,p,v,E,I){this.expression=l,this.type=A,this.useIntegerZoom=p,this.zoom=v,this.layerId=I,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(l,A,p){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(v,l,A.patterns&&A.patterns[this.layerId],p)}updatePaintArray(l,A,p,v,E){this._setPaintValues(l,A,p.patterns&&p.patterns[this.layerId],E)}_setPaintValues(l,A,p,v){if(!v||!p)return;const{min:E,mid:I,max:L}=p,O=v[E],H=v[I],q=v[L];if(O&&H&&q)for(let $=l;$<A;$++)this.zoomInPaintVertexArray.emplace($,H.tl[0],H.tl[1],H.br[0],H.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],H.pixelRatio,O.pixelRatio),this.zoomOutPaintVertexArray.emplace($,H.tl[0],H.tl[1],H.br[0],H.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],H.pixelRatio,q.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,sl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,sl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zm{constructor(l,A,p){this.binders={},this._buffers=[];const v=[];for(const E in l.paint._values){if(!p(E))continue;const I=l.paint.get(E);if(!(I instanceof Sa&&Jo(I.property.specification)))continue;const L=Cp(E,l.type),O=I.value,H=I.property.specification.type,q=I.property.useIntegerZoom,$=I.property.specification["property-type"],Y=$==="cross-faded"||$==="cross-faded-data-driven";if(O.kind==="constant")this.binders[E]=Y?new _A(O.value,L):new xh(O.value,L,H),v.push(`/u_${E}`);else if(O.kind==="source"||Y){const ot=Vm(E,H,"source");this.binders[E]=Y?new Fa(O,H,q,A,ot,l.id):new Ia(O,L,H,ot),v.push(`/a_${E}`)}else{const ot=Vm(E,H,"composite");this.binders[E]=new ea(O,L,H,q,A,ot),v.push(`/z_${E}`)}}this.cacheKey=v.sort().join("")}getMaxValue(l){const A=this.binders[l];return A instanceof Ia||A instanceof ea?A.maxValue:0}populatePaintArrays(l,A,p,v,E){for(const I in this.binders){const L=this.binders[I];(L instanceof Ia||L instanceof ea||L instanceof Fa)&&L.populatePaintArray(l,A,p,v,E)}}setConstantPatternPositions(l,A){for(const p in this.binders){const v=this.binders[p];v instanceof _A&&v.setConstantPatternPositions(l,A)}}updatePaintArrays(l,A,p,v,E){let I=!1;for(const L in l){const O=A.getPositions(L);for(const H of O){const q=p.feature(H.index);for(const $ in this.binders){const Y=this.binders[$];if((Y instanceof Ia||Y instanceof ea||Y instanceof Fa)&&Y.expression.isStateDependent===!0){const ot=v.paint.get($);Y.expression=ot.value,Y.updatePaintArray(H.start,H.end,q,l[L],E),I=!0}}}}return I}defines(){const l=[];for(const A in this.binders){const p=this.binders[A];(p instanceof xh||p instanceof _A)&&l.push(...p.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return l}getBinderAttributes(){const l=[];for(const A in this.binders){const p=this.binders[A];if(p instanceof Ia||p instanceof ea)for(let v=0;v<p.paintVertexAttributes.length;v++)l.push(p.paintVertexAttributes[v].name);else if(p instanceof Fa)for(let v=0;v<sl.members.length;v++)l.push(sl.members[v].name)}return l}getBinderUniforms(){const l=[];for(const A in this.binders){const p=this.binders[A];if(p instanceof xh||p instanceof _A||p instanceof ea)for(const v of p.uniformNames)l.push(v)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,A){const p=[];for(const v in this.binders){const E=this.binders[v];if(E instanceof xh||E instanceof _A||E instanceof ea){for(const I of E.uniformNames)if(A[I]){const L=E.getBinding(l,A[I],I);p.push({name:I,property:v,binding:L})}}}return p}setUniforms(l,A,p,v){for(const{name:E,property:I,binding:L}of A)this.binders[I].setUniform(L,v,p.get(I),E)}updatePaintBuffers(l){this._buffers=[];for(const A in this.binders){const p=this.binders[A];if(l&&p instanceof Fa){const v=l.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(p instanceof Ia||p instanceof ea)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(l){for(const A in this.binders){const p=this.binders[A];(p instanceof Ia||p instanceof ea||p instanceof Fa)&&p.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const A=this.binders[l];(A instanceof Ia||A instanceof ea||A instanceof Fa)&&A.destroy()}}}class vA{constructor(l,A){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const v of l)this.programConfigurations[v.id]=new zm(v,A,p);this.needsUpload=!1,this._featureMap=new Ta,this._bufferOffset=0}populatePaintArrays(l,A,p,v,E,I){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(l,A,v,E,I);A.id!==void 0&&this._featureMap.add(A.id,p,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,A,p,v){for(const E of p)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(l,this._featureMap,A,E,v)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const A in this.programConfigurations)this.programConfigurations[A].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function Cp(u,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${l}-`,"").replace(/-/g,"_")]}function Vm(u,l,A){const p={color:{source:K,composite:$e},number:{source:ae,composite:K}},v=function(E){return{"line-pattern":{source:ni,composite:ni},"fill-pattern":{source:ni,composite:ni},"fill-extrusion-pattern":{source:ni,composite:ni}}[E]}(u);return v&&v[A]||p[l][A]}tr("ConstantBinder",xh),tr("CrossFadedConstantBinder",_A),tr("SourceExpressionBinder",Ia),tr("CrossFadedCompositeBinder",Fa),tr("CompositeExpressionBinder",ea),tr("ProgramConfiguration",zm,{omit:["_buffers"]}),tr("ProgramConfigurationSet",vA);const _i=8192,Wl=Math.pow(2,14)-1,Gm=-Wl-1;function Eu(u){const l=_i/u.extent,A=u.loadGeometry();for(let p=0;p<A.length;p++){const v=A[p];for(let E=0;E<v.length;E++){const I=v[E],L=Math.round(I.x*l),O=Math.round(I.y*l);I.x=pt(L,Gm,Wl),I.y=pt(O,Gm,Wl),(L<I.x||L>I.x+1||O<I.y||O>I.y+1)&&wt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return A}function bA(u,l){return{type:u.type,id:u.id,properties:u.properties,geometry:l?Eu(u):[]}}function Nd(u,l,A,p,v){u.emplaceBack(2*l+(p+1)/2,2*A+(v+1)/2)}class Su{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(A=>A.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Ti,this.indexArray=new Ui,this.segments=new yi,this.programConfigurations=new vA(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(l,A,p){const v=this.layers[0],E=[];let I=null,L=!1;v.type==="circle"&&(I=v.layout.get("circle-sort-key"),L=!I.isConstant());for(const{feature:O,id:H,index:q,sourceLayerIndex:$}of l){const Y=this.layers[0]._featureFilter.needGeometry,ot=bA(O,Y);if(!this.layers[0]._featureFilter.filter(new En(this.zoom),ot,p))continue;const ut=L?I.evaluate(ot,{},p):void 0,vt={id:H,properties:O.properties,type:O.type,sourceLayerIndex:$,index:q,geometry:Y?ot.geometry:Eu(O),patterns:{},sortKey:ut};E.push(vt)}L&&E.sort((O,H)=>O.sortKey-H.sortKey);for(const O of E){const{geometry:H,index:q,sourceLayerIndex:$}=O,Y=l[q].feature;this.addFeature(O,H,q,p),A.featureIndex.insert(Y,H,q,$,this.index)}}update(l,A,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,A,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Uc),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,A,p,v){for(const E of A)for(const I of E){const L=I.x,O=I.y;if(L<0||L>=_i||O<0||O>=_i)continue;const H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),q=H.vertexLength;Nd(this.layoutVertexArray,L,O,-1,-1),Nd(this.layoutVertexArray,L,O,1,-1),Nd(this.layoutVertexArray,L,O,1,1),Nd(this.layoutVertexArray,L,O,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),H.vertexLength+=4,H.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,{},v)}}function j_(u,l){for(let A=0;A<u.length;A++)if(ra(l,u[A]))return!0;for(let A=0;A<l.length;A++)if(ra(u,l[A]))return!0;return!!jm(u,l)}function q_(u,l,A){return!!ra(u,l)||!!Qd(l,u,A)}function K_(u,l){if(u.length===1)return $l(l,u[0]);for(let A=0;A<l.length;A++){const p=l[A];for(let v=0;v<p.length;v++)if(ra(u,p[v]))return!0}for(let A=0;A<u.length;A++)if($l(l,u[A]))return!0;for(let A=0;A<l.length;A++)if(jm(u,l[A]))return!0;return!1}function W_(u,l,A){if(u.length>1){if(jm(u,l))return!0;for(let p=0;p<l.length;p++)if(Qd(l[p],u,A))return!0}for(let p=0;p<u.length;p++)if(Qd(u[p],l,A))return!0;return!1}function jm(u,l){if(u.length===0||l.length===0)return!1;for(let A=0;A<u.length-1;A++){const p=u[A],v=u[A+1];for(let E=0;E<l.length-1;E++)if(kd(p,v,l[E],l[E+1]))return!0}return!1}function kd(u,l,A,p){return _t(u,A,p)!==_t(l,A,p)&&_t(u,l,A)!==_t(u,l,p)}function Qd(u,l,A){const p=A*A;if(l.length===1)return u.distSqr(l[0])<p;for(let v=1;v<l.length;v++)if(Hd(u,l[v-1],l[v])<p)return!0;return!1}function Hd(u,l,A){const p=l.distSqr(A);if(p===0)return u.distSqr(l);const v=((u.x-l.x)*(A.x-l.x)+(u.y-l.y)*(A.y-l.y))/p;return u.distSqr(v<0?l:v>1?A:A.sub(l)._mult(v)._add(l))}function $l(u,l){let A,p,v,E=!1;for(let I=0;I<u.length;I++){A=u[I];for(let L=0,O=A.length-1;L<A.length;O=L++)p=A[L],v=A[O],p.y>l.y!=v.y>l.y&&l.x<(v.x-p.x)*(l.y-p.y)/(v.y-p.y)+p.x&&(E=!E)}return E}function ra(u,l){let A=!1;for(let p=0,v=u.length-1;p<u.length;v=p++){const E=u[p],I=u[v];E.y>l.y!=I.y>l.y&&l.x<(I.x-E.x)*(l.y-E.y)/(I.y-E.y)+E.x&&(A=!A)}return A}function Tu(u,l,A){const p=A[0],v=A[2];if(u.x<p.x&&l.x<p.x||u.x>v.x&&l.x>v.x||u.y<p.y&&l.y<p.y||u.y>v.y&&l.y>v.y)return!1;const E=_t(u,l,A[0]);return E!==_t(u,l,A[1])||E!==_t(u,l,A[2])||E!==_t(u,l,A[3])}function Iu(u,l,A){const p=l.paint.get(u).value;return p.kind==="constant"?p.value:A.programConfigurations.get(l.id).getMaxValue(u)}function Bh(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function zd(u,l,A,p,v){if(!l[0]&&!l[1])return u;const E=b.convert(l)._mult(v);A==="viewport"&&E._rotate(-p);const I=[];for(let L=0;L<u.length;L++)I.push(u[L].sub(E));return I}let $_,Ep;tr("CircleBucket",Su,{omit:["layers"]});var qm={get paint(){return Ep=Ep||new _({"circle-radius":new Fr(lt.paint_circle["circle-radius"]),"circle-color":new Fr(lt.paint_circle["circle-color"]),"circle-blur":new Fr(lt.paint_circle["circle-blur"]),"circle-opacity":new Fr(lt.paint_circle["circle-opacity"]),"circle-translate":new dr(lt.paint_circle["circle-translate"]),"circle-translate-anchor":new dr(lt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dr(lt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dr(lt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fr(lt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fr(lt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fr(lt.paint_circle["circle-stroke-opacity"])})},get layout(){return $_=$_||new _({"circle-sort-key":new Fr(lt.layout_circle["circle-sort-key"])})}},Mo=1e-6,Sp=typeof Float32Array<"u"?Float32Array:Array;function QE(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function mN(u,l,A){var p=l[0],v=l[1],E=l[2],I=l[3],L=l[4],O=l[5],H=l[6],q=l[7],$=l[8],Y=l[9],ot=l[10],ut=l[11],vt=l[12],It=l[13],Dt=l[14],te=l[15],Qt=A[0],Kt=A[1],ve=A[2],be=A[3];return u[0]=Qt*p+Kt*L+ve*$+be*vt,u[1]=Qt*v+Kt*O+ve*Y+be*It,u[2]=Qt*E+Kt*H+ve*ot+be*Dt,u[3]=Qt*I+Kt*q+ve*ut+be*te,u[4]=(Qt=A[4])*p+(Kt=A[5])*L+(ve=A[6])*$+(be=A[7])*vt,u[5]=Qt*v+Kt*O+ve*Y+be*It,u[6]=Qt*E+Kt*H+ve*ot+be*Dt,u[7]=Qt*I+Kt*q+ve*ut+be*te,u[8]=(Qt=A[8])*p+(Kt=A[9])*L+(ve=A[10])*$+(be=A[11])*vt,u[9]=Qt*v+Kt*O+ve*Y+be*It,u[10]=Qt*E+Kt*H+ve*ot+be*Dt,u[11]=Qt*I+Kt*q+ve*ut+be*te,u[12]=(Qt=A[12])*p+(Kt=A[13])*L+(ve=A[14])*$+(be=A[15])*vt,u[13]=Qt*v+Kt*O+ve*Y+be*It,u[14]=Qt*E+Kt*H+ve*ot+be*Dt,u[15]=Qt*I+Kt*q+ve*ut+be*te,u}Math.hypot||(Math.hypot=function(){for(var u=0,l=arguments.length;l--;)u+=arguments[l]*arguments[l];return Math.sqrt(u)});var Km,ubt=mN;function X_(u,l,A){var p=l[0],v=l[1],E=l[2],I=l[3];return u[0]=A[0]*p+A[4]*v+A[8]*E+A[12]*I,u[1]=A[1]*p+A[5]*v+A[9]*E+A[13]*I,u[2]=A[2]*p+A[6]*v+A[10]*E+A[14]*I,u[3]=A[3]*p+A[7]*v+A[11]*E+A[15]*I,u}Km=new Sp(4),Sp!=Float32Array&&(Km[0]=0,Km[1]=0,Km[2]=0,Km[3]=0);class Abt extends T{constructor(l){super(l,qm)}createBucket(l){return new Su(l)}queryRadius(l){const A=l;return Iu("circle-radius",this,A)+Iu("circle-stroke-width",this,A)+Bh(this.paint.get("circle-translate"))}queryIntersectsFeature(l,A,p,v,E,I,L,O){const H=zd(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,L),q=this.paint.get("circle-radius").evaluate(A,p)+this.paint.get("circle-stroke-width").evaluate(A,p),$=this.paint.get("circle-pitch-alignment")==="map",Y=$?H:function(ut,vt){return ut.map(It=>yN(It,vt))}(H,O),ot=$?q*L:q;for(const ut of v)for(const vt of ut){const It=$?vt:yN(vt,O);let Dt=ot;const te=X_([],[vt.x,vt.y,0,1],O);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Dt*=te[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Dt*=I.cameraToCenterDistance/te[3]),q_(Y,It,Dt))return!0}return!1}}function yN(u,l){const A=X_([],[u.x,u.y,0,1],l);return new b(A[0]/A[3],A[1]/A[3])}class _N extends Su{}let vN;tr("HeatmapBucket",_N,{omit:["layers"]});var hbt={get paint(){return vN=vN||new _({"heatmap-radius":new Fr(lt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fr(lt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dr(lt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new d(lt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dr(lt.paint_heatmap["heatmap-opacity"])})}};function HE(u,l,A,p){let{width:v,height:E}=l;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==v*E*A)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${v*E*A}`)}else p=new Uint8Array(v*E*A);return u.width=v,u.height=E,u.data=p,u}function bN(u,l,A){let{width:p,height:v}=l;if(p===u.width&&v===u.height)return;const E=HE({},{width:p,height:v},A);zE(u,E,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,p),height:Math.min(u.height,v)},A),u.width=p,u.height=v,u.data=E.data}function zE(u,l,A,p,v,E){if(v.width===0||v.height===0)return l;if(v.width>u.width||v.height>u.height||A.x>u.width-v.width||A.y>u.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>l.width||v.height>l.height||p.x>l.width-v.width||p.y>l.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const I=u.data,L=l.data;if(I===L)throw new Error("srcData equals dstData, so image is already copied");for(let O=0;O<v.height;O++){const H=((A.y+O)*u.width+A.x)*E,q=((p.y+O)*l.width+p.x)*E;for(let $=0;$<v.width*E;$++)L[q+$]=I[H+$]}return l}class Wm{constructor(l,A){HE(this,l,1,A)}resize(l){bN(this,l,1)}clone(){return new Wm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,A,p,v,E){zE(l,A,p,v,E,1)}}class ll{constructor(l,A){HE(this,l,4,A)}resize(l){bN(this,l,4)}replace(l,A){A?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new ll({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,A,p,v,E){zE(l,A,p,v,E,4)}}function wN(u){const l={},A=u.resolution||256,p=u.clips?u.clips.length:1,v=u.image||new ll({width:A,height:p});if(Math.log(A)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${A}`);const E=(I,L,O)=>{l[u.evaluationKey]=O;const H=u.expression.evaluate(l);v.data[I+L+0]=Math.floor(255*H.r/H.a),v.data[I+L+1]=Math.floor(255*H.g/H.a),v.data[I+L+2]=Math.floor(255*H.b/H.a),v.data[I+L+3]=Math.floor(255*H.a)};if(u.clips)for(let I=0,L=0;I<p;++I,L+=4*A)for(let O=0,H=0;O<A;O++,H+=4){const q=O/(A-1),{start:$,end:Y}=u.clips[I];E(L,H,$*(1-q)+Y*q)}else for(let I=0,L=0;I<A;I++,L+=4)E(0,L,I/(A-1));return v}tr("AlphaImage",Wm),tr("RGBAImage",ll);class dbt extends T{createBucket(l){return new _N(l)}constructor(l){super(l,hbt),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wN({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xN;var fbt={get paint(){return xN=xN||new _({"hillshade-illumination-direction":new dr(lt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dr(lt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dr(lt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dr(lt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dr(lt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dr(lt.paint_hillshade["hillshade-accent-color"])})}};class pbt extends T{constructor(l){super(l,fbt)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const gbt=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:mbt}=gbt;var VE={exports:{}};function J_(u,l,A){A=A||2;var p,v,E,I,L,O,H,q=l&&l.length,$=q?l[0]*A:u.length,Y=BN(u,0,$,A,!0),ot=[];if(!Y||Y.next===Y.prev)return ot;if(q&&(Y=function(vt,It,Dt,te){var Qt,Kt,ve,be=[];for(Qt=0,Kt=It.length;Qt<Kt;Qt++)(ve=BN(vt,It[Qt]*te,Qt<Kt-1?It[Qt+1]*te:vt.length,te,!1))===ve.next&&(ve.steiner=!0),be.push(Cbt(ve));for(be.sort(wbt),Qt=0;Qt<be.length;Qt++)Dt=xbt(be[Qt],Dt);return Dt}(u,l,Y,A)),u.length>80*A){p=E=u[0],v=I=u[1];for(var ut=A;ut<$;ut+=A)(L=u[ut])<p&&(p=L),(O=u[ut+1])<v&&(v=O),L>E&&(E=L),O>I&&(I=O);H=(H=Math.max(E-p,I-v))!==0?32767/H:0}return $m(Y,ot,A,p,v,H,0),ot}function BN(u,l,A,p,v){var E,I;if(v===qE(u,l,A,p)>0)for(E=l;E<A;E+=p)I=SN(E,u[E],u[E+1],I);else for(E=A-p;E>=l;E-=p)I=SN(E,u[E],u[E+1],I);return I&&Y_(I,I.next)&&(Jm(I),I=I.next),I}function Vd(u,l){if(!u)return u;l||(l=u);var A,p=u;do if(A=!1,p.steiner||!Y_(p,p.next)&&Ri(p.prev,p,p.next)!==0)p=p.next;else{if(Jm(p),(p=l=p.prev)===p.next)break;A=!0}while(A||p!==l);return l}function $m(u,l,A,p,v,E,I){if(u){!I&&E&&function(q,$,Y,ot){var ut=q;do ut.z===0&&(ut.z=GE(ut.x,ut.y,$,Y,ot)),ut.prevZ=ut.prev,ut.nextZ=ut.next,ut=ut.next;while(ut!==q);ut.prevZ.nextZ=null,ut.prevZ=null,function(vt){var It,Dt,te,Qt,Kt,ve,be,Ye,cr=1;do{for(Dt=vt,vt=null,Kt=null,ve=0;Dt;){for(ve++,te=Dt,be=0,It=0;It<cr&&(be++,te=te.nextZ);It++);for(Ye=cr;be>0||Ye>0&&te;)be!==0&&(Ye===0||!te||Dt.z<=te.z)?(Qt=Dt,Dt=Dt.nextZ,be--):(Qt=te,te=te.nextZ,Ye--),Kt?Kt.nextZ=Qt:vt=Qt,Qt.prevZ=Kt,Kt=Qt;Dt=te}Kt.nextZ=null,cr*=2}while(ve>1)}(ut)}(u,p,v,E);for(var L,O,H=u;u.prev!==u.next;)if(L=u.prev,O=u.next,E?_bt(u,p,v,E):ybt(u))l.push(L.i/A|0),l.push(u.i/A|0),l.push(O.i/A|0),Jm(u),u=O.next,H=O.next;else if((u=O)===H){I?I===1?$m(u=vbt(Vd(u),l,A),l,A,p,v,E,2):I===2&&bbt(u,l,A,p,v,E):$m(Vd(u),l,A,p,v,E,1);break}}}function ybt(u){var l=u.prev,A=u,p=u.next;if(Ri(l,A,p)>=0)return!1;for(var v=l.x,E=A.x,I=p.x,L=l.y,O=A.y,H=p.y,q=v<E?v<I?v:I:E<I?E:I,$=L<O?L<H?L:H:O<H?O:H,Y=v>E?v>I?v:I:E>I?E:I,ot=L>O?L>H?L:H:O>H?O:H,ut=p.next;ut!==l;){if(ut.x>=q&&ut.x<=Y&&ut.y>=$&&ut.y<=ot&&Tp(v,L,E,O,I,H,ut.x,ut.y)&&Ri(ut.prev,ut,ut.next)>=0)return!1;ut=ut.next}return!0}function _bt(u,l,A,p){var v=u.prev,E=u,I=u.next;if(Ri(v,E,I)>=0)return!1;for(var L=v.x,O=E.x,H=I.x,q=v.y,$=E.y,Y=I.y,ot=L<O?L<H?L:H:O<H?O:H,ut=q<$?q<Y?q:Y:$<Y?$:Y,vt=L>O?L>H?L:H:O>H?O:H,It=q>$?q>Y?q:Y:$>Y?$:Y,Dt=GE(ot,ut,l,A,p),te=GE(vt,It,l,A,p),Qt=u.prevZ,Kt=u.nextZ;Qt&&Qt.z>=Dt&&Kt&&Kt.z<=te;){if(Qt.x>=ot&&Qt.x<=vt&&Qt.y>=ut&&Qt.y<=It&&Qt!==v&&Qt!==I&&Tp(L,q,O,$,H,Y,Qt.x,Qt.y)&&Ri(Qt.prev,Qt,Qt.next)>=0||(Qt=Qt.prevZ,Kt.x>=ot&&Kt.x<=vt&&Kt.y>=ut&&Kt.y<=It&&Kt!==v&&Kt!==I&&Tp(L,q,O,$,H,Y,Kt.x,Kt.y)&&Ri(Kt.prev,Kt,Kt.next)>=0))return!1;Kt=Kt.nextZ}for(;Qt&&Qt.z>=Dt;){if(Qt.x>=ot&&Qt.x<=vt&&Qt.y>=ut&&Qt.y<=It&&Qt!==v&&Qt!==I&&Tp(L,q,O,$,H,Y,Qt.x,Qt.y)&&Ri(Qt.prev,Qt,Qt.next)>=0)return!1;Qt=Qt.prevZ}for(;Kt&&Kt.z<=te;){if(Kt.x>=ot&&Kt.x<=vt&&Kt.y>=ut&&Kt.y<=It&&Kt!==v&&Kt!==I&&Tp(L,q,O,$,H,Y,Kt.x,Kt.y)&&Ri(Kt.prev,Kt,Kt.next)>=0)return!1;Kt=Kt.nextZ}return!0}function vbt(u,l,A){var p=u;do{var v=p.prev,E=p.next.next;!Y_(v,E)&&CN(v,p,p.next,E)&&Xm(v,E)&&Xm(E,v)&&(l.push(v.i/A|0),l.push(p.i/A|0),l.push(E.i/A|0),Jm(p),Jm(p.next),p=u=E),p=p.next}while(p!==u);return Vd(p)}function bbt(u,l,A,p,v,E){var I=u;do{for(var L=I.next.next;L!==I.prev;){if(I.i!==L.i&&Ebt(I,L)){var O=EN(I,L);return I=Vd(I,I.next),O=Vd(O,O.next),$m(I,l,A,p,v,E,0),void $m(O,l,A,p,v,E,0)}L=L.next}I=I.next}while(I!==u)}function wbt(u,l){return u.x-l.x}function xbt(u,l){var A=function(v,E){var I,L=E,O=v.x,H=v.y,q=-1/0;do{if(H<=L.y&&H>=L.next.y&&L.next.y!==L.y){var $=L.x+(H-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if($<=O&&$>q&&(q=$,I=L.x<L.next.x?L:L.next,$===O))return I}L=L.next}while(L!==E);if(!I)return null;var Y,ot=I,ut=I.x,vt=I.y,It=1/0;L=I;do O>=L.x&&L.x>=ut&&O!==L.x&&Tp(H<vt?O:q,H,ut,vt,H<vt?q:O,H,L.x,L.y)&&(Y=Math.abs(H-L.y)/(O-L.x),Xm(L,v)&&(Y<It||Y===It&&(L.x>I.x||L.x===I.x&&Bbt(I,L)))&&(I=L,It=Y)),L=L.next;while(L!==ot);return I}(u,l);if(!A)return l;var p=EN(A,u);return Vd(p,p.next),Vd(A,A.next)}function Bbt(u,l){return Ri(u.prev,u,l.prev)<0&&Ri(l.next,u,u.next)<0}function GE(u,l,A,p,v){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-A)*v|0)|u<<8))|u<<4))|u<<2))|u<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-p)*v|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function Cbt(u){var l=u,A=u;do(l.x<A.x||l.x===A.x&&l.y<A.y)&&(A=l),l=l.next;while(l!==u);return A}function Tp(u,l,A,p,v,E,I,L){return(v-I)*(l-L)>=(u-I)*(E-L)&&(u-I)*(p-L)>=(A-I)*(l-L)&&(A-I)*(E-L)>=(v-I)*(p-L)}function Ebt(u,l){return u.next.i!==l.i&&u.prev.i!==l.i&&!function(A,p){var v=A;do{if(v.i!==A.i&&v.next.i!==A.i&&v.i!==p.i&&v.next.i!==p.i&&CN(v,v.next,A,p))return!0;v=v.next}while(v!==A);return!1}(u,l)&&(Xm(u,l)&&Xm(l,u)&&function(A,p){var v=A,E=!1,I=(A.x+p.x)/2,L=(A.y+p.y)/2;do v.y>L!=v.next.y>L&&v.next.y!==v.y&&I<(v.next.x-v.x)*(L-v.y)/(v.next.y-v.y)+v.x&&(E=!E),v=v.next;while(v!==A);return E}(u,l)&&(Ri(u.prev,u,l.prev)||Ri(u,l.prev,l))||Y_(u,l)&&Ri(u.prev,u,u.next)>0&&Ri(l.prev,l,l.next)>0)}function Ri(u,l,A){return(l.y-u.y)*(A.x-l.x)-(l.x-u.x)*(A.y-l.y)}function Y_(u,l){return u.x===l.x&&u.y===l.y}function CN(u,l,A,p){var v=tv(Ri(u,l,A)),E=tv(Ri(u,l,p)),I=tv(Ri(A,p,u)),L=tv(Ri(A,p,l));return v!==E&&I!==L||!(v!==0||!Z_(u,A,l))||!(E!==0||!Z_(u,p,l))||!(I!==0||!Z_(A,u,p))||!(L!==0||!Z_(A,l,p))}function Z_(u,l,A){return l.x<=Math.max(u.x,A.x)&&l.x>=Math.min(u.x,A.x)&&l.y<=Math.max(u.y,A.y)&&l.y>=Math.min(u.y,A.y)}function tv(u){return u>0?1:u<0?-1:0}function Xm(u,l){return Ri(u.prev,u,u.next)<0?Ri(u,l,u.next)>=0&&Ri(u,u.prev,l)>=0:Ri(u,l,u.prev)<0||Ri(u,u.next,l)<0}function EN(u,l){var A=new jE(u.i,u.x,u.y),p=new jE(l.i,l.x,l.y),v=u.next,E=l.prev;return u.next=l,l.prev=u,A.next=v,v.prev=A,p.next=A,A.prev=p,E.next=p,p.prev=E,p}function SN(u,l,A,p){var v=new jE(u,l,A);return p?(v.next=p.next,v.prev=p,p.next.prev=v,p.next=v):(v.prev=v,v.next=v),v}function Jm(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function jE(u,l,A){this.i=u,this.x=l,this.y=A,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qE(u,l,A,p){for(var v=0,E=l,I=A-p;E<A;E+=p)v+=(u[I]-u[E])*(u[E+1]+u[I+1]),I=E;return v}VE.exports=J_,VE.exports.default=J_,J_.deviation=function(u,l,A,p){var v=l&&l.length,E=Math.abs(qE(u,0,v?l[0]*A:u.length,A));if(v)for(var I=0,L=l.length;I<L;I++)E-=Math.abs(qE(u,l[I]*A,I<L-1?l[I+1]*A:u.length,A));var O=0;for(I=0;I<p.length;I+=3){var H=p[I]*A,q=p[I+1]*A,$=p[I+2]*A;O+=Math.abs((u[H]-u[$])*(u[q+1]-u[H+1])-(u[H]-u[q])*(u[$+1]-u[H+1]))}return E===0&&O===0?0:Math.abs((O-E)/E)},J_.flatten=function(u){for(var l=u[0][0].length,A={vertices:[],holes:[],dimensions:l},p=0,v=0;v<u.length;v++){for(var E=0;E<u[v].length;E++)for(var I=0;I<l;I++)A.vertices.push(u[v][E][I]);v>0&&A.holes.push(p+=u[v-1].length)}return A};var TN=h(VE.exports);function KE(u,l,A){const p=A.patternDependencies;let v=!1;for(const E of l){const I=E.paint.get(`${u}-pattern`);I.isConstant()||(v=!0);const L=I.constantOr(null);L&&(v=!0,p[L.to]=!0,p[L.from]=!0)}return v}function WE(u,l,A,p,v){const E=v.patternDependencies;for(const I of l){const L=I.paint.get(`${u}-pattern`).value;if(L.kind!=="constant"){let O=L.evaluate({zoom:p-1},A,{},v.availableImages),H=L.evaluate({zoom:p},A,{},v.availableImages),q=L.evaluate({zoom:p+1},A,{},v.availableImages);O=O&&O.name?O.name:O,H=H&&H.name?H.name:H,q=q&&q.name?q.name:q,E[O]=!0,E[H]=!0,E[q]=!0,A.patterns[I.id]={min:O,mid:H,max:q}}}return A}class $E{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(A=>A.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ii,this.indexArray=new Ui,this.indexArray2=new ii,this.programConfigurations=new vA(l.layers,l.zoom),this.segments=new yi,this.segments2=new yi,this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(l,A,p){this.hasPattern=KE("fill",this.layers,A);const v=this.layers[0].layout.get("fill-sort-key"),E=!v.isConstant(),I=[];for(const{feature:L,id:O,index:H,sourceLayerIndex:q}of l){const $=this.layers[0]._featureFilter.needGeometry,Y=bA(L,$);if(!this.layers[0]._featureFilter.filter(new En(this.zoom),Y,p))continue;const ot=E?v.evaluate(Y,{},p,A.availableImages):void 0,ut={id:O,properties:L.properties,type:L.type,sourceLayerIndex:q,index:H,geometry:$?Y.geometry:Eu(L),patterns:{},sortKey:ot};I.push(ut)}E&&I.sort((L,O)=>L.sortKey-O.sortKey);for(const L of I){const{geometry:O,index:H,sourceLayerIndex:q}=L;if(this.hasPattern){const $=WE("fill",this.layers,L,this.zoom,A);this.patternFeatures.push($)}else this.addFeature(L,O,H,p,{});A.featureIndex.insert(l[H].feature,O,H,q,this.index)}}update(l,A,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,A,this.stateDependentLayers,p)}addFeatures(l,A,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,A,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,mbt),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,A,p,v,E){for(const I of Ul(A,500)){let L=0;for(const ot of I)L+=ot.length;const O=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),H=O.vertexLength,q=[],$=[];for(const ot of I){if(ot.length===0)continue;ot!==I[0]&&$.push(q.length/2);const ut=this.segments2.prepareSegment(ot.length,this.layoutVertexArray,this.indexArray2),vt=ut.vertexLength;this.layoutVertexArray.emplaceBack(ot[0].x,ot[0].y),this.indexArray2.emplaceBack(vt+ot.length-1,vt),q.push(ot[0].x),q.push(ot[0].y);for(let It=1;It<ot.length;It++)this.layoutVertexArray.emplaceBack(ot[It].x,ot[It].y),this.indexArray2.emplaceBack(vt+It-1,vt+It),q.push(ot[It].x),q.push(ot[It].y);ut.vertexLength+=ot.length,ut.primitiveLength+=ot.length}const Y=TN(q,$);for(let ot=0;ot<Y.length;ot+=3)this.indexArray.emplaceBack(H+Y[ot],H+Y[ot+1],H+Y[ot+2]);O.vertexLength+=L,O.primitiveLength+=Y.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,E,v)}}let IN,FN;tr("FillBucket",$E,{omit:["layers","patternFeatures"]});var Sbt={get paint(){return FN=FN||new _({"fill-antialias":new dr(lt.paint_fill["fill-antialias"]),"fill-opacity":new Fr(lt.paint_fill["fill-opacity"]),"fill-color":new Fr(lt.paint_fill["fill-color"]),"fill-outline-color":new Fr(lt.paint_fill["fill-outline-color"]),"fill-translate":new dr(lt.paint_fill["fill-translate"]),"fill-translate-anchor":new dr(lt.paint_fill["fill-translate-anchor"]),"fill-pattern":new C(lt.paint_fill["fill-pattern"])})},get layout(){return IN=IN||new _({"fill-sort-key":new Fr(lt.layout_fill["fill-sort-key"])})}};class Tbt extends T{constructor(l){super(l,Sbt)}recalculate(l,A){super.recalculate(l,A);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new $E(l)}queryRadius(){return Bh(this.paint.get("fill-translate"))}queryIntersectsFeature(l,A,p,v,E,I,L){return K_(zd(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,L),v)}isTileClipped(){return!0}}const Ibt=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Fbt=S([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Lbt}=Ibt;var Ch={},Pbt=f,LN=Ip;function Ip(u,l,A,p,v){this.properties={},this.extent=A,this.type=0,this._pbf=u,this._geometry=-1,this._keys=p,this._values=v,u.readFields(Mbt,this,l)}function Mbt(u,l,A){u==1?l.id=A.readVarint():u==2?function(p,v){for(var E=p.readVarint()+p.pos;p.pos<E;){var I=v._keys[p.readVarint()],L=v._values[p.readVarint()];v.properties[I]=L}}(A,l):u==3?l.type=A.readVarint():u==4&&(l._geometry=A.pos)}function Ubt(u){for(var l,A,p=0,v=0,E=u.length,I=E-1;v<E;I=v++)p+=((A=u[I]).x-(l=u[v]).x)*(l.y+A.y);return p}Ip.types=["Unknown","Point","LineString","Polygon"],Ip.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var l,A=u.readVarint()+u.pos,p=1,v=0,E=0,I=0,L=[];u.pos<A;){if(v<=0){var O=u.readVarint();p=7&O,v=O>>3}if(v--,p===1||p===2)E+=u.readSVarint(),I+=u.readSVarint(),p===1&&(l&&L.push(l),l=[]),l.push(new Pbt(E,I));else{if(p!==7)throw new Error("unknown command "+p);l&&l.push(l[0].clone())}}return l&&L.push(l),L},Ip.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var l=u.readVarint()+u.pos,A=1,p=0,v=0,E=0,I=1/0,L=-1/0,O=1/0,H=-1/0;u.pos<l;){if(p<=0){var q=u.readVarint();A=7&q,p=q>>3}if(p--,A===1||A===2)(v+=u.readSVarint())<I&&(I=v),v>L&&(L=v),(E+=u.readSVarint())<O&&(O=E),E>H&&(H=E);else if(A!==7)throw new Error("unknown command "+A)}return[I,O,L,H]},Ip.prototype.toGeoJSON=function(u,l,A){var p,v,E=this.extent*Math.pow(2,A),I=this.extent*u,L=this.extent*l,O=this.loadGeometry(),H=Ip.types[this.type];function q(ot){for(var ut=0;ut<ot.length;ut++){var vt=ot[ut];ot[ut]=[360*(vt.x+I)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(vt.y+L)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(p=0;p<O.length;p++)$[p]=O[p][0];q(O=$);break;case 2:for(p=0;p<O.length;p++)q(O[p]);break;case 3:for(O=function(ot){var ut=ot.length;if(ut<=1)return[ot];for(var vt,It,Dt=[],te=0;te<ut;te++){var Qt=Ubt(ot[te]);Qt!==0&&(It===void 0&&(It=Qt<0),It===Qt<0?(vt&&Dt.push(vt),vt=[ot[te]]):vt.push(ot[te]))}return vt&&Dt.push(vt),Dt}(O),p=0;p<O.length;p++)for(v=0;v<O[p].length;v++)q(O[p][v])}O.length===1?O=O[0]:H="Multi"+H;var Y={type:"Feature",geometry:{type:H,coordinates:O},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};var Rbt=LN,PN=MN;function MN(u,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(Obt,this,l),this.length=this._features.length}function Obt(u,l,A){u===15?l.version=A.readVarint():u===1?l.name=A.readString():u===5?l.extent=A.readVarint():u===2?l._features.push(A.pos):u===3?l._keys.push(A.readString()):u===4&&l._values.push(function(p){for(var v=null,E=p.readVarint()+p.pos;p.pos<E;){var I=p.readVarint()>>3;v=I===1?p.readString():I===2?p.readFloat():I===3?p.readDouble():I===4?p.readVarint64():I===5?p.readVarint():I===6?p.readSVarint():I===7?p.readBoolean():null}return v}(A))}MN.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var l=this._pbf.readVarint()+this._pbf.pos;return new Rbt(this._pbf,l,this.extent,this._keys,this._values)};var Dbt=PN;function Nbt(u,l,A){if(u===3){var p=new Dbt(A,A.readVarint()+A.pos);p.length&&(l[p.name]=p)}}Ch.VectorTile=function(u,l){this.layers=u.readFields(Nbt,{},l)},Ch.VectorTileFeature=LN,Ch.VectorTileLayer=PN;const kbt=Ch.VectorTileFeature.types,XE=Math.pow(2,13);function Ym(u,l,A,p,v,E,I,L){u.emplaceBack(l,A,2*Math.floor(p*XE)+I,v*XE*2,E*XE*2,Math.round(L))}class JE{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(A=>A.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new qi,this.centroidVertexArray=new ci,this.indexArray=new Ui,this.programConfigurations=new vA(l.layers,l.zoom),this.segments=new yi,this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(l,A,p){this.features=[],this.hasPattern=KE("fill-extrusion",this.layers,A);for(const{feature:v,id:E,index:I,sourceLayerIndex:L}of l){const O=this.layers[0]._featureFilter.needGeometry,H=bA(v,O);if(!this.layers[0]._featureFilter.filter(new En(this.zoom),H,p))continue;const q={id:E,sourceLayerIndex:L,index:I,geometry:O?H.geometry:Eu(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(WE("fill-extrusion",this.layers,q,this.zoom,A)):this.addFeature(q,q.geometry,I,p,{}),A.featureIndex.insert(v,q.geometry,I,L,this.index,!0)}}addFeatures(l,A,p){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,A,p)}}update(l,A,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,A,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Lbt),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,Fbt.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,A,p,v,E){const I={x:0,y:0,vertexCount:0};for(const L of Ul(A,500)){let O=0;for(const ut of L)O+=ut.length;let H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ut of L){if(ut.length===0||Hbt(ut))continue;let vt=0;for(let It=0;It<ut.length;It++){const Dt=ut[It];if(It>=1){const te=ut[It-1];if(!Qbt(Dt,te)){H.vertexLength+4>yi.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Qt=Dt.sub(te)._perp()._unit(),Kt=te.dist(Dt);vt+Kt>32768&&(vt=0),Ym(this.layoutVertexArray,Dt.x,Dt.y,Qt.x,Qt.y,0,0,vt),Ym(this.layoutVertexArray,Dt.x,Dt.y,Qt.x,Qt.y,0,1,vt),I.x+=2*Dt.x,I.y+=2*Dt.y,I.vertexCount+=2,vt+=Kt,Ym(this.layoutVertexArray,te.x,te.y,Qt.x,Qt.y,0,0,vt),Ym(this.layoutVertexArray,te.x,te.y,Qt.x,Qt.y,0,1,vt),I.x+=2*te.x,I.y+=2*te.y,I.vertexCount+=2;const ve=H.vertexLength;this.indexArray.emplaceBack(ve,ve+2,ve+1),this.indexArray.emplaceBack(ve+1,ve+2,ve+3),H.vertexLength+=4,H.primitiveLength+=2}}}}if(H.vertexLength+O>yi.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray)),kbt[l.type]!=="Polygon")continue;const q=[],$=[],Y=H.vertexLength;for(const ut of L)if(ut.length!==0){ut!==L[0]&&$.push(q.length/2);for(let vt=0;vt<ut.length;vt++){const It=ut[vt];Ym(this.layoutVertexArray,It.x,It.y,0,0,1,1,0),I.x+=It.x,I.y+=It.y,I.vertexCount+=1,q.push(It.x),q.push(It.y)}}const ot=TN(q,$);for(let ut=0;ut<ot.length;ut+=3)this.indexArray.emplaceBack(Y+ot[ut],Y+ot[ut+2],Y+ot[ut+1]);H.primitiveLength+=ot.length/3,H.vertexLength+=O}for(let L=0;L<I.vertexCount;L++)this.centroidVertexArray.emplaceBack(Math.floor(I.x/I.vertexCount),Math.floor(I.y/I.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,E,v)}}function Qbt(u,l){return u.x===l.x&&(u.x<0||u.x>_i)||u.y===l.y&&(u.y<0||u.y>_i)}function Hbt(u){return u.every(l=>l.x<0)||u.every(l=>l.x>_i)||u.every(l=>l.y<0)||u.every(l=>l.y>_i)}let UN;tr("FillExtrusionBucket",JE,{omit:["layers","features"]});var zbt={get paint(){return UN=UN||new _({"fill-extrusion-opacity":new dr(lt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fr(lt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dr(lt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dr(lt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new C(lt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fr(lt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fr(lt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dr(lt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Vbt extends T{constructor(l){super(l,zbt)}createBucket(l){return new JE(l)}queryRadius(){return Bh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,A,p,v,E,I,L,O){const H=zd(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,L),q=this.paint.get("fill-extrusion-height").evaluate(A,p),$=this.paint.get("fill-extrusion-base").evaluate(A,p),Y=function(ut,vt,It,Dt){const te=[];for(const Qt of ut){const Kt=[Qt.x,Qt.y,0,1];X_(Kt,Kt,vt),te.push(new b(Kt[0]/Kt[3],Kt[1]/Kt[3]))}return te}(H,O),ot=function(ut,vt,It,Dt){const te=[],Qt=[],Kt=Dt[8]*vt,ve=Dt[9]*vt,be=Dt[10]*vt,Ye=Dt[11]*vt,cr=Dt[8]*It,We=Dt[9]*It,Ge=Dt[10]*It,ir=Dt[11]*It;for(const br of ut){const Xe=[],xe=[];for(const ur of br){const ar=ur.x,Kr=ur.y,Vn=Dt[0]*ar+Dt[4]*Kr+Dt[12],Gn=Dt[1]*ar+Dt[5]*Kr+Dt[13],Wi=Dt[2]*ar+Dt[6]*Kr+Dt[14],ul=Dt[3]*ar+Dt[7]*Kr+Dt[15],oo=Wi+be,As=ul+Ye,Ss=Vn+cr,ao=Gn+We,Uo=Wi+Ge,lo=ul+ir,$i=new b((Vn+Kt)/As,(Gn+ve)/As);$i.z=oo/As,Xe.push($i);const vs=new b(Ss/lo,ao/lo);vs.z=Uo/lo,xe.push(vs)}te.push(Xe),Qt.push(xe)}return[te,Qt]}(v,$,q,O);return function(ut,vt,It){let Dt=1/0;K_(It,vt)&&(Dt=RN(It,vt[0]));for(let te=0;te<vt.length;te++){const Qt=vt[te],Kt=ut[te];for(let ve=0;ve<Qt.length-1;ve++){const be=Qt[ve],Ye=[be,Qt[ve+1],Kt[ve+1],Kt[ve],be];j_(It,Ye)&&(Dt=Math.min(Dt,RN(It,Ye)))}}return Dt!==1/0&&Dt}(ot[0],ot[1],Y)}}function Zm(u,l){return u.x*l.x+u.y*l.y}function RN(u,l){if(u.length===1){let A=0;const p=l[A++];let v;for(;!v||p.equals(v);)if(v=l[A++],!v)return 1/0;for(;A<l.length;A++){const E=l[A],I=u[0],L=v.sub(p),O=E.sub(p),H=I.sub(p),q=Zm(L,L),$=Zm(L,O),Y=Zm(O,O),ot=Zm(H,L),ut=Zm(H,O),vt=q*Y-$*$,It=(Y*ot-$*ut)/vt,Dt=(q*ut-$*ot)/vt,te=p.z*(1-It-Dt)+v.z*It+E.z*Dt;if(isFinite(te))return te}return 1/0}{let A=1/0;for(const p of l)A=Math.min(A,p.z);return A}}const Gbt=S([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:jbt}=Gbt,qbt=S([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Kbt}=qbt,Wbt=Ch.VectorTileFeature.types,$bt=Math.cos(Math.PI/180*37.5),ON=Math.pow(2,14)/.5;class YE{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(A=>A.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(A=>{this.gradients[A.id]={}}),this.layoutVertexArray=new no,this.layoutVertexArray2=new Fi,this.indexArray=new Ui,this.programConfigurations=new vA(l.layers,l.zoom),this.segments=new yi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id)}populate(l,A,p){this.hasPattern=KE("line",this.layers,A);const v=this.layers[0].layout.get("line-sort-key"),E=!v.isConstant(),I=[];for(const{feature:L,id:O,index:H,sourceLayerIndex:q}of l){const $=this.layers[0]._featureFilter.needGeometry,Y=bA(L,$);if(!this.layers[0]._featureFilter.filter(new En(this.zoom),Y,p))continue;const ot=E?v.evaluate(Y,{},p):void 0,ut={id:O,properties:L.properties,type:L.type,sourceLayerIndex:q,index:H,geometry:$?Y.geometry:Eu(L),patterns:{},sortKey:ot};I.push(ut)}E&&I.sort((L,O)=>L.sortKey-O.sortKey);for(const L of I){const{geometry:O,index:H,sourceLayerIndex:q}=L;if(this.hasPattern){const $=WE("line",this.layers,L,this.zoom,A);this.patternFeatures.push($)}else this.addFeature(L,O,H,p,{});A.featureIndex.insert(l[H].feature,O,H,q,this.index)}}update(l,A,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,A,this.stateDependentLayers,p)}addFeatures(l,A,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,A,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,Kbt)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,jbt),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,A,p,v,E){const I=this.layers[0].layout,L=I.get("line-join").evaluate(l,{}),O=I.get("line-cap"),H=I.get("line-miter-limit"),q=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const $ of A)this.addLine($,l,L,O,H,q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,E,v)}addLine(l,A,p,v,E,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Dt=0;Dt<l.length-1;Dt++)this.totalDistance+=l[Dt].dist(l[Dt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=Wbt[A.type]==="Polygon";let O=l.length;for(;O>=2&&l[O-1].equals(l[O-2]);)O--;let H=0;for(;H<O-1&&l[H].equals(l[H+1]);)H++;if(O<(L?3:2))return;p==="bevel"&&(E=1.05);const q=this.overscaling<=16?15*_i/(512*this.overscaling):0,$=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let Y,ot,ut,vt,It;this.e1=this.e2=-1,L&&(Y=l[O-2],It=l[H].sub(Y)._unit()._perp());for(let Dt=H;Dt<O;Dt++){if(ut=Dt===O-1?L?l[H+1]:void 0:l[Dt+1],ut&&l[Dt].equals(ut))continue;It&&(vt=It),Y&&(ot=Y),Y=l[Dt],It=ut?ut.sub(Y)._unit()._perp():vt,vt=vt||It;let te=vt.add(It);te.x===0&&te.y===0||te._unit();const Qt=vt.x*It.x+vt.y*It.y,Kt=te.x*It.x+te.y*It.y,ve=Kt!==0?1/Kt:1/0,be=2*Math.sqrt(2-2*Kt),Ye=Kt<$bt&&ot&&ut,cr=vt.x*It.y-vt.y*It.x>0;if(Ye&&Dt>H){const ir=Y.dist(ot);if(ir>2*q){const br=Y.sub(Y.sub(ot)._mult(q/ir)._round());this.updateDistance(ot,br),this.addCurrentVertex(br,vt,0,0,$),ot=br}}const We=ot&&ut;let Ge=We?p:L?"butt":v;if(We&&Ge==="round"&&(ve<I?Ge="miter":ve<=2&&(Ge="fakeround")),Ge==="miter"&&ve>E&&(Ge="bevel"),Ge==="bevel"&&(ve>2&&(Ge="flipbevel"),ve<E&&(Ge="miter")),ot&&this.updateDistance(ot,Y),Ge==="miter")te._mult(ve),this.addCurrentVertex(Y,te,0,0,$);else if(Ge==="flipbevel"){if(ve>100)te=It.mult(-1);else{const ir=ve*vt.add(It).mag()/vt.sub(It).mag();te._perp()._mult(ir*(cr?-1:1))}this.addCurrentVertex(Y,te,0,0,$),this.addCurrentVertex(Y,te.mult(-1),0,0,$)}else if(Ge==="bevel"||Ge==="fakeround"){const ir=-Math.sqrt(ve*ve-1),br=cr?ir:0,Xe=cr?0:ir;if(ot&&this.addCurrentVertex(Y,vt,br,Xe,$),Ge==="fakeround"){const xe=Math.round(180*be/Math.PI/20);for(let ur=1;ur<xe;ur++){let ar=ur/xe;if(ar!==.5){const Vn=ar-.5;ar+=ar*Vn*(ar-1)*((1.0904+Qt*(Qt*(3.55645-1.43519*Qt)-3.2452))*Vn*Vn+(.848013+Qt*(.215638*Qt-1.06021)))}const Kr=It.sub(vt)._mult(ar)._add(vt)._unit()._mult(cr?-1:1);this.addHalfVertex(Y,Kr.x,Kr.y,!1,cr,0,$)}}ut&&this.addCurrentVertex(Y,It,-br,-Xe,$)}else if(Ge==="butt")this.addCurrentVertex(Y,te,0,0,$);else if(Ge==="square"){const ir=ot?1:-1;this.addCurrentVertex(Y,te,ir,ir,$)}else Ge==="round"&&(ot&&(this.addCurrentVertex(Y,vt,0,0,$),this.addCurrentVertex(Y,vt,1,1,$,!0)),ut&&(this.addCurrentVertex(Y,It,-1,-1,$,!0),this.addCurrentVertex(Y,It,0,0,$)));if(Ye&&Dt<O-1){const ir=Y.dist(ut);if(ir>2*q){const br=Y.add(ut.sub(Y)._mult(q/ir)._round());this.updateDistance(Y,br),this.addCurrentVertex(br,It,0,0,$),Y=br}}}}addCurrentVertex(l,A,p,v,E){let I=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const L=A.y*v-A.x,O=-A.y-A.x*v;this.addHalfVertex(l,A.x+A.y*p,A.y-A.x*p,I,!1,p,E),this.addHalfVertex(l,L,O,I,!0,-v,E),this.distance>ON/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,A,p,v,E,I))}addHalfVertex(l,A,p,v,E,I,L){let{x:O,y:H}=l;const q=.5*(this.lineClips?this.scaledDistance*(ON-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((O<<1)+(v?1:0),(H<<1)+(E?1:0),Math.round(63*A)+128,Math.round(63*p)+128,1+(I===0?0:I<0?-1:1)|(63&q)<<2,q>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const $=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,$),L.primitiveLength++),E?this.e2=$:this.e1=$}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,A){this.distance+=l.dist(A),this.updateScaledDistance()}}let DN,NN;tr("LineBucket",YE,{omit:["layers","patternFeatures"]});var kN={get paint(){return NN=NN||new _({"line-opacity":new Fr(lt.paint_line["line-opacity"]),"line-color":new Fr(lt.paint_line["line-color"]),"line-translate":new dr(lt.paint_line["line-translate"]),"line-translate-anchor":new dr(lt.paint_line["line-translate-anchor"]),"line-width":new Fr(lt.paint_line["line-width"]),"line-gap-width":new Fr(lt.paint_line["line-gap-width"]),"line-offset":new Fr(lt.paint_line["line-offset"]),"line-blur":new Fr(lt.paint_line["line-blur"]),"line-dasharray":new c(lt.paint_line["line-dasharray"]),"line-pattern":new C(lt.paint_line["line-pattern"]),"line-gradient":new d(lt.paint_line["line-gradient"])})},get layout(){return DN=DN||new _({"line-cap":new dr(lt.layout_line["line-cap"]),"line-join":new Fr(lt.layout_line["line-join"]),"line-miter-limit":new dr(lt.layout_line["line-miter-limit"]),"line-round-limit":new dr(lt.layout_line["line-round-limit"]),"line-sort-key":new Fr(lt.layout_line["line-sort-key"])})}};class Xbt extends Fr{possiblyEvaluate(l,A){return A=new En(Math.floor(A.zoom),{now:A.now,fadeDuration:A.fadeDuration,zoomHistory:A.zoomHistory,transition:A.transition}),super.possiblyEvaluate(l,A)}evaluate(l,A,p,v){return A=mt({},A,{zoom:Math.floor(A.zoom)}),super.evaluate(l,A,p,v)}}let ev;class Jbt extends T{constructor(l){super(l,kN),this.gradientVersion=0,ev||(ev=new Xbt(kN.paint.properties["line-width"].specification),ev.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const A=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(A)&&A._styleExpression.expression instanceof Ze,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,A){super.recalculate(l,A),this.paint._values["line-floorwidth"]=ev.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new YE(l)}queryRadius(l){const A=l,p=QN(Iu("line-width",this,A),Iu("line-gap-width",this,A)),v=Iu("line-offset",this,A);return p/2+Math.abs(v)+Bh(this.paint.get("line-translate"))}queryIntersectsFeature(l,A,p,v,E,I,L){const O=zd(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,L),H=L/2*QN(this.paint.get("line-width").evaluate(A,p),this.paint.get("line-gap-width").evaluate(A,p)),q=this.paint.get("line-offset").evaluate(A,p);return q&&(v=function($,Y){const ot=[];for(let ut=0;ut<$.length;ut++){const vt=$[ut],It=[];for(let Dt=0;Dt<vt.length;Dt++){const te=vt[Dt-1],Qt=vt[Dt],Kt=vt[Dt+1],ve=Dt===0?new b(0,0):Qt.sub(te)._unit()._perp(),be=Dt===vt.length-1?new b(0,0):Kt.sub(Qt)._unit()._perp(),Ye=ve._add(be)._unit(),cr=Ye.x*be.x+Ye.y*be.y;cr!==0&&Ye._mult(1/cr),It.push(Ye._mult(Y)._add(Qt))}ot.push(It)}return ot}(v,q*L)),function($,Y,ot){for(let ut=0;ut<Y.length;ut++){const vt=Y[ut];if($.length>=3){for(let It=0;It<vt.length;It++)if(ra($,vt[It]))return!0}if(W_($,vt,ot))return!0}return!1}(O,v,H)}isTileClipped(){return!0}}function QN(u,l){return l>0?l+2*u:u}const Ybt=S([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zbt=S([{name:"a_projected_pos",components:3,type:"Float32"}],4);S([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const twt=S([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);S([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const HN=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ewt=S([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function rwt(u,l,A){return u.sections.forEach(p=>{p.text=function(v,E,I){const L=E.layout.get("text-transform").evaluate(I,{});return L==="uppercase"?v=v.toLocaleUpperCase():L==="lowercase"&&(v=v.toLocaleLowerCase()),ql.applyArabicShaping&&(v=ql.applyArabicShaping(v)),v}(p.text,l,A)}),u}S([{name:"triangle",components:3,type:"Uint16"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),S([{type:"Float32",name:"offsetX"}]),S([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),S([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const t0={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var us=24,zN=zn,VN=function(u,l,A,p,v){var E,I,L=8*v-p-1,O=(1<<L)-1,H=O>>1,q=-7,$=v-1,Y=-1,ot=u[l+$];for($+=Y,E=ot&(1<<-q)-1,ot>>=-q,q+=L;q>0;E=256*E+u[l+$],$+=Y,q-=8);for(I=E&(1<<-q)-1,E>>=-q,q+=p;q>0;I=256*I+u[l+$],$+=Y,q-=8);if(E===0)E=1-H;else{if(E===O)return I?NaN:1/0*(ot?-1:1);I+=Math.pow(2,p),E-=H}return(ot?-1:1)*I*Math.pow(2,E-p)},GN=function(u,l,A,p,v,E){var I,L,O,H=8*E-v-1,q=(1<<H)-1,$=q>>1,Y=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,ot=0,ut=1,vt=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(L=isNaN(l)?1:0,I=q):(I=Math.floor(Math.log(l)/Math.LN2),l*(O=Math.pow(2,-I))<1&&(I--,O*=2),(l+=I+$>=1?Y/O:Y*Math.pow(2,1-$))*O>=2&&(I++,O/=2),I+$>=q?(L=0,I=q):I+$>=1?(L=(l*O-1)*Math.pow(2,v),I+=$):(L=l*Math.pow(2,$-1)*Math.pow(2,v),I=0));v>=8;u[A+ot]=255&L,ot+=ut,L/=256,v-=8);for(I=I<<v|L,H+=v;H>0;u[A+ot]=255&I,ot+=ut,I/=256,H-=8);u[A+ot-ut]|=128*vt};function zn(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}zn.Varint=0,zn.Fixed64=1,zn.Bytes=2,zn.Fixed32=5;var ZE=4294967296,jN=1/ZE,qN=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function wA(u){return u.type===zn.Bytes?u.readVarint()+u.pos:u.pos+1}function Fp(u,l,A){return A?4294967296*l+(u>>>0):4294967296*(l>>>0)+(u>>>0)}function KN(u,l,A){var p=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));A.realloc(p);for(var v=A.pos-1;v>=u;v--)A.buf[v+p]=A.buf[v]}function nwt(u,l){for(var A=0;A<u.length;A++)l.writeVarint(u[A])}function iwt(u,l){for(var A=0;A<u.length;A++)l.writeSVarint(u[A])}function swt(u,l){for(var A=0;A<u.length;A++)l.writeFloat(u[A])}function owt(u,l){for(var A=0;A<u.length;A++)l.writeDouble(u[A])}function awt(u,l){for(var A=0;A<u.length;A++)l.writeBoolean(u[A])}function lwt(u,l){for(var A=0;A<u.length;A++)l.writeFixed32(u[A])}function cwt(u,l){for(var A=0;A<u.length;A++)l.writeSFixed32(u[A])}function uwt(u,l){for(var A=0;A<u.length;A++)l.writeFixed64(u[A])}function Awt(u,l){for(var A=0;A<u.length;A++)l.writeSFixed64(u[A])}function rv(u,l){return(u[l]|u[l+1]<<8|u[l+2]<<16)+16777216*u[l+3]}function Lp(u,l,A){u[A]=l,u[A+1]=l>>>8,u[A+2]=l>>>16,u[A+3]=l>>>24}function WN(u,l){return(u[l]|u[l+1]<<8|u[l+2]<<16)+(u[l+3]<<24)}zn.prototype={destroy:function(){this.buf=null},readFields:function(u,l,A){for(A=A||this.length;this.pos<A;){var p=this.readVarint(),v=p>>3,E=this.pos;this.type=7&p,u(v,l,this),this.pos===E&&this.skip(p)}return l},readMessage:function(u,l){return this.readFields(u,l,this.readVarint()+this.pos)},readFixed32:function(){var u=rv(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=WN(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=rv(this.buf,this.pos)+rv(this.buf,this.pos+4)*ZE;return this.pos+=8,u},readSFixed64:function(){var u=rv(this.buf,this.pos)+WN(this.buf,this.pos+4)*ZE;return this.pos+=8,u},readFloat:function(){var u=VN(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=VN(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var l,A,p=this.buf;return l=127&(A=p[this.pos++]),A<128?l:(l|=(127&(A=p[this.pos++]))<<7,A<128?l:(l|=(127&(A=p[this.pos++]))<<14,A<128?l:(l|=(127&(A=p[this.pos++]))<<21,A<128?l:function(v,E,I){var L,O,H=I.buf;if(L=(112&(O=H[I.pos++]))>>4,O<128||(L|=(127&(O=H[I.pos++]))<<3,O<128)||(L|=(127&(O=H[I.pos++]))<<10,O<128)||(L|=(127&(O=H[I.pos++]))<<17,O<128)||(L|=(127&(O=H[I.pos++]))<<24,O<128)||(L|=(1&(O=H[I.pos++]))<<31,O<128))return Fp(v,L,E);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(A=p[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,l=this.pos;return this.pos=u,u-l>=12&&qN?function(A,p,v){return qN.decode(A.subarray(p,v))}(this.buf,l,u):function(A,p,v){for(var E="",I=p;I<v;){var L,O,H,q=A[I],$=null,Y=q>239?4:q>223?3:q>191?2:1;if(I+Y>v)break;Y===1?q<128&&($=q):Y===2?(192&(L=A[I+1]))==128&&($=(31&q)<<6|63&L)<=127&&($=null):Y===3?(O=A[I+2],(192&(L=A[I+1]))==128&&(192&O)==128&&(($=(15&q)<<12|(63&L)<<6|63&O)<=2047||$>=55296&&$<=57343)&&($=null)):Y===4&&(O=A[I+2],H=A[I+3],(192&(L=A[I+1]))==128&&(192&O)==128&&(192&H)==128&&(($=(15&q)<<18|(63&L)<<12|(63&O)<<6|63&H)<=65535||$>=1114112)&&($=null)),$===null?($=65533,Y=1):$>65535&&($-=65536,E+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),E+=String.fromCharCode($),I+=Y}return E}(this.buf,l,u)},readBytes:function(){var u=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,u);return this.pos=u,l},readPackedVarint:function(u,l){if(this.type!==zn.Bytes)return u.push(this.readVarint(l));var A=wA(this);for(u=u||[];this.pos<A;)u.push(this.readVarint(l));return u},readPackedSVarint:function(u){if(this.type!==zn.Bytes)return u.push(this.readSVarint());var l=wA(this);for(u=u||[];this.pos<l;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==zn.Bytes)return u.push(this.readBoolean());var l=wA(this);for(u=u||[];this.pos<l;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==zn.Bytes)return u.push(this.readFloat());var l=wA(this);for(u=u||[];this.pos<l;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==zn.Bytes)return u.push(this.readDouble());var l=wA(this);for(u=u||[];this.pos<l;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==zn.Bytes)return u.push(this.readFixed32());var l=wA(this);for(u=u||[];this.pos<l;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==zn.Bytes)return u.push(this.readSFixed32());var l=wA(this);for(u=u||[];this.pos<l;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==zn.Bytes)return u.push(this.readFixed64());var l=wA(this);for(u=u||[];this.pos<l;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==zn.Bytes)return u.push(this.readSFixed64());var l=wA(this);for(u=u||[];this.pos<l;)u.push(this.readSFixed64());return u},skip:function(u){var l=7&u;if(l===zn.Varint)for(;this.buf[this.pos++]>127;);else if(l===zn.Bytes)this.pos=this.readVarint()+this.pos;else if(l===zn.Fixed32)this.pos+=4;else{if(l!==zn.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(u,l){this.writeVarint(u<<3|l)},realloc:function(u){for(var l=this.length||16;l<this.pos+u;)l*=2;if(l!==this.length){var A=new Uint8Array(l);A.set(this.buf),this.buf=A,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),Lp(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),Lp(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),Lp(this.buf,-1&u,this.pos),Lp(this.buf,Math.floor(u*jN),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),Lp(this.buf,-1&u,this.pos),Lp(this.buf,Math.floor(u*jN),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(l,A){var p,v;if(l>=0?(p=l%4294967296|0,v=l/4294967296|0):(v=~(-l/4294967296),4294967295^(p=~(-l%4294967296))?p=p+1|0:(p=0,v=v+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");A.realloc(10),function(E,I,L){L.buf[L.pos++]=127&E|128,E>>>=7,L.buf[L.pos++]=127&E|128,E>>>=7,L.buf[L.pos++]=127&E|128,E>>>=7,L.buf[L.pos++]=127&E|128,L.buf[L.pos]=127&(E>>>=7)}(p,0,A),function(E,I){var L=(7&E)<<4;I.buf[I.pos++]|=L|((E>>>=3)?128:0),E&&(I.buf[I.pos++]=127&E|((E>>>=7)?128:0),E&&(I.buf[I.pos++]=127&E|((E>>>=7)?128:0),E&&(I.buf[I.pos++]=127&E|((E>>>=7)?128:0),E&&(I.buf[I.pos++]=127&E|((E>>>=7)?128:0),E&&(I.buf[I.pos++]=127&E)))))}(v,A)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var l=this.pos;this.pos=function(p,v,E){for(var I,L,O=0;O<v.length;O++){if((I=v.charCodeAt(O))>55295&&I<57344){if(!L){I>56319||O+1===v.length?(p[E++]=239,p[E++]=191,p[E++]=189):L=I;continue}if(I<56320){p[E++]=239,p[E++]=191,p[E++]=189,L=I;continue}I=L-55296<<10|I-56320|65536,L=null}else L&&(p[E++]=239,p[E++]=191,p[E++]=189,L=null);I<128?p[E++]=I:(I<2048?p[E++]=I>>6|192:(I<65536?p[E++]=I>>12|224:(p[E++]=I>>18|240,p[E++]=I>>12&63|128),p[E++]=I>>6&63|128),p[E++]=63&I|128)}return E}(this.buf,u,this.pos);var A=this.pos-l;A>=128&&KN(l,A,this),this.pos=l-1,this.writeVarint(A),this.pos+=A},writeFloat:function(u){this.realloc(4),GN(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),GN(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var l=u.length;this.writeVarint(l),this.realloc(l);for(var A=0;A<l;A++)this.buf[this.pos++]=u[A]},writeRawMessage:function(u,l){this.pos++;var A=this.pos;u(l,this);var p=this.pos-A;p>=128&&KN(A,p,this),this.pos=A-1,this.writeVarint(p),this.pos+=p},writeMessage:function(u,l,A){this.writeTag(u,zn.Bytes),this.writeRawMessage(l,A)},writePackedVarint:function(u,l){l.length&&this.writeMessage(u,nwt,l)},writePackedSVarint:function(u,l){l.length&&this.writeMessage(u,iwt,l)},writePackedBoolean:function(u,l){l.length&&this.writeMessage(u,awt,l)},writePackedFloat:function(u,l){l.length&&this.writeMessage(u,swt,l)},writePackedDouble:function(u,l){l.length&&this.writeMessage(u,owt,l)},writePackedFixed32:function(u,l){l.length&&this.writeMessage(u,lwt,l)},writePackedSFixed32:function(u,l){l.length&&this.writeMessage(u,cwt,l)},writePackedFixed64:function(u,l){l.length&&this.writeMessage(u,uwt,l)},writePackedSFixed64:function(u,l){l.length&&this.writeMessage(u,Awt,l)},writeBytesField:function(u,l){this.writeTag(u,zn.Bytes),this.writeBytes(l)},writeFixed32Field:function(u,l){this.writeTag(u,zn.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(u,l){this.writeTag(u,zn.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(u,l){this.writeTag(u,zn.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(u,l){this.writeTag(u,zn.Fixed64),this.writeSFixed64(l)},writeVarintField:function(u,l){this.writeTag(u,zn.Varint),this.writeVarint(l)},writeSVarintField:function(u,l){this.writeTag(u,zn.Varint),this.writeSVarint(l)},writeStringField:function(u,l){this.writeTag(u,zn.Bytes),this.writeString(l)},writeFloatField:function(u,l){this.writeTag(u,zn.Fixed32),this.writeFloat(l)},writeDoubleField:function(u,l){this.writeTag(u,zn.Fixed64),this.writeDouble(l)},writeBooleanField:function(u,l){this.writeVarintField(u,!!l)}};var tS=h(zN);const eS=3;function hwt(u,l,A){u===1&&A.readMessage(dwt,l)}function dwt(u,l,A){if(u===3){const{id:p,bitmap:v,width:E,height:I,left:L,top:O,advance:H}=A.readMessage(fwt,{});l.push({id:p,bitmap:new Wm({width:E+2*eS,height:I+2*eS},v),metrics:{width:E,height:I,left:L,top:O,advance:H}})}}function fwt(u,l,A){u===1?l.id=A.readVarint():u===2?l.bitmap=A.readBytes():u===3?l.width=A.readVarint():u===4?l.height=A.readVarint():u===5?l.left=A.readSVarint():u===6?l.top=A.readSVarint():u===7&&(l.advance=A.readVarint())}const $N=eS;function XN(u){let l=0,A=0;for(const I of u)l+=I.w*I.h,A=Math.max(A,I.w);u.sort((I,L)=>L.h-I.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),A),h:1/0}];let v=0,E=0;for(const I of u)for(let L=p.length-1;L>=0;L--){const O=p[L];if(!(I.w>O.w||I.h>O.h)){if(I.x=O.x,I.y=O.y,E=Math.max(E,I.y+I.h),v=Math.max(v,I.x+I.w),I.w===O.w&&I.h===O.h){const H=p.pop();L<p.length&&(p[L]=H)}else I.h===O.h?(O.x+=I.w,O.w-=I.w):I.w===O.w?(O.y+=I.h,O.h-=I.h):(p.push({x:O.x+I.w,y:O.y,w:O.w-I.w,h:I.h}),O.y+=I.h,O.h-=I.h);break}}return{w:v,h:E,fill:l/(v*E)||0}}const na=1;class rS{constructor(l,A){let{pixelRatio:p,version:v,stretchX:E,stretchY:I,content:L,textFitWidth:O,textFitHeight:H}=A;this.paddedRect=l,this.pixelRatio=p,this.stretchX=E,this.stretchY=I,this.content=L,this.version=v,this.textFitWidth=O,this.textFitHeight=H}get tl(){return[this.paddedRect.x+na,this.paddedRect.y+na]}get br(){return[this.paddedRect.x+this.paddedRect.w-na,this.paddedRect.y+this.paddedRect.h-na]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*na)/this.pixelRatio,(this.paddedRect.h-2*na)/this.pixelRatio]}}class JN{constructor(l,A){const p={},v={};this.haveRenderCallbacks=[];const E=[];this.addImages(l,p,E),this.addImages(A,v,E);const{w:I,h:L}=XN(E),O=new ll({width:I||1,height:L||1});for(const H in l){const q=l[H],$=p[H].paddedRect;ll.copy(q.data,O,{x:0,y:0},{x:$.x+na,y:$.y+na},q.data)}for(const H in A){const q=A[H],$=v[H].paddedRect,Y=$.x+na,ot=$.y+na,ut=q.data.width,vt=q.data.height;ll.copy(q.data,O,{x:0,y:0},{x:Y,y:ot},q.data),ll.copy(q.data,O,{x:0,y:vt-1},{x:Y,y:ot-1},{width:ut,height:1}),ll.copy(q.data,O,{x:0,y:0},{x:Y,y:ot+vt},{width:ut,height:1}),ll.copy(q.data,O,{x:ut-1,y:0},{x:Y-1,y:ot},{width:1,height:vt}),ll.copy(q.data,O,{x:0,y:0},{x:Y+ut,y:ot},{width:1,height:vt})}this.image=O,this.iconPositions=p,this.patternPositions=v}addImages(l,A,p){for(const v in l){const E=l[v],I={x:0,y:0,w:E.data.width+2*na,h:E.data.height+2*na};p.push(I),A[v]=new rS(I,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(l,A){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in l.updatedImages)this.patchUpdatedImage(this.iconPositions[p],l.getImage(p),A),this.patchUpdatedImage(this.patternPositions[p],l.getImage(p),A)}patchUpdatedImage(l,A,p){if(!l||!A||l.version===A.version)return;l.version=A.version;const[v,E]=l.tl;p.update(A.data,void 0,{x:v,y:E})}}var Eh;tr("ImagePosition",rS),tr("ImageAtlas",JN),a.ah=void 0,(Eh=a.ah||(a.ah={}))[Eh.none=0]="none",Eh[Eh.horizontal=1]="horizontal",Eh[Eh.vertical=2]="vertical",Eh[Eh.horizontalOnly=3]="horizontalOnly";const e0=-17;class r0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,A){const p=new r0;return p.scale=l||1,p.fontStack=A,p}static forImage(l){const A=new r0;return A.imageName=l,A}}class Pp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,A){const p=new Pp;for(let v=0;v<l.sections.length;v++){const E=l.sections[v];E.image?p.addImageSection(E):p.addTextSection(E,A)}return p}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let A="";for(let p=0;p<l.length;p++){const v=l.charCodeAt(p+1)||null,E=l.charCodeAt(p-1)||null;A+=v&&Ud(v)&&!t0[l[p+1]]||E&&Ud(E)&&!t0[l[p-1]]||!t0[l[p]]?l[p]:t0[l[p]]}return A}(this.text)}trim(){let l=0;for(let p=0;p<this.text.length&&iv[this.text.charCodeAt(p)];p++)l++;let A=this.text.length;for(let p=this.text.length-1;p>=0&&p>=l&&iv[this.text.charCodeAt(p)];p--)A--;this.text=this.text.substring(l,A),this.sectionIndex=this.sectionIndex.slice(l,A)}substring(l,A){const p=new Pp;return p.text=this.text.substring(l,A),p.sectionIndex=this.sectionIndex.slice(l,A),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,A)=>Math.max(l,this.sections[A].scale),0)}addTextSection(l,A){this.text+=l.text,this.sections.push(r0.forText(l.scale,l.fontStack||A));const p=this.sections.length-1;for(let v=0;v<l.text.length;++v)this.sectionIndex.push(p)}addImageSection(l){const A=l.image?l.image.name:"";if(A.length===0)return void wt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(r0.forImage(A)),this.sectionIndex.push(this.sections.length-1)):wt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function nv(u,l,A,p,v,E,I,L,O,H,q,$,Y,ot,ut,vt){const It=Pp.fromFeature(u,v);let Dt;$===a.ah.vertical&&It.verticalizePunctuation();const{processBidirectionalText:te,processStyledBidirectionalText:Qt}=ql;if(te&&It.sections.length===1){Dt=[];const be=te(It.toString(),nS(It,H,E,l,p,ot,ut));for(const Ye of be){const cr=new Pp;cr.text=Ye,cr.sections=It.sections;for(let We=0;We<Ye.length;We++)cr.sectionIndex.push(0);Dt.push(cr)}}else if(Qt){Dt=[];const be=Qt(It.text,It.sectionIndex,nS(It,H,E,l,p,ot,ut));for(const Ye of be){const cr=new Pp;cr.text=Ye[0],cr.sectionIndex=Ye[1],cr.sections=It.sections,Dt.push(cr)}}else Dt=function(be,Ye){const cr=[],We=be.text;let Ge=0;for(const ir of Ye)cr.push(be.substring(Ge,ir)),Ge=ir;return Ge<We.length&&cr.push(be.substring(Ge,We.length)),cr}(It,nS(It,H,E,l,p,ot,ut));const Kt=[],ve={positionedLines:Kt,text:It.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:$,iconsInText:!1,verticalizable:!1};return function(be,Ye,cr,We,Ge,ir,br,Xe,xe,ur,ar,Kr){let Vn=0,Gn=e0,Wi=0,ul=0;const oo=Xe==="right"?1:Xe==="left"?0:.5;let As=0;for(const $i of Ge){$i.trim();const vs=$i.getMaxScale(),Ro=(vs-1)*us,ia={positionedGlyphs:[],lineOffset:0};be.positionedLines[As]=ia;const js=ia.positionedGlyphs;let sa=0;if(!$i.length()){Gn+=ir,++As;continue}for(let Li=0;Li<$i.length();Li++){const rn=$i.getSection(Li),Xi=$i.getSectionIndex(Li),qs=$i.getCharCode(Li);let hs=0,Xl=null,Oc=null,Dc=null,xA=us;const Jl=!(xe===a.ah.horizontal||!ar&&!Md(qs)||ar&&(iv[qs]||(Ss=qs,Ke.Arabic(Ss)||Ke["Arabic Supplement"](Ss)||Ke["Arabic Extended-A"](Ss)||Ke["Arabic Presentation Forms-A"](Ss)||Ke["Arabic Presentation Forms-B"](Ss))));if(rn.imageName){const hl=We[rn.imageName];if(!hl)continue;Dc=rn.imageName,be.iconsInText=be.iconsInText||!0,Oc=hl.paddedRect;const oa=hl.displaySize;rn.scale=rn.scale*us/Kr,Xl={width:oa[0],height:oa[1],left:na,top:-$N,advance:Jl?oa[1]:oa[0]},hs=Ro+(us-oa[1]*rn.scale),xA=Xl.advance;const BA=Jl?oa[0]*rn.scale-us*vs:oa[1]*rn.scale-us*vs;BA>0&&BA>sa&&(sa=BA)}else{const hl=cr[rn.fontStack],oa=hl&&hl[qs];if(oa&&oa.rect)Oc=oa.rect,Xl=oa.metrics;else{const BA=Ye[rn.fontStack],a0=BA&&BA[qs];if(!a0)continue;Xl=a0.metrics}hs=(vs-rn.scale)*us}Jl?(be.verticalizable=!0,js.push({glyph:qs,imageName:Dc,x:Vn,y:Gn+hs,vertical:Jl,scale:rn.scale,fontStack:rn.fontStack,sectionIndex:Xi,metrics:Xl,rect:Oc}),Vn+=xA*rn.scale+ur):(js.push({glyph:qs,imageName:Dc,x:Vn,y:Gn+hs,vertical:Jl,scale:rn.scale,fontStack:rn.fontStack,sectionIndex:Xi,metrics:Xl,rect:Oc}),Vn+=Xl.advance*rn.scale+ur)}js.length!==0&&(Wi=Math.max(Vn-ur,Wi),mwt(js,0,js.length-1,oo,sa)),Vn=0;const Al=ir*vs+sa;ia.lineOffset=Math.max(sa,Ro),Gn+=Al,ul=Math.max(Al,ul),++As}var Ss;const ao=Gn-e0,{horizontalAlign:Uo,verticalAlign:lo}=iS(br);(function($i,vs,Ro,ia,js,sa,Al,Li,rn){const Xi=(vs-Ro)*js;let qs=0;qs=sa!==Al?-Li*ia-e0:(-ia*rn+.5)*Al;for(const hs of $i)for(const Xl of hs.positionedGlyphs)Xl.x+=Xi,Xl.y+=qs})(be.positionedLines,oo,Uo,lo,Wi,ul,ir,ao,Ge.length),be.top+=-lo*ao,be.bottom=be.top+ao,be.left+=-Uo*Wi,be.right=be.left+Wi}(ve,l,A,p,Dt,I,L,O,$,H,Y,vt),!function(be){for(const Ye of be)if(Ye.positionedGlyphs.length!==0)return!1;return!0}(Kt)&&ve}const iv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pwt={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function YN(u,l,A,p,v,E){if(l.imageName){const I=p[l.imageName];return I?I.displaySize[0]*l.scale*us/E+v:0}{const I=A[l.fontStack],L=I&&I[u];return L?L.metrics.advance*l.scale+v:0}}function ZN(u,l,A,p){const v=Math.pow(u-l,2);return p?u<l?v/2:2*v:v+Math.abs(A)*A}function gwt(u,l,A){let p=0;return u===10&&(p-=1e4),A&&(p+=150),u!==40&&u!==65288||(p+=50),l!==41&&l!==65289||(p+=50),p}function tk(u,l,A,p,v,E){let I=null,L=ZN(l,A,v,E);for(const O of p){const H=ZN(l-O.x,A,v,E)+O.badness;H<=L&&(I=O,L=H)}return{index:u,x:l,priorBreak:I,badness:L}}function ek(u){return u?ek(u.priorBreak).concat(u.index):[]}function nS(u,l,A,p,v,E,I){if(E!=="point")return[];if(!u)return[];const L=[],O=function(Y,ot,ut,vt,It,Dt){let te=0;for(let Qt=0;Qt<Y.length();Qt++){const Kt=Y.getSection(Qt);te+=YN(Y.getCharCode(Qt),Kt,vt,It,ot,Dt)}return te/Math.max(1,Math.ceil(te/ut))}(u,l,A,p,v,I),H=u.text.indexOf("")>=0;let q=0;for(let Y=0;Y<u.length();Y++){const ot=u.getSection(Y),ut=u.getCharCode(Y);if(iv[ut]||(q+=YN(ut,ot,p,v,l,I)),Y<u.length()-1){const vt=!(($=ut)<11904||!(Ke["Bopomofo Extended"]($)||Ke.Bopomofo($)||Ke["CJK Compatibility Forms"]($)||Ke["CJK Compatibility Ideographs"]($)||Ke["CJK Compatibility"]($)||Ke["CJK Radicals Supplement"]($)||Ke["CJK Strokes"]($)||Ke["CJK Symbols and Punctuation"]($)||Ke["CJK Unified Ideographs Extension A"]($)||Ke["CJK Unified Ideographs"]($)||Ke["Enclosed CJK Letters and Months"]($)||Ke["Halfwidth and Fullwidth Forms"]($)||Ke.Hiragana($)||Ke["Ideographic Description Characters"]($)||Ke["Kangxi Radicals"]($)||Ke["Katakana Phonetic Extensions"]($)||Ke.Katakana($)||Ke["Vertical Forms"]($)||Ke["Yi Radicals"]($)||Ke["Yi Syllables"]($)));(pwt[ut]||vt||ot.imageName)&&L.push(tk(Y+1,q,O,L,gwt(ut,u.getCharCode(Y+1),vt&&H),!1))}}var $;return ek(tk(u.length(),q,O,L,0,!0))}function iS(u){let l=.5,A=.5;switch(u){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":A=1;break;case"top":case"top-right":case"top-left":A=0}return{horizontalAlign:l,verticalAlign:A}}function mwt(u,l,A,p,v){if(!p&&!v)return;const E=u[A],I=(u[A].x+E.metrics.advance*E.scale)*p;for(let L=l;L<=A;L++)u[L].x-=I,u[L].y+=v}function ywt(u,l,A){const{horizontalAlign:p,verticalAlign:v}=iS(A),E=l[0]-u.displaySize[0]*p,I=l[1]-u.displaySize[1]*v;return{image:u,top:I,bottom:I+u.displaySize[1],left:E,right:E+u.displaySize[0]}}function rk(u){var l,A;let p=u.left,v=u.top,E=u.right-p,I=u.bottom-v;const L=(l=u.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",O=(A=u.image.textFitHeight)!==null&&A!==void 0?A:"stretchOrShrink",H=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(O==="proportional"){if(L==="stretchOnly"&&E/I<H||L==="proportional"){const q=Math.ceil(I*H);p*=q/E,E=q}}else if(L==="proportional"&&O==="stretchOnly"&&H!==0&&E/I>H){const q=Math.ceil(E/H);v*=q/I,I=q}return{x1:p,y1:v,x2:p+E,y2:v+I}}function nk(u,l,A,p,v,E){const I=u.image;let L;if(I.content){const It=I.content,Dt=I.pixelRatio||1;L=[It[0]/Dt,It[1]/Dt,I.displaySize[0]-It[2]/Dt,I.displaySize[1]-It[3]/Dt]}const O=l.left*E,H=l.right*E;let q,$,Y,ot;A==="width"||A==="both"?(ot=v[0]+O-p[3],$=v[0]+H+p[1]):(ot=v[0]+(O+H-I.displaySize[0])/2,$=ot+I.displaySize[0]);const ut=l.top*E,vt=l.bottom*E;return A==="height"||A==="both"?(q=v[1]+ut-p[0],Y=v[1]+vt+p[2]):(q=v[1]+(ut+vt-I.displaySize[1])/2,Y=q+I.displaySize[1]),{image:I,top:q,right:$,bottom:Y,left:ot,collisionPadding:L}}const n0=255,Fu=128,Sh=n0*Fu;function ik(u,l){const{expression:A}=l;if(A.kind==="constant")return{kind:"constant",layoutSize:A.evaluate(new En(u+1))};if(A.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:v}=A;let E=0;for(;E<p.length&&p[E]<=u;)E++;E=Math.max(0,E-1);let I=E;for(;I<p.length&&p[I]<u+1;)I++;I=Math.min(p.length-1,I);const L=p[E],O=p[I];return A.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:O,interpolationType:v}:{kind:"camera",minZoom:L,maxZoom:O,minSize:A.evaluate(new En(L)),maxSize:A.evaluate(new En(O)),interpolationType:v}}}function sS(u,l,A){let p="never";const v=u.get(l);return v?p=v:u.get(A)&&(p="always"),p}const _wt=Ch.VectorTileFeature.types,vwt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sv(u,l,A,p,v,E,I,L,O,H,q,$,Y){const ot=L?Math.min(Sh,Math.round(L[0])):0,ut=L?Math.min(Sh,Math.round(L[1])):0;u.emplaceBack(l,A,Math.round(32*p),Math.round(32*v),E,I,(ot<<1)+(O?1:0),ut,16*H,16*q,256*$,256*Y)}function oS(u,l,A){u.emplaceBack(l.x,l.y,A),u.emplaceBack(l.x,l.y,A),u.emplaceBack(l.x,l.y,A),u.emplaceBack(l.x,l.y,A)}function bwt(u){for(const l of u.sections)if(yh(l.text))return!0;return!1}class aS{constructor(l){this.layoutVertexArray=new cs,this.indexArray=new Ui,this.programConfigurations=l,this.segments=new yi,this.dynamicLayoutVertexArray=new io,this.opacityVertexArray=new so,this.hasVisibleVertices=!1,this.placedSymbolArray=new Dr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,A,p,v){this.isEmpty()||(p&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Ybt.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,A),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,Zbt.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,vwt,!0),this.opacityVertexBuffer.itemSize=1),(p||v)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tr("SymbolBuffers",aS);class lS{constructor(l,A,p){this.layoutVertexArray=new l,this.layoutAttributes=A,this.indexArray=new p,this.segments=new yi,this.collisionVertexArray=new Ki}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,twt.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}tr("CollisionBuffers",lS);class Mp{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(I=>I.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=QE([]),this.placementViewportMatrix=QE([]);const A=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ik(this.zoom,A["text-size"]),this.iconSizeData=ik(this.zoom,A["icon-size"]);const p=this.layers[0].layout,v=p.get("symbol-sort-key"),E=p.get("symbol-z-order");this.canOverlap=sS(p,"text-overlap","text-allow-overlap")!=="never"||sS(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(I=>a.ah[I])),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.sourceID=l.sourceID}createArrays(){this.text=new aS(new vA(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new aS(new vA(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new ln,this.lineVertexArray=new bn,this.symbolInstances=new Sn,this.textAnchorOffsets=new Xr}calculateGlyphDependencies(l,A,p,v,E){for(let I=0;I<l.length;I++)if(A[l.charCodeAt(I)]=!0,(p||v)&&E){const L=t0[l.charAt(I)];L&&(A[L.charCodeAt(0)]=!0)}}populate(l,A,p){const v=this.layers[0],E=v.layout,I=E.get("text-font"),L=E.get("text-field"),O=E.get("icon-image"),H=(L.value.kind!=="constant"||L.value.value instanceof jr&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),q=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,$=E.get("symbol-sort-key");if(this.features=[],!H&&!q)return;const Y=A.iconDependencies,ot=A.glyphDependencies,ut=A.availableImages,vt=new En(this.zoom);for(const{feature:It,id:Dt,index:te,sourceLayerIndex:Qt}of l){const Kt=v._featureFilter.needGeometry,ve=bA(It,Kt);if(!v._featureFilter.filter(vt,ve,p))continue;let be,Ye;if(Kt||(ve.geometry=Eu(It)),H){const We=v.getValueAndResolveTokens("text-field",ve,p,ut),Ge=jr.factory(We),ir=this.hasRTLText=this.hasRTLText||bwt(Ge);(!ir||ql.getRTLTextPluginStatus()==="unavailable"||ir&&ql.isParsed())&&(be=rwt(Ge,v,ve))}if(q){const We=v.getValueAndResolveTokens("icon-image",ve,p,ut);Ye=We instanceof on?We:on.fromString(We)}if(!be&&!Ye)continue;const cr=this.sortFeaturesByKey?$.evaluate(ve,{},p):void 0;if(this.features.push({id:Dt,text:be,icon:Ye,index:te,sourceLayerIndex:Qt,geometry:ve.geometry,properties:It.properties,type:_wt[It.type],sortKey:cr}),Ye&&(Y[Ye.name]=!0),be){const We=I.evaluate(ve,{},p).join(","),Ge=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ah.vertical)>=0;for(const ir of be.sections)if(ir.image)Y[ir.image.name]=!0;else{const br=Ca(be.toString()),Xe=ir.fontStack||We,xe=ot[Xe]=ot[Xe]||{};this.calculateGlyphDependencies(ir.text,xe,Ge,this.allowVerticalPlacement,br)}}}E.get("symbol-placement")==="line"&&(this.features=function(It){const Dt={},te={},Qt=[];let Kt=0;function ve(We){Qt.push(It[We]),Kt++}function be(We,Ge,ir){const br=te[We];return delete te[We],te[Ge]=br,Qt[br].geometry[0].pop(),Qt[br].geometry[0]=Qt[br].geometry[0].concat(ir[0]),br}function Ye(We,Ge,ir){const br=Dt[Ge];return delete Dt[Ge],Dt[We]=br,Qt[br].geometry[0].shift(),Qt[br].geometry[0]=ir[0].concat(Qt[br].geometry[0]),br}function cr(We,Ge,ir){const br=ir?Ge[0][Ge[0].length-1]:Ge[0][0];return`${We}:${br.x}:${br.y}`}for(let We=0;We<It.length;We++){const Ge=It[We],ir=Ge.geometry,br=Ge.text?Ge.text.toString():null;if(!br){ve(We);continue}const Xe=cr(br,ir),xe=cr(br,ir,!0);if(Xe in te&&xe in Dt&&te[Xe]!==Dt[xe]){const ur=Ye(Xe,xe,ir),ar=be(Xe,xe,Qt[ur].geometry);delete Dt[Xe],delete te[xe],te[cr(br,Qt[ar].geometry,!0)]=ar,Qt[ur].geometry=null}else Xe in te?be(Xe,xe,ir):xe in Dt?Ye(Xe,xe,ir):(ve(We),Dt[Xe]=Kt-1,te[xe]=Kt-1)}return Qt.filter(We=>We.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((It,Dt)=>It.sortKey-Dt.sortKey)}update(l,A,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,A,this.layers,p),this.icon.programConfigurations.updatePaintArrays(l,A,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,A){const p=this.lineVertexArray.length;if(l.segment!==void 0){let v=l.dist(A[l.segment+1]),E=l.dist(A[l.segment]);const I={};for(let L=l.segment+1;L<A.length;L++)I[L]={x:A[L].x,y:A[L].y,tileUnitDistanceFromAnchor:v},L<A.length-1&&(v+=A[L+1].dist(A[L]));for(let L=l.segment||0;L>=0;L--)I[L]={x:A[L].x,y:A[L].y,tileUnitDistanceFromAnchor:E},L>0&&(E+=A[L-1].dist(A[L]));for(let L=0;L<A.length;L++){const O=I[L];this.lineVertexArray.emplaceBack(O.x,O.y,O.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(l,A,p,v,E,I,L,O,H,q,$,Y){const ot=l.indexArray,ut=l.layoutVertexArray,vt=l.segments.prepareSegment(4*A.length,ut,ot,this.canOverlap?I.sortKey:void 0),It=this.glyphOffsetArray.length,Dt=vt.vertexLength,te=this.allowVerticalPlacement&&L===a.ah.vertical?Math.PI/2:0,Qt=I.text&&I.text.sections;for(let Kt=0;Kt<A.length;Kt++){const{tl:ve,tr:be,bl:Ye,br:cr,tex:We,pixelOffsetTL:Ge,pixelOffsetBR:ir,minFontScaleX:br,minFontScaleY:Xe,glyphOffset:xe,isSDF:ur,sectionIndex:ar}=A[Kt],Kr=vt.vertexLength,Vn=xe[1];sv(ut,O.x,O.y,ve.x,Vn+ve.y,We.x,We.y,p,ur,Ge.x,Ge.y,br,Xe),sv(ut,O.x,O.y,be.x,Vn+be.y,We.x+We.w,We.y,p,ur,ir.x,Ge.y,br,Xe),sv(ut,O.x,O.y,Ye.x,Vn+Ye.y,We.x,We.y+We.h,p,ur,Ge.x,ir.y,br,Xe),sv(ut,O.x,O.y,cr.x,Vn+cr.y,We.x+We.w,We.y+We.h,p,ur,ir.x,ir.y,br,Xe),oS(l.dynamicLayoutVertexArray,O,te),ot.emplaceBack(Kr,Kr+1,Kr+2),ot.emplaceBack(Kr+1,Kr+2,Kr+3),vt.vertexLength+=4,vt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xe[0]),Kt!==A.length-1&&ar===A[Kt+1].sectionIndex||l.programConfigurations.populatePaintArrays(ut.length,I,I.index,{},Y,Qt&&Qt[ar])}l.placedSymbolArray.emplaceBack(O.x,O.y,It,this.glyphOffsetArray.length-It,Dt,H,q,O.segment,p?p[0]:0,p?p[1]:0,v[0],v[1],L,0,!1,0,$)}_addCollisionDebugVertex(l,A,p,v,E,I){return A.emplaceBack(0,0),l.emplaceBack(p.x,p.y,v,E,Math.round(I.x),Math.round(I.y))}addCollisionDebugVertices(l,A,p,v,E,I,L){const O=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),H=O.vertexLength,q=E.layoutVertexArray,$=E.collisionVertexArray,Y=L.anchorX,ot=L.anchorY;this._addCollisionDebugVertex(q,$,I,Y,ot,new b(l,A)),this._addCollisionDebugVertex(q,$,I,Y,ot,new b(p,A)),this._addCollisionDebugVertex(q,$,I,Y,ot,new b(p,v)),this._addCollisionDebugVertex(q,$,I,Y,ot,new b(l,v)),O.vertexLength+=4;const ut=E.indexArray;ut.emplaceBack(H,H+1),ut.emplaceBack(H+1,H+2),ut.emplaceBack(H+2,H+3),ut.emplaceBack(H+3,H),O.primitiveLength+=4}addDebugCollisionBoxes(l,A,p,v){for(let E=l;E<A;E++){const I=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,v?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lS(An,HN.members,ii),this.iconCollisionBox=new lS(An,HN.members,ii);for(let l=0;l<this.symbolInstances.length;l++){const A=this.symbolInstances.get(l);this.addDebugCollisionBoxes(A.textBoxStartIndex,A.textBoxEndIndex,A,!0),this.addDebugCollisionBoxes(A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,!0),this.addDebugCollisionBoxes(A.iconBoxStartIndex,A.iconBoxEndIndex,A,!1),this.addDebugCollisionBoxes(A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,!1)}}_deserializeCollisionBoxesForSymbol(l,A,p,v,E,I,L,O,H){const q={};for(let $=A;$<p;$++){const Y=l.get($);q.textBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},q.textFeatureIndex=Y.featureIndex;break}for(let $=v;$<E;$++){const Y=l.get($);q.verticalTextBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},q.verticalTextFeatureIndex=Y.featureIndex;break}for(let $=I;$<L;$++){const Y=l.get($);q.iconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},q.iconFeatureIndex=Y.featureIndex;break}for(let $=O;$<H;$++){const Y=l.get($);q.verticalIconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},q.verticalIconFeatureIndex=Y.featureIndex;break}return q}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let A=0;A<this.symbolInstances.length;A++){const p=this.symbolInstances.get(A);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,A){const p=l.placedSymbolArray.get(A),v=p.vertexStartIndex+4*p.numGlyphs;for(let E=p.vertexStartIndex;E<v;E+=4)l.indexArray.emplaceBack(E,E+1,E+2),l.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const A=Math.sin(l),p=Math.cos(l),v=[],E=[],I=[];for(let L=0;L<this.symbolInstances.length;++L){I.push(L);const O=this.symbolInstances.get(L);v.push(0|Math.round(A*O.anchorX+p*O.anchorY)),E.push(O.featureIndex)}return I.sort((L,O)=>v[L]-v[O]||E[O]-E[L]),I}addToSortKeyRanges(l,A){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===A?p.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:A,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const A of this.symbolInstanceIndexes){const p=this.symbolInstances.get(A);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((v,E,I)=>{v>=0&&I.indexOf(v)===E&&this.addIndicesForPlacedSymbol(this.text,v)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let sk,ok;tr("SymbolBucket",Mp,{omit:["layers","collisionBoxArray","features","compareText"]}),Mp.MAX_GLYPHS=65535,Mp.addDynamicAttributes=oS;var cS={get paint(){return ok=ok||new _({"icon-opacity":new Fr(lt.paint_symbol["icon-opacity"]),"icon-color":new Fr(lt.paint_symbol["icon-color"]),"icon-halo-color":new Fr(lt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fr(lt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fr(lt.paint_symbol["icon-halo-blur"]),"icon-translate":new dr(lt.paint_symbol["icon-translate"]),"icon-translate-anchor":new dr(lt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fr(lt.paint_symbol["text-opacity"]),"text-color":new Fr(lt.paint_symbol["text-color"],{runtimeType:Rr,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Fr(lt.paint_symbol["text-halo-color"]),"text-halo-width":new Fr(lt.paint_symbol["text-halo-width"]),"text-halo-blur":new Fr(lt.paint_symbol["text-halo-blur"]),"text-translate":new dr(lt.paint_symbol["text-translate"]),"text-translate-anchor":new dr(lt.paint_symbol["text-translate-anchor"])})},get layout(){return sk=sk||new _({"symbol-placement":new dr(lt.layout_symbol["symbol-placement"]),"symbol-spacing":new dr(lt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dr(lt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fr(lt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dr(lt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new dr(lt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new dr(lt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new dr(lt.layout_symbol["icon-ignore-placement"]),"icon-optional":new dr(lt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dr(lt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fr(lt.layout_symbol["icon-size"]),"icon-text-fit":new dr(lt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dr(lt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fr(lt.layout_symbol["icon-image"]),"icon-rotate":new Fr(lt.layout_symbol["icon-rotate"]),"icon-padding":new Fr(lt.layout_symbol["icon-padding"]),"icon-keep-upright":new dr(lt.layout_symbol["icon-keep-upright"]),"icon-offset":new Fr(lt.layout_symbol["icon-offset"]),"icon-anchor":new Fr(lt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dr(lt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dr(lt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dr(lt.layout_symbol["text-rotation-alignment"]),"text-field":new Fr(lt.layout_symbol["text-field"]),"text-font":new Fr(lt.layout_symbol["text-font"]),"text-size":new Fr(lt.layout_symbol["text-size"]),"text-max-width":new Fr(lt.layout_symbol["text-max-width"]),"text-line-height":new dr(lt.layout_symbol["text-line-height"]),"text-letter-spacing":new Fr(lt.layout_symbol["text-letter-spacing"]),"text-justify":new Fr(lt.layout_symbol["text-justify"]),"text-radial-offset":new Fr(lt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dr(lt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Fr(lt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Fr(lt.layout_symbol["text-anchor"]),"text-max-angle":new dr(lt.layout_symbol["text-max-angle"]),"text-writing-mode":new dr(lt.layout_symbol["text-writing-mode"]),"text-rotate":new Fr(lt.layout_symbol["text-rotate"]),"text-padding":new dr(lt.layout_symbol["text-padding"]),"text-keep-upright":new dr(lt.layout_symbol["text-keep-upright"]),"text-transform":new Fr(lt.layout_symbol["text-transform"]),"text-offset":new Fr(lt.layout_symbol["text-offset"]),"text-allow-overlap":new dr(lt.layout_symbol["text-allow-overlap"]),"text-overlap":new dr(lt.layout_symbol["text-overlap"]),"text-ignore-placement":new dr(lt.layout_symbol["text-ignore-placement"]),"text-optional":new dr(lt.layout_symbol["text-optional"])})}};class ak{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:pn,this.defaultValue=l}evaluate(l){if(l.formattedSection){const A=this.defaultValue.property.overrides;if(A&&A.hasOverride(l.formattedSection))return A.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tr("FormatSectionOverride",ak,{omit:["defaultValue"]});class ov extends T{constructor(l){super(l,cS)}recalculate(l,A){if(super.recalculate(l,A),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const v=[];for(const E of p)v.indexOf(E)<0&&v.push(E);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,A,p,v){const E=this.layout.get(l).evaluate(A,{},p,v),I=this._unevaluatedLayout._values[l];return I.isDataDriven()||Qs(I.value)||!E?E:function(L,O){return O.replace(/{([^{}]+)}/g,(H,q)=>L&&q in L?String(L[q]):"")}(A.properties,E)}createBucket(l){return new Mp(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of cS.paint.overridableProperties){if(!ov.hasPaintOverride(this.layout,l))continue;const A=this.paint.get(l),p=new ak(A),v=new ba(p,A.property.specification);let E=null;E=A.value.kind==="constant"||A.value.kind==="source"?new Ja("source",v):new Vl("composite",v,A.value.zoomStops),this.paint._values[l]=new Sa(A.property,E,A.parameters)}}_handleOverridablePaintPropertyUpdate(l,A,p){return!(!this.layout||A.isDataDriven()||p.isDataDriven())&&ov.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,A){const p=l.get("text-field"),v=cS.paint.properties[A];let E=!1;const I=L=>{for(const O of L)if(v.overrides&&v.overrides.hasOverride(O))return void(E=!0)};if(p.value.kind==="constant"&&p.value.value instanceof jr)I(p.value.value.sections);else if(p.value.kind==="source"){const L=H=>{E||(H instanceof Cs&&Qn(H.value)===sn?I(H.value.sections):H instanceof hu?I(H.sections):H.eachChild(L))},O=p.value;O._styleExpression&&L(O._styleExpression.expression)}return E}}let lk;var wwt={get paint(){return lk=lk||new _({"background-color":new dr(lt.paint_background["background-color"]),"background-pattern":new c(lt.paint_background["background-pattern"]),"background-opacity":new dr(lt.paint_background["background-opacity"])})}};class xwt extends T{constructor(l){super(l,wwt)}}let ck;var Bwt={get paint(){return ck=ck||new _({"raster-opacity":new dr(lt.paint_raster["raster-opacity"]),"raster-hue-rotate":new dr(lt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dr(lt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dr(lt.paint_raster["raster-brightness-max"]),"raster-saturation":new dr(lt.paint_raster["raster-saturation"]),"raster-contrast":new dr(lt.paint_raster["raster-contrast"]),"raster-resampling":new dr(lt.paint_raster["raster-resampling"]),"raster-fade-duration":new dr(lt.paint_raster["raster-fade-duration"])})}};class Cwt extends T{constructor(l){super(l,Bwt)}}class Ewt extends T{constructor(l){super(l,{}),this.onAdd=A=>{this.implementation.onAdd&&this.implementation.onAdd(A,A.painter.context.gl)},this.onRemove=A=>{this.implementation.onRemove&&this.implementation.onRemove(A,A.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Swt{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const uS=63710088e-1;class Th{constructor(l,A){if(isNaN(l)||isNaN(A))throw new Error(`Invalid LngLat object: (${l}, ${A})`);if(this.lng=+l,this.lat=+A,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Th(gt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const A=Math.PI/180,p=this.lat*A,v=l.lat*A,E=Math.sin(p)*Math.sin(v)+Math.cos(p)*Math.cos(v)*Math.cos((l.lng-this.lng)*A);return uS*Math.acos(Math.min(E,1))}static convert(l){if(l instanceof Th)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Th(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Th(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const uk=2*Math.PI*uS;function Ak(u){return uk*Math.cos(u*Math.PI/180)}function hk(u){return(180+u)/360}function dk(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function fk(u,l){return u/Ak(l)}function AS(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class av{constructor(l,A){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+l,this.y=+A,this.z=+p}static fromLngLat(l){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const p=Th.convert(l);return new av(hk(p.lng),dk(p.lat),fk(A,p.lat))}toLngLat(){return new Th(360*this.x-180,AS(this.y))}toAltitude(){return this.z*Ak(AS(this.y))}meterInMercatorCoordinateUnits(){return 1/uk*(l=AS(this.y),1/Math.cos(l*Math.PI/180));var l}}function pk(u,l,A){var p=2*Math.PI*6378137/256/Math.pow(2,A);return[u*p-2*Math.PI*6378137/2,l*p-2*Math.PI*6378137/2]}class hS{constructor(l,A,p){if(l<0||l>25||p<0||p>=Math.pow(2,l)||A<0||A>=Math.pow(2,l))throw new Error(`x=${A}, y=${p}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=A,this.y=p,this.key=i0(0,l,l,A,p)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,A,p){const v=(I=this.y,L=this.z,O=pk(256*(E=this.x),256*(I=Math.pow(2,L)-I-1),L),H=pk(256*(E+1),256*(I+1),L),O[0]+","+O[1]+","+H[0]+","+H[1]);var E,I,L,O,H;const q=function($,Y,ot){let ut,vt="";for(let It=$;It>0;It--)ut=1<<It-1,vt+=(Y&ut?1:0)+(ot&ut?2:0);return vt}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,A>1?"@2x":"").replace(/{quadkey}/g,q).replace(/{bbox-epsg-3857}/g,v)}isChildOf(l){const A=this.z-l.z;return A>0&&l.x===this.x>>A&&l.y===this.y>>A}getTilePoint(l){const A=Math.pow(2,this.z);return new b((l.x*A-this.x)*_i,(l.y*A-this.y)*_i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gk{constructor(l,A){this.wrap=l,this.canonical=A,this.key=i0(l,A.z,A.z,A.x,A.y)}}class cl{constructor(l,A,p,v,E){if(l<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${p}`);this.overscaledZ=l,this.wrap=A,this.canonical=new hS(p,+v,+E),this.key=i0(A,l,p,v,E)}clone(){return new cl(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const A=this.canonical.z-l;return l>this.canonical.z?new cl(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new cl(l,this.wrap,l,this.canonical.x>>A,this.canonical.y>>A)}calculateScaledKey(l,A){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-l;return l>this.canonical.z?i0(this.wrap*+A,l,this.canonical.z,this.canonical.x,this.canonical.y):i0(this.wrap*+A,l,l,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const A=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>A&&l.canonical.y===this.canonical.y>>A}children(l){if(this.overscaledZ>=l)return[new cl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const A=this.canonical.z+1,p=2*this.canonical.x,v=2*this.canonical.y;return[new cl(A,this.wrap,A,p,v),new cl(A,this.wrap,A,p+1,v),new cl(A,this.wrap,A,p,v+1),new cl(A,this.wrap,A,p+1,v+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new cl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new cl(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gk(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new av(l.x-this.wrap,l.y))}}function i0(u,l,A,p,v){(u*=2)<0&&(u=-1*u-1);const E=1<<A;return(E*E*u+E*v+p).toString(36)+A.toString(36)+l.toString(36)}tr("CanonicalTileID",hS),tr("OverscaledTileID",cl,{omit:["posMatrix"]});class mk{constructor(l,A,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,I=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,L=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=l,A.height!==A.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void wt(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=A.height;const O=this.dim=A.height-2;switch(this.data=new Uint32Array(A.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=E,this.blueFactor=I,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let H=0;H<O;H++)this.data[this._idx(-1,H)]=this.data[this._idx(0,H)],this.data[this._idx(O,H)]=this.data[this._idx(O-1,H)],this.data[this._idx(H,-1)]=this.data[this._idx(H,0)],this.data[this._idx(H,O)]=this.data[this._idx(H,O-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(O,-1)]=this.data[this._idx(O-1,0)],this.data[this._idx(-1,O)]=this.data[this._idx(0,O-1)],this.data[this._idx(O,O)]=this.data[this._idx(O-1,O-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let H=0;H<O;H++)for(let q=0;q<O;q++){const $=this.get(H,q);$>this.max&&(this.max=$),$<this.min&&(this.min=$)}}get(l,A){const p=new Uint8Array(this.data.buffer),v=4*this._idx(l,A);return this.unpack(p[v],p[v+1],p[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,A){if(l<-1||l>=this.dim+1||A<-1||A>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(A+1)*this.stride+(l+1)}unpack(l,A,p){return l*this.redFactor+A*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new ll({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,A,p){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let v=A*this.dim,E=A*this.dim+this.dim,I=p*this.dim,L=p*this.dim+this.dim;switch(A){case-1:v=E-1;break;case 1:E=v+1}switch(p){case-1:I=L-1;break;case 1:L=I+1}const O=-A*this.dim,H=-p*this.dim;for(let q=I;q<L;q++)for(let $=v;$<E;$++)this.data[this._idx($,q)]=l.data[this._idx($+O,q+H)]}}tr("DEMData",mk);class yk{constructor(l){this._stringToNumber={},this._numberToString=[];for(let A=0;A<l.length;A++){const p=l[A];this._stringToNumber[p]=A,this._numberToString[A]=p}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class _k{constructor(l,A,p,v,E){this.type="Feature",this._vectorTileFeature=l,l._z=A,l._x=p,l._y=v,this.properties=l.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const A in this)A!=="_geometry"&&A!=="_vectorTileFeature"&&(l[A]=this[A]);return l}}class vk{constructor(l,A){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new gA(_i,16,0),this.grid3D=new gA(_i,16,0),this.featureIndexArray=new di,this.promoteId=A}insert(l,A,p,v,E,I){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,v,E);const O=I?this.grid3D:this.grid;for(let H=0;H<A.length;H++){const q=A[H],$=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<q.length;Y++){const ot=q[Y];$[0]=Math.min($[0],ot.x),$[1]=Math.min($[1],ot.y),$[2]=Math.max($[2],ot.x),$[3]=Math.max($[3],ot.y)}$[0]<_i&&$[1]<_i&&$[2]>=0&&$[3]>=0&&O.insert(L,$[0],$[1],$[2],$[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ch.VectorTile(new tS(this.rawTileData)).layers,this.sourceLayerCoder=new yk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,A,p,v){this.loadVTLayers();const E=l.params||{},I=_i/l.tileSize/l.scale,L=On(E.filter),O=l.queryGeometry,H=l.queryPadding*I,q=wk(O),$=this.grid.query(q.minX-H,q.minY-H,q.maxX+H,q.maxY+H),Y=wk(l.cameraQueryGeometry),ot=this.grid3D.query(Y.minX-H,Y.minY-H,Y.maxX+H,Y.maxY+H,(It,Dt,te,Qt)=>function(Kt,ve,be,Ye,cr){for(const Ge of Kt)if(ve<=Ge.x&&be<=Ge.y&&Ye>=Ge.x&&cr>=Ge.y)return!0;const We=[new b(ve,be),new b(ve,cr),new b(Ye,cr),new b(Ye,be)];if(Kt.length>2){for(const Ge of We)if(ra(Kt,Ge))return!0}for(let Ge=0;Ge<Kt.length-1;Ge++)if(Tu(Kt[Ge],Kt[Ge+1],We))return!0;return!1}(l.cameraQueryGeometry,It-H,Dt-H,te+H,Qt+H));for(const It of ot)$.push(It);$.sort(Twt);const ut={};let vt;for(let It=0;It<$.length;It++){const Dt=$[It];if(Dt===vt)continue;vt=Dt;const te=this.featureIndexArray.get(Dt);let Qt=null;this.loadMatchingFeature(ut,te.bucketIndex,te.sourceLayerIndex,te.featureIndex,L,E.layers,E.availableImages,A,p,v,(Kt,ve,be)=>(Qt||(Qt=Eu(Kt)),ve.queryIntersectsFeature(O,Kt,be,Qt,this.z,l.transform,I,l.pixelPosMatrix)))}return ut}loadMatchingFeature(l,A,p,v,E,I,L,O,H,q,$){const Y=this.bucketLayerIDs[A];if(I&&!function(It,Dt){for(let te=0;te<It.length;te++)if(Dt.indexOf(It[te])>=0)return!0;return!1}(I,Y))return;const ot=this.sourceLayerCoder.decode(p),ut=this.vtLayers[ot].feature(v);if(E.needGeometry){const It=bA(ut,!0);if(!E.filter(new En(this.tileID.overscaledZ),It,this.tileID.canonical))return}else if(!E.filter(new En(this.tileID.overscaledZ),ut))return;const vt=this.getId(ut,ot);for(let It=0;It<Y.length;It++){const Dt=Y[It];if(I&&I.indexOf(Dt)<0)continue;const te=O[Dt];if(!te)continue;let Qt={};vt&&q&&(Qt=q.getState(te.sourceLayer||"_geojsonTileLayer",vt));const Kt=mt({},H[Dt]);Kt.paint=bk(Kt.paint,te.paint,ut,Qt,L),Kt.layout=bk(Kt.layout,te.layout,ut,Qt,L);const ve=!$||$(ut,te,Qt);if(!ve)continue;const be=new _k(ut,this.z,this.x,this.y,vt);be.layer=Kt;let Ye=l[Dt];Ye===void 0&&(Ye=l[Dt]=[]),Ye.push({featureIndex:v,feature:be,intersectionZ:ve})}}lookupSymbolFeatures(l,A,p,v,E,I,L,O){const H={};this.loadVTLayers();const q=On(E);for(const $ of l)this.loadMatchingFeature(H,p,v,$,q,I,L,O,A);return H}hasLayer(l){for(const A of this.bucketLayerIDs)for(const p of A)if(l===p)return!0;return!1}getId(l,A){let p=l.id;return this.promoteId&&(p=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[A]],typeof p=="boolean"&&(p=Number(p))),p}}function bk(u,l,A,p,v){return Mt(u,(E,I)=>{const L=l instanceof _h?l.get(I):null;return L&&L.evaluate?L.evaluate(A,p,v):L})}function wk(u){let l=1/0,A=1/0,p=-1/0,v=-1/0;for(const E of u)l=Math.min(l,E.x),A=Math.min(A,E.y),p=Math.max(p,E.x),v=Math.max(v,E.y);return{minX:l,minY:A,maxX:p,maxY:v}}function Twt(u,l){return l-u}function xk(u,l,A,p,v){const E=[];for(let I=0;I<u.length;I++){const L=u[I];let O;for(let H=0;H<L.length-1;H++){let q=L[H],$=L[H+1];q.x<l&&$.x<l||(q.x<l?q=new b(l,q.y+(l-q.x)/($.x-q.x)*($.y-q.y))._round():$.x<l&&($=new b(l,q.y+(l-q.x)/($.x-q.x)*($.y-q.y))._round()),q.y<A&&$.y<A||(q.y<A?q=new b(q.x+(A-q.y)/($.y-q.y)*($.x-q.x),A)._round():$.y<A&&($=new b(q.x+(A-q.y)/($.y-q.y)*($.x-q.x),A)._round()),q.x>=p&&$.x>=p||(q.x>=p?q=new b(p,q.y+(p-q.x)/($.x-q.x)*($.y-q.y))._round():$.x>=p&&($=new b(p,q.y+(p-q.x)/($.x-q.x)*($.y-q.y))._round()),q.y>=v&&$.y>=v||(q.y>=v?q=new b(q.x+(v-q.y)/($.y-q.y)*($.x-q.x),v)._round():$.y>=v&&($=new b(q.x+(v-q.y)/($.y-q.y)*($.x-q.x),v)._round()),O&&q.equals(O[O.length-1])||(O=[q],E.push(O)),O.push($)))))}}return E}tr("FeatureIndex",vk,{omit:["rawTileData","sourceLayerCoder"]});class Ih extends b{constructor(l,A,p,v){super(l,A),this.angle=p,v!==void 0&&(this.segment=v)}clone(){return new Ih(this.x,this.y,this.angle,this.segment)}}function Bk(u,l,A,p,v){if(l.segment===void 0||A===0)return!0;let E=l,I=l.segment+1,L=0;for(;L>-A/2;){if(I--,I<0)return!1;L-=u[I].dist(E),E=u[I]}L+=u[I].dist(u[I+1]),I++;const O=[];let H=0;for(;L<A/2;){const q=u[I],$=u[I+1];if(!$)return!1;let Y=u[I-1].angleTo(q)-q.angleTo($);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),O.push({distance:L,angleDelta:Y}),H+=Y;L-O[0].distance>p;)H-=O.shift().angleDelta;if(H>v)return!1;I++,L+=q.dist($)}return!0}function Ck(u){let l=0;for(let A=0;A<u.length-1;A++)l+=u[A].dist(u[A+1]);return l}function Ek(u,l,A){return u?.6*l*A:0}function Sk(u,l){return Math.max(u?u.right-u.left:0,l?l.right-l.left:0)}function Iwt(u,l,A,p,v,E){const I=Ek(A,v,E),L=Sk(A,p)*E;let O=0;const H=Ck(u)/2;for(let q=0;q<u.length-1;q++){const $=u[q],Y=u[q+1],ot=$.dist(Y);if(O+ot>H){const ut=(H-O)/ot,vt=zi.number($.x,Y.x,ut),It=zi.number($.y,Y.y,ut),Dt=new Ih(vt,It,Y.angleTo($),q);return Dt._round(),!I||Bk(u,Dt,L,I,l)?Dt:void 0}O+=ot}}function Fwt(u,l,A,p,v,E,I,L,O){const H=Ek(p,E,I),q=Sk(p,v),$=q*I,Y=u[0].x===0||u[0].x===O||u[0].y===0||u[0].y===O;return l-$<l/4&&(l=$+l/4),Tk(u,Y?l/2*L%l:(q/2+2*E)*I*L%l,l,H,A,$,Y,!1,O)}function Tk(u,l,A,p,v,E,I,L,O){const H=E/2,q=Ck(u);let $=0,Y=l-A,ot=[];for(let ut=0;ut<u.length-1;ut++){const vt=u[ut],It=u[ut+1],Dt=vt.dist(It),te=It.angleTo(vt);for(;Y+A<$+Dt;){Y+=A;const Qt=(Y-$)/Dt,Kt=zi.number(vt.x,It.x,Qt),ve=zi.number(vt.y,It.y,Qt);if(Kt>=0&&Kt<O&&ve>=0&&ve<O&&Y-H>=0&&Y+H<=q){const be=new Ih(Kt,ve,te,ut);be._round(),p&&!Bk(u,be,E,p,v)||ot.push(be)}}$+=Dt}return L||ot.length||I||(ot=Tk(u,$/2,A,p,v,E,I,!0,O)),ot}tr("Anchor",Ih);const Up=na;function Ik(u,l,A,p){const v=[],E=u.image,I=E.pixelRatio,L=E.paddedRect.w-2*Up,O=E.paddedRect.h-2*Up;let H={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const q=E.stretchX||[[0,L]],$=E.stretchY||[[0,O]],Y=(xe,ur)=>xe+ur[1]-ur[0],ot=q.reduce(Y,0),ut=$.reduce(Y,0),vt=L-ot,It=O-ut;let Dt=0,te=ot,Qt=0,Kt=ut,ve=0,be=vt,Ye=0,cr=It;if(E.content&&p){const xe=E.content,ur=xe[2]-xe[0],ar=xe[3]-xe[1];(E.textFitWidth||E.textFitHeight)&&(H=rk(u)),Dt=lv(q,0,xe[0]),Qt=lv($,0,xe[1]),te=lv(q,xe[0],xe[2]),Kt=lv($,xe[1],xe[3]),ve=xe[0]-Dt,Ye=xe[1]-Qt,be=ur-te,cr=ar-Kt}const We=H.x1,Ge=H.y1,ir=H.x2-We,br=H.y2-Ge,Xe=(xe,ur,ar,Kr)=>{const Vn=cv(xe.stretch-Dt,te,ir,We),Gn=uv(xe.fixed-ve,be,xe.stretch,ot),Wi=cv(ur.stretch-Qt,Kt,br,Ge),ul=uv(ur.fixed-Ye,cr,ur.stretch,ut),oo=cv(ar.stretch-Dt,te,ir,We),As=uv(ar.fixed-ve,be,ar.stretch,ot),Ss=cv(Kr.stretch-Qt,Kt,br,Ge),ao=uv(Kr.fixed-Ye,cr,Kr.stretch,ut),Uo=new b(Vn,Wi),lo=new b(oo,Wi),$i=new b(oo,Ss),vs=new b(Vn,Ss),Ro=new b(Gn/I,ul/I),ia=new b(As/I,ao/I),js=l*Math.PI/180;if(js){const Li=Math.sin(js),rn=Math.cos(js),Xi=[rn,-Li,Li,rn];Uo._matMult(Xi),lo._matMult(Xi),vs._matMult(Xi),$i._matMult(Xi)}const sa=xe.stretch+xe.fixed,Al=ur.stretch+ur.fixed;return{tl:Uo,tr:lo,bl:vs,br:$i,tex:{x:E.paddedRect.x+Up+sa,y:E.paddedRect.y+Up+Al,w:ar.stretch+ar.fixed-sa,h:Kr.stretch+Kr.fixed-Al},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ro,pixelOffsetBR:ia,minFontScaleX:be/I/ir,minFontScaleY:cr/I/br,isSDF:A}};if(p&&(E.stretchX||E.stretchY)){const xe=Fk(q,vt,ot),ur=Fk($,It,ut);for(let ar=0;ar<xe.length-1;ar++){const Kr=xe[ar],Vn=xe[ar+1];for(let Gn=0;Gn<ur.length-1;Gn++)v.push(Xe(Kr,ur[Gn],Vn,ur[Gn+1]))}}else v.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:O+1}));return v}function lv(u,l,A){let p=0;for(const v of u)p+=Math.max(l,Math.min(A,v[1]))-Math.max(l,Math.min(A,v[0]));return p}function Fk(u,l,A){const p=[{fixed:-Up,stretch:0}];for(const[v,E]of u){const I=p[p.length-1];p.push({fixed:v-I.stretch,stretch:I.stretch}),p.push({fixed:v-I.stretch,stretch:I.stretch+(E-v)})}return p.push({fixed:l+Up,stretch:A}),p}function cv(u,l,A,p){return u/l*A+p}function uv(u,l,A,p){return u-l*A/p}class Av{constructor(l,A,p,v,E,I,L,O,H,q){var $;if(this.boxStartIndex=l.length,H){let Y=I.top,ot=I.bottom;const ut=I.collisionPadding;ut&&(Y-=ut[1],ot+=ut[3]);let vt=ot-Y;vt>0&&(vt=Math.max(10,vt),this.circleDiameter=vt)}else{const Y=!(($=I.image)===null||$===void 0)&&$.content&&(I.image.textFitWidth||I.image.textFitHeight)?rk(I):{x1:I.left,y1:I.top,x2:I.right,y2:I.bottom};Y.y1=Y.y1*L-O[0],Y.y2=Y.y2*L+O[2],Y.x1=Y.x1*L-O[3],Y.x2=Y.x2*L+O[1];const ot=I.collisionPadding;if(ot&&(Y.x1-=ot[0]*L,Y.y1-=ot[1]*L,Y.x2+=ot[2]*L,Y.y2+=ot[3]*L),q){const ut=new b(Y.x1,Y.y1),vt=new b(Y.x2,Y.y1),It=new b(Y.x1,Y.y2),Dt=new b(Y.x2,Y.y2),te=q*Math.PI/180;ut._rotate(te),vt._rotate(te),It._rotate(te),Dt._rotate(te),Y.x1=Math.min(ut.x,vt.x,It.x,Dt.x),Y.x2=Math.max(ut.x,vt.x,It.x,Dt.x),Y.y1=Math.min(ut.y,vt.y,It.y,Dt.y),Y.y2=Math.max(ut.y,vt.y,It.y,Dt.y)}l.emplaceBack(A.x,A.y,Y.x1,Y.y1,Y.x2,Y.y2,p,v,E)}this.boxEndIndex=l.length}}class Lwt{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pwt;if(this.data=l,this.length=this.data.length,this.compare=A,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(l){this.data.push(l),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const l=this.data[0],A=this.data.pop();return this.length--,this.length>0&&(this.data[0]=A,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:A,compare:p}=this,v=A[l];for(;l>0;){const E=l-1>>1,I=A[E];if(p(v,I)>=0)break;A[l]=I,l=E}A[l]=v}_down(l){const{data:A,compare:p}=this,v=this.length>>1,E=A[l];for(;l<v;){let I=1+(l<<1),L=A[I];const O=I+1;if(O<this.length&&p(A[O],L)<0&&(I=O,L=A[O]),p(L,E)>=0)break;A[l]=L,l=I}A[l]=E}}function Pwt(u,l){return u<l?-1:u>l?1:0}function Mwt(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=1/0,v=1/0,E=-1/0,I=-1/0;const L=u[0];for(let ot=0;ot<L.length;ot++){const ut=L[ot];(!ot||ut.x<p)&&(p=ut.x),(!ot||ut.y<v)&&(v=ut.y),(!ot||ut.x>E)&&(E=ut.x),(!ot||ut.y>I)&&(I=ut.y)}const O=Math.min(E-p,I-v);let H=O/2;const q=new Lwt([],Uwt);if(O===0)return new b(p,v);for(let ot=p;ot<E;ot+=O)for(let ut=v;ut<I;ut+=O)q.push(new Rp(ot+H,ut+H,H,u));let $=function(ot){let ut=0,vt=0,It=0;const Dt=ot[0];for(let te=0,Qt=Dt.length,Kt=Qt-1;te<Qt;Kt=te++){const ve=Dt[te],be=Dt[Kt],Ye=ve.x*be.y-be.x*ve.y;vt+=(ve.x+be.x)*Ye,It+=(ve.y+be.y)*Ye,ut+=3*Ye}return new Rp(vt/ut,It/ut,0,ot)}(u),Y=q.length;for(;q.length;){const ot=q.pop();(ot.d>$.d||!$.d)&&($=ot,A&&console.log("found best %d after %d probes",Math.round(1e4*ot.d)/1e4,Y)),ot.max-$.d<=l||(H=ot.h/2,q.push(new Rp(ot.p.x-H,ot.p.y-H,H,u)),q.push(new Rp(ot.p.x+H,ot.p.y-H,H,u)),q.push(new Rp(ot.p.x-H,ot.p.y+H,H,u)),q.push(new Rp(ot.p.x+H,ot.p.y+H,H,u)),Y+=4)}return A&&(console.log(`num probes: ${Y}`),console.log(`best distance: ${$.d}`)),$.p}function Uwt(u,l){return l.max-u.max}function Rp(u,l,A,p){this.p=new b(u,l),this.h=A,this.d=function(v,E){let I=!1,L=1/0;for(let O=0;O<E.length;O++){const H=E[O];for(let q=0,$=H.length,Y=$-1;q<$;Y=q++){const ot=H[q],ut=H[Y];ot.y>v.y!=ut.y>v.y&&v.x<(ut.x-ot.x)*(v.y-ot.y)/(ut.y-ot.y)+ot.x&&(I=!I),L=Math.min(L,Hd(v,ot,ut))}}return(I?1:-1)*Math.sqrt(L)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Gs;a.aq=void 0,(Gs=a.aq||(a.aq={}))[Gs.center=1]="center",Gs[Gs.left=2]="left",Gs[Gs.right=3]="right",Gs[Gs.top=4]="top",Gs[Gs.bottom=5]="bottom",Gs[Gs["top-left"]=6]="top-left",Gs[Gs["top-right"]=7]="top-right",Gs[Gs["bottom-left"]=8]="bottom-left",Gs[Gs["bottom-right"]=9]="bottom-right";const Fh=7,dS=Number.POSITIVE_INFINITY;function Lk(u,l){return l[1]!==dS?function(A,p,v){let E=0,I=0;switch(p=Math.abs(p),v=Math.abs(v),A){case"top-right":case"top-left":case"top":I=v-Fh;break;case"bottom-right":case"bottom-left":case"bottom":I=-v+Fh}switch(A){case"top-right":case"bottom-right":case"right":E=-p;break;case"top-left":case"bottom-left":case"left":E=p}return[E,I]}(u,l[0],l[1]):function(A,p){let v=0,E=0;p<0&&(p=0);const I=p/Math.SQRT2;switch(A){case"top-right":case"top-left":E=I-Fh;break;case"bottom-right":case"bottom-left":E=-I+Fh;break;case"bottom":E=-p+Fh;break;case"top":E=p-Fh}switch(A){case"top-right":case"bottom-right":v=-I;break;case"top-left":case"bottom-left":v=I;break;case"left":v=p;break;case"right":v=-p}return[v,E]}(u,l[0])}function Pk(u,l,A){var p;const v=u.layout,E=(p=v.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(l,{},A);if(E){const L=E.values,O=[];for(let H=0;H<L.length;H+=2){const q=O[H]=L[H],$=L[H+1].map(Y=>Y*us);q.startsWith("top")?$[1]-=Fh:q.startsWith("bottom")&&($[1]+=Fh),O[H+1]=$}return new mn(O)}const I=v.get("text-variable-anchor");if(I){let L;L=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(l,{},A)*us,dS]:v.get("text-offset").evaluate(l,{},A).map(H=>H*us);const O=[];for(const H of I)O.push(H,Lk(H,L));return new mn(O)}return null}function fS(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Rwt(u,l,A,p,v,E,I,L,O,H,q){let $=E.textMaxSize.evaluate(l,{});$===void 0&&($=I);const Y=u.layers[0].layout,ot=Y.get("icon-offset").evaluate(l,{},q),ut=Uk(A.horizontal),vt=I/24,It=u.tilePixelRatio*vt,Dt=u.tilePixelRatio*$/24,te=u.tilePixelRatio*L,Qt=u.tilePixelRatio*Y.get("symbol-spacing"),Kt=Y.get("text-padding")*u.tilePixelRatio,ve=function(xe,ur,ar){let Kr=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Vn=xe.get("icon-padding").evaluate(ur,{},ar),Gn=Vn&&Vn.values;return[Gn[0]*Kr,Gn[1]*Kr,Gn[2]*Kr,Gn[3]*Kr]}(Y,l,q,u.tilePixelRatio),be=Y.get("text-max-angle")/180*Math.PI,Ye=Y.get("text-rotation-alignment")!=="viewport"&&Y.get("symbol-placement")!=="point",cr=Y.get("icon-rotation-alignment")==="map"&&Y.get("symbol-placement")!=="point",We=Y.get("symbol-placement"),Ge=Qt/2,ir=Y.get("icon-text-fit");let br;p&&ir!=="none"&&(u.allowVerticalPlacement&&A.vertical&&(br=nk(p,A.vertical,ir,Y.get("icon-text-fit-padding"),ot,vt)),ut&&(p=nk(p,ut,ir,Y.get("icon-text-fit-padding"),ot,vt)));const Xe=(xe,ur)=>{ur.x<0||ur.x>=_i||ur.y<0||ur.y>=_i||function(ar,Kr,Vn,Gn,Wi,ul,oo,As,Ss,ao,Uo,lo,$i,vs,Ro,ia,js,sa,Al,Li,rn,Xi,qs,hs,Xl){const Oc=ar.addToLineVertexArray(Kr,Vn);let Dc,xA,Jl,hl,oa=0,BA=0,a0=0,Nk=0,wS=-1,xS=-1;const CA={};let kk=Rc("");if(ar.allowVerticalPlacement&&Gn.vertical){const co=As.layout.get("text-rotate").evaluate(rn,{},hs)+90;Jl=new Av(Ss,Kr,ao,Uo,lo,Gn.vertical,$i,vs,Ro,co),oo&&(hl=new Av(Ss,Kr,ao,Uo,lo,oo,js,sa,Ro,co))}if(Wi){const co=As.layout.get("icon-rotate").evaluate(rn,{}),dl=As.layout.get("icon-text-fit")!=="none",Gd=Ik(Wi,co,qs,dl),kc=oo?Ik(oo,co,qs,dl):void 0;xA=new Av(Ss,Kr,ao,Uo,lo,Wi,js,sa,!1,co),oa=4*Gd.length;const jd=ar.iconSizeData;let Lu=null;jd.kind==="source"?(Lu=[Fu*As.layout.get("icon-size").evaluate(rn,{})],Lu[0]>Sh&&wt(`${ar.layerIds[0]}: Value for "icon-size" is >= ${n0}. Reduce your "icon-size".`)):jd.kind==="composite"&&(Lu=[Fu*Xi.compositeIconSizes[0].evaluate(rn,{},hs),Fu*Xi.compositeIconSizes[1].evaluate(rn,{},hs)],(Lu[0]>Sh||Lu[1]>Sh)&&wt(`${ar.layerIds[0]}: Value for "icon-size" is >= ${n0}. Reduce your "icon-size".`)),ar.addSymbols(ar.icon,Gd,Lu,Li,Al,rn,a.ah.none,Kr,Oc.lineStartIndex,Oc.lineLength,-1,hs),wS=ar.icon.placedSymbolArray.length-1,kc&&(BA=4*kc.length,ar.addSymbols(ar.icon,kc,Lu,Li,Al,rn,a.ah.vertical,Kr,Oc.lineStartIndex,Oc.lineLength,-1,hs),xS=ar.icon.placedSymbolArray.length-1)}const Qk=Object.keys(Gn.horizontal);for(const co of Qk){const dl=Gn.horizontal[co];if(!Dc){kk=Rc(dl.text);const kc=As.layout.get("text-rotate").evaluate(rn,{},hs);Dc=new Av(Ss,Kr,ao,Uo,lo,dl,$i,vs,Ro,kc)}const Gd=dl.positionedLines.length===1;if(a0+=Mk(ar,Kr,dl,ul,As,Ro,rn,ia,Oc,Gn.vertical?a.ah.horizontal:a.ah.horizontalOnly,Gd?Qk:[co],CA,wS,Xi,hs),Gd)break}Gn.vertical&&(Nk+=Mk(ar,Kr,Gn.vertical,ul,As,Ro,rn,ia,Oc,a.ah.vertical,["vertical"],CA,xS,Xi,hs));const Nwt=Dc?Dc.boxStartIndex:ar.collisionBoxArray.length,kwt=Dc?Dc.boxEndIndex:ar.collisionBoxArray.length,Qwt=Jl?Jl.boxStartIndex:ar.collisionBoxArray.length,Hwt=Jl?Jl.boxEndIndex:ar.collisionBoxArray.length,zwt=xA?xA.boxStartIndex:ar.collisionBoxArray.length,Vwt=xA?xA.boxEndIndex:ar.collisionBoxArray.length,Gwt=hl?hl.boxStartIndex:ar.collisionBoxArray.length,jwt=hl?hl.boxEndIndex:ar.collisionBoxArray.length;let Nc=-1;const dv=(co,dl)=>co&&co.circleDiameter?Math.max(co.circleDiameter,dl):dl;Nc=dv(Dc,Nc),Nc=dv(Jl,Nc),Nc=dv(xA,Nc),Nc=dv(hl,Nc);const Hk=Nc>-1?1:0;Hk&&(Nc*=Xl/us),ar.glyphOffsetArray.length>=Mp.MAX_GLYPHS&&wt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),rn.sortKey!==void 0&&ar.addToSortKeyRanges(ar.symbolInstances.length,rn.sortKey);const qwt=Pk(As,rn,hs),[Kwt,Wwt]=function(co,dl){const Gd=co.length,kc=dl==null?void 0:dl.values;if((kc==null?void 0:kc.length)>0)for(let jd=0;jd<kc.length;jd+=2){const Lu=kc[jd+1];co.emplaceBack(a.aq[kc[jd]],Lu[0],Lu[1])}return[Gd,co.length]}(ar.textAnchorOffsets,qwt);ar.symbolInstances.emplaceBack(Kr.x,Kr.y,CA.right>=0?CA.right:-1,CA.center>=0?CA.center:-1,CA.left>=0?CA.left:-1,CA.vertical||-1,wS,xS,kk,Nwt,kwt,Qwt,Hwt,zwt,Vwt,Gwt,jwt,ao,a0,Nk,oa,BA,Hk,0,$i,Nc,Kwt,Wwt)}(u,ur,xe,A,p,v,br,u.layers[0],u.collisionBoxArray,l.index,l.sourceLayerIndex,u.index,It,[Kt,Kt,Kt,Kt],Ye,O,te,ve,cr,ot,l,E,H,q,I)};if(We==="line")for(const xe of xk(l.geometry,0,0,_i,_i)){const ur=Fwt(xe,Qt,be,A.vertical||ut,p,24,Dt,u.overscaling,_i);for(const ar of ur)ut&&Owt(u,ut.text,Ge,ar)||Xe(xe,ar)}else if(We==="line-center"){for(const xe of l.geometry)if(xe.length>1){const ur=Iwt(xe,be,A.vertical||ut,p,24,Dt);ur&&Xe(xe,ur)}}else if(l.type==="Polygon")for(const xe of Ul(l.geometry,0)){const ur=Mwt(xe,16);Xe(xe[0],new Ih(ur.x,ur.y,0))}else if(l.type==="LineString")for(const xe of l.geometry)Xe(xe,new Ih(xe[0].x,xe[0].y,0));else if(l.type==="Point")for(const xe of l.geometry)for(const ur of xe)Xe([ur],new Ih(ur.x,ur.y,0))}function Mk(u,l,A,p,v,E,I,L,O,H,q,$,Y,ot,ut){const vt=function(te,Qt,Kt,ve,be,Ye,cr,We){const Ge=ve.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,ir=[];for(const br of Qt.positionedLines)for(const Xe of br.positionedGlyphs){if(!Xe.rect)continue;const xe=Xe.rect||{};let ur=$N+1,ar=!0,Kr=1,Vn=0;const Gn=(be||We)&&Xe.vertical,Wi=Xe.metrics.advance*Xe.scale/2;if(We&&Qt.verticalizable&&(Vn=br.lineOffset/2-(Xe.imageName?-(us-Xe.metrics.width*Xe.scale)/2:(Xe.scale-1)*us)),Xe.imageName){const Li=cr[Xe.imageName];ar=Li.sdf,Kr=Li.pixelRatio,ur=na/Kr}const ul=be?[Xe.x+Wi,Xe.y]:[0,0];let oo=be?[0,0]:[Xe.x+Wi+Kt[0],Xe.y+Kt[1]-Vn],As=[0,0];Gn&&(As=oo,oo=[0,0]);const Ss=Xe.metrics.isDoubleResolution?2:1,ao=(Xe.metrics.left-ur)*Xe.scale-Wi+oo[0],Uo=(-Xe.metrics.top-ur)*Xe.scale+oo[1],lo=ao+xe.w/Ss*Xe.scale/Kr,$i=Uo+xe.h/Ss*Xe.scale/Kr,vs=new b(ao,Uo),Ro=new b(lo,Uo),ia=new b(ao,$i),js=new b(lo,$i);if(Gn){const Li=new b(-Wi,Wi-e0),rn=-Math.PI/2,Xi=us/2-Wi,qs=new b(5-e0-Xi,-(Xe.imageName?Xi:0)),hs=new b(...As);vs._rotateAround(rn,Li)._add(qs)._add(hs),Ro._rotateAround(rn,Li)._add(qs)._add(hs),ia._rotateAround(rn,Li)._add(qs)._add(hs),js._rotateAround(rn,Li)._add(qs)._add(hs)}if(Ge){const Li=Math.sin(Ge),rn=Math.cos(Ge),Xi=[rn,-Li,Li,rn];vs._matMult(Xi),Ro._matMult(Xi),ia._matMult(Xi),js._matMult(Xi)}const sa=new b(0,0),Al=new b(0,0);ir.push({tl:vs,tr:Ro,bl:ia,br:js,tex:xe,writingMode:Qt.writingMode,glyphOffset:ul,sectionIndex:Xe.sectionIndex,isSDF:ar,pixelOffsetTL:sa,pixelOffsetBR:Al,minFontScaleX:0,minFontScaleY:0})}return ir}(0,A,L,v,E,I,p,u.allowVerticalPlacement),It=u.textSizeData;let Dt=null;It.kind==="source"?(Dt=[Fu*v.layout.get("text-size").evaluate(I,{})],Dt[0]>Sh&&wt(`${u.layerIds[0]}: Value for "text-size" is >= ${n0}. Reduce your "text-size".`)):It.kind==="composite"&&(Dt=[Fu*ot.compositeTextSizes[0].evaluate(I,{},ut),Fu*ot.compositeTextSizes[1].evaluate(I,{},ut)],(Dt[0]>Sh||Dt[1]>Sh)&&wt(`${u.layerIds[0]}: Value for "text-size" is >= ${n0}. Reduce your "text-size".`)),u.addSymbols(u.text,vt,Dt,L,E,I,H,l,O.lineStartIndex,O.lineLength,Y,ut);for(const te of q)$[te]=u.text.placedSymbolArray.length-1;return 4*vt.length}function Uk(u){for(const l in u)return u[l];return null}function Owt(u,l,A,p){const v=u.compareText;if(l in v){const E=v[l];for(let I=E.length-1;I>=0;I--)if(p.dist(E[I])<A)return!0}else v[l]=[];return v[l].push(p),!1}const Rk=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pS{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[A,p]=new Uint8Array(l,0,2);if(A!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=p>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const E=Rk[15&p];if(!E)throw new Error("Unrecognized array type.");const[I]=new Uint16Array(l,2,1),[L]=new Uint32Array(l,4,1);return new pS(L,I,E,l)}constructor(l){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,v=arguments.length>3?arguments[3]:void 0;if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+A,2),65535),this.ArrayType=p,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const E=Rk.indexOf(this.ArrayType),I=2*l*this.ArrayType.BYTES_PER_ELEMENT,L=l*this.IndexArrayType.BYTES_PER_ELEMENT,O=(8-L%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${p}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+L+O,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+I+L+O),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+L+O,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=A,new Uint32Array(this.data,4,1)[0]=l)}add(l,A){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=l,this.coords[this._pos++]=A,p}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return gS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,A,p,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:I,nodeSize:L}=this,O=[0,E.length-1,0],H=[];for(;O.length;){const q=O.pop()||0,$=O.pop()||0,Y=O.pop()||0;if($-Y<=L){for(let It=Y;It<=$;It++){const Dt=I[2*It],te=I[2*It+1];Dt>=l&&Dt<=p&&te>=A&&te<=v&&H.push(E[It])}continue}const ot=Y+$>>1,ut=I[2*ot],vt=I[2*ot+1];ut>=l&&ut<=p&&vt>=A&&vt<=v&&H.push(E[ot]),(q===0?l<=ut:A<=vt)&&(O.push(Y),O.push(ot-1),O.push(1-q)),(q===0?p>=ut:v>=vt)&&(O.push(ot+1),O.push($),O.push(1-q))}return H}within(l,A,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:E,nodeSize:I}=this,L=[0,v.length-1,0],O=[],H=p*p;for(;L.length;){const q=L.pop()||0,$=L.pop()||0,Y=L.pop()||0;if($-Y<=I){for(let It=Y;It<=$;It++)Dk(E[2*It],E[2*It+1],l,A)<=H&&O.push(v[It]);continue}const ot=Y+$>>1,ut=E[2*ot],vt=E[2*ot+1];Dk(ut,vt,l,A)<=H&&O.push(v[ot]),(q===0?l-p<=ut:A-p<=vt)&&(L.push(Y),L.push(ot-1),L.push(1-q)),(q===0?l+p>=ut:A+p>=vt)&&(L.push(ot+1),L.push($),L.push(1-q))}return O}}function gS(u,l,A,p,v,E){if(v-p<=A)return;const I=p+v>>1;Ok(u,l,I,p,v,E),gS(u,l,A,p,I-1,1-E),gS(u,l,A,I+1,v,1-E)}function Ok(u,l,A,p,v,E){for(;v>p;){if(v-p>600){const H=v-p+1,q=A-p+1,$=Math.log(H),Y=.5*Math.exp(2*$/3),ot=.5*Math.sqrt($*Y*(H-Y)/H)*(q-H/2<0?-1:1);Ok(u,l,A,Math.max(p,Math.floor(A-q*Y/H+ot)),Math.min(v,Math.floor(A+(H-q)*Y/H+ot)),E)}const I=l[2*A+E];let L=p,O=v;for(s0(u,l,p,A),l[2*v+E]>I&&s0(u,l,p,v);L<O;){for(s0(u,l,L,O),L++,O--;l[2*L+E]<I;)L++;for(;l[2*O+E]>I;)O--}l[2*p+E]===I?s0(u,l,p,O):(O++,s0(u,l,O,v)),O<=A&&(p=O+1),A<=O&&(v=O-1)}}function s0(u,l,A,p){mS(u,A,p),mS(l,2*A,2*p),mS(l,2*A+1,2*p+1)}function mS(u,l,A){const p=u[l];u[l]=u[A],u[A]=p}function Dk(u,l,A,p){const v=u-A,E=l-p;return v*v+E*E}var yS;a.be=void 0,(yS=a.be||(a.be={})).create="create",yS.load="load",yS.fullLoad="fullLoad";let hv=null,o0=[];const _S=1e3/60,vS="loadTime",bS="fullLoadTime",Dwt={mark(u){performance.mark(u)},frame(u){const l=u;hv!=null&&o0.push(l-hv),hv=l},clearMetrics(){hv=null,o0=[],performance.clearMeasures(vS),performance.clearMeasures(bS);for(const u in a.be)performance.clearMarks(a.be[u])},getPerformanceMetrics(){performance.measure(vS,a.be.create,a.be.load),performance.measure(bS,a.be.create,a.be.fullLoad);const u=performance.getEntriesByName(vS)[0].duration,l=performance.getEntriesByName(bS)[0].duration,A=o0.length,p=1/(o0.reduce((E,I)=>E+I,0)/A/1e3),v=o0.filter(E=>E>_S).reduce((E,I)=>E+(I-_S)/_S,0);return{loadTime:u,fullLoadTime:l,fps:p,percentDroppedFrames:v/(A+v)*100,totalFrames:A}}};a.$=yi,a.A=Sp,a.B=function(u){if(Yt==null){const l=u.navigator?u.navigator.userAgent:null;Yt=!!u.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Yt},a.C=class{constructor(u,l){this.target=u,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Swt(()=>this.process()),this.subscription=function(A,p,v,E){return A.addEventListener(p,v,!1),{unsubscribe:()=>{A.removeEventListener(p,v,!1)}}}(this.target,"message",A=>this.receive(A)),this.globalScope=Jt(self)?u:window}registerMessageHandler(u,l){this.messageHandlers[u]=l}sendAsync(u,l){return new Promise((A,p)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:A,reject:p},l&&l.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const L={id:v,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(L)},{once:!0});const E=[],I=Object.assign(Object.assign({},u),{id:v,sourceMapId:this.mapId,origin:location.origin,data:Es(u.data,E)});this.target.postMessage(I,{transfer:E})})}receive(u){const l=u.data,A=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[A];const p=this.abortControllers[A];return delete this.abortControllers[A],void(p&&p.abort())}if(Jt(self)||l.mustQueue)return this.tasks[A]=l,this.taskQueue.push(A),void this.invoker.trigger();this.processTask(A,l)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),l=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(u,l)}processTask(u,l){return o(this,void 0,void 0,function*(){if(l.type==="<response>"){const v=this.resolveRejects[u];return delete this.resolveRejects[u],v?void(l.error?v.reject(ji(l.error)):v.resolve(ji(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const A=ji(l.data),p=new AbortController;this.abortControllers[u]=p;try{const v=yield this.messageHandlers[l.type](l.sourceMapId,A,p);this.completeTask(u,null,v)}catch(v){this.completeTask(u,v)}})}completeTask(u,l,A){const p=[];delete this.abortControllers[u];const v={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?Es(l):null,data:Es(A,p)};this.target.postMessage(v,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.D=dr,a.E=fe,a.F=function(){var u=new Sp(16);return Sp!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},a.G=qt,a.H=function(u,l,A){var p,v,E,I,L,O,H,q,$,Y,ot,ut,vt=A[0],It=A[1],Dt=A[2];return l===u?(u[12]=l[0]*vt+l[4]*It+l[8]*Dt+l[12],u[13]=l[1]*vt+l[5]*It+l[9]*Dt+l[13],u[14]=l[2]*vt+l[6]*It+l[10]*Dt+l[14],u[15]=l[3]*vt+l[7]*It+l[11]*Dt+l[15]):(v=l[1],E=l[2],I=l[3],L=l[4],O=l[5],H=l[6],q=l[7],$=l[8],Y=l[9],ot=l[10],ut=l[11],u[0]=p=l[0],u[1]=v,u[2]=E,u[3]=I,u[4]=L,u[5]=O,u[6]=H,u[7]=q,u[8]=$,u[9]=Y,u[10]=ot,u[11]=ut,u[12]=p*vt+L*It+$*Dt+l[12],u[13]=v*vt+O*It+Y*Dt+l[13],u[14]=E*vt+H*It+ot*Dt+l[14],u[15]=I*vt+q*It+ut*Dt+l[15]),u},a.I=rS,a.J=function(u,l,A){var p=A[0],v=A[1],E=A[2];return u[0]=l[0]*p,u[1]=l[1]*p,u[2]=l[2]*p,u[3]=l[3]*p,u[4]=l[4]*v,u[5]=l[5]*v,u[6]=l[6]*v,u[7]=l[7]*v,u[8]=l[8]*E,u[9]=l[9]*E,u[10]=l[10]*E,u[11]=l[11]*E,u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15],u},a.K=mN,a.L=function(u,l){const A={};for(let p=0;p<l.length;p++){const v=l[p];v in u&&(A[v]=u[v])}return A},a.M=Th,a.N=hk,a.O=dk,a.P=b,a.Q=cl,a.R=ll,a.S=z,a.T=Kl,a.U=G,a.V=ne,a.W=_i,a.X=S,a.Y=av,a.Z=class extends k{},a._=o,a.a=Pt,a.a$=function(u,l){return u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[3],u[4]=l[4],u[5]=l[5],u[6]=l[6],u[7]=l[7],u[8]=l[8],u[9]=l[9],u[10]=l[10],u[11]=l[11],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15],u},a.a0=hS,a.a1=ye,a.a2=u=>{const l=window.document.createElement("video");return l.muted=!0,new Promise(A=>{l.onloadstart=()=>{A(l)};for(const p of u){const v=window.document.createElement("source");Ce(p)||(l.crossOrigin="Anonymous"),v.src=p,l.appendChild(v)}})},a.a3=function(){return ft++},a.a4=Je,a.a5=Mp,a.a6=On,a.a7=bA,a.a8=En,a.a9=_k,a.aA=function(u){if(u.type==="custom")return new Ewt(u);switch(u.type){case"background":return new xwt(u);case"circle":return new Abt(u);case"fill":return new Tbt(u);case"fill-extrusion":return new Vbt(u);case"heatmap":return new dbt(u);case"hillshade":return new pbt(u);case"line":return new Jbt(u);case"raster":return new Cwt(u);case"symbol":return new ov(u)}},a.aB=at,a.aC=function(u,l){if(!u)return[{command:"setStyle",args:[l]}];let A=[];try{if(!pe(u.version,l.version))return[{command:"setStyle",args:[l]}];pe(u.center,l.center)||A.push({command:"setCenter",args:[l.center]}),pe(u.zoom,l.zoom)||A.push({command:"setZoom",args:[l.zoom]}),pe(u.bearing,l.bearing)||A.push({command:"setBearing",args:[l.bearing]}),pe(u.pitch,l.pitch)||A.push({command:"setPitch",args:[l.pitch]}),pe(u.sprite,l.sprite)||A.push({command:"setSprite",args:[l.sprite]}),pe(u.glyphs,l.glyphs)||A.push({command:"setGlyphs",args:[l.glyphs]}),pe(u.transition,l.transition)||A.push({command:"setTransition",args:[l.transition]}),pe(u.light,l.light)||A.push({command:"setLight",args:[l.light]}),pe(u.terrain,l.terrain)||A.push({command:"setTerrain",args:[l.terrain]}),pe(u.sky,l.sky)||A.push({command:"setSky",args:[l.sky]});const p={},v=[];(function(I,L,O,H){let q;for(q in L=L||{},I=I||{})Object.prototype.hasOwnProperty.call(I,q)&&(Object.prototype.hasOwnProperty.call(L,q)||Oe(q,O,H));for(q in L)Object.prototype.hasOwnProperty.call(L,q)&&(Object.prototype.hasOwnProperty.call(I,q)?pe(I[q],L[q])||(I[q].type==="geojson"&&L[q].type==="geojson"&&hr(I,L,q)?we(O,{command:"setGeoJSONSourceData",args:[q,L[q].data]}):nr(q,L,O,H)):Ie(q,L,O))})(u.sources,l.sources,v,p);const E=[];u.layers&&u.layers.forEach(I=>{"source"in I&&p[I.source]?A.push({command:"removeLayer",args:[I.id]}):E.push(I)}),A=A.concat(v),function(I,L,O){L=L||[];const H=(I=I||[]).map(Mr),q=L.map(Mr),$=I.reduce(kr,{}),Y=L.reduce(kr,{}),ot=H.slice(),ut=Object.create(null);let vt,It,Dt,te,Qt;for(let Kt=0,ve=0;Kt<H.length;Kt++)vt=H[Kt],Object.prototype.hasOwnProperty.call(Y,vt)?ve++:(we(O,{command:"removeLayer",args:[vt]}),ot.splice(ot.indexOf(vt,ve),1));for(let Kt=0,ve=0;Kt<q.length;Kt++)vt=q[q.length-1-Kt],ot[ot.length-1-Kt]!==vt&&(Object.prototype.hasOwnProperty.call($,vt)?(we(O,{command:"removeLayer",args:[vt]}),ot.splice(ot.lastIndexOf(vt,ot.length-ve),1)):ve++,te=ot[ot.length-Kt],we(O,{command:"addLayer",args:[Y[vt],te]}),ot.splice(ot.length-Kt,0,vt),ut[vt]=!0);for(let Kt=0;Kt<q.length;Kt++)if(vt=q[Kt],It=$[vt],Dt=Y[vt],!ut[vt]&&!pe(It,Dt))if(pe(It.source,Dt.source)&&pe(It["source-layer"],Dt["source-layer"])&&pe(It.type,Dt.type)){for(Qt in Sr(It.layout,Dt.layout,O,vt,null,"setLayoutProperty"),Sr(It.paint,Dt.paint,O,vt,null,"setPaintProperty"),pe(It.filter,Dt.filter)||we(O,{command:"setFilter",args:[vt,Dt.filter]}),pe(It.minzoom,Dt.minzoom)&&pe(It.maxzoom,Dt.maxzoom)||we(O,{command:"setLayerZoomRange",args:[vt,Dt.minzoom,Dt.maxzoom]}),It)Object.prototype.hasOwnProperty.call(It,Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Sr(It[Qt],Dt[Qt],O,vt,Qt.slice(6),"setPaintProperty"):pe(It[Qt],Dt[Qt])||we(O,{command:"setLayerProperty",args:[vt,Qt,Dt[Qt]]}));for(Qt in Dt)Object.prototype.hasOwnProperty.call(Dt,Qt)&&!Object.prototype.hasOwnProperty.call(It,Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Sr(It[Qt],Dt[Qt],O,vt,Qt.slice(6),"setPaintProperty"):pe(It[Qt],Dt[Qt])||we(O,{command:"setLayerProperty",args:[vt,Qt,Dt[Qt]]}))}else we(O,{command:"removeLayer",args:[vt]}),te=ot[ot.lastIndexOf(vt)+1],we(O,{command:"addLayer",args:[Dt,te]})}(E,l.layers,A)}catch(p){console.warn("Unable to compute style diff:",p),A=[{command:"setStyle",args:[l]}]}return A},a.aD=function(u){const l=[],A=u.id;return A===void 0&&l.push({message:`layers.${A}: missing required property "id"`}),u.render===void 0&&l.push({message:`layers.${A}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&l.push({message:`layers.${A}: property "renderingMode" must be either "2d" or "3d"`}),l},a.aE=function u(l,A){if(Array.isArray(l)){if(!Array.isArray(A)||l.length!==A.length)return!1;for(let p=0;p<l.length;p++)if(!u(l[p],A[p]))return!1;return!0}if(typeof l=="object"&&l!==null&&A!==null){if(typeof A!="object"||Object.keys(l).length!==Object.keys(A).length)return!1;for(const p in l)if(!u(l[p],A[p]))return!1;return!0}return l===A},a.aF=Mt,a.aG=Lt,a.aH=class extends Po{constructor(u,l){super(u,l),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},a.aI=Bp,a.aJ=class extends Po{constructor(u,l){super(u,l),this.current=G_}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let l=1;l<16;l++)if(u[l]!==this.current[l]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},a.aK=z_,a.aL=class extends Po{constructor(u,l){super(u,l),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},a.aM=class extends Po{constructor(u,l){super(u,l),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},a.aN=V_,a.aO=function(u,l,A,p,v,E,I){var L=1/(l-A),O=1/(p-v),H=1/(E-I);return u[0]=-2*L,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*O,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*H,u[11]=0,u[12]=(l+A)*L,u[13]=(v+p)*O,u[14]=(I+E)*H,u[15]=1,u},a.aP=lr,a.aQ=ubt,a.aR=class extends yt{},a.aS=ewt,a.aT=class extends Wt{},a.aU=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},a.aV=wN,a.aW=ci,a.aX=class extends Ee{},a.aY=Ui,a.aZ=function(u,l){return u[0]===l[0]&&u[1]===l[1]&&u[2]===l[2]&&u[3]===l[3]&&u[4]===l[4]&&u[5]===l[5]&&u[6]===l[6]&&u[7]===l[7]&&u[8]===l[8]&&u[9]===l[9]&&u[10]===l[10]&&u[11]===l[11]&&u[12]===l[12]&&u[13]===l[13]&&u[14]===l[14]&&u[15]===l[15]},a.a_=function(u,l){var A=u[0],p=u[1],v=u[2],E=u[3],I=u[4],L=u[5],O=u[6],H=u[7],q=u[8],$=u[9],Y=u[10],ot=u[11],ut=u[12],vt=u[13],It=u[14],Dt=u[15],te=l[0],Qt=l[1],Kt=l[2],ve=l[3],be=l[4],Ye=l[5],cr=l[6],We=l[7],Ge=l[8],ir=l[9],br=l[10],Xe=l[11],xe=l[12],ur=l[13],ar=l[14],Kr=l[15];return Math.abs(A-te)<=Mo*Math.max(1,Math.abs(A),Math.abs(te))&&Math.abs(p-Qt)<=Mo*Math.max(1,Math.abs(p),Math.abs(Qt))&&Math.abs(v-Kt)<=Mo*Math.max(1,Math.abs(v),Math.abs(Kt))&&Math.abs(E-ve)<=Mo*Math.max(1,Math.abs(E),Math.abs(ve))&&Math.abs(I-be)<=Mo*Math.max(1,Math.abs(I),Math.abs(be))&&Math.abs(L-Ye)<=Mo*Math.max(1,Math.abs(L),Math.abs(Ye))&&Math.abs(O-cr)<=Mo*Math.max(1,Math.abs(O),Math.abs(cr))&&Math.abs(H-We)<=Mo*Math.max(1,Math.abs(H),Math.abs(We))&&Math.abs(q-Ge)<=Mo*Math.max(1,Math.abs(q),Math.abs(Ge))&&Math.abs($-ir)<=Mo*Math.max(1,Math.abs($),Math.abs(ir))&&Math.abs(Y-br)<=Mo*Math.max(1,Math.abs(Y),Math.abs(br))&&Math.abs(ot-Xe)<=Mo*Math.max(1,Math.abs(ot),Math.abs(Xe))&&Math.abs(ut-xe)<=Mo*Math.max(1,Math.abs(ut),Math.abs(xe))&&Math.abs(vt-ur)<=Mo*Math.max(1,Math.abs(vt),Math.abs(ur))&&Math.abs(It-ar)<=Mo*Math.max(1,Math.abs(It),Math.abs(ar))&&Math.abs(Dt-Kr)<=Mo*Math.max(1,Math.abs(Dt),Math.abs(Kr))},a.aa=function(u){const l={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(A,p,v,E)=>{const I=v||E;return l[p]=!I||I.toLowerCase(),""}),l["max-age"]){const A=parseInt(l["max-age"],10);isNaN(A)?delete l["max-age"]:l["max-age"]=A}return l},a.ab=function(u,l){const A=[];for(const p in u)p in l||A.push(p);return A},a.ac=pt,a.ad=function(u,l,A){var p=Math.sin(A),v=Math.cos(A),E=l[0],I=l[1],L=l[2],O=l[3],H=l[4],q=l[5],$=l[6],Y=l[7];return l!==u&&(u[8]=l[8],u[9]=l[9],u[10]=l[10],u[11]=l[11],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15]),u[0]=E*v+H*p,u[1]=I*v+q*p,u[2]=L*v+$*p,u[3]=O*v+Y*p,u[4]=H*v-E*p,u[5]=q*v-I*p,u[6]=$*v-L*p,u[7]=Y*v-O*p,u},a.ae=function(u){var l=new Sp(16);return l[0]=u[0],l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=u[6],l[7]=u[7],l[8]=u[8],l[9]=u[9],l[10]=u[10],l[11]=u[11],l[12]=u[12],l[13]=u[13],l[14]=u[14],l[15]=u[15],l},a.af=X_,a.ag=function(u,l){let A=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:v,minZoom:E,maxZoom:I}=u,L=v?pt(Ir.interpolationFactor(v,l,E,I),0,1):0;u.kind==="camera"?p=zi.number(u.minSize,u.maxSize,L):A=L}return{uSizeT:A,uSize:p}},a.ai=function(u,l,A){let{uSize:p,uSizeT:v}=l,{lowerSize:E,upperSize:I}=A;return u.kind==="source"?E/Fu:u.kind==="composite"?zi.number(E/Fu,I/Fu,v):p},a.aj=oS,a.ak=function(u,l,A,p){const v=l.y-u.y,E=l.x-u.x,I=p.y-A.y,L=p.x-A.x,O=I*E-L*v;if(O===0)return null;const H=(L*(u.y-A.y)-I*(u.x-A.x))/O;return new b(u.x+H*E,u.y+H*v)},a.al=xk,a.am=j_,a.an=QE,a.ao=function(u){let l=1/0,A=1/0,p=-1/0,v=-1/0;for(const E of u)l=Math.min(l,E.x),A=Math.min(A,E.y),p=Math.max(p,E.x),v=Math.max(v,E.y);return[l,A,p,v]},a.ap=us,a.ar=sS,a.as=function(u,l){var A=l[0],p=l[1],v=l[2],E=l[3],I=l[4],L=l[5],O=l[6],H=l[7],q=l[8],$=l[9],Y=l[10],ot=l[11],ut=l[12],vt=l[13],It=l[14],Dt=l[15],te=A*L-p*I,Qt=A*O-v*I,Kt=A*H-E*I,ve=p*O-v*L,be=p*H-E*L,Ye=v*H-E*O,cr=q*vt-$*ut,We=q*It-Y*ut,Ge=q*Dt-ot*ut,ir=$*It-Y*vt,br=$*Dt-ot*vt,Xe=Y*Dt-ot*It,xe=te*Xe-Qt*br+Kt*ir+ve*Ge-be*We+Ye*cr;return xe?(u[0]=(L*Xe-O*br+H*ir)*(xe=1/xe),u[1]=(v*br-p*Xe-E*ir)*xe,u[2]=(vt*Ye-It*be+Dt*ve)*xe,u[3]=(Y*be-$*Ye-ot*ve)*xe,u[4]=(O*Ge-I*Xe-H*We)*xe,u[5]=(A*Xe-v*Ge+E*We)*xe,u[6]=(It*Kt-ut*Ye-Dt*Qt)*xe,u[7]=(q*Ye-Y*Kt+ot*Qt)*xe,u[8]=(I*br-L*Ge+H*cr)*xe,u[9]=(p*Ge-A*br-E*cr)*xe,u[10]=(ut*be-vt*Kt+Dt*te)*xe,u[11]=($*Kt-q*be-ot*te)*xe,u[12]=(L*We-I*ir-O*cr)*xe,u[13]=(A*ir-p*We+v*cr)*xe,u[14]=(vt*Qt-ut*ve-It*te)*xe,u[15]=(q*ve-$*Qt+Y*te)*xe,u):null},a.at=fS,a.au=iS,a.av=pS,a.aw=function(){const u={},l=lt.$version;for(const A in lt.$root){const p=lt.$root[A];if(p.required){let v=null;v=A==="version"?l:p.type==="array"?[]:{},v!=null&&(u[A]=v)}}return u},a.ax=wp,a.ay=oe,a.az=function(u){u=u.slice();const l=Object.create(null);for(let A=0;A<u.length;A++)l[u[A].id]=u[A];for(let A=0;A<u.length;A++)"ref"in u[A]&&(u[A]=er(u[A],l[u[A].ref]));return u},a.b=ee,a.b0=function(u,l,A){return u[0]=l[0]*A[0],u[1]=l[1]*A[1],u[2]=l[2]*A[2],u[3]=l[3]*A[3],u},a.b1=function(u,l){return u[0]*l[0]+u[1]*l[1]+u[2]*l[2]+u[3]*l[3]},a.b2=gt,a.b3=gk,a.b4=fk,a.b5=function(u,l,A,p,v){var E,I=1/Math.tan(l/2);return u[0]=I/A,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=I,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,v!=null&&v!==1/0?(u[10]=(v+p)*(E=1/(p-v)),u[14]=2*v*p*E):(u[10]=-1,u[14]=-2*p),u},a.b6=function(u,l,A){var p=Math.sin(A),v=Math.cos(A),E=l[4],I=l[5],L=l[6],O=l[7],H=l[8],q=l[9],$=l[10],Y=l[11];return l!==u&&(u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[3],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15]),u[4]=E*v+H*p,u[5]=I*v+q*p,u[6]=L*v+$*p,u[7]=O*v+Y*p,u[8]=H*v-E*p,u[9]=q*v-I*p,u[10]=$*v-L*p,u[11]=Y*v-O*p,u},a.b7=X,a.b8=et,a.b9=function(u){return u*Math.PI/180},a.bA=To,a.bB=ql,a.ba=function(u,l){return u[0]=l[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=l[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=l[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},a.bb=class extends N{},a.bc=uS,a.bd=Dwt,a.bf=Gt,a.bg=function(u,l){Pt.REGISTERED_PROTOCOLS[u]=l},a.bh=function(u){delete Pt.REGISTERED_PROTOCOLS[u]},a.bi=function(u,l){const A={};for(let v=0;v<u.length;v++){const E=l&&l[u[v].id]||_p(u[v]);l&&(l[u[v].id]=E);let I=A[E];I||(I=A[E]=[]),I.push(u[v])}const p=[];for(const v in A)p.push(A[v]);return p},a.bj=tr,a.bk=yk,a.bl=vk,a.bm=JN,a.bn=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=_i/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const l=u.bucket.layers[0],A=l.layout,p=l._unevaluatedLayout._values,v={layoutIconSize:p["icon-size"].possiblyEvaluate(new En(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new En(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new En(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:H,maxZoom:q}=u.bucket.textSizeData;v.compositeTextSizes=[p["text-size"].possiblyEvaluate(new En(H),u.canonical),p["text-size"].possiblyEvaluate(new En(q),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:H,maxZoom:q}=u.bucket.iconSizeData;v.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new En(H),u.canonical),p["icon-size"].possiblyEvaluate(new En(q),u.canonical)]}const E=A.get("text-line-height")*us,I=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",L=A.get("text-keep-upright"),O=A.get("text-size");for(const H of u.bucket.features){const q=A.get("text-font").evaluate(H,{},u.canonical).join(","),$=O.evaluate(H,{},u.canonical),Y=v.layoutTextSize.evaluate(H,{},u.canonical),ot=v.layoutIconSize.evaluate(H,{},u.canonical),ut={horizontal:{},vertical:void 0},vt=H.text;let It,Dt=[0,0];if(vt){const Kt=vt.toString(),ve=A.get("text-letter-spacing").evaluate(H,{},u.canonical)*us,be=Fo(Kt)?ve:0,Ye=A.get("text-anchor").evaluate(H,{},u.canonical),cr=Pk(l,H,u.canonical);if(!cr){const Xe=A.get("text-radial-offset").evaluate(H,{},u.canonical);Dt=Xe?Lk(Ye,[Xe*us,dS]):A.get("text-offset").evaluate(H,{},u.canonical).map(xe=>xe*us)}let We=I?"center":A.get("text-justify").evaluate(H,{},u.canonical);const Ge=A.get("symbol-placement"),ir=Ge==="point"?A.get("text-max-width").evaluate(H,{},u.canonical)*us:0,br=()=>{u.bucket.allowVerticalPlacement&&Ca(Kt)&&(ut.vertical=nv(vt,u.glyphMap,u.glyphPositions,u.imagePositions,q,ir,E,Ye,"left",be,Dt,a.ah.vertical,!0,Ge,Y,$))};if(!I&&cr){const Xe=new Set;if(We==="auto")for(let ur=0;ur<cr.values.length;ur+=2)Xe.add(fS(cr.values[ur]));else Xe.add(We);let xe=!1;for(const ur of Xe)if(!ut.horizontal[ur])if(xe)ut.horizontal[ur]=ut.horizontal[0];else{const ar=nv(vt,u.glyphMap,u.glyphPositions,u.imagePositions,q,ir,E,"center",ur,be,Dt,a.ah.horizontal,!1,Ge,Y,$);ar&&(ut.horizontal[ur]=ar,xe=ar.positionedLines.length===1)}br()}else{We==="auto"&&(We=fS(Ye));const Xe=nv(vt,u.glyphMap,u.glyphPositions,u.imagePositions,q,ir,E,Ye,We,be,Dt,a.ah.horizontal,!1,Ge,Y,$);Xe&&(ut.horizontal[We]=Xe),br(),Ca(Kt)&&I&&L&&(ut.vertical=nv(vt,u.glyphMap,u.glyphPositions,u.imagePositions,q,ir,E,Ye,We,be,Dt,a.ah.vertical,!1,Ge,Y,$))}}let te=!1;if(H.icon&&H.icon.name){const Kt=u.imageMap[H.icon.name];Kt&&(It=ywt(u.imagePositions[H.icon.name],A.get("icon-offset").evaluate(H,{},u.canonical),A.get("icon-anchor").evaluate(H,{},u.canonical)),te=!!Kt.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=te:u.bucket.sdfIcons!==te&&wt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Kt.pixelRatio!==u.bucket.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Qt=Uk(ut.horizontal)||ut.vertical;u.bucket.iconsInText=!!Qt&&Qt.iconsInText,(Qt||It)&&Rwt(u.bucket,H,ut,It,u.imageMap,v,Y,ot,Dt,te,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},a.bo=YE,a.bp=$E,a.bq=JE,a.br=Ch,a.bs=tS,a.bt=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},a.bu=function(u,l,A,p,v){return o(this,void 0,void 0,function*(){if(G())try{return yield ne(u,l,A,p,v)}catch{}return function(E,I,L,O,H){const q=E.width,$=E.height;re&&Be||(re=new OffscreenCanvas(q,$),Be=re.getContext("2d",{willReadFrequently:!0})),re.width=q,re.height=$,Be.drawImage(E,0,0,q,$);const Y=Be.getImageData(I,L,O,H);return Be.clearRect(0,0,q,$),Y.data}(u,l,A,p,v)})},a.bv=mk,a.bw=h,a.bx=f,a.by=zN,a.bz=function(u){return u.message===it},a.c=bt,a.d=u=>o(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(l)}catch(A){throw new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.e=mt,a.f=u=>new Promise((l,A)=>{const p=new Image;p.onload=()=>{l(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=$t})},p.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(u)],{type:"image/png"});p.src=u.byteLength?URL.createObjectURL(v):$t}),a.g=Ot,a.h=(u,l)=>ie(mt(u,{type:"json"}),l),a.i=Jt,a.j=ke,a.k=Ne,a.l=(u,l)=>ie(mt(u,{type:"arrayBuffer"}),l),a.m=ie,a.n=function(u){return new tS(u).readFields(hwt,[])},a.o=Wm,a.p=XN,a.q=_,a.r=Qm,a.s=Ce,a.t=Pd,a.u=Ke,a.v=lt,a.w=wt,a.x=el,a.y=function(u){let[l,A,p]=u;return A+=90,A*=Math.PI/180,p*=Math.PI/180,{x:l*Math.cos(A)*Math.sin(p),y:l*Math.sin(A)*Math.sin(p),z:l*Math.cos(p)}},a.z=zi}),i("worker",["./shared"],function(a){class o{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,J){for(const Ft of Z){this._layerConfigs[Ft.id]=Ft;const Nt=this._layers[Ft.id]=a.aA(Ft);Nt._featureFilter=a.a6(Nt.filter),this.keyCache[Ft.id]&&delete this.keyCache[Ft.id]}for(const Ft of J)delete this.keyCache[Ft],delete this._layerConfigs[Ft],delete this._layers[Ft];this.familiesBySource={};const st=a.bi(Object.values(this._layerConfigs),this.keyCache);for(const Ft of st){const Nt=Ft.map(ue=>this._layers[ue.id]),Ht=Nt[0];if(Ht.visibility==="none")continue;const jt=Ht.source||"";let Tt=this.familiesBySource[jt];Tt||(Tt=this.familiesBySource[jt]={});const Xt=Ht.sourceLayer||"_geojsonTileLayer";let _e=Tt[Xt];_e||(_e=Tt[Xt]=[]),_e.push(Nt)}}}class h{constructor(Z){const J={},st=[];for(const jt in Z){const Tt=Z[jt],Xt=J[jt]={};for(const _e in Tt){const ue=Tt[+_e];if(!ue||ue.bitmap.width===0||ue.bitmap.height===0)continue;const Ae={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};st.push(Ae),Xt[_e]={rect:Ae,metrics:ue.metrics}}}const{w:Ft,h:Nt}=a.p(st),Ht=new a.o({width:Ft||1,height:Nt||1});for(const jt in Z){const Tt=Z[jt];for(const Xt in Tt){const _e=Tt[+Xt];if(!_e||_e.bitmap.width===0||_e.bitmap.height===0)continue;const ue=J[jt][Xt].rect;a.o.copy(_e.bitmap,Ht,{x:0,y:0},{x:ue.x+1,y:ue.y+1},_e.bitmap)}}this.image=Ht,this.positions=J}}a.bj("GlyphAtlas",h);class f{constructor(Z){this.tileID=new a.Q(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId,this.inFlightDependencies=[]}parse(Z,J,st,Ft){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=Z,this.collisionBoxArray=new a.a4;const Nt=new a.bk(Object.keys(Z.layers).sort()),Ht=new a.bl(this.tileID,this.promoteId);Ht.bucketLayerIDs=[];const jt={},Tt={featureIndex:Ht,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:st},Xt=J.familiesBySource[this.source];for(const vr in Xt){const Wr=Z.layers[vr];if(!Wr)continue;Wr.version===1&&a.w(`Vector tile source "${this.source}" layer "${vr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _n=Nt.encode(vr),Rn=[];for(let Zn=0;Zn<Wr.length;Zn++){const Rt=Wr.feature(Zn),qe=Ht.getId(Rt,vr);Rn.push({feature:Rt,id:qe,index:Zn,sourceLayerIndex:_n})}for(const Zn of Xt[vr]){const Rt=Zn[0];Rt.source!==this.source&&a.w(`layer.source = ${Rt.source} does not equal this.source = ${this.source}`),Rt.minzoom&&this.zoom<Math.floor(Rt.minzoom)||Rt.maxzoom&&this.zoom>=Rt.maxzoom||Rt.visibility!=="none"&&(m(Zn,this.zoom,st),(jt[Rt.id]=Rt.createBucket({index:Ht.bucketLayerIDs.length,layers:Zn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_n,sourceID:this.source})).populate(Rn,Tt,this.tileID.canonical),Ht.bucketLayerIDs.push(Zn.map(qe=>qe.id)))}}const _e=a.aF(Tt.glyphDependencies,vr=>Object.keys(vr).map(Number));this.inFlightDependencies.forEach(vr=>vr==null?void 0:vr.abort()),this.inFlightDependencies=[];let ue=Promise.resolve({});if(Object.keys(_e).length){const vr=new AbortController;this.inFlightDependencies.push(vr),ue=Ft.sendAsync({type:"GG",data:{stacks:_e,source:this.source,tileID:this.tileID,type:"glyphs"}},vr)}const Ae=Object.keys(Tt.iconDependencies);let ze=Promise.resolve({});if(Ae.length){const vr=new AbortController;this.inFlightDependencies.push(vr),ze=Ft.sendAsync({type:"GI",data:{icons:Ae,source:this.source,tileID:this.tileID,type:"icons"}},vr)}const Ve=Object.keys(Tt.patternDependencies);let Er=Promise.resolve({});if(Ve.length){const vr=new AbortController;this.inFlightDependencies.push(vr),Er=Ft.sendAsync({type:"GI",data:{icons:Ve,source:this.source,tileID:this.tileID,type:"patterns"}},vr)}const[_r,Ur,Vr]=yield Promise.all([ue,ze,Er]),Gr=new h(_r),Zr=new a.bm(Ur,Vr);for(const vr in jt){const Wr=jt[vr];Wr instanceof a.a5?(m(Wr.layers,this.zoom,st),a.bn({bucket:Wr,glyphMap:_r,glyphPositions:Gr.positions,imageMap:Ur,imagePositions:Zr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Wr.hasPattern&&(Wr instanceof a.bo||Wr instanceof a.bp||Wr instanceof a.bq)&&(m(Wr.layers,this.zoom,st),Wr.addFeatures(Tt,this.tileID.canonical,Zr.patternPositions))}return this.status="done",{buckets:Object.values(jt).filter(vr=>!vr.isEmpty()),featureIndex:Ht,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gr.image,imageAtlas:Zr,glyphMap:this.returnDependencies?_r:null,iconMap:this.returnDependencies?Ur:null,glyphPositions:this.returnDependencies?Gr.positions:null}})}}function m(Bt,Z,J){const st=new a.a8(Z);for(const Ft of Bt)Ft.recalculate(st,J)}class b{constructor(Z,J,st){this.actor=Z,this.layerIndex=J,this.availableImages=st,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Z,J){return a._(this,void 0,void 0,function*(){const st=yield a.l(Z.request,J);try{return{vectorTile:new a.br.VectorTile(new a.bs(st.data)),rawData:st.data,cacheControl:st.cacheControl,expires:st.expires}}catch(Ft){const Nt=new Uint8Array(st.data);let Ht=`Unable to parse the tile at ${Z.request.url}, `;throw Ht+=Nt[0]===31&&Nt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ft.messge}`,new Error(Ht)}})}loadTile(Z){return a._(this,void 0,void 0,function*(){const J=Z.uid,st=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new a.bt(Z.request),Ft=new f(Z);this.loading[J]=Ft;const Nt=new AbortController;Ft.abort=Nt;try{const Ht=yield this.loadVectorTile(Z,Nt);if(delete this.loading[J],!Ht)return null;const jt=Ht.rawData,Tt={};Ht.expires&&(Tt.expires=Ht.expires),Ht.cacheControl&&(Tt.cacheControl=Ht.cacheControl);const Xt={};if(st){const ue=st.finish();ue&&(Xt.resourceTiming=JSON.parse(JSON.stringify(ue)))}Ft.vectorTile=Ht.vectorTile;const _e=Ft.parse(Ht.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[J]=Ft,this.fetching[J]={rawTileData:jt,cacheControl:Tt,resourceTiming:Xt};try{const ue=yield _e;return a.e({rawTileData:jt.slice(0)},ue,Tt,Xt)}finally{delete this.fetching[J]}}catch(Ht){throw delete this.loading[J],Ft.status="done",this.loaded[J]=Ft,Ht}})}reloadTile(Z){return a._(this,void 0,void 0,function*(){const J=Z.uid;if(!this.loaded||!this.loaded[J])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const st=this.loaded[J];if(st.showCollisionBoxes=Z.showCollisionBoxes,st.status==="parsing"){const Ft=yield st.parse(st.vectorTile,this.layerIndex,this.availableImages,this.actor);let Nt;if(this.fetching[J]){const{rawTileData:Ht,cacheControl:jt,resourceTiming:Tt}=this.fetching[J];delete this.fetching[J],Nt=a.e({rawTileData:Ht.slice(0)},Ft,jt,Tt)}else Nt=Ft;return Nt}if(st.status==="done"&&st.vectorTile)return st.parse(st.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Z){return a._(this,void 0,void 0,function*(){const J=this.loading,st=Z.uid;J&&J[st]&&J[st].abort&&(J[st].abort.abort(),delete J[st])})}removeTile(Z){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Z.uid]&&delete this.loaded[Z.uid]})}}class x{constructor(){this.loaded={}}loadTile(Z){return a._(this,void 0,void 0,function*(){const{uid:J,encoding:st,rawImageData:Ft,redFactor:Nt,greenFactor:Ht,blueFactor:jt,baseShift:Tt}=Z,Xt=Ft.width+2,_e=Ft.height+2,ue=a.b(Ft)?new a.R({width:Xt,height:_e},yield a.bu(Ft,-1,-1,Xt,_e)):Ft,Ae=new a.bv(J,ue,st,Nt,Ht,jt,Tt);return this.loaded=this.loaded||{},this.loaded[J]=Ae,Ae})}removeTile(Z){const J=this.loaded,st=Z.uid;J&&J[st]&&delete J[st]}}function B(Bt,Z){if(Bt.length!==0){P(Bt[0],Z);for(var J=1;J<Bt.length;J++)P(Bt[J],!Z)}}function P(Bt,Z){for(var J=0,st=0,Ft=0,Nt=Bt.length,Ht=Nt-1;Ft<Nt;Ht=Ft++){var jt=(Bt[Ft][0]-Bt[Ht][0])*(Bt[Ht][1]+Bt[Ft][1]),Tt=J+jt;st+=Math.abs(J)>=Math.abs(jt)?J-Tt+jt:jt-Tt+J,J=Tt}J+st>=0!=!!Z&&Bt.reverse()}var R=a.bw(function Bt(Z,J){var st,Ft=Z&&Z.type;if(Ft==="FeatureCollection")for(st=0;st<Z.features.length;st++)Bt(Z.features[st],J);else if(Ft==="GeometryCollection")for(st=0;st<Z.geometries.length;st++)Bt(Z.geometries[st],J);else if(Ft==="Feature")Bt(Z.geometry,J);else if(Ft==="Polygon")B(Z.coordinates,J);else if(Ft==="MultiPolygon")for(st=0;st<Z.coordinates.length;st++)B(Z.coordinates[st],J);return Z});const Q=a.br.VectorTileFeature.prototype.toGeoJSON;var z={exports:{}},G=a.bx,X=a.br.VectorTileFeature,et=pt;function pt(Bt,Z){this.options=Z||{},this.features=Bt,this.length=Bt.length}function gt(Bt,Z){this.id=typeof Bt.id=="number"?Bt.id:void 0,this.type=Bt.type,this.rawGeometry=Bt.type===1?[Bt.geometry]:Bt.geometry,this.properties=Bt.tags,this.extent=Z||4096}pt.prototype.feature=function(Bt){return new gt(this.features[Bt],this.options.extent)},gt.prototype.loadGeometry=function(){var Bt=this.rawGeometry;this.geometry=[];for(var Z=0;Z<Bt.length;Z++){for(var J=Bt[Z],st=[],Ft=0;Ft<J.length;Ft++)st.push(new G(J[Ft][0],J[Ft][1]));this.geometry.push(st)}return this.geometry},gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Bt=this.geometry,Z=1/0,J=-1/0,st=1/0,Ft=-1/0,Nt=0;Nt<Bt.length;Nt++)for(var Ht=Bt[Nt],jt=0;jt<Ht.length;jt++){var Tt=Ht[jt];Z=Math.min(Z,Tt.x),J=Math.max(J,Tt.x),st=Math.min(st,Tt.y),Ft=Math.max(Ft,Tt.y)}return[Z,st,J,Ft]},gt.prototype.toGeoJSON=X.prototype.toGeoJSON;var mt=a.by,ft=et;function Mt(Bt){var Z=new mt;return function(J,st){for(var Ft in J.layers)st.writeMessage(3,Lt,J.layers[Ft])}(Bt,Z),Z.finish()}function Lt(Bt,Z){var J;Z.writeVarintField(15,Bt.version||1),Z.writeStringField(1,Bt.name||""),Z.writeVarintField(5,Bt.extent||4096);var st={keys:[],values:[],keycache:{},valuecache:{}};for(J=0;J<Bt.length;J++)st.feature=Bt.feature(J),Z.writeMessage(2,at,st);var Ft=st.keys;for(J=0;J<Ft.length;J++)Z.writeStringField(3,Ft[J]);var Nt=st.values;for(J=0;J<Nt.length;J++)Z.writeMessage(4,Yt,Nt[J])}function at(Bt,Z){var J=Bt.feature;J.id!==void 0&&Z.writeVarintField(1,J.id),Z.writeMessage(2,ct,Bt),Z.writeVarintField(3,J.type),Z.writeMessage(4,Jt,J)}function ct(Bt,Z){var J=Bt.feature,st=Bt.keys,Ft=Bt.values,Nt=Bt.keycache,Ht=Bt.valuecache;for(var jt in J.properties){var Tt=J.properties[jt],Xt=Nt[jt];if(Tt!==null){Xt===void 0&&(st.push(jt),Nt[jt]=Xt=st.length-1),Z.writeVarint(Xt);var _e=typeof Tt;_e!=="string"&&_e!=="boolean"&&_e!=="number"&&(Tt=JSON.stringify(Tt));var ue=_e+":"+Tt,Ae=Ht[ue];Ae===void 0&&(Ft.push(Tt),Ht[ue]=Ae=Ft.length-1),Z.writeVarint(Ae)}}}function wt(Bt,Z){return(Z<<3)+(7&Bt)}function _t(Bt){return Bt<<1^Bt>>31}function Jt(Bt,Z){for(var J=Bt.loadGeometry(),st=Bt.type,Ft=0,Nt=0,Ht=J.length,jt=0;jt<Ht;jt++){var Tt=J[jt],Xt=1;st===1&&(Xt=Tt.length),Z.writeVarint(wt(1,Xt));for(var _e=st===3?Tt.length-1:Tt.length,ue=0;ue<_e;ue++){ue===1&&st!==1&&Z.writeVarint(wt(2,_e-1));var Ae=Tt[ue].x-Ft,ze=Tt[ue].y-Nt;Z.writeVarint(_t(Ae)),Z.writeVarint(_t(ze)),Ft+=Ae,Nt+=ze}st===3&&Z.writeVarint(wt(7,1))}}function Yt(Bt,Z){var J=typeof Bt;J==="string"?Z.writeStringField(1,Bt):J==="boolean"?Z.writeBooleanField(7,Bt):J==="number"&&(Bt%1!=0?Z.writeDoubleField(3,Bt):Bt<0?Z.writeSVarintField(6,Bt):Z.writeVarintField(5,Bt))}z.exports=Mt,z.exports.fromVectorTileJs=Mt,z.exports.fromGeojsonVt=function(Bt,Z){Z=Z||{};var J={};for(var st in Bt)J[st]=new ft(Bt[st].features,Z),J[st].name=st,J[st].version=Z.version,J[st].extent=Z.extent;return Mt({layers:J})},z.exports.GeoJSONWrapper=ft;var ee=a.bw(z.exports);const $t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Bt=>Bt},ne=Math.fround||(re=new Float32Array(1),Bt=>(re[0]=+Bt,re[0]));var re;const Be=3,it=5,bt=6;class Pt{constructor(Z){this.options=Object.assign(Object.create($t),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:J,minZoom:st,maxZoom:Ft}=this.options;J&&console.time("total time");const Nt=`prepare ${Z.length} points`;J&&console.time(Nt),this.points=Z;const Ht=[];for(let Tt=0;Tt<Z.length;Tt++){const Xt=Z[Tt];if(!Xt.geometry)continue;const[_e,ue]=Xt.geometry.coordinates,Ae=ne(Gt(_e)),ze=ne(oe(ue));Ht.push(Ae,ze,1/0,Tt,-1,1),this.options.reduce&&Ht.push(0)}let jt=this.trees[Ft+1]=this._createTree(Ht);J&&console.timeEnd(Nt);for(let Tt=Ft;Tt>=st;Tt--){const Xt=+Date.now();jt=this.trees[Tt]=this._createTree(this._cluster(jt,Tt)),J&&console.log("z%d: %d clusters in %dms",Tt,jt.numItems,+Date.now()-Xt)}return J&&console.timeEnd("total time"),this}getClusters(Z,J){let st=((Z[0]+180)%360+360)%360-180;const Ft=Math.max(-90,Math.min(90,Z[1]));let Nt=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Ht=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)st=-180,Nt=180;else if(st>Nt){const ue=this.getClusters([st,Ft,180,Ht],J),Ae=this.getClusters([-180,Ft,Nt,Ht],J);return ue.concat(Ae)}const jt=this.trees[this._limitZoom(J)],Tt=jt.range(Gt(st),oe(Ht),Gt(Nt),oe(Ft)),Xt=jt.data,_e=[];for(const ue of Tt){const Ae=this.stride*ue;_e.push(Xt[Ae+it]>1?Ot(Xt,Ae,this.clusterProps):this.points[Xt[Ae+Be]])}return _e}getChildren(Z){const J=this._getOriginId(Z),st=this._getOriginZoom(Z),Ft="No cluster with the specified id.",Nt=this.trees[st];if(!Nt)throw new Error(Ft);const Ht=Nt.data;if(J*this.stride>=Ht.length)throw new Error(Ft);const jt=this.options.radius/(this.options.extent*Math.pow(2,st-1)),Tt=Nt.within(Ht[J*this.stride],Ht[J*this.stride+1],jt),Xt=[];for(const _e of Tt){const ue=_e*this.stride;Ht[ue+4]===Z&&Xt.push(Ht[ue+it]>1?Ot(Ht,ue,this.clusterProps):this.points[Ht[ue+Be]])}if(Xt.length===0)throw new Error(Ft);return Xt}getLeaves(Z,J,st){const Ft=[];return this._appendLeaves(Ft,Z,J=J||10,st=st||0,0),Ft}getTile(Z,J,st){const Ft=this.trees[this._limitZoom(Z)],Nt=Math.pow(2,Z),{extent:Ht,radius:jt}=this.options,Tt=jt/Ht,Xt=(st-Tt)/Nt,_e=(st+1+Tt)/Nt,ue={features:[]};return this._addTileFeatures(Ft.range((J-Tt)/Nt,Xt,(J+1+Tt)/Nt,_e),Ft.data,J,st,Nt,ue),J===0&&this._addTileFeatures(Ft.range(1-Tt/Nt,Xt,1,_e),Ft.data,Nt,st,Nt,ue),J===Nt-1&&this._addTileFeatures(Ft.range(0,Xt,Tt/Nt,_e),Ft.data,-1,st,Nt,ue),ue.features.length?ue:null}getClusterExpansionZoom(Z){let J=this._getOriginZoom(Z)-1;for(;J<=this.options.maxZoom;){const st=this.getChildren(Z);if(J++,st.length!==1)break;Z=st[0].properties.cluster_id}return J}_appendLeaves(Z,J,st,Ft,Nt){const Ht=this.getChildren(J);for(const jt of Ht){const Tt=jt.properties;if(Tt&&Tt.cluster?Nt+Tt.point_count<=Ft?Nt+=Tt.point_count:Nt=this._appendLeaves(Z,Tt.cluster_id,st,Ft,Nt):Nt<Ft?Nt++:Z.push(jt),Z.length===st)break}return Nt}_createTree(Z){const J=new a.av(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let st=0;st<Z.length;st+=this.stride)J.add(Z[st],Z[st+1]);return J.finish(),J.data=Z,J}_addTileFeatures(Z,J,st,Ft,Nt,Ht){for(const jt of Z){const Tt=jt*this.stride,Xt=J[Tt+it]>1;let _e,ue,Ae;if(Xt)_e=qt(J,Tt,this.clusterProps),ue=J[Tt],Ae=J[Tt+1];else{const Er=this.points[J[Tt+Be]];_e=Er.properties;const[_r,Ur]=Er.geometry.coordinates;ue=Gt(_r),Ae=oe(Ur)}const ze={type:1,geometry:[[Math.round(this.options.extent*(ue*Nt-st)),Math.round(this.options.extent*(Ae*Nt-Ft))]],tags:_e};let Ve;Ve=Xt||this.options.generateId?J[Tt+Be]:this.points[J[Tt+Be]].id,Ve!==void 0&&(ze.id=Ve),Ht.features.push(ze)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,J){const{radius:st,extent:Ft,reduce:Nt,minPoints:Ht}=this.options,jt=st/(Ft*Math.pow(2,J)),Tt=Z.data,Xt=[],_e=this.stride;for(let ue=0;ue<Tt.length;ue+=_e){if(Tt[ue+2]<=J)continue;Tt[ue+2]=J;const Ae=Tt[ue],ze=Tt[ue+1],Ve=Z.within(Tt[ue],Tt[ue+1],jt),Er=Tt[ue+it];let _r=Er;for(const Ur of Ve){const Vr=Ur*_e;Tt[Vr+2]>J&&(_r+=Tt[Vr+it])}if(_r>Er&&_r>=Ht){let Ur,Vr=Ae*Er,Gr=ze*Er,Zr=-1;const vr=((ue/_e|0)<<5)+(J+1)+this.points.length;for(const Wr of Ve){const _n=Wr*_e;if(Tt[_n+2]<=J)continue;Tt[_n+2]=J;const Rn=Tt[_n+it];Vr+=Tt[_n]*Rn,Gr+=Tt[_n+1]*Rn,Tt[_n+4]=vr,Nt&&(Ur||(Ur=this._map(Tt,ue,!0),Zr=this.clusterProps.length,this.clusterProps.push(Ur)),Nt(Ur,this._map(Tt,_n)))}Tt[ue+4]=vr,Xt.push(Vr/_r,Gr/_r,1/0,vr,-1,_r),Nt&&Xt.push(Zr)}else{for(let Ur=0;Ur<_e;Ur++)Xt.push(Tt[ue+Ur]);if(_r>1)for(const Ur of Ve){const Vr=Ur*_e;if(!(Tt[Vr+2]<=J)){Tt[Vr+2]=J;for(let Gr=0;Gr<_e;Gr++)Xt.push(Tt[Vr+Gr])}}}}return Xt}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,J,st){if(Z[J+it]>1){const Ht=this.clusterProps[Z[J+bt]];return st?Object.assign({},Ht):Ht}const Ft=this.points[Z[J+Be]].properties,Nt=this.options.map(Ft);return st&&Nt===Ft?Object.assign({},Nt):Nt}}function Ot(Bt,Z,J){return{type:"Feature",id:Bt[Z+Be],properties:qt(Bt,Z,J),geometry:{type:"Point",coordinates:[(st=Bt[Z],360*(st-.5)),ie(Bt[Z+1])]}};var st}function qt(Bt,Z,J){const st=Bt[Z+it],Ft=st>=1e4?`${Math.round(st/1e3)}k`:st>=1e3?Math.round(st/100)/10+"k":st,Nt=Bt[Z+bt],Ht=Nt===-1?{}:Object.assign({},J[Nt]);return Object.assign(Ht,{cluster:!0,cluster_id:Bt[Z+Be],point_count:st,point_count_abbreviated:Ft})}function Gt(Bt){return Bt/360+.5}function oe(Bt){const Z=Math.sin(Bt*Math.PI/180),J=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return J<0?0:J>1?1:J}function ie(Bt){const Z=(180-360*Bt)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Ce(Bt,Z,J,st){for(var Ft,Nt=st,Ht=J-Z>>1,jt=J-Z,Tt=Bt[Z],Xt=Bt[Z+1],_e=Bt[J],ue=Bt[J+1],Ae=Z+3;Ae<J;Ae+=3){var ze=Fe(Bt[Ae],Bt[Ae+1],Tt,Xt,_e,ue);if(ze>Nt)Ft=Ae,Nt=ze;else if(ze===Nt){var Ve=Math.abs(Ae-Ht);Ve<jt&&(Ft=Ae,jt=Ve)}}Nt>st&&(Ft-Z>3&&Ce(Bt,Z,Ft,st),Bt[Ft+2]=Nt,J-Ft>3&&Ce(Bt,Ft,J,st))}function Fe(Bt,Z,J,st,Ft,Nt){var Ht=Ft-J,jt=Nt-st;if(Ht!==0||jt!==0){var Tt=((Bt-J)*Ht+(Z-st)*jt)/(Ht*Ht+jt*jt);Tt>1?(J=Ft,st=Nt):Tt>0&&(J+=Ht*Tt,st+=jt*Tt)}return(Ht=Bt-J)*Ht+(jt=Z-st)*jt}function Re(Bt,Z,J,st){var Ft={id:Bt===void 0?null:Bt,type:Z,geometry:J,tags:st,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Nt){var Ht=Nt.geometry,jt=Nt.type;if(jt==="Point"||jt==="MultiPoint"||jt==="LineString")Ne(Nt,Ht);else if(jt==="Polygon"||jt==="MultiLineString")for(var Tt=0;Tt<Ht.length;Tt++)Ne(Nt,Ht[Tt]);else if(jt==="MultiPolygon")for(Tt=0;Tt<Ht.length;Tt++)for(var Xt=0;Xt<Ht[Tt].length;Xt++)Ne(Nt,Ht[Tt][Xt])}(Ft),Ft}function Ne(Bt,Z){for(var J=0;J<Z.length;J+=3)Bt.minX=Math.min(Bt.minX,Z[J]),Bt.minY=Math.min(Bt.minY,Z[J+1]),Bt.maxX=Math.max(Bt.maxX,Z[J]),Bt.maxY=Math.max(Bt.maxY,Z[J+1])}function ke(Bt,Z,J,st){if(Z.geometry){var Ft=Z.geometry.coordinates,Nt=Z.geometry.type,Ht=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2),jt=[],Tt=Z.id;if(J.promoteId?Tt=Z.properties[J.promoteId]:J.generateId&&(Tt=st||0),Nt==="Point")fe(Ft,jt);else if(Nt==="MultiPoint")for(var Xt=0;Xt<Ft.length;Xt++)fe(Ft[Xt],jt);else if(Nt==="LineString")lt(Ft,jt,Ht,!1);else if(Nt==="MultiLineString"){if(J.lineMetrics){for(Xt=0;Xt<Ft.length;Xt++)lt(Ft[Xt],jt=[],Ht,!1),Bt.push(Re(Tt,"LineString",jt,Z.properties));return}pr(Ft,jt,Ht,!1)}else if(Nt==="Polygon")pr(Ft,jt,Ht,!0);else{if(Nt!=="MultiPolygon"){if(Nt==="GeometryCollection"){for(Xt=0;Xt<Z.geometry.geometries.length;Xt++)ke(Bt,{id:Tt,geometry:Z.geometry.geometries[Xt],properties:Z.properties},J,st);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Xt=0;Xt<Ft.length;Xt++){var _e=[];pr(Ft[Xt],_e,Ht,!0),jt.push(_e)}}Bt.push(Re(Tt,Nt,jt,Z.properties))}}function fe(Bt,Z){Z.push(er(Bt[0])),Z.push(pe(Bt[1])),Z.push(0)}function lt(Bt,Z,J,st){for(var Ft,Nt,Ht=0,jt=0;jt<Bt.length;jt++){var Tt=er(Bt[jt][0]),Xt=pe(Bt[jt][1]);Z.push(Tt),Z.push(Xt),Z.push(0),jt>0&&(Ht+=st?(Ft*Xt-Tt*Nt)/2:Math.sqrt(Math.pow(Tt-Ft,2)+Math.pow(Xt-Nt,2))),Ft=Tt,Nt=Xt}var _e=Z.length-3;Z[2]=1,Ce(Z,0,_e,J),Z[_e+2]=1,Z.size=Math.abs(Ht),Z.start=0,Z.end=Z.size}function pr(Bt,Z,J,st){for(var Ft=0;Ft<Bt.length;Ft++){var Nt=[];lt(Bt[Ft],Nt,J,st),Z.push(Nt)}}function er(Bt){return Bt/360+.5}function pe(Bt){var Z=Math.sin(Bt*Math.PI/180),J=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return J<0?0:J>1?1:J}function we(Bt,Z,J,st,Ft,Nt,Ht,jt){if(st/=Z,Nt>=(J/=Z)&&Ht<st)return Bt;if(Ht<J||Nt>=st)return null;for(var Tt=[],Xt=0;Xt<Bt.length;Xt++){var _e=Bt[Xt],ue=_e.geometry,Ae=_e.type,ze=Ft===0?_e.minX:_e.minY,Ve=Ft===0?_e.maxX:_e.maxY;if(ze>=J&&Ve<st)Tt.push(_e);else if(!(Ve<J||ze>=st)){var Er=[];if(Ae==="Point"||Ae==="MultiPoint")Ie(ue,Er,J,st,Ft);else if(Ae==="LineString")Oe(ue,Er,J,st,Ft,!1,jt.lineMetrics);else if(Ae==="MultiLineString")hr(ue,Er,J,st,Ft,!1);else if(Ae==="Polygon")hr(ue,Er,J,st,Ft,!0);else if(Ae==="MultiPolygon")for(var _r=0;_r<ue.length;_r++){var Ur=[];hr(ue[_r],Ur,J,st,Ft,!0),Ur.length&&Er.push(Ur)}if(Er.length){if(jt.lineMetrics&&Ae==="LineString"){for(_r=0;_r<Er.length;_r++)Tt.push(Re(_e.id,Ae,Er[_r],_e.tags));continue}Ae!=="LineString"&&Ae!=="MultiLineString"||(Er.length===1?(Ae="LineString",Er=Er[0]):Ae="MultiLineString"),Ae!=="Point"&&Ae!=="MultiPoint"||(Ae=Er.length===3?"Point":"MultiPoint"),Tt.push(Re(_e.id,Ae,Er,_e.tags))}}}return Tt.length?Tt:null}function Ie(Bt,Z,J,st,Ft){for(var Nt=0;Nt<Bt.length;Nt+=3){var Ht=Bt[Nt+Ft];Ht>=J&&Ht<=st&&(Z.push(Bt[Nt]),Z.push(Bt[Nt+1]),Z.push(Bt[Nt+2]))}}function Oe(Bt,Z,J,st,Ft,Nt,Ht){for(var jt,Tt,Xt=nr(Bt),_e=Ft===0?Mr:kr,ue=Bt.start,Ae=0;Ae<Bt.length-3;Ae+=3){var ze=Bt[Ae],Ve=Bt[Ae+1],Er=Bt[Ae+2],_r=Bt[Ae+3],Ur=Bt[Ae+4],Vr=Ft===0?ze:Ve,Gr=Ft===0?_r:Ur,Zr=!1;Ht&&(jt=Math.sqrt(Math.pow(ze-_r,2)+Math.pow(Ve-Ur,2))),Vr<J?Gr>J&&(Tt=_e(Xt,ze,Ve,_r,Ur,J),Ht&&(Xt.start=ue+jt*Tt)):Vr>st?Gr<st&&(Tt=_e(Xt,ze,Ve,_r,Ur,st),Ht&&(Xt.start=ue+jt*Tt)):Sr(Xt,ze,Ve,Er),Gr<J&&Vr>=J&&(Tt=_e(Xt,ze,Ve,_r,Ur,J),Zr=!0),Gr>st&&Vr<=st&&(Tt=_e(Xt,ze,Ve,_r,Ur,st),Zr=!0),!Nt&&Zr&&(Ht&&(Xt.end=ue+jt*Tt),Z.push(Xt),Xt=nr(Bt)),Ht&&(ue+=jt)}var vr=Bt.length-3;ze=Bt[vr],Ve=Bt[vr+1],Er=Bt[vr+2],(Vr=Ft===0?ze:Ve)>=J&&Vr<=st&&Sr(Xt,ze,Ve,Er),vr=Xt.length-3,Nt&&vr>=3&&(Xt[vr]!==Xt[0]||Xt[vr+1]!==Xt[1])&&Sr(Xt,Xt[0],Xt[1],Xt[2]),Xt.length&&Z.push(Xt)}function nr(Bt){var Z=[];return Z.size=Bt.size,Z.start=Bt.start,Z.end=Bt.end,Z}function hr(Bt,Z,J,st,Ft,Nt){for(var Ht=0;Ht<Bt.length;Ht++)Oe(Bt[Ht],Z,J,st,Ft,Nt,!1)}function Sr(Bt,Z,J,st){Bt.push(Z),Bt.push(J),Bt.push(st)}function Mr(Bt,Z,J,st,Ft,Nt){var Ht=(Nt-Z)/(st-Z);return Bt.push(Nt),Bt.push(J+(Ft-J)*Ht),Bt.push(1),Ht}function kr(Bt,Z,J,st,Ft,Nt){var Ht=(Nt-J)/(Ft-J);return Bt.push(Z+(st-Z)*Ht),Bt.push(Nt),Bt.push(1),Ht}function ye(Bt,Z){for(var J=[],st=0;st<Bt.length;st++){var Ft,Nt=Bt[st],Ht=Nt.type;if(Ht==="Point"||Ht==="MultiPoint"||Ht==="LineString")Ft=or(Nt.geometry,Z);else if(Ht==="MultiLineString"||Ht==="Polygon"){Ft=[];for(var jt=0;jt<Nt.geometry.length;jt++)Ft.push(or(Nt.geometry[jt],Z))}else if(Ht==="MultiPolygon")for(Ft=[],jt=0;jt<Nt.geometry.length;jt++){for(var Tt=[],Xt=0;Xt<Nt.geometry[jt].length;Xt++)Tt.push(or(Nt.geometry[jt][Xt],Z));Ft.push(Tt)}J.push(Re(Nt.id,Ht,Ft,Nt.tags))}return J}function or(Bt,Z){var J=[];J.size=Bt.size,Bt.start!==void 0&&(J.start=Bt.start,J.end=Bt.end);for(var st=0;st<Bt.length;st+=3)J.push(Bt[st]+Z,Bt[st+1],Bt[st+2]);return J}function xr(Bt,Z){if(Bt.transformed)return Bt;var J,st,Ft,Nt=1<<Bt.z,Ht=Bt.x,jt=Bt.y;for(J=0;J<Bt.features.length;J++){var Tt=Bt.features[J],Xt=Tt.geometry,_e=Tt.type;if(Tt.geometry=[],_e===1)for(st=0;st<Xt.length;st+=2)Tt.geometry.push(De(Xt[st],Xt[st+1],Z,Nt,Ht,jt));else for(st=0;st<Xt.length;st++){var ue=[];for(Ft=0;Ft<Xt[st].length;Ft+=2)ue.push(De(Xt[st][Ft],Xt[st][Ft+1],Z,Nt,Ht,jt));Tt.geometry.push(ue)}}return Bt.transformed=!0,Bt}function De(Bt,Z,J,st,Ft,Nt){return[Math.round(J*(Bt*st-Ft)),Math.round(J*(Z*st-Nt))]}function pn(Bt,Z,J,st,Ft){for(var Nt=Z===Ft.maxZoom?0:Ft.tolerance/((1<<Z)*Ft.extent),Ht={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:J,y:st,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},jt=0;jt<Bt.length;jt++){Ht.numFeatures++,ge(Ht,Bt[jt],Nt,Ft);var Tt=Bt[jt].minX,Xt=Bt[jt].minY,_e=Bt[jt].maxX,ue=Bt[jt].maxY;Tt<Ht.minX&&(Ht.minX=Tt),Xt<Ht.minY&&(Ht.minY=Xt),_e>Ht.maxX&&(Ht.maxX=_e),ue>Ht.maxY&&(Ht.maxY=ue)}return Ht}function ge(Bt,Z,J,st){var Ft=Z.geometry,Nt=Z.type,Ht=[];if(Nt==="Point"||Nt==="MultiPoint")for(var jt=0;jt<Ft.length;jt+=3)Ht.push(Ft[jt]),Ht.push(Ft[jt+1]),Bt.numPoints++,Bt.numSimplified++;else if(Nt==="LineString")yr(Ht,Ft,Bt,J,!1,!1);else if(Nt==="MultiLineString"||Nt==="Polygon")for(jt=0;jt<Ft.length;jt++)yr(Ht,Ft[jt],Bt,J,Nt==="Polygon",jt===0);else if(Nt==="MultiPolygon")for(var Tt=0;Tt<Ft.length;Tt++){var Xt=Ft[Tt];for(jt=0;jt<Xt.length;jt++)yr(Ht,Xt[jt],Bt,J,!0,jt===0)}if(Ht.length){var _e=Z.tags||null;if(Nt==="LineString"&&st.lineMetrics){for(var ue in _e={},Z.tags)_e[ue]=Z.tags[ue];_e.mapbox_clip_start=Ft.start/Ft.size,_e.mapbox_clip_end=Ft.end/Ft.size}var Ae={geometry:Ht,type:Nt==="Polygon"||Nt==="MultiPolygon"?3:Nt==="LineString"||Nt==="MultiLineString"?2:1,tags:_e};Z.id!==null&&(Ae.id=Z.id),Bt.features.push(Ae)}}function yr(Bt,Z,J,st,Ft,Nt){var Ht=st*st;if(st>0&&Z.size<(Ft?Ht:st))J.numPoints+=Z.length/3;else{for(var jt=[],Tt=0;Tt<Z.length;Tt+=3)(st===0||Z[Tt+2]>Ht)&&(J.numSimplified++,jt.push(Z[Tt]),jt.push(Z[Tt+1])),J.numPoints++;Ft&&function(Xt,_e){for(var ue=0,Ae=0,ze=Xt.length,Ve=ze-2;Ae<ze;Ve=Ae,Ae+=2)ue+=(Xt[Ae]-Xt[Ve])*(Xt[Ae+1]+Xt[Ve+1]);if(ue>0===_e)for(Ae=0,ze=Xt.length;Ae<ze/2;Ae+=2){var Er=Xt[Ae],_r=Xt[Ae+1];Xt[Ae]=Xt[ze-2-Ae],Xt[Ae+1]=Xt[ze-1-Ae],Xt[ze-2-Ae]=Er,Xt[ze-1-Ae]=_r}}(jt,Nt),Bt.push(jt)}}function je(Bt,Z){var J=(Z=this.options=function(Ft,Nt){for(var Ht in Nt)Ft[Ht]=Nt[Ht];return Ft}(Object.create(this.options),Z)).debug;if(J&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var st=function(Ft,Nt){var Ht=[];if(Ft.type==="FeatureCollection")for(var jt=0;jt<Ft.features.length;jt++)ke(Ht,Ft.features[jt],Nt,jt);else ke(Ht,Ft.type==="Feature"?Ft:{geometry:Ft},Nt);return Ht}(Bt,Z);this.tiles={},this.tileCoords=[],J&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),st=function(Ft,Nt){var Ht=Nt.buffer/Nt.extent,jt=Ft,Tt=we(Ft,1,-1-Ht,Ht,0,-1,2,Nt),Xt=we(Ft,1,1-Ht,2+Ht,0,-1,2,Nt);return(Tt||Xt)&&(jt=we(Ft,1,-Ht,1+Ht,0,-1,2,Nt)||[],Tt&&(jt=ye(Tt,1).concat(jt)),Xt&&(jt=jt.concat(ye(Xt,-1)))),jt}(st,Z),st.length&&this.splitTile(st,0,0,0),J&&(st.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Rr(Bt,Z,J){return 32*((1<<Bt)*J+Z)+Bt}function cn(Bt,Z){return Z?Bt.properties[Z]:Bt.id}function He(Bt,Z){if(Bt==null)return!0;if(Bt.type==="Feature")return cn(Bt,Z)!=null;if(Bt.type==="FeatureCollection"){const J=new Set;for(const st of Bt.features){const Ft=cn(st,Z);if(Ft==null||J.has(Ft))return!1;J.add(Ft)}return!0}return!1}function Kn(Bt,Z){const J=new Map;if(Bt!=null)if(Bt.type==="Feature")J.set(cn(Bt,Z),Bt);else for(const st of Bt.features)J.set(cn(st,Z),st);return J}je.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},je.prototype.splitTile=function(Bt,Z,J,st,Ft,Nt,Ht){for(var jt=[Bt,Z,J,st],Tt=this.options,Xt=Tt.debug;jt.length;){st=jt.pop(),J=jt.pop(),Z=jt.pop(),Bt=jt.pop();var _e=1<<Z,ue=Rr(Z,J,st),Ae=this.tiles[ue];if(!Ae&&(Xt>1&&console.time("creation"),Ae=this.tiles[ue]=pn(Bt,Z,J,st,Tt),this.tileCoords.push({z:Z,x:J,y:st}),Xt)){Xt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,J,st,Ae.numFeatures,Ae.numPoints,Ae.numSimplified),console.timeEnd("creation"));var ze="z"+Z;this.stats[ze]=(this.stats[ze]||0)+1,this.total++}if(Ae.source=Bt,Ft){if(Z===Tt.maxZoom||Z===Ft)continue;var Ve=1<<Ft-Z;if(J!==Math.floor(Nt/Ve)||st!==Math.floor(Ht/Ve))continue}else if(Z===Tt.indexMaxZoom||Ae.numPoints<=Tt.indexMaxPoints)continue;if(Ae.source=null,Bt.length!==0){Xt>1&&console.time("clipping");var Er,_r,Ur,Vr,Gr,Zr,vr=.5*Tt.buffer/Tt.extent,Wr=.5-vr,_n=.5+vr,Rn=1+vr;Er=_r=Ur=Vr=null,Gr=we(Bt,_e,J-vr,J+_n,0,Ae.minX,Ae.maxX,Tt),Zr=we(Bt,_e,J+Wr,J+Rn,0,Ae.minX,Ae.maxX,Tt),Bt=null,Gr&&(Er=we(Gr,_e,st-vr,st+_n,1,Ae.minY,Ae.maxY,Tt),_r=we(Gr,_e,st+Wr,st+Rn,1,Ae.minY,Ae.maxY,Tt),Gr=null),Zr&&(Ur=we(Zr,_e,st-vr,st+_n,1,Ae.minY,Ae.maxY,Tt),Vr=we(Zr,_e,st+Wr,st+Rn,1,Ae.minY,Ae.maxY,Tt),Zr=null),Xt>1&&console.timeEnd("clipping"),jt.push(Er||[],Z+1,2*J,2*st),jt.push(_r||[],Z+1,2*J,2*st+1),jt.push(Ur||[],Z+1,2*J+1,2*st),jt.push(Vr||[],Z+1,2*J+1,2*st+1)}}},je.prototype.getTile=function(Bt,Z,J){var st=this.options,Ft=st.extent,Nt=st.debug;if(Bt<0||Bt>24)return null;var Ht=1<<Bt,jt=Rr(Bt,Z=(Z%Ht+Ht)%Ht,J);if(this.tiles[jt])return xr(this.tiles[jt],Ft);Nt>1&&console.log("drilling down to z%d-%d-%d",Bt,Z,J);for(var Tt,Xt=Bt,_e=Z,ue=J;!Tt&&Xt>0;)Xt--,_e=Math.floor(_e/2),ue=Math.floor(ue/2),Tt=this.tiles[Rr(Xt,_e,ue)];return Tt&&Tt.source?(Nt>1&&console.log("found parent tile z%d-%d-%d",Xt,_e,ue),Nt>1&&console.time("drilling down"),this.splitTile(Tt.source,Xt,_e,ue,Bt,Z,J),Nt>1&&console.timeEnd("drilling down"),this.tiles[jt]?xr(this.tiles[jt],Ft):null):null};class sn extends b{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Z,J){return a._(this,void 0,void 0,function*(){const st=Z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Ft=this._geoJSONIndex.getTile(st.z,st.x,st.y);if(!Ft)return null;const Nt=new class{constructor(jt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.W,this.length=jt.length,this._features=jt}feature(jt){return new class{constructor(Tt){this._feature=Tt,this.extent=a.W,this.type=Tt.type,this.properties=Tt.tags,"id"in Tt&&!isNaN(Tt.id)&&(this.id=parseInt(Tt.id,10))}loadGeometry(){if(this._feature.type===1){const Tt=[];for(const Xt of this._feature.geometry)Tt.push([new a.P(Xt[0],Xt[1])]);return Tt}{const Tt=[];for(const Xt of this._feature.geometry){const _e=[];for(const ue of Xt)_e.push(new a.P(ue[0],ue[1]));Tt.push(_e)}return Tt}}toGeoJSON(Tt,Xt,_e){return Q.call(this,Tt,Xt,_e)}}(this._features[jt])}}(Ft.features);let Ht=ee(Nt);return Ht.byteOffset===0&&Ht.byteLength===Ht.buffer.byteLength||(Ht=new Uint8Array(Ht)),{vectorTile:Nt,rawData:Ht.buffer}})}loadData(Z){return a._(this,void 0,void 0,function*(){var J;(J=this._pendingRequest)===null||J===void 0||J.abort();const st=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new a.bt(Z.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Z,this._pendingRequest),this._geoJSONIndex=Z.cluster?new Pt(function(Nt){let{superclusterOptions:Ht,clusterProperties:jt}=Nt;if(!jt||!Ht)return Ht;const Tt={},Xt={},_e={accumulated:null,zoom:0},ue={properties:null},Ae=Object.keys(jt);for(const ze of Ae){const[Ve,Er]=jt[ze],_r=a.bA(Er),Ur=a.bA(typeof Ve=="string"?[Ve,["accumulated"],["get",ze]]:Ve);Tt[ze]=_r.value,Xt[ze]=Ur.value}return Ht.map=ze=>{ue.properties=ze;const Ve={};for(const Er of Ae)Ve[Er]=Tt[Er].evaluate(_e,ue);return Ve},Ht.reduce=(ze,Ve)=>{ue.properties=Ve;for(const Er of Ae)_e.accumulated=ze[Er],ze[Er]=Xt[Er].evaluate(_e,ue)},Ht}(Z)).load((yield this._pendingData).features):new je(yield this._pendingData,Z.geojsonVtOptions),this.loaded={};const Ft={};if(st){const Nt=st.finish();Nt&&(Ft.resourceTiming={},Ft.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Nt)))}return Ft}catch(Ft){if(delete this._pendingRequest,a.bz(Ft))return{abandoned:!0};throw Ft}})}getData(){return a._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Z){const J=this.loaded;return J&&J[Z.uid]?super.reloadTile(Z):this.loadTile(Z)}loadAndProcessGeoJSON(Z,J){return a._(this,void 0,void 0,function*(){let st=yield this.loadGeoJSON(Z,J);if(delete this._pendingRequest,typeof st!="object")throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(R(st,!0),Z.filter){const Ft=a.bA(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ft.result==="error")throw new Error(Ft.value.map(Ht=>`${Ht.key}: ${Ht.message}`).join(", "));st={type:"FeatureCollection",features:st.features.filter(Ht=>Ft.value.evaluate({zoom:0},Ht))}}return st})}loadGeoJSON(Z,J){return a._(this,void 0,void 0,function*(){const{promoteId:st}=Z;if(Z.request){const Ft=yield a.h(Z.request,J);return this._dataUpdateable=He(Ft.data,st)?Kn(Ft.data,st):void 0,Ft.data}if(typeof Z.data=="string")try{const Ft=JSON.parse(Z.data);return this._dataUpdateable=He(Ft,st)?Kn(Ft,st):void 0,Ft}catch{throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`)}if(!Z.dataDiff)throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Z.source}`);return function(Ft,Nt,Ht){var jt,Tt,Xt,_e;if(Nt.removeAll&&Ft.clear(),Nt.remove)for(const ue of Nt.remove)Ft.delete(ue);if(Nt.add)for(const ue of Nt.add){const Ae=cn(ue,Ht);Ae!=null&&Ft.set(Ae,ue)}if(Nt.update)for(const ue of Nt.update){let Ae=Ft.get(ue.id);if(Ae==null)continue;const ze=!ue.removeAllProperties&&(((jt=ue.removeProperties)===null||jt===void 0?void 0:jt.length)>0||((Tt=ue.addOrUpdateProperties)===null||Tt===void 0?void 0:Tt.length)>0);if((ue.newGeometry||ue.removeAllProperties||ze)&&(Ae=Object.assign({},Ae),Ft.set(ue.id,Ae),ze&&(Ae.properties=Object.assign({},Ae.properties))),ue.newGeometry&&(Ae.geometry=ue.newGeometry),ue.removeAllProperties)Ae.properties={};else if(((Xt=ue.removeProperties)===null||Xt===void 0?void 0:Xt.length)>0)for(const Ve of ue.removeProperties)Object.prototype.hasOwnProperty.call(Ae.properties,Ve)&&delete Ae.properties[Ve];if(((_e=ue.addOrUpdateProperties)===null||_e===void 0?void 0:_e.length)>0)for(const{key:Ve,value:Er}of ue.addOrUpdateProperties)Ae.properties[Ve]=Er}}(this._dataUpdateable,Z.dataDiff,st),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Z){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Z){return this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId)}getClusterChildren(Z){return this._geoJSONIndex.getChildren(Z.clusterId)}getClusterLeaves(Z){return this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset)}}class Jr{constructor(Z){this.self=Z,this.actor=new a.C(Z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(J,st)=>{if(this.externalWorkerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.externalWorkerSourceTypes[J]=st},this.self.addProtocol=a.bg,this.self.removeProtocol=a.bh,this.self.registerRTLTextPlugin=J=>{if(a.bB.isParsed())throw new Error("RTL text plugin already registered.");a.bB.setMethods(J)},this.actor.registerMessageHandler("LDT",(J,st)=>this._getDEMWorkerSource(J,st.source).loadTile(st)),this.actor.registerMessageHandler("RDT",(J,st)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(J,st.source).removeTile(st)})),this.actor.registerMessageHandler("GCEZ",(J,st)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(J,st.type,st.source).getClusterExpansionZoom(st)})),this.actor.registerMessageHandler("GCC",(J,st)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(J,st.type,st.source).getClusterChildren(st)})),this.actor.registerMessageHandler("GCL",(J,st)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(J,st.type,st.source).getClusterLeaves(st)})),this.actor.registerMessageHandler("LD",(J,st)=>this._getWorkerSource(J,st.type,st.source).loadData(st)),this.actor.registerMessageHandler("GD",(J,st)=>this._getWorkerSource(J,st.type,st.source).getData()),this.actor.registerMessageHandler("LT",(J,st)=>this._getWorkerSource(J,st.type,st.source).loadTile(st)),this.actor.registerMessageHandler("RT",(J,st)=>this._getWorkerSource(J,st.type,st.source).reloadTile(st)),this.actor.registerMessageHandler("AT",(J,st)=>this._getWorkerSource(J,st.type,st.source).abortTile(st)),this.actor.registerMessageHandler("RMT",(J,st)=>this._getWorkerSource(J,st.type,st.source).removeTile(st)),this.actor.registerMessageHandler("RS",(J,st)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[J]||!this.workerSources[J][st.type]||!this.workerSources[J][st.type][st.source])return;const Ft=this.workerSources[J][st.type][st.source];delete this.workerSources[J][st.type][st.source],Ft.removeSource!==void 0&&Ft.removeSource(st)})),this.actor.registerMessageHandler("RM",J=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J]})),this.actor.registerMessageHandler("SR",(J,st)=>a._(this,void 0,void 0,function*(){this.referrer=st})),this.actor.registerMessageHandler("SRPS",(J,st)=>this._syncRTLPluginState(J,st)),this.actor.registerMessageHandler("IS",(J,st)=>a._(this,void 0,void 0,function*(){this.self.importScripts(st)})),this.actor.registerMessageHandler("SI",(J,st)=>this._setImages(J,st)),this.actor.registerMessageHandler("UL",(J,st)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(J).update(st.layers,st.removedIds)})),this.actor.registerMessageHandler("SL",(J,st)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(J).replace(st)}))}_setImages(Z,J){return a._(this,void 0,void 0,function*(){this.availableImages[Z]=J;for(const st in this.workerSources[Z]){const Ft=this.workerSources[Z][st];for(const Nt in Ft)Ft[Nt].availableImages=J}})}_syncRTLPluginState(Z,J){return a._(this,void 0,void 0,function*(){if(a.bB.isParsed())return a.bB.getState();if(J.pluginStatus!=="loading")return a.bB.setState(J),J;const st=J.pluginURL;if(this.self.importScripts(st),a.bB.isParsed()){const Ft={pluginStatus:"loaded",pluginURL:st};return a.bB.setState(Ft),Ft}throw a.bB.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${st}`)})}_getAvailableImages(Z){let J=this.availableImages[Z];return J||(J=[]),J}_getLayerIndex(Z){let J=this.layerIndexes[Z];return J||(J=this.layerIndexes[Z]=new o),J}_getWorkerSource(Z,J,st){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][J]||(this.workerSources[Z][J]={}),!this.workerSources[Z][J][st]){const Ft={sendAsync:(Nt,Ht)=>(Nt.targetMapId=Z,this.actor.sendAsync(Nt,Ht))};switch(J){case"vector":this.workerSources[Z][J][st]=new b(Ft,this._getLayerIndex(Z),this._getAvailableImages(Z));break;case"geojson":this.workerSources[Z][J][st]=new sn(Ft,this._getLayerIndex(Z),this._getAvailableImages(Z));break;default:this.workerSources[Z][J][st]=new this.externalWorkerSourceTypes[J](Ft,this._getLayerIndex(Z),this._getAvailableImages(Z))}}return this.workerSources[Z][J][st]}_getDEMWorkerSource(Z,J){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][J]||(this.demWorkerSources[Z][J]=new x),this.demWorkerSources[Z][J]}}return a.i(self)&&(self.worker=new Jr(self)),Jr}),i("index",["exports","./shared"],function(a,o){var h="4.3.2";let f,m;const b={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:C=>new Promise((c,d)=>{const _=requestAnimationFrame(c);C.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),d(o.c())})}),getImageData(C){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(C).getImageData(-c,-c,C.width+2*c,C.height+2*c)},getImageCanvasContext(C){const c=window.document.createElement("canvas"),d=c.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return c.width=C.width,c.height=C.height,d.drawImage(C,0,0,C.width,C.height),d},resolveURL:C=>(f||(f=document.createElement("a")),f.href=C,f.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(m==null&&(m=matchMedia("(prefers-reduced-motion: reduce)")),m.matches)}};class x{static testProp(c){if(!x.docStyle)return c[0];for(let d=0;d<c.length;d++)if(c[d]in x.docStyle)return c[d];return c[0]}static create(c,d,_){const w=window.document.createElement(c);return d!==void 0&&(w.className=d),_&&_.appendChild(w),w}static createNS(c,d){return window.document.createElementNS(c,d)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(c,d){c.style[x.transformProp]=d}static addEventListener(c,d,_){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};c.addEventListener(d,_,"passive"in w?w:w.capture)}static removeEventListener(c,d,_){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};c.removeEventListener(d,_,"passive"in w?w:w.capture)}static suppressClickInternal(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static getScale(c){const d=c.getBoundingClientRect();return{x:d.width/c.offsetWidth||1,y:d.height/c.offsetHeight||1,boundingClientRect:d}}static getPoint(c,d,_){const w=d.boundingClientRect;return new o.P((_.clientX-w.left)/d.x-c.clientLeft,(_.clientY-w.top)/d.y-c.clientTop)}static mousePos(c,d){const _=x.getScale(c);return x.getPoint(c,_,d)}static touchPos(c,d){const _=[],w=x.getScale(c);for(let T=0;T<d.length;T++)_.push(x.getPoint(c,w,d[T]));return _}static mouseButton(c){return c.button}static remove(c){c.parentNode&&c.parentNode.removeChild(c)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(C){!Q&&R&&(z?G(C):P=C)}};let P,R,Q=!1,z=!1;function G(C){const c=C.createTexture();C.bindTexture(C.TEXTURE_2D,c);try{if(C.texImage2D(C.TEXTURE_2D,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,R),C.isContextLost())return;B.supported=!0}catch{}C.deleteTexture(c),Q=!0}var X;typeof document<"u"&&(R=document.createElement("img"),R.onload=()=>{P&&G(P),P=null,z=!0},R.onerror=()=>{Q=!0,P=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(C){let c,d,_,w;C.resetRequestQueue=()=>{c=[],d=0,_=0,w={}},C.addThrottleControl=y=>{const S=_++;return w[S]=y,S},C.removeThrottleControl=y=>{delete w[y],U()},C.getImage=function(y,S){let F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((M,N)=>{B.supported&&(y.headers||(y.headers={}),y.headers.accept="image/webp,*/*"),o.e(y,{type:"image"}),c.push({abortController:S,requestParameters:y,supportImageRefresh:F,state:"queued",onError:k=>{N(k)},onSuccess:k=>{M(k)}}),U()})};const T=y=>o._(this,void 0,void 0,function*(){y.state="running";const{requestParameters:S,supportImageRefresh:F,onError:M,onSuccess:N,abortController:k}=y,V=F===!1&&!o.i(self)&&!o.g(S.url)&&(!S.headers||Object.keys(S.headers).reduce((tt,ht)=>tt&&ht==="accept",!0));d++;const j=V?g(S,k):o.m(S,k);try{const tt=yield j;delete y.abortController,y.state="completed",tt.data instanceof HTMLImageElement||o.b(tt.data)?N(tt):tt.data&&N({data:yield(K=tt.data,typeof createImageBitmap=="function"?o.d(K):o.f(K)),cacheControl:tt.cacheControl,expires:tt.expires})}catch(tt){delete y.abortController,M(tt)}finally{d--,U()}var K}),U=()=>{const y=(()=>{for(const S of Object.keys(w))if(w[S]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let S=d;S<y&&c.length>0;S++){const F=c.shift();F.abortController.signal.aborted?S--:T(F)}},g=(y,S)=>new Promise((F,M)=>{const N=new Image,k=y.url,V=y.credentials;V&&V==="include"?N.crossOrigin="use-credentials":(V&&V==="same-origin"||!o.s(k))&&(N.crossOrigin="anonymous"),S.signal.addEventListener("abort",()=>{N.src="",M(o.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,F({data:N})},N.onerror=()=>{N.onerror=N.onload=null,S.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=k})}(X||(X={})),X.resetRequestQueue();class et{constructor(c){this._transformRequestFn=c}transformRequest(c,d){return this._transformRequestFn&&this._transformRequestFn(c,d)||{url:c}}setTransformRequest(c){this._transformRequestFn=c}}function pt(C){var c=new o.A(3);return c[0]=C[0],c[1]=C[1],c[2]=C[2],c}var gt,mt=function(C,c,d){return C[0]=c[0]-d[0],C[1]=c[1]-d[1],C[2]=c[2]-d[2],C};gt=new o.A(3),o.A!=Float32Array&&(gt[0]=0,gt[1]=0,gt[2]=0);var ft=function(C){var c=C[0],d=C[1];return c*c+d*d};function Mt(C){const c=[];if(typeof C=="string")c.push({id:"default",url:C});else if(C&&C.length>0){const d=[];for(const{id:_,url:w}of C){const T=`${_}${w}`;d.indexOf(T)===-1&&(d.push(T),c.push({id:_,url:w}))}}return c}function Lt(C,c,d){const _=C.split("?");return _[0]+=`${c}${d}`,_.join("?")}(function(){var C=new o.A(2);o.A!=Float32Array&&(C[0]=0,C[1]=0)})();class at{constructor(c,d,_,w){this.context=c,this.format=_,this.texture=c.gl.createTexture(),this.update(d,w)}update(c,d,_){const{width:w,height:T}=c,U=!(this.size&&this.size[0]===w&&this.size[1]===T||_),{context:g}=this,{gl:y}=g;if(this.useMipmap=!!(d&&d.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!d||d.premultiply!==!1)),U)this.size=[w,T],c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||o.b(c)?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,c):y.texImage2D(y.TEXTURE_2D,0,this.format,w,T,0,this.format,y.UNSIGNED_BYTE,c.data);else{const{x:S,y:F}=_||{x:0,y:0};c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||o.b(c)?y.texSubImage2D(y.TEXTURE_2D,0,S,F,y.RGBA,y.UNSIGNED_BYTE,c):y.texSubImage2D(y.TEXTURE_2D,0,S,F,w,T,y.RGBA,y.UNSIGNED_BYTE,c.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)}bind(c,d,_){const{context:w}=this,{gl:T}=w;T.bindTexture(T.TEXTURE_2D,this.texture),_!==T.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=T.LINEAR),c!==this.filter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,c),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,_||c),this.filter=c),d!==this.wrap&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,d),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}function ct(C){const{userImage:c}=C;return!!(c&&c.render&&c.render())&&(C.data.replace(new Uint8Array(c.data.buffer)),!0)}class wt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:d,promiseResolve:_}of this.requestors)_(this._getImagesForIds(d));this.requestors=[]}}getImage(c){const d=this.images[c];if(d&&!d.data&&d.spriteData){const _=d.spriteData;d.data=new o.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),d.spriteData=null}return d}addImage(c,d){if(this.images[c])throw new Error(`Image id ${c} already exist, use updateImage instead`);this._validate(c,d)&&(this.images[c]=d)}_validate(c,d){let _=!0;const w=d.data||d.spriteData;return this._validateStretch(d.stretchX,w&&w.width)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,w&&w.height)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "content" value`))),_=!1),_}_validateStretch(c,d){if(!c)return!0;let _=0;for(const w of c){if(w[0]<_||w[1]<w[0]||d<w[1])return!1;_=w[1]}return!0}_validateContent(c,d){if(!c)return!0;if(c.length!==4)return!1;const _=d.spriteData,w=_&&_.width||d.data.width,T=_&&_.height||d.data.height;return!(c[0]<0||w<c[0]||c[1]<0||T<c[1]||c[2]<0||w<c[2]||c[3]<0||T<c[3]||c[2]<c[0]||c[3]<c[1])}updateImage(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const w=this.getImage(c);if(_&&(w.data.width!==d.data.width||w.data.height!==d.data.height))throw new Error(`size mismatch between old image (${w.data.width}x${w.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=w.version+1,this.images[c]=d,this.updatedImages[c]=!0}removeImage(c){const d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c){return new Promise((d,_)=>{let w=!0;if(!this.isLoaded())for(const T of c)this.images[T]||(w=!1);this.isLoaded()||w?d(this._getImagesForIds(c)):this.requestors.push({ids:c,promiseResolve:d})})}_getImagesForIds(c){const d={};for(const _ of c){let w=this.getImage(_);w||(this.fire(new o.k("styleimagemissing",{id:_})),w=this.getImage(_)),w?d[_]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,textFitWidth:w.textFitWidth,textFitHeight:w.textFitHeight,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:o.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:c,height:d}=this.atlasImage;return{width:c,height:d}}getPattern(c){const d=this.patterns[c],_=this.getImage(c);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const w={w:_.data.width+2,h:_.data.height+2,x:0,y:0},T=new o.I(w,_);this.patterns[c]={bin:w,position:T}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new at(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const T in this.patterns)c.push(this.patterns[T].bin);const{w:d,h:_}=o.p(c),w=this.atlasImage;w.resize({width:d||1,height:_||1});for(const T in this.patterns){const{bin:U}=this.patterns[T],g=U.x+1,y=U.y+1,S=this.getImage(T).data,F=S.width,M=S.height;o.R.copy(S,w,{x:0,y:0},{x:g,y},{width:F,height:M}),o.R.copy(S,w,{x:0,y:M-1},{x:g,y:y-1},{width:F,height:1}),o.R.copy(S,w,{x:0,y:0},{x:g,y:y+M},{width:F,height:1}),o.R.copy(S,w,{x:F-1,y:0},{x:g-1,y},{width:1,height:M}),o.R.copy(S,w,{x:0,y:0},{x:g+F,y},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const d of c){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.getImage(d);_||o.w(`Image with ID: "${d}" was not found`),ct(_)&&this.updateImage(d,_)}}}const _t=1e20;function Jt(C,c,d,_,w,T,U,g,y){for(let S=c;S<c+_;S++)Yt(C,d*T+S,T,w,U,g,y);for(let S=d;S<d+w;S++)Yt(C,S*T+c,1,_,U,g,y)}function Yt(C,c,d,_,w,T,U){T[0]=0,U[0]=-_t,U[1]=_t,w[0]=C[c];for(let g=1,y=0,S=0;g<_;g++){w[g]=C[c+g*d];const F=g*g;do{const M=T[y];S=(w[g]-w[M]+F-M*M)/(g-M)/2}while(S<=U[y]&&--y>-1);y++,T[y]=g,U[y]=S,U[y+1]=_t}for(let g=0,y=0;g<_;g++){for(;U[y+1]<g;)y++;const S=T[y],F=g-S;C[c+g*d]=w[S]+F*F}}class ee{constructor(c,d){this.requestManager=c,this.localIdeographFontFamily=d,this.entries={}}setURL(c){this.url=c}getGlyphs(c){return o._(this,void 0,void 0,function*(){const d=[];for(const T in c)for(const U of c[T])d.push(this._getAndCacheGlyphsPromise(T,U));const _=yield Promise.all(d),w={};for(const{stack:T,id:U,glyph:g}of _)w[T]||(w[T]={}),w[T][U]=g&&{id:g.id,bitmap:g.bitmap.clone(),metrics:g.metrics};return w})}_getAndCacheGlyphsPromise(c,d){return o._(this,void 0,void 0,function*(){let _=this.entries[c];_||(_=this.entries[c]={glyphs:{},requests:{},ranges:{}});let w=_.glyphs[d];if(w!==void 0)return{stack:c,id:d,glyph:w};if(w=this._tinySDF(_,c,d),w)return _.glyphs[d]=w,{stack:c,id:d,glyph:w};const T=Math.floor(d/256);if(256*T>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[T])return{stack:c,id:d,glyph:w};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[T]){const g=ee.loadGlyphRange(c,T,this.url,this.requestManager);_.requests[T]=g}const U=yield _.requests[T];for(const g in U)this._doesCharSupportLocalGlyph(+g)||(_.glyphs[+g]=U[+g]);return _.ranges[T]=!0,{stack:c,id:d,glyph:U[d]||null}})}_doesCharSupportLocalGlyph(c){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](c)||o.u["Hangul Syllables"](c)||o.u.Hiragana(c)||o.u.Katakana(c))}_tinySDF(c,d,_){const w=this.localIdeographFontFamily;if(!w||!this._doesCharSupportLocalGlyph(_))return;let T=c.tinySDF;if(!T){let g="400";/bold/i.test(d)?g="900":/medium/i.test(d)?g="500":/light/i.test(d)&&(g="200"),T=c.tinySDF=new ee.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:w,fontWeight:g})}const U=T.draw(String.fromCharCode(_));return{id:_,bitmap:new o.o({width:U.width||60,height:U.height||60},U.data),metrics:{width:U.glyphWidth/2||24,height:U.glyphHeight/2||24,left:U.glyphLeft/2+.5||0,top:U.glyphTop/2-27.5||-8,advance:U.glyphAdvance/2||24,isDoubleResolution:!0}}}}ee.loadGlyphRange=function(C,c,d,_){return o._(this,void 0,void 0,function*(){const w=256*c,T=w+255,U=_.transformRequest(d.replace("{fontstack}",C).replace("{range}",`${w}-${T}`),"Glyphs"),g=yield o.l(U,new AbortController);if(!g||!g.data)throw new Error(`Could not load glyph range. range: ${c}, ${w}-${T}`);const y={};for(const S of o.n(g.data))y[S.id]=S;return y})},ee.TinySDF=class{constructor(){let{fontSize:C=24,buffer:c=3,radius:d=8,cutoff:_=.25,fontFamily:w="sans-serif",fontWeight:T="normal",fontStyle:U="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=c,this.cutoff=_,this.radius=d;const g=this.size=C+4*c,y=this._createCanvas(g),S=this.ctx=y.getContext("2d",{willReadFrequently:!0});S.font=`${U} ${T} ${C}px ${w}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(C){const c=document.createElement("canvas");return c.width=c.height=C,c}draw(C){const{width:c,actualBoundingBoxAscent:d,actualBoundingBoxDescent:_,actualBoundingBoxLeft:w,actualBoundingBoxRight:T}=this.ctx.measureText(C),U=Math.ceil(d),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(T-w))),y=Math.min(this.size-this.buffer,U+Math.ceil(_)),S=g+2*this.buffer,F=y+2*this.buffer,M=Math.max(S*F,0),N=new Uint8ClampedArray(M),k={data:N,width:S,height:F,glyphWidth:g,glyphHeight:y,glyphTop:U,glyphLeft:0,glyphAdvance:c};if(g===0||y===0)return k;const{ctx:V,buffer:j,gridInner:K,gridOuter:tt}=this;V.clearRect(j,j,g,y),V.fillText(C,j,j+U);const ht=V.getImageData(j,j,g,y);tt.fill(_t,0,M),K.fill(0,0,M);for(let rt=0;rt<y;rt++)for(let At=0;At<g;At++){const St=ht.data[4*(rt*g+At)+3]/255;if(St===0)continue;const Ct=(rt+j)*S+At+j;if(St===1)tt[Ct]=0,K[Ct]=_t;else{const yt=.5-St;tt[Ct]=yt>0?yt*yt:0,K[Ct]=yt<0?yt*yt:0}}Jt(tt,0,0,S,F,S,this.f,this.v,this.z),Jt(K,j,j,g,y,S,this.f,this.v,this.z);for(let rt=0;rt<M;rt++){const At=Math.sqrt(tt[rt])-Math.sqrt(K[rt]);N[rt]=Math.round(255-255*(At/this.radius+this.cutoff))}return k}};class $t{constructor(){this.specification=o.v.light.position}possiblyEvaluate(c,d){return o.y(c.expression.evaluate(d))}interpolate(c,d,_){return{x:o.z.number(c.x,d.x,_),y:o.z.number(c.y,d.y,_),z:o.z.number(c.z,d.z,_)}}}let ne;class re extends o.E{constructor(c){super(),ne=ne||new o.q({anchor:new o.D(o.v.light.anchor),position:new $t,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(ne),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.r,c,d))for(const _ in c){const w=c[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),w):this._transitionable.setValue(_,w)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,_){return(!_||_.validate!==!1)&&o.t(this,c.call(o.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}class Be{constructor(c,d){this.width=c,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(c,d){const _=c.join(",")+String(d);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(c,d)),this.dashEntry[_]}getDashRanges(c,d,_){const w=[];let T=c.length%2==1?-c[c.length-1]*_:0,U=c[0]*_,g=!0;w.push({left:T,right:U,isDash:g,zeroLength:c[0]===0});let y=c[0];for(let S=1;S<c.length;S++){g=!g;const F=c[S];T=y*_,y+=F,U=y*_,w.push({left:T,right:U,isDash:g,zeroLength:F===0})}return w}addRoundDash(c,d,_){const w=d/2;for(let T=-_;T<=_;T++){const U=this.width*(this.nextRow+_+T);let g=0,y=c[g];for(let S=0;S<this.width;S++){S/y.right>1&&(y=c[++g]);const F=Math.abs(S-y.left),M=Math.abs(S-y.right),N=Math.min(F,M);let k;const V=T/_*(w+1);if(y.isDash){const j=w-Math.abs(V);k=Math.sqrt(N*N+j*j)}else k=w-Math.sqrt(N*N+V*V);this.data[U+S]=Math.max(0,Math.min(255,k+128))}}}addRegularDash(c){for(let g=c.length-1;g>=0;--g){const y=c[g],S=c[g+1];y.zeroLength?c.splice(g,1):S&&S.isDash===y.isDash&&(S.left=y.left,c.splice(g,1))}const d=c[0],_=c[c.length-1];d.isDash===_.isDash&&(d.left=_.left-this.width,_.right=d.right+this.width);const w=this.width*this.nextRow;let T=0,U=c[T];for(let g=0;g<this.width;g++){g/U.right>1&&(U=c[++T]);const y=Math.abs(g-U.left),S=Math.abs(g-U.right),F=Math.min(y,S);this.data[w+g]=Math.max(0,Math.min(255,(U.isDash?F:-F)+128))}}addDash(c,d){const _=d?7:0,w=2*_+1;if(this.nextRow+w>this.height)return o.w("LineAtlas out of space"),null;let T=0;for(let g=0;g<c.length;g++)T+=c[g];if(T!==0){const g=this.width/T,y=this.getDashRanges(c,this.width,g);d?this.addRoundDash(y,g,_):this.addRegularDash(y)}const U={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:T};return this.nextRow+=w,this.dirty=!0,U}bind(c){const d=c.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const it="maplibre_preloaded_worker_pool";class bt{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<bt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[it]}numActive(){return Object.keys(this.active).length}}const Pt=Math.floor(b.hardwareConcurrency/2);let Ot,qt;function Gt(){return Ot||(Ot=new bt),Ot}bt.workerCount=o.B(globalThis)?Math.max(Math.min(Pt,3),1):1;class oe{constructor(c,d){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=d;const _=this.workerPool.acquire(d);for(let w=0;w<_.length;w++){const T=new o.C(_[w],d);T.name=`Worker ${w}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(c,d){const _=[];for(const w of this.actors)_.push(w.sendAsync({type:c,data:d}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(d=>{d.remove()}),this.actors=[],c&&this.workerPool.release(this.id)}registerMessageHandler(c,d){for(const _ of this.actors)_.registerMessageHandler(c,d)}}function ie(){return qt||(qt=new oe(Gt(),o.G),qt.registerMessageHandler("GR",(C,c,d)=>o.m(c,d))),qt}function Ce(C,c){const d=o.F();return o.H(d,d,[1,1,0]),o.J(d,d,[.5*C.width,.5*C.height,1]),o.K(d,d,C.calculatePosMatrix(c.toUnwrapped()))}function Fe(C,c,d,_,w,T){const U=function(M,N,k){if(M)for(const V of M){const j=N[V];if(j&&j.source===k&&j.type==="fill-extrusion")return!0}else for(const V in N){const j=N[V];if(j.source===k&&j.type==="fill-extrusion")return!0}return!1}(w&&w.layers,c,C.id),g=T.maxPitchScaleFactor(),y=C.tilesIn(_,g,U);y.sort(Re);const S=[];for(const M of y)S.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(c,d,C._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,w,T,g,Ce(C.transform,M.tileID))});const F=function(M){const N={},k={};for(const V of M){const j=V.queryResults,K=V.wrappedTileID,tt=k[K]=k[K]||{};for(const ht in j){const rt=j[ht],At=tt[ht]=tt[ht]||{},St=N[ht]=N[ht]||[];for(const Ct of rt)At[Ct.featureIndex]||(At[Ct.featureIndex]=!0,St.push(Ct))}}return N}(S);for(const M in F)F[M].forEach(N=>{const k=N.feature,V=C.getFeatureState(k.layer["source-layer"],k.id);k.source=k.layer.source,k.layer["source-layer"]&&(k.sourceLayer=k.layer["source-layer"]),k.state=V});return F}function Re(C,c){const d=C.tileID,_=c.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function Ne(C,c,d){return o._(this,void 0,void 0,function*(){let _=C;if(C.url?_=(yield o.h(c.transformRequest(C.url,"Source"),d)).data:yield b.frameAsync(d),!_)return null;const w=o.L(o.e(_,C),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(w.vectorLayerIds=_.vector_layers.map(T=>T.id)),w})}class ke{constructor(c,d){c&&(d?this.setSouthWest(c).setNorthEast(d):Array.isArray(c)&&(c.length===4?this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]]):this.setSouthWest(c[0]).setNorthEast(c[1])))}setNorthEast(c){return this._ne=c instanceof o.M?new o.M(c.lng,c.lat):o.M.convert(c),this}setSouthWest(c){return this._sw=c instanceof o.M?new o.M(c.lng,c.lat):o.M.convert(c),this}extend(c){const d=this._sw,_=this._ne;let w,T;if(c instanceof o.M)w=c,T=c;else{if(!(c instanceof ke))return Array.isArray(c)?c.length===4||c.every(Array.isArray)?this.extend(ke.convert(c)):this.extend(o.M.convert(c)):c&&("lng"in c||"lon"in c)&&"lat"in c?this.extend(o.M.convert(c)):this;if(w=c._sw,T=c._ne,!w||!T)return this}return d||_?(d.lng=Math.min(w.lng,d.lng),d.lat=Math.min(w.lat,d.lat),_.lng=Math.max(T.lng,_.lng),_.lat=Math.max(T.lat,_.lat)):(this._sw=new o.M(w.lng,w.lat),this._ne=new o.M(T.lng,T.lat)),this}getCenter(){return new o.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.M(this.getWest(),this.getNorth())}getSouthEast(){return new o.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(c){const{lng:d,lat:_}=o.M.convert(c);let w=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(w=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&w}static convert(c){return c instanceof ke?c:c&&new ke(c)}static fromLngLat(c){const _=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,w=_/Math.cos(Math.PI/180*c.lat);return new ke(new o.M(c.lng-w,c.lat-_),new o.M(c.lng+w,c.lat+_))}}class fe{constructor(c,d,_){this.bounds=ke.convert(this.validateBounds(c)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const d=Math.pow(2,c.z),_=Math.floor(o.N(this.bounds.getWest())*d),w=Math.floor(o.O(this.bounds.getNorth())*d),T=Math.ceil(o.N(this.bounds.getEast())*d),U=Math.ceil(o.O(this.bounds.getSouth())*d);return c.x>=_&&c.x<T&&c.y>=w&&c.y<U}}class lt extends o.E{constructor(c,d,_,w){if(super(),this.id=c,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.L(d,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),c&&(o.e(this,c),c.bounds&&(this.tileBounds=new fe(c.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(c){this._tileJSONRequest=null,this.fire(new o.j(c))}})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.abort(),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(c){return o._(this,void 0,void 0,function*(){const d=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(d,"Tile"),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let w="RT";if(c.actor&&c.state!=="expired"){if(c.state==="loading")return new Promise((T,U)=>{c.reloadPromise={resolve:T,reject:U}})}else c.actor=this.dispatcher.getActor(),w="LT";c.abortController=new AbortController;try{const T=yield c.actor.sendAsync({type:w,data:_},c.abortController);if(delete c.abortController,c.aborted)return;this._afterTileLoadWorkerResponse(c,T)}catch(T){if(delete c.abortController,c.aborted)return;if(T&&T.status!==404)throw T;this._afterTileLoadWorkerResponse(c,null)}})}_afterTileLoadWorkerResponse(c,d){if(d&&d.resourceTiming&&(c.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&c.setExpiryData(d),c.loadVectorData(d,this.map.painter),c.reloadPromise){const _=c.reloadPromise;c.reloadPromise=null,this.loadTile(c).then(_.resolve).catch(_.reject)}}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.actor&&(yield c.actor.sendAsync({type:"AT",data:{uid:c.uid,type:this.type,source:this.id}}))})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.unloadVectorData(),c.actor&&(yield c.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class pr extends o.E{constructor(c,d,_,w){super(),this.id=c,this.dispatcher=_,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},d),o.e(this,o.L(d,["url","scheme","tileSize"]))}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,c&&(o.e(this,c),c.bounds&&(this.tileBounds=new fe(c.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(c){this._tileJSONRequest=null,this.fire(new o.j(c))}})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(c){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}serialize(){return o.e({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c){return o._(this,void 0,void 0,function*(){const d=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);c.abortController=new AbortController;try{const _=yield X.getImage(this.map._requestManager.transformRequest(d,"Tile"),c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&c.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const w=this.map.painter.context,T=w.gl,U=_.data;c.texture=this.map.painter.getTileTexture(U.width),c.texture?c.texture.update(U,{useMipmap:!0}):(c.texture=new at(w,U,T.RGBA,{useMipmap:!0}),c.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&T.texParameterf(T.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),c.state="loaded"}}catch(_){if(delete c.abortController,c.aborted)c.state="unloaded";else if(_)throw c.state="errored",_}})}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController)})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.texture&&this.map.painter.saveTileTexture(c.texture)})}hasTransition(){return!1}}class er extends pr{constructor(c,d,_,w){super(c,d,_,w),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(c){return o._(this,void 0,void 0,function*(){const d=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(d,"Tile");c.neighboringTiles=this._getNeighboringTiles(c.tileID),c.abortController=new AbortController;try{const w=yield X.getImage(_,c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(w&&w.data){const T=w.data;this.map._refreshExpiredTiles&&w.cacheControl&&w.expires&&c.setExpiryData({cacheControl:w.cacheControl,expires:w.expires});const U=o.b(T)&&o.S()?T:yield this.readImageNow(T),g={type:this.type,uid:c.uid,source:this.id,rawImageData:U,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!c.actor||c.state==="expired"){c.actor=this.dispatcher.getActor();const y=yield c.actor.sendAsync({type:"LDT",data:g});c.dem=y,c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0,c.state="loaded"}}}catch(w){if(delete c.abortController,c.aborted)c.state="unloaded";else if(w)throw c.state="errored",w}})}readImageNow(c){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.U()){const d=c.width+2,_=c.height+2;try{return new o.R({width:d,height:_},yield o.V(c,-1,-1,d,_))}catch{}}return b.getImageData(c,1)})}_getNeighboringTiles(c){const d=c.canonical,_=Math.pow(2,d.z),w=(d.x-1+_)%_,T=d.x===0?c.wrap-1:c.wrap,U=(d.x+1+_)%_,g=d.x+1===_?c.wrap+1:c.wrap,y={};return y[new o.Q(c.overscaledZ,T,d.z,w,d.y).key]={backfilled:!1},y[new o.Q(c.overscaledZ,g,d.z,U,d.y).key]={backfilled:!1},d.y>0&&(y[new o.Q(c.overscaledZ,T,d.z,w,d.y-1).key]={backfilled:!1},y[new o.Q(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},y[new o.Q(c.overscaledZ,g,d.z,U,d.y-1).key]={backfilled:!1}),d.y+1<_&&(y[new o.Q(c.overscaledZ,T,d.z,w,d.y+1).key]={backfilled:!1},y[new o.Q(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},y[new o.Q(c.overscaledZ,g,d.z,U,d.y+1).key]={backfilled:!1}),y}unloadTile(c){return o._(this,void 0,void 0,function*(){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&(yield c.actor.sendAsync({type:"RDT",data:{type:this.type,uid:c.uid,source:this.id}}))})}}class pe extends o.E{constructor(c,d,_,w){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(w),this._data=d.data,this._options=o.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const T=o.W/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*T,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*T,extent:o.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:o.W,radius:(d.clusterRadius||50)*T,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(c){this.map=c,this.load()}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){return this._updateWorkerData(c),this}getData(){return o._(this,void 0,void 0,function*(){const c=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:c})})}setClusterOptions(c){return this.workerOptions.cluster=c.cluster,c&&(c.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=c.clusterRadius),c.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=c.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(c){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:c,source:this.id}})}getClusterChildren(c){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:c,source:this.id}})}getClusterLeaves(c,d,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:c,limit:d,offset:_}})}_updateWorkerData(c){return o._(this,void 0,void 0,function*(){const d=o.e({type:this.type},this.workerOptions);c?d.dataDiff=c:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(b.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let w=null;_.resourceTiming&&_.resourceTiming[this.id]&&(w=_.resourceTiming[this.id].slice(0));const T={dataType:"source"};this._collectResourceTiming&&w&&w.length>0&&o.e(T,{resourceTiming:w}),this.fire(new o.k("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},T),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(c){return o._(this,void 0,void 0,function*(){const d=c.actor?"RT":"LT";c.actor=this.actor;const _={type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};c.abortController=new AbortController;const w=yield this.actor.sendAsync({type:d,data:_},c.abortController);delete c.abortController,c.unloadVectorData(),c.aborted||c.loadVectorData(w,this.map.painter,d==="RT")})}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.aborted=!0})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var we=o.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ie extends o.E{constructor(c,d,_,w){super(),this.id=c,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}load(c){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield X.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,c&&(this.coordinates=c),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new o.j(d))}})}loaded(){return this._loaded}updateImage(c){return c.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=c.url,this.load(c.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(c){this.coordinates=c;const d=c.map(o.Y.fromLngLat);this.tileID=function(w){let T=1/0,U=1/0,g=-1/0,y=-1/0;for(const N of w)T=Math.min(T,N.x),U=Math.min(U,N.y),g=Math.max(g,N.x),y=Math.max(y,N.y);const S=Math.max(g-T,y-U),F=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),M=Math.pow(2,F);return new o.a0(F,Math.floor((T+g)/2*M),Math.floor((U+y)/2*M))}(d),this.minzoom=this.maxzoom=this.tileID.z;const _=d.map(w=>this.tileID.getTilePoint(w)._round());return this._boundsArray=new o.Z,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,o.W,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,o.W),this._boundsArray.emplaceBack(_[2].x,_[2].y,o.W,o.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const c=this.map.painter.context,d=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,we.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new at(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const w in this.tiles){const T=this.tiles[w];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,_=!0)}_&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(c){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={}):c.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Oe extends Ie{constructor(c,d,_,w){super(c,d,_,w),this.roundZoom=!0,this.type="video",this.options=d}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const c=this.options;this.urls=[];for(const d of c.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield o.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new o.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new o.j(new o.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,d=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,we.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new at(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const w in this.tiles){const T=this.tiles[w];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,_=!0)}_&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class nr extends Ie{constructor(c,d,_,w){super(c,d,_,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(T=>!Array.isArray(T)||T.length!==2||T.some(U=>typeof U!="number"))||this.fire(new o.j(new o.a1(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a1(`sources.${c}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new o.j(new o.a1(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a1(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a1(`sources.${c}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,we.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new at(d,this.canvas,_.RGBA,{premultiply:!0});let w=!1;for(const T in this.tiles){const U=this.tiles[T];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture,w=!0)}w&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}}const hr={},Sr=C=>{switch(C){case"geojson":return pe;case"image":return Ie;case"raster":return pr;case"raster-dem":return er;case"vector":return lt;case"video":return Oe;case"canvas":return nr}return hr[C]},Mr="RTLPluginLoaded";class kr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ie()}_syncState(c){return this.status=c,this.dispatcher.broadcast("SRPS",{pluginStatus:c,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(c){return o._(this,arguments,void 0,function(d){var _=this;let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(_.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(_.url=b.resolveURL(d),!_.url)throw new Error(`requested url ${d} is invalid`);if(_.status==="unavailable"){if(!w)return _._requestImport();_.status="deferred",_._syncState(_.status)}else if(_.status==="requested")return _._requestImport()}()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(Mr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ye=null;function or(){return ye||(ye=new kr),ye}class xr{constructor(c,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=c,this.uid=o.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(c){const d=c+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(c){this.demTexture&&c.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(c,d,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",c){c.featureIndex&&(this.latestFeatureIndex=c.featureIndex,c.rawTileData?(this.latestRawTileData=c.rawTileData,this.latestFeatureIndex.rawTileData=c.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=c.collisionBoxArray,this.buckets=function(w,T){const U={};if(!T)return U;for(const g of w){const y=g.layerIds.map(S=>T.getLayer(S)).filter(Boolean);if(y.length!==0){g.layers=y,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(S=>y.filter(F=>F.id===S)[0]));for(const S of y)U[S.id]=g}}return U}(c.buckets,d.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const T=this.buckets[w];if(T instanceof o.a5){if(this.hasSymbolBuckets=!0,!_)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const T=this.buckets[w];if(T instanceof o.a5&&T.hasRTLText){this.hasRTLText=!0,or().lazyLoad();break}}this.queryPadding=0;for(const w in this.buckets){const T=this.buckets[w];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(w).queryRadius(T))}c.imageAtlas&&(this.imageAtlas=c.imageAtlas),c.glyphAtlasImage&&(this.glyphAtlasImage=c.glyphAtlasImage)}else this.collisionBoxArray=new o.a4}unloadVectorData(){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(c){return this.buckets[c.id]}upload(c){for(const _ in this.buckets){const w=this.buckets[_];w.uploadPending()&&w.upload(c)}const d=c.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new at(c,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new at(c,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(c){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(c,this.imageAtlasTexture)}queryRenderedFeatures(c,d,_,w,T,U,g,y,S,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:w,cameraQueryGeometry:T,scale:U,tileSize:this.tileSize,pixelPosMatrix:F,transform:y,params:g,queryPadding:this.queryPadding*S},c,d,_):{}}querySourceFeatures(c,d){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const w=_.loadVTLayers(),T=d&&d.sourceLayer?d.sourceLayer:"",U=w._geojsonTileLayer||w[T];if(!U)return;const g=o.a6(d&&d.filter),{z:y,x:S,y:F}=this.tileID.canonical,M={z:y,x:S,y:F};for(let N=0;N<U.length;N++){const k=U.feature(N);if(g.needGeometry){const K=o.a7(k,!0);if(!g.filter(new o.a8(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!g.filter(new o.a8(this.tileID.overscaledZ),k))continue;const V=_.getId(k,T),j=new o.a9(k,y,S,F,V);j.tile=M,c.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(c){const d=this.expirationTime;if(c.cacheControl){const _=o.aa(c.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){const _=Date.now();let w=!1;if(this.expirationTime>_)w=!1;else if(d)if(this.expirationTime<d)w=!0;else{const T=this.expirationTime-d;T?this.expirationTime=_+Math.max(T,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(c,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(c).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const w in this.buckets){if(!d.style.hasLayer(w))continue;const T=this.buckets[w],U=T.layers[0].sourceLayer||"_geojsonTileLayer",g=_[U],y=c[U];if(!g||!y||Object.keys(y).length===0)continue;T.update(y,g,this.imageAtlas&&this.imageAtlas.patternPositions||{});const S=d&&d.style&&d.style.getLayer(w);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<b.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(c){this.symbolFadeHoldUntil=b.now()+c}setDependencies(c,d){const _={};for(const w of d)_[w]=!0;this.dependencies[c]=_}hasDependency(c,d){for(const _ of c){const w=this.dependencies[_];if(w){for(const T of d)if(w[T])return!0}}return!1}}class De{constructor(c,d){this.max=c,this.onRemove=d,this.reset()}reset(){for(const c in this.data)for(const d of this.data[c])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(c,d,_){const w=c.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);const T={value:d,timeout:void 0};if(_!==void 0&&(T.timeout=setTimeout(()=>{this.remove(c,T)},_)),this.data[w].push(T),this.order.push(w),this.order.length>this.max){const U=this._getAndRemoveByKey(this.order[0]);U&&this.onRemove(U)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){const d=this.data[c].shift();return d.timeout&&clearTimeout(d.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),d.value}getByKey(c){const d=this.data[c];return d?d[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,d){if(!this.has(c))return this;const _=c.wrapped().key,w=d===void 0?0:this.data[_].indexOf(d),T=this.data[_][w];return this.data[_].splice(w,1),T.timeout&&clearTimeout(T.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(T.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(c){const d=[];for(const _ in this.data)for(const w of this.data[_])c(w.value)||d.push(w);for(const _ of d)this.remove(_.value.tileID,_)}}class pn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(c,d,_){const w=String(d);if(this.stateChanges[c]=this.stateChanges[c]||{},this.stateChanges[c][w]=this.stateChanges[c][w]||{},o.e(this.stateChanges[c][w],_),this.deletedStates[c]===null){this.deletedStates[c]={};for(const T in this.state[c])T!==w&&(this.deletedStates[c][T]=null)}else if(this.deletedStates[c]&&this.deletedStates[c][w]===null){this.deletedStates[c][w]={};for(const T in this.state[c][w])_[T]||(this.deletedStates[c][w][T]=null)}else for(const T in _)this.deletedStates[c]&&this.deletedStates[c][w]&&this.deletedStates[c][w][T]===null&&delete this.deletedStates[c][w][T]}removeFeatureState(c,d,_){if(this.deletedStates[c]===null)return;const w=String(d);if(this.deletedStates[c]=this.deletedStates[c]||{},_&&d!==void 0)this.deletedStates[c][w]!==null&&(this.deletedStates[c][w]=this.deletedStates[c][w]||{},this.deletedStates[c][w][_]=null);else if(d!==void 0)if(this.stateChanges[c]&&this.stateChanges[c][w])for(_ in this.deletedStates[c][w]={},this.stateChanges[c][w])this.deletedStates[c][w][_]=null;else this.deletedStates[c][w]=null;else this.deletedStates[c]=null}getState(c,d){const _=String(d),w=o.e({},(this.state[c]||{})[_],(this.stateChanges[c]||{})[_]);if(this.deletedStates[c]===null)return{};if(this.deletedStates[c]){const T=this.deletedStates[c][d];if(T===null)return{};for(const U in T)delete w[U]}return w}initializeTileState(c,d){c.setFeatureState(this.state,d)}coalesceChanges(c,d){const _={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const T={};for(const U in this.stateChanges[w])this.state[w][U]||(this.state[w][U]={}),o.e(this.state[w][U],this.stateChanges[w][U]),T[U]=this.state[w][U];_[w]=T}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const T={};if(this.deletedStates[w]===null)for(const U in this.state[w])T[U]={},this.state[w][U]={};else for(const U in this.deletedStates[w]){if(this.deletedStates[w][U]===null)this.state[w][U]={};else for(const g of Object.keys(this.deletedStates[w][U]))delete this.state[w][U][g];T[U]=this.state[w][U]}_[w]=_[w]||{},o.e(_[w],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const w in c)c[w].setFeatureState(_,d)}}class ge extends o.E{constructor(c,d,_){super(),this.id=c,this.dispatcher=_,this.on("data",w=>this._dataHandler(w)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((w,T,U,g)=>{const y=new(Sr(T.type))(w,T,U,g);if(y.id!==w)throw new Error(`Expected Source id to be ${w} instead of ${y.id}`);return y})(c,d,_,this),this._tiles={},this._cache=new De(0,w=>this._unloadTile(w)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new pn,this._didEmitContent=!1,this._updated=!1}onAdd(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._maxTileCacheZoomLevels=c?c._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(c)}onRemove(c){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(c)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const c in this._tiles){const d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(c,d,_){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(c),this._tileLoaded(c,d,_)}catch(w){c.state="errored",w.status!==404?this._source.fire(new o.j(w,{tile:c})):this.update(this.transform,this.terrain)}})}_unloadTile(c){this._source.unloadTile&&this._source.unloadTile(c)}_abortTile(c){this._source.abortTile&&this._source.abortTile(c),this._source.fire(new o.k("dataabort",{tile:c,coord:c.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(c){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const _=this._tiles[d];_.upload(c),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(c=>c.tileID).sort(yr).map(c=>c.key)}getRenderableIds(c){const d=[];for(const _ in this._tiles)this._isIdRenderable(_,c)&&d.push(this._tiles[_]);return c?d.sort((_,w)=>{const T=_.tileID,U=w.tileID,g=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),y=new o.P(U.canonical.x,U.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-U.overscaledZ||y.y-g.y||y.x-g.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(yr).map(_=>_.key)}hasRenderableParent(c){const d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")}}_reloadTile(c,d){return o._(this,void 0,void 0,function*(){const _=this._tiles[c];_&&(_.state!=="loading"&&(_.state=d),yield this._loadTile(_,c,d))})}_tileLoaded(c,d,_){c.timeAdded=b.now(),_==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),c.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:c,coord:c.tileID}))}_backfillDEM(c){const d=this.getRenderableIds();for(let w=0;w<d.length;w++){const T=d[w];if(c.neighboringTiles&&c.neighboringTiles[T]){const U=this.getTileByID(T);_(c,U),_(U,c)}}function _(w,T){w.needsHillshadePrepare=!0,w.needsTerrainPrepare=!0;let U=T.tileID.canonical.x-w.tileID.canonical.x;const g=T.tileID.canonical.y-w.tileID.canonical.y,y=Math.pow(2,w.tileID.canonical.z),S=T.tileID.key;U===0&&g===0||Math.abs(g)>1||(Math.abs(U)>1&&(Math.abs(U+y)===1?U+=y:Math.abs(U-y)===1&&(U-=y)),T.dem&&w.dem&&(w.dem.backfillBorder(T.dem,U,g),w.neighboringTiles&&w.neighboringTiles[S]&&(w.neighboringTiles[S].backfilled=!0)))}}getTile(c){return this.getTileByID(c.key)}getTileByID(c){return this._tiles[c]}_retainLoadedChildren(c,d,_,w){for(const T in this._tiles){let U=this._tiles[T];if(w[T]||!U.hasData()||U.tileID.overscaledZ<=d||U.tileID.overscaledZ>_)continue;let g=U.tileID;for(;U&&U.tileID.overscaledZ>d+1;){const S=U.tileID.scaledTo(U.tileID.overscaledZ-1);U=this._tiles[S.key],U&&U.hasData()&&(g=S)}let y=g;for(;y.overscaledZ>d;)if(y=y.scaledTo(y.overscaledZ-1),c[y.key]){w[g.key]=g;break}}}findLoadedParent(c,d){if(c.key in this._loadedParentTiles){const _=this._loadedParentTiles[c.key];return _&&_.tileID.overscaledZ>=d?_:null}for(let _=c.overscaledZ-1;_>=d;_--){const w=c.scaledTo(_),T=this._getLoadedTile(w);if(T)return T}}findLoadedSibling(c){return this._getLoadedTile(c)}_getLoadedTile(c){const d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)}updateCacheSize(c){const d=Math.ceil(c.width/this._source.tileSize)+1,_=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*_*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(T)}handleWrapJump(c){const d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){const _={};for(const w in this._tiles){const T=this._tiles[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),_[T.tileID.key]=T}this._tiles=_;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(w,this._tiles[w])}}_updateCoveredAndRetainedTiles(c,d,_,w,T,U){const g={},y={},S=Object.keys(c),F=b.now();for(const M of S){const N=c[M],k=this._tiles[M];if(!k||k.fadeEndTime!==0&&k.fadeEndTime<=F)continue;const V=this.findLoadedParent(N,d),j=this.findLoadedSibling(N),K=V||j||null;K&&(this._addTile(K.tileID),g[K.tileID.key]=K.tileID),y[M]=N}this._retainLoadedChildren(y,w,_,c);for(const M in g)c[M]||(this._coveredTiles[M]=!0,c[M]=g[M]);if(U){const M={},N={};for(const k of T)this._tiles[k.key].hasData()?M[k.key]=k:N[k.key]=k;for(const k in N){const V=N[k].children(this._source.maxzoom);this._tiles[V[0].key]&&this._tiles[V[1].key]&&this._tiles[V[2].key]&&this._tiles[V[3].key]&&(M[V[0].key]=c[V[0].key]=V[0],M[V[1].key]=c[V[1].key]=V[1],M[V[2].key]=c[V[2].key]=V[2],M[V[3].key]=c[V[3].key]=V[3],delete N[k])}for(const k in N){const V=N[k],j=this.findLoadedParent(V,this._source.minzoom),K=this.findLoadedSibling(V),tt=j||K||null;if(tt){M[tt.tileID.key]=c[tt.tileID.key]=tt.tileID;for(const ht in M)M[ht].isChildOf(tt.tileID)&&delete M[ht]}}for(const k in this._tiles)M[k]||(this._coveredTiles[k]=!0)}}update(c,d){if(!this._sourceLoaded||this._paused)return;let _;this.transform=c,this.terrain=d,this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new o.Q(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(_=c.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(_=_.filter(F=>this._source.hasTile(F)))):_=[];const w=c.coveringZoomLevel(this._source),T=Math.max(w-ge.maxOverzooming,this._source.minzoom),U=Math.max(w+ge.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const M of _)if(M.canonical.z>this._source.minzoom){const N=M.scaledTo(M.canonical.z-1);F[N.key]=N;const k=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));F[k.key]=k}_=_.concat(Object.values(F))}const g=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,g&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const y=this._updateRetainedTiles(_,w);je(this._source.type)&&this._updateCoveredAndRetainedTiles(y,T,U,w,_,d);for(const F in y)this._tiles[F].clearFadeHold();const S=o.ab(this._tiles,y);for(const F of S){const M=this._tiles[F];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)}_updateRetainedTiles(c,d){var _;const w={},T={},U=Math.max(d-ge.maxOverzooming,this._source.minzoom),g=Math.max(d+ge.maxUnderzooming,this._source.minzoom),y={};for(const S of c){const F=this._addTile(S);w[S.key]=S,F.hasData()||d<this._source.maxzoom&&(y[S.key]=S)}this._retainLoadedChildren(y,d,g,w);for(const S of c){let F=this._tiles[S.key];if(F.hasData())continue;if(d+1>this._source.maxzoom){const N=S.children(this._source.maxzoom)[0],k=this.getTile(N);if(k&&k.hasData()){w[N.key]=N;continue}}else{const N=S.children(this._source.maxzoom);if(w[N[0].key]&&w[N[1].key]&&w[N[2].key]&&w[N[3].key])continue}let M=F.wasRequested();for(let N=S.overscaledZ-1;N>=U;--N){const k=S.scaledTo(N);if(T[k.key])break;if(T[k.key]=!0,F=this.getTile(k),!F&&M&&(F=this._addTile(k)),F){const V=F.hasData();if((V||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||M)&&(w[k.key]=k),M=F.wasRequested(),V)break}}}return w}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const c in this._tiles){const d=[];let _,w=this._tiles[c].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){_=this._loadedParentTiles[w.key];break}d.push(w.key);const T=w.scaledTo(w.overscaledZ-1);if(_=this._getLoadedTile(T),_)break;w=T}for(const T of d)this._loadedParentTiles[T]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const c in this._tiles){const d=this._tiles[c].tileID,_=this._getLoadedTile(d);this._loadedSiblingTiles[d.key]=_}}_addTile(c){let d=this._tiles[c.key];if(d)return d;d=this._cache.getAndRemove(c),d&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));const _=d;return d||(d=new xr(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,c.key,d.state)),d.uses++,this._tiles[c.key]=d,_||this._source.fire(new o.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(c,d){c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);const _=d.getExpiryTimeout();_&&(this._timers[c]=setTimeout(()=>{this._reloadTile(c,"expired"),delete this._timers[c]},_))}_removeTile(c){const d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(c){const d=c.sourceDataType;c.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const c in this._tiles)this._removeTile(c);this._cache.reset()}tilesIn(c,d,_){const w=[],T=this.transform;if(!T)return w;const U=_?T.getCameraQueryGeometry(c):c,g=c.map(V=>T.pointCoordinate(V,this.terrain)),y=U.map(V=>T.pointCoordinate(V,this.terrain)),S=this.getIds();let F=1/0,M=1/0,N=-1/0,k=-1/0;for(const V of y)F=Math.min(F,V.x),M=Math.min(M,V.y),N=Math.max(N,V.x),k=Math.max(k,V.y);for(let V=0;V<S.length;V++){const j=this._tiles[S[V]];if(j.holdingForFade())continue;const K=j.tileID,tt=Math.pow(2,T.zoom-j.tileID.overscaledZ),ht=d*j.queryPadding*o.W/j.tileSize/tt,rt=[K.getTilePoint(new o.Y(F,M)),K.getTilePoint(new o.Y(N,k))];if(rt[0].x-ht<o.W&&rt[0].y-ht<o.W&&rt[1].x+ht>=0&&rt[1].y+ht>=0){const At=g.map(Ct=>K.getTilePoint(Ct)),St=y.map(Ct=>K.getTilePoint(Ct));w.push({tile:j,tileID:K,queryGeometry:At,cameraQueryGeometry:St,scale:tt})}}return w}getVisibleCoordinates(c){const d=this.getRenderableIds(c).map(_=>this._tiles[_].tileID);for(const _ of d)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(je(this._source.type)){const c=b.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=c)return!0}return!1}setFeatureState(c,d,_){this._state.updateState(c=c||"_geojsonTileLayer",d,_)}removeFeatureState(c,d,_){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,_)}getFeatureState(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)}setDependencies(c,d,_){const w=this._tiles[c];w&&w.setDependencies(d,_)}reloadTilesForDependencies(c,d){for(const _ in this._tiles)this._tiles[_].hasDependency(c,d)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(c,d))}}function yr(C,c){const d=Math.abs(2*C.wrap)-+(C.wrap<0),_=Math.abs(2*c.wrap)-+(c.wrap<0);return C.overscaledZ-c.overscaledZ||_-d||c.canonical.y-C.canonical.y||c.canonical.x-C.canonical.x}function je(C){return C==="raster"||C==="image"||C==="video"}ge.maxOverzooming=10,ge.maxUnderzooming=3;class Rr{constructor(c,d){this.reset(c,d)}reset(c,d){this.points=c||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=o.ac(c,0,1);let d=1,_=this._distances[d];const w=c*this.paddedLength+this.padding;for(;_<w&&d<this._distances.length;)_=this._distances[++d];const T=d-1,U=this._distances[T],g=_-U,y=g>0?(w-U)/g:0;return this.points[T].mult(1-y).add(this.points[d].mult(y))}}function cn(C,c){let d=!0;return C==="always"||C!=="never"&&c!=="never"||(d=!1),d}class He{constructor(c,d,_){const w=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(c/_),this.yCellCount=Math.ceil(d/_);for(let U=0;U<this.xCellCount*this.yCellCount;U++)w.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=d,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,d,_,w,T){this._forEachCell(d,_,w,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(w),this.bboxes.push(T)}insertCircle(c,d,_,w){this._forEachCell(d-w,_-w,d+w,_+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(d),this.circles.push(_),this.circles.push(w)}_insertBoxCell(c,d,_,w,T,U){this.boxCells[T].push(U)}_insertCircleCell(c,d,_,w,T,U){this.circleCells[T].push(U)}_query(c,d,_,w,T,U,g){if(_<0||c>this.width||w<0||d>this.height)return[];const y=[];if(c<=0&&d<=0&&this.width<=_&&this.height<=w){if(T)return[{key:null,x1:c,y1:d,x2:_,y2:w}];for(let S=0;S<this.boxKeys.length;S++)y.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const F=this.circles[3*S],M=this.circles[3*S+1],N=this.circles[3*S+2];y.push({key:this.circleKeys[S],x1:F-N,y1:M-N,x2:F+N,y2:M+N})}}else this._forEachCell(c,d,_,w,this._queryCell,y,{hitTest:T,overlapMode:U,seenUids:{box:{},circle:{}}},g);return y}query(c,d,_,w){return this._query(c,d,_,w,!1,null)}hitTest(c,d,_,w,T,U){return this._query(c,d,_,w,!0,T,U).length>0}hitTestCircle(c,d,_,w,T){const U=c-_,g=c+_,y=d-_,S=d+_;if(g<0||U>this.width||S<0||y>this.height)return!1;const F=[];return this._forEachCell(U,y,g,S,this._queryCellCircle,F,{hitTest:!0,overlapMode:w,circle:{x:c,y:d,radius:_},seenUids:{box:{},circle:{}}},T),F.length>0}_queryCell(c,d,_,w,T,U,g,y){const{seenUids:S,hitTest:F,overlapMode:M}=g,N=this.boxCells[T];if(N!==null){const V=this.bboxes;for(const j of N)if(!S.box[j]){S.box[j]=!0;const K=4*j,tt=this.boxKeys[j];if(c<=V[K+2]&&d<=V[K+3]&&_>=V[K+0]&&w>=V[K+1]&&(!y||y(tt))&&(!F||!cn(M,tt.overlapMode))&&(U.push({key:tt,x1:V[K],y1:V[K+1],x2:V[K+2],y2:V[K+3]}),F))return!0}}const k=this.circleCells[T];if(k!==null){const V=this.circles;for(const j of k)if(!S.circle[j]){S.circle[j]=!0;const K=3*j,tt=this.circleKeys[j];if(this._circleAndRectCollide(V[K],V[K+1],V[K+2],c,d,_,w)&&(!y||y(tt))&&(!F||!cn(M,tt.overlapMode))){const ht=V[K],rt=V[K+1],At=V[K+2];if(U.push({key:tt,x1:ht-At,y1:rt-At,x2:ht+At,y2:rt+At}),F)return!0}}}return!1}_queryCellCircle(c,d,_,w,T,U,g,y){const{circle:S,seenUids:F,overlapMode:M}=g,N=this.boxCells[T];if(N!==null){const V=this.bboxes;for(const j of N)if(!F.box[j]){F.box[j]=!0;const K=4*j,tt=this.boxKeys[j];if(this._circleAndRectCollide(S.x,S.y,S.radius,V[K+0],V[K+1],V[K+2],V[K+3])&&(!y||y(tt))&&!cn(M,tt.overlapMode))return U.push(!0),!0}}const k=this.circleCells[T];if(k!==null){const V=this.circles;for(const j of k)if(!F.circle[j]){F.circle[j]=!0;const K=3*j,tt=this.circleKeys[j];if(this._circlesCollide(V[K],V[K+1],V[K+2],S.x,S.y,S.radius)&&(!y||y(tt))&&!cn(M,tt.overlapMode))return U.push(!0),!0}}}_forEachCell(c,d,_,w,T,U,g,y){const S=this._convertToXCellCoord(c),F=this._convertToYCellCoord(d),M=this._convertToXCellCoord(_),N=this._convertToYCellCoord(w);for(let k=S;k<=M;k++)for(let V=F;V<=N;V++)if(T.call(this,c,d,_,w,this.xCellCount*V+k,U,g,y))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,d,_,w,T,U){const g=w-c,y=T-d,S=_+U;return S*S>g*g+y*y}_circleAndRectCollide(c,d,_,w,T,U,g){const y=(U-w)/2,S=Math.abs(c-(w+y));if(S>y+_)return!1;const F=(g-T)/2,M=Math.abs(d-(T+F));if(M>F+_)return!1;if(S<=y||M<=F)return!0;const N=S-y,k=M-F;return N*N+k*k<=_*_}}function Kn(C,c,d,_,w){const T=o.F();return c?(o.J(T,T,[1/w,1/w,1]),d||o.ad(T,T,_.angle)):o.K(T,_.labelPlaneMatrix,C),T}function sn(C,c,d,_,w){if(c){const T=o.ae(C);return o.J(T,T,[w,w,1]),d||o.ad(T,T,-_.angle),T}return _.glCoordMatrix}function Jr(C,c,d){let _;d?(_=[C.x,C.y,d(C.x,C.y),1],o.af(_,_,c)):(_=[C.x,C.y,0,1],function(T,U,g){const y=U[0],S=U[1];T[0]=g[0]*y+g[4]*S+g[12],T[1]=g[1]*y+g[5]*S+g[13],T[3]=g[3]*y+g[7]*S+g[15]}(_,_,c));const w=_[3];return{point:new o.P(_[0]/w,_[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function Bt(C,c){return .5+C/c*.5}function Z(C,c){return C.x>=-c[0]&&C.x<=c[0]&&C.y>=-c[1]&&C.y<=c[1]}function J(C,c,d,_,w,T,U,g,y,S,F,M,N,k,V){const j=_?C.textSizeData:C.iconSizeData,K=o.ag(j,d.transform.zoom),tt=[256/d.width*2+1,256/d.height*2+1],ht=_?C.text.dynamicLayoutVertexArray:C.icon.dynamicLayoutVertexArray;ht.clear();const rt=C.lineVertexArray,At=_?C.text.placedSymbolArray:C.icon.placedSymbolArray,St=d.transform.width/d.transform.height;let Ct=!1;for(let yt=0;yt<At.length;yt++){const Et=At.get(yt);if(Et.hidden||Et.writingMode===o.ah.vertical&&!Ct){ze(Et.numGlyphs,ht);continue}Ct=!1;const Wt=Jr(new o.P(Et.anchorX,Et.anchorY),c,V);if(!Z(Wt.point,tt)){ze(Et.numGlyphs,ht);continue}const Zt=Bt(d.transform.cameraToCenterDistance,Wt.signedDistanceFromCamera),zt=o.ai(j,K,Et),ae=U?zt/Zt:zt*Zt,de={getElevation:V,labelPlaneMatrix:w,lineVertexArray:rt,pitchWithMap:U,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:S,tileAnchorPoint:new o.P(Et.anchorX,Et.anchorY),unwrappedTileID:F,width:M,height:N,translation:k},Me=Nt(de,Et,ae,!1,g,c,T,C.glyphOffsetArray,ht,St,y);Ct=Me.useVertical,(Me.notEnoughRoom||Ct||Me.needsFlipping&&Nt(de,Et,ae,!0,g,c,T,C.glyphOffsetArray,ht,St,y).notEnoughRoom)&&ze(Et.numGlyphs,ht)}_?C.text.dynamicLayoutVertexBuffer.updateData(ht):C.icon.dynamicLayoutVertexBuffer.updateData(ht)}function st(C,c,d,_,w,T,U,g){const y=T.glyphStartIndex+T.numGlyphs,S=T.lineStartIndex,F=T.lineStartIndex+T.lineLength,M=c.getoffsetX(T.glyphStartIndex),N=c.getoffsetX(y-1),k=ue(C*M,d,_,w,T.segment,S,F,g,U);if(!k)return null;const V=ue(C*N,d,_,w,T.segment,S,F,g,U);return V?g.projectionCache.anyProjectionOccluded?null:{first:k,last:V}:null}function Ft(C,c,d,_){return C===o.ah.horizontal&&Math.abs(d.y-c.y)>Math.abs(d.x-c.x)*_?{useVertical:!0}:(C===o.ah.vertical?c.y<d.y:c.x>d.x)?{needsFlipping:!0}:null}function Nt(C,c,d,_,w,T,U,g,y,S,F){const M=d/24,N=c.lineOffsetX*M,k=c.lineOffsetY*M;let V;if(c.numGlyphs>1){const j=c.glyphStartIndex+c.numGlyphs,K=c.lineStartIndex,tt=c.lineStartIndex+c.lineLength,ht=st(M,g,N,k,_,c,F,C);if(!ht)return{notEnoughRoom:!0};const rt=Jr(ht.first.point,U,C.getElevation).point,At=Jr(ht.last.point,U,C.getElevation).point;if(w&&!_){const St=Ft(c.writingMode,rt,At,S);if(St)return St}V=[ht.first];for(let St=c.glyphStartIndex+1;St<j-1;St++)V.push(ue(M*g.getoffsetX(St),N,k,_,c.segment,K,tt,C,F));V.push(ht.last)}else{if(w&&!_){const K=Jr(C.tileAnchorPoint,T,C.getElevation).point,tt=c.lineStartIndex+c.segment+1,ht=new o.P(C.lineVertexArray.getx(tt),C.lineVertexArray.gety(tt)),rt=Jr(ht,T,C.getElevation),At=rt.signedDistanceFromCamera>0?rt.point:function(Ct,yt,Et,Wt,Zt,zt){return Ht(Ct,yt,Et,1,Zt,zt)}(C.tileAnchorPoint,ht,K,0,T,C),St=Ft(c.writingMode,K,At,S);if(St)return St}const j=ue(M*g.getoffsetX(c.glyphStartIndex),N,k,_,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,C,F);if(!j||C.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};V=[j]}for(const j of V)o.aj(y,j.point,j.angle);return{}}function Ht(C,c,d,_,w,T){const U=C.add(C.sub(c)._unit()),g=w!==void 0?Jr(U,w,T.getElevation).point:Tt(U.x,U.y,T).point,y=d.sub(g);return d.add(y._mult(_/y.mag()))}function jt(C,c,d){const _=c.projectionCache;if(_.projections[C])return _.projections[C];const w=new o.P(c.lineVertexArray.getx(C),c.lineVertexArray.gety(C)),T=Tt(w.x,w.y,c);if(T.signedDistanceFromCamera>0)return _.projections[C]=T.point,_.anyProjectionOccluded=_.anyProjectionOccluded||T.isOccluded,T.point;const U=C-d.direction;return function(g,y,S,F,M){return Ht(g,y,S,F,void 0,M)}(d.distanceFromAnchor===0?c.tileAnchorPoint:new o.P(c.lineVertexArray.getx(U),c.lineVertexArray.gety(U)),w,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,c)}function Tt(C,c,d){const _=C+d.translation[0],w=c+d.translation[1];let T;return!d.pitchWithMap&&d.projection.useSpecialProjectionForSymbols?(T=d.projection.projectTileCoordinates(_,w,d.unwrappedTileID,d.getElevation),T.point.x=(.5*T.point.x+.5)*d.width,T.point.y=(.5*-T.point.y+.5)*d.height):(T=Jr(new o.P(_,w),d.labelPlaneMatrix,d.getElevation),T.isOccluded=!1),T}function Xt(C,c,d){return C._unit()._perp()._mult(c*d)}function _e(C,c,d,_,w,T,U,g,y){if(g.projectionCache.offsets[C])return g.projectionCache.offsets[C];const S=d.add(c);if(C+y.direction<_||C+y.direction>=w)return g.projectionCache.offsets[C]=S,S;const F=jt(C+y.direction,g,y),M=Xt(F.sub(d),U,y.direction),N=d.add(M),k=F.add(M);return g.projectionCache.offsets[C]=o.ak(T,S,N,k)||S,g.projectionCache.offsets[C]}function ue(C,c,d,_,w,T,U,g,y){const S=_?C-c:C+c;let F=S>0?1:-1,M=0;_&&(F*=-1,M=Math.PI),F<0&&(M+=Math.PI);let N,k=F>0?T+w:T+w+1;g.projectionCache.cachedAnchorPoint?N=g.projectionCache.cachedAnchorPoint:(N=Tt(g.tileAnchorPoint.x,g.tileAnchorPoint.y,g).point,g.projectionCache.cachedAnchorPoint=N);let V,j,K=N,tt=N,ht=0,rt=0;const At=Math.abs(S),St=[];let Ct;for(;ht+rt<=At;){if(k+=F,k<T||k>=U)return null;ht+=rt,tt=K,j=V;const Wt={absOffsetX:At,direction:F,distanceFromAnchor:ht,previousVertex:tt};if(K=jt(k,g,Wt),d===0)St.push(tt),Ct=K.sub(tt);else{let Zt;const zt=K.sub(tt);Zt=zt.mag()===0?Xt(jt(k+F,g,Wt).sub(K),d,F):Xt(zt,d,F),j||(j=tt.add(Zt)),V=_e(k,Zt,K,T,U,j,d,g,Wt),St.push(j),Ct=V.sub(j)}rt=Ct.mag()}const yt=Ct._mult((At-ht)/rt)._add(j||tt),Et=M+Math.atan2(K.y-tt.y,K.x-tt.x);return St.push(yt),{point:yt,angle:y?Et:0,path:St}}const Ae=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ze(C,c){for(let d=0;d<C;d++){const _=c.length;c.resize(_+4),c.float32.set(Ae,3*_)}}const Ve=100;class Er{constructor(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new He(c.width+200,c.height+200,25),w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new He(c.width+200,c.height+200,25);this.transform=c,this.mapProjection=d,this.grid=_,this.ignoredGrid=w,this.pitchFactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Ve,this.screenBottomBoundary=c.height+Ve,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(c,d,_,w,T,U,g,y,S,F,M){const N=c.anchorPointX+y[0],k=c.anchorPointY+y[1],V=this.projectAndGetPerspectiveRatio(w,N,k,T,F),j=this._projectCollisionBox(c,_,w,T,U,g,y,V,F,M),[K,tt,ht,rt]=j.box;return this.mapProjection.useSpecialProjectionForSymbols&&(U?j.allPointsOccluded:this.mapProjection.isOccluded(N,k,T))||V.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(K,tt,ht,rt)||d!=="always"&&this.grid.hitTest(K,tt,ht,rt,d,S)?{box:[K,tt,ht,rt],placeable:!1,offscreen:!1}:{box:[K,tt,ht,rt],placeable:!0,offscreen:this.isOffscreen(K,tt,ht,rt)}}placeCollisionCircles(c,d,_,w,T,U,g,y,S,F,M,N,k,V,j,K){const tt=[],ht=new o.P(d.anchorX,d.anchorY),rt=this.getPerspectiveRatio(U,ht.x,ht.y,g,K),At=(M?T/rt:T*rt)/o.ap,St={getElevation:K,labelPlaneMatrix:y,lineVertexArray:_,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ht,unwrappedTileID:g,width:this.transform.width,height:this.transform.height,translation:j},Ct=st(At,w,d.lineOffsetX*At,d.lineOffsetY*At,!1,d,!1,St);let yt=!1,Et=!1,Wt=!0;if(Ct){const Zt=.5*k*rt+V,zt=new o.P(-100,-100),ae=new o.P(this.screenRightBoundary,this.screenBottomBoundary),de=new Rr,Me=Ct.first,le=Ct.last;let Ee=[];for(let Je=Me.path.length-1;Je>=1;Je--)Ee.push(Me.path[Je]);for(let Je=1;Je<le.path.length;Je++)Ee.push(le.path[Je]);const $e=2.5*Zt;if(S){const Je=this.projectPathToScreenSpace(Ee,St,S);Ee=Je.some(mr=>mr.signedDistanceFromCamera<=0)?[]:Je.map(mr=>mr.point)}let Tr=[];if(Ee.length>0){const Je=Ee[0].clone(),mr=Ee[0].clone();for(let Dr=1;Dr<Ee.length;Dr++)Je.x=Math.min(Je.x,Ee[Dr].x),Je.y=Math.min(Je.y,Ee[Dr].y),mr.x=Math.max(mr.x,Ee[Dr].x),mr.y=Math.max(mr.y,Ee[Dr].y);Tr=Je.x>=zt.x&&mr.x<=ae.x&&Je.y>=zt.y&&mr.y<=ae.y?[Ee]:mr.x<zt.x||Je.x>ae.x||mr.y<zt.y||Je.y>ae.y?[]:o.al([Ee],zt.x,zt.y,ae.x,ae.y)}for(const Je of Tr){de.reset(Je,.25*Zt);let mr=0;mr=de.length<=.5*Zt?1:Math.ceil(de.paddedLength/$e)+1;for(let Dr=0;Dr<mr;Dr++){const Lr=Dr/Math.max(mr-1,1),Sn=de.lerp(Lr),ln=Sn.x+Ve,bn=Sn.y+Ve;tt.push(ln,bn,Zt,0);const Dn=ln-Zt,Xr=bn-Zt,Nn=ln+Zt,di=bn+Zt;if(Wt=Wt&&this.isOffscreen(Dn,Xr,Nn,di),Et=Et||this.isInsideGrid(Dn,Xr,Nn,di),c!=="always"&&this.grid.hitTestCircle(ln,bn,Zt,c,N)&&(yt=!0,!F))return{circles:[],offscreen:!1,collisionDetected:yt}}}}return{circles:!F&&yt||!Et||rt<this.perspectiveRatioCutoff?[]:tt,offscreen:Wt,collisionDetected:yt}}projectPathToScreenSpace(c,d,_){return c.map(w=>Jr(w,_,d.getElevation))}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let _=1/0,w=1/0,T=-1/0,U=-1/0;for(const F of c){const M=new o.P(F.x+Ve,F.y+Ve);_=Math.min(_,M.x),w=Math.min(w,M.y),T=Math.max(T,M.x),U=Math.max(U,M.y),d.push(M)}const g=this.grid.query(_,w,T,U).concat(this.ignoredGrid.query(_,w,T,U)),y={},S={};for(const F of g){const M=F.key;if(y[M.bucketInstanceId]===void 0&&(y[M.bucketInstanceId]={}),y[M.bucketInstanceId][M.featureIndex])continue;const N=[new o.P(F.x1,F.y1),new o.P(F.x2,F.y1),new o.P(F.x2,F.y2),new o.P(F.x1,F.y2)];o.am(d,N)&&(y[M.bucketInstanceId][M.featureIndex]=!0,S[M.bucketInstanceId]===void 0&&(S[M.bucketInstanceId]=[]),S[M.bucketInstanceId].push(M.featureIndex))}return S}insertCollisionBox(c,d,_,w,T,U){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:T,collisionGroupID:U,overlapMode:d},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,d,_,w,T,U){const g=_?this.ignoredGrid:this.grid,y={bucketInstanceId:w,featureIndex:T,collisionGroupID:U,overlapMode:d};for(let S=0;S<c.length;S+=4)g.insertCircle(y,c[S],c[S+1],c[S+2])}projectAndGetPerspectiveRatio(c,d,_,w,T){const U=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(d,_,w,T):Jr(new o.P(d,_),c,T);return{point:new o.P((U.point.x+1)/2*this.transform.width+Ve,(1-U.point.y)/2*this.transform.height+Ve),perspectiveRatio:.5+this.transform.cameraToCenterDistance/U.signedDistanceFromCamera*.5,isOccluded:U.isOccluded,signedDistanceFromCamera:U.signedDistanceFromCamera}}getPerspectiveRatio(c,d,_,w,T){const U=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(d,_,w,T):Jr(new o.P(d,_),c,T);return .5+this.transform.cameraToCenterDistance/U.signedDistanceFromCamera*.5}isOffscreen(c,d,_,w){return _<Ve||c>=this.screenRightBoundary||w<Ve||d>this.screenBottomBoundary}isInsideGrid(c,d,_,w){return _>=0&&c<this.gridRightBoundary&&w>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const c=o.an([]);return o.H(c,c,[-100,-100,0]),c}_projectCollisionBox(c,d,_,w,T,U,g,y,S,F){const M=d*y.perspectiveRatio;let N=new o.P(1,0),k=new o.P(0,1);const V=new o.P(c.anchorPointX+g[0],c.anchorPointY+g[1]);if(U&&!T){const Zt=this.projectAndGetPerspectiveRatio(_,V.x+1,V.y,w,S).point.sub(y.point).unit(),zt=Math.atan(Zt.y/Zt.x)+(Zt.x<0?Math.PI:0),ae=Math.sin(zt),de=Math.cos(zt);N=new o.P(de,ae),k=new o.P(-ae,de)}else if(!U&&T){const Zt=-this.transform.angle,zt=Math.sin(Zt),ae=Math.cos(Zt);N=new o.P(ae,zt),k=new o.P(-zt,ae)}let j=y.point,K=M;if(T){j=V;const Zt=this.transform.zoom-Math.floor(this.transform.zoom);K=Math.pow(2,-Zt),K*=this.mapProjection.getPitchedTextCorrection(this.transform,V,w),F||(K*=o.ac(.5+y.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}F&&(j=j.add(N.mult(F.x*K)).add(k.mult(F.y*K)));const tt=c.x1*K,ht=c.x2*K,rt=(tt+ht)/2,At=c.y1*K,St=c.y2*K,Ct=(At+St)/2,yt=[{offsetX:tt,offsetY:At},{offsetX:rt,offsetY:At},{offsetX:ht,offsetY:At},{offsetX:ht,offsetY:Ct},{offsetX:ht,offsetY:St},{offsetX:rt,offsetY:St},{offsetX:tt,offsetY:St},{offsetX:tt,offsetY:Ct}];let Et=[];for(const{offsetX:Zt,offsetY:zt}of yt)Et.push(new o.P(j.x+N.x*Zt+k.x*zt,j.y+N.y*Zt+k.y*zt));let Wt=!1;if(T){const Zt=Et.map(zt=>this.projectAndGetPerspectiveRatio(_,zt.x,zt.y,w,S));Wt=Zt.some(zt=>!zt.isOccluded),Et=Zt.map(zt=>zt.point)}else Wt=!0;return{box:o.ao(Et),allPointsOccluded:!Wt}}}function _r(C,c,d){return c*(o.W/(C.tileSize*Math.pow(2,d-C.tileID.overscaledZ)))}class Ur{constructor(c,d,_,w){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?d:-d))):w&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Vr{constructor(c,d,_,w,T){this.text=new Ur(c?c.text:null,d,_,T),this.icon=new Ur(c?c.icon:null,d,w,T)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gr{constructor(c,d,_){this.text=c,this.icon=d,this.skipFade=_}}class Zr{constructor(){this.invProjMatrix=o.F(),this.viewportMatrix=o.F(),this.circles=[]}}class vr{constructor(c,d,_,w,T){this.bucketInstanceId=c,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=w,this.tileID=T}}class Wr{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const d=++this.maxGroupID;this.collisionGroups[c]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[c]}}function _n(C,c,d,_,w){const{horizontalAlign:T,verticalAlign:U}=o.au(C);return new o.P(-(T-.5)*c+_[0]*w,-(U-.5)*d+_[1]*w)}class Rn{constructor(c,d,_,w,T,U){this.transform=c.clone(),this.terrain=_,this.collisionIndex=new Er(this.transform,d),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=w,this.retainedQueryData={},this.collisionGroups=new Wr(T),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=U,U&&(U.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(c){const d=this.terrain;return d?(_,w)=>d.getElevation(c,_,w):null}getBucketParts(c,d,_,w){const T=_.getBucket(d),U=_.latestFeatureIndex;if(!T||!U||d.id!==T.layerIds[0])return;const g=_.collisionBoxArray,y=T.layers[0].layout,S=T.layers[0].paint,F=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),M=_.tileSize/o.W,N=_.tileID.toUnwrapped(),k=this.transform.calculatePosMatrix(N),V=y.get("text-pitch-alignment")==="map",j=y.get("text-rotation-alignment")==="map",K=_r(_,1,this.transform.zoom),tt=this.collisionIndex.mapProjection.translatePosition(this.transform,_,S.get("text-translate"),S.get("text-translate-anchor")),ht=this.collisionIndex.mapProjection.translatePosition(this.transform,_,S.get("icon-translate"),S.get("icon-translate-anchor")),rt=Kn(k,V,j,this.transform,K);let At=null;if(V){const Ct=sn(k,V,j,this.transform,K);At=o.K([],this.transform.labelPlaneMatrix,Ct)}this.retainedQueryData[T.bucketInstanceId]=new vr(T.bucketInstanceId,U,T.sourceLayerIndex,T.index,_.tileID);const St={bucket:T,layout:y,translationText:tt,translationIcon:ht,posMatrix:k,unwrappedTileID:N,textLabelPlaneMatrix:rt,labelToScreenMatrix:At,scale:F,textPixelRatio:M,holdingForFade:_.holdingForFade(),collisionBoxArray:g,partiallyEvaluatedTextSize:o.ag(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(w)for(const Ct of T.sortKeyRanges){const{sortKey:yt,symbolInstanceStart:Et,symbolInstanceEnd:Wt}=Ct;c.push({sortKey:yt,symbolInstanceStart:Et,symbolInstanceEnd:Wt,parameters:St})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:St})}attemptAnchorPlacement(c,d,_,w,T,U,g,y,S,F,M,N,k,V,j,K,tt,ht,rt){const At=o.aq[c.textAnchor],St=[c.textOffset0,c.textOffset1],Ct=_n(At,_,w,St,T),yt=this.collisionIndex.placeCollisionBox(d,N,y,S,F,g,U,K,M.predicate,rt,Ct);if((!ht||this.collisionIndex.placeCollisionBox(ht,N,y,S,F,g,U,tt,M.predicate,rt,Ct).placeable)&&yt.placeable){let Et;if(this.prevPlacement&&this.prevPlacement.variableOffsets[k.crossTileID]&&this.prevPlacement.placements[k.crossTileID]&&this.prevPlacement.placements[k.crossTileID].text&&(Et=this.prevPlacement.variableOffsets[k.crossTileID].anchor),k.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[k.crossTileID]={textOffset:St,width:_,height:w,anchor:At,textBoxScale:T,prevAnchor:Et},this.markUsedJustification(V,At,k,j),V.allowVerticalPlacement&&(this.markUsedOrientation(V,j,k),this.placedOrientations[k.crossTileID]=j),{shift:Ct,placedGlyphBoxes:yt}}}placeLayerBucketPart(c,d,_){const{bucket:w,layout:T,translationText:U,translationIcon:g,posMatrix:y,unwrappedTileID:S,textLabelPlaneMatrix:F,labelToScreenMatrix:M,textPixelRatio:N,holdingForFade:k,collisionBoxArray:V,partiallyEvaluatedTextSize:j,collisionGroup:K}=c.parameters,tt=T.get("text-optional"),ht=T.get("icon-optional"),rt=o.ar(T,"text-overlap","text-allow-overlap"),At=rt==="always",St=o.ar(T,"icon-overlap","icon-allow-overlap"),Ct=St==="always",yt=T.get("text-rotation-alignment")==="map",Et=T.get("text-pitch-alignment")==="map",Wt=T.get("icon-text-fit")!=="none",Zt=T.get("symbol-z-order")==="viewport-y",zt=At&&(Ct||!w.hasIconData()||ht),ae=Ct&&(At||!w.hasTextData()||tt);!w.collisionArrays&&V&&w.deserializeCollisionBoxes(V);const de=this._getTerrainElevationFunc(this.retainedQueryData[w.bucketInstanceId].tileID),Me=(le,Ee,$e)=>{var Tr,Je;if(d[le.crossTileID])return;if(k)return void(this.placements[le.crossTileID]=new Gr(!1,!1,!1));let mr=!1,Dr=!1,Lr=!0,Sn=null,ln={box:null,placeable:!1,offscreen:null},bn={box:null,placeable:!1,offscreen:null},Dn=null,Xr=null,Nn=null,di=0,ci=0,Ti=0;Ee.textFeatureIndex?di=Ee.textFeatureIndex:le.useRuntimeCollisionCircles&&(di=le.featureIndex),Ee.verticalTextFeatureIndex&&(ci=Ee.verticalTextFeatureIndex);const Ii=Ee.textBox;if(Ii){const ni=An=>{let Ki=o.ah.horizontal;if(w.allowVerticalPlacement&&!An&&this.prevPlacement){const Ui=this.prevPlacement.placedOrientations[le.crossTileID];Ui&&(this.placedOrientations[le.crossTileID]=Ui,Ki=Ui,this.markUsedOrientation(w,Ki,le))}return Ki},cs=(An,Ki)=>{if(w.allowVerticalPlacement&&le.numVerticalGlyphVertices>0&&Ee.verticalTextBox){for(const Ui of w.writingModes)if(Ui===o.ah.vertical?(ln=Ki(),bn=ln):ln=An(),ln&&ln.placeable)break}else ln=An()},io=le.textAnchorOffsetStartIndex,so=le.textAnchorOffsetEndIndex;if(so===io){const An=(Ki,Ui)=>{const ii=this.collisionIndex.placeCollisionBox(Ki,rt,N,y,S,Et,yt,U,K.predicate,de);return ii&&ii.placeable&&(this.markUsedOrientation(w,Ui,le),this.placedOrientations[le.crossTileID]=Ui),ii};cs(()=>An(Ii,o.ah.horizontal),()=>{const Ki=Ee.verticalTextBox;return w.allowVerticalPlacement&&le.numVerticalGlyphVertices>0&&Ki?An(Ki,o.ah.vertical):{box:null,offscreen:null}}),ni(ln&&ln.placeable)}else{let An=o.aq[(Je=(Tr=this.prevPlacement)===null||Tr===void 0?void 0:Tr.variableOffsets[le.crossTileID])===null||Je===void 0?void 0:Je.anchor];const Ki=(ii,il,Uc)=>{const yi=ii.x2-ii.x1,Lo=ii.y2-ii.y1,sl=le.textBoxScale,ol=Wt&&St==="never"?il:null;let al=null,mA=rt==="never"?1:2,vh="never";An&&mA++;for(let Cu=0;Cu<mA;Cu++){for(let yA=io;yA<so;yA++){const Rc=w.textAnchorOffsets.get(yA);if(An&&Rc.textAnchor!==An)continue;const Ta=this.attemptAnchorPlacement(Rc,ii,yi,Lo,sl,yt,Et,N,y,S,K,vh,le,w,Uc,U,g,ol,de);if(Ta&&(al=Ta.placedGlyphBoxes,al&&al.placeable))return mr=!0,Sn=Ta.shift,al}An?An=null:vh=rt}return _&&!al&&(al={box:this.collisionIndex.placeCollisionBox(Ii,"always",N,y,S,Et,yt,U,K.predicate,de,new o.P(0,0)).box,offscreen:!1,placeable:!1}),al};cs(()=>Ki(Ii,Ee.iconBox,o.ah.horizontal),()=>{const ii=Ee.verticalTextBox;return w.allowVerticalPlacement&&(!ln||!ln.placeable)&&le.numVerticalGlyphVertices>0&&ii?Ki(ii,Ee.verticalIconBox,o.ah.vertical):{box:null,occluded:!0,offscreen:null}}),ln&&(mr=ln.placeable,Lr=ln.offscreen);const Ui=ni(ln&&ln.placeable);if(!mr&&this.prevPlacement){const ii=this.prevPlacement.variableOffsets[le.crossTileID];ii&&(this.variableOffsets[le.crossTileID]=ii,this.markUsedJustification(w,ii.anchor,le,Ui))}}}if(Dn=ln,mr=Dn&&Dn.placeable,Lr=Dn&&Dn.offscreen,le.useRuntimeCollisionCircles){const ni=w.text.placedSymbolArray.get(le.centerJustifiedTextSymbolIndex),cs=o.ai(w.textSizeData,j,ni),io=T.get("text-padding");Xr=this.collisionIndex.placeCollisionCircles(rt,ni,w.lineVertexArray,w.glyphOffsetArray,cs,y,S,F,M,_,Et,K.predicate,le.collisionCircleDiameter,io,U,de),Xr.circles.length&&Xr.collisionDetected&&!_&&o.w("Collisions detected, but collision boxes are not shown"),mr=At||Xr.circles.length>0&&!Xr.collisionDetected,Lr=Lr&&Xr.offscreen}if(Ee.iconFeatureIndex&&(Ti=Ee.iconFeatureIndex),Ee.iconBox){const ni=cs=>this.collisionIndex.placeCollisionBox(cs,St,N,y,S,Et,yt,g,K.predicate,de,Wt&&Sn?Sn:void 0);bn&&bn.placeable&&Ee.verticalIconBox?(Nn=ni(Ee.verticalIconBox),Dr=Nn.placeable):(Nn=ni(Ee.iconBox),Dr=Nn.placeable),Lr=Lr&&Nn.offscreen}const qi=tt||le.numHorizontalGlyphVertices===0&&le.numVerticalGlyphVertices===0,no=ht||le.numIconVertices===0;qi||no?no?qi||(Dr=Dr&&mr):mr=Dr&&mr:Dr=mr=Dr&&mr;const Fi=Dr&&Nn.placeable;if(mr&&Dn.placeable&&this.collisionIndex.insertCollisionBox(Dn.box,rt,T.get("text-ignore-placement"),w.bucketInstanceId,bn&&bn.placeable&&ci?ci:di,K.ID),Fi&&this.collisionIndex.insertCollisionBox(Nn.box,St,T.get("icon-ignore-placement"),w.bucketInstanceId,Ti,K.ID),Xr&&mr&&this.collisionIndex.insertCollisionCircles(Xr.circles,rt,T.get("text-ignore-placement"),w.bucketInstanceId,di,K.ID),_&&this.storeCollisionData(w.bucketInstanceId,$e,Ee,Dn,Nn,Xr),le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(w.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[le.crossTileID]=new Gr(mr||zt,Dr||ae,Lr||w.justReloaded),d[le.crossTileID]=!0};if(Zt){if(c.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const le=w.getSortedSymbolIndexes(this.transform.angle);for(let Ee=le.length-1;Ee>=0;--Ee){const $e=le[Ee];Me(w.symbolInstances.get($e),w.collisionArrays[$e],$e)}}else for(let le=c.symbolInstanceStart;le<c.symbolInstanceEnd;le++)Me(w.symbolInstances.get(le),w.collisionArrays[le],le);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[w.bucketInstanceId];o.as(le.invProjMatrix,y),le.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}storeCollisionData(c,d,_,w,T,U){if(_.textBox||_.iconBox){let g,y;this.collisionBoxArrays.has(c)?g=this.collisionBoxArrays.get(c):(g=new Map,this.collisionBoxArrays.set(c,g)),g.has(d)?y=g.get(d):(y={text:null,icon:null},g.set(d,y)),_.textBox&&(y.text=w.box),_.iconBox&&(y.icon=T.box)}if(U){let g=this.collisionCircleArrays[c];g===void 0&&(g=this.collisionCircleArrays[c]=new Zr);for(let y=0;y<U.circles.length;y+=4)g.circles.push(U.circles[y+0]),g.circles.push(U.circles[y+1]),g.circles.push(U.circles[y+2]),g.circles.push(U.collisionDetected?1:0)}}markUsedJustification(c,d,_,w){let T;T=w===o.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[o.at(d)];const U=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const g of U)g>=0&&(c.text.placedSymbolArray.get(g).crossTileID=T>=0&&g!==T?0:_.crossTileID)}markUsedOrientation(c,d,_){const w=d===o.ah.horizontal||d===o.ah.horizontalOnly?d:0,T=d===o.ah.vertical?d:0,U=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const g of U)c.text.placedSymbolArray.get(g).placedOrientation=w;_.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const w=d?d.symbolFadeChange(c):1,T=d?d.opacities:{},U=d?d.variableOffsets:{},g=d?d.placedOrientations:{};for(const y in this.placements){const S=this.placements[y],F=T[y];F?(this.opacities[y]=new Vr(F,w,S.text,S.icon),_=_||S.text!==F.text.placed||S.icon!==F.icon.placed):(this.opacities[y]=new Vr(null,w,S.text,S.icon,S.skipFade),_=_||S.text||S.icon)}for(const y in T){const S=T[y];if(!this.opacities[y]){const F=new Vr(S,w,!1,!1);F.isHidden()||(this.opacities[y]=F,_=_||S.text.placed||S.icon.placed)}}for(const y in U)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=U[y]);for(const y in g)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=g[y]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:c)}updateLayerOpacities(c,d){const _={};for(const w of d){const T=w.getBucket(c);T&&w.latestFeatureIndex&&c.id===T.layerIds[0]&&this.updateBucketOpacities(T,w.tileID,_,w.collisionBoxArray)}}updateBucketOpacities(c,d,_,w){c.hasTextData()&&(c.text.opacityVertexArray.clear(),c.text.hasVisibleVertices=!1),c.hasIconData()&&(c.icon.opacityVertexArray.clear(),c.icon.hasVisibleVertices=!1),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const T=c.layers[0],U=T.layout,g=new Vr(null,0,!1,!1,!0),y=U.get("text-allow-overlap"),S=U.get("icon-allow-overlap"),F=T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=U.get("text-rotation-alignment")==="map",N=U.get("text-pitch-alignment")==="map",k=U.get("icon-text-fit")!=="none",V=new Vr(null,0,y&&(S||!c.hasIconData()||U.get("icon-optional")),S&&(y||!c.hasTextData()||U.get("text-optional")),!0);!c.collisionArrays&&w&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(w);const j=(tt,ht,rt)=>{for(let At=0;At<ht/4;At++)tt.opacityVertexArray.emplaceBack(rt);tt.hasVisibleVertices=tt.hasVisibleVertices||rt!==Wn},K=this.collisionBoxArrays.get(c.bucketInstanceId);for(let tt=0;tt<c.symbolInstances.length;tt++){const ht=c.symbolInstances.get(tt),{numHorizontalGlyphVertices:rt,numVerticalGlyphVertices:At,crossTileID:St}=ht;let Ct=this.opacities[St];_[St]?Ct=g:Ct||(Ct=V,this.opacities[St]=Ct),_[St]=!0;const yt=ht.numIconVertices>0,Et=this.placedOrientations[ht.crossTileID],Wt=Et===o.ah.vertical,Zt=Et===o.ah.horizontal||Et===o.ah.horizontalOnly;if(rt>0||At>0){const ae=gn(Ct.text);j(c.text,rt,Wt?Wn:ae),j(c.text,At,Zt?Wn:ae);const de=Ct.text.isHidden();[ht.rightJustifiedTextSymbolIndex,ht.centerJustifiedTextSymbolIndex,ht.leftJustifiedTextSymbolIndex].forEach(Ee=>{Ee>=0&&(c.text.placedSymbolArray.get(Ee).hidden=de||Wt?1:0)}),ht.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(ht.verticalPlacedTextSymbolIndex).hidden=de||Zt?1:0);const Me=this.variableOffsets[ht.crossTileID];Me&&this.markUsedJustification(c,Me.anchor,ht,Et);const le=this.placedOrientations[ht.crossTileID];le&&(this.markUsedJustification(c,"left",ht,le),this.markUsedOrientation(c,le,ht))}if(yt){const ae=gn(Ct.icon),de=!(k&&ht.verticalPlacedIconSymbolIndex&&Wt);ht.placedIconSymbolIndex>=0&&(j(c.icon,ht.numIconVertices,de?ae:Wn),c.icon.placedSymbolArray.get(ht.placedIconSymbolIndex).hidden=Ct.icon.isHidden()),ht.verticalPlacedIconSymbolIndex>=0&&(j(c.icon,ht.numVerticalIconVertices,de?Wn:ae),c.icon.placedSymbolArray.get(ht.verticalPlacedIconSymbolIndex).hidden=Ct.icon.isHidden())}const zt=K&&K.has(tt)?K.get(tt):{text:null,icon:null};if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const ae=c.collisionArrays[tt];if(ae){let de=new o.P(0,0);if(ae.textBox||ae.verticalTextBox){let Me=!0;if(F){const le=this.variableOffsets[St];le?(de=_n(le.anchor,le.width,le.height,le.textOffset,le.textBoxScale),M&&de._rotate(N?this.transform.angle:-this.transform.angle)):Me=!1}if(ae.textBox||ae.verticalTextBox){let le;ae.textBox&&(le=Wt),ae.verticalTextBox&&(le=Zt),Zn(c.textCollisionBox.collisionVertexArray,Ct.text.placed,!Me||le,zt.text,de.x,de.y)}}if(ae.iconBox||ae.verticalIconBox){const Me=!!(!Zt&&ae.verticalIconBox);let le;ae.iconBox&&(le=Me),ae.verticalIconBox&&(le=!Me),Zn(c.iconCollisionBox.collisionVertexArray,Ct.icon.placed,le,zt.icon,k?de.x:0,k?de.y:0)}}}}if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.text.opacityVertexArray.length!==c.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${c.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${c.text.layoutVertexArray.length}) / 4`);if(c.icon.opacityVertexArray.length!==c.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${c.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${c.icon.layoutVertexArray.length}) / 4`);if(c.bucketInstanceId in this.collisionCircleArrays){const tt=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=tt.invProjMatrix,c.placementViewportMatrix=tt.viewportMatrix,c.collisionCircleArray=tt.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>c}setStale(){this.stale=!0}}function Zn(C,c,d,_,w,T){_&&_.length!==0||(_=[0,0,0,0]);const U=_[0]-Ve,g=_[1]-Ve,y=_[2]-Ve,S=_[3]-Ve;C.emplaceBack(c?1:0,d?1:0,w||0,T||0,U,g),C.emplaceBack(c?1:0,d?1:0,w||0,T||0,y,g),C.emplaceBack(c?1:0,d?1:0,w||0,T||0,y,S),C.emplaceBack(c?1:0,d?1:0,w||0,T||0,U,S)}const Rt=Math.pow(2,25),qe=Math.pow(2,24),Te=Math.pow(2,17),lr=Math.pow(2,16),Or=Math.pow(2,9),Fn=Math.pow(2,8),jr=Math.pow(2,1);function gn(C){if(C.opacity===0&&!C.placed)return 0;if(C.opacity===1&&C.placed)return 4294967295;const c=C.placed?1:0,d=Math.floor(127*C.opacity);return d*Rt+c*qe+d*Te+c*lr+d*Or+c*Fn+d*jr+c}const Wn=0;function mn(){return{isOccluded:(C,c,d)=>!1,getPitchedTextCorrection:(C,c,d)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(C,c,d,_){throw new Error("Not implemented.")},translatePosition:(C,c,d,_)=>function(w,T,U,g){let y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(!U[0]&&!U[1])return[0,0];const S=y?g==="map"?w.angle:0:g==="viewport"?-w.angle:0;if(S){const F=Math.sin(S),M=Math.cos(S);U=[U[0]*M-U[1]*F,U[0]*F+U[1]*M]}return[y?U[0]:_r(T,U[0],w.zoom),y?U[1]:_r(T,U[1],w.zoom)]}(C,c,d,_),getCircleRadiusCorrection:C=>1}}class on{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&!c.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,d,_,w,T){const U=this._bucketParts;for(;this._currentTileIndex<c.length;)if(d.getBucketParts(U,w,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,U.sort((g,y)=>g.sortKey-y.sortKey));this._currentPartIndex<U.length;)if(d.placeLayerBucketPart(U[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,T())return!0;return!1}}class Bc{constructor(c,d,_,w,T,U,g,y){this.placement=new Rn(c,mn(),d,U,g,y),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=w,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(c,d,_){const w=b.now(),T=()=>!this._forceFullPlacement&&b.now()-w>2;for(;this._currentPlacementIndex>=0;){const U=d[c[this._currentPlacementIndex]],g=this.placement.collisionIndex.transform.zoom;if(U.type==="symbol"&&(!U.minzoom||U.minzoom<=g)&&(!U.maxzoom||U.maxzoom>g)){if(this._inProgressLayer||(this._inProgressLayer=new on(U)),this._inProgressLayer.continuePlacement(_[U.source],this.placement,this._showCollisionBoxes,U,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const os=512/o.W/2;class Qn{constructor(c,d,_){this.tileID=c,this.bucketInstanceId=_,this._symbolsByKey={};const w=new Map;for(let T=0;T<d.length;T++){const U=d.get(T),g=U.key,y=w.get(g);y?y.push(U):w.set(g,[U])}for(const[T,U]of w){const g={positions:U.map(y=>({x:Math.floor(y.anchorX*os),y:Math.floor(y.anchorY*os)})),crossTileIDs:U.map(y=>y.crossTileID)};if(g.positions.length>128){const y=new o.av(g.positions.length,16,Uint16Array);for(const{x:S,y:F}of g.positions)y.add(S,F);y.finish(),delete g.positions,g.index=y}this._symbolsByKey[T]=g}}getScaledCoordinates(c,d){const{x:_,y:w,z:T}=this.tileID.canonical,{x:U,y:g,z:y}=d.canonical,S=os/Math.pow(2,y-T),F=(g*o.W+c.anchorY)*S,M=w*o.W*os;return{x:Math.floor((U*o.W+c.anchorX)*S-_*o.W*os),y:Math.floor(F-M)}}findMatches(c,d,_){const w=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let T=0;T<c.length;T++){const U=c.get(T);if(U.crossTileID)continue;const g=this._symbolsByKey[U.key];if(!g)continue;const y=this.getScaledCoordinates(U,d);if(g.index){const S=g.index.range(y.x-w,y.y-w,y.x+w,y.y+w).sort();for(const F of S){const M=g.crossTileIDs[F];if(!_[M]){_[M]=!0,U.crossTileID=M;break}}}else if(g.positions)for(let S=0;S<g.positions.length;S++){const F=g.positions[S],M=g.crossTileIDs[S];if(Math.abs(F.x-y.x)<=w&&Math.abs(F.y-y.y)<=w&&!_[M]){_[M]=!0,U.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(c=>{let{crossTileIDs:d}=c;return d})}}class un{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const d=Math.round((c-this.lng)/360);if(d!==0)for(const _ in this.indexes){const w=this.indexes[_],T={};for(const U in w){const g=w[U];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+d),T[g.tileID.key]=g}this.indexes[_]=T}this.lng=c}addBucket(c,d,_){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const w=this.usedCrossTileIDs[c.overscaledZ];for(const T in this.indexes){const U=this.indexes[T];if(Number(T)>c.overscaledZ)for(const g in U){const y=U[g];y.tileID.isChildOf(c)&&y.findMatches(d.symbolInstances,c,w)}else{const g=U[c.scaledTo(Number(T)).key];g&&g.findMatches(d.symbolInstances,c,w)}}for(let T=0;T<d.symbolInstances.length;T++){const U=d.symbolInstances.get(T);U.crossTileID||(U.crossTileID=_.generate(),w[U.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Qn(c,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(c,d){for(const _ of d.getCrossTileIDsLists())for(const w of _)delete this.usedCrossTileIDs[c][w]}removeStaleBuckets(c){let d=!1;for(const _ in this.indexes){const w=this.indexes[_];for(const T in w)c[w[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,w[T]),delete w[T],d=!0)}return d}}class Ln{constructor(){this.layerIndexes={},this.crossTileIDs=new un,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,d,_){let w=this.layerIndexes[c.id];w===void 0&&(w=this.layerIndexes[c.id]=new Cs);let T=!1;const U={};w.handleWrapJump(_);for(const g of d){const y=g.getBucket(c);y&&c.id===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(g.tileID,y,this.crossTileIDs)&&(T=!0),U[y.bucketInstanceId]=!0)}return w.removeStaleBuckets(U)&&(T=!0),T}pruneUnusedLayers(c){const d={};c.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const Os=(C,c)=>o.t(C,c&&c.filter(d=>d.identifier!=="source.canvas")),Mi=o.aw();class ga extends o.E{constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const w=this.sourceCaches[_].getSource().type;w!=="vector"&&w!=="geojson"||this.sourceCaches[_].reload()}},this.map=c,this.dispatcher=new oe(Gt(),c._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,w)=>this.getGlyphs(_,w)),this.dispatcher.registerMessageHandler("GI",(_,w)=>this.getImages(_,w)),this.imageManager=new wt,this.imageManager.setEventedParent(this),this.glyphManager=new ee(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Be(256,512),this.crossTileSymbolIndex=new Ln,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.ay()),or().on(Mr,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const w=this.sourceCaches[_.sourceId];if(!w)return;const T=w.getSource();if(T&&T.vectorLayerIds)for(const U in this._layers){const g=this._layers[U];g.source===T.id&&this._validateLayer(g)}})}loadURL(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const w=this.map._requestManager.transformRequest(c,"Style");this._loadStyleRequest=new AbortController,o.h(w,this._loadStyleRequest).then(T=>{this._loadStyleRequest=null,this._load(T.data,d,_)}).catch(T=>{this._loadStyleRequest=null,T&&this.fire(new o.j(T))})}loadJSON(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,b.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(c,d,_)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Mi,{validate:!1})}_load(c,d,_){var w;const T=d.transformStyle?d.transformStyle(_,c):c;if(!d.validate||!Os(this,o.x(T))){this._loaded=!0,this.stylesheet=T;for(const U in T.sources)this.addSource(U,T.sources[U],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new re(this.stylesheet.light),this.map.setTerrain((w=this.stylesheet.terrain)!==null&&w!==void 0?w:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const c=o.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",c),this._order=c.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of c){const _=o.aA(d);_.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=_}}_loadSprite(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,w;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(T,U,g,y){return o._(this,void 0,void 0,function*(){const S=Mt(T),F=g>1?"@2x":"",M={},N={};for(const{id:k,url:V}of S){const j=U.transformRequest(Lt(V,F,".json"),"SpriteJSON");M[k]=o.h(j,y);const K=U.transformRequest(Lt(V,F,".png"),"SpriteImage");N[k]=X.getImage(K,y)}return yield Promise.all([...Object.values(M),...Object.values(N)]),function(k,V){return o._(this,void 0,void 0,function*(){const j={};for(const K in k){j[K]={};const tt=b.getImageCanvasContext((yield V[K]).data),ht=(yield k[K]).data;for(const rt in ht){const{width:At,height:St,x:Ct,y:yt,sdf:Et,pixelRatio:Wt,stretchX:Zt,stretchY:zt,content:ae,textFitWidth:de,textFitHeight:Me}=ht[rt];j[K][rt]={data:null,pixelRatio:Wt,sdf:Et,stretchX:Zt,stretchY:zt,content:ae,textFitWidth:de,textFitHeight:Me,spriteData:{width:At,height:St,x:Ct,y:yt,context:tt}}}}return j})}(M,N)})}(c,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(T=>{if(this._spriteRequest=null,T)for(const U in T){this._spritesImagesIds[U]=[];const g=this._spritesImagesIds[U]?this._spritesImagesIds[U].filter(y=>!(y in T)):[];for(const y of g)this.imageManager.removeImage(y),this._changedImages[y]=!0;for(const y in T[U]){const S=U==="default"?y:`${U}:${y}`;this._spritesImagesIds[U].push(S),S in this.imageManager.images?this.imageManager.updateImage(S,T[U][y],!1):this.imageManager.addImage(S,T[U][y]),d&&(this._changedImages[S]=!0)}}}).catch(T=>{this._spriteRequest=null,w=T,this.fire(new o.j(w))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),_&&_(w)})}_unloadSprite(){for(const c of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(c),this._changedImages[c]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(c){const d=this.sourceCaches[c.source];if(!d)return;const _=c.sourceLayer;if(!_)return;const w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(_)===-1)&&this.fire(new o.j(new Error(`Source layer "${_}" does not exist on source "${w.id}" as specified by style layer "${c.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(c){const d=this._serializedAllLayers();if(!c||c.length===0)return Object.values(d);const _=[];for(const w of c)d[w]&&_.push(d[w]);return _}_serializedAllLayers(){let c=this._serializedLayers;if(c)return c;c=this._serializedLayers={};const d=Object.keys(this._layers);for(const _ of d){const w=this._layers[_];w.type!=="custom"&&(c[_]=w.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(c){if(!this._loaded)return;const d=this._changed;if(d){const w=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(w.length||T.length)&&this._updateWorkerLayers(w,T);for(const U in this._updatedSources){const g=this._updatedSources[U];if(g==="reload")this._reloadSource(U);else{if(g!=="clear")throw new Error(`Invalid action ${g}`);this._clearSource(U)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const U in this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}const _={};for(const w in this.sourceCaches){const T=this.sourceCaches[w];_[w]=T.used,T.used=!1}for(const w of this._order){const T=this._layers[w];T.recalculate(c,this._availableImages),!T.isHidden(c.zoom)&&T.source&&(this.sourceCaches[T.source].used=!0)}for(const w in _){const T=this.sourceCaches[w];!!_[w]!=!!T.used&&T.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:w}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(c,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(c),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var _;this._checkLoaded();const w=this.serialize();if(c=d.transformStyle?d.transformStyle(w,c):c,((_=d.validate)===null||_===void 0||_)&&Os(this,o.x(c)))return!1;(c=o.aB(c)).layers=o.az(c.layers);const T=o.aC(w,c),U=this._getOperationsToPerform(T);if(U.unimplemented.length>0)throw new Error(`Unimplemented: ${U.unimplemented.join(", ")}.`);if(U.operations.length===0)return!1;for(const g of U.operations)g();return this.stylesheet=c,this._serializedLayers=null,!0}_getOperationsToPerform(c){const d=[],_=[];for(const w of c)switch(w.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,w.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,w.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,w.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,w.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,w.args));break;case"addSource":d.push(()=>this.addSource.apply(this,w.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,w.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,w.args));break;case"setLight":d.push(()=>this.setLight.apply(this,w.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,w.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,w.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,w.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,w.args));break;case"setTransition":d.push(()=>{});break;default:_.push(w.command)}return{operations:d,unimplemented:_}}addImage(c,d){if(this.getImage(c))return this.fire(new o.j(new Error(`An image named "${c}" already exists.`)));this.imageManager.addImage(c,d),this._afterImageUpdated(c)}updateImage(c,d){this.imageManager.updateImage(c,d)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){if(!this.getImage(c))return this.fire(new o.j(new Error(`An image named "${c}" does not exist.`)));this.imageManager.removeImage(c),this._afterImageUpdated(c)}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error(`Source "${c}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.x.source,`sources.${c}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const w=this.sourceCaches[c]=new ge(c,d,this.dispatcher);w.style=this,w.setEventedParent(this,()=>({isSourceLoaded:w.loaded(),source:w.serialize(),sourceId:c})),w.onAdd(this.map),this._changed=!0}removeSource(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===c)return this.fire(new o.j(new Error(`Source "${c}" cannot be removed while layer "${_}" is using it.`)));const d=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],d.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(c,d){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error(`There is no source with this ID=${c}`);const _=this.sourceCaches[c].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(d),this._changed=!0}getSource(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()}addLayer(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const w=c.id;if(this.getLayer(w))return void this.fire(new o.j(new Error(`Layer "${w}" already exists on this map.`)));let T;if(c.type==="custom"){if(Os(this,o.aD(c)))return;T=o.aA(c)}else{if("source"in c&&typeof c.source=="object"&&(this.addSource(w,c.source),c=o.aB(c),c=o.e(c,{source:w})),this._validate(o.x.layer,`layers.${w}`,c,{arrayIndex:-1},_))return;T=o.aA(c),this._validateLayer(T),T.setEventedParent(this,{layer:{id:w}})}const U=d?this._order.indexOf(d):this._order.length;if(d&&U===-1)this.fire(new o.j(new Error(`Cannot add layer "${w}" before non-existing layer "${d}".`)));else{if(this._order.splice(U,0,w),this._layerOrderChanged=!0,this._layers[w]=T,this._removedLayers[w]&&T.source&&T.type!=="custom"){const g=this._removedLayers[w];delete this._removedLayers[w],g.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}moveLayer(c,d){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new o.j(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===d)return;const _=this._order.indexOf(c);this._order.splice(_,1);const w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new o.j(new Error(`Cannot move layer "${c}" before non-existing layer "${d}".`))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}removeLayer(c){this._checkLoaded();const d=this._layers[c];if(!d)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${c}".`)));d.setEventedParent(null);const _=this._order.indexOf(c);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],this._serializedLayers&&delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}getLayer(c){return this._layers[c]}getLayersOrder(){return[...this._order]}hasLayer(c){return c in this._layers}setLayerZoomRange(c,d,_){this._checkLoaded();const w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===_||(d!=null&&(w.minzoom=d),_!=null&&(w.maxzoom=_),this._updateLayer(w)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${c}".`)))}setFilter(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const w=this.getLayer(c);if(w){if(!o.aE(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(o.x.filter,`layers.${w.id}.filter`,d,null,_)||(w.filter=o.aB(d),this._updateLayer(w)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${c}".`)))}getFilter(c){return o.aB(this.getLayer(c).filter)}setLayoutProperty(c,d,_){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const T=this.getLayer(c);T?o.aE(T.getLayoutProperty(d),_)||(T.setLayoutProperty(d,_,w),this._updateLayer(T)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${c}".`)))}getLayoutProperty(c,d){const _=this.getLayer(c);if(_)return _.getLayoutProperty(d);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${c}".`)))}setPaintProperty(c,d,_){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const T=this.getLayer(c);T?o.aE(T.getPaintProperty(d),_)||(T.setPaintProperty(d,_,w)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[c]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${c}".`)))}getPaintProperty(c,d){return this.getLayer(c).getPaintProperty(d)}setFeatureState(c,d){this._checkLoaded();const _=c.source,w=c.sourceLayer,T=this.sourceCaches[_];if(T===void 0)return void this.fire(new o.j(new Error(`The source '${_}' does not exist in the map's style.`)));const U=T.getSource().type;U==="geojson"&&w?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):U!=="vector"||w?(c.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),T.setFeatureState(w,c.id,d)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(c,d){this._checkLoaded();const _=c.source,w=this.sourceCaches[_];if(w===void 0)return void this.fire(new o.j(new Error(`The source '${_}' does not exist in the map's style.`)));const T=w.getSource().type,U=T==="vector"?c.sourceLayer:void 0;T!=="vector"||U?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(U,c.id,d):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(c){this._checkLoaded();const d=c.source,_=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0)return w.getSource().type!=="vector"||_?(c.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),w.getFeatureState(_,c.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const c=o.aF(this.sourceCaches,T=>T.serialize()),d=this._serializeByIds(this._order),_=this.map.getTerrain()||void 0,w=this.stylesheet;return o.aG({version:w.version,name:w.name,metadata:w.metadata,light:w.light,center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch,sprite:w.sprite,glyphs:w.glyphs,transition:w.transition,sources:c,layers:d,terrain:_},T=>T!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(c){const d=U=>this._layers[U].type==="fill-extrusion",_={},w=[];for(let U=this._order.length-1;U>=0;U--){const g=this._order[U];if(d(g)){_[g]=U;for(const y of c){const S=y[g];if(S)for(const F of S)w.push(F)}}}w.sort((U,g)=>g.intersectionZ-U.intersectionZ);const T=[];for(let U=this._order.length-1;U>=0;U--){const g=this._order[U];if(d(g))for(let y=w.length-1;y>=0;y--){const S=w[y].feature;if(_[S.layer.id]<U)break;T.push(S),w.pop()}else for(const y of c){const S=y[g];if(S)for(const F of S)T.push(F.feature)}}return T}queryRenderedFeatures(c,d,_){d&&d.filter&&this._validate(o.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const g of d.layers){const y=this._layers[g];if(!y)return this.fire(new o.j(new Error(`The layer '${g}' does not exist in the map's style and cannot be queried for features.`))),[];w[y.source]=!0}}const T=[];d.availableImages=this._availableImages;const U=this._serializedAllLayers();for(const g in this.sourceCaches)d.layers&&!w[g]||T.push(Fe(this.sourceCaches[g],this._layers,U,c,d,_));return this.placement&&T.push(function(g,y,S,F,M,N,k){const V={},j=N.queryRenderedSymbols(F),K=[];for(const tt of Object.keys(j).map(Number))K.push(k[tt]);K.sort(Re);for(const tt of K){const ht=tt.featureIndex.lookupSymbolFeatures(j[tt.bucketInstanceId],y,tt.bucketIndex,tt.sourceLayerIndex,M.filter,M.layers,M.availableImages,g);for(const rt in ht){const At=V[rt]=V[rt]||[],St=ht[rt];St.sort((Ct,yt)=>{const Et=tt.featureSortOrder;if(Et){const Wt=Et.indexOf(Ct.featureIndex);return Et.indexOf(yt.featureIndex)-Wt}return yt.featureIndex-Ct.featureIndex});for(const Ct of St)At.push(Ct)}}for(const tt in V)V[tt].forEach(ht=>{const rt=ht.feature,At=S[g[tt].source].getFeatureState(rt.layer["source-layer"],rt.id);rt.source=rt.layer.source,rt.layer["source-layer"]&&(rt.sourceLayer=rt.layer["source-layer"]),rt.state=At});return V}(this._layers,U,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(c,d){d&&d.filter&&this._validate(o.x.filter,"querySourceFeatures.filter",d.filter,null,d);const _=this.sourceCaches[c];return _?function(w,T){const U=w.getRenderableIds().map(S=>w.getTileByID(S)),g=[],y={};for(let S=0;S<U.length;S++){const F=U[S],M=F.tileID.canonical.key;y[M]||(y[M]=!0,F.querySourceFeatures(g,T))}return g}(_,d):[]}getLight(){return this.light.getLight()}setLight(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const _=this.light.getLight();let w=!1;for(const U in c)if(!o.aE(c[U],_[U])){w=!0;break}if(!w)return;const T={now:b.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(T)}_validate(c,d,_,w){let T=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!T||T.validate!==!1)&&Os(this,c.call(o.x,o.e({key:d,style:this.serialize(),value:_,styleSpec:o.v},w)))}_remove(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),or().off(Mr,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const _=this.sourceCaches[d];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),c&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(c)}_clearSource(c){this.sourceCaches[c].clearTiles()}_reloadSource(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()}_updateSources(c){for(const d in this.sourceCaches)this.sourceCaches[d].update(c,this.map.terrain)}_generateCollisionBoxes(){for(const c in this.sourceCaches)this._reloadSource(c)}_updatePlacement(c,d,_,w){let T=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,U=!1,g=!1;const y={};for(const S of this._order){const F=this._layers[S];if(F.type!=="symbol")continue;if(!y[F.source]){const N=this.sourceCaches[F.source];y[F.source]=N.getRenderableIds(!0).map(k=>N.getTileByID(k)).sort((k,V)=>V.tileID.overscaledZ-k.tileID.overscaledZ||(k.tileID.isLessThan(V.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(F,y[F.source],c.center.lng);U=U||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(b.now(),c.zoom))&&(this.pauseablePlacement=new Bc(c,this.map.terrain,this._order,T,d,_,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(b.now()),g=!0),U&&this.pauseablePlacement.placement.setStale()),g||U)for(const S of this._order){const F=this._layers[S];F.type==="symbol"&&this.placement.updateLayerOpacities(F,y[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(b.now())}_releaseSymbolFadeTiles(){for(const c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,d){return o._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const w=this.sourceCaches[d.source];return w&&w.setDependencies(d.tileID.key,d.type,d.icons),_})}getGlyphs(c,d){return o._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(d.stacks),w=this.sourceCaches[d.source];return w&&w.setDependencies(d.tileID.key,d.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),c&&this._validate(o.x.glyphs,"glyphs",c,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=c,this.glyphManager.entries={},this.glyphManager.setURL(c))}addSprite(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},w=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const T=[{id:c,url:d}],U=[...Mt(this.stylesheet.sprite),...T];this._validate(o.x.sprite,"sprite",U,null,_)||(this.stylesheet.sprite=U,this._loadSprite(T,!0,w))}removeSprite(c){this._checkLoaded();const d=Mt(this.stylesheet.sprite);if(d.find(_=>_.id===c)){if(this._spritesImagesIds[c])for(const _ of this._spritesImagesIds[c])this.imageManager.removeImage(_),this._changedImages[_]=!0;d.splice(d.findIndex(_=>_.id===c),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[c],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${c}" doesn't exists on this map.`)))}getSprite(){return Mt(this.stylesheet.sprite)}setSprite(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),c&&this._validate(o.x.sprite,"sprite",c,null,d)||(this.stylesheet.sprite=c,c?this._loadSprite(c,!0,_):(this._unloadSprite(),_&&_(null)))}}var ti=o.X([{name:"a_pos",type:"Int16",components:2}]),as="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const wi={prelude:an(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:an(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:an(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:an(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:an("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:an(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:an(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:an("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:an("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:an("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:an(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:an(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:an(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:an(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:an(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:an(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:an(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:an(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:an(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:an(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:an(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:an(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:an(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:an(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:an(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:an(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:an("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",as),terrainDepth:an("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",as),terrainCoords:an("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",as)};function an(C,c){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=c.match(/attribute ([\w]+) ([\w]+)/g),w=C.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),U=T?T.concat(w):w,g={};return{fragmentSource:C=C.replace(d,(y,S,F,M,N)=>(g[N]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${F} ${M} ${N};
#else
uniform ${F} ${M} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${F} ${M} ${N} = u_${N};
#endif
`)),vertexSource:c=c.replace(d,(y,S,F,M,N)=>{const k=M==="float"?"vec2":"vec4",V=N.match(/color/)?"color":k;return g[N]?S==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${F} ${k} a_${N};
varying ${F} ${M} ${N};
#else
uniform ${F} ${M} u_${N};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${F} ${M} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${V}(a_${N}, u_${N}_t);
#else
    ${F} ${M} ${N} = u_${N};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${F} ${k} a_${N};
#else
uniform ${F} ${M} u_${N};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${F} ${M} ${N} = a_${N};
#else
    ${F} ${M} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${F} ${M} ${N} = unpack_mix_${V}(a_${N}, u_${N}_t);
#else
    ${F} ${M} ${N} = u_${N};
#endif
`}),staticAttributes:_,staticUniforms:U}}class jo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(c,d,_,w,T,U,g,y,S){this.context=c;let F=this.boundPaintVertexBuffers.length!==w.length;for(let M=0;!F&&M<w.length;M++)this.boundPaintVertexBuffers[M]!==w[M]&&(F=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||F||this.boundIndexBuffer!==T||this.boundVertexOffset!==U||this.boundDynamicVertexBuffer!==g||this.boundDynamicVertexBuffer2!==y||this.boundDynamicVertexBuffer3!==S?this.freshBind(d,_,w,T,U,g,y,S):(c.bindVertexArray.set(this.vao),g&&g.bind(),T&&T.dynamicDraw&&T.bind(),y&&y.bind(),S&&S.bind())}freshBind(c,d,_,w,T,U,g,y){const S=c.numAttributes,F=this.context,M=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=w,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=U,this.boundDynamicVertexBuffer2=g,this.boundDynamicVertexBuffer3=y,d.enableAttributes(M,c);for(const N of _)N.enableAttributes(M,c);U&&U.enableAttributes(M,c),g&&g.enableAttributes(M,c),y&&y.enableAttributes(M,c),d.bind(),d.setVertexAttribPointers(M,c,T);for(const N of _)N.bind(),N.setVertexAttribPointers(M,c,T);U&&(U.bind(),U.setVertexAttribPointers(M,c,T)),w&&w.bind(),g&&(g.bind(),g.setVertexAttribPointers(M,c,T)),y&&(y.bind(),y.setVertexAttribPointers(M,c,T)),F.currentNumAttributes=S}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function qo(C){const c=[];for(let d=0;d<C.length;d++){if(C[d]===null)continue;const _=C[d].split(" ");c.push(_.pop())}return c}class Il{constructor(c,d,_,w,T,U){const g=c.gl;this.program=g.createProgram();const y=qo(d.staticAttributes),S=_?_.getBinderAttributes():[],F=y.concat(S),M=wi.prelude.staticUniforms?qo(wi.prelude.staticUniforms):[],N=d.staticUniforms?qo(d.staticUniforms):[],k=_?_.getBinderUniforms():[],V=M.concat(N).concat(k),j=[];for(const Ct of V)j.indexOf(Ct)<0&&j.push(Ct);const K=_?_.defines():[];T&&K.push("#define OVERDRAW_INSPECTOR;"),U&&K.push("#define TERRAIN3D;");const tt=K.concat(wi.prelude.fragmentSource,d.fragmentSource).join(`
`),ht=K.concat(wi.prelude.vertexSource,d.vertexSource).join(`
`),rt=g.createShader(g.FRAGMENT_SHADER);if(g.isContextLost())return void(this.failedToCreate=!0);if(g.shaderSource(rt,tt),g.compileShader(rt),!g.getShaderParameter(rt,g.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${g.getShaderInfoLog(rt)}`);g.attachShader(this.program,rt);const At=g.createShader(g.VERTEX_SHADER);if(g.isContextLost())return void(this.failedToCreate=!0);if(g.shaderSource(At,ht),g.compileShader(At),!g.getShaderParameter(At,g.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${g.getShaderInfoLog(At)}`);g.attachShader(this.program,At),this.attributes={};const St={};this.numAttributes=F.length;for(let Ct=0;Ct<this.numAttributes;Ct++)F[Ct]&&(g.bindAttribLocation(this.program,Ct,F[Ct]),this.attributes[F[Ct]]=Ct);if(g.linkProgram(this.program),!g.getProgramParameter(this.program,g.LINK_STATUS))throw new Error(`Program failed to link: ${g.getProgramInfoLog(this.program)}`);g.deleteShader(At),g.deleteShader(rt);for(let Ct=0;Ct<j.length;Ct++){const yt=j[Ct];if(yt&&!St[yt]){const Et=g.getUniformLocation(this.program,yt);Et&&(St[yt]=Et)}}this.fixedUniforms=w(c,St),this.terrainUniforms=((Ct,yt)=>({u_depth:new o.aH(Ct,yt.u_depth),u_terrain:new o.aH(Ct,yt.u_terrain),u_terrain_dim:new o.aI(Ct,yt.u_terrain_dim),u_terrain_matrix:new o.aJ(Ct,yt.u_terrain_matrix),u_terrain_unpack:new o.aK(Ct,yt.u_terrain_unpack),u_terrain_exaggeration:new o.aI(Ct,yt.u_terrain_exaggeration)}))(c,St),this.binderUniforms=_?_.getUniforms(c,St):[]}draw(c,d,_,w,T,U,g,y,S,F,M,N,k,V,j,K,tt,ht){const rt=c.gl;if(this.failedToCreate)return;if(c.program.set(this.program),c.setDepthMode(_),c.setStencilMode(w),c.setColorMode(T),c.setCullFace(U),y){c.activeTexture.set(rt.TEXTURE2),rt.bindTexture(rt.TEXTURE_2D,y.depthTexture),c.activeTexture.set(rt.TEXTURE3),rt.bindTexture(rt.TEXTURE_2D,y.texture);for(const St in this.terrainUniforms)this.terrainUniforms[St].set(y[St])}for(const St in this.fixedUniforms)this.fixedUniforms[St].set(g[St]);j&&j.setUniforms(c,this.binderUniforms,k,{zoom:V});let At=0;switch(d){case rt.LINES:At=2;break;case rt.TRIANGLES:At=3;break;case rt.LINE_STRIP:At=1}for(const St of N.get()){const Ct=St.vaos||(St.vaos={});(Ct[S]||(Ct[S]=new jo)).bind(c,this,F,j?j.getPaintVertexBuffers():[],M,St.vertexOffset,K,tt,ht),rt.drawElements(d,St.primitiveLength*At,rt.UNSIGNED_SHORT,St.primitiveOffset*At*2)}}}function Fl(C,c,d){const _=1/_r(d,1,c.transform.tileZoom),w=Math.pow(2,d.tileID.overscaledZ),T=d.tileSize*Math.pow(2,c.transform.tileZoom)/w,U=T*(d.tileID.canonical.x+d.tileID.wrap*w),g=T*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,C.fromScale,C.toScale],u_fade:C.t,u_pixel_coord_upper:[U>>16,g>>16],u_pixel_coord_lower:[65535&U,65535&g]}}const dt=(C,c,d,_)=>{const w=c.style.light,T=w.properties.get("position"),U=[T.x,T.y,T.z],g=function(){var S=new o.A(9);return o.A!=Float32Array&&(S[1]=0,S[2]=0,S[3]=0,S[5]=0,S[6]=0,S[7]=0),S[0]=1,S[4]=1,S[8]=1,S}();w.properties.get("anchor")==="viewport"&&function(S,F){var M=Math.sin(F),N=Math.cos(F);S[0]=N,S[1]=M,S[2]=0,S[3]=-M,S[4]=N,S[5]=0,S[6]=0,S[7]=0,S[8]=1}(g,-c.transform.angle),function(S,F,M){var N=F[0],k=F[1],V=F[2];S[0]=N*M[0]+k*M[3]+V*M[6],S[1]=N*M[1]+k*M[4]+V*M[7],S[2]=N*M[2]+k*M[5]+V*M[8]}(U,U,g);const y=w.properties.get("color");return{u_matrix:C,u_lightpos:U,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_vertical_gradient:+d,u_opacity:_}},xt=(C,c,d,_,w,T,U)=>o.e(dt(C,c,d,_),Fl(T,c,U),{u_height_factor:-Math.pow(2,w.overscaledZ)/U.tileSize/8}),kt=C=>({u_matrix:C}),he=(C,c,d,_)=>o.e(kt(C),Fl(d,c,_)),Le=(C,c)=>({u_matrix:C,u_world:c}),Ze=(C,c,d,_,w)=>o.e(he(C,c,d,_),{u_world:w}),Qr=(C,c,d,_)=>{const w=C.transform;let T,U;if(_.paint.get("circle-pitch-alignment")==="map"){const g=_r(d,1,w.zoom);T=!0,U=[g,g]}else T=!1,U=w.pixelsToGLUnits;return{u_camera_to_center_distance:w.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:C.translatePosMatrix(c.posMatrix,d,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+T,u_device_pixel_ratio:C.pixelRatio,u_extrude_scale:U}},ei=(C,c,d)=>({u_matrix:C,u_inv_matrix:c,u_camera_to_center_distance:d.cameraToCenterDistance,u_viewport_size:[d.width,d.height]}),$n=function(C,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:C,u_color:c,u_overlay:0,u_overlay_scale:d}},xi=C=>({u_matrix:C}),vn=(C,c,d,_)=>({u_matrix:C,u_extrude_scale:_r(c,1,d),u_intensity:_});function au(C,c){const d=Math.pow(2,c.canonical.z),_=c.canonical.y;return[new o.Y(0,_/d).toLngLat().lat,new o.Y(0,(_+1)/d).toLngLat().lat]}const zi=(C,c,d,_)=>{const w=C.transform;return{u_matrix:cu(C,c,d,_),u_ratio:1/_r(c,1,w.zoom),u_device_pixel_ratio:C.pixelRatio,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},Ir=(C,c,d,_,w)=>o.e(zi(C,c,d,w),{u_image:0,u_image_height:_}),aA=(C,c,d,_,w)=>{const T=C.transform,U=wo(c,T);return{u_matrix:cu(C,c,d,w),u_texsize:c.imageAtlasTexture.size,u_ratio:1/_r(c,1,T.zoom),u_device_pixel_ratio:C.pixelRatio,u_image:0,u_scale:[U,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},lu=(C,c,d,_,w,T)=>{const U=C.lineAtlas,g=wo(c,C.transform),y=d.layout.get("line-cap")==="round",S=U.getDash(_.from,y),F=U.getDash(_.to,y),M=S.width*w.fromScale,N=F.width*w.toScale;return o.e(zi(C,c,d,T),{u_patternscale_a:[g/M,-S.height/2],u_patternscale_b:[g/N,-F.height/2],u_sdfgamma:U.width/(256*Math.min(M,N)*C.pixelRatio)/2,u_image:0,u_tex_y_a:S.y,u_tex_y_b:F.y,u_mix:w.t})};function wo(C,c){return 1/_r(C,1,c.tileZoom)}function cu(C,c,d,_){return C.translatePosMatrix(_?_.posMatrix:c.tileID.posMatrix,c,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const ja=(C,c,d,_,w)=>{return{u_matrix:C,u_tl_parent:c,u_scale_parent:d,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(U=w.paint.get("raster-saturation"),U>0?1-1/(1.001-U):-U),u_contrast_factor:(T=w.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:uu(w.paint.get("raster-hue-rotate"))};var T,U};function uu(C){C*=Math.PI/180;const c=Math.sin(C),d=Math.cos(C);return[(2*d+1)/3,(-Math.sqrt(3)*c-d+1)/3,(Math.sqrt(3)*c-d+1)/3]}const Au=(C,c,d,_,w,T,U,g,y,S,F,M,N,k)=>{const V=U.transform;return{u_is_size_zoom_constant:+(C==="constant"||C==="source"),u_is_size_feature_constant:+(C==="constant"||C==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:V.width/V.height,u_fade_change:U.options.fadeDuration?U.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:y,u_coord_matrix:S,u_is_text:+M,u_pitch_with_map:+_,u_is_along_line:w,u_is_variable_anchor:T,u_texsize:N,u_texture:0,u_translation:F,u_pitched_scale:k}},ch=(C,c,d,_,w,T,U,g,y,S,F,M,N,k,V)=>{const j=U.transform;return o.e(Au(C,c,d,_,w,T,U,g,y,S,F,M,N,V),{u_gamma_scale:_?Math.cos(j._pitch)*j.cameraToCenterDistance:1,u_device_pixel_ratio:U.pixelRatio,u_is_halo:+k})},xd=(C,c,d,_,w,T,U,g,y,S,F,M,N,k)=>o.e(ch(C,c,d,_,w,T,U,g,y,S,F,!0,M,!0,k),{u_texsize_icon:N,u_texture_icon:1}),Bd=(C,c,d)=>({u_matrix:C,u_opacity:c,u_color:d}),lA=(C,c,d,_,w,T)=>o.e(function(U,g,y,S){const F=y.imageManager.getPattern(U.from.toString()),M=y.imageManager.getPattern(U.to.toString()),{width:N,height:k}=y.imageManager.getPixelSize(),V=Math.pow(2,S.tileID.overscaledZ),j=S.tileSize*Math.pow(2,y.transform.tileZoom)/V,K=j*(S.tileID.canonical.x+S.tileID.wrap*V),tt=j*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[N,k],u_mix:g.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:g.fromScale,u_scale_b:g.toScale,u_tile_units_to_pixels:1/_r(S,1,y.transform.tileZoom),u_pixel_coord_upper:[K>>16,tt>>16],u_pixel_coord_lower:[65535&K,65535&tt]}}(_,T,d,w),{u_matrix:C,u_opacity:c}),ma={fillExtrusion:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_lightpos:new o.aL(C,c.u_lightpos),u_lightintensity:new o.aI(C,c.u_lightintensity),u_lightcolor:new o.aL(C,c.u_lightcolor),u_vertical_gradient:new o.aI(C,c.u_vertical_gradient),u_opacity:new o.aI(C,c.u_opacity)}),fillExtrusionPattern:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_lightpos:new o.aL(C,c.u_lightpos),u_lightintensity:new o.aI(C,c.u_lightintensity),u_lightcolor:new o.aL(C,c.u_lightcolor),u_vertical_gradient:new o.aI(C,c.u_vertical_gradient),u_height_factor:new o.aI(C,c.u_height_factor),u_image:new o.aH(C,c.u_image),u_texsize:new o.aM(C,c.u_texsize),u_pixel_coord_upper:new o.aM(C,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aM(C,c.u_pixel_coord_lower),u_scale:new o.aL(C,c.u_scale),u_fade:new o.aI(C,c.u_fade),u_opacity:new o.aI(C,c.u_opacity)}),fill:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix)}),fillPattern:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_image:new o.aH(C,c.u_image),u_texsize:new o.aM(C,c.u_texsize),u_pixel_coord_upper:new o.aM(C,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aM(C,c.u_pixel_coord_lower),u_scale:new o.aL(C,c.u_scale),u_fade:new o.aI(C,c.u_fade)}),fillOutline:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_world:new o.aM(C,c.u_world)}),fillOutlinePattern:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_world:new o.aM(C,c.u_world),u_image:new o.aH(C,c.u_image),u_texsize:new o.aM(C,c.u_texsize),u_pixel_coord_upper:new o.aM(C,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aM(C,c.u_pixel_coord_lower),u_scale:new o.aL(C,c.u_scale),u_fade:new o.aI(C,c.u_fade)}),circle:(C,c)=>({u_camera_to_center_distance:new o.aI(C,c.u_camera_to_center_distance),u_scale_with_map:new o.aH(C,c.u_scale_with_map),u_pitch_with_map:new o.aH(C,c.u_pitch_with_map),u_extrude_scale:new o.aM(C,c.u_extrude_scale),u_device_pixel_ratio:new o.aI(C,c.u_device_pixel_ratio),u_matrix:new o.aJ(C,c.u_matrix)}),collisionBox:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_pixel_extrude_scale:new o.aM(C,c.u_pixel_extrude_scale)}),collisionCircle:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_inv_matrix:new o.aJ(C,c.u_inv_matrix),u_camera_to_center_distance:new o.aI(C,c.u_camera_to_center_distance),u_viewport_size:new o.aM(C,c.u_viewport_size)}),debug:(C,c)=>({u_color:new o.aN(C,c.u_color),u_matrix:new o.aJ(C,c.u_matrix),u_overlay:new o.aH(C,c.u_overlay),u_overlay_scale:new o.aI(C,c.u_overlay_scale)}),clippingMask:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix)}),heatmap:(C,c)=>({u_extrude_scale:new o.aI(C,c.u_extrude_scale),u_intensity:new o.aI(C,c.u_intensity),u_matrix:new o.aJ(C,c.u_matrix)}),heatmapTexture:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_world:new o.aM(C,c.u_world),u_image:new o.aH(C,c.u_image),u_color_ramp:new o.aH(C,c.u_color_ramp),u_opacity:new o.aI(C,c.u_opacity)}),hillshade:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_image:new o.aH(C,c.u_image),u_latrange:new o.aM(C,c.u_latrange),u_light:new o.aM(C,c.u_light),u_shadow:new o.aN(C,c.u_shadow),u_highlight:new o.aN(C,c.u_highlight),u_accent:new o.aN(C,c.u_accent)}),hillshadePrepare:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_image:new o.aH(C,c.u_image),u_dimension:new o.aM(C,c.u_dimension),u_zoom:new o.aI(C,c.u_zoom),u_unpack:new o.aK(C,c.u_unpack)}),line:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_ratio:new o.aI(C,c.u_ratio),u_device_pixel_ratio:new o.aI(C,c.u_device_pixel_ratio),u_units_to_pixels:new o.aM(C,c.u_units_to_pixels)}),lineGradient:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_ratio:new o.aI(C,c.u_ratio),u_device_pixel_ratio:new o.aI(C,c.u_device_pixel_ratio),u_units_to_pixels:new o.aM(C,c.u_units_to_pixels),u_image:new o.aH(C,c.u_image),u_image_height:new o.aI(C,c.u_image_height)}),linePattern:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_texsize:new o.aM(C,c.u_texsize),u_ratio:new o.aI(C,c.u_ratio),u_device_pixel_ratio:new o.aI(C,c.u_device_pixel_ratio),u_image:new o.aH(C,c.u_image),u_units_to_pixels:new o.aM(C,c.u_units_to_pixels),u_scale:new o.aL(C,c.u_scale),u_fade:new o.aI(C,c.u_fade)}),lineSDF:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_ratio:new o.aI(C,c.u_ratio),u_device_pixel_ratio:new o.aI(C,c.u_device_pixel_ratio),u_units_to_pixels:new o.aM(C,c.u_units_to_pixels),u_patternscale_a:new o.aM(C,c.u_patternscale_a),u_patternscale_b:new o.aM(C,c.u_patternscale_b),u_sdfgamma:new o.aI(C,c.u_sdfgamma),u_image:new o.aH(C,c.u_image),u_tex_y_a:new o.aI(C,c.u_tex_y_a),u_tex_y_b:new o.aI(C,c.u_tex_y_b),u_mix:new o.aI(C,c.u_mix)}),raster:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_tl_parent:new o.aM(C,c.u_tl_parent),u_scale_parent:new o.aI(C,c.u_scale_parent),u_buffer_scale:new o.aI(C,c.u_buffer_scale),u_fade_t:new o.aI(C,c.u_fade_t),u_opacity:new o.aI(C,c.u_opacity),u_image0:new o.aH(C,c.u_image0),u_image1:new o.aH(C,c.u_image1),u_brightness_low:new o.aI(C,c.u_brightness_low),u_brightness_high:new o.aI(C,c.u_brightness_high),u_saturation_factor:new o.aI(C,c.u_saturation_factor),u_contrast_factor:new o.aI(C,c.u_contrast_factor),u_spin_weights:new o.aL(C,c.u_spin_weights)}),symbolIcon:(C,c)=>({u_is_size_zoom_constant:new o.aH(C,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(C,c.u_is_size_feature_constant),u_size_t:new o.aI(C,c.u_size_t),u_size:new o.aI(C,c.u_size),u_camera_to_center_distance:new o.aI(C,c.u_camera_to_center_distance),u_pitch:new o.aI(C,c.u_pitch),u_rotate_symbol:new o.aH(C,c.u_rotate_symbol),u_aspect_ratio:new o.aI(C,c.u_aspect_ratio),u_fade_change:new o.aI(C,c.u_fade_change),u_matrix:new o.aJ(C,c.u_matrix),u_label_plane_matrix:new o.aJ(C,c.u_label_plane_matrix),u_coord_matrix:new o.aJ(C,c.u_coord_matrix),u_is_text:new o.aH(C,c.u_is_text),u_pitch_with_map:new o.aH(C,c.u_pitch_with_map),u_is_along_line:new o.aH(C,c.u_is_along_line),u_is_variable_anchor:new o.aH(C,c.u_is_variable_anchor),u_texsize:new o.aM(C,c.u_texsize),u_texture:new o.aH(C,c.u_texture),u_translation:new o.aM(C,c.u_translation),u_pitched_scale:new o.aI(C,c.u_pitched_scale)}),symbolSDF:(C,c)=>({u_is_size_zoom_constant:new o.aH(C,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(C,c.u_is_size_feature_constant),u_size_t:new o.aI(C,c.u_size_t),u_size:new o.aI(C,c.u_size),u_camera_to_center_distance:new o.aI(C,c.u_camera_to_center_distance),u_pitch:new o.aI(C,c.u_pitch),u_rotate_symbol:new o.aH(C,c.u_rotate_symbol),u_aspect_ratio:new o.aI(C,c.u_aspect_ratio),u_fade_change:new o.aI(C,c.u_fade_change),u_matrix:new o.aJ(C,c.u_matrix),u_label_plane_matrix:new o.aJ(C,c.u_label_plane_matrix),u_coord_matrix:new o.aJ(C,c.u_coord_matrix),u_is_text:new o.aH(C,c.u_is_text),u_pitch_with_map:new o.aH(C,c.u_pitch_with_map),u_is_along_line:new o.aH(C,c.u_is_along_line),u_is_variable_anchor:new o.aH(C,c.u_is_variable_anchor),u_texsize:new o.aM(C,c.u_texsize),u_texture:new o.aH(C,c.u_texture),u_gamma_scale:new o.aI(C,c.u_gamma_scale),u_device_pixel_ratio:new o.aI(C,c.u_device_pixel_ratio),u_is_halo:new o.aH(C,c.u_is_halo),u_translation:new o.aM(C,c.u_translation),u_pitched_scale:new o.aI(C,c.u_pitched_scale)}),symbolTextAndIcon:(C,c)=>({u_is_size_zoom_constant:new o.aH(C,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(C,c.u_is_size_feature_constant),u_size_t:new o.aI(C,c.u_size_t),u_size:new o.aI(C,c.u_size),u_camera_to_center_distance:new o.aI(C,c.u_camera_to_center_distance),u_pitch:new o.aI(C,c.u_pitch),u_rotate_symbol:new o.aH(C,c.u_rotate_symbol),u_aspect_ratio:new o.aI(C,c.u_aspect_ratio),u_fade_change:new o.aI(C,c.u_fade_change),u_matrix:new o.aJ(C,c.u_matrix),u_label_plane_matrix:new o.aJ(C,c.u_label_plane_matrix),u_coord_matrix:new o.aJ(C,c.u_coord_matrix),u_is_text:new o.aH(C,c.u_is_text),u_pitch_with_map:new o.aH(C,c.u_pitch_with_map),u_is_along_line:new o.aH(C,c.u_is_along_line),u_is_variable_anchor:new o.aH(C,c.u_is_variable_anchor),u_texsize:new o.aM(C,c.u_texsize),u_texsize_icon:new o.aM(C,c.u_texsize_icon),u_texture:new o.aH(C,c.u_texture),u_texture_icon:new o.aH(C,c.u_texture_icon),u_gamma_scale:new o.aI(C,c.u_gamma_scale),u_device_pixel_ratio:new o.aI(C,c.u_device_pixel_ratio),u_is_halo:new o.aH(C,c.u_is_halo),u_translation:new o.aM(C,c.u_translation),u_pitched_scale:new o.aI(C,c.u_pitched_scale)}),background:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_opacity:new o.aI(C,c.u_opacity),u_color:new o.aN(C,c.u_color)}),backgroundPattern:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_opacity:new o.aI(C,c.u_opacity),u_image:new o.aH(C,c.u_image),u_pattern_tl_a:new o.aM(C,c.u_pattern_tl_a),u_pattern_br_a:new o.aM(C,c.u_pattern_br_a),u_pattern_tl_b:new o.aM(C,c.u_pattern_tl_b),u_pattern_br_b:new o.aM(C,c.u_pattern_br_b),u_texsize:new o.aM(C,c.u_texsize),u_mix:new o.aI(C,c.u_mix),u_pattern_size_a:new o.aM(C,c.u_pattern_size_a),u_pattern_size_b:new o.aM(C,c.u_pattern_size_b),u_scale_a:new o.aI(C,c.u_scale_a),u_scale_b:new o.aI(C,c.u_scale_b),u_pixel_coord_upper:new o.aM(C,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aM(C,c.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aI(C,c.u_tile_units_to_pixels)}),terrain:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_texture:new o.aH(C,c.u_texture),u_ele_delta:new o.aI(C,c.u_ele_delta)}),terrainDepth:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_ele_delta:new o.aI(C,c.u_ele_delta)}),terrainCoords:(C,c)=>({u_matrix:new o.aJ(C,c.u_matrix),u_texture:new o.aH(C,c.u_texture),u_terrain_coords_id:new o.aI(C,c.u_terrain_coords_id),u_ele_delta:new o.aI(C,c.u_ele_delta)})};class ya{constructor(c,d,_){this.context=c;const w=c.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qa{constructor(c,d,_,w){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=w,this.context=c;const T=c.gl;this.buffer=T.createBuffer(),c.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){if(c.length!==this.length)throw new Error(`Length of new data is ${c.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,d){for(let _=0;_<this.attributes.length;_++){const w=d.attributes[this.attributes[_].name];w!==void 0&&c.enableVertexAttribArray(w)}}setVertexAttribPointers(c,d,_){for(let w=0;w<this.attributes.length;w++){const T=this.attributes[w],U=d.attributes[T.name];U!==void 0&&c.vertexAttribPointer(U,T.components,c[hu[T.type]],!1,this.itemSize,T.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ka=new WeakMap;function Vi(C){var c;if(Ka.has(C))return Ka.get(C);{const d=(c=C.getParameter(C.VERSION))===null||c===void 0?void 0:c.startsWith("WebGL 2.0");return Ka.set(C,d),d}}class yn{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class du extends yn{getDefault(){return o.aP.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Ll extends yn{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Pl extends yn{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Wa extends yn{getDefault(){return[!0,!0,!0,!0]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Ko extends yn{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Cd extends yn{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Zs extends yn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Wo extends yn{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class fu extends yn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}}class Cc extends yn{getDefault(){return[0,1]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class uh extends yn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}}class Ml extends yn{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Ah extends yn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}}class pu extends yn{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class gu extends yn{getDefault(){return o.aP.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class cA extends yn{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class xo extends yn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}}class mu extends yn{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class uA extends yn{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class hh extends yn{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class dh extends yn{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class _a extends yn{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Ec extends yn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Ul extends yn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Rl extends yn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class AA extends yn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class D extends yn{getDefault(){return null}set(c){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class nt extends yn{getDefault(){return null}set(c){var d;if(c===this.current&&!this.dirty)return;const _=this.gl;Vi(_)?_.bindVertexArray(c):(d=_.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(c),this.current=c,this.dirty=!1}}class Ut extends yn{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Vt extends yn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class se extends yn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class me extends yn{constructor(c,d){super(c),this.context=c,this.parent=d}getDefault(){return null}}class Pe extends me{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class rr extends me{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Pr extends me{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class qr{constructor(c,d,_,w,T){this.context=c,this.width=d,this.height=_;const U=c.gl,g=this.framebuffer=U.createFramebuffer();if(this.colorAttachment=new Pe(c,g),w)this.depthAttachment=T?new Pr(c,g):new rr(c,g);else if(T)throw new Error("Stencil cannot be set without depth");if(U.checkFramebufferStatus(U.FRAMEBUFFER)!==U.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const c=this.context.gl,d=this.colorAttachment.get();if(d&&c.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&c.deleteRenderbuffer(_)}c.deleteFramebuffer(this.framebuffer)}}class Br{constructor(c,d,_){this.blendFunction=c,this.blendColor=d,this.mask=_}}Br.Replace=[1,0],Br.disabled=new Br(Br.Replace,o.aP.transparent,[!1,!1,!1,!1]),Br.unblended=new Br(Br.Replace,o.aP.transparent,[!0,!0,!0,!0]),Br.alphaBlended=new Br([1,771],o.aP.transparent,[!0,!0,!0,!0]);class dn{constructor(c){var d,_;if(this.gl=c,this.clearColor=new du(this),this.clearDepth=new Ll(this),this.clearStencil=new Pl(this),this.colorMask=new Wa(this),this.depthMask=new Ko(this),this.stencilMask=new Cd(this),this.stencilFunc=new Zs(this),this.stencilOp=new Wo(this),this.stencilTest=new fu(this),this.depthRange=new Cc(this),this.depthTest=new uh(this),this.depthFunc=new Ml(this),this.blend=new Ah(this),this.blendFunc=new pu(this),this.blendColor=new gu(this),this.blendEquation=new cA(this),this.cullFace=new xo(this),this.cullFaceSide=new mu(this),this.frontFace=new uA(this),this.program=new hh(this),this.activeTexture=new dh(this),this.viewport=new _a(this),this.bindFramebuffer=new Ec(this),this.bindRenderbuffer=new Ul(this),this.bindTexture=new Rl(this),this.bindVertexBuffer=new AA(this),this.bindElementBuffer=new D(this),this.bindVertexArray=new nt(this),this.pixelStoreUnpack=new Ut(this),this.pixelStoreUnpackPremultiplyAlpha=new Vt(this),this.pixelStoreUnpackFlipY=new se(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),Vi(c)){this.HALF_FLOAT=c.HALF_FLOAT;const w=c.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=c.RGBA16F)!==null&&d!==void 0?d:w==null?void 0:w.RGBA16F_EXT,this.RGB16F=(_=c.RGB16F)!==null&&_!==void 0?_:w==null?void 0:w.RGB16F_EXT,c.getExtension("EXT_color_buffer_float")}else{c.getExtension("EXT_color_buffer_half_float"),c.getExtension("OES_texture_half_float_linear");const w=c.getExtension("OES_texture_half_float");this.HALF_FLOAT=w==null?void 0:w.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,d){return new ya(this,c,d)}createVertexBuffer(c,d,_){return new qa(this,c,d,_)}createRenderbuffer(c,d,_){const w=this.gl,T=w.createRenderbuffer();return this.bindRenderbuffer.set(T),w.renderbufferStorage(w.RENDERBUFFER,c,d,_),this.bindRenderbuffer.set(null),T}createFramebuffer(c,d,_,w){return new qr(this,c,d,_,w)}clear(c){let{color:d,depth:_,stencil:w}=c;const T=this.gl;let U=0;d&&(U|=T.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),_!==void 0&&(U|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_),this.depthMask.set(!0)),w!==void 0&&(U|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(w),this.stencilMask.set(255)),T.clear(U)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){o.aE(c.blendFunction,Br.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}createVertexArray(){var c;return Vi(this.gl)?this.gl.createVertexArray():(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.createVertexArrayOES()}deleteVertexArray(c){var d;return Vi(this.gl)?this.gl.deleteVertexArray(c):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(c)}unbindVAO(){this.bindVertexArray.set(null)}}class gr{constructor(c,d,_){this.func=c,this.mask=d,this.range=_}}gr.ReadOnly=!1,gr.ReadWrite=!0,gr.disabled=new gr(519,gr.ReadOnly,[0,1]);const ri=7680;class Yr{constructor(c,d,_,w,T,U){this.test=c,this.ref=d,this.mask=_,this.fail=w,this.depthFail=T,this.pass=U}}Yr.disabled=new Yr({func:519,mask:0},0,0,ri,ri,ri);class en{constructor(c,d,_){this.enable=c,this.mode=d,this.frontFace=_}}let Bi;function Bo(C,c,d,_,w){const T=C.context,U=T.gl,g=C.useProgram("collisionBox"),y=[];let S=0,F=0;for(let tt=0;tt<_.length;tt++){const ht=_[tt],rt=c.getTile(ht).getBucket(d);if(!rt)continue;const At=w?rt.textCollisionBox:rt.iconCollisionBox,St=rt.collisionCircleArray;if(St.length>0){const Ct=o.F();o.aQ(Ct,rt.placementInvProjMatrix,C.transform.glCoordMatrix),o.aQ(Ct,Ct,rt.placementViewportMatrix),y.push({circleArray:St,circleOffset:F,transform:ht.posMatrix,invTransform:Ct,coord:ht}),S+=St.length/4,F=S}At&&g.draw(T,U.LINES,gr.disabled,Yr.disabled,C.colorModeForRenderPass(),en.disabled,{u_matrix:ht.posMatrix,u_pixel_extrude_scale:[1/(M=C.transform).width,1/M.height]},C.style.map.terrain&&C.style.map.terrain.getTerrainData(ht),d.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,null,C.transform.zoom,null,null,At.collisionVertexBuffer)}var M;if(!w||!y.length)return;const N=C.useProgram("collisionCircle"),k=new o.aR;k.resize(4*S),k._trim();let V=0;for(const tt of y)for(let ht=0;ht<tt.circleArray.length/4;ht++){const rt=4*ht,At=tt.circleArray[rt+0],St=tt.circleArray[rt+1],Ct=tt.circleArray[rt+2],yt=tt.circleArray[rt+3];k.emplace(V++,At,St,Ct,yt,0),k.emplace(V++,At,St,Ct,yt,1),k.emplace(V++,At,St,Ct,yt,2),k.emplace(V++,At,St,Ct,yt,3)}(!Bi||Bi.length<2*S)&&(Bi=function(tt){const ht=2*tt,rt=new o.aT;rt.resize(ht),rt._trim();for(let At=0;At<ht;At++){const St=6*At;rt.uint16[St+0]=4*At+0,rt.uint16[St+1]=4*At+1,rt.uint16[St+2]=4*At+2,rt.uint16[St+3]=4*At+2,rt.uint16[St+4]=4*At+3,rt.uint16[St+5]=4*At+0}return rt}(S));const j=T.createIndexBuffer(Bi,!0),K=T.createVertexBuffer(k,o.aS.members,!0);for(const tt of y){const ht=ei(tt.transform,tt.invTransform,C.transform);N.draw(T,U.TRIANGLES,gr.disabled,Yr.disabled,C.colorModeForRenderPass(),en.disabled,ht,C.style.map.terrain&&C.style.map.terrain.getTerrainData(tt.coord),d.id,K,j,o.$.simpleSegment(0,2*tt.circleOffset,tt.circleArray.length,tt.circleArray.length/2),null,C.transform.zoom,null,null,null)}K.destroy(),j.destroy()}en.disabled=new en(!1,1029,2305),en.backCCW=new en(!0,1029,2305);const Ds=o.an(new Float32Array(16));function $a(C,c,d,_,w,T){const{horizontalAlign:U,verticalAlign:g}=o.au(C);return new o.P((-(U-.5)*c/w+_[0])*T,(-(g-.5)*d/w+_[1])*T)}function hA(C,c,d,_,w,T){const U=c.tileAnchorPoint.add(new o.P(c.translation[0],c.translation[1]));if(c.pitchWithMap){let g=_.mult(T);return d||(g=g.rotate(-w)),Jr(U.add(g),c.labelPlaneMatrix,c.getElevation).point}if(d){const g=Tt(c.tileAnchorPoint.x+1,c.tileAnchorPoint.y,c).point.sub(C),y=Math.atan(g.y/g.x)+(g.x<0?Math.PI:0);return C.add(_.rotate(y))}return C.add(_)}function Ol(C,c,d,_,w,T,U,g,y,S,F,M,N,k){const V=C.text.placedSymbolArray,j=C.text.dynamicLayoutVertexArray,K=C.icon.dynamicLayoutVertexArray,tt={};j.clear();for(let ht=0;ht<V.length;ht++){const rt=V.get(ht),At=rt.hidden||!rt.crossTileID||C.allowVerticalPlacement&&!rt.placedOrientation?null:_[rt.crossTileID];if(At){const St=new o.P(rt.anchorX,rt.anchorY),Ct={getElevation:k,width:w.width,height:w.height,labelPlaneMatrix:T,lineVertexArray:null,pitchWithMap:d,projection:F,projectionCache:null,tileAnchorPoint:St,translation:M,unwrappedTileID:N},yt=d?Jr(St,U,k):Tt(St.x,St.y,Ct),Et=Bt(w.cameraToCenterDistance,yt.signedDistanceFromCamera);let Wt=o.ai(C.textSizeData,y,rt)*Et/o.ap;d&&(Wt*=C.tilePixelRatio/g);const{width:Zt,height:zt,anchor:ae,textOffset:de,textBoxScale:Me}=At,le=$a(ae,Zt,zt,de,Me,Wt),Ee=F.getPitchedTextCorrection(w,St.add(new o.P(M[0],M[1])),N),$e=hA(yt.point,Ct,c,le,w.angle,Ee),Tr=C.allowVerticalPlacement&&rt.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let Je=0;Je<rt.numGlyphs;Je++)o.aj(j,$e,Tr);S&&rt.associatedIconIndex>=0&&(tt[rt.associatedIconIndex]={shiftedAnchor:$e,angle:Tr})}else ze(rt.numGlyphs,j)}if(S){K.clear();const ht=C.icon.placedSymbolArray;for(let rt=0;rt<ht.length;rt++){const At=ht.get(rt);if(At.hidden)ze(At.numGlyphs,K);else{const St=tt[rt];if(St)for(let Ct=0;Ct<At.numGlyphs;Ct++)o.aj(K,St.shiftedAnchor,St.angle);else ze(At.numGlyphs,K)}}C.icon.dynamicLayoutVertexBuffer.updateData(K)}C.text.dynamicLayoutVertexBuffer.updateData(j)}function Dl(C,c,d){return d.iconsInText&&c?"symbolTextAndIcon":C?"symbolSDF":"symbolIcon"}function va(C,c,d,_,w,T,U,g,y,S,F,M){const N=C.context,k=N.gl,V=C.transform,j=mn(),K=g==="map",tt=y==="map",ht=g!=="viewport"&&d.layout.get("symbol-placement")!=="point",rt=K&&!tt&&!ht,At=!tt&&ht,St=!d.layout.get("symbol-sort-key").isConstant();let Ct=!1;const yt=C.depthModeForSublayer(0,gr.ReadOnly),Et=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Wt=[],Zt=j.getCircleRadiusCorrection(V);for(const zt of _){const ae=c.getTile(zt),de=ae.getBucket(d);if(!de)continue;const Me=w?de.text:de.icon;if(!Me||!Me.segments.get().length||!Me.hasVisibleVertices)continue;const le=Me.programConfigurations.get(d.id),Ee=w||de.sdfIcons,$e=w?de.textSizeData:de.iconSizeData,Tr=tt||V.pitch!==0,Je=C.useProgram(Dl(Ee,w,de),le),mr=o.ag($e,V.zoom),Dr=C.style.map.terrain&&C.style.map.terrain.getTerrainData(zt);let Lr,Sn,ln,bn,Dn=[0,0],Xr=null;if(w)Sn=ae.glyphAtlasTexture,ln=k.LINEAR,Lr=ae.glyphAtlasTexture.size,de.iconsInText&&(Dn=ae.imageAtlasTexture.size,Xr=ae.imageAtlasTexture,bn=Tr||C.options.rotating||C.options.zooming||$e.kind==="composite"||$e.kind==="camera"?k.LINEAR:k.NEAREST);else{const ii=d.layout.get("icon-size").constantOr(0)!==1||de.iconsNeedLinear;Sn=ae.imageAtlasTexture,ln=Ee||C.options.rotating||C.options.zooming||ii||Tr?k.LINEAR:k.NEAREST,Lr=ae.imageAtlasTexture.size}const Nn=_r(ae,1,C.transform.zoom),di=At?zt.posMatrix:Ds,ci=Kn(di,tt,K,C.transform,Nn),Ti=sn(di,tt,K,C.transform,Nn),Ii=sn(zt.posMatrix,tt,K,C.transform,Nn),qi=j.translatePosition(C.transform,ae,T,U),no=Et&&de.hasTextData(),Fi=d.layout.get("icon-text-fit")!=="none"&&no&&de.hasIconData();if(ht){const ii=C.style.map.terrain?(Uc,yi)=>C.style.map.terrain.getElevation(zt,Uc,yi):null,il=d.layout.get("text-rotation-alignment")==="map";J(de,zt.posMatrix,C,w,ci,Ii,tt,S,il,j,zt.toUnwrapped(),V.width,V.height,qi,ii)}const ni=zt.posMatrix,cs=w&&Et||Fi,io=ht||cs?Ds:ci,so=Ti,An=Ee&&d.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ki;Ki=Ee?de.iconsInText?xd($e.kind,mr,rt,tt,ht,cs,C,ni,io,so,qi,Lr,Dn,Zt):ch($e.kind,mr,rt,tt,ht,cs,C,ni,io,so,qi,w,Lr,!0,Zt):Au($e.kind,mr,rt,tt,ht,cs,C,ni,io,so,qi,w,Lr,Zt);const Ui={program:Je,buffers:Me,uniformValues:Ki,atlasTexture:Sn,atlasTextureIcon:Xr,atlasInterpolation:ln,atlasInterpolationIcon:bn,isSDF:Ee,hasHalo:An};if(St&&de.canOverlap){Ct=!0;const ii=Me.segments.get();for(const il of ii)Wt.push({segments:new o.$([il]),sortKey:il.sortKey,state:Ui,terrainData:Dr})}else Wt.push({segments:Me.segments,sortKey:0,state:Ui,terrainData:Dr})}Ct&&Wt.sort((zt,ae)=>zt.sortKey-ae.sortKey);for(const zt of Wt){const ae=zt.state;if(N.activeTexture.set(k.TEXTURE0),ae.atlasTexture.bind(ae.atlasInterpolation,k.CLAMP_TO_EDGE),ae.atlasTextureIcon&&(N.activeTexture.set(k.TEXTURE1),ae.atlasTextureIcon&&ae.atlasTextureIcon.bind(ae.atlasInterpolationIcon,k.CLAMP_TO_EDGE)),ae.isSDF){const de=ae.uniformValues;ae.hasHalo&&(de.u_is_halo=1,Nl(ae.buffers,zt.segments,d,C,ae.program,yt,F,M,de,zt.terrainData)),de.u_is_halo=0}Nl(ae.buffers,zt.segments,d,C,ae.program,yt,F,M,ae.uniformValues,zt.terrainData)}}function Nl(C,c,d,_,w,T,U,g,y,S){const F=_.context;w.draw(F,F.gl.TRIANGLES,T,U,g,en.disabled,y,S,d.id,C.layoutVertexBuffer,C.indexBuffer,c,d.paint,_.transform.zoom,C.programConfigurations.get(d.id),C.dynamicLayoutVertexBuffer,C.opacityVertexBuffer)}function Co(C,c,d,_,w){if(!d||!_||!_.imageAtlas)return;const T=_.imageAtlas.patternPositions;let U=T[d.to.toString()],g=T[d.from.toString()];if(!U&&g&&(U=g),!g&&U&&(g=U),!U||!g){const y=w.getPaintProperty(c);U=T[y],g=T[y]}U&&g&&C.setConstantPatternPositions(U,g)}function Eo(C,c,d,_,w,T,U){const g=C.context.gl,y="fill-pattern",S=d.paint.get(y),F=S&&S.constantOr(1),M=d.getCrossfadeParameters();let N,k,V,j,K;U?(k=F&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=g.LINES):(k=F?"fillPattern":"fill",N=g.TRIANGLES);const tt=S.constantOr(null);for(const ht of _){const rt=c.getTile(ht);if(F&&!rt.patternsLoaded())continue;const At=rt.getBucket(d);if(!At)continue;const St=At.programConfigurations.get(d.id),Ct=C.useProgram(k,St),yt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(ht);F&&(C.context.activeTexture.set(g.TEXTURE0),rt.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),St.updatePaintBuffers(M)),Co(St,y,tt,rt,d);const Et=yt?ht:null,Wt=C.translatePosMatrix(Et?Et.posMatrix:ht.posMatrix,rt,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(U){j=At.indexBuffer2,K=At.segments2;const Zt=[g.drawingBufferWidth,g.drawingBufferHeight];V=k==="fillOutlinePattern"&&F?Ze(Wt,C,M,rt,Zt):Le(Wt,Zt)}else j=At.indexBuffer,K=At.segments,V=F?he(Wt,C,M,rt):kt(Wt);Ct.draw(C.context,N,w,C.stencilModeForClipping(ht),T,en.disabled,V,yt,d.id,At.layoutVertexBuffer,j,K,d.paint,C.transform.zoom,St)}}function Hn(C,c,d,_,w,T,U){const g=C.context,y=g.gl,S="fill-extrusion-pattern",F=d.paint.get(S),M=F.constantOr(1),N=d.getCrossfadeParameters(),k=d.paint.get("fill-extrusion-opacity"),V=F.constantOr(null);for(const j of _){const K=c.getTile(j),tt=K.getBucket(d);if(!tt)continue;const ht=C.style.map.terrain&&C.style.map.terrain.getTerrainData(j),rt=tt.programConfigurations.get(d.id),At=C.useProgram(M?"fillExtrusionPattern":"fillExtrusion",rt);M&&(C.context.activeTexture.set(y.TEXTURE0),K.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),rt.updatePaintBuffers(N)),Co(rt,S,V,K,d);const St=C.translatePosMatrix(j.posMatrix,K,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Ct=d.paint.get("fill-extrusion-vertical-gradient"),yt=M?xt(St,C,Ct,k,j,N,K):dt(St,C,Ct,k);At.draw(g,g.gl.TRIANGLES,w,T,U,en.backCCW,yt,ht,d.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,d.paint,C.transform.zoom,rt,C.style.map.terrain&&tt.centroidVertexBuffer)}}function Sc(C,c,d,_,w,T,U){const g=C.context,y=g.gl,S=d.fbo;if(!S)return;const F=C.useProgram("hillshade"),M=C.style.map.terrain&&C.style.map.terrain.getTerrainData(c);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,S.colorAttachment.get()),F.draw(g,y.TRIANGLES,w,T,U,en.disabled,((N,k,V,j)=>{const K=V.paint.get("hillshade-shadow-color"),tt=V.paint.get("hillshade-highlight-color"),ht=V.paint.get("hillshade-accent-color");let rt=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(rt-=N.transform.angle);const At=!N.options.moving;return{u_matrix:j?j.posMatrix:N.transform.calculatePosMatrix(k.tileID.toUnwrapped(),At),u_image:0,u_latrange:au(0,k.tileID),u_light:[V.paint.get("hillshade-exaggeration"),rt],u_shadow:K,u_highlight:tt,u_accent:ht}})(C,d,_,M?c:null),M,_.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments)}function Tc(C,c,d,_,w,T){const U=C.context,g=U.gl,y=c.dem;if(y&&y.data){const S=y.dim,F=y.stride,M=y.getPixels();if(U.activeTexture.set(g.TEXTURE1),U.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||C.getTileTexture(F),c.demTexture){const k=c.demTexture;k.update(M,{premultiply:!1}),k.bind(g.NEAREST,g.CLAMP_TO_EDGE)}else c.demTexture=new at(U,M,g.RGBA,{premultiply:!1}),c.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);U.activeTexture.set(g.TEXTURE0);let N=c.fbo;if(!N){const k=new at(U,{width:S,height:S,data:null},g.RGBA);k.bind(g.LINEAR,g.CLAMP_TO_EDGE),N=c.fbo=U.createFramebuffer(S,S,!0,!1),N.colorAttachment.set(k.texture)}U.bindFramebuffer.set(N.framebuffer),U.viewport.set([0,0,S,S]),C.useProgram("hillshadePrepare").draw(U,g.TRIANGLES,_,w,T,en.disabled,((k,V)=>{const j=V.stride,K=o.F();return o.aO(K,0,o.W,-o.W,0,0,1),o.H(K,K,[0,-o.W,0]),{u_matrix:K,u_image:1,u_dimension:[j,j],u_zoom:k.overscaledZ,u_unpack:V.getUnpackVector()}})(c.tileID,y),null,d.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments),c.needsHillshadePrepare=!1}}function kl(C,c,d,_,w,T){const U=_.paint.get("raster-fade-duration");if(!T&&U>0){const g=b.now(),y=(g-C.timeAdded)/U,S=c?(g-c.timeAdded)/U:-1,F=d.getSource(),M=w.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),N=!c||Math.abs(c.tileID.overscaledZ-M)>Math.abs(C.tileID.overscaledZ-M),k=N&&C.refreshedUponExpiration?1:o.ac(N?y:1-S,0,1);return C.refreshedUponExpiration&&y>=1&&(C.refreshedUponExpiration=!1),c?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}const $o=new o.aP(1,0,0,1),ls=new o.aP(0,1,0,1),yu=new o.aP(0,0,1,1),Xa=new o.aP(1,0,1,1),Ic=new o.aP(0,1,1,1);function to(C,c,d,_){Jo(C,0,c+d/2,C.transform.width,d,_)}function Xo(C,c,d,_){Jo(C,c-d/2,0,d,C.transform.height,_)}function Jo(C,c,d,_,w,T){const U=C.context,g=U.gl;g.enable(g.SCISSOR_TEST),g.scissor(c*C.pixelRatio,d*C.pixelRatio,_*C.pixelRatio,w*C.pixelRatio),U.clear({color:T}),g.disable(g.SCISSOR_TEST)}function fh(C,c,d){const _=C.context,w=_.gl,T=d.posMatrix,U=C.useProgram("debug"),g=gr.disabled,y=Yr.disabled,S=C.colorModeForRenderPass(),F="$debug",M=C.style.map.terrain&&C.style.map.terrain.getTerrainData(d);_.activeTexture.set(w.TEXTURE0);const N=c.getTileByID(d.key).latestRawTileData,k=Math.floor((N&&N.byteLength||0)/1024),V=c.getTile(d).tileSize,j=512/Math.min(V,512)*(d.overscaledZ/C.transform.zoom)*.5;let K=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(K+=` => ${d.overscaledZ}`),function(tt,ht){tt.initDebugOverlayCanvas();const rt=tt.debugOverlayCanvas,At=tt.context.gl,St=tt.debugOverlayCanvas.getContext("2d");St.clearRect(0,0,rt.width,rt.height),St.shadowColor="white",St.shadowBlur=2,St.lineWidth=1.5,St.strokeStyle="white",St.textBaseline="top",St.font="bold 36px Open Sans, sans-serif",St.fillText(ht,5,5),St.strokeText(ht,5,5),tt.debugOverlayTexture.update(rt),tt.debugOverlayTexture.bind(At.LINEAR,At.CLAMP_TO_EDGE)}(C,`${K} ${k}kB`),U.draw(_,w.TRIANGLES,g,y,Br.alphaBlended,en.disabled,$n(T,o.aP.transparent,j),null,F,C.debugBuffer,C.quadTriangleIndexBuffer,C.debugSegments),U.draw(_,w.LINE_STRIP,g,y,S,en.disabled,$n(T,o.aP.red),M,F,C.debugBuffer,C.tileBorderIndexBuffer,C.debugSegments)}function Yo(C,c,d){const _=C.context,w=_.gl,T=C.colorModeForRenderPass(),U=new gr(w.LEQUAL,gr.ReadWrite,C.depthRangeFor3D),g=C.useProgram("terrain"),y=c.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,C.width,C.height]);for(const S of d){const F=C.renderToTexture.getTexture(S),M=c.getTerrainData(S.tileID);_.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,F.texture);const N={u_matrix:C.transform.calculatePosMatrix(S.tileID.toUnwrapped()),u_texture:0,u_ele_delta:c.getMeshFrameDelta(C.transform.zoom)};g.draw(_,w.TRIANGLES,U,Yr.disabled,T,en.backCCW,N,M,"terrain",y.vertexBuffer,y.indexBuffer,y.segments)}}class $r{constructor(c,d){this.context=new dn(c),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ge.maxUnderzooming+ge.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ln}resize(c,d,_){if(this.width=Math.floor(c*_),this.height=Math.floor(d*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style._order)this.style._layers[w].resize()}setup(){const c=this.context,d=new o.aW;d.emplaceBack(0,0),d.emplaceBack(o.W,0),d.emplaceBack(0,o.W),d.emplaceBack(o.W,o.W),this.tileExtentBuffer=c.createVertexBuffer(d,ti.members),this.tileExtentSegments=o.$.simpleSegment(0,0,4,2);const _=new o.aW;_.emplaceBack(0,0),_.emplaceBack(o.W,0),_.emplaceBack(0,o.W),_.emplaceBack(o.W,o.W),this.debugBuffer=c.createVertexBuffer(_,ti.members),this.debugSegments=o.$.simpleSegment(0,0,4,5);const w=new o.Z;w.emplaceBack(0,0,0,0),w.emplaceBack(o.W,0,o.W,0),w.emplaceBack(0,o.W,0,o.W),w.emplaceBack(o.W,o.W,o.W,o.W),this.rasterBoundsBuffer=c.createVertexBuffer(w,we.members),this.rasterBoundsSegments=o.$.simpleSegment(0,0,4,2);const T=new o.aW;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(T,ti.members),this.viewportSegments=o.$.simpleSegment(0,0,4,2);const U=new o.aX;U.emplaceBack(0),U.emplaceBack(1),U.emplaceBack(3),U.emplaceBack(2),U.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(U);const g=new o.aY;g.emplaceBack(0,1,2),g.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(g);const y=this.context.gl;this.stencilClearMode=new Yr({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO)}clearStencil(){const c=this.context,d=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=o.F();o.aO(_,0,this.width,this.height,0,0,1),o.J(_,_,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,d.TRIANGLES,gr.disabled,this.stencilClearMode,Br.disabled,en.disabled,xi(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(c,d){if(this.currentStencilSource===c.source||!c.isTileClipped()||!d||!d.length)return;this.currentStencilSource=c.source;const _=this.context,w=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(Br.disabled),_.setDepthMode(gr.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const U of d){const g=this._tileClippingMaskIDs[U.key]=this.nextStencilID++,y=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U);T.draw(_,w.TRIANGLES,gr.disabled,new Yr({func:w.ALWAYS,mask:0},g,255,w.KEEP,w.KEEP,w.REPLACE),Br.disabled,en.disabled,xi(U.posMatrix),y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,d=this.context.gl;return new Yr({func:d.NOTEQUAL,mask:255},c,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(c){const d=this.context.gl;return new Yr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(c){const d=this.context.gl,_=c.sort((U,g)=>g.overscaledZ-U.overscaledZ),w=_[_.length-1].overscaledZ,T=_[0].overscaledZ-w+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const U={};for(let g=0;g<T;g++)U[g+w]=new Yr({func:d.GEQUAL,mask:255},g+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[U,_]}return[{[w]:Yr.disabled},_]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new Br([c.CONSTANT_COLOR,c.ONE],new o.aP(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Br.unblended:Br.alphaBlended}depthModeForSublayer(c,d,_){if(!this.opaquePassEnabledForLayer())return gr.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new gr(_||this.context.gl.LEQUAL,d,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,d){this.style=c,this.options=d,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(b.now()),this.imageManager.beginFrame();const _=this.style._order,w=this.style.sourceCaches,T={},U={},g={};for(const y in w){const S=w[y];S.used&&S.prepare(this.context),T[y]=S.getVisibleCoordinates(),U[y]=T[y].slice().reverse(),g[y]=S.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let y=0;y<_.length;y++)if(this.style._layers[_[y]].is3D()){this.opaquePassCutoff=y;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const y of _){const S=this.style._layers[y];if(!S.hasOffscreenPass()||S.isHidden(this.transform.zoom))continue;const F=U[S.source];(S.type==="custom"||F.length)&&this.renderLayer(this,w[S.source],S,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?o.aP.black:o.aP.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const y=this.style._layers[_[this.currentLayer]],S=w[y.source],F=T[y.source];this._renderTileClippingMasks(y,F),this.renderLayer(this,S,y,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const y=this.style._layers[_[this.currentLayer]],S=w[y.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(y))continue;const F=(y.type==="symbol"?g:U)[y.source];this._renderTileClippingMasks(y,T[y.source]),this.renderLayer(this,S,y,F)}if(this.options.showTileBoundaries){const y=function(S,F){let M=null;const N=Object.values(S._layers).flatMap(K=>K.source&&!K.isHidden(F)?[S.sourceCaches[K.source]]:[]),k=N.filter(K=>K.getSource().type==="vector"),V=N.filter(K=>K.getSource().type!=="vector"),j=K=>{(!M||M.getSource().maxzoom<K.getSource().maxzoom)&&(M=K)};return k.forEach(K=>j(K)),M||V.forEach(K=>j(K)),M}(this.style,this.transform.zoom);y&&function(S,F,M){for(let N=0;N<M.length;N++)fh(S,F,M[N])}(this,y,y.getVisibleCoordinates())}this.options.showPadding&&function(y){const S=y.transform.padding;to(y,y.transform.height-(S.top||0),3,$o),to(y,S.bottom||0,3,ls),Xo(y,S.left||0,3,yu),Xo(y,y.transform.width-(S.right||0),3,Xa);const F=y.transform.centerPoint;(function(M,N,k,V){Jo(M,N-1,k-10,2,20,V),Jo(M,N-10,k-1,20,2,V)})(y,F.x,y.transform.height-F.y,Ic)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(c){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,_=this.transform.projMatrix;let w=this.terrainFacilitator.dirty;w||(w=c?!o.aZ(d,_):!o.a_(d,_)),w||(w=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),w&&(o.a$(d,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,U){const g=T.context,y=g.gl,S=Br.unblended,F=new gr(y.LEQUAL,gr.ReadWrite,[0,1]),M=U.getTerrainMesh(),N=U.sourceCache.getRenderableTiles(),k=T.useProgram("terrainDepth");g.bindFramebuffer.set(U.getFramebuffer("depth").framebuffer),g.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),g.clear({color:o.aP.transparent,depth:1});for(const V of N){const j=U.getTerrainData(V.tileID),K={u_matrix:T.transform.calculatePosMatrix(V.tileID.toUnwrapped()),u_ele_delta:U.getMeshFrameDelta(T.transform.zoom)};k.draw(g,y.TRIANGLES,F,Yr.disabled,S,en.backCCW,K,j,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}g.bindFramebuffer.set(null),g.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain),function(T,U){const g=T.context,y=g.gl,S=Br.unblended,F=new gr(y.LEQUAL,gr.ReadWrite,[0,1]),M=U.getTerrainMesh(),N=U.getCoordsTexture(),k=U.sourceCache.getRenderableTiles(),V=T.useProgram("terrainCoords");g.bindFramebuffer.set(U.getFramebuffer("coords").framebuffer),g.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),g.clear({color:o.aP.transparent,depth:1}),U.coordsIndex=[];for(const j of k){const K=U.getTerrainData(j.tileID);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,N.texture);const tt={u_matrix:T.transform.calculatePosMatrix(j.tileID.toUnwrapped()),u_terrain_coords_id:(255-U.coordsIndex.length)/255,u_texture:0,u_ele_delta:U.getMeshFrameDelta(T.transform.zoom)};V.draw(g,y.TRIANGLES,F,Yr.disabled,S,en.backCCW,tt,K,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),U.coordsIndex.push(j.tileID.key)}g.bindFramebuffer.set(null),g.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain))}renderLayer(c,d,_,w){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(w||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(T,U,g,y,S){if(T.renderPass!=="translucent")return;const F=Yr.disabled,M=T.colorModeForRenderPass();(g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(N,k,V,j,K,tt,ht,rt,At){const St=k.transform,Ct=mn(),yt=K==="map",Et=tt==="map";for(const Wt of N){const Zt=j.getTile(Wt),zt=Zt.getBucket(V);if(!zt||!zt.text||!zt.text.segments.get().length)continue;const ae=o.ag(zt.textSizeData,St.zoom),de=_r(Zt,1,k.transform.zoom),Me=Kn(Wt.posMatrix,Et,yt,k.transform,de),le=V.layout.get("icon-text-fit")!=="none"&&zt.hasIconData();if(ae){const Ee=Math.pow(2,St.zoom-Zt.tileID.overscaledZ),$e=k.style.map.terrain?(Je,mr)=>k.style.map.terrain.getElevation(Wt,Je,mr):null,Tr=Ct.translatePosition(St,Zt,ht,rt);Ol(zt,yt,Et,At,St,Me,Wt.posMatrix,Ee,ae,le,Ct,Tr,Wt.toUnwrapped(),$e)}}}(y,T,g,U,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),S),g.paint.get("icon-opacity").constantOr(1)!==0&&va(T,U,g,y,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),F,M),g.paint.get("text-opacity").constantOr(1)!==0&&va(T,U,g,y,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),F,M),U.map.showCollisionBoxes&&(Bo(T,U,g,y,!0),Bo(T,U,g,y,!1))})(c,d,_,w,this.style.placement.variableOffsets);break;case"circle":(function(T,U,g,y){if(T.renderPass!=="translucent")return;const S=g.paint.get("circle-opacity"),F=g.paint.get("circle-stroke-width"),M=g.paint.get("circle-stroke-opacity"),N=!g.layout.get("circle-sort-key").isConstant();if(S.constantOr(1)===0&&(F.constantOr(1)===0||M.constantOr(1)===0))return;const k=T.context,V=k.gl,j=T.depthModeForSublayer(0,gr.ReadOnly),K=Yr.disabled,tt=T.colorModeForRenderPass(),ht=[];for(let rt=0;rt<y.length;rt++){const At=y[rt],St=U.getTile(At),Ct=St.getBucket(g);if(!Ct)continue;const yt=Ct.programConfigurations.get(g.id),Et=T.useProgram("circle",yt),Wt=Ct.layoutVertexBuffer,Zt=Ct.indexBuffer,zt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(At),ae={programConfiguration:yt,program:Et,layoutVertexBuffer:Wt,indexBuffer:Zt,uniformValues:Qr(T,At,St,g),terrainData:zt};if(N){const de=Ct.segments.get();for(const Me of de)ht.push({segments:new o.$([Me]),sortKey:Me.sortKey,state:ae})}else ht.push({segments:Ct.segments,sortKey:0,state:ae})}N&&ht.sort((rt,At)=>rt.sortKey-At.sortKey);for(const rt of ht){const{programConfiguration:At,program:St,layoutVertexBuffer:Ct,indexBuffer:yt,uniformValues:Et,terrainData:Wt}=rt.state;St.draw(k,V.TRIANGLES,j,K,tt,en.disabled,Et,Wt,g.id,Ct,yt,rt.segments,g.paint,T.transform.zoom,At)}})(c,d,_,w);break;case"heatmap":(function(T,U,g,y){if(g.paint.get("heatmap-opacity")!==0)if(T.renderPass==="offscreen"){const S=T.context,F=S.gl,M=Yr.disabled,N=new Br([F.ONE,F.ONE],o.aP.transparent,[!0,!0,!0,!0]);(function(k,V,j){const K=k.gl;k.activeTexture.set(K.TEXTURE1),k.viewport.set([0,0,V.width/4,V.height/4]);let tt=j.heatmapFbo;if(tt)K.bindTexture(K.TEXTURE_2D,tt.colorAttachment.get()),k.bindFramebuffer.set(tt.framebuffer);else{const ht=K.createTexture();K.bindTexture(K.TEXTURE_2D,ht),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),tt=j.heatmapFbo=k.createFramebuffer(V.width/4,V.height/4,!1,!1),function(rt,At,St,Ct){var yt,Et;const Wt=rt.gl,Zt=(yt=rt.HALF_FLOAT)!==null&&yt!==void 0?yt:Wt.UNSIGNED_BYTE,zt=(Et=rt.RGBA16F)!==null&&Et!==void 0?Et:Wt.RGBA;Wt.texImage2D(Wt.TEXTURE_2D,0,zt,At.width/4,At.height/4,0,Wt.RGBA,Zt,null),Ct.colorAttachment.set(St)}(k,V,ht,tt)}})(S,T,g),S.clear({color:o.aP.transparent});for(let k=0;k<y.length;k++){const V=y[k];if(U.hasRenderableParent(V))continue;const j=U.getTile(V),K=j.getBucket(g);if(!K)continue;const tt=K.programConfigurations.get(g.id),ht=T.useProgram("heatmap",tt),{zoom:rt}=T.transform;ht.draw(S,F.TRIANGLES,gr.disabled,M,N,en.disabled,vn(V.posMatrix,j,rt,g.paint.get("heatmap-intensity")),null,g.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,g.paint,T.transform.zoom,tt)}S.viewport.set([0,0,T.width,T.height])}else T.renderPass==="translucent"&&(T.context.setColorMode(T.colorModeForRenderPass()),function(S,F){const M=S.context,N=M.gl,k=F.heatmapFbo;if(!k)return;M.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,k.colorAttachment.get()),M.activeTexture.set(N.TEXTURE1);let V=F.colorRampTexture;V||(V=F.colorRampTexture=new at(M,F.colorRamp,N.RGBA)),V.bind(N.LINEAR,N.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(M,N.TRIANGLES,gr.disabled,Yr.disabled,S.colorModeForRenderPass(),en.disabled,((j,K,tt,ht)=>{const rt=o.F();o.aO(rt,0,j.width,j.height,0,0,1);const At=j.context.gl;return{u_matrix:rt,u_world:[At.drawingBufferWidth,At.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}})(S,F),null,F.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,F.paint,S.transform.zoom)}(T,g))})(c,d,_,w);break;case"line":(function(T,U,g,y){if(T.renderPass!=="translucent")return;const S=g.paint.get("line-opacity"),F=g.paint.get("line-width");if(S.constantOr(1)===0||F.constantOr(1)===0)return;const M=T.depthModeForSublayer(0,gr.ReadOnly),N=T.colorModeForRenderPass(),k=g.paint.get("line-dasharray"),V=g.paint.get("line-pattern"),j=V.constantOr(1),K=g.paint.get("line-gradient"),tt=g.getCrossfadeParameters(),ht=j?"linePattern":k?"lineSDF":K?"lineGradient":"line",rt=T.context,At=rt.gl;let St=!0;for(const Ct of y){const yt=U.getTile(Ct);if(j&&!yt.patternsLoaded())continue;const Et=yt.getBucket(g);if(!Et)continue;const Wt=Et.programConfigurations.get(g.id),Zt=T.context.program.get(),zt=T.useProgram(ht,Wt),ae=St||zt.program!==Zt,de=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ct),Me=V.constantOr(null);if(Me&&yt.imageAtlas){const $e=yt.imageAtlas,Tr=$e.patternPositions[Me.to.toString()],Je=$e.patternPositions[Me.from.toString()];Tr&&Je&&Wt.setConstantPatternPositions(Tr,Je)}const le=de?Ct:null,Ee=j?aA(T,yt,g,tt,le):k?lu(T,yt,g,k,tt,le):K?Ir(T,yt,g,Et.lineClipsArray.length,le):zi(T,yt,g,le);if(j)rt.activeTexture.set(At.TEXTURE0),yt.imageAtlasTexture.bind(At.LINEAR,At.CLAMP_TO_EDGE),Wt.updatePaintBuffers(tt);else if(k&&(ae||T.lineAtlas.dirty))rt.activeTexture.set(At.TEXTURE0),T.lineAtlas.bind(rt);else if(K){const $e=Et.gradients[g.id];let Tr=$e.texture;if(g.gradientVersion!==$e.version){let Je=256;if(g.stepInterpolant){const mr=U.getSource().maxzoom,Dr=Ct.canonical.z===mr?Math.ceil(1<<T.transform.maxZoom-Ct.canonical.z):1;Je=o.ac(o.aU(Et.maxLineLength/o.W*1024*Dr),256,rt.maxTextureSize)}$e.gradient=o.aV({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:Je,image:$e.gradient||void 0,clips:Et.lineClipsArray}),$e.texture?$e.texture.update($e.gradient):$e.texture=new at(rt,$e.gradient,At.RGBA),$e.version=g.gradientVersion,Tr=$e.texture}rt.activeTexture.set(At.TEXTURE0),Tr.bind(g.stepInterpolant?At.NEAREST:At.LINEAR,At.CLAMP_TO_EDGE)}zt.draw(rt,At.TRIANGLES,M,T.stencilModeForClipping(Ct),N,en.disabled,Ee,de,g.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,g.paint,T.transform.zoom,Wt,Et.layoutVertexBuffer2),St=!1}})(c,d,_,w);break;case"fill":(function(T,U,g,y){const S=g.paint.get("fill-color"),F=g.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const M=T.colorModeForRenderPass(),N=g.paint.get("fill-pattern"),k=T.opaquePassEnabledForLayer()&&!N.constantOr(1)&&S.constantOr(o.aP.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(T.renderPass===k){const V=T.depthModeForSublayer(1,T.renderPass==="opaque"?gr.ReadWrite:gr.ReadOnly);Eo(T,U,g,y,V,M,!1)}if(T.renderPass==="translucent"&&g.paint.get("fill-antialias")){const V=T.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,gr.ReadOnly);Eo(T,U,g,y,V,M,!0)}})(c,d,_,w);break;case"fill-extrusion":(function(T,U,g,y){const S=g.paint.get("fill-extrusion-opacity");if(S!==0&&T.renderPass==="translucent"){const F=new gr(T.context.gl.LEQUAL,gr.ReadWrite,T.depthRangeFor3D);if(S!==1||g.paint.get("fill-extrusion-pattern").constantOr(1))Hn(T,U,g,y,F,Yr.disabled,Br.disabled),Hn(T,U,g,y,F,T.stencilModeFor3D(),T.colorModeForRenderPass());else{const M=T.colorModeForRenderPass();Hn(T,U,g,y,F,Yr.disabled,M)}}})(c,d,_,w);break;case"hillshade":(function(T,U,g,y){if(T.renderPass!=="offscreen"&&T.renderPass!=="translucent")return;const S=T.context,F=T.depthModeForSublayer(0,gr.ReadOnly),M=T.colorModeForRenderPass(),[N,k]=T.renderPass==="translucent"?T.stencilConfigForOverlap(y):[{},y];for(const V of k){const j=U.getTile(V);j.needsHillshadePrepare!==void 0&&j.needsHillshadePrepare&&T.renderPass==="offscreen"?Tc(T,j,g,F,Yr.disabled,M):T.renderPass==="translucent"&&Sc(T,V,j,g,F,N[V.overscaledZ],M)}S.viewport.set([0,0,T.width,T.height])})(c,d,_,w);break;case"raster":(function(T,U,g,y){if(T.renderPass!=="translucent"||g.paint.get("raster-opacity")===0||!y.length)return;const S=T.context,F=S.gl,M=U.getSource(),N=T.useProgram("raster"),k=T.colorModeForRenderPass(),[V,j]=M instanceof Ie?[{},y]:T.stencilConfigForOverlap(y),K=j[j.length-1].overscaledZ,tt=!T.options.moving;for(const ht of j){const rt=T.depthModeForSublayer(ht.overscaledZ-K,g.paint.get("raster-opacity")===1?gr.ReadWrite:gr.ReadOnly,F.LESS),At=U.getTile(ht);At.registerFadeDuration(g.paint.get("raster-fade-duration"));const St=U.findLoadedParent(ht,0),Ct=U.findLoadedSibling(ht),yt=kl(At,St||Ct||null,U,g,T.transform,T.style.map.terrain);let Et,Wt;const Zt=g.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;S.activeTexture.set(F.TEXTURE0),At.texture.bind(Zt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(F.TEXTURE1),St?(St.texture.bind(Zt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Et=Math.pow(2,St.tileID.overscaledZ-At.tileID.overscaledZ),Wt=[At.tileID.canonical.x*Et%1,At.tileID.canonical.y*Et%1]):At.texture.bind(Zt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const zt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(ht),ae=zt?ht:null,de=ae?ae.posMatrix:T.transform.calculatePosMatrix(ht.toUnwrapped(),tt),Me=ja(de,Wt||[0,0],Et||1,yt,g);M instanceof Ie?N.draw(S,F.TRIANGLES,rt,Yr.disabled,k,en.disabled,Me,zt,g.id,M.boundsBuffer,T.quadTriangleIndexBuffer,M.boundsSegments):N.draw(S,F.TRIANGLES,rt,V[ht.overscaledZ],k,en.disabled,Me,zt,g.id,T.rasterBoundsBuffer,T.quadTriangleIndexBuffer,T.rasterBoundsSegments)}})(c,d,_,w);break;case"background":(function(T,U,g,y){const S=g.paint.get("background-color"),F=g.paint.get("background-opacity");if(F===0)return;const M=T.context,N=M.gl,k=T.transform,V=k.tileSize,j=g.paint.get("background-pattern");if(T.isPatternMissing(j))return;const K=!j&&S.a===1&&F===1&&T.opaquePassEnabledForLayer()?"opaque":"translucent";if(T.renderPass!==K)return;const tt=Yr.disabled,ht=T.depthModeForSublayer(0,K==="opaque"?gr.ReadWrite:gr.ReadOnly),rt=T.colorModeForRenderPass(),At=T.useProgram(j?"backgroundPattern":"background"),St=y||k.coveringTiles({tileSize:V,terrain:T.style.map.terrain});j&&(M.activeTexture.set(N.TEXTURE0),T.imageManager.bind(T.context));const Ct=g.getCrossfadeParameters();for(const yt of St){const Et=y?yt.posMatrix:T.transform.calculatePosMatrix(yt.toUnwrapped()),Wt=j?lA(Et,F,T,j,{tileID:yt,tileSize:V},Ct):Bd(Et,F,S),Zt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(yt);At.draw(M,N.TRIANGLES,ht,tt,rt,en.disabled,Wt,Zt,g.id,T.tileExtentBuffer,T.quadTriangleIndexBuffer,T.tileExtentSegments)}})(c,0,_,w);break;case"custom":(function(T,U,g){const y=T.context,S=g.implementation;if(T.renderPass==="offscreen"){const F=S.prerender;F&&(T.setCustomLayerDefaults(),y.setColorMode(T.colorModeForRenderPass()),F.call(S,y.gl,T.transform.customLayerMatrix()),y.setDirty(),T.setBaseState())}else if(T.renderPass==="translucent"){T.setCustomLayerDefaults(),y.setColorMode(T.colorModeForRenderPass()),y.setStencilMode(Yr.disabled);const F=S.renderingMode==="3d"?new gr(T.context.gl.LEQUAL,gr.ReadWrite,T.depthRangeFor3D):T.depthModeForSublayer(0,gr.ReadOnly);y.setDepthMode(F),S.render(y.gl,T.transform.customLayerMatrix()),y.setDirty(),T.setBaseState(),y.bindFramebuffer.set(null)}})(c,0,_)}}translatePosMatrix(c,d,_,w,T){if(!_[0]&&!_[1])return c;const U=T?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(U){const S=Math.sin(U),F=Math.cos(U);_=[_[0]*F-_[1]*S,_[0]*S+_[1]*F]}const g=[T?_[0]:_r(d,_[0],this.transform.zoom),T?_[1]:_r(d,_[1],this.transform.zoom),0],y=new Float32Array(16);return o.H(y,c,g),y}saveTileTexture(c){const d=this._tileTextures[c.size[0]];d?d.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const d=this._tileTextures[c];return d&&d.length>0?d.pop():null}isPatternMissing(c){if(!c)return!1;if(!c.from||!c.to)return!0;const d=this.imageManager.getPattern(c.from.toString()),_=this.imageManager.getPattern(c.to.toString());return!d||!_}useProgram(c,d){this.cache=this.cache||{};const _=c+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new Il(this.context,wi[c],d,ma[c],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new at(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:c,drawingBufferHeight:d}=this.context.gl;return this.width!==c||this.height!==d}}class ys{constructor(c,d){this.points=c,this.planes=d}static fromInvProjectionMatrix(c,d,_){const w=Math.pow(2,_),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{const y=1/(g=o.af([],g,c))[3]/d*w;return o.b0(g,g,[y,y,1/g[3],y])}),U=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{const y=function(N,k){var V=k[0],j=k[1],K=k[2],tt=V*V+j*j+K*K;return tt>0&&(tt=1/Math.sqrt(tt)),N[0]=k[0]*tt,N[1]=k[1]*tt,N[2]=k[2]*tt,N}([],function(N,k,V){var j=k[0],K=k[1],tt=k[2],ht=V[0],rt=V[1],At=V[2];return N[0]=K*At-tt*rt,N[1]=tt*ht-j*At,N[2]=j*rt-K*ht,N}([],mt([],T[g[0]],T[g[1]]),mt([],T[g[2]],T[g[1]]))),S=-((F=y)[0]*(M=T[g[1]])[0]+F[1]*M[1]+F[2]*M[2]);var F,M;return y.concat(S)});return new ys(T,U)}}class Zo{constructor(c,d){this.min=c,this.max=d,this.center=function(_,w,T){return _[0]=.5*w[0],_[1]=.5*w[1],_[2]=.5*w[2],_}([],function(_,w,T){return _[0]=w[0]+T[0],_[1]=w[1]+T[1],_[2]=w[2]+T[2],_}([],this.min,this.max))}quadrant(c){const d=[c%2==0,c<2],_=pt(this.min),w=pt(this.max);for(let T=0;T<d.length;T++)_[T]=d[T]?this.min[T]:this.center[T],w[T]=d[T]?this.center[T]:this.max[T];return w[2]=this.max[2],new Zo(_,w)}distanceX(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]}distanceY(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]}intersects(c){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let w=0;w<c.planes.length;w++){const T=c.planes[w];let U=0;for(let g=0;g<d.length;g++)o.b1(T,d[g])>=0&&U++;if(U===0)return 0;U!==d.length&&(_=!1)}if(_)return 2;for(let w=0;w<3;w++){let T=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let g=0;g<c.points.length;g++){const y=c.points[g][w]-this.min[w];T=Math.min(T,y),U=Math.max(U,y)}if(U<0||T>this.max[w]-this.min[w])return 0}return 1}}class Ns{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(c)||c<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=d,this.left=_,this.right=w}interpolate(c,d,_){return d.top!=null&&c.top!=null&&(this.top=o.z.number(c.top,d.top,_)),d.bottom!=null&&c.bottom!=null&&(this.bottom=o.z.number(c.bottom,d.bottom,_)),d.left!=null&&c.left!=null&&(this.left=o.z.number(c.left,d.left,_)),d.right!=null&&c.right!=null&&(this.right=o.z.number(c.right,d.right,_)),this}getCenter(c,d){const _=o.ac((this.left+c-this.right)/2,0,c),w=o.ac((this.top+d-this.bottom)/2,0,d);return new o.P(_,w)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Ns(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ks=85.051129;class Ql{constructor(c,d,_,w,T){this.tileSize=512,this._renderWorldCopies=T===void 0||!!T,this._minZoom=c||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=w??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ns,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const c=new Ql(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.apply(this),c}apply(c){this.tileSize=c.tileSize,this.latRange=c.latRange,this.width=c.width,this.height=c.height,this._center=c._center,this._elevation=c._elevation,this.minElevationForCurrentTile=c.minElevationForCurrentTile,this.zoom=c.zoom,this.angle=c.angle,this._fov=c._fov,this._pitch=c._pitch,this._unmodified=c._unmodified,this._edgeInsets=c._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(c){const d=-o.b2(c,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var _=new o.A(4);return o.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,w,T){var U=w[0],g=w[1],y=w[2],S=w[3],F=Math.sin(T),M=Math.cos(T);_[0]=U*M+y*F,_[1]=g*M+S*F,_[2]=U*-F+y*M,_[3]=g*-F+S*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const d=o.ac(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(c){const d=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(c){c!==this._elevation&&(this._elevation=c,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,d,_){this._unmodified=!1,this._edgeInsets.interpolate(c,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const d=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(c){const d=[new o.b3(0,c)];if(this._renderWorldCopies){const _=this.pointCoordinate(new o.P(0,0)),w=this.pointCoordinate(new o.P(this.width,0)),T=this.pointCoordinate(new o.P(this.width,this.height)),U=this.pointCoordinate(new o.P(0,this.height)),g=Math.floor(Math.min(_.x,w.x,T.x,U.x)),y=Math.floor(Math.max(_.x,w.x,T.x,U.x)),S=1;for(let F=g-S;F<=y+S;F++)F!==0&&d.push(new o.b3(F,c))}return d}coveringTiles(c){var d,_;let w=this.coveringZoomLevel(c);const T=w;if(c.minzoom!==void 0&&w<c.minzoom)return[];c.maxzoom!==void 0&&w>c.maxzoom&&(w=c.maxzoom);const U=this.pointCoordinate(this.getCameraPoint()),g=o.Y.fromLngLat(this.center),y=Math.pow(2,w),S=[y*U.x,y*U.y,0],F=[y*g.x,y*g.y,0],M=ys.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,w);let N=c.minzoom||0;!c.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=w);const k=c.terrain?2/Math.min(this.tileSize,c.tileSize)*this.tileSize:3,V=rt=>({aabb:new Zo([rt*y,0,0],[(rt+1)*y,y,0]),zoom:0,x:0,y:0,wrap:rt,fullyVisible:!1}),j=[],K=[],tt=w,ht=c.reparseOverscaled?T:w;if(this._renderWorldCopies)for(let rt=1;rt<=3;rt++)j.push(V(-rt)),j.push(V(rt));for(j.push(V(0));j.length>0;){const rt=j.pop(),At=rt.x,St=rt.y;let Ct=rt.fullyVisible;if(!Ct){const zt=rt.aabb.intersects(M);if(zt===0)continue;Ct=zt===2}const yt=c.terrain?S:F,Et=rt.aabb.distanceX(yt),Wt=rt.aabb.distanceY(yt),Zt=Math.max(Math.abs(Et),Math.abs(Wt));if(rt.zoom===tt||Zt>k+(1<<tt-rt.zoom)-2&&rt.zoom>=N){const zt=tt-rt.zoom,ae=S[0]-.5-(At<<zt),de=S[1]-.5-(St<<zt);K.push({tileID:new o.Q(rt.zoom===tt?ht:rt.zoom,rt.wrap,rt.zoom,At,St),distanceSq:ft([F[0]-.5-At,F[1]-.5-St]),tileDistanceToCamera:Math.sqrt(ae*ae+de*de)})}else for(let zt=0;zt<4;zt++){const ae=(At<<1)+zt%2,de=(St<<1)+(zt>>1),Me=rt.zoom+1;let le=rt.aabb.quadrant(zt);if(c.terrain){const Ee=new o.Q(Me,rt.wrap,Me,ae,de),$e=c.terrain.getMinMaxElevation(Ee),Tr=(d=$e.minElevation)!==null&&d!==void 0?d:this.elevation,Je=(_=$e.maxElevation)!==null&&_!==void 0?_:this.elevation;le=new Zo([le.min[0],le.min[1],Tr],[le.max[0],le.max[1],Je])}j.push({aabb:le,zoom:Me,x:ae,y:de,wrap:rt.wrap,fullyVisible:Ct})}}return K.sort((rt,At)=>rt.distanceSq-At.distanceSq).map(rt=>rt.tileID)}resize(c,d){this.width=c,this.height=d,this.pixelsToGLUnits=[2/c,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const d=o.ac(c.lat,-85.051129,ks);return new o.P(o.N(c.lng)*this.worldSize,o.O(d)*this.worldSize)}unproject(c){return new o.Y(c.x/this.worldSize,c.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(c){const d=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,w=this.pointLocation(this.centerPoint,c),T=c.getElevationForLngLatZoom(w,this.tileZoom);if(!(this.elevation-T))return;const U=_+d-T,g=Math.cos(this._pitch)*this.cameraToCenterDistance/U/o.b4(1,w.lat),y=this.scaleZoom(g/this.tileSize);this._elevation=T,this._center=w,this.zoom=y}setLocationAtPoint(c,d){const _=this.pointCoordinate(d),w=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(c),U=new o.Y(T.x-(_.x-w.x),T.y-(_.y-w.y));this.center=this.coordinateLocation(U),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(c,d){return d?this.coordinatePoint(this.locationCoordinate(c),d.getElevationForLngLatZoom(c,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(c))}pointLocation(c,d){return this.coordinateLocation(this.pointCoordinate(c,d))}locationCoordinate(c){return o.Y.fromLngLat(c)}coordinateLocation(c){return c&&c.toLngLat()}pointCoordinate(c,d){if(d){const N=d.pointCoordinate(c);if(N!=null)return N}const _=[c.x,c.y,0,1],w=[c.x,c.y,1,1];o.af(_,_,this.pixelMatrixInverse),o.af(w,w,this.pixelMatrixInverse);const T=_[3],U=w[3],g=_[1]/T,y=w[1]/U,S=_[2]/T,F=w[2]/U,M=S===F?0:(0-S)/(F-S);return new o.Y(o.z.number(_[0]/T,w[0]/U,M)/this.worldSize,o.z.number(g,y,M)/this.worldSize)}coordinatePoint(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const w=[c.x*this.worldSize,c.y*this.worldSize,d,1];return o.af(w,w,_),new o.P(w[0]/w[3],w[1]/w[3])}getBounds(){const c=Math.max(0,this.height/2-this.getHorizon());return new ke().extend(this.pointLocation(new o.P(0,c))).extend(this.pointLocation(new o.P(this.width,c))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ke([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,ks])}calculatePosMatrix(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const _=c.key,w=d?this._alignedPosMatrixCache:this._posMatrixCache;if(w[_])return w[_];const T=c.canonical,U=this.worldSize/this.zoomScale(T.z),g=T.x+Math.pow(2,T.z)*c.wrap,y=o.an(new Float64Array(16));return o.H(y,y,[g*U,T.y*U,0]),o.J(y,y,[U/o.W,U/o.W,1]),o.K(y,d?this.alignedProjMatrix:this.projMatrix,y),w[_]=new Float32Array(y),w[_]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(c,d){d=o.ac(+d,this.minZoom,this.maxZoom);const _={center:new o.M(c.lng,c.lat),zoom:d};let w=this.lngRange;if(!this._renderWorldCopies&&w===null){const rt=179.9999999999;w=[-rt,rt]}const T=this.tileSize*this.zoomScale(_.zoom);let U=0,g=T,y=0,S=T,F=0,M=0;const{x:N,y:k}=this.size;if(this.latRange){const rt=this.latRange;U=o.O(rt[1])*T,g=o.O(rt[0])*T,g-U<k&&(F=k/(g-U))}w&&(y=o.b2(o.N(w[0])*T,0,T),S=o.b2(o.N(w[1])*T,0,T),S<y&&(S+=T),S-y<N&&(M=N/(S-y)));const{x:V,y:j}=this.project.call({worldSize:T},c);let K,tt;const ht=Math.max(M||0,F||0);if(ht){const rt=new o.P(M?(S+y)/2:V,F?(g+U)/2:j);return _.center=this.unproject.call({worldSize:T},rt).wrap(),_.zoom+=this.scaleZoom(ht),_}if(this.latRange){const rt=k/2;j-rt<U&&(tt=U+rt),j+rt>g&&(tt=g-rt)}if(w){const rt=(y+S)/2;let At=V;this._renderWorldCopies&&(At=o.b2(V,rt-T/2,rt+T/2));const St=N/2;At-St<y&&(K=y+St),At+St>S&&(K=S-St)}if(K!==void 0||tt!==void 0){const rt=new o.P(K??V,tt??j);_.center=this.unproject.call({worldSize:T},rt).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this._unmodified,{center:d,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=_,this._unmodified=c,this._constraining=!1}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,d=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b4(1,this.center.lat)*this.worldSize;let w=o.an(new Float64Array(16));o.J(w,w,[this.width/2,-this.height/2,1]),o.H(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=o.an(new Float64Array(16)),o.J(w,w,[1,-1,1]),o.H(w,w,[-1,-1,0]),o.J(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w;const T=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),U=Math.min(this.elevation,this.minElevationForCurrentTile),g=T-U*this._pixelPerMeter/Math.cos(this._pitch),y=U<0?g:T,S=Math.PI/2+this._pitch,F=this._fov*(.5+c.y/this.height),M=Math.sin(F)*y/Math.sin(o.ac(Math.PI-S-F,.01,Math.PI-.01)),N=this.getHorizon(),k=2*Math.atan(N/this.cameraToCenterDistance)*(.5+c.y/(2*N)),V=Math.sin(k)*y/Math.sin(o.ac(Math.PI-S-k,.01,Math.PI-.01)),j=Math.min(M,V),K=1.01*(Math.cos(Math.PI/2-this._pitch)*j+y),tt=this.height/50;w=new Float64Array(16),o.b5(w,this._fov,this.width/this.height,tt,K),w[8]=2*-c.x/this.width,w[9]=2*c.y/this.height,o.J(w,w,[1,-1,1]),o.H(w,w,[0,0,-this.cameraToCenterDistance]),o.b6(w,w,this._pitch),o.ad(w,w,this.angle),o.H(w,w,[-d,-_,0]),this.mercatorMatrix=o.J([],w,[this.worldSize,this.worldSize,this.worldSize]),o.J(w,w,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.K(new Float64Array(16),this.labelPlaneMatrix,w),o.H(w,w,[0,0,-this.elevation]),this.projMatrix=w,this.invProjMatrix=o.as([],w),this.pixelMatrix3D=o.K(new Float64Array(16),this.labelPlaneMatrix,w);const ht=this.width%2/2,rt=this.height%2/2,At=Math.cos(this.angle),St=Math.sin(this.angle),Ct=d-Math.round(d)+At*ht+St*rt,yt=_-Math.round(_)+At*rt+St*ht,Et=new Float64Array(w);if(o.H(Et,Et,[Ct>.5?Ct-1:Ct,yt>.5?yt-1:yt,0]),this.alignedProjMatrix=Et,w=o.as(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");this.pixelMatrixInverse=w,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const c=this.pointCoordinate(new o.P(0,0)),d=[c.x*this.worldSize,c.y*this.worldSize,0,1];return o.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,c))}getCameraQueryGeometry(c){const d=this.getCameraPoint();if(c.length===1)return[c[0],d];{let _=d.x,w=d.y,T=d.x,U=d.y;for(const g of c)_=Math.min(_,g.x),w=Math.min(w,g.y),T=Math.max(T,g.x),U=Math.max(U,g.y);return[new o.P(_,w),new o.P(T,w),new o.P(T,U),new o.P(_,U),new o.P(_,w)]}}lngLatToCameraDepth(c,d){const _=this.locationCoordinate(c),w=[_.x*this.worldSize,_.y*this.worldSize,d,1];return o.af(w,w,this.projMatrix),w[2]/w[3]}}function So(C,c){var d=this;let _,w=!1,T=null,U=null;const g=()=>{T=null,w&&(C.apply(U,_),T=setTimeout(g,c),w=!1)};return function(){for(var y=arguments.length,S=new Array(y),F=0;F<y;F++)S[F]=arguments[F];return w=!0,U=d,_=S,T||g(),T}}class Hl{constructor(c){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let _;return d.split("&").map(w=>w.split("=")).forEach(w=>{w[0]===this._hashName&&(_=w)}),(_&&_[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=So(this._updateHashUnthrottled,300),this._hashName=c&&encodeURIComponent(c)}addTo(c){return this._map=c,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(c){const d=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,w=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,w),U=Math.round(d.lng*T)/T,g=Math.round(d.lat*T)/T,y=this._map.getBearing(),S=this._map.getPitch();let F="";if(F+=c?`/${U}/${g}/${_}`:`${_}/${g}/${U}`,(y||S)&&(F+="/"+Math.round(10*y)/10),S&&(F+=`/${Math.round(S)}`),this._hashName){const M=this._hashName;let N=!1;const k=window.location.hash.slice(1).split("&").map(V=>{const j=V.split("=")[0];return j===M?(N=!0,`${j}=${F}`):V}).filter(V=>V);return N||k.push(`${M}=${F}`),`#${k.join("&")}`}return`#${F}`}}const zl={linearity:.3,easing:o.b7(0,0,.3,1)},ba=o.e({deceleration:2500,maxSpeed:1400},zl),Qs=o.e({deceleration:20,maxSpeed:1400},zl),To=o.e({deceleration:1e3,maxSpeed:360},zl),Ja=o.e({deceleration:1e3,maxSpeed:90},zl);class Vl{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:b.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,d=b.now();for(;c.length>0&&d-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(d.pan.mag()){const T=Hs(d.pan.mag(),_,o.e({},ba,c||{}));w.offset=d.pan.mult(T.amount/d.pan.mag()),w.center=this._map.transform.center,ta(w,T)}if(d.zoom){const T=Hs(d.zoom,_,Qs);w.zoom=this._map.transform.zoom+T.amount,ta(w,T)}if(d.bearing){const T=Hs(d.bearing,_,To);w.bearing=this._map.transform.bearing+o.ac(T.amount,-179,179),ta(w,T)}if(d.pitch){const T=Hs(d.pitch,_,Ja);w.pitch=this._map.transform.pitch+T.amount,ta(w,T)}if(w.zoom||w.bearing){const T=d.pinchAround===void 0?d.around:d.pinchAround;w.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),o.e(w,{noMoveStart:!0})}}function ta(C,c){(!C.duration||C.duration<c.duration)&&(C.duration=c.duration,C.easing=c.easing)}function Hs(C,c,d){const{maxSpeed:_,linearity:w,deceleration:T}=d,U=o.ac(C*w/(c/1e3),-_,_),g=Math.abs(U)/(T*w);return{easing:d.easing,duration:1e3*g,amount:U*(g/2)}}class Ei extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,_){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const T=x.mousePos(d.getCanvas(),_),U=d.unproject(T);super(c,o.e({point:T,lngLat:U,originalEvent:_},w)),this._defaultPrevented=!1,this.target=d}}class Gi extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,_){const w=c==="touchend"?_.changedTouches:_.touches,T=x.touchPos(d.getCanvasContainer(),w),U=T.map(y=>d.unproject(y)),g=T.reduce((y,S,F,M)=>y.add(S.div(M.length)),new o.P(0,0));super(c,{points:T,point:g,lngLats:U,lngLat:d.unproject(g),originalEvent:_}),this._defaultPrevented=!1}}class wa extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,_){super(c,{originalEvent:_}),this._defaultPrevented=!1}}class On{constructor(c,d){this._map=c,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(c){return this._firePreventable(new wa(c.type,this._map,c))}mousedown(c,d){return this._mousedownPos=d,this._firePreventable(new Ei(c.type,this._map,c))}mouseup(c){this._map.fire(new Ei(c.type,this._map,c))}click(c,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ei(c.type,this._map,c))}dblclick(c){return this._firePreventable(new Ei(c.type,this._map,c))}mouseover(c){this._map.fire(new Ei(c.type,this._map,c))}mouseout(c){this._map.fire(new Ei(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Gi(c.type,this._map,c))}touchmove(c){this._map.fire(new Gi(c.type,this._map,c))}touchend(c){this._map.fire(new Gi(c.type,this._map,c))}touchcancel(c){this._map.fire(new Gi(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xn{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(c){this._map.fire(new Ei(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ei("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._ignoreContextMenu||this._map.fire(new Ei(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jn{constructor(c){this._map=c}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(c){return this.transform.pointLocation(o.P.convert(c),this._map.terrain)}}class hi{constructor(c,d){this._map=c,this._tr=new Jn(c),this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,d){this.isEnabled()&&c.shiftKey&&c.button===0&&(x.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(c,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=_,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",c));const T=Math.min(w.x,_.x),U=Math.max(w.x,_.x),g=Math.min(w.y,_.y),y=Math.max(w.y,_.y);x.setTransform(this._box,`translate(${T}px,${g}px)`),this._box.style.width=U-T+"px",this._box.style.height=y-g+"px"}mouseupWindow(c,d){if(!this._active||c.button!==0)return;const _=this._startPos,w=d;if(this.reset(),x.suppressClick(),_.x!==w.x||_.y!==w.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:c})),{cameraAnimation:T=>T.fitScreenCoordinates(_,w,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",c)}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(c,d){return this._map.fire(new o.k(c,{originalEvent:d}))}}function eo(C,c){if(C.length!==c.length)throw new Error(`The number of touches and points are not equal - touches ${C.length}, points ${c.length}`);const d={};for(let _=0;_<C.length;_++)d[C[_].identifier]=c[_];return d}class Ya{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(c,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),_.length===this.numTouches&&(this.centroid=function(w){const T=new o.P(0,0);for(const U of w)T._add(U);return T.div(w.length)}(d),this.touches=eo(_,d)))}touchmove(c,d,_){if(this.aborted||!this.centroid)return;const w=eo(_,d);for(const T in this.touches){const U=w[T];(!U||U.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(c,d,_){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Za{constructor(c){this.singleTap=new Ya(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(c,d,_){this.singleTap.touchstart(c,d,_)}touchmove(c,d,_){this.singleTap.touchmove(c,d,_)}touchend(c,d,_){const w=this.singleTap.touchend(c,d,_);if(w){const T=c.timeStamp-this.lastTime<500,U=!this.lastTap||this.lastTap.dist(w)<30;if(T&&U||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Fc{constructor(c){this._tr=new Jn(c),this._zoomIn=new Za({numTouches:1,numTaps:2}),this._zoomOut=new Za({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,d,_){this._zoomIn.touchstart(c,d,_),this._zoomOut.touchstart(c,d,_)}touchmove(c,d,_){this._zoomIn.touchmove(c,d,_),this._zoomOut.touchmove(c,d,_)}touchend(c,d,_){const w=this._zoomIn.touchend(c,d,_),T=this._zoomOut.touchend(c,d,_),U=this._tr;return w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:U.zoom+1,around:U.unproject(w)},{originalEvent:c})}):T?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:U.zoom-1,around:U.unproject(T)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gl{constructor(c){this._enabled=!!c.enable,this._moveStateManager=c.moveStateManager,this._clickTolerance=c.clickTolerance||1,this._moveFunction=c.move,this._activateOnStart=!!c.activateOnStart,c.assignEvents(this),this.reset()}reset(c){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(c)}_move(){const c=this._moveFunction(...arguments);if(c.bearingDelta||c.pitchDelta||c.around||c.panDelta)return this._active=!0,c}dragStart(c,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(c)&&(this._moveStateManager.startMove(c),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(c,d){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(c.preventDefault(),!this._moveStateManager.isValidMoveEvent(c))return void this.reset(c);const w=d.length?d[0]:d;return!this._moved&&w.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=w,this._move(_,w))}dragEnd(c){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(c)&&(this._moved&&x.suppressClick(),this.reset(c))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const _p={0:1,2:2};class dA{constructor(c){this._correctEvent=c.checkCorrectEvent}startMove(c){const d=x.mouseButton(c);this._eventButton=d}endMove(c){delete this._eventButton}isValidStartEvent(c){return this._correctEvent(c)}isValidMoveEvent(c){return!function(d,_){const w=_p[_];return d.buttons===void 0||(d.buttons&w)!==w}(c,this._eventButton)}isValidEndEvent(c){return x.mouseButton(c)===this._eventButton}}class li{constructor(){this._firstTouch=void 0}_isOneFingerTouch(c){return c.targetTouches.length===1}_isSameTouchEvent(c){return c.targetTouches[0].identifier===this._firstTouch}startMove(c){this._firstTouch=c.targetTouches[0].identifier}endMove(c){delete this._firstTouch}isValidStartEvent(c){return this._isOneFingerTouch(c)}isValidMoveEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}isValidEndEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}}const xa=C=>{C.mousedown=C.dragStart,C.mousemoveWindow=C.dragMove,C.mouseup=C.dragEnd,C.contextmenu=c=>{c.preventDefault()}},zs=C=>{let{enable:c,clickTolerance:d,bearingDegreesPerPixelMoved:_=.8}=C;const w=new dA({checkCorrectEvent:T=>x.mouseButton(T)===0&&T.ctrlKey||x.mouseButton(T)===2});return new Gl({clickTolerance:d,move:(T,U)=>({bearingDelta:(U.x-T.x)*_}),moveStateManager:w,enable:c,assignEvents:xa})},_u=C=>{let{enable:c,clickTolerance:d,pitchDegreesPerPixelMoved:_=-.5}=C;const w=new dA({checkCorrectEvent:T=>x.mouseButton(T)===0&&T.ctrlKey||x.mouseButton(T)===2});return new Gl({clickTolerance:d,move:(T,U)=>({pitchDelta:(U.y-T.y)*_}),moveStateManager:w,enable:c,assignEvents:xa})};class vu{constructor(c,d){this._clickTolerance=c.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(c,d,_){return this._calculateTransform(c,d,_)}touchmove(c,d,_){if(this._active&&!(_.length<this.minTouchs()))return c.preventDefault(),this._calculateTransform(c,d,_)}touchend(c,d,_){this._calculateTransform(c,d,_),this._active&&_.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,d,_){_.length>0&&(this._active=!0);const w=eo(_,d),T=new o.P(0,0),U=new o.P(0,0);let g=0;for(const S in w){const F=w[S],M=this._touches[S];M&&(T._add(F),U._add(F.sub(M)),g++,w[S]=F)}if(this._touches=w,g<this.minTouchs()||!U.mag())return;const y=U.div(g);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(g),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _s{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(c,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(c,d,_){if(!this._firstTwoTouches)return;c.preventDefault();const[w,T]=this._firstTwoTouches,U=Si(_,d,w),g=Si(_,d,T);if(!U||!g)return;const y=this._aroundCenter?null:U.add(g).div(2);return this._move([U,g],y,c)}touchend(c,d,_){if(!this._firstTwoTouches)return;const[w,T]=this._firstTwoTouches,U=Si(_,d,w),g=Si(_,d,T);U&&g||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Si(C,c,d){for(let _=0;_<C.length;_++)if(C[_].identifier===d)return c[_]}function tl(C,c){return Math.log(C/c)/Math.LN2}class Lc extends _s{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,d){const _=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(tl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tl(this._distance,_),pinchAround:d}}}function ph(C,c){return 180*C.angleWith(c)/Math.PI}class bu extends _s{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,d,_){const w=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ph(this._vector,w),pinchAround:d}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const d=25/(Math.PI*this._minDiameter)*360,_=ph(c,this._startVector);return Math.abs(_)<d}}function Pc(C){return Math.abs(C.y)>Math.abs(C.x)}class fA extends _s{constructor(c){super(),this._currentTouchCount=0,this._map=c}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(c,d,_){super.touchstart(c,d,_),this._currentTouchCount=_.length}_start(c){this._lastPoints=c,Pc(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,d,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const w=c[0].sub(this._lastPoints[0]),T=c[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(w,T,_.timeStamp),this._valid?(this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+T.y)/2*-.5}):void 0}gestureBeginsVertically(c,d,_){if(this._valid!==void 0)return this._valid;const w=c.mag()>=2,T=d.mag()>=2;if(!w&&!T)return;if(!w||!T)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const U=c.y>0==d.y>0;return Pc(c)&&Pc(d)&&U}}const Ed={panStep:100,bearingStep:15,pitchStep:10};class Ba{constructor(c){this._tr=new Jn(c);const d=Ed;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let d=0,_=0,w=0,T=0,U=0;switch(c.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:c.shiftKey?_=-1:(c.preventDefault(),T=-1);break;case 39:c.shiftKey?_=1:(c.preventDefault(),T=1);break;case 38:c.shiftKey?w=1:(c.preventDefault(),U=-1);break;case 40:c.shiftKey?w=-1:(c.preventDefault(),U=1);break;default:return}return this._rotationDisabled&&(_=0,w=0),{cameraAnimation:g=>{const y=this._tr;g.easeTo({duration:300,easeId:"keyboardHandler",easing:gh,zoom:d?Math.round(y.zoom)+d*(c.shiftKey?2:1):y.zoom,bearing:y.bearing+_*this._bearingStep,pitch:y.pitch+w*this._pitchStep,offset:[-T*this._panStep,-U*this._panStep],center:y.center},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gh(C){return C*(2-C)}const wu=4.000244140625;class pA{constructor(c,d){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=c,this._tr=new Jn(c),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(c){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!c[this._map.cooperativeGestures._bypassKey])return;let d=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const _=b.now(),w=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%wu==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(w*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),c.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=c,this._delta-=d,this._active||this._start(c)),c.preventDefault()}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=x.mousePos(this._map.getCanvas(),c),_=this._tr;this._around=d.y>_.transform.height/2-_.transform.getHorizon()?o.M.convert(this._aroundCenter?_.center:_.unproject(d)):o.M.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._tr.transform;if(this._delta!==0){const g=this._type==="wheel"&&Math.abs(this._delta)>wu?this._wheelZoomRate:this._defaultZoomRate;let y=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&y!==0&&(y=1/y);const S=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):c.scale;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(S*y))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:c.zoom,_=this._startZoom,w=this._easing;let T,U=!1;if(this._type==="wheel"&&_&&w){const g=Math.min((b.now()-this._lastWheelEventTime)/200,1),y=w(g);T=o.z.number(_,d,y),g<1?this._frameId||(this._frameId=!0):U=!0}else T=d,U=!0;return this._active=!0,U&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!U,zoomDelta:T-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let d=o.b8;if(this._prevEase){const _=this._prevEase,w=(b.now()-_.start)/_.duration,T=_.easing(w+.01)-_.easing(w),U=.27/Math.sqrt(T*T+1e-4)*.01,g=Math.sqrt(.0729-U*U);d=o.b7(U,g,.25,1)}return this._prevEase={start:b.now(),duration:c,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Sd{constructor(c,d){this._clickZoom=c,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vp{constructor(c){this._tr=new Jn(c),this.reset()}reset(){this._active=!1}dblclick(c,d){return c.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(c.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Td{constructor(){this._tap=new Za({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(c,d,_){if(!this._swipePoint)if(this._tapTime){const w=d[0],T=c.timeStamp-this._tapTime<500,U=this._tapPoint.dist(w)<30;T&&U?_.length>0&&(this._swipePoint=w,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(c,d,_)}touchmove(c,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const w=d[0],T=w.y-this._swipePoint.y;return this._swipePoint=w,c.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(c,d,_)}touchend(c,d,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const w=this._tap.touchend(c,d,_);w&&(this._tapTime=c.timeStamp,this._tapPoint=w)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Id{constructor(c,d,_){this._el=c,this._mousePan=d,this._touchPan=_}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xu{constructor(c,d,_){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fd{constructor(c,d,_,w){this._el=c,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Io{constructor(c,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=c,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const c=this._map.getCanvasContainer();c.classList.add("maplibregl-cooperative-gestures"),this._container=x.create("div","maplibregl-cooperative-gesture-screen",c);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),w=document.createElement("div");w.className="maplibregl-desktop-message",w.textContent=d,this._container.appendChild(w);const T=document.createElement("div");T.className="maplibregl-mobile-message",T.textContent=_,this._container.appendChild(T),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(x.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(c){this._onCooperativeGesture(c.touches.length===1)}wheel(c){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!c[this._bypassKey])}_onCooperativeGesture(c){this._enabled&&c&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ro=C=>C.zoom||C.drag||C.pitch||C.rotate;class mh extends o.k{}function Vs(C){return C.panDelta&&C.panDelta.mag()||C.zoomDelta||C.bearingDelta||C.pitchDelta}class el{constructor(c,d){this.handleWindowEvent=w=>{this.handleEvent(w,`${w.type}Window`)},this.handleEvent=(w,T)=>{if(w.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const U=w.type==="renderFrame"?void 0:w,g={needsRenderFrame:!1},y={},S={},F=w.touches,M=F?this._getMapTouches(F):void 0,N=M?x.touchPos(this._map.getCanvas(),M):x.mousePos(this._map.getCanvas(),w);for(const{handlerName:j,handler:K,allowed:tt}of this._handlers){if(!K.isEnabled())continue;let ht;this._blockedByActive(S,tt,j)?K.reset():K[T||w.type]&&(ht=K[T||w.type](w,N,M),this.mergeHandlerResult(g,y,ht,j,U),ht&&ht.needsRenderFrame&&this._triggerRenderFrame()),(ht||K.isActive())&&(S[j]=K)}const k={};for(const j in this._previousActiveHandlers)S[j]||(k[j]=U);this._previousActiveHandlers=S,(Object.keys(k).length||Vs(g))&&(this._changes.push([g,y,k]),this._triggerRenderFrame()),(Object.keys(S).length||Vs(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=g;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vl(c),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,T,U]of this._listeners)x.addEventListener(w,T,w===document?this.handleWindowEvent:this.handleEvent,U)}destroy(){for(const[c,d,_]of this._listeners)x.removeEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(c){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new On(d,c));const w=d.boxZoom=new hi(d,c);this._add("boxZoom",w),c.interactive&&c.boxZoom&&w.enable();const T=d.cooperativeGestures=new Io(d,c.cooperativeGestures);this._add("cooperativeGestures",T),c.cooperativeGestures&&T.enable();const U=new Fc(d),g=new vp(d);d.doubleClickZoom=new Sd(g,U),this._add("tapZoom",U),this._add("clickZoom",g),c.interactive&&c.doubleClickZoom&&d.doubleClickZoom.enable();const y=new Td;this._add("tapDragZoom",y);const S=d.touchPitch=new fA(d);this._add("touchPitch",S),c.interactive&&c.touchPitch&&d.touchPitch.enable(c.touchPitch);const F=zs(c),M=_u(c);d.dragRotate=new xu(c,F,M),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),c.interactive&&c.dragRotate&&d.dragRotate.enable();const N=(ht=>{let{enable:rt,clickTolerance:At}=ht;const St=new dA({checkCorrectEvent:Ct=>x.mouseButton(Ct)===0&&!Ct.ctrlKey});return new Gl({clickTolerance:At,move:(Ct,yt)=>({around:yt,panDelta:yt.sub(Ct)}),activateOnStart:!0,moveStateManager:St,enable:rt,assignEvents:xa})})(c),k=new vu(c,d);d.dragPan=new Id(_,N,k),this._add("mousePan",N),this._add("touchPan",k,["touchZoom","touchRotate"]),c.interactive&&c.dragPan&&d.dragPan.enable(c.dragPan);const V=new bu,j=new Lc;d.touchZoomRotate=new Fd(_,j,V,y),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),c.interactive&&c.touchZoomRotate&&d.touchZoomRotate.enable(c.touchZoomRotate);const K=d.scrollZoom=new pA(d,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),c.interactive&&c.scrollZoom&&d.scrollZoom.enable(c.scrollZoom);const tt=d.keyboard=new Ba(d);this._add("keyboard",tt),c.interactive&&c.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new Xn(d))}_add(c,d,_){this._handlers.push({handlerName:c,handler:d,allowed:_}),this._handlersById[c]=d}stop(c){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ro(this._eventsInProgress)||this.isZooming()}_blockedByActive(c,d,_){for(const w in c)if(w!==_&&(!d||d.indexOf(w)<0))return!0;return!1}_getMapTouches(c){const d=[];for(const _ of c)this._el.contains(_.target)&&d.push(_);return d}mergeHandlerResult(c,d,_,w,T){if(!_)return;o.e(c,_);const U={handlerName:w,originalEvent:_.originalEvent||T};_.zoomDelta!==void 0&&(d.zoom=U),_.panDelta!==void 0&&(d.drag=U),_.pitchDelta!==void 0&&(d.pitch=U),_.bearingDelta!==void 0&&(d.rotate=U)}_applyChanges(){const c={},d={},_={};for(const[w,T,U]of this._changes)w.panDelta&&(c.panDelta=(c.panDelta||new o.P(0,0))._add(w.panDelta)),w.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(c.around=w.around),w.pinchAround!==void 0&&(c.pinchAround=w.pinchAround),w.noInertia&&(c.noInertia=w.noInertia),o.e(d,T),o.e(_,U);this._updateMapTransform(c,d,_),this._changes=[]}_updateMapTransform(c,d,_){const w=this._map,T=w._getTransformForUpdate(),U=w.terrain;if(!(Vs(c)||U&&this._terrainMovement))return this._fireEvents(d,_,!0);let{panDelta:g,zoomDelta:y,bearingDelta:S,pitchDelta:F,around:M,pinchAround:N}=c;N!==void 0&&(M=N),w._stop(!0),M=M||w.transform.centerPoint;const k=T.pointLocation(g?M.sub(g):M);S&&(T.bearing+=S),F&&(T.pitch+=F),y&&(T.zoom+=y),U?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?T.center=T.pointLocation(T.centerPoint.sub(g)):T.setLocationAtPoint(k,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,T.setLocationAtPoint(k,M)):T.setLocationAtPoint(k,M),w._applyUpdatedTransform(T),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(d,_,!0)}_fireEvents(c,d,_){const w=ro(this._eventsInProgress),T=ro(c),U={};for(const M in c){const{originalEvent:N}=c[M];this._eventsInProgress[M]||(U[`${M}start`]=N),this._eventsInProgress[M]=c[M]}!w&&T&&this._fireEvent("movestart",T.originalEvent);for(const M in U)this._fireEvent(M,U[M]);T&&this._fireEvent("move",T.originalEvent);for(const M in c){const{originalEvent:N}=c[M];this._fireEvent(M,N)}const g={};let y;for(const M in this._eventsInProgress){const{handlerName:N,originalEvent:k}=this._eventsInProgress[M];this._handlersById[N].isActive()||(delete this._eventsInProgress[M],y=d[N]||k,g[`${M}end`]=y)}for(const M in g)this._fireEvent(M,g[M]);const S=ro(this._eventsInProgress),F=(w||T)&&!S;if(F&&this._terrainMovement&&(this._map._elevationFreeze=!1,this._terrainMovement=!1,this._map.transform.recalculateZoom(this._map.terrain)),_&&F){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=k=>k!==0&&-this._bearingSnap<k&&k<this._bearingSnap;!M||!M.essential&&b.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:y})),N(this._map.getBearing())&&this._map.resetNorth()):(N(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:y})),this._updatingCamera=!1}}_fireEvent(c,d){this._map.fire(new o.k(c,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{delete this._frameId,this.handleEvent(new mh("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Qm extends o.E{constructor(c,d){super(),this._renderFrameCallback=()=>{const _=Math.min((b.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.M(this.transform.center.lng,this.transform.center.lat)}setCenter(c,d){return this.jumpTo({center:c},d)}panBy(c,d,_){return c=o.P.convert(c).mult(-1),this.panTo(this.transform.center,o.e({offset:c},d),_)}panTo(c,d,_){return this.easeTo(o.e({center:c},d),_)}getZoom(){return this.transform.zoom}setZoom(c,d){return this.jumpTo({zoom:c},d),this}zoomTo(c,d,_){return this.easeTo(o.e({zoom:c},d),_)}zoomIn(c,d){return this.zoomTo(this.getZoom()+1,c,d),this}zoomOut(c,d){return this.zoomTo(this.getZoom()-1,c,d),this}getBearing(){return this.transform.bearing}setBearing(c,d){return this.jumpTo({bearing:c},d),this}getPadding(){return this.transform.padding}setPadding(c,d){return this.jumpTo({padding:c},d),this}rotateTo(c,d,_){return this.easeTo(o.e({bearing:c},d),_)}resetNorth(c,d){return this.rotateTo(0,o.e({duration:1e3},c),d),this}resetNorthPitch(c,d){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},c),d),this}snapToNorth(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this}getPitch(){return this.transform.pitch}setPitch(c,d){return this.jumpTo({pitch:c},d),this}cameraForBounds(c,d){c=ke.convert(c);const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),_,d)}_cameraForBoxAndBearing(c,d,_,w){const T={top:0,bottom:0,right:0,left:0};if(typeof(w=o.e({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){const zt=w.padding;w.padding={top:zt,bottom:zt,right:zt,left:zt}}w.padding=o.e(T,w.padding);const U=this.transform,g=U.padding,y=new ke(c,d),S=U.project(y.getNorthWest()),F=U.project(y.getNorthEast()),M=U.project(y.getSouthEast()),N=U.project(y.getSouthWest()),k=o.b9(-_),V=S.rotate(k),j=F.rotate(k),K=M.rotate(k),tt=N.rotate(k),ht=new o.P(Math.max(V.x,j.x,tt.x,K.x),Math.max(V.y,j.y,tt.y,K.y)),rt=new o.P(Math.min(V.x,j.x,tt.x,K.x),Math.min(V.y,j.y,tt.y,K.y)),At=ht.sub(rt),St=(U.width-(g.left+g.right+w.padding.left+w.padding.right))/At.x,Ct=(U.height-(g.top+g.bottom+w.padding.top+w.padding.bottom))/At.y;if(Ct<0||St<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const yt=Math.min(U.scaleZoom(U.scale*Math.min(St,Ct)),w.maxZoom),Et=o.P.convert(w.offset),Wt=new o.P((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(o.b9(_)),Zt=Et.add(Wt).mult(U.scale/U.zoomScale(yt));return{center:U.unproject(S.add(M).div(2).sub(Zt)),zoom:yt,bearing:_}}fitBounds(c,d,_){return this._fitInternal(this.cameraForBounds(c,d),d,_)}fitScreenCoordinates(c,d,_,w,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(c)),this.transform.pointLocation(o.P.convert(d)),_,w),w,T)}_fitInternal(c,d,_){return c?(delete(d=o.e(c,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(c,d){this.stop();const _=this._getTransformForUpdate();let w=!1,T=!1,U=!1;return"zoom"in c&&_.zoom!==+c.zoom&&(w=!0,_.zoom=+c.zoom),c.center!==void 0&&(_.center=o.M.convert(c.center)),"bearing"in c&&_.bearing!==+c.bearing&&(T=!0,_.bearing=+c.bearing),"pitch"in c&&_.pitch!==+c.pitch&&(U=!0,_.pitch=+c.pitch),c.padding==null||_.isPaddingEqual(c.padding)||(_.padding=c.padding),this._applyUpdatedTransform(_),this.fire(new o.k("movestart",d)).fire(new o.k("move",d)),w&&this.fire(new o.k("zoomstart",d)).fire(new o.k("zoom",d)).fire(new o.k("zoomend",d)),T&&this.fire(new o.k("rotatestart",d)).fire(new o.k("rotate",d)).fire(new o.k("rotateend",d)),U&&this.fire(new o.k("pitchstart",d)).fire(new o.k("pitch",d)).fire(new o.k("pitchend",d)),this.fire(new o.k("moveend",d))}calculateCameraOptionsFromTo(c,d,_){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const T=o.Y.fromLngLat(c,d),U=o.Y.fromLngLat(_,w),g=U.x-T.x,y=U.y-T.y,S=U.z-T.z,F=Math.hypot(g,y,S);if(F===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(g,y),N=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),k=180*Math.atan2(g,-y)/Math.PI;let V=180*Math.acos(M/F)/Math.PI;return V=S<0?90-V:90+V,{center:U.toLngLat(),zoom:N,pitch:V,bearing:k}}easeTo(c,d){var _;this._stop(!1,c.easeId),((c=o.e({offset:[0,0],duration:500,easing:o.b8},c)).animate===!1||!c.essential&&b.prefersReducedMotion)&&(c.duration=0);const w=this._getTransformForUpdate(),T=this.getZoom(),U=this.getBearing(),g=this.getPitch(),y=this.getPadding(),S="bearing"in c?this._normalizeBearing(c.bearing,U):U,F="pitch"in c?+c.pitch:g,M="padding"in c?c.padding:w.padding,N=o.P.convert(c.offset);let k=w.centerPoint.add(N);const V=w.pointLocation(k),{center:j,zoom:K}=w.getConstrained(o.M.convert(c.center||V),(_=c.zoom)!==null&&_!==void 0?_:T);this._normalizeCenter(j);const tt=w.project(V),ht=w.project(j).sub(tt),rt=w.zoomScale(K-T);let At,St;c.around&&(At=o.M.convert(c.around),St=w.locationPoint(At));const Ct={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==T,this._rotating=this._rotating||U!==S,this._pitching=this._pitching||F!==g,this._padding=!w.isPaddingEqual(M),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,Ct),this.terrain&&this._prepareElevation(j),this._ease(yt=>{if(this._zooming&&(w.zoom=o.z.number(T,K,yt)),this._rotating&&(w.bearing=o.z.number(U,S,yt)),this._pitching&&(w.pitch=o.z.number(g,F,yt)),this._padding&&(w.interpolatePadding(y,M,yt),k=w.centerPoint.add(N)),this.terrain&&!c.freezeElevation&&this._updateElevation(yt),At)w.setLocationAtPoint(At,St);else{const Et=w.zoomScale(w.zoom-T),Wt=K>T?Math.min(2,rt):Math.max(.5,rt),Zt=Math.pow(Wt,1-yt),zt=w.unproject(tt.add(ht.mult(yt*Zt)).mult(Et));w.setLocationAtPoint(w.renderWorldCopies?zt.wrap():zt,k)}this._applyUpdatedTransform(w),this._fireMoveEvents(d)},yt=>{this.terrain&&c.freezeElevation&&this._finalizeElevation(),this._afterEase(d,yt)},c),this}_prepareEase(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,d||_.moving||this.fire(new o.k("movestart",c)),this._zooming&&!_.zooming&&this.fire(new o.k("zoomstart",c)),this._rotating&&!_.rotating&&this.fire(new o.k("rotatestart",c)),this._pitching&&!_.pitching&&this.fire(new o.k("pitchstart",c))}_prepareElevation(c){this._elevationCenter=c,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(c){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(c<1&&d!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=c*(_-(d-(_*c+this._elevationStart))/(1-c)),this._elevationTarget=d}this.transform.elevation=o.z.number(this._elevationStart,this._elevationTarget,c)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(c){if(!this.transformCameraUpdate)return;const d=c.clone(),{center:_,zoom:w,pitch:T,bearing:U,elevation:g}=this.transformCameraUpdate(d);_&&(d.center=_),w!==void 0&&(d.zoom=w),T!==void 0&&(d.pitch=T),U!==void 0&&(d.bearing=U),g!==void 0&&(d.elevation=g),this.transform.apply(d)}_fireMoveEvents(c){this.fire(new o.k("move",c)),this._zooming&&this.fire(new o.k("zoom",c)),this._rotating&&this.fire(new o.k("rotate",c)),this._pitching&&this.fire(new o.k("pitch",c))}_afterEase(c,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const _=this._zooming,w=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new o.k("zoomend",c)),w&&this.fire(new o.k("rotateend",c)),T&&this.fire(new o.k("pitchend",c)),this.fire(new o.k("moveend",c))}flyTo(c,d){var _;if(!c.essential&&b.prefersReducedMotion){const Ee=o.L(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ee,d)}this.stop(),c=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.b8},c);const w=this._getTransformForUpdate(),T=this.getZoom(),U=this.getBearing(),g=this.getPitch(),y=this.getPadding(),S="bearing"in c?this._normalizeBearing(c.bearing,U):U,F="pitch"in c?+c.pitch:g,M="padding"in c?c.padding:w.padding,N=o.P.convert(c.offset);let k=w.centerPoint.add(N);const V=w.pointLocation(k),{center:j,zoom:K}=w.getConstrained(o.M.convert(c.center||V),(_=c.zoom)!==null&&_!==void 0?_:T);this._normalizeCenter(j);const tt=w.zoomScale(K-T),ht=w.project(V),rt=w.project(j).sub(ht);let At=c.curve;const St=Math.max(w.width,w.height),Ct=St/tt,yt=rt.mag();if("minZoom"in c){const Ee=o.ac(Math.min(c.minZoom,T,K),w.minZoom,w.maxZoom),$e=St/w.zoomScale(Ee-T);At=Math.sqrt($e/yt*2)}const Et=At*At;function Wt(Ee){const $e=(Ct*Ct-St*St+(Ee?-1:1)*Et*Et*yt*yt)/(2*(Ee?Ct:St)*Et*yt);return Math.log(Math.sqrt($e*$e+1)-$e)}function Zt(Ee){return(Math.exp(Ee)-Math.exp(-Ee))/2}function zt(Ee){return(Math.exp(Ee)+Math.exp(-Ee))/2}const ae=Wt(!1);let de=function(Ee){return zt(ae)/zt(ae+At*Ee)},Me=function(Ee){return St*((zt(ae)*(Zt($e=ae+At*Ee)/zt($e))-Zt(ae))/Et)/yt;var $e},le=(Wt(!0)-ae)/At;if(Math.abs(yt)<1e-6||!isFinite(le)){if(Math.abs(St-Ct)<1e-6)return this.easeTo(c,d);const Ee=Ct<St?-1:1;le=Math.abs(Math.log(Ct/St))/At,Me=()=>0,de=$e=>Math.exp(Ee*At*$e)}return c.duration="duration"in c?+c.duration:1e3*le/("screenSpeed"in c?+c.screenSpeed/At:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==S,this._pitching=F!==g,this._padding=!w.isPaddingEqual(M),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(j),this._ease(Ee=>{const $e=Ee*le,Tr=1/de($e);w.zoom=Ee===1?K:T+w.scaleZoom(Tr),this._rotating&&(w.bearing=o.z.number(U,S,Ee)),this._pitching&&(w.pitch=o.z.number(g,F,Ee)),this._padding&&(w.interpolatePadding(y,M,Ee),k=w.centerPoint.add(N)),this.terrain&&!c.freezeElevation&&this._updateElevation(Ee);const Je=Ee===1?j:w.unproject(ht.add(rt.mult(Me($e))).mult(Tr));w.setLocationAtPoint(w.renderWorldCopies?Je.wrap():Je,k),this._applyUpdatedTransform(w),this._fireMoveEvents(d)},()=>{this.terrain&&c.freezeElevation&&this._finalizeElevation(),this._afterEase(d)},c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,d){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,d)}return c||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(c,d,_){_.animate===!1||_.duration===0?(c(1),d()):(this._easeStart=b.now(),this._easeOptions=_,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(c,d){c=o.b2(c,-180,180);const _=Math.abs(c-d);return Math.abs(c-360-d)<_&&(c-=360),Math.abs(c+360-d)<_&&(c+=360),c}_normalizeCenter(c){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const _=c.lng-d.center.lng;c.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(c){return this.terrain?this.terrain.getElevationForLngLatZoom(o.M.convert(c),this.transform.tileZoom)-this.transform.elevation:null}}const bp={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ld{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:bp;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=c}getDefaultPosition(){return"bottom-right"}onAdd(c){return this._map=c,this._compact=this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(c,d){const _=this._map._getUIString(`AttributionControl.${d}`);c.title=_,c.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(w=>typeof w!="string"?"":w)):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const d=this._map.style.sourceCaches;for(const w in d){const T=d[w];if(T.used||T.usedForTerrain){const U=T.getSource();U.attribution&&c.indexOf(U.attribution)<0&&c.push(U.attribution)}}c=c.filter(w=>String(w).trim()),c.sort((w,T)=>w.length-T.length),c=c.filter((w,T)=>{for(let U=T+1;U<c.length;U++)if(c[U].indexOf(w)>=0)return!1;return!0});const _=c.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,c.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Pd{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const d=this._container.children;if(d.length){const _=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=c}getDefaultPosition(){return"bottom-left"}onAdd(c){this._map=c,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const d=x.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class gA{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const d=++this._id;return this._queue.push({callback:c,id:d,cancelled:!1}),d}remove(c){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const w of _)if(w.id===c)return void(w.cancelled=!0)}run(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var jl=o.X([{name:"a_pos3d",type:"Int16",components:3}]);class tr extends o.E{constructor(c){super(),this.sourceCache=c,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,c.usedForTerrain=!0,c.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(c,d){this.sourceCache.update(c,d),this._renderableTilesKeys=[];const _={};for(const w of c.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))_[w.key]=!0,this._renderableTilesKeys.push(w.key),this._tiles[w.key]||(w.posMatrix=new Float64Array(16),o.aO(w.posMatrix,0,o.W,0,o.W,0,1),this._tiles[w.key]=new xr(w,this.tileSize));for(const w in this._tiles)_[w]||delete this._tiles[w]}freeRtt(c){for(const d in this._tiles){const _=this._tiles[d];(!c||_.tileID.equals(c)||_.tileID.isChildOf(c)||c.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(c=>this.getTileByID(c))}getTileByID(c){return this._tiles[c]}getTerrainCoords(c){const d={};for(const _ of this._renderableTilesKeys){const w=this._tiles[_].tileID;if(w.canonical.equals(c.canonical)){const T=c.clone();T.posMatrix=new Float64Array(16),o.aO(T.posMatrix,0,o.W,0,o.W,0,1),d[_]=T}else if(w.canonical.isChildOf(c.canonical)){const T=c.clone();T.posMatrix=new Float64Array(16);const U=w.canonical.z-c.canonical.z,g=w.canonical.x-(w.canonical.x>>U<<U),y=w.canonical.y-(w.canonical.y>>U<<U),S=o.W>>U;o.aO(T.posMatrix,0,S,0,S,0,1),o.H(T.posMatrix,T.posMatrix,[-g*S,-y*S,0]),d[_]=T}else if(c.canonical.isChildOf(w.canonical)){const T=c.clone();T.posMatrix=new Float64Array(16);const U=c.canonical.z-w.canonical.z,g=c.canonical.x-(c.canonical.x>>U<<U),y=c.canonical.y-(c.canonical.y>>U<<U),S=o.W>>U;o.aO(T.posMatrix,0,o.W,0,o.W,0,1),o.H(T.posMatrix,T.posMatrix,[g*S,y*S,0]),o.J(T.posMatrix,T.posMatrix,[1/2**U,1/2**U,0]),d[_]=T}}return d}getSourceTile(c,d){const _=this.sourceCache._source;let w=c.overscaledZ-this.deltaZoom;if(w>_.maxzoom&&(w=_.maxzoom),w<_.minzoom)return null;this._sourceTileCache[c.key]||(this._sourceTileCache[c.key]=c.scaledTo(w).key);let T=this.sourceCache.getTileByID(this._sourceTileCache[c.key]);if((!T||!T.dem)&&d)for(;w>=_.minzoom&&(!T||!T.dem);)T=this.sourceCache.getTileByID(c.scaledTo(w--).key);return T}tilesAfterTime(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(d=>d.timeAdded>=c)}}class rl{constructor(c,d,_){this.painter=c,this.sourceCache=new tr(d),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(c,d,_){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.W;var T;if(!(d>=0&&d<w&&_>=0&&_<w))return 0;const U=this.getTerrainData(c),g=(T=U.tile)===null||T===void 0?void 0:T.dem;if(!g)return 0;const y=function(V,j,K){var tt=j[0],ht=j[1];return V[0]=K[0]*tt+K[4]*ht+K[12],V[1]=K[1]*tt+K[5]*ht+K[13],V}([],[d/w*o.W,_/w*o.W],U.u_terrain_matrix),S=[y[0]*g.dim,y[1]*g.dim],F=Math.floor(S[0]),M=Math.floor(S[1]),N=S[0]-F,k=S[1]-M;return g.get(F,M)*(1-N)*(1-k)+g.get(F+1,M)*N*(1-k)+g.get(F,M+1)*(1-N)*k+g.get(F+1,M+1)*N*k}getElevationForLngLatZoom(c,d){const{tileID:_,mercatorX:w,mercatorY:T}=this._getOverscaledTileIDFromLngLatZoom(c,d);return this.getElevation(_,w%o.W,T%o.W,o.W)}getElevation(c,d,_){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.W;return this.getDEMElevation(c,d,_,w)*this.exaggeration}getTerrainData(c){if(!this._emptyDemTexture){const w=this.painter.context,T=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new at(w,T,w.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new at(w,new o.R({width:1,height:1}),w.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.an([])}const d=this.sourceCache.getSourceTile(c,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const w=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new at(w,d.dem.getPixels(),w.gl.RGBA,{premultiply:!1}),d.demTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const _=d&&d+d.tileID.key+c.key;if(_&&!this._demMatrixCache[_]){const w=this.sourceCache.sourceCache._source.maxzoom;let T=c.canonical.z-d.tileID.canonical.z;c.overscaledZ>c.canonical.z&&(c.canonical.z>=w?T=c.canonical.z-w:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const U=c.canonical.x-(c.canonical.x>>T<<T),g=c.canonical.y-(c.canonical.y>>T<<T),y=o.ba(new Float64Array(16),[1/(o.W<<T),1/(o.W<<T),0]);o.H(y,y,[U*o.W,g*o.W,0]),this._demMatrixCache[c.key]={matrix:y,coord:c}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[c.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(c){const d=this.painter,_=d.width/devicePixelRatio,w=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===w||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new at(d.context,{width:_,height:w,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new at(d.context,{width:_,height:w,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(_,w,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,_,w))),this._fbo.colorAttachment.set(c==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const c=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let T=0,U=0;T<this._coordsTextureSize;T++)for(let g=0;g<this._coordsTextureSize;g++,U+=4)d[U+0]=255&g,d[U+1]=255&T,d[U+2]=g>>8<<4|T>>8,d[U+3]=0;const _=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),w=new at(c,_,c.gl.RGBA,{premultiply:!1});return w.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._coordsTexture=w,w}pointCoordinate(c){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),_=this.painter.context,w=_.gl,T=Math.round(c.x*this.painter.pixelRatio/devicePixelRatio),U=Math.round(c.y*this.painter.pixelRatio/devicePixelRatio),g=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),w.readPixels(T,g-U-1,1,1,w.RGBA,w.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null);const y=d[0]+(d[2]>>4<<8),S=d[1]+((15&d[2])<<8),F=this.coordsIndex[255-d[3]],M=F&&this.sourceCache.getTileByID(F);if(!M)return null;const N=this._coordsTextureSize,k=(1<<M.tileID.canonical.z)*N;return new o.Y((M.tileID.canonical.x*N+y)/k+M.tileID.wrap,(M.tileID.canonical.y*N+S)/k,this.getElevation(M.tileID,y,S,N))}depthAtPoint(c){const d=new Uint8Array(4),_=this.painter.context,w=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),w.readPixels(c.x,this.painter.height/devicePixelRatio-c.y-1,1,1,w.RGBA,w.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const c=this.painter.context,d=new o.bb,_=new o.aY,w=this.meshSize,T=o.W/w,U=w*w;for(let M=0;M<=w;M++)for(let N=0;N<=w;N++)d.emplaceBack(N*T,M*T,0);for(let M=0;M<U;M+=w+1)for(let N=0;N<w;N++)_.emplaceBack(N+M,w+N+M+1,w+N+M+2),_.emplaceBack(N+M,w+N+M+2,N+M+1);const g=d.length,y=g+2*(w+1);for(const M of[0,1])for(let N=0;N<=w;N++)for(const k of[0,1])d.emplaceBack(N*T,M*o.W,k);for(let M=0;M<2*w;M+=2)_.emplaceBack(y+M,y+M+1,y+M+3),_.emplaceBack(y+M,y+M+3,y+M+2),_.emplaceBack(g+M,g+M+3,g+M+1),_.emplaceBack(g+M,g+M+2,g+M+3);const S=d.length,F=S+2*(w+1);for(const M of[0,1])for(let N=0;N<=w;N++)for(const k of[0,1])d.emplaceBack(M*o.W,N*T,k);for(let M=0;M<2*w;M+=2)_.emplaceBack(S+M,S+M+1,S+M+3),_.emplaceBack(S+M,S+M+3,S+M+2),_.emplaceBack(F+M,F+M+3,F+M+1),_.emplaceBack(F+M,F+M+2,F+M+3);return this._mesh={indexBuffer:c.createIndexBuffer(_),vertexBuffer:c.createVertexBuffer(d,jl.members),segments:o.$.simpleSegment(0,0,d.length,_.length)},this._mesh}getMeshFrameDelta(c){return 2*Math.PI*o.bc/Math.pow(2,c)/5}getMinTileElevationForLngLatZoom(c,d){var _;const{tileID:w}=this._getOverscaledTileIDFromLngLatZoom(c,d);return(_=this.getMinMaxElevation(w).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(c){const d=this.getTerrainData(c).tile,_={minElevation:null,maxElevation:null};return d&&d.dem&&(_.minElevation=d.dem.min*this.exaggeration,_.maxElevation=d.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(c,d){const _=o.Y.fromLngLat(c.wrap()),w=(1<<d)*o.W,T=_.x*w,U=_.y*w,g=Math.floor(T/o.W),y=Math.floor(U/o.W);return{tileID:new o.Q(d,0,d,g,y),mercatorX:T,mercatorY:U}}}class Es{constructor(c,d,_){this._context=c,this._size=d,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const c of this._objects)c.texture.destroy(),c.fbo.destroy()}_createObject(c){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new at(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(_.texture),{id:c,fbo:d,texture:_,stamp:-1,inUse:!1}}getObjectForId(c){return this._objects[c]}useObject(c){c.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>c.id!==d),this._recentlyUsed.push(c.id)}stampObject(c){c.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const c=this._createObject(this._objects.length);return this._objects.push(c),c}freeObject(c){c.inUse=!1}freeAllObjects(){for(const c of this._objects)this.freeObject(c)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(c=>!c.inUse)===!1}}const ji={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class wp{constructor(c,d){this.painter=c,this.terrain=d,this.pool=new Es(c.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(c){return this.pool.getObjectForId(c.rtt[this._stacks.length-1].id).texture}prepareForRender(c,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=c._order.filter(_=>!c._layers[_].isHidden(d)),this._coordsDescendingInv={};for(const _ in c.sourceCaches){this._coordsDescendingInv[_]={};const w=c.sourceCaches[_].getVisibleCoordinates();for(const T of w){const U=this.terrain.sourceCache.getTerrainCoords(T);for(const g in U)this._coordsDescendingInv[_][g]||(this._coordsDescendingInv[_][g]=[]),this._coordsDescendingInv[_][g].push(U[g])}}this._coordsDescendingInvStr={};for(const _ of c._order){const w=c._layers[_],T=w.source;if(ji[w.type]&&!this._coordsDescendingInvStr[T]){this._coordsDescendingInvStr[T]={};for(const U in this._coordsDescendingInv[T])this._coordsDescendingInvStr[T][U]=this._coordsDescendingInv[T][U].map(g=>g.key).sort().join()}}for(const _ of this._renderableTiles)for(const w in this._coordsDescendingInvStr){const T=this._coordsDescendingInvStr[w][_.tileID.key];T&&T!==_.rttCoords[w]&&(_.rtt=[])}}renderLayer(c){if(c.isHidden(this.painter.transform.zoom))return!1;const d=c.type,_=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===c.id;if(ji[d]&&(this._prevType&&ji[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(c.id),!w))return!0;if(ji[this._prevType]||ji[d]&&w){this._prevType=d;const T=this._stacks.length-1,U=this._stacks[T]||[];for(const g of this._renderableTiles){if(this.pool.isFull()&&(Yo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(g),g.rtt[T]){const S=this.pool.getObjectForId(g.rtt[T].id);if(S.stamp===g.rtt[T].stamp){this.pool.useObject(S);continue}}const y=this.pool.getOrCreateFreeObject();this.pool.useObject(y),this.pool.stampObject(y),g.rtt[T]={id:y.id,stamp:y.stamp},_.context.bindFramebuffer.set(y.fbo.framebuffer),_.context.clear({color:o.aP.transparent,stencil:0}),_.currentStencilSource=void 0;for(let S=0;S<U.length;S++){const F=_.style._layers[U[S]],M=F.source?this._coordsDescendingInv[F.source][g.tileID.key]:[g.tileID];_.context.viewport.set([0,0,y.fbo.width,y.fbo.height]),_._renderTileClippingMasks(F,M),_.renderLayer(_,_.style.sourceCaches[F.source],F,M),F.source&&(g.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][g.tileID.key])}}return Yo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ji[d]}return!1}}const Ke={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ca=h,Fo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:bp,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},xp=C=>{C.touchstart=C.dragStart,C.touchmoveWindow=C.dragMove,C.touchend=C.dragEnd},Md={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ud{constructor(c,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=U=>{this.startMouse(o.e({},U,{ctrlKey:!0,preventDefault:()=>U.preventDefault()}),x.mousePos(this.element,U)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=U=>{this.moveMouse(U,x.mousePos(this.element,U))},this.mouseup=U=>{this.mouseRotate.dragEnd(U),this.mousePitch&&this.mousePitch.dragEnd(U),this.offTemp()},this.touchstart=U=>{U.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,U.targetTouches)[0],this.startTouch(U,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=U=>{U.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,U.targetTouches)[0],this.moveTouch(U,this._lastPos))},this.touchend=U=>{U.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const w=c.dragRotate._mouseRotate.getClickTolerance(),T=c.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=zs({clickTolerance:w,enable:!0}),this.touchRotate=(U=>{let{enable:g,clickTolerance:y,bearingDegreesPerPixelMoved:S=.8}=U;const F=new li;return new Gl({clickTolerance:y,move:(M,N)=>({bearingDelta:(N.x-M.x)*S}),moveStateManager:F,enable:g,assignEvents:xp})})({clickTolerance:w,enable:!0}),this.map=c,_&&(this.mousePitch=_u({clickTolerance:T,enable:!0}),this.touchPitch=(U=>{let{enable:g,clickTolerance:y,pitchDegreesPerPixelMoved:S=-.5}=U;const F=new li;return new Gl({clickTolerance:y,move:(M,N)=>({pitchDelta:(N.y-M.y)*S}),moveStateManager:F,enable:g,assignEvents:xp})})({clickTolerance:T,enable:!0})),x.addEventListener(d,"mousedown",this.mousedown),x.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(d,"touchcancel",this.reset)}startMouse(c,d){this.mouseRotate.dragStart(c,d),this.mousePitch&&this.mousePitch.dragStart(c,d),x.disableDrag()}startTouch(c,d){this.touchRotate.dragStart(c,d),this.touchPitch&&this.touchPitch.dragStart(c,d),x.disableDrag()}moveMouse(c,d){const _=this.map,{bearingDelta:w}=this.mouseRotate.dragMove(c,d)||{};if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const{pitchDelta:T}=this.mousePitch.dragMove(c,d)||{};T&&_.setPitch(_.getPitch()+T)}}moveTouch(c,d){const _=this.map,{bearingDelta:w}=this.touchRotate.dragMove(c,d)||{};if(w&&_.setBearing(_.getBearing()+w),this.touchPitch){const{pitchDelta:T}=this.touchPitch.dragMove(c,d)||{};T&&_.setPitch(_.getPitch()+T)}}off(){const c=this.element;x.removeEventListener(c,"mousedown",this.mousedown),x.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(c,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let nl;function Rd(C,c,d){const _=new o.M(C.lng,C.lat);if(C=new o.M(C.lng,C.lat),c){const w=new o.M(C.lng-360,C.lat),T=new o.M(C.lng+360,C.lat),U=d.locationPoint(C).distSqr(c);d.locationPoint(w).distSqr(c)<U?C=w:d.locationPoint(T).distSqr(c)<U&&(C=T)}for(;Math.abs(C.lng-d.center.lng)>180;){const w=d.locationPoint(C);if(w.x>=0&&w.y>=0&&w.x<=d.width&&w.y<=d.height)break;C.lng>d.center.lng?C.lng-=360:C.lng+=360}return C.lng!==_.lng&&d.locationPoint(C).y>d.height/2-d.getHorizon()?C:_}const yh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ql(C,c,d){const _=C.classList;for(const w in yh)_.remove(`maplibregl-${d}-anchor-${w}`);_.add(`maplibregl-${d}-anchor-${c}`)}class En extends o.E{constructor(c){if(super(),this._onKeyPress=d=>{const _=d.code,w=d.charCode||d.keyCode;_!=="Space"&&_!=="Enter"&&w!==32&&w!==13||this.togglePopup()},this._onMapClick=d=>{const _=d.originalEvent.target,w=this._element;this._popup&&(_===w||w.contains(_))&&this.togglePopup()},this._update=d=>{var _;if(!this._map)return;const w=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!w)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Rd(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let T="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?T=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(T=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let U="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?U="rotateX(0deg)":this._pitchAlignment==="map"&&(U=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${yh[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${U} ${T}`),b.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(c==null?void 0:c.opacity,c==null?void 0:c.opacityWhenCovered),c&&c.element)this._element=c.element,this._offset=o.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const d=x.createNS("http://www.w3.org/2000/svg","svg"),_=41,w=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${_}px`),d.setAttributeNS(null,"width",`${w}px`),d.setAttributeNS(null,"viewBox",`0 0 ${w} ${_}`);const T=x.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const U=x.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill-rule","nonzero");const g=x.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(3.0, 29.0)"),g.setAttributeNS(null,"fill","#000000");const y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const tt of y){const ht=x.createNS("http://www.w3.org/2000/svg","ellipse");ht.setAttributeNS(null,"opacity","0.04"),ht.setAttributeNS(null,"cx","10.5"),ht.setAttributeNS(null,"cy","5.80029008"),ht.setAttributeNS(null,"rx",tt.rx),ht.setAttributeNS(null,"ry",tt.ry),g.appendChild(ht)}const S=x.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill",this._color);const F=x.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),S.appendChild(F);const M=x.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const N=x.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(N);const k=x.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(6.0, 7.0)"),k.setAttributeNS(null,"fill","#FFFFFF");const V=x.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const j=x.createNS("http://www.w3.org/2000/svg","circle");j.setAttributeNS(null,"fill","#000000"),j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962");const K=x.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),V.appendChild(j),V.appendChild(K),U.appendChild(g),U.appendChild(S),U.appendChild(M),U.appendChild(k),U.appendChild(V),d.appendChild(U),d.setAttributeNS(null,"height",_*this._scale+"px"),d.setAttributeNS(null,"width",w*this._scale+"px"),this._element.appendChild(d),this._offset=o.P.convert(c&&c.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),ql(this._element,this._anchor,"marker"),c&&c.className)for(const d of c.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),c.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=o.M.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const w=Math.abs(13.5)/Math.SQRT2;c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const c=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:c?(c.isOpen()?c.remove():(c.setLngLat(this._lngLat),c.addTo(this._map)),this):this}_updateOpacity(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var d,_;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(c)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const w=this._map,T=w.terrain.depthAtPoint(this._pos),U=w.terrain.getElevationForLngLatZoom(this._lngLat,w.transform.tileZoom);if(w.transform.lngLatToCameraDepth(this._lngLat,U)-T<.006)return void(this._element.style.opacity=this._opacity);const g=-this._offset.y/w.transform._pixelPerMeter,y=Math.sin(w.getPitch()*Math.PI/180)*g,S=w.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),F=w.transform.lngLatToCameraDepth(this._lngLat,U+y)-S>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(c){return this._offset=o.P.convert(c),this._update(),this}addClassName(c){this._element.classList.add(c)}removeClassName(c){this._element.classList.remove(c)}toggleClassName(c){return this._element.classList.toggle(c)}setDraggable(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(c,d){return c===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),c!==void 0&&(this._opacity=c),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Mc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ea=0,Kl=!1;const Od={maxWidth:100,unit:"metric"};function Dd(C,c,d){const _=d&&d.maxWidth||100,w=C._container.clientHeight/2,T=C.unproject([0,w]),U=C.unproject([_,w]),g=T.distanceTo(U);if(d&&d.unit==="imperial"){const y=3.2808*g;y>5280?Bu(c,_,y/5280,C._getUIString("ScaleControl.Miles")):Bu(c,_,y,C._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Bu(c,_,g/1852,C._getUIString("ScaleControl.NauticalMiles")):g>=1e3?Bu(c,_,g/1e3,C._getUIString("ScaleControl.Kilometers")):Bu(c,_,g,C._getUIString("ScaleControl.Meters"))}function Bu(C,c,d,_){const w=function(T){const U=Math.pow(10,`${Math.floor(T)}`.length-1);let g=T/U;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:g>=1?1:function(y){const S=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*S)/S}(g),U*g}(d);C.style.width=c*(w/d)+"px",C.innerHTML=`${w}&nbsp;${_}`}const Sa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},_h=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function dr(C){if(C){if(typeof C=="number"){const c=Math.round(Math.abs(C)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,C),"top-left":new o.P(c,c),"top-right":new o.P(-c,c),bottom:new o.P(0,-C),"bottom-left":new o.P(c,-c),"bottom-right":new o.P(-c,-c),left:new o.P(C,0),right:new o.P(-C,0)}}if(C instanceof o.P||Array.isArray(C)){const c=o.P.convert(C);return{center:c,top:c,"top-left":c,"top-right":c,bottom:c,"bottom-left":c,"bottom-right":c,left:c,right:c}}return{center:o.P.convert(C.center||[0,0]),top:o.P.convert(C.top||[0,0]),"top-left":o.P.convert(C["top-left"]||[0,0]),"top-right":o.P.convert(C["top-right"]||[0,0]),bottom:o.P.convert(C.bottom||[0,0]),"bottom-left":o.P.convert(C["bottom-left"]||[0,0]),"bottom-right":o.P.convert(C["bottom-right"]||[0,0]),left:o.P.convert(C.left||[0,0]),right:o.P.convert(C.right||[0,0])}}return dr(new o.P(0,0))}const Fr=h;a.AJAXError=o.bf,a.Evented=o.E,a.LngLat=o.M,a.MercatorCoordinate=o.Y,a.Point=o.P,a.addProtocol=o.bg,a.config=o.a,a.removeProtocol=o.bh,a.AttributionControl=Ld,a.BoxZoomHandler=hi,a.CanvasSource=nr,a.CooperativeGesturesHandler=Io,a.DoubleClickZoomHandler=Sd,a.DragPanHandler=Id,a.DragRotateHandler=xu,a.EdgeInsets=Ns,a.FullscreenControl=class extends o.E{constructor(){let C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var c;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((c=d==null?void 0:d.shadowRoot)===null||c===void 0)&&c.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,C&&C.container&&(C.container instanceof HTMLElement?this._container=C.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(C){return this._map=C,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const C=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",C).setAttribute("aria-hidden","true"),C.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const C=this._getTitle();this._fullscreenButton.setAttribute("aria-label",C),this._fullscreenButton.title=C}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=pe,a.GeolocateControl=class extends o.E{constructor(C){super(),this._onSuccess=c=>{if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",c)),this._finish()}},this._updateCamera=c=>{const d=new o.M(c.coords.longitude,c.coords.latitude),_=c.coords.accuracy,w=this._map.getBearing(),T=o.e({bearing:w},this.options.fitBoundsOptions),U=ke.fromLngLat(d,_);this._map.fitBounds(U,T,{geolocateSource:!0})},this._updateMarker=c=>{if(c){const d=new o.M(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=c=>{if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Kl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",c)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=c=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new En({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new En({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},Mc,C)}onAdd(C){return this._map=C,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return o._(this,arguments,void 0,function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(nl!==void 0&&!c)return nl;if(window.navigator.permissions===void 0)return nl=!!window.navigator.geolocation,nl;try{nl=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{nl=!!window.navigator.geolocation}return nl}()})}().then(c=>this._setupUI(c)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ea=0,Kl=!1}_isOutOfMapMaxBounds(C){const c=this._map.getMaxBounds(),d=C.coords;return c&&(d.longitude<c.getWest()||d.longitude>c.getEast()||d.latitude<c.getSouth()||d.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const C=this._map.getBounds(),c=C.getSouthEast(),d=C.getNorthEast(),_=c.distanceTo(d),w=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${w}px`,this._circleElement.style.height=`${w}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ea--,Kl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let C;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ea++,Ea>1?(C={maximumAge:6e5,timeout:0},Kl=!0):(C=this.options.positionOptions,Kl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,C)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.Hash=Hl,a.ImageSource=Ie,a.KeyboardHandler=Ba,a.LngLatBounds=ke,a.LogoControl=Pd,a.Map=class extends Qm{constructor(C){if(o.bd.mark(o.be.create),(C=o.e({},Fo,C)).minZoom!=null&&C.maxZoom!=null&&C.minZoom>C.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(C.minPitch!=null&&C.maxPitch!=null&&C.minPitch>C.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(C.minPitch!=null&&C.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(C.maxPitch!=null&&C.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ql(C.minZoom,C.maxZoom,C.minPitch,C.maxPitch,C.renderWorldCopies),{bearingSnap:C.bearingSnap}),this._contextLost=c=>{c.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:c}))},this._contextRestored=c=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:c}))},this._onMapScroll=c=>{if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=C.interactive,this._maxTileCacheSize=C.maxTileCacheSize,this._maxTileCacheZoomLevels=C.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=C.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=C.preserveDrawingBuffer,this._antialias=C.antialias,this._trackResize=C.trackResize,this._bearingSnap=C.bearingSnap,this._refreshExpiredTiles=C.refreshExpiredTiles,this._fadeDuration=C.fadeDuration,this._crossSourceCollisions=C.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=C.collectResourceTiming,this._renderTaskQueue=new gA,this._controls=[],this._mapId=o.a3(),this._locale=o.e({},Ke,C.locale),this._clickTolerance=C.clickTolerance,this._overridePixelRatio=C.pixelRatio,this._maxCanvasSize=C.maxCanvasSize,this.transformCameraUpdate=C.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=C.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=X.addThrottleControl(()=>this.isMoving()),this._requestManager=new et(C.transformRequest),typeof C.container=="string"){if(this._container=document.getElementById(C.container),!this._container)throw new Error(`Container '${C.container}' not found.`)}else{if(!(C.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=C.container}if(C.maxBounds&&this.setMaxBounds(C.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let c=!1;const d=So(_=>{this._trackResize&&!this._removed&&this.resize(_)._update()},50);this._resizeObserver=new ResizeObserver(_=>{c?d(_):c=!0}),this._resizeObserver.observe(this._container)}this.handlers=new el(this,C),this._hash=C.hash&&new Hl(typeof C.hash=="string"&&C.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}),C.bounds&&(this.resize(),this.fitBounds(C.bounds,o.e({},C.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=C.localIdeographFontFamily,this._validateStyle=C.validateStyle,C.style&&this.setStyle(C.style,{localIdeographFontFamily:C.localIdeographFontFamily}),C.attributionControl&&this.addControl(new Ld(typeof C.attributionControl=="boolean"?void 0:C.attributionControl)),C.maplibreLogo&&this.addControl(new Pd,C.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.k(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.k(`${c.dataType}dataloading`,c))}),this.on("dataabort",c=>{this.fire(new o.k("sourcedataabort",c))})}_getMapId(){return this._mapId}addControl(C,c){if(c===void 0&&(c=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=C.onAdd(this);this._controls.push(C);const _=this._controlPositions[c];return c.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(C){if(!C||!C.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(C);return c>-1&&this._controls.splice(c,1),C.onRemove(this),this}hasControl(C){return this._controls.indexOf(C)>-1}calculateCameraOptionsFromTo(C,c,d,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(C,c,d,_)}resize(C){var c;const d=this._containerDimensions(),_=d[0],w=d[1],T=this._getClampedPixelRatio(_,w);if(this._resizeCanvas(_,w,T),this.painter.resize(_,w,T),this.painter.overLimit()){const g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];const y=this._getClampedPixelRatio(_,w);this._resizeCanvas(_,w,y),this.painter.resize(_,w,y)}this.transform.resize(_,w),(c=this._requestedCameraState)===null||c===void 0||c.resize(_,w);const U=!this._moving;return U&&(this.stop(),this.fire(new o.k("movestart",C)).fire(new o.k("move",C))),this.fire(new o.k("resize",C)),U&&this.fire(new o.k("moveend",C)),this}_getClampedPixelRatio(C,c){const{0:d,1:_}=this._maxCanvasSize,w=this.getPixelRatio(),T=C*w,U=c*w;return Math.min(T>d?d/T:1,U>_?_/U:1)*w}getPixelRatio(){var C;return(C=this._overridePixelRatio)!==null&&C!==void 0?C:devicePixelRatio}setPixelRatio(C){this._overridePixelRatio=C,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(C){return this.transform.setMaxBounds(ke.convert(C)),this._update()}setMinZoom(C){if((C=C??-2)>=-2&&C<=this.transform.maxZoom)return this.transform.minZoom=C,this._update(),this.getZoom()<C&&this.setZoom(C),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(C){if((C=C??22)>=this.transform.minZoom)return this.transform.maxZoom=C,this._update(),this.getZoom()>C&&this.setZoom(C),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(C){if((C=C??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch)return this.transform.minPitch=C,this._update(),this.getPitch()<C&&this.setPitch(C),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(C){if((C=C??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(C>=this.transform.minPitch)return this.transform.maxPitch=C,this._update(),this.getPitch()>C&&this.setPitch(C),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(C){return this.transform.renderWorldCopies=C,this._update()}project(C){return this.transform.locationPoint(o.M.convert(C),this.style&&this.terrain)}unproject(C){return this.transform.pointLocation(o.P.convert(C),this.terrain)}isMoving(){var C;return this._moving||((C=this.handlers)===null||C===void 0?void 0:C.isMoving())}isZooming(){var C;return this._zooming||((C=this.handlers)===null||C===void 0?void 0:C.isZooming())}isRotating(){var C;return this._rotating||((C=this.handlers)===null||C===void 0?void 0:C.isRotating())}_createDelegatedListener(C,c,d){if(C==="mouseenter"||C==="mouseover"){let _=!1;return{layer:c,listener:d,delegates:{mousemove:T=>{const U=this.getLayer(c)?this.queryRenderedFeatures(T.point,{layers:[c]}):[];U.length?_||(_=!0,d.call(this,new Ei(C,this,T.originalEvent,{features:U}))):_=!1},mouseout:()=>{_=!1}}}}if(C==="mouseleave"||C==="mouseout"){let _=!1;return{layer:c,listener:d,delegates:{mousemove:U=>{(this.getLayer(c)?this.queryRenderedFeatures(U.point,{layers:[c]}):[]).length?_=!0:_&&(_=!1,d.call(this,new Ei(C,this,U.originalEvent)))},mouseout:U=>{_&&(_=!1,d.call(this,new Ei(C,this,U.originalEvent)))}}}}{const _=w=>{const T=this.getLayer(c)?this.queryRenderedFeatures(w.point,{layers:[c]}):[];T.length&&(w.features=T,d.call(this,w),delete w.features)};return{layer:c,listener:d,delegates:{[C]:_}}}}on(C,c,d){if(d===void 0)return super.on(C,c);const _=this._createDelegatedListener(C,c,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(_);for(const w in _.delegates)this.on(w,_.delegates[w]);return this}once(C,c,d){if(d===void 0)return super.once(C,c);const _=this._createDelegatedListener(C,c,d);for(const w in _.delegates)this.once(w,_.delegates[w]);return this}off(C,c,d){return d===void 0?super.off(C,c):(this._delegatedListeners&&this._delegatedListeners[C]&&(_=>{const w=this._delegatedListeners[C];for(let T=0;T<w.length;T++){const U=w[T];if(U.layer===c&&U.listener===d){for(const g in U.delegates)this.off(g,U.delegates[g]);return w.splice(T,1),this}}})(),this)}queryRenderedFeatures(C,c){if(!this.style)return[];let d;const _=C instanceof o.P||Array.isArray(C),w=_?C:[[0,0],[this.transform.width,this.transform.height]];if(c=c||(_?{}:C)||{},w instanceof o.P||typeof w[0]=="number")d=[o.P.convert(w)];else{const T=o.P.convert(w[0]),U=o.P.convert(w[1]);d=[T,new o.P(U.x,T.y),U,new o.P(T.x,U.y),T]}return this.style.queryRenderedFeatures(d,c,this.transform)}querySourceFeatures(C,c){return this.style.querySourceFeatures(C,c)}setStyle(C,c){return(c=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&C?(this._diffStyle(C,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._updateStyle(C,c))}setTransformRequest(C){return this._requestManager.setTransformRequest(C),this}_getUIString(C){const c=this._locale[C];if(c==null)throw new Error(`Missing UI string '${C}'`);return c}_updateStyle(C,c){if(c.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(C,c));const d=this.style&&c.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!C)),C?(this.style=new ga(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C,c,d):this.style.loadJSON(C,c,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ga(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(C,c){if(typeof C=="string"){const d=this._requestManager.transformRequest(C,"Style");o.h(d,new AbortController).then(_=>{this._updateDiff(_.data,c)}).catch(_=>{_&&this.fire(new o.j(_))})}else typeof C=="object"&&this._updateDiff(C,c)}_updateDiff(C,c){try{this.style.setState(C,c)&&this._update(!0)}catch(d){o.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(C,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(C,c){return this._lazyInitEmptyStyle(),this.style.addSource(C,c),this._update(!0)}isSourceLoaded(C){const c=this.style&&this.style.sourceCaches[C];if(c!==void 0)return c.loaded();this.fire(new o.j(new Error(`There is no source with ID '${C}'`)))}setTerrain(C){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),C){const c=this.style.sourceCaches[C.source];if(!c)throw new Error(`cannot load terrain, because there exists no source with ID: ${C.source}`);this.terrain===null&&c.reload();for(const d in this.style._layers){const _=this.style._layers[d];_.type==="hillshade"&&_.source===C.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new rl(this.painter,c,C),this.painter.renderToTexture=new wp(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==C.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:C})),this}getTerrain(){var C,c;return(c=(C=this.terrain)===null||C===void 0?void 0:C.options)!==null&&c!==void 0?c:null}areTilesLoaded(){const C=this.style&&this.style.sourceCaches;for(const c in C){const d=C[c]._tiles;for(const _ in d){const w=d[_];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}removeSource(C){return this.style.removeSource(C),this._update(!0)}getSource(C){return this.style.getSource(C)}addImage(C,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:_=1,sdf:w=!1,stretchX:T,stretchY:U,content:g,textFitWidth:y,textFitHeight:S}=d;if(this._lazyInitEmptyStyle(),!(c instanceof HTMLImageElement||o.b(c))){if(c.width===void 0||c.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:F,height:M,data:N}=c,k=c;return this.style.addImage(C,{data:new o.R({width:F,height:M},new Uint8Array(N)),pixelRatio:_,stretchX:T,stretchY:U,content:g,textFitWidth:y,textFitHeight:S,sdf:w,version:0,userImage:k}),k.onAdd&&k.onAdd(this,C),this}}{const{width:F,height:M,data:N}=b.getImageData(c);this.style.addImage(C,{data:new o.R({width:F,height:M},N),pixelRatio:_,stretchX:T,stretchY:U,content:g,textFitWidth:y,textFitHeight:S,sdf:w,version:0})}}updateImage(C,c){const d=this.style.getImage(C);if(!d)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=c instanceof HTMLImageElement||o.b(c)?b.getImageData(c):c,{width:w,height:T,data:U}=_;if(w===void 0||T===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==d.data.width||T!==d.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const g=!(c instanceof HTMLImageElement||o.b(c));return d.data.replace(U,g),this.style.updateImage(C,d),this}getImage(C){return this.style.getImage(C)}hasImage(C){return C?!!this.style.getImage(C):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(C){this.style.removeImage(C)}loadImage(C){return X.getImage(this._requestManager.transformRequest(C,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(C,c){return this._lazyInitEmptyStyle(),this.style.addLayer(C,c),this._update(!0)}moveLayer(C,c){return this.style.moveLayer(C,c),this._update(!0)}removeLayer(C){return this.style.removeLayer(C),this._update(!0)}getLayer(C){return this.style.getLayer(C)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(C,c,d){return this.style.setLayerZoomRange(C,c,d),this._update(!0)}setFilter(C,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(C,c,d),this._update(!0)}getFilter(C){return this.style.getFilter(C)}setPaintProperty(C,c,d){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(C,c,d,_),this._update(!0)}getPaintProperty(C,c){return this.style.getPaintProperty(C,c)}setLayoutProperty(C,c,d){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(C,c,d,_),this._update(!0)}getLayoutProperty(C,c){return this.style.getLayoutProperty(C,c)}setGlyphs(C){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(C,c),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(C,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(C,c,d,_=>{_||this._update(!0)}),this}removeSprite(C){return this._lazyInitEmptyStyle(),this.style.removeSprite(C),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(C){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(C,c,d=>{d||this._update(!0)}),this}setLight(C){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(C,c),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(C,c){return this.style.setFeatureState(C,c),this._update()}removeFeatureState(C,c){return this.style.removeFeatureState(C,c),this._update()}getFeatureState(C){return this.style.getFeatureState(C)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let C=0,c=0;return this._container&&(C=this._container.clientWidth||400,c=this._container.clientHeight||300),[C,c]}_setupContainer(){const C=this._container;C.classList.add("maplibregl-map");const c=this._canvasContainer=x.create("div","maplibregl-canvas-container",C);this._interactive&&c.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),_=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],_);const w=this._controlContainer=x.create("div","maplibregl-control-container",C),T=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(U=>{T[U]=x.create("div",`maplibregl-ctrl-${U} `,w)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(C,c,d){this._canvas.width=Math.floor(d*C),this._canvas.height=Math.floor(d*c),this._canvas.style.width=`${C}px`,this._canvas.style.height=`${c}px`}_setupPainter(){const C={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let c=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{c={requestedAttributes:C},_&&(c.statusMessage=_.statusMessage,c.type=_.type)},{once:!0});const d=this._canvas.getContext("webgl2",C)||this._canvas.getContext("webgl",C);if(!d){const _="Failed to initialize WebGL";throw c?(c.message=_,new Error(JSON.stringify(c))):new Error(_)}this.painter=new $r(d,this.transform),B.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(C){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(C){return this._update(),this._renderTaskQueue.add(C)}_cancelRenderFrame(C){this._renderTaskQueue.remove(C)}_render(C){const c=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const w=this.transform.zoom,T=b.now();this.style.zoomHistory.update(w,T);const U=new o.a8(w,{now:T,fadeDuration:c,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),g=U.crossFadingFactor();g===1&&g===this._crossFadingFactor||(d=!0,this._crossFadingFactor=g),this.style.update(U)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,c,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:c,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bd.mark(o.be.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,o.bd.mark(o.be.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var C;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),X.removeThrottleControl(this._imageQueueHandle),(C=this._resizeObserver)===null||C===void 0||C.disconnect();const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.bd.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,b.frameAsync(this._frameRequest).then(C=>{o.bd.frame(C),this._frameRequest=null,this._render(C)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())}get showPadding(){return!!this._showPadding}set showPadding(C){this._showPadding!==C&&(this._showPadding=C,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())}get repaint(){return!!this._repaint}set repaint(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(C){this._vertices=C,this._update()}get version(){return Ca}getCameraTargetElevation(){return this.transform.elevation}},a.MapMouseEvent=Ei,a.MapTouchEvent=Gi,a.MapWheelEvent=wa,a.Marker=En,a.NavigationControl=class{constructor(C){this._updateZoomButtons=()=>{const c=this._map.getZoom(),d=c===this._map.getMaxZoom(),_=c===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=c},this._setButtonTitle=(c,d)=>{const _=this._map._getUIString(`NavigationControl.${d}`);c.title=_,c.setAttribute("aria-label",_)},this.options=o.e({},Md,C),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",c=>this._map.zoomIn({},{originalEvent:c})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",c=>this._map.zoomOut({},{originalEvent:c})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",c=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:c}):this._map.resetNorth({},{originalEvent:c})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(C){return this._map=C,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ud(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(C,c){const d=x.create("button",C,this._container);return d.type="button",d.addEventListener("click",c),d}},a.Popup=class extends o.E{constructor(C){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=c=>{this._update(c.point)},this._onMouseMove=c=>{this._update(c.point)},this._onDrag=c=>{this._update(c.point)},this._update=c=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const g of this.options.className.split(" "))this._container.classList.add(g);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Rd(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!c)return;const _=this._flatPos=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&c?c:this._map.transform.locationPoint(this._lngLat));let w=this.options.anchor;const T=dr(this.options.offset);if(!w){const g=this._container.offsetWidth,y=this._container.offsetHeight;let S;S=_.y+T.bottom.y<y?["top"]:_.y>this._map.transform.height-y?["bottom"]:[],_.x<g/2?S.push("left"):_.x>this._map.transform.width-g/2&&S.push("right"),w=S.length===0?"bottom":S.join("-")}let U=_.add(T[w]);this.options.subpixelPositioning||(U=U.round()),x.setTransform(this._container,`${yh[w]} translate(${U.x}px,${U.y}px)`),ql(this._container,w,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Sa),C)}addTo(C){return this._map&&this.remove(),this._map=C,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(C){return this._lngLat=o.M.convert(C),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(C){return this.setDOMContent(document.createTextNode(C))}setHTML(C){const c=document.createDocumentFragment(),d=document.createElement("body");let _;for(d.innerHTML=C;_=d.firstChild,_;)c.appendChild(_);return this.setDOMContent(c)}getMaxWidth(){var C;return(C=this._container)===null||C===void 0?void 0:C.style.maxWidth}setMaxWidth(C){return this.options.maxWidth=C,this._update(),this}setDOMContent(C){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(C),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(C){return this._container&&this._container.classList.add(C),this}removeClassName(C){return this._container&&this._container.classList.remove(C),this}setOffset(C){return this.options.offset=C,this._update(),this}toggleClassName(C){if(this._container)return this._container.classList.toggle(C)}setSubpixelPositioning(C){this.options.subpixelPositioning=C}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const C=this._container.querySelector(_h);C&&C.focus()}},a.RasterDEMTileSource=er,a.RasterTileSource=pr,a.ScaleControl=class{constructor(C){this._onMove=()=>{Dd(this._map,this._container,this.options)},this.setUnit=c=>{this.options.unit=c,Dd(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Od),C)}getDefaultPosition(){return"bottom-left"}onAdd(C){return this._map=C,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",C.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=pA,a.Style=ga,a.TerrainControl=class{constructor(C){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=C}onAdd(C){return this._map=C,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=fA,a.TwoFingersTouchRotateHandler=bu,a.TwoFingersTouchZoomHandler=Lc,a.TwoFingersTouchZoomRotateHandler=Fd,a.VectorTileSource=lt,a.VideoSource=Oe,a.addSourceType=(C,c)=>o._(void 0,void 0,void 0,function*(){if(Sr(C))throw new Error(`A source type called "${C}" already exists.`);((d,_)=>{hr[d]=_})(C,c)}),a.clearPrewarmedResources=function(){const C=Ot;C&&(C.isPreloaded()&&C.numActive()===1?(C.release(it),Ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return or().getRTLTextPluginStatus()},a.getVersion=function(){return Fr},a.getWorkerCount=function(){return bt.workerCount},a.getWorkerUrl=function(){return o.a.WORKER_URL},a.importScriptInWorkers=function(C){return ie().broadcast("IS",C)},a.prewarm=function(){Gt().acquire(it)},a.setMaxParallelImageRequests=function(C){o.a.MAX_PARALLEL_IMAGE_REQUESTS=C},a.setRTLTextPlugin=function(C,c){return or().setRTLTextPlugin(C,c)},a.setWorkerCount=function(C){bt.workerCount=C},a.setWorkerUrl=function(C){o.a.WORKER_URL=C}});var s=e;return s})})(BS);var CS=BS.exports;const Ts=Dp(CS);var Is;(function(r){r[r.Unknown=0]="Unknown",r[r.Point=1]="Point",r[r.LineString=2]="LineString",r[r.Polygon=3]="Polygon",r[r.MultiPoint=4]="MultiPoint",r[r.MultiLineString=5]="MultiLineString",r[r.MultiPolygon=6]="MultiPolygon",r[r.GeometryCollection=7]="GeometryCollection",r[r.CircularString=8]="CircularString",r[r.CompoundCurve=9]="CompoundCurve",r[r.CurvePolygon=10]="CurvePolygon",r[r.MultiCurve=11]="MultiCurve",r[r.MultiSurface=12]="MultiSurface",r[r.Curve=13]="Curve",r[r.Surface=14]="Surface",r[r.PolyhedralSurface=15]="PolyhedralSurface",r[r.TIN=16]="TIN",r[r.Triangle=17]="Triangle"})(Is||(Is={}));const Np=4,kp=4,Qp=4,SA=new Int32Array(2),ES=new Float32Array(SA.buffer),SS=new Float64Array(SA.buffer),l0=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var fv;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(fv||(fv={}));class Pu{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Pu(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return SA[0]=this.readInt32(t),ES[0]}readFloat64(t){return SA[l0?0:1]=this.readInt32(t),SA[l0?1:0]=this.readInt32(t+4),SS[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){ES[0]=e,this.writeInt32(t,SA[0])}writeFloat64(t,e){SS[0]=e,this.writeInt32(t,SA[l0?0:1]),this.writeInt32(t+4,SA[l0?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Np+kp)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<kp;e++)t+=String.fromCharCode(this.readInt8(this.position_+Np+e));return t}__offset(t,e){const n=t-this.readInt32(t);return e<this.readInt16(n)?this.readInt16(n+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const n=this.readInt32(t);t+=Np;const i=this.bytes_.subarray(t,t+n);return e===fv.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+Np}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=kp)throw new Error("FlatBuffers: file identifier must be length "+kp);for(let e=0;e<kp;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+Np+e))return!1;return!0}createScalarList(t,e){const n=[];for(let i=0;i<e;++i){const s=t(i);s!==null&&n.push(s)}return n}createObjList(t,e){const n=[];for(let i=0;i<e;++i){const s=t(i);s!==null&&n.push(s.unpack())}return n}}let Vk=class La{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new La).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+Qp),(e||new La).__init(t.readInt32(t.position())+t.position(),t)}ends(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+t*4):0}endsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}xyLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}zLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}mLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}tLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+t*8):BigInt(0)}tmLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):Is.Unknown}parts(t,e){const n=this.bb.__offset(this.bb_pos,18);return n?(e||new La).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}partsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addInt32(e[n]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addInt64(e[n]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,Is.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,n,i,s,a,o,h,f){return La.startGeometry(t),La.addEnds(t,e),La.addXy(t,n),La.addZ(t,i),La.addM(t,s),La.addT(t,a),La.addTm(t,o),La.addType(t,h),La.addParts(t,f),La.endGeometry(t)}};function pv(r,t){const e=[];for(let n=0;n<r.length;n+=2){const i=[r[n],r[n+1]];t&&i.push(t[n>>1]),e.push(i)}return e}function TS(r,t,e){if(!e||e.length===0)return[pv(r,t)];let n=0;const i=Array.from(e).map(a=>r.slice(n,n=a<<1));let s;return t&&(n=0,s=Array.from(e).map(a=>t.slice(n,n=a))),i.map((a,o)=>pv(a,s?s[o]:void 0))}function Gk(r,t){const e=r.xyArray(),n=r.zArray();switch(t){case Is.Point:{const i=Array.from(e);return n&&i.push(n[0]),i}case Is.MultiPoint:case Is.LineString:return pv(e,n);case Is.MultiLineString:return TS(e,n,r.endsArray());case Is.Polygon:return TS(e,n,r.endsArray())}}function gv(r,t){let e=t;if(e===Is.Unknown&&(e=r.type()),e===Is.GeometryCollection){const i=[];for(let s=0;s<r.partsLength();s++){const a=r.parts(s),o=a.type();i.push(gv(a,o))}return{type:Is[e],geometries:i}}else if(e===Is.MultiPolygon){const i=[];for(let s=0;s<r.partsLength();s++)i.push(gv(r.parts(s),Is.Polygon));return{type:Is[e],coordinates:i.map(s=>s.coordinates)}}const n=Gk(r,e);return{type:Is[e],coordinates:n}}var Fs;(function(r){r[r.Byte=0]="Byte",r[r.UByte=1]="UByte",r[r.Bool=2]="Bool",r[r.Short=3]="Short",r[r.UShort=4]="UShort",r[r.Int=5]="Int",r[r.UInt=6]="UInt",r[r.Long=7]="Long",r[r.ULong=8]="ULong",r[r.Float=9]="Float",r[r.Double=10]="Double",r[r.String=11]="String",r[r.Json=12]="Json",r[r.DateTime=13]="DateTime",r[r.Binary=14]="Binary"})(Fs||(Fs={}));class Ls{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new Ls).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+Qp),(e||new Ls).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Fs.Byte}title(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){const t=this.bb.__offset(this.bb_pos,18);return t?!!this.bb.readInt8(this.bb_pos+t):!0}unique(){const t=this.bb.__offset(this.bb_pos,20);return t?!!this.bb.readInt8(this.bb_pos+t):!1}primaryKey(){const t=this.bb.__offset(this.bb_pos,22);return t?!!this.bb.readInt8(this.bb_pos+t):!1}metadata(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,Fs.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){const e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,n,i,s,a,o,h,f,m,b,x){return Ls.startColumn(t),Ls.addName(t,e),Ls.addType(t,n),Ls.addTitle(t,i),Ls.addDescription(t,s),Ls.addWidth(t,a),Ls.addPrecision(t,o),Ls.addScale(t,h),Ls.addNullable(t,f),Ls.addUnique(t,m),Ls.addPrimaryKey(t,b),Ls.addMetadata(t,x),Ls.endColumn(t)}}class Yl{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new Yl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+Qp),(e||new Yl).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new Vk).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new Ls).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let n=e.length-1;n>=0;n--)t.addInt8(e[n]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,n,i){return Yl.startFeature(t),Yl.addGeometry(t,e),Yl.addProperties(t,n),Yl.addColumns(t,i),Yl.endFeature(t)}}new TextEncoder;const IS=new TextDecoder;function jk(r,t){const e={};if(!t||t.length===0)return e;const n=r.propertiesArray();if(!n)return e;const i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength();let a=0;for(;a<s;){const o=i.getUint16(a,!0);a+=2;const h=t[o],f=h.name;switch(h.type){case Fs.Bool:{e[f]=!!i.getUint8(a),a+=1;break}case Fs.Byte:{e[f]=i.getInt8(a),a+=1;break}case Fs.UByte:{e[f]=i.getUint8(a),a+=1;break}case Fs.Short:{e[f]=i.getInt16(a,!0),a+=2;break}case Fs.UShort:{e[f]=i.getUint16(a,!0),a+=2;break}case Fs.Int:{e[f]=i.getInt32(a,!0),a+=4;break}case Fs.UInt:{e[f]=i.getUint32(a,!0),a+=4;break}case Fs.Long:{e[f]=Number(i.getBigInt64(a,!0)),a+=8;break}case Fs.ULong:{e[f]=Number(i.getBigUint64(a,!0)),a+=8;break}case Fs.Float:{e[f]=i.getFloat32(a,!0),a+=4;break}case Fs.Double:{e[f]=i.getFloat64(a,!0),a+=8;break}case Fs.DateTime:case Fs.String:{const m=i.getUint32(a,!0);a+=4,e[f]=IS.decode(n.subarray(a,a+m)),a+=m;break}case Fs.Json:{const m=i.getUint32(a,!0);a+=4;const b=IS.decode(n.subarray(a,a+m));e[f]=JSON.parse(b),a+=m;break}default:throw new Error("Unknown type "+h.type)}}return e}function mv(r,t){const e=t.columns;return{type:"Feature",geometry:gv(r.geometry(),t.geometryType),properties:jk(r,e)}}const yv=new Uint8Array(0);function qk(){return this._source.cancel()}function Kk(r,t){if(!r.length)return t;if(!t.length)return r;var e=new Uint8Array(r.length+t.length);return e.set(r),e.set(t,r.length),e}function Wk(){var r=this,t=r._array.subarray(r._index);return r._source.read().then(function(e){return r._array=yv,r._index=0,e.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:Kk(t,e.value)}})}function $k(r){if((r|=0)<0)throw new Error("invalid length");var t=this,e=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return t._source.read().then(function(s){return s.done?(t._array=yv,t._index=0,e>0?n.subarray(0,e):null):e+s.value.length>=r?(t._array=s.value,t._index=r-e,n.set(s.value.subarray(0,r-e),e),n):(n.set(s.value,e),e+=s.value.length,i())})}()}function Xk(r){return typeof r.slice=="function"?r:new c0(typeof r.read=="function"?r:r.getReader())}function c0(r){this._source=r,this._array=yv,this._index=0}c0.prototype.read=Wk,c0.prototype.slice=$k,c0.prototype.cancel=qk;class fl{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new fl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+Qp),(e||new fl).__init(t.readInt32(t.position())+t.position(),t)}org(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,n,i,s,a,o){return fl.startCrs(t),fl.addOrg(t,e),fl.addCode(t,n),fl.addName(t,i),fl.addDescription(t,s),fl.addWkt(t,a),fl.addCodeString(t,o),fl.endCrs(t)}}class u0{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new u0).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+Qp),(e||new u0).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}envelopeLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Is.Unknown}hasZ(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasM(){const t=this.bb.__offset(this.bb_pos,12);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasT(){const t=this.bb.__offset(this.bb_pos,14);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasTm(){const t=this.bb.__offset(this.bb_pos,16);return t?!!this.bb.readInt8(this.bb_pos+t):!1}columns(t,e){const n=this.bb.__offset(this.bb_pos,18);return n?(e||new Ls).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){const e=this.bb.__offset(this.bb_pos,24);return e?(t||new fl).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){const e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){const e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,Is.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}function _v(r){const t=u0.getRootAsHeader(r),e=t.featuresCount(),n=t.indexNodeSize(),i=[];for(let h=0;h<t.columnsLength();h++){const f=t.columns(h);if(!f)throw new Error("Column unexpectedly missing");if(!f.name())throw new Error("Column name unexpectedly missing");i.push({name:f.name(),type:f.type(),title:f.title(),description:f.description(),width:f.width(),precision:f.precision(),scale:f.scale(),nullable:f.nullable(),unique:f.unique(),primary_key:f.primaryKey()})}const s=t.crs(),a=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:t.geometryType(),columns:i,envelope:null,featuresCount:Number(e),indexNodeSize:n,crs:a,title:t.title(),description:t.description(),metadata:t.metadata()}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var vv=function(r,t){return vv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])},vv(r,t)};function Jk(r,t){vv(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Kd(r,t,e,n){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(m){try{f(n.next(m))}catch(b){a(b)}}function h(m){try{f(n.throw(m))}catch(b){a(b)}}function f(m){m.done?s(m.value):i(m.value).then(o,h)}f((n=n.apply(r,[])).next())})}function TA(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(f){return function(m){return h([f,m])}}function h(f){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,i=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){e.label=f[1];break}if(f[0]===6&&e.label<s[1]){e.label=s[1],s=f;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(f);break}s[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(r,e)}catch(m){f=[6,m],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function Wd(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Hp(r){return this instanceof Hp?(this.v=r,this):new Hp(r)}function Yk(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(r,t||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(x){n[x]&&(i[x]=function(B){return new Promise(function(P,R){s.push([x,B,P,R])>1||o(x,B)})})}function o(x,B){try{h(n[x](B))}catch(P){b(s[0][3],P)}}function h(x){x.value instanceof Hp?Promise.resolve(x.value.v).then(f,m):b(s[0][2],x)}function f(x){o("next",x)}function m(x){o("throw",x)}function b(x,B){x(B),s.shift(),s.length&&o(s[0][0],s[0][1])}}var FS=function(r){Jk(t,r);function t(e){var n=r.call(this,e)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return t}(Error);(function(){function r(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})(),function(){function r(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}(),function(){function r(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}();function bv(r){r!=null&&typeof r.then=="function"&&r.then(d0,d0)}var wv=0,LS=1,Lh=2,A0=3,xv=4,h0=1024,d0=function(){};function $d(r){var t=r.err,e=Promise.resolve(r.execution).then(function(n){if(t!=null)throw t;return n});return r.err=void 0,r.execution=e.then(function(){},function(){}),r.pending===void 0?e:r.pending.then(function(){return e})}function Ph(r,t){var e=r.state>=A0;return Promise.resolve(t).then(function(n){return!e&&r.state>=xv?$d(r).then(function(i){return{value:i,done:!0}}):{value:n,done:e}})}function Bv(r,t){var e,n;if(!(r.state>=Lh))if(r.state=Lh,r.onnext(),r.onstop(),r.err==null&&(r.err=t),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))zp(r);else try{for(var i=Wd(r.pushes),s=i.next();!s.done;s=i.next()){var a=s.value;a.resolve()}}catch(o){e={error:o}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}function zp(r){var t,e;if(!(r.state>=A0)){r.state<Lh&&Bv(r),r.state=A0,r.buffer=void 0;try{for(var n=Wd(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,a=r.pending===void 0?$d(r):r.pending.then(function(){return $d(r)});s.resolve(Ph(r,a))}}catch(o){t={error:o}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}r.pushes=[],r.nexts=[]}}function PS(r){r.state>=xv||(r.state<A0&&zp(r),r.state=xv)}function Zk(r,t){if(bv(t),r.pushes.length>=h0)throw new FS("No more than "+h0+" pending calls to push are allowed on a single repeater.");if(r.state>=Lh)return Promise.resolve(void 0);var e=r.pending===void 0?Promise.resolve(t):r.pending.then(function(){return t});e=e.catch(function(h){r.state<Lh&&(r.err=h),PS(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(Ph(r,e)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):n=new Promise(function(h){return r.onnext=h})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(e),n=Promise.resolve(void 0)):n=new Promise(function(h){return r.pushes.push({resolve:h,value:e})});var s=!0,a={},o=n.catch(function(h){if(s)throw h});return a.then=function(h,f){return s=!1,Promise.prototype.then.call(n,h,f)},a.catch=function(h){return s=!1,Promise.prototype.catch.call(n,h)},a.finally=n.finally.bind(n),r.pending=e.then(function(){return o}).catch(function(h){r.err=h,PS(r)}),a}function t8(r){var t=Bv.bind(null,r),e=new Promise(function(n){return r.onstop=n});return t.then=e.then.bind(e),t.catch=e.catch.bind(e),t.finally=e.finally.bind(e),t}function e8(r){if(!(r.state>=LS)){r.state=LS;var t=Zk.bind(null,r),e=t8(r);r.execution=new Promise(function(n){return n(r.executor(t,e))}),r.execution.catch(function(){return Bv(r)})}}var f0=new WeakMap,Vp=function(){function r(t,e){f0.set(this,{executor:t,buffer:e,err:void 0,state:wv,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:d0,onstop:d0})}return r.prototype.next=function(t){bv(t);var e=f0.get(this);if(e===void 0)throw new Error("WeakMap error");if(e.nexts.length>=h0)throw new FS("No more than "+h0+" pending calls to next are allowed on a single repeater.");if(e.state<=wv&&e8(e),e.onnext(t),typeof e.buffer<"u"&&!e.buffer.empty){var n=Ph(e,e.buffer.remove());if(e.pushes.length){var i=e.pushes.shift();e.buffer.add(i.value),e.onnext=i.resolve}return n}else if(e.pushes.length){var s=e.pushes.shift();return e.onnext=s.resolve,Ph(e,s.value)}else if(e.state>=Lh)return zp(e),Ph(e,$d(e));return new Promise(function(a){return e.nexts.push({resolve:a,value:t})})},r.prototype.return=function(t){bv(t);var e=f0.get(this);if(e===void 0)throw new Error("WeakMap error");return zp(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),Ph(e,$d(e))},r.prototype.throw=function(t){var e=f0.get(this);if(e===void 0)throw new Error("WeakMap error");return e.state<=wv||e.state>=Lh||typeof e.buffer<"u"&&!e.buffer.empty?(zp(e),e.err==null&&(e.err=t),Ph(e,$d(e))):this.next(Promise.reject(t))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=r8,r.merge=n8,r.zip=i8,r.latest=s8,r}();function p0(r,t){var e,n,i=[],s=function(f){f!=null&&typeof f[Symbol.asyncIterator]=="function"?i.push(f[Symbol.asyncIterator]()):f!=null&&typeof f[Symbol.iterator]=="function"?i.push(f[Symbol.iterator]()):i.push(function(){return Yk(this,arguments,function(){return TA(this,function(x){switch(x.label){case 0:return t.yieldValues?[4,Hp(f)]:[3,3];case 1:return[4,x.sent()];case 2:x.sent(),x.label=3;case 3:return t.returnValues?[4,Hp(f)]:[3,5];case 4:return[2,x.sent()];case 5:return[2]}})})}())};try{for(var a=Wd(r),o=a.next();!o.done;o=a.next()){var h=o.value;s(h)}}catch(f){e={error:f}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return i}function r8(r){var t=this,e=p0(r,{returnValues:!0});return new Vp(function(n,i){return Kd(t,void 0,void 0,function(){var s,a,o,h,f,m;return TA(this,function(b){switch(b.label){case 0:if(!e.length)return i(),[2];a=!1,i.then(function(){s(),a=!0}),b.label=1;case 1:b.trys.push([1,,5,7]),h=void 0,f=0,m=function(){var x,B,P,R,Q,z;return TA(this,function(G){switch(G.label){case 0:x=f;try{for(B=(Q=void 0,Wd(e)),P=B.next();!P.done;P=B.next())R=P.value,Promise.resolve(R.next()).then(function(X){X.done?(i(),o===void 0&&(o=X)):f===x&&(f++,s(X))},function(X){return i(X)})}catch(X){Q={error:X}}finally{try{P&&!P.done&&(z=B.return)&&z.call(B)}finally{if(Q)throw Q.error}}return[4,new Promise(function(X){return s=X})];case 1:return h=G.sent(),h===void 0?[3,3]:[4,n(h.value)];case 2:G.sent(),G.label=3;case 3:return[2]}})},b.label=2;case 2:return a?[3,4]:[5,m()];case 3:return b.sent(),[3,2];case 4:return[2,o&&o.value];case 5:return i(),[4,Promise.race(e.map(function(x){return x.return&&x.return()}))];case 6:return b.sent(),[7];case 7:return[2]}})})})}function n8(r){var t=this,e=p0(r,{yieldValues:!0});return new Vp(function(n,i){return Kd(t,void 0,void 0,function(){var s,a,o,h=this;return TA(this,function(f){switch(f.label){case 0:if(!e.length)return i(),[2];s=[],a=!1,i.then(function(){var m,b;a=!0;try{for(var x=Wd(s),B=x.next();!B.done;B=x.next()){var P=B.value;P()}}catch(R){m={error:R}}finally{try{B&&!B.done&&(b=x.return)&&b.call(x)}finally{if(m)throw m.error}}}),f.label=1;case 1:return f.trys.push([1,,3,4]),[4,Promise.all(e.map(function(m,b){return Kd(h,void 0,void 0,function(){var x,B;return TA(this,function(P){switch(P.label){case 0:P.trys.push([0,,6,9]),P.label=1;case 1:return a?[3,5]:(Promise.resolve(m.next()).then(function(R){return s[b](R)},function(R){return i(R)}),[4,new Promise(function(R){s[b]=R})]);case 2:return x=P.sent(),x===void 0?[3,4]:x.done?(o=x,[2]):[4,n(x.value)];case 3:P.sent(),P.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return B=m.return,B?[4,m.return()]:[3,8];case 7:B=P.sent(),P.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return f.sent(),[2,o&&o.value];case 3:return i(),[7];case 4:return[2]}})})})}function i8(r){var t=this,e=p0(r,{returnValues:!0});return new Vp(function(n,i){return Kd(t,void 0,void 0,function(){var s,a,o,h;return TA(this,function(f){switch(f.label){case 0:if(!e.length)return i(),[2,[]];a=!1,i.then(function(){s(),a=!0}),f.label=1;case 1:f.trys.push([1,,6,8]),f.label=2;case 2:return a?[3,5]:(Promise.all(e.map(function(m){return m.next()})).then(function(m){return s(m)},function(m){return i(m)}),[4,new Promise(function(m){return s=m})]);case 3:return o=f.sent(),o===void 0?[2]:(h=o.map(function(m){return m.value}),o.some(function(m){return m.done})?[2,h]:[4,n(h)]);case 4:return f.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(e.map(function(m){return m.return&&m.return()}))];case 7:return f.sent(),[7];case 8:return[2]}})})})}function s8(r){var t=this,e=p0(r,{yieldValues:!0,returnValues:!0});return new Vp(function(n,i){return Kd(t,void 0,void 0,function(){var s,a,o,h,f,m=this;return TA(this,function(b){switch(b.label){case 0:if(!e.length)return i(),[2,[]];a=[],o=!1,i.then(function(){var x,B;s();try{for(var P=Wd(a),R=P.next();!R.done;R=P.next()){var Q=R.value;Q()}}catch(z){x={error:z}}finally{try{R&&!R.done&&(B=P.return)&&B.call(P)}finally{if(x)throw x.error}}o=!0}),b.label=1;case 1:return b.trys.push([1,,5,7]),Promise.all(e.map(function(x){return x.next()})).then(function(x){return s(x)},function(x){return i(x)}),[4,new Promise(function(x){return s=x})];case 2:return h=b.sent(),h===void 0?[2]:(f=h.map(function(x){return x.value}),h.every(function(x){return x.done})?[2,f]:[4,n(f.slice())]);case 3:return b.sent(),[4,Promise.all(e.map(function(x,B){return Kd(m,void 0,void 0,function(){var P;return TA(this,function(R){switch(R.label){case 0:if(h[B].done)return[2,h[B].value];R.label=1;case 1:return o?[3,4]:(Promise.resolve(x.next()).then(function(Q){return a[B](Q)},function(Q){return i(Q)}),[4,new Promise(function(Q){return a[B]=Q})]);case 2:return P=R.sent(),P===void 0?[2,h[B].value]:P.done?[2,P.value]:(f[B]=P.value,[4,n(f.slice())]);case 3:return R.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,b.sent()];case 5:return i(),[4,Promise.all(e.map(function(x){return x.return&&x.return()}))];case 6:return b.sent(),[7];case 7:return[2]}})})})}let g0=class{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(t){if(t<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=t}};g0.global=new g0;var Zl;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error"})(Zl||(Zl={}));class Ps{static debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(Zl.Debug,...e)}static info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(Zl.Info,...e)}static warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(Zl.Warn,...e)}static error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(Zl.Error,...e)}static log(t){if(!(this.logLevel>t)){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];switch(t){case Zl.Debug:{console.debug(...n);break}case Zl.Info:{console.info(...n);break}case Zl.Warn:{console.warn(...n);break}case Zl.Error:{console.error(...n);break}}}}}Ps.logLevel=Zl.Warn;const Mh=8*4+8,o8=16;function Cv(r,t){t=Math.min(Math.max(+t,2),65535);let e=r,n=e;do e=Math.ceil(e/t),n+=e;while(e!==1);return n*Mh}function a8(r,t){if(t<2)throw new Error("Node size must be at least 2");if(r===0)throw new Error("Number of items must be greater than 0");let e=r,n=e;const i=[e];do e=Math.ceil(e/t),n+=e,i.push(e);while(e!==1);const s=[];e=n;for(const o of i)s.push(e-o),e-=o;const a=[];for(let o=0;o<i.length;o++)a.push([s[o],s[o]+i[o]]);return a}async function*l8(r,t,e,n){class i{constructor(P,R){this._level=R,this.nodes=P}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(P){console.assert(P>this.nodes[1]),this.nodes[1]=P}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:s,minY:a,maxX:o,maxY:h}=e;Ps.info(`tree items: ${r}, nodeSize: ${t}`);const f=a8(r,t),m=f[0][0],x=[(()=>{const B=[0,1],P=f.length-1;return new i(B,P)})()];for(Ps.debug(`starting stream search with queue: ${x}, numItems: ${r}, nodeSize: ${t}, levelBounds: ${f}`);x.length!=0;){const B=x.shift();Ps.debug(`popped node: ${B}, queueLength: ${x.length}`);const P=B.startNodeIdx(),R=P>=m,Q=(()=>{const[,et]=f[B.level()],pt=Math.min(B.endNodeIdx()+t,et);return R&&pt<et?pt+1:pt})(),z=Q-P,G=await n(P*Mh,z*Mh),X=new DataView(G);for(let et=P;et<Q;et++){const pt=et-P,gt=pt*Mh;if(o<X.getFloat64(gt+0,!0)||h<X.getFloat64(gt+8,!0)||s>X.getFloat64(gt+16,!0)||a>X.getFloat64(gt+24,!0))continue;const mt=X.getBigUint64(gt+32,!0);if(R){const ct=mt,wt=(()=>{if(et<r-1){const Jt=(pt+1)*Mh;return X.getBigUint64(Jt+32,!0)-ct}else return null})(),_t=et-m;yield[Number(ct),_t,Number(wt)];continue}const ft=mt,Mt=g0.global.extraRequestThreshold()/Mh,Lt=x[x.length-1];if(Lt!==void 0&&Lt.level()==B.level()-1&&ft<Lt.endNodeIdx()+Mt){Ps.debug(`Merging "nodeRange" request into existing range: ${Lt}, newEndNodeIdx: ${Lt.endNodeIdx()} -> ${ft}`),Lt.extendEndNodeIdx(Number(ft));continue}const at=(()=>{const ct=B.level()-1,wt=[Number(ft),Number(ft)+1];return new i(wt,ct)})();Lt!==void 0&&Lt.level()==at.level()?Ps.info(`Same level, but too far away. Pushing new request for nodeIdx: ${ft} rather than merging with distant ${Lt}`):Ps.info(`Pushing new level for ${at} onto queue with nearestNodeRange: ${Lt} since there's not already a range for this level.`),x.push(at)}}}const IA=new Uint8Array([102,103,98,3,102,103,98,0]),Mu=4;class Ev{constructor(t,e,n,i,s){this.headerClient=t,this.header=e,this.headerLength=n,this.indexLength=i,this.nocache=s}static async open(t,e){const i=new MS(t,e),s=(()=>{const x=o8,B=3;let P=0,R;for(R=0;R<B;R++){const Q=x**R*Mh;P+=Q}return P})(),a=2024+s;Ps.debug(`fetching header. minReqLength: ${a} (assumedHeaderLength: 2024, assumedIndexLength: ${s})`);{const x=new Uint8Array(await i.getRange(0,8,a,"header"));if(!x.subarray(0,3).every((B,P)=>IA[P]===B))throw Ps.error(`bytes: ${x} != ${IA}`),new Error("Not a FlatGeobuf file");Ps.debug("magic bytes look good")}let o;{const x=await i.getRange(8,4,a,"header");o=new DataView(x).getUint32(0,!0);const B=1048576*10;if(o>B||o<8)throw new Error("Invalid header size");Ps.debug(`headerLength: ${o}`)}const h=await i.getRange(12,o,a,"header"),f=new Pu(new Uint8Array(h)),m=_v(f),b=Cv(m.featuresCount,m.indexNodeSize);return Ps.debug("completed: opening http reader"),new Ev(i,m,o,b,e)}async*selectBbox(t){const e=this.lengthBeforeTree(),n=this.headerClient,i=async function(h,f){return n.getRange(e+h,f,0,"index")},s=[];let a=[];for await(const h of l8(this.header.featuresCount,this.header.indexNodeSize,t,i)){const[f,,]=h;let[,,m]=h;if(m||(Ps.info("final feature"),m=4),a.length==0){a.push([f,m]);continue}const b=a[a.length-1],x=f-(b[0]+b[1]);x>g0.global.extraRequestThreshold()&&(Ps.info(`Pushing new feature batch, since gap ${x} was too large`),s.push(a),a=[]),a.push([f,m])}this.headerClient.logUsage("header+index"),a.length>0&&s.push(a);const o=s.flatMap(h=>this.readFeatureBatch(h,this.nocache));yield*Vp.merge(o)}lengthBeforeTree(){return IA.length+Mu+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new MS(this.headerClient.httpClient,t)}async*readFeatureBatch(t,e){const[n]=t[0],[i,s]=t[t.length-1],a=n,h=i+s-a,f=this.buildFeatureClient(e);let m=h;for(const[b]of t)yield await this.readFeature(f,b,m),m=0;f.logUsage("feature")}async readFeature(t,e,n){const i=e+this.lengthBeforeFeatures();let s;{const m=await t.getRange(i,4,n,"feature length");s=new DataView(m).getUint32(0,!0)}const a=await t.getRange(i+4,s,n,"feature data"),o=new Uint8Array(a),h=new Uint8Array(s+Mu);h.set(o,Mu);const f=new Pu(h);return f.setPosition(Mu),Yl.getRootAsFeature(f)}}class MS{constructor(t,e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof t=="string")this.httpClient=new US(t,e);else if(t instanceof US)this.httpClient=t;else throw new Error("Unknown source ")}async getRange(t,e,n,i){this.bytesEverUsed+=e;const s=t-this.head,a=s+e;if(s>=0&&a<=this.buffer.byteLength)return this.buffer.slice(s,a);const o=Math.max(e,n);return this.bytesEverFetched+=o,Ps.debug(`requesting for new Range: ${t}-${t+o-1}`),this.buffer=await this.httpClient.getRange(t,o,i),this.head=t,this.buffer.slice(0,e)}logUsage(t){const e=t.split(" ")[0],n=this.bytesEverUsed,i=this.bytesEverFetched,s=(100*n/i).toFixed(2);Ps.info(`${e} bytes used/requested: ${n} / ${i} = ${s}%`)}}class US{constructor(t,e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=t,this.nocache=e}async getRange(t,e,n){this.requestsEverMade+=1,this.bytesEverRequested+=e;const i=`bytes=${t}-${t+e-1}`;Ps.info(`request: #${this.requestsEverMade}, purpose: ${n}), bytes: (this_request: ${e}, ever: ${this.bytesEverRequested}), Range: ${i}`);const s={Range:i};return this.nocache&&(s["Cache-Control"]="no-cache, no-store"),(await fetch(this.url,{headers:s})).arrayBuffer()}}function c8(r,t,e){if(!r.subarray(0,3).every((m,b)=>IA[b]===m))throw new Error("Not a FlatGeobuf file");const n=new Pu(r),i=n.readUint32(IA.length);n.setPosition(IA.length+Mu);const s=_v(n);let a=IA.length+Mu+i;const{indexNodeSize:o,featuresCount:h}=s;o>0&&(a+=Cv(h,o));const f=[];for(;a<n.capacity();){const m=n.readUint32(a);n.setPosition(a+Mu);const b=Yl.getRootAsFeature(n);f.push(t(b,s)),a+=Mu+m}return f}async function*u8(r,t,e){const n=Xk(r),i=async x=>await n.slice(x);let s=new Uint8Array(await i(8));if(!s.subarray(0,3).every((x,B)=>IA[B]===x))throw new Error("Not a FlatGeobuf file");s=new Uint8Array(await i(4));let a=new Pu(s);const o=a.readUint32(0);s=new Uint8Array(await i(o)),a=new Pu(s);const h=_v(a),{indexNodeSize:f,featuresCount:m}=h;if(f>0){const x=Cv(m,f);await i(x)}let b;for(;b=await h8(i,h,t);)yield b}function A8(r,t,e,n){try{let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){const s=await Ev.open(r,i);Ps.debug("opened reader");for await(const a of s.selectBbox(t))yield e(a,s.header)}()}catch(i){return Promise.reject(i)}}async function h8(r,t,e){let n=new Uint8Array(await r(4,"feature length"));if(n.byteLength===0)return;let i=new Pu(n);const s=i.readUint32(0);n=new Uint8Array(await r(s,"feature data"));const a=new Uint8Array(s+4);a.set(n,4),i=new Pu(a),i.setPosition(Mu);const o=Yl.getRootAsFeature(i);return e(o,t)}function d8(r,t){return{type:"FeatureCollection",features:c8(r,mv)}}function f8(r,t){return u8(r,mv)}function p8(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return A8(r,t,mv,e,n)}function RS(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return r instanceof Uint8Array?d8(r):r instanceof ReadableStream?f8(r):p8(r,t,e,n)}class g8{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(t){this._map=t;let e=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(e._btn.className.indexOf("3d")!=-1){let f={pitch:e._pitch,bearing:e._bearing};e._minpitchzoom&&t.getZoom()>e._minpitchzoom&&(f.zoom=e._minpitchzoom);var n=0,i=38.5,s=6,a=62.33,{longitude:o,latitude:h}=t.getCenter();t.getZoom()<10?t.setTerrain({source:"terrainMapZen",exaggeration:1.5}):o>=n&&o<=s&&h>=i&&h<=a?t.setTerrain({source:"terrainICGC",exaggeration:1.2}):t.setTerrain({source:"terrainMapZen",exaggeration:1.5}),t.easeTo(f),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else t.setTerrain(null),t.easeTo({pitch:0,bearing:0}),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function Gp(r){"@babel/helpers - typeof";return Gp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gp(r)}function m8(r,t){if(Gp(r)!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(Gp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function y8(r){var t=m8(r,"string");return Gp(t)=="symbol"?t:t+""}function W(r,t,e){return t=y8(t),t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function ui(r,t){if(!r)throw new Error(t||"loader assertion failed.")}const m0=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),OS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);OS&&parseFloat(OS[1]);const _8="3.4.15";function Qc(r,t){if(!r)throw new Error(t||"loaders.gl assertion failed.")}const Sv={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},v8=Sv.global||Sv.self||Sv.window||{},Uu=typeof process!="object"||String(process)!=="[object process]"||process.browser,Tv=typeof importScripts=="function",b8=typeof window<"u"&&typeof window.orientation<"u",DS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);DS&&parseFloat(DS[1]);class w8{constructor(t,e){W(this,"name",void 0),W(this,"workerThread",void 0),W(this,"isRunning",!0),W(this,"result",void 0),W(this,"_resolve",()=>{}),W(this,"_reject",()=>{}),this.name=t,this.workerThread=e,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Qc(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Qc(this.isRunning),this.isRunning=!1,this._reject(t)}}let Iv=class{terminate(){}};const Fv=new Map;function x8(r){Qc(r.source&&!r.url||!r.source&&r.url);let t=Fv.get(r.source||r.url);return t||(r.url&&(t=B8(r.url),Fv.set(r.url,t)),r.source&&(t=NS(r.source),Fv.set(r.source,t))),Qc(t),t}function B8(r){if(!r.startsWith("http"))return r;const t=C8(r);return NS(t)}function NS(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function C8(r){return`try {
  importScripts('`.concat(r,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function kS(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0;const n=e||new Set;if(r){if(QS(r))n.add(r);else if(QS(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(t&&typeof r=="object")for(const i in r)kS(r[i],t,n)}}return e===void 0?Array.from(n):[]}function QS(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const Lv=()=>{};class Pv{static isSupported(){return typeof Worker<"u"&&Uu||typeof Iv<"u"&&!Uu}constructor(t){W(this,"name",void 0),W(this,"source",void 0),W(this,"url",void 0),W(this,"terminated",!1),W(this,"worker",void 0),W(this,"onMessage",void 0),W(this,"onError",void 0),W(this,"_loadableURL","");const{name:e,source:n,url:i}=t;Qc(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=Lv,this.onError=s=>console.log(s),this.worker=Uu?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Lv,this.onError=Lv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||kS(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=x8({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new Iv(n,{eval:!1})}else if(this.source)t=new Iv(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class E8{static isSupported(){return Pv.isSupported()}constructor(t){W(this,"name","unnamed"),W(this,"source",void 0),W(this,"url",void 0),W(this,"maxConcurrency",1),W(this,"maxMobileConcurrency",1),W(this,"onDebug",()=>{}),W(this,"reuseWorkers",!0),W(this,"props",{}),W(this,"jobQueue",[]),W(this,"idleQueue",[]),W(this,"count",0),W(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,a,o)=>s.done(o),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,a)=>s.error(a);const i=new Promise(s=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new w8(e.name,t);t.onMessage=i=>e.onMessage(n,i.type,i.payload),t.onError=i=>e.onError(n,i),e.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Pv({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return b8?this.maxMobileConcurrency:this.maxConcurrency}}const S8={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Ru{static isSupported(){return Pv.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ru._workerFarm=Ru._workerFarm||new Ru({}),Ru._workerFarm.setProps(t),Ru._workerFarm}constructor(t){W(this,"props",void 0),W(this,"workerPools",new Map),this.props={...S8},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:i}=t;let s=this.workerPools.get(e);return s||(s=new E8({name:e,source:n,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}W(Ru,"_workerFarm",void 0);const T8="latest";function I8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t[r.id]||{},n="".concat(r.id,"-worker.js");let i=e.workerUrl;if(!i&&r.id==="compression"&&(i=t.workerUrl),t._workerType==="test"&&(i="modules/".concat(r.module,"/dist/").concat(n)),!i){let s=r.version;s==="latest"&&(s=T8);const a=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(r.module).concat(a,"/dist/").concat(n)}return Qc(i),i}function F8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_8;Qc(r,"no worker provided");const e=r.version;return!(!t||!e)}const L8=null,P8=null,Mv=null,HS=null,M8=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:L8,readFileAsText:P8,requireFromFile:Mv,requireFromString:HS},Symbol.toStringTag,{value:"Module"})),U8="3.4.15",Uv={};async function Uh(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t&&(r=R8(r,t,e)),Uv[r]=Uv[r]||O8(r),await Uv[r]}function R8(r,t,e){if(r.startsWith("http"))return r;const n=e.modules||{};return n[r]?n[r]:Uu?e.CDN?(Qc(e.CDN.startsWith("http")),"".concat(e.CDN,"/").concat(t,"@").concat(U8,"/dist/libs/").concat(r)):Tv?"../src/libs/".concat(r):"modules/".concat(t,"/src/libs/").concat(r):"modules/".concat(t,"/dist/libs/").concat(r)}async function O8(r){if(r.endsWith("wasm"))return await(await fetch(r)).arrayBuffer();if(!Uu)try{return M8&&Mv&&await Mv(r)}catch{return null}if(Tv)return importScripts(r);const e=await(await fetch(r)).text();return D8(e,r)}function D8(r,t){if(!Uu)return HS;if(Tv)return eval.call(v8,r),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(r))}catch{e.text=r}return document.body.appendChild(e),null}function N8(r,t){return!Ru.isSupported()||!Uu&&!(t!=null&&t._nodeWorkers)?!1:r.worker&&(t==null?void 0:t.worker)}async function k8(r,t,e,n,i){const s=r.id,a=I8(r,e),h=Ru.getWorkerFarm(e).getWorkerPool({name:s,url:a});e=JSON.parse(JSON.stringify(e)),n=JSON.parse(JSON.stringify(n||{}));const f=await h.startJob("process-on-worker",Q8.bind(null,i));return f.postMessage("process",{input:t,options:e,context:n}),await(await f.result).result}async function Q8(r,t,e,n){switch(e){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:i,input:s,options:a}=n;try{const o=await r(s,a);t.postMessage("done",{id:i,result:o})}catch(o){const h=o instanceof Error?o.message:"unknown error";t.postMessage("error",{id:i,error:h})}break;default:console.warn("parse-with-worker unknown message ".concat(e))}}function H8(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,t):ArrayBuffer.isView(r)?zS(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?zS(r,0,t):""}function zS(r,t,e){if(r.byteLength<=t+e)return"";const n=new DataView(r);let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(n.getUint8(t+s));return i}function z8(r){try{return JSON.parse(r)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(H8(r),'"'))}}function V8(r,t,e){if(e=e||r.byteLength,r.byteLength<e||t.byteLength<e)return!1;const n=new Uint8Array(r),i=new Uint8Array(t);for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}function G8(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];const n=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),i=n.reduce((o,h)=>o+h.byteLength,0),s=new Uint8Array(i);let a=0;for(const o of n)s.set(o,a),a+=o.byteLength;return s.buffer}function Rv(r,t,e){const n=e!==void 0?new Uint8Array(r).subarray(t,t+e):new Uint8Array(r).subarray(t);return new Uint8Array(n).buffer}function jp(r,t){return ui(r>=0),ui(t>0),r+(t-1)&~(t-1)}function j8(r,t,e){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,s=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,s)}return t.set(n,e),e+jp(n.byteLength,4)}async function q8(r){const t=[];for await(const e of r)t.push(e);return G8(...t)}function VS(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();r=t[0]*1e3+t[1]/1e6}else r=Date.now();return r}class GS{constructor(t,e){W(this,"name",void 0),W(this,"type",void 0),W(this,"sampleSize",1),W(this,"time",void 0),W(this,"count",void 0),W(this,"samples",void 0),W(this,"lastTiming",void 0),W(this,"lastSampleTime",void 0),W(this,"lastSampleCount",void 0),W(this,"_count",0),W(this,"_time",0),W(this,"_samples",0),W(this,"_startTime",0),W(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=VS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(VS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class qp{constructor(t){W(this,"id",void 0),W(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:n}=t;return this.stats[e]||(t instanceof GS?this.stats[e]=t:this.stats[e]=new GS(e,n)),this.stats[e]}}const K8="Queued Requests",W8="Active Requests",$8="Cancelled Requests",X8="Queued Requests Ever",J8="Active Requests Ever",Y8={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Z8{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};W(this,"props",void 0),W(this,"stats",void 0),W(this,"activeRequestCount",0),W(this,"requestQueue",[]),W(this,"requestMap",new Map),W(this,"deferredUpdate",null),this.props={...Y8,...t},this.stats=new qp({id:this.props.id}),this.stats.get(K8),this.stats.get(W8),this.stats.get($8),this.stats.get(X8),this.stats.get(J8)}scheduleRequest(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:e},i=new Promise(s=>(n.resolve=s,n));return this.requestQueue.push(n),this.requestMap.set(t,i),this._issueNewRequests(),i}_issueRequest(t){const{handle:e,resolve:n}=t;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort((e,n)=>e.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let tQ="";const jS={};function eQ(r){for(const t in jS)if(r.startsWith(t)){const e=jS[t];r=r.replace(t,e)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r="".concat(tQ).concat(r)),r}function $wt(r){return r}function rQ(r){return r&&typeof r=="object"&&r.isBuffer}function qS(r){if(rQ(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const t=r;return new TextEncoder().encode(t).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function KS(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(t+1):""}function Ov(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(0,t):""}const nQ=r=>typeof r=="boolean",Kp=r=>typeof r=="function",Wp=r=>r!==null&&typeof r=="object",WS=r=>Wp(r)&&r.constructor==={}.constructor,iQ=r=>r&&typeof r[Symbol.iterator]=="function",sQ=r=>r&&typeof r[Symbol.asyncIterator]=="function",Rh=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,Oh=r=>typeof Blob<"u"&&r instanceof Blob,oQ=r=>r&&typeof r=="object"&&r.isBuffer,aQ=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||Wp(r)&&Kp(r.tee)&&Kp(r.cancel)&&Kp(r.getReader),lQ=r=>Wp(r)&&Kp(r.read)&&Kp(r.pipe)&&nQ(r.readable),$S=r=>aQ(r)||lQ(r),cQ=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,uQ=/^([-\w.]+\/[-\w.+]+)/;function AQ(r){const t=uQ.exec(r);return t?t[1]:r}function XS(r){const t=cQ.exec(r);return t?t[1]:""}const JS=/\?.*/;function hQ(r){const t=r.match(JS);return t&&t[0]}function Dv(r){return r.replace(JS,"")}function y0(r){return Rh(r)?r.url:Oh(r)?r.name||"":typeof r=="string"?r:""}function Nv(r){if(Rh(r)){const t=r,e=t.headers.get("content-type")||"",n=Dv(t.url);return AQ(e)||XS(n)}return Oh(r)?r.type||"":typeof r=="string"?XS(r):""}function dQ(r){return Rh(r)?r.headers["content-length"]||-1:Oh(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function YS(r){if(Rh(r))return r;const t={},e=dQ(r);e>=0&&(t["content-length"]=String(e));const n=y0(r),i=Nv(r);i&&(t["content-type"]=i);const s=await gQ(r);s&&(t["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r));const a=new Response(r,{headers:t});return Object.defineProperty(a,"url",{value:n}),a}async function fQ(r){if(!r.ok){const t=await pQ(r);throw new Error(t)}}async function pQ(r){let t="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): ");try{const e=r.headers.get("Content-Type");let n=r.statusText;e.includes("application/json")&&(n+=" ".concat(await r.text())),t+=n,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function gQ(r){if(typeof r=="string")return"data:,".concat(r.slice(0,5));if(r instanceof Blob){const e=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=s=>{var a;return n(s==null||(a=s.target)===null||a===void 0?void 0:a.result)},i.readAsDataURL(e)})}if(r instanceof ArrayBuffer){const e=r.slice(0,5),n=mQ(e);return"data:base64,".concat(n)}return null}function mQ(r){let t="";const e=new Uint8Array(r);for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)}async function ZS(r,t){if(typeof r=="string"){r=eQ(r);let e=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(e=t.fetch),await fetch(r,e)}return await YS(r)}function tT(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function Ou(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||tT()}const _0={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},v0=_0.window||_0.self||_0.global,$p=_0.process||{},eT=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Ou();const kv=globalThis;function rT(r){if(!Ou())return"Node";if(tT())return"Electron";const e=(typeof navigator<"u"?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";const n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i?"IE":kv.chrome?"Chrome":kv.safari?"Safari":kv.mozInnerScreenX?"Firefox":"Unknown"}function yQ(r){try{const t=window[r],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class _Q{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";W(this,"storage",void 0),W(this,"id",void 0),W(this,"config",void 0),this.storage=yQ(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function vQ(r){let t;return r<10?t="".concat(r.toFixed(2),"ms"):r<100?t="".concat(r.toFixed(1),"ms"):r<1e3?t="".concat(r.toFixed(0),"ms"):t="".concat((r/1e3).toFixed(2),"s"),t}function bQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-r.length,0);return"".concat(" ".repeat(e)).concat(r)}function Qv(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>n&&(e=Math.min(e,n/r.width));const s=r.width*e,a=r.height*e,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}let b0;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(b0||(b0={}));function nT(r){return typeof r=="string"?b0[r.toUpperCase()]||b0.WHITE:r}function wQ(r,t,e){return!Ou&&typeof r=="string"&&(t&&(t=nT(t),r="\x1B[".concat(t,"m").concat(r,"\x1B[39m")),e&&(t=nT(e),r="\x1B[".concat(e+10,"m").concat(r,"\x1B[49m"))),r}function xQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(e);for(const i of n)typeof r[i]=="function"&&(t.find(s=>i===s)||(r[i]=r[i].bind(r)))}function w0(r,t){if(!r)throw new Error(t||"Assertion failed")}function Xd(){let r;if(Ou&&"performance"in v0){var t,e;r=v0==null||(t=v0.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in $p){var n;const i=$p==null||(n=$p.hrtime)===null||n===void 0?void 0:n.call($p);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const Jd={debug:Ou&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},BQ={enabled:!0,level:0};function pl(){}const iT={},sT={once:!0};class Xp{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};W(this,"id",void 0),W(this,"VERSION",eT),W(this,"_startTs",Xd()),W(this,"_deltaTs",Xd()),W(this,"_storage",void 0),W(this,"userData",{}),W(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new _Q("__probe-".concat(this.id,"__"),BQ),this.timeStamp("".concat(this.id," started")),xQ(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Xd()-this._startTs).toPrecision(10))}getDelta(){return Number((Xd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){w0(t,e)}warn(t){return this._getLogFunction(0,t,Jd.warn,arguments,sT)}error(t){return this._getLogFunction(0,t,Jd.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,Jd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Jd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return this._getLogFunction(t,e,Jd.debug||Jd.info,arguments,sT)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||pl,n&&[n],{tag:TQ(e)}):pl}image(t){let{logLevel:e,priority:n,image:i,message:s="",scale:a=1}=t;return this._shouldLog(e||n)?Ou?SQ({image:i,message:s,scale:a}):EQ():pl}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||pl)}group(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=aT({logLevel:t,message:e,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||pl)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=oT(t)}_getLogFunction(t,e,n,i,s){if(this._shouldLog(t)){s=aT({logLevel:t,message:e,args:i,opts:s}),n=n||s.method,w0(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Xd();const a=s.tag||s.message;if(s.once)if(!iT[a])iT[a]=Xd();else return pl;return e=CQ(this.id,s.message,s),n.bind(console,e,...s.args)}return pl}}W(Xp,"VERSION",eT);function oT(r){if(!r)return 0;let t;switch(typeof r){case"number":t=r;break;case"object":t=r.logLevel||r.priority||0;break;default:return 0}return w0(Number.isFinite(t)&&t>=0),t}function aT(r){const{logLevel:t,message:e}=r;r.logLevel=oT(t);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),r.message=t;break;case"object":Object.assign(r,t);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return w0(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function CQ(r,t,e){if(typeof t=="string"){const n=e.time?bQ(vQ(e.total)):"";t=e.time?"".concat(r,": ").concat(n,"  ").concat(t):"".concat(r,": ").concat(t),t=wQ(t,e.color,e.background)}return t}function EQ(r){return console.warn("removed"),pl}function SQ(r){let{image:t,message:e="",scale:n=1}=r;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const a=Qv(s,e,n);console.log(...a)},s.src=t,pl}const i=t.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Qv(t,e,n)),pl;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Qv(s,e,n)),s.src=t.toDataURL(),pl}return pl}function TQ(r){for(const t in r)for(const e in r[t])return e||"untitled";return"empty"}const lT=new Xp({id:"loaders.gl"});class IQ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class FQ{constructor(){W(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.error.bind(this.console,...e)}}const cT={fetch:null,mimeType:void 0,nothrow:!1,log:new FQ,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:m0,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},LQ={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function uT(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state=r._state||{},r._state}const AT=()=>{const r=uT();return r.globalOptions=r.globalOptions||{...cT},r.globalOptions};function PQ(r,t,e,n){return e=e||[],e=Array.isArray(e)?e:[e],MQ(r,e),RQ(t,r,n)}function MQ(r,t){hT(r,null,cT,LQ,t);for(const e of t){const n=r&&r[e.id]||{},i=e.options&&e.options[e.id]||{},s=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};hT(n,e.id,i,s,t)}}function hT(r,t,e,n,i){const s=t||"Top level",a=t?"".concat(t,"."):"";for(const o in r){const h=!t&&Wp(r[o]),f=o==="baseUri"&&!t,m=o==="workerUrl"&&t;if(!(o in e)&&!f&&!m){if(o in n)lT.warn("".concat(s," loader option '").concat(a).concat(o,"' no longer supported, use '").concat(n[o],"'"))();else if(!h){const b=UQ(o,i);lT.warn("".concat(s," loader option '").concat(a).concat(o,"' not recognized. ").concat(b))()}}}}function UQ(r,t){const e=r.toLowerCase();let n="";for(const i of t)for(const s in i.options){if(r===s)return"Did you mean '".concat(i.id,".").concat(s,"'?");const a=s.toLowerCase();(e.startsWith(a)||a.startsWith(e))&&(n=n||"Did you mean '".concat(i.id,".").concat(s,"'?"))}return n}function RQ(r,t,e){const i={...r.options||{}};return OQ(i,e),i.log===null&&(i.log=new IQ),dT(i,AT()),dT(i,t),i}function dT(r,t){for(const e in t)if(e in t){const n=t[e];WS(n)&&WS(r[e])?r[e]={...r[e],...t[e]}:r[e]=t[e]}}function OQ(r,t){t&&!("baseUri"in r)&&(r.baseUri=t)}function Hv(r){var t;return r?(Array.isArray(r)&&(r=r[0]),Array.isArray((t=r)===null||t===void 0?void 0:t.extensions)):!1}function zv(r){var t,e;ui(r,"null loader"),ui(Hv(r),"invalid loader");let n;return Array.isArray(r)&&(n=r[1],r=r[0],r={...r,options:{...r.options,...n}}),((t=r)!==null&&t!==void 0&&t.parseTextSync||(e=r)!==null&&e!==void 0&&e.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const fT=()=>{const r=uT();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function DQ(r){const t=fT();r=Array.isArray(r)?r:[r];for(const e of r){const n=zv(e);t.find(i=>n===i)||t.unshift(n)}}function NQ(){return fT()}const kQ=new Xp({id:"loaders.gl"}),QQ=/\.([^.]+)$/;async function HQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!gT(r))return null;let i=pT(r,t,{...e,nothrow:!0},n);if(i)return i;if(Oh(r)&&(r=await r.slice(0,10).arrayBuffer(),i=pT(r,t,e,n)),!i&&!(e!=null&&e.nothrow))throw new Error(mT(r));return i}function pT(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!gT(r))return null;if(t&&!Array.isArray(t))return zv(t);let i=[];t&&(i=i.concat(t)),e!=null&&e.ignoreRegisteredLoaders||i.push(...NQ()),VQ(i);const s=zQ(r,i,e,n);if(!s&&!(e!=null&&e.nothrow))throw new Error(mT(r));return s}function zQ(r,t,e,n){const i=y0(r),s=Nv(r),a=Dv(i)||(n==null?void 0:n.url);let o=null,h="";if(e!=null&&e.mimeType&&(o=Vv(t,e==null?void 0:e.mimeType),h="match forced by supplied MIME type ".concat(e==null?void 0:e.mimeType)),o=o||GQ(t,a),h=h||(o?"matched url ".concat(a):""),o=o||Vv(t,s),h=h||(o?"matched MIME type ".concat(s):""),o=o||qQ(t,r),h=h||(o?"matched initial data ".concat(_T(r)):""),o=o||Vv(t,e==null?void 0:e.fallbackMimeType),h=h||(o?"matched fallback MIME type ".concat(s):""),h){var f;kQ.log(1,"selectLoader selected ".concat((f=o)===null||f===void 0?void 0:f.name,": ").concat(h,"."))}return o}function gT(r){return!(r instanceof Response&&r.status===204)}function mT(r){const t=y0(r),e=Nv(r);let n="No valid loader found (";n+=t?"".concat(KS(t),", "):"no url provided, ",n+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");const i=r?_T(r):"";return n+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",n+=")",n}function VQ(r){for(const t of r)zv(t)}function GQ(r,t){const e=t&&QQ.exec(t),n=e&&e[1];return n?jQ(r,n):null}function jQ(r,t){t=t.toLowerCase();for(const e of r)for(const n of e.extensions)if(n.toLowerCase()===t)return e;return null}function Vv(r,t){for(const e of r)if(e.mimeTypes&&e.mimeTypes.includes(t)||t==="application/x.".concat(e.id))return e;return null}function qQ(r,t){if(!t)return null;for(const e of r)if(typeof t=="string"){if(KQ(t,e))return e}else if(ArrayBuffer.isView(t)){if(yT(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&yT(t,0,e))return e;return null}function KQ(r,t){return t.testText?t.testText(r):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>r.startsWith(n))}function yT(r,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>WQ(r,t,e,i))}function WQ(r,t,e,n){if(n instanceof ArrayBuffer)return V8(n,r,n.byteLength);switch(typeof n){case"function":return n(r,e);case"string":const i=Gv(r,t,n.length);return n===i;default:return!1}}function _T(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,t):ArrayBuffer.isView(r)?Gv(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?Gv(r,0,t):""}function Gv(r,t,e){if(r.byteLength<t+e)return"";const n=new DataView(r);let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(n.getUint8(t+s));return i}const $Q=256*1024;function*XQ(r,t){const e=(t==null?void 0:t.chunkSize)||$Q;let n=0;const i=new TextEncoder;for(;n<r.length;){const s=Math.min(r.length-n,e),a=r.slice(n,n+s);n+=s,yield i.encode(a)}}const JQ=256*1024;function YQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:e=JQ}=t;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,e),s=new ArrayBuffer(i),a=new Uint8Array(r,n,i);new Uint8Array(s).set(a),n+=i,yield s}}()}const ZQ=1024*1024;async function*tH(r,t){const e=(t==null?void 0:t.chunkSize)||ZQ;let n=0;for(;n<r.size;){const i=n+e,s=await r.slice(n,i).arrayBuffer();n=i,yield s}}function vT(r,t){return m0?eH(r,t):rH(r)}async function*eH(r,t){const e=r.getReader();let n;try{for(;;){const i=n||e.read();t!=null&&t._streamReadAhead&&(n=e.read());const{done:s,value:a}=await i;if(s)return;yield qS(a)}}catch{e.releaseLock()}}async function*rH(r,t){for await(const e of r)yield qS(e)}function nH(r,t){if(typeof r=="string")return XQ(r,t);if(r instanceof ArrayBuffer)return YQ(r,t);if(Oh(r))return tH(r,t);if($S(r))return vT(r,t);if(Rh(r))return vT(r.body,t);throw new Error("makeIterator")}const bT="Cannot convert supplied data type";function iH(r,t,e){if(t.text&&typeof r=="string")return r;if(oQ(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(bT)}async function sH(r,t,e){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return iH(r,t);if(Oh(r)&&(r=await YS(r)),Rh(r)){const i=r;return await fQ(i),t.binary?await i.arrayBuffer():await i.text()}if($S(r)&&(r=nH(r,e)),iQ(r)||sQ(r))return q8(r);throw new Error(bT)}function wT(r,t){const e=AT(),n=r||e;return typeof n.fetch=="function"?n.fetch:Wp(n.fetch)?i=>ZS(i,n):t!=null&&t.fetch?t==null?void 0:t.fetch:ZS}function oH(r,t,e){if(e)return e;const n={fetch:wT(t,r),...r};if(n.url){const i=Dv(n.url);n.baseUrl=i,n.queryString=hQ(n.url),n.filename=KS(i),n.baseUrl=Ov(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function aH(r,t){if(!t&&r&&!Array.isArray(r))return r;let e;if(r&&(e=Array.isArray(r)?r:[r]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...n]:n}return e&&e.length?e:null}async function jv(r,t,e,n){Qc(!n||typeof n=="object"),t&&!Array.isArray(t)&&!Hv(t)&&(n=void 0,e=t,t=void 0),r=await r,e=e||{};const i=y0(r),a=aH(t,n),o=await HQ(r,a,e);return o?(e=PQ(e,o,a,i),n=oH({url:i,parse:jv,loaders:a},e,n||null),await lH(o,r,e,n)):null}async function lH(r,t,e,n){if(F8(r),Rh(t)){const i=t,{ok:s,redirected:a,status:o,statusText:h,type:f,url:m}=i,b=Object.fromEntries(i.headers.entries());n.response={headers:b,ok:s,redirected:a,status:o,statusText:h,type:f,url:m}}if(t=await sH(t,r,e),r.parseTextSync&&typeof t=="string")return e.dataType="text",r.parseTextSync(t,e,n,r);if(N8(r,e))return await k8(r,t,e,n,jv);if(r.parseText&&typeof t=="string")return await r.parseText(t,e,n,r);if(r.parse)return await r.parse(t,e,n,r);throw Qc(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"))}async function FA(r,t,e,n){!Array.isArray(t)&&!Hv(t)&&(e=t,t=void 0);const i=wT(e);let s=r;return typeof r=="string"&&(s=await i(r)),Oh(r)&&(s=await i(r)),await jv(s,t,e)}const cH="3.4.15",{_parseImageNode:uH}=globalThis,qv=typeof Image<"u",Kv=typeof ImageBitmap<"u",Wv=m0?!0:!!uH;function AH(r){switch(r){case"auto":return Kv||qv||Wv;case"imagebitmap":return Kv;case"image":return qv;case"data":return Wv;default:throw new Error("@loaders.gl/images: image ".concat(r," not supported in this environment"))}}function hH(){if(Kv)return"imagebitmap";if(qv)return"image";if(Wv)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function dH(r){const t=pH(r);if(!t)throw new Error("Not an image");return t}function fH(r){switch(dH(r)){case"data":return r;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=r.width,t.height=r.height,e.drawImage(r,0,0),e.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function pH(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const gH=/^data:image\/svg\+xml/,mH=/\.svg((\?|#).*)?$/;function $v(r){return r&&(gH.test(r)||mH.test(r))}function yH(r,t){if($v(t)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(n))}return xT(r,t)}function xT(r,t){if($v(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function BT(r,t,e){const n=yH(r,e),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await _H(s||n,t)}finally{s&&i.revokeObjectURL(s)}}async function _H(r,t){const e=new Image;return e.src=r,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((n,i)=>{try{e.onload=()=>n(e),e.onerror=s=>i(new Error("Could not load image ".concat(r,": ").concat(s)))}catch(s){i(s)}})}const vH={};let CT=!0;async function bH(r,t,e){let n;$v(e)?n=await BT(r,t,e):n=xT(r,e);const i=t&&t.imagebitmap;return await wH(n,i)}async function wH(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((xH(t)||!CT)&&(t=null),t)try{return await createImageBitmap(r,t)}catch(e){console.warn(e),CT=!1}return await createImageBitmap(r)}function xH(r){for(const t in r||vH)return!1;return!0}function BH(r){return!TH(r,"ftyp",4)||!(r[8]&96)?null:CH(r)}function CH(r){switch(EH(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function EH(r,t,e){return String.fromCharCode(...r.slice(t,e))}function SH(r){return[...r].map(t=>t.charCodeAt(0))}function TH(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=SH(t);for(let i=0;i<n.length;++i)if(n[i]!==r[i+e])return!1;return!0}const Hc=!1,Jp=!0;function Xv(r){const t=Yp(r);return FH(t)||MH(t)||LH(t)||PH(t)||IH(t)}function IH(r){const t=new Uint8Array(r instanceof DataView?r.buffer:r),e=BH(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function FH(r){const t=Yp(r);return t.byteLength>=24&&t.getUint32(0,Hc)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Hc),height:t.getUint32(20,Hc)}:null}function LH(r){const t=Yp(r);return t.byteLength>=10&&t.getUint32(0,Hc)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Jp),height:t.getUint16(8,Jp)}:null}function PH(r){const t=Yp(r);return t.byteLength>=14&&t.getUint16(0,Hc)===16973&&t.getUint32(2,Jp)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Jp),height:t.getUint32(22,Jp)}:null}function MH(r){const t=Yp(r);if(!(t.byteLength>=3&&t.getUint16(0,Hc)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=UH();let s=2;for(;s+9<t.byteLength;){const a=t.getUint16(s,Hc);if(i.has(a))return{mimeType:"image/jpeg",height:t.getUint16(s+5,Hc),width:t.getUint16(s+7,Hc)};if(!n.has(a))return null;s+=2,s+=t.getUint16(s,Hc)}return null}function UH(){const r=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)r.add(e);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Yp(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function RH(r,t){const{mimeType:e}=Xv(r)||{},n=globalThis._parseImageNode;return ui(n),await n(r,e)}async function OH(r,t,e){t=t||{};const i=(t.image||{}).type||"auto",{url:s}=e||{},a=DH(i);let o;switch(a){case"imagebitmap":o=await bH(r,t,s);break;case"image":o=await BT(r,t,s);break;case"data":o=await RH(r);break;default:ui(!1)}return i==="data"&&(o=fH(o)),o}function DH(r){switch(r){case"auto":case"data":return hH();default:return AH(r),r}}const ET={id:"image",module:"images",name:"Images",version:cH,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:OH,tests:[r=>!!Xv(new DataView(r))],options:{image:{type:"auto",decode:!0}}},Jv={};function NH(r){if(Jv[r]===void 0){const t=m0?QH(r):kH(r);Jv[r]=t}return Jv[r]}function kH(r){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:e,_imageFormatsNode:n=t}=globalThis;return!!e&&n.includes(r)}function QH(r){switch(r){case"image/avif":case"image/webp":return HH(r);default:return!0}}function HH(r){try{return document.createElement("canvas").toDataURL(r).indexOf("data:".concat(r))===0}catch{return!1}}const Bn=new Xp({id:"deck"}),LA={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},Yv=1,Zp=2,Zv=3,tb=4,zH=2,VH=r=>({"layer.changeFlag":(t,e,n)=>{r.log(Zv,"".concat(t.id," ").concat(e,": "),n[e])()},"layer.initialize":t=>{r.log(Yv,"Initializing ".concat(t))()},"layer.update":(t,e)=>{if(e){const n=t.getChangeFlags();r.log(Zp,"Updating ".concat(t," because: ").concat(Object.keys(n).filter(i=>n[i]).join(", ")))()}else r.log(tb,"".concat(t," does not need update"))()},"layer.matched":(t,e)=>{e&&r.log(tb,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{r.log(Yv,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,e,n)=>{e?r.log(Zp,"Composite layer rendered new subLayers ".concat(t),n)():r.log(tb,"Composite layer reused subLayers ".concat(t),n)()},"layerManager.setLayers":(t,e,n)=>{e&&r.log(Zp,"Updating ".concat(n.length," deck layers"))()},"layerManager.activateViewport":(t,e)=>{r.log(Zv,"Viewport changed",e)()},"attributeManager.invalidate":(t,e,n)=>{r.log(Yv,n?"invalidated attributes ".concat(n," (").concat(e,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":t=>{LA.attributeUpdateMessages.length=0,LA.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,e)=>{const n=Math.round(Date.now()-LA.attributeManagerUpdateStart);r.groupCollapsed(Zp,"Updated attributes for ".concat(e," instances in ").concat(t.id," in ").concat(n,"ms"))();for(const i of LA.attributeUpdateMessages)r.log(Zv,i)();r.groupEnd(Zp)()},"attribute.updateStart":t=>{LA.attributeUpdateStart=Date.now()},"attribute.allocate":(t,e)=>{const n="".concat(t.id," allocated ").concat(e);LA.attributeUpdateMessages.push(n)},"attribute.updateEnd":(t,e)=>{const n=Math.round(Date.now()-LA.attributeUpdateStart),i="".concat(t.id," updated ").concat(e," in ").concat(n,"ms");LA.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":(t,e,n)=>{const{pass:i,redrawReason:s,stats:a}=n;for(const o of e){const{totalCount:h,visibleCount:f,compositeCount:m,pickableCount:b}=o,B=h-m-f;r.log(zH,"RENDER #".concat(t.renderCount,"   ").concat(f," (of ").concat(h," layers) to ").concat(i," because ").concat(s,"   (").concat(B," hidden, ").concat(m," composite ").concat(b," pickable)"))(),a&&a.get("Redraw Layers").add(f)}}});var GH={};let x0={};GH.NODE_ENV!=="production"&&(x0=VH(Bn));function jH(r){x0=r}function uo(r,t,e,n){Bn.level>0&&x0[r]&&x0[r].call(null,t,e,n)}function qH(r){const t=r[0],e=r[r.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const KH={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:qH,parseTextSync:JSON.parse};function WH(){const r="8.9.36",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==r)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(r));return t||(Bn.log(1,"deck.gl ".concat(r))(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:Bn,_registerLoggers:jH},DQ([KH,[ET,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const $H=WH(),xn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(xn,"IDENTITY",{get:()=>(Bn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const zc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},eb={common:0,meters:1,pixels:2},ST={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},wr=new Xp({id:"luma.gl"});function Oo(r,t){if(!r)throw new Error(t||"luma.gl: assertion failed.")}const XH="Invalid WebGLRenderingContext",JH="Requires WebGL2";function B0(r){return typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}function fn(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function YH(r){return fn(r)?r:null}function C0(r){return Oo(B0(r),XH),r}function Do(r){return Oo(fn(r),JH),r}const tg={};function ZH(r){globalThis.console&&globalThis.console.error&&globalThis.console.error(r)}function tz(r){globalThis.console&&globalThis.console.log&&globalThis.console.log(r)}function ez(r,t){tg[r]=!0,ZH(t)}function rz(r){const t=r.getError;r.getError=function(){let n;do n=t.apply(r),n!==0&&(tg[n]=!0);while(n!==0);for(n in tg)if(tg[n])return delete tg[n],parseInt(n,10);return 0}}const eg=function r(t){const e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let n=0;n<this.attribs.length;n++){const i=new r.VertexAttrib(e);this.attribs[n]=i}this.maxAttrib=0};eg.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},eg.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Dh=function(t){const e=this;this.gl=t,rz(t);const n=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(s){return s===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(s){const a=e.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const o=a.attribs[s];return o.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(s){const a=e.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const o=a.attribs[s];return o.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(s,a){switch(s){case 34962:e.currentArrayBuffer=a;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=a;break}return n.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(s,a){const h=e.currentVertexArrayObject.attribs[s];switch(a){case 34975:return h.buffer;case 34338:return h.enabled;case 34339:return h.size;case 34340:return h.stride;case 34341:return h.type;case 34922:return h.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(s,a,o,h,f,m){const b=e.currentVertexArrayObject;b.maxAttrib=Math.max(b.maxAttrib,s);const x=b.attribs[s];return x.buffer=e.currentArrayBuffer,x.size=a,x.type=o,x.normalized=h,x.stride=f,x.offset=m,x.recache(),n.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",()=>{tz("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};Dh.prototype.VERTEX_ARRAY_BINDING_OES=34229,Dh.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let n=0;n<this.vertexArrayObjects.length;++n)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new eg(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},Dh.prototype.createVertexArrayOES=function(){const t=new eg(this);return this.vertexArrayObjects.push(t),t},Dh.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},Dh.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof eg&&t.hasBeenBound&&t.ext===this)},Dh.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive){ez(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(i===s)return;(!i||s.elementArrayBuffer!==i.elementArrayBuffer)&&n.bindBuffer.call(e,34963,s.elementArrayBuffer);let a=this.currentArrayBuffer;const o=Math.max(i?i.maxAttrib:0,s.maxAttrib);for(let h=0;h<=o;h++){const f=s.attribs[h],m=i?i.attribs[h]:null;if((!i||f.enabled!==m.enabled)&&(f.enabled?n.enableVertexAttribArray.call(e,h):n.disableVertexAttribArray.call(e,h)),f.enabled){let b=!1;(!i||f.buffer!==m.buffer)&&(a!==f.buffer&&(n.bindBuffer.call(e,34962,f.buffer),a=f.buffer),b=!0),(b||f.cached!==m.cached)&&n.vertexAttribPointer.call(e,h,f.size,f.type,f.normalized,f.stride,f.offset)}}this.currentArrayBuffer!==a&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)};function nz(r){if(typeof r.createVertexArray=="function")return;const t=r.getSupportedExtensions;r.getSupportedExtensions=function(){const i=t.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const e=r.getExtension;r.getExtension=function(i){const s=e.call(this,i);return s||(i!=="OES_vertex_array_object"?null:(r.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Dh(this)),this.__OESVertexArrayObject))}}const TT="OES_element_index",IT="WEBGL_draw_buffers",iz="EXT_disjoint_timer_query",sz="EXT_disjoint_timer_query_webgl2",oz="EXT_texture_filter_anisotropic",FT="WEBGL_debug_renderer_info",az=35723,lz=4352,cz=36795,uz=34047,Az=37445,hz=37446,fi=r=>fn(r)?void 0:0,dz={3074:r=>fn(r)?void 0:36064,[az]:r=>fn(r)?void 0:lz,35977:fi,32937:fi,[cz]:(r,t)=>{const e=fn(r)?r.getExtension(sz):r.getExtension(iz);return e&&e.GPU_DISJOINT_EXT?t(e.GPU_DISJOINT_EXT):0},[Az]:(r,t)=>{const e=r.getExtension(FT);return t(e&&e.UNMASKED_VENDOR_WEBGL||7936)},[hz]:(r,t)=>{const e=r.getExtension(FT);return t(e&&e.UNMASKED_RENDERER_WEBGL||7937)},[uz]:(r,t)=>{const e=r.luma.extensions[oz];return e?t(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:fi,35071:fi,37447:fi,36063:(r,t)=>{if(!fn(r)){const e=r.getExtension(IT);return e?t(e.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:fi,35374:fi,35377:fi,34852:r=>{if(!fn(r)){const t=r.getExtension(IT);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:r=>r.getExtension(TT)?2147483647:65535,33001:r=>r.getExtension(TT)?16777216:65535,33e3:r=>16777216,37157:fi,35373:fi,35657:fi,36183:fi,37137:fi,34045:fi,35978:fi,35979:fi,35968:fi,35376:fi,35375:fi,35659:fi,37154:fi,35371:fi,35658:fi,35076:fi,35077:fi,35380:fi};function fz(r,t,e){const n=dz[e],i=typeof n=="function"?n(r,t,e):n;return i!==void 0?i:t(e)}const pz="OES_vertex_array_object",LT="ANGLE_instanced_arrays",gz="WEBGL_draw_buffers",mz="EXT_disjoint_timer_query",yz="EXT_texture_filter_anisotropic",_z="VertexArray requires WebGL2 or OES_vertex_array_object extension";function vz(r,t){return{webgl2:fn(r),ext:r.getExtension(t)}}const PT={[pz]:{meta:{suffix:"OES"},createVertexArray:()=>{Oo(!1,_z)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[LT]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(r,t){Oo(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[gz]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Oo(!1)}},[mz]:{meta:{suffix:"EXT"},createQuery:()=>{Oo(!1)},deleteQuery:()=>{Oo(!1)},beginQuery:()=>{Oo(!1)},endQuery:()=>{},getQuery(r,t){return this.getQueryObject(r,t)},getQueryParameter(r,t){return this.getQueryObject(r,t)},getQueryObject:()=>{}}},rb={readBuffer:(r,t,e)=>{fn(r)&&t(e)},getVertexAttrib:(r,t,e,n)=>{const{webgl2:i,ext:s}=vz(r,LT);let a;switch(n){case 35069:a=i?void 0:!1;break;case 35070:a=!i&&!s?0:void 0;break}return a!==void 0?a:t(e,n)},getProgramParameter:(r,t,e,n)=>{if(!fn(r))switch(n){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(e,n)},getInternalformatParameter:(r,t,e,n,i)=>{if(!fn(r))switch(i){case 32937:return new Int32Array([0])}return r.getInternalformatParameter(e,n,i)},getTexParameter(r,t,e,n){switch(n){case 34046:const{extensions:i}=r.luma,s=i[yz];n=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(e,n)},getParameter:fz,hint(r,t,e,n){return t(e,n)}};function bz(r){r.luma=r.luma||{};const{luma:t}=r;return t.polyfilled||(nz(r),wz(r),Bz(r,PT),xz(r,{target:t,target2:r}),t.polyfilled=!0),r}globalThis.polyfillContext=bz;function wz(r){r.luma.extensions={};const t=r.getSupportedExtensions()||[];for(const e of t)r.luma[e]=r.getExtension(e)}function xz(r,t){let{target:e,target2:n}=t;Object.keys(rb).forEach(i=>{if(typeof rb[i]=="function"){const s=r[i]?r[i].bind(r):()=>{},a=rb[i].bind(null,r,s);e[i]=a,n[i]=a}})}function Bz(r,t){for(const e of Object.getOwnPropertyNames(t))e!=="overrides"&&Cz(r,{extension:e,target:r.luma,target2:r})}function Cz(r,t){let{extension:e,target:n,target2:i}=t;const s=PT[e];Oo(s);const{meta:a={}}=s,{suffix:o=""}=a,h=r.getExtension(e);for(const f of Object.keys(s)){const m="".concat(f).concat(o);let b=null;f==="meta"||typeof r[f]=="function"||(h&&typeof h[m]=="function"?b=function(){return h[m](...arguments)}:typeof s[f]=="function"&&(b=s[f].bind(n))),b&&(n[f]=b,i[f]=b)}}const nb={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},PA=(r,t,e)=>t?r.enable(e):r.disable(e),MT=(r,t,e)=>r.hint(e,t),Pa=(r,t,e)=>r.pixelStorei(e,t),Ez=(r,t)=>{const e=fn(r)?36009:36160;return r.bindFramebuffer(e,t)},Sz=(r,t)=>r.bindFramebuffer(36008,t);function rg(r){return Array.isArray(r)||ArrayBuffer.isView(r)}const Tz={3042:PA,32773:(r,t)=>r.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,t)=>r.clearColor(...t),3107:(r,t)=>r.colorMask(...t),2884:PA,2885:(r,t)=>r.cullFace(t),2929:PA,2931:(r,t)=>r.clearDepth(t),2932:(r,t)=>r.depthFunc(t),2928:(r,t)=>r.depthRange(...t),2930:(r,t)=>r.depthMask(t),3024:PA,35723:MT,36006:Ez,2886:(r,t)=>r.frontFace(t),33170:MT,2849:(r,t)=>r.lineWidth(t),32823:PA,32824:"polygonOffset",10752:"polygonOffset",35977:PA,32938:"sampleCoverage",32939:"sampleCoverage",3089:PA,3088:(r,t)=>r.scissor(...t),2960:PA,2961:(r,t)=>r.clearStencil(t),2968:(r,t)=>r.stencilMaskSeparate(1028,t),36005:(r,t)=>r.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,t)=>r.viewport(...t),3333:Pa,3317:Pa,37440:Pa,37441:Pa,37443:Pa,3330:Pa,3332:Pa,3331:Pa,36010:Sz,3314:Pa,32878:Pa,3316:Pa,3315:Pa,32877:Pa,framebuffer:(r,t)=>{const e=t&&"handle"in t?t.handle:t;return r.bindFramebuffer(36160,e)},blend:(r,t)=>t?r.enable(3042):r.disable(3042),blendColor:(r,t)=>r.blendColor(...t),blendEquation:(r,t)=>{t=rg(t)?t:[t,t],r.blendEquationSeparate(...t)},blendFunc:(r,t)=>{t=rg(t)&&t.length===2?[...t,...t]:t,r.blendFuncSeparate(...t)},clearColor:(r,t)=>r.clearColor(...t),clearDepth:(r,t)=>r.clearDepth(t),clearStencil:(r,t)=>r.clearStencil(t),colorMask:(r,t)=>r.colorMask(...t),cull:(r,t)=>t?r.enable(2884):r.disable(2884),cullFace:(r,t)=>r.cullFace(t),depthTest:(r,t)=>t?r.enable(2929):r.disable(2929),depthFunc:(r,t)=>r.depthFunc(t),depthMask:(r,t)=>r.depthMask(t),depthRange:(r,t)=>r.depthRange(...t),dither:(r,t)=>t?r.enable(3024):r.disable(3024),derivativeHint:(r,t)=>{r.hint(35723,t)},frontFace:(r,t)=>r.frontFace(t),mipmapHint:(r,t)=>r.hint(33170,t),lineWidth:(r,t)=>r.lineWidth(t),polygonOffsetFill:(r,t)=>t?r.enable(32823):r.disable(32823),polygonOffset:(r,t)=>r.polygonOffset(...t),sampleCoverage:(r,t)=>r.sampleCoverage(...t),scissorTest:(r,t)=>t?r.enable(3089):r.disable(3089),scissor:(r,t)=>r.scissor(...t),stencilTest:(r,t)=>t?r.enable(2960):r.disable(2960),stencilMask:(r,t)=>{t=rg(t)?t:[t,t];const[e,n]=t;r.stencilMaskSeparate(1028,e),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,t)=>{t=rg(t)&&t.length===3?[...t,...t]:t;const[e,n,i,s,a,o]=t;r.stencilFuncSeparate(1028,e,n,i),r.stencilFuncSeparate(1029,s,a,o)},stencilOp:(r,t)=>{t=rg(t)&&t.length===3?[...t,...t]:t;const[e,n,i,s,a,o]=t;r.stencilOpSeparate(1028,e,n,i),r.stencilOpSeparate(1029,s,a,o)},viewport:(r,t)=>r.viewport(...t)};function Oi(r,t,e){return t[r]!==void 0?t[r]:e[r]}const Iz={blendEquation:(r,t,e)=>r.blendEquationSeparate(Oi(32777,t,e),Oi(34877,t,e)),blendFunc:(r,t,e)=>r.blendFuncSeparate(Oi(32969,t,e),Oi(32968,t,e),Oi(32971,t,e),Oi(32970,t,e)),polygonOffset:(r,t,e)=>r.polygonOffset(Oi(32824,t,e),Oi(10752,t,e)),sampleCoverage:(r,t,e)=>r.sampleCoverage(Oi(32938,t,e),Oi(32939,t,e)),stencilFuncFront:(r,t,e)=>r.stencilFuncSeparate(1028,Oi(2962,t,e),Oi(2967,t,e),Oi(2963,t,e)),stencilFuncBack:(r,t,e)=>r.stencilFuncSeparate(1029,Oi(34816,t,e),Oi(36003,t,e),Oi(36004,t,e)),stencilOpFront:(r,t,e)=>r.stencilOpSeparate(1028,Oi(2964,t,e),Oi(2965,t,e),Oi(2966,t,e)),stencilOpBack:(r,t,e)=>r.stencilOpSeparate(1029,Oi(34817,t,e),Oi(34818,t,e),Oi(34819,t,e))},UT={enable:(r,t)=>r({[t]:!0}),disable:(r,t)=>r({[t]:!1}),pixelStorei:(r,t,e)=>r({[t]:e}),hint:(r,t,e)=>r({[t]:e}),bindFramebuffer:(r,t,e)=>{switch(t){case 36160:return r({36006:e,36010:e});case 36009:return r({36006:e});case 36008:return r({36010:e});default:return null}},blendColor:(r,t,e,n,i)=>r({32773:new Float32Array([t,e,n,i])}),blendEquation:(r,t)=>r({32777:t,34877:t}),blendEquationSeparate:(r,t,e)=>r({32777:t,34877:e}),blendFunc:(r,t,e)=>r({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(r,t,e,n,i)=>r({32969:t,32968:e,32971:n,32970:i}),clearColor:(r,t,e,n,i)=>r({3106:new Float32Array([t,e,n,i])}),clearDepth:(r,t)=>r({2931:t}),clearStencil:(r,t)=>r({2961:t}),colorMask:(r,t,e,n,i)=>r({3107:[t,e,n,i]}),cullFace:(r,t)=>r({2885:t}),depthFunc:(r,t)=>r({2932:t}),depthRange:(r,t,e)=>r({2928:new Float32Array([t,e])}),depthMask:(r,t)=>r({2930:t}),frontFace:(r,t)=>r({2886:t}),lineWidth:(r,t)=>r({2849:t}),polygonOffset:(r,t,e)=>r({32824:t,10752:e}),sampleCoverage:(r,t,e)=>r({32938:t,32939:e}),scissor:(r,t,e,n,i)=>r({3088:new Int32Array([t,e,n,i])}),stencilMask:(r,t)=>r({2968:t,36005:t}),stencilMaskSeparate:(r,t,e)=>r({[t===1028?2968:36005]:e}),stencilFunc:(r,t,e,n)=>r({2962:t,2967:e,2963:n,34816:t,36003:e,36004:n}),stencilFuncSeparate:(r,t,e,n,i)=>r({[t===1028?2962:34816]:e,[t===1028?2967:36003]:n,[t===1028?2963:36004]:i}),stencilOp:(r,t,e,n)=>r({2964:t,2965:e,2966:n,34817:t,34818:e,34819:n}),stencilOpSeparate:(r,t,e,n,i)=>r({[t===1028?2964:34817]:e,[t===1028?2965:34818]:n,[t===1028?2966:34819]:i}),viewport:(r,t,e,n,i)=>r({2978:[t,e,n,i]})},Vc=(r,t)=>r.isEnabled(t),RT={3042:Vc,2884:Vc,2929:Vc,3024:Vc,32823:Vc,32926:Vc,32928:Vc,3089:Vc,2960:Vc,35977:Vc};function OT(r){for(const t in r)return!1;return!0}function Fz(r,t){if(r===t)return!0;const e=Array.isArray(r)||ArrayBuffer.isView(r),n=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&n&&r.length===t.length){for(let i=0;i<r.length;++i)if(r[i]!==t[i])return!1;return!0}return!1}function DT(r,t){const e=r[t].bind(r);r[t]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in r.state.cache?r.state.enable?r.state.cache[i]:e(...arguments):e(...arguments)},Object.defineProperty(r[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function Lz(r,t,e){const n=r[t].bind(r);r[t]=function(){for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];const{valueChanged:h,oldValue:f}=e(r.state._updateCache,...a);return h&&n(...a),f},Object.defineProperty(r[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function Pz(r){const t=r.useProgram.bind(r);r.useProgram=function(n){r.state.program!==n&&(t(n),r.state.program=n)}}class Mz{constructor(t){let{copyState:e=!1,log:n=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?Rz(t):Object.assign({},nb),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Oo(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];Du(this.gl,t),this.stateStack.pop()}_updateCache(t){let e=!1,n;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in t){Oo(s!==void 0);const a=t[s],o=this.cache[s];Fz(a,o)||(e=!0,n=o,i&&!(s in i)&&(i[s]=o),this.cache[s]=a)}return{valueChanged:e,oldValue:n}}}function NT(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:e=!0,copyState:n}=t;if(Oo(n!==void 0),!r.state){const{polyfillContext:i}=globalThis;i&&i(r),r.state=new Mz(r,{copyState:n}),Pz(r);for(const s in UT){const a=UT[s];Lz(r,s,a)}DT(r,"getParameter"),DT(r,"isEnabled")}return r.state.enable=e,r}function Uz(r){r.state||NT(r,{copyState:!1}),r.state.push()}function kT(r){Oo(r.state),r.state.pop()}function Du(r,t){if(Oo(B0(r),"setParameters requires a WebGL context"),OT(t))return;const e={};for(const i in t){const s=Number(i),a=Tz[i];a&&(typeof a=="string"?e[a]=!0:a(r,t[i],s))}const n=r.state&&r.state.cache;if(n)for(const i in e){const s=Iz[i];s(r,t,n)}}function Rz(r,t){if(t=t||nb,typeof t=="number"){const i=t,s=RT[i];return s?s(r,i):r.getParameter(i)}const e=Array.isArray(t)?t:Object.keys(t),n={};for(const i of e){const s=RT[i];n[i]=s?s(r,Number(i)):r.getParameter(Number(i))}return n}function Oz(r){Du(r,nb)}function tc(r,t,e){if(OT(t))return e(r);const{nocatch:n=!0}=t;Uz(r),Du(r,t);let i;if(n)i=e(r),kT(r);else try{i=e(r)}finally{kT(r)}return i}function Yd(r){const{luma:t}=r;if(r.canvas&&t){const e=t.canvasSizeInfo,n="clientWidth"in e?e.clientWidth:r.canvas.clientWidth;return n?r.drawingBufferWidth/n:1}return 1}function ib(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const n=Yd(r),i=r.drawingBufferWidth,s=r.drawingBufferHeight;return Nz(t,n,i,s,e)}function Dz(r){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(r)?r<=0?1:r:r?t:1}function Nz(r,t,e,n,i){const s=QT(r[0],t,e);let a=HT(r[1],t,n,i),o=QT(r[0]+1,t,e);const h=o===e-1?o:o-1;o=HT(r[1]+1,t,n,i);let f;return i?(o=o===0?o:o+1,f=a,a=o):f=o===n-1?o:o-1,{x:s,y:a,width:Math.max(h-s+1,1),height:Math.max(f-a+1,1)}}function QT(r,t,e){return Math.min(Math.round(r*t),e-1)}function HT(r,t,e,n){return n?Math.max(0,e-1-Math.round(r*t)):Math.min(Math.round(r*t),e-1)}const sb=Ou(),kz=sb&&typeof document<"u",zT={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function VT(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Oo(sb,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),r=Object.assign({},zT,r);const{width:t,height:e}=r;function n(o){if(r.throwOnError)throw new Error(o);return console.error(o),null}r.onError=n;let i;const{canvas:s}=r,a=Vz({canvas:s,width:t,height:e,onError:n});return i=zz(a,r),i?(i=ob(i,r),Gz(i),i):null}function ob(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!r||r._instrumented)return r;r._version=r._version||jz(r),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{},t=Object.assign({},zT,t);const{manageState:e,debug:n}=t;return e&&NT(r,{copyState:!1,log:function(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return wr.log(1,...s)()}}),sb&&n&&(globalThis.makeDebugContext?(r=globalThis.makeDebugContext(r,t),wr.level=Math.max(wr.level,1)):wr.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),r._instrumented=!0,r}function Qz(r){const t=r.getParameter(7936),e=r.getParameter(7937),n=r.getExtension("WEBGL_debug_renderer_info"),i=n&&r.getParameter(n.UNMASKED_VENDOR_WEBGL||7936),s=n&&r.getParameter(n.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||t,renderer:s||e,vendorMasked:t,rendererMasked:e,version:r.getParameter(7938),shadingLanguageVersion:r.getParameter(35724)}}function Hz(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r.canvas){const n=Dz(t.useDevicePixels);qz(r,n,t);return}const e=r.getExtension("STACKGL_resize_drawingbuffer");e&&"width"in t&&"height"in t&&e.resize(t.width,t.height)}function zz(r,t){const{onError:e}=t;let n=null;const i=h=>n=h.statusMessage||n;r.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:s=!0,webgl2:a=!0}=t;let o=null;return a&&(o=o||r.getContext("webgl2",t),o=o||r.getContext("experimental-webgl2",t)),s&&(o=o||r.getContext("webgl",t),o=o||r.getContext("experimental-webgl",t)),r.removeEventListener("webglcontextcreationerror",i,!1),o?(t.onContextLost&&r.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&r.addEventListener("webglcontextrestored",t.onContextRestored,!1),o):e("Failed to create ".concat(a&&!s?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function Vz(r){let{canvas:t,width:e=800,height:n=600,onError:i}=r,s;return typeof t=="string"?(kz&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(t,"' before page was loaded")),s=document.getElementById(t)):t?s=t:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(e)?"".concat(e,"px"):"100%",s.style.height=Number.isFinite(n)?"".concat(n,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function Gz(r){const t=fn(r)?"WebGL2":"WebGL1",e=Qz(r),n=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",i=r.debug?" debug":"";wr.info(1,"".concat(t).concat(i," context ").concat(n))()}function jz(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?2:1}function qz(r,t,e){let n="width"in e?e.width:r.canvas.clientWidth,i="height"in e?e.height:r.canvas.clientHeight;(!n||!i)&&(wr.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=r.canvas.width||1,i=r.canvas.height||1),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{};const s=r.luma.canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==i||s.devicePixelRatio!==t){let a=t;const o=Math.floor(n*a),h=Math.floor(i*a);r.canvas.width=o,r.canvas.height=h,(r.drawingBufferWidth!==o||r.drawingBufferHeight!==h)&&(wr.warn("Device pixel ratio clamped")(),a=Math.min(r.drawingBufferWidth/n,r.drawingBufferHeight/i),r.canvas.width=Math.floor(n*a),r.canvas.height=Math.floor(i*a)),Object.assign(r.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:t})}}const ng="8.5.21",Kz="set luma.log.level=1 (or higher) to trace rendering";class Wz{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new qp({id:t})),this.stats.get(t)}}const Nh=new Wz;if(globalThis.luma&&globalThis.luma.VERSION!==ng)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(ng));globalThis.luma||(Ou()&&wr.log(1,"luma.gl ".concat(ng," - ").concat(Kz))(),globalThis.luma=globalThis.luma||{VERSION:ng,version:ng,log:wr,stats:Nh,globals:{modules:{},nodeIO:{}}});function $z(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function Xz(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}function sr(r,t){if(!r)throw new Error(t||"luma.gl: assertion failed.")}function ab(r,t){if(typeof t!="string")return t;const e=Number(t);if(!isNaN(e))return e;t=t.replace(/^.*\./,"");const n=r[t];return sr(n!==void 0,"Accessing undefined constant GL.".concat(t)),n}function MA(r,t){t=Number(t);for(const e in r)if(r[e]===t)return"GL.".concat(e);return String(t)}const lb={};function Nu(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";lb[r]=lb[r]||1;const t=lb[r]++;return"".concat(r,"-").concat(t)}function GT(r){return sr(typeof r=="number","Input must be a number"),r&&(r&r-1)===0}function Zd(r){let t=!0;for(const e in r){t=!1;break}return t}function jT(r,t,e,n){const i="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(r);n.forEach(a=>{s.methodName||(s[a]=()=>{throw wr.removed("Calling removed method ".concat(t,".").concat(a,": "),i)(),new Error(a)})})}const tf="Resource subclass must define virtual methods";let ku=class{get[Symbol.toStringTag](){return"Resource"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};C0(t);const{id:n,userData:i={}}=e;this.gl=t,this.gl2=t,this.id=n||Nu(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=e.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach(n=>n.delete()),this}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof t!="function")return this._bindHandle(t),this;let e;return this._bound?e=t():(this._bindHandle(this.handle),this._bound=!0,e=t(),this._bound=!1,this._bindHandle(null)),e}unbind(){this.bind(null)}getParameter(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=ab(this.gl,t),sr(t);const i=(this.constructor.PARAMETERS||{})[t];if(i){const s=fn(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const o=i.webgl1,h="webgl2"in i?i.webgl2:i.webgl1;return s?h:o}}return this._getParameter(t,e)}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:e,keys:n}=t,i=this.constructor.PARAMETERS||{},s=fn(this.gl),a={},o=e||Object.keys(i);for(const h of o){const f=i[h];if(f&&(!("webgl2"in f)||s)&&(!("extension"in f)||this.gl.getExtension(f.extension))){const b=n?MA(this.gl,h):h;a[b]=this.getParameter(h,t),n&&f.type==="GLenum"&&(a[b]=MA(this.gl,a[b]))}}return a}setParameter(t,e){t=ab(this.gl,t),sr(t);const i=(this.constructor.PARAMETERS||{})[t];if(i){const s=fn(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(e=ab(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,n){return jT(this,t,e,n)}initialize(t){}_createHandle(){throw new Error(tf)}_deleteHandle(){throw new Error(tf)}_bindHandle(t){throw new Error(tf)}_getOptsFromHandle(){throw new Error(tf)}_getParameter(t,e){throw new Error(tf)}_setParameter(t,e){throw new Error(tf)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this[Symbol.toStringTag],e=Nh.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag];Nh.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(t,e),this._trackAllocatedMemoryForContext(t,e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=t}_trackAllocatedMemoryForContext(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=Nh.get("Memory Usage".concat(n));i.get("GPU Memory").addCount(t),i.get("".concat(e," Memory")).addCount(t)}_trackDeallocatedMemory(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(t),this._trackDeallocatedMemoryForContext(t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=Nh.get("Memory Usage".concat(e));n.get("GPU Memory").subtractCount(this.byteLength),n.get("".concat(t," Memory")).subtractCount(this.byteLength)}};const Jz="Failed to deduce GL constant from typed array";function cb(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Jz)}}function ig(r){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Yz(r){let{data:t,width:e,height:n,bytesPerPixel:i=4,temp:s}=r;const a=e*i;s=s||new Uint8Array(a);for(let o=0;o<n/2;++o){const h=o*a,f=(n-o-1)*a;s.set(t.subarray(h,h+a)),t.copyWithin(h,f,f+a),t.set(s,f)}}function Zz(r){let{data:t,width:e,height:n}=r;const i=Math.round(e/2),s=Math.round(n/2),a=new Uint8Array(i*s*4);for(let o=0;o<s;o++)for(let h=0;h<i;h++)for(let f=0;f<4;f++)a[(o*i+h)*4+f]=t[(o*2*e+h*2)*4+f];return{data:a,width:i,height:s}}function ub(r,t,e){const{removedProps:n={},deprecatedProps:i={},replacedProps:s={}}=e;for(const o in n)if(o in t){const f=n[o]?"".concat(r,".").concat(n[o]):"N/A";wr.removed("".concat(r,".").concat(o),f)()}for(const o in i)if(o in t){const h=i[o];wr.deprecated("".concat(r,".").concat(o),"".concat(r,".").concat(h))()}let a=null;for(const o in s)if(o in t){const h=s[o];wr.deprecated("".concat(r,".").concat(o),"".concat(r,".").concat(h))(),a=a||Object.assign({},t),a[h]=t[o],delete a[o]}return a||t}const t7={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},e7={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class aa{static getBytesPerElement(t){return ig(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return sr(t.size),ig(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new aa(t7,...e)}constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return aa.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return aa.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=ub("Accessor",t,e7),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const qT=10,KT={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},r7={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:KT},n7={removedProps:KT};let si=class extends ku{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/aa.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/aa.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=ub("Buffer",t,r7),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return t=ub("Buffer",t,n7),"accessor"in t&&this.setAccessor(t.accessor),this}setAccessor(t){return t=Object.assign({},t),delete t.buffer,this.accessor=new aa(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:n=0,srcOffset:i=0}=t,s=t.byteLength||t.length;sr(e);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),i!==0||s!==void 0?(Do(this.gl),this.gl.bufferSubData(this.target,n,e,i,s)):this.gl.bufferSubData(a,n,e),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(e),this}copyData(t){let{sourceBuffer:e,readOffset:n=0,writeOffset:i=0,size:s}=t;const{gl:a}=this;return Do(a),a.bindBuffer(36662,e.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,n,i,s),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:e=0,dstOffset:n=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Do(this.gl);const s=ig(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(e),o=n;let h,f;t?(f=t.length,h=f-o):(h=Math.min(a,i||a),f=o+h);const m=Math.min(a,h);return i=i||m,sr(i<=m),t=t||new s(f),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,n,i),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:n=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?i!==void 0?this.gl.bindBufferRange(t,e,this.handle,n,i):(sr(n===0),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(qT,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.byteLength+e;sr(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.usage),this.gl.bufferSubData(i,e,t),this.gl.bindBuffer(i,null),this.debugData=t.slice(0,qT),this.bytesUsed=n,this._trackAllocatedMemory(n);const s=cb(t);return sr(s),this.setAccessor(new aa(this.accessor,{type:s})),this}_setByteLength(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;sr(t>=0),this._trackDeallocatedMemory();let n=t;t===0&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=ig(this.accessor.type||5126,{clamped:!1}),n=t/e.BYTES_PER_ELEMENT;return this.getElementCount()-n}_inferType(t){this.accessor.type||this.setAccessor(new aa(this.accessor,{type:cb(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return wr.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return wr.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return wr.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return wr.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new aa(this.accessor,t),this}};const Ab={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},WT={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},$T={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function i7(r,t){const e=Ab[t];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;const n=fn(r)&&e.gl2||e.gl1;return typeof n=="string"?r.getExtension(n):n}function s7(r,t){const e=Ab[t];switch(e&&e.types[0]){case 5126:return r.getExtension("OES_texture_float_linear");case 5131:return r.getExtension("OES_texture_half_float_linear");default:return!0}}const o7=[9729,9728],XT=globalThis.WebGLBuffer||function(){};class ef extends ku{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:n,linearFiltering:i}=e;let s=!0;return n&&(s=s&&i7(t,n),s=s&&(!i||s7(t,n))),s}constructor(t,e){const{id:n=Nu("texture"),handle:i,target:s}=e;super(t,{id:n,handle:i}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then(G=>this.initialize(Object.assign({},t,{pixels:G,data:G}))),this;const n=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement;if(n&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:i=null,format:s=6408,border:a=0,recreate:o=!1,parameters:h={},pixelStore:f={},textureUnit:m=void 0}=t;e||(e=i);let{width:b,height:x,dataFormat:B,type:P,compressed:R=!1,mipmaps:Q=!0}=t;const{depth:z=0}=t;return{width:b,height:x,compressed:R,dataFormat:B,type:P}=this._deduceParameters({format:s,type:P,dataFormat:B,compressed:R,data:e,width:b,height:x}),this.width=b,this.height=x,this.depth=z,this.format=s,this.type=P,this.dataFormat=B,this.border=a,this.textureUnit=m,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),Q&&this._isNPOT()&&(wr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),Q=!1,this._updateForNPOT(h)),this.mipmaps=Q,this.setImageData({data:e,width:b,height:x,depth:z,format:s,type:P,dataFormat:B,border:a,mipmaps:Q,parameters:f,compressed:R}),Q&&this.generateMipmap(),this.setParameters(h),o&&(this.data=e),n&&(this._video={video:e,parameters:h,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:n,mipmaps:i=!1}=t;return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(wr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),tc(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:n=null,level:i=0,format:s=this.format,border:a=this.border,offset:o=0,parameters:h={}}=t;let{data:f=null,type:m=this.type,width:b=this.width,height:x=this.height,dataFormat:B=this.dataFormat,compressed:P=!1}=t;f||(f=n),{type:m,dataFormat:B,compressed:P,width:b,height:x}=this._deduceParameters({format:s,type:m,dataFormat:B,compressed:P,data:f,width:b,height:x});const{gl:R}=this;R.bindTexture(this.target,this.handle);let Q=null;({data:f,dataType:Q}=this._getDataType({data:f,compressed:P}));let z,G=0;if(tc(this.gl,h,()=>{switch(Q){case"null":R.texImage2D(e,i,s,b,x,a,B,m,f);break;case"typed-array":R.texImage2D(e,i,s,b,x,a,B,m,f,o);break;case"buffer":z=Do(R),z.bindBuffer(35052,f.handle||f),z.texImage2D(e,i,s,b,x,a,B,m,o),z.bindBuffer(35052,null);break;case"browser-object":fn(R)?R.texImage2D(e,i,s,b,x,a,B,m,f):R.texImage2D(e,i,s,B,m,f);break;case"compressed":for(const[X,et]of f.entries())R.compressedTexImage2D(e,X,et.format,et.width,et.height,a,et.data),G+=et.levelSize;break;default:sr(!1,"Unknown image data type")}}),Q==="compressed")this._trackAllocatedMemory(G,"Texture");else if(f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const X=WT[this.dataFormat]||4,et=$T[this.type]||1;this._trackAllocatedMemory(this.width*this.height*X*et,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:n=null,data:i=null,x:s=0,y:a=0,width:o=this.width,height:h=this.height,level:f=0,format:m=this.format,type:b=this.type,dataFormat:x=this.dataFormat,compressed:B=!1,offset:P=0,border:R=this.border,parameters:Q={}}=t;if({type:b,dataFormat:x,compressed:B,width:o,height:h}=this._deduceParameters({format:m,type:b,dataFormat:x,compressed:B,data:i,width:o,height:h}),sr(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const z=i;i=z.data,o=z.shape[0],h=z.shape[1]}i instanceof si&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),tc(this.gl,Q,()=>{if(B)this.gl.compressedTexSubImage2D(e,f,s,a,o,h,m,i);else if(i===null)this.gl.texSubImage2D(e,f,s,a,o,h,x,b,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,f,s,a,o,h,x,b,i,P);else if(i instanceof XT){const z=Do(this.gl);z.bindBuffer(35052,i),z.texSubImage2D(e,f,s,a,o,h,x,b,P),z.bindBuffer(35052,null)}else fn(this.gl)?Do(this.gl).texSubImage2D(e,f,s,a,o,h,x,b,i):this.gl.texSubImage2D(e,f,s,a,x,b,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return wr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:n=!1}=t;return n?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof si?{data:e.handle,dataType:"buffer"}:e instanceof XT?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:n}=t;let{width:i,height:s,dataFormat:a,type:o,compressed:h}=t;const f=Ab[e];return a=a||f&&f.dataFormat,o=o||f&&f.types[0],h=h||f&&f.compressed,{width:i,height:s}=this._deduceImageSize(n,i,s),{dataFormat:a,type:o,compressed:h,width:i,height:s,format:e,data:n}}_deduceImageSize(t,e,n){let i;return typeof ImageData<"u"&&t instanceof ImageData?i={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?i={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?i={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?i={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?i={width:t.videoWidth,height:t.videoHeight}:t?i={width:e,height:n}:i={width:e>=0?e:1,height:n>=0?n:1},sr(i,"Could not deduced texture size"),sr(e===void 0||i.width===e,"Deduced texture width does not match supplied width"),sr(n===void 0||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:sr(!1);break;default:this.gl.texParameteri(this.target,t,e);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return fn(this.gl)||!this.width||!this.height?!1:!GT(this.width)||!GT(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:o7.indexOf(e)===-1&&(e=9729);break;case 10242:case 10243:e!==33071&&(e=33071);break}return e}}let a7="";function l7(r,t){return sr(typeof r=="string"),r=a7+r,new Promise((e,n)=>{try{const i=new Image;i.onload=()=>e(i),i.onerror=()=>n(new Error("Could not load image ".concat(r,"."))),i.crossOrigin=t&&t.crossOrigin||"anonymous",i.src=r}catch(i){n(i)}})}class Ma extends ef{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return ef.isSupported(t,e)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};C0(t),(e instanceof Promise||typeof e=="string")&&(e={data:e}),typeof e.data=="string"&&(e=Object.assign({},e,{data:l7(e.data)})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const hb=[34069,34070,34071,34072,34073,34074];class JT extends ef{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};C0(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:e=!0,parameters:n={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(n)}),this}subImage(t){let{face:e,data:n,x:i=0,y:s=0,mipmapLevel:a=0}=t;return this._subImage({target:e,data:n,x:i,y:s,mipmapLevel:a})}async setCubeMapImageData(t){let{width:e,height:n,pixels:i,data:s,border:a=0,format:o=6408,type:h=5121}=t;const{gl:f}=this,m=i||s,b=await Promise.all(hb.map(x=>{const B=m[x];return Promise.all(Array.isArray(B)?B:[B])}));this.bind(),hb.forEach((x,B)=>{b[B].length>1&&this.opts.mipmaps!==!1&&wr.warn("".concat(this.id," has mipmap and multiple LODs."))(),b[B].forEach((P,R)=>{e&&n?f.texImage2D(x,R,o,e,n,a,o,h,P):f.texImage2D(x,R,o,o,h,P)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:n,height:i,pixels:s,data:a,border:o=0,format:h=6408,type:f=5121}=t,{gl:m}=this,b=s||a;return this.bind(),b instanceof Promise?b.then(x=>this.setImageDataForFace(Object.assign({},t,{face:e,data:x,pixels:x}))):this.width||this.height?m.texImage2D(e,0,h,n,i,o,h,f,b):m.texImage2D(e,0,h,h,f,b),this}}JT.FACES=hb;class c7 extends ef{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return fn(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Do(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:n=6408,width:i,height:s,depth:a=1,border:o=0,format:h,type:f=5121,offset:m=0,data:b,parameters:x={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),tc(this.gl,x,()=>{ArrayBuffer.isView(b)&&this.gl.texImage3D(this.target,e,n,i,s,a,o,h,f,b),b instanceof si&&(this.gl.bindBuffer(35052,b.handle),this.gl.texImage3D(this.target,e,n,i,s,a,o,h,f,m))}),b&&b.byteLength)this._trackAllocatedMemory(b.byteLength,"Texture");else{const B=WT[this.dataFormat]||4,P=$T[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*B*P,"Texture")}return this.loaded=!0,this}}const kh="EXT_color_buffer_float",YT={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:kh,bpp:2},33327:{gl2:kh,bpp:4},34842:{gl2:kh,bpp:8},33326:{gl2:kh,bpp:4},33328:{gl2:kh,bpp:8},34836:{gl2:kh,bpp:16},35898:{gl2:kh,bpp:4}};function u7(r,t,e){const n=e[t];if(!n)return!1;const i=fn(r)&&n.gl2||n.gl1;return typeof i=="string"?r.getExtension(i):i}class rf extends ku{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!e||u7(t,e,YT)}static getSamplesForFormat(t,e){let{format:n}=e;return t.getInternalformatParameter(36161,n,32937)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:n=1,height:i=1,samples:s=0}=t;return sr(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&fn(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,n,i):this.gl.renderbufferStorage(36161,e,n,i),this.format=e,this.width=n,this.height=i,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*YT[this.format].bpp),this}resize(t){let{width:e,height:n}=t;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const A7=256,h7=1024,d7=16384,ZT=6144,t5=6145,e5=6146,r5=34041,n5="clear: bad arguments";function db(r){let{framebuffer:t=null,color:e=null,depth:n=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};t&&(s.framebuffer=t);let a=0;e&&(a|=d7,e!==!0&&(s.clearColor=e)),n&&(a|=A7,n!==!0&&(s.clearDepth=n)),i&&(a|=h7,n!==!0&&(s.clearStencil=n)),sr(a!==0,n5),tc(r,s,()=>{r.clear(a)})}function f7(r){let{framebuffer:t=null,buffer:e=ZT,drawBuffer:n=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Do(r),tc(r,{framebuffer:t},()=>{switch(e){case ZT:switch(i.constructor){case Int32Array:r.clearBufferiv(e,n,i);break;case Uint32Array:r.clearBufferuiv(e,n,i);break;case Float32Array:default:r.clearBufferfv(e,n,i)}break;case t5:r.clearBufferfv(t5,0,[i]);break;case e5:r.clearBufferiv(e5,0,[i]);break;case r5:const[s,a]=i;r.clearBufferfi(r5,0,s,a);break;default:sr(!1,n5)}})}function p7(r){switch(r){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return sr(!1),0}}function E0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:e=0,sourceY:n=0,sourceFormat:i=6408}=t;let{sourceAttachment:s=36064,target:a=null,sourceWidth:o,sourceHeight:h,sourceType:f}=t;const{framebuffer:m,deleteFramebuffer:b}=g7(r);sr(m);const{gl:x,handle:B,attachments:P}=m;o=o||m.width,h=h||m.height,s===36064&&B===null&&(s=1028),sr(P[s]),f=f||P[s].type,a=m7(a,f,i,o,h),f=f||cb(a);const R=x.bindFramebuffer(36160,B);return x.readPixels(e,n,o,h,i,f,a),x.bindFramebuffer(36160,R||null),b&&m.delete(),a}function i5(r){let{sourceAttachment:t=36064,targetMaxHeight:e=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=E0(r,{sourceAttachment:t}),{width:i,height:s}=r;for(;s>e;)({data:n,width:i,height:s}=Zz({data:n,width:i,height:s}));Yz({data:n,width:i,height:s});const a=document.createElement("canvas");a.width=i,a.height=s;const o=a.getContext("2d"),h=o.createImageData(i,s);return h.data.set(n),o.putImageData(h,0,0),a.toDataURL()}function g7(r){return r instanceof bs?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:E7(r),deleteFramebuffer:!0}}function m7(r,t,e,n,i){if(r)return r;t=t||5121;const s=ig(t,{clamped:!1}),a=p7(e);return new s(n*i*a)}const pi={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function y7(r){const t=new Ma(r,{format:6408,type:5126,dataFormat:6408}),e=new bs(r,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),n=e.getStatus();return t.delete(),e.delete(),n===36053}const s5={[pi.WEBGL2]:[!1,!0],[pi.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[pi.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[pi.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[pi.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[pi.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[pi.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[pi.FLOAT_BLEND]:["EXT_float_blend"],[pi.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[pi.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[pi.TEXTURE_FLOAT]:["OES_texture_float",!0],[pi.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[pi.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[pi.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[pi.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[pi.COLOR_ATTACHMENT_RGBA32F]:[y7,"EXT_color_buffer_float"],[pi.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[pi.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[pi.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[pi.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[pi.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[pi.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},_7=2;function fb(r,t){return o5(r,t)}function o5(r,t){return t=Array.isArray(t)?t:[t],t.every(e=>a5(r,e))}function v7(r){r.luma=r.luma||{},r.luma.caps=r.luma.caps||{};for(const t in s5)r.luma.caps[t]===void 0&&(r.luma.caps[t]=a5(r,t));return r.luma.caps}function a5(r,t){return r.luma=r.luma||{},r.luma.caps=r.luma.caps||{},r.luma.caps[t]===void 0&&(r.luma.caps[t]=b7(r,t)),r.luma.caps[t]||wr.log(_7,"Feature: ".concat(t," not supported"))(),r.luma.caps[t]}function b7(r,t){const e=s5[t];sr(e,t);let n;const i=fn(r)&&e[1]||e[0];if(typeof i=="function")n=i(r);else if(Array.isArray(i)){n=!0;for(const s of i)n=n&&!!r.getExtension(s)}else typeof i=="string"?n=!!r.getExtension(i):typeof i=="boolean"?n=i:sr(!1);return n}const l5="Multiple render targets not supported";class bs extends ku{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:n,colorBufferHalfFloat:i}=e;let s=!0;return n&&(s=!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),i&&(s=s&&!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new bs(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=Do(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=Do(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:n=1,attachments:i=null,color:s=!0,depth:a=!0,stencil:o=!1,check:h=!0,readBuffer:f=void 0,drawBuffers:m=void 0}=t;if(sr(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,i)for(const b in i){const x=i[b];(Array.isArray(x)?x[0]:x).resize({width:e,height:n})}else i=this._createDefaultAttachments(s,a,o,e,n);this.update({clearAttachments:!0,attachments:i,readBuffer:f,drawBuffers:m}),i&&h&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:n,drawBuffers:i,clearAttachments:s=!1,resizeAttachments:a=!0}=t;this.attach(e,{clearAttachments:s,resizeAttachments:a});const{gl:o}=this,h=o.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),i&&this._setDrawBuffers(i),o.bindFramebuffer(36160,h||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:e,height:n}=t;if(this.handle===null)return sr(e===void 0&&n===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),n===void 0&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&wr.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))();for(const i in this.attachments)this.attachments[i].resize({width:e,height:n});return this.width=e,this.height=n,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:n=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};e&&Object.keys(this.attachments).forEach(a=>{i[a]=null}),Object.assign(i,t);const s=this.gl.bindFramebuffer(36160,this.handle);for(const a in i){sr(a!==void 0,"Misspelled framebuffer binding point?");const o=Number(a),h=i[o];let f=h;if(!f)this._unattach(o);else if(f instanceof rf)this._attachRenderbuffer({attachment:o,renderbuffer:f});else if(Array.isArray(h)){const[m,b=0,x=0]=h;f=m,this._attachTexture({attachment:o,texture:m,layer:b,level:x})}else this._attachTexture({attachment:o,texture:f,layer:0,level:0});n&&f&&f.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(x7(t));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),n}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e,depth:n,stencil:i,drawBuffers:s=[]}=t,a=this.gl.bindFramebuffer(36160,this.handle);return(e||n||i)&&db(this.gl,{color:e,depth:n,stencil:i}),s.forEach((o,h)=>{f7(this.gl,{drawBuffer:h,value:o})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return wr.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return wr.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return wr.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return wr.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return wr.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return wr.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:n=0,y:i=0,width:s,height:a}=t;const o=Do(this.gl),h=o.bindFramebuffer(36008,this.handle);return n===0&&i===0&&s===void 0&&a===void 0?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,n,i,s,a),o.bindFramebuffer(36008,h),this}getAttachmentParameter(t,e,n){let i=this._getAttachmentParameterFallback(e);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=MA(this.gl,i)),i}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const s of n){const a=e?MA(this.gl,s):s;i[a]=this.getAttachmentParameter(t,s,e)}return i}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=Object.keys(this.attachments),n={};for(const i of e){const s=Number(i),a=t?MA(this.gl,s):s;n[a]=this.getAttachmentParameters(s,t)}return n}show(){return typeof window<"u"&&window.open(i5(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>wr.level||typeof window>"u")return this;e=e||"Framebuffer ".concat(this.id);const n=i5(this,{targetMaxHeight:100});return wr.image({logLevel:t,message:e,image:n},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,n,i,s){let a=null;return t&&(a=a||{},a[36064]=new Ma(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),e&&n?(a=a||{},a[33306]=new rf(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(a[33306])):e?(a=a||{},a[36096]=new rf(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:s}),this.ownResources.push(a[36096])):n&&sr(!1),a}_unattach(t){const e=this.attachments[t];e&&(e instanceof rf?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:n}=t;const{gl:i}=this;i.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture(t){let{attachment:e=36064,texture:n,layer:i,level:s}=t;const{gl:a}=this;switch(a.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:Do(a).framebufferTextureLayer(36160,e,n.target,s,i);break;case 34067:const h=w7(i);a.framebufferTexture2D(36160,e,h,n.handle,s);break;case 3553:a.framebufferTexture2D(36160,e,3553,n.handle,s);break;default:sr(!1,"Illegal texture type")}a.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(t){const e=YH(this.gl);e?e.readBuffer(t):sr(t===36064||t===1029,l5),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,n=Do(e);if(n)n.drawBuffers(t);else{const i=e.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(t):sr(t.length===1&&(t[0]===36064||t[0]===1029),l5)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=v7(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return!e.WEBGL2&&!e.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function w7(r){return r<34069?r+34069:r}function x7(r){return(bs.STATUS||{})[r]||"Framebuffer error ".concat(r)}const B7=[36049,36048,33296,33298,33299,33300,33301,33302,33303];bs.ATTACHMENT_PARAMETERS=B7;function C7(r,t){sr(r instanceof Ma||r instanceof JT||r instanceof c7);const e=r.constructor,{gl:n,width:i,height:s,format:a,type:o,dataFormat:h,border:f,mipmaps:m}=r,b=Object.assign({width:i,height:s,format:a,type:o,dataFormat:h,border:f,mipmaps:m},t);return new e(n,b)}function E7(r,t){const{gl:e,width:n,height:i,id:s}=r;return new bs(e,Object.assign({},t,{id:"framebuffer-for-".concat(s),width:n,height:i,attachments:{36064:r}}))}function S0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,n=r.match(e);return n?n[1]:t}const S7=35632,T7=35633;function I7(r){switch(r){case S7:return"fragment";case T7:return"vertex";default:return"unknown type"}}function F7(r,t,e,n){const i=r.split(/\r?\n/),s={},a={},o=n||S0(t)||"(unnamed)",h="".concat(I7(e)," shader ").concat(o);for(let m=0;m<i.length;m++){const b=i[m];if(b.length<=1)continue;const x=b.split(":"),B=x[0],P=parseInt(x[2],10);if(isNaN(P))throw new Error("GLSL compilation error in ".concat(h,": ").concat(r));B!=="WARNING"?s[P]=b:a[P]=b}const f=L7(t);return{shaderName:h,errors:c5(s,f),warnings:c5(a,f)}}function c5(r,t){let e="";for(let n=0;n<t.length;n++){const i=t[n];if(!(!r[n+3]&&!r[n+2]&&!r[n+1])&&(e+="".concat(i,`
`),r[n+1])){const s=r[n+1],a=s.split(":",3),o=a[0],h=parseInt(a[1],10)||0,f=s.substring(a.join(":").length+1).trim();e+=u5("^^^ ".concat(o,": ").concat(f,`

`),h)}}return e}function L7(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const n=r.split(/\r?\n/),i=String(n.length+t-1).length;return n.map((s,a)=>{const o=String(a+t),h=o.length;return u5(o,i-h)+e+s})}function u5(r,t){let e="";for(let n=0;n<t;++n)e+=" ";return"".concat(e).concat(r)}function A5(r){let t=100;const e=r.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){const n=parseInt(e[1],10);Number.isFinite(n)&&(t=n)}return t}const P7="Shader: GLSL source code must be a JavaScript string";class sg extends ku{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return sr(!1),"unknown"}}constructor(t,e){C0(t),sr(typeof e.source=="string",P7);const n=S0(e.source,null)||e.id||Nu("unnamed ".concat(sg.getTypeName(e.shaderType)));super(t,{id:n}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const n=S0(e,null);n&&(this.id=Nu(n)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(sg.getTypeName(this.shaderType),":").concat(this.id)}getName(){return S0(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const n=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:s,warnings:a}=F7(n,this.source,this.shaderType,this.id);throw wr.error("GLSL compilation errors in ".concat(i,`
`).concat(s))(),wr.warn("GLSL compilation warnings in ".concat(i,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class pb extends sg{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class gb extends sg{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const M7={5126:vi.bind(null,"uniform1fv",Ua,1,Ao),35664:vi.bind(null,"uniform2fv",Ua,2,Ao),35665:vi.bind(null,"uniform3fv",Ua,3,Ao),35666:vi.bind(null,"uniform4fv",Ua,4,Ao),5124:vi.bind(null,"uniform1iv",UA,1,Ao),35667:vi.bind(null,"uniform2iv",UA,2,Ao),35668:vi.bind(null,"uniform3iv",UA,3,Ao),35669:vi.bind(null,"uniform4iv",UA,4,Ao),35670:vi.bind(null,"uniform1iv",UA,1,Ao),35671:vi.bind(null,"uniform2iv",UA,2,Ao),35672:vi.bind(null,"uniform3iv",UA,3,Ao),35673:vi.bind(null,"uniform4iv",UA,4,Ao),35674:vi.bind(null,"uniformMatrix2fv",Ua,4,Qu),35675:vi.bind(null,"uniformMatrix3fv",Ua,9,Qu),35676:vi.bind(null,"uniformMatrix4fv",Ua,16,Qu),35678:Ks,35680:Ks,5125:vi.bind(null,"uniform1uiv",T0,1,Ao),36294:vi.bind(null,"uniform2uiv",T0,2,Ao),36295:vi.bind(null,"uniform3uiv",T0,3,Ao),36296:vi.bind(null,"uniform4uiv",T0,4,Ao),35685:vi.bind(null,"uniformMatrix2x3fv",Ua,6,Qu),35686:vi.bind(null,"uniformMatrix2x4fv",Ua,8,Qu),35687:vi.bind(null,"uniformMatrix3x2fv",Ua,6,Qu),35688:vi.bind(null,"uniformMatrix3x4fv",Ua,12,Qu),35689:vi.bind(null,"uniformMatrix4x2fv",Ua,8,Qu),35690:vi.bind(null,"uniformMatrix4x3fv",Ua,12,Qu),35678:Ks,35680:Ks,35679:Ks,35682:Ks,36289:Ks,36292:Ks,36293:Ks,36298:Ks,36299:Ks,36300:Ks,36303:Ks,36306:Ks,36307:Ks,36308:Ks,36311:Ks},U7={},R7={},O7={},h5=[0];function mb(r,t,e,n){t===1&&typeof r=="boolean"&&(r=r?1:0),Number.isFinite(r)&&(h5[0]=r,r=h5);const i=r.length;if(i%t&&wr.warn("Uniform size should be multiples of ".concat(t),r)(),r instanceof e)return r;let s=n[i];s||(s=new e(i),n[i]=s);for(let a=0;a<i;a++)s[a]=r[a];return s}function Ua(r,t){return mb(r,t,Float32Array,U7)}function UA(r,t){return mb(r,t,Int32Array,R7)}function T0(r,t){return mb(r,t,Uint32Array,O7)}function d5(r,t,e){const n=M7[e.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(e.type));return n().bind(null,r,t)}function D7(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,e=r.match(t);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(r));return{name:e[1],length:e[2]||1,isArray:!!e[2]}}function N7(r,t,e){for(const n in r){const i=r[n];if((!e||!!e[n])&&!k7(i))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(n),i),new Error("".concat(t," Bad uniform ").concat(n))}return!0}function k7(r){return Array.isArray(r)||ArrayBuffer.isView(r)?H7(r):isFinite(r)||r===!0||r===!1||r instanceof ef||r instanceof rf?!0:r instanceof bs?!!r.texture:!1}function Q7(r,t,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(r[t]){const n=r[t];for(let i=0,s=e.length;i<s;++i)n[i]=e[i]}else r[t]=e.slice();else r[t]=e}function H7(r){if(r.length===0)return!1;const t=Math.min(r.length,16);for(let e=0;e<t;++e)if(!Number.isFinite(r[e]))return!1;return!0}function Ks(){let r=null;return(t,e,n)=>{const i=r!==n;return i&&(t.uniform1i(e,n),r=n),i}}function vi(r,t,e,n){let i=null,s=null;return(a,o,h)=>{const f=t(h,e),m=f.length;let b=!1;if(i===null)i=new Float32Array(m),s=m,b=!0;else{sr(s===m,"Uniform length cannot change.");for(let x=0;x<m;++x)if(f[x]!==i[x]){b=!0;break}}return b&&(n(a,r,o,f),i.set(f)),b}}function Ao(r,t,e,n){r[t](e,n)}function Qu(r,t,e,n){r[t](e,!1,n)}const z7=5120,V7=5121,G7=5122,j7=5123,f5=0,I0=1,q7=2,K7=3,F0=4,W7=5,$7=6,ws=5126,X7=35664,J7=35665,Y7=35666,og=5124,Z7=35667,t9=35668,e9=35669,ag=5125,r9=36294,n9=36295,i9=36296,s9=35670,o9=35671,a9=35672,l9=35673,c9=35674,u9=35675,A9=35676,h9=35685,d9=35686,f9=35687,p9=35688,g9=35689,m9=35690,yb={[ws]:[ws,1,"float"],[X7]:[ws,2,"vec2"],[J7]:[ws,3,"vec3"],[Y7]:[ws,4,"vec4"],[og]:[og,1,"int"],[Z7]:[og,2,"ivec2"],[t9]:[og,3,"ivec3"],[e9]:[og,4,"ivec4"],[ag]:[ag,1,"uint"],[r9]:[ag,2,"uvec2"],[n9]:[ag,3,"uvec3"],[i9]:[ag,4,"uvec4"],[s9]:[ws,1,"bool"],[o9]:[ws,2,"bvec2"],[a9]:[ws,3,"bvec3"],[l9]:[ws,4,"bvec4"],[c9]:[ws,8,"mat2"],[h9]:[ws,8,"mat2x3"],[d9]:[ws,8,"mat2x4"],[u9]:[ws,12,"mat3"],[f9]:[ws,12,"mat3x2"],[p9]:[ws,12,"mat3x4"],[A9]:[ws,16,"mat4"],[g9]:[ws,16,"mat4x2"],[m9]:[ws,16,"mat4x3"]};function y9(r){switch(r){case f5:return f5;case I0:return I0;case K7:return I0;case q7:return I0;case F0:return F0;case W7:return F0;case $7:return F0;default:return sr(!1),0}}function p5(r){const t=yb[r];if(!t)return null;const[e,n]=t;return{type:e,components:n}}function g5(r,t){switch(r){case z7:case V7:case G7:case j7:r=ws;break}for(const e in yb){const[n,i,s]=yb[e];if(n===r&&i===t)return{glType:e,name:s}}return null}class _9{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,n=e.getProgramParameter(t.handle,35721);for(let i=0;i<n;i++){const{name:s,type:a,size:o}=e.getActiveAttrib(t.handle,i),h=e.getAttribLocation(t.handle,s);h>=0&&this._addAttribute(h,s,a,o)}this.attributeInfos.sort((i,s)=>i.location-s.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!fn(e))return;const n=e.getProgramParameter(t.handle,35971);for(let i=0;i<n;i++){const{name:s,type:a,size:o}=e.getTransformFeedbackVarying(t.handle,i);this._addVarying(i,s,a,o)}this.varyingInfos.sort((i,s)=>i.location-s.location)}_addAttribute(t,e,n,i){const{type:s,components:a}=p5(n),o={type:s,size:i*a};this._inferProperties(t,e,o);const h={location:t,name:e,accessor:new aa(o)};this.attributeInfos.push(h),this.attributeInfosByLocation[t]=h,this.attributeInfosByName[h.name]=h}_inferProperties(t,e,n){/instance/i.test(e)&&(n.divisor=1)}_addVarying(t,e,n,i){const{type:s,components:a}=p5(n),o=new aa({type:s,size:i*a}),h={location:t,name:e,accessor:o};this.varyingInfos.push(h),this.varyingInfosByName[h.name]=h}}const m5=4,v9=35981,b9=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class y5 extends ku{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",b9),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:e,vs:n,fs:i,varyings:s,bufferMode:a=v9}=t;return this.hash=e||"",this.vs=typeof n=="string"?new pb(this.gl,{id:"".concat(t.id,"-vs"),source:n}):n,this.fs=typeof i=="string"?new gb(this.gl,{id:"".concat(t.id,"-fs"),source:i}):i,sr(this.vs instanceof pb),sr(this.fs instanceof gb),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Do(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new _9(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:n=4,vertexCount:i,offset:s=0,start:a,end:o,isIndexed:h=!1,indexType:f=5123,instanceCount:m=0,isInstanced:b=m>0,vertexArray:x=null,transformFeedback:B,framebuffer:P,parameters:R={},uniforms:Q,samplers:z}=t;if((Q||z)&&(wr.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(Q||{})),wr.priority>=e){const G=P?P.id:"default",X="mode=".concat(MA(this.gl,n)," verts=").concat(i," ")+"instances=".concat(m," indexType=").concat(MA(this.gl,f)," ")+"isInstanced=".concat(b," isIndexed=").concat(h," ")+"Framebuffer=".concat(G);wr.log(e,X)()}return sr(x),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||b&&m===0?!1:(x.bindForDraw(i,m,()=>{if(P!==void 0&&(R=Object.assign({},R,{framebuffer:P})),B){const G=y9(n);B.begin(G)}this._bindTextures(),tc(this.gl,R,()=>{h&&b?this.gl2.drawElementsInstanced(n,i,f,s,m):h&&fn(this.gl)&&!isNaN(a)&&!isNaN(o)?this.gl2.drawRangeElements(n,a,o,i,f,s):h?this.gl.drawElements(n,i,f,s):b?this.gl2.drawArraysInstanced(n,s,i,m):this.gl.drawArrays(n,s,i)}),B&&B.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};wr.priority>=2&&N7(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const n=t[e],i=this._uniformSetters[e];if(i){let s=n,a=!1;if(s instanceof bs&&(s=s.texture),s instanceof ef)if(a=this.uniforms[e]!==n,a){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const o=s,{textureIndex:h}=i;o.bind(h),s=h,this._textureUniforms[e]=o}else s=i.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(i(s)||a)&&Q7(this.uniforms,e,n)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const n=this._textureUniforms[e];n.update(),t=t&&n.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),n={};for(const i of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new pb({handle:i});break;case 35632:n.fs=new gb({handle:i});break}return n}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const e=this._getName();this.id=Nu(e)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),wr.time(m5,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),wr.timeEnd(m5,"linkProgram for ".concat(this._getName()))(),t.debug||wr.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const n=this.gl.getActiveUniform(this.handle,e),{name:i}=D7(n.name);let s=t.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=d5(t,s,n),n.size>1)for(let a=0;a<n.size;a++)s=t.getUniformLocation(this.handle,"".concat(i,"[").concat(a,"]")),this._uniformSetters["".concat(i,"[").concat(a,"]")]=d5(t,s,n)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}const w9=34918,x9=34919,B9=35007,C9=36795,E9=35976,S9=35887,T9=36202;class L0 extends ku{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const n=fn(t),i=o5(t,pi.TIMER_QUERY);let s=n||i;for(const a of e)switch(a){case"queries":s=s&&n;break;case"timers":s=s&&i;break;default:sr(!1)}return s}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(B9)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?T9:S9)}beginTransformFeedbackQuery(){return this.begin(E9)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,x9);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(C9)}getResult(){return this.gl2.getQueryParameter(this.handle,w9)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((n,i)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return L0.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class _5 extends ku{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return fn(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Do(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Zd(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:i,byteSize:s,byteOffset:a}=this._getBufferParams(e);return n<0?(this.unused[t]=i,wr.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[n]=e,this.bindOnUse||this._bindBuffer(n,i,a,s),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,n,i;return t instanceof si?i=t:(i=t.buffer,n=t.byteSize,e=t.byteOffset),(e!==void 0||n!==void 0)&&(e=e||0,n=n||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:n}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:n,byteOffset:i}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,i,n)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const s=e&&e.handle;return!s||i===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,n,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let P0=null;function I9(r){return(!P0||P0.byteLength<r)&&(P0=new ArrayBuffer(r)),P0}function F9(r,t){const e=I9(r.BYTES_PER_ELEMENT*t);return new r(e,0,t)}function L9(r){let{target:t,source:e,start:n=0,count:i=1}=r;const s=e.length,a=i*s;let o=0;for(let h=n;o<s;o++)t[h++]=e[o];for(;o<a;)o<a-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+a-o),o=a);return t}const P9="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ra extends ku{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?fn(t)||rT()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new Ra(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return Ra.MAX_ATTRIBUTES=Ra.MAX_ATTRIBUTES||t.getParameter(34921),Ra.MAX_ATTRIBUTES}static setConstant(t,e,n){switch(n.constructor){case Float32Array:Ra._setConstantFloatArray(t,e,n);break;case Int32Array:Ra._setConstantIntArray(t,e,n);break;case Uint32Array:Ra._setConstantUintArray(t,e,n);break;default:sr(!1)}}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Ra.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return sr(!t||t.target===34963,P9),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,n){if(e.target===34963)return this.setElementBuffer(e,n);const{size:i,type:s,stride:a,offset:o,normalized:h,integer:f,divisor:m}=n,{gl:b,gl2:x}=this;return t=Number(t),this.bind(()=>{b.bindBuffer(34962,e.handle),f?(sr(fn(b)),x.vertexAttribIPointer(t,i,s,a,o)):b.vertexAttribPointer(t,i,s,h,a,o),b.enableVertexAttribArray(t),x.vertexAttribDivisor(t,m||0)}),this}enable(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!e&&t===0&&!Ra.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const n=this._normalizeConstantArrayValue(e),i=n.byteLength*t,s=n.length*t;let a=!this.buffer;if(this.buffer=this.buffer||new si(this.gl,i),a=a||this.buffer.reallocate(i),a=a||!this._compareConstantArrayValues(n,this.bufferValue),a){const o=F9(e.constructor,s);L9({target:o,source:n,start:0,count:s}),this.buffer.subData(o),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}static _setConstantFloatArray(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:sr(!1)}}static _setConstantIntArray(t,e,n){switch(sr(fn(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:sr(!1)}}static _setConstantUintArray(t,e,n){switch(sr(fn(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:sr(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:n}=e;return sr(Number.isFinite(n)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(n,t);default:return this.gl.getVertexAttrib(n,t)}})}}const M9="VertexArray: attributes must be Buffers or constants (i.e. typed array)",U9=/^(.+)__LOCATION_([0-9]+)$/,R9=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class O9{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.id||e.program&&e.program.id;this.id=n,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ra(t),jT(this,"VertexArray","v6.0",R9),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const n=t[e];this._setAttribute(e,n)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e.target===34963)return this.setElementBuffer(e,n);const{location:i,accessor:s}=this._resolveLocationAndAccessor(t,e,e.accessor,n);return i>=0&&(this.values[i]=e,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,e,s)),this}setConstant(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:s}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n));return i>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[i]=e,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new si(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof si&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof si&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,n){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),i=n()}),i}_resolveLocationAndAccessor(t,e,n,i){const s={location:-1,accessor:null},{location:a,name:o}=this._getAttributeIndex(t);if(!Number.isFinite(a)||a<0)return this.unused[t]=e,wr.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),s;const h=this._getAttributeInfo(o||a);if(!h)return s;const f=this.accessors[a]||{},m=aa.resolve(h.accessor,f,n,i),{size:b,type:x}=m;return sr(Number.isFinite(b)&&Number.isFinite(x)),{location:a,accessor:m}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const n=U9.exec(t),i=n?n[1]:t,s=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+s,name:i}:{location:-1}}_setAttribute(t,e){if(e instanceof si)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof si){const n=e[0],i=e[1];this.setBuffer(t,n,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const n=e;this.setConstant(t,n)}else if(e.buffer instanceof si){const n=e;this.setBuffer(t,n.buffer,n)}else throw new Error(M9)}_setConstantAttributes(t,e){const n=Math.max(t|0,e|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)i=this.values[s],ArrayBuffer.isView(i)&&this._setConstantAttribute(s,i)}_setConstantAttributeZero(t,e){if(Ra.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(t,e){Ra.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const n=this.values[e],i=this.accessors[e];if(!n)return;const{divisor:s}=i,a=s>0;if(t.isInstanced=t.isInstanced||a,n instanceof si){const o=n;if(a){const h=o.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,h)}else{const h=o.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,h)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return wr.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function D9(r,t){const{maxElts:e=16,size:n=1}=t;let i="[";for(let a=0;a<r.length&&a<e;++a)a>0&&(i+=",".concat(a%n===0?" ":"")),i+=lg(r[a],t);const s=r.length>e?"...":"]";return"".concat(i).concat(s)}function lg(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=1e-16,{isInteger:n=!1}=t;if(Array.isArray(r)||ArrayBuffer.isView(r))return D9(r,t);if(!Number.isFinite(r))return String(r);if(Math.abs(r)<e)return n?"0":"0.";if(n||Math.abs(r)>100&&Math.abs(r)<1e4)return r.toFixed(0);const i=r.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function v5(r){let{header:t="Uniforms",program:e,uniforms:n,undefinedOnly:i=!1}=r;sr(e);const s=".*_.*",a=".*Matrix",o=e._uniformSetters,h={},f=Object.keys(o).sort();let m=0;for(const B of f)!B.match(s)&&!B.match(a)&&_b({table:h,header:t,uniforms:n,uniformName:B,undefinedOnly:i})&&m++;for(const B of f)B.match(a)&&_b({table:h,header:t,uniforms:n,uniformName:B,undefinedOnly:i})&&m++;for(const B of f)h[B]||_b({table:h,header:t,uniforms:n,uniformName:B,undefinedOnly:i})&&m++;let b=0;const x={};if(!i)for(const B in n){const P=n[B];h[B]||(b++,x[B]={Type:"NOT USED: ".concat(P),[t]:lg(P)})}return{table:h,count:m,unusedTable:x,unusedCount:b}}function _b(r){let{table:t,header:e,uniforms:n,uniformName:i,undefinedOnly:s}=r;const a=n[i],o=N9(a);return!s||!o?(t[i]={[e]:o?lg(a):"N/A","Uniform Type":o?a:"NOT PROVIDED"},!0):!1}function N9(r){return r!=null}function k9(r){let{vertexArray:t,header:e="Attributes"}=r;if(!t.configuration)return{};const n={};t.elements&&(n.ELEMENT_ARRAY_BUFFER=b5(t,t.elements,null,e));const i=t.values;for(const s in i){const a=t._getAttributeInfo(s);if(a){let o="".concat(s,": ").concat(a.name);const h=t.accessors[a.location];h&&(o="".concat(s,": ").concat(Q9(a.name,h))),n[o]=b5(t,i[s],h,e)}}return n}function b5(r,t,e,n){const{gl:i}=r;if(!t)return{[n]:"null","Format ":"N/A"};let s="NOT PROVIDED",a=1,o=0,h=0,f,m,b;if(e&&(s=e.type,a=e.size,s=String(s).replace("Array",""),f=s.indexOf("nt")!==-1),t instanceof si){const x=t,{data:B,changed:P}=x.getDebugData();m=P?"*":"",b=B,h=x.byteLength,o=h/B.BYTES_PER_ELEMENT/a;let R;if(e){const Q=e.divisor>0;R="".concat(Q?"I ":"P "," ").concat(o," (x").concat(a,"=").concat(h," bytes ").concat(MA(i,s),")")}else f=!0,R="".concat(h," bytes");return{[n]:"".concat(m).concat(lg(b,{size:a,isInteger:f})),"Format ":R}}return b=t,a=t.length,s=String(t.constructor.name).replace("Array",""),f=s.indexOf("nt")!==-1,{[n]:"".concat(lg(b,{size:a,isInteger:f})," (constant)"),"Format ":"".concat(a,"x").concat(s," (constant)")}}function Q9(r,t){const{type:e,size:n}=t,i=g5(e,n);return i?"".concat(r," (").concat(i.name,")"):r}function H9(r){const t={},e="Accessors for ".concat(r.id);for(const n of r.attributeInfos)if(n){const i=w5(n);t["in ".concat(i)]={[e]:JSON.stringify(n.accessor)}}for(const n of r.varyingInfos)if(n){const i=w5(n);t["out ".concat(i)]={[e]:JSON.stringify(n.accessor)}}return t}function w5(r){const{type:t,size:e}=r.accessor,n=g5(t,e);return n?"".concat(n.name," ").concat(r.name):r.name}const x5=Ou()&&typeof document<"u";let z9=0;class V9{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:e=Q=>VT(Q),onAddHTML:n=null,onInitialize:i=()=>{},onRender:s=()=>{},onFinalize:a=()=>{},onError:o,gl:h=null,glOptions:f={},debug:m=!1,createFramebuffer:b=!1,autoResizeViewport:x=!0,autoResizeDrawingBuffer:B=!0,stats:P=Nh.get("animation-loop-".concat(z9++))}=t;let{useDevicePixels:R=!0}=t;"useDevicePixelRatio"in t&&(wr.deprecated("useDevicePixelRatio","useDevicePixels")(),R=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:n,onInitialize:i,onRender:s,onFinalize:a,onError:o,gl:h,glOptions:f,debug:m,createFramebuffer:b},this.gl=h,this.needsRedraw=null,this.timeline=null,this.stats=P,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:x,autoResizeDrawingBuffer:B,useDevicePixels:R}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return sr(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=L0.isSupported(this.gl,["timers"])?new L0(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(n=>{this._running&&(this._addCallbackData(n||{}),n!==!1&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n=document.getElementById(t);return n?Number(n.value):e}setViewParameters(){return wr.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=x5?new Promise((t,e)=>{if(x5&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):Xz(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):$z(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?ob(this.props.gl,t):this.onCreateContext(t),!B0(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Oz(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let n=1;const{canvas:i}=this.gl;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&Hz(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new bs(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const cg="vs",vb="fs";function Oa(r,t){if(!r)throw new Error(t||"shadertools: assertion failed.")}const bb={number:{validate(r,t){return Number.isFinite(r)&&(!("max"in t)||r<=t.max)&&(!("min"in t)||r>=t.min)}},array:{validate(r,t){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function G9(r){const t={};for(const e in r){const n=r[e],i=j9(n);t[e]=i}return t}function j9(r){let t=B5(r);return t==="object"?r?"type"in r?Object.assign({},r,bb[r.type]):"value"in r?(t=B5(r.value),Object.assign({type:t},r,bb[t])):{type:"object",value:r}:{type:"object",value:null}:Object.assign({type:t,value:r},bb[t])}function B5(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const q9="vs",K9="fs";class C5{constructor(t){let{name:e,vs:n,fs:i,dependencies:s=[],uniforms:a,getUniforms:o,deprecations:h=[],defines:f={},inject:m={},vertexShader:b,fragmentShader:x}=t;Oa(typeof e=="string"),this.name=e,this.vs=n||b,this.fs=i||x,this.getModuleUniforms=o,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(h),this.defines=f,this.injections=W9(m),a&&(this.uniforms=G9(a))}getModuleSource(t){let e;switch(t){case q9:e=this.vs||"";break;case K9:e=this.fs||"";break;default:Oa(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(e,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(n=>{n.regex.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())})}_parseDeprecationDefinitions(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp("\\b".concat(e.old,"\\("));break;default:e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={},n=this.uniforms;for(const i in n){const s=n[i];i in t&&!s.private?(s.validate&&Oa(s.validate(t[i],s),"".concat(this.name,": invalid ").concat(i)),e[i]=t[i]):e[i]=s.value}return e}}function W9(r){const t={vs:{},fs:{}};for(const e in r){let n=r[e];const i=e.slice(0,2);typeof n=="string"&&(n={order:0,injection:n}),t[i][e]=n}return t}function $9(r){return X9(S5(r))}function X9(r){const t={},e={};return E5({modules:r,level:0,moduleMap:t,moduleDepth:e}),Object.keys(e).sort((n,i)=>e[i]-e[n]).map(n=>t[n])}function E5(r){let{modules:t,level:e,moduleMap:n,moduleDepth:i}=r;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)n[s.name]=s,(i[s.name]===void 0||i[s.name]<e)&&(i[s.name]=e);for(const s of t)s.dependencies&&E5({modules:s.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}function S5(r,t){return r.map(e=>(e instanceof C5||(Oa(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),Oa(e.name,"shader module has no name"),e=new C5(e),e.dependencies=S5(e.dependencies)),e))}function J9(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},e=r.userAgent||t.userAgent||"",n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i}const Y9=7936,Z9=7937,tV=7938,eV=35724,wb={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Qh={};Object.keys(wb).forEach(r=>{Qh[r]=r});function rV(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function nV(r){const t=r.getExtension("WEBGL_debug_renderer_info"),e=r.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||Y9),n=r.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||Z9);return{gpuVendor:iV(e,n),vendor:e,renderer:n,version:r.getParameter(tV),shadingLanguageVersion:r.getParameter(eV)}}function iV(r,t){return r.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":r.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":r.match(/AMD/i)||t.match(/AMD/i)||r.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const xb={};function T5(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=wb[t];if(Oa(n,t),!J9(e))return!0;if(t in xb)return xb[t];const i=n[0],s=e.behavior||"enable",a="#extension GL_".concat(i," : ").concat(s,`
void main(void) {}`),o=r.createShader(35633);r.shaderSource(o,a),r.compileShader(o);const h=r.getShaderParameter(o,35713);return r.deleteShader(o),xb[t]=h,h}function sV(r,t){const e=wb[t];Oa(e,t);const n=rV(r)&&e[1]||e[0],i=typeof n=="string"?!!r.getExtension(n):n;return Oa(i===!1||i===!0),i}function M0(r,t){return t=Array.isArray(t)?t:[t],t.every(e=>sV(r,e))}function oV(r){switch(nV(r).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function aV(r,t,e){let n=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return M0(r,Qh.GLSL_FRAG_DEPTH)&&(n+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),M0(r,Qh.GLSL_DERIVATIVES)&&T5(r,Qh.GLSL_DERIVATIVES)&&(n+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),M0(r,Qh.GLSL_FRAG_DATA)&&T5(r,Qh.GLSL_FRAG_DATA,{behavior:"require"})&&(n+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),M0(r,Qh.GLSL_TEXTURE_LOD)&&(n+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),n}const lV=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,cV=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,uV={[cg]:lV,[vb]:cV},U0="__LUMA_INJECT_DECLARATIONS__",I5=/void\s+main\s*\([^)]*\)\s*\{\n?/,F5=/}\n?[^{}]*$/,Bb=[];function L5(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=t===cg;for(const s in e){const a=e[s];a.sort((h,f)=>h.order-f.order),Bb.length=a.length;for(let h=0,f=a.length;h<f;++h)Bb[h]=a[h].injection;const o="".concat(Bb.join(`
`),`
`);switch(s){case"vs:#decl":i&&(r=r.replace(U0,o));break;case"vs:#main-start":i&&(r=r.replace(I5,h=>h+o));break;case"vs:#main-end":i&&(r=r.replace(F5,h=>o+h));break;case"fs:#decl":i||(r=r.replace(U0,o));break;case"fs:#main-start":i||(r=r.replace(I5,h=>h+o));break;case"fs:#main-end":i||(r=r.replace(F5,h=>o+h));break;default:r=r.replace(s,h=>h+o)}}return r=r.replace(U0,""),n&&(r=r.replace(/\}\s*$/,s=>s+uV[t])),r}function Cb(r){const t={};return Oa(Array.isArray(r)&&r.length>1),r.forEach(e=>{for(const n in e)t[n]=t[n]?"".concat(t[n],`
`).concat(e[n]):e[n]}),t}function nf(r){return new RegExp("\\b".concat(r,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const P5=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],AV=[...P5,[nf("attribute"),"in $1"],[nf("varying"),"out $1"]],hV=[...P5,[nf("varying"),"in $1"]],M5=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],dV=[...M5,[nf("in"),"attribute $1"],[nf("out"),"varying $1"]],fV=[...M5,[nf("in"),"varying $1"]],Eb="gl_FragColor",Sb=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,pV=/void\s+main\s*\([^)]*\)\s*\{\n?/;function gV(r,t,e){switch(t){case 300:return e?R0(r,AV):mV(r);case 100:return e?R0(r,dV):yV(r);default:throw new Error("unknown GLSL version ".concat(t))}}function R0(r,t){for(const[e,n]of t)r=r.replace(e,n);return r}function mV(r){r=R0(r,hV);const t=r.match(Sb);if(t){const e=t[1];r=r.replace(new RegExp("\\b".concat(Eb,"\\b"),"g"),e)}else{const e="fragmentColor";r=r.replace(pV,n=>"out vec4 ".concat(e,`;
`).concat(n)).replace(new RegExp("\\b".concat(Eb,"\\b"),"g"),e)}return r}function yV(r){r=R0(r,fV);const t=r.match(Sb);if(t){const e=t[1];r=r.replace(Sb,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),Eb)}return r}const _V=`

`.concat(U0,`

`),U5={[cg]:"vertex",[vb]:"fragment"},vV=`precision highp float;

`;function bV(r,t){const{vs:e,fs:n}=t,i=$9(t.modules||[]);return{gl:r,vs:R5(r,Object.assign({},t,{source:e,type:cg,modules:i})),fs:R5(r,Object.assign({},t,{source:n,type:vb,modules:i})),getUniforms:wV(i)}}function R5(r,t){let{id:e,source:n,type:i,modules:s,defines:a={},hookFunctions:o=[],inject:h={},transpileToGLSL100:f=!1,prologue:m=!0,log:b}=t;Oa(typeof n=="string","shader source must be a string");const x=i===cg,B=n.split(`
`);let P=100,R="",Q=n;B[0].indexOf("#version ")===0?(P=300,R=B[0],Q=B.slice(1).join(`
`)):R="#version ".concat(P);const z={};s.forEach(mt=>{Object.assign(z,mt.getDefines())}),Object.assign(z,a);let G=m?"".concat(R,`
`).concat(BV({id:e,source:n,type:i}),`
`).concat(xV({type:i}),`
`).concat(oV(r),`
`).concat(aV(r),`
`).concat(CV(z),`
`).concat(x?"":vV,`
`):"".concat(R,`
`);const X=SV(o),et={},pt={},gt={};for(const mt in h){const ft=typeof h[mt]=="string"?{injection:h[mt],order:0}:h[mt],Mt=mt.match(/^(v|f)s:(#)?([\w-]+)$/);if(Mt){const Lt=Mt[2],at=Mt[3];Lt?at==="decl"?pt[mt]=[ft]:gt[mt]=[ft]:et[mt]=[ft]}else gt[mt]=[ft]}for(const mt of s){b&&mt.checkDeprecations(Q,b);const ft=mt.getModuleSource(i,P);G+=ft;const Mt=mt.injections[i];for(const Lt in Mt){const at=Lt.match(/^(v|f)s:#([\w-]+)$/);if(at){const wt=at[2]==="decl"?pt:gt;wt[Lt]=wt[Lt]||[],wt[Lt].push(Mt[Lt])}else et[Lt]=et[Lt]||[],et[Lt].push(Mt[Lt])}}return G+=_V,G=L5(G,i,pt),G+=EV(X[i],et),G+=Q,G=L5(G,i,gt),G=gV(G,f?100:P,x),G}function wV(r){return function(e){const n={};for(const i of r){const s=i.getUniforms(e,n);Object.assign(n,s)}return n}}function xV(r){let{type:t}=r;return`
#define SHADER_TYPE_`.concat(U5[t].toUpperCase(),`
`)}function BV(r){let{id:t,source:e,type:n}=r;return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(U5[n],`

`):""}function CV(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,e="";for(const n in r){t===0&&(e+=`
// APPLICATION DEFINES
`),t++;const i=r[n];(i||Number.isFinite(i))&&(e+="#define ".concat(n.toUpperCase()," ").concat(r[n],`
`))}return t===0&&(e+=`
`),e}function EV(r,t){let e="";for(const n in r){const i=r[n];if(e+="void ".concat(i.signature,` {
`),i.header&&(e+="  ".concat(i.header)),t[n]){const s=t[n];s.sort((a,o)=>a.order-o.order);for(const a of s)e+="  ".concat(a.injection,`
`)}i.footer&&(e+="  ".concat(i.footer)),e+=`}
`}return e}function SV(r){const t={vs:{},fs:{}};return r.forEach(e=>{let n;typeof e!="string"?(n=e,e=n.hook):n={},e=e.trim();const[i,s]=e.split(":"),a=e.replace(/\(.+/,"");t[i][a]=Object.assign(n,{signature:s})}),t}const TV="void main() {gl_FragColor = vec4(0);}",O5=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,IV=`#version 300 es
`.concat(O5);function D5(r,t){t=Array.isArray(t)?t:[t];const e=r.replace(/^\s+/,"").split(/\s+/),[n,i,s]=e;if(!t.includes(n)||!i||!s)return null;const a=s.split(";")[0];return{qualifier:n,type:i,name:a}}function N5(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:e,inputType:n,output:i}=r;if(!e)return t===300?IV:t>300?"#version ".concat(t,`
`).concat(O5):TV;const s=PV(e,n);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(n," ").concat(e,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(s,`;
}`):"varying ".concat(n," ").concat(e,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function FV(r){switch(r){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Oa(!1),null}}function LV(r){switch(r){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Oa(!1),null}}function PV(r,t){switch(t){case"float":return"vec4(".concat(r,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(r,", 0.0, 1.0)");case"vec3":return"vec4(".concat(r,", 1.0)");case"vec4":return r;default:return Oa(!1),null}}const MV={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function ec(r,t){if(!r)throw new Error("math.gl assertion ".concat(t))}const UV=1/Math.PI*180,RV=1/180*Math.PI,xs={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function OV(r){let{precision:t=xs.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=QV(r),"".concat(parseFloat(r.toPrecision(t)))}function RA(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function DV(r){return kV(r)}function NV(r){return Hu(r)}function kV(r,t){return Tb(r,e=>e*RV,t)}function Hu(r,t){return Tb(r,e=>e*UV,t)}function zu(r,t,e){return Tb(r,n=>Math.max(t,Math.min(e,n)))}function O0(r,t,e){return RA(r)?r.map((n,i)=>O0(n,t[i],e)):e*t+(1-e)*r}function rc(r,t,e){const n=xs.EPSILON;e&&(xs.EPSILON=e);try{if(r===t)return!0;if(RA(r)&&RA(t)){if(r.length!==t.length)return!1;for(let i=0;i<r.length;++i)if(!rc(r[i],t[i]))return!1;return!0}return r&&r.equals?r.equals(t):t&&t.equals?t.equals(r):typeof r=="number"&&typeof t=="number"?Math.abs(r-t)<=xs.EPSILON*Math.max(1,Math.abs(r),Math.abs(t)):!1}finally{xs.EPSILON=n}}function QV(r){return Math.round(r/xs.EPSILON)*xs.EPSILON}function HV(r){return r.clone?r.clone():new Array(r.length)}function Tb(r,t,e){if(RA(r)){const n=r;e=e||HV(n);for(let i=0;i<e.length&&i<n.length;++i)e[i]=t(r[i],i,e);return e}return t(r)}function zV(r){function t(){var e=Reflect.construct(r,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return t.prototype=Object.create(r.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r,t}class Ib extends zV(Array){clone(){return new this.constructor().copy(this)}fromArray(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:RA(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(xs)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+OV(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!rc(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(n===void 0)return this.lerp(this,t,e);for(let i=0;i<this.ELEMENTS;++i){const s=t[i];this[i]=s+n*(e[i]-s)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(xs.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function VV(r,t){if(r.length!==t)return!1;for(let e=0;e<r.length;++e)if(!Number.isFinite(r[e]))return!1;return!0}function kn(r){if(!Number.isFinite(r))throw new Error("Invalid number ".concat(r));return r}function ug(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(xs.debug&&!VV(r,t))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return r}class Fb extends Ib{get x(){return this[0]}set x(t){this[0]=kn(t)}get y(){return this[1]}set y(t){this[1]=kn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-t[n];e+=i*i}return kn(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return kn(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return ec(t>=0&&t<this.ELEMENTS,"index is out of range"),kn(this[t])}setComponent(t,e){return ec(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var Ag=1e-6,nc=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});function GV(){var r=new nc(2);return nc!=Float32Array&&(r[0]=0,r[1]=0),r}function k5(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function jV(r,t){return r[0]=-t[0],r[1]=-t[1],r}function Q5(r,t,e,n){var i=t[0],s=t[1];return r[0]=i+n*(e[0]-i),r[1]=s+n*(e[1]-s),r}function qV(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r}function KV(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i+e[4],r[1]=e[1]*n+e[3]*i+e[5],r}function H5(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[3]*i+e[6],r[1]=e[1]*n+e[4]*i+e[7],r}function z5(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[4]*i+e[12],r[1]=e[1]*n+e[5]*i+e[13],r}(function(){var r=GV();return function(t,e,n,i,s,a){var o,h;for(e||(e=2),n||(n=0),i?h=Math.min(i*e+n,t.length):h=t.length,o=n;o<h;o+=e)r[0]=t[o],r[1]=t[o+1],s(r,r,a),t[o]=r[0],t[o+1]=r[1];return t}})();function V5(r,t,e){const n=t[0],i=t[1],s=e[3]*n+e[7]*i||1;return r[0]=(e[0]*n+e[4]*i)/s,r[1]=(e[1]*n+e[5]*i)/s,r}function G5(r,t,e){const n=t[0],i=t[1],s=t[2],a=e[3]*n+e[7]*i+e[11]*s||1;return r[0]=(e[0]*n+e[4]*i+e[8]*s)/a,r[1]=(e[1]*n+e[5]*i+e[9]*s)/a,r[2]=(e[2]*n+e[6]*i+e[10]*s)/a,r}function WV(r,t,e){const n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r[2]=t[2],r}function $V(r,t,e){const n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r[2]=t[2],r[3]=t[3],r}function j5(r,t,e){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n+e[3]*i+e[6]*s,r[1]=e[1]*n+e[4]*i+e[7]*s,r[2]=e[2]*n+e[5]*i+e[8]*s,r[3]=t[3],r}class Lb extends Fb{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),RA(t)&&arguments.length===1?this.copy(t):(xs.debug&&(kn(t),kn(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return xs.debug&&(kn(t.x),kn(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return z5(this,this,t),this.check()}transformAsVector(t){return V5(this,this,t),this.check()}transformByMatrix3(t){return H5(this,this,t),this.check()}transformByMatrix2x3(t){return KV(this,this,t),this.check()}transformByMatrix2(t){return qV(this,this,t),this.check()}}function q5(){var r=new nc(3);return nc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function K5(r){var t=r[0],e=r[1],n=r[2];return Math.hypot(t,e,n)}function W5(r,t,e){var n=new nc(3);return n[0]=r,n[1]=t,n[2]=e,n}function XV(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function JV(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function YV(r,t){var e=t[0],n=t[1],i=t[2],s=e*e+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r}function Pb(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function D0(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[0],o=e[1],h=e[2];return r[0]=i*h-s*o,r[1]=s*a-n*h,r[2]=n*o-i*a,r}function Mb(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[3]*n+e[7]*i+e[11]*s+e[15];return a=a||1,r[0]=(e[0]*n+e[4]*i+e[8]*s+e[12])/a,r[1]=(e[1]*n+e[5]*i+e[9]*s+e[13])/a,r[2]=(e[2]*n+e[6]*i+e[10]*s+e[14])/a,r}function $5(r,t,e){var n=t[0],i=t[1],s=t[2];return r[0]=n*e[0]+i*e[3]+s*e[6],r[1]=n*e[1]+i*e[4]+s*e[7],r[2]=n*e[2]+i*e[5]+s*e[8],r}function X5(r,t,e){var n=e[0],i=e[1],s=e[2],a=e[3],o=t[0],h=t[1],f=t[2],m=i*f-s*h,b=s*o-n*f,x=n*h-i*o,B=i*x-s*b,P=s*m-n*x,R=n*b-i*m,Q=a*2;return m*=Q,b*=Q,x*=Q,B*=2,P*=2,R*=2,r[0]=o+m+B,r[1]=h+b+P,r[2]=f+x+R,r}function ZV(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function tG(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function eG(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function rG(r,t){var e=r[0],n=r[1],i=r[2],s=t[0],a=t[1],o=t[2],h=Math.sqrt(e*e+n*n+i*i),f=Math.sqrt(s*s+a*a+o*o),m=h*f,b=m&&Pb(r,t)/m;return Math.acos(Math.min(Math.max(b,-1),1))}var nG=XV,iG=K5;(function(){var r=q5();return function(t,e,n,i,s,a){var o,h;for(e||(e=3),n||(n=0),i?h=Math.min(i*e+n,t.length):h=t.length,o=n;o<h;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2];return t}})();const Ub=[0,0,0];let N0;class ce extends Fb{static get ZERO(){return N0||(N0=new ce(0,0,0),Object.freeze(N0)),N0}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&RA(t)?this.copy(t):(xs.debug&&(kn(t),kn(e),kn(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return xs.debug&&(kn(t.x),kn(t.y),kn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=kn(t)}angle(t){return rG(this,t)}cross(t){return D0(this,this,t),this.check()}rotateX(t){let{radians:e,origin:n=Ub}=t;return ZV(this,this,n,e),this.check()}rotateY(t){let{radians:e,origin:n=Ub}=t;return tG(this,this,n,e),this.check()}rotateZ(t){let{radians:e,origin:n=Ub}=t;return eG(this,this,n,e),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Mb(this,this,t),this.check()}transformAsVector(t){return G5(this,this,t),this.check()}transformByMatrix3(t){return $5(this,this,t),this.check()}transformByMatrix2(t){return WV(this,this,t),this.check()}transformByQuaternion(t){return X5(this,this,t),this.check()}}let k0;class Rb extends Fb{static get ZERO(){return k0||(k0=new Rb(0,0,0,0),Object.freeze(k0)),k0}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),RA(t)&&arguments.length===1?this.copy(t):(xs.debug&&(kn(t),kn(e),kn(n),kn(i)),this[0]=t,this[1]=e,this[2]=n,this[3]=i)}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return xs.debug&&(kn(t.x),kn(t.y),kn(t.z),kn(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=kn(t)}get w(){return this[3]}set w(t){this[3]=kn(t)}transform(t){return Mb(this,this,t),this.check()}transformByMatrix3(t){return j5(this,this,t),this.check()}transformByMatrix2(t){return $V(this,this,t),this.check()}transformByQuaternion(t){return X5(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class J5 extends Ib{toString(){let t="[";if(xs.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=kn(n),this}getColumn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=t*this.RANK;for(let i=0;i<this.RANK;++i)e[i]=this[n+i];return e}setColumn(t,e){const n=t*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=e[i];return this}}function sG(){var r=new nc(9);return nc!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function oG(r,t){if(r===t){var e=t[1],n=t[2],i=t[5];r[1]=t[3],r[2]=t[6],r[3]=e,r[5]=t[7],r[6]=n,r[7]=i}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r}function aG(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],h=t[6],f=t[7],m=t[8],b=m*a-o*f,x=-m*s+o*h,B=f*s-a*h,P=e*b+n*x+i*B;return P?(P=1/P,r[0]=b*P,r[1]=(-m*n+i*f)*P,r[2]=(o*n-i*a)*P,r[3]=x*P,r[4]=(m*e-i*h)*P,r[5]=(-o*e+i*s)*P,r[6]=B*P,r[7]=(-f*e+n*h)*P,r[8]=(a*e-n*s)*P,r):null}function lG(r){var t=r[0],e=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8];return t*(f*s-a*h)+e*(-f*i+a*o)+n*(h*i-s*o)}function Y5(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],h=t[5],f=t[6],m=t[7],b=t[8],x=e[0],B=e[1],P=e[2],R=e[3],Q=e[4],z=e[5],G=e[6],X=e[7],et=e[8];return r[0]=x*n+B*a+P*f,r[1]=x*i+B*o+P*m,r[2]=x*s+B*h+P*b,r[3]=R*n+Q*a+z*f,r[4]=R*i+Q*o+z*m,r[5]=R*s+Q*h+z*b,r[6]=G*n+X*a+et*f,r[7]=G*i+X*o+et*m,r[8]=G*s+X*h+et*b,r}function cG(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],h=t[5],f=t[6],m=t[7],b=t[8],x=e[0],B=e[1];return r[0]=n,r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=h,r[6]=x*n+B*a+f,r[7]=x*i+B*o+m,r[8]=x*s+B*h+b,r}function uG(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],h=t[5],f=t[6],m=t[7],b=t[8],x=Math.sin(e),B=Math.cos(e);return r[0]=B*n+x*a,r[1]=B*i+x*o,r[2]=B*s+x*h,r[3]=B*a-x*n,r[4]=B*o-x*i,r[5]=B*h-x*s,r[6]=f,r[7]=m,r[8]=b,r}function Z5(r,t,e){var n=e[0],i=e[1];return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=i*t[3],r[4]=i*t[4],r[5]=i*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function AG(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e+e,o=n+n,h=i+i,f=e*a,m=n*a,b=n*o,x=i*a,B=i*o,P=i*h,R=s*a,Q=s*o,z=s*h;return r[0]=1-b-P,r[3]=m-z,r[6]=x+Q,r[1]=m+z,r[4]=1-f-P,r[7]=B-R,r[2]=x-Q,r[5]=B+R,r[8]=1-f-b,r}var Ob;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(Ob||(Ob={}));const hG=Object.freeze([1,0,0,0,1,0,0,0,1]);class Di extends J5{static get IDENTITY(){return fG()}static get ZERO(){return dG()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Ob}constructor(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):n.length>0?this.copy([t,...n]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(hG)}fromObject(t){return this.check()}fromQuaternion(t){return AG(this,t),this.check()}set(t,e,n,i,s,a,o,h,f){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this.check()}setRowMajor(t,e,n,i,s,a,o,h,f){return this[0]=t,this[1]=i,this[2]=o,this[3]=e,this[4]=s,this[5]=h,this[6]=n,this[7]=a,this[8]=f,this.check()}determinant(){return lG(this)}transpose(){return oG(this,this),this.check()}invert(){return aG(this,this),this.check()}multiplyLeft(t){return Y5(this,t,this),this.check()}multiplyRight(t){return Y5(this,this,t),this.check()}rotate(t){return uG(this,this,t),this.check()}scale(t){return Array.isArray(t)?Z5(this,this,t):Z5(this,this,[t,t]),this.check()}translate(t){return cG(this,this,t),this.check()}transform(t,e){let n;switch(t.length){case 2:n=H5(e||[-0,-0],t,this);break;case 3:n=$5(e||[-0,-0,-0],t,this);break;case 4:n=j5(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ug(n,t.length),n}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let Q0,H0;function dG(){return Q0||(Q0=new Di([0,0,0,0,0,0,0,0,0]),Object.freeze(Q0)),Q0}function fG(){return H0||(H0=new Di,Object.freeze(H0)),H0}function pG(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function gG(r,t){if(r===t){var e=t[1],n=t[2],i=t[3],s=t[6],a=t[7],o=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=e,r[6]=t[9],r[7]=t[13],r[8]=n,r[9]=s,r[11]=t[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function Db(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],h=t[6],f=t[7],m=t[8],b=t[9],x=t[10],B=t[11],P=t[12],R=t[13],Q=t[14],z=t[15],G=e*o-n*a,X=e*h-i*a,et=e*f-s*a,pt=n*h-i*o,gt=n*f-s*o,mt=i*f-s*h,ft=m*R-b*P,Mt=m*Q-x*P,Lt=m*z-B*P,at=b*Q-x*R,ct=b*z-B*R,wt=x*z-B*Q,_t=G*wt-X*ct+et*at+pt*Lt-gt*Mt+mt*ft;return _t?(_t=1/_t,r[0]=(o*wt-h*ct+f*at)*_t,r[1]=(i*ct-n*wt-s*at)*_t,r[2]=(R*mt-Q*gt+z*pt)*_t,r[3]=(x*gt-b*mt-B*pt)*_t,r[4]=(h*Lt-a*wt-f*Mt)*_t,r[5]=(e*wt-i*Lt+s*Mt)*_t,r[6]=(Q*et-P*mt-z*X)*_t,r[7]=(m*mt-x*et+B*X)*_t,r[8]=(a*ct-o*Lt+f*ft)*_t,r[9]=(n*Lt-e*ct-s*ft)*_t,r[10]=(P*gt-R*et+z*G)*_t,r[11]=(b*et-m*gt-B*G)*_t,r[12]=(o*Mt-a*at-h*ft)*_t,r[13]=(e*at-n*Mt+i*ft)*_t,r[14]=(R*X-P*pt-Q*G)*_t,r[15]=(m*pt-b*X+x*G)*_t,r):null}function mG(r){var t=r[0],e=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],h=r[7],f=r[8],m=r[9],b=r[10],x=r[11],B=r[12],P=r[13],R=r[14],Q=r[15],z=t*a-e*s,G=t*o-n*s,X=t*h-i*s,et=e*o-n*a,pt=e*h-i*a,gt=n*h-i*o,mt=f*P-m*B,ft=f*R-b*B,Mt=f*Q-x*B,Lt=m*R-b*P,at=m*Q-x*P,ct=b*Q-x*R;return z*ct-G*at+X*Lt+et*Mt-pt*ft+gt*mt}function Hh(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],h=t[5],f=t[6],m=t[7],b=t[8],x=t[9],B=t[10],P=t[11],R=t[12],Q=t[13],z=t[14],G=t[15],X=e[0],et=e[1],pt=e[2],gt=e[3];return r[0]=X*n+et*o+pt*b+gt*R,r[1]=X*i+et*h+pt*x+gt*Q,r[2]=X*s+et*f+pt*B+gt*z,r[3]=X*a+et*m+pt*P+gt*G,X=e[4],et=e[5],pt=e[6],gt=e[7],r[4]=X*n+et*o+pt*b+gt*R,r[5]=X*i+et*h+pt*x+gt*Q,r[6]=X*s+et*f+pt*B+gt*z,r[7]=X*a+et*m+pt*P+gt*G,X=e[8],et=e[9],pt=e[10],gt=e[11],r[8]=X*n+et*o+pt*b+gt*R,r[9]=X*i+et*h+pt*x+gt*Q,r[10]=X*s+et*f+pt*B+gt*z,r[11]=X*a+et*m+pt*P+gt*G,X=e[12],et=e[13],pt=e[14],gt=e[15],r[12]=X*n+et*o+pt*b+gt*R,r[13]=X*i+et*h+pt*x+gt*Q,r[14]=X*s+et*f+pt*B+gt*z,r[15]=X*a+et*m+pt*P+gt*G,r}function z0(r,t,e){var n=e[0],i=e[1],s=e[2],a,o,h,f,m,b,x,B,P,R,Q,z;return t===r?(r[12]=t[0]*n+t[4]*i+t[8]*s+t[12],r[13]=t[1]*n+t[5]*i+t[9]*s+t[13],r[14]=t[2]*n+t[6]*i+t[10]*s+t[14],r[15]=t[3]*n+t[7]*i+t[11]*s+t[15]):(a=t[0],o=t[1],h=t[2],f=t[3],m=t[4],b=t[5],x=t[6],B=t[7],P=t[8],R=t[9],Q=t[10],z=t[11],r[0]=a,r[1]=o,r[2]=h,r[3]=f,r[4]=m,r[5]=b,r[6]=x,r[7]=B,r[8]=P,r[9]=R,r[10]=Q,r[11]=z,r[12]=a*n+m*i+P*s+t[12],r[13]=o*n+b*i+R*s+t[13],r[14]=h*n+x*i+Q*s+t[14],r[15]=f*n+B*i+z*s+t[15]),r}function Nb(r,t,e){var n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*i,r[5]=t[5]*i,r[6]=t[6]*i,r[7]=t[7]*i,r[8]=t[8]*s,r[9]=t[9]*s,r[10]=t[10]*s,r[11]=t[11]*s,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function yG(r,t,e,n){var i=n[0],s=n[1],a=n[2],o=Math.hypot(i,s,a),h,f,m,b,x,B,P,R,Q,z,G,X,et,pt,gt,mt,ft,Mt,Lt,at,ct,wt,_t,Jt;return o<Ag?null:(o=1/o,i*=o,s*=o,a*=o,h=Math.sin(e),f=Math.cos(e),m=1-f,b=t[0],x=t[1],B=t[2],P=t[3],R=t[4],Q=t[5],z=t[6],G=t[7],X=t[8],et=t[9],pt=t[10],gt=t[11],mt=i*i*m+f,ft=s*i*m+a*h,Mt=a*i*m-s*h,Lt=i*s*m-a*h,at=s*s*m+f,ct=a*s*m+i*h,wt=i*a*m+s*h,_t=s*a*m-i*h,Jt=a*a*m+f,r[0]=b*mt+R*ft+X*Mt,r[1]=x*mt+Q*ft+et*Mt,r[2]=B*mt+z*ft+pt*Mt,r[3]=P*mt+G*ft+gt*Mt,r[4]=b*Lt+R*at+X*ct,r[5]=x*Lt+Q*at+et*ct,r[6]=B*Lt+z*at+pt*ct,r[7]=P*Lt+G*at+gt*ct,r[8]=b*wt+R*_t+X*Jt,r[9]=x*wt+Q*_t+et*Jt,r[10]=B*wt+z*_t+pt*Jt,r[11]=P*wt+G*_t+gt*Jt,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function tI(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[4],a=t[5],o=t[6],h=t[7],f=t[8],m=t[9],b=t[10],x=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=s*i+f*n,r[5]=a*i+m*n,r[6]=o*i+b*n,r[7]=h*i+x*n,r[8]=f*i-s*n,r[9]=m*i-a*n,r[10]=b*i-o*n,r[11]=x*i-h*n,r}function _G(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[0],a=t[1],o=t[2],h=t[3],f=t[8],m=t[9],b=t[10],x=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*i-f*n,r[1]=a*i-m*n,r[2]=o*i-b*n,r[3]=h*i-x*n,r[8]=s*n+f*i,r[9]=a*n+m*i,r[10]=o*n+b*i,r[11]=h*n+x*i,r}function eI(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[0],a=t[1],o=t[2],h=t[3],f=t[4],m=t[5],b=t[6],x=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*i+f*n,r[1]=a*i+m*n,r[2]=o*i+b*n,r[3]=h*i+x*n,r[4]=f*i-s*n,r[5]=m*i-a*n,r[6]=b*i-o*n,r[7]=x*i-h*n,r}function vG(r,t){var e=t[0],n=t[1],i=t[2],s=t[4],a=t[5],o=t[6],h=t[8],f=t[9],m=t[10];return r[0]=Math.hypot(e,n,i),r[1]=Math.hypot(s,a,o),r[2]=Math.hypot(h,f,m),r}function bG(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e+e,o=n+n,h=i+i,f=e*a,m=n*a,b=n*o,x=i*a,B=i*o,P=i*h,R=s*a,Q=s*o,z=s*h;return r[0]=1-b-P,r[1]=m+z,r[2]=x-Q,r[3]=0,r[4]=m-z,r[5]=1-f-P,r[6]=B+R,r[7]=0,r[8]=x+Q,r[9]=B-R,r[10]=1-f-b,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function wG(r,t,e,n,i,s,a){var o=1/(e-t),h=1/(i-n),f=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*h,r[6]=0,r[7]=0,r[8]=(e+t)*o,r[9]=(i+n)*h,r[10]=(a+s)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*f,r[15]=0,r}function xG(r,t,e,n,i){var s=1/Math.tan(t/2),a;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(a=1/(n-i),r[10]=(i+n)*a,r[14]=2*i*n*a):(r[10]=-1,r[14]=-2*n),r}var BG=xG;function CG(r,t,e,n,i,s,a){var o=1/(t-e),h=1/(n-i),f=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(t+e)*o,r[13]=(i+n)*h,r[14]=(a+s)*f,r[15]=1,r}var EG=CG;function SG(r,t,e,n){var i,s,a,o,h,f,m,b,x,B,P=t[0],R=t[1],Q=t[2],z=n[0],G=n[1],X=n[2],et=e[0],pt=e[1],gt=e[2];return Math.abs(P-et)<Ag&&Math.abs(R-pt)<Ag&&Math.abs(Q-gt)<Ag?pG(r):(m=P-et,b=R-pt,x=Q-gt,B=1/Math.hypot(m,b,x),m*=B,b*=B,x*=B,i=G*x-X*b,s=X*m-z*x,a=z*b-G*m,B=Math.hypot(i,s,a),B?(B=1/B,i*=B,s*=B,a*=B):(i=0,s=0,a=0),o=b*a-x*s,h=x*i-m*a,f=m*s-b*i,B=Math.hypot(o,h,f),B?(B=1/B,o*=B,h*=B,f*=B):(o=0,h=0,f=0),r[0]=i,r[1]=o,r[2]=m,r[3]=0,r[4]=s,r[5]=h,r[6]=b,r[7]=0,r[8]=a,r[9]=f,r[10]=x,r[11]=0,r[12]=-(i*P+s*R+a*Q),r[13]=-(o*P+h*R+f*Q),r[14]=-(m*P+b*R+x*Q),r[15]=1,r)}function TG(){var r=new nc(4);return nc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function IG(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function rI(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function FG(r){var t=r[0],e=r[1],n=r[2],i=r[3];return Math.hypot(t,e,n,i)}function LG(r){var t=r[0],e=r[1],n=r[2],i=r[3];return t*t+e*e+n*n+i*i}function PG(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e*e+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=e*a,r[1]=n*a,r[2]=i*a,r[3]=s*a,r}function MG(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function UG(r,t,e,n){var i=t[0],s=t[1],a=t[2],o=t[3];return r[0]=i+n*(e[0]-i),r[1]=s+n*(e[1]-s),r[2]=a+n*(e[2]-a),r[3]=o+n*(e[3]-o),r}function hg(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3];return r[0]=e[0]*n+e[4]*i+e[8]*s+e[12]*a,r[1]=e[1]*n+e[5]*i+e[9]*s+e[13]*a,r[2]=e[2]*n+e[6]*i+e[10]*s+e[14]*a,r[3]=e[3]*n+e[7]*i+e[11]*s+e[15]*a,r}function RG(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[0],o=e[1],h=e[2],f=e[3],m=f*n+o*s-h*i,b=f*i+h*n-a*s,x=f*s+a*i-o*n,B=-a*n-o*i-h*s;return r[0]=m*f+B*-a+b*-h-x*-o,r[1]=b*f+B*-o+x*-a-m*-h,r[2]=x*f+B*-h+m*-o-b*-a,r[3]=t[3],r}(function(){var r=TG();return function(t,e,n,i,s,a){var o,h;for(e||(e=4),n||(n=0),i?h=Math.min(i*e+n,t.length):h=t.length,o=n;o<h;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],r[3]=t[o+3],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2],t[o+3]=r[3];return t}})();var kb;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(kb||(kb={}));const OG=45*Math.PI/180,DG=1,Qb=.1,Hb=500,NG=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class wn extends J5{static get IDENTITY(){return QG()}static get ZERO(){return kG()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return kb}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,i,s,a,o,h,f,m,b,x,B,P,R,Q){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=h,this[8]=f,this[9]=m,this[10]=b,this[11]=x,this[12]=B,this[13]=P,this[14]=R,this[15]=Q,this.check()}setRowMajor(t,e,n,i,s,a,o,h,f,m,b,x,B,P,R,Q){return this[0]=t,this[1]=s,this[2]=f,this[3]=B,this[4]=e,this[5]=a,this[6]=m,this[7]=P,this[8]=n,this[9]=o,this[10]=b,this[11]=R,this[12]=i,this[13]=h,this[14]=x,this[15]=Q,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(NG)}fromObject(t){return this.check()}fromQuaternion(t){return bG(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:i,top:s,near:a=Qb,far:o=Hb}=t;return o===1/0?HG(this,e,n,i,s,a):wG(this,e,n,i,s,a,o),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:i=[0,1,0]}=t;return SG(this,e,n,i),this.check()}ortho(t){const{left:e,right:n,bottom:i,top:s,near:a=Qb,far:o=Hb}=t;return EG(this,e,n,i,s,a,o),this.check()}orthographic(t){const{fovy:e=OG,aspect:n=DG,focalDistance:i=1,near:s=Qb,far:a=Hb}=t;nI(e);const o=e/2,h=i*Math.tan(o),f=h*n;return this.ortho({left:-f,right:f,bottom:-h,top:h,near:s,far:a})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=t;return nI(e),BG(this,e,n,i,s),this.check()}determinant(){return mG(this)}getScale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],s=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*s,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*s,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],s=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=this[4]*i,t[4]=this[5]*s,t[5]=this[6]*a,t[6]=this[8]*i,t[7]=this[9]*s,t[8]=this[10]*a,t}transpose(){return gG(this,this),this.check()}invert(){return Db(this,this),this.check()}multiplyLeft(t){return Hh(this,t,this),this.check()}multiplyRight(t){return Hh(this,this,t),this.check()}rotateX(t){return tI(this,this,t),this.check()}rotateY(t){return _G(this,this,t),this.check()}rotateZ(t){return eI(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return yG(this,this,t,e),this.check()}scale(t){return Nb(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return z0(this,this,t),this.check()}transform(t,e){return t.length===4?(e=hg(e||[-0,-0,-0,-0],t,this),ug(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let i;switch(n){case 2:i=z5(e||[-0,-0],t,this);break;case 3:i=Mb(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ug(i,t.length),i}transformAsVector(t,e){let n;switch(t.length){case 2:n=V5(e||[-0,-0],t,this);break;case 3:n=G5(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ug(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let V0,G0;function kG(){return V0||(V0=new wn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(V0)),V0}function QG(){return G0||(G0=new wn,Object.freeze(G0)),G0}function nI(r){if(r>Math.PI*2)throw Error("expected radians")}function HG(r,t,e,n,i,s){const a=2*s/(e-t),o=2*s/(i-n),h=(e+t)/(e-t),f=(i+n)/(i-n),m=-1,b=-1,x=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=h,r[9]=f,r[10]=m,r[11]=b,r[12]=0,r[13]=0,r[14]=x,r[15]=0,r}function iI(){var r=new nc(4);return nc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function zG(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function sI(r,t,e){e=e*.5;var n=Math.sin(e);return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=Math.cos(e),r}function oI(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],h=e[1],f=e[2],m=e[3];return r[0]=n*m+a*o+i*f-s*h,r[1]=i*m+a*h+s*o-n*f,r[2]=s*m+a*f+n*h-i*o,r[3]=a*m-n*o-i*h-s*f,r}function VG(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),h=Math.cos(e);return r[0]=n*h+a*o,r[1]=i*h+s*o,r[2]=s*h-i*o,r[3]=a*h-n*o,r}function GG(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),h=Math.cos(e);return r[0]=n*h-s*o,r[1]=i*h+a*o,r[2]=s*h+n*o,r[3]=a*h-i*o,r}function jG(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),h=Math.cos(e);return r[0]=n*h+i*o,r[1]=i*h-n*o,r[2]=s*h+a*o,r[3]=a*h-s*o,r}function qG(r,t){var e=t[0],n=t[1],i=t[2];return r[0]=e,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-e*e-n*n-i*i)),r}function j0(r,t,e,n){var i=t[0],s=t[1],a=t[2],o=t[3],h=e[0],f=e[1],m=e[2],b=e[3],x,B,P,R,Q;return B=i*h+s*f+a*m+o*b,B<0&&(B=-B,h=-h,f=-f,m=-m,b=-b),1-B>Ag?(x=Math.acos(B),P=Math.sin(x),R=Math.sin((1-n)*x)/P,Q=Math.sin(n*x)/P):(R=1-n,Q=n),r[0]=R*i+Q*h,r[1]=R*s+Q*f,r[2]=R*a+Q*m,r[3]=R*o+Q*b,r}function KG(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e*e+n*n+i*i+s*s,o=a?1/a:0;return r[0]=-e*o,r[1]=-n*o,r[2]=-i*o,r[3]=s*o,r}function WG(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function aI(r,t){var e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[5]-t[7])*n,r[1]=(t[6]-t[2])*n,r[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[s*3+s]-t[a*3+a]+1),r[i]=.5*n,n=.5/n,r[3]=(t[s*3+a]-t[a*3+s])*n,r[s]=(t[s*3+i]+t[i*3+s])*n,r[a]=(t[a*3+i]+t[i*3+a])*n}return r}var $G=IG,XG=rI,JG=MG,YG=UG,ZG=FG,tj=LG,lI=PG,ej=function(){var r=q5(),t=W5(1,0,0),e=W5(0,1,0);return function(n,i,s){var a=Pb(i,s);return a<-.999999?(D0(r,t,i),iG(r)<1e-6&&D0(r,e,i),YV(r,r),sI(n,r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(D0(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+a,lI(n,n))}}();(function(){var r=iI(),t=iI();return function(e,n,i,s,a,o){return j0(r,n,a,o),j0(t,i,s,o),j0(e,r,t,2*o*(1-o)),e}})(),function(){var r=sG();return function(t,e,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],lI(t,aI(t,r))}}();const rj=[0,0,0,1];class dg extends Ib{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,n,i)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return aI(this,t),this.check()}fromAxisRotation(t,e){return sI(this,t,e),this.check()}identity(){return zG(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=kn(t)}get y(){return this[1]}set y(t){this[1]=kn(t)}get z(){return this[2]}set z(t){this[2]=kn(t)}get w(){return this[3]}set w(t){this[3]=kn(t)}len(){return ZG(this)}lengthSquared(){return tj(this)}dot(t){return JG(this,t)}rotationTo(t,e){return ej(this,t,e),this.check()}add(t){return $G(this,this,t),this.check()}calculateW(){return qG(this,this),this.check()}conjugate(){return WG(this,this),this.check()}invert(){return KG(this,this),this.check()}lerp(t,e,n){return n===void 0?this.lerp(this,t,e):(YG(this,t,e,n),this.check())}multiplyRight(t){return oI(this,this,t),this.check()}multiplyLeft(t){return oI(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return VG(this,this,t),this.check()}rotateY(t){return GG(this,this,t),this.check()}rotateZ(t){return jG(this,this,t),this.check()}scale(t){return XG(this,this,t),this.check()}slerp(t,e,n){let i,s,a;switch(arguments.length){case 1:({start:i=rj,target:s,ratio:a}=t);break;case 2:i=this,s=t,a=e;break;default:i=t,s=e,a=n}return j0(this,i,s,a),this.check()}transformVector4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Rb;return RG(e,t,this),ug(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const fg={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},cI=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,nj={lightSources:{}};function zb(){let{color:r=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r.map(e=>e*t/255)}function ij(r){let{ambientLight:t,pointLights:e=[],directionalLights:n=[]}=r;const i={};return t?i["lighting_uAmbientLight.color"]=zb(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,a)=>{i["lighting_uPointLight[".concat(a,"].color")]=zb(s),i["lighting_uPointLight[".concat(a,"].position")]=s.position,i["lighting_uPointLight[".concat(a,"].attenuation")]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,n.forEach((s,a)=>{i["lighting_uDirectionalLight[".concat(a,"].color")]=zb(s),i["lighting_uDirectionalLight[".concat(a,"].direction")]=s.direction}),i.lighting_uDirectionalLightCount=n.length,i}function uI(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:nj;if("lightSources"in r){const{ambientLight:t,pointLights:e,directionalLights:n}=r.lightSources||{};return t||e&&e.length>0||n&&n.length>0?Object.assign({},ij({ambientLight:t,pointLights:e,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in r){const t={pointLights:[],directionalLights:[]};for(const e of r.lights||[])switch(e.type){case"ambient":t.ambientLight=e;break;case"directional":t.directionalLights.push(e);break;case"point":t.pointLights.push(e);break}return uI({lightSources:t})}return{}}const Vb={name:"lights",vs:cI,fs:cI,getUniforms:uI,defines:{MAX_LIGHTS:3}},sj={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function oj(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sj;const t={};if(r.pickingSelectedColor!==void 0)if(!r.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const e=r.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=e}if(r.pickingHighlightColor){const e=Array.from(r.pickingHighlightColor,n=>n/255);Number.isFinite(e[3])||(e[3]=1),t.picking_uHighlightColor=e}return r.pickingActive!==void 0&&(t.picking_uActive=!!r.pickingActive,t.picking_uAttribute=!!r.pickingAttribute),t}const aj={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:oj},AI=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,lj={};function cj(r){const{ambient:t=.35,diffuse:e=.6,shininess:n=32,specularColor:i=[30,30,30]}=r;return{lighting_uAmbient:t,lighting_uDiffuse:e,lighting_uShininess:n,lighting_uSpecularColor:i.map(s=>s/255)}}function hI(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:lj;if(!("material"in r))return{};const{material:t}=r;return t?cj(t):{lighting_uEnabled:!1}}const uj={name:"gouraud-lighting",dependencies:[Vb],vs:AI,defines:{LIGHTING_VERTEX:1},getUniforms:hI},Aj={name:"phong-lighting",dependencies:[Vb],fs:AI,defines:{LIGHTING_FRAGMENT:1},getUniforms:hI},Gb={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[Vb]},hj={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class pg{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new pg(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:e="",fs:n="",defines:i={},inject:s={},varyings:a=[],bufferMode:o=35981,transpileToGLSL100:h=!1}=t,f=this._getModuleList(t.modules),m=this._getHash(e),b=this._getHash(n),x=f.map(X=>this._getHash(X.name)).sort(),B=a.map(X=>this._getHash(X)),P=Object.keys(i).sort(),R=Object.keys(s).sort(),Q=[],z=[];for(const X of P)Q.push(this._getHash(X)),Q.push(this._getHash(i[X]));for(const X of R)z.push(this._getHash(X)),z.push(this._getHash(s[X]));const G="".concat(m,"/").concat(b,"D").concat(Q.join("/"),"M").concat(x.join("/"),"I").concat(z.join("/"),"V").concat(B.join("/"),"H").concat(this.stateHash,"B").concat(o).concat(h?"T":"");if(!this._programCache[G]){const X=bV(this.gl,{vs:e,fs:n,modules:f,inject:s,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:h});this._programCache[G]=new y5(this.gl,{hash:G,vs:X.vs,fs:X.fs,varyings:a,bufferMode:o}),this._getUniforms[G]=X.getUniforms||(et=>{}),this._useCounts[G]=0}return this._useCounts[G]++,this._programCache[G]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,this._useCounts[e]===0&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),n={};let i=0;for(let s=0,a=this._defaultModules.length;s<a;++s){const o=this._defaultModules[s],h=o.name;e[i++]=o,n[h]=!0}for(let s=0,a=t.length;s<a;++s){const o=t[s],h=o.name;n[h]||(e[i++]=o,n[h]=!0)}return e.length=i,e}}const dj={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function fj(r,t,e){const n={};let i=t.indices;for(const s in t.attributes){const a=t.attributes[s],o=pj(s);if(s==="indices")i=a;else if(a.constant)n[o]=a.value;else{const h=a.value,f={...a};delete f.value,n[o]=[new si(r,h),f],gj(s,f)}}if(i){const s=i.value||i;sr(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};n.indices=[new si(r,{data:s,target:34963}),a]}return n}function pj(r,t){const{attributeMap:e=dj}={};return e&&e[r]||r}function gj(r,t){let e;switch(r){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break}switch(e){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}sr(Number.isFinite(t.size),"attribute ".concat(r," needs size"))}const sf=2,mj=1e4,yj="Model needs drawMode and vertexCount",dI=()=>{},_j={};class of{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:n=Nu("model")}=e;sr(B0(t)),this.id=n,this.gl=t,this.id=e.id||Nu("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||pg.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:h,bufferMode:f,transpileToGLSL100:m}=t;this.programProps={program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:h,bufferMode:f,transpileToGLSL100:m},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},sr(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),yj)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:h,bufferMode:f,transpileToGLSL100:m}=t;this.programProps={program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:h,bufferMode:f,transpileToGLSL100:m},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return sr(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return sr(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=fj(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Zd(t))return this;const e={};for(const n in t){const i=t[n];e[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return db(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:n,uniforms:i={},attributes:s={},transformFeedback:a=this.transformFeedback,parameters:o={},vertexArray:h=this.vertexArray}=t;this.setAttributes(s),this.updateModuleSettings(e),this.setUniforms(i);let f;wr.priority>=sf&&(f=this._logDrawCallStart(sf));const m=this.vertexArray.getDrawParams(),{isIndexed:b=m.isIndexed,indexType:x=m.indexType,indexOffset:B=m.indexOffset,vertexArrayInstanced:P=m.isInstanced}=this.props;P&&!this.isInstanced&&wr.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:R,instanceCount:Q}=this,{onBeforeRender:z=dI,onAfterRender:G=dI}=this.props;z(),this.program.setUniforms(this.uniforms);const X=this.program.draw(Object.assign(_j,t,{logPriority:f,uniforms:null,framebuffer:n,parameters:o,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:h,transformFeedback:a,isIndexed:b,indexType:x,isInstanced:R,instanceCount:Q,offset:b?B:0}));return G(),wr.priority>=sf&&this._logDrawCallEnd(f,h,n),X}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:e=!0,feedbackBuffers:n,unbindModels:i=[]}=t;let{parameters:s}=t;n&&this._setFeedbackBuffers(n),e&&(s=Object.assign({},s,{35977:e})),i.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:s}))}finally{i.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return wr.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:e}=this.programProps;if(e)this._managedProgram=!1;else{const{vs:n,fs:i,modules:s,inject:a,defines:o,varyings:h,bufferMode:f,transpileToGLSL100:m}=this.programProps;e=this.programManager.get({vs:n,fs:i,modules:s,inject:a,defines:o,varyings:h,bufferMode:f,transpileToGLSL100:m}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}sr(e instanceof y5,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new O9(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof si&&e.delete()}}_setAnimationProps(t){this.animated&&sr(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Zd(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new _5(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:mj;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),wr.group(sf,">>> DRAWING MODEL ".concat(this.id),{collapsed:wr.level<=2})(),t}_logDrawCallEnd(t,e,n,i){if(t===void 0)return;const s=k9({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:o,unusedCount:h}=v5({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:f,count:m}=v5({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});m>0&&wr.log("MISSING UNIFORMS",Object.keys(f))(),h>0&&wr.log("UNUSED UNIFORMS",Object.keys(o))();const b=H9(this.vertexArray.configuration);wr.table(t,s)(),wr.table(t,a)(),wr.table(t+1,b)(),i&&i.log({logLevel:sf,message:"Rendered to ".concat(i.id)}),wr.groupEnd(sf)()}}class vj{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:i}=e;return{attributes:Object.assign({},n,t.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],n=t?e[t]:null;return n?n instanceof si?n:n.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:e}=t,n=this.getBuffer(e);return n?n.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&sr(fn(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const s=this.feedbackMap[i];i in e&&(n[s]=i)}Object.assign(n,t.feedbackBuffers);for(const i in n){const s=n[i];if(typeof s=="string"){const a=e[s],{byteLength:o,usage:h,accessor:f}=a;n[i]=this._createNewBuffer(i,{byteLength:o,usage:h,accessor:f})}}return n}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const n=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:n})}_setupTransformFeedback(t,e){let{model:n}=e;const{program:i}=n;t.transformFeedback=new _5(this.gl,{program:i,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:n}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:e,feedbackBuffers:n})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),n=Object.assign({},t.feedbackBuffers);for(const i in this.feedbackMap){const s=this.feedbackMap[i];e[i]=t.feedbackBuffers[s],n[s]=t.sourceBuffers[i],sr(n[s]instanceof si)}return{sourceBuffers:e,feedbackBuffers:n}}_createNewBuffer(t,e){const n=new si(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}const bj="transform_uSampler_",q0="transform_uSize_",fI="transform_position";function wj(r){let{vs:t,sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=r,a=Object.keys(e).length,o=null;const h={};let f=t,m={};if(a>0||n){const b=f.split(`
`),x=b.slice();if(b.forEach((B,P,R)=>{if(a>0){const Q=Sj(B,e);if(Q){const{updatedLine:z,inject:G}=Q;x[P]=z,m=Cb([m,G]),Object.assign(h,Q.samplerTextureMap),a--}}n&&!o&&(o=Ej(B,n))}),n){sr(i);const B="".concat(q0).concat(n),P="uniform vec2 ".concat(B,`;
`),R="     vec2 ".concat(fI," = transform_getPos(").concat(B,`);
     gl_Position = vec4(`).concat(fI,`, 0, 1.);
`);m=Cb([m,{"vs:#decl":P,"vs:#main-start":R}])}f=x.join(`
`)}return{vs:f,targetTextureType:o,inject:m,samplerTextureMap:h}}function xj(r){let{sourceTextureMap:t,targetTextureVarying:e,targetTexture:n}=r;const i={};let s,a;e&&({width:s,height:a}=n,i["".concat(q0).concat(e)]=[s,a]);for(const o in t)({width:s,height:a}=t[o]),i["".concat(q0).concat(o)]=[s,a];return i}function Bj(r){return D5(r,["attribute","in"])}function Cj(r){const t="".concat(bj).concat(r),e="".concat(q0).concat(r),n="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(e,";");return{samplerName:t,sizeName:e,uniformDeclerations:n}}function Ej(r,t){const e=D5(r,["varying","out"]);return e&&e.name===t?e.type:null}function Sj(r,t){const e={},n=Bj(r);if(!n)return null;const{type:i,name:s}=n;if(s&&t[s]){const a="// ".concat(r," => Replaced by Transform with a sampler"),{samplerName:o,sizeName:h,uniformDeclerations:f}=Cj(s),m=FV(i),b="  ".concat(i," ").concat(s," = transform_getInput(").concat(o,", ").concat(h,").").concat(m,`;
`);return e[o]=s,{updatedLine:a,inject:{"vs:#decl":f,"vs:#main-start":b},samplerTextureMap:e}}return null}const Tj={10241:9728,10240:9728,10242:33071,10243:33071},Ij="transform_output";class Fj{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,sourceTextures:n,framebuffer:i,targetTexture:s}=this.bindings[this.currentIndex],a=Object.assign({},e,t.attributes),o=Object.assign({},t.uniforms),h=Object.assign({},t.parameters);let f=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const b in this.samplerTextureMap){const x=this.samplerTextureMap[b];o[b]=n[x]}this._setSourceTextureParameters();const m=xj({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(o,m)}return this.hasTargetTexture&&(f=!1,h.viewport=[0,0,i.width,i.height]),{attributes:a,framebuffer:i,uniforms:o,discard:f,parameters:h}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],n=E0(e);if(!t)return n;const i=n.constructor,s=LV(this.targetTextureType),a=new i(n.length*s/4);let o=0;for(let h=0;h<n.length;h+=4)for(let f=0;f<s;f++)a[o++]=n[h+f];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:n}=t;this._swapTexture=n,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:n}=t;if(n instanceof Ma)return n;const i=e[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:n={},_targetTexture:i}=t,s=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:n,targetTexture:s}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((n,i,s)=>{s[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new si(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:e,targetTexture:n}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:e,targetTexture:n})}}_updateBinding(t,e){const{sourceBuffers:n,sourceTextures:i,targetTexture:s}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,i),Object.assign(t.sourceBuffers,n),s){t.targetTexture=s;const{width:a,height:o}=s,{framebuffer:h}=t;h?(h.update({attachments:{36064:s},resizeAttachments:!1}),h.resize({width:a,height:o})):t.framebuffer=new bs(this.gl,{id:"transform-framebuffer",width:a,height:o,attachments:{36064:s}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const n in e)e[n].setParameters(Tj)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;const n=t.sourceTextures[this._swapTexture];return{sourceTextures:e,targetTexture:n}}_createNewTexture(t){const e=C7(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:e,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:s,targetTextureType:a,inject:o,samplerTextureMap:h}=wj({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),f=Cb([t.inject||{},o]);this.targetTextureType=a,this.samplerTextureMap=h;const m=t._fs||N5({version:A5(i),input:this.targetTextureVarying,inputType:a,output:Ij}),b=this.hasSourceTextures||this.targetTextureVarying?[hj].concat(t.modules||[]):t.modules;return{vs:i,fs:m,modules:b,uniforms:s,inject:f}}}class jb{static isSupported(t){return fn(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:n}=this;t&&t.delete(),e&&e.delete(),n&&n.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:e=!0}=t,n=this._updateDrawOptions(t);e&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)t=t||n.swap();sr(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e){const i=n.getData(t);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)n.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new of(e,Object.assign({},t,{fs:t.fs||N5({version:A5(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=i.updateModelProps(e);return e}_buildResourceTransforms(t,e){Lj(e)&&(this.bufferTransform=new vj(t,e)),Pj(e)&&(this.textureTransform=new Fj(t,e)),sr(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=Object.assign(e,i.getDrawOptions(e));return e}}function Lj(r){return!!(!Zd(r.feedbackBuffers)||!Zd(r.feedbackMap)||r.varyings&&r.varyings.length>0)}function Pj(r){return!!(!Zd(r._sourceTextures)||r._targetTexture||r._targetTextureVarying)}const pI={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class gg{static get DRAW_MODE(){return pI}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e=Nu("geometry"),drawMode:n=pI.TRIANGLES,attributes:i={},indices:s=null,vertexCount:a=null}=t;this.id=e,this.drawMode=n|0,this.attributes={},this.userData={},this._setAttributes(i,s),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const n in t){let i=t[n];i=ArrayBuffer.isView(i)?{value:i}:i,sr(ArrayBuffer.isView(i.value),"".concat(this._print(n),": must be typed array or object with value as typed array")),(n==="POSITION"||n==="positions")&&!i.size&&(i.size=3),n==="indices"?(sr(!this.indices),this.indices=i):this.attributes[n]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const i in t){const s=t[i],{value:a,size:o,constant:h}=s;!h&&a&&o>=1&&(n=Math.min(n,a.length/o))}return sr(Number.isFinite(n)),n}}let Mj=1,Uj=1;class gI{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=t,a=Mj++,o={time:0,delay:e,duration:n,rate:i,repeat:s};return this._setChannelTime(o,this.time),this.channels.set(a,o),a}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const i of e)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:s,channel:a}=i;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=Uj++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay,i=t.duration*t.repeat;n>=i?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}const Rj=[255,255,255],Oj=1;let Dj=0;class mI{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};W(this,"id",void 0),W(this,"color",void 0),W(this,"intensity",void 0),W(this,"type","ambient");const{color:e=Rj}=t,{intensity:n=Oj}=t;this.id=t.id||"ambient-".concat(Dj++),this.color=e,this.intensity=n}}const Nj=[255,255,255],kj=1,Qj=[0,0,-1];let Hj=0;class yI{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};W(this,"id",void 0),W(this,"color",void 0),W(this,"intensity",void 0),W(this,"type","directional"),W(this,"direction",void 0),W(this,"shadow",void 0);const{color:e=Nj}=t,{intensity:n=kj}=t,{direction:i=Qj}=t,{_shadow:s=!1}=t;this.id=t.id||"directional-".concat(Hj++),this.color=e,this.intensity=n,this.type="directional",this.direction=new ce(i).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class zj{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};W(this,"id",void 0),W(this,"gl",void 0),W(this,"props",void 0);const{id:n}=e;this.id=n,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class qb extends zj{constructor(){super(...arguments),W(this,"_lastRenderIndex",-1)}render(t){const e=this.gl;return Du(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:n,viewports:i,views:s,onViewportActive:a,clearStack:o=!0,clearCanvas:h=!0}=t;t.pass=t.pass||"unknown";const f=this.gl;h&&Gj(f,e),o&&(this._lastRenderIndex=-1);const m=[];for(const b of i){const x=s&&s[b.id];a==null||a(b);const B=this._getDrawLayerParams(b,t),P=b.subViewports||[b];for(const R of P){const Q=this._drawLayersInViewport(f,{target:e,moduleParameters:n,viewport:R,view:x,pass:t.pass,layers:t.layers},B);m.push(Q)}}return m}_getDrawLayerParams(t,e){let{layers:n,pass:i,isPicking:s=!1,layerFilter:a,cullRect:o,effects:h,moduleParameters:f}=e,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const b=[],x=_I(this._lastRenderIndex+1),B={layer:n[0],viewport:t,isPicking:s,renderPass:i,cullRect:o},P={};for(let R=0;R<n.length;R++){const Q=n[R],z=this._shouldDrawLayer(Q,B,a,P),G={shouldDrawLayer:z};z&&!m&&(G.layerRenderIndex=x(Q,z),G.moduleParameters=this._getModuleParameters(Q,h,i,f),G.layerParameters=this.getLayerParameters(Q,R,t)),b[R]=G}return b}_drawLayersInViewport(t,e,n){let{layers:i,moduleParameters:s,pass:a,target:o,viewport:h,view:f}=e;const m=Vj(t,{moduleParameters:s,target:o,viewport:h});if(f&&f.props.clear){const x=f.props.clear===!0?{color:!0,depth:!0}:f.props.clear;tc(t,{scissorTest:!0,scissor:m},()=>db(t,x))}const b={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};Du(t,{viewport:m});for(let x=0;x<i.length;x++){const B=i[x],{shouldDrawLayer:P,layerRenderIndex:R,moduleParameters:Q,layerParameters:z}=n[x];if(P&&B.props.pickable&&b.pickableCount++,B.isComposite)b.compositeCount++;else if(P){b.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,R),Q.viewport=h;try{B._drawLayer({moduleParameters:Q,uniforms:{layerIndex:R},parameters:z})}catch(G){B.raiseError(G,"drawing ".concat(B," to ").concat(a))}}}return b}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,n){return t.props.parameters}_shouldDrawLayer(t,e,n,i){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let a=t.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(e))return!1;e.layer=a,a=a.parent}if(n){const o=e.layer.id;if(o in i||(i[o]=n(e)),!i[o])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,n,i){var s;const a=Object.assign(Object.create(((s=t.internalState)===null||s===void 0?void 0:s.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Yd(this.gl)});if(e)for(const h of e){var o;Object.assign(a,(o=h.getModuleParameters)===null||o===void 0?void 0:o.call(h,t))}return Object.assign(a,this.getModuleParameters(t,e),i)}}function _I(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={},n=(i,s)=>{const a=i.props._offset,o=i.id,h=i.parent&&i.parent.id;let f;if(h&&!(h in t)&&n(i.parent,!1),h in e){const m=e[h]=e[h]||_I(t[h],t);f=m(i,s),e[o]=m}else Number.isFinite(a)?(f=a+(t[h]||0),e[o]=null):f=r;return s&&f>=r&&(r=f+1),t[o]=f,f};return n}function Vj(r,t){let{moduleParameters:e,target:n,viewport:i}=t;const s=n&&n.id!=="default-framebuffer",a=e&&e.devicePixelRatio||Yd(r),o=s?n.height:r.drawingBufferHeight,h=i;return[h.x*a,o-(h.y+h.height)*a,h.width*a,h.height*a]}function Gj(r,t){const e=t?t.width:r.drawingBufferWidth,n=t?t.height:r.drawingBufferHeight;Du(r,{viewport:[0,0,e,n]}),r.clear(16640)}class jj extends qb{constructor(t,e){super(t,e),W(this,"shadowMap",void 0),W(this,"depthBuffer",void 0),W(this,"fbo",void 0),this.shadowMap=new Ma(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new rf(t,{format:33189,width:1,height:1}),this.fbo=new bs(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;tc(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const n=t.viewports[0],i=Yd(this.gl),s=n.width*i,a=n.height*i;(s!==e.width||a!==e.height)&&e.resize({width:s,height:a}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const vI="#define SMOOTH_EDGE_RADIUS 0.5",qj=`
`.concat(vI,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),Kj=`
`.concat(vI,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),Wj={name:"geometry",vs:qj,fs:Kj},$j=Object.keys(xn).map(r=>"const int COORDINATE_SYSTEM_".concat(r," = ").concat(xn[r],";")).join(""),Xj=Object.keys(zc).map(r=>"const int PROJECTION_MODE_".concat(r," = ").concat(zc[r],";")).join(""),Jj=Object.keys(eb).map(r=>"const int UNIT_".concat(r.toUpperCase()," = ").concat(eb[r],";")).join(""),Yj="".concat($j,`
`).concat(Xj,`
`).concat(Jj,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function Zj(r,t){if(r===t)return!0;if(Array.isArray(r)){const e=r.length;if(!t||t.length!==e)return!1;for(let n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}return!1}function mg(r){let t={},e;return n=>{for(const i in n)if(!Zj(n[i],t[i])){e=r(n),t=n;break}return e}}const bI=[0,0,0,0],tq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],wI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],eq=[0,0,0],xI=[0,0,0],rq=mg(sq);function BI(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:xI;e.length<3&&(e=[e[0],e[1],0]);let n=e,i,s=!0;switch(t===xn.LNGLAT_OFFSETS||t===xn.METER_OFFSETS?i=e:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case zc.WEB_MERCATOR:(t===xn.LNGLAT||t===xn.CARTESIAN)&&(i=[0,0,0],s=!1);break;case zc.WEB_MERCATOR_AUTO_OFFSET:t===xn.LNGLAT?n=i:t===xn.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case zc.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case zc.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:s}}function nq(r,t,e){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:s,viewProjectionMatrix:a}=r,o=bI,h=bI,f=r.cameraPosition;const{geospatialOrigin:m,shaderCoordinateOrigin:b,offsetMode:x}=BI(r,t,e);return x&&(h=r.projectPosition(m||b),f=[f[0]-h[0],f[1]-h[1],f[2]-h[2]],h[3]=1,o=hg([],h,a),s=n||s,a=Hh([],i,s),a=Hh([],a,tq)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:h,cameraPosCommon:f,shaderCoordinateOrigin:b,geospatialOrigin:m}}function iq(r){let{viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=xn.DEFAULT,coordinateOrigin:s=xI,autoWrapLongitude:a=!1}=r;i===xn.DEFAULT&&(i=t.isGeospatial?xn.LNGLAT:xn.CARTESIAN);const o=rq({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return o.project_uWrapLongitude=a,o.project_uModelMatrix=n||wI,o}function sq(r){let{viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}=r;const{projectionCenter:s,viewProjectionMatrix:a,originCommon:o,cameraPosCommon:h,shaderCoordinateOrigin:f,geospatialOrigin:m}=nq(t,n,i),b=t.getDistanceScales(),x=[t.width*e,t.height*e],B=hg([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,P={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:f,project_uCommonOrigin:o.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:x,project_uDevicePixelRatio:e,project_uFocalDistance:B,project_uCommonUnitsPerMeter:b.unitsPerMeter,project_uCommonUnitsPerWorldUnit:b.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:eq,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:wI,project_uCameraPosition:h};if(m){const R=t.getDistanceScales(m);switch(n){case xn.METER_OFFSETS:P.project_uCommonUnitsPerWorldUnit=R.unitsPerMeter,P.project_uCommonUnitsPerWorldUnit2=R.unitsPerMeter2;break;case xn.LNGLAT:case xn.LNGLAT_OFFSETS:t._pseudoMeters||(P.project_uCommonUnitsPerMeter=R.unitsPerMeter),P.project_uCommonUnitsPerWorldUnit=R.unitsPerDegree,P.project_uCommonUnitsPerWorldUnit2=R.unitsPerDegree2;break;case xn.CARTESIAN:P.project_uCommonUnitsPerWorldUnit=[1,1,R.unitsPerMeter[2]],P.project_uCommonUnitsPerWorldUnit2=[0,0,R.unitsPerMeter2[2]];break}}return P}const oq={};function aq(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oq;return"viewport"in r?iq(r):{}}const Kb={name:"project",dependencies:[MV,Wj],vs:Yj,getUniforms:aq};function lq(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function af(r,t){const e=hg([],t,r);return rI(e,e,1/e[3]),e}function CI(r,t){const e=r%t;return e<0?t+e:e}function Wb(r,t,e){return r<t?t:r>e?e:r}function cq(r){return Math.log(r)*Math.LOG2E}const $b=Math.log2||cq;function Vu(r,t){if(!r)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const ic=Math.PI,EI=ic/4,gl=ic/180,Xb=180/ic,lf=512,K0=4003e4,W0=85.051129,uq=1.5;function Aq(r){return $b(r)}function yg(r){const[t,e]=r;Vu(Number.isFinite(t)),Vu(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*gl,i=e*gl,s=lf*(n+ic)/(2*ic),a=lf*(ic+Math.log(Math.tan(EI+i*.5)))/(2*ic);return[s,a]}function cf(r){const[t,e]=r,n=t/lf*(2*ic)-ic,i=2*(Math.atan(Math.exp(e/lf*(2*ic)-ic))-EI);return[n*Xb,i*Xb]}function hq(r){const{latitude:t}=r;Vu(Number.isFinite(t));const e=Math.cos(t*gl);return Aq(K0*e)-9}function $0(r){const t=Math.cos(r*gl);return lf/K0/t}function Jb(r){const{latitude:t,longitude:e,highPrecision:n=!1}=r;Vu(Number.isFinite(t)&&Number.isFinite(e));const i=lf,s=Math.cos(t*gl),a=i/360,o=a/s,h=i/K0/s,f={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[a,o,h],degreesPerUnit:[1/a,1/o,1/h]};if(n){const m=gl*Math.tan(t*gl)/s,b=a*m/2,x=i/K0*m,B=x/o*h;f.unitsPerDegree2=[0,b,x],f.unitsPerMeter2=[B,0,B]}return f}function SI(r,t){const[e,n,i]=r,[s,a,o]=t,{unitsPerMeter:h,unitsPerMeter2:f}=Jb({longitude:e,latitude:n,highPrecision:!0}),m=yg(r);m[0]+=s*(h[0]+f[0]*a),m[1]+=a*(h[1]+f[1]*a);const b=cf(m),x=(i||0)+(o||0);return Number.isFinite(i)||Number.isFinite(o)?[b[0],b[1],x]:b}function dq(r){const{height:t,pitch:e,bearing:n,altitude:i,scale:s,center:a}=r,o=lq();z0(o,o,[0,0,-i]),tI(o,o,-e*gl),eI(o,o,n*gl);const h=s/t;return Nb(o,o,[h,h,h]),a&&z0(o,o,JV([],a)),o}function fq(r){const{width:t,height:e,altitude:n,pitch:i=0,offset:s,center:a,scale:o,nearZMultiplier:h=1,farZMultiplier:f=1}=r;let{fovy:m=X0(uq)}=r;n!==void 0&&(m=X0(n));const b=m*gl,x=i*gl,B=TI(m);let P=B;a&&(P+=a[2]*o/Math.cos(x)/e);const R=b*(.5+(s?s[1]:0)/e),Q=Math.sin(R)*P/Math.sin(Wb(Math.PI/2-x-R,.01,Math.PI-.01)),z=Math.sin(x)*Q+P,G=P*10,X=Math.min(z*f,G);return{fov:b,aspect:t/e,focalDistance:B,near:h,far:X}}function X0(r){return 2*Math.atan(.5/r)*Xb}function TI(r){return .5/Math.tan(.5*r*gl)}function II(r,t){const[e,n,i=0]=r;return Vu(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i)),af(t,[e,n,i,1])}function Yb(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[n,i,s]=r;if(Vu(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return af(t,[n,i,s,1]);const a=af(t,[n,i,0,1]),o=af(t,[n,i,1,1]),h=a[2],f=o[2],m=h===f?0:((e||0)-h)/(f-h);return Q5([],a,o,m)}function pq(r){const{width:t,height:e,bounds:n,minExtent:i=0,maxZoom:s=24,offset:a=[0,0]}=r,[[o,h],[f,m]]=n,b=gq(r.padding),x=yg([o,Wb(m,-W0,W0)]),B=yg([f,Wb(h,-W0,W0)]),P=[Math.max(Math.abs(B[0]-x[0]),i),Math.max(Math.abs(B[1]-x[1]),i)],R=[t-b.left-b.right-Math.abs(a[0])*2,e-b.top-b.bottom-Math.abs(a[1])*2];Vu(R[0]>0&&R[1]>0);const Q=R[0]/P[0],z=R[1]/P[1],G=(b.right-b.left)/2/Q,X=(b.top-b.bottom)/2/z,et=[(B[0]+x[0])/2+G,(B[1]+x[1])/2+X],pt=cf(et),gt=Math.min(s,$b(Math.abs(Math.min(Q,z))));return Vu(Number.isFinite(gt)),{longitude:pt[0],latitude:pt[1],zoom:gt}}function gq(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(Vu(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const FI=Math.PI/180;function mq(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:e,height:n,unproject:i}=r,s={targetZ:t},a=i([0,n],s),o=i([e,n],s);let h,f;const m=r.fovy?.5*r.fovy*FI:Math.atan(.5/r.altitude),b=(90-r.pitch)*FI;return m>b-.01?(h=LI(r,0,t),f=LI(r,e,t)):(h=i([0,0],s),f=i([e,0],s)),[a,o,f,h]}function LI(r,t,e){const{pixelUnprojectionMatrix:n}=r,i=af(n,[t,0,1,1]),s=af(n,[t,r.height,1,1]),o=(e*r.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),h=Q5([],i,s,o),f=cf(h);return f.push(e),f}const PI=512;function yq(r){const{width:t,height:e,pitch:n=0}=r;let{longitude:i,latitude:s,zoom:a,bearing:o=0}=r;(i<-180||i>180)&&(i=CI(i+180,360)-180),(o<-180||o>180)&&(o=CI(o+180,360)-180);const h=$b(e/PI);if(a<=h)a=h,s=0;else{const f=e/2/Math.pow(2,a),m=cf([0,f])[1];if(s<m)s=m;else{const b=cf([0,PI-f])[1];s>b&&(s=b)}}return{width:t,height:e,longitude:i,latitude:s,zoom:a,pitch:n,bearing:o}}const _q=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,vq=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,bq=mg(Eq),wq=mg(Sq),xq=[0,0,0,1],Bq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Cq(r,t){const[e,n,i]=r,s=Yb([e,n,i],t);return Number.isFinite(i)?s:[s[0],s[1],0]}function Eq(r){let{viewport:t,center:e}=r;return new wn(t.viewProjectionMatrix).invert().transform(e)}function Sq(r){let{viewport:t,shadowMatrices:e}=r;const n=[],i=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,a=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>Cq(o,i));for(const o of e){const h=o.clone().translate(new ce(t.center).negate()),f=a.map(b=>h.transform(b)),m=new wn().ortho({left:Math.min(...f.map(b=>b[0])),right:Math.max(...f.map(b=>b[0])),bottom:Math.min(...f.map(b=>b[1])),top:Math.max(...f.map(b=>b[1])),near:Math.min(...f.map(b=>-b[2])),far:Math.max(...f.map(b=>-b[2]))});n.push(m.multiplyRight(o))}return n}function Tq(r,t){const{shadowEnabled:e=!0}=r;if(!e||!r.shadowMatrices||!r.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const n={shadow_uDrawShadowMap:!!r.drawToShadowMap,shadow_uUseShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,shadow_uColor:r.shadowColor||xq,shadow_uLightId:r.shadowLightId||0,shadow_uLightCount:r.shadowMatrices.length},i=bq({viewport:r.viewport,center:t.project_uCenter}),s=[],a=wq({shadowMatrices:r.shadowMatrices,viewport:r.viewport}).slice();for(let o=0;o<r.shadowMatrices.length;o++){const h=a[o],f=h.clone().translate(new ce(r.viewport.center).negate());t.project_uCoordinateSystem===xn.LNGLAT&&t.project_uProjectionMode===zc.WEB_MERCATOR?(a[o]=f,s[o]=i):(a[o]=h.clone().multiplyRight(Bq),s[o]=f.transform(i))}for(let o=0;o<a.length;o++)n["shadow_uViewProjectionMatrices[".concat(o,"]")]=a[o],n["shadow_uProjectCenters[".concat(o,"]")]=s[o],r.shadowMaps&&r.shadowMaps.length>0?n["shadow_uShadowMap".concat(o)]=r.shadowMaps[o]:n["shadow_uShadowMap".concat(o)]=r.dummyShadowMap;return n}const Zb={name:"shadow",dependencies:[Kb],vs:_q,fs:vq,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?Tq(r,t):{}}},Iq={color:[255,255,255],intensity:1},MI=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Fq=[0,0,0,200/255];class tw{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};W(this,"id","lighting-effect"),W(this,"props",void 0),W(this,"shadowColor",Fq),W(this,"shadow",void 0),W(this,"ambientLight",void 0),W(this,"directionalLights",void 0),W(this,"pointLights",void 0),W(this,"shadowPasses",[]),W(this,"shadowMaps",[]),W(this,"dummyShadowMap",null),W(this,"programManager",void 0),W(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.props=t}preRender(t,e){let{layers:n,layerFilter:i,viewports:s,onViewportActive:a,views:o}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=pg.getDefaultProgramManager(t),Zb&&this.programManager.addDefaultModule(Zb)),this.dummyShadowMap||(this.dummyShadowMap=new Ma(t,{width:1,height:1}));for(let h=0;h<this.shadowPasses.length;h++)this.shadowPasses[h].render({layers:n,layerFilter:i,viewports:s,onViewportActive:a,views:o,moduleParameters:{shadowLightId:h,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:t})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Zb),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const n=new wn().lookAt({eye:new ce(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new jj(t);this.shadowPasses[e]=n,this.shadowMaps[e]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;!t&&e.length===0&&n.length===0&&(this.ambientLight=new mI(Iq),this.directionalLights.push(new yI(MI[0]),new yI(MI[1])))}}class Lq{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};W(this,"_pool",[]),W(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,n){let{size:i=1,type:s,padding:a=0,copy:o=!1,initialize:h=!1,maxCount:f}=n;const m=s||t&&t.constructor||Float32Array,b=e*i+a;if(ArrayBuffer.isView(t)){if(b<=t.length)return t;if(b*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new m(t.buffer,0,b)}let x=1/0;f&&(x=f*i+a);const B=this._allocate(m,b,h,x);return t&&o?B.set(t):h||B.fill(0,0,4),this._release(t),B}release(t){this._release(t)}_allocate(t,e,n,i){let s=Math.max(Math.ceil(e*this.opts.overAlloc),1);s>i&&(s=i);const a=this._pool,o=t.BYTES_PER_ELEMENT*s,h=a.findIndex(f=>f.byteLength>=o);if(h>=0){const f=new t(a.splice(h,1)[0],0,s);return n&&f.fill(0),f}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:i}=n,s=e.findIndex(a=>a.byteLength>=i);s<0?e.push(n):(s>0||e.length<this.opts.poolSize)&&e.splice(s,0,n),e.length>this.opts.poolSize&&e.shift()}}const _g=new Lq;function vg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Pq(r){return[r[12],r[13],r[14]]}function Mq(r){return{left:uf(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:uf(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:uf(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:uf(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:uf(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:uf(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const UI=new ce;function uf(r,t,e,n){UI.set(r,t,e);const i=UI.len();return{distance:n/i,normal:new ce(-r/i,-t/i,-e/i)}}function Uq(r){return r-Math.fround(r)}let bg;function ew(r,t){const{size:e=1,startIndex:n=0}=t,i=t.endIndex!==void 0?t.endIndex:r.length,s=(i-n)/e;bg=_g.allocate(bg,s,{type:Float32Array,size:e*2});let a=n,o=0;for(;a<i;){for(let h=0;h<e;h++){const f=r[a++];bg[o+h]=f,bg[o+h+e]=Uq(f)}o+=e*2}return bg.subarray(0,s*e*2)}function Rq(r){let t=null,e=!1;for(const n of r)n&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const Oq=Math.PI/180,Dq=vg(),RI=[0,0,0],Nq={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function kq(r){let{width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:s,padding:a,near:o,far:h}=r;const f=t/e,m=n?new wn().orthographic({fovy:i,aspect:f,focalDistance:s,near:o,far:h}):new wn().perspective({fovy:i,aspect:f,near:o,far:h});if(a){const{left:b=0,right:x=0,top:B=0,bottom:P=0}=a,R=zu((b+t-x)/2,0,t)-t/2,Q=zu((B+e-P)/2,0,e)-e/2;m[8]-=R*2/t,m[9]+=Q*2/e}return m}class Af{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};W(this,"id",void 0),W(this,"x",void 0),W(this,"y",void 0),W(this,"width",void 0),W(this,"height",void 0),W(this,"padding",void 0),W(this,"isGeospatial",void 0),W(this,"zoom",void 0),W(this,"focalDistance",void 0),W(this,"position",void 0),W(this,"modelMatrix",void 0),W(this,"distanceScales",void 0),W(this,"scale",void 0),W(this,"center",void 0),W(this,"cameraPosition",void 0),W(this,"projectionMatrix",void 0),W(this,"viewMatrix",void 0),W(this,"viewMatrixUncentered",void 0),W(this,"viewMatrixInverse",void 0),W(this,"viewProjectionMatrix",void 0),W(this,"pixelProjectionMatrix",void 0),W(this,"pixelUnprojectionMatrix",void 0),W(this,"resolution",void 0),W(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||Nq,this.focalDistance=t.focalDistance||1,this.position=t.position||RI,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?zc.WEB_MERCATOR:zc.WEB_MERCATOR_AUTO_OFFSET:zc.IDENTITY}equals(t){return t instanceof Af?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&rc(t.projectionMatrix,this.projectionMatrix)&&rc(t.viewMatrix,this.viewMatrix):!1}project(t){let{topLeft:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=this.projectPosition(t),i=II(n,this.pixelProjectionMatrix),[s,a]=i,o=e?a:this.height-a;return t.length===2?[s,o]:[s,o,i[2]]}unproject(t){let{topLeft:e=!0,targetZ:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[i,s,a]=t,o=e?s:this.height-s,h=n&&n*this.distanceScales.unitsPerMeter[2],f=Yb([i,o,a],this.pixelUnprojectionMatrix,h),[m,b,x]=this.unprojectPosition(f);return Number.isFinite(a)?[m,b,x]:Number.isFinite(n)?[m,b,n]:[m,b]}projectPosition(t){const[e,n]=this.projectFlat(t),i=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,n,i]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t),i=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,n,i]}projectFlat(t){if(this.isGeospatial){const e=yg(t);return e[1]=zu(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?cf(t):t}getBounds(){const e={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},n=this.unproject([0,0],e),i=this.unproject([this.width,0],e),s=this.unproject([0,this.height],e),a=this.unproject([this.width,this.height],e);return[Math.min(n[0],i[0],s[0],a[0]),Math.min(n[1],i[1],s[1],a[1]),Math.max(n[0],i[0],s[0],a[0]),Math.max(n[1],i[1],s[1],a[1])]}getDistanceScales(t){return t?Jb({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:e,y:n,width:i=1,height:s=1}=t;return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Mq(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=hq({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Jb({latitude:n,longitude:e}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:a}=t;let o=RI;if(s&&(o=a?new wn(a).transformAsVector(s,[]):s),this.isGeospatial){const h=this.projectPosition([e,n,0]);this.center=new ce(o).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(o)}_initMatrices(t){const{viewMatrix:e=Dq,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:h=1e3,padding:f=null,focalDistance:m=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new wn().multiplyRight(e).translate(new ce(this.center).negate()),this.projectionMatrix=n||kq({width:this.width,height:this.height,orthographic:i,fovyRadians:s||a*Oq,focalDistance:m,padding:f,near:o,far:h});const b=vg();Hh(b,b,this.projectionMatrix),Hh(b,b,this.viewMatrix),this.viewProjectionMatrix=b,this.viewMatrixInverse=Db([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Pq(this.viewMatrixInverse);const x=vg(),B=vg();Nb(x,x,[this.width/2,-this.height/2,1]),z0(x,x,[1,-1,0]),Hh(B,x,this.viewProjectionMatrix),this.pixelProjectionMatrix=B,this.pixelUnprojectionMatrix=Db(vg(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Bn.warn("Pixel project matrix not invertible")()}}W(Af,"displayName","Viewport");class zh extends Af{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:e=0,longitude:n=0,zoom:i=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:h=1.01,nearZ:f,farZ:m,orthographic:b=!1,projectionMatrix:x,repeat:B=!1,worldOffset:P=0,position:R,padding:Q,legacyMeterSizes:z=!1}=t;let{width:G,height:X,altitude:et=1.5}=t;const pt=Math.pow(2,i);G=G||1,X=X||1;let gt,mt=null;if(x)et=x[5]/2,gt=X0(et);else{t.fovy?(gt=t.fovy,et=TI(gt)):gt=X0(et);let Mt;if(Q){const{top:Lt=0,bottom:at=0}=Q;Mt=[0,zu((Lt+X-at)/2,0,X)-X/2]}mt=fq({width:G,height:X,scale:pt,center:R&&[0,0,R[2]*$0(e)],offset:Mt,pitch:s,fovy:gt,nearZMultiplier:o,farZMultiplier:h}),Number.isFinite(f)&&(mt.near=f),Number.isFinite(m)&&(mt.far=m)}let ft=dq({height:X,pitch:s,bearing:a,scale:pt,altitude:et});P&&(ft=new wn().translate([512*P,0,0]).multiplyLeft(ft)),super({...t,width:G,height:X,viewMatrix:ft,longitude:n,latitude:e,zoom:i,...mt,fovy:gt,focalDistance:et}),W(this,"longitude",void 0),W(this,"latitude",void 0),W(this,"pitch",void 0),W(this,"bearing",void 0),W(this,"altitude",void 0),W(this,"fovy",void 0),W(this,"orthographic",void 0),W(this,"_subViewports",void 0),W(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=n,this.zoom=i,this.pitch=s,this.bearing=a,this.altitude=et,this.fovy=gt,this.orthographic=b,this._subViewports=B?[]:null,this._pseudoMeters=z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let i=e;i<=n;i++){const s=i?new zh({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t),i=(t[2]||0)*$0(t[1]);return[e,n,i]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t),i=(t[2]||0)/$0(n);return[e,n,i]}addMetersToLngLat(t,e){return SI(t,e)}panByPosition(t,e){const n=Yb(e,this.pixelUnprojectionMatrix),i=this.projectFlat(t),s=k5([],i,jV([],n)),a=k5([],this.center,s),[o,h]=this.unprojectFlat(a);return{longitude:o,latitude:h}}getBounds(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=mq(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:n,height:i}=this,{longitude:s,latitude:a,zoom:o}=pq({width:n,height:i,bounds:t,...e});return new zh({width:n,height:i,longitude:s,latitude:a,zoom:o})}}W(zh,"displayName","WebMercatorViewport");const OI=[0,0,0];function rw(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=t.projectPosition(r);if(e&&t instanceof zh){const[i,s,a=0]=r,o=t.getDistanceScales([i,s]);n[2]=a*o.unitsPerMeter[2]}return n}function Qq(r){const{viewport:t,modelMatrix:e,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:a}=r;return i===xn.DEFAULT&&(i=t.isGeospatial?xn.LNGLAT:xn.CARTESIAN),s===void 0&&(s=i),a===void 0&&(a=n),{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function DI(r,t){let{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}=t,[o,h,f=0]=r;switch(n&&([o,h,f]=hg([],[o,h,f,1],n)),i){case xn.LNGLAT:return rw([o,h,f],e,a);case xn.LNGLAT_OFFSETS:return rw([o+s[0],h+s[1],f+(s[2]||0)],e,a);case xn.METER_OFFSETS:return rw(SI(s,[o,h,f]),e,a);case xn.CARTESIAN:default:return e.isGeospatial?[o+s[0],h+s[1],f+s[2]]:e.projectPosition([o,h,f])}}function Hq(r,t){const{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=Qq(t),{autoOffset:h=!0}=t,{geospatialOrigin:f=OI,shaderCoordinateOrigin:m=OI,offsetMode:b=!1}=h?BI(e,n,i):{},x=DI(r,{viewport:e,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:b});if(b){const B=e.projectPosition(f||m);nG(x,x,B)}return x}const NI={blendFunc:[1,0,32771,0],blendEquation:32774};class kI extends qb{constructor(){super(...arguments),W(this,"pickZ",void 0),W(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:a,pickingFBO:o,deviceRect:{x:h,y:f,width:m,height:b},cullRect:x,effects:B,pass:P="picking",pickZ:R,moduleParameters:Q}=t;const z=this.gl;this.pickZ=R;const G=this._resetColorEncoder(R),X=tc(z,{scissorTest:!0,scissor:[h,f,m,b],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...NI,blend:!R},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:a,cullRect:x,effects:B==null?void 0:B.filter(pt=>pt.useInPicking),pass:P,isPicking:!0,moduleParameters:Q}));return this._colorEncoderState=null,{decodePickingColor:G&&Vq.bind(null,G),stats:X}}shouldDrawLayer(t){const{pickable:e,operation:n}=t.props;return e&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,n){const i={...t.props.parameters},{pickable:s,operation:a}=t.props;return this._colorEncoderState?s&&a.includes("draw")&&(Object.assign(i,NI),i.blend=!0,i.blendColor=zq(this._colorEncoderState,t,n)):i.blend=!1,a.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function zq(r,t,e){const{byLayer:n,byAlpha:i}=r;let s,a=n.get(t);return a?(a.viewports.push(e),s=a.a):(s=n.size+1,s<=255?(a={a:s,layer:t,viewports:[e]},n.set(t,a),i[s]=a):(Bn.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function Vq(r,t){const e=r.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const hf={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},J0=Symbol.for("component"),OA=Symbol.for("propTypes"),nw=Symbol.for("deprecatedProps"),df=Symbol.for("asyncPropDefaults"),Vh=Symbol.for("asyncPropOriginal"),DA=Symbol.for("asyncPropResolved");function Y0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(r)?QI(r,t,[]):t(r)?[r]:[]}function QI(r,t,e){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?QI(i,t,e):t(i)&&e.push(i)}return e}function Gq(r){let{target:t,source:e,start:n=0,count:i=1}=r;const s=e.length,a=i*s;let o=0;for(let h=n;o<s;o++)t[h++]=e[o];for(;o<a;)o<a-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+a-o),o=a);return t}class jq{constructor(t,e,n){W(this,"id",void 0),W(this,"context",void 0),W(this,"isLoaded",void 0),W(this,"persistent",void 0),W(this,"_loadCount",0),W(this,"_subscribers",new Set),W(this,"_data",void 0),W(this,"_loader",void 0),W(this,"_error",void 0),W(this,"_content",void 0),this.id=t,this.context=n,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let i=t;typeof t=="string"&&(i=FA(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class qq{constructor(t){let{gl:e,protocol:n}=t;W(this,"protocol",void 0),W(this,"_context",void 0),W(this,"_resources",void 0),W(this,"_consumers",void 0),W(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add(t){let{resourceId:e,data:n,forceUpdate:i=!1,persistent:s=!0}=t,a=this._resources[e];a?a.setData(n,i):(a=new jq(e,n,this._context),this._resources[e]=a),a.persistent=s}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:e}=t;const n=this._consumers[e];if(n){for(const i in n){const s=n[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe(t){let{resourceId:e,onChange:n,consumerId:i,requestId:s="default"}=t;const{_resources:a,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const h=a[e];if(this._track(i,s,h,n),h)return h.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,i){const s=this._consumers,a=s[t]=s[t]||{},o=a[e]||{},h=o.resourceId&&this._resources[o.resourceId];h&&(h.unsubscribe(o),this.prune()),n&&(a[e]=o,o.onChange=i,o.resourceId=n.id,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const iw={name:"project32",dependencies:[Kb],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},sw={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...aj},Kq=[Kb],Wq=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function $q(r){const t=pg.getDefaultProgramManager(r);for(const e of Kq)t.addDefaultModule(e);for(const e of Wq)t.addShaderHook(e);return t}const Xq="layerManager.setLayers",Jq="layerManager.activateViewport";class Yq{constructor(t){let{deck:e,stats:n,viewport:i,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};W(this,"layers",void 0),W(this,"context",void 0),W(this,"resourceManager",void 0),W(this,"_lastRenderedLayers",[]),W(this,"_needsRedraw",!1),W(this,"_needsUpdate",!1),W(this,"_nextLayers",null),W(this,"_debug",!1),W(this,"activateViewport",a=>{uo(Jq,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new qq({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&$q(t),stats:n||new qp({id:"deck.gl"}),viewport:i||new Af({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new gI,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(t);e=e||i}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t?this.layers.filter(e=>t.find(n=>e.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){uo(Xq,this,e,t),this._lastRenderedLayers=t;const n=Y0(t,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,n){n.raiseError(e,"".concat(t," of ").concat(n))}_updateLayers(t,e){const n={};for(const a of t)n[a.id]?Bn.warn("Multiple old layers with same id ".concat(a.id))():n[a.id]=a;const i=[];this._updateSublayersRecursively(e,n,i),this._finalizeOldLayers(n);let s=!1;for(const a of i)if(a.hasUniformTransition()){s="Uniform transition in ".concat(a);break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(t,e,n){for(const i of t){i.context=this.context;const s=e[i.id];s===null&&Bn.warn("Multiple new layers with same id ".concat(i.id))(),e[i.id]=null;let a=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),a=i.isComposite?i.getSubLayers():null}catch(o){this._handleError("matching",o,i)}a&&this._updateSublayersRecursively(a,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=hf.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=hf.MATCHED,e!==t&&(t.lifecycle=hf.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=hf.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=hf.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function Gc(r,t,e){if(r===t)return!0;if(!e||!r||!t)return!1;if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!Gc(r[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof r=="object"&&typeof t=="object"){const n=Object.keys(r),i=Object.keys(t);if(n.length!==i.length)return!1;for(const s of n)if(!t.hasOwnProperty(s)||!Gc(r[s],t[s],e-1))return!1;return!0}return!1}class Zq{constructor(t){W(this,"width",void 0),W(this,"height",void 0),W(this,"views",void 0),W(this,"viewState",void 0),W(this,"controllers",void 0),W(this,"timeline",void 0),W(this,"_viewports",void 0),W(this,"_viewportMap",void 0),W(this,"_isUpdating",void 0),W(this,"_needsRedraw",void 0),W(this,"_needsUpdate",void 0),W(this,"_eventManager",void 0),W(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),i={x:t[0],y:t[1]};for(let s=n.length-1;s>=0;--s){const a=n[s];if(a.containsPixel(i)){const o=t.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Y0(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Gc(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Bn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){const n=e.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var a;return(a=this.getView(t.id))===null||a===void 0?void 0:a.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(t,e,n,i){const s=t.controller;if(s&&n){const a={...e,...s,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==s.type)&&(i=this._createController(t,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=t.length;i--;){const s=t[i],a=this.getViewState(s),o=s.makeViewport({viewState:a,width:this.width,height:this.height});let h=e[s.id];const f=!!s.controller;f&&!h&&(n=!0),(n||!f)&&h&&(h.finalize(),h=null),this.controllers[s.id]=this._updateController(s,a,o,h),o&&this._viewports.unshift(o)}for(const i in e){const s=e[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((n,i)=>!t[i].equals(e[i]))}}const tK=/([0-9]+\.?[0-9]*)(%|px)/;function NA(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const t=tK.exec(r);if(t&&t.length>=3){const e=t[2]==="%",n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(r))}}function kA(r,t){return r.relative?Math.round(r.position*t):r.position}function Ws(r,t){if(!r)throw new Error(t||"deck.gl: assertion failed.")}class eK{constructor(t){W(this,"id",void 0),W(this,"viewportInstance",void 0),W(this,"_x",void 0),W(this,"_y",void 0),W(this,"_width",void 0),W(this,"_height",void 0),W(this,"_padding",void 0),W(this,"props",void 0);const{id:e,x:n=0,y:i=0,width:s="100%",height:a="100%",padding:o=null,viewportInstance:h}=t||{};Ws(!h||h instanceof Af),this.viewportInstance=h,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=NA(n),this._y=NA(i),this._width=NA(s),this._height=NA(a),this._padding=o&&{left:NA(o.left||0),right:NA(o.right||0),top:NA(o.top||0),bottom:NA(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&Gc(this.props,t.props,2)}makeViewport(t){let{width:e,height:n,viewState:i}=t;if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const s=this.getDimensions({width:e,height:n});return!s.height||!s.width?null:new this.ViewportType({...i,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const n in this.props.viewState)n!=="id"&&(e[n]=this.props.viewState[n]);return e}return t}getDimensions(t){let{width:e,height:n}=t;const i={x:kA(this._x,e),y:kA(this._y,n),width:kA(this._width,e),height:kA(this._height,n)};return this._padding&&(i.padding={left:kA(this._padding.left,e),top:kA(this._padding.top,n),right:kA(this._padding.right,e),bottom:kA(this._padding.bottom,n)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class wg{constructor(t){W(this,"_inProgress",void 0),W(this,"_handle",void 0),W(this,"_timeline",void 0),W(this,"time",void 0),W(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,n;this.cancel(),this.settings=t,this._inProgress=!0,(e=(n=this.settings).onStart)===null||e===void 0||e.call(n,this)}end(){if(this._inProgress){var t,e;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)===null||t===void 0||t.call(e,this)}}cancel(){if(this._inProgress){var t,e;(t=(e=this.settings).onInterrupt)===null||t===void 0||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)===null||t===void 0||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const HI=()=>{},ow={BREAK:1,SNAP_TO_END:2,IGNORE:3},rK=r=>r,nK=ow.BREAK;class iK{constructor(t){W(this,"getControllerState",void 0),W(this,"props",void 0),W(this,"propsInTransition",void 0),W(this,"transition",void 0),W(this,"onViewStateChange",void 0),W(this,"onStateChange",void 0),W(this,"_onTransitionUpdate",e=>{const{time:n,settings:{interpolator:i,startProps:s,endProps:a,duration:o,easing:h}}=e,f=h(n/o),m=i.interpolateProps(s,a,f);this.propsInTransition=this.getControllerState({...this.props,...m}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new wg(t.timeline),this.onViewStateChange=t.onViewStateChange||HI,this.onStateChange=t.onStateChange||HI}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let i=n;if(this.transition.inProgress){const{interruption:s,endProps:a}=this.transition.settings;i={...n,...s===ow.SNAP_TO_END?a:this.propsInTransition||n}}this._triggerTransition(i,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:n}=t;return(e>0||e==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===ow.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const n=this.getControllerState(t),i=this.getControllerState(e).shortestPathFrom(n),s=e.transitionInterpolator,a=s.getDuration?s.getDuration(t,e):e.transitionDuration;if(a===0)return;const o=s.initializeProps(t,i);this.propsInTransition={};const h={duration:a,easing:e.transitionEasing||rK,interpolator:s,interruption:e.transitionInterruption||nK,startProps:o.start,endProps:o.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}class sK{constructor(t){W(this,"_propsToCompare",void 0),W(this,"_propsToExtract",void 0),W(this,"_requiredProps",void 0);const{compare:e,extract:n,required:i}=t;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}arePropsEqual(t,e){for(const n of this._propsToCompare)if(!(n in t)||!(n in e)||!rc(t[n],e[n]))return!1;return!0}initializeProps(t,e){const n={},i={};for(const s of this._propsToExtract)(s in t||s in e)&&(n[s]=t[s],i[s]=e[s]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const n=t[e];Ws(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))})}}const oK=["longitude","latitude","zoom","bearing","pitch"],aK=["longitude","latitude","zoom"];class zI extends sK{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:oK,required:aK},super(n.transitionProps),W(this,"opts",void 0),this.opts=n}initializeProps(t,e){const n=super.initializeProps(t,e),{makeViewport:i,around:s}=this.opts;if(i&&s){const a=i(t),o=i(e),h=a.unproject(s);n.start.around=s,Object.assign(n.end,{around:o.project(h),aroundPosition:h,width:e.width,height:e.height})}return n}interpolateProps(t,e,n){const i={};for(const s of this._propsToExtract)i[s]=O0(t[s]||0,e[s]||0,n);if(e.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...e,...i});Object.assign(i,s.panByPosition(e.aroundPosition,O0(t.around,e.around,n)))}return i}}const QA={transitionDuration:0},lK=300,Z0=r=>1-(1-r)*(1-r),ff={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Gh={};class cK{constructor(t){W(this,"props",void 0),W(this,"state",{}),W(this,"transitionManager",void 0),W(this,"eventManager",void 0),W(this,"onViewStateChange",void 0),W(this,"onStateChange",void 0),W(this,"makeViewport",void 0),W(this,"_controllerState",void 0),W(this,"_events",{}),W(this,"_interactionState",{isDragging:!1}),W(this,"_customEvents",[]),W(this,"_eventStartBlocked",null),W(this,"_panMove",!1),W(this,"invertPan",!1),W(this,"dragMode","rotate"),W(this,"inertia",0),W(this,"scrollZoom",!0),W(this,"dragPan",!0),W(this,"dragRotate",!0),W(this,"doubleClickZoom",!0),W(this,"touchZoom",!0),W(this,"touchRotate",!1),W(this,"keyboard",!0),this.transitionManager=new iK({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)if(this._events[e]){var t;(t=this.eventManager)===null||t===void 0||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:n}=this.props,{offsetCenter:i}=t;return[i.x-e,i.y-n]}isPointInBounds(t,e){const{width:n,height:i}=this.props;if(e&&e.handled)return!1;const s=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return s&&e&&e.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?lK:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:o=!0,touchRotate:h=!1,keyboard:f=!0}=t,m=!!this.onViewStateChange;this.toggleEvents(ff.WHEEL,m&&n),this.toggleEvents(ff.PAN,m),this.toggleEvents(ff.PINCH,m&&(o||h)),this.toggleEvents(ff.TRIPLE_PAN,m&&h),this.toggleEvents(ff.DOUBLE_TAP,m&&a),this.toggleEvents(ff.KEYBOARD,m&&f),this.scrollZoom=n,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=o,this.touchRotate=h,this.keyboard=f}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(n=>{this._events[n]!==e&&(this._events[n]=e,e?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i={...t.getViewportProps(),...e},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),s){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(i,QA,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,QA,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Z0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,QA,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Z0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let a=2/(1+Math.exp(-Math.abs(s*n)));s<0&&a!==0&&(a=1/a);const o=this.controllerState.zoom({pos:e,scale:a});return this.updateViewport(o,{...this._getTransitionProps({around:e}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,QA,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,QA,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*e/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Z0},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return Gh._startPinchRotation=t.rotation,Gh._lastPinchEvent=t,this.updateViewport(n,QA,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:Gh._startPinchRotation-n})}return this.updateViewport(e,QA,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Gh._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:n}=Gh;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const i=this.getCenter(t);let s=this.controllerState.rotateEnd();const a=Math.log2(t.scale),o=(a-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),h=Math.pow(2,a+o*e/2);s=s.zoom({pos:i,scale:h}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:e,transitionEasing:Z0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Gh._startPinchRotation=null,Gh._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let h;const f={};switch(t.srcEvent.code){case"Minus":h=e?o.zoomOut(n).zoomOut(n):o.zoomOut(n),f.isZooming=!0;break;case"Equal":h=e?o.zoomIn(n).zoomIn(n):o.zoomIn(n),f.isZooming=!0;break;case"ArrowLeft":e?(h=o.rotateLeft(s),f.isRotating=!0):(h=o.moveLeft(i),f.isPanning=!0);break;case"ArrowRight":e?(h=o.rotateRight(s),f.isRotating=!0):(h=o.moveRight(i),f.isPanning=!0);break;case"ArrowUp":e?(h=o.rotateUp(a),f.isRotating=!0):(h=o.moveUp(i),f.isPanning=!0);break;case"ArrowDown":e?(h=o.rotateDown(a),f.isRotating=!0):(h=o.moveDown(i),f.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),f),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?QA:t?{...e,transitionInterpolator:new zI({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class uK{constructor(t,e){W(this,"_viewportProps",void 0),W(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const VI=5,AK=1.2;class hK extends uK{constructor(t){const{width:e,height:n,latitude:i,longitude:s,zoom:a,bearing:o=0,pitch:h=0,altitude:f=1.5,position:m=[0,0,0],maxZoom:b=20,minZoom:x=0,maxPitch:B=60,minPitch:P=0,startPanLngLat:R,startZoomLngLat:Q,startRotatePos:z,startBearing:G,startPitch:X,startZoom:et,normalize:pt=!0}=t;Ws(Number.isFinite(s)),Ws(Number.isFinite(i)),Ws(Number.isFinite(a)),super({width:e,height:n,latitude:i,longitude:s,zoom:a,bearing:o,pitch:h,altitude:f,maxZoom:b,minZoom:x,maxPitch:B,minPitch:P,normalize:pt,position:m},{startPanLngLat:R,startZoomLngLat:Q,startRotatePos:z,startBearing:G,startPitch:X,startZoom:et}),W(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:e}=t;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan(t){let{pos:e,startPos:n}=t;const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:e}=t;return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:e,deltaAngleX:n=0,deltaAngleY:i=0}=t;const{startRotatePos:s,startBearing:a,startPitch:o}=this.getState();if(!s||a===void 0||o===void 0)return this;let h;return e?h=this._getNewRotation(e,s,o,a):h={bearing:a+n,pitch:o+i},this._getUpdatedState(h)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:e}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:e,startPos:n,scale:i}=t,{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(n)||this._unproject(e)),!a)return this;const{maxZoom:o,minZoom:h}=this.getViewportProps();let f=s+Math.log2(i);f=zu(f,h,o);const m=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...m.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:s}=n;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(s-e.longitude)>180&&(n.longitude=s<0?s+360:s-360),n}applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:i}=t;t.zoom=zu(i,n,e);const{maxPitch:s,minPitch:a,pitch:o}=t;t.pitch=zu(o,a,s);const{normalize:h=!0}=t;return h&&Object.assign(t,yq(t)),t}_zoomFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.zoom({pos:[e/2,n/2],scale:t})}_panFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.pan({startPos:[e/2,n/2],pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,n,i){const s=t[0]-e[0],a=t[1]-e[1],o=t[1],h=e[1],{width:f,height:m}=this.getViewportProps(),b=s/f;let x=0;a>0?Math.abs(m-h)>VI&&(x=a/(h-m)*AK):a<0&&h>VI&&(x=1-o/h),x=zu(x,-1,1);const{minPitch:B,maxPitch:P}=this.getViewportProps(),R=i+180*b;let Q=n;return x>0?Q=n+x*(P-n):x<0&&(Q=n-x*(B-n)),{pitch:Q,bearing:R}}}class dK extends cK{constructor(){super(...arguments),W(this,"ControllerState",hK),W(this,"transition",{transitionDuration:300,transitionInterpolator:new zI({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),W(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class aw extends eK{get ViewportType(){return zh}get ControllerType(){return dK}}W(aw,"displayName","MapView");const fK=new tw;function pK(r,t){var e,n;const i=(e=r.order)!==null&&e!==void 0?e:1/0,s=(n=t.order)!==null&&n!==void 0?n:1/0;return i-s}class gK{constructor(){W(this,"effects",void 0),W(this,"_resolvedEffects",[]),W(this,"_defaultEffects",[]),W(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(n=>n.id===t.id)){const n=e.findIndex(i=>pK(i,t)>0);n<0?e.push(t):e.splice(n,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Gc(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const i of this.effects)e[i.id]=i;const n=[];for(const i of t){const s=e[i.id];s&&s!==i?s.setProps?(s.setProps(i.props),n.push(s)):(s.cleanup(),n.push(i)):n.push(i),delete e[i.id]}for(const i in e)e[i].cleanup();this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(i=>i instanceof tw)||this._resolvedEffects.push(fK),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class mK extends qb{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const yK="deckRenderer.renderLayers";class _K{constructor(t){W(this,"gl",void 0),W(this,"layerFilter",void 0),W(this,"drawPickingColors",void 0),W(this,"drawLayersPass",void 0),W(this,"pickLayersPass",void 0),W(this,"renderCount",void 0),W(this,"_needsRedraw",void 0),W(this,"renderBuffers",void 0),W(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new mK(t),this.pickLayersPass=new kI(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||bs.getDefaultFramebuffer(this.gl)};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target,s=e.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,uo(yK,this,s,t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const n of t)e.preRenderStats[n.id]=n.preRender(this.gl,e),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new bs(this.gl),new bs(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:n}=this,i={...e,inputBuffer:n[0],swapBuffer:n[1],target:null};for(const s of t)if(s.postRender){if(s.id===this.lastPostProcessEffect){i.target=e.target,s.postRender(this.gl,i);break}const a=s.postRender(this.gl,i);i.inputBuffer=a,i.swapBuffer=a===n[0]?n[1]:n[0]}}}const vK={pickedColor:null,pickedObjectIndex:-1};function bK(r){let{pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:s,deviceRect:a}=r;const{x:o,y:h,width:f,height:m}=a;let b=s*s,x=-1,B=0;for(let P=0;P<m;P++){const R=P+h-i,Q=R*R;if(Q>b)B+=4*f;else for(let z=0;z<f;z++){if(t[B+3]-1>=0){const X=z+o-n,et=X*X+Q;et<=b&&(b=et,x=B)}B+=4}}if(x>=0){const P=t.slice(x,x+4),R=e(P);if(R){const Q=Math.floor(x/4/f),z=x/4-Q*f;return{...R,pickedColor:P,pickedX:o+z,pickedY:h+Q}}Bn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return vK}function wK(r){let{pickedColors:t,decodePickingColor:e}=r;const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const a=t.slice(i,i+4),o=a.join(",");if(!n.has(o)){const h=e(a);h?n.set(o,{...h,color:a}):Bn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function GI(r){let{pickInfo:t,viewports:e,pixelRatio:n,x:i,y:s,z:a}=r,o=e[0];e.length>1&&(o=BK((t==null?void 0:t.pickedViewports)||e,{x:i,y:s}));let h;if(o){const f=[i-o.x,s-o.y];a!==void 0&&(f[2]=a),h=o.unproject(f)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:h,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function xK(r){const{pickInfo:t,lastPickedInfo:e,mode:n,layers:i}=r,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=t,h=a?[a]:[];if(n==="hover"){const b=e.index,x=e.layerId,B=a?a.props.id:null;if(B!==x||o!==b){if(B!==x){const P=i.find(R=>R.props.id===x);P&&h.unshift(P)}e.layerId=B,e.index=o,e.info=null}}const f=GI(r),m=new Map;return m.set(null,f),h.forEach(b=>{let x={...f};b===a&&(x.color=s,x.index=o,x.picked=!0),x=jI({layer:b,info:x,mode:n});const B=x.layer;b===a&&n==="hover"&&(e.info=x),m.set(B.id,x),n==="hover"&&B.updateAutoHighlight(x)}),m}function jI(r){let{layer:t,info:e,mode:n}=r;for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function BK(r,t){for(let e=r.length-1;e>=0;e--){const n=r[e];if(n.containsPixel(t))return n}return r[0]}class CK{constructor(t){W(this,"gl",void 0),W(this,"pickingFBO",void 0),W(this,"depthFBO",void 0),W(this,"pickLayersPass",void 0),W(this,"layerFilter",void 0),W(this,"lastPickedInfo",void 0),W(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new kI(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:e,y:n,layers:i,viewports:s}=t,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const o=a&&a.layer&&a.layer.id,h=a&&a.viewport&&a.viewport.id,f=o?i.find(B=>B.id===o):null,m=h&&s.find(B=>B.id===h)||s[0],b=m&&m.unproject([e-m.x,n-m.y]);return{...a,...{x:e,y:n,viewport:m,coordinate:b,layer:f}}}_resizeBuffer(){var t,e;const{gl:n}=this;if(!this.pickingFBO&&(this.pickingFBO=new bs(n),bs.isSupported(n,{colorBufferFloat:!0}))){const i=new bs(n);i.attach({36064:new Ma(n,{format:fn(n)?34836:6408,type:5126})}),this.depthFBO=i}(t=this.pickingFBO)===null||t===void 0||t.resize({width:n.canvas.width,height:n.canvas.height}),(e=this.depthFBO)===null||e===void 0||e.resize({width:n.canvas.width,height:n.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return e.length?e:null}_pickClosestObject(t){let{layers:e,views:n,viewports:i,x:s,y:a,radius:o=0,depth:h=1,mode:f="query",unproject3D:m,onViewportActive:b,effects:x}=t;const B=this._getPickable(e),P=Yd(this.gl);if(!B)return{result:[],emptyInfo:GI({viewports:i,x:s,y:a,pixelRatio:P})};this._resizeBuffer();const R=ib(this.gl,[s,a],!0),Q=[R.x+Math.floor(R.width/2),R.y+Math.floor(R.height/2)],z=Math.round(o*P),{width:G,height:X}=this.pickingFBO,et=this._getPickingRect({deviceX:Q[0],deviceY:Q[1],deviceRadius:z,deviceWidth:G,deviceHeight:X}),pt={x:s-o,y:a-o,width:o*2+1,height:o*2+1};let gt;const mt=[],ft=new Set;for(let Mt=0;Mt<h;Mt++){let Lt;if(et){const ct=this._drawAndSample({layers:B,views:n,viewports:i,onViewportActive:b,deviceRect:et,cullRect:pt,effects:x,pass:"picking:".concat(f)});Lt=bK({...ct,deviceX:Q[0],deviceY:Q[1],deviceRadius:z,deviceRect:et})}else Lt={pickedColor:null,pickedObjectIndex:-1};let at;if(Lt.pickedLayer&&m&&this.depthFBO){const{pickedColors:ct}=this._drawAndSample({layers:[Lt.pickedLayer],views:n,viewports:i,onViewportActive:b,deviceRect:{x:Lt.pickedX,y:Lt.pickedY,width:1,height:1},cullRect:pt,effects:x,pass:"picking:".concat(f,":z")},!0);ct[3]&&(at=ct[0])}Lt.pickedLayer&&Mt+1<h&&(ft.add(Lt.pickedLayer),Lt.pickedLayer.disablePickingIndex(Lt.pickedObjectIndex)),gt=xK({pickInfo:Lt,lastPickedInfo:this.lastPickedInfo,mode:f,layers:B,viewports:i,x:s,y:a,z:at,pixelRatio:P});for(const ct of gt.values())ct.layer&&mt.push(ct);if(!Lt.pickedColor)break}for(const Mt of ft)Mt.restorePickingColors();return{result:mt,emptyInfo:gt.get(null)}}_pickVisibleObjects(t){let{layers:e,views:n,viewports:i,x:s,y:a,width:o=1,height:h=1,mode:f="query",maxObjects:m=null,onViewportActive:b,effects:x}=t;const B=this._getPickable(e);if(!B)return[];this._resizeBuffer();const P=Yd(this.gl),R=ib(this.gl,[s,a],!0),Q=R.x,z=R.y+R.height,G=ib(this.gl,[s+o,a+h],!0),X=G.x+G.width,et=G.y,pt={x:Q,y:et,width:X-Q,height:z-et},gt=this._drawAndSample({layers:B,views:n,viewports:i,onViewportActive:b,deviceRect:pt,cullRect:{x:s,y:a,width:o,height:h},effects:x,pass:"picking:".concat(f)}),mt=wK(gt),ft=new Map,Mt=Number.isFinite(m);for(let at=0;at<mt.length;at++){var Lt;if(Mt&&m&&ft.size>=m)break;const ct=mt[at];let wt={color:ct.pickedColor,layer:null,index:ct.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:P};wt=jI({layer:ct.pickedLayer,info:wt,mode:f});const _t=(Lt=wt.object)!==null&&Lt!==void 0?Lt:"".concat(wt.layer.id,"[").concat(wt.index,"]");ft.has(_t)||ft.set(_t,wt)}return Array.from(ft.values())}_drawAndSample(t){let{layers:e,views:n,viewports:i,onViewportActive:s,deviceRect:a,cullRect:o,effects:h,pass:f}=t,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const b=m?this.depthFBO:this.pickingFBO,x={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:s,pickingFBO:b,deviceRect:a,cullRect:o,effects:h,pass:f,pickZ:m,preRenderStats:{}};for(const X of h)X.useInPicking&&(x.preRenderStats[X.id]=X.preRender(this.gl,x));const{decodePickingColor:B}=this.pickLayersPass.render(x),{x:P,y:R,width:Q,height:z}=a,G=new(m?Float32Array:Uint8Array)(Q*z*4);return E0(b,{sourceX:P,sourceY:R,sourceWidth:Q,sourceHeight:z,target:G}),{pickedColors:G,decodePickingColor:B}}_getPickingRect(t){let{deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:s,deviceHeight:a}=t;const o=Math.max(0,e-i),h=Math.max(0,n-i),f=Math.min(s,e+i+1)-o,m=Math.min(a,n+i+1)-h;return f<=0||m<=0?null:{x:o,y:h,width:f,height:m}}}const EK={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class SK{constructor(t){W(this,"el",null),W(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,EK),e.appendChild(this.el))}setTooltip(t,e,n){const i=this.el;if(i){if(typeof t=="string")i.innerText=t;else if(t)t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.className&&(i.className=t.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(e,"px, ").concat(n,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(i.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var qI={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(r){(function(t,e,n,i){var s=["","webkit","Moz","MS","ms","o"],a=e.createElement("div"),o="function",h=Math.round,f=Math.abs,m=Date.now;function b(dt,xt,kt){return setTimeout(X(dt,kt),xt)}function x(dt,xt,kt){return Array.isArray(dt)?(B(dt,kt[xt],kt),!0):!1}function B(dt,xt,kt){var he;if(dt)if(dt.forEach)dt.forEach(xt,kt);else if(dt.length!==i)for(he=0;he<dt.length;)xt.call(kt,dt[he],he,dt),he++;else for(he in dt)dt.hasOwnProperty(he)&&xt.call(kt,dt[he],he,dt)}function P(dt,xt,kt){var he="DEPRECATED METHOD: "+xt+`
`+kt+` AT 
`;return function(){var Le=new Error("get-stack-trace"),Ze=Le&&Le.stack?Le.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Qr=t.console&&(t.console.warn||t.console.log);return Qr&&Qr.call(t.console,he,Ze),dt.apply(this,arguments)}}var R;typeof Object.assign!="function"?R=function(xt){if(xt===i||xt===null)throw new TypeError("Cannot convert undefined or null to object");for(var kt=Object(xt),he=1;he<arguments.length;he++){var Le=arguments[he];if(Le!==i&&Le!==null)for(var Ze in Le)Le.hasOwnProperty(Ze)&&(kt[Ze]=Le[Ze])}return kt}:R=Object.assign;var Q=P(function(xt,kt,he){for(var Le=Object.keys(kt),Ze=0;Ze<Le.length;)(!he||he&&xt[Le[Ze]]===i)&&(xt[Le[Ze]]=kt[Le[Ze]]),Ze++;return xt},"extend","Use `assign`."),z=P(function(xt,kt){return Q(xt,kt,!0)},"merge","Use `assign`.");function G(dt,xt,kt){var he=xt.prototype,Le;Le=dt.prototype=Object.create(he),Le.constructor=dt,Le._super=he,kt&&R(Le,kt)}function X(dt,xt){return function(){return dt.apply(xt,arguments)}}function et(dt,xt){return typeof dt==o?dt.apply(xt&&xt[0]||i,xt):dt}function pt(dt,xt){return dt===i?xt:dt}function gt(dt,xt,kt){B(Lt(xt),function(he){dt.addEventListener(he,kt,!1)})}function mt(dt,xt,kt){B(Lt(xt),function(he){dt.removeEventListener(he,kt,!1)})}function ft(dt,xt){for(;dt;){if(dt==xt)return!0;dt=dt.parentNode}return!1}function Mt(dt,xt){return dt.indexOf(xt)>-1}function Lt(dt){return dt.trim().split(/\s+/g)}function at(dt,xt,kt){if(dt.indexOf&&!kt)return dt.indexOf(xt);for(var he=0;he<dt.length;){if(kt&&dt[he][kt]==xt||!kt&&dt[he]===xt)return he;he++}return-1}function ct(dt){return Array.prototype.slice.call(dt,0)}function wt(dt,xt,kt){for(var he=[],Le=[],Ze=0;Ze<dt.length;){var Qr=dt[Ze][xt];at(Le,Qr)<0&&he.push(dt[Ze]),Le[Ze]=Qr,Ze++}return he=he.sort(function($n,xi){return $n[xt]>xi[xt]}),he}function _t(dt,xt){for(var kt,he,Le=xt[0].toUpperCase()+xt.slice(1),Ze=0;Ze<s.length;){if(kt=s[Ze],he=kt?kt+Le:xt,he in dt)return he;Ze++}return i}var Jt=1;function Yt(){return Jt++}function ee(dt){var xt=dt.ownerDocument||dt;return xt.defaultView||xt.parentWindow||t}var $t=/mobile|tablet|ip(ad|hone|od)|android/i,ne="ontouchstart"in t,re=_t(t,"PointerEvent")!==i,Be=ne&&$t.test(navigator.userAgent),it="touch",bt="pen",Pt="mouse",Ot="kinect",qt=25,Gt=1,oe=2,ie=4,Ce=8,Fe=1,Re=2,Ne=4,ke=8,fe=16,lt=Re|Ne,pr=ke|fe,er=lt|pr,pe=["x","y"],we=["clientX","clientY"];function Ie(dt,xt){var kt=this;this.manager=dt,this.callback=xt,this.element=dt.element,this.target=dt.options.inputTarget,this.domHandler=function(he){et(dt.options.enable,[dt])&&kt.handler(he)},this.init()}Ie.prototype={handler:function(){},init:function(){this.evEl&&gt(this.element,this.evEl,this.domHandler),this.evTarget&&gt(this.target,this.evTarget,this.domHandler),this.evWin&&gt(ee(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&mt(this.element,this.evEl,this.domHandler),this.evTarget&&mt(this.target,this.evTarget,this.domHandler),this.evWin&&mt(ee(this.element),this.evWin,this.domHandler)}};function Oe(dt){var xt,kt=dt.options.inputClass;return kt?xt=kt:re?xt=Z:Be?xt=Xt:ne?xt=ze:xt=He,new xt(dt,nr)}function nr(dt,xt,kt){var he=kt.pointers.length,Le=kt.changedPointers.length,Ze=xt&Gt&&he-Le===0,Qr=xt&(ie|Ce)&&he-Le===0;kt.isFirst=!!Ze,kt.isFinal=!!Qr,Ze&&(dt.session={}),kt.eventType=xt,hr(dt,kt),dt.emit("hammer.input",kt),dt.recognize(kt),dt.session.prevInput=kt}function hr(dt,xt){var kt=dt.session,he=xt.pointers,Le=he.length;kt.firstInput||(kt.firstInput=kr(xt)),Le>1&&!kt.firstMultiple?kt.firstMultiple=kr(xt):Le===1&&(kt.firstMultiple=!1);var Ze=kt.firstInput,Qr=kt.firstMultiple,ei=Qr?Qr.center:Ze.center,$n=xt.center=ye(he);xt.timeStamp=m(),xt.deltaTime=xt.timeStamp-Ze.timeStamp,xt.angle=pn(ei,$n),xt.distance=De(ei,$n),Sr(kt,xt),xt.offsetDirection=xr(xt.deltaX,xt.deltaY);var xi=or(xt.deltaTime,xt.deltaX,xt.deltaY);xt.overallVelocityX=xi.x,xt.overallVelocityY=xi.y,xt.overallVelocity=f(xi.x)>f(xi.y)?xi.x:xi.y,xt.scale=Qr?yr(Qr.pointers,he):1,xt.rotation=Qr?ge(Qr.pointers,he):0,xt.maxPointers=kt.prevInput?xt.pointers.length>kt.prevInput.maxPointers?xt.pointers.length:kt.prevInput.maxPointers:xt.pointers.length,Mr(kt,xt);var vn=dt.element;ft(xt.srcEvent.target,vn)&&(vn=xt.srcEvent.target),xt.target=vn}function Sr(dt,xt){var kt=xt.center,he=dt.offsetDelta||{},Le=dt.prevDelta||{},Ze=dt.prevInput||{};(xt.eventType===Gt||Ze.eventType===ie)&&(Le=dt.prevDelta={x:Ze.deltaX||0,y:Ze.deltaY||0},he=dt.offsetDelta={x:kt.x,y:kt.y}),xt.deltaX=Le.x+(kt.x-he.x),xt.deltaY=Le.y+(kt.y-he.y)}function Mr(dt,xt){var kt=dt.lastInterval||xt,he=xt.timeStamp-kt.timeStamp,Le,Ze,Qr,ei;if(xt.eventType!=Ce&&(he>qt||kt.velocity===i)){var $n=xt.deltaX-kt.deltaX,xi=xt.deltaY-kt.deltaY,vn=or(he,$n,xi);Ze=vn.x,Qr=vn.y,Le=f(vn.x)>f(vn.y)?vn.x:vn.y,ei=xr($n,xi),dt.lastInterval=xt}else Le=kt.velocity,Ze=kt.velocityX,Qr=kt.velocityY,ei=kt.direction;xt.velocity=Le,xt.velocityX=Ze,xt.velocityY=Qr,xt.direction=ei}function kr(dt){for(var xt=[],kt=0;kt<dt.pointers.length;)xt[kt]={clientX:h(dt.pointers[kt].clientX),clientY:h(dt.pointers[kt].clientY)},kt++;return{timeStamp:m(),pointers:xt,center:ye(xt),deltaX:dt.deltaX,deltaY:dt.deltaY}}function ye(dt){var xt=dt.length;if(xt===1)return{x:h(dt[0].clientX),y:h(dt[0].clientY)};for(var kt=0,he=0,Le=0;Le<xt;)kt+=dt[Le].clientX,he+=dt[Le].clientY,Le++;return{x:h(kt/xt),y:h(he/xt)}}function or(dt,xt,kt){return{x:xt/dt||0,y:kt/dt||0}}function xr(dt,xt){return dt===xt?Fe:f(dt)>=f(xt)?dt<0?Re:Ne:xt<0?ke:fe}function De(dt,xt,kt){kt||(kt=pe);var he=xt[kt[0]]-dt[kt[0]],Le=xt[kt[1]]-dt[kt[1]];return Math.sqrt(he*he+Le*Le)}function pn(dt,xt,kt){kt||(kt=pe);var he=xt[kt[0]]-dt[kt[0]],Le=xt[kt[1]]-dt[kt[1]];return Math.atan2(Le,he)*180/Math.PI}function ge(dt,xt){return pn(xt[1],xt[0],we)+pn(dt[1],dt[0],we)}function yr(dt,xt){return De(xt[0],xt[1],we)/De(dt[0],dt[1],we)}var je={mousedown:Gt,mousemove:oe,mouseup:ie},Rr="mousedown",cn="mousemove mouseup";function He(){this.evEl=Rr,this.evWin=cn,this.pressed=!1,Ie.apply(this,arguments)}G(He,Ie,{handler:function(xt){var kt=je[xt.type];kt&Gt&&xt.button===0&&(this.pressed=!0),kt&oe&&xt.which!==1&&(kt=ie),this.pressed&&(kt&ie&&(this.pressed=!1),this.callback(this.manager,kt,{pointers:[xt],changedPointers:[xt],pointerType:Pt,srcEvent:xt}))}});var Kn={pointerdown:Gt,pointermove:oe,pointerup:ie,pointercancel:Ce,pointerout:Ce},sn={2:it,3:bt,4:Pt,5:Ot},Jr="pointerdown",Bt="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Jr="MSPointerDown",Bt="MSPointerMove MSPointerUp MSPointerCancel");function Z(){this.evEl=Jr,this.evWin=Bt,Ie.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}G(Z,Ie,{handler:function(xt){var kt=this.store,he=!1,Le=xt.type.toLowerCase().replace("ms",""),Ze=Kn[Le],Qr=sn[xt.pointerType]||xt.pointerType,ei=Qr==it,$n=at(kt,xt.pointerId,"pointerId");Ze&Gt&&(xt.button===0||ei)?$n<0&&(kt.push(xt),$n=kt.length-1):Ze&(ie|Ce)&&(he=!0),!($n<0)&&(kt[$n]=xt,this.callback(this.manager,Ze,{pointers:kt,changedPointers:[xt],pointerType:Qr,srcEvent:xt}),he&&kt.splice($n,1))}});var J={touchstart:Gt,touchmove:oe,touchend:ie,touchcancel:Ce},st="touchstart",Ft="touchstart touchmove touchend touchcancel";function Nt(){this.evTarget=st,this.evWin=Ft,this.started=!1,Ie.apply(this,arguments)}G(Nt,Ie,{handler:function(xt){var kt=J[xt.type];if(kt===Gt&&(this.started=!0),!!this.started){var he=Ht.call(this,xt,kt);kt&(ie|Ce)&&he[0].length-he[1].length===0&&(this.started=!1),this.callback(this.manager,kt,{pointers:he[0],changedPointers:he[1],pointerType:it,srcEvent:xt})}}});function Ht(dt,xt){var kt=ct(dt.touches),he=ct(dt.changedTouches);return xt&(ie|Ce)&&(kt=wt(kt.concat(he),"identifier")),[kt,he]}var jt={touchstart:Gt,touchmove:oe,touchend:ie,touchcancel:Ce},Tt="touchstart touchmove touchend touchcancel";function Xt(){this.evTarget=Tt,this.targetIds={},Ie.apply(this,arguments)}G(Xt,Ie,{handler:function(xt){var kt=jt[xt.type],he=_e.call(this,xt,kt);he&&this.callback(this.manager,kt,{pointers:he[0],changedPointers:he[1],pointerType:it,srcEvent:xt})}});function _e(dt,xt){var kt=ct(dt.touches),he=this.targetIds;if(xt&(Gt|oe)&&kt.length===1)return he[kt[0].identifier]=!0,[kt,kt];var Le,Ze,Qr=ct(dt.changedTouches),ei=[],$n=this.target;if(Ze=kt.filter(function(xi){return ft(xi.target,$n)}),xt===Gt)for(Le=0;Le<Ze.length;)he[Ze[Le].identifier]=!0,Le++;for(Le=0;Le<Qr.length;)he[Qr[Le].identifier]&&ei.push(Qr[Le]),xt&(ie|Ce)&&delete he[Qr[Le].identifier],Le++;if(ei.length)return[wt(Ze.concat(ei),"identifier"),ei]}var ue=2500,Ae=25;function ze(){Ie.apply(this,arguments);var dt=X(this.handler,this);this.touch=new Xt(this.manager,dt),this.mouse=new He(this.manager,dt),this.primaryTouch=null,this.lastTouches=[]}G(ze,Ie,{handler:function(xt,kt,he){var Le=he.pointerType==it,Ze=he.pointerType==Pt;if(!(Ze&&he.sourceCapabilities&&he.sourceCapabilities.firesTouchEvents)){if(Le)Ve.call(this,kt,he);else if(Ze&&_r.call(this,he))return;this.callback(xt,kt,he)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ve(dt,xt){dt&Gt?(this.primaryTouch=xt.changedPointers[0].identifier,Er.call(this,xt)):dt&(ie|Ce)&&Er.call(this,xt)}function Er(dt){var xt=dt.changedPointers[0];if(xt.identifier===this.primaryTouch){var kt={x:xt.clientX,y:xt.clientY};this.lastTouches.push(kt);var he=this.lastTouches,Le=function(){var Ze=he.indexOf(kt);Ze>-1&&he.splice(Ze,1)};setTimeout(Le,ue)}}function _r(dt){for(var xt=dt.srcEvent.clientX,kt=dt.srcEvent.clientY,he=0;he<this.lastTouches.length;he++){var Le=this.lastTouches[he],Ze=Math.abs(xt-Le.x),Qr=Math.abs(kt-Le.y);if(Ze<=Ae&&Qr<=Ae)return!0}return!1}var Ur=_t(a.style,"touchAction"),Vr=Ur!==i,Gr="compute",Zr="auto",vr="manipulation",Wr="none",_n="pan-x",Rn="pan-y",Zn=Te();function Rt(dt,xt){this.manager=dt,this.set(xt)}Rt.prototype={set:function(dt){dt==Gr&&(dt=this.compute()),Vr&&this.manager.element.style&&Zn[dt]&&(this.manager.element.style[Ur]=dt),this.actions=dt.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var dt=[];return B(this.manager.recognizers,function(xt){et(xt.options.enable,[xt])&&(dt=dt.concat(xt.getTouchAction()))}),qe(dt.join(" "))},preventDefaults:function(dt){var xt=dt.srcEvent,kt=dt.offsetDirection;if(this.manager.session.prevented){xt.preventDefault();return}var he=this.actions,Le=Mt(he,Wr)&&!Zn[Wr],Ze=Mt(he,Rn)&&!Zn[Rn],Qr=Mt(he,_n)&&!Zn[_n];if(Le){var ei=dt.pointers.length===1,$n=dt.distance<2,xi=dt.deltaTime<250;if(ei&&$n&&xi)return}if(!(Qr&&Ze)&&(Le||Ze&&kt&lt||Qr&&kt&pr))return this.preventSrc(xt)},preventSrc:function(dt){this.manager.session.prevented=!0,dt.preventDefault()}};function qe(dt){if(Mt(dt,Wr))return Wr;var xt=Mt(dt,_n),kt=Mt(dt,Rn);return xt&&kt?Wr:xt||kt?xt?_n:Rn:Mt(dt,vr)?vr:Zr}function Te(){if(!Vr)return!1;var dt={},xt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(kt){dt[kt]=xt?t.CSS.supports("touch-action",kt):!0}),dt}var lr=1,Or=2,Fn=4,jr=8,gn=jr,Wn=16,mn=32;function on(dt){this.options=R({},this.defaults,dt||{}),this.id=Yt(),this.manager=null,this.options.enable=pt(this.options.enable,!0),this.state=lr,this.simultaneous={},this.requireFail=[]}on.prototype={defaults:{},set:function(dt){return R(this.options,dt),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(dt){if(x(dt,"recognizeWith",this))return this;var xt=this.simultaneous;return dt=Qn(dt,this),xt[dt.id]||(xt[dt.id]=dt,dt.recognizeWith(this)),this},dropRecognizeWith:function(dt){return x(dt,"dropRecognizeWith",this)?this:(dt=Qn(dt,this),delete this.simultaneous[dt.id],this)},requireFailure:function(dt){if(x(dt,"requireFailure",this))return this;var xt=this.requireFail;return dt=Qn(dt,this),at(xt,dt)===-1&&(xt.push(dt),dt.requireFailure(this)),this},dropRequireFailure:function(dt){if(x(dt,"dropRequireFailure",this))return this;dt=Qn(dt,this);var xt=at(this.requireFail,dt);return xt>-1&&this.requireFail.splice(xt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(dt){return!!this.simultaneous[dt.id]},emit:function(dt){var xt=this,kt=this.state;function he(Le){xt.manager.emit(Le,dt)}kt<jr&&he(xt.options.event+Bc(kt)),he(xt.options.event),dt.additionalEvent&&he(dt.additionalEvent),kt>=jr&&he(xt.options.event+Bc(kt))},tryEmit:function(dt){if(this.canEmit())return this.emit(dt);this.state=mn},canEmit:function(){for(var dt=0;dt<this.requireFail.length;){if(!(this.requireFail[dt].state&(mn|lr)))return!1;dt++}return!0},recognize:function(dt){var xt=R({},dt);if(!et(this.options.enable,[this,xt])){this.reset(),this.state=mn;return}this.state&(gn|Wn|mn)&&(this.state=lr),this.state=this.process(xt),this.state&(Or|Fn|jr|Wn)&&this.tryEmit(xt)},process:function(dt){},getTouchAction:function(){},reset:function(){}};function Bc(dt){return dt&Wn?"cancel":dt&jr?"end":dt&Fn?"move":dt&Or?"start":""}function os(dt){return dt==fe?"down":dt==ke?"up":dt==Re?"left":dt==Ne?"right":""}function Qn(dt,xt){var kt=xt.manager;return kt?kt.get(dt):dt}function un(){on.apply(this,arguments)}G(un,on,{defaults:{pointers:1},attrTest:function(dt){var xt=this.options.pointers;return xt===0||dt.pointers.length===xt},process:function(dt){var xt=this.state,kt=dt.eventType,he=xt&(Or|Fn),Le=this.attrTest(dt);return he&&(kt&Ce||!Le)?xt|Wn:he||Le?kt&ie?xt|jr:xt&Or?xt|Fn:Or:mn}});function Cs(){un.apply(this,arguments),this.pX=null,this.pY=null}G(Cs,un,{defaults:{event:"pan",threshold:10,pointers:1,direction:er},getTouchAction:function(){var dt=this.options.direction,xt=[];return dt&lt&&xt.push(Rn),dt&pr&&xt.push(_n),xt},directionTest:function(dt){var xt=this.options,kt=!0,he=dt.distance,Le=dt.direction,Ze=dt.deltaX,Qr=dt.deltaY;return Le&xt.direction||(xt.direction&lt?(Le=Ze===0?Fe:Ze<0?Re:Ne,kt=Ze!=this.pX,he=Math.abs(dt.deltaX)):(Le=Qr===0?Fe:Qr<0?ke:fe,kt=Qr!=this.pY,he=Math.abs(dt.deltaY))),dt.direction=Le,kt&&he>xt.threshold&&Le&xt.direction},attrTest:function(dt){return un.prototype.attrTest.call(this,dt)&&(this.state&Or||!(this.state&Or)&&this.directionTest(dt))},emit:function(dt){this.pX=dt.deltaX,this.pY=dt.deltaY;var xt=os(dt.direction);xt&&(dt.additionalEvent=this.options.event+xt),this._super.emit.call(this,dt)}});function Ln(){un.apply(this,arguments)}G(Ln,un,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Wr]},attrTest:function(dt){return this._super.attrTest.call(this,dt)&&(Math.abs(dt.scale-1)>this.options.threshold||this.state&Or)},emit:function(dt){if(dt.scale!==1){var xt=dt.scale<1?"in":"out";dt.additionalEvent=this.options.event+xt}this._super.emit.call(this,dt)}});function Os(){on.apply(this,arguments),this._timer=null,this._input=null}G(Os,on,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Zr]},process:function(dt){var xt=this.options,kt=dt.pointers.length===xt.pointers,he=dt.distance<xt.threshold,Le=dt.deltaTime>xt.time;if(this._input=dt,!he||!kt||dt.eventType&(ie|Ce)&&!Le)this.reset();else if(dt.eventType&Gt)this.reset(),this._timer=b(function(){this.state=gn,this.tryEmit()},xt.time,this);else if(dt.eventType&ie)return gn;return mn},reset:function(){clearTimeout(this._timer)},emit:function(dt){this.state===gn&&(dt&&dt.eventType&ie?this.manager.emit(this.options.event+"up",dt):(this._input.timeStamp=m(),this.manager.emit(this.options.event,this._input)))}});function Mi(){un.apply(this,arguments)}G(Mi,un,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Wr]},attrTest:function(dt){return this._super.attrTest.call(this,dt)&&(Math.abs(dt.rotation)>this.options.threshold||this.state&Or)}});function ga(){un.apply(this,arguments)}G(ga,un,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:lt|pr,pointers:1},getTouchAction:function(){return Cs.prototype.getTouchAction.call(this)},attrTest:function(dt){var xt=this.options.direction,kt;return xt&(lt|pr)?kt=dt.overallVelocity:xt&lt?kt=dt.overallVelocityX:xt&pr&&(kt=dt.overallVelocityY),this._super.attrTest.call(this,dt)&&xt&dt.offsetDirection&&dt.distance>this.options.threshold&&dt.maxPointers==this.options.pointers&&f(kt)>this.options.velocity&&dt.eventType&ie},emit:function(dt){var xt=os(dt.offsetDirection);xt&&this.manager.emit(this.options.event+xt,dt),this.manager.emit(this.options.event,dt)}});function ti(){on.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}G(ti,on,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[vr]},process:function(dt){var xt=this.options,kt=dt.pointers.length===xt.pointers,he=dt.distance<xt.threshold,Le=dt.deltaTime<xt.time;if(this.reset(),dt.eventType&Gt&&this.count===0)return this.failTimeout();if(he&&Le&&kt){if(dt.eventType!=ie)return this.failTimeout();var Ze=this.pTime?dt.timeStamp-this.pTime<xt.interval:!0,Qr=!this.pCenter||De(this.pCenter,dt.center)<xt.posThreshold;this.pTime=dt.timeStamp,this.pCenter=dt.center,!Qr||!Ze?this.count=1:this.count+=1,this._input=dt;var ei=this.count%xt.taps;if(ei===0)return this.hasRequireFailures()?(this._timer=b(function(){this.state=gn,this.tryEmit()},xt.interval,this),Or):gn}return mn},failTimeout:function(){return this._timer=b(function(){this.state=mn},this.options.interval,this),mn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==gn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function as(dt,xt){return xt=xt||{},xt.recognizers=pt(xt.recognizers,as.defaults.preset),new jo(dt,xt)}as.VERSION="2.0.7",as.defaults={domEvents:!1,touchAction:Gr,enable:!0,inputTarget:null,inputClass:null,preset:[[Mi,{enable:!1}],[Ln,{enable:!1},["rotate"]],[ga,{direction:lt}],[Cs,{direction:lt},["swipe"]],[ti],[ti,{event:"doubletap",taps:2},["tap"]],[Os]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var wi=1,an=2;function jo(dt,xt){this.options=R({},as.defaults,xt||{}),this.options.inputTarget=this.options.inputTarget||dt,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=dt,this.input=Oe(this),this.touchAction=new Rt(this,this.options.touchAction),qo(this,!0),B(this.options.recognizers,function(kt){var he=this.add(new kt[0](kt[1]));kt[2]&&he.recognizeWith(kt[2]),kt[3]&&he.requireFailure(kt[3])},this)}jo.prototype={set:function(dt){return R(this.options,dt),dt.touchAction&&this.touchAction.update(),dt.inputTarget&&(this.input.destroy(),this.input.target=dt.inputTarget,this.input.init()),this},stop:function(dt){this.session.stopped=dt?an:wi},recognize:function(dt){var xt=this.session;if(!xt.stopped){this.touchAction.preventDefaults(dt);var kt,he=this.recognizers,Le=xt.curRecognizer;(!Le||Le&&Le.state&gn)&&(Le=xt.curRecognizer=null);for(var Ze=0;Ze<he.length;)kt=he[Ze],xt.stopped!==an&&(!Le||kt==Le||kt.canRecognizeWith(Le))?kt.recognize(dt):kt.reset(),!Le&&kt.state&(Or|Fn|jr)&&(Le=xt.curRecognizer=kt),Ze++}},get:function(dt){if(dt instanceof on)return dt;for(var xt=this.recognizers,kt=0;kt<xt.length;kt++)if(xt[kt].options.event==dt)return xt[kt];return null},add:function(dt){if(x(dt,"add",this))return this;var xt=this.get(dt.options.event);return xt&&this.remove(xt),this.recognizers.push(dt),dt.manager=this,this.touchAction.update(),dt},remove:function(dt){if(x(dt,"remove",this))return this;if(dt=this.get(dt),dt){var xt=this.recognizers,kt=at(xt,dt);kt!==-1&&(xt.splice(kt,1),this.touchAction.update())}return this},on:function(dt,xt){if(dt!==i&&xt!==i){var kt=this.handlers;return B(Lt(dt),function(he){kt[he]=kt[he]||[],kt[he].push(xt)}),this}},off:function(dt,xt){if(dt!==i){var kt=this.handlers;return B(Lt(dt),function(he){xt?kt[he]&&kt[he].splice(at(kt[he],xt),1):delete kt[he]}),this}},emit:function(dt,xt){this.options.domEvents&&Il(dt,xt);var kt=this.handlers[dt]&&this.handlers[dt].slice();if(!(!kt||!kt.length)){xt.type=dt,xt.preventDefault=function(){xt.srcEvent.preventDefault()};for(var he=0;he<kt.length;)kt[he](xt),he++}},destroy:function(){this.element&&qo(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function qo(dt,xt){var kt=dt.element;if(kt.style){var he;B(dt.options.cssProps,function(Le,Ze){he=_t(kt.style,Ze),xt?(dt.oldCssProps[he]=kt.style[he],kt.style[he]=Le):kt.style[he]=dt.oldCssProps[he]||""}),xt||(dt.oldCssProps={})}}function Il(dt,xt){var kt=e.createEvent("Event");kt.initEvent(dt,!0,!0),kt.gesture=xt,xt.target.dispatchEvent(kt)}R(as,{INPUT_START:Gt,INPUT_MOVE:oe,INPUT_END:ie,INPUT_CANCEL:Ce,STATE_POSSIBLE:lr,STATE_BEGAN:Or,STATE_CHANGED:Fn,STATE_ENDED:jr,STATE_RECOGNIZED:gn,STATE_CANCELLED:Wn,STATE_FAILED:mn,DIRECTION_NONE:Fe,DIRECTION_LEFT:Re,DIRECTION_RIGHT:Ne,DIRECTION_UP:ke,DIRECTION_DOWN:fe,DIRECTION_HORIZONTAL:lt,DIRECTION_VERTICAL:pr,DIRECTION_ALL:er,Manager:jo,Input:Ie,TouchAction:Rt,TouchInput:Xt,MouseInput:He,PointerEventInput:Z,TouchMouseInput:ze,SingleTouchInput:Nt,Recognizer:on,AttrRecognizer:un,Tap:ti,Pan:Cs,Swipe:ga,Pinch:Ln,Rotate:Mi,Press:Os,on:gt,off:mt,each:B,merge:z,extend:Q,assign:R,inherit:G,bindFn:X,prefixed:_t});var Fl=typeof t<"u"?t:typeof self<"u"?self:{};Fl.Hammer=as,r.exports?r.exports=as:t[n]=as})(window,document,"Hammer")})(qI);var xg=qI.exports;const jc=Op({__proto__:null,default:Dp(xg)},[xg]),KI=1,WI=2,lw=4,TK={mousedown:KI,mousemove:WI,mouseup:lw};function IK(r,t){for(let e=0;e<r.length;e++)if(t(r[e]))return!0;return!1}function FK(r){const t=r.prototype.handler;r.prototype.handler=function(n){const i=this.store;n.button>0&&n.type==="pointerdown"&&(IK(i,s=>s.pointerId===n.pointerId)||i.push(n)),t.call(this,n)}}function LK(r){r.prototype.handler=function(e){let n=TK[e.type];n&KI&&e.button>=0&&(this.pressed=!0),n&WI&&e.which===0&&(n=lw),this.pressed&&(n&lw&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}FK(xg.PointerEventInput),LK(xg.MouseInput);const PK=xg.Manager;class ty{constructor(t,e,n){this.element=t,this.callback=e,this.options={enable:!0,...n}}}const MK=jc?[[jc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[jc.Rotate,{enable:!1}],[jc.Pinch,{enable:!1}],[jc.Swipe,{enable:!1}],[jc.Pan,{threshold:0,enable:!1}],[jc.Press,{enable:!1}],[jc.Tap,{event:"doubletap",taps:2,enable:!1}],[jc.Tap,{event:"anytap",enable:!1}],[jc.Tap,{enable:!1}]]:null,$I={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},UK={doubletap:["tap"]},RK={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},cw={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},OK={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},XI={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},DK=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",pf=typeof window<"u"?window:global;let uw=!1;try{const r={get passive(){return uw=!0,!0}};pf.addEventListener("test",null,r),pf.removeEventListener("test",null)}catch{uw=!1}const NK=DK.indexOf("firefox")!==-1,{WHEEL_EVENTS:kK}=cw,JI="wheel",YI=4.000244140625,QK=40,HK=.25;class zK extends ty{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;pf.WheelEvent&&(NK&&i.deltaMode===pf.WheelEvent.DOM_DELTA_PIXEL&&(s/=pf.devicePixelRatio),i.deltaMode===pf.WheelEvent.DOM_DELTA_LINE&&(s*=QK)),s!==0&&s%YI===0&&(s=Math.floor(s/YI)),i.shiftKey&&s&&(s=s*HK),this.callback({type:JI,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(kK),this.events.forEach(i=>t.addEventListener(i,this.handleEvent,uw?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===JI&&(this.options.enable=e)}}const{MOUSE_EVENTS:VK}=cw,ZI="pointermove",t3="pointerover",e3="pointerout",r3="pointerenter",n3="pointerleave";class GK extends ty{constructor(t,e,n){super(t,e,n),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(VK),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===ZI&&(this.enableMoveEvent=e),t===t3&&(this.enableOverEvent=e),t===e3&&(this.enableOutEvent=e),t===r3&&(this.enableEnterEvent=e),t===n3&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(t3,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(e3,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(r3,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(n3,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(ZI,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:jK}=cw,i3="keydown",s3="keyup";class qK extends ty{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:i3,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:s3,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(jK),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===i3&&(this.enableDownEvent=e),t===s3&&(this.enableUpEvent=e)}}const o3="contextmenu";class KK extends ty{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:o3,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===o3&&(this.options.enable=e)}}const Aw=1,ey=2,hw=4,WK={pointerdown:Aw,pointermove:ey,pointerup:hw,mousedown:Aw,mousemove:ey,mouseup:hw},$K=1,XK=2,JK=3,YK=0,ZK=1,tW=2,eW=1,rW=2,nW=4;function iW(r){const t=WK[r.srcEvent.type];if(!t)return null;const{buttons:e,button:n,which:i}=r.srcEvent;let s=!1,a=!1,o=!1;return t===hw||t===ey&&!Number.isFinite(e)?(s=i===$K,a=i===XK,o=i===JK):t===ey?(s=!!(e&eW),a=!!(e&nW),o=!!(e&rW)):t===Aw&&(s=n===YK,a=n===ZK,o=n===tW),{leftButton:s,middleButton:a,rightButton:o}}function sW(r,t){const e=r.center;if(!e)return null;const n=t.getBoundingClientRect(),i=n.width/t.offsetWidth||1,s=n.height/t.offsetHeight||1,a={x:(e.x-n.left-t.clientLeft)/i,y:(e.y-n.top-t.clientTop)/s};return{center:e,offsetCenter:a}}const dw={srcElement:"root",priority:0};class oW{constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const n=this._normalizeEvent(e);let i=e.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:a,handlersByElement:o}=this;let h=dw;typeof n=="string"||n&&n.addEventListener?h={...dw,srcElement:n}:n&&(h={...dw,...n});let f=o.get(h.srcElement);f||(f=[],o.set(h.srcElement,f));const m={type:t,handler:e,srcElement:h.srcElement,priority:h.priority};i&&(m.once=!0),s&&(m.passive=!0),a.push(m),this._active=this._active||!m.passive;let b=f.length-1;for(;b>=0&&!(f[b].priority>=m.priority);)b--;f.splice(b+1,0,m)}remove(t,e){const{handlers:n,handlersByElement:i}=this;for(let s=n.length-1;s>=0;s--){const a=n[s];if(a.type===t&&a.handler===e){n.splice(s,1);const o=i.get(a.srcElement);o.splice(o.indexOf(a),1),o.length===0&&i.delete(a.srcElement)}}this._active=n.some(s=>!s.passive)}_emit(t,e){const n=this.handlersByElement.get(e);if(n){let i=!1;const s=()=>{t.handled=!0},a=()=>{t.handled=!0,i=!0},o=[];for(let h=0;h<n.length;h++){const{type:f,handler:m,once:b}=n[h];if(m({...t,type:f,stopPropagation:s,stopImmediatePropagation:a}),b&&o.push(n[h]),i)break}for(let h=0;h<o.length;h++){const{type:f,handler:m}=o[h];this.remove(f,m)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...iW(t),...sW(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const aW={events:null,recognizers:null,recognizerOptions:{},Manager:PK,touchAction:"none",tabIndex:0};class lW{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;this._onBasicInput=i=>{const{srcEvent:s}=i,a=RK[s.type];a&&this.manager.emit(a,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...aW,...e},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,n=e.Manager;this.manager=new n(t,{touchAction:e.touchAction,recognizers:e.recognizers||MK}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys($I).forEach(i=>{const s=this.manager.get(i);s&&$I[i].forEach(a=>{s.recognizeWith(a)})});for(const i in e.recognizerOptions){const s=this.manager.get(i);if(s){const a=e.recognizerOptions[i];delete a.enable,s.set(a)}}this.wheelInput=new zK(t,this._onOtherEvent,{enable:!1}),this.moveInput=new GK(t,this._onOtherEvent,{enable:!1}),this.keyInput=new qK(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new KK(t,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,n){this._addEventHandler(t,e,n,!1)}once(t,e,n){this._addEventHandler(t,e,n,!0)}watch(t,e,n){this._addEventHandler(t,e,n,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:n}=this;if(!n)return;const i=n.get(t);if(i&&i.options.enable!==e){i.set({enable:e});const s=UK[t];s&&!this.options.recognizers&&s.forEach(a=>{const o=n.get(a);e?(o.requireFailure(t),i.dropRequireFailure(a)):o.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,n,i,s){if(typeof t!="string"){n=e;for(const m in t)this._addEventHandler(m,t[m],n,i,s);return}const{manager:a,events:o}=this,h=XI[t]||t;let f=o.get(h);f||(f=new oW(this),o.set(h,f),f.recognizerName=OK[h]||h,a&&a.on(h,f.handleEvent)),f.add(t,e,n,i,s),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const a in t)this._removeEventHandler(a,t[a]);return}const{events:n}=this,i=XI[t]||t,s=n.get(i);if(s&&(s.remove(t,e),s.isEmpty())){const{recognizerName:a}=s;let o=!1;for(const h of n.values())if(h.recognizerName===a&&!h.isEmpty()){o=!0;break}o||this._toggleRecognizer(a,!1)}}}function jh(){}const a3={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:jh,onResize:jh,onViewStateChange:jh,onInteractionStateChange:jh,onBeforeRender:jh,onAfterRender:jh,onLoad:jh,onError:r=>Bn.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:r=>{let{isDragging:t}=r;return t?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class fw{constructor(t){W(this,"props",void 0),W(this,"width",0),W(this,"height",0),W(this,"userData",{}),W(this,"canvas",null),W(this,"viewManager",null),W(this,"layerManager",null),W(this,"effectManager",null),W(this,"deckRenderer",null),W(this,"deckPicker",null),W(this,"eventManager",null),W(this,"tooltip",null),W(this,"metrics",void 0),W(this,"animationLoop",void 0),W(this,"stats",void 0),W(this,"viewState",void 0),W(this,"cursorState",void 0),W(this,"_needsRedraw",void 0),W(this,"_pickRequest",void 0),W(this,"_lastPointerDownInfo",null),W(this,"_metricsCounter",void 0),W(this,"_onPointerMove",e=>{const{_pickRequest:n}=this;if(e.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(e.leftButton||e.rightButton)return;{const i=e.offsetCenter;if(!i)return;n.x=i.x,n.y=i.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=e}),W(this,"_onEvent",e=>{const n=ST[e.type],i=e.offsetCenter;if(!n||!i||!this.layerManager)return;const s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:s,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:o}=a,h=o&&(o[n.handler]||o.props[n.handler]),f=this.props[n.handler];let m=!1;h&&(m=h.call(o,a,e)),!m&&f&&f(a,e)}),W(this,"_onPointerDown",e=>{const n=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...a3,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&Bn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),rT()==="IE"&&Bn.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new qp({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&_g.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,n,i,s,a,o,h;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(a=this.deckPicker)===null||a===void 0||a.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(h=this.tooltip)===null||h===void 0||h.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var f;(f=this.canvas.parentElement)===null||f===void 0||f.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Bn.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Bn.removed("onLayerClick","onClick")(),t.initialViewState&&!Gc(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||n||i||s||a,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return Ws(this.viewManager),this.viewManager.views}getViewports(t){return Ws(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,n){Ws(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(e).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(e).timeEnd(),s}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),Ws(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:n}=t;if(e||e===0){const s=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=s}if(n||n===0){var i;const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.position=((i=t.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var t,e;const{canvas:n}=this;if(!n)return;const i=(t=n.clientWidth)!==null&&t!==void 0?t:n.width,s=(e=n.clientHeight)!==null&&e!==void 0?e:n.height;if(i!==this.width||s!==this.height){var a,o;this.width=i,this.height=s,(a=this.viewManager)===null||a===void 0||a.setProps({width:i,height:s}),(o=this.layerManager)===null||o===void 0||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:s})}}_createAnimationLoop(t){const{width:e,height:n,gl:i,glOptions:s,debug:a,onError:o,onBeforeRender:h,onAfterRender:f,useDevicePixels:m}=t;return new V9({width:e,height:n,useDevicePixels:m,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:b=>VT({...s,...b,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:b=>this._setGLContext(b.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:h,onAfterRender:f,onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new aw({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=n.length>0;let s=i,a=!1;for(const o of n){var e;s=o,a=((e=o.layer)===null||e===void 0?void 0:e.onHover(o,t.event))||a}if(!a&&this.props.onHover&&this.props.onHover(s,t.event),this.props.getTooltip&&this.tooltip){const o=this.props.getTooltip(s);this.tooltip.setTooltip(o,s.x,s.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,ob(t,{enable:!0,copyState:!0})),this.tooltip=new SK(this.canvas),Du(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new gI;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new lW(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in ST)this.eventManager.on(i,this._onEvent);this.viewManager=new Zq({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new Yq(t,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new gK,this.deckRenderer=new _K(t),this.deckPicker=new CK(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:n}=this.layerManager.context;Du(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:n})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Bn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=Nh.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}W(fw,"defaultProps",a3),W(fw,"VERSION",$H);class pw{constructor(t,e){W(this,"opts",void 0),W(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:n}=this.source,{size:i}=e;let s=n;if(n&&n.length!==i){s=new Float32Array(i);const a=e.elementOffset||0;for(let o=0;o<i;++o)s[o]=n[a+o]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function cW(r){switch(r){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function ry(r){return r.stride||r.size*r.bytesPerElement}function l3(r,t){t.offset&&Bn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=ry(r),n=t.vertexOffset!==void 0?t.vertexOffset:r.vertexOffset||0,i=t.elementOffset||0,s=n*e+i*r.bytesPerElement+(r.offset||0);return{...t,offset:s,stride:e}}function uW(r,t){const e=l3(r,t);return{high:e,low:{...e,offset:e.offset+r.size*4}}}class AW{constructor(t,e,n){W(this,"gl",void 0),W(this,"id",void 0),W(this,"size",void 0),W(this,"settings",void 0),W(this,"value",void 0),W(this,"doublePrecision",void 0),W(this,"_buffer",void 0),W(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const i=e.logicalType||e.type,s=i===5130;let{defaultValue:a}=e;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let o;s?o=5126:!i&&e.isIndexed?o=t&&fb(t,pi.ELEMENT_INDEX_UINT32)?5125:5123:o=i||5126;let h=cW(i||o||5126);this.doublePrecision=s,s&&e.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...e,defaultType:h,defaultValue:a,logicalType:i,type:o,size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new si(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*ry(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),_g.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,s=uW(this.getAccessor(),e||{});return n[t]=new pw(this,s.high),n["".concat(t,"64Low")]=i?new pw(this,s.low):new Float32Array(this.size),n}if(e){const n=l3(this.getAccessor(),e);return{[t]:new pw(this,n)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:i}=this,s=n*i;if(e&&s&&e.length>=s){const a=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let h=0;h<s;)for(let f=0;f<i;f++){const m=e[h++];m<a[f]&&(a[f]=m),m>o[f]&&(o[f]=m)}t=[a,o]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof si?n={buffer:t}:n=t;const i={...this.settings,...n};if(e.bufferAccessor=i,e.bounds=null,n.constant){let s=n.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!e.constant||!this._areValuesEqual(s,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=s}else if(n.buffer){const s=n.buffer;e.externalBuffer=s,e.constant=!1,this.value=n.value||null;const a=n.value instanceof Float64Array;i.type=n.type||s.accessor.type,i.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(a?2:1),i.stride=ry(i)}else if(n.value){this._checkExternalBuffer(n);let s=n.value;e.externalBuffer=null,e.constant=!1,this.value=s,i.bytesPerElement=s.BYTES_PER_ELEMENT,i.stride=ry(i);const{buffer:a,byteOffset:o}=this;this.doublePrecision&&s instanceof Float64Array&&(s=ew(s,i));const h=s.byteLength+o+i.stride*2;a.byteLength<h&&a.reallocate(h),a.setAccessor(null),a.subData({data:s,offset:o}),i.type=n.type||a.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?ew(e,{size:this.size,startIndex:n,endIndex:i}):e.subarray(n,i),offset:n*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:n}=this,i=n.allocatedValue,s=_g.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=s;const{buffer:a,byteOffset:o}=this;return a.byteLength<s.byteLength+o&&(a.reallocate(s.byteLength+o),e&&i&&a.subData({data:i instanceof Float64Array?ew(i,this):i,offset:o})),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=e.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));!(e instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Bn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(e=>(e+128)/255*2-1);case 5122:return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case 5121:return new Float32Array(t).map(e=>e/255);case 5123:return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,n){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t){let a=s;for(;--a>=0;)e[n+a]=i[a];return e}switch(s){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let a=s;for(;--a>=0;)e[n+a]=Number.isFinite(t[a])?t[a]:i[a]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}}const c3=[],u3=[];function A3(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=c3;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(u3.length=r.length,n=u3):n=c3,(t>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,e),i.index=t-1),{iterable:n,objectInfo:i}}function h3(r){return r&&r[Symbol.asyncIterator]}function hW(r,t){const{size:e,stride:n,offset:i,startIndices:s,nested:a}=t,o=r.BYTES_PER_ELEMENT,h=n?n/o:e,f=i?i/o:0,m=Math.floor((r.length-f)/h);return(b,x)=>{let{index:B,target:P}=x;if(!s){const G=B*h+f;for(let X=0;X<e;X++)P[X]=r[G+X];return P}const R=s[B],Q=s[B+1]||m;let z;if(a){z=new Array(Q-R);for(let G=R;G<Q;G++){const X=G*h+f;P=new Array(e);for(let et=0;et<e;et++)P[et]=r[X+et];z[G-R]=P}}else if(h===e)z=r.subarray(R*e+f,Q*e+f);else{z=new r.constructor((Q-R)*e);let G=0;for(let X=R;X<Q;X++){const et=X*h+f;for(let pt=0;pt<e;pt++)z[G++]=r[et+pt]}}return z}}const dW=[],ny=[[0,1/0]];function fW(r,t){if(r===ny||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return r;const e=[],n=r.length;let i=0;for(let s=0;s<n;s++){const a=r[s];a[1]<t[0]?(e.push(a),i=s+1):a[0]>t[1]?e.push(a):t=[Math.min(a[0],t[0]),Math.max(a[1],t[1])]}return e.splice(i,0,t),e}function gw(r){const{source:t,target:e,start:n=0,size:i,getData:s}=r,a=r.end||e.length,o=t.length,h=a-n;if(o>h){e.set(t.subarray(0,h),n);return}if(e.set(t,n),!s)return;let f=o;for(;f<h;){const m=s(f,t);for(let b=0;b<i;b++)e[n+f]=m[b]||0,f++}}function pW(r){let{source:t,target:e,size:n,getData:i,sourceStartIndices:s,targetStartIndices:a}=r;if(!Array.isArray(a))return gw({source:t,target:e,size:n,getData:i}),e;let o=0,h=0;const f=i&&((b,x)=>i(b+h,x)),m=Math.min(s.length,a.length);for(let b=1;b<m;b++){const x=s[b]*n,B=a[b]*n;gw({source:t.subarray(o,x),target:e,start:h,end:B,size:n,getData:f}),o=x,h=B}return h<e.length&&gw({source:[],target:e,start:h,size:n,getData:f}),e}const gW={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function d3(r,t){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const e=r.type||"interpolation";return{...gW[e],...t,...r,type:e}}function f3(r,t){const e=t.getBuffer();return e?[e,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function p3(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(r,'"'))}}function g3(r){r.push(r.shift())}function mw(r,t){const{doublePrecision:e,settings:n,value:i,size:s}=r,a=e&&i instanceof Float64Array?2:1;return(n.noAlloc?i.length:t*s)*a}function m3(r){let{buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:s,getData:a=G=>G}=r;const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,h=n.size*o,f=n.byteOffset,m=n.startIndices,b=s&&m,x=mw(n,e),B=n.isConstant;if(!b&&i>=x)return;const P=B?n.value:n.getBuffer().getData({srcByteOffset:f});if(n.settings.normalized&&!B){const G=a;a=(X,et)=>n.normalizeConstant(G(X,et))}const R=B?(G,X)=>a(P,X):(G,X)=>a(P.subarray(G,G+h),X),Q=t.getData({length:i}),z=new Float32Array(x);pW({source:Q,target:z,sourceStartIndices:s,targetStartIndices:m,size:h,getData:R}),t.byteLength<z.byteLength+f&&t.reallocate(z.byteLength+f),t.subData({data:z,offset:f})}class yw extends AW{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:ny}),W(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,i=Array.isArray(e)?t[e.find(s=>t[s])]:t[e];return d3(i,n)}setNeedsUpdate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:n=0,endRow:i=1/0}=e;this.state.updateRanges=fW(this.state.updateRanges,[n,i])}else this.state.updateRanges=ny}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=dW}setNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,e.updateRanges!==ny),!0):!1}updateBuffer(t){let{numInstances:e,data:n,props:i,context:s}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:o,noAlloc:h}}=this;let f=!0;if(o){for(const[m,b]of a)o.call(s,this,{data:n,startRow:m,endRow:b,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[m,b]of a){const x=Number.isFinite(m)?this.getVertexOffset(m):0,B=Number.isFinite(b)?this.getVertexOffset(b):h||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:x,endOffset:B})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),i.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const a=t;Ws(ArrayBuffer.isView(a.value),"invalid ".concat(i.accessor));const o=!!a.size&&a.size!==this.size;return n.binaryAccessor=hW(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:e,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const n in t)Object.assign(e,super.getShaderAttributes(n,t[n]));return e}_autoUpdater(t,e){let{data:n,startRow:i,endRow:s,props:a,numInstances:o}=e;if(t.constant)return;const{settings:h,state:f,value:m,size:b,startIndices:x}=t,{accessor:B,transform:P}=h,R=f.binaryAccessor||(typeof B=="function"?B:a[B]);Ws(typeof R=="function",'accessor "'.concat(B,'" is not a function'));let Q=t.getVertexOffset(i);const{iterable:z,objectInfo:G}=A3(n,i,s);for(const X of z){G.index++;let et=R(X,G);if(P&&(et=P.call(this,et)),x){const pt=(G.index<x.length-1?x[G.index+1]:o)-x[G.index];if(et&&Array.isArray(et[0])){let gt=Q;for(const mt of et)t._normalizeValue(mt,m,gt),gt+=b}else et&&et.length>b?m.set(et,Q):(t._normalizeValue(et,G.target,0),Gq({target:m,source:G.target,start:Q,count:pt}));Q+=pt*b}else t._normalizeValue(et,m,Q),Q+=b}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class mW{constructor(t){let{gl:e,attribute:n,timeline:i}=t;W(this,"gl",void 0),W(this,"type","interpolation"),W(this,"attributeInTransition",void 0),W(this,"settings",void 0),W(this,"attribute",void 0),W(this,"transition",void 0),W(this,"currentStartIndices",void 0),W(this,"currentLength",void 0),W(this,"transform",void 0),W(this,"buffers",void 0),this.gl=e,this.transition=new wg(i),this.attribute=n,this.attributeInTransition=new yw(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=_W(e,n);const s={byteLength:0,usage:35050};this.buffers=[new si(e,s),new si(e,s)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:n,buffers:i,attribute:s}=this;g3(i);const a={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)m3({buffer:o,...a});this.currentStartIndices=s.startIndices,this.currentLength=mw(s,e),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:i[0],aTo:f3(n,s)},feedbackBuffers:{vCurrent:i[1]}})}update(){const t=this.transition.update();if(t){const{duration:e,easing:n}=this.settings,{time:i}=this.transition;let s=i/e;n&&(s=n(s)),this.transform.run({uniforms:{time:s}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const yW=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function _W(r,t){const e=p3(t.size);return new jb(r,{vs:yW,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}class vW{constructor(t){let{gl:e,attribute:n,timeline:i}=t;W(this,"gl",void 0),W(this,"type","spring"),W(this,"attributeInTransition",void 0),W(this,"settings",void 0),W(this,"attribute",void 0),W(this,"transition",void 0),W(this,"currentStartIndices",void 0),W(this,"currentLength",void 0),W(this,"texture",void 0),W(this,"framebuffer",void 0),W(this,"transform",void 0),W(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new wg(i),this.attribute=n,this.attributeInTransition=new yw(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=wW(e),this.framebuffer=xW(e,this.texture),this.transform=bW(e,n,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new si(e,s),new si(e,s),new si(e,s)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:n,buffers:i,attribute:s}=this,a={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)m3({buffer:o,...a});this.settings=t,this.currentStartIndices=s.startIndices,this.currentLength=mw(s,e),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:f3(n,s)}})}update(){const{buffers:t,transform:e,framebuffer:n,transition:i}=this;if(!i.update())return!1;const a=this.settings;return e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),g3(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),E0(n)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function bW(r,t,e){const n=p3(t.size);return new jb(r,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}function wW(r){return new Ma(r,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function xW(r,t){return new bs(r,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}const BW={interpolation:mW,spring:vW};class CW{constructor(t,e){let{id:n,timeline:i}=e;W(this,"id",void 0),W(this,"isSupported",void 0),W(this,"gl",void 0),W(this,"timeline",void 0),W(this,"transitions",void 0),W(this,"needsRedraw",void 0),W(this,"numInstances",void 0),this.id=n,this.gl=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=jb.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:e,transitions:n,numInstances:i}=t;this.numInstances=i||1;for(const s in e){const a=e[s],o=a.getTransitionSetting(n);o&&this._updateAttribute(s,a,o)}for(const s in this.transitions){const a=e[s];(!a||!a.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,n){const i=this.transitions[t];let s=!i||i.type!==n.type;if(s){if(!this.isSupported){Bn.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}i&&this._removeTransition(t);const a=BW[n.type];a?this.transitions[t]=new a({attribute:e,timeline:this.timeline,gl:this.gl}):(Bn.error("unsupported transition type '".concat(n.type,"'"))(),s=!1)}(s||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const y3="attributeManager.invalidate",EW="attributeManager.updateStart",SW="attributeManager.updateEnd",TW="attribute.updateStart",IW="attribute.allocate",FW="attribute.updateEnd";class LW{constructor(t){let{id:e="attribute-manager",stats:n,timeline:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};W(this,"id",void 0),W(this,"gl",void 0),W(this,"attributes",void 0),W(this,"updateTriggers",void 0),W(this,"needsRedraw",void 0),W(this,"userData",void 0),W(this,"stats",void 0),W(this,"attributeTransitionManager",void 0),W(this,"mergeBoundsMemoized",mg(Rq)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new CW(t,{id:"".concat(e,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);uo(y3,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);uo(y3,this,"all")}update(t){let{data:e,numInstances:n,startIndices:i=null,transitions:s,props:a={},buffers:o={},context:h={}}=t,f=!1;uo(EW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const m in this.attributes){const b=this.attributes[m],x=b.settings.accessor;b.startIndices=i,b.numInstances=n,a[m]&&Bn.removed("props.".concat(m),"data.attributes.".concat(m))(),b.setExternalBuffer(o[m])||b.setBinaryValue(typeof x=="string"?o[x]:void 0,e.startIndices)||typeof x=="string"&&!o[x]&&b.setConstantValue(a[x])||b.needsUpdate()&&(f=!0,this._updateAttribute({attribute:b,numInstances:n,data:e,props:a,context:h})),this.needsRedraw=this.needsRedraw||b.needsRedraw()}f&&uo(SW,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map(n=>{var i;return(i=this.attributes[n])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(e)}getChangedAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:e,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const s in e){const a=e[s];a.needsRedraw(t)&&!n.hasAttribute(s)&&(i[s]=a)}return i}getShaderAttributes(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t||(t=this.getAttributes());const n={};for(const i in t)e[i]||Object.assign(n,t[i].getShaderAttributes());return n}_add(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const n in t){const i=t[n];this.attributes[n]=this._createAttribute(n,i,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,n){const i={...e,id:t,size:e.isIndexed&&1||e.size||1,divisor:n.instanced?1:e.divisor||0};return new yw(this.gl,i)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:i}=this,s=i[t];return s&&s.forEach(a=>{const o=n[a];o&&o.setNeedsUpdate(o.id,e)}),s}_updateAttribute(t){const{attribute:e,numInstances:n}=t;if(uo(TW,e),e.constant){e.setConstantValue(e.value);return}e.allocate(n)&&uo(IW,e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,uo(FW,e,n))}}class PW extends wg{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:i,easing:s}}=this,a=s(t/i);this._value=O0(e,n,a)}}const _3=1e-5;function v3(r,t,e,n,i){const s=t-r,o=(e-t)*i,h=-s*n;return o+h+s+t}function MW(r,t,e,n,i){if(Array.isArray(e)){const s=[];for(let a=0;a<e.length;a++)s[a]=v3(r[a],t[a],e[a],n,i);return s}return v3(r,t,e,n,i)}function b3(r,t){if(Array.isArray(r)){let e=0;for(let n=0;n<r.length;n++){const i=r[n]-t[n];e+=i*i}return Math.sqrt(e)}return Math.abs(r-t)}class UW extends wg{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:i}=this.settings,{_prevValue:s=t,_currValue:a=t}=this;let o=MW(s,a,e,n,i);const h=b3(o,e),f=b3(o,a);h<_3&&f<_3&&(o=e,this.end()),this._prevValue=a,this._currValue=o}}const RW={interpolation:PW,spring:UW};class OW{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,i){const{transitions:s}=this;if(s.has(t)){const h=s.get(t),{value:f=h.settings.fromValue}=h;e=f,this.remove(t)}if(i=d3(i),!i)return;const a=RW[i.type];if(!a){Bn.error("unsupported transition type '".concat(i.type,"'"))();return}const o=new a(this.timeline);o.start({...i,fromValue:e,toValue:n}),s.set(t,o)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function DW(r){const t=r[OA];for(const e in t){const n=t[e],{validate:i}=n;if(i&&!i(r[e],n))throw new Error("Invalid prop ".concat(e,": ").concat(r[e]))}}function NW(r,t){const e=w3({newProps:r,oldProps:t,propTypes:r[OA],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=QW(r,t);let i=!1;return n||(i=HW(r,t)),{dataChanged:n,propsChanged:e,updateTriggersChanged:i,extensionsChanged:zW(r,t),transitionsChanged:kW(r,t)}}function kW(r,t){if(!r.transitions)return!1;const e={},n=r[OA];let i=!1;for(const s in r.transitions){const a=n[s],o=a&&a.type;(o==="number"||o==="color"||o==="array")&&_w(r[s],t[s],a)&&(e[s]=!0,i=!0)}return i?e:!1}function w3(r){let{newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:s="props"}=r;if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(const a of Object.keys(t))if(!(a in n)){if(!(a in e))return"".concat(s,".").concat(a," added");const o=_w(t[a],e[a],i[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}for(const a of Object.keys(e))if(!(a in n)){if(!(a in t))return"".concat(s,".").concat(a," dropped");if(!Object.hasOwnProperty.call(t,a)){const o=_w(t[a],e[a],i[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}}return!1}function _w(r,t,e){let n=e&&e.equal;return n&&!n(r,t,e)||!n&&(n=r&&t&&r.equals,n&&!n.call(r,t))?"changed deeply":!n&&t!==r?"changed shallowly":null}function QW(r,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,t.data)||(e="Data comparator detected a change"):r.data!==t.data&&(e="A new data container was supplied"),e&&i&&(e=i(r.data,t.data)||e),e}function HW(r,t){if(t===null)return{all:!0};if("all"in r.updateTriggers&&x3(r,t,"all"))return{all:!0};const e={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&x3(r,t,i)&&(e[i]=!0,n=!0);return n?e:!1}function zW(r,t){if(t===null)return!0;const e=t.extensions,{extensions:n}=r;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(e[i]))return!0;return!1}function x3(r,t,e){let n=r.updateTriggers[e];n=n??{};let i=t.updateTriggers[e];return i=i??{},w3({oldProps:i,newProps:n,triggerName:e})}const VW="count(): argument not an object",GW="count(): argument not a container";function jW(r){if(!KW(r))throw new Error(VW);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(qW(r))return Object.keys(r).length;throw new Error(GW)}function qW(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function KW(r){return r!==null&&typeof r=="object"}function WW(r,t){if(!t)return r;const e={...r,...t};if("defines"in t&&(e.defines={...r.defines,...t.defines}),"modules"in t&&(e.modules=(r.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=e.modules.findIndex(i=>i.name==="project32");n>=0&&e.modules.splice(n,1)}if("inject"in t)if(!r.inject)e.inject=t.inject;else{const n={...r.inject};for(const i in t.inject)n[i]=(n[i]||"")+t.inject[i];e.inject=n}return e}const $W={10241:9987,10240:9729,10242:33071,10243:33071},vw={};function XW(r,t,e,n){if(e instanceof Ma)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={10241:e.data.length>1?9985:9729});const s=new Ma(t,{...e,parameters:{...$W,...i,...n}});return vw[s.id]=r,s}function JW(r,t){!t||!(t instanceof Ma)||vw[t.id]===r&&(t.delete(),delete vw[t.id])}const YW={boolean:{validate(r,t){return!0},equal(r,t,e){return!!r==!!t}},number:{validate(r,t){return Number.isFinite(r)&&(!("max"in t)||r<=t.max)&&(!("min"in t)||r>=t.min)}},color:{validate(r,t){return t.optional&&!r||bw(r)&&(r.length===3||r.length===4)},equal(r,t,e){return Gc(r,t,1)}},accessor:{validate(r,t){const e=iy(r);return e==="function"||e===iy(t.value)},equal(r,t,e){return typeof t=="function"?!0:Gc(r,t,1)}},array:{validate(r,t){return t.optional&&!r||bw(r)},equal(r,t,e){const{compare:n}=e,i=Number.isInteger(n)?n:n?1:0;return n?Gc(r,t,i):r===t}},object:{equal(r,t,e){if(e.ignore)return!0;const{compare:n}=e,i=Number.isInteger(n)?n:n?1:0;return n?Gc(r,t,i):r===t}},function:{validate(r,t){return t.optional&&!r||typeof r=="function"},equal(r,t,e){return!e.compare&&e.ignore!==!1||r===t}},data:{transform:(r,t,e)=>{const{dataTransform:n}=e.props;return n&&r?n(r):r}},image:{transform:(r,t,e)=>{const n=e.context;return!n||!n.gl?null:XW(e.id,n.gl,r,{...t.parameters,...e.props.textureParameters})},release:(r,t,e)=>{JW(e.id,r)}}};function ZW(r){const t={},e={},n={};for(const[i,s]of Object.entries(r)){const a=s==null?void 0:s.deprecatedFor;if(a)n[i]=Array.isArray(a)?a:[a];else{const o=t$(i,s);t[i]=o,e[i]=o.value}}return{propTypes:t,defaultProps:e,deprecatedProps:n}}function t$(r,t){switch(iy(t)){case"object":return Bg(r,t);case"array":return Bg(r,{type:"array",value:t,compare:!1});case"boolean":return Bg(r,{type:"boolean",value:t});case"number":return Bg(r,{type:"number",value:t});case"function":return Bg(r,{type:"function",value:t,compare:!0});default:return{name:r,type:"unknown",value:t}}}function Bg(r,t){return"type"in t?{name:r,...YW[t.type],...t}:"value"in t?{name:r,type:iy(t.value),...t}:{name:r,type:"object",value:t}}function bw(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function iy(r){return bw(r)?"array":r===null?"null":typeof r}function e$(r,t){let e;for(let s=t.length-1;s>=0;s--){const a=t[s];"extensions"in a&&(e=a.extensions)}const n=ww(r.constructor,e),i=Object.create(n);i[J0]=r,i[Vh]={},i[DA]={};for(let s=0;s<t.length;++s){const a=t[s];for(const o in a)i[o]=a[o]}return Object.freeze(i),i}const r$="_mergedDefaultProps";function ww(r,t){let e=r$;if(t)for(const i of t){const s=i.constructor;s&&(e+=":".concat(s.extensionName||s.name))}const n=B3(r,e);return n||(r[e]=n$(r,t||[]))}function n$(r,t){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=ww(n),s=B3(r,"defaultProps")||{},a=ZW(s),o=Object.assign(Object.create(null),i,a.defaultProps),h=Object.assign(Object.create(null),i==null?void 0:i[OA],a.propTypes),f=Object.assign(Object.create(null),i==null?void 0:i[nw],a.deprecatedProps);for(const m of t){const b=ww(m.constructor);b&&(Object.assign(o,b),Object.assign(h,b[OA]),Object.assign(f,b[nw]))}return i$(o,r),o$(o,h),s$(o,f),o[OA]=h,o[nw]=f,t.length===0&&!xw(r,"_propTypes")&&(r._propTypes=h),o}function i$(r,t){const e=l$(t);Object.defineProperties(r,{id:{writable:!0,value:e}})}function s$(r,t){for(const e in t)Object.defineProperty(r,e,{enumerable:!1,set(n){const i="".concat(this.id,": ").concat(e);for(const s of t[e])xw(this,s)||(this[s]=n);Bn.deprecated(i,t[e].join("/"))()}})}function o$(r,t){const e={},n={};for(const i in t){const s=t[i],{name:a,value:o}=s;s.async&&(e[a]=o,n[a]=a$(a))}r[df]=e,r[Vh]={},Object.defineProperties(r,n)}function a$(r){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||h3(t)?this[Vh][r]=t:this[DA][r]=t},get(){if(this[DA]){if(r in this[DA])return this[DA][r]||this[df][r];if(r in this[Vh]){const t=this[J0]&&this[J0].internalState;if(t&&t.hasAsyncProp(r))return t.getAsyncProp(r)||this[df][r]}}return this[df][r]}}}function xw(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function B3(r,t){return xw(r,t)&&r[t]}function l$(r){const t=r.componentName;return t||Bn.warn("".concat(r.name,".componentName not specified"))(),t||r.name}let c$=0;class Bw{constructor(){W(this,"id",void 0),W(this,"props",void 0),W(this,"count",void 0);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.props=e$(this,e),this.id=this.props.id,this.count=c$++}clone(t){const{props:e}=this,n={};for(const i in e[df])i in e[DA]?n[i]=e[DA][i]:i in e[Vh]&&(n[i]=e[Vh][i]);return new this.constructor({...e,...n,...t})}}W(Bw,"componentName","Component"),W(Bw,"defaultProps",{});const u$=Object.freeze({});class A${constructor(t){W(this,"component",void 0),W(this,"onAsyncPropUpdated",void 0),W(this,"asyncProps",void 0),W(this,"oldProps",void 0),W(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||u$}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[J0]||this.component;const e=t[DA]||{},n=t[Vh]||t,i=t[df]||{};for(const s in e){const a=e[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a),e[s]=this.getAsyncProp(s)}for(const s in n){const a=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(h3(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e===n.resolvedValue||e===n.lastValue?!1:(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;e.then(s=>{this.component&&(s=this._postProcessValue(n,s),this._setAsyncPropValue(t,s,i),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let s=[],a=0;for await(const o of e){if(!this.component)return;const{dataTransform:h}=this.component.props;h?s=h(o,s):s=s.concat(o),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(t,s,i)}this._onResolve(t,s)}_postProcessValue(t,e){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const i=this.component&&this.component.props[OA];this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class h$ extends A${constructor(t){let{attributeManager:e,layer:n}=t;super(n),W(this,"attributeManager",void 0),W(this,"needsRedraw",void 0),W(this,"needsUpdate",void 0),W(this,"subLayers",void 0),W(this,"usesPickingColorCache",void 0),W(this,"hasPickingBuffer",void 0),W(this,"changeFlags",void 0),W(this,"viewport",void 0),W(this,"uniformTransitions",void 0),W(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(e,{propName:t,layer:n}):super._fetch(t,e)}_onResolve(t,e){const n=this.layer;if(n){const i=n.props.onDataLoad;t==="data"&&i&&i(e,{propName:t,layer:n})}}_onError(t,e){const n=this.layer;n&&n.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const d$="layer.changeFlag",f$="layer.initialize",p$="layer.update",g$="layer.finalize",m$="layer.matched",C3=2**24-1,y$=Object.freeze([]),_$=mg(r=>{let{oldViewport:t,viewport:e}=r;return t.equals(e)});let qc=new Uint8ClampedArray(0);const v$={data:{type:"data",value:y$,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,t)=>{let{propName:e,layer:n,loaders:i,loadOptions:s,signal:a}=t;const{resourceManager:o}=n.context;if(s=s||n.getLoadOptions(),i=i||n.props.loaders,a){var h;s={...s,fetch:{...(h=s)===null||h===void 0?void 0:h.fetch,signal:a}}}let f=o.contains(r);return!f&&!s&&(o.add({resourceId:r,data:FA(r,i),persistent:!1}),f=!0),f?o.subscribe({resourceId:r,onChange:m=>{var b;return(b=n.internalState)===null||b===void 0?void 0:b.reloadAsyncProp(e,m)},consumerId:n.id,requestId:e}):FA(r,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:xn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:r=>{let{layerIndex:t}=r;return[0,-t*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class gf extends Bw{constructor(){super(...arguments),W(this,"internalState",null),W(this,"lifecycle",hf.NO_STATE),W(this,"context",void 0),W(this,"state",void 0),W(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){Ws(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=DI(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,a]=II(n,e.pixelProjectionMatrix);return t.length===2?[i,s]:[i,s,a]}unproject(t){return Ws(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){Ws(this.internalState);const n=this.internalState.viewport||this.context.viewport;return Hq(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===xn.DEFAULT||t===xn.LNGLAT||t===xn.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){Ws(t instanceof Uint8Array);const[e,n,i]=t;return e+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:jW(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())===null||t===void 0?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=WW(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const i of n)e.invalidateAll(i);else e.invalidateAll();if(e){const{props:i}=t,s=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(s!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:o,instancePickingColors:h}=e.attributes,f=o||h;f&&(a&&f.constant&&(f.constant=!1,e.invalidate(f.id)),!f.value&&!a&&(f.constant=!0,f.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo(t){let{info:e,mode:n,sourceLayer:i}=t;const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(t,e){var n,i;if(e&&(t=new Error("".concat(e,": ").concat(t.message),{cause:t})),!((n=(i=this.props).onError)!==null&&n!==void 0&&n.call(i,t))){var s,a;(s=this.context)===null||s===void 0||(a=s.onError)===null||a===void 0||a.call(s,t,this)}}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!_$({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const i in e)Object.defineProperty(n,i,{value:e[i]});return n}return this.props}calculateInstancePickingColors(t,e){let{numInstances:n}=e;if(t.constant)return;const i=Math.floor(qc.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>C3&&Bn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),qc=_g.allocate(qc,n,{size:3,copy:!0,maxCount:Math.max(n,C3)});const s=Math.floor(qc.length/3),a=[];for(let o=i;o<s;o++)this.encodePickingColor(o,a),qc[o*3+0]=a[0],qc[o*3+1]=a[1],qc[o*3+2]=a[2]}t.value=qc.subarray(0,n*3)}_setModelAttributes(t,e){const n=this.getAttributeManager(),i=t.userData.excludeAttributes||{},s=n.getShaderAttributes(e,i);t.setAttributes(s)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i,a=s&&e.attributes&&e.attributes[s.id];if(a&&a.value){const o=a.value,h=this.encodePickingColor(t);for(let f=0;f<e.length;f++){const m=s.getVertexOffset(f);o[m]===h[0]&&o[m+1]===h[1]&&o[m+2]===h[2]&&this._disablePickingIndex(f)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;if(!i)return;const s=i.getVertexOffset(t),a=i.getVertexOffset(t+1);i.buffer.subData({data:new Uint8Array(a-s),offset:s})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==qc.buffer&&(n.value=qc.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Ws(!this.internalState),Ws(Number.isFinite(this.props.coordinateSystem)),uo(f$,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new h$({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Bn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new OW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){uo(m$,this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(uo(p$,this,t),!t)return;const e=this.props,n=this.context,i=this.internalState,s=n.viewport,a=this._updateUniformTransition();i.propsInTransition=a,n.viewport=i.viewport||s,this.props=a;try{const o=this._getUpdateParams(),h=this.getModels();if(n.gl)this.updateState(o);else try{this.updateState(o)}catch{}for(const m of this.props.extensions)m.updateState.call(this,o,m);const f=this.getModels()[0]!==h[0];this._postUpdate(o,f)}finally{n.viewport=s,this.props=e,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){uo(g$,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:e=null,uniforms:n={},parameters:i={}}=t;this._updateAttributeTransition();const s=this.props,a=this.context;this.props=this.internalState.propsInTransition||s;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:h}=this.props,f=h&&h(n)||[0,0];Du(a.gl,{polygonOffset:f}),tc(a.gl,i,()=>{const m={moduleParameters:e,uniforms:n,parameters:i,context:a};for(const b of this.props.extensions)b.draw.call(this,m,b);this.draw(m)})}finally{this.props=s}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const i in t)if(t[i]){let s=!1;switch(i){case"dataChanged":const a=t[i],o=e[i];a&&Array.isArray(o)&&(e.dataChanged=Array.isArray(a)?o.concat(a):a,s=!0);default:e[i]||(e[i]=t[i],s=!0)}s&&uo(d$,this,i,t)}const n=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=NW(t,e);if(n.updateTriggersChanged)for(const s in n.updateTriggersChanged)n.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(n.transitionsChanged)for(const s in n.transitionsChanged){var i;this.internalState.uniformTransitions.add(s,e[s],t[s],(i=t.transitions)===null||i===void 0?void 0:i[s])}return this.setChangeFlags(n)}validateProps(){DW(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(e.pickingHighlightColor=n(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new LW(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:i}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:o,highlightColor:h}=n;if(e||i.autoHighlight!==a||i.highlightedObjectIndex!==o||i.highlightColor!==h){const f={};a||(f.pickingSelectedColor=null),Array.isArray(h)&&(f.pickingHighlightColor=h),(e||o!==i.highlightedObjectIndex)&&(f.pickingSelectedColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setModuleParameters(f)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(t):!1;if(e=e||i,e)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}W(gf,"defaultProps",v$),W(gf,"layerName","Layer");const b$="compositeLayer.renderLayers";class E3 extends gf{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:e}=t;const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,i)}return t}getSubLayerProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var e;const{opacity:n,pickable:i,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:h,autoHighlight:f,highlightColor:m,coordinateSystem:b,coordinateOrigin:x,wrapLongitude:B,positionFormat:P,modelMatrix:R,extensions:Q,fetch:z,operation:G,_subLayerProps:X}=this.props,et={id:"",updateTriggers:{},opacity:n,pickable:i,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:h,autoHighlight:f,highlightColor:m,coordinateSystem:b,coordinateOrigin:x,wrapLongitude:B,positionFormat:P,modelMatrix:R,extensions:Q,fetch:z,operation:G},pt=X&&t.id&&X[t.id],gt=pt&&pt.updateTriggers,mt=t.id||"sublayer";if(pt){const ft=this.props[OA],Mt=t.type?t.type._propTypes:{};for(const Lt in pt){const at=Mt[Lt]||ft[Lt];at&&at.type==="accessor"&&(pt[Lt]=this.getSubLayerAccessor(pt[Lt]))}}Object.assign(et,t,pt),et.id="".concat(this.props.id,"-").concat(mt),et.updateTriggers={all:(e=this.props.updateTriggers)===null||e===void 0?void 0:e.all,...t.updateTriggers,...gt};for(const ft of Q){const Mt=ft.getSubLayerProps.call(this,ft);Mt&&Object.assign(et,Mt,{updateTriggers:Object.assign(et.updateTriggers,Mt.updateTriggers)})}return et}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const s=this.renderLayers();n=Y0(s,Boolean),this.internalState.subLayers=n}uo(b$,this,i,n);for(const s of n)s.parent=this}}W(E3,"layerName","CompositeLayer");const Cw=512,w$=Math.PI/180;function x$(r){let{map:t,gl:e,deck:n}=r;if(t.__deck)return t.__deck;const i=n==null?void 0:n.props._customRender,s=n==null?void 0:n.props.onLoad,a=C$({...n==null?void 0:n.props,_customRender:()=>{t.triggerRepaint(),i==null||i("")}});let o;return(!n||n.props.gl===e)&&(Object.assign(a,{gl:e,width:null,height:null,touchAction:"unset",viewState:Ew(t)}),n!=null&&n.isInitialized?S3(n,t):a.onLoad=()=>{s==null||s(),S3(o,t)}),n?(o=n,n.setProps(a),n.userData.isExternal=!0):(o=new fw(a),t.on("remove",()=>{B$(t)})),o.userData.mapboxLayers=new Set,t.__deck=o,t.on("render",()=>{o.isInitialized&&L$(o,t)}),o}function S3(r,t){const e=()=>{r.isInitialized?P$(r,t):t.off("move",e)};t.on("move",e)}function B$(r){var t;(t=r.__deck)===null||t===void 0||t.finalize(),r.__deck=null}function C$(r){return{...r,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...r.parameters},views:r.views||[new aw({id:"mapbox"})]}}function E$(r,t){r.userData.mapboxLayers.add(t),Sw(r)}function S$(r,t){r.userData.mapboxLayers.delete(t),Sw(r)}function T$(r,t){Sw(r)}function I$(r,t,e){let{currentViewport:n}=r.userData,i=!1;n||(n=T3(r,t,!0),r.userData.currentViewport=n,i=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:s=>{let{layer:a}=s;return e.id===a.id||a.props.operation.includes("terrain")},clearStack:i,clearCanvas:!1})}function Ew(r){var t;const{lng:e,lat:n}=r.getCenter(),i={longitude:(e+540)%360-180,latitude:n,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(t=r.getTerrain)!==null&&t!==void 0&&t.call(r)&&F$(r,i),i}function F$(r,t){if(r.getFreeCameraOptions){const{position:e}=r.getFreeCameraOptions();if(!e||e.z===void 0)return;const n=r.transform.height,{longitude:i,latitude:s,pitch:a}=t,o=e.x*Cw,h=(1-e.y)*Cw,f=e.z*Cw,m=yg([i,s]),b=o-m[0],x=h-m[1],B=Math.sqrt(b*b+x*x),P=a*w$,R=1.5*n,Q=P<.001?R*Math.cos(P)/f:R*Math.sin(P)/B;t.zoom=Math.log2(Q);const z=R*Math.cos(P)/Q,G=f-z;t.position=[0,0,G/$0(s)]}else typeof r.transform.elevation=="number"&&(t.position=[0,0,r.transform.elevation])}function T3(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new zh({id:"mapbox",x:0,y:0,width:r.width,height:r.height,...Ew(t),nearZMultiplier:e?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function L$(r,t){const{mapboxLayers:e,isExternal:n}=r.userData;if(n){const i=Array.from(e,m=>m.id),a=Y0(r.props.layers,Boolean).some(m=>m&&!i.includes(m.id));let o=r.getViewports();const h=o.findIndex(m=>m.id==="mapbox"),f=o.length>1||h<0;(a||f)&&(h>=0&&(o=o.slice(),o[h]=T3(r,t,!1)),r._drawLayers("mapbox-repaint",{viewports:o,layerFilter:m=>(!r.props.layerFilter||r.props.layerFilter(m))&&(m.viewport.id!=="mapbox"||!i.includes(m.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function P$(r,t){r.setProps({viewState:Ew(t)}),r.needsRedraw({clearRedrawFlags:!0})}function Sw(r){if(r.userData.isExternal)return;const t=[];r.userData.mapboxLayers.forEach(e=>{const n=e.props.type,i=new n(e.props);t.push(i)}),r.setProps({layers:t})}class M${constructor(t){if(W(this,"id",void 0),W(this,"type",void 0),W(this,"renderingMode",void 0),W(this,"map",void 0),W(this,"deck",void 0),W(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,e){this.map=t,this.deck=x$({map:t,gl:e,deck:this.props.deck}),E$(this.deck,this)}onRemove(){this.deck&&S$(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&T$(this.deck)}render(){I$(this.deck,this.map,this)}}const U$=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,R$=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,I3=[0,0,0,255],F3=[0,0,1],O$={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:F3},getColor:{type:"accessor",value:I3},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function D$(r){const{header:t,attributes:e}=r;!t||!e||(r.length=t.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0&&(e.instanceColors=e.COLOR_0))}class Tw extends gf{getShaders(){return super.getShaders({vs:U$,fs:R$,modules:[iw,uj,sw]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:F3},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:I3}})}updateState(t){const{changeFlags:e,props:n}=t;if(super.updateState(t),e.extensionsChanged){var i;const{gl:s}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}e.dataChanged&&D$(n.data)}draw(t){let{uniforms:e}=t;const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:eb[i],radiusPixels:n}).draw()}_getModel(t){const e=[];for(let n=0;n<3;n++){const i=n/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new of(t,{...this.getShaders(),id:this.props.id,geometry:new gg({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}W(Tw,"layerName","PointCloudLayer"),W(Tw,"defaultProps",O$);const Da={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new ce,new ce;const Cg=new ce,L3=new ce;class Eg{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;W(this,"center",void 0),W(this,"radius",void 0),this.radius=-0,this.center=new ce,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=Cg.from(e),this.center=new ce().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Eg(this.center,this.radius)}union(t){const e=this.center,n=this.radius,i=t.center,s=t.radius,a=Cg.copy(i).subtract(e),o=a.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return t.clone();const h=(n+o+s)*.5;return L3.copy(a).scale((-n+h)/o).add(e),this.center.copy(L3),this.radius=h,this}expand(t){const n=Cg.from(t).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(t){this.center.transform(t);const e=vG(Cg,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const n=Cg.from(t).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(t){const e=this.center,n=this.radius,s=t.normal.dot(e)+t.distance;return s<-n?Da.OUTSIDE:s<n?Da.INTERSECTING:Da.INSIDE}}const N$=new ce,k$=new ce,sy=new ce,oy=new ce,ay=new ce,Q$=new ce,H$=new ce,Gu={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Sg{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];W(this,"center",void 0),W(this,"halfAxes",void 0),this.center=new ce().from(t),this.halfAxes=new Di(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new ce(t).len(),new ce(e).len(),new ce(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new ce(t).normalize(),s=new ce(e).normalize(),a=new ce(n).normalize();return new dg().fromMatrix3(new Di([...i,...s,...a]))}fromCenterHalfSizeQuaternion(t,e,n){const i=new dg(n),s=new Di().fromQuaternion(i);return s[0]=s[0]*e[0],s[1]=s[1]*e[0],s[2]=s[2]*e[0],s[3]=s[3]*e[1],s[4]=s[4]*e[1],s[5]=s[5]*e[1],s[6]=s[6]*e[2],s[7]=s[7]*e[2],s[8]=s[8]*e[2],this.center=new ce().from(t),this.halfAxes=s,this}clone(){return new Sg(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Eg;const e=this.halfAxes,n=e.getColumn(0,sy),i=e.getColumn(1,oy),s=e.getColumn(2,ay),a=N$.copy(n).add(i).add(s);return t.center.copy(this.center),t.radius=a.magnitude(),t}intersectPlane(t){const e=this.center,n=t.normal,i=this.halfAxes,s=n.x,a=n.y,o=n.z,h=Math.abs(s*i[Gu.COLUMN0ROW0]+a*i[Gu.COLUMN0ROW1]+o*i[Gu.COLUMN0ROW2])+Math.abs(s*i[Gu.COLUMN1ROW0]+a*i[Gu.COLUMN1ROW1]+o*i[Gu.COLUMN1ROW2])+Math.abs(s*i[Gu.COLUMN2ROW0]+a*i[Gu.COLUMN2ROW1]+o*i[Gu.COLUMN2ROW2]),f=n.dot(e)+t.distance;return f<=-h?Da.OUTSIDE:f>=h?Da.INSIDE:Da.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=k$.from(t).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,sy),s=n.getColumn(1,oy),a=n.getColumn(2,ay),o=i.magnitude(),h=s.magnitude(),f=a.magnitude();i.normalize(),s.normalize(),a.normalize();let m=0,b;return b=Math.abs(e.dot(i))-o,b>0&&(m+=b*b),b=Math.abs(e.dot(s))-h,b>0&&(m+=b*b),b=Math.abs(e.dot(a))-f,b>0&&(m+=b*b),m}computePlaneDistances(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=this.center,o=this.halfAxes,h=o.getColumn(0,sy),f=o.getColumn(1,oy),m=o.getColumn(2,ay),b=Q$.copy(h).add(f).add(m).add(a),x=H$.copy(b).subtract(t);let B=e.dot(x);return i=Math.min(B,i),s=Math.max(B,s),b.copy(a).add(h).add(f).subtract(m),x.copy(b).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),b.copy(a).add(h).subtract(f).add(m),x.copy(b).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),b.copy(a).add(h).subtract(f).subtract(m),x.copy(b).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),a.copy(b).subtract(h).add(f).add(m),x.copy(b).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),a.copy(b).subtract(h).add(f).subtract(m),x.copy(b).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),a.copy(b).subtract(h).subtract(f).add(m),x.copy(b).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),a.copy(b).subtract(h).subtract(f).subtract(m),x.copy(b).subtract(t),B=e.dot(x),i=Math.min(B,i),s=Math.max(B,s),n[0]=i,n[1]=s,n}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,sy);e.transformAsPoint(t);const n=this.halfAxes.getColumn(1,oy);n.transformAsPoint(t);const i=this.halfAxes.getColumn(2,ay);return i.transformAsPoint(t),this.halfAxes=new Di([...e,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const P3=new ce,M3=new ce;class sc{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;W(this,"normal",void 0),W(this,"distance",void 0),this.normal=new ce,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return ec(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=P3.from(t),this.normal.from(e).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,e,n,i){return this.normal.set(t,e,n),ec(rc(this.normal.len(),1)),this.distance=i,this}clone(){return new sc(this.normal,this.distance)}equals(t){return rc(this.distance,t.distance)&&rc(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=M3.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}projectPointOntoPlane(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];t=P3.from(t);const n=this.getPointDistance(t),i=M3.copy(this.normal).scale(n);return t.subtract(i).to(e)}}const U3=[new ce([1,0,0]),new ce([0,1,0]),new ce([0,0,1])],R3=new ce,z$=new ce;new sc(new ce(1,0,0),0);class ml{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];W(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*U3.length;const e=t.center,n=t.radius;let i=0;for(const s of U3){let a=this.planes[i],o=this.planes[i+1];a||(a=this.planes[i]=new sc),o||(o=this.planes[i+1]=new sc);const h=R3.copy(s).scale(-n).add(e);-s.dot(h),a.fromPointNormal(h,s);const f=R3.copy(s).scale(n).add(e),m=z$.copy(s).negate();-m.dot(f),o.fromPointNormal(f,m),i+=2}return this}computeVisibility(t){let e=Da.INSIDE;for(const n of this.planes)switch(t.intersectPlane(n)){case Da.OUTSIDE:return Da.OUTSIDE;case Da.INTERSECTING:e=Da.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(ec(Number.isFinite(e),"parentPlaneMask is required."),e===ml.MASK_OUTSIDE||e===ml.MASK_INSIDE)return e;let n=ml.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const a=s<31?1<<s:0;if(s<31&&!(e&a))continue;const o=i[s],h=t.intersectPlane(o);if(h===Da.OUTSIDE)return ml.MASK_OUTSIDE;h===Da.INTERSECTING&&(n|=a)}return n}}W(ml,"MASK_OUTSIDE",4294967295),W(ml,"MASK_INSIDE",0),W(ml,"MASK_INDETERMINATE",2147483647),new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce;const Kc=new Di,V$=new Di,G$=new Di,ly=new Di,O3=new Di;function j$(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=fg.EPSILON20,n=10;let i=0,s=0;const a=V$,o=G$;a.identity(),o.copy(r);const h=e*q$(o);for(;s<n&&K$(o)>h;)W$(o,ly),O3.copy(ly).transpose(),o.multiplyRight(ly),o.multiplyLeft(O3),a.multiplyRight(ly),++i>2&&(++s,i=0);return t.unitary=a.toTarget(t.unitary),t.diagonal=o.toTarget(t.diagonal),t}function q$(r){let t=0;for(let e=0;e<9;++e){const n=r[e];t+=n*n}return Math.sqrt(t)}const Iw=[1,0,0],Fw=[2,2,1];function K$(r){let t=0;for(let e=0;e<3;++e){const n=r[Kc.getElementIndex(Fw[e],Iw[e])];t+=2*n*n}return Math.sqrt(t)}function W$(r,t){const e=fg.EPSILON15;let n=0,i=1;for(let f=0;f<3;++f){const m=Math.abs(r[Kc.getElementIndex(Fw[f],Iw[f])]);m>n&&(i=f,n=m)}const s=Iw[i],a=Fw[i];let o=1,h=0;if(Math.abs(r[Kc.getElementIndex(a,s)])>e){const f=r[Kc.getElementIndex(a,a)],m=r[Kc.getElementIndex(s,s)],b=r[Kc.getElementIndex(a,s)],x=(f-m)/2/b;let B;x<0?B=-1/(-x+Math.sqrt(1+x*x)):B=1/(x+Math.sqrt(1+x*x)),o=1/Math.sqrt(1+B*B),h=B*o}return Di.IDENTITY.to(t),t[Kc.getElementIndex(s,s)]=t[Kc.getElementIndex(a,a)]=o,t[Kc.getElementIndex(a,s)]=h,t[Kc.getElementIndex(s,a)]=-h,t}const HA=new ce,$$=new ce,X$=new ce,J$=new ce,Y$=new ce,Z$=new Di,tX={diagonal:new Di,unitary:new Di};function eX(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Sg;if(!r||r.length===0)return t.halfAxes=new Di([0,0,0,0,0,0,0,0,0]),t.center=new ce,t;const e=r.length,n=new ce(0,0,0);for(const Mt of r)n.add(Mt);const i=1/e;n.multiplyByScalar(i);let s=0,a=0,o=0,h=0,f=0,m=0;for(const Mt of r){const Lt=HA.copy(Mt).subtract(n);s+=Lt.x*Lt.x,a+=Lt.x*Lt.y,o+=Lt.x*Lt.z,h+=Lt.y*Lt.y,f+=Lt.y*Lt.z,m+=Lt.z*Lt.z}s*=i,a*=i,o*=i,h*=i,f*=i,m*=i;const b=Z$;b[0]=s,b[1]=a,b[2]=o,b[3]=a,b[4]=h,b[5]=f,b[6]=o,b[7]=f,b[8]=m;const{unitary:x}=j$(b,tX),B=t.halfAxes.copy(x);let P=B.getColumn(0,X$),R=B.getColumn(1,J$),Q=B.getColumn(2,Y$),z=-Number.MAX_VALUE,G=-Number.MAX_VALUE,X=-Number.MAX_VALUE,et=Number.MAX_VALUE,pt=Number.MAX_VALUE,gt=Number.MAX_VALUE;for(const Mt of r)HA.copy(Mt),z=Math.max(HA.dot(P),z),G=Math.max(HA.dot(R),G),X=Math.max(HA.dot(Q),X),et=Math.min(HA.dot(P),et),pt=Math.min(HA.dot(R),pt),gt=Math.min(HA.dot(Q),gt);P=P.multiplyByScalar(.5*(et+z)),R=R.multiplyByScalar(.5*(pt+G)),Q=Q.multiplyByScalar(.5*(gt+X)),t.center.copy(P).add(R).add(Q);const mt=$$.set(z-et,G-pt,X-gt).multiplyByScalar(.5),ft=new Di([mt[0],0,0,0,mt[1],0,0,0,mt[2]]);return t.halfAxes.multiplyRight(ft),t}const Lw=Math.PI/180,cy=new Float32Array(16),D3=new Float32Array(12);function N3(r,t,e){const n=t[0]*Lw,i=t[1]*Lw,s=t[2]*Lw,a=Math.sin(s),o=Math.sin(n),h=Math.sin(i),f=Math.cos(s),m=Math.cos(n),b=Math.cos(i),x=e[0],B=e[1],P=e[2];r[0]=x*b*m,r[1]=x*h*m,r[2]=x*-o,r[3]=B*(-h*f+b*o*a),r[4]=B*(b*f+h*o*a),r[5]=B*m*a,r[6]=P*(h*a+b*o*f),r[7]=P*(-b*a+h*o*f),r[8]=P*m*f}function k3(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const Q3={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,t){let{startRow:e,endRow:n}=t;const{data:i,getOrientation:s,getScale:a,getTranslation:o,getTransformMatrix:h}=this.props,f=Array.isArray(h),m=f&&h.length===16,b=Array.isArray(a),x=Array.isArray(s),B=Array.isArray(o),P=m||!f&&!!h(i[0]);P?r.constant=m:r.constant=x&&b&&B;const R=r.value;if(r.constant){let Q;P?(cy.set(h),Q=k3(cy)):(Q=D3,N3(Q,s,a),Q.set(o,9)),r.value=new Float32Array(Q)}else{let Q=e*r.size;const{iterable:z,objectInfo:G}=A3(i,e,n);for(const X of z){G.index++;let et;if(P)cy.set(m?h:h(X,G)),et=k3(cy);else{et=D3;const pt=x?s:s(X,G),gt=b?a:a(X,G);N3(et,pt,gt),et.set(B?o:o(X,G),9)}R[Q++]=et[0],R[Q++]=et[1],R[Q++]=et[2],R[Q++]=et[3],R[Q++]=et[4],R[Q++]=et[5],R[Q++]=et[6],R[Q++]=et[7],R[Q++]=et[8],R[Q++]=et[9],R[Q++]=et[10],R[Q++]=et[11]}}}};function H3(r,t){return t===xn.CARTESIAN||t===xn.METER_OFFSETS||t===xn.DEFAULT&&!r.isGeospatial}const rX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function z3(r){let t=1/0,e=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],h=o&&o.length;for(let f=0;f<h;f+=3){const m=o[f],b=o[f+1],x=o[f+2];t=m<t?m:t,e=b<e?b:e,n=x<n?x:n,i=m>i?m:i,s=b>s?b:s,a=x>a?x:a}return[[t,e,n],[i,s,a]]}function iX(r,t){if(!r)throw new Error("loader assertion failed.")}class mf{constructor(t,e){W(this,"fields",void 0),W(this,"metadata",void 0),iX(Array.isArray(t)),sX(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(){const t=Object.create(null);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const a of n)t[a]=!0;const s=this.fields.filter(a=>t[a.name]);return new mf(s,this.metadata)}selectAt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(s=>this.fields[s]).filter(Boolean);return new mf(i,this.metadata)}assign(t){let e,n=this.metadata;if(t instanceof mf){const a=t;e=a.fields,n=V3(V3(new Map,this.metadata),a.metadata)}else e=t;const i=Object.create(null);for(const a of this.fields)i[a.name]=a;for(const a of e)i[a.name]=a;const s=Object.values(i);return new mf(s,n)}}function sX(r){const t={};for(const e of r)t[e.name]&&console.warn("Schema: duplicated field name",e.name,e),t[e.name]=!0}function V3(r,t){return new Map([...r||new Map,...t||new Map])}class uy{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;W(this,"name",void 0),W(this,"type",void 0),W(this,"nullable",void 0),W(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=n,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new uy(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Ni=function(r){return r[r.NONE=0]="NONE",r[r.Null=1]="Null",r[r.Int=2]="Int",r[r.Float=3]="Float",r[r.Binary=4]="Binary",r[r.Utf8=5]="Utf8",r[r.Bool=6]="Bool",r[r.Decimal=7]="Decimal",r[r.Date=8]="Date",r[r.Time=9]="Time",r[r.Timestamp=10]="Timestamp",r[r.Interval=11]="Interval",r[r.List=12]="List",r[r.Struct=13]="Struct",r[r.Union=14]="Union",r[r.FixedSizeBinary=15]="FixedSizeBinary",r[r.FixedSizeList=16]="FixedSizeList",r[r.Map=17]="Map",r[r.Dictionary=-1]="Dictionary",r[r.Int8=-2]="Int8",r[r.Int16=-3]="Int16",r[r.Int32=-4]="Int32",r[r.Int64=-5]="Int64",r[r.Uint8=-6]="Uint8",r[r.Uint16=-7]="Uint16",r[r.Uint32=-8]="Uint32",r[r.Uint64=-9]="Uint64",r[r.Float16=-10]="Float16",r[r.Float32=-11]="Float32",r[r.Float64=-12]="Float64",r[r.DateDay=-13]="DateDay",r[r.DateMillisecond=-14]="DateMillisecond",r[r.TimestampSecond=-15]="TimestampSecond",r[r.TimestampMillisecond=-16]="TimestampMillisecond",r[r.TimestampMicrosecond=-17]="TimestampMicrosecond",r[r.TimestampNanosecond=-18]="TimestampNanosecond",r[r.TimeSecond=-19]="TimeSecond",r[r.TimeMillisecond=-20]="TimeMillisecond",r[r.TimeMicrosecond=-21]="TimeMicrosecond",r[r.TimeNanosecond=-22]="TimeNanosecond",r[r.DenseUnion=-23]="DenseUnion",r[r.SparseUnion=-24]="SparseUnion",r[r.IntervalDayTime=-25]="IntervalDayTime",r[r.IntervalYearMonth=-26]="IntervalYearMonth",r}({}),G3,j3,q3;class Pw{static isNull(t){return t&&t.typeId===Ni.Null}static isInt(t){return t&&t.typeId===Ni.Int}static isFloat(t){return t&&t.typeId===Ni.Float}static isBinary(t){return t&&t.typeId===Ni.Binary}static isUtf8(t){return t&&t.typeId===Ni.Utf8}static isBool(t){return t&&t.typeId===Ni.Bool}static isDecimal(t){return t&&t.typeId===Ni.Decimal}static isDate(t){return t&&t.typeId===Ni.Date}static isTime(t){return t&&t.typeId===Ni.Time}static isTimestamp(t){return t&&t.typeId===Ni.Timestamp}static isInterval(t){return t&&t.typeId===Ni.Interval}static isList(t){return t&&t.typeId===Ni.List}static isStruct(t){return t&&t.typeId===Ni.Struct}static isUnion(t){return t&&t.typeId===Ni.Union}static isFixedSizeBinary(t){return t&&t.typeId===Ni.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===Ni.FixedSizeList}static isMap(t){return t&&t.typeId===Ni.Map}static isDictionary(t){return t&&t.typeId===Ni.Dictionary}get typeId(){return Ni.NONE}compareTo(t){return this===t}}G3=Symbol.toStringTag;class yf extends Pw{constructor(t,e){super(),W(this,"isSigned",void 0),W(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return Ni.Int}get[G3](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class oX extends yf{constructor(){super(!0,8)}}class aX extends yf{constructor(){super(!0,16)}}class lX extends yf{constructor(){super(!0,32)}}class cX extends yf{constructor(){super(!1,8)}}class uX extends yf{constructor(){super(!1,16)}}class AX extends yf{constructor(){super(!1,32)}}const K3={HALF:16,SINGLE:32,DOUBLE:64};j3=Symbol.toStringTag;class W3 extends Pw{constructor(t){super(),W(this,"precision",void 0),this.precision=t}get typeId(){return Ni.Float}get[j3](){return"Float"}toString(){return"Float".concat(this.precision)}}class hX extends W3{constructor(){super(K3.SINGLE)}}class dX extends W3{constructor(){super(K3.DOUBLE)}}q3=Symbol.toStringTag;class fX extends Pw{constructor(t,e){super(),W(this,"listSize",void 0),W(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return Ni.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[q3](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function pX(r){switch(r.constructor){case Int8Array:return new oX;case Uint8Array:return new cX;case Int16Array:return new aX;case Uint16Array:return new uX;case Int32Array:return new lX;case Uint32Array:return new AX;case Float32Array:return new hX;case Float64Array:return new dX;default:throw new Error("array type not supported")}}function gX(r,t,e){const n=pX(t.value),i=e||mX(t);return new uy(r,new fX(t.size,new uy("value",n)),!1,i)}function mX(r){const t=new Map;return"byteOffset"in r&&t.set("byteOffset",r.byteOffset.toString(10)),"byteStride"in r&&t.set("byteStride",r.byteStride.toString(10)),"normalized"in r&&t.set("normalized",r.normalized.toString()),t}function $3(r,t){(r.COLOR_0||r.colors)&&t||(r.colors={constant:!0,value:new Float32Array([1,1,1])}),Bn.assert(r.positions||r.POSITION,'no "postions" or "POSITION" attribute in mesh')}function X3(r,t){if(r.attributes)return $3(r.attributes,t),r instanceof gg?r:new gg(r);if(r.positions||r.POSITION)return $3(r,t),new gg({attributes:r});throw Error("Invalid mesh")}const yX={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class Mw extends gf{constructor(){super(...arguments),W(this,"state",void 0)}getShaders(){const t=!fn(this.context.gl),e={};return fb(this.context.gl,pi.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:rX,fs:nX,modules:[iw,Aj,sw],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:n}=this.props;if(!n)return null;if(e=(t=n.header)===null||t===void 0?void 0:t.boundingBox,!e){const{attributes:i}=X3(n,this.props._useMeshColors);i.POSITION=i.POSITION||i.positions,e=z3(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Q3}),this.setState({emptyTexture:new Ma(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:i}=t;if(e.mesh!==n.mesh||i.extensionsChanged){var s;if(this.state.positionBounds=null,(s=this.state.model)===null||s===void 0||s.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const a=e.mesh.attributes||e.mesh;this.setState({hasNormals:!!(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==n.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw(t){let{uniforms:e}=t;if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:i,coordinateSystem:s,_instanced:a}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:i,composeModelMatrix:!a||H3(n,s),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.model)&&super.isLoaded}getModel(t){const e=new of(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:X3(t,this.props._useMeshColors),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state;return e.setUniforms({sampler:n||i,hasTexture:!!n}),e}setTexture(t){const{emptyTexture:e,model:n}=this.state;n&&n.setUniforms({sampler:t||e,hasTexture:!!t})}}W(Mw,"defaultProps",yX),W(Mw,"layerName","SimpleMeshLayer");class _f{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e}=t;this.id=e||Nu(this.constructor.name),this.display=!0,this.position=new ce,this.rotation=new ce,this.scale=new ce(1,1,1),this.matrix=new wn,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return sr(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return sr(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return sr(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:e,rotation:n,scale:i,update:s=!0}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:e,rotation:n,scale:i}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(t,e){sr(t),e=e||this.matrix;const n=new wn(t).multiplyRight(e),i=n.invert(),s=i.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class Tg extends _f{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;wr.assert(e.every(n=>n instanceof _f),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(t){const e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((e,n)=>{let{worldMatrix:i}=n;const s=e.getBounds();if(!s)return;const[a,o]=s,h=new ce(a).add(o).divide([2,2,2]);i.transformAsPoint(h,h);const f=new ce(o).subtract(a).divide([2,2,2]);i.transformAsVector(f,f);for(let m=0;m<8;m++){const b=new ce(m&1?-1:1,m&2?-1:1,m&4?-1:1).multiply(f).add(h);for(let x=0;x<3;x++)t[0][x]=Math.min(t[0][x],b[x]),t[1][x]=Math.max(t[1][x],b[x])}}),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:e=new wn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new wn(e).multiplyRight(this.matrix);for(const i of this.children)i instanceof Tg?i.traverse(t,{worldMatrix:n}):t(i,{worldMatrix:n})}}const _X={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vX={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function J3(r){if(!r._animation){const t=vX[r.componentType],e=_X[r.type],n=e*r.count,{buffer:i,byteOffset:s}=r.bufferView.data,a=new t(i,s+(r.byteOffset||0),n);if(e===1)r._animation=Array.from(a);else{const o=[];for(let h=0;h<a.length;h+=e)o.push(Array.from(a.slice(h,h+e)));r._animation=o}}return r._animation}const bX=new wn;function wX(r,t){if(t.matrix.identity(),r.translation&&t.matrix.translate(r.translation),r.rotation){const e=bX.fromQuaternion(r.rotation);t.matrix.multiplyRight(e)}r.scale&&t.matrix.scale(r.scale)}const Uw=new dg;function xX(r,t,e,n,i){if(t==="rotation"){Uw.slerp({start:e,target:n,ratio:i});for(let s=0;s<Uw.length;s++)r[t][s]=Uw[s]}else for(let s=0;s<e.length;s++)r[t][s]=i*n[s]+(1-i)*e[s]}function BX(r,t,e){let{p0:n,outTangent0:i,inTangent1:s,p1:a,tDiff:o,ratio:h}=e;for(let f=0;f<r[t].length;f++){const m=i[f]*o,b=s[f]*o;r[t][f]=(2*Math.pow(h,3)-3*Math.pow(h,2)+1)*n[f]+(Math.pow(h,3)-2*Math.pow(h,2)+h)*m+(-2*Math.pow(h,3)+3*Math.pow(h,2))*a[f]+(Math.pow(h,3)-Math.pow(h,2))*b}}function CX(r,t,e){for(let n=0;n<e.length;n++)r[t][n]=e[n]}function EX(r,t,e,n){let{input:i,interpolation:s,output:a}=t;const o=i[i.length-1],h=r%o,f=i.findIndex(B=>B>=h),m=Math.max(0,f-1);if(!Array.isArray(e[n]))switch(n){case"translation":e[n]=[0,0,0];break;case"rotation":e[n]=[0,0,0,1];break;case"scale":e[n]=[1,1,1];break;default:wr.warn("Bad animation path ".concat(n))()}sr(e[n].length===a[m].length);const b=i[m],x=i[f];switch(s){case"STEP":CX(e,n,a[m]);break;case"LINEAR":if(x>b){const B=(h-b)/(x-b);xX(e,n,a[m],a[f],B)}break;case"CUBICSPLINE":if(x>b){const B=(h-b)/(x-b),P=x-b,R=a[3*m+1],Q=a[3*m+2],z=a[3*f+0],G=a[3*f+1];BX(e,n,{p0:R,outTangent0:Q,inTangent1:z,p1:G,tDiff:P,ratio:B})}break;default:wr.warn("Interpolation ".concat(s," not supported"))();break}}class SX{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const n=(t/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:s,target:a,path:o}=i;EX(n,s,a,o),wX(a,a._node)})}}class TX{constructor(t){this.animations=t.animations.map((e,n)=>{const i=e.name||"Animation-".concat(n),s=e.samplers.map(o=>{let{input:h,interpolation:f="LINEAR",output:m}=o;return{input:J3(t.accessors[h]),interpolation:f,output:J3(t.accessors[m])}}),a=e.channels.map(o=>{let{sampler:h,target:f}=o;return{sampler:s[h],target:t.nodes[f.node],path:f.path}});return new SX({name:i,channels:a})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(e=>e.animate(t))}getAnimations(){return this.animations}}class IX extends _f{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof of?(this.model=t,this._setModelNodeProps(e)):this.model=new of(t,e),this.bounds=null,this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class Y3{constructor(t,e){let{attributes:n,material:i,pbrDebug:s,imageBasedLightingEnvironment:a,lights:o,useTangents:h}=e;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},fb(t,pi.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],a&&(this.uniforms.u_DiffuseEnvSampler=a.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=a.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=a.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(n.NORMAL,"HAS_NORMALS"),this.defineIfPresent(n.TANGENT&&h,"HAS_TANGENTS"),this.defineIfPresent(n.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(a,"USE_IBL"),this.defineIfPresent(o,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const i=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},s=t.texture.source.image;let a,o={};s.compressed?(a=s,o={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):a={data:s};const h=new Ma(this.gl,{id:t.name||t.id,parameters:{...i,...o},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...a});this.uniforms[e]=h,this.defineIfPresent(n,n),this.generatedTextures.push(h)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:n=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,n]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode==="MASK"){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else t.alphaMode==="BLEND"&&(wr.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(t=>t.delete())}}const FX=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,LX=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function Z3(r,t){return fn(r)?`#version 300 es
`.concat(t):t}function PX(r,t){const{id:e,drawMode:n,vertexCount:i,attributes:s,modelOptions:a}=t,o=new Y3(r,t);wr.info(4,"createGLTFModel defines: ",o.defines)();const h=[];h.push(...o.generatedTextures),h.push(...Object.values(s).map(m=>m.buffer));const f=new IX(r,{id:e,drawMode:n,vertexCount:i,modules:[Gb],parameters:o.parameters,vs:Z3(r,FX),fs:Z3(r,LX),managedResources:h,...a,defines:{...o.defines,...a.defines}});return f.setProps({attributes:s}),f.setUniforms(o.uniforms),f}const MX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},UX={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class RX{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.options=Object.assign({},UX,e)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new TX(this.gltf):null}createScene(t){const n=(t.nodes||[]).map(s=>this.createNode(s));return new Tg({id:t.name||t.id,children:n})}createNode(t){if(!t._node){const n=(t.children||[]).map(s=>this.createNode(s));t.mesh&&n.push(this.createMesh(t.mesh));const i=new Tg({id:t.name||t.id,children:n});if(t.matrix)i.setMatrix(t.matrix);else{if(i.matrix.identity(),t.translation&&i.matrix.translate(t.translation),t.rotation){const s=new wn().fromQuaternion(t.rotation);i.matrix.multiplyRight(s)}t.scale&&i.matrix.scale(t.scale)}t._node=i}return t._node}createMesh(t){if(!t._mesh){const n=(t.primitives||[]).map((s,a)=>this.createPrimitive(s,a,t)),i=new Tg({id:t.name||t.id,children:n});t._mesh=i}return t._mesh}getVertexCount(t){wr.warn("getVertexCount() not found")()}createPrimitive(t,e,n){const i=PX(this.gl,Object.assign({id:t.name||"".concat(n.name||n.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return i.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],i}createAttributes(t,e){const n={};return Object.keys(t).forEach(i=>{n[i]=this.createAccessor(t[i],this.createBuffer(t[i],this.gl.ARRAY_BUFFER))}),e&&(n.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),wr.info(4,"glTF Attributes",{attributes:t,indices:e,generated:n})(),n}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[e]||(n.lumaBuffers[e]=new si(this.gl,{id:"from-".concat(n.id),data:n.data||t.value,target:e})),n.lumaBuffers[e]}createAccessor(t,e){return new aa({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:MX[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function OX(r,t,e){const n=new RX(r,e),i=n.instantiate(t),s=n.createAnimator();return{scenes:i,animator:s}}const DX="3.4.15",NX="3.4.15",tF="3.4.15",kX="https://unpkg.com/@loaders.gl/textures@".concat(tF,"/dist/libs/basis_encoder.wasm"),QX="https://unpkg.com/@loaders.gl/textures@".concat(tF,"/dist/libs/basis_encoder.js");let Rw;async function eF(r){const t=r.modules||{};return t.basis?t.basis:(Rw=Rw||HX(r),await Rw)}async function HX(r){let t=null,e=null;return[t,e]=await Promise.all([await Uh("basis_transcoder.js","textures",r),await Uh("basis_transcoder.wasm","textures",r)]),t=t||globalThis.BASIS,await zX(t,e)}function zX(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r(e).then(i=>{const{BasisFile:s,initializeBasis:a}=i;a(),n({BasisFile:s})})})}let Ow;async function rF(r){const t=r.modules||{};return t.basisEncoder?t.basisEncoder:(Ow=Ow||VX(r),await Ow)}async function VX(r){let t=null,e=null;return[t,e]=await Promise.all([await Uh(QX,"textures",r),await Uh(kX,"textures",r)]),t=t||globalThis.BASIS,await GX(t,e)}function GX(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r(e).then(i=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:h}=i;o(),n({BasisFile:s,KTX2File:a,BasisEncoder:h})})})}const vf={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},jX=["","WEBKIT_","MOZ_"],nF={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Ay=null;function qX(r){if(!Ay){r=r||KX()||void 0,Ay=new Set;for(const t of jX)for(const e in nF)if(r&&r.getExtension("".concat(t).concat(e))){const n=nF[e];Ay.add(n)}}return Ay}function KX(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var iF,sF,oF,aF,lF,cF,uF,AF;(function(r){r[r.NONE=0]="NONE",r[r.BASISLZ=1]="BASISLZ",r[r.ZSTD=2]="ZSTD",r[r.ZLIB=3]="ZLIB"})(iF||(iF={})),function(r){r[r.BASICFORMAT=0]="BASICFORMAT"}(sF||(sF={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC"}(oF||(oF={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.SRGB=1]="SRGB"}(aF||(aF={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.LINEAR=1]="LINEAR",r[r.SRGB=2]="SRGB",r[r.ITU=3]="ITU",r[r.NTSC=4]="NTSC",r[r.SLOG=5]="SLOG",r[r.SLOG2=6]="SLOG2"}(lF||(lF={})),function(r){r[r.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",r[r.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(cF||(cF={})),function(r){r[r.RGB=0]="RGB",r[r.RRR=3]="RRR",r[r.GGG=4]="GGG",r[r.AAA=15]="AAA"}(uF||(uF={})),function(r){r[r.RGB=0]="RGB",r[r.RGBA=3]="RGBA",r[r.RRR=4]="RRR",r[r.RRRG=5]="RRRG"}(AF||(AF={}));const Na=[171,75,84,88,32,50,48,187,13,10,26,10];function WX(r){const t=new Uint8Array(r);return!(t.byteLength<Na.length||t[0]!==Na[0]||t[1]!==Na[1]||t[2]!==Na[2]||t[3]!==Na[3]||t[4]!==Na[4]||t[5]!==Na[5]||t[6]!==Na[6]||t[7]!==Na[7]||t[8]!==Na[8]||t[9]!==Na[9]||t[10]!==Na[10]||t[11]!==Na[11])}const $X={etc1:{basisFormat:0,compressed:!0,format:vf.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:vf.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:vf.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:vf.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:vf.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:vf.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function XX(r,t){if(t.basis.containerFormat==="auto"){if(WX(r)){const n=await rF(t);return hF(n.KTX2File,r,t)}const{BasisFile:e}=await eF(t);return Dw(e,r,t)}switch(t.basis.module){case"encoder":const e=await rF(t);switch(t.basis.containerFormat){case"ktx2":return hF(e.KTX2File,r,t);case"basis":default:return Dw(e.BasisFile,r,t)}case"transcoder":default:const{BasisFile:n}=await eF(t);return Dw(n,r,t)}}function Dw(r,t,e){const n=new r(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),s=[];for(let a=0;a<i;a++){const o=n.getNumLevels(a),h=[];for(let f=0;f<o;f++)h.push(JX(n,a,f,e));s.push(h)}return s}finally{n.close(),n.delete()}}function JX(r,t,e,n){const i=r.getImageWidth(t,e),s=r.getImageHeight(t,e),a=r.getHasAlpha(),{compressed:o,format:h,basisFormat:f}=dF(n,a),m=r.getImageTranscodedSizeInBytes(t,e,f),b=new Uint8Array(m);if(!r.transcodeImage(b,t,e,f,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:b,compressed:o,format:h,hasAlpha:a}}function hF(r,t,e){const n=new r(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),s=[];for(let a=0;a<i;a++){s.push(YX(n,a,e));break}return[s]}finally{n.close(),n.delete()}}function YX(r,t,e){const{alphaFlag:n,height:i,width:s}=r.getImageLevelInfo(t,0,0),{compressed:a,format:o,basisFormat:h}=dF(e,n),f=r.getImageTranscodedSizeInBytes(t,0,0,h),m=new Uint8Array(f);if(!r.transcodeImage(m,t,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:m,compressed:a,levelSize:f,hasAlpha:n,format:o}}function dF(r,t){let e=r&&r.basis&&r.basis.format;return e==="auto"&&(e=fF()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),$X[e]}function fF(){const r=qX();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const ZX={...{name:"Basis",id:Uu?"basis":"basis-nodejs",module:"textures",version:NX,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:XX};function ka(r,t){if(!r)throw new Error(t||"assert failed: gltf")}function pF(r,t){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=t.baseUri||t.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(r));return n.substr(0,n.lastIndexOf("/")+1)+r}function tJ(r,t,e){const n=r.bufferViews[e];ka(n);const i=n.buffer,s=t[i];ka(s);const a=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,n.byteLength)}const gF=["SCALAR","VEC2","VEC3","VEC4"],eJ=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],rJ=new Map(eJ),nJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},sJ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function mF(r){return gF[r-1]||gF[0]}function yF(r){const t=rJ.get(r.constructor);if(!t)throw new Error("Illegal typed array");return t}function Nw(r,t){const e=sJ[r.componentType],n=nJ[r.type],i=iJ[r.componentType],s=r.count*n,a=r.count*n*i;return ka(a>=0&&a<=t.byteLength),{ArrayType:e,length:s,byteLength:a}}function _F(r){let{images:t,bufferViews:e}=r;t=t||[],e=e||[];const n=t.map(a=>a.bufferView);e=e.filter(a=>!n.includes(a));const i=e.reduce((a,o)=>a+o.byteLength,0),s=t.reduce((a,o)=>{const{width:h,height:f}=o.image;return a+h*f},0);return i+Math.ceil(4*s*1.33)}const oJ={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class la{constructor(t){W(this,"gltf",void 0),W(this,"sourceBuffers",void 0),W(this,"byteLength",void 0),this.gltf=t||{json:{...oJ},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find(i=>i===t),n=this.json.extensions||{};return e?n[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(n=>n===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const n=this.json[t]&&this.json[t][e];if(!n)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return n}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,n=this.gltf.buffers[e];ka(n);const i=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,{ArrayType:s,length:a}=Nw(t,e),o=e.byteOffset+t.byteOffset;return new s(i,o,a)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,s=e.byteOffset||0;return new Uint8Array(i,s,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,n){return t.extensions=t.extensions||{},t.extensions[e]=n,this.registerUsedExtension(e),this}setObjectExtension(t,e,n){const i=t.extensions||{};i[e]=n}removeObjectExtension(t,e){const n=t.extensions||{},i=n[e];return delete n[e],i}addExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ka(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ka(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:n}=t;this.json.nodes=this.json.nodes||[];const i={mesh:e};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:n,material:i,mode:s=4}=t,o={primitives:[{attributes:this._addAttributes(e),mode:s}]};if(n){const h=this._addIndices(n);o.primitives[0].indices=h}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const n={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(t,e){const n=Xv(t),i=e||(n==null?void 0:n.mimeType),a={bufferView:this.addBufferView(t),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(t){const e=t.byteLength;ka(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const n={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=jp(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(t,e){const n={bufferView:t,type:mF(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const n=this.addBufferView(t);let i={min:e.min,max:e.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(t,e.size));const s={size:e.size,componentType:yF(t),count:Math.round(t.length/e.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(s,e))}addTexture(t){const{imageIndex:e}=t,n={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const n=this.byteLength,i=new ArrayBuffer(n),s=new Uint8Array(i);let a=0;for(const o of this.sourceBuffers||[])a=j8(o,s,a);(t=this.json)!==null&&t!==void 0&&(e=t.buffers)!==null&&e!==void 0&&e[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(t,e){let n=!0;for(;n;){const i=t.indexOf(e);i>-1?t.splice(i,1):n=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};for(const n in t){const i=t[n],s=this._getGltfAttributeName(n),a=this.addBinaryBuffer(i.value,i);e[s]=a}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const n={min:null,max:null};if(t.length<e)return n;n.min=[],n.max=[];const i=t.subarray(0,e);for(const s of i)n.min.push(s),n.max.push(s);for(let s=e;s<t.length;s+=e)for(let a=0;a<e;a++)n.min[0+a]=Math.min(n.min[0+a],t[s+a]),n.max[0+a]=Math.max(n.max[0+a],t[s+a]);return n}}const aJ="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",lJ="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",cJ=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),uJ=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),AJ={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},hJ={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function dJ(r,t,e,n,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await fJ();mJ(a,a.exports[hJ[i]],r,t,e,n,a.exports[AJ[s||"NONE"]])}let kw;async function fJ(){return kw||(kw=pJ()),kw}async function pJ(){let r=aJ;WebAssembly.validate(cJ)&&(r=lJ,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(gJ(r),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function gJ(r){const t=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);t[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let e=0;for(let n=0;n<r.length;++n)t[e++]=t[n]<60?uJ[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,e)}function mJ(r,t,e,n,i,s,a){const o=r.exports.sbrk,h=n+3&-4,f=o(h*i),m=o(s.length),b=new Uint8Array(r.exports.memory.buffer);b.set(s,m);const x=t(f,n,i,m,s.length);if(x===0&&a&&a(f,h,i),e.set(b.subarray(f,f+n*i)),o(f-o(0)),x!==0)throw new Error("Malformed buffer data: ".concat(x))}const Qw="EXT_meshopt_compression",yJ=Qw;async function _J(r,t){var e;const n=new la(r);if(!(t!=null&&(e=t.gltf)!==null&&e!==void 0&&e.decompressMeshes))return;const i=[];for(const s of r.json.bufferViews||[])i.push(vJ(n,s));await Promise.all(i),n.removeExtension(Qw)}async function vJ(r,t){const e=r.getObjectExtension(t,Qw);if(e){const{byteOffset:n=0,byteLength:i=0,byteStride:s,count:a,mode:o,filter:h="NONE",buffer:f}=e,m=r.gltf.buffers[f],b=new Uint8Array(m.arrayBuffer,m.byteOffset+n,i),x=new Uint8Array(r.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await dJ(x,a,s,b,o,h),x}return null}const bJ=Object.freeze(Object.defineProperty({__proto__:null,decode:_J,name:yJ},Symbol.toStringTag,{value:"Module"})),bf="EXT_texture_webp",wJ=bf;function xJ(r,t){const e=new la(r);if(!NH("image/webp")){if(e.getRequiredExtensions().includes(bf))throw new Error("gltf: Required extension ".concat(bf," not supported by browser"));return}const{json:n}=e;for(const i of n.textures||[]){const s=e.getObjectExtension(i,bf);s&&(i.source=s.source),e.removeObjectExtension(i,bf)}e.removeExtension(bf)}const BJ=Object.freeze(Object.defineProperty({__proto__:null,name:wJ,preprocess:xJ},Symbol.toStringTag,{value:"Module"})),hy="KHR_texture_basisu",CJ=hy;function EJ(r,t){const e=new la(r),{json:n}=e;for(const i of n.textures||[]){const s=e.getObjectExtension(i,hy);s&&(i.source=s.source),e.removeObjectExtension(i,hy)}e.removeExtension(hy)}const SJ=Object.freeze(Object.defineProperty({__proto__:null,name:CJ,preprocess:EJ},Symbol.toStringTag,{value:"Module"})),TJ={name:"Draco",id:Uu?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.15",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function IJ(r,t,e){const n=bF(t.metadata),i=[],s=FJ(t.attributes);for(const a in r){const o=r[a],h=vF(a,o,s[a]);i.push(h)}if(e){const a=vF("indices",e);i.push(a)}return new mf(i,n)}function FJ(r){const t={};for(const e in r){const n=r[e];t[n.name||"undefined"]=n}return t}function vF(r,t,e){const n=e?bF(e.metadata):void 0;return gX(r,t,n)}function bF(r){const t=new Map;for(const e in r)t.set("".concat(e,".string"),JSON.stringify(r[e]));return t}const wF={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},LJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},PJ=4;class MJ{constructor(t){W(this,"draco",void 0),W(this,"decoder",void 0),W(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const i=this.decoder.GetEncodedGeometryType(n),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const x="DRACO decompression failed: ".concat(a.error_msg());throw new Error(x)}const o=this._getDracoLoaderData(s,i,e),h=this._getMeshData(s,o,e),f=z3(h.attributes),m=IJ(h.attributes,o,h.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:f},...h,schema:m}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,e,n){const i=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,n);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(t,e){const n={};for(let i=0;i<t.num_attributes();i++){const s=this.decoder.GetAttribute(t,i),a=this._getAttributeMetadata(t,i);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:a};const o=this._getQuantizationTransform(s,e);o&&(n[s.unique_id()].quantization_transform=o);const h=this._getOctahedronTransform(s,e);h&&(n[s.unique_id()].octahedron_transform=h)}return n}_getMeshData(t,e,n){const i=this._getMeshAttributes(e,t,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(t,e,n){const i={};for(const s of Object.values(t.attributes)){const a=this._deduceAttributeName(s,n);s.name=a;const{value:o,size:h}=this._getAttributeValues(e,s);i[a]={value:o,size:h,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return i}_getTriangleListIndices(t){const n=t.num_faces()*3,i=n*PJ,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(t,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,n).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),OJ(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const n=LJ[e.data_type],i=e.num_components,a=t.num_points()*i,o=a*n.BYTES_PER_ELEMENT,h=UJ(this.draco,n);let f;const m=this.draco._malloc(o);try{const b=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,b,h,o,m),f=new n(this.draco.HEAPF32.buffer,m,a).slice()}finally{this.draco._free(m)}return{value:f,size:i}}_deduceAttributeName(t,e){const n=t.unique_id;for(const[a,o]of Object.entries(e.extraAttributes||{}))if(o===n)return a;const i=t.attribute_type;for(const a in wF)if(this.draco[a]===i)return wF[a];const s=e.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(n)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const n=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},n=this.metadataQuerier.NumEntries(t);for(let i=0;i<n;i++){const s=this.metadataQuerier.GetEntryName(t,i);e[s]=this._getDracoMetadataField(t,s)}return e}_getDracoMetadataField(t,e){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,n);const i=RJ(n);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:n=[]}=t,i=[...e,...n];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,e){const{quantizedAttributes:n=[]}=e,i=t.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(t))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(o=>a.min_value(o))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:n=[]}=e,i=t.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(t))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}function UJ(r,t){switch(t){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function RJ(r){const t=r.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=r.GetValue(n);return e}function OJ(r){const t=r.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=r.GetValue(n);return e}const Hw="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),DJ="".concat(Hw,"/draco_decoder.js"),NJ="".concat(Hw,"/draco_wasm_wrapper.js"),kJ="".concat(Hw,"/draco_decoder.wasm");let Ig;async function QJ(r){const t=r.modules||{};return t.draco3d?Ig=Ig||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):Ig=Ig||HJ(r),await Ig}async function HJ(r){let t,e;switch(r.draco&&r.draco.decoderType){case"js":t=await Uh(DJ,"draco",r);break;case"wasm":default:[t,e]=await Promise.all([await Uh(NJ,"draco",r),await Uh(kJ,"draco",r)])}return t=t||globalThis.DracoDecoderModule,await zJ(t,e)}function zJ(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r({...e,onModuleLoaded:i=>n({draco:i})})})}const xF={...TJ,parse:VJ};async function VJ(r,t){const{draco:e}=await QJ(t),n=new MJ(e);try{return n.parseSync(r,t==null?void 0:t.draco)}finally{n.destroy()}}function GJ(r){const t={};for(const e in r){const n=r[e];if(e!=="indices"){const i=BF(n);t[e]=i}}return t}function BF(r){const{buffer:t,size:e,count:n}=jJ(r);return{value:t,size:e,byteOffset:0,count:n,type:mF(e),componentType:yF(t)}}function jJ(r){let t=r,e=1,n=0;return r&&r.value&&(t=r.value,e=r.size||1),t&&(ArrayBuffer.isView(t)||(t=qJ(t,Float32Array)),n=t.length/e),{buffer:t,size:e,count:n}}function qJ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return r?Array.isArray(r)?new t(r):e&&!(r instanceof t)?new t(r):r:null}const qh="KHR_draco_mesh_compression",KJ=qh;function WJ(r,t,e){const n=new la(r);for(const i of CF(n))n.getObjectExtension(i,qh)}async function $J(r,t,e){var n;if(!(t!=null&&(n=t.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const i=new la(r),s=[];for(const a of CF(i))i.getObjectExtension(a,qh)&&s.push(JJ(i,a,t,e));await Promise.all(s),i.removeExtension(qh)}function XJ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=new la(r);for(const n of e.json.meshes||[])YJ(n,t),e.addRequiredExtension(qh)}async function JJ(r,t,e,n){const i=r.getObjectExtension(t,qh);if(!i)return;const s=r.getTypedArrayForBufferView(i.bufferView),a=Rv(s.buffer,s.byteOffset),{parse:o}=n,h={...e};delete h["3d-tiles"];const f=await o(a,xF,h,n),m=GJ(f.attributes);for(const[b,x]of Object.entries(m))if(b in t.attributes){const B=t.attributes[b],P=r.getAccessor(B);P!=null&&P.min&&P!==null&&P!==void 0&&P.max&&(x.min=P.min,x.max=P.max)}t.attributes=m,f.indices&&(t.indices=BF(f.indices)),ZJ(t)}function YJ(r,t){var e;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const a=i.DracoWriter.encodeSync({attributes:r}),o=s==null||(e=s.parseSync)===null||e===void 0?void 0:e.call(s,{attributes:r}),h=i._addFauxAttributes(o.attributes),f=i.addBufferView(a);return{primitives:[{attributes:h,mode:n,extensions:{[qh]:{bufferView:f,attributes:h}}}]}}function ZJ(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*CF(r){for(const t of r.json.meshes||[])for(const e of t.primitives)yield e}const tY=Object.freeze(Object.defineProperty({__proto__:null,decode:$J,encode:XJ,name:KJ,preprocess:WJ},Symbol.toStringTag,{value:"Module"})),eY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},zw="KHR_texture_transform",nY=zw,dy=new ce,iY=new Di,sY=new Di;async function oY(r,t){if(!new la(r).getExtension(zw))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)aY(s,r)}function aY(r,t){var e,n,i;const s=[],a=(e=t.json.materials)===null||e===void 0?void 0:e[r],o=a==null||(n=a.pbrMetallicRoughness)===null||n===void 0?void 0:n.baseColorTexture;o&&Fg(t,r,o,s);const h=a==null?void 0:a.emissiveTexture;h&&Fg(t,r,h,s);const f=a==null?void 0:a.normalTexture;f&&Fg(t,r,f,s);const m=a==null?void 0:a.occlusionTexture;m&&Fg(t,r,m,s);const b=a==null||(i=a.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;b&&Fg(t,r,b,s)}function Fg(r,t,e,n){const i=lY(e,n);if(!i)return;const s=r.json.meshes||[];for(const a of s)for(const o of a.primitives){const h=o.material;Number.isFinite(h)&&t===h&&cY(r,o,i)}}function lY(r,t){var e;const n=(e=r.extensions)===null||e===void 0?void 0:e[zw],{texCoord:i=0}=r,{texCoord:s=i}=n;if(!(t.findIndex(o=>{let[h,f]=o;return h===i&&f===s})!==-1)){const o=hY(n);return i!==s&&(r.texCoord=s),t.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:o}}return null}function cY(r,t,e){const{originalTexCoord:n,texCoord:i,matrix:s}=e,a=t.attributes["TEXCOORD_".concat(n)];if(Number.isFinite(a)){var o;const f=(o=r.json.accessors)===null||o===void 0?void 0:o[a];if(f&&f.bufferView){var h;const m=(h=r.json.bufferViews)===null||h===void 0?void 0:h[f.bufferView];if(m){const{arrayBuffer:b,byteOffset:x}=r.buffers[m.buffer],B=(x||0)+(f.byteOffset||0)+(m.byteOffset||0),{ArrayType:P,length:R}=Nw(f,m),Q=rY[f.componentType],z=eY[f.type],G=m.byteStride||Q*z,X=new Float32Array(R);for(let et=0;et<f.count;et++){const pt=new P(b,B+et*G,2);dy.set(pt[0],pt[1],1),dy.transformByMatrix3(s),X.set([dy[0],dy[1]],et*z)}n===i?uY(f,m,r.buffers,X):AY(i,f,t,r,X)}}}}function uY(r,t,e,n){r.componentType=5126,e.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function AY(r,t,e,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=n.json.accessors;a&&(a.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes["TEXCOORD_".concat(r)]=a.length-1)}function hY(r){const{offset:t=[0,0],rotation:e=0,scale:n=[1,1]}=r,i=new Di().set(1,0,0,0,1,0,t[0],t[1],1),s=iY.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),a=sY.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(a)}const dY=Object.freeze(Object.defineProperty({__proto__:null,decode:oY,name:nY},Symbol.toStringTag,{value:"Module"})),Kh="KHR_lights_punctual",fY=Kh;async function pY(r){const t=new la(r),{json:e}=t,n=t.getExtension(Kh);n&&(t.json.lights=n.lights,t.removeExtension(Kh));for(const i of e.nodes||[]){const s=t.getObjectExtension(i,Kh);s&&(i.light=s.light),t.removeObjectExtension(i,Kh)}}async function gY(r){const t=new la(r),{json:e}=t;if(e.lights){const n=t.addExtension(Kh);ka(!n.lights),n.lights=e.lights,delete e.lights}if(t.json.lights){for(const n of t.json.lights){const i=n.node;t.addObjectExtension(i,Kh,n)}delete t.json.lights}}const mY=Object.freeze(Object.defineProperty({__proto__:null,decode:pY,encode:gY,name:fY},Symbol.toStringTag,{value:"Module"})),Lg="KHR_materials_unlit",yY=Lg;async function _Y(r){const t=new la(r),{json:e}=t;for(const n of e.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,Lg);t.removeExtension(Lg)}function vY(r){const t=new la(r),{json:e}=t;if(t.materials)for(const n of e.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,Lg,{}),t.addExtension(Lg))}const bY=Object.freeze(Object.defineProperty({__proto__:null,decode:_Y,encode:vY,name:yY},Symbol.toStringTag,{value:"Module"})),Pg="KHR_techniques_webgl",wY=Pg;async function xY(r){const t=new la(r),{json:e}=t,n=t.getExtension(Pg);if(n){const i=CY(n,t);for(const s of e.materials||[]){const a=t.getObjectExtension(s,Pg);a&&(s.technique=Object.assign({},a,i[a.technique]),s.technique.values=EY(s.technique,t)),t.removeObjectExtension(s,Pg)}t.removeExtension(Pg)}}async function BY(r,t){}function CY(r,t){const{programs:e=[],shaders:n=[],techniques:i=[]}=r,s=new TextDecoder;return n.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(t.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(a=>{a.fragmentShader=n[a.fragmentShader],a.vertexShader=n[a.vertexShader]}),i.forEach(a=>{a.program=e[a.program]}),i}function EY(r,t){const e=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in e)&&(e[n]=r.uniforms[n].value)}),Object.keys(e).forEach(n=>{typeof e[n]=="object"&&e[n].index!==void 0&&(e[n].texture=t.getTexture(e[n].index))}),e}const SY=Object.freeze(Object.defineProperty({__proto__:null,decode:xY,encode:BY,name:wY},Symbol.toStringTag,{value:"Module"})),EF="EXT_feature_metadata",TY=EF;async function IY(r){const t=new la(r);FY(t)}function FY(r){var t;const e=r.getExtension(EF),n=e==null||(t=e.schema)===null||t===void 0?void 0:t.classes,i=e==null?void 0:e.featureTables;if((e==null?void 0:e.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),n&&i)for(const a in n){const o=n[a],h=MY(i,a);h&&LY(r,h,o)}}function LY(r,t,e){for(const i in e.properties){var n;const s=e.properties[i],a=t==null||(n=t.properties)===null||n===void 0?void 0:n[i],o=t.count;if(a){const h=PY(r,s,o,a);a.data=h}}}function PY(r,t,e,n){const i=n.bufferView;let s=r.getTypedArrayForBufferView(i);switch(t.type){case"STRING":{const a=n.stringOffsetBufferView,o=r.getTypedArrayForBufferView(a);s=UY(s,o,e);break}}return s}function MY(r,t){for(const e in r){const n=r[e];if(n.class===t)return n}return null}function UY(r,t,e){const n=[],i=new TextDecoder("utf8");let s=0;const a=4;for(let o=0;o<e;o++){const h=t[(o+1)*a]-t[o*a],f=r.subarray(s,h+s),m=i.decode(f);n.push(m),s+=h}return n}const SF=[bJ,BJ,SJ,tY,mY,bY,SY,dY,Object.freeze(Object.defineProperty({__proto__:null,decode:IY,name:TY},Symbol.toStringTag,{value:"Module"}))];function RY(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const n=SF.filter(s=>TF(s.name,t));for(const s of n){var i;(i=s.preprocess)===null||i===void 0||i.call(s,r,t,e)}}async function OY(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const n=SF.filter(s=>TF(s.name,t));for(const s of n){var i;await((i=s.decode)===null||i===void 0?void 0:i.call(s,r,t,e))}}function TF(r,t){var e;const n=(t==null||(e=t.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{};return!(r in n&&!n[r])}const Vw="KHR_binary_glTF";function DY(r){const t=new la(r),{json:e}=t;for(const n of e.images||[]){const i=t.getObjectExtension(n,Vw);i&&Object.assign(n,i),t.removeObjectExtension(n,Vw)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(Vw)}const IF={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},NY={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class kY{constructor(){W(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),W(this,"json",void 0)}normalize(t,e){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(n.asset.version));return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),DY(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in IF)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const n=t[e];if(!(!n||Array.isArray(n))){t[e]=[];for(const i in n){const s=n[i];s.id=s.id||i;const a=t[e].length;t[e].push(s),this.idToIndexMap[e][i]=a}}}_convertObjectIdsToArrayIndices(t){for(const e in IF)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:n,indices:i,material:s}=e;for(const a in n)n[a]=this._convertIdToIndex(n[a],"accessor");i&&(e.indices=this._convertIdToIndex(i,"accessor")),s&&(e.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const n of t[e])for(const i in n){const s=n[i],a=this._convertIdToIndex(s,i);n[i]=a}}_convertIdToIndex(t,e){const n=NY[e];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][t];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return i}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const s of t.materials){var e,n,i;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((e=s.values)===null||e===void 0?void 0:e.tex)||((n=s.values)===null||n===void 0?void 0:n.texture2d_0)||((i=s.values)===null||i===void 0?void 0:i.diffuseTex),o=t.textures.findIndex(h=>h.id===a);o!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}}function QY(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new kY().normalize(r,t)}const HY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},yl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},VY={magFilter:yl.TEXTURE_MAG_FILTER,minFilter:yl.TEXTURE_MIN_FILTER,wrapS:yl.TEXTURE_WRAP_S,wrapT:yl.TEXTURE_WRAP_T},GY={[yl.TEXTURE_MAG_FILTER]:yl.LINEAR,[yl.TEXTURE_MIN_FILTER]:yl.NEAREST_MIPMAP_LINEAR,[yl.TEXTURE_WRAP_S]:yl.REPEAT,[yl.TEXTURE_WRAP_T]:yl.REPEAT};function jY(r){return zY[r]}function qY(r){return HY[r]}class KY{constructor(){W(this,"baseUri",""),W(this,"json",{}),W(this,"buffers",[]),W(this,"images",[])}postProcess(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:n,buffers:i=[],images:s=[],baseUri:a=""}=t;return ka(n),this.baseUri=a,this.json=n,this.buffers=i,this.images=s,this._resolveTree(this.json,e),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map((e,n)=>this._resolveBufferView(e,n))),t.images&&(t.images=t.images.map((e,n)=>this._resolveImage(e,n))),t.samplers&&(t.samplers=t.samplers.map((e,n)=>this._resolveSampler(e,n))),t.textures&&(t.textures=t.textures.map((e,n)=>this._resolveTexture(e,n))),t.accessors&&(t.accessors=t.accessors.map((e,n)=>this._resolveAccessor(e,n))),t.materials&&(t.materials=t.materials.map((e,n)=>this._resolveMaterial(e,n))),t.meshes&&(t.meshes=t.meshes.map((e,n)=>this._resolveMesh(e,n))),t.nodes&&(t.nodes=t.nodes.map((e,n)=>this._resolveNode(e,n))),t.skins&&(t.skins=t.skins.map((e,n)=>this._resolveSkin(e,n))),t.scenes&&(t.scenes=t.scenes.map((e,n)=>this._resolveScene(e,n))),t.scene!==void 0&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if(typeof e=="object")return e;const n=this.json[t]&&this.json[t][e];return n||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),n}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map(n=>this.getNode(n)),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map(n=>this.getNode(n))),t.mesh!==void 0?t.mesh=this.getMesh(t.mesh):t.meshes!==void 0&&t.meshes.length&&(t.mesh=t.meshes.reduce((n,i)=>{const s=this.getMesh(i);return n.id=s.id,n.primitives=n.primitives.concat(s.primitives),n},{primitives:[]})),t.camera!==void 0&&(t.camera=this.getCamera(t.camera)),t.skin!==void 0&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map(n=>{n={...n};const i=n.attributes;n.attributes={};for(const s in i)n.attributes[s]=this.getAccessor(i[s]);return n.indices!==void 0&&(n.indices=this.getAccessor(n.indices)),n.material!==void 0&&(n.material=this.getMaterial(n.material)),n})),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const n=t.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){if(t.id=t.id||"accessor-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=jY(t.componentType),t.components=qY(t.type),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const n=t.bufferView.buffer,{ArrayType:i,byteLength:s}=Nw(t,t.bufferView),a=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+n.byteOffset;let o=n.arrayBuffer.slice(a,a+s);t.bufferView.byteStride&&(o=this._getValueFromInterleavedBuffer(n,a,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new i(o)}return t}_getValueFromInterleavedBuffer(t,e,n,i,s){const a=new Uint8Array(s*i);for(let o=0;o<s;o++){const h=e+o*n;a.set(new Uint8Array(t.arrayBuffer.slice(h,h+i)),o*i)}return a.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):GY,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const n in t){const i=this._enumSamplerParameter(n);i!==void 0&&(t.parameters[i]=t[n])}return t}_enumSamplerParameter(t){return VY[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView));const n=this.images[e];return n&&(t.image=n),t}_resolveBufferView(t,e){const n=t.buffer,i={id:"bufferView-".concat(e),...t,buffer:this.buffers[n]},s=this.buffers[n].arrayBuffer;let a=this.buffers[n].byteOffset||0;return"byteOffset"in t&&(a+=t.byteOffset),i.data=new Uint8Array(s,a,t.byteLength),i}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}function WY(r,t){return new KY().postProcess(r,t)}const FF=1735152710,Gw=12,fy=8,$Y=1313821514,XY=5130562,JY=0,YY=1,ZY=0,wf=!0;function tZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}function eZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new DataView(r),{magic:i=FF}=e,s=n.getUint32(t,!1);return s===i||s===FF}function rZ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(t),i=tZ(n,e+0),s=n.getUint32(e+4,wf),a=n.getUint32(e+8,wf);switch(Object.assign(r,{header:{byteOffset:e,byteLength:a,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),e+=Gw,r.version){case 1:return nZ(r,n,e);case 2:return iZ(r,n,e,{});default:throw new Error("Invalid GLB version ".concat(r.version,". Only supports v1 and v2."))}}function nZ(r,t,e){ui(r.header.byteLength>Gw+fy);const n=t.getUint32(e+0,wf),i=t.getUint32(e+4,wf);return e+=fy,ui(i===ZY),jw(r,t,e,n),e+=n,e+=qw(r,t,e,r.header.byteLength),e}function iZ(r,t,e,n){return ui(r.header.byteLength>Gw+fy),sZ(r,t,e,n),e+r.header.byteLength}function sZ(r,t,e,n){for(;e+8<=r.header.byteLength;){const i=t.getUint32(e+0,wf),s=t.getUint32(e+4,wf);switch(e+=fy,s){case $Y:jw(r,t,e,i);break;case XY:qw(r,t,e,i);break;case JY:n.strict||jw(r,t,e,i);break;case YY:n.strict||qw(r,t,e,i);break}e+=jp(i,4)}return e}function jw(r,t,e,n){const i=new Uint8Array(t.buffer,e,n),a=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(a),jp(n,4)}function qw(r,t,e,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:e,byteLength:n,arrayBuffer:t.buffer}),jp(n,4)}async function oZ(r,t){var e,n,i,s;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;aZ(r,t,a,o),QY(r,{normalize:o==null||(e=o.gltf)===null||e===void 0?void 0:e.normalize}),RY(r,o,h);const f=[];if(o!=null&&(n=o.gltf)!==null&&n!==void 0&&n.loadBuffers&&r.json.buffers&&await lZ(r,o,h),o!=null&&(i=o.gltf)!==null&&i!==void 0&&i.loadImages){const b=cZ(r,o,h);f.push(b)}const m=OY(r,o,h);return f.push(m),await Promise.all(f),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.postProcess?WY(r,o):r}function aZ(r,t,e,n){if(n.uri&&(r.baseUri=n.uri),t instanceof ArrayBuffer&&!eZ(t,e,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")r.json=z8(t);else if(t instanceof ArrayBuffer){const a={};e=rZ(a,t,e,n.glb),ka(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),r._glb=a,r.json=a.json}else ka(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=r.json.images||[];r.images=new Array(s.length).fill({})}async function lZ(r,t,e){const n=r.json.buffers||[];for(let a=0;a<n.length;++a){const o=n[a];if(o.uri){var i,s;const{fetch:h}=e;ka(h);const f=pF(o.uri,t),m=await(e==null||(i=e.fetch)===null||i===void 0?void 0:i.call(e,f)),b=await(m==null||(s=m.arrayBuffer)===null||s===void 0?void 0:s.call(m));r.buffers[a]={arrayBuffer:b,byteOffset:0,byteLength:b.byteLength},delete o.uri}else r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function cZ(r,t,e){const n=uZ(r),i=r.json.images||[],s=[];for(const a of n)s.push(AZ(r,i[a],a,t,e));return await Promise.all(s)}function uZ(r){const t=new Set,e=r.json.textures||[];for(const n of e)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function AZ(r,t,e,n,i){const{fetch:s,parse:a}=i;let o;if(t.uri&&!t.hasOwnProperty("bufferView")){const f=pF(t.uri,n);o=await(await s(f)).arrayBuffer(),t.bufferView={data:o}}if(Number.isFinite(t.bufferView)){const f=tJ(r.json,r.buffers,t.bufferView);o=Rv(f.buffer,f.byteOffset,f.byteLength)}ka(o,"glTF image has no data");let h=await a(o,[ET,ZX],{mimeType:t.mimeType,basis:n.basis||{format:fF()}},i);h&&h[0]&&(h={compressed:!0,mipmaps:!1,width:h[0].width,height:h[0].height,data:h[0]}),r.images=r.images||[],r.images[e]=h}const Mg={name:"glTF",id:"gltf",module:"gltf",version:DX,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:hZ,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function hZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;t={...Mg.options,...t},t.gltf={...Mg.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await oZ({},r,n,t,e)}async function dZ(r){const t=[];return r.scenes.forEach(e=>{e.traverse(n=>{Object.values(n.model.getUniforms()).forEach(i=>{i.loaded===!1&&t.push(i)})})}),await fZ(()=>t.some(e=>!e.loaded))}async function fZ(r){for(;r();)await new Promise(t=>requestAnimationFrame(t))}const pZ=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,gZ=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,LF=[255,255,255,255],mZ={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:LF},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Mg]};class Kw extends gf{constructor(){super(...arguments),W(this,"state",void 0)}getShaders(){const t=[iw,sw];return this.props._lighting==="pbr"&&t.push(Gb),super.getShaders({vs:pZ,fs:gZ,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:LF,transition:!0},instanceModelMatrix:Q3})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.scenegraph!==n.scenegraph?this._updateScenegraph():e._animations!==n._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.scenegraph)&&super.isLoaded}_updateScenegraph(){const t=this.props,{gl:e}=this.context;let n=null;if(t.scenegraph instanceof _f)n={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const o=t.scenegraph,h=OX(e,o,this._getModelOptions());n={gltf:o,...h},dZ(h).then(()=>this.setNeedsRedraw())}else t.scenegraph&&(Bn.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),n=t.scenegraph);const i={layer:this,gl:e},s=t.getScene(n,i),a=t.getAnimator(n,i);s instanceof _f?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,a,t._animations),this.setState({scenegraph:s,animator:a})):s!==null&&Bn.warn("invalid scenegraph:",s)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse(n=>{this._setModelAttributes(n.model,e)})}}_applyAnimationsProp(t,e,n){if(!t||!e||!n)return;const i=e.getAnimations();Object.keys(n).sort().forEach(s=>{const a=n[s];if(s==="*")i.forEach(o=>{Object.assign(o,a)});else if(Number.isFinite(Number(s))){const o=Number(s);o>=0&&o<i.length?Object.assign(i[o],a):Bn.warn("animation ".concat(s," not found"))()}else{const o=i.find(h=>{let{name:f}=h;return f===s});o?Object.assign(o,a):Bn.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof _f&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(typeof t=="function"?e=t({gl:this.context.gl,layer:this}):e=t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!fn(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(e=>{this._setModelAttributes(e.model,t)})}draw(t){let{moduleParameters:e=null,parameters:n={},context:i}=t;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(i.timeline.getTime()),this.setNeedsRedraw());const{viewport:s}=this.context,{sizeScale:a,sizeMinPixels:o,sizeMaxPixels:h,opacity:f,coordinateSystem:m}=this.props,b=this.getNumInstances();this.state.scenegraph.traverse((x,B)=>{let{worldMatrix:P}=B;x.model.setInstanceCount(b),x.updateModuleSettings(e),x.draw({parameters:n,uniforms:{sizeScale:a,opacity:f,sizeMinPixels:o,sizeMaxPixels:h,composeModelMatrix:H3(s,m),sceneModelMatrix:P,u_Camera:x.model.getUniforms().project_uCameraPosition}})})}}W(Kw,"defaultProps",mZ),W(Kw,"layerName","ScenegraphLayer");const yZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,_Z=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function vZ(r){r.COLOR_0||r.colors||(r.colors={constant:!0,value:new Float32Array([1,1,1])})}const bZ={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Ww extends Mw{getShaders(){const t=super.getShaders();return t.modules.push(Gb),{...t,vs:yZ,fs:_Z}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!e}),super.draw(t))}getModel(t){const{id:e,pbrMaterial:n}=this.props,i=this.parseMaterial(n,t);this.setState({materialParser:i});const s=this.getShaders();return vZ(t.attributes),new of(this.context.gl,{...this.getShaders(),id:e,geometry:t,defines:{...s.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:n}=this.props,i=this.parseMaterial(t,n);this.setState({materialParser:i}),e.setUniforms(i.uniforms)}}parseMaterial(t,e){var n;const i=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return(n=this.state.materialParser)===null||n===void 0||n.delete(),new Y3(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:{unlit:i,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,n=new Uint8ClampedArray(e.length*t.size),i=[];for(let s=0;s<e.length;s++)this.encodePickingColor(e[s],i),n[s*3]=i[0],n[s*3+1]=i[1],n[s*3+2]=i[2];t.value=n}finalizeState(t){var e;super.finalizeState(t),(e=this.state.materialParser)===null||e===void 0||e.delete(),this.setState({materialParser:null})}}W(Ww,"layerName","MeshLayer"),W(Ww,"defaultProps",bZ);const wZ=6378137,xZ=6378137,BZ=6356752314245179e-9;function py(r){return r}new ce;function CZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:py;return"longitude"in r?(t[0]=e(r.longitude),t[1]=e(r.latitude),t[2]=r.height):"x"in r?(t[0]=e(r.x),t[1]=e(r.y),t[2]=r.z):(t[0]=e(r[0]),t[1]=e(r[1]),t[2]=r[2]),t}function EZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return CZ(r,t,xs._cartographicRadians?py:DV)}function SZ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:py;return"longitude"in t?(t.longitude=e(r[0]),t.latitude=e(r[1]),t.height=r[2]):"x"in t?(t.x=e(r[0]),t.y=e(r[1]),t.z=r[2]):(t[0]=e(r[0]),t[1]=e(r[1]),t[2]=r[2]),t}function TZ(r,t){return SZ(r,t,xs._cartographicRadians?py:NV)}const xf=new ce,IZ=new ce,FZ=new ce;function LZ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:s}=t;xf.from(r);const a=xf.x,o=xf.y,h=xf.z,f=n.x,m=n.y,b=n.z,x=a*a*f*f,B=o*o*m*m,P=h*h*b*b,R=x+B+P,Q=Math.sqrt(1/R);if(!Number.isFinite(Q))return;const z=IZ;if(z.copy(r).scale(Q),R<s)return z.to(e);const G=i.x,X=i.y,et=i.z,pt=FZ;pt.set(z.x*G*2,z.y*X*2,z.z*et*2);let gt=(1-Q)*xf.len()/(.5*pt.len()),mt=0,ft,Mt,Lt,at;do{gt-=mt,ft=1/(1+gt*G),Mt=1/(1+gt*X),Lt=1/(1+gt*et);const ct=ft*ft,wt=Mt*Mt,_t=Lt*Lt,Jt=ct*ft,Yt=wt*Mt,ee=_t*Lt;at=x*ct+B*wt+P*_t-1;const ne=-2*(x*Jt*G+B*Yt*X+P*ee*et);mt=at/ne}while(Math.abs(at)>fg.EPSILON12);return xf.scale([ft,Mt,Lt]).to(e)}const PF=1e-14,PZ=new ce,MF={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},$w={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ug={east:new ce,north:new ce,up:new ce,west:new ce,south:new ce,down:new ce},MZ=new ce,UZ=new ce,RZ=new ce;function UF(r,t,e,n,i,s){const a=MF[t]&&MF[t][e];ec(a&&(!n||n===a));let o,h,f;const m=PZ.copy(i);if(rc(m.x,0,PF)&&rc(m.y,0,PF)){const x=Math.sign(m.z);o=MZ.fromArray($w[t]),t!=="east"&&t!=="west"&&o.scale(x),h=UZ.fromArray($w[e]),e!=="east"&&e!=="west"&&h.scale(x),f=RZ.fromArray($w[n]),n!=="east"&&n!=="west"&&f.scale(x)}else{const{up:x,east:B,north:P}=Ug;B.set(-m.y,m.x,0).normalize(),r.geodeticSurfaceNormal(m,x),P.copy(x).cross(B);const{down:R,west:Q,south:z}=Ug;R.copy(x).scale(-1),Q.copy(B).scale(-1),z.copy(P).scale(-1),o=Ug[t],h=Ug[e],f=Ug[n]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=h.x,s[5]=h.y,s[6]=h.z,s[7]=0,s[8]=f.x,s[9]=f.y,s[10]=f.z,s[11]=0,s[12]=m.x,s[13]=m.y,s[14]=m.z,s[15]=1,s}const gy=new ce,RF=new ce,OZ=new ce,oc=new ce,DZ=new ce,my=new ce;class Pi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;W(this,"radii",void 0),W(this,"radiiSquared",void 0),W(this,"radiiToTheFourth",void 0),W(this,"oneOverRadii",void 0),W(this,"oneOverRadiiSquared",void 0),W(this,"minimumRadius",void 0),W(this,"maximumRadius",void 0),W(this,"centerToleranceSquared",fg.EPSILON1),W(this,"squaredXOverSquaredZ",void 0),ec(t>=0),ec(e>=0),ec(n>=0),this.radii=new ce(t,e,n),this.radiiSquared=new ce(t*t,e*e,n*n),this.radiiToTheFourth=new ce(t*t*t*t,e*e*e*e,n*n*n*n),this.oneOverRadii=new ce(t===0?0:1/t,e===0?0:1/e,n===0?0:1/n),this.oneOverRadiiSquared=new ce(t===0?0:1/(t*t),e===0?0:1/(e*e),n===0?0:1/(n*n)),this.minimumRadius=Math.min(t,e,n),this.maximumRadius=Math.max(t,e,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=RF,i=OZ,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,n),i.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(i));return i.scale(1/a),n.scale(s),i.add(n),i.to(e)}cartesianToCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];my.from(t);const n=this.scaleToGeodeticSurface(my,oc);if(!n)return;const i=this.geodeticSurfaceNormal(n,RF),s=DZ;s.copy(my).subtract(n);const a=Math.atan2(i.y,i.x),o=Math.asin(i.z),h=Math.sign(Pb(s,my))*K5(s);return TZ([a,o,h],e)}eastNorthUpToFixedFrame(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new wn;return UF(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new wn;return UF(this,t,e,n,i,s)}geocentricSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return gy.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=EZ(t),i=n[0],s=n[1],a=Math.cos(s);return gy.set(a*Math.cos(i),a*Math.sin(i),Math.sin(s)).normalize(),gy.to(e)}geodeticSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return gy.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return LZ(t,this,e)}scaleToGeocentricSurface(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];oc.from(t);const n=oc.x,i=oc.y,s=oc.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+i*i*a.y+s*s*a.z);return oc.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return oc.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return oc.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];ec(rc(this.radii.x,this.radii.y,fg.EPSILON15)),ec(this.radii.z>0),oc.from(t);const i=oc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-e))return oc.set(0,0,i).to(n)}}W(Pi,"WGS84",new Pi(wZ,xZ,BZ));class NZ{constructor(t,e,n){W(this,"item",void 0),W(this,"previous",void 0),W(this,"next",void 0),this.item=t,this.previous=e,this.next=n}}class kZ{constructor(){W(this,"head",null),W(this,"tail",null),W(this,"_length",0)}get length(){return this._length}add(t){const e=new NZ(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t,++this._length}}class QZ{constructor(){W(this,"_list",void 0),W(this,"_sentinel",void 0),W(this,"_trimTiles",void 0),this._list=new kZ,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,n){e._cacheNode||(e._cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const i=e._cacheNode;i&&(this._list.remove(i),e._cacheNode=null,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,s=t.maximumMemoryUsage*1024*1024,a=this._sentinel;let o=i.head;for(;o!==a&&(t.gpuMemoryUsageInBytes>s||n);){const h=o.item;o=o.next,this.unloadTile(t,h,e)}}trim(){this._trimTiles=!0}}function HZ(r,t){ui(r),ui(t);const{rtcCenter:e,gltfUpAxis:n}=t,{computedTransform:i,boundingVolume:{center:s}}=r;let a=new wn(i);switch(e&&a.translate(e),n){case"Z":break;case"Y":const b=new wn().rotateX(Math.PI/2);a=a.multiplyRight(b);break;case"X":const x=new wn().rotateY(-Math.PI/2);a=a.multiplyRight(x);break}t.isQuantized&&a.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const o=new ce(s);t.cartesianModelMatrix=a,t.cartesianOrigin=o;const h=Pi.WGS84.cartesianToCartographic(o,new ce),m=Pi.WGS84.eastNorthUpToFixedFrame(o).invert();t.cartographicModelMatrix=m.multiplyRight(a),t.cartographicOrigin=h,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const OF=new ce,Xw=new ce,Jw=new ml([new sc,new sc,new sc,new sc,new sc,new sc]);function zZ(r,t){const{cameraDirection:e,cameraUp:n,height:i}=r,{metersPerUnit:s}=r.distanceScales,a=yy(r,r.center),o=Pi.WGS84.eastNorthUpToFixedFrame(a),h=r.unprojectPosition(r.cameraPosition),f=Pi.WGS84.cartographicToCartesian(h,new ce),m=new ce(o.transformAsVector(new ce(e).scale(s))).normalize(),b=new ce(o.transformAsVector(new ce(n).scale(s))).normalize();GZ(r);const x=r.constructor,{longitude:B,latitude:P,width:R,bearing:Q,zoom:z}=r,G=new x({longitude:B,latitude:P,height:i,width:R,bearing:Q,zoom:z,pitch:0});return{camera:{position:f,direction:m,up:b},viewport:r,topDownViewport:G,height:i,cullingVolume:Jw,frameNumber:t,sseDenominator:1.15}}function VZ(r,t,e){if(e===0||r.length<=e)return[r,[]];const n=[],{longitude:i,latitude:s}=t.viewport;for(const[f,m]of r.entries()){const[b,x]=m.header.mbs,B=Math.abs(i-b),P=Math.abs(s-x),R=Math.sqrt(P*P+B*B);n.push([f,R])}const a=n.sort((f,m)=>f[1]-m[1]),o=[];for(let f=0;f<e;f++)o.push(r[a[f][0]]);const h=[];for(let f=e;f<a.length;f++)h.push(r[a[f][0]]);return[o,h]}function GZ(r){const t=r.getFrustumPlanes(),e=DF(t.near,r.cameraPosition),n=yy(r,e),i=yy(r,r.cameraPosition,Xw);let s=0;Jw.planes[s++].fromPointNormal(n,OF.copy(n).subtract(i));for(const a in t){if(a==="near")continue;const o=t[a],h=DF(o,e,Xw),f=yy(r,h,Xw);Jw.planes[s++].fromPointNormal(f,OF.copy(n).subtract(f))}}function DF(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new ce;const n=r.normal.dot(t);return e.copy(r.normal).scale(r.distance-n).add(t),e}function yy(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new ce;const n=r.unprojectPosition(t);return Pi.WGS84.cartographicToCartesian(n,e)}const jZ=6378137,qZ=6378137,Yw=6356752314245179e-9,NF=new ce;function KZ(r,t){if(r instanceof Sg){const{halfAxes:e}=r,n=$Z(e);return Math.log2(Yw/(n+t[2]))}else if(r instanceof Eg){const{radius:e}=r;return Math.log2(Yw/(e+t[2]))}else if(r.width&&r.height){const{width:e,height:n}=r,i=Math.log2(jZ/e),s=Math.log2(qZ/n);return(i+s)/2}return 1}function kF(r,t,e){const n=Pi.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],new ce),i=Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2));return Math.log2(Yw/(i+t[2]))}function WZ(r,t,e){const[n,i,s,a]=r;return kF({xmin:n,xmax:s,ymin:i,ymax:a,zmin:0,zmax:0},t,e)}function $Z(r){r.getColumn(0,NF);const t=r.getColumn(1),e=r.getColumn(2);return NF.add(t).add(e).len()}const Qa={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},ju={ADD:1,REPLACE:2},Bf={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},_l={I3S:"I3S",TILES3D:"TILES3D"},_y={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},XZ={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function QF(r){return r!=null}const ho=new ce,vy=new ce,JZ=new ce,YZ=new ce;function Zw(r,t,e){if(ui(r,"3D Tile: boundingVolume must be defined"),r.box)return ttt(r.box,t,e);if(r.region){const[n,i,s,a,o,h]=r.region,f=Pi.WGS84.cartographicToCartesian([Hu(n),Hu(a),o],JZ),m=Pi.WGS84.cartographicToCartesian([Hu(s),Hu(i),h],YZ),b=new ce().addVectors(f,m).multiplyScalar(.5),x=new ce().subVectors(f,m).len()/2;return HF([b[0],b[1],b[2],x],new wn)}if(r.sphere)return HF(r.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function ZZ(r,t){if(r.box)return ett(t);if(r.region){const[e,n,i,s,a,o]=r.region;return[[Hu(e),Hu(n),a],[Hu(i),Hu(s),o]]}if(r.sphere)return rtt(t);throw new Error("Unkown boundingVolume type")}function ttt(r,t,e){const n=new ce(r[0],r[1],r[2]);t.transform(n,n);let i=[];if(r.length===10){const f=r.slice(3,6),m=new dg;m.fromArray(r,6);const b=new ce([1,0,0]),x=new ce([0,1,0]),B=new ce([0,0,1]);b.transformByQuaternion(m),b.scale(f[0]),x.transformByQuaternion(m),x.scale(f[1]),B.transformByQuaternion(m),B.scale(f[2]),i=[...b.toArray(),...x.toArray(),...B.toArray()]}else i=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const s=t.transformAsVector(i.slice(0,3)),a=t.transformAsVector(i.slice(3,6)),o=t.transformAsVector(i.slice(6,9)),h=new Di([s[0],s[1],s[2],a[0],a[1],a[2],o[0],o[1],o[2]]);return QF(e)?(e.center=n,e.halfAxes=h,e):new Sg(n,h)}function HF(r,t,e){const n=new ce(r[0],r[1],r[2]);t.transform(n,n);const i=t.getScale(vy),s=Math.max(Math.max(i[0],i[1]),i[2]),a=r[3]*s;return QF(e)?(e.center=n,e.radius=a,e):new Eg(n,a)}function ett(r){const t=zF(),{halfAxes:e}=r,n=new ce(e.getColumn(0)),i=new ce(e.getColumn(1)),s=new ce(e.getColumn(2));for(let a=0;a<2;a++){for(let o=0;o<2;o++){for(let h=0;h<2;h++)ho.copy(r.center),ho.add(n),ho.add(i),ho.add(s),VF(t,ho),s.negate();i.negate()}n.negate()}return t}function rtt(r){const t=zF(),{center:e,radius:n}=r,i=Pi.WGS84.scaleToGeodeticSurface(e,ho);let s;i?s=Pi.WGS84.geodeticSurfaceNormal(i):s=new ce(0,0,1);let a=new ce(s[2],-s[1],0);a.len()>0?a.normalize():a=new ce(0,1,0);const o=a.clone().cross(s);for(const h of[a,o,s]){vy.copy(h).scale(n);for(let f=0;f<2;f++)ho.copy(e),ho.add(vy),VF(t,ho),vy.negate()}return t}function zF(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function VF(r,t){Pi.WGS84.cartesianToCartographic(t,ho),r[0][0]=Math.min(r[0][0],ho[0]),r[0][1]=Math.min(r[0][1],ho[1]),r[0][2]=Math.min(r[0][2],ho[2]),r[1][0]=Math.max(r[1][0],ho[0]),r[1][1]=Math.max(r[1][1],ho[1]),r[1][2]=Math.max(r[1][2],ho[2])}new ce,new ce,new wn,new ce,new ce,new ce;function ntt(r,t){const e=r*t;return 1-Math.exp(-(e*e))}function itt(r,t){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const e=r.dynamicScreenSpaceErrorComputedDensity,n=r.dynamicScreenSpaceErrorFactor;return ntt(t,e)*n}return 0}function stt(r,t,e){const n=r.tileset,i=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,s=e?i:r.lodMetricValue;if(s===0)return 0;const a=Math.max(r._distanceToCamera,1e-7),{height:o,sseDenominator:h}=t,{viewDistanceScale:f}=n.options;let m=s*o*(f||1)/(a*h);return m-=itt(n,a),m}const t2=new ce,GF=new ce,zA=new ce,jF=new ce,ott=new ce,e2=new wn,qF=new wn;function att(r,t){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const e=2*KF(r,t);return e<2?"OUT":!r.header.children||e<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function KF(r,t){const{topDownViewport:e}=t,n=r.header.mbs[1],i=r.header.mbs[0],s=r.header.mbs[2],a=r.header.mbs[3],o=[...r.boundingVolume.center],h=e.unprojectPosition(e.cameraPosition);Pi.WGS84.cartographicToCartesian(h,t2),GF.copy(t2).subtract(o).normalize(),Pi.WGS84.eastNorthUpToFixedFrame(o,e2),qF.copy(e2).invert(),zA.copy(t2).transform(qF);const f=Math.sqrt(zA[0]*zA[0]+zA[1]*zA[1]),m=f*f/zA[2];jF.copy([zA[0],zA[1],m]);const x=jF.transform(e2).subtract(o).normalize(),P=GF.cross(x).normalize().scale(a).add(o),R=Pi.WGS84.cartesianToCartographic(P),Q=e.project([i,n,s]),z=e.project(R);return ott.copy(Q).subtract(z).magnitude()}function ltt(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class WF{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;W(this,"_map",new Map),W(this,"_array",void 0),W(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return ui(t<this._array.length),this._array[t]}set(t,e){ui(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){ui(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){ui(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const ctt={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class by{traversalFinished(t){return!0}constructor(t){W(this,"options",void 0),W(this,"root",null),W(this,"selectedTiles",{}),W(this,"requestedTiles",{}),W(this,"emptyTiles",{}),W(this,"lastUpdate",new Date().getTime()),W(this,"updateDebounceTime",1e3),W(this,"_traversalStack",new WF),W(this,"_emptyTraversalStack",new WF),W(this,"_frameNumber",null),this.options={...ctt,...t}}traverse(t,e,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const s=n.pop();let a=!1;this.canTraverse(s,e)&&(this.updateChildTiles(s,e),a=this.updateAndPushChildren(s,e,n,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const o=s.parent,h=!!(!o||o._shouldRefine),f=!a;s.hasRenderContent?s.refine===ju.ADD?(this.loadTile(s,e),this.selectTile(s,e)):s.refine===ju.REPLACE&&(this.loadTile(s,e),f&&this.selectTile(s,e)):(this.emptyTiles[s.id]=s,this.loadTile(s,e),f&&this.selectTile(s,e)),this.touchTile(s,e),s._shouldRefine=a&&h}const i=new Date().getTime();(this.traversalFinished(e)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const n=t.children;for(const i of n)this.updateTile(i,e)}updateAndPushChildren(t,e,n,i){const{loadSiblings:s,skipLevelOfDetail:a}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const h=t.refine===ju.REPLACE&&t.hasRenderContent&&!a;let f=!1,m=!0;for(const b of o)if(b._selectionDepth=i,b.isVisibleAndInRequestVolume?(n.find(b)&&n.delete(b),n.push(b),f=!0):(h||s)&&(this.loadTile(b,e),this.touchTile(b,e)),h){let x;if(b._inRequestVolume?b.hasRenderContent?x=b.contentAvailable:x=this.executeEmptyTraversal(b,e):x=!1,m=m&&x,!m)return!1}return f||(m=!1),m}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!i&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,e,n):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=t._screenSpaceError;return n&&(i=t.getScreenSpaceError(e,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===e.viewport.id&&n.push(i);else n.push(e.viewport.id);t.updateVisibility(e,n)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let n=!1;for(const i of t.children)i.updateVisibility(e),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,e){let n=!0;const i=this._emptyTraversalStack;for(i.push(t);i.length>0&&n;){const s=i.pop();if(this.updateTile(s,e),s.isVisibleAndInRequestVolume||this.loadTile(s,e),this.touchTile(s,e),!s.hasRenderContent&&this.canTraverse(s,e,!1,!0)){const o=s.children;for(const h of o)i.find(h)&&i.delete(h),i.push(h)}else!s.contentAvailable&&!s.hasEmptyContent&&(n=!1)}return n}}const $F=new ce;function utt(r){return r!=null}class r2{constructor(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";W(this,"tileset",void 0),W(this,"header",void 0),W(this,"id",void 0),W(this,"url",void 0),W(this,"parent",void 0),W(this,"refine",void 0),W(this,"type",void 0),W(this,"contentUrl",void 0),W(this,"lodMetricType","geometricError"),W(this,"lodMetricValue",0),W(this,"boundingVolume",null),W(this,"content",null),W(this,"contentState",Qa.UNLOADED),W(this,"gpuMemoryUsageInBytes",0),W(this,"children",[]),W(this,"depth",0),W(this,"viewportIds",[]),W(this,"transform",new wn),W(this,"extensions",null),W(this,"implicitTiling",null),W(this,"userData",{}),W(this,"computedTransform",void 0),W(this,"hasEmptyContent",!1),W(this,"hasTilesetContent",!1),W(this,"traverser",new by({})),W(this,"_cacheNode",null),W(this,"_frameNumber",null),W(this,"_expireDate",null),W(this,"_expiredContent",null),W(this,"_boundingBox",void 0),W(this,"_distanceToCamera",0),W(this,"_screenSpaceError",0),W(this,"_visibilityPlaneMask",void 0),W(this,"_visible",void 0),W(this,"_contentBoundingVolume",void 0),W(this,"_viewerRequestVolume",void 0),W(this,"_initialTransform",new wn),W(this,"_priority",0),W(this,"_selectedFrame",0),W(this,"_requestedFrame",0),W(this,"_selectionDepth",0),W(this,"_touchedFrame",0),W(this,"_centerZDepth",0),W(this,"_shouldRefine",!1),W(this,"_stackLength",0),W(this,"_visitedFrame",0),W(this,"_inRequestVolume",!1),W(this,"_lodJudge",null),this.header=e,this.tileset=t,this.id=i||e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Qa.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Qa.UNLOADED}get contentExpired(){return this.contentState===Qa.EXPIRED}get contentFailed(){return this.contentState===Qa.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=ZZ(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case _l.I3S:return KF(this,t);case _l.TILES3D:return stt(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,n=this.refine===ju.ADD||e;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Qa.UNLOADED)return-1;const i=this.parent,a=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,o=t.root?t.root._screenSpaceError:0;return Math.max(o-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Qa.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=Qa.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await FA(n,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Qa.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Qa.FAILED,n}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Qa.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:ml.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==ml.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:e}=t;const n=this.boundingVolume;return $F.subVectors(n.center,e.position),e.direction.dot($F)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(utt(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=Qa.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new wn(t.transform):new wn;const e=this.parent,n=this.tileset,i=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new wn(i).multiplyRight(this.transform);const s=e&&e._initialTransform?e._initialTransform.clone():new wn;this._initialTransform=new wn(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Qa.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ml.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||ju.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=Zw(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=Zw(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Zw(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new wn).clone().multiplyRight(this.transform);e.equals(this.computedTransform)||(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return ltt(this.tileset.tileset)}}}class Att extends by{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const a=t.children[0];this.updateTileVisibility(a,e),t._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const i=t.refine===ju.REPLACE,s=t._optimChildrenWithinParent===XZ.USE_OPTIMIZATION;if(i&&s&&n&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:n}=t;return!n||n.hasTilesetContent||n.refine!==ju.ADD?!1:!this.shouldRefine(t,e,!0)}}class htt{constructor(){W(this,"frameNumberMap",new Map)}register(t,e){const n=this.frameNumberMap.get(t)||new Map,i=n.get(e)||0;n.set(e,i+1),this.frameNumberMap.set(t,n)}deregister(t,e){const n=this.frameNumberMap.get(t);if(!n)return;const i=n.get(e)||1;n.set(e,i-1)}isZero(t,e){var n;return(((n=this.frameNumberMap.get(t))===null||n===void 0?void 0:n.get(e))||0)===0}}const n2={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class dtt{constructor(){W(this,"_statusMap",void 0),W(this,"pendingTilesRegister",new htt),this._statusMap={}}add(t,e,n,i){if(!this._statusMap[e]){const{frameNumber:s,viewport:{id:a}}=i;this._statusMap[e]={request:t,callback:n,key:e,frameState:i,status:n2.REQUESTED},this.pendingTilesRegister.register(a,s),t().then(o=>{this._statusMap[e].status=n2.COMPLETED;const{frameNumber:h,viewport:{id:f}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(f,h),this._statusMap[e].callback(o,i)}).catch(o=>{this._statusMap[e].status=n2.ERROR;const{frameNumber:h,viewport:{id:f}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(f,h),n(o)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:s,viewport:{id:a}}=e;this.pendingTilesRegister.register(a,s),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class ftt extends by{constructor(t){super(t),W(this,"_tileManager",void 0),this._tileManager=new dtt}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=att(t,e),t._lodJudge==="DIG"}updateChildTiles(t,e){const n=t.header.children||[],i=t.children,s=t.tileset;for(const a of n){const o="".concat(a.id,"-").concat(e.viewport.id),h=i&&i.find(f=>f.id===o);if(h)h&&this.updateTile(h,e);else{let f=()=>this._loadTile(a.id,s);this._tileManager.find(o)?this._tileManager.update(o,e):(s.tileset.nodePages&&(f=()=>s.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(f,o,b=>this._onTileLoad(b,t,o),e))}}return!1}async _loadTile(t,e){const{loader:n}=e,i=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),s={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await FA(i,n,s)}_onTileLoad(t,e,n){const i=new r2(e.tileset,t,e,n);e.children.push(i);const s=this._tileManager.find(i.id).frameState;this.updateTile(i,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,s)}}const ptt={description:"",ellipsoid:Pi.WGS84,modelMatrix:new wn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},wy="Tiles In Tileset(s)",i2="Tiles In Memory",XF="Tiles In View",JF="Tiles To Render",YF="Tiles Loaded",s2="Tiles Loading",ZF="Tiles Unloaded",tL="Failed Tile Loads",eL="Points/Vertices",o2="Tile Memory Use";class gtt{constructor(t,e){W(this,"options",void 0),W(this,"loadOptions",void 0),W(this,"type",void 0),W(this,"tileset",void 0),W(this,"loader",void 0),W(this,"url",void 0),W(this,"basePath",void 0),W(this,"modelMatrix",void 0),W(this,"ellipsoid",void 0),W(this,"lodMetricType",void 0),W(this,"lodMetricValue",void 0),W(this,"refine",void 0),W(this,"root",null),W(this,"roots",{}),W(this,"asset",{}),W(this,"description",""),W(this,"properties",void 0),W(this,"extras",null),W(this,"attributions",{}),W(this,"credits",{}),W(this,"stats",void 0),W(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),W(this,"cartographicCenter",null),W(this,"cartesianCenter",null),W(this,"zoom",1),W(this,"boundingVolume",null),W(this,"dynamicScreenSpaceErrorComputedDensity",0),W(this,"maximumMemoryUsage",32),W(this,"gpuMemoryUsageInBytes",0),W(this,"_frameNumber",0),W(this,"_queryParams",{}),W(this,"_extensionsUsed",[]),W(this,"_tiles",{}),W(this,"_pendingCount",0),W(this,"selectedTiles",[]),W(this,"traverseCounter",0),W(this,"geometricError",0),W(this,"lastUpdatedVieports",null),W(this,"_requestedTiles",[]),W(this,"_emptyTiles",[]),W(this,"frameStateData",{}),W(this,"_traverser",void 0),W(this,"_cache",new QZ),W(this,"_requestScheduler",void 0),W(this,"updatePromise",null),W(this,"tilesetInitializationPromise",void 0),this.options={...ptt,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||Ov(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Z8({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new qp({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const n=[];for(const i of e){const s=i.id;this._needTraverse(s)?n.push(s):this.traverseCounter--}for(const i of e){const s=i.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!n.includes(s))continue;const a=zZ(i,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[e],i=Object.values(this._traverser.selectedTiles),[s,a]=VZ(i,t,this.options.maximumTilesSelected);n.selectedTiles=s;for(const o of a)o.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const n=new Set(t.map(a=>a.id)),i=new Set(e.map(a=>a.id));let s=t.filter(a=>!i.has(a.id)).length>0;return s=s||e.filter(a=>!n.has(a.id)).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?e+=n.content.pointCount:e+=n.content.vertexCount);this.stats.get(XF).count=this.selectedTiles.length,this.stats.get(JF).count=t,this.stats.get(eL).count=e}async _initializeTileSet(t){this.type===_l.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===_l.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===_l.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:s,ymin:a,ymax:o,zmin:h,zmax:f}=e;this.cartographicCenter=new ce(i+(s-i)/2,a+(o-a)/2,h+(f-h)/2),this.cartesianCenter=Pi.WGS84.cartographicToCartesian(this.cartographicCenter,new ce),this.zoom=kF(e,this.cartographicCenter,this.cartesianCenter);return}const n=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(n){const[i,s,a,o]=n;this.cartographicCenter=new ce(i+(a-i)/2,s+(o-s)/2,0),this.cartesianCenter=Pi.WGS84.cartographicToCartesian(this.cartographicCenter,new ce),this.zoom=WZ(n,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new ce,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new ce,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?this.cartographicCenter=Pi.WGS84.cartesianToCartographic(e,new ce):this.cartographicCenter=new ce(0,0,-Pi.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=KZ(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(wy),this.stats.get(s2),this.stats.get(i2),this.stats.get(XF),this.stats.get(JF),this.stats.get(YF),this.stats.get(ZF),this.stats.get(tL),this.stats.get(eL),this.stats.get(o2,"memory")}_initializeTileHeaders(t,e){const n=new r2(this,t.root,e);if(e&&(e.children.push(n),n.depth=e.depth+1),this.type===_l.TILES3D){const s=[];for(s.push(n);s.length>0;){const a=s.pop();this.stats.get(wy).incrementCount();const o=a.header.children||[];for(const h of o){var i;const f=new r2(this,h,a);if((i=f.contentUrl)!==null&&i!==void 0&&i.includes("?session=")){const b=new URL(f.contentUrl).searchParams.get("session");b&&(this._queryParams.session=b)}a.children.push(f),f.depth=a.depth+1,s.push(f)}}}return n}_initializeTraverser(){let t;switch(this.type){case _l.TILES3D:t=Att;break;case _l.I3S:t=ftt;break;default:t=by}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(n){this._onTileLoadError(t,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(tL).incrementCount();const n=e.message||e.toString(),i=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(n)),this.options.onTileError(t,n,i)}_onTileLoad(t,e){if(e){if(this.type===_l.I3S){var n,i;const s=((n=this.tileset)===null||n===void 0||(i=n.nodePagesTile)===null||i===void 0?void 0:i.nodesInNodePages)||0;this.stats.get(wy).reset(),this.stats.get(wy).addCount(s)}t&&t.content&&HZ(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===_l.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===_l.TILES3D){var e;const{extensionsRemoved:n=[]}=((e=t.content)===null||e===void 0?void 0:e.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(s2).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(s2).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(YF).incrementCount(),this.stats.get(i2).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(o2).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(i2).decrementCount(),this.stats.get(ZF).incrementCount(),this.stats.get(o2).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const n of e.children)t.push(n);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const i of t.children)n.push(i);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),n=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const rL="3.4.15",Rg={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function nL(r,t,e){ui(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,t,e);return n.decode(i)}function mtt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const e=new DataView(r);return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}const ytt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ds={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Tn={...ytt,...ds},a2={[ds.DOUBLE]:Float64Array,[ds.FLOAT]:Float32Array,[ds.UNSIGNED_SHORT]:Uint16Array,[ds.UNSIGNED_INT]:Uint32Array,[ds.UNSIGNED_BYTE]:Uint8Array,[ds.BYTE]:Int8Array,[ds.SHORT]:Int16Array,[ds.INT]:Int32Array},_tt={DOUBLE:ds.DOUBLE,FLOAT:ds.FLOAT,UNSIGNED_SHORT:ds.UNSIGNED_SHORT,UNSIGNED_INT:ds.UNSIGNED_INT,UNSIGNED_BYTE:ds.UNSIGNED_BYTE,BYTE:ds.BYTE,SHORT:ds.SHORT,INT:ds.INT},l2="Failed to convert GL type";class Wc{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in a2)if(a2[e]===t)return e;throw new Error(l2)}static fromName(t){const e=_tt[t];if(!e)throw new Error(l2);return e}static getArrayType(t){switch(t){case ds.UNSIGNED_SHORT_5_6_5:case ds.UNSIGNED_SHORT_4_4_4_4:case ds.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=a2[t];if(!e)throw new Error(l2);return e}}static getByteSize(t){return Wc.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!Wc.getArrayType(t)}static createTypedArray(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(e.byteLength-n)/Wc.getByteSize(t));const s=Wc.getArrayType(t);return new s(e,n,i)}}function vtt(r,t){if(!r)throw new Error("math.gl assertion failed. ".concat(t))}function btt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const e=r>>11&31,n=r>>5&63,i=r&31;return t[0]=e<<3,t[1]=n<<2,t[2]=i<<3,t}new Lb,new ce,new Lb,new Lb;function iL(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return zu(r,0,t)/t*2-1}function sL(r){return r<0?-1:1}function wtt(r,t,e,n){if(vtt(n),r<0||r>e||t<0||t>e)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(e));if(n.x=iL(r,e),n.y=iL(t,e),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*sL(i),n.y=(1-Math.abs(i))*sL(n.y)}return n.normalize()}function xtt(r,t,e){return wtt(r,t,255,e)}class c2{constructor(t,e){W(this,"json",void 0),W(this,"buffer",void 0),W(this,"featuresLength",0),W(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tn.UNSIGNED_INT,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,i.byteOffset):i}getPropertyArray(t,e,n){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(e=Wc.fromName(i.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(t,e,i)}getProperty(t,e,n,i,s){const a=this.json[t];if(!a)return a;const o=this.getPropertyArray(t,e,n);if(n===1)return o[i];for(let h=0;h<n;++h)s[h]=o[n*i+h];return s}_getTypedArrayFromBinary(t,e,n,i,s){const a=this._cachedTypedArrays;let o=a[t];return o||(o=Wc.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+s,i*n),a[t]=o),o}_getTypedArrayFromArray(t,e,n){const i=this._cachedTypedArrays;let s=i[t];return s||(s=Wc.createTypedArray(e,n),i[t]=s),s}}const Btt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ctt={SCALAR:(r,t)=>r[t],VEC2:(r,t)=>[r[2*t+0],r[2*t+1]],VEC3:(r,t)=>[r[3*t+0],r[3*t+1],r[3*t+2]],VEC4:(r,t)=>[r[4*t+0],r[4*t+1],r[4*t+2],r[4*t+3]],MAT2:(r,t)=>[r[4*t+0],r[4*t+1],r[4*t+2],r[4*t+3]],MAT3:(r,t)=>[r[9*t+0],r[9*t+1],r[9*t+2],r[9*t+3],r[9*t+4],r[9*t+5],r[9*t+6],r[9*t+7],r[9*t+8]],MAT4:(r,t)=>[r[16*t+0],r[16*t+1],r[16*t+2],r[16*t+3],r[16*t+4],r[16*t+5],r[16*t+6],r[16*t+7],r[16*t+8],r[16*t+9],r[16*t+10],r[16*t+11],r[16*t+12],r[16*t+13],r[16*t+14],r[16*t+15]]},Ett={SCALAR:(r,t,e)=>{t[e]=r},VEC2:(r,t,e)=>{t[2*e+0]=r[0],t[2*e+1]=r[1]},VEC3:(r,t,e)=>{t[3*e+0]=r[0],t[3*e+1]=r[1],t[3*e+2]=r[2]},VEC4:(r,t,e)=>{t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},MAT2:(r,t,e)=>{t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},MAT3:(r,t,e)=>{t[9*e+0]=r[0],t[9*e+1]=r[1],t[9*e+2]=r[2],t[9*e+3]=r[3],t[9*e+4]=r[4],t[9*e+5]=r[5],t[9*e+6]=r[6],t[9*e+7]=r[7],t[9*e+8]=r[8],t[9*e+9]=r[9]},MAT4:(r,t,e)=>{t[16*e+0]=r[0],t[16*e+1]=r[1],t[16*e+2]=r[2],t[16*e+3]=r[3],t[16*e+4]=r[4],t[16*e+5]=r[5],t[16*e+6]=r[6],t[16*e+7]=r[7],t[16*e+8]=r[8],t[16*e+9]=r[9],t[16*e+10]=r[10],t[16*e+11]=r[11],t[16*e+12]=r[12],t[16*e+13]=r[13],t[16*e+14]=r[14],t[16*e+15]=r[15]}};function Stt(r,t,e,n){const{componentType:i}=r;ui(r.componentType);const s=typeof i=="string"?Wc.fromName(i):i,a=Btt[r.type],o=Ctt[r.type],h=Ett[r.type];return e+=r.byteOffset,{values:Wc.createTypedArray(s,t,e,a*n),type:s,size:a,unpacker:o,packer:h}}const $c=r=>r!==void 0;function Ttt(r,t,e){if(!t)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?Itt(n,e):null}function Itt(r,t){let e,n,i;const s=r.instancesLength,a=r.classes;let o=r.classIds,h=r.parentCounts,f=r.parentIds,m=s;$c(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,i=getBinaryAccessor(o),o=i.createArrayBufferView(t.buffer,t.byteOffset+o.byteOffset,s));let b;if($c(h))for($c(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),h=i.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,s)),b=new Uint16Array(s),m=0,e=0;e<s;++e)b[e]=m,m+=h[e];$c(f)&&$c(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,i=getBinaryAccessor(f),f=i.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,m));const x=a.length;for(e=0;e<x;++e){const Q=a[e].length,z=a[e].instances,G=getBinaryProperties(Q,z,t);a[e].instances=combine(G,z)}const B=new Array(x).fill(0),P=new Uint16Array(s);for(e=0;e<s;++e)n=o[e],P[e]=B[n],++B[n];const R={classes:a,classIds:o,classIndexes:P,parentCounts:h,parentIndexes:b,parentIds:f};return Ptt(R),R}function Og(r,t,e){if(!r)return;const n=r.parentCounts;return r.parentIds?e(r,t):n>0?Ftt(r,t,e):Ltt(r,t,e)}function Ftt(r,t,e){const n=r.classIds,i=r.parentCounts,s=r.parentIds,a=r.parentIndexes,o=n.length,h=scratchVisited;h.length=Math.max(h.length,o);const f=++marker,m=scratchStack;for(m.length=0,m.push(t);m.length>0;){if(t=m.pop(),h[t]===f)continue;h[t]=f;const b=e(r,t);if($c(b))return b;const x=i[t],B=a[t];for(let P=0;P<x;++P){const R=s[B+P];R!==t&&m.push(R)}}return null}function Ltt(r,t,e){let n=!0;for(;n;){const i=e(r,t);if($c(i))return i;const s=r.parentIds[t];n=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}function Ptt(r){const e=r.classIds.length;for(let n=0;n<e;++n)oL(r,n,stack)}function oL(r,t,e){const n=r.parentCounts,i=r.parentIds,s=r.parentIndexes,o=r.classIds.length;if(!$c(i))return;assert(t<o,"Parent index ".concat(t," exceeds the total number of instances: ").concat(o)),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const h=$c(n)?n[t]:1,f=$c(n)?s[t]:t;for(let m=0;m<h;++m){const b=i[f+m];b!==t&&oL(r,b,e)}e.pop(t)}function ca(r){return r!=null}const xy=(r,t)=>r,Mtt={HIERARCHY:!0,extensions:!0,extras:!0};class aL{constructor(t,e,n){var i;let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};W(this,"json",void 0),W(this,"binary",void 0),W(this,"featureCount",void 0),W(this,"_extensions",void 0),W(this,"_properties",void 0),W(this,"_binaryProperties",void 0),W(this,"_hierarchy",void 0),ui(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const a in this.json)Mtt[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Ttt(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),ui(typeof e=="string",e),this._hierarchy){const n=Og(this._hierarchy,t,(i,s)=>{const a=i.classIds[s];return i.classes[a].name===e});return ca(n)}return!1}isExactClass(t,e){return ui(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),ui(typeof e=="string",e),ca(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=ca(e)?e:[],e.length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),ui(typeof e=="string",e),this._binaryProperties){const i=this._binaryProperties[e];if(ca(i))return this._getBinaryProperty(i,t)}const n=this._properties[e];if(ca(n))return xy(n[t]);if(this._hierarchy){const i=this._getHierarchyProperty(t,e);if(ca(i))return i}}setProperty(t,e,n){const i=this.featureCount;if(this._checkBatchId(t),ui(typeof e=="string",e),this._binaryProperties){const a=this._binaryProperties[e];if(a){this._setBinaryProperty(a,t,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let s=this._properties[e];ca(s)||(this._properties[e]=new Array(i),s=this._properties[e]),s[t]=xy(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],i=this._initializeBinaryProperty(e,n);i&&(t=t||{},t[e]=i)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;ui(this.binary,"Property ".concat(t," requires a batch table binary.")),ui(n.type,"Property ".concat(t," requires a type."));const i=Stt(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=Og(this._hierarchy,t,(i,s)=>{const a=i.classIds[s],o=i.classes[a].instances;return ca(o[e])});return ca(n)}_getPropertyNamesInHierarchy(t,e){Og(this._hierarchy,t,(n,i)=>{const s=n.classIds[i],a=n.classes[s].instances;for(const o in a)a.hasOwnProperty(o)&&e.indexOf(o)===-1&&e.push(o)})}_getHierarchyProperty(t,e){return Og(this._hierarchy,t,(n,i)=>{const s=n.classIds[i],a=n.classes[s],o=n.classIndexes[i],h=a.instances[e];return ca(h)?ca(h.typedArray)?this._getBinaryProperty(h,o):xy(h[o]):null})}_setHierarchyProperty(t,e,n,i){const s=Og(this._hierarchy,e,(a,o)=>{const h=a.classIds[o],f=a.classes[h],m=a.classIndexes[o],b=f.instances[n];return ca(b)?(ui(o===e,'Inherited property "'.concat(n,'" is read-only.')),ca(b.typedArray)?this._setBinaryProperty(b,m,i):b[m]=xy(i),!0):!1});return ca(s)}}const u2=4;function By(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(t);if(r.magic=n.getUint32(e,!0),e+=u2,r.version=n.getUint32(e,!0),e+=u2,r.byteLength=n.getUint32(e,!0),e+=u2,r.version!==1)throw new Error("3D Tile Version ".concat(r.version," not supported"));return e}const Cf=4,lL="b3dm tile in legacy format.";function A2(r,t,e){const n=new DataView(t);let i;r.header=r.header||{};let s=n.getUint32(e,!0);e+=Cf;let a=n.getUint32(e,!0);e+=Cf;let o=n.getUint32(e,!0);e+=Cf;let h=n.getUint32(e,!0);return e+=Cf,o>=570425344?(e-=Cf*2,i=s,o=a,h=0,s=0,a=0,console.warn(lL)):h>=570425344&&(e-=Cf,i=o,o=s,h=a,s=0,a=0,console.warn(lL)),r.header.featureTableJsonByteLength=s,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=o,r.header.batchTableBinaryByteLength=h,r.header.batchLength=i,e}function h2(r,t,e,n){return e=Utt(r,t,e),e=Rtt(r,t,e),e}function Utt(r,t,e,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:a}=r.header;if(r.featureTableJson={BATCH_LENGTH:a||0},i>0){const o=nL(t,e,i);r.featureTableJson=JSON.parse(o)}return e+=i,r.featureTableBinary=new Uint8Array(t,e,s),e+=s,e}function Rtt(r,t,e,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=r.header;if(i>0){const a=nL(t,e,i);r.batchTableJson=JSON.parse(a),e+=i,s>0&&(r.batchTableBinary=new Uint8Array(t,e,s),r.batchTableBinary=new Uint8Array(r.batchTableBinary),e+=s)}return e}function cL(r,t,e){if(!t&&(!r||!r.batchIds||!e))return null;const{batchIds:n,isRGB565:i,pointCount:s}=r;if(n&&e){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const h=n[o],m=e.getProperty(h,"dimensions").map(b=>b*255);a[o*3]=m[0],a[o*3+1]=m[1],a[o*3+2]=m[2]}return{type:Tn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(i){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const h=btt(t[o]);a[o*3]=h[0],a[o*3+1]=h[1],a[o*3+2]=h[2]}return{type:Tn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return t&&t.length===s*3?{type:Tn.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Tn.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const uL=new ce;function Ott(r,t){if(!t)return null;if(r.isOctEncoded16P){const e=new Float32Array(r.pointsLength*3);for(let n=0;n<r.pointsLength;n++)xtt(t[n*2],t[n*2+1],uL),uL.toArray(e,n*3);return{type:Tn.FLOAT,size:2,value:e}}return{type:Tn.FLOAT,size:2,value:t}}function Dtt(r,t,e){return r.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,Ntt(r,t)):{type:Tn.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function Ntt(r,t){const e=new ce,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)e.set(t[i*3],t[i*3+1],t[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function ktt(r,t,e,n,i){e=By(r,t,e),e=A2(r,t,e),e=h2(r,t,e),Qtt(r);const{featureTable:s,batchTable:a}=Htt(r);return await qtt(r,s,a,n,i),ztt(r,s,n),Vtt(r,s,a),Gtt(r,s),e}function Qtt(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function Htt(r){const t=new c2(r.featureTableJson,r.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,r.featuresLength=e,r.pointsLength=e,r.pointCount=e,r.rtcCenter=t.getGlobalProperty("RTC_CENTER",Tn.FLOAT,3);const n=jtt(r,t);return{featureTable:t,batchTable:n}}function ztt(r,t,e){if(!r.attributes.positions){if(t.hasProperty("POSITION"))r.attributes.positions=t.getPropertyArray("POSITION",Tn.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",Tn.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Tn.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Tn.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=Dtt(r,n,e)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Vtt(r,t,e){if(!r.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",Tn.UNSIGNED_BYTE,4),r.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",Tn.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",Tn.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=cL(r,n,e)}t.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Tn.UNSIGNED_BYTE,4))}function Gtt(r,t){if(!r.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",Tn.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",Tn.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=Ott(r,e)}}function jtt(r,t){let e=null;if(!r.batchIds&&t.hasProperty("BATCH_ID")&&(r.batchIds=t.getPropertyArray("BATCH_ID",Tn.UNSIGNED_SHORT,1),r.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=r;e=new aL(i,s,n)}return e}async function qtt(r,t,e,n,i){let s,a,o;const h=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(o=h.properties);const f=t.getExtension("3DTILES_draco_point_compression");if(f){a=f.properties;const b=f.byteOffset,x=f.byteLength;if(!a||!Number.isFinite(b)||!x)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=r.featureTableBinary.slice(b,b+x),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;const m={buffer:s,properties:{...a,...o},featureTableProperties:a,batchTableProperties:o,dequantizeInShader:!1};return await Ktt(r,m,n,i)}async function Ktt(r,t,e,n){const{parse:i}=n,s={...e,draco:{...e.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];const a=await i(t.buffer,xF,s),o=a.attributes.POSITION&&a.attributes.POSITION.value,h=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,f=a.attributes.NORMAL&&a.attributes.NORMAL.value,m=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,b=o&&a.attributes.POSITION.value.quantization,x=f&&a.attributes.NORMAL.value.quantization;if(b){const P=a.POSITION.data.quantization,R=P.range;r.quantizedVolumeScale=new ce(R,R,R),r.quantizedVolumeOffset=new ce(P.minValues),r.quantizedRange=(1<<P.quantizationBits)-1,r.isQuantizedDraco=!0}x&&(r.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const B={};if(t.batchTableProperties)for(const P of Object.keys(t.batchTableProperties))a.attributes[P]&&a.attributes[P].value&&(B[P.toLowerCase()]=a.attributes[P].value);r.attributes={positions:o,colors:cL(r,h,void 0),normals:f,batchIds:m,...B}}const d2={URI:0,EMBEDDED:1};function AL(r,t,e,n){r.rotateYtoZ=!0;const i=r.byteOffset+r.byteLength-e;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=Rv(t,e,i),r.gltfByteOffset=0,r.gltfByteLength=i,e%4===0||console.warn("".concat(r.type,": embedded glb is not aligned to a 4-byte boundary.")),r.byteOffset+r.byteLength}async function hL(r,t,e,n){const i=e["3d-tiles"]||{};if(Wtt(r,t),i.loadGLTF){const{parse:s,fetch:a}=n;r.gltfUrl&&(r.gltfArrayBuffer=await a(r.gltfUrl,e),r.gltfByteOffset=0),r.gltfArrayBuffer&&(r.gltf=await s(r.gltfArrayBuffer,Mg,e,n),r.gpuMemoryUsageInBytes=_F(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength)}}function Wtt(r,t,e){switch(t){case d2.URI:const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),s=new TextDecoder().decode(n);r.gltfUrl=s.replace(/[\s\0]+$/,""),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case d2.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function $tt(r,t,e,n,i){var s;e=Xtt(r,t,e,n),await hL(r,d2.EMBEDDED,n,i);const a=r==null||(s=r.gltf)===null||s===void 0?void 0:s.extensions;return a&&a.CESIUM_RTC&&(r.rtcCenter=a.CESIUM_RTC.center),e}function Xtt(r,t,e,n,i){e=By(r,t,e),e=A2(r,t,e),e=h2(r,t,e),e=AL(r,t,e,n);const s=new c2(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=s.getGlobalProperty("RTC_CENTER",Tn.FLOAT,3),e}async function Jtt(r,t,e,n,i){return e=Ytt(r,t,e,n),await hL(r,r.gltfFormat,n,i),e}function Ytt(r,t,e,n,i){if(e=By(r,t,e),r.version!==1)throw new Error("Instanced 3D Model version ".concat(r.version," is not supported"));e=A2(r,t,e);const s=new DataView(t);if(r.gltfFormat=s.getUint32(e,!0),e+=4,e=h2(r,t,e),e=AL(r,t,e,n),r.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new c2(r.featureTableJson,r.featureTableBinary),o=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",Tn.FLOAT,3);const h=new aL(r.batchTableJson,r.batchTableBinary,o);return Ztt(r,a,h,o),e}function Ztt(r,t,e,n){const s={instances:new Array(n),batchTable:r._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,a=new ce;new ce,new ce,new ce;const o=new Di,h=new dg,f=new ce,m={},b=new wn,x=[],B=[],P=new ce,R=new ce;for(let Q=0;Q<n;Q++){let z;if(t.hasProperty("POSITION"))z=t.getProperty("POSITION",Tn.FLOAT,3,Q,a);else if(t.hasProperty("POSITION_QUANTIZED")){z=t.getProperty("POSITION_QUANTIZED",Tn.UNSIGNED_SHORT,3,Q,a);const mt=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Tn.FLOAT,3,P);if(!mt)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ft=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Tn.FLOAT,3,R);if(!ft)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Mt=65535;for(let Lt=0;Lt<3;Lt++)z[Lt]=z[Lt]/Mt*ft[Lt]+mt[Lt]}if(!z)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(z),m.translation=a,r.normalUp=t.getProperty("NORMAL_UP",Tn.FLOAT,3,Q,x),r.normalRight=t.getProperty("NORMAL_RIGHT",Tn.FLOAT,3,Q,B),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Tn.UNSIGNED_SHORT,2,x),r.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Tn.UNSIGNED_SHORT,2,B),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(Pi.WGS84.eastNorthUpToFixedFrame(a,b),b.getRotationMatrix3(o)):o.identity()}h.fromMatrix3(o),m.rotation=h,f.set(1,1,1);const G=t.getProperty("SCALE",Tn.FLOAT,1,Q);Number.isFinite(G)&&f.multiplyByScalar(G);const X=t.getProperty("SCALE_NON_UNIFORM",Tn.FLOAT,3,Q,x);X&&f.scale(X),m.scale=f;let et=t.getProperty("BATCH_ID",Tn.UNSIGNED_SHORT,1,Q);et===void 0&&(et=Q);const pt=new wn().fromQuaternion(m.rotation);b.identity(),b.translate(m.translation),b.multiplyRight(pt),b.scale(m.scale);const gt=b.clone();s[Q]={modelMatrix:gt,batchId:et}}r.instances=s}async function tet(r,t,e,n,i,s){e=By(r,t,e);const a=new DataView(t);for(r.tilesLength=a.getUint32(e,!0),e+=4,r.tiles=[];r.tiles.length<r.tilesLength&&r.byteLength-e>12;){const o={};r.tiles.push(o),e=await s(t,e,n,i,o)}return e}async function eet(r,t,e,n){r.rotateYtoZ=!0,r.gltfUpAxis=e["3d-tiles"]&&e["3d-tiles"].assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=n;r.gltf=await i(t,Mg,e,n),r.gpuMemoryUsageInBytes=_F(r.gltf)}async function dL(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=t,i.type=mtt(r,t),i.type){case Rg.COMPOSITE:return await tet(i,r,t,e,n,dL);case Rg.BATCHED_3D_MODEL:return await $tt(i,r,t,e,n);case Rg.GLTF:return await eet(i,r,e,n);case Rg.INSTANCED_3D_MODEL:return await Jtt(i,r,t,e,n);case Rg.POINT_CLOUD:return await ktt(i,r,t,e,n);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const ret=1952609651,net=1;async function iet(r,t,e){if(new Uint32Array(r.slice(0,4))[0]!==ret)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==net)throw new Error("Wrong subtree file verson, must be 1");const s=fL(r.slice(8,16)),a=new Uint8Array(r,24,s),h=new TextDecoder("utf8").decode(a),f=JSON.parse(h),m=fL(r.slice(16,24));let b=new ArrayBuffer(0);return m&&(b=r.slice(24+s)),"bufferView"in f.tileAvailability&&(f.tileAvailability.explicitBitstream=await f2(f,"tileAvailability",b,e)),"bufferView"in f.contentAvailability&&(f.contentAvailability.explicitBitstream=await f2(f,"contentAvailability",b,e)),"bufferView"in f.childSubtreeAvailability&&(f.childSubtreeAvailability.explicitBitstream=await f2(f,"childSubtreeAvailability",b,e)),f}function set(r,t){if(t.startsWith("http")){const s=new URL(r,t);return decodeURI(s.toString())}const n="http://".concat(t),i=new URL(r,n);return"/".concat(i.host).concat(i.pathname)}async function f2(r,t,e,n){const i=r[t].bufferView,s=r.bufferViews[i],a=r.buffers[s.buffer];if(!(n!=null&&n.url)||!n.fetch)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(a.uri){const o=set(a.uri,n==null?void 0:n.url),f=await(await n.fetch(o)).arrayBuffer();return new Uint8Array(f,s.byteOffset,s.byteLength)}return new Uint8Array(e,s.byteOffset,s.byteLength)}function fL(r){const t=new DataView(r),e=t.getUint32(0,!0),n=t.getUint32(4,!0);return e+2**32*n}const pL={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:rL,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:iet,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var vl=null;try{vl=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Yn(r,t,e){this.low=r|0,this.high=t|0,this.unsigned=!!e}Yn.prototype.__isLong__,Object.defineProperty(Yn.prototype,"__isLong__",{value:!0});function fo(r){return(r&&r.__isLong__)===!0}function gL(r){var t=Math.clz32(r&-r);return r?31-t:t}Yn.isLong=fo;var mL={},yL={};function Wh(r,t){var e,n,i;return t?(r>>>=0,(i=0<=r&&r<256)&&(n=yL[r],n)?n:(e=Pn(r,0,!0),i&&(yL[r]=e),e)):(r|=0,(i=-128<=r&&r<128)&&(n=mL[r],n)?n:(e=Pn(r,r<0?-1:0,!1),i&&(mL[r]=e),e))}Yn.fromInt=Wh;function bl(r,t){if(isNaN(r))return t?qu:lc;if(t){if(r<0)return qu;if(r>=vL)return CL}else{if(r<=-bL)return ua;if(r+1>=bL)return BL}return r<0?bl(-r,t).neg():Pn(r%Ef|0,r/Ef|0,t)}Yn.fromNumber=bl;function Pn(r,t,e){return new Yn(r,t,e)}Yn.fromBits=Pn;var Cy=Math.pow;function p2(r,t,e){if(r.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return t?qu:lc;if(e=e||10,e<2||36<e)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return p2(r.substring(1),t,e).neg();for(var i=bl(Cy(e,8)),s=lc,a=0;a<r.length;a+=8){var o=Math.min(8,r.length-a),h=parseInt(r.substring(a,a+o),e);if(o<8){var f=bl(Cy(e,o));s=s.mul(f).add(bl(h))}else s=s.mul(i),s=s.add(bl(h))}return s.unsigned=t,s}Yn.fromString=p2;function ac(r,t){return typeof r=="number"?bl(r,t):typeof r=="string"?p2(r,t):Pn(r.low,r.high,typeof t=="boolean"?t:r.unsigned)}Yn.fromValue=ac;var _L=65536,oet=1<<24,Ef=_L*_L,vL=Ef*Ef,bL=vL/2,wL=Wh(oet),lc=Wh(0);Yn.ZERO=lc;var qu=Wh(0,!0);Yn.UZERO=qu;var Sf=Wh(1);Yn.ONE=Sf;var xL=Wh(1,!0);Yn.UONE=xL;var g2=Wh(-1);Yn.NEG_ONE=g2;var BL=Pn(-1,2147483647,!1);Yn.MAX_VALUE=BL;var CL=Pn(-1,-1,!0);Yn.MAX_UNSIGNED_VALUE=CL;var ua=Pn(0,-2147483648,!1);Yn.MIN_VALUE=ua;var Qe=Yn.prototype;Qe.toInt=function(){return this.unsigned?this.low>>>0:this.low},Qe.toNumber=function(){return this.unsigned?(this.high>>>0)*Ef+(this.low>>>0):this.high*Ef+(this.low>>>0)},Qe.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ua)){var e=bl(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=bl(Cy(t,6),this.unsigned),a=this,o="";;){var h=a.div(s),f=a.sub(h.mul(s)).toInt()>>>0,m=f.toString(t);if(a=h,a.isZero())return m+o;for(;m.length<6;)m="0"+m;o=""+m+o}},Qe.getHighBits=function(){return this.high},Qe.getHighBitsUnsigned=function(){return this.high>>>0},Qe.getLowBits=function(){return this.low},Qe.getLowBitsUnsigned=function(){return this.low>>>0},Qe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ua)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1},Qe.isZero=function(){return this.high===0&&this.low===0},Qe.eqz=Qe.isZero,Qe.isNegative=function(){return!this.unsigned&&this.high<0},Qe.isPositive=function(){return this.unsigned||this.high>=0},Qe.isOdd=function(){return(this.low&1)===1},Qe.isEven=function(){return(this.low&1)===0},Qe.equals=function(t){return fo(t)||(t=ac(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},Qe.eq=Qe.equals,Qe.notEquals=function(t){return!this.eq(t)},Qe.neq=Qe.notEquals,Qe.ne=Qe.notEquals,Qe.lessThan=function(t){return this.comp(t)<0},Qe.lt=Qe.lessThan,Qe.lessThanOrEqual=function(t){return this.comp(t)<=0},Qe.lte=Qe.lessThanOrEqual,Qe.le=Qe.lessThanOrEqual,Qe.greaterThan=function(t){return this.comp(t)>0},Qe.gt=Qe.greaterThan,Qe.greaterThanOrEqual=function(t){return this.comp(t)>=0},Qe.gte=Qe.greaterThanOrEqual,Qe.ge=Qe.greaterThanOrEqual,Qe.compare=function(t){if(fo(t)||(t=ac(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Qe.comp=Qe.compare,Qe.negate=function(){return!this.unsigned&&this.eq(ua)?ua:this.not().add(Sf)},Qe.neg=Qe.negate,Qe.add=function(t){fo(t)||(t=ac(t));var e=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,a=t.high>>>16,o=t.high&65535,h=t.low>>>16,f=t.low&65535,m=0,b=0,x=0,B=0;return B+=s+f,x+=B>>>16,B&=65535,x+=i+h,b+=x>>>16,x&=65535,b+=n+o,m+=b>>>16,b&=65535,m+=e+a,m&=65535,Pn(x<<16|B,m<<16|b,this.unsigned)},Qe.subtract=function(t){return fo(t)||(t=ac(t)),this.add(t.neg())},Qe.sub=Qe.subtract,Qe.multiply=function(t){if(this.isZero())return this;if(fo(t)||(t=ac(t)),vl){var e=vl.mul(this.low,this.high,t.low,t.high);return Pn(e,vl.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?qu:lc;if(this.eq(ua))return t.isOdd()?ua:lc;if(t.eq(ua))return this.isOdd()?ua:lc;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(wL)&&t.lt(wL))return bl(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,a=this.low&65535,o=t.high>>>16,h=t.high&65535,f=t.low>>>16,m=t.low&65535,b=0,x=0,B=0,P=0;return P+=a*m,B+=P>>>16,P&=65535,B+=s*m,x+=B>>>16,B&=65535,B+=a*f,x+=B>>>16,B&=65535,x+=i*m,b+=x>>>16,x&=65535,x+=s*f,b+=x>>>16,x&=65535,x+=a*h,b+=x>>>16,x&=65535,b+=n*m+i*f+s*h+a*o,b&=65535,Pn(B<<16|P,b<<16|x,this.unsigned)},Qe.mul=Qe.multiply,Qe.divide=function(t){if(fo(t)||(t=ac(t)),t.isZero())throw Error("division by zero");if(vl){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?vl.div_u:vl.div_s)(this.low,this.high,t.low,t.high);return Pn(e,vl.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?qu:lc;var n,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return qu;if(t.gt(this.shru(1)))return xL;s=qu}else{if(this.eq(ua)){if(t.eq(Sf)||t.eq(g2))return ua;if(t.eq(ua))return Sf;var a=this.shr(1);return n=a.div(t).shl(1),n.eq(lc)?t.isNegative()?Sf:g2:(i=this.sub(t.mul(n)),s=n.add(i.div(t)),s)}else if(t.eq(ua))return this.unsigned?qu:lc;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=lc}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),h=o<=48?1:Cy(2,o-48),f=bl(n),m=f.mul(t);m.isNegative()||m.gt(i);)n-=h,f=bl(n,this.unsigned),m=f.mul(t);f.isZero()&&(f=Sf),s=s.add(f),i=i.sub(m)}return s},Qe.div=Qe.divide,Qe.modulo=function(t){if(fo(t)||(t=ac(t)),vl){var e=(this.unsigned?vl.rem_u:vl.rem_s)(this.low,this.high,t.low,t.high);return Pn(e,vl.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},Qe.mod=Qe.modulo,Qe.rem=Qe.modulo,Qe.not=function(){return Pn(~this.low,~this.high,this.unsigned)},Qe.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Qe.clz=Qe.countLeadingZeros,Qe.countTrailingZeros=function(){return this.low?gL(this.low):gL(this.high)+32},Qe.ctz=Qe.countTrailingZeros,Qe.and=function(t){return fo(t)||(t=ac(t)),Pn(this.low&t.low,this.high&t.high,this.unsigned)},Qe.or=function(t){return fo(t)||(t=ac(t)),Pn(this.low|t.low,this.high|t.high,this.unsigned)},Qe.xor=function(t){return fo(t)||(t=ac(t)),Pn(this.low^t.low,this.high^t.high,this.unsigned)},Qe.shiftLeft=function(t){return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Pn(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Pn(0,this.low<<t-32,this.unsigned)},Qe.shl=Qe.shiftLeft,Qe.shiftRight=function(t){return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Pn(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Pn(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Qe.shr=Qe.shiftRight,Qe.shiftRightUnsigned=function(t){return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Pn(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?Pn(this.high,0,this.unsigned):Pn(this.high>>>t-32,0,this.unsigned)},Qe.shru=Qe.shiftRightUnsigned,Qe.shr_u=Qe.shiftRightUnsigned,Qe.rotateLeft=function(t){var e;return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?Pn(this.high,this.low,this.unsigned):t<32?(e=32-t,Pn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,Pn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))},Qe.rotl=Qe.rotateLeft,Qe.rotateRight=function(t){var e;return fo(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?Pn(this.high,this.low,this.unsigned):t<32?(e=32-t,Pn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,Pn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))},Qe.rotr=Qe.rotateRight,Qe.toSigned=function(){return this.unsigned?Pn(this.low,this.high,!1):this},Qe.toUnsigned=function(){return this.unsigned?this:Pn(this.low,this.high,!0)},Qe.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Qe.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},Qe.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]},Yn.fromBytes=function(t,e,n){return n?Yn.fromBytesLE(t,e):Yn.fromBytesBE(t,e)},Yn.fromBytesLE=function(t,e){return new Yn(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Yn.fromBytesBE=function(t,e){return new Yn(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const aet=16;function EL(r){r==="X"&&(r="");const t=r.padEnd(aet,"0");return Yn.fromString(t,!0,16)}function cet(r){if(r.isZero())return"X";let t=r.countTrailingZeros();const e=t%4;t=(t-e)/4;const n=t;t*=4;const s=r.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-s.length).join("0")+s}function uet(r,t){const e=Aet(r).shiftRightUnsigned(2);return r.add(Yn.fromNumber(2*t+1-4).multiply(e))}function Aet(r){return r.and(r.not().add(1))}const het=3,det=2*30+1,SL=180/Math.PI;function fet(r){if(r.length===0)throw new Error("Invalid Hilbert quad key ".concat(r));const t=r.split("/"),e=parseInt(t[0],10),n=t[1],i=n.length;let s=0;const a=[0,0];for(let o=i-1;o>=0;o--){s=i-o;const h=n[o];let f=0,m=0;h==="1"?m=1:h==="2"?(f=1,m=1):h==="3"&&(f=1);const b=Math.pow(2,s-1);get(b,a,f,m),a[0]+=b*f,a[1]+=b*m}if(e%2===1){const o=a[0];a[0]=a[1],a[1]=o}return{face:e,ij:a,level:s}}function pet(r){if(r.isZero())return"";let t=r.toString(2);for(;t.length<het+det;)t="0"+t;const e=t.lastIndexOf("1"),n=t.substring(0,3),i=t.substring(3,e),s=i.length/2,a=Yn.fromString(n,!0,2).toString(10);let o="";if(s!==0)for(o=Yn.fromString(i,!0,2).toString(4);o.length<s;)o="0"+o;return"".concat(a,"/").concat(o)}function TL(r,t,e){const n=1<<t;return[(r[0]+e[0])/n,(r[1]+e[1])/n]}function IL(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function FL(r){return[IL(r[0]),IL(r[1])]}function LL(r,t){let[e,n]=t;switch(r){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function PL(r){let[t,e,n]=r;const i=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*SL,i*SL]}function get(r,t,e,n){if(n===0){e===1&&(t[0]=r-1-t[0],t[1]=r-1-t[1]);const i=t[0];t[0]=t[1],t[1]=i}}function met(r){const t=TL(r.ij,r.level,[.5,.5]),e=FL(t),n=LL(r.face,e);return PL(n)}const yet=100;function ML(r){const{face:t,ij:e,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(yet*Math.pow(2,-n))),a=new Float64Array(4*s*2+2);let o=0,h=0;for(let f=0;f<4;f++){const m=i[f].slice(0),b=i[f+1],x=(b[0]-m[0])/s,B=(b[1]-m[1])/s;for(let P=0;P<s;P++){m[0]+=x,m[1]+=B;const R=TL(e,n,m),Q=FL(R),z=LL(t,Q),G=PL(z);Math.abs(G[1])>89.999&&(G[0]=h);const X=G[0]-h;G[0]+=X>180?-360:X<-180?360:0,a[o++]=G[0],a[o++]=G[1],h=G[0]}}return a[o++]=a[0],a[o++]=a[1],a}function m2(r){const t=_et(r);return fet(t)}function _et(r){if(r.indexOf("/")>0)return r;const t=EL(r);return pet(t)}function vet(r){const t=m2(r);return met(t)}function bet(r){let t;if(r.face===2||r.face===5){let e=null,n=0;for(let i=0;i<4;i++){const s="".concat(r.face,"/").concat(i),a=m2(s),o=ML(a);(typeof e>"u"||e===null)&&(e=new Float64Array(4*o.length)),e.set(o,n),n+=o.length}t=UL(e)}else{const e=ML(r);t=UL(e)}return t}function UL(r){if(r.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let n=0;n<r.length;n+=2)t.push(r[n]),e.push(r[n+1]);return t.sort((n,i)=>n-i),e.sort((n,i)=>n-i),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function wet(r,t){const e=(t==null?void 0:t.minimumHeight)||0,n=(t==null?void 0:t.maximumHeight)||0,i=m2(r),s=bet(i),a=s.west,o=s.south,h=s.east,f=s.north,m=[];return m.push(new ce(a,f,e)),m.push(new ce(h,f,e)),m.push(new ce(h,o,e)),m.push(new ce(a,o,e)),m.push(new ce(a,f,n)),m.push(new ce(h,f,n)),m.push(new ce(h,o,n)),m.push(new ce(a,o,n)),m}function RL(r){const t=r.token,e={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=wet(t,e),i=vet(t),s=i[0],a=i[1],o=Pi.WGS84.cartographicToCartesian([s,a,e.maximumHeight]),h=new ce(o[0],o[1],o[2]);n.push(h);const f=eX(n);return[...f.center,...f.halfAxes]}const xet={QUADTREE:4,OCTREE:8};function Bet(r,t,e){if(r!=null&&r.box){const n=EL(r.s2VolumeInfo.token),i=uet(n,t),s=cet(i),a={...r.s2VolumeInfo};switch(a.token=s,e){case"OCTREE":const f=r.s2VolumeInfo,m=f.maximumHeight-f.minimumHeight,b=m/2,x=f.minimumHeight+m/2;f.minimumHeight=x-b,f.maximumHeight=x+b;break}return{box:RL(a),s2VolumeInfo:a}}}async function OL(r){const{options:t,parentData:e={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=r;let{subtree:a,level:o=0}=r;const{subdivisionScheme:h,subtreeLevels:f,maximumLevel:m,contentUrlTemplate:b,subtreesUriTemplate:x,basePath:B}=t,P={children:[],lodMetricValue:0,contentUrl:""},R=xet[h],Q=n&1,z=n>>1&1,G=n>>2&1,X=(R**o-1)/(R-1);let et=$h(e.mortonIndex,n),pt=X+et,gt=$h(e.x,Q),mt=$h(e.y,z),ft=$h(e.z,G),Mt=!1;o+1>f&&(Mt=y2(a.childSubtreeAvailability,et));const Lt=$h(i.x,gt),at=$h(i.y,mt),ct=$h(i.z,ft),wt=o+i.level;if(Mt){const $t="".concat(B,"/").concat(x),ne=_2($t,wt,Lt,at,ct);a=await FA(ne,pL),i.mortonIndex=et,i.x=gt,i.y=mt,i.z=ft,i.level=o,et=0,pt=0,gt=0,mt=0,ft=0,o=0}if(!y2(a.tileAvailability,pt)||o>m)return P;y2(a.contentAvailability,pt)&&(P.contentUrl=_2(b,wt,Lt,at,ct));const Yt=o+1,ee={mortonIndex:et,x:gt,y:mt,z:ft};for(let $t=0;$t<R;$t++){const ne=Bet(s,$t,h),re=await OL({subtree:a,options:t,parentData:ee,childIndex:$t,level:Yt,globalData:i,s2VolumeBox:ne});if(re.contentUrl||re.children.length){const Be=wt+1,bt=Cet(re,Be,{childTileX:gt,childTileY:mt,childTileZ:ft},t,s);P.children.push(bt)}}return P}function y2(r,t){return"constant"in r?!!r.constant:r.explicitBitstream?Iet(t,r.explicitBitstream):!1}function Cet(r,t,e,n,i){const{basePath:s,refine:a,getRefine:o,lodMetricType:h,getTileType:f,rootLodMetricValue:m,rootBoundingVolume:b}=n,x=r.contentUrl&&r.contentUrl.replace("".concat(s,"/"),""),B=m/2**t,P=i!=null&&i.box?{box:i.box}:b,R=Eet(t,P,e);return{children:r.children,contentUrl:r.contentUrl,content:{uri:x},id:r.contentUrl,refine:o(a),type:f(r),lodMetricType:h,lodMetricValue:B,geometricError:B,transform:r.transform,boundingVolume:R}}function Eet(r,t,e){if(t.region){const{childTileX:n,childTileY:i,childTileZ:s}=e,[a,o,h,f,m,b]=t.region,x=2**r,B=(h-a)/x,P=(f-o)/x,R=(b-m)/x,[Q,z]=[a+B*n,a+B*(n+1)],[G,X]=[o+P*i,o+P*(i+1)],[et,pt]=[m+R*s,m+R*(s+1)];return{region:[Q,G,z,X,et,pt]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function $h(r,t){return parseInt(r.toString(2)+t.toString(2),2)}function _2(r,t,e,n,i){const s=Tet({level:t,x:e,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function Tet(r){const t={};for(const e in r)t["{".concat(e,"}")]=r[e];return t}function Iet(r,t){const e=Math.floor(r/8),n=r%8;return(t[e]>>n&1)===1}function v2(r){if(!r.contentUrl)return Bf.EMPTY;const e=r.contentUrl.split("?")[0].split(".").pop();switch(e){case"pnts":return Bf.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Bf.SCENEGRAPH;default:return e}}function b2(r){switch(r){case"REPLACE":case"replace":return ju.REPLACE;case"ADD":case"add":return ju.ADD;default:return r}}function w2(r,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const n=new URL(r,"".concat(t,"/"));return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return"".concat(t,"/").concat(r)}function DL(r,t){if(!r)return null;if(r.content){const e=r.content.uri||r.content.url;r.contentUrl=w2(e,t.basePath)}return r.id=r.contentUrl,r.lodMetricType=_y.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform,r.type=v2(r),r.refine=b2(r.refine),r}async function Fet(r,t){const e=r.basePath;let n;const i=kL(r==null?void 0:r.root);i&&r.root?n=await NL(r.root,r,i,t):n=DL(r.root,r);const s=[];for(s.push(n);s.length>0;){const o=(s.pop()||{}).children||[];for(let h of o){const f=kL(h);f?h=await NL(h,r,f,t):DL(h,{basePath:e}),s.push(h)}}return n}async function NL(r,t,e,n){var i,s;const a=t.basePath,{subdivisionScheme:o,maximumLevel:h,subtreeLevels:f,subtrees:{uri:m}}=e,b=_2(m,0,0,0,0),x=w2(b,a),B=await FA(x,pL,n),P=w2(r.content.uri,a),R=t==null||(i=t.root)===null||i===void 0?void 0:i.refine,Q=r.geometricError,z=(s=r.boundingVolume.extensions)===null||s===void 0?void 0:s["3DTILES_bounding_volume_S2"];if(z){const pt={box:RL(z),s2VolumeInfo:z};r.boundingVolume=pt}const G=r.boundingVolume,X={contentUrlTemplate:P,subtreesUriTemplate:m,subdivisionScheme:o,subtreeLevels:f,maximumLevel:h,refine:R,basePath:a,lodMetricType:_y.GEOMETRIC_ERROR,rootLodMetricValue:Q,rootBoundingVolume:G,getTileType:v2,getRefine:b2};return await Let(r,B,X)}async function Let(r,t,e){if(!r)return null;r.lodMetricType=_y.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform;const{children:n,contentUrl:i}=await OL({subtree:t,options:e,s2VolumeBox:r});return i&&(r.contentUrl=i,r.content={uri:i.replace("".concat(e.basePath,"/"),"")}),r.refine=b2(r.refine),r.type=v2(r),r.children=n,r.id=r.contentUrl,r}function kL(r){var t;return(r==null||(t=r.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const x2={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:rL,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Ret,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function Pet(r){return Ov(r.url)}async function Met(r,t,e){const n={content:{featureIds:null}};return await dL(r,0,t,e,n.content),n.content}async function Uet(r,t,e){var n;const i=JSON.parse(new TextDecoder().decode(r));return i.loader=t.loader||x2,i.url=e.url,i.queryString=e.queryString,i.basePath=Pet(i),i.root=await Fet(i,t),i.type=_l.TILES3D,i.lodMetricType=_y.GEOMETRIC_ERROR,i.lodMetricValue=((n=i.root)===null||n===void 0?void 0:n.lodMetricValue)||0,i}async function Ret(r,t,e){const n=t["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=e.url&&e.url.indexOf(".json")!==-1:i=n.isTileset,i?r=await Uet(r,t,e):r=await Met(r,t,e),r}const QL=[0],Oet={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:x2,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,t,e)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class B2 extends E3{constructor(){super(...arguments),W(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&Bn.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,e;return!!(!((t=this.state)===null||t===void 0||(e=t.tileset3d)===null||e===void 0)&&e.isLoaded()&&super.isLoaded)}shouldUpdateState(t){let{changeFlags:e}=t;return e.somethingChanged}updateState(t){let{props:e,oldProps:n,changeFlags:i}=t;if(e.data&&e.data!==n.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:s}=this.state;for(const a in s)s[a].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,e[t.id]=t;const i=n==null?void 0:n[t.id];(!i||!t.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(t){let{info:e,sourceLayer:n}=t;const i=n&&n.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer(t){let{layer:e,viewport:n}=t;const{tile:i}=e.props,{id:s}=n;return i.selected&&i.viewportIds.includes(s)}_updateAutoHighlight(t){const e=t.sourceTile,n=this.state.layerMap[e==null?void 0:e.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props;let n=this.props.loader||this.props.loaders;Array.isArray(n)&&(n=n[0]);const i={loadOptions:{...e}};let s=t;if(n.preload){const h=await n.preload(t,e);h.url&&(s=h.url),h.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:h.headers}),Object.assign(i,h)}const a=await FA(s,n,i.loadOptions),o=new gtt(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:n}=this.context,i=Object.keys(t).length;!n||!i||!e||e.selectTiles(Object.values(t)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case Bf.POINTCLOUD:return this._makePointCloudLayer(t,e);case Bf.SCENEGRAPH:return this._make3DModelLayer(t);case Bf.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:n,pointCount:i,constantRGBA:s,cartographicOrigin:a,modelMatrix:o}=t.content,{positions:h,normals:f,colors:m}=n;if(!h)return null;const b=e&&e.props.data||{header:{vertexCount:i},attributes:{POSITION:h,NORMAL:f,COLOR_0:m}},{pointSize:x,getPointColor:B}=this.props,P=this.getSubLayerClass("pointcloud",Tw);return new P({pointSize:x},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:b,coordinateSystem:xn.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:s||B,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:n,cartographicOrigin:i,modelMatrix:s}=t.content,a=this.getSubLayerClass("scenegraph",Kw);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:n||QL,scenegraph:e,coordinateSystem:xn.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:o=>o.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const n=t.content,{attributes:i,indices:s,modelMatrix:a,cartographicOrigin:o,coordinateSystem:h=xn.METER_OFFSETS,material:f,featureIds:m}=n,{_getMeshColor:b}=this.props,x=e&&e.props.mesh||new gg({drawMode:4,attributes:Det(i),indices:s}),B=this.getSubLayerClass("mesh",Ww);return new B(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:x,data:QL,getColor:b(t),pbrMaterial:f,modelMatrix:a,coordinateOrigin:o,coordinateSystem:h,featureIds:m,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map(n=>{const i=e[n.id]=e[n.id]||{tile:n};let{layer:s}=i;return n.selected&&(s?i.needsUpdate&&(s=this._getSubLayer(n,s),i.needsUpdate=!1):s=this._getSubLayer(n)),i.layer=s,s}).filter(Boolean):null}}W(B2,"defaultProps",Oet),W(B2,"layerName","Tile3DLayer");function Det(r){const t={};return t.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(t.normals=r.normals),r.texCoords&&(t.texCoords=r.texCoords),r.colors&&(t.colors=r.colors),r.uvRegions&&(t.uvRegions=r.uvRegions),t}var Net=Object.defineProperty,ket=(r,t,e)=>t in r?Net(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Mn=(r,t,e)=>(ket(r,typeof t!="symbol"?t+"":t,e),e);let Qet=class{constructor(t){Mn(this,"map"),Mn(this,"width"),Mn(this,"height"),Mn(this,"svgCanvas"),Mn(this,"xLine"),Mn(this,"yLine"),Mn(this,"color","#535353"),this.map=t,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var t,e;this.width=(t=this.map)==null?void 0:t.getCanvas().clientWidth,this.height=(e=this.map)==null?void 0:e.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const t=this.width/2,e=this.height/2;this.yLine.setAttribute("x1",`${t}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${t}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${e}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${e}px`)}else console.error("element value is null")}createCanvas(t){if(this.width!==void 0&&this.height!==void 0){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.position="relative",e.setAttribute("width",`${this.width}px`),e.setAttribute("height",`${this.height}px`);const n=this.width/2,i=this.height/2;this.yLine=e.appendChild(this.createLine(n,0,n,this.height,this.color,"2px")),this.xLine=e.appendChild(this.createLine(0,i,this.width,i,this.color,"2px")),t==null||t.appendChild(e),this.svgCanvas=e}}createLine(t,e,n,i,s,a){const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1",t),o.setAttribute("y1",e),o.setAttribute("x2",n),o.setAttribute("y2",i),o.setAttribute("stroke-dasharray","5,5"),o.setAttribute("stroke",s),o.setAttribute("stroke-width",a),o}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};const C2={72:72,96:96,200:200,300:300,400:400},Ku={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Dg={Landscape:"landscape",Portrait:"portrait"},Xh={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},Tf={in:"in",mm:"mm"};let Het=class{constructor(t){Mn(this,"map"),Mn(this,"width"),Mn(this,"height"),Mn(this,"unit"),Mn(this,"svgCanvas"),Mn(this,"svgPath");var e,n,i;if(this.map=t,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const s=(e=this.map)==null?void 0:e.getCanvas().clientWidth,a=(n=this.map)==null?void 0:n.getCanvas().clientHeight,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.setAttribute("width",`${s}px`),o.setAttribute("height",`${a}px`);const h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("style","fill:#888888;stroke-width:0"),h.setAttribute("fill-opacity","0.5"),o.append(h),(i=this.map)==null||i.getCanvasContainer().appendChild(o),this.svgCanvas=o,this.svgPath=h}mapResize(){this.generateCutOut()}updateArea(t,e){this.width=t,this.height=e,this.unit=Tf.mm,this.generateCutOut()}generateCutOut(){var t,e;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const n=this.toPixels(this.width),i=this.toPixels(this.height),s=(t=this.map)==null?void 0:t.getCanvas().clientWidth,a=(e=this.map)==null?void 0:e.getCanvas().clientHeight,o=s/2-n/2,h=o+n,f=a/2-i/2,m=f+i;this.svgCanvas.setAttribute("width",`${s}px`),this.svgCanvas.setAttribute("height",`${a}px`),this.svgPath.setAttribute("d",`M 0 0 L ${s} 0 L ${s} ${a} L 0 ${a} M ${o} ${f} L ${o} ${m} L ${h} ${m} L ${h} ${f}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Tf.mm&&(e/=25.4),e*t}};const HL={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},zet={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer",LanguageName:"Franais",LanguageCode:"fr"},Vet={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},Get={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},jet={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},qet={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Espaola",LanguageCode:"es"},Ket={PageSize:"Mida",PageOrientation:"Orientaci",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},Wet={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To",LanguageName:"Ting Vit",LanguageCode:"vi"},$et={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"uk"},Xet={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHans"},Jet={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHant"},Yet={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"ja"},Zet={PageSize:"Tamanho da pgina",PageOrientation:"Orientao da pgina",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Portugus",LanguageCode:"pt"},trt=[HL,zet,Vet,Get,jet,qet,Ket,Wet,$et,Xet,Jet,Yet,Zet],ert=r=>trt.find(t=>t.LanguageCode===r)??HL;(function(r){var t={};function e(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=r,e.c=t,e.d=function(n,i,s){e.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:s})},e.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,i){if(1&i&&(n=e(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var a in n)e.d(s,a,(function(o){return n[o]}).bind(null,a));return s},e.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(i,"a",i),i},e.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},e.p="",e(e.s=0)})([function(r,t,e){r.exports=e(1)},function(r,t){function e(i,s){for(var a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}var n=function(){function i(){(function(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")})(this,i),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var s,a;return s=i,(a=[{key:"show",value:function(o){this.setOptions(o),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var o=document.getElementById("loading-overlay-stylesheet");o&&(o.disabled=!0,o.parentNode.removeChild(o),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(o){if(o!==void 0)for(var h in o)this.options[h]=o[h]}},{key:"generateAndAddOverlayElement",value:function(){var o="50%";this.options.offsetX!==0&&(o="calc(50% + "+this.options.offsetX+")");var h="50%";if(this.options.offsetY!==0&&(h="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var f='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(h,"; left: ").concat(o,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),m=document.getElementById(this.options.containerID);return m.style.position="relative",void m.insertAdjacentHTML("beforeend",f)}var b='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(h,"; left: ").concat(o,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",b)}},{key:"generateSpinnerElement",value:function(){var o=this,h=Object.keys(this.numberOfEmptyDivForSpinner).find(function(m){return m===o.options.spinnerIcon}),f=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[h]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(f,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var o=document.createElement("link");o.setAttribute("id","loading-overlay-stylesheet"),o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(o)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(o){for(var h="",f=1;f<=o;f++)h+="<div></div>";return h}}])&&e(s.prototype,a),i}();window.JsLoadingOverlay=new n,r.exports=JsLoadingOverlay}]);function Un(r){"@babel/helpers - typeof";return Un=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Un(r)}var Aa=Uint8Array,No=Uint16Array,Ng=Uint32Array,Ey=new Aa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Sy=new Aa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),E2=new Aa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zL=function(r,t){for(var e=new No(31),n=0;n<31;++n)e[n]=t+=1<<r[n-1];for(var i=new Ng(e[30]),n=1;n<30;++n)for(var s=e[n];s<e[n+1];++s)i[s]=s-e[n]<<5|n;return[e,i]},VL=zL(Ey,2),jL=VL[0],S2=VL[1];jL[28]=258,S2[258]=28;for(var qL=zL(Sy,0),rrt=qL[0],KL=qL[1],T2=new No(32768),bi=0;bi<32768;++bi){var VA=(bi&43690)>>>1|(bi&21845)<<1;VA=(VA&52428)>>>2|(VA&13107)<<2,VA=(VA&61680)>>>4|(VA&3855)<<4,T2[bi]=((VA&65280)>>>8|(VA&255)<<8)>>>1}for(var Xc=function(r,t,e){for(var n=r.length,i=0,s=new No(t);i<n;++i)++s[r[i]-1];var a=new No(t);for(i=0;i<t;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(e){o=new No(1<<t);var h=15-t;for(i=0;i<n;++i)if(r[i])for(var f=i<<4|r[i],m=t-r[i],b=a[r[i]-1]++<<m,x=b|(1<<m)-1;b<=x;++b)o[T2[b]>>>h]=f}else for(o=new No(n),i=0;i<n;++i)o[i]=T2[a[r[i]-1]++]>>>15-r[i];return o},GA=new Aa(288),bi=0;bi<144;++bi)GA[bi]=8;for(var bi=144;bi<256;++bi)GA[bi]=9;for(var bi=256;bi<280;++bi)GA[bi]=7;for(var bi=280;bi<288;++bi)GA[bi]=8;for(var kg=new Aa(32),bi=0;bi<32;++bi)kg[bi]=5;var nrt=Xc(GA,9,0),irt=Xc(GA,9,1),srt=Xc(kg,5,0),ort=Xc(kg,5,1),I2=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},cc=function(r,t,e){var n=t/8>>0;return(r[n]|r[n+1]<<8)>>>(t&7)&e},F2=function(r,t){var e=t/8>>0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>>(t&7)},L2=function(r){return(r/8>>0)+(r&7&&1)},WL=function(r,t,e){(e==null||e>r.length)&&(e=r.length);var n=new(r instanceof No?No:r instanceof Ng?Ng:Aa)(e-t);return n.set(r.subarray(t,e)),n},art=function(r,t,e){var n=r.length,i=!t||e,s=!e||e.i;e||(e={}),t||(t=new Aa(n*3));var a=function(qt){var Gt=t.length;if(qt>Gt){var oe=new Aa(Math.max(Gt*2,qt));oe.set(t),t=oe}},o=e.f||0,h=e.p||0,f=e.b||0,m=e.l,b=e.d,x=e.m,B=e.n,P=n*8;do{if(!m){e.f=o=cc(r,h,1);var R=cc(r,h+1,3);if(h+=3,R)if(R==1)m=irt,b=ort,x=9,B=5;else if(R==2){var Q=cc(r,h,31)+257,z=cc(r,h+10,15)+4,G=Q+cc(r,h+5,31)+1;h+=14;for(var X=new Aa(G),et=new Aa(19),pt=0;pt<z;++pt)et[E2[pt]]=cc(r,h+pt*3,7);h+=z*3;var gt=I2(et),mt=(1<<gt)-1;if(!s&&h+G*(gt+7)>P)break;for(var ft=Xc(et,gt,1),pt=0;pt<G;){var Mt=ft[cc(r,h,mt)];h+=Mt&15;var Lt=Mt>>>4;if(Lt<16)X[pt++]=Lt;else{var at=0,ct=0;for(Lt==16?(ct=3+cc(r,h,3),h+=2,at=X[pt-1]):Lt==17?(ct=3+cc(r,h,7),h+=3):Lt==18&&(ct=11+cc(r,h,127),h+=7);ct--;)X[pt++]=at}}var wt=X.subarray(0,Q),_t=X.subarray(Q);x=I2(wt),B=I2(_t),m=Xc(wt,x,1),b=Xc(_t,B,1)}else throw"invalid block type";else{var Lt=L2(h)+4,Jt=r[Lt-4]|r[Lt-3]<<8,Yt=Lt+Jt;if(Yt>n){if(s)throw"unexpected EOF";break}i&&a(f+Jt),t.set(r.subarray(Lt,Yt),f),e.b=f+=Jt,e.p=h=Yt*8;continue}if(h>P)throw"unexpected EOF"}i&&a(f+131072);for(var ee=(1<<x)-1,$t=(1<<B)-1,ne=x+B+18;s||h+ne<P;){var at=m[F2(r,h)&ee],re=at>>>4;if(h+=at&15,h>P)throw"unexpected EOF";if(!at)throw"invalid length/literal";if(re<256)t[f++]=re;else if(re==256){m=null;break}else{var Be=re-254;if(re>264){var pt=re-257,it=Ey[pt];Be=cc(r,h,(1<<it)-1)+jL[pt],h+=it}var bt=b[F2(r,h)&$t],Pt=bt>>>4;if(!bt)throw"invalid distance";h+=bt&15;var _t=rrt[Pt];if(Pt>3){var it=Sy[Pt];_t+=F2(r,h)&(1<<it)-1,h+=it}if(h>P)throw"unexpected EOF";i&&a(f+131072);for(var Ot=f+Be;f<Ot;f+=4)t[f]=t[f-_t],t[f+1]=t[f+1-_t],t[f+2]=t[f+2-_t],t[f+3]=t[f+3-_t];f=Ot}}e.l=m,e.p=h,e.b=f,m&&(o=1,e.m=x,e.d=b,e.n=B)}while(!o);return f==t.length?t:WL(t,0,f)},Wu=function(r,t,e){e<<=t&7;var n=t/8>>0;r[n]|=e,r[n+1]|=e>>>8},Qg=function(r,t,e){e<<=t&7;var n=t/8>>0;r[n]|=e,r[n+1]|=e>>>8,r[n+2]|=e>>>16},P2=function(r,t){for(var e=[],n=0;n<r.length;++n)r[n]&&e.push({s:n,f:r[n]});var i=e.length,s=e.slice();if(!i)return[new Aa(0),0];if(i==1){var a=new Aa(e[0].s+1);return a[e[0].s]=1,[a,1]}e.sort(function(pt,gt){return pt.f-gt.f}),e.push({s:-1,f:25001});var o=e[0],h=e[1],f=0,m=1,b=2;for(e[0]={s:-1,f:o.f+h.f,l:o,r:h};m!=i-1;)o=e[e[f].f<e[b].f?f++:b++],h=e[f!=m&&e[f].f<e[b].f?f++:b++],e[m++]={s:-1,f:o.f+h.f,l:o,r:h};for(var x=s[0].s,n=1;n<i;++n)s[n].s>x&&(x=s[n].s);var B=new No(x+1),P=M2(e[m-1],B,0);if(P>t){var n=0,R=0,Q=P-t,z=1<<Q;for(s.sort(function(gt,mt){return B[mt.s]-B[gt.s]||gt.f-mt.f});n<i;++n){var G=s[n].s;if(B[G]>t)R+=z-(1<<P-B[G]),B[G]=t;else break}for(R>>>=Q;R>0;){var X=s[n].s;B[X]<t?R-=1<<t-B[X]++-1:++n}for(;n>=0&&R;--n){var et=s[n].s;B[et]==t&&(--B[et],++R)}P=t}return[new Aa(B),P]},M2=function(r,t,e){return r.s==-1?Math.max(M2(r.l,t,e+1),M2(r.r,t,e+1)):t[r.s]=e},$L=function(r){for(var t=r.length;t&&!r[--t];);for(var e=new No(++t),n=0,i=r[0],s=1,a=function(h){e[n++]=h},o=1;o<=t;++o)if(r[o]==i&&o!=t)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=r[o]}return[e.subarray(0,n),t]},Hg=function(r,t){for(var e=0,n=0;n<t.length;++n)e+=r[n]*t[n];return e},U2=function(r,t,e){var n=e.length,i=L2(t+2);r[i]=n&255,r[i+1]=n>>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var s=0;s<n;++s)r[i+s+4]=e[s];return(i+4+n)*8},XL=function(r,t,e,n,i,s,a,o,h,f,m){Wu(t,m++,e),++i[256];for(var b=P2(i,15),x=b[0],B=b[1],P=P2(s,15),R=P[0],Q=P[1],z=$L(x),G=z[0],X=z[1],et=$L(R),pt=et[0],gt=et[1],mt=new No(19),ft=0;ft<G.length;++ft)mt[G[ft]&31]++;for(var ft=0;ft<pt.length;++ft)mt[pt[ft]&31]++;for(var Mt=P2(mt,7),Lt=Mt[0],at=Mt[1],ct=19;ct>4&&!Lt[E2[ct-1]];--ct);var wt=f+5<<3,_t=Hg(i,GA)+Hg(s,kg)+a,Jt=Hg(i,x)+Hg(s,R)+a+14+3*ct+Hg(mt,Lt)+(2*mt[16]+3*mt[17]+7*mt[18]);if(wt<=_t&&wt<=Jt)return U2(t,m,r.subarray(h,h+f));var Yt,ee,$t,ne;if(Wu(t,m,1+(Jt<_t)),m+=2,Jt<_t){Yt=Xc(x,B,0),ee=x,$t=Xc(R,Q,0),ne=R;var re=Xc(Lt,at,0);Wu(t,m,X-257),Wu(t,m+5,gt-1),Wu(t,m+10,ct-4),m+=14;for(var ft=0;ft<ct;++ft)Wu(t,m+3*ft,Lt[E2[ft]]);m+=3*ct;for(var Be=[G,pt],it=0;it<2;++it)for(var bt=Be[it],ft=0;ft<bt.length;++ft){var Pt=bt[ft]&31;Wu(t,m,re[Pt]),m+=Lt[Pt],Pt>15&&(Wu(t,m,bt[ft]>>>5&127),m+=bt[ft]>>>12)}}else Yt=nrt,ee=GA,$t=srt,ne=kg;for(var ft=0;ft<o;++ft)if(n[ft]>255){var Pt=n[ft]>>>18&31;Qg(t,m,Yt[Pt+257]),m+=ee[Pt+257],Pt>7&&(Wu(t,m,n[ft]>>>23&31),m+=Ey[Pt]);var Ot=n[ft]&31;Qg(t,m,$t[Ot]),m+=ne[Ot],Ot>3&&(Qg(t,m,n[ft]>>>5&8191),m+=Sy[Ot])}else Qg(t,m,Yt[n[ft]]),m+=ee[n[ft]];return Qg(t,m,Yt[256]),m+ee[256]},lrt=new Ng([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),crt=function(r,t,e,n,i,s){var a=r.length,o=new Aa(n+a+5*(1+Math.floor(a/7e3))+i),h=o.subarray(n,o.length-i),f=0;if(!t||a<8)for(var m=0;m<=a;m+=65535){var b=m+65535;b<a?f=U2(h,f,r.subarray(m,b)):(h[m]=s,f=U2(h,f,r.subarray(m,a)))}else{for(var x=lrt[t-1],B=x>>>13,P=x&8191,R=(1<<e)-1,Q=new No(32768),z=new No(R+1),G=Math.ceil(e/3),X=2*G,et=function(ke){return(r[ke]^r[ke+1]<<G^r[ke+2]<<X)&R},pt=new Ng(25e3),gt=new No(288),mt=new No(32),ft=0,Mt=0,m=0,Lt=0,at=0,ct=0;m<a;++m){var wt=et(m),_t=m&32767,Jt=z[wt];if(Q[_t]=Jt,z[wt]=_t,at<=m){var Yt=a-m;if((ft>7e3||Lt>24576)&&Yt>423){f=XL(r,h,0,pt,gt,mt,Mt,Lt,ct,m-ct,f),Lt=ft=Mt=0,ct=m;for(var ee=0;ee<286;++ee)gt[ee]=0;for(var ee=0;ee<30;++ee)mt[ee]=0}var $t=2,ne=0,re=P,Be=_t-Jt&32767;if(Yt>2&&wt==et(m-Be))for(var it=Math.min(B,Yt)-1,bt=Math.min(32767,m),Pt=Math.min(258,Yt);Be<=bt&&--re&&_t!=Jt;){if(r[m+$t]==r[m+$t-Be]){for(var Ot=0;Ot<Pt&&r[m+Ot]==r[m+Ot-Be];++Ot);if(Ot>$t){if($t=Ot,ne=Be,Ot>it)break;for(var qt=Math.min(Be,Ot-2),Gt=0,ee=0;ee<qt;++ee){var oe=m-Be+ee+32768&32767,ie=Q[oe],Ce=oe-ie+32768&32767;Ce>Gt&&(Gt=Ce,Jt=oe)}}}_t=Jt,Jt=Q[_t],Be+=_t-Jt+32768&32767}if(ne){pt[Lt++]=268435456|S2[$t]<<18|KL[ne];var Fe=S2[$t]&31,Re=KL[ne]&31;Mt+=Ey[Fe]+Sy[Re],++gt[257+Fe],++mt[Re],at=m+$t,++ft}else pt[Lt++]=r[m],++gt[r[m]]}}f=XL(r,h,s,pt,gt,mt,Mt,Lt,ct,m-ct,f)}return WL(o,0,n+L2(f)+i)},urt=function(){var r=1,t=0;return{p:function(e){for(var n=r,i=t,s=e.length,a=0;a!=s;){for(var o=Math.min(a+5552,s);a<o;++a)n+=e[a],i+=n;n%=65521,i%=65521}r=n,t=i},d:function(){return(r>>>8<<16|(t&255)<<8|t>>>8)+((r&255)<<23)*2}}},Art=function(r,t,e,n,i){return crt(r,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+t.mem,e,n,!i)},hrt=function(r,t,e){for(;e;++t)r[t]=e,e>>>=8},drt=function(r,t){var e=t.level,n=e==0?0:e<6?1:e==9?3:2;r[0]=120,r[1]=n<<6|(n?32-2*n:1)},frt=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function R2(r,t){t===void 0&&(t={});var e=urt();e.p(r);var n=Art(r,t,2,4);return drt(n,t),hrt(n,n.length-4,e.d()),n}function prt(r,t){return art((frt(r),r.subarray(2,-4)),t)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Hr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function O2(){Hr.console&&typeof Hr.console.log=="function"&&Hr.console.log.apply(Hr.console,arguments)}var Ai={log:O2,warn:function(r){Hr.console&&(typeof Hr.console.warn=="function"?Hr.console.warn.apply(Hr.console,arguments):O2.call(null,arguments))},error:function(r){Hr.console&&(typeof Hr.console.error=="function"?Hr.console.error.apply(Hr.console,arguments):O2(r))}};function D2(r,t,e){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){Jh(n.response,t,e)},n.onerror=function(){Ai.error("could not download file")},n.send()}function JL(r){var t=new XMLHttpRequest;t.open("HEAD",r,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Ty(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(t)}}var zg,N2,Jh=Hr.saveAs||((typeof window>"u"?"undefined":Un(window))!=="object"||window!==Hr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,t,e){var n=Hr.URL||Hr.webkitURL,i=document.createElement("a");t=t||r.name||"download",i.download=t,i.rel="noopener",typeof r=="string"?(i.href=r,i.origin!==location.origin?JL(i.href)?D2(r,t,e):Ty(i,i.target="_blank"):Ty(i)):(i.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){Ty(i)},0))}:"msSaveOrOpenBlob"in navigator?function(r,t,e){if(t=t||r.name||"download",typeof r=="string")if(JL(r))D2(r,t,e);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){Ty(n)})}else navigator.msSaveOrOpenBlob(function(i,s){return s===void 0?s={autoBom:!1}:Un(s)!=="object"&&(Ai.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}(r,e),t)}:function(r,t,e,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return D2(r,t,e);var i=r.type==="application/octet-stream",s=/constructor/i.test(Hr.HTMLElement)||Hr.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||i&&s)&&(typeof FileReader>"u"?"undefined":Un(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var m=o.result;m=a?m:m.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=m:location=m,n=null},o.readAsDataURL(r)}else{var h=Hr.URL||Hr.webkitURL,f=h.createObjectURL(r);n?n.location=f:location.href=f,n=null,setTimeout(function(){h.revokeObjectURL(f)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function YL(r){var t;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],n=0;n<e.length;n++){var i=e[n].re,s=e[n].process,a=i.exec(r);a&&(t=s(a),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),h=this.g.toString(16),f=this.b.toString(16);return o.length==1&&(o="0"+o),h.length==1&&(h="0"+h),f.length==1&&(f="0"+f),"#"+o+h+f}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function k2(r,t){var e=r[0],n=r[1],i=r[2],s=r[3];e=po(e,n,i,s,t[0],7,-680876936),s=po(s,e,n,i,t[1],12,-389564586),i=po(i,s,e,n,t[2],17,606105819),n=po(n,i,s,e,t[3],22,-1044525330),e=po(e,n,i,s,t[4],7,-176418897),s=po(s,e,n,i,t[5],12,1200080426),i=po(i,s,e,n,t[6],17,-1473231341),n=po(n,i,s,e,t[7],22,-45705983),e=po(e,n,i,s,t[8],7,1770035416),s=po(s,e,n,i,t[9],12,-1958414417),i=po(i,s,e,n,t[10],17,-42063),n=po(n,i,s,e,t[11],22,-1990404162),e=po(e,n,i,s,t[12],7,1804603682),s=po(s,e,n,i,t[13],12,-40341101),i=po(i,s,e,n,t[14],17,-1502002290),e=go(e,n=po(n,i,s,e,t[15],22,1236535329),i,s,t[1],5,-165796510),s=go(s,e,n,i,t[6],9,-1069501632),i=go(i,s,e,n,t[11],14,643717713),n=go(n,i,s,e,t[0],20,-373897302),e=go(e,n,i,s,t[5],5,-701558691),s=go(s,e,n,i,t[10],9,38016083),i=go(i,s,e,n,t[15],14,-660478335),n=go(n,i,s,e,t[4],20,-405537848),e=go(e,n,i,s,t[9],5,568446438),s=go(s,e,n,i,t[14],9,-1019803690),i=go(i,s,e,n,t[3],14,-187363961),n=go(n,i,s,e,t[8],20,1163531501),e=go(e,n,i,s,t[13],5,-1444681467),s=go(s,e,n,i,t[2],9,-51403784),i=go(i,s,e,n,t[7],14,1735328473),e=mo(e,n=go(n,i,s,e,t[12],20,-1926607734),i,s,t[5],4,-378558),s=mo(s,e,n,i,t[8],11,-2022574463),i=mo(i,s,e,n,t[11],16,1839030562),n=mo(n,i,s,e,t[14],23,-35309556),e=mo(e,n,i,s,t[1],4,-1530992060),s=mo(s,e,n,i,t[4],11,1272893353),i=mo(i,s,e,n,t[7],16,-155497632),n=mo(n,i,s,e,t[10],23,-1094730640),e=mo(e,n,i,s,t[13],4,681279174),s=mo(s,e,n,i,t[0],11,-358537222),i=mo(i,s,e,n,t[3],16,-722521979),n=mo(n,i,s,e,t[6],23,76029189),e=mo(e,n,i,s,t[9],4,-640364487),s=mo(s,e,n,i,t[12],11,-421815835),i=mo(i,s,e,n,t[15],16,530742520),e=yo(e,n=mo(n,i,s,e,t[2],23,-995338651),i,s,t[0],6,-198630844),s=yo(s,e,n,i,t[7],10,1126891415),i=yo(i,s,e,n,t[14],15,-1416354905),n=yo(n,i,s,e,t[5],21,-57434055),e=yo(e,n,i,s,t[12],6,1700485571),s=yo(s,e,n,i,t[3],10,-1894986606),i=yo(i,s,e,n,t[10],15,-1051523),n=yo(n,i,s,e,t[1],21,-2054922799),e=yo(e,n,i,s,t[8],6,1873313359),s=yo(s,e,n,i,t[15],10,-30611744),i=yo(i,s,e,n,t[6],15,-1560198380),n=yo(n,i,s,e,t[13],21,1309151649),e=yo(e,n,i,s,t[4],6,-145523070),s=yo(s,e,n,i,t[11],10,-1120210379),i=yo(i,s,e,n,t[2],15,718787259),n=yo(n,i,s,e,t[9],21,-343485551),r[0]=jA(e,r[0]),r[1]=jA(n,r[1]),r[2]=jA(i,r[2]),r[3]=jA(s,r[3])}function Iy(r,t,e,n,i,s){return t=jA(jA(t,r),jA(n,s)),jA(t<<i|t>>>32-i,e)}function po(r,t,e,n,i,s,a){return Iy(t&e|~t&n,r,t,i,s,a)}function go(r,t,e,n,i,s,a){return Iy(t&n|e&~n,r,t,i,s,a)}function mo(r,t,e,n,i,s,a){return Iy(t^e^n,r,t,i,s,a)}function yo(r,t,e,n,i,s,a){return Iy(e^(t|~n),r,t,i,s,a)}function ZL(r){var t,e=r.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=r.length;t+=64)k2(n,grt(r.substring(t-64,t)));r=r.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r.length;t++)i[t>>2]|=r.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(k2(n,i),t=0;t<16;t++)i[t]=0;return i[14]=8*e,k2(n,i),n}function grt(r){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=r.charCodeAt(t)+(r.charCodeAt(t+1)<<8)+(r.charCodeAt(t+2)<<16)+(r.charCodeAt(t+3)<<24);return e}zg=Hr.atob.bind(Hr),N2=Hr.btoa.bind(Hr);var tP="0123456789abcdef".split("");function mrt(r){for(var t="",e=0;e<4;e++)t+=tP[r>>8*e+4&15]+tP[r>>8*e&15];return t}function yrt(r){return String.fromCharCode((255&r)>>0,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function Q2(r){return ZL(r).map(yrt).join("")}var _rt=function(r){for(var t=0;t<r.length;t++)r[t]=mrt(r[t]);return r.join("")}(ZL("hello"))!="5d41402abc4b2a76b9719d911017c592";function jA(r,t){if(_rt){var e=(65535&r)+(65535&t);return(r>>16)+(t>>16)+(e>>16)<<16|65535&e}return r+t&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function H2(r,t){var e,n,i,s;if(r!==e){for(var a=(i=r,s=1+(256/r.length>>0),new Array(s+1).join(i)),o=[],h=0;h<256;h++)o[h]=h;var f=0;for(h=0;h<256;h++){var m=o[h];f=(f+m+a.charCodeAt(h))%256,o[h]=o[f],o[f]=m}e=r,n=o}else o=n;var b=t.length,x=0,B=0,P="";for(h=0;h<b;h++)B=(B+(m=o[x=(x+1)%256]))%256,o[x]=o[B],o[B]=m,a=o[(o[x]+o[B])%256],P+=String.fromCharCode(t.charCodeAt(h)^a);return P}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var eP={print:4,modify:8,copy:16,"annot-forms":32};function If(r,t,e,n){this.v=1,this.r=2;var i=192;r.forEach(function(o){if(eP.perm!==void 0)throw new Error("Invalid permission: "+o);i+=eP[o]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var s=(t+this.padding).substr(0,32),a=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^i)),this.encryptionKey=Q2(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=H2(this.encryptionKey,this.padding)}function Ff(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var t="",e=r.length,n=0;n<e;n++){var i=r.charCodeAt(n);i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?t+="#"+("0"+i.toString(16)).slice(-2):t+=r[n]}return t}function rP(r){if(Un(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,n,i){if(i=i||!1,typeof e!="string"||typeof n!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var s=Math.random().toString(35);return t[e][s]=[n,!!i],s},this.unsubscribe=function(e){for(var n in t)if(t[n][e])return delete t[n][e],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var n=Array.prototype.slice.call(arguments,1),i=[];for(var s in t[e]){var a=t[e][s];try{a[0].apply(r,n)}catch(o){Hr.console&&Ai.error("jsPDF PubSub Error",o.message,o)}a[1]&&i.push(s)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function Fy(r){if(!(this instanceof Fy))return new Fy(r);var t="opacity,stroke-opacity".split(",");for(var e in r)r.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=r[e]);this.id="",this.objectNumber=-1}function nP(r,t){this.gState=r,this.matrix=t,this.id="",this.objectNumber=-1}function Yh(r,t,e,n,i){if(!(this instanceof Yh))return new Yh(r,t,e,n,i);this.type=r==="axial"?2:3,this.coords=t,this.colors=e,nP.call(this,n,i)}function Lf(r,t,e,n,i){if(!(this instanceof Lf))return new Lf(r,t,e,n,i);this.boundingBox=r,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,nP.call(this,n,i)}function zr(r){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],i=arguments[2],s=arguments[3],a=[],o=1,h=16,f="S",m=null;Un(r=r||{})==="object"&&(e=r.orientation,n=r.unit||n,i=r.format||i,s=r.compress||r.compressPdf||s,(m=r.encryption||null)!==null&&(m.userPassword=m.userPassword||"",m.ownerPassword=m.ownerPassword||"",m.userPermissions=m.userPermissions||[]),o=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(t=r.precision),r.floatPrecision!==void 0&&(h=r.floatPrecision),f=r.defaultPathOperation||"S"),a=r.filters||(s===!0?["FlateEncode"]:a),n=n||"mm",e=(""+(e||"P")).toLowerCase();var b=r.putOnlyUsedFonts||!1,x={},B={internal:{},__private__:{}};B.__private__.PubSub=rP;var P="1.3",R=B.__private__.getPdfVersion=function(){return P};B.__private__.setPdfVersion=function(D){P=D};var Q={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};B.__private__.getPageFormats=function(){return Q};var z=B.__private__.getPageFormat=function(D){return Q[D]};i=i||"a4";var G={COMPAT:"compat",ADVANCED:"advanced"},X=G.COMPAT;function et(){this.saveGraphicsState(),lt(new Tt(De,0,0,-De,0,Rl()*De).toString()+" cm"),this.setFontSize(this.getFontSize()/De),f="n",X=G.ADVANCED}function pt(){this.restoreGraphicsState(),f="S",X=G.COMPAT}var gt=B.__private__.combineFontStyleAndFontWeight=function(D,nt){if(D=="bold"&&nt=="normal"||D=="bold"&&nt==400||D=="normal"&&nt=="italic"||D=="bold"&&nt=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return nt&&(D=nt==400||nt==="normal"?D==="italic"?"italic":"normal":nt!=700&&nt!=="bold"||D!=="normal"?(nt==700?"bold":nt)+""+D:"bold"),D};B.advancedAPI=function(D){var nt=X===G.COMPAT;return nt&&et.call(this),typeof D!="function"||(D(this),nt&&pt.call(this)),this},B.compatAPI=function(D){var nt=X===G.ADVANCED;return nt&&pt.call(this),typeof D!="function"||(D(this),nt&&et.call(this)),this},B.isAdvancedAPI=function(){return X===G.ADVANCED};var mt,ft=function(D){if(X!==G.ADVANCED)throw new Error(D+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Mt=B.roundToPrecision=B.__private__.roundToPrecision=function(D,nt){var Ut=t||nt;if(isNaN(D)||isNaN(Ut))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return D.toFixed(Ut).replace(/0+$/,"")};mt=B.hpf=B.__private__.hpf=typeof h=="number"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return Mt(D,h)}:h==="smart"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return Mt(D,D>-1&&D<1?16:5)}:function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return Mt(D,16)};var Lt=B.f2=B.__private__.f2=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f2");return Mt(D,2)},at=B.__private__.f3=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f3");return Mt(D,3)},ct=B.scale=B.__private__.scale=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.scale");return X===G.COMPAT?D*De:X===G.ADVANCED?D:void 0},wt=function(D){return X===G.COMPAT?Rl()-D:X===G.ADVANCED?D:void 0},_t=function(D){return ct(wt(D))};B.__private__.setPrecision=B.setPrecision=function(D){typeof parseInt(D,10)=="number"&&(t=parseInt(D,10))};var Jt,Yt="00000000000000000000000000000000",ee=B.__private__.getFileId=function(){return Yt},$t=B.__private__.setFileId=function(D){return Yt=D!==void 0&&/^[a-fA-F0-9]{32}$/.test(D)?D.toUpperCase():Yt.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),m!==null&&(vn=new If(m.userPermissions,m.userPassword,m.ownerPassword,Yt)),Yt};B.setFileId=function(D){return $t(D),this},B.getFileId=function(){return ee()};var ne=B.__private__.convertDateToPDFDate=function(D){var nt=D.getTimezoneOffset(),Ut=nt<0?"+":"-",Vt=Math.floor(Math.abs(nt/60)),se=Math.abs(nt%60),me=[Ut,Pt(Vt),"'",Pt(se),"'"].join("");return["D:",D.getFullYear(),Pt(D.getMonth()+1),Pt(D.getDate()),Pt(D.getHours()),Pt(D.getMinutes()),Pt(D.getSeconds()),me].join("")},re=B.__private__.convertPDFDateToDate=function(D){var nt=parseInt(D.substr(2,4),10),Ut=parseInt(D.substr(6,2),10)-1,Vt=parseInt(D.substr(8,2),10),se=parseInt(D.substr(10,2),10),me=parseInt(D.substr(12,2),10),Pe=parseInt(D.substr(14,2),10);return new Date(nt,Ut,Vt,se,me,Pe,0)},Be=B.__private__.setCreationDate=function(D){var nt;if(D===void 0&&(D=new Date),D instanceof Date)nt=ne(D);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(D))throw new Error("Invalid argument passed to jsPDF.setCreationDate");nt=D}return Jt=nt},it=B.__private__.getCreationDate=function(D){var nt=Jt;return D==="jsDate"&&(nt=re(Jt)),nt};B.setCreationDate=function(D){return Be(D),this},B.getCreationDate=function(D){return it(D)};var bt,Pt=B.__private__.padd2=function(D){return("0"+parseInt(D)).slice(-2)},Ot=B.__private__.padd2Hex=function(D){return("00"+(D=D.toString())).substr(D.length)},qt=0,Gt=[],oe=[],ie=0,Ce=[],Fe=[],Re=!1,Ne=oe,ke=function(){qt=0,ie=0,oe=[],Gt=[],Ce=[],_r=ze(),Ur=ze()};B.__private__.setCustomOutputDestination=function(D){Re=!0,Ne=D};var fe=function(D){Re||(Ne=D)};B.__private__.resetCustomOutputDestination=function(){Re=!1,Ne=oe};var lt=B.__private__.out=function(D){return D=D.toString(),ie+=D.length+1,Ne.push(D),Ne},pr=B.__private__.write=function(D){return lt(arguments.length===1?D.toString():Array.prototype.join.call(arguments," "))},er=B.__private__.getArrayBuffer=function(D){for(var nt=D.length,Ut=new ArrayBuffer(nt),Vt=new Uint8Array(Ut);nt--;)Vt[nt]=D.charCodeAt(nt);return Ut},pe=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];B.__private__.getStandardFonts=function(){return pe};var we=r.fontSize||16;B.__private__.setFontSize=B.setFontSize=function(D){return we=X===G.ADVANCED?D/De:D,this};var Ie,Oe=B.__private__.getFontSize=B.getFontSize=function(){return X===G.COMPAT?we:we*De},nr=r.R2L||!1;B.__private__.setR2L=B.setR2L=function(D){return nr=D,this},B.__private__.getR2L=B.getR2L=function(){return nr};var hr,Sr=B.__private__.setZoomMode=function(D){var nt=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(D))Ie=D;else if(isNaN(D)){if(nt.indexOf(D)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+D+'" is not recognized.');Ie=D}else Ie=parseInt(D,10)};B.__private__.getZoomMode=function(){return Ie};var Mr,kr=B.__private__.setPageMode=function(D){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(D)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+D+'" is not recognized.');hr=D};B.__private__.getPageMode=function(){return hr};var ye=B.__private__.setLayoutMode=function(D){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(D)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+D+'" is not recognized.');Mr=D};B.__private__.getLayoutMode=function(){return Mr},B.__private__.setDisplayMode=B.setDisplayMode=function(D,nt,Ut){return Sr(D),ye(nt),kr(Ut),this};var or={title:"",subject:"",author:"",keywords:"",creator:""};B.__private__.getDocumentProperty=function(D){if(Object.keys(or).indexOf(D)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return or[D]},B.__private__.getDocumentProperties=function(){return or},B.__private__.setDocumentProperties=B.setProperties=B.setDocumentProperties=function(D){for(var nt in or)or.hasOwnProperty(nt)&&D[nt]&&(or[nt]=D[nt]);return this},B.__private__.setDocumentProperty=function(D,nt){if(Object.keys(or).indexOf(D)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return or[D]=nt};var xr,De,pn,ge,yr,je={},Rr={},cn=[],He={},Kn={},sn={},Jr={},Bt=null,Z=0,J=[],st=new rP(B),Ft=r.hotfixes||[],Nt={},Ht={},jt=[],Tt=function D(nt,Ut,Vt,se,me,Pe){if(!(this instanceof D))return new D(nt,Ut,Vt,se,me,Pe);isNaN(nt)&&(nt=1),isNaN(Ut)&&(Ut=0),isNaN(Vt)&&(Vt=0),isNaN(se)&&(se=1),isNaN(me)&&(me=0),isNaN(Pe)&&(Pe=0),this._matrix=[nt,Ut,Vt,se,me,Pe]};Object.defineProperty(Tt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(Tt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(Tt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(Tt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(Tt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(Tt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(Tt.prototype,"a",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(Tt.prototype,"b",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(Tt.prototype,"c",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(Tt.prototype,"d",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(Tt.prototype,"e",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(Tt.prototype,"f",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(Tt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Tt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Tt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Tt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Tt.prototype.join=function(D){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(mt).join(D)},Tt.prototype.multiply=function(D){var nt=D.sx*this.sx+D.shy*this.shx,Ut=D.sx*this.shy+D.shy*this.sy,Vt=D.shx*this.sx+D.sy*this.shx,se=D.shx*this.shy+D.sy*this.sy,me=D.tx*this.sx+D.ty*this.shx+this.tx,Pe=D.tx*this.shy+D.ty*this.sy+this.ty;return new Tt(nt,Ut,Vt,se,me,Pe)},Tt.prototype.decompose=function(){var D=this.sx,nt=this.shy,Ut=this.shx,Vt=this.sy,se=this.tx,me=this.ty,Pe=Math.sqrt(D*D+nt*nt),rr=(D/=Pe)*Ut+(nt/=Pe)*Vt;Ut-=D*rr,Vt-=nt*rr;var Pr=Math.sqrt(Ut*Ut+Vt*Vt);return rr/=Pr,D*(Vt/=Pr)<nt*(Ut/=Pr)&&(D=-D,nt=-nt,rr=-rr,Pe=-Pe),{scale:new Tt(Pe,0,0,Pr,0,0),translate:new Tt(1,0,0,1,se,me),rotate:new Tt(D,nt,-nt,D,0,0),skew:new Tt(1,0,rr,1,0,0)}},Tt.prototype.toString=function(D){return this.join(" ")},Tt.prototype.inversed=function(){var D=this.sx,nt=this.shy,Ut=this.shx,Vt=this.sy,se=this.tx,me=this.ty,Pe=1/(D*Vt-nt*Ut),rr=Vt*Pe,Pr=-nt*Pe,qr=-Ut*Pe,Br=D*Pe;return new Tt(rr,Pr,qr,Br,-rr*se-qr*me,-Pr*se-Br*me)},Tt.prototype.applyToPoint=function(D){var nt=D.x*this.sx+D.y*this.shx+this.tx,Ut=D.x*this.shy+D.y*this.sy+this.ty;return new xo(nt,Ut)},Tt.prototype.applyToRectangle=function(D){var nt=this.applyToPoint(D),Ut=this.applyToPoint(new xo(D.x+D.w,D.y+D.h));return new mu(nt.x,nt.y,Ut.x-nt.x,Ut.y-nt.y)},Tt.prototype.clone=function(){var D=this.sx,nt=this.shy,Ut=this.shx,Vt=this.sy,se=this.tx,me=this.ty;return new Tt(D,nt,Ut,Vt,se,me)},B.Matrix=Tt;var Xt=B.matrixMult=function(D,nt){return nt.multiply(D)},_e=new Tt(1,0,0,1,0,0);B.unitMatrix=B.identityMatrix=_e;var ue=function(D,nt){if(!Kn[D]){var Ut=(nt instanceof Yh?"Sh":"P")+(Object.keys(He).length+1).toString(10);nt.id=Ut,Kn[D]=Ut,He[Ut]=nt,st.publish("addPattern",nt)}};B.ShadingPattern=Yh,B.TilingPattern=Lf,B.addShadingPattern=function(D,nt){return ft("addShadingPattern()"),ue(D,nt),this},B.beginTilingPattern=function(D){ft("beginTilingPattern()"),hh(D.boundingBox[0],D.boundingBox[1],D.boundingBox[2]-D.boundingBox[0],D.boundingBox[3]-D.boundingBox[1],D.matrix)},B.endTilingPattern=function(D,nt){ft("endTilingPattern()"),nt.stream=Fe[bt].join(`
`),ue(D,nt),st.publish("endTilingPattern",nt),jt.pop().restore()};var Ae=B.__private__.newObject=function(){var D=ze();return Ve(D,!0),D},ze=B.__private__.newObjectDeferred=function(){return qt++,Gt[qt]=function(){return ie},qt},Ve=function(D,nt){return nt=typeof nt=="boolean"&&nt,Gt[D]=ie,nt&&lt(D+" 0 obj"),D},Er=B.__private__.newAdditionalObject=function(){var D={objId:ze(),content:""};return Ce.push(D),D},_r=ze(),Ur=ze(),Vr=B.__private__.decodeColorString=function(D){var nt=D.split(" ");if(nt.length!==2||nt[1]!=="g"&&nt[1]!=="G")nt.length===5&&(nt[4]==="k"||nt[4]==="K")&&(nt=[(1-nt[0])*(1-nt[3]),(1-nt[1])*(1-nt[3]),(1-nt[2])*(1-nt[3]),"r"]);else{var Ut=parseFloat(nt[0]);nt=[Ut,Ut,Ut,"r"]}for(var Vt="#",se=0;se<3;se++)Vt+=("0"+Math.floor(255*parseFloat(nt[se])).toString(16)).slice(-2);return Vt},Gr=B.__private__.encodeColorString=function(D){var nt;typeof D=="string"&&(D={ch1:D});var Ut=D.ch1,Vt=D.ch2,se=D.ch3,me=D.ch4,Pe=D.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Ut=="string"&&Ut.charAt(0)!=="#"){var rr=new YL(Ut);if(rr.ok)Ut=rr.toHex();else if(!/^\d*\.?\d*$/.test(Ut))throw new Error('Invalid color "'+Ut+'" passed to jsPDF.encodeColorString.')}if(typeof Ut=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Ut)&&(Ut="#"+Ut[1]+Ut[1]+Ut[2]+Ut[2]+Ut[3]+Ut[3]),typeof Ut=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Ut)){var Pr=parseInt(Ut.substr(1),16);Ut=Pr>>16&255,Vt=Pr>>8&255,se=255&Pr}if(Vt===void 0||me===void 0&&Ut===Vt&&Vt===se)if(typeof Ut=="string")nt=Ut+" "+Pe[0];else switch(D.precision){case 2:nt=Lt(Ut/255)+" "+Pe[0];break;case 3:default:nt=at(Ut/255)+" "+Pe[0]}else if(me===void 0||Un(me)==="object"){if(me&&!isNaN(me.a)&&me.a===0)return nt=["1.","1.","1.",Pe[1]].join(" ");if(typeof Ut=="string")nt=[Ut,Vt,se,Pe[1]].join(" ");else switch(D.precision){case 2:nt=[Lt(Ut/255),Lt(Vt/255),Lt(se/255),Pe[1]].join(" ");break;default:case 3:nt=[at(Ut/255),at(Vt/255),at(se/255),Pe[1]].join(" ")}}else if(typeof Ut=="string")nt=[Ut,Vt,se,me,Pe[2]].join(" ");else switch(D.precision){case 2:nt=[Lt(Ut),Lt(Vt),Lt(se),Lt(me),Pe[2]].join(" ");break;case 3:default:nt=[at(Ut),at(Vt),at(se),at(me),Pe[2]].join(" ")}return nt},Zr=B.__private__.getFilters=function(){return a},vr=B.__private__.putStream=function(D){var nt=(D=D||{}).data||"",Ut=D.filters||Zr(),Vt=D.alreadyAppliedFilters||[],se=D.addLength1||!1,me=nt.length,Pe=D.objectId,rr=function(en){return en};if(m!==null&&Pe===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");m!==null&&(rr=vn.encryptor(Pe,0));var Pr={};Ut===!0&&(Ut=["FlateEncode"]);var qr=D.additionalKeyValues||[],Br=(Pr=zr.API.processDataByFilters!==void 0?zr.API.processDataByFilters(nt,Ut):{data:nt,reverseChain:[]}).reverseChain+(Array.isArray(Vt)?Vt.join(" "):Vt.toString());if(Pr.data.length!==0&&(qr.push({key:"Length",value:Pr.data.length}),se===!0&&qr.push({key:"Length1",value:me})),Br.length!=0)if(Br.split("/").length-1==1)qr.push({key:"Filter",value:Br});else{qr.push({key:"Filter",value:"["+Br+"]"});for(var dn=0;dn<qr.length;dn+=1)if(qr[dn].key==="DecodeParms"){for(var gr=[],ri=0;ri<Pr.reverseChain.split("/").length-1;ri+=1)gr.push("null");gr.push(qr[dn].value),qr[dn].value="["+gr.join(" ")+"]"}}lt("<<");for(var Yr=0;Yr<qr.length;Yr++)lt("/"+qr[Yr].key+" "+qr[Yr].value);lt(">>"),Pr.data.length!==0&&(lt("stream"),lt(rr(Pr.data)),lt("endstream"))},Wr=B.__private__.putPage=function(D){var nt=D.number,Ut=D.data,Vt=D.objId,se=D.contentsObjId;Ve(Vt,!0),lt("<</Type /Page"),lt("/Parent "+D.rootDictionaryObjId+" 0 R"),lt("/Resources "+D.resourceDictionaryObjId+" 0 R"),lt("/MediaBox ["+parseFloat(mt(D.mediaBox.bottomLeftX))+" "+parseFloat(mt(D.mediaBox.bottomLeftY))+" "+mt(D.mediaBox.topRightX)+" "+mt(D.mediaBox.topRightY)+"]"),D.cropBox!==null&&lt("/CropBox ["+mt(D.cropBox.bottomLeftX)+" "+mt(D.cropBox.bottomLeftY)+" "+mt(D.cropBox.topRightX)+" "+mt(D.cropBox.topRightY)+"]"),D.bleedBox!==null&&lt("/BleedBox ["+mt(D.bleedBox.bottomLeftX)+" "+mt(D.bleedBox.bottomLeftY)+" "+mt(D.bleedBox.topRightX)+" "+mt(D.bleedBox.topRightY)+"]"),D.trimBox!==null&&lt("/TrimBox ["+mt(D.trimBox.bottomLeftX)+" "+mt(D.trimBox.bottomLeftY)+" "+mt(D.trimBox.topRightX)+" "+mt(D.trimBox.topRightY)+"]"),D.artBox!==null&&lt("/ArtBox ["+mt(D.artBox.bottomLeftX)+" "+mt(D.artBox.bottomLeftY)+" "+mt(D.artBox.topRightX)+" "+mt(D.artBox.topRightY)+"]"),typeof D.userUnit=="number"&&D.userUnit!==1&&lt("/UserUnit "+D.userUnit),st.publish("putPage",{objId:Vt,pageContext:J[nt],pageNumber:nt,page:Ut}),lt("/Contents "+se+" 0 R"),lt(">>"),lt("endobj");var me=Ut.join(`
`);return X===G.ADVANCED&&(me+=`
Q`),Ve(se,!0),vr({data:me,filters:Zr(),objectId:se}),lt("endobj"),Vt},_n=B.__private__.putPages=function(){var D,nt,Ut=[];for(D=1;D<=Z;D++)J[D].objId=ze(),J[D].contentsObjId=ze();for(D=1;D<=Z;D++)Ut.push(Wr({number:D,data:Fe[D],objId:J[D].objId,contentsObjId:J[D].contentsObjId,mediaBox:J[D].mediaBox,cropBox:J[D].cropBox,bleedBox:J[D].bleedBox,trimBox:J[D].trimBox,artBox:J[D].artBox,userUnit:J[D].userUnit,rootDictionaryObjId:_r,resourceDictionaryObjId:Ur}));Ve(_r,!0),lt("<</Type /Pages");var Vt="/Kids [";for(nt=0;nt<Z;nt++)Vt+=Ut[nt]+" 0 R ";lt(Vt+"]"),lt("/Count "+Z),lt(">>"),lt("endobj"),st.publish("postPutPages")},Rn=function(D){st.publish("putFont",{font:D,out:lt,newObject:Ae,putStream:vr}),D.isAlreadyPutted!==!0&&(D.objectNumber=Ae(),lt("<<"),lt("/Type /Font"),lt("/BaseFont /"+Ff(D.postScriptName)),lt("/Subtype /Type1"),typeof D.encoding=="string"&&lt("/Encoding /"+D.encoding),lt("/FirstChar 32"),lt("/LastChar 255"),lt(">>"),lt("endobj"))},Zn=function(){for(var D in je)je.hasOwnProperty(D)&&(b===!1||b===!0&&x.hasOwnProperty(D))&&Rn(je[D])},Rt=function(D){D.objectNumber=Ae();var nt=[];nt.push({key:"Type",value:"/XObject"}),nt.push({key:"Subtype",value:"/Form"}),nt.push({key:"BBox",value:"["+[mt(D.x),mt(D.y),mt(D.x+D.width),mt(D.y+D.height)].join(" ")+"]"}),nt.push({key:"Matrix",value:"["+D.matrix.toString()+"]"});var Ut=D.pages[1].join(`
`);vr({data:Ut,additionalKeyValues:nt,objectId:D.objectNumber}),lt("endobj")},qe=function(){for(var D in Nt)Nt.hasOwnProperty(D)&&Rt(Nt[D])},Te=function(D,nt){var Ut,Vt=[],se=1/(nt-1);for(Ut=0;Ut<1;Ut+=se)Vt.push(Ut);if(Vt.push(1),D[0].offset!=0){var me={offset:0,color:D[0].color};D.unshift(me)}if(D[D.length-1].offset!=1){var Pe={offset:1,color:D[D.length-1].color};D.push(Pe)}for(var rr="",Pr=0,qr=0;qr<Vt.length;qr++){for(Ut=Vt[qr];Ut>D[Pr+1].offset;)Pr++;var Br=D[Pr].offset,dn=(Ut-Br)/(D[Pr+1].offset-Br),gr=D[Pr].color,ri=D[Pr+1].color;rr+=Ot(Math.round((1-dn)*gr[0]+dn*ri[0]).toString(16))+Ot(Math.round((1-dn)*gr[1]+dn*ri[1]).toString(16))+Ot(Math.round((1-dn)*gr[2]+dn*ri[2]).toString(16))}return rr.trim()},lr=function(D,nt){nt||(nt=21);var Ut=Ae(),Vt=Te(D.colors,nt),se=[];se.push({key:"FunctionType",value:"0"}),se.push({key:"Domain",value:"[0.0 1.0]"}),se.push({key:"Size",value:"["+nt+"]"}),se.push({key:"BitsPerSample",value:"8"}),se.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),se.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),vr({data:Vt,additionalKeyValues:se,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Ut}),lt("endobj"),D.objectNumber=Ae(),lt("<< /ShadingType "+D.type),lt("/ColorSpace /DeviceRGB");var me="/Coords ["+mt(parseFloat(D.coords[0]))+" "+mt(parseFloat(D.coords[1]))+" ";D.type===2?me+=mt(parseFloat(D.coords[2]))+" "+mt(parseFloat(D.coords[3])):me+=mt(parseFloat(D.coords[2]))+" "+mt(parseFloat(D.coords[3]))+" "+mt(parseFloat(D.coords[4]))+" "+mt(parseFloat(D.coords[5])),lt(me+="]"),D.matrix&&lt("/Matrix ["+D.matrix.toString()+"]"),lt("/Function "+Ut+" 0 R"),lt("/Extend [true true]"),lt(">>"),lt("endobj")},Or=function(D,nt){var Ut=ze(),Vt=Ae();nt.push({resourcesOid:Ut,objectOid:Vt}),D.objectNumber=Vt;var se=[];se.push({key:"Type",value:"/Pattern"}),se.push({key:"PatternType",value:"1"}),se.push({key:"PaintType",value:"1"}),se.push({key:"TilingType",value:"1"}),se.push({key:"BBox",value:"["+D.boundingBox.map(mt).join(" ")+"]"}),se.push({key:"XStep",value:mt(D.xStep)}),se.push({key:"YStep",value:mt(D.yStep)}),se.push({key:"Resources",value:Ut+" 0 R"}),D.matrix&&se.push({key:"Matrix",value:"["+D.matrix.toString()+"]"}),vr({data:D.stream,additionalKeyValues:se,objectId:D.objectNumber}),lt("endobj")},Fn=function(D){var nt;for(nt in He)He.hasOwnProperty(nt)&&(He[nt]instanceof Yh?lr(He[nt]):He[nt]instanceof Lf&&Or(He[nt],D))},jr=function(D){for(var nt in D.objectNumber=Ae(),lt("<<"),D)switch(nt){case"opacity":lt("/ca "+Lt(D[nt]));break;case"stroke-opacity":lt("/CA "+Lt(D[nt]))}lt(">>"),lt("endobj")},gn=function(){var D;for(D in sn)sn.hasOwnProperty(D)&&jr(sn[D])},Wn=function(){for(var D in lt("/XObject <<"),Nt)Nt.hasOwnProperty(D)&&Nt[D].objectNumber>=0&&lt("/"+D+" "+Nt[D].objectNumber+" 0 R");st.publish("putXobjectDict"),lt(">>")},mn=function(){vn.oid=Ae(),lt("<<"),lt("/Filter /Standard"),lt("/V "+vn.v),lt("/R "+vn.r),lt("/U <"+vn.toHexString(vn.U)+">"),lt("/O <"+vn.toHexString(vn.O)+">"),lt("/P "+vn.P),lt(">>"),lt("endobj")},on=function(){for(var D in lt("/Font <<"),je)je.hasOwnProperty(D)&&(b===!1||b===!0&&x.hasOwnProperty(D))&&lt("/"+D+" "+je[D].objectNumber+" 0 R");lt(">>")},Bc=function(){if(Object.keys(He).length>0){for(var D in lt("/Shading <<"),He)He.hasOwnProperty(D)&&He[D]instanceof Yh&&He[D].objectNumber>=0&&lt("/"+D+" "+He[D].objectNumber+" 0 R");st.publish("putShadingPatternDict"),lt(">>")}},os=function(D){if(Object.keys(He).length>0){for(var nt in lt("/Pattern <<"),He)He.hasOwnProperty(nt)&&He[nt]instanceof B.TilingPattern&&He[nt].objectNumber>=0&&He[nt].objectNumber<D&&lt("/"+nt+" "+He[nt].objectNumber+" 0 R");st.publish("putTilingPatternDict"),lt(">>")}},Qn=function(){if(Object.keys(sn).length>0){var D;for(D in lt("/ExtGState <<"),sn)sn.hasOwnProperty(D)&&sn[D].objectNumber>=0&&lt("/"+D+" "+sn[D].objectNumber+" 0 R");st.publish("putGStateDict"),lt(">>")}},un=function(D){Ve(D.resourcesOid,!0),lt("<<"),lt("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),on(),Bc(),os(D.objectOid),Qn(),Wn(),lt(">>"),lt("endobj")},Cs=function(){var D=[];Zn(),gn(),qe(),Fn(D),st.publish("putResources"),D.forEach(un),un({resourcesOid:Ur,objectOid:Number.MAX_SAFE_INTEGER}),st.publish("postPutResources")},Ln=function(){st.publish("putAdditionalObjects");for(var D=0;D<Ce.length;D++){var nt=Ce[D];Ve(nt.objId,!0),lt(nt.content),lt("endobj")}st.publish("postPutAdditionalObjects")},Os=function(D){Rr[D.fontName]=Rr[D.fontName]||{},Rr[D.fontName][D.fontStyle]=D.id},Mi=function(D,nt,Ut,Vt,se){var me={id:"F"+(Object.keys(je).length+1).toString(10),postScriptName:D,fontName:nt,fontStyle:Ut,encoding:Vt,isStandardFont:se||!1,metadata:{}};return st.publish("addFont",{font:me,instance:this}),je[me.id]=me,Os(me),me.id},ga=function(D){for(var nt=0,Ut=pe.length;nt<Ut;nt++){var Vt=Mi.call(this,D[nt][0],D[nt][1],D[nt][2],pe[nt][3],!0);b===!1&&(x[Vt]=!0);var se=D[nt][0].split("-");Os({id:Vt,fontName:se[0],fontStyle:se[1]||""})}st.publish("addFonts",{fonts:je,dictionary:Rr})},ti=function(D){return D.foo=function(){try{return D.apply(this,arguments)}catch(Vt){var nt=Vt.stack||"";~nt.indexOf(" at ")&&(nt=nt.split(" at ")[1]);var Ut="Error in function "+nt.split(`
`)[0].split("<")[0]+": "+Vt.message;if(!Hr.console)throw new Error(Ut);Hr.console.error(Ut,Vt),Hr.alert&&alert(Ut)}},D.foo.bar=D,D.foo},as=function(D,nt){var Ut,Vt,se,me,Pe,rr,Pr,qr,Br;if(se=(nt=nt||{}).sourceEncoding||"Unicode",Pe=nt.outputEncoding,(nt.autoencode||Pe)&&je[xr].metadata&&je[xr].metadata[se]&&je[xr].metadata[se].encoding&&(me=je[xr].metadata[se].encoding,!Pe&&je[xr].encoding&&(Pe=je[xr].encoding),!Pe&&me.codePages&&(Pe=me.codePages[0]),typeof Pe=="string"&&(Pe=me[Pe]),Pe)){for(Pr=!1,rr=[],Ut=0,Vt=D.length;Ut<Vt;Ut++)(qr=Pe[D.charCodeAt(Ut)])?rr.push(String.fromCharCode(qr)):rr.push(D[Ut]),rr[Ut].charCodeAt(0)>>8&&(Pr=!0);D=rr.join("")}for(Ut=D.length;Pr===void 0&&Ut!==0;)D.charCodeAt(Ut-1)>>8&&(Pr=!0),Ut--;if(!Pr)return D;for(rr=nt.noBOM?[]:[254,255],Ut=0,Vt=D.length;Ut<Vt;Ut++){if((Br=(qr=D.charCodeAt(Ut))>>8)>>8)throw new Error("Character at position "+Ut+" of string '"+D+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");rr.push(Br),rr.push(qr-(Br<<8))}return String.fromCharCode.apply(void 0,rr)},wi=B.__private__.pdfEscape=B.pdfEscape=function(D,nt){return as(D,nt).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},an=B.__private__.beginPage=function(D){Fe[++Z]=[],J[Z]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(D[0]),topRightY:Number(D[1])}},Il(Z),fe(Fe[bt])},jo=function(D,nt){var Ut,Vt,se;switch(e=nt||e,typeof D=="string"&&(Ut=z(D.toLowerCase()),Array.isArray(Ut)&&(Vt=Ut[0],se=Ut[1])),Array.isArray(D)&&(Vt=D[0]*De,se=D[1]*De),isNaN(Vt)&&(Vt=i[0],se=i[1]),(Vt>14400||se>14400)&&(Ai.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Vt=Math.min(14400,Vt),se=Math.min(14400,se)),i=[Vt,se],e.substr(0,1)){case"l":se>Vt&&(i=[se,Vt]);break;case"p":Vt>se&&(i=[se,Vt])}an(i),yn(Ka),lt(Wo),pu!==0&&lt(pu+" J"),gu!==0&&lt(gu+" j"),st.publish("addPage",{pageNumber:Z})},qo=function(D){D>0&&D<=Z&&(Fe.splice(D,1),J.splice(D,1),Z--,bt>Z&&(bt=Z),this.setPage(bt))},Il=function(D){D>0&&D<=Z&&(bt=D)},Fl=B.__private__.getNumberOfPages=B.getNumberOfPages=function(){return Fe.length-1},dt=function(D,nt,Ut){var Vt,se=void 0;return Ut=Ut||{},D=D!==void 0?D:je[xr].fontName,nt=nt!==void 0?nt:je[xr].fontStyle,Vt=D.toLowerCase(),Rr[Vt]!==void 0&&Rr[Vt][nt]!==void 0?se=Rr[Vt][nt]:Rr[D]!==void 0&&Rr[D][nt]!==void 0?se=Rr[D][nt]:Ut.disableWarning===!1&&Ai.warn("Unable to look up font label for font '"+D+"', '"+nt+"'. Refer to getFontList() for available fonts."),se||Ut.noFallback||(se=Rr.times[nt])==null&&(se=Rr.times.normal),se},xt=B.__private__.putInfo=function(){var D=Ae(),nt=function(Vt){return Vt};for(var Ut in m!==null&&(nt=vn.encryptor(D,0)),lt("<<"),lt("/Producer ("+wi(nt("jsPDF "+zr.version))+")"),or)or.hasOwnProperty(Ut)&&or[Ut]&&lt("/"+Ut.substr(0,1).toUpperCase()+Ut.substr(1)+" ("+wi(nt(or[Ut]))+")");lt("/CreationDate ("+wi(nt(Jt))+")"),lt(">>"),lt("endobj")},kt=B.__private__.putCatalog=function(D){var nt=(D=D||{}).rootDictionaryObjId||_r;switch(Ae(),lt("<<"),lt("/Type /Catalog"),lt("/Pages "+nt+" 0 R"),Ie||(Ie="fullwidth"),Ie){case"fullwidth":lt("/OpenAction [3 0 R /FitH null]");break;case"fullheight":lt("/OpenAction [3 0 R /FitV null]");break;case"fullpage":lt("/OpenAction [3 0 R /Fit]");break;case"original":lt("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Ut=""+Ie;Ut.substr(Ut.length-1)==="%"&&(Ie=parseInt(Ie)/100),typeof Ie=="number"&&lt("/OpenAction [3 0 R /XYZ null null "+Lt(Ie)+"]")}switch(Mr||(Mr="continuous"),Mr){case"continuous":lt("/PageLayout /OneColumn");break;case"single":lt("/PageLayout /SinglePage");break;case"two":case"twoleft":lt("/PageLayout /TwoColumnLeft");break;case"tworight":lt("/PageLayout /TwoColumnRight")}hr&&lt("/PageMode /"+hr),st.publish("putCatalog"),lt(">>"),lt("endobj")},he=B.__private__.putTrailer=function(){lt("trailer"),lt("<<"),lt("/Size "+(qt+1)),lt("/Root "+qt+" 0 R"),lt("/Info "+(qt-1)+" 0 R"),m!==null&&lt("/Encrypt "+vn.oid+" 0 R"),lt("/ID [ <"+Yt+"> <"+Yt+"> ]"),lt(">>")},Le=B.__private__.putHeader=function(){lt("%PDF-"+P),lt("%")},Ze=B.__private__.putXRef=function(){var D="0000000000";lt("xref"),lt("0 "+(qt+1)),lt("0000000000 65535 f ");for(var nt=1;nt<=qt;nt++)typeof Gt[nt]=="function"?lt((D+Gt[nt]()).slice(-10)+" 00000 n "):Gt[nt]!==void 0?lt((D+Gt[nt]).slice(-10)+" 00000 n "):lt("0000000000 00000 n ")},Qr=B.__private__.buildDocument=function(){ke(),fe(oe),st.publish("buildDocument"),Le(),_n(),Ln(),Cs(),m!==null&&mn(),xt(),kt();var D=ie;return Ze(),he(),lt("startxref"),lt(""+D),lt("%%EOF"),fe(Fe[bt]),oe.join(`
`)},ei=B.__private__.getBlob=function(D){return new Blob([er(D)],{type:"application/pdf"})},$n=B.output=B.__private__.output=ti(function(D,nt){switch(typeof(nt=nt||{})=="string"?nt={filename:nt}:nt.filename=nt.filename||"generated.pdf",D){case void 0:return Qr();case"save":B.save(nt.filename);break;case"arraybuffer":return er(Qr());case"blob":return ei(Qr());case"bloburi":case"bloburl":if(Hr.URL!==void 0&&typeof Hr.URL.createObjectURL=="function")return Hr.URL&&Hr.URL.createObjectURL(ei(Qr()))||void 0;Ai.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Ut="",Vt=Qr();try{Ut=N2(Vt)}catch{Ut=N2(unescape(encodeURIComponent(Vt)))}return"data:application/pdf;filename="+nt.filename+";base64,"+Ut;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Hr)==="[object Window]"){var se="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",me=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';nt.pdfObjectUrl&&(se=nt.pdfObjectUrl,me="");var Pe='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+se+'"'+me+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(nt)+");<\/script></body></html>",rr=Hr.open();return rr!==null&&rr.document.write(Pe),rr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Hr)==="[object Window]"){var Pr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(nt.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+nt.filename+'" width="500px" height="400px" /></body></html>',qr=Hr.open();if(qr!==null){qr.document.write(Pr);var Br=this;qr.document.documentElement.querySelector("#pdfViewer").onload=function(){qr.document.title=nt.filename,qr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Br.output("bloburl"))}}return qr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Hr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var dn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",nt)+'"></iframe></body></html>',gr=Hr.open();if(gr!==null&&(gr.document.write(dn),gr.document.title=nt.filename),gr||typeof safari>"u")return gr;break;case"datauri":case"dataurl":return Hr.document.location.href=this.output("datauristring",nt);default:return null}}),xi=function(D){return Array.isArray(Ft)===!0&&Ft.indexOf(D)>-1};switch(n){case"pt":De=1;break;case"mm":De=72/25.4;break;case"cm":De=72/2.54;break;case"in":De=72;break;case"px":De=xi("px_scaling")==1?.75:96/72;break;case"pc":case"em":De=12;break;case"ex":De=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);De=n}var vn=null;Be(),$t();var au=function(D){return m!==null?vn.encryptor(D,0):function(nt){return nt}},zi=B.__private__.getPageInfo=B.getPageInfo=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:J[D].objId,pageNumber:D,pageContext:J[D]}},Ir=B.__private__.getPageInfoByObjId=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var nt in J)if(J[nt].objId===D)break;return zi(nt)},aA=B.__private__.getCurrentPageInfo=B.getCurrentPageInfo=function(){return{objId:J[bt].objId,pageNumber:bt,pageContext:J[bt]}};B.addPage=function(){return jo.apply(this,arguments),this},B.setPage=function(){return Il.apply(this,arguments),fe.call(this,Fe[bt]),this},B.insertPage=function(D){return this.addPage(),this.movePage(bt,D),this},B.movePage=function(D,nt){var Ut,Vt;if(D>nt){Ut=Fe[D],Vt=J[D];for(var se=D;se>nt;se--)Fe[se]=Fe[se-1],J[se]=J[se-1];Fe[nt]=Ut,J[nt]=Vt,this.setPage(nt)}else if(D<nt){Ut=Fe[D],Vt=J[D];for(var me=D;me<nt;me++)Fe[me]=Fe[me+1],J[me]=J[me+1];Fe[nt]=Ut,J[nt]=Vt,this.setPage(nt)}return this},B.deletePage=function(){return qo.apply(this,arguments),this},B.__private__.text=B.text=function(D,nt,Ut,Vt,se){var me,Pe,rr,Pr,qr,Br,dn,gr,ri,Yr=(Vt=Vt||{}).scope||this;if(typeof D=="number"&&typeof nt=="number"&&(typeof Ut=="string"||Array.isArray(Ut))){var en=Ut;Ut=nt,nt=D,D=en}if(arguments[3]instanceof Tt?(ft("The transform parameter of text() with a Matrix value"),ri=se):(rr=arguments[4],Pr=arguments[5],Un(dn=arguments[3])==="object"&&dn!==null||(typeof rr=="string"&&(Pr=rr,rr=null),typeof dn=="string"&&(Pr=dn,dn=null),typeof dn=="number"&&(rr=dn,dn=null),Vt={flags:dn,angle:rr,align:Pr})),isNaN(nt)||isNaN(Ut)||D==null)throw new Error("Invalid arguments passed to jsPDF.text");if(D.length===0)return Yr;var Bi="",Bo=!1,Ds=typeof Vt.lineHeightFactor=="number"?Vt.lineHeightFactor:qa,$a=Yr.internal.scaleFactor;function hA(On){return On=On.split("	").join(Array(Vt.TabLen||9).join(" ")),wi(On,dn)}function Ol(On){for(var Xn,Jn=On.concat(),hi=[],eo=Jn.length;eo--;)typeof(Xn=Jn.shift())=="string"?hi.push(Xn):Array.isArray(On)&&(Xn.length===1||Xn[1]===void 0&&Xn[2]===void 0)?hi.push(Xn[0]):hi.push([Xn[0],Xn[1],Xn[2]]);return hi}function Dl(On,Xn){var Jn;if(typeof On=="string")Jn=Xn(On)[0];else if(Array.isArray(On)){for(var hi,eo,Ya=On.concat(),Za=[],Fc=Ya.length;Fc--;)typeof(hi=Ya.shift())=="string"?Za.push(Xn(hi)[0]):Array.isArray(hi)&&typeof hi[0]=="string"&&(eo=Xn(hi[0],hi[1],hi[2]),Za.push([eo[0],eo[1],eo[2]]));Jn=Za}return Jn}var va=!1,Nl=!0;if(typeof D=="string")va=!0;else if(Array.isArray(D)){var Co=D.concat();Pe=[];for(var Eo,Hn=Co.length;Hn--;)(typeof(Eo=Co.shift())!="string"||Array.isArray(Eo)&&typeof Eo[0]!="string")&&(Nl=!1);va=Nl}if(va===!1)throw new Error('Type of text must be string or Array. "'+D+'" is not recognized.');typeof D=="string"&&(D=D.match(/[\r?\n]/)?D.split(/\r\n|\r|\n/g):[D]);var Sc=we/Yr.internal.scaleFactor,Tc=Sc*(Ds-1);switch(Vt.baseline){case"bottom":Ut-=Tc;break;case"top":Ut+=Sc-Tc;break;case"hanging":Ut+=Sc-2*Tc;break;case"middle":Ut+=Sc/2-Tc}if((Br=Vt.maxWidth||0)>0&&(typeof D=="string"?D=Yr.splitTextToSize(D,Br):Object.prototype.toString.call(D)==="[object Array]"&&(D=D.reduce(function(On,Xn){return On.concat(Yr.splitTextToSize(Xn,Br))},[]))),me={text:D,x:nt,y:Ut,options:Vt,mutex:{pdfEscape:wi,activeFontKey:xr,fonts:je,activeFontSize:we}},st.publish("preProcessText",me),D=me.text,rr=(Vt=me.options).angle,!(ri instanceof Tt)&&rr&&typeof rr=="number"){rr*=Math.PI/180,Vt.rotationDirection===0&&(rr=-rr),X===G.ADVANCED&&(rr=-rr);var kl=Math.cos(rr),$o=Math.sin(rr);ri=new Tt(kl,$o,-$o,kl,0,0)}else rr&&rr instanceof Tt&&(ri=rr);X!==G.ADVANCED||ri||(ri=_e),(qr=Vt.charSpace||Ml)!==void 0&&(Bi+=mt(ct(qr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(gr=Vt.horizontalScale)!==void 0&&(Bi+=mt(100*gr)+` Tz
`),Vt.lang;var ls=-1,yu=Vt.renderingMode!==void 0?Vt.renderingMode:Vt.stroke,Xa=Yr.internal.getCurrentPageInfo().pageContext;switch(yu){case 0:case!1:case"fill":ls=0;break;case 1:case!0:case"stroke":ls=1;break;case 2:case"fillThenStroke":ls=2;break;case 3:case"invisible":ls=3;break;case 4:case"fillAndAddForClipping":ls=4;break;case 5:case"strokeAndAddPathForClipping":ls=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ls=6;break;case 7:case"addToPathForClipping":ls=7}var Ic=Xa.usedRenderingMode!==void 0?Xa.usedRenderingMode:-1;ls!==-1?Bi+=ls+` Tr
`:Ic!==-1&&(Bi+=`0 Tr
`),ls!==-1&&(Xa.usedRenderingMode=ls),Pr=Vt.align||"left";var to,Xo=we*Ds,Jo=Yr.internal.pageSize.getWidth(),fh=je[xr];qr=Vt.charSpace||Ml,Br=Vt.maxWidth||0,dn=Object.assign({autoencode:!0,noBOM:!0},Vt.flags);var Yo=[];if(Object.prototype.toString.call(D)==="[object Array]"){var $r;Pe=Ol(D),Pr!=="left"&&(to=Pe.map(function(On){return Yr.getStringUnitWidth(On,{font:fh,charSpace:qr,fontSize:we,doKerning:!1})*we/$a}));var ys,Zo=0;if(Pr==="right"){nt-=to[0],D=[],Hn=Pe.length;for(var Ns=0;Ns<Hn;Ns++)Ns===0?(ys=Wa(nt),$r=Ko(Ut)):(ys=ct(Zo-to[Ns]),$r=-Xo),D.push([Pe[Ns],ys,$r]),Zo=to[Ns]}else if(Pr==="center"){nt-=to[0]/2,D=[],Hn=Pe.length;for(var ks=0;ks<Hn;ks++)ks===0?(ys=Wa(nt),$r=Ko(Ut)):(ys=ct((Zo-to[ks])/2),$r=-Xo),D.push([Pe[ks],ys,$r]),Zo=to[ks]}else if(Pr==="left"){D=[],Hn=Pe.length;for(var Ql=0;Ql<Hn;Ql++)D.push(Pe[Ql])}else{if(Pr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');D=[],Hn=Pe.length,Br=Br!==0?Br:Jo;for(var So=0;So<Hn;So++)$r=So===0?Ko(Ut):-Xo,ys=So===0?Wa(nt):0,So<Hn-1?Yo.push(mt(ct((Br-to[So])/(Pe[So].split(" ").length-1)))):Yo.push(0),D.push([Pe[So],ys,$r])}}var Hl=typeof Vt.R2L=="boolean"?Vt.R2L:nr;Hl===!0&&(D=Dl(D,function(On,Xn,Jn){return[On.split("").reverse().join(""),Xn,Jn]})),me={text:D,x:nt,y:Ut,options:Vt,mutex:{pdfEscape:wi,activeFontKey:xr,fonts:je,activeFontSize:we}},st.publish("postProcessText",me),D=me.text,Bo=me.mutex.isHex||!1;var zl=je[xr].encoding;zl!=="WinAnsiEncoding"&&zl!=="StandardEncoding"||(D=Dl(D,function(On,Xn,Jn){return[hA(On),Xn,Jn]})),Pe=Ol(D),D=[];for(var ba,Qs,To,Ja=0,Vl=1,ta=Array.isArray(Pe[0])?Vl:Ja,Hs="",Ei=function(On,Xn,Jn){var hi="";return Jn instanceof Tt?(Jn=typeof Vt.angle=="number"?Xt(Jn,new Tt(1,0,0,1,On,Xn)):Xt(new Tt(1,0,0,1,On,Xn),Jn),X===G.ADVANCED&&(Jn=Xt(new Tt(1,0,0,-1,0,0),Jn)),hi=Jn.join(" ")+` Tm
`):hi=mt(On)+" "+mt(Xn)+` Td
`,hi},Gi=0;Gi<Pe.length;Gi++){switch(Hs="",ta){case Vl:To=(Bo?"<":"(")+Pe[Gi][0]+(Bo?">":")"),ba=parseFloat(Pe[Gi][1]),Qs=parseFloat(Pe[Gi][2]);break;case Ja:To=(Bo?"<":"(")+Pe[Gi]+(Bo?">":")"),ba=Wa(nt),Qs=Ko(Ut)}Yo!==void 0&&Yo[Gi]!==void 0&&(Hs=Yo[Gi]+` Tw
`),Gi===0?D.push(Hs+Ei(ba,Qs,ri)+To):ta===Ja?D.push(Hs+To):ta===Vl&&D.push(Hs+Ei(ba,Qs,ri)+To)}D=ta===Ja?D.join(` Tj
T* `):D.join(` Tj
`),D+=` Tj
`;var wa=`BT
/`;return wa+=xr+" "+we+` Tf
`,wa+=mt(we*Ds)+` TL
`,wa+=Cc+`
`,wa+=Bi,wa+=D,lt(wa+="ET"),x[xr]=!0,Yr};var lu=B.__private__.clip=B.clip=function(D){return lt(D==="evenodd"?"W*":"W"),this};B.clipEvenOdd=function(){return lu("evenodd")},B.__private__.discardPath=B.discardPath=function(){return lt("n"),this};var wo=B.__private__.isValidStyle=function(D){var nt=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(D)!==-1&&(nt=!0),nt};B.__private__.setDefaultPathOperation=B.setDefaultPathOperation=function(D){return wo(D)&&(f=D),this};var cu=B.__private__.getStyle=B.getStyle=function(D){var nt=f;switch(D){case"D":case"S":nt="S";break;case"F":nt="f";break;case"FD":case"DF":nt="B";break;case"f":case"f*":case"B":case"B*":nt=D}return nt},ja=B.close=function(){return lt("h"),this};B.stroke=function(){return lt("S"),this},B.fill=function(D){return uu("f",D),this},B.fillEvenOdd=function(D){return uu("f*",D),this},B.fillStroke=function(D){return uu("B",D),this},B.fillStrokeEvenOdd=function(D){return uu("B*",D),this};var uu=function(D,nt){Un(nt)==="object"?xd(nt,D):lt(D)},Au=function(D){D===null||X===G.ADVANCED&&D===void 0||(D=cu(D),lt(D))};function ch(D,nt,Ut,Vt,se){var me=new Lf(nt||this.boundingBox,Ut||this.xStep,Vt||this.yStep,this.gState,se||this.matrix);me.stream=this.stream;var Pe=D+"$$"+this.cloneIndex+++"$$";return ue(Pe,me),me}var xd=function(D,nt){var Ut=Kn[D.key],Vt=He[Ut];if(Vt instanceof Yh)lt("q"),lt(Bd(nt)),Vt.gState&&B.setGState(Vt.gState),lt(D.matrix.toString()+" cm"),lt("/"+Ut+" sh"),lt("Q");else if(Vt instanceof Lf){var se=new Tt(1,0,0,-1,0,Rl());D.matrix&&(se=se.multiply(D.matrix||_e),Ut=ch.call(Vt,D.key,D.boundingBox,D.xStep,D.yStep,se).id),lt("q"),lt("/Pattern cs"),lt("/"+Ut+" scn"),Vt.gState&&B.setGState(Vt.gState),lt(nt),lt("Q")}},Bd=function(D){switch(D){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},lA=B.moveTo=function(D,nt){return lt(mt(ct(D))+" "+mt(_t(nt))+" m"),this},ma=B.lineTo=function(D,nt){return lt(mt(ct(D))+" "+mt(_t(nt))+" l"),this},ya=B.curveTo=function(D,nt,Ut,Vt,se,me){return lt([mt(ct(D)),mt(_t(nt)),mt(ct(Ut)),mt(_t(Vt)),mt(ct(se)),mt(_t(me)),"c"].join(" ")),this};B.__private__.line=B.line=function(D,nt,Ut,Vt,se){if(isNaN(D)||isNaN(nt)||isNaN(Ut)||isNaN(Vt)||!wo(se))throw new Error("Invalid arguments passed to jsPDF.line");return X===G.COMPAT?this.lines([[Ut-D,Vt-nt]],D,nt,[1,1],se||"S"):this.lines([[Ut-D,Vt-nt]],D,nt,[1,1]).stroke()},B.__private__.lines=B.lines=function(D,nt,Ut,Vt,se,me){var Pe,rr,Pr,qr,Br,dn,gr,ri,Yr,en,Bi,Bo;if(typeof D=="number"&&(Bo=Ut,Ut=nt,nt=D,D=Bo),Vt=Vt||[1,1],me=me||!1,isNaN(nt)||isNaN(Ut)||!Array.isArray(D)||!Array.isArray(Vt)||!wo(se)||typeof me!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(lA(nt,Ut),Pe=Vt[0],rr=Vt[1],qr=D.length,en=nt,Bi=Ut,Pr=0;Pr<qr;Pr++)(Br=D[Pr]).length===2?(en=Br[0]*Pe+en,Bi=Br[1]*rr+Bi,ma(en,Bi)):(dn=Br[0]*Pe+en,gr=Br[1]*rr+Bi,ri=Br[2]*Pe+en,Yr=Br[3]*rr+Bi,en=Br[4]*Pe+en,Bi=Br[5]*rr+Bi,ya(dn,gr,ri,Yr,en,Bi));return me&&ja(),Au(se),this},B.path=function(D){for(var nt=0;nt<D.length;nt++){var Ut=D[nt],Vt=Ut.c;switch(Ut.op){case"m":lA(Vt[0],Vt[1]);break;case"l":ma(Vt[0],Vt[1]);break;case"c":ya.apply(this,Vt);break;case"h":ja()}}return this},B.__private__.rect=B.rect=function(D,nt,Ut,Vt,se){if(isNaN(D)||isNaN(nt)||isNaN(Ut)||isNaN(Vt)||!wo(se))throw new Error("Invalid arguments passed to jsPDF.rect");return X===G.COMPAT&&(Vt=-Vt),lt([mt(ct(D)),mt(_t(nt)),mt(ct(Ut)),mt(ct(Vt)),"re"].join(" ")),Au(se),this},B.__private__.triangle=B.triangle=function(D,nt,Ut,Vt,se,me,Pe){if(isNaN(D)||isNaN(nt)||isNaN(Ut)||isNaN(Vt)||isNaN(se)||isNaN(me)||!wo(Pe))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Ut-D,Vt-nt],[se-Ut,me-Vt],[D-se,nt-me]],D,nt,[1,1],Pe,!0),this},B.__private__.roundedRect=B.roundedRect=function(D,nt,Ut,Vt,se,me,Pe){if(isNaN(D)||isNaN(nt)||isNaN(Ut)||isNaN(Vt)||isNaN(se)||isNaN(me)||!wo(Pe))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var rr=4/3*(Math.SQRT2-1);return se=Math.min(se,.5*Ut),me=Math.min(me,.5*Vt),this.lines([[Ut-2*se,0],[se*rr,0,se,me-me*rr,se,me],[0,Vt-2*me],[0,me*rr,-se*rr,me,-se,me],[2*se-Ut,0],[-se*rr,0,-se,-me*rr,-se,-me],[0,2*me-Vt],[0,-me*rr,se*rr,-me,se,-me]],D+se,nt,[1,1],Pe,!0),this},B.__private__.ellipse=B.ellipse=function(D,nt,Ut,Vt,se){if(isNaN(D)||isNaN(nt)||isNaN(Ut)||isNaN(Vt)||!wo(se))throw new Error("Invalid arguments passed to jsPDF.ellipse");var me=4/3*(Math.SQRT2-1)*Ut,Pe=4/3*(Math.SQRT2-1)*Vt;return lA(D+Ut,nt),ya(D+Ut,nt-Pe,D+me,nt-Vt,D,nt-Vt),ya(D-me,nt-Vt,D-Ut,nt-Pe,D-Ut,nt),ya(D-Ut,nt+Pe,D-me,nt+Vt,D,nt+Vt),ya(D+me,nt+Vt,D+Ut,nt+Pe,D+Ut,nt),Au(se),this},B.__private__.circle=B.circle=function(D,nt,Ut,Vt){if(isNaN(D)||isNaN(nt)||isNaN(Ut)||!wo(Vt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(D,nt,Ut,Ut,Vt)},B.setFont=function(D,nt,Ut){return Ut&&(nt=gt(nt,Ut)),xr=dt(D,nt,{disableWarning:!1}),this};var hu=B.__private__.getFont=B.getFont=function(){return je[dt.apply(B,arguments)]};B.__private__.getFontList=B.getFontList=function(){var D,nt,Ut={};for(D in Rr)if(Rr.hasOwnProperty(D))for(nt in Ut[D]=[],Rr[D])Rr[D].hasOwnProperty(nt)&&Ut[D].push(nt);return Ut},B.addFont=function(D,nt,Ut,Vt,se){var me=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&me.indexOf(arguments[3])!==-1?se=arguments[3]:arguments[3]&&me.indexOf(arguments[3])==-1&&(Ut=gt(Ut,Vt)),se=se||"Identity-H",Mi.call(this,D,nt,Ut,se)};var qa,Ka=r.lineWidth||.200025,Vi=B.__private__.getLineWidth=B.getLineWidth=function(){return Ka},yn=B.__private__.setLineWidth=B.setLineWidth=function(D){return Ka=D,lt(mt(ct(D))+" w"),this};B.__private__.setLineDash=zr.API.setLineDash=zr.API.setLineDashPattern=function(D,nt){if(D=D||[],nt=nt||0,isNaN(nt)||!Array.isArray(D))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return D=D.map(function(Ut){return mt(ct(Ut))}).join(" "),nt=mt(ct(nt)),lt("["+D+"] "+nt+" d"),this};var du=B.__private__.getLineHeight=B.getLineHeight=function(){return we*qa};B.__private__.getLineHeight=B.getLineHeight=function(){return we*qa};var Ll=B.__private__.setLineHeightFactor=B.setLineHeightFactor=function(D){return typeof(D=D||1.15)=="number"&&(qa=D),this},Pl=B.__private__.getLineHeightFactor=B.getLineHeightFactor=function(){return qa};Ll(r.lineHeight);var Wa=B.__private__.getHorizontalCoordinate=function(D){return ct(D)},Ko=B.__private__.getVerticalCoordinate=function(D){return X===G.ADVANCED?D:J[bt].mediaBox.topRightY-J[bt].mediaBox.bottomLeftY-ct(D)},Cd=B.__private__.getHorizontalCoordinateString=B.getHorizontalCoordinateString=function(D){return mt(Wa(D))},Zs=B.__private__.getVerticalCoordinateString=B.getVerticalCoordinateString=function(D){return mt(Ko(D))},Wo=r.strokeColor||"0 G";B.__private__.getStrokeColor=B.getDrawColor=function(){return Vr(Wo)},B.__private__.setStrokeColor=B.setDrawColor=function(D,nt,Ut,Vt){return Wo=Gr({ch1:D,ch2:nt,ch3:Ut,ch4:Vt,pdfColorType:"draw",precision:2}),lt(Wo),this};var fu=r.fillColor||"0 g";B.__private__.getFillColor=B.getFillColor=function(){return Vr(fu)},B.__private__.setFillColor=B.setFillColor=function(D,nt,Ut,Vt){return fu=Gr({ch1:D,ch2:nt,ch3:Ut,ch4:Vt,pdfColorType:"fill",precision:2}),lt(fu),this};var Cc=r.textColor||"0 g",uh=B.__private__.getTextColor=B.getTextColor=function(){return Vr(Cc)};B.__private__.setTextColor=B.setTextColor=function(D,nt,Ut,Vt){return Cc=Gr({ch1:D,ch2:nt,ch3:Ut,ch4:Vt,pdfColorType:"text",precision:3}),this};var Ml=r.charSpace,Ah=B.__private__.getCharSpace=B.getCharSpace=function(){return parseFloat(Ml||0)};B.__private__.setCharSpace=B.setCharSpace=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Ml=D,this};var pu=0;B.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},B.__private__.setLineCap=B.setLineCap=function(D){var nt=B.CapJoinStyles[D];if(nt===void 0)throw new Error("Line cap style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return pu=nt,lt(nt+" J"),this};var gu=0;B.__private__.setLineJoin=B.setLineJoin=function(D){var nt=B.CapJoinStyles[D];if(nt===void 0)throw new Error("Line join style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return gu=nt,lt(nt+" j"),this},B.__private__.setLineMiterLimit=B.__private__.setMiterLimit=B.setLineMiterLimit=B.setMiterLimit=function(D){if(D=D||0,isNaN(D))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return lt(mt(ct(D))+" M"),this},B.GState=Fy,B.setGState=function(D){(D=typeof D=="string"?sn[Jr[D]]:cA(null,D)).equals(Bt)||(lt("/"+D.id+" gs"),Bt=D)};var cA=function(D,nt){if(!D||!Jr[D]){var Ut=!1;for(var Vt in sn)if(sn.hasOwnProperty(Vt)&&sn[Vt].equals(nt)){Ut=!0;break}if(Ut)nt=sn[Vt];else{var se="GS"+(Object.keys(sn).length+1).toString(10);sn[se]=nt,nt.id=se}return D&&(Jr[D]=nt.id),st.publish("addGState",nt),nt}};B.addGState=function(D,nt){return cA(D,nt),this},B.saveGraphicsState=function(){return lt("q"),cn.push({key:xr,size:we,color:Cc}),this},B.restoreGraphicsState=function(){lt("Q");var D=cn.pop();return xr=D.key,we=D.size,Cc=D.color,Bt=null,this},B.setCurrentTransformationMatrix=function(D){return lt(D.toString()+" cm"),this},B.comment=function(D){return lt("#"+D),this};var xo=function(D,nt){var Ut=D||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Ut},set:function(me){isNaN(me)||(Ut=parseFloat(me))}});var Vt=nt||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Vt},set:function(me){isNaN(me)||(Vt=parseFloat(me))}});var se="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return se},set:function(me){se=me.toString()}}),this},mu=function(D,nt,Ut,Vt){xo.call(this,D,nt),this.type="rect";var se=Ut||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return se},set:function(Pe){isNaN(Pe)||(se=parseFloat(Pe))}});var me=Vt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return me},set:function(Pe){isNaN(Pe)||(me=parseFloat(Pe))}}),this},uA=function(){this.page=Z,this.currentPage=bt,this.pages=Fe.slice(0),this.pagesContext=J.slice(0),this.x=pn,this.y=ge,this.matrix=yr,this.width=Ec(bt),this.height=Rl(bt),this.outputDestination=Ne,this.id="",this.objectNumber=-1};uA.prototype.restore=function(){Z=this.page,bt=this.currentPage,J=this.pagesContext,Fe=this.pages,pn=this.x,ge=this.y,yr=this.matrix,Ul(bt,this.width),AA(bt,this.height),Ne=this.outputDestination};var hh=function(D,nt,Ut,Vt,se){jt.push(new uA),Z=bt=0,Fe=[],pn=D,ge=nt,yr=se,an([Ut,Vt])},dh=function(D){if(Ht[D])jt.pop().restore();else{var nt=new uA,Ut="Xo"+(Object.keys(Nt).length+1).toString(10);nt.id=Ut,Ht[D]=Ut,Nt[Ut]=nt,st.publish("addFormObject",nt),jt.pop().restore()}};for(var _a in B.beginFormObject=function(D,nt,Ut,Vt,se){return hh(D,nt,Ut,Vt,se),this},B.endFormObject=function(D){return dh(D),this},B.doFormObject=function(D,nt){var Ut=Nt[Ht[D]];return lt("q"),lt(nt.toString()+" cm"),lt("/"+Ut.id+" Do"),lt("Q"),this},B.getFormObject=function(D){var nt=Nt[Ht[D]];return{x:nt.x,y:nt.y,width:nt.width,height:nt.height,matrix:nt.matrix}},B.save=function(D,nt){return D=D||"generated.pdf",(nt=nt||{}).returnPromise=nt.returnPromise||!1,nt.returnPromise===!1?(Jh(ei(Qr()),D),typeof Jh.unload=="function"&&Hr.setTimeout&&setTimeout(Jh.unload,911),this):new Promise(function(Ut,Vt){try{var se=Jh(ei(Qr()),D);typeof Jh.unload=="function"&&Hr.setTimeout&&setTimeout(Jh.unload,911),Ut(se)}catch(me){Vt(me.message)}})},zr.API)zr.API.hasOwnProperty(_a)&&(_a==="events"&&zr.API.events.length?function(D,nt){var Ut,Vt,se;for(se=nt.length-1;se!==-1;se--)Ut=nt[se][0],Vt=nt[se][1],D.subscribe.apply(D,[Ut].concat(typeof Vt=="function"?[Vt]:Vt))}(st,zr.API.events):B[_a]=zr.API[_a]);var Ec=B.getPageWidth=function(D){return(J[D=D||bt].mediaBox.topRightX-J[D].mediaBox.bottomLeftX)/De},Ul=B.setPageWidth=function(D,nt){J[D].mediaBox.topRightX=nt*De+J[D].mediaBox.bottomLeftX},Rl=B.getPageHeight=function(D){return(J[D=D||bt].mediaBox.topRightY-J[D].mediaBox.bottomLeftY)/De},AA=B.setPageHeight=function(D,nt){J[D].mediaBox.topRightY=nt*De+J[D].mediaBox.bottomLeftY};return B.internal={pdfEscape:wi,getStyle:cu,getFont:hu,getFontSize:Oe,getCharSpace:Ah,getTextColor:uh,getLineHeight:du,getLineHeightFactor:Pl,getLineWidth:Vi,write:pr,getHorizontalCoordinate:Wa,getVerticalCoordinate:Ko,getCoordinateString:Cd,getVerticalCoordinateString:Zs,collections:{},newObject:Ae,newAdditionalObject:Er,newObjectDeferred:ze,newObjectDeferredBegin:Ve,getFilters:Zr,putStream:vr,events:st,scaleFactor:De,pageSize:{getWidth:function(){return Ec(bt)},setWidth:function(D){Ul(bt,D)},getHeight:function(){return Rl(bt)},setHeight:function(D){AA(bt,D)}},encryptionOptions:m,encryption:vn,getEncryptor:au,output:$n,getNumberOfPages:Fl,pages:Fe,out:lt,f2:Lt,f3:at,getPageInfo:zi,getPageInfoByObjId:Ir,getCurrentPageInfo:aA,getPDFVersion:R,Point:xo,Rectangle:mu,Matrix:Tt,hasHotfix:xi},Object.defineProperty(B.internal.pageSize,"width",{get:function(){return Ec(bt)},set:function(D){Ul(bt,D)},enumerable:!0,configurable:!0}),Object.defineProperty(B.internal.pageSize,"height",{get:function(){return Rl(bt)},set:function(D){AA(bt,D)},enumerable:!0,configurable:!0}),ga.call(B,pe),xr="F1",jo(i,e),st.publish("initialized"),B}If.prototype.lsbFirstWord=function(r){return String.fromCharCode(r>>0&255,r>>8&255,r>>16&255,r>>24&255)},If.prototype.toHexString=function(r){return r.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},If.prototype.hexToBytes=function(r){for(var t=[],e=0;e<r.length;e+=2)t.push(String.fromCharCode(parseInt(r.substr(e,2),16)));return t.join("")},If.prototype.processOwnerPassword=function(r,t){return H2(Q2(t).substr(0,5),r)},If.prototype.encryptor=function(r,t){var e=Q2(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return H2(e,n)}},Fy.prototype.equals=function(r){var t,e="id,objectNumber,equals";if(!r||Un(r)!==Un(this))return!1;var n=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!r.hasOwnProperty(t)||this[t]!==r[t])return!1;n++}for(t in r)r.hasOwnProperty(t)&&e.indexOf(t)<0&&n--;return n===0},zr.API={events:[]},zr.version="2.5.1";var ki=zr.API,z2=1,Zh=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Pf=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},tn=function(r){return r.toFixed(2)},qA=function(r){return r.toFixed(5)};ki.__acroform__={};var ha=function(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r},iP=function(r){return r*z2},Jc=function(r){var t=new oP,e=Cr.internal.getHeight(r)||0,n=Cr.internal.getWidth(r)||0;return t.BBox=[0,0,Number(tn(n)),Number(tn(e))],t},vrt=ki.__acroform__.setBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|=1<<t},brt=ki.__acroform__.clearBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&=~(1<<t)},wrt=ki.__acroform__.getBit=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<t?1:0},Ji=ki.__acroform__.getBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return wrt(r,t-1)},Yi=ki.__acroform__.setBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return vrt(r,t-1)},Zi=ki.__acroform__.clearBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return brt(r,t-1)},xrt=ki.__acroform__.calculateCoordinates=function(r,t){var e=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,i=r[0],s=r[1],a=r[2],o=r[3],h={};return h.lowerLeft_X=e(i)||0,h.lowerLeft_Y=n(s+o)||0,h.upperRight_X=e(i+a)||0,h.upperRight_Y=n(s)||0,[Number(tn(h.lowerLeft_X)),Number(tn(h.lowerLeft_Y)),Number(tn(h.upperRight_X)),Number(tn(h.upperRight_Y))]},Brt=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var t=[],e=r._V||r.DV,n=V2(r,e),i=r.scope.internal.getFont(r.fontName,r.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(r.scope.__private__.encodeColorString(r.color)),t.push("/"+i+" "+tn(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=Jc(r);return s.scope=r.scope,s.stream=t.join(`
`),s}},V2=function(r,t){var e=r.fontSize===0?r.maxFontSize:r.fontSize,n={text:"",fontSize:""},i=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");i=r.multiline?i.map(function(at){return at.split(`
`)}):i.map(function(at){return[at]});var s=e,a=Cr.internal.getHeight(r)||0;a=a<0?-a:a;var o=Cr.internal.getWidth(r)||0;o=o<0?-o:o;var h=function(at,ct,wt){if(at+1<i.length){var _t=ct+" "+i[at+1][0];return Ly(_t,r,wt).width<=o-4}return!1};s++;t:for(;s>0;){t="",s--;var f,m,b=Ly("3",r,s).height,x=r.multiline?a-s:(a-b)/2,B=x+=2,P=0,R=0,Q=0;if(s<=0){t=`(...) Tj
`,t+="% Width of Text: "+Ly(t,r,s=12).width+", FieldWidth:"+o+`
`;break}for(var z="",G=0,X=0;X<i.length;X++)if(i.hasOwnProperty(X)){var et=!1;if(i[X].length!==1&&Q!==i[X].length-1){if((b+2)*(G+2)+2>a)continue t;z+=i[X][Q],et=!0,R=X,X--}else{z=(z+=i[X][Q]+" ").substr(z.length-1)==" "?z.substr(0,z.length-1):z;var pt=parseInt(X),gt=h(pt,z,s),mt=X>=i.length-1;if(gt&&!mt){z+=" ",Q=0;continue}if(gt||mt){if(mt)R=pt;else if(r.multiline&&(b+2)*(G+2)+2>a)continue t}else{if(!r.multiline||(b+2)*(G+2)+2>a)continue t;R=pt}}for(var ft="",Mt=P;Mt<=R;Mt++){var Lt=i[Mt];if(r.multiline){if(Mt===R){ft+=Lt[Q]+" ",Q=(Q+1)%Lt.length;continue}if(Mt===P){ft+=Lt[Lt.length-1]+" ";continue}}ft+=Lt[0]+" "}switch(ft=ft.substr(ft.length-1)==" "?ft.substr(0,ft.length-1):ft,m=Ly(ft,r,s).width,r.textAlign){case"right":f=o-m-2;break;case"center":f=(o-m)/2;break;case"left":default:f=2}t+=tn(f)+" "+tn(B)+` Td
`,t+="("+Zh(ft)+`) Tj
`,t+=-tn(f)+` 0 Td
`,B=-(s+2),m=0,P=et?R:R+1,G++,z=""}break}return n.text=t,n.fontSize=s,n},Ly=function(r,t,e){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),i=t.scope.getStringUnitWidth(r,{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:i}},Crt={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Ert=function(r,t){var e={type:"reference",object:r};t.internal.getPageInfo(r.page).pageContext.annotations.find(function(n){return n.type===e.type&&n.object===e.object})===void 0&&t.internal.getPageInfo(r.page).pageContext.annotations.push(e)},Srt=function(r,t){for(var e in r)if(r.hasOwnProperty(e)){var n=e,i=r[e];t.internal.newObjectDeferredBegin(i.objId,!0),Un(i)==="object"&&typeof i.putStream=="function"&&i.putStream(),delete r[n]}},Trt=function(r,t){if(t.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(uc.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(Crt)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");z2=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new aP,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s.objId=void 0,s.hasAnnotation&&Ert(s,e)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(e){(function(n,i){var s=!n;for(var a in n||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(a)){var o=n[a],h=[],f=o.Rect;if(o.Rect&&(o.Rect=xrt(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=Cr.createDefaultAppearanceStream(o),Un(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(h=o.getKeyValueListForStream()),o.Rect=f,o.hasAppearanceStream&&!o.appearanceStreamContent){var m=Brt(o);h.push({key:"AP",value:"<</N "+m+">>"}),i.internal.acroformPlugin.xForms.push(m)}if(o.appearanceStreamContent){var b="";for(var x in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(x)){var B=o.appearanceStreamContent[x];if(b+="/"+x+" ",b+="<<",Object.keys(B).length>=1||Array.isArray(B)){for(var a in B)if(B.hasOwnProperty(a)){var P=B[a];typeof P=="function"&&(P=P.call(i,o)),b+="/"+a+" "+P+" ",i.internal.acroformPlugin.xForms.indexOf(P)>=0||i.internal.acroformPlugin.xForms.push(P)}}else typeof(P=B)=="function"&&(P=P.call(i,o)),b+="/"+a+" "+P,i.internal.acroformPlugin.xForms.indexOf(P)>=0||i.internal.acroformPlugin.xForms.push(P);b+=">>"}h.push({key:"AP",value:`<<
`+b+">>"})}i.internal.putStream({additionalKeyValues:h,objectId:o.objId}),i.internal.out("endobj")}s&&Srt(i.internal.acroformPlugin.xForms,i)})(e,r)}),r.internal.acroformPlugin.isInitialized=!0}},sP=ki.__acroform__.arrayToPdfArray=function(r,t,e){var n=function(a){return a};if(Array.isArray(r)){for(var i="[",s=0;s<r.length;s++)switch(s!==0&&(i+=" "),Un(r[s])){case"boolean":case"number":case"object":i+=r[s].toString();break;case"string":r[s].substr(0,1)!=="/"?(t!==void 0&&e&&(n=e.internal.getEncryptor(t)),i+="("+Zh(n(r[s].toString()))+")"):i+=r[s].toString()}return i+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},G2=function(r,t,e){var n=function(i){return i};return t!==void 0&&e&&(n=e.internal.getEncryptor(t)),(r=r||"").toString(),r="("+Zh(n(r))+")"},Yc=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Yc.prototype.toString=function(){return this.objId+" 0 R"},Yc.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},Yc.prototype.getKeyValueListForStream=function(){var r=[],t=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var n=t[e],i=this[n];i&&(Array.isArray(i)?r.push({key:n,value:sP(i,this.objId,this.scope)}):i instanceof Yc?(i.scope=this.scope,r.push({key:n,value:i.objId+" 0 R"})):typeof i!="function"&&r.push({key:n,value:i}))}return r};var oP=function(){Yc.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){r=e.trim()},get:function(){return r||null}})};ha(oP,Yc);var aP=function(){Yc.call(this);var r,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var e=function(n){return n};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+Zh(e(r))+")"}},set:function(e){r=e}})};ha(aP,Yc);var uc=function r(){Yc.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(z){if(isNaN(z))throw new Error('Invalid value "'+z+'" for attribute F supplied.');t=z}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Ji(t,3)},set:function(z){z?this.F=Yi(t,3):this.F=Zi(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(z){if(isNaN(z))throw new Error('Invalid value "'+z+'" for attribute Ff supplied.');e=z}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(z){n=z!==void 0?z:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(z){n[0]=z}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(z){n[1]=z}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(z){n[2]=z}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(z){n[3]=z}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(z){switch(z){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=z;break;default:throw new Error('Invalid value "'+z+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof Uy)return;s="FieldObject"+r.FieldNum++}var z=function(G){return G};return this.scope&&(z=this.scope.internal.getEncryptor(this.objId)),"("+Zh(z(s))+")"},set:function(z){s=z.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(z){s=z}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(z){a=z}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(z){o=z}});var h=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return h},set:function(z){h=z}});var f=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return f===void 0?50/z2:f},set:function(z){f=z}});var m="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return m},set:function(z){m=z}});var b="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!b||this instanceof Uy||this instanceof td))return G2(b,this.objId,this.scope)},set:function(z){z=z.toString(),b=z}});var x=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(x)return this instanceof Ms?x:G2(x,this.objId,this.scope)},set:function(z){z=z.toString(),x=this instanceof Ms?z:z.substr(0,1)==="("?Pf(z.substr(1,z.length-2)):Pf(z)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ms?Pf(x.substr(1,x.length-1)):x},set:function(z){z=z.toString(),x=this instanceof Ms?"/"+z:z}});var B=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(B)return B},set:function(z){this.V=z}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(B)return this instanceof Ms?B:G2(B,this.objId,this.scope)},set:function(z){z=z.toString(),B=this instanceof Ms?z:z.substr(0,1)==="("?Pf(z.substr(1,z.length-2)):Pf(z)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ms?Pf(B.substr(1,B.length-1)):B},set:function(z){z=z.toString(),B=this instanceof Ms?"/"+z:z}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var P,R=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return R},set:function(z){z=!!z,R=z}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(P)return P},set:function(z){P=z}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,1)},set:function(z){z?this.Ff=Yi(this.Ff,1):this.Ff=Zi(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,2)},set:function(z){z?this.Ff=Yi(this.Ff,2):this.Ff=Zi(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,3)},set:function(z){z?this.Ff=Yi(this.Ff,3):this.Ff=Zi(this.Ff,3)}});var Q=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(Q!==null)return Q},set:function(z){if([0,1,2].indexOf(z)===-1)throw new Error('Invalid value "'+z+'" for attribute Q supplied.');Q=z}}),Object.defineProperty(this,"textAlign",{get:function(){var z;switch(Q){case 0:default:z="left";break;case 1:z="center";break;case 2:z="right"}return z},configurable:!0,enumerable:!0,set:function(z){switch(z){case"right":case 2:Q=2;break;case"center":case 1:Q=1;break;case"left":case 0:default:Q=0}}})};ha(uc,Yc);var Mf=function(){uc.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){r=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return sP(t,this.objId,this.scope)},set:function(e){var n,i;i=[],typeof(n=e)=="string"&&(i=function(s,a,o){o||(o=1);for(var h,f=[];h=a.exec(s);)f.push(h[o]);return f}(n,/\((.*?)\)/g)),t=i}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,18)},set:function(e){e?this.Ff=Yi(this.Ff,18):this.Ff=Zi(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=Yi(this.Ff,19):this.Ff=Zi(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,20)},set:function(e){e?(this.Ff=Yi(this.Ff,20),t.sort()):this.Ff=Zi(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,22)},set:function(e){e?this.Ff=Yi(this.Ff,22):this.Ff=Zi(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,23)},set:function(e){e?this.Ff=Yi(this.Ff,23):this.Ff=Zi(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,27)},set:function(e){e?this.Ff=Yi(this.Ff,27):this.Ff=Zi(this.Ff,27)}}),this.hasAppearanceStream=!1};ha(Mf,uc);var Uf=function(){Mf.call(this),this.fontName="helvetica",this.combo=!1};ha(Uf,Mf);var Rf=function(){Uf.call(this),this.combo=!0};ha(Rf,Uf);var Py=function(){Rf.call(this),this.edit=!0};ha(Py,Rf);var Ms=function(){uc.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,15)},set:function(e){e?this.Ff=Yi(this.Ff,15):this.Ff=Zi(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,16)},set:function(e){e?this.Ff=Yi(this.Ff,16):this.Ff=Zi(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,17)},set:function(e){e?this.Ff=Yi(this.Ff,17):this.Ff=Zi(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,26)},set:function(e){e?this.Ff=Yi(this.Ff,26):this.Ff=Zi(this.Ff,26)}});var r,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(s){return s};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,i=[];for(n in i.push("<<"),t)i.push("/"+n+" ("+Zh(e(t[n]))+")");return i.push(">>"),i.join(`
`)}},set:function(e){Un(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(e){r="/"+e}})};ha(Ms,uc);var My=function(){Ms.call(this),this.pushButton=!0};ha(My,Ms);var Of=function(){Ms.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t!==void 0?t:[]}})};ha(Of,Ms);var Uy=function(){var r,t;uc.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(i){r=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(i){t=i}});var e,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),n)a.push("/"+s+" ("+Zh(i(n[s]))+")");return a.push(">>"),a.join(`
`)},set:function(i){Un(i)==="object"&&(n=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(i){typeof i=="string"&&(n.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(i){e=i}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(i){e="/"+i}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Cr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};ha(Uy,uc),Of.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=r.createAppearanceStream(e.optionName),e.caption=r.getCA()}},Of.prototype.createOption=function(r){var t=new Uy;return t.Parent=this,t.optionName=r,this.Kids.push(t),Irt.call(this.scope,t),t};var Ry=function(){Ms.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Cr.CheckBox.createAppearanceStream()};ha(Ry,Ms);var td=function(){uc.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,13)},set:function(t){t?this.Ff=Yi(this.Ff,13):this.Ff=Zi(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,21)},set:function(t){t?this.Ff=Yi(this.Ff,21):this.Ff=Zi(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,23)},set:function(t){t?this.Ff=Yi(this.Ff,23):this.Ff=Zi(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,24)},set:function(t){t?this.Ff=Yi(this.Ff,24):this.Ff=Zi(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,25)},set:function(t){t?this.Ff=Yi(this.Ff,25):this.Ff=Zi(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,26)},set:function(t){t?this.Ff=Yi(this.Ff,26):this.Ff=Zi(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){Number.isInteger(t)&&(r=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};ha(td,uc);var Oy=function(){td.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Ji(this.Ff,14)},set:function(r){r?this.Ff=Yi(this.Ff,14):this.Ff=Zi(this.Ff,14)}}),this.password=!0};ha(Oy,td);var Cr={CheckBox:{createAppearanceStream:function(){return{N:{On:Cr.CheckBox.YesNormal},D:{On:Cr.CheckBox.YesPushDown,Off:Cr.CheckBox.OffPushDown}}},YesPushDown:function(r){var t=Jc(r);t.scope=r.scope;var e=[],n=r.scope.internal.getFont(r.fontName,r.fontStyle).id,i=r.scope.__private__.encodeColorString(r.color),s=V2(r,r.caption);return e.push("0.749023 g"),e.push("0 0 "+tn(Cr.internal.getWidth(r))+" "+tn(Cr.internal.getHeight(r))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+n+" "+tn(s.fontSize)+" Tf "+i),e.push("BT"),e.push(s.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`
`),t},YesNormal:function(r){var t=Jc(r);t.scope=r.scope;var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,n=r.scope.__private__.encodeColorString(r.color),i=[],s=Cr.internal.getHeight(r),a=Cr.internal.getWidth(r),o=V2(r,r.caption);return i.push("1 g"),i.push("0 0 "+tn(a)+" "+tn(s)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+tn(a-1)+" "+tn(s-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+e+" "+tn(o.fontSize)+" Tf "+n),i.push(o.text),i.push("ET"),i.push("Q"),t.stream=i.join(`
`),t},OffPushDown:function(r){var t=Jc(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+tn(Cr.internal.getWidth(r))+" "+tn(Cr.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(r){var t={D:{Off:Cr.RadioButton.Circle.OffPushDown},N:{}};return t.N[r]=Cr.RadioButton.Circle.YesNormal,t.D[r]=Cr.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(r){var t=Jc(r);t.scope=r.scope;var e=[],n=Cr.internal.getWidth(r)<=Cr.internal.getHeight(r)?Cr.internal.getWidth(r)/4:Cr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Cr.internal.Bezier_C,s=Number((n*i).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+qA(Cr.internal.getWidth(r)/2)+" "+qA(Cr.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),e.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),e.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),e.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Jc(r);t.scope=r.scope;var e=[],n=Cr.internal.getWidth(r)<=Cr.internal.getHeight(r)?Cr.internal.getWidth(r)/4:Cr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Cr.internal.Bezier_C).toFixed(5)),a=Number((n*Cr.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+qA(Cr.internal.getWidth(r)/2)+" "+qA(Cr.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+qA(Cr.internal.getWidth(r)/2)+" "+qA(Cr.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+a+" "+a+" "+n+" 0 "+n+" c"),e.push("-"+a+" "+n+" -"+n+" "+a+" -"+n+" 0 c"),e.push("-"+n+" -"+a+" -"+a+" -"+n+" 0 -"+n+" c"),e.push(a+" -"+n+" "+n+" -"+a+" "+n+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},OffPushDown:function(r){var t=Jc(r);t.scope=r.scope;var e=[],n=Cr.internal.getWidth(r)<=Cr.internal.getHeight(r)?Cr.internal.getWidth(r)/4:Cr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Cr.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+qA(Cr.internal.getWidth(r)/2)+" "+qA(Cr.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t}},Cross:{createAppearanceStream:function(r){var t={D:{Off:Cr.RadioButton.Cross.OffPushDown},N:{}};return t.N[r]=Cr.RadioButton.Cross.YesNormal,t.D[r]=Cr.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(r){var t=Jc(r);t.scope=r.scope;var e=[],n=Cr.internal.calculateCross(r);return e.push("q"),e.push("1 1 "+tn(Cr.internal.getWidth(r)-2)+" "+tn(Cr.internal.getHeight(r)-2)+" re"),e.push("W"),e.push("n"),e.push(tn(n.x1.x)+" "+tn(n.x1.y)+" m"),e.push(tn(n.x2.x)+" "+tn(n.x2.y)+" l"),e.push(tn(n.x4.x)+" "+tn(n.x4.y)+" m"),e.push(tn(n.x3.x)+" "+tn(n.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Jc(r);t.scope=r.scope;var e=Cr.internal.calculateCross(r),n=[];return n.push("0.749023 g"),n.push("0 0 "+tn(Cr.internal.getWidth(r))+" "+tn(Cr.internal.getHeight(r))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+tn(Cr.internal.getWidth(r)-2)+" "+tn(Cr.internal.getHeight(r)-2)+" re"),n.push("W"),n.push("n"),n.push(tn(e.x1.x)+" "+tn(e.x1.y)+" m"),n.push(tn(e.x2.x)+" "+tn(e.x2.y)+" l"),n.push(tn(e.x4.x)+" "+tn(e.x4.y)+" m"),n.push(tn(e.x3.x)+" "+tn(e.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(r){var t=Jc(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+tn(Cr.internal.getWidth(r))+" "+tn(Cr.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}}},createDefaultAppearanceStream:function(r){var t=r.scope.internal.getFont(r.fontName,r.fontStyle).id,e=r.scope.__private__.encodeColorString(r.color);return"/"+t+" "+r.fontSize+" Tf "+e}};Cr.internal={Bezier_C:.551915024494,calculateCross:function(r){var t=Cr.internal.getWidth(r),e=Cr.internal.getHeight(r),n=Math.min(t,e);return{x1:{x:(t-n)/2,y:(e-n)/2+n},x2:{x:(t-n)/2+n,y:(e-n)/2},x3:{x:(t-n)/2,y:(e-n)/2},x4:{x:(t-n)/2+n,y:(e-n)/2+n}}}},Cr.internal.getWidth=function(r){var t=0;return Un(r)==="object"&&(t=iP(r.Rect[2])),t},Cr.internal.getHeight=function(r){var t=0;return Un(r)==="object"&&(t=iP(r.Rect[3])),t};var Irt=ki.addField=function(r){if(Trt(this,r),!(r instanceof uc))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=r).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};ki.AcroFormChoiceField=Mf,ki.AcroFormListBox=Uf,ki.AcroFormComboBox=Rf,ki.AcroFormEditBox=Py,ki.AcroFormButton=Ms,ki.AcroFormPushButton=My,ki.AcroFormRadioButton=Of,ki.AcroFormCheckBox=Ry,ki.AcroFormTextField=td,ki.AcroFormPasswordField=Oy,ki.AcroFormAppearance=Cr,ki.AcroForm={ChoiceField:Mf,ListBox:Uf,ComboBox:Rf,EditBox:Py,Button:Ms,PushButton:My,RadioButton:Of,CheckBox:Ry,TextField:td,PasswordField:Oy,Appearance:Cr},zr.AcroForm={ChoiceField:Mf,ListBox:Uf,ComboBox:Rf,EditBox:Py,Button:Ms,PushButton:My,RadioButton:Of,CheckBox:Ry,TextField:td,PasswordField:Oy,Appearance:Cr};function lP(r){return r.reduce(function(t,e,n){return t[e]=n,t},{})}(function(r){r.__addimage__={};var t="UNKNOWN",e={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=r.__addimage__.getImageFileTypeByImageData=function(at,ct){var wt,_t,Jt,Yt,ee,$t=t;if((ct=ct||t)==="RGBA"||at.data!==void 0&&at.data instanceof Uint8ClampedArray&&"height"in at&&"width"in at)return"RGBA";if(gt(at))for(ee in e)for(Jt=e[ee],wt=0;wt<Jt.length;wt+=1){for(Yt=!0,_t=0;_t<Jt[wt].length;_t+=1)if(Jt[wt][_t]!==void 0&&Jt[wt][_t]!==at[_t]){Yt=!1;break}if(Yt===!0){$t=ee;break}}else for(ee in e)for(Jt=e[ee],wt=0;wt<Jt.length;wt+=1){for(Yt=!0,_t=0;_t<Jt[wt].length;_t+=1)if(Jt[wt][_t]!==void 0&&Jt[wt][_t]!==at.charCodeAt(_t)){Yt=!1;break}if(Yt===!0){$t=ee;break}}return $t===t&&ct!==t&&($t=ct),$t},i=function at(ct){for(var wt=this.internal.write,_t=this.internal.putStream,Jt=(0,this.internal.getFilters)();Jt.indexOf("FlateEncode")!==-1;)Jt.splice(Jt.indexOf("FlateEncode"),1);ct.objectId=this.internal.newObject();var Yt=[];if(Yt.push({key:"Type",value:"/XObject"}),Yt.push({key:"Subtype",value:"/Image"}),Yt.push({key:"Width",value:ct.width}),Yt.push({key:"Height",value:ct.height}),ct.colorSpace===Q.INDEXED?Yt.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(ct.palette.length/3-1)+" "+("sMask"in ct&&ct.sMask!==void 0?ct.objectId+2:ct.objectId+1)+" 0 R]"}):(Yt.push({key:"ColorSpace",value:"/"+ct.colorSpace}),ct.colorSpace===Q.DEVICE_CMYK&&Yt.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Yt.push({key:"BitsPerComponent",value:ct.bitsPerComponent}),"decodeParameters"in ct&&ct.decodeParameters!==void 0&&Yt.push({key:"DecodeParms",value:"<<"+ct.decodeParameters+">>"}),"transparency"in ct&&Array.isArray(ct.transparency)){for(var ee="",$t=0,ne=ct.transparency.length;$t<ne;$t++)ee+=ct.transparency[$t]+" "+ct.transparency[$t]+" ";Yt.push({key:"Mask",value:"["+ee+"]"})}ct.sMask!==void 0&&Yt.push({key:"SMask",value:ct.objectId+1+" 0 R"});var re=ct.filter!==void 0?["/"+ct.filter]:void 0;if(_t({data:ct.data,additionalKeyValues:Yt,alreadyAppliedFilters:re,objectId:ct.objectId}),wt("endobj"),"sMask"in ct&&ct.sMask!==void 0){var Be="/Predictor "+ct.predictor+" /Colors 1 /BitsPerComponent "+ct.bitsPerComponent+" /Columns "+ct.width,it={width:ct.width,height:ct.height,colorSpace:"DeviceGray",bitsPerComponent:ct.bitsPerComponent,decodeParameters:Be,data:ct.sMask};"filter"in ct&&(it.filter=ct.filter),at.call(this,it)}if(ct.colorSpace===Q.INDEXED){var bt=this.internal.newObject();_t({data:ft(new Uint8Array(ct.palette)),objectId:bt}),wt("endobj")}},s=function(){var at=this.internal.collections.addImage_images;for(var ct in at)i.call(this,at[ct])},a=function(){var at,ct=this.internal.collections.addImage_images,wt=this.internal.write;for(var _t in ct)wt("/I"+(at=ct[_t]).index,at.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",a))},h=function(){var at=this.internal.collections.addImage_images;return o.call(this),at},f=function(){return Object.keys(this.internal.collections.addImage_images).length},m=function(at){return typeof r["process"+at.toUpperCase()]=="function"},b=function(at){return Un(at)==="object"&&at.nodeType===1},x=function(at,ct){if(at.nodeName==="IMG"&&at.hasAttribute("src")){var wt=""+at.getAttribute("src");if(wt.indexOf("data:image/")===0)return zg(unescape(wt).split("base64,").pop());var _t=r.loadFile(wt,!0);if(_t!==void 0)return _t}if(at.nodeName==="CANVAS"){if(at.width===0||at.height===0)throw new Error("Given canvas must have data. Canvas width: "+at.width+", height: "+at.height);var Jt;switch(ct){case"PNG":Jt="image/png";break;case"WEBP":Jt="image/webp";break;case"JPEG":case"JPG":default:Jt="image/jpeg"}return zg(at.toDataURL(Jt,1).split("base64,").pop())}},B=function(at){var ct=this.internal.collections.addImage_images;if(ct){for(var wt in ct)if(at===ct[wt].alias)return ct[wt]}},P=function(at,ct,wt){return at||ct||(at=-96,ct=-96),at<0&&(at=-1*wt.width*72/at/this.internal.scaleFactor),ct<0&&(ct=-1*wt.height*72/ct/this.internal.scaleFactor),at===0&&(at=ct*wt.width/wt.height),ct===0&&(ct=at*wt.height/wt.width),[at,ct]},R=function(at,ct,wt,_t,Jt,Yt){var ee=P.call(this,wt,_t,Jt),$t=this.internal.getCoordinateString,ne=this.internal.getVerticalCoordinateString,re=h.call(this);if(wt=ee[0],_t=ee[1],re[Jt.index]=Jt,Yt){Yt*=Math.PI/180;var Be=Math.cos(Yt),it=Math.sin(Yt),bt=function(Ot){return Ot.toFixed(4)},Pt=[bt(Be),bt(it),bt(-1*it),bt(Be),0,0,"cm"]}this.internal.write("q"),Yt?(this.internal.write([1,"0","0",1,$t(at),ne(ct+_t),"cm"].join(" ")),this.internal.write(Pt.join(" ")),this.internal.write([$t(wt),"0","0",$t(_t),"0","0","cm"].join(" "))):this.internal.write([$t(wt),"0","0",$t(_t),$t(at),ne(ct+_t),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Jt.index+" Do"),this.internal.write("Q")},Q=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var z=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},G=r.__addimage__.sHashCode=function(at){var ct,wt,_t=0;if(typeof at=="string")for(wt=at.length,ct=0;ct<wt;ct++)_t=(_t<<5)-_t+at.charCodeAt(ct),_t|=0;else if(gt(at))for(wt=at.byteLength/2,ct=0;ct<wt;ct++)_t=(_t<<5)-_t+at[ct],_t|=0;return _t},X=r.__addimage__.validateStringAsBase64=function(at){(at=at||"").toString().trim();var ct=!0;return at.length===0&&(ct=!1),at.length%4!=0&&(ct=!1),/^[A-Za-z0-9+/]+$/.test(at.substr(0,at.length-2))===!1&&(ct=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(at.substr(-2))===!1&&(ct=!1),ct},et=r.__addimage__.extractImageFromDataUrl=function(at){var ct=(at=at||"").split("base64,"),wt=null;if(ct.length===2){var _t=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(ct[0]);Array.isArray(_t)&&(wt={mimeType:_t[1],charset:_t[2],data:ct[1]})}return wt},pt=r.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};r.__addimage__.isArrayBuffer=function(at){return pt()&&at instanceof ArrayBuffer};var gt=r.__addimage__.isArrayBufferView=function(at){return pt()&&typeof Uint32Array<"u"&&(at instanceof Int8Array||at instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&at instanceof Uint8ClampedArray||at instanceof Int16Array||at instanceof Uint16Array||at instanceof Int32Array||at instanceof Uint32Array||at instanceof Float32Array||at instanceof Float64Array)},mt=r.__addimage__.binaryStringToUint8Array=function(at){for(var ct=at.length,wt=new Uint8Array(ct),_t=0;_t<ct;_t++)wt[_t]=at.charCodeAt(_t);return wt},ft=r.__addimage__.arrayBufferToBinaryString=function(at){for(var ct="",wt=gt(at)?at:new Uint8Array(at),_t=0;_t<wt.length;_t+=8192)ct+=String.fromCharCode.apply(null,wt.subarray(_t,_t+8192));return ct};r.addImage=function(){var at,ct,wt,_t,Jt,Yt,ee,$t,ne;if(typeof arguments[1]=="number"?(ct=t,wt=arguments[1],_t=arguments[2],Jt=arguments[3],Yt=arguments[4],ee=arguments[5],$t=arguments[6],ne=arguments[7]):(ct=arguments[1],wt=arguments[2],_t=arguments[3],Jt=arguments[4],Yt=arguments[5],ee=arguments[6],$t=arguments[7],ne=arguments[8]),Un(at=arguments[0])==="object"&&!b(at)&&"imageData"in at){var re=at;at=re.imageData,ct=re.format||ct||t,wt=re.x||wt||0,_t=re.y||_t||0,Jt=re.w||re.width||Jt,Yt=re.h||re.height||Yt,ee=re.alias||ee,$t=re.compression||$t,ne=re.rotation||re.angle||ne}var Be=this.internal.getFilters();if($t===void 0&&Be.indexOf("FlateEncode")!==-1&&($t="SLOW"),isNaN(wt)||isNaN(_t))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var it=Mt.call(this,at,ct,ee,$t);return R.call(this,wt,_t,Jt,Yt,it,ne),this};var Mt=function(at,ct,wt,_t){var Jt,Yt,ee;if(typeof at=="string"&&n(at)===t){at=unescape(at);var $t=Lt(at,!1);($t!==""||($t=r.loadFile(at,!0))!==void 0)&&(at=$t)}if(b(at)&&(at=x(at,ct)),ct=n(at,ct),!m(ct))throw new Error("addImage does not support files of type '"+ct+"', please ensure that a plugin for '"+ct+"' support is added.");if(((ee=wt)==null||ee.length===0)&&(wt=function(ne){return typeof ne=="string"||gt(ne)?G(ne):gt(ne.data)?G(ne.data):null}(at)),(Jt=B.call(this,wt))||(pt()&&(at instanceof Uint8Array||ct==="RGBA"||(Yt=at,at=mt(at))),Jt=this["process"+ct.toUpperCase()](at,f.call(this),wt,function(ne){return ne&&typeof ne=="string"&&(ne=ne.toUpperCase()),ne in r.image_compression?ne:z.NONE}(_t),Yt)),!Jt)throw new Error("An unknown error occurred whilst processing the image.");return Jt},Lt=r.__addimage__.convertBase64ToBinaryString=function(at,ct){var wt;ct=typeof ct!="boolean"||ct;var _t,Jt="";if(typeof at=="string"){_t=(wt=et(at))!==null?wt.data:at;try{Jt=zg(_t)}catch(Yt){if(ct)throw X(_t)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Yt.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Jt};r.getImageProperties=function(at){var ct,wt,_t="";if(b(at)&&(at=x(at)),typeof at=="string"&&n(at)===t&&((_t=Lt(at,!1))===""&&(_t=r.loadFile(at)||""),at=_t),wt=n(at),!m(wt))throw new Error("addImage does not support files of type '"+wt+"', please ensure that a plugin for '"+wt+"' support is added.");if(!pt()||at instanceof Uint8Array||(at=mt(at)),!(ct=this["process"+wt.toUpperCase()](at)))throw new Error("An unknown error occurred whilst processing the image");return ct.fileType=wt,ct}})(zr.API),function(r){var t=function(e){if(e!==void 0&&e!="")return!0};zr.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(e){for(var n,i,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,h=this.internal.getPageInfoByObjId(e.objId),f=e.pageContext.annotations,m=!1,b=0;b<f.length&&!m;b++)switch((n=f[b]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(m=!0);break;case"reference":case"text":case"freetext":m=!0}if(m!=0){this.internal.write("/Annots [");for(var x=0;x<f.length;x++){n=f[x];var B=this.internal.pdfEscape,P=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var R=this.internal.newAdditionalObject(),Q=this.internal.newAdditionalObject(),z=this.internal.getEncryptor(R.objId),G=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+B(z(n.contents))+")",s+=" /Popup "+Q.objId+" 0 R",s+=" /P "+h.objId+" 0 R",s+=" /T ("+B(z(G))+") >>",R.content=s;var X=R.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+a(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+X,n.open&&(s+=" /Open true"),s+=" >>",Q.content=s,this.internal.write(R.objId,"0 R",Q.objId,"0 R");break;case"freetext":i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var et=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+B(P(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+et+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var pt=this.annotations._nameMap[n.options.name];n.options.pageNumber=pt.page,n.options.top=pt.y}else n.options.top||(n.options.top=0);if(i="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+B(P(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var gt=o(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+gt+" "+n.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),r.createAnnotation=function(e){var n=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":n.pageContext.annotations.push(e)}},r.link=function(e,n,i,s,a){var o=this.internal.getCurrentPageInfo(),h=this.internal.getCoordinateString,f=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:h(e),y:f(n),w:h(e+i),h:f(n+s)},options:a,type:"link"})},r.textWithLink=function(e,n,i,s){var a,o,h=this.getTextWidth(e),f=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var m=this.splitTextToSize(e,o).length;a=Math.ceil(f*m)}else o=h,a=f;return this.text(e,n,i,s),i+=.2*f,s.align==="center"&&(n-=h/2),s.align==="right"&&(n-=h),this.link(n,i-f,o,a,s),h},r.getTextWidth=function(e){var n=this.internal.getFontSize();return this.getStringUnitWidth(e)*n/this.internal.scaleFactor}}(zr.API),function(r){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];r.__arabicParser__={};var s=r.__arabicParser__.isInArabicSubstitutionA=function(R){return t[R.charCodeAt(0)]!==void 0},a=r.__arabicParser__.isArabicLetter=function(R){return typeof R=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(R)},o=r.__arabicParser__.isArabicEndLetter=function(R){return a(R)&&s(R)&&t[R.charCodeAt(0)].length<=2},h=r.__arabicParser__.isArabicAlfLetter=function(R){return a(R)&&i.indexOf(R.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function(R){return a(R)&&s(R)&&t[R.charCodeAt(0)].length>=1};var f=r.__arabicParser__.arabicLetterHasFinalForm=function(R){return a(R)&&s(R)&&t[R.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function(R){return a(R)&&s(R)&&t[R.charCodeAt(0)].length>=3};var m=r.__arabicParser__.arabicLetterHasMedialForm=function(R){return a(R)&&s(R)&&t[R.charCodeAt(0)].length==4},b=r.__arabicParser__.resolveLigatures=function(R){var Q=0,z=e,G="",X=0;for(Q=0;Q<R.length;Q+=1)z[R.charCodeAt(Q)]!==void 0?(X++,typeof(z=z[R.charCodeAt(Q)])=="number"&&(G+=String.fromCharCode(z),z=e,X=0),Q===R.length-1&&(z=e,G+=R.charAt(Q-(X-1)),Q-=X-1,X=0)):(z=e,G+=R.charAt(Q-X),Q-=X,X=0);return G};r.__arabicParser__.isArabicDiacritic=function(R){return R!==void 0&&n[R.charCodeAt(0)]!==void 0};var x=r.__arabicParser__.getCorrectForm=function(R,Q,z){return a(R)?s(R)===!1?-1:!f(R)||!a(Q)&&!a(z)||!a(z)&&o(Q)||o(R)&&!a(Q)||o(R)&&h(Q)||o(R)&&o(Q)?0:m(R)&&a(Q)&&!o(Q)&&a(z)&&f(z)?3:o(R)||!a(z)?1:2:-1},B=function(R){var Q=0,z=0,G=0,X="",et="",pt="",gt=(R=R||"").split("\\s+"),mt=[];for(Q=0;Q<gt.length;Q+=1){for(mt.push(""),z=0;z<gt[Q].length;z+=1)X=gt[Q][z],et=gt[Q][z-1],pt=gt[Q][z+1],a(X)?(G=x(X,et,pt),mt[Q]+=G!==-1?String.fromCharCode(t[X.charCodeAt(0)][G]):X):mt[Q]+=X;mt[Q]=b(mt[Q])}return mt.join(" ")},P=r.__arabicParser__.processArabic=r.processArabic=function(){var R,Q=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,z=[];if(Array.isArray(Q)){var G=0;for(z=[],G=0;G<Q.length;G+=1)Array.isArray(Q[G])?z.push([B(Q[G][0]),Q[G][1],Q[G][2]]):z.push([B(Q[G])]);R=z}else R=B(Q);return typeof arguments[0]=="string"?R:(arguments[0].text=R,arguments[0])};r.events.push(["preProcessText",P])}(zr.API),zr.API.autoPrint=function(r){var t;switch((r=r||{}).variant=r.variant||"non-conform",r.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(r){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(o){e=o}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(o){n=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,n){var i;if((e=e||"2d")!=="2d")return null;for(i in n)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=n[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(zr.API),function(r){var t={left:0,top:0,bottom:0,right:0},e=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var h=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return h},set:function(R){h=R}});var f=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return f},set:function(R){f=R}});var m=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return m},set:function(R){m=R}});var b=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return b},set:function(R){b=R}});var x=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return x},set:function(R){x=R}});var B=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return B},set:function(R){B=R}});var P=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return P},set:function(R){P=R}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(h){return n.call(this),this.internal.__cell__.headerFunction=typeof h=="function"?h:void 0,this},r.getTextDimensions=function(h,f){n.call(this);var m=(f=f||{}).fontSize||this.getFontSize(),b=f.font||this.getFont(),x=f.scaleFactor||this.internal.scaleFactor,B=0,P=0,R=0,Q=this;if(!Array.isArray(h)&&typeof h!="string"){if(typeof h!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");h=String(h)}var z=f.maxWidth;z>0?typeof h=="string"?h=this.splitTextToSize(h,z):Object.prototype.toString.call(h)==="[object Array]"&&(h=h.reduce(function(X,et){return X.concat(Q.splitTextToSize(et,z))},[])):h=Array.isArray(h)?h:[h];for(var G=0;G<h.length;G++)B<(R=this.getStringUnitWidth(h[G],{font:b})*m)&&(B=R);return B!==0&&(P=h.length),{w:B/=x,h:Math.max((P*m*this.getLineHeightFactor()-m*(this.getLineHeightFactor()-1))/x,0)}},r.cellAddPage=function(){n.call(this),this.addPage();var h=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(h.left,h.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=r.cell=function(){var h;h=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var f=this.internal.__cell__.lastCell,m=this.internal.__cell__.padding,b=this.internal.__cell__.margins||t,x=this.internal.__cell__.tableHeaderRow,B=this.internal.__cell__.printHeaders;return f.lineNumber!==void 0&&(f.lineNumber===h.lineNumber?(h.x=(f.x||0)+(f.width||0),h.y=f.y||0):f.y+f.height+h.height+b.bottom>this.getPageHeight()?(this.cellAddPage(),h.y=b.top,B&&x&&(this.printHeaderRow(h.lineNumber,!0),h.y+=x[0].height)):h.y=f.y+f.height||h.y),h.text[0]!==void 0&&(this.rect(h.x,h.y,h.width,h.height,e===!0?"FD":void 0),h.align==="right"?this.text(h.text,h.x+h.width-m,h.y+m,{align:"right",baseline:"top"}):h.align==="center"?this.text(h.text,h.x+h.width/2,h.y+m,{align:"center",baseline:"top",maxWidth:h.width-m-m}):this.text(h.text,h.x+m,h.y+m,{align:"left",baseline:"top",maxWidth:h.width-m-m})),this.internal.__cell__.lastCell=h,this};r.table=function(h,f,m,b,x){if(n.call(this),!m)throw new Error("No data for PDF table.");var B,P,R,Q,z=[],G=[],X=[],et={},pt={},gt=[],mt=[],ft=(x=x||{}).autoSize||!1,Mt=x.printHeaders!==!1,Lt=x.css&&x.css["font-size"]!==void 0?16*x.css["font-size"]:x.fontSize||12,at=x.margins||Object.assign({width:this.getPageWidth()},t),ct=typeof x.padding=="number"?x.padding:3,wt=x.headerBackgroundColor||"#c8c8c8",_t=x.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=Mt,this.internal.__cell__.margins=at,this.internal.__cell__.table_font_size=Lt,this.internal.__cell__.padding=ct,this.internal.__cell__.headerBackgroundColor=wt,this.internal.__cell__.headerTextColor=_t,this.setFontSize(Lt),b==null)G=z=Object.keys(m[0]),X=z.map(function(){return"left"});else if(Array.isArray(b)&&Un(b[0])==="object")for(z=b.map(function(re){return re.name}),G=b.map(function(re){return re.prompt||re.name||""}),X=b.map(function(re){return re.align||"left"}),B=0;B<b.length;B+=1)pt[b[B].name]=b[B].width*(19.049976/25.4);else Array.isArray(b)&&typeof b[0]=="string"&&(G=z=b,X=z.map(function(){return"left"}));if(ft||Array.isArray(b)&&typeof b[0]=="string")for(B=0;B<z.length;B+=1){for(et[Q=z[B]]=m.map(function(re){return re[Q]}),this.setFont(void 0,"bold"),gt.push(this.getTextDimensions(G[B],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),P=et[Q],this.setFont(void 0,"normal"),R=0;R<P.length;R+=1)gt.push(this.getTextDimensions(P[R],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);pt[Q]=Math.max.apply(null,gt)+ct+ct,gt=[]}if(Mt){var Jt={};for(B=0;B<z.length;B+=1)Jt[z[B]]={},Jt[z[B]].text=G[B],Jt[z[B]].align=X[B];var Yt=o.call(this,Jt,pt);mt=z.map(function(re){return new s(h,f,pt[re],Yt,Jt[re].text,void 0,Jt[re].align)}),this.setTableHeaderRow(mt),this.printHeaderRow(1,!1)}var ee=b.reduce(function(re,Be){return re[Be.name]=Be.align,re},{});for(B=0;B<m.length;B+=1){"rowStart"in x&&x.rowStart instanceof Function&&x.rowStart({row:B,data:m[B]},this);var $t=o.call(this,m[B],pt);for(R=0;R<z.length;R+=1){var ne=m[B][z[R]];"cellStart"in x&&x.cellStart instanceof Function&&x.cellStart({row:B,col:R,data:ne},this),a.call(this,new s(h,f,pt[z[R]],$t,ne,B+2,ee[z[R]]))}}return this.internal.__cell__.table_x=h,this.internal.__cell__.table_y=f,this};var o=function(h,f){var m=this.internal.__cell__.padding,b=this.internal.__cell__.table_font_size,x=this.internal.scaleFactor;return Object.keys(h).map(function(B){var P=h[B];return this.splitTextToSize(P.hasOwnProperty("text")?P.text:P,f[B]-m-m)},this).map(function(B){return this.getLineHeightFactor()*B.length*b/x+m+m},this).reduce(function(B,P){return Math.max(B,P)},0)};r.setTableHeaderRow=function(h){n.call(this),this.internal.__cell__.tableHeaderRow=h},r.printHeaderRow=function(h,f){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var m;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var b=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(b[0],b[1],b[2],b[3],void 0,-1)}this.setFont(void 0,"bold");for(var x=[],B=0;B<this.internal.__cell__.tableHeaderRow.length;B+=1){m=this.internal.__cell__.tableHeaderRow[B].clone(),f&&(m.y=this.internal.__cell__.margins.top||0,x.push(m)),m.lineNumber=h;var P=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,m),this.setTextColor(P)}x.length>0&&this.setTableHeaderRow(x),this.setFont(void 0,"normal"),e=!1}}(zr.API);var cP={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},uP=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],j2=lP(uP),AP=[100,200,300,400,500,600,700,800,900],Frt=lP(AP);function q2(r){var t=r.family.replace(/"|'/g,"").toLowerCase(),e=function(s){return cP[s=s||"normal"]?s:"normal"}(r.style),n=function(s){if(!s)return 400;if(typeof s=="number")return s>=100&&s<=900&&s%100==0?s:400;if(/^\d00$/.test(s))return parseInt(s);switch(s){case"bold":return 700;case"normal":default:return 400}}(r.weight),i=function(s){return typeof j2[s=s||"normal"]=="number"?s:"normal"}(r.stretch);return{family:t,style:e,weight:n,stretch:i,src:r.src||[],ref:r.ref||{name:t,style:[i,e,n].join(" ")}}}function hP(r,t,e,n){var i;for(i=e;i>=0&&i<t.length;i+=n)if(r[t[i]])return r[t[i]];for(i=e;i>=0&&i<t.length;i-=n)if(r[t[i]])return r[t[i]]}var Lrt={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},dP={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function fP(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function Prt(r,t,e){for(var n=(e=e||{}).defaultFontFamily||"times",i=Object.assign({},Lrt,e.genericFontFamilies||{}),s=null,a=null,o=0;o<t.length;++o)if(i[(s=q2(t[o])).family]&&(s.family=i[s.family]),r.hasOwnProperty(s.family)){a=r[s.family];break}if(!(a=a||r[n]))throw new Error("Could not find a font-family for the rule '"+fP(s)+"' and default family '"+n+"'.");if(a=function(h,f){if(f[h])return f[h];var m=j2[h],b=m<=j2.normal?-1:1,x=hP(f,uP,m,b);if(!x)throw new Error("Could not find a matching font-stretch value for "+h);return x}(s.stretch,a),a=function(h,f){if(f[h])return f[h];for(var m=cP[h],b=0;b<m.length;++b)if(f[m[b]])return f[m[b]];throw new Error("Could not find a matching font-style for "+h)}(s.style,a),!(a=function(h,f){if(f[h])return f[h];if(h===400&&f[500])return f[500];if(h===500&&f[400])return f[400];var m=Frt[h],b=hP(f,AP,m,h<400?-1:1);if(!b)throw new Error("Could not find a matching font-weight for value "+h);return b}(s.weight,a)))throw new Error("Failed to resolve a font for the rule '"+fP(s)+"'.");return a}function pP(r){return r.trimLeft()}function Mrt(r,t){for(var e=0;e<r.length;){if(r.charAt(e)===t)return[r.substring(0,e),r.substring(e+1)];e+=1}return null}function Urt(r){var t=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],r.substring(t[0].length)]}var Dy,gP,mP,yP=["times"];(function(r){var t,e,n,i,s,a,o,h,f,m=function(it){return it=it||{},this.isStrokeTransparent=it.isStrokeTransparent||!1,this.strokeOpacity=it.strokeOpacity||1,this.strokeStyle=it.strokeStyle||"#000000",this.fillStyle=it.fillStyle||"#000000",this.isFillTransparent=it.isFillTransparent||!1,this.fillOpacity=it.fillOpacity||1,this.font=it.font||"10px sans-serif",this.textBaseline=it.textBaseline||"alphabetic",this.textAlign=it.textAlign||"left",this.lineWidth=it.lineWidth||1,this.lineJoin=it.lineJoin||"miter",this.lineCap=it.lineCap||"butt",this.path=it.path||[],this.transform=it.transform!==void 0?it.transform.clone():new h,this.globalCompositeOperation=it.globalCompositeOperation||"normal",this.globalAlpha=it.globalAlpha||1,this.clip_path=it.clip_path||[],this.currentPoint=it.currentPoint||new a,this.miterLimit=it.miterLimit||10,this.lastPoint=it.lastPoint||new a,this.lineDashOffset=it.lineDashOffset||0,this.lineDash=it.lineDash||[],this.margin=it.margin||[0,0,0,0],this.prevPageLastElemOffset=it.prevPageLastElemOffset||0,this.ignoreClearRect=typeof it.ignoreClearRect!="boolean"||it.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new b(this),t=this.internal.f2,e=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,h=this.internal.Matrix,f=new m}]);var b=function(it){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var bt=it;Object.defineProperty(this,"pdf",{get:function(){return bt}});var Pt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Pt},set:function(fe){Pt=!!fe}});var Ot=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Ot},set:function(fe){Ot=!!fe}});var qt=0;Object.defineProperty(this,"posX",{get:function(){return qt},set:function(fe){isNaN(fe)||(qt=fe)}});var Gt=0;Object.defineProperty(this,"posY",{get:function(){return Gt},set:function(fe){isNaN(fe)||(Gt=fe)}}),Object.defineProperty(this,"margin",{get:function(){return f.margin},set:function(fe){var lt;typeof fe=="number"?lt=[fe,fe,fe,fe]:((lt=new Array(4))[0]=fe[0],lt[1]=fe.length>=2?fe[1]:lt[0],lt[2]=fe.length>=3?fe[2]:lt[0],lt[3]=fe.length>=4?fe[3]:lt[1]),f.margin=lt}});var oe=!1;Object.defineProperty(this,"autoPaging",{get:function(){return oe},set:function(fe){oe=fe}});var ie=0;Object.defineProperty(this,"lastBreak",{get:function(){return ie},set:function(fe){ie=fe}});var Ce=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Ce},set:function(fe){Ce=fe}}),Object.defineProperty(this,"ctx",{get:function(){return f},set:function(fe){fe instanceof m&&(f=fe)}}),Object.defineProperty(this,"path",{get:function(){return f.path},set:function(fe){f.path=fe}});var Fe=[];Object.defineProperty(this,"ctxStack",{get:function(){return Fe},set:function(fe){Fe=fe}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(fe){var lt;lt=x(fe),this.ctx.fillStyle=lt.style,this.ctx.isFillTransparent=lt.a===0,this.ctx.fillOpacity=lt.a,this.pdf.setFillColor(lt.r,lt.g,lt.b,{a:lt.a}),this.pdf.setTextColor(lt.r,lt.g,lt.b,{a:lt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(fe){var lt=x(fe);this.ctx.strokeStyle=lt.style,this.ctx.isStrokeTransparent=lt.a===0,this.ctx.strokeOpacity=lt.a,lt.a===0?this.pdf.setDrawColor(255,255,255):(lt.a,this.pdf.setDrawColor(lt.r,lt.g,lt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(fe){["butt","round","square"].indexOf(fe)!==-1&&(this.ctx.lineCap=fe,this.pdf.setLineCap(fe))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(fe){isNaN(fe)||(this.ctx.lineWidth=fe,this.pdf.setLineWidth(fe))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(fe){["bevel","round","miter"].indexOf(fe)!==-1&&(this.ctx.lineJoin=fe,this.pdf.setLineJoin(fe))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(fe){isNaN(fe)||(this.ctx.miterLimit=fe,this.pdf.setMiterLimit(fe))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(fe){this.ctx.textBaseline=fe}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(fe){["right","end","center","left","start"].indexOf(fe)!==-1&&(this.ctx.textAlign=fe)}});var Re=null;function Ne(fe,lt){if(Re===null){var pr=function(er){var pe=[];return Object.keys(er).forEach(function(we){er[we].forEach(function(Ie){var Oe=null;switch(Ie){case"bold":Oe={family:we,weight:"bold"};break;case"italic":Oe={family:we,style:"italic"};break;case"bolditalic":Oe={family:we,weight:"bold",style:"italic"};break;case"":case"normal":Oe={family:we}}Oe!==null&&(Oe.ref={name:we,style:Ie},pe.push(Oe))})}),pe}(fe.getFontList());Re=function(er){for(var pe={},we=0;we<er.length;++we){var Ie=q2(er[we]),Oe=Ie.family,nr=Ie.stretch,hr=Ie.style,Sr=Ie.weight;pe[Oe]=pe[Oe]||{},pe[Oe][nr]=pe[Oe][nr]||{},pe[Oe][nr][hr]=pe[Oe][nr][hr]||{},pe[Oe][nr][hr][Sr]=Ie}return pe}(pr.concat(lt))}return Re}var ke=null;Object.defineProperty(this,"fontFaces",{get:function(){return ke},set:function(fe){Re=null,ke=fe}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(fe){var lt;if(this.ctx.font=fe,(lt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(fe))!==null){var pr=lt[1],er=(lt[2],lt[3]),pe=lt[4],we=(lt[5],lt[6]),Ie=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(pe)[2];pe=Math.floor(Ie==="px"?parseFloat(pe)*this.pdf.internal.scaleFactor:Ie==="em"?parseFloat(pe)*this.pdf.getFontSize():parseFloat(pe)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(pe);var Oe=function(or){var xr,De,pn=[],ge=or.trim();if(ge==="")return yP;if(ge in dP)return[dP[ge]];for(;ge!=="";){switch(De=null,xr=(ge=pP(ge)).charAt(0)){case'"':case"'":De=Mrt(ge.substring(1),xr);break;default:De=Urt(ge)}if(De===null||(pn.push(De[0]),(ge=pP(De[1]))!==""&&ge.charAt(0)!==","))return yP;ge=ge.replace(/^,/,"")}return pn}(we);if(this.fontFaces){var nr=Prt(Ne(this.pdf,this.fontFaces),Oe.map(function(or){return{family:or,stretch:"normal",weight:er,style:pr}}));this.pdf.setFont(nr.ref.name,nr.ref.style)}else{var hr="";(er==="bold"||parseInt(er,10)>=700||pr==="bold")&&(hr="bold"),pr==="italic"&&(hr+="italic"),hr.length===0&&(hr="normal");for(var Sr="",Mr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},kr=0;kr<Oe.length;kr++){if(this.pdf.internal.getFont(Oe[kr],hr,{noFallback:!0,disableWarning:!0})!==void 0){Sr=Oe[kr];break}if(hr==="bolditalic"&&this.pdf.internal.getFont(Oe[kr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Sr=Oe[kr],hr="bold";else if(this.pdf.internal.getFont(Oe[kr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Sr=Oe[kr],hr="normal";break}}if(Sr===""){for(var ye=0;ye<Oe.length;ye++)if(Mr[Oe[ye]]){Sr=Mr[Oe[ye]];break}}Sr=Sr===""?"Times":Sr,this.pdf.setFont(Sr,hr)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(fe){this.ctx.globalCompositeOperation=fe}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(fe){this.ctx.globalAlpha=fe}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(fe){this.ctx.lineDashOffset=fe,Be.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(fe){this.ctx.lineDash=fe,Be.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(fe){this.ctx.ignoreClearRect=!!fe}})};b.prototype.setLineDash=function(it){this.lineDash=it},b.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},b.prototype.fill=function(){et.call(this,"fill",!1)},b.prototype.stroke=function(){et.call(this,"stroke",!1)},b.prototype.beginPath=function(){this.path=[{type:"begin"}]},b.prototype.moveTo=function(it,bt){if(isNaN(it)||isNaN(bt))throw Ai.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Pt=this.ctx.transform.applyToPoint(new a(it,bt));this.path.push({type:"mt",x:Pt.x,y:Pt.y}),this.ctx.lastPoint=new a(it,bt)},b.prototype.closePath=function(){var it=new a(0,0),bt=0;for(bt=this.path.length-1;bt!==-1;bt--)if(this.path[bt].type==="begin"&&Un(this.path[bt+1])==="object"&&typeof this.path[bt+1].x=="number"){it=new a(this.path[bt+1].x,this.path[bt+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(it.x,it.y)},b.prototype.lineTo=function(it,bt){if(isNaN(it)||isNaN(bt))throw Ai.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Pt=this.ctx.transform.applyToPoint(new a(it,bt));this.path.push({type:"lt",x:Pt.x,y:Pt.y}),this.ctx.lastPoint=new a(Pt.x,Pt.y)},b.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),et.call(this,null,!0)},b.prototype.quadraticCurveTo=function(it,bt,Pt,Ot){if(isNaN(Pt)||isNaN(Ot)||isNaN(it)||isNaN(bt))throw Ai.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var qt=this.ctx.transform.applyToPoint(new a(Pt,Ot)),Gt=this.ctx.transform.applyToPoint(new a(it,bt));this.path.push({type:"qct",x1:Gt.x,y1:Gt.y,x:qt.x,y:qt.y}),this.ctx.lastPoint=new a(qt.x,qt.y)},b.prototype.bezierCurveTo=function(it,bt,Pt,Ot,qt,Gt){if(isNaN(qt)||isNaN(Gt)||isNaN(it)||isNaN(bt)||isNaN(Pt)||isNaN(Ot))throw Ai.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var oe=this.ctx.transform.applyToPoint(new a(qt,Gt)),ie=this.ctx.transform.applyToPoint(new a(it,bt)),Ce=this.ctx.transform.applyToPoint(new a(Pt,Ot));this.path.push({type:"bct",x1:ie.x,y1:ie.y,x2:Ce.x,y2:Ce.y,x:oe.x,y:oe.y}),this.ctx.lastPoint=new a(oe.x,oe.y)},b.prototype.arc=function(it,bt,Pt,Ot,qt,Gt){if(isNaN(it)||isNaN(bt)||isNaN(Pt)||isNaN(Ot)||isNaN(qt))throw Ai.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Gt=!!Gt,!this.ctx.transform.isIdentity){var oe=this.ctx.transform.applyToPoint(new a(it,bt));it=oe.x,bt=oe.y;var ie=this.ctx.transform.applyToPoint(new a(0,Pt)),Ce=this.ctx.transform.applyToPoint(new a(0,0));Pt=Math.sqrt(Math.pow(ie.x-Ce.x,2)+Math.pow(ie.y-Ce.y,2))}Math.abs(qt-Ot)>=2*Math.PI&&(Ot=0,qt=2*Math.PI),this.path.push({type:"arc",x:it,y:bt,radius:Pt,startAngle:Ot,endAngle:qt,counterclockwise:Gt})},b.prototype.arcTo=function(it,bt,Pt,Ot,qt){throw new Error("arcTo not implemented.")},b.prototype.rect=function(it,bt,Pt,Ot){if(isNaN(it)||isNaN(bt)||isNaN(Pt)||isNaN(Ot))throw Ai.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(it,bt),this.lineTo(it+Pt,bt),this.lineTo(it+Pt,bt+Ot),this.lineTo(it,bt+Ot),this.lineTo(it,bt),this.lineTo(it+Pt,bt),this.lineTo(it,bt)},b.prototype.fillRect=function(it,bt,Pt,Ot){if(isNaN(it)||isNaN(bt)||isNaN(Pt)||isNaN(Ot))throw Ai.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!B.call(this)){var qt={};this.lineCap!=="butt"&&(qt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(qt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(it,bt,Pt,Ot),this.fill(),qt.hasOwnProperty("lineCap")&&(this.lineCap=qt.lineCap),qt.hasOwnProperty("lineJoin")&&(this.lineJoin=qt.lineJoin)}},b.prototype.strokeRect=function(it,bt,Pt,Ot){if(isNaN(it)||isNaN(bt)||isNaN(Pt)||isNaN(Ot))throw Ai.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");P.call(this)||(this.beginPath(),this.rect(it,bt,Pt,Ot),this.stroke())},b.prototype.clearRect=function(it,bt,Pt,Ot){if(isNaN(it)||isNaN(bt)||isNaN(Pt)||isNaN(Ot))throw Ai.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(it,bt,Pt,Ot))},b.prototype.save=function(it){it=typeof it!="boolean"||it;for(var bt=this.pdf.internal.getCurrentPageInfo().pageNumber,Pt=0;Pt<this.pdf.internal.getNumberOfPages();Pt++)this.pdf.setPage(Pt+1),this.pdf.internal.out("q");if(this.pdf.setPage(bt),it){this.ctx.fontSize=this.pdf.internal.getFontSize();var Ot=new m(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Ot}},b.prototype.restore=function(it){it=typeof it!="boolean"||it;for(var bt=this.pdf.internal.getCurrentPageInfo().pageNumber,Pt=0;Pt<this.pdf.internal.getNumberOfPages();Pt++)this.pdf.setPage(Pt+1),this.pdf.internal.out("Q");this.pdf.setPage(bt),it&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},b.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var x=function(it){var bt,Pt,Ot,qt;if(it.isCanvasGradient===!0&&(it=it.getColor()),!it)return{r:0,g:0,b:0,a:0,style:it};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(it))bt=0,Pt=0,Ot=0,qt=0;else{var Gt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(it);if(Gt!==null)bt=parseInt(Gt[1]),Pt=parseInt(Gt[2]),Ot=parseInt(Gt[3]),qt=1;else if((Gt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(it))!==null)bt=parseInt(Gt[1]),Pt=parseInt(Gt[2]),Ot=parseInt(Gt[3]),qt=parseFloat(Gt[4]);else{if(qt=1,typeof it=="string"&&it.charAt(0)!=="#"){var oe=new YL(it);it=oe.ok?oe.toHex():"#000000"}it.length===4?(bt=it.substring(1,2),bt+=bt,Pt=it.substring(2,3),Pt+=Pt,Ot=it.substring(3,4),Ot+=Ot):(bt=it.substring(1,3),Pt=it.substring(3,5),Ot=it.substring(5,7)),bt=parseInt(bt,16),Pt=parseInt(Pt,16),Ot=parseInt(Ot,16)}}return{r:bt,g:Pt,b:Ot,a:qt,style:it}},B=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},P=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};b.prototype.fillText=function(it,bt,Pt,Ot){if(isNaN(bt)||isNaN(Pt)||typeof it!="string")throw Ai.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Ot=isNaN(Ot)?void 0:Ot,!B.call(this)){var qt=$t(this.ctx.transform.rotation),Gt=this.ctx.transform.scaleX;ct.call(this,{text:it,x:bt,y:Pt,scale:Gt,angle:qt,align:this.textAlign,maxWidth:Ot})}},b.prototype.strokeText=function(it,bt,Pt,Ot){if(isNaN(bt)||isNaN(Pt)||typeof it!="string")throw Ai.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!P.call(this)){Ot=isNaN(Ot)?void 0:Ot;var qt=$t(this.ctx.transform.rotation),Gt=this.ctx.transform.scaleX;ct.call(this,{text:it,x:bt,y:Pt,scale:Gt,renderingMode:"stroke",angle:qt,align:this.textAlign,maxWidth:Ot})}},b.prototype.measureText=function(it){if(typeof it!="string")throw Ai.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var bt=this.pdf,Pt=this.pdf.internal.scaleFactor,Ot=bt.internal.getFontSize(),qt=bt.getStringUnitWidth(it)*Ot/bt.internal.scaleFactor,Gt=function(oe){var ie=(oe=oe||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ie}}),this};return new Gt({width:qt*=Math.round(96*Pt/72*1e4)/1e4})},b.prototype.scale=function(it,bt){if(isNaN(it)||isNaN(bt))throw Ai.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Pt=new h(it,0,0,bt,0,0);this.ctx.transform=this.ctx.transform.multiply(Pt)},b.prototype.rotate=function(it){if(isNaN(it))throw Ai.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var bt=new h(Math.cos(it),Math.sin(it),-Math.sin(it),Math.cos(it),0,0);this.ctx.transform=this.ctx.transform.multiply(bt)},b.prototype.translate=function(it,bt){if(isNaN(it)||isNaN(bt))throw Ai.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Pt=new h(1,0,0,1,it,bt);this.ctx.transform=this.ctx.transform.multiply(Pt)},b.prototype.transform=function(it,bt,Pt,Ot,qt,Gt){if(isNaN(it)||isNaN(bt)||isNaN(Pt)||isNaN(Ot)||isNaN(qt)||isNaN(Gt))throw Ai.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var oe=new h(it,bt,Pt,Ot,qt,Gt);this.ctx.transform=this.ctx.transform.multiply(oe)},b.prototype.setTransform=function(it,bt,Pt,Ot,qt,Gt){it=isNaN(it)?1:it,bt=isNaN(bt)?0:bt,Pt=isNaN(Pt)?0:Pt,Ot=isNaN(Ot)?1:Ot,qt=isNaN(qt)?0:qt,Gt=isNaN(Gt)?0:Gt,this.ctx.transform=new h(it,bt,Pt,Ot,qt,Gt)};var R=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};b.prototype.drawImage=function(it,bt,Pt,Ot,qt,Gt,oe,ie,Ce){var Fe=this.pdf.getImageProperties(it),Re=1,Ne=1,ke=1,fe=1;Ot!==void 0&&ie!==void 0&&(ke=ie/Ot,fe=Ce/qt,Re=Fe.width/Ot*ie/Ot,Ne=Fe.height/qt*Ce/qt),Gt===void 0&&(Gt=bt,oe=Pt,bt=0,Pt=0),Ot!==void 0&&ie===void 0&&(ie=Ot,Ce=qt),Ot===void 0&&ie===void 0&&(ie=Fe.width,Ce=Fe.height);for(var lt,pr=this.ctx.transform.decompose(),er=$t(pr.rotate.shx),pe=new h,we=(pe=(pe=(pe=pe.multiply(pr.translate)).multiply(pr.skew)).multiply(pr.scale)).applyToRectangle(new o(Gt-bt*ke,oe-Pt*fe,Ot*Re,qt*Ne)),Ie=Q.call(this,we),Oe=[],nr=0;nr<Ie.length;nr+=1)Oe.indexOf(Ie[nr])===-1&&Oe.push(Ie[nr]);if(X(Oe),this.autoPaging)for(var hr=Oe[0],Sr=Oe[Oe.length-1],Mr=hr;Mr<Sr+1;Mr++){this.pdf.setPage(Mr);var kr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ye=Mr===1?this.posY+this.margin[0]:this.margin[0],or=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],xr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],De=Mr===1?0:or+(Mr-2)*xr;if(this.ctx.clip_path.length!==0){var pn=this.path;lt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=G(lt,this.posX+this.margin[3],-De+ye+this.ctx.prevPageLastElemOffset),pt.call(this,"fill",!0),this.path=pn}var ge=JSON.parse(JSON.stringify(we));ge=G([ge],this.posX+this.margin[3],-De+ye+this.ctx.prevPageLastElemOffset)[0];var yr=(Mr>hr||Mr<Sr)&&R.call(this);yr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],kr,xr,null).clip().discardPath()),this.pdf.addImage(it,"JPEG",ge.x,ge.y,ge.w,ge.h,null,null,er),yr&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(it,"JPEG",we.x,we.y,we.w,we.h,null,null,er)};var Q=function(it,bt,Pt){var Ot=[];bt=bt||this.pdf.internal.pageSize.width,Pt=Pt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var qt=this.posY+this.ctx.prevPageLastElemOffset;switch(it.type){default:case"mt":case"lt":Ot.push(Math.floor((it.y+qt)/Pt)+1);break;case"arc":Ot.push(Math.floor((it.y+qt-it.radius)/Pt)+1),Ot.push(Math.floor((it.y+qt+it.radius)/Pt)+1);break;case"qct":var Gt=ne(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x,it.y);Ot.push(Math.floor((Gt.y+qt)/Pt)+1),Ot.push(Math.floor((Gt.y+Gt.h+qt)/Pt)+1);break;case"bct":var oe=re(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x2,it.y2,it.x,it.y);Ot.push(Math.floor((oe.y+qt)/Pt)+1),Ot.push(Math.floor((oe.y+oe.h+qt)/Pt)+1);break;case"rect":Ot.push(Math.floor((it.y+qt)/Pt)+1),Ot.push(Math.floor((it.y+it.h+qt)/Pt)+1)}for(var ie=0;ie<Ot.length;ie+=1)for(;this.pdf.internal.getNumberOfPages()<Ot[ie];)z.call(this);return Ot},z=function(){var it=this.fillStyle,bt=this.strokeStyle,Pt=this.font,Ot=this.lineCap,qt=this.lineWidth,Gt=this.lineJoin;this.pdf.addPage(),this.fillStyle=it,this.strokeStyle=bt,this.font=Pt,this.lineCap=Ot,this.lineWidth=qt,this.lineJoin=Gt},G=function(it,bt,Pt){for(var Ot=0;Ot<it.length;Ot++)switch(it[Ot].type){case"bct":it[Ot].x2+=bt,it[Ot].y2+=Pt;case"qct":it[Ot].x1+=bt,it[Ot].y1+=Pt;case"mt":case"lt":case"arc":default:it[Ot].x+=bt,it[Ot].y+=Pt}return it},X=function(it){return it.sort(function(bt,Pt){return bt-Pt})},et=function(it,bt){for(var Pt,Ot,qt=this.fillStyle,Gt=this.strokeStyle,oe=this.lineCap,ie=this.lineWidth,Ce=Math.abs(ie*this.ctx.transform.scaleX),Fe=this.lineJoin,Re=JSON.parse(JSON.stringify(this.path)),Ne=JSON.parse(JSON.stringify(this.path)),ke=[],fe=0;fe<Ne.length;fe++)if(Ne[fe].x!==void 0)for(var lt=Q.call(this,Ne[fe]),pr=0;pr<lt.length;pr+=1)ke.indexOf(lt[pr])===-1&&ke.push(lt[pr]);for(var er=0;er<ke.length;er++)for(;this.pdf.internal.getNumberOfPages()<ke[er];)z.call(this);if(X(ke),this.autoPaging)for(var pe=ke[0],we=ke[ke.length-1],Ie=pe;Ie<we+1;Ie++){this.pdf.setPage(Ie),this.fillStyle=qt,this.strokeStyle=Gt,this.lineCap=oe,this.lineWidth=Ce,this.lineJoin=Fe;var Oe=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],nr=Ie===1?this.posY+this.margin[0]:this.margin[0],hr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Sr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Mr=Ie===1?0:hr+(Ie-2)*Sr;if(this.ctx.clip_path.length!==0){var kr=this.path;Pt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=G(Pt,this.posX+this.margin[3],-Mr+nr+this.ctx.prevPageLastElemOffset),pt.call(this,it,!0),this.path=kr}if(Ot=JSON.parse(JSON.stringify(Re)),this.path=G(Ot,this.posX+this.margin[3],-Mr+nr+this.ctx.prevPageLastElemOffset),bt===!1||Ie===0){var ye=(Ie>pe||Ie<we)&&R.call(this);ye&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Oe,Sr,null).clip().discardPath()),pt.call(this,it,bt),ye&&this.pdf.restoreGraphicsState()}this.lineWidth=ie}else this.lineWidth=Ce,pt.call(this,it,bt),this.lineWidth=ie;this.path=Re},pt=function(it,bt){if((it!=="stroke"||bt||!P.call(this))&&(it==="stroke"||bt||!B.call(this))){for(var Pt,Ot,qt=[],Gt=this.path,oe=0;oe<Gt.length;oe++){var ie=Gt[oe];switch(ie.type){case"begin":qt.push({begin:!0});break;case"close":qt.push({close:!0});break;case"mt":qt.push({start:ie,deltas:[],abs:[]});break;case"lt":var Ce=qt.length;if(Gt[oe-1]&&!isNaN(Gt[oe-1].x)&&(Pt=[ie.x-Gt[oe-1].x,ie.y-Gt[oe-1].y],Ce>0)){for(;Ce>=0;Ce--)if(qt[Ce-1].close!==!0&&qt[Ce-1].begin!==!0){qt[Ce-1].deltas.push(Pt),qt[Ce-1].abs.push(ie);break}}break;case"bct":Pt=[ie.x1-Gt[oe-1].x,ie.y1-Gt[oe-1].y,ie.x2-Gt[oe-1].x,ie.y2-Gt[oe-1].y,ie.x-Gt[oe-1].x,ie.y-Gt[oe-1].y],qt[qt.length-1].deltas.push(Pt);break;case"qct":var Fe=Gt[oe-1].x+2/3*(ie.x1-Gt[oe-1].x),Re=Gt[oe-1].y+2/3*(ie.y1-Gt[oe-1].y),Ne=ie.x+2/3*(ie.x1-ie.x),ke=ie.y+2/3*(ie.y1-ie.y),fe=ie.x,lt=ie.y;Pt=[Fe-Gt[oe-1].x,Re-Gt[oe-1].y,Ne-Gt[oe-1].x,ke-Gt[oe-1].y,fe-Gt[oe-1].x,lt-Gt[oe-1].y],qt[qt.length-1].deltas.push(Pt);break;case"arc":qt.push({deltas:[],abs:[],arc:!0}),Array.isArray(qt[qt.length-1].abs)&&qt[qt.length-1].abs.push(ie)}}Ot=bt?null:it==="stroke"?"stroke":"fill";for(var pr=!1,er=0;er<qt.length;er++)if(qt[er].arc)for(var pe=qt[er].abs,we=0;we<pe.length;we++){var Ie=pe[we];Ie.type==="arc"?ft.call(this,Ie.x,Ie.y,Ie.radius,Ie.startAngle,Ie.endAngle,Ie.counterclockwise,void 0,bt,!pr):wt.call(this,Ie.x,Ie.y),pr=!0}else if(qt[er].close===!0)this.pdf.internal.out("h"),pr=!1;else if(qt[er].begin!==!0){var Oe=qt[er].start.x,nr=qt[er].start.y;_t.call(this,qt[er].deltas,Oe,nr),pr=!0}Ot&&Mt.call(this,Ot),bt&&Lt.call(this)}},gt=function(it){var bt=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Pt=bt*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return it-Pt;case"top":return it+bt-Pt;case"hanging":return it+bt-2*Pt;case"middle":return it+bt/2-Pt;case"ideographic":return it;case"alphabetic":default:return it}},mt=function(it){return it+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};b.prototype.createLinearGradient=function(){var it=function(){};return it.colorStops=[],it.addColorStop=function(bt,Pt){this.colorStops.push([bt,Pt])},it.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},it.isCanvasGradient=!0,it},b.prototype.createPattern=function(){return this.createLinearGradient()},b.prototype.createRadialGradient=function(){return this.createLinearGradient()};var ft=function(it,bt,Pt,Ot,qt,Gt,oe,ie,Ce){for(var Fe=Yt.call(this,Pt,Ot,qt,Gt),Re=0;Re<Fe.length;Re++){var Ne=Fe[Re];Re===0&&(Ce?at.call(this,Ne.x1+it,Ne.y1+bt):wt.call(this,Ne.x1+it,Ne.y1+bt)),Jt.call(this,it,bt,Ne.x2,Ne.y2,Ne.x3,Ne.y3,Ne.x4,Ne.y4)}ie?Lt.call(this):Mt.call(this,oe)},Mt=function(it){switch(it){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Lt=function(){this.pdf.clip(),this.pdf.discardPath()},at=function(it,bt){this.pdf.internal.out(e(it)+" "+n(bt)+" m")},ct=function(it){var bt;switch(it.align){case"right":case"end":bt="right";break;case"center":bt="center";break;case"left":case"start":default:bt="left"}var Pt=this.pdf.getTextDimensions(it.text),Ot=gt.call(this,it.y),qt=mt.call(this,Ot)-Pt.h,Gt=this.ctx.transform.applyToPoint(new a(it.x,Ot)),oe=this.ctx.transform.decompose(),ie=new h;ie=(ie=(ie=ie.multiply(oe.translate)).multiply(oe.skew)).multiply(oe.scale);for(var Ce,Fe,Re,Ne=this.ctx.transform.applyToRectangle(new o(it.x,Ot,Pt.w,Pt.h)),ke=ie.applyToRectangle(new o(it.x,qt,Pt.w,Pt.h)),fe=Q.call(this,ke),lt=[],pr=0;pr<fe.length;pr+=1)lt.indexOf(fe[pr])===-1&&lt.push(fe[pr]);if(X(lt),this.autoPaging)for(var er=lt[0],pe=lt[lt.length-1],we=er;we<pe+1;we++){this.pdf.setPage(we);var Ie=we===1?this.posY+this.margin[0]:this.margin[0],Oe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],nr=this.pdf.internal.pageSize.height-this.margin[2],hr=nr-this.margin[0],Sr=this.pdf.internal.pageSize.width-this.margin[1],Mr=Sr-this.margin[3],kr=we===1?0:Oe+(we-2)*hr;if(this.ctx.clip_path.length!==0){var ye=this.path;Ce=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=G(Ce,this.posX+this.margin[3],-1*kr+Ie),pt.call(this,"fill",!0),this.path=ye}var or=G([JSON.parse(JSON.stringify(ke))],this.posX+this.margin[3],-kr+Ie+this.ctx.prevPageLastElemOffset)[0];it.scale>=.01&&(Fe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Fe*it.scale),Re=this.lineWidth,this.lineWidth=Re*it.scale);var xr=this.autoPaging!=="text";if(xr||or.y+or.h<=nr){if(xr||or.y>=Ie&&or.x<=Sr){var De=xr?it.text:this.pdf.splitTextToSize(it.text,it.maxWidth||Sr-or.x)[0],pn=G([JSON.parse(JSON.stringify(Ne))],this.posX+this.margin[3],-kr+Ie+this.ctx.prevPageLastElemOffset)[0],ge=xr&&(we>er||we<pe)&&R.call(this);ge&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Mr,hr,null).clip().discardPath()),this.pdf.text(De,pn.x,pn.y,{angle:it.angle,align:bt,renderingMode:it.renderingMode}),ge&&this.pdf.restoreGraphicsState()}}else or.y<nr&&(this.ctx.prevPageLastElemOffset+=nr-or.y);it.scale>=.01&&(this.pdf.setFontSize(Fe),this.lineWidth=Re)}else it.scale>=.01&&(Fe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Fe*it.scale),Re=this.lineWidth,this.lineWidth=Re*it.scale),this.pdf.text(it.text,Gt.x+this.posX,Gt.y+this.posY,{angle:it.angle,align:bt,renderingMode:it.renderingMode,maxWidth:it.maxWidth}),it.scale>=.01&&(this.pdf.setFontSize(Fe),this.lineWidth=Re)},wt=function(it,bt,Pt,Ot){Pt=Pt||0,Ot=Ot||0,this.pdf.internal.out(e(it+Pt)+" "+n(bt+Ot)+" l")},_t=function(it,bt,Pt){return this.pdf.lines(it,bt,Pt,null,null)},Jt=function(it,bt,Pt,Ot,qt,Gt,oe,ie){this.pdf.internal.out([t(i(Pt+it)),t(s(Ot+bt)),t(i(qt+it)),t(s(Gt+bt)),t(i(oe+it)),t(s(ie+bt)),"c"].join(" "))},Yt=function(it,bt,Pt,Ot){for(var qt=2*Math.PI,Gt=Math.PI/2;bt>Pt;)bt-=qt;var oe=Math.abs(Pt-bt);oe<qt&&Ot&&(oe=qt-oe);for(var ie=[],Ce=Ot?-1:1,Fe=bt;oe>1e-5;){var Re=Fe+Ce*Math.min(oe,Gt);ie.push(ee.call(this,it,Fe,Re)),oe-=Math.abs(Re-Fe),Fe=Re}return ie},ee=function(it,bt,Pt){var Ot=(Pt-bt)/2,qt=it*Math.cos(Ot),Gt=it*Math.sin(Ot),oe=qt,ie=-Gt,Ce=oe*oe+ie*ie,Fe=Ce+oe*qt+ie*Gt,Re=4/3*(Math.sqrt(2*Ce*Fe)-Fe)/(oe*Gt-ie*qt),Ne=oe-Re*ie,ke=ie+Re*oe,fe=Ne,lt=-ke,pr=Ot+bt,er=Math.cos(pr),pe=Math.sin(pr);return{x1:it*Math.cos(bt),y1:it*Math.sin(bt),x2:Ne*er-ke*pe,y2:Ne*pe+ke*er,x3:fe*er-lt*pe,y3:fe*pe+lt*er,x4:it*Math.cos(Pt),y4:it*Math.sin(Pt)}},$t=function(it){return 180*it/Math.PI},ne=function(it,bt,Pt,Ot,qt,Gt){var oe=it+.5*(Pt-it),ie=bt+.5*(Ot-bt),Ce=qt+.5*(Pt-qt),Fe=Gt+.5*(Ot-Gt),Re=Math.min(it,qt,oe,Ce),Ne=Math.max(it,qt,oe,Ce),ke=Math.min(bt,Gt,ie,Fe),fe=Math.max(bt,Gt,ie,Fe);return new o(Re,ke,Ne-Re,fe-ke)},re=function(it,bt,Pt,Ot,qt,Gt,oe,ie){var Ce,Fe,Re,Ne,ke,fe,lt,pr,er,pe,we,Ie,Oe,nr,hr=Pt-it,Sr=Ot-bt,Mr=qt-Pt,kr=Gt-Ot,ye=oe-qt,or=ie-Gt;for(Fe=0;Fe<41;Fe++)er=(lt=(Re=it+(Ce=Fe/40)*hr)+Ce*((ke=Pt+Ce*Mr)-Re))+Ce*(ke+Ce*(qt+Ce*ye-ke)-lt),pe=(pr=(Ne=bt+Ce*Sr)+Ce*((fe=Ot+Ce*kr)-Ne))+Ce*(fe+Ce*(Gt+Ce*or-fe)-pr),Fe==0?(we=er,Ie=pe,Oe=er,nr=pe):(we=Math.min(we,er),Ie=Math.min(Ie,pe),Oe=Math.max(Oe,er),nr=Math.max(nr,pe));return new o(Math.round(we),Math.round(Ie),Math.round(Oe-we),Math.round(nr-Ie))},Be=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var it,bt,Pt=(it=this.ctx.lineDash,bt=this.ctx.lineDashOffset,JSON.stringify({lineDash:it,lineDashOffset:bt}));this.prevLineDash!==Pt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Pt)}}})(zr.API),function(r){var t=function(s){var a,o,h,f,m,b,x,B,P,R;for(o=[],h=0,f=(s+=a="\0\0\0\0".slice(s.length%4||4)).length;f>h;h+=4)(m=(s.charCodeAt(h)<<24)+(s.charCodeAt(h+1)<<16)+(s.charCodeAt(h+2)<<8)+s.charCodeAt(h+3))!==0?(b=(m=((m=((m=((m=(m-(R=m%85))/85)-(P=m%85))/85)-(B=m%85))/85)-(x=m%85))/85)%85,o.push(b+33,x+33,B+33,P+33,R+33)):o.push(122);return function(Q,z){for(var G=z;G>0;G--)Q.pop()}(o,a.length),String.fromCharCode.apply(String,o)+"~>"},e=function(s){var a,o,h,f,m,b=String,x="length",B=255,P="charCodeAt",R="slice",Q="replace";for(s[R](-2),s=s[R](0,-2)[Q](/\s/g,"")[Q]("z","!!!!!"),h=[],f=0,m=(s+=a="uuuuu"[R](s[x]%5||5))[x];m>f;f+=5)o=52200625*(s[P](f)-33)+614125*(s[P](f+1)-33)+7225*(s[P](f+2)-33)+85*(s[P](f+3)-33)+(s[P](f+4)-33),h.push(B&o>>24,B&o>>16,B&o>>8,B&o);return function(z,G){for(var X=G;X>0;X--)z.pop()}(h,a[x]),b.fromCharCode.apply(b,h)},n=function(s){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((s=s.replace(/\s/g,"")).indexOf(">")!==-1&&(s=s.substr(0,s.indexOf(">"))),s.length%2&&(s+="0"),a.test(s)===!1)return"";for(var o="",h=0;h<s.length;h+=2)o+=String.fromCharCode("0x"+(s[h]+s[h+1]));return o},i=function(s){for(var a=new Uint8Array(s.length),o=s.length;o--;)a[o]=s.charCodeAt(o);return s=(a=R2(a)).reduce(function(h,f){return h+String.fromCharCode(f)},"")};r.processDataByFilters=function(s,a){var o=0,h=s||"",f=[];for(typeof(a=a||[])=="string"&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":h=e(h),f.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":h=t(h),f.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":h=n(h),f.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":h=h.split("").map(function(m){return("0"+m.charCodeAt().toString(16)).slice(-2)}).join("")+">",f.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":h=i(h),f.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:h,reverseChain:f.reverse().join(" ")}}}(zr.API),function(r){r.loadFile=function(t,e,n){return function(i,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=function(h,f,m){var b=new XMLHttpRequest,x=0,B=function(P){var R=P.length,Q=[],z=String.fromCharCode;for(x=0;x<R;x+=1)Q.push(z(255&P.charCodeAt(x)));return Q.join("")};if(b.open("GET",h,!f),b.overrideMimeType("text/plain; charset=x-user-defined"),f===!1&&(b.onload=function(){b.status===200?m(B(this.responseText)):m(void 0)}),b.send(null),f&&b.status===200)return B(b.responseText)}(i,s,a)}catch{}return o}(t,e,n)},r.loadImageFile=r.loadFile}(zr.API),function(r){function t(){return(Hr.html2canvas?Promise.resolve(Hr.html2canvas):Promise.resolve().then(()=>kut)).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function e(){return(Hr.DOMPurify?Promise.resolve(Hr.DOMPurify):Promise.resolve().then(()=>pAt)).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var n=function(a){var o=Un(a);return o==="undefined"?"undefined":o==="string"||a instanceof String?"string":o==="number"||a instanceof Number?"number":o==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":o==="object"?"object":"unknown"},i=function(a,o){var h=document.createElement(a);for(var f in o.className&&(h.className=o.className),o.innerHTML&&o.dompurify&&(h.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)h.style[f]=o.style[f];return h},s=function a(o){var h=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),f=a.convert(Promise.resolve(),h);return f=(f=f.setProgress(1,a,1,[a])).set(o)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(a,o){return a.__proto__=o||s.prototype,a},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(a,o){return this.then(function(){switch(o=o||function(h){switch(n(h)){case"string":return"string";case"element":return h.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a)){case"string":return this.then(e).then(function(h){return this.set({src:i("div",{innerHTML:a,dompurify:h})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},s.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=function h(f,m){for(var b=f.nodeType===3?document.createTextNode(f.nodeValue):f.cloneNode(!1),x=f.firstChild;x;x=x.nextSibling)m!==!0&&x.nodeType===1&&x.nodeName==="SCRIPT"||b.appendChild(h(x,m));return f.nodeType===1&&(f.nodeName==="CANVAS"?(b.width=f.width,b.height=f.height,b.getContext("2d").drawImage(f,0,0)):f.nodeName!=="TEXTAREA"&&f.nodeName!=="SELECT"||(b.value=f.value),b.addEventListener("load",function(){b.scrollTop=f.scrollTop,b.scrollLeft=f.scrollLeft},!0)),b}(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var h=Object.assign({},this.opt.html2canvas);return delete h.onrendered,o(this.prop.container,h)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var h=this.opt.jsPDF,f=this.opt.fontFaces,m=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,b=Object.assign({async:!0,allowTaint:!0,scale:m,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete b.onrendered,h.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,h.context2d.posX=this.opt.x,h.context2d.posY=this.opt.y,h.context2d.margin=this.opt.margin,h.context2d.fontFaces=f,f)for(var x=0;x<f.length;++x){var B=f[x],P=B.src.find(function(R){return R.format==="truetype"});P&&h.addFont(P.url,B.ref.name,B.ref.style)}return b.windowHeight=b.windowHeight||0,b.windowHeight=b.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):b.windowHeight,h.context2d.save(!0),o(this.prop.container,b)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(a,o,h){return(h=h||"pdf").toLowerCase()==="img"||h.toLowerCase()==="image"?this.outputImg(a,o):this.outputPdf(a,o)},s.prototype.outputPdf=function(a,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,o)})},s.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},s.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(a){if(n(a)!=="object")return this;var o=Object.keys(a||{}).map(function(h){if(h in s.template.prop)return function(){this.prop[h]=a[h]};switch(h){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[h]=a[h]}}},this);return this.then(function(){return this.thenList(o)})},s.prototype.get=function(a,o){return this.then(function(){var h=a in s.template.prop?this.prop[a]:this.opt[a];return o?o(h):h})},s.prototype.setMargin=function(a){return this.then(function(){switch(n(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},s.prototype.setPageSize=function(a){function o(h,f){return Math.floor(h*f/72*96)}return this.then(function(){(a=a||zr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:o(a.inner.width,a.k),height:o(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},s.prototype.setProgress=function(a,o,h,f){return a!=null&&(this.progress.val=a),o!=null&&(this.progress.state=o),h!=null&&(this.progress.n=h),f!=null&&(this.progress.stack=f),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(a,o,h,f){return this.setProgress(a?this.progress.val+a:null,o||null,h?this.progress.n+h:null,f?this.progress.stack.concat(f):null)},s.prototype.then=function(a,o){var h=this;return this.thenCore(a,o,function(f,m){return h.updateProgress(null,null,1,[f]),Promise.prototype.then.call(this,function(b){return h.updateProgress(null,f),b}).then(f,m).then(function(b){return h.updateProgress(1),b})})},s.prototype.thenCore=function(a,o,h){h=h||Promise.prototype.then,a&&(a=a.bind(this)),o&&(o=o.bind(this));var f=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:s.convert(Object.assign({},this),Promise.prototype),m=h.call(f,a,o);return s.convert(m,this.__proto__)},s.prototype.thenExternal=function(a,o){return Promise.prototype.then.call(this,a,o)},s.prototype.thenList=function(a){var o=this;return a.forEach(function(h){o=o.thenCore(h)}),o},s.prototype.catch=function(a){a&&(a=a.bind(this));var o=Promise.prototype.catch.call(this,a);return s.convert(o,this)},s.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},s.prototype.error=function(a){return this.then(function(){throw new Error(a)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,zr.getPageSize=function(a,o,h){if(Un(a)==="object"){var f=a;a=f.orientation,o=f.unit||o,h=f.format||h}o=o||"mm",h=h||"a4",a=(""+(a||"P")).toLowerCase();var m,b=(""+h).toLowerCase(),x={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":m=1;break;case"mm":m=72/25.4;break;case"cm":m=72/2.54;break;case"in":m=72;break;case"px":m=.75;break;case"pc":case"em":m=12;break;case"ex":m=6;break;default:throw"Invalid unit: "+o}var B,P=0,R=0;if(x.hasOwnProperty(b))P=x[b][1]/m,R=x[b][0]/m;else try{P=h[1],R=h[0]}catch{throw new Error("Invalid format: "+h)}if(a==="p"||a==="portrait")a="p",R>P&&(B=R,R=P,P=B);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",P>R&&(B=R,R=P,P=B)}return{width:R,height:P,unit:o,k:m,orientation:a}},r.html=function(a,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(q2):null;var h=new s(o);return o.worker?h:h.from(a).doCallback()}}(zr.API),zr.API.addJS=function(r){return mP=r,this.internal.events.subscribe("postPutResources",function(){Dy=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Dy+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),gP=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+mP+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Dy!==void 0&&gP!==void 0&&this.internal.out("/Names <</JavaScript "+Dy+" 0 R>>")}),this},function(r){var t;r.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=e.outline.render().split(/\r\n/),s=0;s<i.length;s++){var a=i[s],o=n.exec(a);if(o!=null){var h=o[1];e.internal.newObjectDeferredBegin(h,!1)}e.internal.write(a)}if(this.outline.createNamedDestinations){var f=this.internal.pages.length,m=[];for(s=0;s<f;s++){var b=e.internal.newObject();m.push(b);var x=e.internal.getPageInfo(s+1);e.internal.write("<< /D["+x.objId+" 0 R /XYZ null null null]>> endobj")}var B=e.internal.newObject();for(e.internal.write("<< /Names [ "),s=0;s<m.length;s++)e.internal.write("(page_"+(s+1)+")"+m[s]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+B+" 0 R"),e.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),r.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(n,i,s){var a={title:i,options:s,children:[]};return n==null&&(n=this.root),n.children.push(a),a},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(n){n.id=e.internal.newObjectDeferred();for(var i=0;i<n.children.length;i++)this.genIds_r(n.children[i])},e.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},e.outline.renderItems=function(n){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<n.children.length;s++){var a=n.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(n)),s>0&&this.line("/Prev "+this.makeRef(n.children[s-1])),s<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var h=e.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+h.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var f=0;f<n.children.length;f++)this.renderItems(n.children[f])},e.outline.line=function(n){this.ctx.val+=n+`\r
`},e.outline.makeRef=function(n){return n.id+" 0 R"},e.outline.makeString=function(n){return"("+e.internal.pdfEscape(n)+")"},e.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(n,i){for(var s=0;s<i.children.length;s++)n.count++,this.count_r(n,i.children[s]);return n.count}}])}(zr.API),function(r){var t=[192,193,194,195,196,197,198,199];r.processJPEG=function(e,n,i,s,a,o){var h,f=this.decode.DCT_DECODE,m=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=a||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(h=function(b){for(var x,B=256*b.charCodeAt(4)+b.charCodeAt(5),P=b.length,R={width:0,height:0,numcomponents:1},Q=4;Q<P;Q+=2){if(Q+=B,t.indexOf(b.charCodeAt(Q+1))!==-1){x=256*b.charCodeAt(Q+5)+b.charCodeAt(Q+6),R={width:256*b.charCodeAt(Q+7)+b.charCodeAt(Q+8),height:x,numcomponents:b.charCodeAt(Q+9)};break}B=256*b.charCodeAt(Q+2)+b.charCodeAt(Q+3)}return R}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}m={data:e,width:h.width,height:h.height,colorSpace:o,bitsPerComponent:8,filter:f,index:n,alias:i}}return m}}(zr.API);var Df,Ny,_P,vP,bP,Rrt=function(){var r,t,e;function n(s){var a,o,h,f,m,b,x,B,P,R,Q,z,G,X;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},b=null;;){switch(a=this.readUInt32(),P=(function(){var et,pt;for(pt=[],et=0;et<4;++et)pt.push(String.fromCharCode(this.data[this.pos++]));return pt}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":b&&this.animation.frames.push(b),this.pos+=4,b={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},m=this.readUInt16(),f=this.readUInt16()||100,b.delay=1e3*m/f,b.disposeOp=this.data[this.pos++],b.blendOp=this.data[this.pos++],b.data=[];break;case"IDAT":case"fdAT":for(P==="fdAT"&&(this.pos+=4,a-=4),s=(b!=null?b.data:void 0)||this.imgData,z=0;0<=a?z<a:z>a;0<=a?++z:--z)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(h=this.palette.length/3,this.transparency.indexed=this.read(a),this.transparency.indexed.length>h)throw new Error("More transparent colors than palette size");if((R=h-this.transparency.indexed.length)>0)for(G=0;0<=R?G<R:G>R;0<=R?++G:--G)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":x=(Q=this.read(a)).indexOf(0),B=String.fromCharCode.apply(String,Q.slice(0,x)),this.text[B]=String.fromCharCode.apply(String,Q.slice(x+1));break;case"IEND":return b&&this.animation.frames.push(b),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(X=this.colorType)===4||X===6,o=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*o,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(s){var a,o;for(o=[],a=0;0<=s?a<s:a>s;0<=s?++a:--a)o.push(this.data[this.pos++]);return o},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(s){var a=this.pixelBitlength/8,o=new Uint8Array(this.width*this.height*a),h=0,f=this;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);function m(b,x,B,P){var R,Q,z,G,X,et,pt,gt,mt,ft,Mt,Lt,at,ct,wt,_t,Jt,Yt,ee,$t,ne,re=Math.ceil((f.width-b)/B),Be=Math.ceil((f.height-x)/P),it=f.width==re&&f.height==Be;for(ct=a*re,Lt=it?o:new Uint8Array(ct*Be),et=s.length,at=0,Q=0;at<Be&&h<et;){switch(s[h++]){case 0:for(G=Jt=0;Jt<ct;G=Jt+=1)Lt[Q++]=s[h++];break;case 1:for(G=Yt=0;Yt<ct;G=Yt+=1)R=s[h++],X=G<a?0:Lt[Q-a],Lt[Q++]=(R+X)%256;break;case 2:for(G=ee=0;ee<ct;G=ee+=1)R=s[h++],z=(G-G%a)/a,wt=at&&Lt[(at-1)*ct+z*a+G%a],Lt[Q++]=(wt+R)%256;break;case 3:for(G=$t=0;$t<ct;G=$t+=1)R=s[h++],z=(G-G%a)/a,X=G<a?0:Lt[Q-a],wt=at&&Lt[(at-1)*ct+z*a+G%a],Lt[Q++]=(R+Math.floor((X+wt)/2))%256;break;case 4:for(G=ne=0;ne<ct;G=ne+=1)R=s[h++],z=(G-G%a)/a,X=G<a?0:Lt[Q-a],at===0?wt=_t=0:(wt=Lt[(at-1)*ct+z*a+G%a],_t=z&&Lt[(at-1)*ct+(z-1)*a+G%a]),pt=X+wt-_t,gt=Math.abs(pt-X),ft=Math.abs(pt-wt),Mt=Math.abs(pt-_t),mt=gt<=ft&&gt<=Mt?X:ft<=Mt?wt:_t,Lt[Q++]=(R+mt)%256;break;default:throw new Error("Invalid filter algorithm: "+s[h-1])}if(!it){var bt=((x+at*P)*f.width+b)*a,Pt=at*ct;for(G=0;G<re;G+=1){for(var Ot=0;Ot<a;Ot+=1)o[bt++]=Lt[Pt++];bt+=(B-1)*a}}at++}}return s=prt(s),f.interlaceMethod==1?(m(0,0,8,8),m(4,0,8,8),m(0,4,4,8),m(2,0,4,4),m(0,2,2,4),m(1,0,2,2),m(0,1,1,2)):m(0,0,1,1),o},n.prototype.decodePalette=function(){var s,a,o,h,f,m,b,x,B;for(o=this.palette,m=this.transparency.indexed||[],f=new Uint8Array((m.length||0)+o.length),h=0,s=0,a=b=0,x=o.length;b<x;a=b+=3)f[h++]=o[a],f[h++]=o[a+1],f[h++]=o[a+2],f[h++]=(B=m[s++])!=null?B:255;return f},n.prototype.copyToImageData=function(s,a){var o,h,f,m,b,x,B,P,R,Q,z;if(h=this.colors,R=null,o=this.hasAlphaChannel,this.palette.length&&(R=(z=this._decodedPalette)!=null?z:this._decodedPalette=this.decodePalette(),h=4,o=!0),P=(f=s.data||s).length,b=R||a,m=x=0,h===1)for(;m<P;)B=R?4*a[m/4]:x,Q=b[B++],f[m++]=Q,f[m++]=Q,f[m++]=Q,f[m++]=o?b[B++]:255,x=B;else for(;m<P;)B=R?4*a[m/4]:x,f[m++]=b[B++],f[m++]=b[B++],f[m++]=b[B++],f[m++]=o?b[B++]:255,x=B},n.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s};var i=function(){if(Object.prototype.toString.call(Hr)==="[object Window]"){try{t=Hr.document.createElement("canvas"),e=t.getContext("2d")}catch{return!1}return!0}return!1};return i(),r=function(s){var a;if(i()===!0)return e.width=s.width,e.height=s.height,e.clearRect(0,0,s.width,s.height),e.putImageData(s,0,0),(a=new Image).src=t.toDataURL(),a;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(s){var a,o,h,f,m,b,x,B;if(this.animation){for(B=[],o=m=0,b=(x=this.animation.frames).length;m<b;o=++m)a=x[o],h=s.createImageData(a.width,a.height),f=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(h,f),a.imageData=h,B.push(a.image=r(h));return B}},n.prototype.renderFrame=function(s,a){var o,h,f;return o=(h=this.animation.frames)[a],f=h[a-1],a===0&&s.clearRect(0,0,this.width,this.height),(f!=null?f.disposeOp:void 0)===1?s.clearRect(f.xOffset,f.yOffset,f.width,f.height):(f!=null?f.disposeOp:void 0)===2&&s.putImageData(f.imageData,f.xOffset,f.yOffset),o.blendOp===0&&s.clearRect(o.xOffset,o.yOffset,o.width,o.height),s.drawImage(o.image,o.xOffset,o.yOffset)},n.prototype.animate=function(s){var a,o,h,f,m,b,x=this;return o=0,b=this.animation,f=b.numFrames,h=b.frames,m=b.numPlays,(a=function(){var B,P;if(B=o++%f,P=h[B],x.renderFrame(s,B),f>1&&o/f<m)return x.animation._timeout=setTimeout(a,P.delay)})()},n.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},n.prototype.render=function(s){var a,o;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,a=s.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(o=a.createImageData(this.width,this.height),this.copyToImageData(o,this.decodePixels()),a.putImageData(o,0,0))},n}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function Ort(r){var t=0;if(r[t++]!==71||r[t++]!==73||r[t++]!==70||r[t++]!==56||(r[t++]+1&253)!=56||r[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=r[t++]|r[t++]<<8,n=r[t++]|r[t++]<<8,i=r[t++],s=i>>7,a=1<<(7&i)+1;r[t++],r[t++];var o=null,h=null;s&&(o=t,h=a,t+=3*a);var f=!0,m=[],b=0,x=null,B=0,P=null;for(this.width=e,this.height=n;f&&t<r.length;)switch(r[t++]){case 33:switch(r[t++]){case 255:if(r[t]!==11||r[t+1]==78&&r[t+2]==69&&r[t+3]==84&&r[t+4]==83&&r[t+5]==67&&r[t+6]==65&&r[t+7]==80&&r[t+8]==69&&r[t+9]==50&&r[t+10]==46&&r[t+11]==48&&r[t+12]==3&&r[t+13]==1&&r[t+16]==0)t+=14,P=r[t++]|r[t++]<<8,t++;else for(t+=12;;){if(!((at=r[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}break;case 249:if(r[t++]!==4||r[t+4]!==0)throw new Error("Invalid graphics extension block.");var R=r[t++];b=r[t++]|r[t++]<<8,x=r[t++],!(1&R)&&(x=null),B=R>>2&7,t++;break;case 254:for(;;){if(!((at=r[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}break;default:throw new Error("Unknown graphic control label: 0x"+r[t-1].toString(16))}break;case 44:var Q=r[t++]|r[t++]<<8,z=r[t++]|r[t++]<<8,G=r[t++]|r[t++]<<8,X=r[t++]|r[t++]<<8,et=r[t++],pt=et>>6&1,gt=1<<(7&et)+1,mt=o,ft=h,Mt=!1;et>>7&&(Mt=!0,mt=t,ft=gt,t+=3*gt);var Lt=t;for(t++;;){var at;if(!((at=r[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}m.push({x:Q,y:z,width:G,height:X,has_local_palette:Mt,palette_offset:mt,palette_size:ft,data_offset:Lt,data_length:t-Lt,transparent_index:x,interlaced:!!pt,delay:b,disposal:B});break;case 59:f=!1;break;default:throw new Error("Unknown gif block: 0x"+r[t-1].toString(16))}this.numFrames=function(){return m.length},this.loopCount=function(){return P},this.frameInfo=function(ct){if(ct<0||ct>=m.length)throw new Error("Frame index out of range.");return m[ct]},this.decodeAndBlitFrameBGRA=function(ct,wt){var _t=this.frameInfo(ct),Jt=_t.width*_t.height,Yt=new Uint8Array(Jt);wP(r,_t.data_offset,Yt,Jt);var ee=_t.palette_offset,$t=_t.transparent_index;$t===null&&($t=256);var ne=_t.width,re=e-ne,Be=ne,it=4*(_t.y*e+_t.x),bt=4*((_t.y+_t.height)*e+_t.x),Pt=it,Ot=4*re;_t.interlaced===!0&&(Ot+=4*e*7);for(var qt=8,Gt=0,oe=Yt.length;Gt<oe;++Gt){var ie=Yt[Gt];if(Be===0&&(Be=ne,(Pt+=Ot)>=bt&&(Ot=4*re+4*e*(qt-1),Pt=it+(ne+re)*(qt<<1),qt>>=1)),ie===$t)Pt+=4;else{var Ce=r[ee+3*ie],Fe=r[ee+3*ie+1],Re=r[ee+3*ie+2];wt[Pt++]=Re,wt[Pt++]=Fe,wt[Pt++]=Ce,wt[Pt++]=255}--Be}},this.decodeAndBlitFrameRGBA=function(ct,wt){var _t=this.frameInfo(ct),Jt=_t.width*_t.height,Yt=new Uint8Array(Jt);wP(r,_t.data_offset,Yt,Jt);var ee=_t.palette_offset,$t=_t.transparent_index;$t===null&&($t=256);var ne=_t.width,re=e-ne,Be=ne,it=4*(_t.y*e+_t.x),bt=4*((_t.y+_t.height)*e+_t.x),Pt=it,Ot=4*re;_t.interlaced===!0&&(Ot+=4*e*7);for(var qt=8,Gt=0,oe=Yt.length;Gt<oe;++Gt){var ie=Yt[Gt];if(Be===0&&(Be=ne,(Pt+=Ot)>=bt&&(Ot=4*re+4*e*(qt-1),Pt=it+(ne+re)*(qt<<1),qt>>=1)),ie===$t)Pt+=4;else{var Ce=r[ee+3*ie],Fe=r[ee+3*ie+1],Re=r[ee+3*ie+2];wt[Pt++]=Ce,wt[Pt++]=Fe,wt[Pt++]=Re,wt[Pt++]=255}--Be}}}function wP(r,t,e,n){for(var i=r[t++],s=1<<i,a=s+1,o=a+1,h=i+1,f=(1<<h)-1,m=0,b=0,x=0,B=r[t++],P=new Int32Array(4096),R=null;;){for(;m<16&&B!==0;)b|=r[t++]<<m,m+=8,B===1?B=r[t++]:--B;if(m<h)break;var Q=b&f;if(b>>=h,m-=h,Q!==s){if(Q===a)break;for(var z=Q<o?Q:R,G=0,X=z;X>s;)X=P[X]>>8,++G;var et=X;if(x+G+(z!==Q?1:0)>n)return void Ai.log("Warning, gif stream longer than expected.");e[x++]=et;var pt=x+=G;for(z!==Q&&(e[x++]=et),X=z;G--;)X=P[X],e[--pt]=255&X,X>>=8;R!==null&&o<4096&&(P[o++]=R<<8|et,o>=f+1&&h<12&&(++h,f=f<<1|1)),R=Q}else o=a+1,f=(1<<(h=i+1))-1,R=null}return x!==n&&Ai.log("Warning, gif stream shorter than expected."),e}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function K2(r){var t,e,n,i,s,a=Math.floor,o=new Array(64),h=new Array(64),f=new Array(64),m=new Array(64),b=new Array(65535),x=new Array(65535),B=new Array(64),P=new Array(64),R=[],Q=0,z=7,G=new Array(64),X=new Array(64),et=new Array(64),pt=new Array(256),gt=new Array(2048),mt=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],ft=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Mt=[0,1,2,3,4,5,6,7,8,9,10,11],Lt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],at=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ct=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],wt=[0,1,2,3,4,5,6,7,8,9,10,11],_t=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Jt=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Yt(it,bt){for(var Pt=0,Ot=0,qt=new Array,Gt=1;Gt<=16;Gt++){for(var oe=1;oe<=it[Gt];oe++)qt[bt[Ot]]=[],qt[bt[Ot]][0]=Pt,qt[bt[Ot]][1]=Gt,Ot++,Pt++;Pt*=2}return qt}function ee(it){for(var bt=it[0],Pt=it[1]-1;Pt>=0;)bt&1<<Pt&&(Q|=1<<z),Pt--,--z<0&&(Q==255?($t(255),$t(0)):$t(Q),z=7,Q=0)}function $t(it){R.push(it)}function ne(it){$t(it>>8&255),$t(255&it)}function re(it,bt,Pt,Ot,qt){for(var Gt,oe=qt[0],ie=qt[240],Ce=function(pe,we){var Ie,Oe,nr,hr,Sr,Mr,kr,ye,or,xr,De=0;for(or=0;or<8;++or){Ie=pe[De],Oe=pe[De+1],nr=pe[De+2],hr=pe[De+3],Sr=pe[De+4],Mr=pe[De+5],kr=pe[De+6];var pn=Ie+(ye=pe[De+7]),ge=Ie-ye,yr=Oe+kr,je=Oe-kr,Rr=nr+Mr,cn=nr-Mr,He=hr+Sr,Kn=hr-Sr,sn=pn+He,Jr=pn-He,Bt=yr+Rr,Z=yr-Rr;pe[De]=sn+Bt,pe[De+4]=sn-Bt;var J=.707106781*(Z+Jr);pe[De+2]=Jr+J,pe[De+6]=Jr-J;var st=.382683433*((sn=Kn+cn)-(Z=je+ge)),Ft=.5411961*sn+st,Nt=1.306562965*Z+st,Ht=.707106781*(Bt=cn+je),jt=ge+Ht,Tt=ge-Ht;pe[De+5]=Tt+Ft,pe[De+3]=Tt-Ft,pe[De+1]=jt+Nt,pe[De+7]=jt-Nt,De+=8}for(De=0,or=0;or<8;++or){Ie=pe[De],Oe=pe[De+8],nr=pe[De+16],hr=pe[De+24],Sr=pe[De+32],Mr=pe[De+40],kr=pe[De+48];var Xt=Ie+(ye=pe[De+56]),_e=Ie-ye,ue=Oe+kr,Ae=Oe-kr,ze=nr+Mr,Ve=nr-Mr,Er=hr+Sr,_r=hr-Sr,Ur=Xt+Er,Vr=Xt-Er,Gr=ue+ze,Zr=ue-ze;pe[De]=Ur+Gr,pe[De+32]=Ur-Gr;var vr=.707106781*(Zr+Vr);pe[De+16]=Vr+vr,pe[De+48]=Vr-vr;var Wr=.382683433*((Ur=_r+Ve)-(Zr=Ae+_e)),_n=.5411961*Ur+Wr,Rn=1.306562965*Zr+Wr,Zn=.707106781*(Gr=Ve+Ae),Rt=_e+Zn,qe=_e-Zn;pe[De+40]=qe+_n,pe[De+24]=qe-_n,pe[De+8]=Rt+Rn,pe[De+56]=Rt-Rn,De++}for(or=0;or<64;++or)xr=pe[or]*we[or],B[or]=xr>0?xr+.5|0:xr-.5|0;return B}(it,bt),Fe=0;Fe<64;++Fe)P[mt[Fe]]=Ce[Fe];var Re=P[0]-Pt;Pt=P[0],Re==0?ee(Ot[0]):(ee(Ot[x[Gt=32767+Re]]),ee(b[Gt]));for(var Ne=63;Ne>0&&P[Ne]==0;)Ne--;if(Ne==0)return ee(oe),Pt;for(var ke,fe=1;fe<=Ne;){for(var lt=fe;P[fe]==0&&fe<=Ne;)++fe;var pr=fe-lt;if(pr>=16){ke=pr>>4;for(var er=1;er<=ke;++er)ee(ie);pr&=15}Gt=32767+P[fe],ee(qt[(pr<<4)+x[Gt]]),ee(b[Gt]),fe++}return Ne!=63&&ee(oe),Pt}function Be(it){it=Math.min(Math.max(it,1),100),s!=it&&(function(bt){for(var Pt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Ot=0;Ot<64;Ot++){var qt=a((Pt[Ot]*bt+50)/100);qt=Math.min(Math.max(qt,1),255),o[mt[Ot]]=qt}for(var Gt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],oe=0;oe<64;oe++){var ie=a((Gt[oe]*bt+50)/100);ie=Math.min(Math.max(ie,1),255),h[mt[oe]]=ie}for(var Ce=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Fe=0,Re=0;Re<8;Re++)for(var Ne=0;Ne<8;Ne++)f[Fe]=1/(o[mt[Fe]]*Ce[Re]*Ce[Ne]*8),m[Fe]=1/(h[mt[Fe]]*Ce[Re]*Ce[Ne]*8),Fe++}(it<50?Math.floor(5e3/it):Math.floor(200-2*it)),s=it)}this.encode=function(it,bt){bt&&Be(bt),R=new Array,Q=0,z=7,ne(65496),ne(65504),ne(16),$t(74),$t(70),$t(73),$t(70),$t(0),$t(1),$t(1),$t(0),ne(1),ne(1),$t(0),$t(0),function(){ne(65499),ne(132),$t(0);for(var Oe=0;Oe<64;Oe++)$t(o[Oe]);$t(1);for(var nr=0;nr<64;nr++)$t(h[nr])}(),function(Oe,nr){ne(65472),ne(17),$t(8),ne(nr),ne(Oe),$t(3),$t(1),$t(17),$t(0),$t(2),$t(17),$t(1),$t(3),$t(17),$t(1)}(it.width,it.height),function(){ne(65476),ne(418),$t(0);for(var Oe=0;Oe<16;Oe++)$t(ft[Oe+1]);for(var nr=0;nr<=11;nr++)$t(Mt[nr]);$t(16);for(var hr=0;hr<16;hr++)$t(Lt[hr+1]);for(var Sr=0;Sr<=161;Sr++)$t(at[Sr]);$t(1);for(var Mr=0;Mr<16;Mr++)$t(ct[Mr+1]);for(var kr=0;kr<=11;kr++)$t(wt[kr]);$t(17);for(var ye=0;ye<16;ye++)$t(_t[ye+1]);for(var or=0;or<=161;or++)$t(Jt[or])}(),ne(65498),ne(12),$t(3),$t(1),$t(0),$t(2),$t(17),$t(3),$t(17),$t(0),$t(63),$t(0);var Pt=0,Ot=0,qt=0;Q=0,z=7,this.encode.displayName="_encode_";for(var Gt,oe,ie,Ce,Fe,Re,Ne,ke,fe,lt=it.data,pr=it.width,er=it.height,pe=4*pr,we=0;we<er;){for(Gt=0;Gt<pe;){for(Fe=pe*we+Gt,Ne=-1,ke=0,fe=0;fe<64;fe++)Re=Fe+(ke=fe>>3)*pe+(Ne=4*(7&fe)),we+ke>=er&&(Re-=pe*(we+1+ke-er)),Gt+Ne>=pe&&(Re-=Gt+Ne-pe+4),oe=lt[Re++],ie=lt[Re++],Ce=lt[Re++],G[fe]=(gt[oe]+gt[ie+256>>0]+gt[Ce+512>>0]>>16)-128,X[fe]=(gt[oe+768>>0]+gt[ie+1024>>0]+gt[Ce+1280>>0]>>16)-128,et[fe]=(gt[oe+1280>>0]+gt[ie+1536>>0]+gt[Ce+1792>>0]>>16)-128;Pt=re(G,f,Pt,t,n),Ot=re(X,m,Ot,e,i),qt=re(et,m,qt,e,i),Gt+=32}we+=8}if(z>=0){var Ie=[];Ie[1]=z+1,Ie[0]=(1<<z+1)-1,ee(Ie)}return ne(65497),new Uint8Array(R)},r=r||50,function(){for(var it=String.fromCharCode,bt=0;bt<256;bt++)pt[bt]=it(bt)}(),t=Yt(ft,Mt),e=Yt(ct,wt),n=Yt(Lt,at),i=Yt(_t,Jt),function(){for(var it=1,bt=2,Pt=1;Pt<=15;Pt++){for(var Ot=it;Ot<bt;Ot++)x[32767+Ot]=Pt,b[32767+Ot]=[],b[32767+Ot][1]=Pt,b[32767+Ot][0]=Ot;for(var qt=-(bt-1);qt<=-it;qt++)x[32767+qt]=Pt,b[32767+qt]=[],b[32767+qt][1]=Pt,b[32767+qt][0]=bt-1+qt;it<<=1,bt<<=1}}(),function(){for(var it=0;it<256;it++)gt[it]=19595*it,gt[it+256>>0]=38470*it,gt[it+512>>0]=7471*it+32768,gt[it+768>>0]=-11059*it,gt[it+1024>>0]=-21709*it,gt[it+1280>>0]=32768*it+8421375,gt[it+1536>>0]=-27439*it,gt[it+1792>>0]=-5329*it}(),Be(r)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function Ac(r,t){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function xP(r){function t(ft){if(!ft)throw Error("assert :P")}function e(ft,Mt,Lt){for(var at=0;4>at;at++)if(ft[Mt+at]!=Lt.charCodeAt(at))return!0;return!1}function n(ft,Mt,Lt,at,ct){for(var wt=0;wt<ct;wt++)ft[Mt+wt]=Lt[at+wt]}function i(ft,Mt,Lt,at){for(var ct=0;ct<at;ct++)ft[Mt+ct]=Lt}function s(ft){return new Int32Array(ft)}function a(ft,Mt){for(var Lt=[],at=0;at<ft;at++)Lt.push(new Mt);return Lt}function o(ft,Mt){var Lt=[];return function at(ct,wt,_t){for(var Jt=_t[wt],Yt=0;Yt<Jt&&(ct.push(_t.length>wt+1?[]:new Mt),!(_t.length<wt+1));Yt++)at(ct[Yt],wt+1,_t)}(Lt,0,ft),Lt}var h=function(){var ft=this;function Mt(g,y){for(var S=1<<y-1>>>0;g&S;)S>>>=1;return S?(g&S-1)+S:g}function Lt(g,y,S,F,M){t(!(F%S));do g[y+(F-=S)]=M;while(0<F)}function at(g,y,S,F,M){if(t(2328>=M),512>=M)var N=s(512);else if((N=s(M))==null)return 0;return function(k,V,j,K,tt,ht){var rt,At,St=V,Ct=1<<j,yt=s(16),Et=s(16);for(t(tt!=0),t(K!=null),t(k!=null),t(0<j),At=0;At<tt;++At){if(15<K[At])return 0;++yt[K[At]]}if(yt[0]==tt)return 0;for(Et[1]=0,rt=1;15>rt;++rt){if(yt[rt]>1<<rt)return 0;Et[rt+1]=Et[rt]+yt[rt]}for(At=0;At<tt;++At)rt=K[At],0<K[At]&&(ht[Et[rt]++]=At);if(Et[15]==1)return(K=new ct).g=0,K.value=ht[0],Lt(k,St,1,Ct,K),Ct;var Wt,Zt=-1,zt=Ct-1,ae=0,de=1,Me=1,le=1<<j;for(At=0,rt=1,tt=2;rt<=j;++rt,tt<<=1){if(de+=Me<<=1,0>(Me-=yt[rt]))return 0;for(;0<yt[rt];--yt[rt])(K=new ct).g=rt,K.value=ht[At++],Lt(k,St+ae,tt,le,K),ae=Mt(ae,rt)}for(rt=j+1,tt=2;15>=rt;++rt,tt<<=1){if(de+=Me<<=1,0>(Me-=yt[rt]))return 0;for(;0<yt[rt];--yt[rt]){if(K=new ct,(ae&zt)!=Zt){for(St+=le,Wt=1<<(Zt=rt)-j;15>Zt&&!(0>=(Wt-=yt[Zt]));)++Zt,Wt<<=1;Ct+=le=1<<(Wt=Zt-j),k[V+(Zt=ae&zt)].g=Wt+j,k[V+Zt].value=St-V-Zt}K.g=rt-j,K.value=ht[At++],Lt(k,St+(ae>>j),tt,le,K),ae=Mt(ae,rt)}}return de!=2*Et[15]-1?0:Ct}(g,y,S,F,M,N)}function ct(){this.value=this.g=0}function wt(){this.value=this.g=0}function _t(){this.G=a(5,ct),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(Hn,wt)}function Jt(g,y,S,F){t(g!=null),t(y!=null),t(2147483648>F),g.Ca=254,g.I=0,g.b=-8,g.Ka=0,g.oa=y,g.pa=S,g.Jd=y,g.Yc=S+F,g.Zc=4<=F?S+F-4+1:S,Gt(g)}function Yt(g,y){for(var S=0;0<y--;)S|=ie(g,128)<<y;return S}function ee(g,y){var S=Yt(g,y);return oe(g)?-S:S}function $t(g,y,S,F){var M,N=0;for(t(g!=null),t(y!=null),t(4294967288>F),g.Sb=F,g.Ra=0,g.u=0,g.h=0,4<F&&(F=4),M=0;M<F;++M)N+=y[S+M]<<8*M;g.Ra=N,g.bb=F,g.oa=y,g.pa=S}function ne(g){for(;8<=g.u&&g.bb<g.Sb;)g.Ra>>>=8,g.Ra+=g.oa[g.pa+g.bb]<<kl-8>>>0,++g.bb,g.u-=8;Pt(g)&&(g.h=1,g.u=0)}function re(g,y){if(t(0<=y),!g.h&&y<=Tc){var S=bt(g)&Sc[y];return g.u+=y,ne(g),S}return g.h=1,g.u=0}function Be(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function it(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function bt(g){return g.Ra>>>(g.u&kl-1)>>>0}function Pt(g){return t(g.bb<=g.Sb),g.h||g.bb==g.Sb&&g.u>kl}function Ot(g,y){g.u=y,g.h=Pt(g)}function qt(g){g.u>=$o&&(t(g.u>=$o),ne(g))}function Gt(g){t(g!=null&&g.oa!=null),g.pa<g.Zc?(g.I=(g.oa[g.pa++]|g.I<<8)>>>0,g.b+=8):(t(g!=null&&g.oa!=null),g.pa<g.Yc?(g.b+=8,g.I=g.oa[g.pa++]|g.I<<8):g.Ka?g.b=0:(g.I<<=8,g.b+=8,g.Ka=1))}function oe(g){return Yt(g,1)}function ie(g,y){var S=g.Ca;0>g.b&&Gt(g);var F=g.b,M=S*y>>>8,N=(g.I>>>F>M)+0;for(N?(S-=M,g.I-=M+1<<F>>>0):S=M+1,F=S,M=0;256<=F;)M+=8,F>>=8;return F=7^M+ls[F],g.b-=F,g.Ca=(S<<F)-1,N}function Ce(g,y,S){g[y+0]=S>>24&255,g[y+1]=S>>16&255,g[y+2]=S>>8&255,g[y+3]=S>>0&255}function Fe(g,y){return g[y+0]<<0|g[y+1]<<8}function Re(g,y){return Fe(g,y)|g[y+2]<<16}function Ne(g,y){return Fe(g,y)|Fe(g,y+2)<<16}function ke(g,y){var S=1<<y;return t(g!=null),t(0<y),g.X=s(S),g.X==null?0:(g.Mb=32-y,g.Xa=y,1)}function fe(g,y){t(g!=null),t(y!=null),t(g.Xa==y.Xa),n(y.X,0,g.X,0,1<<y.Xa)}function lt(){this.X=[],this.Xa=this.Mb=0}function pr(g,y,S,F){t(S!=null),t(F!=null);var M=S[0],N=F[0];return M==0&&(M=(g*N+y/2)/y),N==0&&(N=(y*M+g/2)/g),0>=M||0>=N?0:(S[0]=M,F[0]=N,1)}function er(g,y){return g+(1<<y)-1>>>y}function pe(g,y){return((4278255360&g)+(4278255360&y)>>>0&4278255360)+((16711935&g)+(16711935&y)>>>0&16711935)>>>0}function we(g,y){ft[y]=function(S,F,M,N,k,V,j){var K;for(K=0;K<k;++K){var tt=ft[g](V[j+K-1],M,N+K);V[j+K]=pe(S[F+K],tt)}}}function Ie(){this.ud=this.hd=this.jd=0}function Oe(g,y){return((4278124286&(g^y))>>>1)+(g&y)>>>0}function nr(g){return 0<=g&&256>g?g:0>g?0:255<g?255:void 0}function hr(g,y){return nr(g+(g-y+.5>>1))}function Sr(g,y,S){return Math.abs(y-S)-Math.abs(g-S)}function Mr(g,y,S,F,M,N,k){for(F=N[k-1],S=0;S<M;++S)N[k+S]=F=pe(g[y+S],F)}function kr(g,y,S,F,M){var N;for(N=0;N<S;++N){var k=g[y+N],V=k>>8&255,j=16711935&(j=(j=16711935&k)+((V<<16)+V));F[M+N]=(4278255360&k)+j>>>0}}function ye(g,y){y.jd=g>>0&255,y.hd=g>>8&255,y.ud=g>>16&255}function or(g,y,S,F,M,N){var k;for(k=0;k<F;++k){var V=y[S+k],j=V>>>8,K=V,tt=255&(tt=(tt=V>>>16)+((g.jd<<24>>24)*(j<<24>>24)>>>5));K=255&(K=(K=K+((g.hd<<24>>24)*(j<<24>>24)>>>5))+((g.ud<<24>>24)*(tt<<24>>24)>>>5)),M[N+k]=(4278255360&V)+(tt<<16)+K}}function xr(g,y,S,F,M){ft[y]=function(N,k,V,j,K,tt,ht,rt,At){for(j=ht;j<rt;++j)for(ht=0;ht<At;++ht)K[tt++]=M(V[F(N[k++])])},ft[g]=function(N,k,V,j,K,tt,ht){var rt=8>>N.b,At=N.Ea,St=N.K[0],Ct=N.w;if(8>rt)for(N=(1<<N.b)-1,Ct=(1<<rt)-1;k<V;++k){var yt,Et=0;for(yt=0;yt<At;++yt)yt&N||(Et=F(j[K++])),tt[ht++]=M(St[Et&Ct]),Et>>=rt}else ft["VP8LMapColor"+S](j,K,St,Ct,tt,ht,k,V,At)}}function De(g,y,S,F,M){for(S=y+S;y<S;){var N=g[y++];F[M++]=N>>16&255,F[M++]=N>>8&255,F[M++]=N>>0&255}}function pn(g,y,S,F,M){for(S=y+S;y<S;){var N=g[y++];F[M++]=N>>16&255,F[M++]=N>>8&255,F[M++]=N>>0&255,F[M++]=N>>24&255}}function ge(g,y,S,F,M){for(S=y+S;y<S;){var N=(k=g[y++])>>16&240|k>>12&15,k=k>>0&240|k>>28&15;F[M++]=N,F[M++]=k}}function yr(g,y,S,F,M){for(S=y+S;y<S;){var N=(k=g[y++])>>16&248|k>>13&7,k=k>>5&224|k>>3&31;F[M++]=N,F[M++]=k}}function je(g,y,S,F,M){for(S=y+S;y<S;){var N=g[y++];F[M++]=N>>0&255,F[M++]=N>>8&255,F[M++]=N>>16&255}}function Rr(g,y,S,F,M,N){if(N==0)for(S=y+S;y<S;)Ce(F,((N=g[y++])[0]>>24|N[1]>>8&65280|N[2]<<8&16711680|N[3]<<24)>>>0),M+=32;else n(F,M,g,y,S)}function cn(g,y){ft[y][0]=ft[g+"0"],ft[y][1]=ft[g+"1"],ft[y][2]=ft[g+"2"],ft[y][3]=ft[g+"3"],ft[y][4]=ft[g+"4"],ft[y][5]=ft[g+"5"],ft[y][6]=ft[g+"6"],ft[y][7]=ft[g+"7"],ft[y][8]=ft[g+"8"],ft[y][9]=ft[g+"9"],ft[y][10]=ft[g+"10"],ft[y][11]=ft[g+"11"],ft[y][12]=ft[g+"12"],ft[y][13]=ft[g+"13"],ft[y][14]=ft[g+"0"],ft[y][15]=ft[g+"0"]}function He(g){return g==Ba||g==gh||g==wu||g==pA}function Kn(){this.eb=[],this.size=this.A=this.fb=0}function sn(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Jr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Kn,this.f.kb=new sn,this.sd=null}function Bt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Z(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function J(g){return alert("todo:WebPSamplerProcessPlane"),g.T}function st(g,y){var S=g.T,F=y.ba.f.RGBA,M=F.eb,N=F.fb+g.ka*F.A,k=Fo[y.ba.S],V=g.y,j=g.O,K=g.f,tt=g.N,ht=g.ea,rt=g.W,At=y.cc,St=y.dc,Ct=y.Mc,yt=y.Nc,Et=g.ka,Wt=g.ka+g.T,Zt=g.U,zt=Zt+1>>1;for(Et==0?k(V,j,null,null,K,tt,ht,rt,K,tt,ht,rt,M,N,null,null,Zt):(k(y.ec,y.fc,V,j,At,St,Ct,yt,K,tt,ht,rt,M,N-F.A,M,N,Zt),++S);Et+2<Wt;Et+=2)At=K,St=tt,Ct=ht,yt=rt,tt+=g.Rc,rt+=g.Rc,N+=2*F.A,k(V,(j+=2*g.fa)-g.fa,V,j,At,St,Ct,yt,K,tt,ht,rt,M,N-F.A,M,N,Zt);return j+=g.fa,g.j+Wt<g.o?(n(y.ec,y.fc,V,j,Zt),n(y.cc,y.dc,K,tt,zt),n(y.Mc,y.Nc,ht,rt,zt),S--):1&Wt||k(V,j,null,null,K,tt,ht,rt,K,tt,ht,rt,M,N+F.A,null,null,Zt),S}function Ft(g,y,S){var F=g.F,M=[g.J];if(F!=null){var N=g.U,k=y.ba.S,V=k==Pc||k==wu;y=y.ba.f.RGBA;var j=[0],K=g.ka;j[0]=g.T,g.Kb&&(K==0?--j[0]:(--K,M[0]-=g.width),g.j+g.ka+g.T==g.o&&(j[0]=g.o-g.j-K));var tt=y.eb;K=y.fb+K*y.A,g=Fc(F,M[0],g.width,N,j,tt,K+(V?0:3),y.A),t(S==j),g&&He(k)&&Ya(tt,K,V,N,j,y.A)}return 0}function Nt(g){var y=g.ma,S=y.ba.S,F=11>S,M=S==Lc||S==bu||S==Pc||S==fA||S==12||He(S);if(y.memory=null,y.Ib=null,y.Jb=null,y.Nd=null,!Nl(y.Oa,g,M?11:12))return 0;if(M&&He(S)&&Pe(),g.da)alert("todo:use_scaling");else{if(F){if(y.Ib=J,g.Kb){if(S=g.U+1>>1,y.memory=s(g.U+2*S),y.memory==null)return 0;y.ec=y.memory,y.fc=0,y.cc=y.ec,y.dc=y.fc+g.U,y.Mc=y.cc,y.Nc=y.dc+S,y.Ib=st,Pe()}}else alert("todo:EmitYUV");M&&(y.Jb=Ft,F&&se())}if(F&&!Bu){for(g=0;256>g;++g)Sa[g]=89858*(g-128)+Mc>>En,Fr[g]=-22014*(g-128)+Mc,dr[g]=-45773*(g-128),_h[g]=113618*(g-128)+Mc>>En;for(g=Ea;g<Kl;++g)y=76283*(g-16)+Mc>>En,C[g-Ea]=Ds(y,255),c[g-Ea]=Ds(y+8>>4,15);Bu=1}return 1}function Ht(g){var y=g.ma,S=g.U,F=g.T;return t(!(1&g.ka)),0>=S||0>=F?0:(S=y.Ib(g,y),y.Jb!=null&&y.Jb(g,y,S),y.Dc+=S,1)}function jt(g){g.ma.memory=null}function Tt(g,y,S,F){return re(g,8)!=47?0:(y[0]=re(g,14)+1,S[0]=re(g,14)+1,F[0]=re(g,1),re(g,3)!=0?0:!g.h)}function Xt(g,y){if(4>g)return g+1;var S=g-2>>1;return(2+(1&g)<<S)+re(y,S)+1}function _e(g,y){return 120<y?y-120:1<=(S=((S=Fd[y-1])>>4)*g+(8-(15&S)))?S:1;var S}function ue(g,y,S){var F=bt(S),M=g[y+=255&F].g-8;return 0<M&&(Ot(S,S.u+8),F=bt(S),y+=g[y].value,y+=F&(1<<M)-1),Ot(S,S.u+g[y].g),g[y].value}function Ae(g,y,S){return S.g+=g.g,S.value+=g.value<<y>>>0,t(8>=S.g),g.g}function ze(g,y,S){var F=g.xc;return t((y=F==0?0:g.vc[g.md*(S>>F)+(y>>F)])<g.Wb),g.Ya[y]}function Ve(g,y,S,F){var M=g.ab,N=g.c*y,k=g.C;y=k+y;var V=S,j=F;for(F=g.Ta,S=g.Ua;0<M--;){var K=g.gc[M],tt=k,ht=y,rt=V,At=j,St=(j=F,V=S,K.Ea);switch(t(tt<ht),t(ht<=K.nc),K.hc){case 2:Ic(rt,At,(ht-tt)*St,j,V);break;case 0:var Ct=tt,yt=ht,Et=j,Wt=V,Zt=(le=K).Ea;Ct==0&&(yu(rt,At,null,null,1,Et,Wt),Mr(rt,At+1,0,0,Zt-1,Et,Wt+1),At+=Zt,Wt+=Zt,++Ct);for(var zt=1<<le.b,ae=zt-1,de=er(Zt,le.b),Me=le.K,le=le.w+(Ct>>le.b)*de;Ct<yt;){var Ee=Me,$e=le,Tr=1;for(Xa(rt,At,Et,Wt-Zt,1,Et,Wt);Tr<Zt;){var Je=(Tr&~ae)+zt;Je>Zt&&(Je=Zt),(0,Yo[Ee[$e++]>>8&15])(rt,At+ +Tr,Et,Wt+Tr-Zt,Je-Tr,Et,Wt+Tr),Tr=Je}At+=Zt,Wt+=Zt,++Ct&ae||(le+=de)}ht!=K.nc&&n(j,V-St,j,V+(ht-tt-1)*St,St);break;case 1:for(St=rt,yt=At,Zt=(rt=K.Ea)-(Wt=rt&~(Et=(At=1<<K.b)-1)),Ct=er(rt,K.b),zt=K.K,K=K.w+(tt>>K.b)*Ct;tt<ht;){for(ae=zt,de=K,Me=new Ie,le=yt+Wt,Ee=yt+rt;yt<le;)ye(ae[de++],Me),$r(Me,St,yt,At,j,V),yt+=At,V+=At;yt<Ee&&(ye(ae[de++],Me),$r(Me,St,yt,Zt,j,V),yt+=Zt,V+=Zt),++tt&Et||(K+=Ct)}break;case 3:if(rt==j&&At==V&&0<K.b){for(yt=j,rt=St=V+(ht-tt)*St-(Wt=(ht-tt)*er(K.Ea,K.b)),At=j,Et=V,Ct=[],Wt=(Zt=Wt)-1;0<=Wt;--Wt)Ct[Wt]=At[Et+Wt];for(Wt=Zt-1;0<=Wt;--Wt)yt[rt+Wt]=Ct[Wt];to(K,tt,ht,j,St,j,V)}else to(K,tt,ht,rt,At,j,V)}V=F,j=S}j!=S&&n(F,S,V,j,N)}function Er(g,y){var S=g.V,F=g.Ba+g.c*g.C,M=y-g.C;if(t(y<=g.l.o),t(16>=M),0<M){var N=g.l,k=g.Ta,V=g.Ua,j=N.width;if(Ve(g,M,S,F),M=V=[V],t((S=g.C)<(F=y)),t(N.v<N.va),F>N.o&&(F=N.o),S<N.j){var K=N.j-S;S=N.j,M[0]+=K*j}if(S>=F?S=0:(M[0]+=4*N.v,N.ka=S-N.j,N.U=N.va-N.v,N.T=F-S,S=1),S){if(V=V[0],11>(S=g.ca).S){var tt=S.f.RGBA,ht=(F=S.S,M=N.U,N=N.T,K=tt.eb,tt.A),rt=N;for(tt=tt.fb+g.Ma*tt.A;0<rt--;){var At=k,St=V,Ct=M,yt=K,Et=tt;switch(F){case tl:ys(At,St,Ct,yt,Et);break;case Lc:Zo(At,St,Ct,yt,Et);break;case Ba:Zo(At,St,Ct,yt,Et),Ya(yt,Et,0,Ct,1,0);break;case ph:Ql(At,St,Ct,yt,Et);break;case bu:Rr(At,St,Ct,yt,Et,1);break;case gh:Rr(At,St,Ct,yt,Et,1),Ya(yt,Et,0,Ct,1,0);break;case Pc:Rr(At,St,Ct,yt,Et,0);break;case wu:Rr(At,St,Ct,yt,Et,0),Ya(yt,Et,1,Ct,1,0);break;case fA:Ns(At,St,Ct,yt,Et);break;case pA:Ns(At,St,Ct,yt,Et),Za(yt,Et,Ct,1,0);break;case Ed:ks(At,St,Ct,yt,Et);break;default:t(0)}V+=j,tt+=ht}g.Ma+=N}else alert("todo:EmitRescaledRowsYUVA");t(g.Ma<=S.height)}}g.C=y,t(g.C<=g.i)}function _r(g){var y;if(0<g.ua)return 0;for(y=0;y<g.Wb;++y){var S=g.Ya[y].G,F=g.Ya[y].H;if(0<S[1][F[1]+0].g||0<S[2][F[2]+0].g||0<S[3][F[3]+0].g)return 0}return 1}function Ur(g,y,S,F,M,N){if(g.Z!=0){var k=g.qd,V=g.rd;for(t(Ca[g.Z]!=null);y<S;++y)Ca[g.Z](k,V,F,M,F,M,N),k=F,V=M,M+=N;g.qd=k,g.rd=V}}function Vr(g,y){var S=g.l.ma,F=S.Z==0||S.Z==1?g.l.j:g.C;if(F=g.C<F?F:g.C,t(y<=g.l.o),y>F){var M=g.l.width,N=S.ca,k=S.tb+M*F,V=g.V,j=g.Ba+g.c*F,K=g.gc;t(g.ab==1),t(K[0].hc==3),Jo(K[0],F,y,V,j,N,k),Ur(S,F,y,N,k,M)}g.C=g.Ma=y}function Gr(g,y,S,F,M,N,k){var V=g.$/F,j=g.$%F,K=g.m,tt=g.s,ht=S+g.$,rt=ht;M=S+F*M;var At=S+F*N,St=280+tt.ua,Ct=g.Pb?V:16777216,yt=0<tt.ua?tt.Wa:null,Et=tt.wc,Wt=ht<At?ze(tt,j,V):null;t(g.C<N),t(At<=M);var Zt=!1;t:for(;;){for(;Zt||ht<At;){var zt=0;if(V>=Ct){var ae=ht-S;t((Ct=g).Pb),Ct.wd=Ct.m,Ct.xd=ae,0<Ct.s.ua&&fe(Ct.s.Wa,Ct.s.vb),Ct=V+ro}if(j&Et||(Wt=ze(tt,j,V)),t(Wt!=null),Wt.Qb&&(y[ht]=Wt.qb,Zt=!0),!Zt)if(qt(K),Wt.jc){zt=K,ae=y;var de=ht,Me=Wt.pd[bt(zt)&Hn-1];t(Wt.jc),256>Me.g?(Ot(zt,zt.u+Me.g),ae[de]=Me.value,zt=0):(Ot(zt,zt.u+Me.g-256),t(256<=Me.value),zt=Me.value),zt==0&&(Zt=!0)}else zt=ue(Wt.G[0],Wt.H[0],K);if(K.h)break;if(Zt||256>zt){if(!Zt)if(Wt.nd)y[ht]=(Wt.qb|zt<<8)>>>0;else{if(qt(K),Zt=ue(Wt.G[1],Wt.H[1],K),qt(K),ae=ue(Wt.G[2],Wt.H[2],K),de=ue(Wt.G[3],Wt.H[3],K),K.h)break;y[ht]=(de<<24|Zt<<16|zt<<8|ae)>>>0}if(Zt=!1,++ht,++j>=F&&(j=0,++V,k!=null&&V<=N&&!(V%16)&&k(g,V),yt!=null))for(;rt<ht;)zt=y[rt++],yt.X[(506832829*zt&4294967295)>>>yt.Mb]=zt}else if(280>zt){if(zt=Xt(zt-256,K),ae=ue(Wt.G[4],Wt.H[4],K),qt(K),ae=_e(F,ae=Xt(ae,K)),K.h)break;if(ht-S<ae||M-ht<zt)break t;for(de=0;de<zt;++de)y[ht+de]=y[ht+de-ae];for(ht+=zt,j+=zt;j>=F;)j-=F,++V,k!=null&&V<=N&&!(V%16)&&k(g,V);if(t(ht<=M),j&Et&&(Wt=ze(tt,j,V)),yt!=null)for(;rt<ht;)zt=y[rt++],yt.X[(506832829*zt&4294967295)>>>yt.Mb]=zt}else{if(!(zt<St))break t;for(Zt=zt-280,t(yt!=null);rt<ht;)zt=y[rt++],yt.X[(506832829*zt&4294967295)>>>yt.Mb]=zt;zt=ht,t(!(Zt>>>(ae=yt).Xa)),y[zt]=ae.X[Zt],Zt=!0}Zt||t(K.h==Pt(K))}if(g.Pb&&K.h&&ht<M)t(g.m.h),g.a=5,g.m=g.wd,g.$=g.xd,0<g.s.ua&&fe(g.s.vb,g.s.Wa);else{if(K.h)break t;k!=null&&k(g,V>N?N:V),g.a=0,g.$=ht-S}return 1}return g.a=3,0}function Zr(g){t(g!=null),g.vc=null,g.yc=null,g.Ya=null;var y=g.Wa;y!=null&&(y.X=null),g.vb=null,t(g!=null)}function vr(){var g=new dh;return g==null?null:(g.a=0,g.xb=Ke,cn("Predictor","VP8LPredictors"),cn("Predictor","VP8LPredictors_C"),cn("PredictorAdd","VP8LPredictorsAdd"),cn("PredictorAdd","VP8LPredictorsAdd_C"),Ic=kr,$r=or,ys=De,Zo=pn,Ns=ge,ks=yr,Ql=je,ft.VP8LMapColor32b=Xo,ft.VP8LMapColor8b=fh,g)}function Wr(g,y,S,F,M){var N=1,k=[g],V=[y],j=F.m,K=F.s,tt=null,ht=0;t:for(;;){if(S)for(;N&&re(j,1);){var rt=k,At=V,St=F,Ct=1,yt=St.m,Et=St.gc[St.ab],Wt=re(yt,2);if(St.Oc&1<<Wt)N=0;else{switch(St.Oc|=1<<Wt,Et.hc=Wt,Et.Ea=rt[0],Et.nc=At[0],Et.K=[null],++St.ab,t(4>=St.ab),Wt){case 0:case 1:Et.b=re(yt,3)+2,Ct=Wr(er(Et.Ea,Et.b),er(Et.nc,Et.b),0,St,Et.K),Et.K=Et.K[0];break;case 3:var Zt,zt=re(yt,8)+1,ae=16<zt?0:4<zt?1:2<zt?2:3;if(rt[0]=er(Et.Ea,ae),Et.b=ae,Zt=Ct=Wr(zt,1,0,St,Et.K)){var de,Me=zt,le=Et,Ee=1<<(8>>le.b),$e=s(Ee);if($e==null)Zt=0;else{var Tr=le.K[0],Je=le.w;for($e[0]=le.K[0][0],de=1;de<1*Me;++de)$e[de]=pe(Tr[Je+de],$e[de-1]);for(;de<4*Ee;++de)$e[de]=0;le.K[0]=null,le.K[0]=$e,Zt=1}}Ct=Zt;break;case 2:break;default:t(0)}N=Ct}}if(k=k[0],V=V[0],N&&re(j,1)&&!(N=1<=(ht=re(j,4))&&11>=ht)){F.a=3;break t}var mr;if(mr=N)e:{var Dr,Lr,Sn,ln=F,bn=k,Dn=V,Xr=ht,Nn=S,di=ln.m,ci=ln.s,Ti=[null],Ii=1,qi=0,no=Io[Xr];r:for(;;){if(Nn&&re(di,1)){var Fi=re(di,3)+2,ni=er(bn,Fi),cs=er(Dn,Fi),io=ni*cs;if(!Wr(ni,cs,0,ln,Ti))break r;for(Ti=Ti[0],ci.xc=Fi,Dr=0;Dr<io;++Dr){var so=Ti[Dr]>>8&65535;Ti[Dr]=so,so>=Ii&&(Ii=so+1)}}if(di.h)break r;for(Lr=0;5>Lr;++Lr){var An=Td[Lr];!Lr&&0<Xr&&(An+=1<<Xr),qi<An&&(qi=An)}var Ki=a(Ii*no,ct),Ui=Ii,ii=a(Ui,_t);if(ii==null)var il=null;else t(65536>=Ui),il=ii;var Uc=s(qi);if(il==null||Uc==null||Ki==null){ln.a=1;break r}var yi=Ki;for(Dr=Sn=0;Dr<Ii;++Dr){var Lo=il[Dr],sl=Lo.G,ol=Lo.H,al=0,mA=1,vh=0;for(Lr=0;5>Lr;++Lr){An=Td[Lr],sl[Lr]=yi,ol[Lr]=Sn,!Lr&&0<Xr&&(An+=1<<Xr);i:{var Cu,yA=An,Rc=ln,Ta=Uc,H_=yi,Hm=Sn,bh=0,Po=Rc.m,Bp=re(Po,1);if(i(Ta,0,0,yA),Bp){var z_=re(Po,1)+1,V_=re(Po,1),G_=re(Po,V_==0?1:8);Ta[G_]=1,z_==2&&(Ta[G_=re(Po,8)]=1);var wh=1}else{var xh=s(19),_A=re(Po,4)+4;if(19<_A){Rc.a=3;var Ia=0;break i}for(Cu=0;Cu<_A;++Cu)xh[xu[Cu]]=re(Po,3);var ea=void 0,Fa=void 0,zm=Rc,vA=xh,Cp=yA,Vm=Ta,_i=0,Wl=zm.m,Gm=8,Eu=a(128,ct);n:for(;at(Eu,0,7,vA,19);){if(re(Wl,1)){var bA=2+2*re(Wl,3);if((ea=2+re(Wl,bA))>Cp)break n}else ea=Cp;for(Fa=0;Fa<Cp&&ea--;){qt(Wl);var Nd=Eu[0+(127&bt(Wl))];Ot(Wl,Wl.u+Nd.g);var Su=Nd.value;if(16>Su)Vm[Fa++]=Su,Su!=0&&(Gm=Su);else{var j_=Su==16,q_=Su-16,K_=vp[q_],W_=re(Wl,Sd[q_])+K_;if(Fa+W_>Cp)break n;for(var jm=j_?Gm:0;0<W_--;)Vm[Fa++]=jm}}_i=1;break n}_i||(zm.a=3),wh=_i}(wh=wh&&!Po.h)&&(bh=at(H_,Hm,8,Ta,yA)),wh&&bh!=0?Ia=bh:(Rc.a=3,Ia=0)}if(Ia==0)break r;if(mA&&Id[Lr]==1&&(mA=yi[Sn].g==0),al+=yi[Sn].g,Sn+=Ia,3>=Lr){var kd,Qd=Uc[0];for(kd=1;kd<An;++kd)Uc[kd]>Qd&&(Qd=Uc[kd]);vh+=Qd}}if(Lo.nd=mA,Lo.Qb=0,mA&&(Lo.qb=(sl[3][ol[3]+0].value<<24|sl[1][ol[1]+0].value<<16|sl[2][ol[2]+0].value)>>>0,al==0&&256>sl[0][ol[0]+0].value&&(Lo.Qb=1,Lo.qb+=sl[0][ol[0]+0].value<<8)),Lo.jc=!Lo.Qb&&6>vh,Lo.jc){var Hd,$l=Lo;for(Hd=0;Hd<Hn;++Hd){var ra=Hd,Tu=$l.pd[ra],Iu=$l.G[0][$l.H[0]+ra];256<=Iu.value?(Tu.g=Iu.g+256,Tu.value=Iu.value):(Tu.g=0,Tu.value=0,ra>>=Ae(Iu,8,Tu),ra>>=Ae($l.G[1][$l.H[1]+ra],16,Tu),ra>>=Ae($l.G[2][$l.H[2]+ra],0,Tu),Ae($l.G[3][$l.H[3]+ra],24,Tu))}}}ci.vc=Ti,ci.Wb=Ii,ci.Ya=il,ci.yc=Ki,mr=1;break e}mr=0}if(!(N=mr)){F.a=3;break t}if(0<ht){if(K.ua=1<<ht,!ke(K.Wa,ht)){F.a=1,N=0;break t}}else K.ua=0;var Bh=F,zd=k,$_=V,Ep=Bh.s,qm=Ep.xc;if(Bh.c=zd,Bh.i=$_,Ep.md=er(zd,qm),Ep.wc=qm==0?-1:(1<<qm)-1,S){F.xb=wp;break t}if((tt=s(k*V))==null){F.a=1,N=0;break t}N=(N=Gr(F,tt,0,k,V,V,null))&&!j.h;break t}return N?(M!=null?M[0]=tt:(t(tt==null),t(S)),F.$=0,S||Zr(K)):Zr(K),N}function _n(g,y){var S=g.c*g.i,F=S+y+16*y;return t(g.c<=y),g.V=s(F),g.V==null?(g.Ta=null,g.Ua=0,g.a=1,0):(g.Ta=g.V,g.Ua=g.Ba+S+y,1)}function Rn(g,y){var S=g.C,F=y-S,M=g.V,N=g.Ba+g.c*S;for(t(y<=g.l.o);0<F;){var k=16<F?16:F,V=g.l.ma,j=g.l.width,K=j*k,tt=V.ca,ht=V.tb+j*S,rt=g.Ta,At=g.Ua;Ve(g,k,M,N),Gl(rt,At,tt,ht,K),Ur(V,S,S+k,tt,ht,j),F-=k,M+=k*g.c,S+=k}t(S==y),g.C=g.Ma=y}function Zn(){this.ub=this.yd=this.td=this.Rb=0}function Rt(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function qe(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function Te(){this.Yb=function(){var g=[];return function y(S,F,M){for(var N=M[F],k=0;k<N&&(S.push(M.length>F+1?[]:0),!(M.length<F+1));k++)y(S[k],F+1,M)}(g,0,[3,11]),g}()}function lr(){this.jb=s(3),this.Wc=o([4,8],Te),this.Xc=o([4,17],Te)}function Or(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function Fn(){this.ld=this.La=this.dd=this.tc=0}function jr(){this.Na=this.la=0}function gn(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Wn(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function mn(){this.uc=this.M=this.Nb=0,this.wa=Array(new Fn),this.Y=0,this.ya=Array(new Wn),this.aa=0,this.l=new os}function on(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Bc(){this.cb=this.a=0,this.sc="",this.m=new Be,this.Od=new Zn,this.Kc=new Rt,this.ed=new Or,this.Qa=new qe,this.Ic=this.$c=this.Aa=0,this.D=new mn,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,Be),this.ia=0,this.pb=a(4,gn),this.Pa=new lr,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new on),this.Hd=0,this.rb=Array(new jr),this.sb=0,this.wa=Array(new Fn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Wn),this.L=this.aa=0,this.gd=o([4,2],Fn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function os(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Qn(){var g=new Bc;return g!=null&&(g.a=0,g.sc="OK",g.cb=0,g.Xb=0,el||(el=Os)),g}function un(g,y,S){return g.a==0&&(g.a=y,g.sc=S,g.cb=0),0}function Cs(g,y,S){return 3<=S&&g[y+0]==157&&g[y+1]==1&&g[y+2]==42}function Ln(g,y){if(g==null)return 0;if(g.a=0,g.sc="OK",y==null)return un(g,2,"null VP8Io passed to VP8GetHeaders()");var S=y.data,F=y.w,M=y.ha;if(4>M)return un(g,7,"Truncated header.");var N=S[F+0]|S[F+1]<<8|S[F+2]<<16,k=g.Od;if(k.Rb=!(1&N),k.td=N>>1&7,k.yd=N>>4&1,k.ub=N>>5,3<k.td)return un(g,3,"Incorrect keyframe parameters.");if(!k.yd)return un(g,4,"Frame not displayable.");F+=3,M-=3;var V=g.Kc;if(k.Rb){if(7>M)return un(g,7,"cannot parse picture header");if(!Cs(S,F,M))return un(g,3,"Bad code word");V.c=16383&(S[F+4]<<8|S[F+3]),V.Td=S[F+4]>>6,V.i=16383&(S[F+6]<<8|S[F+5]),V.Ud=S[F+6]>>6,F+=7,M-=7,g.za=V.c+15>>4,g.Ub=V.i+15>>4,y.width=V.c,y.height=V.i,y.Da=0,y.j=0,y.v=0,y.va=y.width,y.o=y.height,y.da=0,y.ib=y.width,y.hb=y.height,y.U=y.width,y.T=y.height,i((N=g.Pa).jb,0,255,N.jb.length),t((N=g.Qa)!=null),N.Cb=0,N.Bb=0,N.Fb=1,i(N.Zb,0,0,N.Zb.length),i(N.Lb,0,0,N.Lb)}if(k.ub>M)return un(g,7,"bad partition length");Jt(N=g.m,S,F,k.ub),F+=k.ub,M-=k.ub,k.Rb&&(V.Ld=oe(N),V.Kd=oe(N)),V=g.Qa;var j,K=g.Pa;if(t(N!=null),t(V!=null),V.Cb=oe(N),V.Cb){if(V.Bb=oe(N),oe(N)){for(V.Fb=oe(N),j=0;4>j;++j)V.Zb[j]=oe(N)?ee(N,7):0;for(j=0;4>j;++j)V.Lb[j]=oe(N)?ee(N,6):0}if(V.Bb)for(j=0;3>j;++j)K.jb[j]=oe(N)?Yt(N,8):255}else V.Bb=0;if(N.Ka)return un(g,3,"cannot parse segment header");if((V=g.ed).zd=oe(N),V.Tb=Yt(N,6),V.wb=Yt(N,3),V.Pc=oe(N),V.Pc&&oe(N)){for(K=0;4>K;++K)oe(N)&&(V.vd[K]=ee(N,6));for(K=0;4>K;++K)oe(N)&&(V.od[K]=ee(N,6))}if(g.L=V.Tb==0?0:V.zd?1:2,N.Ka)return un(g,3,"cannot parse filter header");var tt=M;if(M=j=F,F=j+tt,V=tt,g.Xb=(1<<Yt(g.m,2))-1,tt<3*(K=g.Xb))S=7;else{for(j+=3*K,V-=3*K,tt=0;tt<K;++tt){var ht=S[M+0]|S[M+1]<<8|S[M+2]<<16;ht>V&&(ht=V),Jt(g.Jc[+tt],S,j,ht),j+=ht,V-=ht,M+=3}Jt(g.Jc[+K],S,j,V),S=j<F?0:5}if(S!=0)return un(g,S,"cannot parse partitions");for(S=Yt(j=g.m,7),M=oe(j)?ee(j,4):0,F=oe(j)?ee(j,4):0,V=oe(j)?ee(j,4):0,K=oe(j)?ee(j,4):0,j=oe(j)?ee(j,4):0,tt=g.Qa,ht=0;4>ht;++ht){if(tt.Cb){var rt=tt.Zb[ht];tt.Fb||(rt+=S)}else{if(0<ht){g.pb[ht]=g.pb[0];continue}rt=S}var At=g.pb[ht];At.Sc[0]=mh[Ds(rt+M,127)],At.Sc[1]=Vs[Ds(rt+0,127)],At.Eb[0]=2*mh[Ds(rt+F,127)],At.Eb[1]=101581*Vs[Ds(rt+V,127)]>>16,8>At.Eb[1]&&(At.Eb[1]=8),At.Qc[0]=mh[Ds(rt+K,117)],At.Qc[1]=Vs[Ds(rt+j,127)],At.lc=rt+j}if(!k.Rb)return un(g,4,"Not a key frame.");for(oe(N),k=g.Pa,S=0;4>S;++S){for(M=0;8>M;++M)for(F=0;3>F;++F)for(V=0;11>V;++V)K=ie(N,jl[S][M][F][V])?Yt(N,8):Pd[S][M][F][V],k.Wc[S][M].Yb[F][V]=K;for(M=0;17>M;++M)k.Xc[S][M]=k.Wc[S][tr[M]]}return g.kc=oe(N),g.kc&&(g.Bd=Yt(N,8)),g.cb=1}function Os(g,y,S,F,M,N,k){var V=y[M].Yb[S];for(S=0;16>M;++M){if(!ie(g,V[S+0]))return M;for(;!ie(g,V[S+1]);)if(V=y[++M].Yb[0],S=0,M==16)return 16;var j=y[M+1].Yb;if(ie(g,V[S+2])){var K=g,tt=0;if(ie(K,(rt=V)[(ht=S)+3]))if(ie(K,rt[ht+6])){for(V=0,ht=2*(tt=ie(K,rt[ht+8]))+(rt=ie(K,rt[ht+9+tt])),tt=0,rt=Qm[ht];rt[V];++V)tt+=tt+ie(K,rt[V]);tt+=3+(8<<ht)}else ie(K,rt[ht+7])?(tt=7+2*ie(K,165),tt+=ie(K,145)):tt=5+ie(K,159);else tt=ie(K,rt[ht+4])?3+ie(K,rt[ht+5]):2;V=j[2]}else tt=1,V=j[1];j=k+bp[M],0>(K=g).b&&Gt(K);var ht,rt=K.b,At=(ht=K.Ca>>1)-(K.I>>rt)>>31;--K.b,K.Ca+=At,K.Ca|=1,K.I-=(ht+1&At)<<rt,N[j]=((tt^At)-At)*F[(0<M)+0]}return 16}function Mi(g){var y=g.rb[g.sb-1];y.la=0,y.Na=0,i(g.zc,0,0,g.zc.length),g.ja=0}function ga(g,y){if(g==null)return 0;if(y==null)return un(g,2,"NULL VP8Io parameter in VP8Decode().");if(!g.cb&&!Ln(g,y))return 0;if(t(g.cb),y.ac==null||y.ac(y)){y.ob&&(g.L=0);var S=_[g.L];if(g.L==2?(g.yb=0,g.zb=0):(g.yb=y.v-S>>4,g.zb=y.j-S>>4,0>g.yb&&(g.yb=0),0>g.zb&&(g.zb=0)),g.Va=y.o+15+S>>4,g.Hb=y.va+15+S>>4,g.Hb>g.za&&(g.Hb=g.za),g.Va>g.Ub&&(g.Va=g.Ub),0<g.L){var F=g.ed;for(S=0;4>S;++S){var M;if(g.Qa.Cb){var N=g.Qa.Lb[S];g.Qa.Fb||(N+=F.Tb)}else N=F.Tb;for(M=0;1>=M;++M){var k=g.gd[S][M],V=N;if(F.Pc&&(V+=F.vd[0],M&&(V+=F.od[0])),0<(V=0>V?0:63<V?63:V)){var j=V;0<F.wb&&(j=4<F.wb?j>>2:j>>1)>9-F.wb&&(j=9-F.wb),1>j&&(j=1),k.dd=j,k.tc=2*V+j,k.ld=40<=V?2:15<=V?1:0}else k.tc=0;k.La=M}}}S=0}else un(g,6,"Frame setup failed"),S=g.a;if(S=S==0){if(S){g.$c=0,0<g.Aa||(g.Ic=T);t:{S=g.Ic,F=4*(j=g.za);var K=32*j,tt=j+1,ht=0<g.L?j*(0<g.Aa?2:1):0,rt=(g.Aa==2?2:1)*j;if((k=F+832+(M=3*(16*S+_[g.L])/2*K)+(N=g.Fa!=null&&0<g.Fa.length?g.Kc.c*g.Kc.i:0))!=k)S=0;else{if(k>g.Vb){if(g.Vb=0,g.Ec=s(k),g.Fc=0,g.Ec==null){S=un(g,1,"no memory during frame initialization.");break t}g.Vb=k}k=g.Ec,V=g.Fc,g.Ac=k,g.Bc=V,V+=F,g.Gd=a(K,on),g.Hd=0,g.rb=a(tt+1,jr),g.sb=1,g.wa=ht?a(ht,Fn):null,g.Y=0,g.D.Nb=0,g.D.wa=g.wa,g.D.Y=g.Y,0<g.Aa&&(g.D.Y+=j),t(!0),g.oc=k,g.pc=V,V+=832,g.ya=a(rt,Wn),g.aa=0,g.D.ya=g.ya,g.D.aa=g.aa,g.Aa==2&&(g.D.aa+=j),g.R=16*j,g.B=8*j,j=(K=_[g.L])*g.R,K=K/2*g.B,g.sa=k,g.ta=V+j,g.qa=g.sa,g.ra=g.ta+16*S*g.R+K,g.Ha=g.qa,g.Ia=g.ra+8*S*g.B+K,g.$c=0,V+=M,g.mb=N?k:null,g.nb=N?V:null,t(V+N<=g.Fc+g.Vb),Mi(g),i(g.Ac,g.Bc,0,F),S=1}}if(S){if(y.ka=0,y.y=g.sa,y.O=g.ta,y.f=g.qa,y.N=g.ra,y.ea=g.Ha,y.Vd=g.Ia,y.fa=g.R,y.Rc=g.B,y.F=null,y.J=0,!zs){for(S=-255;255>=S;++S)_p[255+S]=0>S?-S:S;for(S=-1020;1020>=S;++S)dA[1020+S]=-128>S?-128:127<S?127:S;for(S=-112;112>=S;++S)li[112+S]=-16>S?-16:15<S?15:S;for(S=-255;510>=S;++S)xa[255+S]=0>S?0:255<S?255:S;zs=1}So=xt,Hl=qo,ba=Il,Qs=Fl,To=dt,zl=jo,Ja=fu,Vl=Cc,ta=Ah,Hs=pu,Ei=uh,Gi=Ml,wa=gu,On=cA,Xn=Pl,Jn=Wa,hi=Ko,eo=Cd,Es[0]=wo,Es[1]=he,Es[2]=aA,Es[3]=lu,Es[4]=cu,Es[5]=uu,Es[6]=ja,Es[7]=Au,Es[8]=xd,Es[9]=ch,rl[0]=xi,rl[1]=Ze,rl[2]=Qr,rl[3]=ei,rl[4]=vn,rl[5]=au,rl[6]=zi,ji[0]=ya,ji[1]=Le,ji[2]=Bd,ji[3]=lA,ji[4]=qa,ji[5]=hu,ji[6]=Ka,S=1}else S=0}S&&(S=function(At,St){for(At.M=0;At.M<At.Va;++At.M){var Ct,yt=At.Jc[At.M&At.Xb],Et=At.m,Wt=At;for(Ct=0;Ct<Wt.za;++Ct){var Zt=Et,zt=Wt,ae=zt.Ac,de=zt.Bc+4*Ct,Me=zt.zc,le=zt.ya[zt.aa+Ct];if(zt.Qa.Bb?le.$b=ie(Zt,zt.Pa.jb[0])?2+ie(Zt,zt.Pa.jb[2]):ie(Zt,zt.Pa.jb[1]):le.$b=0,zt.kc&&(le.Ad=ie(Zt,zt.Bd)),le.Za=!ie(Zt,145)+0,le.Za){var Ee=le.Ob,$e=0;for(zt=0;4>zt;++zt){var Tr,Je=Me[0+zt];for(Tr=0;4>Tr;++Tr){Je=gA[ae[de+Tr]][Je];for(var mr=Ld[ie(Zt,Je[0])];0<mr;)mr=Ld[2*mr+ie(Zt,Je[mr])];Je=-mr,ae[de+Tr]=Je}n(Ee,$e,ae,de,4),$e+=4,Me[0+zt]=Je}}else Je=ie(Zt,156)?ie(Zt,128)?1:3:ie(Zt,163)?2:0,le.Ob[0]=Je,i(ae,de,Je,4),i(Me,0,Je,4);le.Dd=ie(Zt,142)?ie(Zt,114)?ie(Zt,183)?1:3:2:0}if(Wt.m.Ka)return un(At,7,"Premature end-of-partition0 encountered.");for(;At.ja<At.za;++At.ja){if(Wt=yt,Zt=(Et=At).rb[Et.sb-1],ae=Et.rb[Et.sb+Et.ja],Ct=Et.ya[Et.aa+Et.ja],de=Et.kc?Ct.Ad:0)Zt.la=ae.la=0,Ct.Za||(Zt.Na=ae.Na=0),Ct.Hc=0,Ct.Gc=0,Ct.ia=0;else{var Dr,Lr;if(Zt=ae,ae=Wt,de=Et.Pa.Xc,Me=Et.ya[Et.aa+Et.ja],le=Et.pb[Me.$b],zt=Me.ad,Ee=0,$e=Et.rb[Et.sb-1],Je=Tr=0,i(zt,Ee,0,384),Me.Za)var Sn=0,ln=de[3];else{mr=s(16);var bn=Zt.Na+$e.Na;if(bn=el(ae,de[1],bn,le.Eb,0,mr,0),Zt.Na=$e.Na=(0<bn)+0,1<bn)So(mr,0,zt,Ee);else{var Dn=mr[0]+3>>3;for(mr=0;256>mr;mr+=16)zt[Ee+mr]=Dn}Sn=1,ln=de[0]}var Xr=15&Zt.la,Nn=15&$e.la;for(mr=0;4>mr;++mr){var di=1&Nn;for(Dn=Lr=0;4>Dn;++Dn)Xr=Xr>>1|(di=(bn=el(ae,ln,bn=di+(1&Xr),le.Sc,Sn,zt,Ee))>Sn)<<7,Lr=Lr<<2|(3<bn?3:1<bn?2:zt[Ee+0]!=0),Ee+=16;Xr>>=4,Nn=Nn>>1|di<<7,Tr=(Tr<<8|Lr)>>>0}for(ln=Xr,Sn=Nn>>4,Dr=0;4>Dr;Dr+=2){for(Lr=0,Xr=Zt.la>>4+Dr,Nn=$e.la>>4+Dr,mr=0;2>mr;++mr){for(di=1&Nn,Dn=0;2>Dn;++Dn)bn=di+(1&Xr),Xr=Xr>>1|(di=0<(bn=el(ae,de[2],bn,le.Qc,0,zt,Ee)))<<3,Lr=Lr<<2|(3<bn?3:1<bn?2:zt[Ee+0]!=0),Ee+=16;Xr>>=2,Nn=Nn>>1|di<<5}Je|=Lr<<4*Dr,ln|=Xr<<4<<Dr,Sn|=(240&Nn)<<Dr}Zt.la=ln,$e.la=Sn,Me.Hc=Tr,Me.Gc=Je,Me.ia=43690&Je?0:le.ia,de=!(Tr|Je)}if(0<Et.L&&(Et.wa[Et.Y+Et.ja]=Et.gd[Ct.$b][Ct.Za],Et.wa[Et.Y+Et.ja].La|=!de),Wt.Ka)return un(At,7,"Premature end-of-file encountered.")}if(Mi(At),Et=St,Wt=1,Ct=(yt=At).D,Zt=0<yt.L&&yt.M>=yt.zb&&yt.M<=yt.Va,yt.Aa==0)t:{if(Ct.M=yt.M,Ct.uc=Zt,Dl(yt,Ct),Wt=1,Ct=(Lr=yt.D).Nb,Zt=(Je=_[yt.L])*yt.R,ae=Je/2*yt.B,mr=16*Ct*yt.R,Dn=8*Ct*yt.B,de=yt.sa,Me=yt.ta-Zt+mr,le=yt.qa,zt=yt.ra-ae+Dn,Ee=yt.Ha,$e=yt.Ia-ae+Dn,Nn=(Xr=Lr.M)==0,Tr=Xr>=yt.Va-1,yt.Aa==2&&Dl(yt,Lr),Lr.uc)for(di=(bn=yt).D.M,t(bn.D.uc),Lr=bn.yb;Lr<bn.Hb;++Lr){Sn=Lr,ln=di;var ci=(Ti=(An=bn).D).Nb;Dr=An.R;var Ti=Ti.wa[Ti.Y+Sn],Ii=An.sa,qi=An.ta+16*ci*Dr+16*Sn,no=Ti.dd,Fi=Ti.tc;if(Fi!=0)if(t(3<=Fi),An.L==1)0<Sn&&Jn(Ii,qi,Dr,Fi+4),Ti.La&&eo(Ii,qi,Dr,Fi),0<ln&&Xn(Ii,qi,Dr,Fi+4),Ti.La&&hi(Ii,qi,Dr,Fi);else{var ni=An.B,cs=An.qa,io=An.ra+8*ci*ni+8*Sn,so=An.Ha,An=An.Ia+8*ci*ni+8*Sn;ci=Ti.ld,0<Sn&&(Vl(Ii,qi,Dr,Fi+4,no,ci),Hs(cs,io,so,An,ni,Fi+4,no,ci)),Ti.La&&(Gi(Ii,qi,Dr,Fi,no,ci),On(cs,io,so,An,ni,Fi,no,ci)),0<ln&&(Ja(Ii,qi,Dr,Fi+4,no,ci),ta(cs,io,so,An,ni,Fi+4,no,ci)),Ti.La&&(Ei(Ii,qi,Dr,Fi,no,ci),wa(cs,io,so,An,ni,Fi,no,ci))}}if(yt.ia&&alert("todo:DitherRow"),Et.put!=null){if(Lr=16*Xr,Xr=16*(Xr+1),Nn?(Et.y=yt.sa,Et.O=yt.ta+mr,Et.f=yt.qa,Et.N=yt.ra+Dn,Et.ea=yt.Ha,Et.W=yt.Ia+Dn):(Lr-=Je,Et.y=de,Et.O=Me,Et.f=le,Et.N=zt,Et.ea=Ee,Et.W=$e),Tr||(Xr-=Je),Xr>Et.o&&(Xr=Et.o),Et.F=null,Et.J=null,yt.Fa!=null&&0<yt.Fa.length&&Lr<Xr&&(Et.J=AA(yt,Et,Lr,Xr-Lr),Et.F=yt.mb,Et.F==null&&Et.F.length==0)){Wt=un(yt,3,"Could not decode alpha data.");break t}Lr<Et.j&&(Je=Et.j-Lr,Lr=Et.j,t(!(1&Je)),Et.O+=yt.R*Je,Et.N+=yt.B*(Je>>1),Et.W+=yt.B*(Je>>1),Et.F!=null&&(Et.J+=Et.width*Je)),Lr<Xr&&(Et.O+=Et.v,Et.N+=Et.v>>1,Et.W+=Et.v>>1,Et.F!=null&&(Et.J+=Et.v),Et.ka=Lr-Et.j,Et.U=Et.va-Et.v,Et.T=Xr-Lr,Wt=Et.put(Et))}Ct+1!=yt.Ic||Tr||(n(yt.sa,yt.ta-Zt,de,Me+16*yt.R,Zt),n(yt.qa,yt.ra-ae,le,zt+8*yt.B,ae),n(yt.Ha,yt.Ia-ae,Ee,$e+8*yt.B,ae))}if(!Wt)return un(At,6,"Output aborted.")}return 1}(g,y)),y.bc!=null&&y.bc(y),S&=1}return S?(g.cb=0,S):0}function ti(g,y,S,F,M){M=g[y+S+32*F]+(M>>3),g[y+S+32*F]=-256&M?0>M?0:255:M}function as(g,y,S,F,M,N){ti(g,y,0,S,F+M),ti(g,y,1,S,F+N),ti(g,y,2,S,F-N),ti(g,y,3,S,F-M)}function wi(g){return(20091*g>>16)+g}function an(g,y,S,F){var M,N=0,k=s(16);for(M=0;4>M;++M){var V=g[y+0]+g[y+8],j=g[y+0]-g[y+8],K=(35468*g[y+4]>>16)-wi(g[y+12]),tt=wi(g[y+4])+(35468*g[y+12]>>16);k[N+0]=V+tt,k[N+1]=j+K,k[N+2]=j-K,k[N+3]=V-tt,N+=4,y++}for(M=N=0;4>M;++M)V=(g=k[N+0]+4)+k[N+8],j=g-k[N+8],K=(35468*k[N+4]>>16)-wi(k[N+12]),ti(S,F,0,0,V+(tt=wi(k[N+4])+(35468*k[N+12]>>16))),ti(S,F,1,0,j+K),ti(S,F,2,0,j-K),ti(S,F,3,0,V-tt),N++,F+=32}function jo(g,y,S,F){var M=g[y+0]+4,N=35468*g[y+4]>>16,k=wi(g[y+4]),V=35468*g[y+1]>>16;as(S,F,0,M+k,g=wi(g[y+1]),V),as(S,F,1,M+N,g,V),as(S,F,2,M-N,g,V),as(S,F,3,M-k,g,V)}function qo(g,y,S,F,M){an(g,y,S,F),M&&an(g,y+16,S,F+4)}function Il(g,y,S,F){Hl(g,y+0,S,F,1),Hl(g,y+32,S,F+128,1)}function Fl(g,y,S,F){var M;for(g=g[y+0]+4,M=0;4>M;++M)for(y=0;4>y;++y)ti(S,F,y,M,g)}function dt(g,y,S,F){g[y+0]&&Qs(g,y+0,S,F),g[y+16]&&Qs(g,y+16,S,F+4),g[y+32]&&Qs(g,y+32,S,F+128),g[y+48]&&Qs(g,y+48,S,F+128+4)}function xt(g,y,S,F){var M,N=s(16);for(M=0;4>M;++M){var k=g[y+0+M]+g[y+12+M],V=g[y+4+M]+g[y+8+M],j=g[y+4+M]-g[y+8+M],K=g[y+0+M]-g[y+12+M];N[0+M]=k+V,N[8+M]=k-V,N[4+M]=K+j,N[12+M]=K-j}for(M=0;4>M;++M)k=(g=N[0+4*M]+3)+N[3+4*M],V=N[1+4*M]+N[2+4*M],j=N[1+4*M]-N[2+4*M],K=g-N[3+4*M],S[F+0]=k+V>>3,S[F+16]=K+j>>3,S[F+32]=k-V>>3,S[F+48]=K-j>>3,F+=64}function kt(g,y,S){var F,M=y-32,N=_s,k=255-g[M-1];for(F=0;F<S;++F){var V,j=N,K=k+g[y-1];for(V=0;V<S;++V)g[y+V]=j[K+g[M+V]];y+=32}}function he(g,y){kt(g,y,4)}function Le(g,y){kt(g,y,8)}function Ze(g,y){kt(g,y,16)}function Qr(g,y){var S;for(S=0;16>S;++S)n(g,y+32*S,g,y-32,16)}function ei(g,y){var S;for(S=16;0<S;--S)i(g,y,g[y-1],16),y+=32}function $n(g,y,S){var F;for(F=0;16>F;++F)i(y,S+32*F,g,16)}function xi(g,y){var S,F=16;for(S=0;16>S;++S)F+=g[y-1+32*S]+g[y+S-32];$n(F>>5,g,y)}function vn(g,y){var S,F=8;for(S=0;16>S;++S)F+=g[y-1+32*S];$n(F>>4,g,y)}function au(g,y){var S,F=8;for(S=0;16>S;++S)F+=g[y+S-32];$n(F>>4,g,y)}function zi(g,y){$n(128,g,y)}function Ir(g,y,S){return g+2*y+S+2>>2}function aA(g,y){var S,F=y-32;for(F=new Uint8Array([Ir(g[F-1],g[F+0],g[F+1]),Ir(g[F+0],g[F+1],g[F+2]),Ir(g[F+1],g[F+2],g[F+3]),Ir(g[F+2],g[F+3],g[F+4])]),S=0;4>S;++S)n(g,y+32*S,F,0,F.length)}function lu(g,y){var S=g[y-1],F=g[y-1+32],M=g[y-1+64],N=g[y-1+96];Ce(g,y+0,16843009*Ir(g[y-1-32],S,F)),Ce(g,y+32,16843009*Ir(S,F,M)),Ce(g,y+64,16843009*Ir(F,M,N)),Ce(g,y+96,16843009*Ir(M,N,N))}function wo(g,y){var S,F=4;for(S=0;4>S;++S)F+=g[y+S-32]+g[y-1+32*S];for(F>>=3,S=0;4>S;++S)i(g,y+32*S,F,4)}function cu(g,y){var S=g[y-1+0],F=g[y-1+32],M=g[y-1+64],N=g[y-1-32],k=g[y+0-32],V=g[y+1-32],j=g[y+2-32],K=g[y+3-32];g[y+0+96]=Ir(F,M,g[y-1+96]),g[y+1+96]=g[y+0+64]=Ir(S,F,M),g[y+2+96]=g[y+1+64]=g[y+0+32]=Ir(N,S,F),g[y+3+96]=g[y+2+64]=g[y+1+32]=g[y+0+0]=Ir(k,N,S),g[y+3+64]=g[y+2+32]=g[y+1+0]=Ir(V,k,N),g[y+3+32]=g[y+2+0]=Ir(j,V,k),g[y+3+0]=Ir(K,j,V)}function ja(g,y){var S=g[y+1-32],F=g[y+2-32],M=g[y+3-32],N=g[y+4-32],k=g[y+5-32],V=g[y+6-32],j=g[y+7-32];g[y+0+0]=Ir(g[y+0-32],S,F),g[y+1+0]=g[y+0+32]=Ir(S,F,M),g[y+2+0]=g[y+1+32]=g[y+0+64]=Ir(F,M,N),g[y+3+0]=g[y+2+32]=g[y+1+64]=g[y+0+96]=Ir(M,N,k),g[y+3+32]=g[y+2+64]=g[y+1+96]=Ir(N,k,V),g[y+3+64]=g[y+2+96]=Ir(k,V,j),g[y+3+96]=Ir(V,j,j)}function uu(g,y){var S=g[y-1+0],F=g[y-1+32],M=g[y-1+64],N=g[y-1-32],k=g[y+0-32],V=g[y+1-32],j=g[y+2-32],K=g[y+3-32];g[y+0+0]=g[y+1+64]=N+k+1>>1,g[y+1+0]=g[y+2+64]=k+V+1>>1,g[y+2+0]=g[y+3+64]=V+j+1>>1,g[y+3+0]=j+K+1>>1,g[y+0+96]=Ir(M,F,S),g[y+0+64]=Ir(F,S,N),g[y+0+32]=g[y+1+96]=Ir(S,N,k),g[y+1+32]=g[y+2+96]=Ir(N,k,V),g[y+2+32]=g[y+3+96]=Ir(k,V,j),g[y+3+32]=Ir(V,j,K)}function Au(g,y){var S=g[y+0-32],F=g[y+1-32],M=g[y+2-32],N=g[y+3-32],k=g[y+4-32],V=g[y+5-32],j=g[y+6-32],K=g[y+7-32];g[y+0+0]=S+F+1>>1,g[y+1+0]=g[y+0+64]=F+M+1>>1,g[y+2+0]=g[y+1+64]=M+N+1>>1,g[y+3+0]=g[y+2+64]=N+k+1>>1,g[y+0+32]=Ir(S,F,M),g[y+1+32]=g[y+0+96]=Ir(F,M,N),g[y+2+32]=g[y+1+96]=Ir(M,N,k),g[y+3+32]=g[y+2+96]=Ir(N,k,V),g[y+3+64]=Ir(k,V,j),g[y+3+96]=Ir(V,j,K)}function ch(g,y){var S=g[y-1+0],F=g[y-1+32],M=g[y-1+64],N=g[y-1+96];g[y+0+0]=S+F+1>>1,g[y+2+0]=g[y+0+32]=F+M+1>>1,g[y+2+32]=g[y+0+64]=M+N+1>>1,g[y+1+0]=Ir(S,F,M),g[y+3+0]=g[y+1+32]=Ir(F,M,N),g[y+3+32]=g[y+1+64]=Ir(M,N,N),g[y+3+64]=g[y+2+64]=g[y+0+96]=g[y+1+96]=g[y+2+96]=g[y+3+96]=N}function xd(g,y){var S=g[y-1+0],F=g[y-1+32],M=g[y-1+64],N=g[y-1+96],k=g[y-1-32],V=g[y+0-32],j=g[y+1-32],K=g[y+2-32];g[y+0+0]=g[y+2+32]=S+k+1>>1,g[y+0+32]=g[y+2+64]=F+S+1>>1,g[y+0+64]=g[y+2+96]=M+F+1>>1,g[y+0+96]=N+M+1>>1,g[y+3+0]=Ir(V,j,K),g[y+2+0]=Ir(k,V,j),g[y+1+0]=g[y+3+32]=Ir(S,k,V),g[y+1+32]=g[y+3+64]=Ir(F,S,k),g[y+1+64]=g[y+3+96]=Ir(M,F,S),g[y+1+96]=Ir(N,M,F)}function Bd(g,y){var S;for(S=0;8>S;++S)n(g,y+32*S,g,y-32,8)}function lA(g,y){var S;for(S=0;8>S;++S)i(g,y,g[y-1],8),y+=32}function ma(g,y,S){var F;for(F=0;8>F;++F)i(y,S+32*F,g,8)}function ya(g,y){var S,F=8;for(S=0;8>S;++S)F+=g[y+S-32]+g[y-1+32*S];ma(F>>4,g,y)}function hu(g,y){var S,F=4;for(S=0;8>S;++S)F+=g[y+S-32];ma(F>>3,g,y)}function qa(g,y){var S,F=4;for(S=0;8>S;++S)F+=g[y-1+32*S];ma(F>>3,g,y)}function Ka(g,y){ma(128,g,y)}function Vi(g,y,S){var F=g[y-S],M=g[y+0],N=3*(M-F)+_u[1020+g[y-2*S]-g[y+S]],k=vu[112+(N+4>>3)];g[y-S]=_s[255+F+vu[112+(N+3>>3)]],g[y+0]=_s[255+M-k]}function yn(g,y,S,F){var M=g[y+0],N=g[y+S];return Si[255+g[y-2*S]-g[y-S]]>F||Si[255+N-M]>F}function du(g,y,S,F){return 4*Si[255+g[y-S]-g[y+0]]+Si[255+g[y-2*S]-g[y+S]]<=F}function Ll(g,y,S,F,M){var N=g[y-3*S],k=g[y-2*S],V=g[y-S],j=g[y+0],K=g[y+S],tt=g[y+2*S],ht=g[y+3*S];return 4*Si[255+V-j]+Si[255+k-K]>F?0:Si[255+g[y-4*S]-N]<=M&&Si[255+N-k]<=M&&Si[255+k-V]<=M&&Si[255+ht-tt]<=M&&Si[255+tt-K]<=M&&Si[255+K-j]<=M}function Pl(g,y,S,F){var M=2*F+1;for(F=0;16>F;++F)du(g,y+F,S,M)&&Vi(g,y+F,S)}function Wa(g,y,S,F){var M=2*F+1;for(F=0;16>F;++F)du(g,y+F*S,1,M)&&Vi(g,y+F*S,1)}function Ko(g,y,S,F){var M;for(M=3;0<M;--M)Pl(g,y+=4*S,S,F)}function Cd(g,y,S,F){var M;for(M=3;0<M;--M)Wa(g,y+=4,S,F)}function Zs(g,y,S,F,M,N,k,V){for(N=2*N+1;0<M--;){if(Ll(g,y,S,N,k))if(yn(g,y,S,V))Vi(g,y,S);else{var j=g,K=y,tt=S,ht=j[K-2*tt],rt=j[K-tt],At=j[K+0],St=j[K+tt],Ct=j[K+2*tt],yt=27*(Wt=_u[1020+3*(At-rt)+_u[1020+ht-St]])+63>>7,Et=18*Wt+63>>7,Wt=9*Wt+63>>7;j[K-3*tt]=_s[255+j[K-3*tt]+Wt],j[K-2*tt]=_s[255+ht+Et],j[K-tt]=_s[255+rt+yt],j[K+0]=_s[255+At-yt],j[K+tt]=_s[255+St-Et],j[K+2*tt]=_s[255+Ct-Wt]}y+=F}}function Wo(g,y,S,F,M,N,k,V){for(N=2*N+1;0<M--;){if(Ll(g,y,S,N,k))if(yn(g,y,S,V))Vi(g,y,S);else{var j=g,K=y,tt=S,ht=j[K-tt],rt=j[K+0],At=j[K+tt],St=vu[112+((Ct=3*(rt-ht))+4>>3)],Ct=vu[112+(Ct+3>>3)],yt=St+1>>1;j[K-2*tt]=_s[255+j[K-2*tt]+yt],j[K-tt]=_s[255+ht+Ct],j[K+0]=_s[255+rt-St],j[K+tt]=_s[255+At-yt]}y+=F}}function fu(g,y,S,F,M,N){Zs(g,y,S,1,16,F,M,N)}function Cc(g,y,S,F,M,N){Zs(g,y,1,S,16,F,M,N)}function uh(g,y,S,F,M,N){var k;for(k=3;0<k;--k)Wo(g,y+=4*S,S,1,16,F,M,N)}function Ml(g,y,S,F,M,N){var k;for(k=3;0<k;--k)Wo(g,y+=4,1,S,16,F,M,N)}function Ah(g,y,S,F,M,N,k,V){Zs(g,y,M,1,8,N,k,V),Zs(S,F,M,1,8,N,k,V)}function pu(g,y,S,F,M,N,k,V){Zs(g,y,1,M,8,N,k,V),Zs(S,F,1,M,8,N,k,V)}function gu(g,y,S,F,M,N,k,V){Wo(g,y+4*M,M,1,8,N,k,V),Wo(S,F+4*M,M,1,8,N,k,V)}function cA(g,y,S,F,M,N,k,V){Wo(g,y+4,1,M,8,N,k,V),Wo(S,F+4,1,M,8,N,k,V)}function xo(){this.ba=new Jr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Z,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function mu(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function uA(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function hh(){this.ua=0,this.Wa=new lt,this.vb=new lt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new _t,this.yc=new ct}function dh(){this.xb=this.a=0,this.l=new os,this.ca=new Jr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new it,this.Pb=0,this.wd=new it,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new hh,this.ab=0,this.gc=a(4,uA),this.Oc=0}function _a(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new os,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ec(g,y,S,F,M,N,k){for(g=g==null?0:g[y+0],y=0;y<k;++y)M[N+y]=g+S[F+y]&255,g=M[N+y]}function Ul(g,y,S,F,M,N,k){var V;if(g==null)Ec(null,null,S,F,M,N,k);else for(V=0;V<k;++V)M[N+V]=g[y+V]+S[F+V]&255}function Rl(g,y,S,F,M,N,k){if(g==null)Ec(null,null,S,F,M,N,k);else{var V,j=g[y+0],K=j,tt=j;for(V=0;V<k;++V)K=tt+(j=g[y+V])-K,tt=S[F+V]+(-256&K?0>K?0:255:K)&255,K=j,M[N+V]=tt}}function AA(g,y,S,F){var M=y.width,N=y.o;if(t(g!=null&&y!=null),0>S||0>=F||S+F>N)return null;if(!g.Cc){if(g.ga==null){var k;if(g.ga=new _a,(k=g.ga==null)||(k=y.width*y.o,t(g.Gb.length==0),g.Gb=s(k),g.Uc=0,g.Gb==null?k=0:(g.mb=g.Gb,g.nb=g.Uc,g.rc=null,k=1),k=!k),!k){k=g.ga;var V=g.Fa,j=g.P,K=g.qc,tt=g.mb,ht=g.nb,rt=j+1,At=K-1,St=k.l;if(t(V!=null&&tt!=null&&y!=null),Ca[0]=null,Ca[1]=Ec,Ca[2]=Ul,Ca[3]=Rl,k.ca=tt,k.tb=ht,k.c=y.width,k.i=y.height,t(0<k.c&&0<k.i),1>=K)y=0;else if(k.$a=V[j+0]>>0&3,k.Z=V[j+0]>>2&3,k.Lc=V[j+0]>>4&3,j=V[j+0]>>6&3,0>k.$a||1<k.$a||4<=k.Z||1<k.Lc||j)y=0;else if(St.put=Ht,St.ac=Nt,St.bc=jt,St.ma=k,St.width=y.width,St.height=y.height,St.Da=y.Da,St.v=y.v,St.va=y.va,St.j=y.j,St.o=y.o,k.$a)t:{t(k.$a==1),y=vr();e:for(;;){if(y==null){y=0;break t}if(t(k!=null),k.mc=y,y.c=k.c,y.i=k.i,y.l=k.l,y.l.ma=k,y.l.width=k.c,y.l.height=k.i,y.a=0,$t(y.m,V,rt,At),!Wr(k.c,k.i,1,y,null)||(y.ab==1&&y.gc[0].hc==3&&_r(y.s)?(k.ic=1,V=y.c*y.i,y.Ta=null,y.Ua=0,y.V=s(V),y.Ba=0,y.V==null?(y.a=1,y=0):y=1):(k.ic=0,y=_n(y,k.c)),!y))break e;y=1;break t}k.mc=null,y=0}else y=At>=k.c*k.i;k=!y}if(k)return null;g.ga.Lc!=1?g.Ga=0:F=N-S}t(g.ga!=null),t(S+F<=N);t:{if(y=(V=g.ga).c,N=V.l.o,V.$a==0){if(rt=g.rc,At=g.Vc,St=g.Fa,j=g.P+1+S*y,K=g.mb,tt=g.nb+S*y,t(j<=g.P+g.qc),V.Z!=0)for(t(Ca[V.Z]!=null),k=0;k<F;++k)Ca[V.Z](rt,At,St,j,K,tt,y),rt=K,At=tt,tt+=y,j+=y;else for(k=0;k<F;++k)n(K,tt,St,j,y),rt=K,At=tt,tt+=y,j+=y;g.rc=rt,g.Vc=At}else{if(t(V.mc!=null),y=S+F,t((k=V.mc)!=null),t(y<=k.i),k.C>=y)y=1;else if(V.ic||se(),V.ic){V=k.V,rt=k.Ba,At=k.c;var Ct=k.i,yt=(St=1,j=k.$/At,K=k.$%At,tt=k.m,ht=k.s,k.$),Et=At*Ct,Wt=At*y,Zt=ht.wc,zt=yt<Wt?ze(ht,K,j):null;t(yt<=Et),t(y<=Ct),t(_r(ht));e:for(;;){for(;!tt.h&&yt<Wt;){if(K&Zt||(zt=ze(ht,K,j)),t(zt!=null),qt(tt),256>(Ct=ue(zt.G[0],zt.H[0],tt)))V[rt+yt]=Ct,++yt,++K>=At&&(K=0,++j<=y&&!(j%16)&&Vr(k,j));else{if(!(280>Ct)){St=0;break e}Ct=Xt(Ct-256,tt);var ae,de=ue(zt.G[4],zt.H[4],tt);if(qt(tt),!(yt>=(de=_e(At,de=Xt(de,tt)))&&Et-yt>=Ct)){St=0;break e}for(ae=0;ae<Ct;++ae)V[rt+yt+ae]=V[rt+yt+ae-de];for(yt+=Ct,K+=Ct;K>=At;)K-=At,++j<=y&&!(j%16)&&Vr(k,j);yt<Wt&&K&Zt&&(zt=ze(ht,K,j))}t(tt.h==Pt(tt))}Vr(k,j>y?y:j);break e}!St||tt.h&&yt<Et?(St=0,k.a=tt.h?5:3):k.$=yt,y=St}else y=Gr(k,k.V,k.Ba,k.c,k.i,y,Rn);if(!y){F=0;break t}}S+F>=N&&(g.Cc=1),F=1}if(!F)return null;if(g.Cc&&((F=g.ga)!=null&&(F.mc=null),g.ga=null,0<g.Ga))return alert("todo:WebPDequantizeLevels"),null}return g.nb+S*M}function D(g,y,S,F,M,N){for(;0<M--;){var k,V=g,j=y+(S?1:0),K=g,tt=y+(S?0:3);for(k=0;k<F;++k){var ht=K[tt+4*k];ht!=255&&(ht*=32897,V[j+4*k+0]=V[j+4*k+0]*ht>>23,V[j+4*k+1]=V[j+4*k+1]*ht>>23,V[j+4*k+2]=V[j+4*k+2]*ht>>23)}y+=N}}function nt(g,y,S,F,M){for(;0<F--;){var N;for(N=0;N<S;++N){var k=g[y+2*N+0],V=15&(K=g[y+2*N+1]),j=4369*V,K=(240&K|K>>4)*j>>16;g[y+2*N+0]=(240&k|k>>4)*j>>16&240|(15&k|k<<4)*j>>16>>4&15,g[y+2*N+1]=240&K|V}y+=M}}function Ut(g,y,S,F,M,N,k,V){var j,K,tt=255;for(K=0;K<M;++K){for(j=0;j<F;++j){var ht=g[y+j];N[k+4*j]=ht,tt&=ht}y+=S,k+=V}return tt!=255}function Vt(g,y,S,F,M){var N;for(N=0;N<M;++N)S[F+N]=g[y+N]>>8}function se(){Ya=D,Za=nt,Fc=Ut,Gl=Vt}function me(g,y,S){ft[g]=function(F,M,N,k,V,j,K,tt,ht,rt,At,St,Ct,yt,Et,Wt,Zt){var zt,ae=Zt-1>>1,de=V[j+0]|K[tt+0]<<16,Me=ht[rt+0]|At[St+0]<<16;t(F!=null);var le=3*de+Me+131074>>2;for(y(F[M+0],255&le,le>>16,Ct,yt),N!=null&&(le=3*Me+de+131074>>2,y(N[k+0],255&le,le>>16,Et,Wt)),zt=1;zt<=ae;++zt){var Ee=V[j+zt]|K[tt+zt]<<16,$e=ht[rt+zt]|At[St+zt]<<16,Tr=de+Ee+Me+$e+524296,Je=Tr+2*(Ee+Me)>>3;le=Je+de>>1,de=(Tr=Tr+2*(de+$e)>>3)+Ee>>1,y(F[M+2*zt-1],255&le,le>>16,Ct,yt+(2*zt-1)*S),y(F[M+2*zt-0],255&de,de>>16,Ct,yt+(2*zt-0)*S),N!=null&&(le=Tr+Me>>1,de=Je+$e>>1,y(N[k+2*zt-1],255&le,le>>16,Et,Wt+(2*zt-1)*S),y(N[k+2*zt+0],255&de,de>>16,Et,Wt+(2*zt+0)*S)),de=Ee,Me=$e}1&Zt||(le=3*de+Me+131074>>2,y(F[M+Zt-1],255&le,le>>16,Ct,yt+(Zt-1)*S),N!=null&&(le=3*Me+de+131074>>2,y(N[k+Zt-1],255&le,le>>16,Et,Wt+(Zt-1)*S)))}}function Pe(){Fo[tl]=xp,Fo[Lc]=Ud,Fo[ph]=Md,Fo[bu]=nl,Fo[Pc]=Rd,Fo[fA]=yh,Fo[Ed]=ql,Fo[Ba]=Ud,Fo[gh]=nl,Fo[wu]=Rd,Fo[pA]=yh}function rr(g){return g&~Dd?0>g?0:255:g>>Od}function Pr(g,y){return rr((19077*g>>8)+(26149*y>>8)-14234)}function qr(g,y,S){return rr((19077*g>>8)-(6419*y>>8)-(13320*S>>8)+8708)}function Br(g,y){return rr((19077*g>>8)+(33050*y>>8)-17685)}function dn(g,y,S,F,M){F[M+0]=Pr(g,S),F[M+1]=qr(g,y,S),F[M+2]=Br(g,y)}function gr(g,y,S,F,M){F[M+0]=Br(g,y),F[M+1]=qr(g,y,S),F[M+2]=Pr(g,S)}function ri(g,y,S,F,M){var N=qr(g,y,S);y=N<<3&224|Br(g,y)>>3,F[M+0]=248&Pr(g,S)|N>>5,F[M+1]=y}function Yr(g,y,S,F,M){var N=240&Br(g,y)|15;F[M+0]=240&Pr(g,S)|qr(g,y,S)>>4,F[M+1]=N}function en(g,y,S,F,M){F[M+0]=255,dn(g,y,S,F,M+1)}function Bi(g,y,S,F,M){gr(g,y,S,F,M),F[M+3]=255}function Bo(g,y,S,F,M){dn(g,y,S,F,M),F[M+3]=255}function Ds(g,y){return 0>g?0:g>y?y:g}function $a(g,y,S){ft[g]=function(F,M,N,k,V,j,K,tt,ht){for(var rt=tt+(-2&ht)*S;tt!=rt;)y(F[M+0],N[k+0],V[j+0],K,tt),y(F[M+1],N[k+0],V[j+0],K,tt+S),M+=2,++k,++j,tt+=2*S;1&ht&&y(F[M+0],N[k+0],V[j+0],K,tt)}}function hA(g,y,S){return S==0?g==0?y==0?6:5:y==0?4:0:S}function Ol(g,y,S,F,M){switch(g>>>30){case 3:Hl(y,S,F,M,0);break;case 2:zl(y,S,F,M);break;case 1:Qs(y,S,F,M)}}function Dl(g,y){var S,F,M=y.M,N=y.Nb,k=g.oc,V=g.pc+40,j=g.oc,K=g.pc+584,tt=g.oc,ht=g.pc+600;for(S=0;16>S;++S)k[V+32*S-1]=129;for(S=0;8>S;++S)j[K+32*S-1]=129,tt[ht+32*S-1]=129;for(0<M?k[V-1-32]=j[K-1-32]=tt[ht-1-32]=129:(i(k,V-32-1,127,21),i(j,K-32-1,127,9),i(tt,ht-32-1,127,9)),F=0;F<g.za;++F){var rt=y.ya[y.aa+F];if(0<F){for(S=-1;16>S;++S)n(k,V+32*S-4,k,V+32*S+12,4);for(S=-1;8>S;++S)n(j,K+32*S-4,j,K+32*S+4,4),n(tt,ht+32*S-4,tt,ht+32*S+4,4)}var At=g.Gd,St=g.Hd+F,Ct=rt.ad,yt=rt.Hc;if(0<M&&(n(k,V-32,At[St].y,0,16),n(j,K-32,At[St].f,0,8),n(tt,ht-32,At[St].ea,0,8)),rt.Za){var Et=k,Wt=V-32+16;for(0<M&&(F>=g.za-1?i(Et,Wt,At[St].y[15],4):n(Et,Wt,At[St+1].y,0,4)),S=0;4>S;S++)Et[Wt+128+S]=Et[Wt+256+S]=Et[Wt+384+S]=Et[Wt+0+S];for(S=0;16>S;++S,yt<<=2)Et=k,Wt=V+d[S],Es[rt.Ob[S]](Et,Wt),Ol(yt,Ct,16*+S,Et,Wt)}else if(Et=hA(F,M,rt.Ob[0]),rl[Et](k,V),yt!=0)for(S=0;16>S;++S,yt<<=2)Ol(yt,Ct,16*+S,k,V+d[S]);for(S=rt.Gc,Et=hA(F,M,rt.Dd),ji[Et](j,K),ji[Et](tt,ht),yt=Ct,Et=j,Wt=K,255&(rt=S>>0)&&(170&rt?ba(yt,256,Et,Wt):To(yt,256,Et,Wt)),rt=tt,yt=ht,255&(S>>=8)&&(170&S?ba(Ct,320,rt,yt):To(Ct,320,rt,yt)),M<g.Ub-1&&(n(At[St].y,0,k,V+480,16),n(At[St].f,0,j,K+224,8),n(At[St].ea,0,tt,ht+224,8)),S=8*N*g.B,At=g.sa,St=g.ta+16*F+16*N*g.R,Ct=g.qa,rt=g.ra+8*F+S,yt=g.Ha,Et=g.Ia+8*F+S,S=0;16>S;++S)n(At,St+S*g.R,k,V+32*S,16);for(S=0;8>S;++S)n(Ct,rt+S*g.B,j,K+32*S,8),n(yt,Et+S*g.B,tt,ht+32*S,8)}}function va(g,y,S,F,M,N,k,V,j){var K=[0],tt=[0],ht=0,rt=j!=null?j.kd:0,At=j??new mu;if(g==null||12>S)return 7;At.data=g,At.w=y,At.ha=S,y=[y],S=[S],At.gb=[At.gb];t:{var St=y,Ct=S,yt=At.gb;if(t(g!=null),t(Ct!=null),t(yt!=null),yt[0]=0,12<=Ct[0]&&!e(g,St[0],"RIFF")){if(e(g,St[0]+8,"WEBP")){yt=3;break t}var Et=Ne(g,St[0]+4);if(12>Et||4294967286<Et){yt=3;break t}if(rt&&Et>Ct[0]-8){yt=7;break t}yt[0]=Et,St[0]+=12,Ct[0]-=12}yt=0}if(yt!=0)return yt;for(Et=0<At.gb[0],S=S[0];;){t:{var Wt=g;Ct=y,yt=S;var Zt=K,zt=tt,ae=St=[0];if((le=ht=[ht])[0]=0,8>yt[0])yt=7;else{if(!e(Wt,Ct[0],"VP8X")){if(Ne(Wt,Ct[0]+4)!=10){yt=3;break t}if(18>yt[0]){yt=7;break t}var de=Ne(Wt,Ct[0]+8),Me=1+Re(Wt,Ct[0]+12);if(2147483648<=Me*(Wt=1+Re(Wt,Ct[0]+15))){yt=3;break t}ae!=null&&(ae[0]=de),Zt!=null&&(Zt[0]=Me),zt!=null&&(zt[0]=Wt),Ct[0]+=18,yt[0]-=18,le[0]=1}yt=0}}if(ht=ht[0],St=St[0],yt!=0)return yt;if(Ct=!!(2&St),!Et&&ht)return 3;if(N!=null&&(N[0]=!!(16&St)),k!=null&&(k[0]=Ct),V!=null&&(V[0]=0),k=K[0],St=tt[0],ht&&Ct&&j==null){yt=0;break}if(4>S){yt=7;break}if(Et&&ht||!Et&&!ht&&!e(g,y[0],"ALPH")){S=[S],At.na=[At.na],At.P=[At.P],At.Sa=[At.Sa];t:{de=g,yt=y,Et=S;var le=At.gb;Zt=At.na,zt=At.P,ae=At.Sa,Me=22,t(de!=null),t(Et!=null),Wt=yt[0];var Ee=Et[0];for(t(Zt!=null),t(ae!=null),Zt[0]=null,zt[0]=null,ae[0]=0;;){if(yt[0]=Wt,Et[0]=Ee,8>Ee){yt=7;break t}var $e=Ne(de,Wt+4);if(4294967286<$e){yt=3;break t}var Tr=8+$e+1&-2;if(Me+=Tr,0<le&&Me>le){yt=3;break t}if(!e(de,Wt,"VP8 ")||!e(de,Wt,"VP8L")){yt=0;break t}if(Ee[0]<Tr){yt=7;break t}e(de,Wt,"ALPH")||(Zt[0]=de,zt[0]=Wt+8,ae[0]=$e),Wt+=Tr,Ee-=Tr}}if(S=S[0],At.na=At.na[0],At.P=At.P[0],At.Sa=At.Sa[0],yt!=0)break}S=[S],At.Ja=[At.Ja],At.xa=[At.xa];t:if(le=g,yt=y,Et=S,Zt=At.gb[0],zt=At.Ja,ae=At.xa,de=yt[0],Wt=!e(le,de,"VP8 "),Me=!e(le,de,"VP8L"),t(le!=null),t(Et!=null),t(zt!=null),t(ae!=null),8>Et[0])yt=7;else{if(Wt||Me){if(le=Ne(le,de+4),12<=Zt&&le>Zt-12){yt=3;break t}if(rt&&le>Et[0]-8){yt=7;break t}zt[0]=le,yt[0]+=8,Et[0]-=8,ae[0]=Me}else ae[0]=5<=Et[0]&&le[de+0]==47&&!(le[de+4]>>5),zt[0]=Et[0];yt=0}if(S=S[0],At.Ja=At.Ja[0],At.xa=At.xa[0],y=y[0],yt!=0)break;if(4294967286<At.Ja)return 3;if(V==null||Ct||(V[0]=At.xa?2:1),k=[k],St=[St],At.xa){if(5>S){yt=7;break}V=k,rt=St,Ct=N,g==null||5>S?g=0:5<=S&&g[y+0]==47&&!(g[y+4]>>5)?(Et=[0],le=[0],Zt=[0],$t(zt=new it,g,y,S),Tt(zt,Et,le,Zt)?(V!=null&&(V[0]=Et[0]),rt!=null&&(rt[0]=le[0]),Ct!=null&&(Ct[0]=Zt[0]),g=1):g=0):g=0}else{if(10>S){yt=7;break}V=St,g==null||10>S||!Cs(g,y+3,S-3)?g=0:(rt=g[y+0]|g[y+1]<<8|g[y+2]<<16,Ct=16383&(g[y+7]<<8|g[y+6]),g=16383&(g[y+9]<<8|g[y+8]),1&rt||3<(rt>>1&7)||!(rt>>4&1)||rt>>5>=At.Ja||!Ct||!g?g=0:(k&&(k[0]=Ct),V&&(V[0]=g),g=1))}if(!g||(k=k[0],St=St[0],ht&&(K[0]!=k||tt[0]!=St)))return 3;j!=null&&(j[0]=At,j.offset=y-j.w,t(4294967286>y-j.w),t(j.offset==j.ha-S));break}return yt==0||yt==7&&ht&&j==null?(N!=null&&(N[0]|=At.na!=null&&0<At.na.length),F!=null&&(F[0]=k),M!=null&&(M[0]=St),0):yt}function Nl(g,y,S){var F=y.width,M=y.height,N=0,k=0,V=F,j=M;if(y.Da=g!=null&&0<g.Da,y.Da&&(V=g.cd,j=g.bd,N=g.v,k=g.j,11>S||(N&=-2,k&=-2),0>N||0>k||0>=V||0>=j||N+V>F||k+j>M))return 0;if(y.v=N,y.j=k,y.va=N+V,y.o=k+j,y.U=V,y.T=j,y.da=g!=null&&0<g.da,y.da){if(!pr(V,j,S=[g.ib],N=[g.hb]))return 0;y.ib=S[0],y.hb=N[0]}return y.ob=g!=null&&g.ob,y.Kb=g==null||!g.Sd,y.da&&(y.ob=y.ib<3*F/4&&y.hb<3*M/4,y.Kb=0),1}function Co(g){if(g==null)return 2;if(11>g.S){var y=g.f.RGBA;y.fb+=(g.height-1)*y.A,y.A=-y.A}else y=g.f.kb,g=g.height,y.O+=(g-1)*y.fa,y.fa=-y.fa,y.N+=(g-1>>1)*y.Ab,y.Ab=-y.Ab,y.W+=(g-1>>1)*y.Db,y.Db=-y.Db,y.F!=null&&(y.J+=(g-1)*y.lb,y.lb=-y.lb);return 0}function Eo(g,y,S,F){if(F==null||0>=g||0>=y)return 2;if(S!=null){if(S.Da){var M=S.cd,N=S.bd,k=-2&S.v,V=-2&S.j;if(0>k||0>V||0>=M||0>=N||k+M>g||V+N>y)return 2;g=M,y=N}if(S.da){if(!pr(g,y,M=[S.ib],N=[S.hb]))return 2;g=M[0],y=N[0]}}F.width=g,F.height=y;t:{var j=F.width,K=F.height;if(g=F.S,0>=j||0>=K||!(g>=tl&&13>g))g=2;else{if(0>=F.Rd&&F.sd==null){k=N=M=y=0;var tt=(V=j*U[g])*K;if(11>g||(N=(K+1)/2*(y=(j+1)/2),g==12&&(k=(M=j)*K)),(K=s(tt+2*N+k))==null){g=1;break t}F.sd=K,11>g?((j=F.f.RGBA).eb=K,j.fb=0,j.A=V,j.size=tt):((j=F.f.kb).y=K,j.O=0,j.fa=V,j.Fd=tt,j.f=K,j.N=0+tt,j.Ab=y,j.Cd=N,j.ea=K,j.W=0+tt+N,j.Db=y,j.Ed=N,g==12&&(j.F=K,j.J=0+tt+2*N),j.Tc=k,j.lb=M)}if(y=1,M=F.S,N=F.width,k=F.height,M>=tl&&13>M)if(11>M)g=F.f.RGBA,y&=(V=Math.abs(g.A))*(k-1)+N<=g.size,y&=V>=N*U[M],y&=g.eb!=null;else{g=F.f.kb,V=(N+1)/2,tt=(k+1)/2,j=Math.abs(g.fa),K=Math.abs(g.Ab);var ht=Math.abs(g.Db),rt=Math.abs(g.lb),At=rt*(k-1)+N;y&=j*(k-1)+N<=g.Fd,y&=K*(tt-1)+V<=g.Cd,y=(y&=ht*(tt-1)+V<=g.Ed)&j>=N&K>=V&ht>=V,y&=g.y!=null,y&=g.f!=null,y&=g.ea!=null,M==12&&(y&=rt>=N,y&=At<=g.Tc,y&=g.F!=null)}else y=0;g=y?0:2}}return g!=0||S!=null&&S.fd&&(g=Co(F)),g}var Hn=64,Sc=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Tc=24,kl=32,$o=8,ls=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];we("Predictor0","PredictorAdd0"),ft.Predictor0=function(){return 4278190080},ft.Predictor1=function(g){return g},ft.Predictor2=function(g,y,S){return y[S+0]},ft.Predictor3=function(g,y,S){return y[S+1]},ft.Predictor4=function(g,y,S){return y[S-1]},ft.Predictor5=function(g,y,S){return Oe(Oe(g,y[S+1]),y[S+0])},ft.Predictor6=function(g,y,S){return Oe(g,y[S-1])},ft.Predictor7=function(g,y,S){return Oe(g,y[S+0])},ft.Predictor8=function(g,y,S){return Oe(y[S-1],y[S+0])},ft.Predictor9=function(g,y,S){return Oe(y[S+0],y[S+1])},ft.Predictor10=function(g,y,S){return Oe(Oe(g,y[S-1]),Oe(y[S+0],y[S+1]))},ft.Predictor11=function(g,y,S){var F=y[S+0];return 0>=Sr(F>>24&255,g>>24&255,(y=y[S-1])>>24&255)+Sr(F>>16&255,g>>16&255,y>>16&255)+Sr(F>>8&255,g>>8&255,y>>8&255)+Sr(255&F,255&g,255&y)?F:g},ft.Predictor12=function(g,y,S){var F=y[S+0];return(nr((g>>24&255)+(F>>24&255)-((y=y[S-1])>>24&255))<<24|nr((g>>16&255)+(F>>16&255)-(y>>16&255))<<16|nr((g>>8&255)+(F>>8&255)-(y>>8&255))<<8|nr((255&g)+(255&F)-(255&y)))>>>0},ft.Predictor13=function(g,y,S){var F=y[S-1];return(hr((g=Oe(g,y[S+0]))>>24&255,F>>24&255)<<24|hr(g>>16&255,F>>16&255)<<16|hr(g>>8&255,F>>8&255)<<8|hr(g>>0&255,F>>0&255))>>>0};var yu=ft.PredictorAdd0;ft.PredictorAdd1=Mr,we("Predictor2","PredictorAdd2"),we("Predictor3","PredictorAdd3"),we("Predictor4","PredictorAdd4"),we("Predictor5","PredictorAdd5"),we("Predictor6","PredictorAdd6"),we("Predictor7","PredictorAdd7"),we("Predictor8","PredictorAdd8"),we("Predictor9","PredictorAdd9"),we("Predictor10","PredictorAdd10"),we("Predictor11","PredictorAdd11"),we("Predictor12","PredictorAdd12"),we("Predictor13","PredictorAdd13");var Xa=ft.PredictorAdd2;xr("ColorIndexInverseTransform","MapARGB","32b",function(g){return g>>8&255},function(g){return g}),xr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(g){return g},function(g){return g>>8&255});var Ic,to=ft.ColorIndexInverseTransform,Xo=ft.MapARGB,Jo=ft.VP8LColorIndexInverseTransformAlpha,fh=ft.MapAlpha,Yo=ft.VP8LPredictorsAdd=[];Yo.length=16,(ft.VP8LPredictors=[]).length=16,(ft.VP8LPredictorsAdd_C=[]).length=16,(ft.VP8LPredictors_C=[]).length=16;var $r,ys,Zo,Ns,ks,Ql,So,Hl,zl,ba,Qs,To,Ja,Vl,ta,Hs,Ei,Gi,wa,On,Xn,Jn,hi,eo,Ya,Za,Fc,Gl,_p=s(511),dA=s(2041),li=s(225),xa=s(767),zs=0,_u=dA,vu=li,_s=xa,Si=_p,tl=0,Lc=1,ph=2,bu=3,Pc=4,fA=5,Ed=6,Ba=7,gh=8,wu=9,pA=10,Sd=[2,3,7],vp=[3,3,11],Td=[280,256,256,256,40],Id=[0,1,1,1,0],xu=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Fd=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Io=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ro=8,mh=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Vs=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],el=null,Qm=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],bp=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Ld=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Pd=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],gA=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],jl=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],tr=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],rl=[],Es=[],ji=[],wp=1,Ke=2,Ca=[],Fo=[];me("UpsampleRgbLinePair",dn,3),me("UpsampleBgrLinePair",gr,3),me("UpsampleRgbaLinePair",Bo,4),me("UpsampleBgraLinePair",Bi,4),me("UpsampleArgbLinePair",en,4),me("UpsampleRgba4444LinePair",Yr,2),me("UpsampleRgb565LinePair",ri,2);var xp=ft.UpsampleRgbLinePair,Md=ft.UpsampleBgrLinePair,Ud=ft.UpsampleRgbaLinePair,nl=ft.UpsampleBgraLinePair,Rd=ft.UpsampleArgbLinePair,yh=ft.UpsampleRgba4444LinePair,ql=ft.UpsampleRgb565LinePair,En=16,Mc=1<<En-1,Ea=-227,Kl=482,Od=6,Dd=(256<<Od)-1,Bu=0,Sa=s(256),_h=s(256),dr=s(256),Fr=s(256),C=s(Kl-Ea),c=s(Kl-Ea);$a("YuvToRgbRow",dn,3),$a("YuvToBgrRow",gr,3),$a("YuvToRgbaRow",Bo,4),$a("YuvToBgraRow",Bi,4),$a("YuvToArgbRow",en,4),$a("YuvToRgba4444Row",Yr,2),$a("YuvToRgb565Row",ri,2);var d=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],_=[0,2,8],w=[8,7,6,4,4,2,2,2,1,1,1,1],T=1;this.WebPDecodeRGBA=function(g,y,S,F,M){var N=Lc,k=new xo,V=new Jr;k.ba=V,V.S=N,V.width=[V.width],V.height=[V.height];var j=V.width,K=V.height,tt=new Bt;if(tt==null||g==null)var ht=2;else t(tt!=null),ht=va(g,y,S,tt.width,tt.height,tt.Pd,tt.Qd,tt.format,null);if(ht!=0?j=0:(j!=null&&(j[0]=tt.width[0]),K!=null&&(K[0]=tt.height[0]),j=1),j){V.width=V.width[0],V.height=V.height[0],F!=null&&(F[0]=V.width),M!=null&&(M[0]=V.height);t:{if(F=new os,(M=new mu).data=g,M.w=y,M.ha=S,M.kd=1,y=[0],t(M!=null),((g=va(M.data,M.w,M.ha,null,null,null,y,null,M))==0||g==7)&&y[0]&&(g=4),(y=g)==0){if(t(k!=null),F.data=M.data,F.w=M.w+M.offset,F.ha=M.ha-M.offset,F.put=Ht,F.ac=Nt,F.bc=jt,F.ma=k,M.xa){if((g=vr())==null){k=1;break t}if(function(rt,At){var St=[0],Ct=[0],yt=[0];e:for(;;){if(rt==null)return 0;if(At==null)return rt.a=2,0;if(rt.l=At,rt.a=0,$t(rt.m,At.data,At.w,At.ha),!Tt(rt.m,St,Ct,yt)){rt.a=3;break e}if(rt.xb=Ke,At.width=St[0],At.height=Ct[0],!Wr(St[0],Ct[0],1,rt,null))break e;return 1}return t(rt.a!=0),0}(g,F)){if(F=(y=Eo(F.width,F.height,k.Oa,k.ba))==0){e:{F=g;r:for(;;){if(F==null){F=0;break e}if(t(F.s.yc!=null),t(F.s.Ya!=null),t(0<F.s.Wb),t((S=F.l)!=null),t((M=S.ma)!=null),F.xb!=0){if(F.ca=M.ba,F.tb=M.tb,t(F.ca!=null),!Nl(M.Oa,S,bu)){F.a=2;break r}if(!_n(F,S.width)||S.da)break r;if((S.da||He(F.ca.S))&&se(),11>F.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),F.ca.f.kb.F!=null&&se()),F.Pb&&0<F.s.ua&&F.s.vb.X==null&&!ke(F.s.vb,F.s.Wa.Xa)){F.a=1;break r}F.xb=0}if(!Gr(F,F.V,F.Ba,F.c,F.i,S.o,Er))break r;M.Dc=F.Ma,F=1;break e}t(F.a!=0),F=0}F=!F}F&&(y=g.a)}else y=g.a}else{if((g=new Qn)==null){k=1;break t}if(g.Fa=M.na,g.P=M.P,g.qc=M.Sa,Ln(g,F)){if((y=Eo(F.width,F.height,k.Oa,k.ba))==0){if(g.Aa=0,S=k.Oa,t((M=g)!=null),S!=null){if(0<(j=0>(j=S.Md)?0:100<j?255:255*j/100)){for(K=tt=0;4>K;++K)12>(ht=M.pb[K]).lc&&(ht.ia=j*w[0>ht.lc?0:ht.lc]>>3),tt|=ht.ia;tt&&(alert("todo:VP8InitRandom"),M.ia=1)}M.Ga=S.Id,100<M.Ga?M.Ga=100:0>M.Ga&&(M.Ga=0)}ga(g,F)||(y=g.a)}}else y=g.a}y==0&&k.Oa!=null&&k.Oa.fd&&(y=Co(k.ba))}k=y}N=k!=0?null:11>N?V.f.RGBA.eb:V.f.kb.y}else N=null;return N};var U=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function f(ft,Mt){for(var Lt="",at=0;at<4;at++)Lt+=String.fromCharCode(ft[Mt++]);return Lt}function m(ft,Mt){return(ft[Mt+0]<<0|ft[Mt+1]<<8|ft[Mt+2]<<16)>>>0}function b(ft,Mt){return(ft[Mt+0]<<0|ft[Mt+1]<<8|ft[Mt+2]<<16|ft[Mt+3]<<24)>>>0}new h;var x=[0],B=[0],P=[],R=new h,Q=r,z=function(ft,Mt){var Lt={},at=0,ct=!1,wt=0,_t=0;if(Lt.frames=[],!function(bt,Pt,Ot,qt){for(var Gt=0;Gt<qt;Gt++)if(bt[Pt+Gt]!=Ot.charCodeAt(Gt))return!0;return!1}(ft,Mt,"RIFF",4)){var Jt,Yt;for(b(ft,Mt+=4),Mt+=8;Mt<ft.length;){var ee=f(ft,Mt),$t=b(ft,Mt+=4);Mt+=4;var ne=$t+(1&$t);switch(ee){case"VP8 ":case"VP8L":Lt.frames[at]===void 0&&(Lt.frames[at]={}),(it=Lt.frames[at]).src_off=ct?_t:Mt-8,it.src_size=wt+$t+8,at++,ct&&(ct=!1,wt=0,_t=0);break;case"VP8X":(it=Lt.header={}).feature_flags=ft[Mt];var re=Mt+4;it.canvas_width=1+m(ft,re),re+=3,it.canvas_height=1+m(ft,re),re+=3;break;case"ALPH":ct=!0,wt=ne+8,_t=Mt-8;break;case"ANIM":(it=Lt.header).bgcolor=b(ft,Mt),re=Mt+4,it.loop_count=(Jt=ft)[(Yt=re)+0]<<0|Jt[Yt+1]<<8,re+=2;break;case"ANMF":var Be,it;(it=Lt.frames[at]={}).offset_x=2*m(ft,Mt),Mt+=3,it.offset_y=2*m(ft,Mt),Mt+=3,it.width=1+m(ft,Mt),Mt+=3,it.height=1+m(ft,Mt),Mt+=3,it.duration=m(ft,Mt),Mt+=3,Be=ft[Mt++],it.dispose=1&Be,it.blend=Be>>1&1}ee!="ANMF"&&(Mt+=ne)}return Lt}}(Q,0);z.response=Q,z.rgbaoutput=!0,z.dataurl=!1;var G=z.header?z.header:null,X=z.frames?z.frames:null;if(G){G.loop_counter=G.loop_count,x=[G.canvas_height],B=[G.canvas_width];for(var et=0;et<X.length&&X[et].blend!=0;et++);}var pt=X[0],gt=R.WebPDecodeRGBA(Q,pt.src_off,pt.src_size,B,x);pt.rgba=gt,pt.imgwidth=B[0],pt.imgheight=x[0];for(var mt=0;mt<B[0]*x[0]*4;mt++)P[mt]=gt[mt];return this.width=B,this.height=x,this.data=P,this}(function(r){var t=function(){return typeof R2=="function"},e=function(x,B,P,R){var Q=4,z=a;switch(R){case r.image_compression.FAST:Q=1,z=s;break;case r.image_compression.MEDIUM:Q=6,z=o;break;case r.image_compression.SLOW:Q=9,z=h}x=n(x,B,P,z);var G=R2(x,{level:Q});return r.__addimage__.arrayBufferToBinaryString(G)},n=function(x,B,P,R){for(var Q,z,G,X=x.length/B,et=new Uint8Array(x.length+X),pt=m(),gt=0;gt<X;gt+=1){if(G=gt*B,Q=x.subarray(G,G+B),R)et.set(R(Q,P,z),G+gt);else{for(var mt,ft=pt.length,Mt=[];mt<ft;mt+=1)Mt[mt]=pt[mt](Q,P,z);var Lt=b(Mt.concat());et.set(Mt[Lt],G+gt)}z=Q}return et},i=function(x){var B=Array.apply([],x);return B.unshift(0),B},s=function(x,B){var P,R=[],Q=x.length;R[0]=1;for(var z=0;z<Q;z+=1)P=x[z-B]||0,R[z+1]=x[z]-P+256&255;return R},a=function(x,B,P){var R,Q=[],z=x.length;Q[0]=2;for(var G=0;G<z;G+=1)R=P&&P[G]||0,Q[G+1]=x[G]-R+256&255;return Q},o=function(x,B,P){var R,Q,z=[],G=x.length;z[0]=3;for(var X=0;X<G;X+=1)R=x[X-B]||0,Q=P&&P[X]||0,z[X+1]=x[X]+256-(R+Q>>>1)&255;return z},h=function(x,B,P){var R,Q,z,G,X=[],et=x.length;X[0]=4;for(var pt=0;pt<et;pt+=1)R=x[pt-B]||0,Q=P&&P[pt]||0,z=P&&P[pt-B]||0,G=f(R,Q,z),X[pt+1]=x[pt]-G+256&255;return X},f=function(x,B,P){if(x===B&&B===P)return x;var R=Math.abs(B-P),Q=Math.abs(x-P),z=Math.abs(x+B-P-P);return R<=Q&&R<=z?x:Q<=z?B:P},m=function(){return[i,s,a,o,h]},b=function(x){var B=x.map(function(P){return P.reduce(function(R,Q){return R+Math.abs(Q)},0)});return B.indexOf(Math.min.apply(null,B))};r.processPNG=function(x,B,P,R){var Q,z,G,X,et,pt,gt,mt,ft,Mt,Lt,at,ct,wt,_t,Jt=this.decode.FLATE_DECODE,Yt="";if(this.__addimage__.isArrayBuffer(x)&&(x=new Uint8Array(x)),this.__addimage__.isArrayBufferView(x)){if(x=(G=new Rrt(x)).imgData,z=G.bits,Q=G.colorSpace,et=G.colors,[4,6].indexOf(G.colorType)!==-1){if(G.bits===8){ft=(mt=G.pixelBitlength==32?new Uint32Array(G.decodePixels().buffer):G.pixelBitlength==16?new Uint16Array(G.decodePixels().buffer):new Uint8Array(G.decodePixels().buffer)).length,Lt=new Uint8Array(ft*G.colors),Mt=new Uint8Array(ft);var ee,$t=G.pixelBitlength-G.bits;for(wt=0,_t=0;wt<ft;wt++){for(ct=mt[wt],ee=0;ee<$t;)Lt[_t++]=ct>>>ee&255,ee+=G.bits;Mt[wt]=ct>>>ee&255}}if(G.bits===16){ft=(mt=new Uint32Array(G.decodePixels().buffer)).length,Lt=new Uint8Array(ft*(32/G.pixelBitlength)*G.colors),Mt=new Uint8Array(ft*(32/G.pixelBitlength)),at=G.colors>1,wt=0,_t=0;for(var ne=0;wt<ft;)ct=mt[wt++],Lt[_t++]=ct>>>0&255,at&&(Lt[_t++]=ct>>>16&255,ct=mt[wt++],Lt[_t++]=ct>>>0&255),Mt[ne++]=ct>>>16&255;z=8}R!==r.image_compression.NONE&&t()?(x=e(Lt,G.width*G.colors,G.colors,R),gt=e(Mt,G.width,1,R)):(x=Lt,gt=Mt,Jt=void 0)}if(G.colorType===3&&(Q=this.color_spaces.INDEXED,pt=G.palette,G.transparency.indexed)){var re=G.transparency.indexed,Be=0;for(wt=0,ft=re.length;wt<ft;++wt)Be+=re[wt];if((Be/=255)===ft-1&&re.indexOf(0)!==-1)X=[re.indexOf(0)];else if(Be!==ft){for(mt=G.decodePixels(),Mt=new Uint8Array(mt.length),wt=0,ft=mt.length;wt<ft;wt++)Mt[wt]=re[mt[wt]];gt=e(Mt,G.width,1)}}var it=function(bt){var Pt;switch(bt){case r.image_compression.FAST:Pt=11;break;case r.image_compression.MEDIUM:Pt=13;break;case r.image_compression.SLOW:Pt=14;break;default:Pt=12}return Pt}(R);return Jt===this.decode.FLATE_DECODE&&(Yt="/Predictor "+it+" "),Yt+="/Colors "+et+" /BitsPerComponent "+z+" /Columns "+G.width,(this.__addimage__.isArrayBuffer(x)||this.__addimage__.isArrayBufferView(x))&&(x=this.__addimage__.arrayBufferToBinaryString(x)),(gt&&this.__addimage__.isArrayBuffer(gt)||this.__addimage__.isArrayBufferView(gt))&&(gt=this.__addimage__.arrayBufferToBinaryString(gt)),{alias:P,data:x,index:B,filter:Jt,decodeParameters:Yt,transparency:X,palette:pt,sMask:gt,predictor:it,width:G.width,height:G.height,bitsPerComponent:z,colorSpace:Q}}}})(zr.API),function(r){r.processGIF89A=function(t,e,n,i){var s=new Ort(t),a=s.width,o=s.height,h=[];s.decodeAndBlitFrameRGBA(0,h);var f={data:h,width:a,height:o},m=new K2(100).encode(f,100);return r.processJPEG.call(this,m,e,n,i)},r.processGIF87A=r.processGIF89A}(zr.API),Ac.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var t=0;t<r;t++){var e=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:i,green:n,blue:e,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Ac.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[r]()}catch(e){Ai.log("bit decode error:"+e)}},Ac.prototype.bit1=function(){var r,t=Math.ceil(this.width/8),e=t%4;for(r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<t;i++)for(var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var h=this.palette[s>>7-o&1];this.data[a+4*o]=h.blue,this.data[a+4*o+1]=h.green,this.data[a+4*o+2]=h.red,this.data[a+4*o+3]=255}e!==0&&(this.pos+=4-e)}},Ac.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),t=r%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,i=0;i<r;i++){var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+2*i*4,o=s>>4,h=15&s,f=this.palette[o];if(this.data[a]=f.blue,this.data[a+1]=f.green,this.data[a+2]=f.red,this.data[a+3]=255,2*i+1>=this.width)break;f=this.palette[h],this.data[a+4]=f.blue,this.data[a+4+1]=f.green,this.data[a+4+2]=f.red,this.data[a+4+3]=255}t!==0&&(this.pos+=4-t)}},Ac.prototype.bit8=function(){for(var r=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*n;if(i<this.palette.length){var a=this.palette[i];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}r!==0&&(this.pos+=4-r)}},Ac.prototype.bit15=function(){for(var r=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&t)/t*255|0,o=(s>>5&t)/t*255|0,h=(s>>10&t)/t*255|0,f=s>>15?255:0,m=n*this.width*4+4*i;this.data[m]=h,this.data[m+1]=o,this.data[m+2]=a,this.data[m+3]=f}this.pos+=r}},Ac.prototype.bit16=function(){for(var r=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&t)/t*255|0,h=(a>>5&e)/e*255|0,f=(a>>11)/t*255|0,m=i*this.width*4+4*s;this.data[m]=f,this.data[m+1]=h,this.data[m+2]=o,this.data[m+3]=255}this.pos+=r}},Ac.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*e;this.data[a]=s,this.data[a+1]=i,this.data[a+2]=n,this.data[a+3]=255}this.pos+=this.width%4}},Ac.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*e;this.data[o]=s,this.data[o+1]=i,this.data[o+2]=n,this.data[o+3]=a}},Ac.prototype.getData=function(){return this.data},function(r){r.processBMP=function(t,e,n,i){var s=new Ac(t,!1),a=s.width,o=s.height,h={data:s.getData(),width:a,height:o},f=new K2(100).encode(h,100);return r.processJPEG.call(this,f,e,n,i)}}(zr.API),xP.prototype.getData=function(){return this.data},function(r){r.processWEBP=function(t,e,n,i){var s=new xP(t),a=s.width,o=s.height,h={data:s.getData(),width:a,height:o},f=new K2(100).encode(h,100);return r.processJPEG.call(this,f,e,n,i)}}(zr.API),zr.API.processRGBA=function(r,t,e){for(var n=r.data,i=n.length,s=new Uint8Array(i/4*3),a=new Uint8Array(i/4),o=0,h=0,f=0;f<i;f+=4){var m=n[f],b=n[f+1],x=n[f+2],B=n[f+3];s[o++]=m,s[o++]=b,s[o++]=x,a[h++]=B}var P=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:P,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},zr.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Df=zr.API,Ny=Df.getCharWidthsArray=function(r,t){var e,n,i=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),a=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:i.metadata.Unicode.widths,h=o.fof?o.fof:1,f=t.kerning?t.kerning:i.metadata.Unicode.kerning,m=f.fof?f.fof:1,b=t.doKerning!==!1,x=0,B=r.length,P=0,R=o[0]||h,Q=[];for(e=0;e<B;e++)n=r.charCodeAt(e),typeof i.metadata.widthOfString=="function"?Q.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(n))+a*(1e3/s)||0)/1e3):(x=b&&Un(f[n])==="object"&&!isNaN(parseInt(f[n][P],10))?f[n][P]/m:0,Q.push((o[n]||R)/h+x)),P=n;return Q},_P=Df.getStringUnitWidth=function(r,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),i=t.charSpace||this.internal.getCharSpace();return Df.processArabic&&(r=Df.processArabic(r)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(r,e,i)/e:Ny.apply(this,arguments).reduce(function(s,a){return s+a},0)},vP=function(r,t,e,n){for(var i=[],s=0,a=r.length,o=0;s!==a&&o+t[s]<e;)o+=t[s],s++;i.push(r.slice(0,s));var h=s;for(o=0;s!==a;)o+t[s]>n&&(i.push(r.slice(h,s)),o=0,h=s),o+=t[s],s++;return h!==s&&i.push(r.slice(h,s)),i},bP=function(r,t,e){e||(e={});var n,i,s,a,o,h,f,m=[],b=[m],x=e.textIndent||0,B=0,P=0,R=r.split(" "),Q=Ny.apply(this,[" ",e])[0];if(h=e.lineIndent===-1?R[0].length+2:e.lineIndent||0){var z=Array(h).join(" "),G=[];R.map(function(et){(et=et.split(/\s*\n/)).length>1?G=G.concat(et.map(function(pt,gt){return(gt&&pt.length?`
`:"")+pt})):G.push(et[0])}),R=G,h=_P.apply(this,[z,e])}for(s=0,a=R.length;s<a;s++){var X=0;if(n=R[s],h&&n[0]==`
`&&(n=n.substr(1),X=1),x+B+(P=(i=Ny.apply(this,[n,e])).reduce(function(et,pt){return et+pt},0))>t||X){if(P>t){for(o=vP.apply(this,[n,i,t-(x+B),t]),m.push(o.shift()),m=[o.pop()];o.length;)b.push([o.shift()]);P=i.slice(n.length-(m[0]?m[0].length:0)).reduce(function(et,pt){return et+pt},0)}else m=[n];b.push(m),x=P+h,B=Q}else m.push(n),x+=B+P,B=Q}return f=h?function(et,pt){return(pt?z:"")+et.join(" ")}:function(et){return et.join(" ")},b.map(f)},Df.splitTextToSize=function(r,t,e){var n,i=(e=e||{}).fontSize||this.internal.getFontSize(),s=(function(m){if(m.widths&&m.kerning)return{widths:m.widths,kerning:m.kerning};var b=this.internal.getFont(m.fontName,m.fontStyle);return b.metadata.Unicode?{widths:b.metadata.Unicode.widths||{0:1},kerning:b.metadata.Unicode.kerning||{}}:{font:b.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);n=Array.isArray(r)?r:String(r).split(/\r?\n/);var a=1*this.internal.scaleFactor*t/i;s.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/i:0,s.lineIndent=e.lineIndent;var o,h,f=[];for(o=0,h=n.length;o<h;o++)f=f.concat(bP.apply(this,[n[o],a,s]));return f},function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",e={},n={},i=0;i<t.length;i++)e[t[i]]="0123456789abcdef"[i],n["0123456789abcdef"[i]]=t[i];var s=function(b){return"0x"+parseInt(b,10).toString(16)},a=r.__fontmetrics__.compress=function(b){var x,B,P,R,Q=["{"];for(var z in b){if(x=b[z],isNaN(parseInt(z,10))?B="'"+z+"'":(z=parseInt(z,10),B=(B=s(z).slice(2)).slice(0,-1)+n[B.slice(-1)]),typeof x=="number")x<0?(P=s(x).slice(3),R="-"):(P=s(x).slice(2),R=""),P=R+P.slice(0,-1)+n[P.slice(-1)];else{if(Un(x)!=="object")throw new Error("Don't know what to do with value type "+Un(x)+".");P=a(x)}Q.push(B+P)}return Q.push("}"),Q.join("")},o=r.__fontmetrics__.uncompress=function(b){if(typeof b!="string")throw new Error("Invalid argument passed to uncompress.");for(var x,B,P,R,Q={},z=1,G=Q,X=[],et="",pt="",gt=b.length-1,mt=1;mt<gt;mt+=1)(R=b[mt])=="'"?x?(P=x.join(""),x=void 0):x=[]:x?x.push(R):R=="{"?(X.push([G,P]),G={},P=void 0):R=="}"?((B=X.pop())[0][B[1]]=G,P=void 0,G=B[0]):R=="-"?z=-1:P===void 0?e.hasOwnProperty(R)?(et+=e[R],P=parseInt(et,16)*z,z=1,et=""):et+=R:e.hasOwnProperty(R)?(pt+=e[R],G[P]=parseInt(pt,16)*z,z=1,P=void 0,pt=""):pt+=R;return Q},h={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},f={Unicode:{Courier:h,"Courier-Bold":h,"Courier-BoldOblique":h,"Courier-Oblique":h,Helvetica:h,"Helvetica-Bold":h,"Helvetica-BoldOblique":h,"Helvetica-Oblique":h,"Times-Roman":h,"Times-Bold":h,"Times-BoldItalic":h,"Times-Italic":h}},m={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(b){var x=b.font,B=m.Unicode[x.postScriptName];B&&(x.metadata.Unicode={},x.metadata.Unicode.widths=B.widths,x.metadata.Unicode.kerning=B.kerning);var P=f.Unicode[x.postScriptName];P&&(x.metadata.Unicode.encoding=P,x.encoding=P.codePages[0])}])}(zr.API),function(r){var t=function(e){for(var n=e.length,i=new Uint8Array(n),s=0;s<n;s++)i[s]=e.charCodeAt(s);return i};r.API.events.push(["addFont",function(e){var n=void 0,i=e.font,s=e.instance;if(!i.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(n=s.existsFileInVFS(i.postScriptName)===!1?s.loadFile(i.postScriptName):s.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?t(o):t(zg(o)),a.metadata=r.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(i,n)}}])}(zr),function(r){function t(){return(Hr.canvg?Promise.resolve(Hr.canvg):Promise.resolve().then(()=>cbt)).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e})}zr.API.addSvgAsImage=function(e,n,i,s,a,o,h,f){if(isNaN(n)||isNaN(i))throw Ai.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(a))throw Ai.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var m=document.createElement("canvas");m.width=s,m.height=a;var b=m.getContext("2d");b.fillStyle="#fff",b.fillRect(0,0,m.width,m.height);var x={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},B=this;return t().then(function(P){return P.fromString(b,e,x)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(P){return P.render(x)}).then(function(){B.addImage(m.toDataURL("image/jpeg",1),n,i,s,a,h,f)})}}(),zr.API.putTotalPages=function(r){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(r,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var i=0;i<this.internal.pages[n].length;i++)this.internal.pages[n][i]=this.internal.pages[n][i].replace(t,e);return this},zr.API.viewerPreferences=function(r,t){var e;r=r||{},t=t||!1;var n,i,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),h=[],f=0,m=0,b=0;function x(P,R){var Q,z=!1;for(Q=0;Q<P.length;Q+=1)P[Q]===R&&(z=!0);return z}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,r==="reset"||t===!0){var B=o.length;for(b=0;b<B;b+=1)e[o[b]].value=e[o[b]].defaultValue,e[o[b]].explicitSet=!1}if(Un(r)==="object"){for(i in r)if(s=r[i],x(o,i)&&s!==void 0){if(e[i].type==="boolean"&&typeof s=="boolean")e[i].value=s;else if(e[i].type==="name"&&x(e[i].valueSet,s))e[i].value=s;else if(e[i].type==="integer"&&Number.isInteger(s))e[i].value=s;else if(e[i].type==="array"){for(f=0;f<s.length;f+=1)if(n=!0,s[f].length===1&&typeof s[f][0]=="number")h.push(String(s[f]-1));else if(s[f].length>1){for(m=0;m<s[f].length;m+=1)typeof s[f][m]!="number"&&(n=!1);n===!0&&h.push([s[f][0]-1,s[f][1]-1].join(" "))}e[i].value="["+h.join(" ")+"]"}else e[i].value=e[i].defaultValue;e[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var P,R=[];for(P in e)e[P].explicitSet===!0&&(e[P].type==="name"?R.push("/"+P+" /"+e[P].value):R.push("/"+P+" "+e[P].value));R.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+R.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},function(r){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',i=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(n)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),h=unescape(encodeURIComponent("</x:xmpmeta>")),f=s.length+a.length+o.length+i.length+h.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+f+" >>"),this.internal.write("stream"),this.internal.write(i+s+a+o+h),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(n,i){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}}(zr.API),function(r){var t=r.API,e=t.pdfEscape16=function(s,a){for(var o,h=a.metadata.Unicode.widths,f=["","0","00","000","0000"],m=[""],b=0,x=s.length;b<x;++b){if(o=a.metadata.characterToGlyph(s.charCodeAt(b)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(b),h.indexOf(o)==-1&&(h.push(o),h.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return m.join("");o=o.toString(16),m.push(f[4-o.length],o)}return m.join("")},n=function(s){var a,o,h,f,m,b,x;for(m=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,h=[],b=0,x=(o=Object.keys(s).sort(function(B,P){return B-P})).length;b<x;b++)a=o[b],h.length>=100&&(m+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar`,h=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(f=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),h.push("<"+a+"><"+f+">"));return h.length&&(m+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar
`),m+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(s){(function(a){var o=a.font,h=a.out,f=a.newObject,m=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="Identity-H"){for(var b=o.metadata.Unicode.widths,x=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),B="",P=0;P<x.length;P++)B+=String.fromCharCode(x[P]);var R=f();m({data:B,addLength1:!0,objectId:R}),h("endobj");var Q=f();m({data:n(o.metadata.toUnicode),addLength1:!0,objectId:Q}),h("endobj");var z=f();h("<<"),h("/Type /FontDescriptor"),h("/FontName /"+Ff(o.fontName)),h("/FontFile2 "+R+" 0 R"),h("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),h("/Flags "+o.metadata.flags),h("/StemV "+o.metadata.stemV),h("/ItalicAngle "+o.metadata.italicAngle),h("/Ascent "+o.metadata.ascender),h("/Descent "+o.metadata.decender),h("/CapHeight "+o.metadata.capHeight),h(">>"),h("endobj");var G=f();h("<<"),h("/Type /Font"),h("/BaseFont /"+Ff(o.fontName)),h("/FontDescriptor "+z+" 0 R"),h("/W "+r.API.PDFObject.convert(b)),h("/CIDToGIDMap /Identity"),h("/DW 1000"),h("/Subtype /CIDFontType2"),h("/CIDSystemInfo"),h("<<"),h("/Supplement 0"),h("/Registry (Adobe)"),h("/Ordering ("+o.encoding+")"),h(">>"),h(">>"),h("endobj"),o.objectNumber=f(),h("<<"),h("/Type /Font"),h("/Subtype /Type0"),h("/ToUnicode "+Q+" 0 R"),h("/BaseFont /"+Ff(o.fontName)),h("/Encoding /"+o.encoding),h("/DescendantFonts ["+G+" 0 R]"),h(">>"),h("endobj"),o.isAlreadyPutted=!0}})(s)}]),t.events.push(["putFont",function(s){(function(a){var o=a.font,h=a.out,f=a.newObject,m=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var b=o.metadata.rawData,x="",B=0;B<b.length;B++)x+=String.fromCharCode(b[B]);var P=f();m({data:x,addLength1:!0,objectId:P}),h("endobj");var R=f();m({data:n(o.metadata.toUnicode),addLength1:!0,objectId:R}),h("endobj");var Q=f();h("<<"),h("/Descent "+o.metadata.decender),h("/CapHeight "+o.metadata.capHeight),h("/StemV "+o.metadata.stemV),h("/Type /FontDescriptor"),h("/FontFile2 "+P+" 0 R"),h("/Flags 96"),h("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),h("/FontName /"+Ff(o.fontName)),h("/ItalicAngle "+o.metadata.italicAngle),h("/Ascent "+o.metadata.ascender),h(">>"),h("endobj"),o.objectNumber=f();for(var z=0;z<o.metadata.hmtx.widths.length;z++)o.metadata.hmtx.widths[z]=parseInt(o.metadata.hmtx.widths[z]*(1e3/o.metadata.head.unitsPerEm));h("<</Subtype/TrueType/Type/Font/ToUnicode "+R+" 0 R/BaseFont/"+Ff(o.fontName)+"/FontDescriptor "+Q+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),h("endobj"),o.isAlreadyPutted=!0}})(s)}]);var i=function(s){var a,o=s.text||"",h=s.x,f=s.y,m=s.options||{},b=s.mutex||{},x=b.pdfEscape,B=b.activeFontKey,P=b.fonts,R=B,Q="",z=0,G="",X=P[R].encoding;if(P[R].encoding!=="Identity-H")return{text:o,x:h,y:f,options:m,mutex:b};for(G=o,R=B,Array.isArray(o)&&(G=o[0]),z=0;z<G.length;z+=1)P[R].metadata.hasOwnProperty("cmap")&&(a=P[R].metadata.cmap.unicode.codeMap[G[z].charCodeAt(0)]),a||G[z].charCodeAt(0)<256&&P[R].metadata.hasOwnProperty("Unicode")?Q+=G[z]:Q+="";var et="";return parseInt(R.slice(1))<14||X==="WinAnsiEncoding"?et=x(Q,R).split("").map(function(pt){return pt.charCodeAt(0).toString(16)}).join(""):X==="Identity-H"&&(et=e(Q,P[R])),b.isHex=!0,{text:et,x:h,y:f,options:m,mutex:b}};t.events.push(["postProcessText",function(s){var a=s.text||"",o=[],h={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var f=0;for(f=0;f<a.length;f+=1)Array.isArray(a[f])&&a[f].length===3?o.push([i(Object.assign({},h,{text:a[f][0]})).text,a[f][1],a[f][2]]):o.push(i(Object.assign({},h,{text:a[f]})).text);s.text=o}else s.text=i(Object.assign({},h,{text:a})).text}])}(zr),function(r){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},r.addFileToVFS=function(e,n){return t.call(this),this.internal.vFS[e]=n,this},r.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}}(zr.API),function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(n){var i,s,a,o,h,f,m,b=t,x=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],B=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],P={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},R={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},Q=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],z=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),G=!1,X=0;this.__bidiEngine__={};var et=function(at){var ct=at.charCodeAt(),wt=ct>>8,_t=R[wt];return _t!==void 0?b[256*_t+(255&ct)]:wt===252||wt===253?"AL":z.test(wt)?"L":wt===8?"R":"N"},pt=function(at){for(var ct,wt=0;wt<at.length;wt++){if((ct=et(at.charAt(wt)))==="L")return!1;if(ct==="R")return!0}return!1},gt=function(at,ct,wt,_t){var Jt,Yt,ee,$t,ne=ct[_t];switch(ne){case"L":case"R":G=!1;break;case"N":case"AN":break;case"EN":G&&(ne="AN");break;case"AL":G=!0,ne="R";break;case"WS":ne="N";break;case"CS":_t<1||_t+1>=ct.length||(Jt=wt[_t-1])!=="EN"&&Jt!=="AN"||(Yt=ct[_t+1])!=="EN"&&Yt!=="AN"?ne="N":G&&(Yt="AN"),ne=Yt===Jt?Yt:"N";break;case"ES":ne=(Jt=_t>0?wt[_t-1]:"B")==="EN"&&_t+1<ct.length&&ct[_t+1]==="EN"?"EN":"N";break;case"ET":if(_t>0&&wt[_t-1]==="EN"){ne="EN";break}if(G){ne="N";break}for(ee=_t+1,$t=ct.length;ee<$t&&ct[ee]==="ET";)ee++;ne=ee<$t&&ct[ee]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for($t=ct.length,ee=_t+1;ee<$t&&ct[ee]==="NSM";)ee++;if(ee<$t){var re=at[_t],Be=re>=1425&&re<=2303||re===64286;if(Jt=ct[ee],Be&&(Jt==="R"||Jt==="AL")){ne="R";break}}}ne=_t<1||(Jt=ct[_t-1])==="B"?"N":wt[_t-1];break;case"B":G=!1,i=!0,ne=X;break;case"S":s=!0,ne="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":G=!1;break;case"BN":ne="N"}return ne},mt=function(at,ct,wt){var _t=at.split("");return wt&&ft(_t,wt,{hiLevel:X}),_t.reverse(),ct&&ct.reverse(),_t.join("")},ft=function(at,ct,wt){var _t,Jt,Yt,ee,$t,ne=-1,re=at.length,Be=0,it=[],bt=X?B:x,Pt=[];for(G=!1,i=!1,s=!1,Jt=0;Jt<re;Jt++)Pt[Jt]=et(at[Jt]);for(Yt=0;Yt<re;Yt++){if($t=Be,it[Yt]=gt(at,Pt,it,Yt),_t=240&(Be=bt[$t][P[it[Yt]]]),Be&=15,ct[Yt]=ee=bt[Be][5],_t>0)if(_t===16){for(Jt=ne;Jt<Yt;Jt++)ct[Jt]=1;ne=-1}else ne=-1;if(bt[Be][6])ne===-1&&(ne=Yt);else if(ne>-1){for(Jt=ne;Jt<Yt;Jt++)ct[Jt]=ee;ne=-1}Pt[Yt]==="B"&&(ct[Yt]=0),wt.hiLevel|=ee}s&&function(Ot,qt,Gt){for(var oe=0;oe<Gt;oe++)if(Ot[oe]==="S"){qt[oe]=X;for(var ie=oe-1;ie>=0&&Ot[ie]==="WS";ie--)qt[ie]=X}}(Pt,ct,re)},Mt=function(at,ct,wt,_t,Jt){if(!(Jt.hiLevel<at)){if(at===1&&X===1&&!i)return ct.reverse(),void(wt&&wt.reverse());for(var Yt,ee,$t,ne,re=ct.length,Be=0;Be<re;){if(_t[Be]>=at){for($t=Be+1;$t<re&&_t[$t]>=at;)$t++;for(ne=Be,ee=$t-1;ne<ee;ne++,ee--)Yt=ct[ne],ct[ne]=ct[ee],ct[ee]=Yt,wt&&(Yt=wt[ne],wt[ne]=wt[ee],wt[ee]=Yt);Be=$t}Be++}}},Lt=function(at,ct,wt){var _t=at.split(""),Jt={hiLevel:X};return wt||(wt=[]),ft(_t,wt,Jt),function(Yt,ee,$t){if($t.hiLevel!==0&&m)for(var ne,re=0;re<Yt.length;re++)ee[re]===1&&(ne=Q.indexOf(Yt[re]))>=0&&(Yt[re]=Q[ne+1])}(_t,wt,Jt),Mt(2,_t,ct,wt,Jt),Mt(1,_t,ct,wt,Jt),_t.join("")};return this.__bidiEngine__.doBidiReorder=function(at,ct,wt){if(function(Jt,Yt){if(Yt)for(var ee=0;ee<Jt.length;ee++)Yt[ee]=ee;o===void 0&&(o=pt(Jt)),f===void 0&&(f=pt(Jt))}(at,ct),a||!h||f)if(a&&h&&o^f)X=o?1:0,at=mt(at,ct,wt);else if(!a&&h&&f)X=o?1:0,at=Lt(at,ct,wt),at=mt(at,ct);else if(!a||o||h||f){if(a&&!h&&o^f)at=mt(at,ct),o?(X=0,at=Lt(at,ct,wt)):(X=1,at=Lt(at,ct,wt),at=mt(at,ct));else if(a&&o&&!h&&f)X=1,at=Lt(at,ct,wt),at=mt(at,ct);else if(!a&&!h&&o^f){var _t=m;o?(X=1,at=Lt(at,ct,wt),X=0,m=!1,at=Lt(at,ct,wt),m=_t):(X=0,at=Lt(at,ct,wt),at=mt(at,ct),X=1,m=!1,at=Lt(at,ct,wt),m=_t,at=mt(at,ct))}}else X=0,at=Lt(at,ct,wt);else X=o?1:0,at=Lt(at,ct,wt);return at},this.__bidiEngine__.setOptions=function(at){at&&(a=at.isInputVisual,h=at.isOutputVisual,o=at.isInputRtl,f=at.isOutputRtl,m=at.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(n){var i=n.text,s=(n.x,n.y,n.options||{}),a=(n.mutex,s.lang,[]);if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,e.setOptions(s),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(a=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?a.push([e.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):a.push([e.doBidiReorder(i[o])]);n.text=a}else n.text=e.doBidiReorder(i);e.setOptions({isInputVisual:!0})}])}(zr),zr.API.TTFFont=function(){function r(t){var e;if(this.rawData=t,e=this.contents=new KA(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new Jrt(this),this.registerTTF()}return r.open=function(t){return new r(t)},r.prototype.parse=function(){return this.directory=new Drt(this.contents),this.head=new krt(this),this.name=new Grt(this),this.cmap=new CP(this),this.toUnicode={},this.hhea=new Qrt(this),this.maxp=new jrt(this),this.hmtx=new qrt(this),this.post=new zrt(this),this.os2=new Hrt(this),this.loca=new Xrt(this),this.glyf=new Krt(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var t,e,n,i,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,h,f;for(f=[],a=0,o=(h=this.bbox).length;a<o;a++)t=h[a],f.push(Math.round(t*this.scaleFactor));return f}).call(this),this.stemV=0,this.post.exists?(n=255&(i=this.post.italic_angle),32768&(e=i>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},r.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},r.prototype.widthOfString=function(t,e,n){var i,s,a,o;for(a=0,s=0,o=(t=""+t).length;0<=o?s<o:s>o;s=0<=o?++s:--s)i=t.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(i))+n*(1e3/e)||0;return a*(e/1e3)},r.prototype.lineHeight=function(t,e){var n;return e==null&&(e=!1),n=e?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},r}();var hc,KA=function(){function r(t){this.data=t??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(t){return this.data[this.pos++]=t},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},r.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},r.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},r.prototype.readString=function(t){var e,n;for(n=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)n[e]=String.fromCharCode(this.readByte());return n.join("")},r.prototype.writeString=function(t){var e,n,i;for(i=[],e=0,n=t.length;0<=n?e<n:e>n;e=0<=n?++e:--e)i.push(this.writeByte(t.charCodeAt(e)));return i},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(t){return this.writeInt16(t)},r.prototype.readLongLong=function(){var t,e,n,i,s,a,o,h;return t=this.readByte(),e=this.readByte(),n=this.readByte(),i=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),h=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^n)+4294967296*(255^i)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^h)+1):72057594037927940*t+281474976710656*e+1099511627776*n+4294967296*i+16777216*s+65536*a+256*o+h},r.prototype.writeLongLong=function(t){var e,n;return e=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(t){return this.writeInt32(t)},r.prototype.read=function(t){var e,n;for(e=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)e.push(this.readByte());return e},r.prototype.write=function(t){var e,n,i,s;for(s=[],n=0,i=t.length;n<i;n++)e=t[n],s.push(this.writeByte(e));return s},r}(),Drt=function(){var r;function t(e){var n,i,s;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},i=0,s=this.tableCount;0<=s?i<s:i>s;i=0<=s?++i:--i)n={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(e){var n,i,s,a,o,h,f,m,b,x,B,P,R;for(R in B=Object.keys(e).length,h=Math.log(2),b=16*Math.floor(Math.log(B)/h),a=Math.floor(b/h),m=16*B-b,(i=new KA).writeInt(this.scalarType),i.writeShort(B),i.writeShort(b),i.writeShort(a),i.writeShort(m),s=16*B,f=i.pos+s,o=null,P=[],e)for(x=e[R],i.writeString(R),i.writeInt(r(x)),i.writeInt(f),i.writeInt(x.length),P=P.concat(x),R==="head"&&(o=f),f+=x.length;f%4;)P.push(0),f++;return i.write(P),n=2981146554-r(i.data),i.pos=o+8,i.writeUInt32(n),i.data},r=function(e){var n,i,s,a;for(e=EP.call(e);e.length%4;)e.push(0);for(s=new KA(e),i=0,n=0,a=e.length;n<a;n=n+=4)i+=s.readUInt32();return 4294967295&i},t}(),Nrt={}.hasOwnProperty,Zc=function(r,t){for(var e in t)Nrt.call(t,e)&&(r[e]=t[e]);function n(){this.constructor=r}return n.prototype=t.prototype,r.prototype=new n,r.__super__=t.prototype,r};hc=function(){function r(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r}();var krt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var n;return(n=new KA).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(e),n.writeShort(this.glyphDataFormat),n.data},t}(),BP=function(){function r(t,e){var n,i,s,a,o,h,f,m,b,x,B,P,R,Q,z,G,X;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),b=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(h=0;h<256;++h)this.codeMap[h]=t.readByte();break;case 4:for(B=t.readUInt16(),x=B/2,t.pos+=6,s=function(){var et,pt;for(pt=[],h=et=0;0<=x?et<x:et>x;h=0<=x?++et:--et)pt.push(t.readUInt16());return pt}(),t.pos+=2,R=function(){var et,pt;for(pt=[],h=et=0;0<=x?et<x:et>x;h=0<=x?++et:--et)pt.push(t.readUInt16());return pt}(),f=function(){var et,pt;for(pt=[],h=et=0;0<=x?et<x:et>x;h=0<=x?++et:--et)pt.push(t.readUInt16());return pt}(),m=function(){var et,pt;for(pt=[],h=et=0;0<=x?et<x:et>x;h=0<=x?++et:--et)pt.push(t.readUInt16());return pt}(),i=(this.length-t.pos+this.offset)/2,o=function(){var et,pt;for(pt=[],h=et=0;0<=i?et<i:et>i;h=0<=i?++et:--et)pt.push(t.readUInt16());return pt}(),h=z=0,X=s.length;z<X;h=++z)for(Q=s[h],n=G=P=R[h];P<=Q?G<=Q:G>=Q;n=P<=Q?++G:--G)m[h]===0?a=n+f[h]:(a=o[m[h]/2+(n-P)-(x-h)]||0)!==0&&(a+=f[h]),this.codeMap[n]=65535&a}t.pos=b}return r.encode=function(t,e){var n,i,s,a,o,h,f,m,b,x,B,P,R,Q,z,G,X,et,pt,gt,mt,ft,Mt,Lt,at,ct,wt,_t,Jt,Yt,ee,$t,ne,re,Be,it,bt,Pt,Ot,qt,Gt,oe,ie,Ce,Fe,Re;switch(_t=new KA,a=Object.keys(t).sort(function(Ne,ke){return Ne-ke}),e){case"macroman":for(R=0,Q=function(){var Ne=[];for(P=0;P<256;++P)Ne.push(0);return Ne}(),G={0:0},s={},Jt=0,ne=a.length;Jt<ne;Jt++)G[ie=t[i=a[Jt]]]==null&&(G[ie]=++R),s[i]={old:t[i],new:G[t[i]]},Q[i]=G[t[i]];return _t.writeUInt16(1),_t.writeUInt16(0),_t.writeUInt32(12),_t.writeUInt16(0),_t.writeUInt16(262),_t.writeUInt16(0),_t.write(Q),{charMap:s,subtable:_t.data,maxGlyphID:R+1};case"unicode":for(ct=[],b=[],X=0,G={},n={},z=f=null,Yt=0,re=a.length;Yt<re;Yt++)G[pt=t[i=a[Yt]]]==null&&(G[pt]=++X),n[i]={old:pt,new:G[pt]},o=G[pt]-i,z!=null&&o===f||(z&&b.push(z),ct.push(i),f=o),z=i;for(z&&b.push(z),b.push(65535),ct.push(65535),Lt=2*(Mt=ct.length),ft=2*Math.pow(Math.log(Mt)/Math.LN2,2),x=Math.log(ft/2)/Math.LN2,mt=2*Mt-ft,h=[],gt=[],B=[],P=ee=0,Be=ct.length;ee<Be;P=++ee){if(at=ct[P],m=b[P],at===65535){h.push(0),gt.push(0);break}if(at-(wt=n[at].new)>=32768)for(h.push(0),gt.push(2*(B.length+Mt-P)),i=$t=at;at<=m?$t<=m:$t>=m;i=at<=m?++$t:--$t)B.push(n[i].new);else h.push(wt-at),gt.push(0)}for(_t.writeUInt16(3),_t.writeUInt16(1),_t.writeUInt32(12),_t.writeUInt16(4),_t.writeUInt16(16+8*Mt+2*B.length),_t.writeUInt16(0),_t.writeUInt16(Lt),_t.writeUInt16(ft),_t.writeUInt16(x),_t.writeUInt16(mt),Gt=0,it=b.length;Gt<it;Gt++)i=b[Gt],_t.writeUInt16(i);for(_t.writeUInt16(0),oe=0,bt=ct.length;oe<bt;oe++)i=ct[oe],_t.writeUInt16(i);for(Ce=0,Pt=h.length;Ce<Pt;Ce++)o=h[Ce],_t.writeUInt16(o);for(Fe=0,Ot=gt.length;Fe<Ot;Fe++)et=gt[Fe],_t.writeUInt16(et);for(Re=0,qt=B.length;Re<qt;Re++)R=B[Re],_t.writeUInt16(R);return{charMap:n,subtable:_t.data,maxGlyphID:X+1}}},r}(),CP=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="cmap",t.prototype.parse=function(e){var n,i,s;for(e.pos=this.offset,this.version=e.readUInt16(),s=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=s?i<s:i>s;i=0<=s?++i:--i)n=new BP(e,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(e,n){var i,s;return n==null&&(n="macroman"),i=BP.encode(e,n),(s=new KA).writeUInt16(0),s.writeUInt16(1),i.table=s.data.concat(i.subtable),i},t}(),Qrt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t}(),Hrt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var n,i;for(i=[],n=0;n<10;++n)i.push(e.readByte());return i}(),this.charRange=function(){var n,i;for(i=[],n=0;n<4;++n)i.push(e.readInt());return i}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var n,i;for(i=[],n=0;n<2;n=++n)i.push(e.readInt());return i}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t}(),zrt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="post",t.prototype.parse=function(e){var n,i,s;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:break;case 131072:var a;for(i=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=i?a<i:a>i;a=0<=i?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],s=[];e.pos<this.offset+this.length;)n=e.readByte(),s.push(this.names.push(e.readString(n)));return s;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 196608:break;case 262144:return this.map=(function(){var o,h,f;for(f=[],a=o=0,h=this.file.maxp.numGlyphs;0<=h?o<h:o>h;a=0<=h?++o:--o)f.push(e.readUInt32());return f}).call(this)}},t}(),Vrt=function(r,t){this.raw=r,this.length=r.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},Grt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="name",t.prototype.parse=function(e){var n,i,s,a,o,h,f,m,b,x,B;for(e.pos=this.offset,e.readShort(),n=e.readShort(),h=e.readShort(),i=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+h+e.readShort()});for(f={},a=b=0,x=i.length;b<x;a=++b)s=i[a],e.pos=s.offset,m=e.readString(s.length),o=new Vrt(m,s),f[B=s.nameID]==null&&(f[B]=[]),f[s.nameID].push(o);this.strings=f,this.copyright=f[0],this.fontFamily=f[1],this.fontSubfamily=f[2],this.uniqueSubfamily=f[3],this.fontName=f[4],this.version=f[5];try{this.postscriptName=f[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=f[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=f[7],this.manufacturer=f[8],this.designer=f[9],this.description=f[10],this.vendorUrl=f[11],this.designerUrl=f[12],this.license=f[13],this.licenseUrl=f[14],this.preferredFamily=f[15],this.preferredSubfamily=f[17],this.compatibleFull=f[18],this.sampleText=f[19]},t}(),jrt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t}(),qrt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="hmtx",t.prototype.parse=function(e){var n,i,s,a,o,h,f;for(e.pos=this.offset,this.metrics=[],n=0,h=this.file.hhea.numberOfMetrics;0<=h?n<h:n>h;n=0<=h?++n:--n)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var m,b;for(b=[],n=m=0;0<=s?m<s:m>s;n=0<=s?++m:--m)b.push(e.readInt16());return b}(),this.widths=(function(){var m,b,x,B;for(B=[],m=0,b=(x=this.metrics).length;m<b;m++)a=x[m],B.push(a.advance);return B}).call(this),i=this.widths[this.widths.length-1],f=[],n=o=0;0<=s?o<s:o>s;n=0<=s?++o:--o)f.push(this.widths.push(i));return f},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t}(),EP=[].slice,Krt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var n,i,s,a,o,h,f,m,b,x;return e in this.cache?this.cache[e]:(a=this.file.loca,n=this.file.contents,i=a.indexOf(e),(s=a.lengthOf(e))===0?this.cache[e]=null:(n.pos=this.offset+i,o=(h=new KA(n.read(s))).readShort(),m=h.readShort(),x=h.readShort(),f=h.readShort(),b=h.readShort(),this.cache[e]=o===-1?new $rt(h,m,x,f,b):new Wrt(h,o,m,x,f,b),this.cache[e]))},t.prototype.encode=function(e,n,i){var s,a,o,h,f;for(o=[],a=[],h=0,f=n.length;h<f;h++)s=e[n[h]],a.push(o.length),s&&(o=o.concat(s.encode(i)));return a.push(o.length),{table:o,offsets:a}},t}(),Wrt=function(){function r(t,e,n,i,s,a){this.raw=t,this.numberOfContours=e,this.xMin=n,this.yMin=i,this.xMax=s,this.yMax=a,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r}(),$rt=function(){function r(t,e,n,i,s){var a,o;for(this.raw=t,this.xMin=e,this.yMin=n,this.xMax=i,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return r.prototype.encode=function(){var t,e,n;for(e=new KA(EP.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)e.pos=this.glyphOffsets[t];return e.data},r}(),Xrt=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Zc(t,hc),t.prototype.tag="loca",t.prototype.parse=function(e){var n,i;return e.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=2)a.push(2*e.readUInt16());return a}).call(this):(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=4)a.push(e.readUInt32());return a}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,n){for(var i=new Uint32Array(this.offsets.length),s=0,a=0,o=0;o<i.length;++o)if(i[o]=s,a<n.length&&n[a]==o){++a,i[o]=s;var h=this.offsets[o],f=this.offsets[o+1]-h;f>0&&(s+=f)}for(var m=new Array(4*i.length),b=0;b<i.length;++b)m[4*b+3]=255&i[b],m[4*b+2]=(65280&i[b])>>8,m[4*b+1]=(16711680&i[b])>>16,m[4*b]=(4278190080&i[b])>>24;return m},t}(),Jrt=function(){function r(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var t,e,n,i,s;for(e in i=this.font.cmap.tables[0].codeMap,t={},s=this.subset)n=s[e],t[e]=i[n];return t},r.prototype.glyphsFor=function(t){var e,n,i,s,a,o,h;for(i={},a=0,o=t.length;a<o;a++)i[s=t[a]]=this.font.glyf.glyphFor(s);for(s in e=[],i)(n=i[s])!=null&&n.compound&&e.push.apply(e,n.glyphIDs);if(e.length>0)for(s in h=this.glyphsFor(e))n=h[s],i[s]=n;return i},r.prototype.encode=function(t,e){var n,i,s,a,o,h,f,m,b,x,B,P,R,Q,z;for(i in n=CP.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),B={0:0},z=n.charMap)B[(h=z[i]).old]=h.new;for(P in x=n.maxGlyphID,a)P in B||(B[P]=x++);return m=function(G){var X,et;for(X in et={},G)et[G[X]]=X;return et}(B),b=Object.keys(m).sort(function(G,X){return G-X}),R=function(){var G,X,et;for(et=[],G=0,X=b.length;G<X;G++)o=b[G],et.push(m[o]);return et}(),s=this.font.glyf.encode(a,R,B),f=this.font.loca.encode(s.offsets,R),Q={cmap:this.font.cmap.raw(),glyf:s.table,loca:f,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(Q["OS/2"]=this.font.os2.raw()),this.font.directory.encode(Q)},r}();zr.API.PDFObject=function(){var r;function t(){}return r=function(e,n){return(Array(n+1).join("0")+e).slice(-n)},t.convert=function(e){var n,i,s,a;if(Array.isArray(e))return"["+function(){var o,h,f;for(f=[],o=0,h=e.length;o<h;o++)n=e[o],f.push(t.convert(n));return f}().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+r(e.getUTCFullYear(),4)+r(e.getUTCMonth(),2)+r(e.getUTCDate(),2)+r(e.getUTCHours(),2)+r(e.getUTCMinutes(),2)+r(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(i in s=["<<"],e)a=e[i],s.push("/"+i+" "+t.convert(a));return s.push(">>"),s.join(`
`)}return""+e},t}();const W2={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},$2={textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]};let Yrt=class{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xh.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Ku.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Tf.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:W2,f=arguments.length>8&&arguments[8]!==void 0?arguments[8]:"maplibregl-ctrl-attrib-inner",m=arguments.length>9&&arguments[9]!==void 0?arguments[9]:$2;Mn(this,"map"),Mn(this,"width"),Mn(this,"height"),Mn(this,"dpi"),Mn(this,"format"),Mn(this,"unit"),Mn(this,"fileName"),Mn(this,"markerClassName"),Mn(this,"markerCirclePaint"),Mn(this,"attributionClassName"),Mn(this,"attributionStyle"),this.map=t,this.width=e[0],this.height=e[1],this.dpi=n,this.format=i,this.unit=s,this.fileName=a,this.markerClassName=o,this.markerCirclePaint=h,this.attributionClassName=f,this.attributionStyle=m}renderMapPost(t){return t}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(t){const e=this.getMarkers();for(let n=0;n<e.length;n++){const i=e.item(n);if(!i)continue;const s=i.getAttribute("style");if(!s)continue;const a=/translate\(([^,]+)px,\s*([^,]+)px\)/,o=s.match(a);if(!o)continue;const h=parseInt(o[1]),f=parseInt(o[2]),m=this.map.unproject([h,f]),b=`point${n}`;t.addSource(b,{type:"geojson",data:{type:"Point",coordinates:[m.lng,m.lat]}}),t.addLayer({id:b,source:b,type:"circle",paint:this.markerCirclePaint})}return t}generate(){const t=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const e=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const n=document.createElement("div");n.className="hidden-map",document.body.appendChild(n);const i=document.createElement("div");i.style.width=this.toPixels(this.width),i.style.height=this.toPixels(this.height),n.appendChild(i);const s=this.map.getStyle();if(s&&s.sources){const o=s.sources;Object.keys(o).forEach(h=>{const f=o[h];Object.keys(f).forEach(m=>{f[m]||delete f[m]})})}let a=this.getRenderedMap(i,s);a.once("idle",()=>{this.addAttributions(a)?a.once("idle",()=>{a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,e):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,e)}))}):(a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,e):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,e)})))})}stripHtml(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}addAttributions(t){if(!this.map.getStyle().glyphs)return!1;const e=t.getContainer(),n=parseInt(e.style.width.replace("px",""))-5,i=parseInt(e.style.height.replace("px",""))-5,s=[n,i],a=t.unproject(s),o=e.getElementsByClassName(this.attributionClassName),h=[];if((o==null?void 0:o.length)>0){const B=o.item(0);if(B)for(let P=0;P<B.children.length;P++){const R=B.children.item(P);R&&h.push(this.stripHtml(R.outerHTML))}}else{const B=this.map.getStyle().sources;Object.keys(B).forEach(P=>{const R=B[P];if("attribution"in R){const Q=R.attribution;h.push(this.stripHtml(Q))}})}if(h.length===0)return!1;const f=h.join(" | "),m="attribution";t.addSource(m,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[a.lng,a.lat]},properties:{attribution:f}}});const b=this.map.getStyle().layers.filter(B=>B.type==="symbol"&&B.layout&&"text-font"in B.layout),x=b.length>0&&b[0].layout?b[0].layout["text-font"]:this.attributionStyle.fallbackTextFont;return t.addLayer({id:m,source:m,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":x,"text-max-width":parseInt(`${n/this.attributionStyle.textSize}`),"text-anchor":"bottom-right","text-justify":"right","text-size":this.attributionStyle.textSize},paint:{"text-halo-color":this.attributionStyle.textHaloColor,"text-halo-width":this.attributionStyle.textHaloWidth,"text-color":this.attributionStyle.textColor}}),!0}exportImage(t,e,n){var i;const s=t.getCanvas(),a=`${this.fileName}.${this.format}`;switch(this.format){case Ku.PNG:this.toPNG(s,a);break;case Ku.JPEG:this.toJPEG(s,a);break;case Ku.PDF:this.toPDF(t,a);break;case Ku.SVG:this.toSVG(s,a);break;default:console.error(`Invalid file format: ${this.format}`);break}t.remove(),(i=e.parentNode)==null||i.removeChild(e),Object.defineProperty(window,"devicePixelRatio",{get(){return n}}),e.remove(),JsLoadingOverlay.hide()}toPNG(t,e){const n=document.createElement("a");n.href=t.toDataURL(),n.download=e,n.click(),n.remove()}toJPEG(t,e){const n=t.toDataURL("image/jpeg",.85),i=document.createElement("a");i.href=n,i.download=e,i.click(),i.remove()}toPDF(t,e){const n=t.getCanvas(),i=new zr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});i.addImage(n.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:s,lat:a}=t.getCenter();i.setProperties({title:t.getStyle().name,subject:`center: [${s}, ${a}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),i.save(e)}toSVG(t,e){const n=t.toDataURL("image/png"),i=Number(this.toPixels(this.width,this.dpi).replace("px","")),s=Number(this.toPixels(this.height,this.dpi).replace("px","")),a=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${i}" 
      height="${s}" 
      viewBox="0 0 ${i} ${s}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${n}" width="${i}" height="${s}"></image>
    </svg>`,o=document.createElement("a");o.href=`data:application/xml,${encodeURIComponent(a)}`,o.download=e,o.click(),o.remove()}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Tf.mm&&(e/=25.4),`${e*t}px`}},Zrt=class extends Yrt{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xh.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Ku.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Tf.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:W2,h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:$2;super(t,e,n,i,s,a,"maplibregl-marker",o,"maplibregl-ctrl-attrib-inner",h)}getRenderedMap(t,e){const n=new CS.Map({container:t,style:e,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(n.setMaxPitch(85),n.setPitch(this.map.getPitch()));const i=(this.map.style.imageManager||{}).images||[];return Object.keys(i).forEach(s=>{n.addImage(s,i[s].data)}),n}renderMapPost(t){const e=this.map.getTerrain();return e&&t.setTerrain({source:e.source,exaggeration:e.exaggeration}),t}},tnt=class{constructor(t){Mn(this,"controlContainer"),Mn(this,"exportContainer"),Mn(this,"crosshair"),Mn(this,"printableArea"),Mn(this,"map"),Mn(this,"exportButton"),Mn(this,"options",{PageSize:Xh.A4,PageOrientation:Dg.Landscape,Format:Ku.PDF,DPI:C2[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(Xh),Filename:"map",markerCirclePaint:W2,attributionStyle:$2}),Mn(this,"MAPLIB_CSS_PREFIX","maplibregl"),t&&(this.options=Object.assign(this.options,t)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const t=this.options.Local??"en";return ert(t)}onAdd(t){var e;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const n=document.createElement("TABLE");n.className="print-table";const i={};(e=this.options.AllowedSizes)==null||e.forEach(m=>{Xh[m]&&(i[m]=Xh[m])});const s=this.createSelection(i,this.getTranslation().PageSize,"page-size",this.options.PageSize,(m,b)=>JSON.stringify(m[b]));n.appendChild(s);const a=this.createSelection(Dg,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(m,b)=>m[b]);n.appendChild(a);const o=this.createSelection(Ku,this.getTranslation().Format,"format-type",this.options.Format,(m,b)=>m[b]);n.appendChild(o);const h=this.createSelection(C2,this.getTranslation().DPI,"dpi-type",this.options.DPI,(m,b)=>m[b]);n.appendChild(h),this.exportContainer.appendChild(n);const f=document.createElement("button");return f.type="button",f.textContent=this.getTranslation().Generate,f.classList.add("generate-button"),f.addEventListener("click",()=>{const m=document.getElementById("mapbox-gl-export-page-size"),b=document.getElementById("mapbox-gl-export-page-orientation"),x=document.getElementById("mapbox-gl-export-format-type"),B=document.getElementById("mapbox-gl-export-dpi-type"),P=b.value;let R=JSON.parse(m.value);P===Dg.Portrait&&(R=R.reverse()),this.generateMap(t,R,Number(B.value),x.value,Tf.mm,this.options.Filename)}),this.exportContainer.appendChild(f),this.controlContainer}generateMap(t,e,n,i,s,a){new Zrt(t,e,n,i,s,a,this.options.markerCirclePaint,this.options.attributionStyle).generate()}createSelection(t,e,n,i,s){const a=document.createElement("label");a.textContent=e;const o=document.createElement("select");o.setAttribute("id",`mapbox-gl-export-${n}`),o.style.width="100%",Object.keys(t).forEach(b=>{const x=document.createElement("option");x.setAttribute("value",s(t,b)),x.appendChild(document.createTextNode(b)),x.setAttribute("name",n),i===t[b]&&(x.selected=!0),o.appendChild(x)}),o.addEventListener("change",()=>{this.updatePrintableArea()});const h=document.createElement("TR"),f=document.createElement("TD"),m=document.createElement("TD");return f.appendChild(a),m.appendChild(o),h.appendChild(f),h.appendChild(m),h}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(t){this.options.Crosshair===!0&&(t===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new Qet(this.map),this.crosshair.create()))}togglePrintableArea(t){this.options.PrintableArea===!0&&(t===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new Het(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const t=document.getElementById("mapbox-gl-export-page-size"),e=document.getElementById("mapbox-gl-export-page-orientation").value;let n=JSON.parse(t.value);e===Dg.Portrait&&(n=n.reverse()),this.printableArea.updateArea(n[0],n[1])}};var SP=rnt,ent=Object.prototype.hasOwnProperty;function rnt(){for(var r={},t=0;t<arguments.length;t++){var e=arguments[t];for(var n in e)ent.call(e,n)&&(r[n]=e[n])}return r}var TP={exports:{}};(function(r,t){(function(){var e={};r.exports=e,e.simpleFilter=function(n,i){return i.filter(function(s){return e.test(n,s)})},e.test=function(n,i){return e.match(n,i)!==null},e.match=function(n,i,s){s=s||{};var a=0,o=[],h=i.length,f=0,m=0,b=s.pre||"",x=s.post||"",B=s.caseSensitive&&i||i.toLowerCase(),P;n=s.caseSensitive&&n||n.toLowerCase();for(var R=0;R<h;R++)P=i[R],B[R]===n[a]?(P=b+P+x,a+=1,m+=1+m):m=0,f+=m,o[o.length]=P;return a===n.length?(f=B===n?1/0:f,{rendered:o.join(""),score:f}):null},e.filter=function(n,i,s){return!i||i.length===0?[]:typeof n!="string"?i:(s=s||{},i.reduce(function(a,o,h,f){var m=o;s.extract&&(m=s.extract(o));var b=e.match(n,m,s);return b!=null&&(a[a.length]={string:b.rendered,score:b.score,index:h,original:o}),a},[]).sort(function(a,o){var h=o.score-a.score;return h||a.index-o.index}))}})()})(TP);var nnt=TP.exports,da=function(r){return this.component=r,this.items=[],this.active=r.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,r.el.parentNode.insertBefore(this.wrapper,r.el.nextSibling),this};da.prototype.show=function(){this.element.style.display="block"},da.prototype.hide=function(){this.element.style.display="none"},da.prototype.add=function(r){this.items.push(r)},da.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},da.prototype.isEmpty=function(){return!this.items.length},da.prototype.isVisible=function(){return this.element.style.display==="block"},da.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var r=0;r<this.items.length;r++)this.drawItem(this.items[r],this.active===r);this.show()},da.prototype.drawItem=function(r,t){var e=document.createElement("li"),n=document.createElement("a");t&&(e.className+=" active"),n.innerHTML=r.string,e.appendChild(n),this.element.appendChild(e),e.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),e.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,r)}).bind(this))},da.prototype.handleMouseUp=function(r){this.selectingListItem=!1,this.component.value(r.original),this.clear(),this.draw()},da.prototype.move=function(r){this.active=r,this.draw()},da.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},da.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},da.prototype.drawError=function(r){var t=document.createElement("li");t.innerHTML=r,this.element.appendChild(t),this.show()};var int=da,snt=SP,ont=nnt,ant=int,_o=function(r,t,e){return e=e||{},this.options=snt({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},e),this.el=r,this.data=t||[],this.list=new ant(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(n){this.handleKeyUp(n.keyCode,n)}).bind(this),!1),this.el.addEventListener("keydown",(function(n){this.handleKeyDown(n)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(n){this.handlePaste(n)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};_o.prototype.handleKeyUp=function(r,t){if(!(r===40||r===38||r===27||r===9)){if(r===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),t.stopPropagation());return}this.handleInputChange(this.el.value)}},_o.prototype.handleKeyDown=function(r){switch(r.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&r.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},_o.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},_o.prototype.handlePaste=function(r){if(r.clipboardData)this.handleInputChange(r.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(r.target.value)},100)}},_o.prototype.handleInputChange=function(r){if(this.query=this.normalize(r),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var e=0;e<t.length&&(this.list.add(t[e]),e!==this.options.limit-1);e++);this.list.draw()}).bind(this))},_o.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},_o.prototype.update=function(r){this.data=r,this.handleKeyUp()},_o.prototype.clear=function(){this.data=[],this.list.clear()},_o.prototype.normalize=function(r){return r=r.toLowerCase(),r},_o.prototype.match=function(r,t){return r.indexOf(t)>-1},_o.prototype.value=function(r){if(this.selected=r,this.el.value=this.getItemValue(r||{place_name:this.query}),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")},_o.prototype.getCandidates=function(r){var t={pre:"<strong>",post:"</strong>",extract:(function(n){return this.getItemValue(n)}).bind(this)},e;this.options.filter?(e=ont.filter(this.query,this.data,t),e=e.map((function(n){return{original:n.original,string:this.render(n.original,n.string)}}).bind(this))):e=this.data.map((function(n){var i=this.render(n);return{original:n,string:i}}).bind(this)),r(e)},_o.prototype.getItemValue=function(r){return r},_o.prototype.render=function(r,t){if(t)return t;for(var e=r.original?this.getItemValue(r.original):this.getItemValue(r),n=this.normalize(e),i=n.lastIndexOf(this.query);i>-1;){var s=i+this.query.length;e=e.slice(0,i)+"<strong>"+e.slice(i,s)+"</strong>"+e.slice(s),i=n.slice(0,i).lastIndexOf(this.query)}return e},_o.prototype.renderError=function(r){this.list.drawError(r)};var lnt=_o,IP=lnt,cnt=IP;typeof window<"u"&&(window.Suggestions=IP);var unt="Expected a function",FP=NaN,Ant="[object Symbol]",hnt=/^\s+|\s+$/g,dnt=/^[-+]0x[0-9a-f]+$/i,fnt=/^0b[01]+$/i,pnt=/^0o[0-7]+$/i,gnt=parseInt,mnt=typeof qd=="object"&&qd&&qd.Object===Object&&qd,ynt=typeof self=="object"&&self&&self.Object===Object&&self,_nt=mnt||ynt||Function("return this")(),vnt=Object.prototype,bnt=vnt.toString,wnt=Math.max,xnt=Math.min,X2=function(){return _nt.Date.now()};function Bnt(r,t,e){var n,i,s,a,o,h,f=0,m=!1,b=!1,x=!0;if(typeof r!="function")throw new TypeError(unt);t=LP(t)||0,J2(e)&&(m=!!e.leading,b="maxWait"in e,s=b?wnt(LP(e.maxWait)||0,t):s,x="trailing"in e?!!e.trailing:x);function B(gt){var mt=n,ft=i;return n=i=void 0,f=gt,a=r.apply(ft,mt),a}function P(gt){return f=gt,o=setTimeout(z,t),m?B(gt):a}function R(gt){var mt=gt-h,ft=gt-f,Mt=t-mt;return b?xnt(Mt,s-ft):Mt}function Q(gt){var mt=gt-h,ft=gt-f;return h===void 0||mt>=t||mt<0||b&&ft>=s}function z(){var gt=X2();if(Q(gt))return G(gt);o=setTimeout(z,R(gt))}function G(gt){return o=void 0,x&&n?B(gt):(n=i=void 0,a)}function X(){o!==void 0&&clearTimeout(o),f=0,n=h=i=o=void 0}function et(){return o===void 0?a:G(X2())}function pt(){var gt=X2(),mt=Q(gt);if(n=arguments,i=this,h=gt,mt){if(o===void 0)return P(h);if(b)return o=setTimeout(z,t),B(h)}return o===void 0&&(o=setTimeout(z,t)),a}return pt.cancel=X,pt.flush=et,pt}function J2(r){var t=typeof r;return!!r&&(t=="object"||t=="function")}function Cnt(r){return!!r&&typeof r=="object"}function Ent(r){return typeof r=="symbol"||Cnt(r)&&bnt.call(r)==Ant}function LP(r){if(typeof r=="number")return r;if(Ent(r))return FP;if(J2(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=J2(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=r.replace(hnt,"");var e=fnt.test(r);return e||pnt.test(r)?gnt(r.slice(2),e?2:8):dnt.test(r)?FP:+r}var Snt=Bnt,Y2={exports:{}},Nf=typeof Reflect=="object"?Reflect:null,PP=Nf&&typeof Nf.apply=="function"?Nf.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},ky;Nf&&typeof Nf.ownKeys=="function"?ky=Nf.ownKeys:Object.getOwnPropertySymbols?ky=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ky=function(t){return Object.getOwnPropertyNames(t)};function Tnt(r){console&&console.warn&&console.warn(r)}var MP=Number.isNaN||function(t){return t!==t};function oi(){oi.init.call(this)}Y2.exports=oi,Y2.exports.once=Pnt,oi.EventEmitter=oi,oi.prototype._events=void 0,oi.prototype._eventsCount=0,oi.prototype._maxListeners=void 0;var UP=10;function Qy(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(oi,"defaultMaxListeners",{enumerable:!0,get:function(){return UP},set:function(r){if(typeof r!="number"||r<0||MP(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");UP=r}}),oi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},oi.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||MP(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function RP(r){return r._maxListeners===void 0?oi.defaultMaxListeners:r._maxListeners}oi.prototype.getMaxListeners=function(){return RP(this)},oi.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i=t==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var h=s[t];if(h===void 0)return!1;if(typeof h=="function")PP(h,this,e);else for(var f=h.length,m=QP(h,f),n=0;n<f;++n)PP(m[n],this,e);return!0};function OP(r,t,e,n){var i,s,a;if(Qy(e),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",t,e.listener?e.listener:e),s=r._events),a=s[t]),a===void 0)a=s[t]=e,++r._eventsCount;else if(typeof a=="function"?a=s[t]=n?[e,a]:[a,e]:n?a.unshift(e):a.push(e),i=RP(r),i>0&&a.length>i&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=t,o.count=a.length,Tnt(o)}return r}oi.prototype.addListener=function(t,e){return OP(this,t,e,!1)},oi.prototype.on=oi.prototype.addListener,oi.prototype.prependListener=function(t,e){return OP(this,t,e,!0)};function Int(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function DP(r,t,e){var n={fired:!1,wrapFn:void 0,target:r,type:t,listener:e},i=Int.bind(n);return i.listener=e,n.wrapFn=i,i}oi.prototype.once=function(t,e){return Qy(e),this.on(t,DP(this,t,e)),this},oi.prototype.prependOnceListener=function(t,e){return Qy(e),this.prependListener(t,DP(this,t,e)),this},oi.prototype.removeListener=function(t,e){var n,i,s,a,o;if(Qy(e),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(s=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){o=n[a].listener,s=a;break}if(s<0)return this;s===0?n.shift():Fnt(n,s),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,o||e)}return this},oi.prototype.off=oi.prototype.removeListener,oi.prototype.removeAllListeners=function(t){var e,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var s=Object.keys(n),a;for(i=0;i<s.length;++i)a=s[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function NP(r,t,e){var n=r._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?Lnt(i):QP(i,i.length)}oi.prototype.listeners=function(t){return NP(this,t,!0)},oi.prototype.rawListeners=function(t){return NP(this,t,!1)},oi.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):kP.call(r,t)},oi.prototype.listenerCount=kP;function kP(r){var t=this._events;if(t!==void 0){var e=t[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}oi.prototype.eventNames=function(){return this._eventsCount>0?ky(this._events):[]};function QP(r,t){for(var e=new Array(t),n=0;n<t;++n)e[n]=r[n];return e}function Fnt(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function Lnt(r){for(var t=new Array(r.length),e=0;e<t.length;++e)t[e]=r[e].listener||r[e];return t}function Pnt(r,t){return new Promise(function(e,n){function i(a){r.removeListener(t,s),n(a)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),e([].slice.call(arguments))}HP(r,t,s,{once:!0}),t!=="error"&&Mnt(r,i,{once:!0})})}function Mnt(r,t,e){typeof r.on=="function"&&HP(r,"error",t,e)}function HP(r,t,e,n){if(typeof r.on=="function")n.once?r.once(t,e):r.on(t,e);else if(typeof r.addEventListener=="function")r.addEventListener(t,function i(s){n.once&&r.removeEventListener(t,i),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var zP=Y2.exports,Unt={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Rnt={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},Ont={placeholder:Rnt},VP={exports:{}};(function(r){(function(t,e,n){r.exports?r.exports=n():t[e]=n()})(qd,"subtag",function(){var t="",e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(h){return h.match(e)||[]}function i(h){return n(h).filter(function(f,m){return f&&m})}function s(h){return h=n(h),{language:h[1]||t,extlang:h[2]||t,script:h[3]||t,region:h[4]||t}}function a(h,f,m){Object.defineProperty(h,f,{value:m,enumerable:!0})}function o(h,f,m){function b(x){return n(x)[h]||t}a(b,"pattern",f),a(s,m,b)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(s,"split",i),s})})(VP);var Dnt=VP.exports,Nnt=cnt,knt=Snt,Ha=SP,Qnt=zP.EventEmitter,GP=Unt,Hnt=Ont,znt=Dnt;function jP(r,t){this._eventEmitter=new Qnt,this.options=Ha({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=r}jP.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(r){return r.text!==void 0?r.text:r.place_name},render:function(r){if(r.geometry){var o=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+o[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+o.splice(1,o.length).join(",")+"</div></div></div>"}else{var t=r.text,e=t.toLowerCase().indexOf(this.query.toLowerCase()),n=this.query.length,i=t.substring(0,e),s=t.substring(e,e+n),a=t.substring(e+n);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+i+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+s+"</span>"+a+"</div></div></div>"}},popupRender:function(r){var t=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(r){function t(n,i){if(!document.body.contains(i))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var s=n.onAdd();i.appendChild(s)}if(r._controlContainer)r.addControl(this);else if(r instanceof HTMLElement)t(this,r);else if(typeof r=="string"){var e=document.querySelectorAll(r);if(e.length===0)throw new Error("Element ",r,"not found.");if(e.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,e[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(r){if(r&&typeof r!="string"&&(this._map=r),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var e=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",knt(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var i=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(i),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),t.appendChild(e),t.appendChild(this._inputEl),t.appendChild(n),this._typeahead=new Nnt(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t},createIcon:function(r,t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+r+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+r),e.setAttribute("viewBox","0 0 18 18"),e.setAttribute("xml:space","preserve"),e.setAttribute("width",18),e.setAttribute("height",18),"innerHTML"in e)e.innerHTML=t;else{var n=document.createElement("div");n.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";var i=n.firstChild,s=i.firstChild;e.appendChild(s)}return e},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(r){var t=(r.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)},_onKeyDown:function(r){var t=27,e=9;if(r.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(r),this._inputEl.blur();var n=r.target&&r.target.shadowRoot?r.target.shadowRoot.activeElement:r.target,i=n?n.value:"";if(!i)return this.fresh=!0,r.keyCode!==e&&this.clear(r),this._clearEl.style.display="none";if(!(r.metaKey||[e,t,37,39,38,40].indexOf(r.keyCode)!==-1)){if(r.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(n.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(n.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}n.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(n.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(r){this.options.clearOnBlur&&this._clearOnBlur(r),this.options.collapsed&&this._collapse()},_onChange:function(){var r=this._typeahead.selected;if(r&&!r.geometry)r.placeId?this._geocode(r.placeId,!0,!0):this._geocode(r.text,!0);else if(r&&JSON.stringify(r)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var t;if(this._removeResultMarkers(),r.properties&&GP[r.properties.short_code])t=Ha({},this.options.flyTo),this._map&&this._map.fitBounds(GP[r.properties.short_code].bbox,t);else if(r.bbox){var e=r.bbox;t=Ha({},this.options.flyTo),this._map&&this._map.fitBounds([[e[0],e[1]],[e[2],e[3]]],t)}else{var n={zoom:this.options.zoom};t=Ha({},n,this.options.flyTo),r.center?t.center=r.center:r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(t.center=r.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(r),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(r),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:r})}},_getConfigForRequest:function(){var r=["bbox","limit","proximity","countries","types","language","reverseMode"],t=this,e=r.reduce(function(n,i){return t.options[i]&&(["countries","types","language"].indexOf(i)>-1?n[i]=t.options[i].split(/[\s,]+/):n[i]=t.options[i],i==="proximity"&&t.options[i]&&typeof t.options[i].longitude=="number"&&typeof t.options[i].latitude=="number"&&(n[i]=[t.options[i].longitude,t.options[i].latitude])),n},{});return e},_geocode:function(r,t,e){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:r}),this.inputString=r;var n=null,i=this._getConfigForRequest(),s;if(this.options.localGeocoderOnly)s=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(r)){var a=r.split(/[\s(,)?]+/).map(function(f){return parseFloat(f,10)}).reverse();i.types&&i.types[0],i=Ha(i,{query:a,limit:1}),"proximity"in i&&delete i.proximity,s=this.geocoderApi.reverseGeocode(i)}else i=Ha(i,{query:r}),this.geocoderApi.getSuggestions?t?this.geocoderApi.searchByPlaceId&&e?s=this.geocoderApi.searchByPlaceId(i):s=this.geocoderApi.forwardGeocode(i):s=this.geocoderApi.getSuggestions(i):s=this.geocoderApi.forwardGeocode(i);var o=[];this.options.localGeocoder&&(o=this.options.localGeocoder(r),o||(o=[]));var h=[];return s.catch((function(f){n=f}).bind(this)).then((function(f){this._loadingEl.style.display="none";var m={};return f?m=f:m={type:"FeatureCollection",features:[]},m.config=i,this.fresh&&(this.fresh=!1),m.features=m.features?o.concat(m.features):o,this.options.externalGeocoder?(h=this.options.externalGeocoder(r,m.features,i)||[],h.then(function(b){return m.features=m.features?b.concat(m.features):b,m},function(){return m})):m}).bind(this)).then((function(f){if(n)throw n;this.options.filter&&f.features.length&&(f.features=f.features.filter(this.options.filter));var m=[];f.suggestions?m=f.suggestions:f.place?m=[f.place]:m=f.features,m.length?(this._clearEl.style.display="block",this._typeahead.update(m),(!this.options.showResultsWhileTyping||t)&&this.options.showResultMarkers&&(f.features.length>0||f.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",f)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",f))}).bind(this)).catch((function(f){this._loadingEl.style.display="none",o.length&&this.options.localGeocoder||h.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(o)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:o}),this._eventEmitter.emit("error",{error:f})}).bind(this)),s},_clear:function(r){r&&r.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(r){this._clear(r),this._inputEl.focus()},_clearOnBlur:function(r){var t=this;r.relatedTarget&&t._clear(r)},_onQueryResult:function(r){var t=r;if(t.features.length){var e=t.features[0];this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var r=this._map.getCenter().wrap();this.setProximity({longitude:r.lng,latitude:r.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(r){return this._geocode(r).then(this._onQueryResult),this},_renderError:function(){var r="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(r)},_renderNoResults:function(){var r="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(r)},_renderMessage:function(r){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(r)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var r=this.options.language.split(",")[0],t=znt.language(r),e=Hnt.placeholder[t];if(e)return e}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var r=this._typeahead.data.filter(function(i){return typeof i!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var t={padding:100},e=Ha({},t,this.options.flyTo),n=new this._maplibregl.LngLatBounds;r.forEach(function(i){n.extend(i.geometry.coordinates)}),this._map.fitBounds(n.toArray(),e)}return r.length>0&&this._maplibregl&&this._handleResultMarkers(r),this}},setInput:function(r){return this._inputEl.value=r,this._typeahead.selected=null,this._typeahead.clear(),r.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r),this},setProximity:function(r){return this.options.proximity=r,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(r){return r&&typeof r=="function"&&(this._typeahead.render=r),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(r){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=r||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(r){return this.options.zoom=r,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(r){return this.options.flyTo=r,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(r){return this.placeholder=r||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(r){return this.options.bbox=r,this},getCountries:function(){return this.options.countries},setCountries:function(r){return this.options.countries=r,this},getTypes:function(){return this.options.types},setTypes:function(r){return this.options.types=r,this},getMinLength:function(){return this.options.minLength},setMinLength:function(r){return this.options.minLength=r,this._typeahead&&(this._typeahead.options.minLength=r),this},getLimit:function(){return this.options.limit},setLimit:function(r){return this.options.limit=r,this._typeahead&&(this._typeahead.options.limit=r),this},getFilter:function(){return this.options.filter},setFilter:function(r){return this.options.filter=r,this},setGeocoderApi:function(r){return this.geocoderApi=r,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(r){if(this._map){this._removeMarker();var t={color:"#4668F2"},e=Ha({},t,this.options.marker);this.mapMarker=new this._maplibregl.Marker(e);var n;if(this.options.popup){var i={},s=Ha({},i,this.options.popup);n=new this._maplibregl.Popup(s).setHTML(this.options.popupRender(r))}return r.center?(this.mapMarker.setLngLat(r.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(this.mapMarker.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(r){if(this._map){this._removeResultMarkers();var t={color:"#4668F2"},e=Ha({},t,this.options.showResultMarkers);return r.forEach((function(n){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var i=this.options.showResultMarkers.element.cloneNode(!0);e=Ha(e,{element:i})}var s=new this._maplibregl.Marker(Ha({},e,{element:i})),a;if(this.options.popup){var o={},h=Ha({},o,this.options.popup);a=new this._maplibregl.Popup(h).setHTML(this.options.popupRender(n))}n.center?(s.setLngLat(n.center).addTo(this._map),this.options.popup&&s.setPopup(a)):n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&(s.setLngLat(n.geometry.coordinates).addTo(this._map),this.options.popup&&s.setPopup(a)),this.resultMarkers.push(s)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(r){r.remove()}),this.resultMarkers=[])},on:function(r,t){return this._eventEmitter.on(r,t),this},off:function(r,t){return this._eventEmitter.removeListener(r,t),this}};var Vnt=jP;const Gnt=Dp(Vnt),ed={defaultOptions:{limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogrfic i Geolgic de Catalunya",logoWidth:100},logoGencatOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensals2023",key:"districtes_censals_2023"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensals2023",key:"seccions_censals_2023"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://tilemaps.icgc.cat/cdn/images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},Styles:{TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},Terrains:{ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Layers:{Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensals2023:"districtes_censals_2023",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensals2023:"seccions_censals_2023",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}}};class jnt{constructor(t){this.options=t||{}}onAdd(t){let e=ed.defaultOptions;return this._map=t,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?e.logoIcgcOptions.logoUrlColor:e.logoIcgcOptions.logoUrlWhite,this._img1.width=e.logoIcgcOptions.logoWidth,this._img1.title=e.logoIcgcOptions.logoTitle,this.link1=document.createElement("a"),this.link1.href=e.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${e.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?e.logoGencatOptions.logoUrlColor:e.logoGencatOptions.logoUrlWhite,this._img2.width=e.logoGencatOptions.logoWidth,this._img2.title=e.logoGencatOptions.logoTitle,this.link2=document.createElement("a"),this.link2.href=e.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${e.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class qnt{constructor(t){this.options=t||{}}onAdd(t){this._map=t,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const e=document.createElement("label");return e.classList.add("maplibregl-legend-title-label"),e.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(e),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var kf=qP.prototype,Z2="WGS 84";function qP(r){r!==void 0&&(Z2=r),this.setEllipsoid(Z2)}kf.convertLatLngToUtm=function(r,t,e){var n;if(this.status)return"No ecclipsoid data associated with unknown datum: "+Z2;if(!Number.isInteger(e))return"Precision is not integer number.";r=parseFloat(r),t=parseFloat(t);var i=t,s=this.toRadians(r),a=this.toRadians(i);i>=8&&i<=13&&r>54.5&&r<58||r>=56&&r<64&&i>=3&&i<12?n=32:(n=(i+180)/6+1,r>=72&&r<84&&(i>=0&&i<9?n=31:i>=9&&i<21?n=33:i>=21&&i<33?n=35:i>=33&&i<42&&(n=37))),n=parseInt(n);var o=(n-1)*6-180+3,h=this.toRadians(o),f=this.getUtmLetterDesignator(r),m=this.eccSquared/(1-this.eccSquared),b=this.a/Math.sqrt(1-this.eccSquared*Math.sin(s)*Math.sin(s)),x=Math.tan(s)*Math.tan(s),B=m*Math.cos(s)*Math.cos(s),P=Math.cos(s)*(a-h),R=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*s-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*s)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*s)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*s)),Q=parseFloat(.9996*b*(P+(1-x+B)*P*P*P/6+(5-18*x+x*x+72*B-58*m)*P*P*P*P*P/120)+5e5),z=parseFloat(.9996*(R+b*Math.tan(s)*(P*P/2+(5-x+9*B+4*B*B)*P*P*P*P/24+(61-58*x+x*x+600*B-330*m)*P*P*P*P*P*P/720)));return r<0&&(z+=1e7),z=KP(z,e),Q=KP(Q,e),{Easting:Q,Northing:z,ZoneNumber:parseInt(n),ZoneLetter:f}},kf.convertUtmToLatLng=function(r,t,e,n){var i=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),s=r-5e5,a=t,o=e,h=n;if(r===void 0)return"Please pass the UTMEasting!";if(t===void 0)return"Please pass the UTMNorthing!";if(e===void 0)return"Please pass the UTMZoneNumber!";if(n===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(h)!==-1||(a-=1e7);var f=(o-1)*6-180+3,m=this.eccSquared/(1-this.eccSquared),b=a/.9996,x=b/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),B=x+(3*i/2-27*i*i*i/32)*Math.sin(2*x)+(21*i*i/16-55*i*i*i*i/32)*Math.sin(4*x)+151*i*i*i/96*Math.sin(6*x);this.toDegrees(B);var P=this.a/Math.sqrt(1-this.eccSquared*Math.sin(B)*Math.sin(B)),R=Math.tan(B)*Math.tan(B),Q=m*Math.cos(B)*Math.cos(B),z=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(B)*Math.sin(B),1.5),G=s/(P*.9996),X=B-P*Math.tan(B)/z*(G*G/2-(5+3*R+10*Q-4*Q*Q-9*m)*G*G*G*G/24+(61+90*R+298*Q+45*R*R-252*m-3*Q*Q)*G*G*G*G*G*G/720);X=this.toDegrees(X);var et=(G-(1+2*R+Q)*G*G*G/6+(5-2*Q+28*R-3*Q*Q+8*m+24*R*R)*G*G*G*G*G/120)/Math.cos(B);return et=f+this.toDegrees(et),{lat:X,lng:et}},kf.getUtmLetterDesignator=function(r){return r=parseFloat(r),84>=r&&r>=72?"X":72>r&&r>=64?"W":64>r&&r>=56?"V":56>r&&r>=48?"U":48>r&&r>=40?"T":40>r&&r>=32?"S":32>r&&r>=24?"R":24>r&&r>=16?"Q":16>r&&r>=8?"P":8>r&&r>=0?"N":0>r&&r>=-8?"M":-8>r&&r>=-16?"L":-16>r&&r>=-24?"K":-24>r&&r>=-32?"J":-32>r&&r>=-40?"H":-40>r&&r>=-48?"G":-48>r&&r>=-56?"F":-56>r&&r>=-64?"E":-64>r&&r>=-72?"D":-72>r&&r>=-80?"C":"Z"},kf.setEllipsoid=function(r){switch(r){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}},kf.toDegrees=function(r){return r/Math.PI*180},kf.toRadians=function(r){return r*Math.PI/180};function KP(r,t){var e=Math.pow(10,t);return Math.round(r*e)/e}var Knt=qP;const Wnt=Dp(Knt);class $nt{constructor(t){this.options=t||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(t){const e=new Wnt;return this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",n=>{const i=n.lngLat.lat,s=n.lngLat.lng;let a="",o="";const h=e.convertLatLngToUtm(i,s,2),f=i>0?"N":"S";this.options.utm&&(a=`ETRS89 UTM ${h.ZoneNumber}${f} X:<b> ${h.Easting}</b> Y:<b> ${h.Northing}</b> <br>`),this.options.lonlat&&(o=`WGS 84 Lon:<b> ${s.toFixed(5)}</b>  Lat:<b> ${i.toFixed(5)}</b>`);const m=`${a}${o}`;this._container.innerHTML=m}),this._container}_lookUTM31(t,e){var n=0,i=0,s=6,a=84;return t>=n&&t<=s&&e>=i&&e<=a}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function WP(r,t){return function(){return r.apply(t,arguments)}}const{toString:Xnt}=Object.prototype,{getPrototypeOf:tx}=Object,Hy=(r=>t=>{const e=Xnt.call(t);return r[e]||(r[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),tu=r=>(r=r.toLowerCase(),t=>Hy(t)===r),zy=r=>t=>typeof t===r,{isArray:Qf}=Array,Vg=zy("undefined");function Jnt(r){return r!==null&&!Vg(r)&&r.constructor!==null&&!Vg(r.constructor)&&wl(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const $P=tu("ArrayBuffer");function Ynt(r){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&$P(r.buffer),t}const Znt=zy("string"),wl=zy("function"),XP=zy("number"),Vy=r=>r!==null&&typeof r=="object",tit=r=>r===!0||r===!1,Gy=r=>{if(Hy(r)!=="object")return!1;const t=tx(r);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},eit=tu("Date"),rit=tu("File"),nit=tu("Blob"),iit=tu("FileList"),sit=r=>Vy(r)&&wl(r.pipe),oit=r=>{let t;return r&&(typeof FormData=="function"&&r instanceof FormData||wl(r.append)&&((t=Hy(r))==="formdata"||t==="object"&&wl(r.toString)&&r.toString()==="[object FormData]"))},ait=tu("URLSearchParams"),lit=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Gg(r,t){let{allOwnKeys:e=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),Qf(r))for(n=0,i=r.length;n<i;n++)t.call(null,r[n],n,r);else{const s=e?Object.getOwnPropertyNames(r):Object.keys(r),a=s.length;let o;for(n=0;n<a;n++)o=s[n],t.call(null,r[o],o,r)}}function JP(r,t){t=t.toLowerCase();const e=Object.keys(r);let n=e.length,i;for(;n-- >0;)if(i=e[n],t===i.toLowerCase())return i;return null}const YP=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ZP=r=>!Vg(r)&&r!==YP;function ex(){const{caseless:r}=ZP(this)&&this||{},t={},e=(n,i)=>{const s=r&&JP(t,i)||i;Gy(t[s])&&Gy(n)?t[s]=ex(t[s],n):Gy(n)?t[s]=ex({},n):Qf(n)?t[s]=n.slice():t[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Gg(arguments[n],e);return t}const cit=function(r,t,e){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Gg(t,(i,s)=>{e&&wl(i)?r[s]=WP(i,e):r[s]=i},{allOwnKeys:n}),r},uit=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Ait=(r,t,e,n)=>{r.prototype=Object.create(t.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:t.prototype}),e&&Object.assign(r.prototype,e)},hit=(r,t,e,n)=>{let i,s,a;const o={};if(t=t||{},r==null)return t;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)a=i[s],(!n||n(a,r,t))&&!o[a]&&(t[a]=r[a],o[a]=!0);r=e!==!1&&tx(r)}while(r&&(!e||e(r,t))&&r!==Object.prototype);return t},dit=(r,t,e)=>{r=String(r),(e===void 0||e>r.length)&&(e=r.length),e-=t.length;const n=r.indexOf(t,e);return n!==-1&&n===e},fit=r=>{if(!r)return null;if(Qf(r))return r;let t=r.length;if(!XP(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=r[t];return e},pit=(r=>t=>r&&t instanceof r)(typeof Uint8Array<"u"&&tx(Uint8Array)),git=(r,t)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;t.call(r,s[0],s[1])}},mit=(r,t)=>{let e;const n=[];for(;(e=r.exec(t))!==null;)n.push(e);return n},yit=tu("HTMLFormElement"),_it=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),tM=(r=>{let{hasOwnProperty:t}=r;return(e,n)=>t.call(e,n)})(Object.prototype),vit=tu("RegExp"),eM=(r,t)=>{const e=Object.getOwnPropertyDescriptors(r),n={};Gg(e,(i,s)=>{let a;(a=t(i,s,r))!==!1&&(n[s]=a||i)}),Object.defineProperties(r,n)},bit=r=>{eM(r,(t,e)=>{if(wl(r)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const n=r[e];if(wl(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},wit=(r,t)=>{const e={},n=i=>{i.forEach(s=>{e[s]=!0})};return Qf(r)?n(r):n(String(r).split(t)),e},xit=()=>{},Bit=(r,t)=>(r=+r,Number.isFinite(r)?r:t),rx="abcdefghijklmnopqrstuvwxyz",rM="0123456789",nM={DIGIT:rM,ALPHA:rx,ALPHA_DIGIT:rx+rx.toUpperCase()+rM},Cit=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nM.ALPHA_DIGIT,e="";const{length:n}=t;for(;r--;)e+=t[Math.random()*n|0];return e};function Eit(r){return!!(r&&wl(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const Sit=r=>{const t=new Array(10),e=(n,i)=>{if(Vy(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;const s=Qf(n)?[]:{};return Gg(n,(a,o)=>{const h=e(a,i+1);!Vg(h)&&(s[o]=h)}),t[i]=void 0,s}}return n};return e(r,0)},Tit=tu("AsyncFunction"),Se={isArray:Qf,isArrayBuffer:$P,isBuffer:Jnt,isFormData:oit,isArrayBufferView:Ynt,isString:Znt,isNumber:XP,isBoolean:tit,isObject:Vy,isPlainObject:Gy,isUndefined:Vg,isDate:eit,isFile:rit,isBlob:nit,isRegExp:vit,isFunction:wl,isStream:sit,isURLSearchParams:ait,isTypedArray:pit,isFileList:iit,forEach:Gg,merge:ex,extend:cit,trim:lit,stripBOM:uit,inherits:Ait,toFlatObject:hit,kindOf:Hy,kindOfTest:tu,endsWith:dit,toArray:fit,forEachEntry:git,matchAll:mit,isHTMLForm:yit,hasOwnProperty:tM,hasOwnProp:tM,reduceDescriptors:eM,freezeMethods:bit,toObjectSet:wit,toCamelCase:_it,noop:xit,toFiniteNumber:Bit,findKey:JP,global:YP,isContextDefined:ZP,ALPHABET:nM,generateString:Cit,isSpecCompliantForm:Eit,toJSONObject:Sit,isAsyncFn:Tit,isThenable:r=>r&&(Vy(r)||wl(r))&&wl(r.then)&&wl(r.catch)};function Cn(r,t,e,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),n&&(this.request=n),i&&(this.response=i)}Se.inherits(Cn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Se.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const iM=Cn.prototype,sM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{sM[r]={value:r}}),Object.defineProperties(Cn,sM),Object.defineProperty(iM,"isAxiosError",{value:!0}),Cn.from=(r,t,e,n,i,s)=>{const a=Object.create(iM);return Se.toFlatObject(r,a,function(h){return h!==Error.prototype},o=>o!=="isAxiosError"),Cn.call(a,r.message,t,e,n,i),a.cause=r,a.name=r.name,s&&Object.assign(a,s),a};const Iit=null;function nx(r){return Se.isPlainObject(r)||Se.isArray(r)}function oM(r){return Se.endsWith(r,"[]")?r.slice(0,-2):r}function aM(r,t,e){return r?r.concat(t).map(function(i,s){return i=oM(i),!e&&s?"["+i+"]":i}).join(e?".":""):t}function Fit(r){return Se.isArray(r)&&!r.some(nx)}const Lit=Se.toFlatObject(Se,{},null,function(t){return/^is[A-Z]/.test(t)});function jy(r,t,e){if(!Se.isObject(r))throw new TypeError("target must be an object");t=t||new FormData,e=Se.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(R,Q){return!Se.isUndefined(Q[R])});const n=e.metaTokens,i=e.visitor||m,s=e.dots,a=e.indexes,h=(e.Blob||typeof Blob<"u"&&Blob)&&Se.isSpecCompliantForm(t);if(!Se.isFunction(i))throw new TypeError("visitor must be a function");function f(P){if(P===null)return"";if(Se.isDate(P))return P.toISOString();if(!h&&Se.isBlob(P))throw new Cn("Blob is not supported. Use a Buffer instead.");return Se.isArrayBuffer(P)||Se.isTypedArray(P)?h&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function m(P,R,Q){let z=P;if(P&&!Q&&typeof P=="object"){if(Se.endsWith(R,"{}"))R=n?R:R.slice(0,-2),P=JSON.stringify(P);else if(Se.isArray(P)&&Fit(P)||(Se.isFileList(P)||Se.endsWith(R,"[]"))&&(z=Se.toArray(P)))return R=oM(R),z.forEach(function(X,et){!(Se.isUndefined(X)||X===null)&&t.append(a===!0?aM([R],et,s):a===null?R:R+"[]",f(X))}),!1}return nx(P)?!0:(t.append(aM(Q,R,s),f(P)),!1)}const b=[],x=Object.assign(Lit,{defaultVisitor:m,convertValue:f,isVisitable:nx});function B(P,R){if(!Se.isUndefined(P)){if(b.indexOf(P)!==-1)throw Error("Circular reference detected in "+R.join("."));b.push(P),Se.forEach(P,function(z,G){(!(Se.isUndefined(z)||z===null)&&i.call(t,z,Se.isString(G)?G.trim():G,R,x))===!0&&B(z,R?R.concat(G):[G])}),b.pop()}}if(!Se.isObject(r))throw new TypeError("data must be an object");return B(r),t}function lM(r){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function ix(r,t){this._pairs=[],r&&jy(r,this,t)}const cM=ix.prototype;cM.append=function(t,e){this._pairs.push([t,e])},cM.toString=function(t){const e=t?function(n){return t.call(this,n,lM)}:lM;return this._pairs.map(function(i){return e(i[0])+"="+e(i[1])},"").join("&")};function Pit(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function uM(r,t,e){if(!t)return r;const n=e&&e.encode||Pit,i=e&&e.serialize;let s;if(i?s=i(t,e):s=Se.isURLSearchParams(t)?t.toString():new ix(t,e).toString(n),s){const a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class AM{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Se.forEach(this.handlers,function(n){n!==null&&t(n)})}}const hM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Mit={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:ix,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},dM=typeof window<"u"&&typeof document<"u",Uit=(r=>dM&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),Rit=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",eu={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:dM,hasStandardBrowserEnv:Uit,hasStandardBrowserWebWorkerEnv:Rit},Symbol.toStringTag,{value:"Module"})),...Mit};function Oit(r,t){return jy(r,new eu.classes.URLSearchParams,Object.assign({visitor:function(e,n,i,s){return eu.isNode&&Se.isBuffer(e)?(this.append(n,e.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},t))}function Dit(r){return Se.matchAll(/\w+|\[(\w*)]/g,r).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Nit(r){const t={},e=Object.keys(r);let n;const i=e.length;let s;for(n=0;n<i;n++)s=e[n],t[s]=r[s];return t}function fM(r){function t(e,n,i,s){let a=e[s++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),h=s>=e.length;return a=!a&&Se.isArray(i)?i.length:a,h?(Se.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o):((!i[a]||!Se.isObject(i[a]))&&(i[a]=[]),t(e,n,i[a],s)&&Se.isArray(i[a])&&(i[a]=Nit(i[a])),!o)}if(Se.isFormData(r)&&Se.isFunction(r.entries)){const e={};return Se.forEachEntry(r,(n,i)=>{t(Dit(n),i,e,0)}),e}return null}function kit(r,t,e){if(Se.isString(r))try{return(t||JSON.parse)(r),Se.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(e||JSON.stringify)(r)}const jg={transitional:hM,adapter:["xhr","http"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,s=Se.isObject(t);if(s&&Se.isHTMLForm(t)&&(t=new FormData(t)),Se.isFormData(t))return i?JSON.stringify(fM(t)):t;if(Se.isArrayBuffer(t)||Se.isBuffer(t)||Se.isStream(t)||Se.isFile(t)||Se.isBlob(t))return t;if(Se.isArrayBufferView(t))return t.buffer;if(Se.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Oit(t,this.formSerializer).toString();if((o=Se.isFileList(t))||n.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return jy(o?{"files[]":t}:t,h&&new h,this.formSerializer)}}return s||i?(e.setContentType("application/json",!1),kit(t)):t}],transformResponse:[function(t){const e=this.transitional||jg.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(t&&Se.isString(t)&&(n&&!this.responseType||i)){const a=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(o){if(a)throw o.name==="SyntaxError"?Cn.from(o,Cn.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:eu.classes.FormData,Blob:eu.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Se.forEach(["delete","get","head","post","put","patch"],r=>{jg.headers[r]={}});const Qit=Se.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Hit=r=>{const t={};let e,n,i;return r&&r.split(`
`).forEach(function(a){i=a.indexOf(":"),e=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!e||t[e]&&Qit[e])&&(e==="set-cookie"?t[e]?t[e].push(n):t[e]=[n]:t[e]=t[e]?t[e]+", "+n:n)}),t},pM=Symbol("internals");function qg(r){return r&&String(r).trim().toLowerCase()}function qy(r){return r===!1||r==null?r:Se.isArray(r)?r.map(qy):String(r)}function zit(r){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=e.exec(r);)t[n[1]]=n[2];return t}const Vit=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function sx(r,t,e,n,i){if(Se.isFunction(n))return n.call(this,t,e);if(i&&(t=e),!!Se.isString(t)){if(Se.isString(n))return t.indexOf(n)!==-1;if(Se.isRegExp(n))return n.test(t)}}function Git(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,n)=>e.toUpperCase()+n)}function jit(r,t){const e=Se.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+e,{value:function(i,s,a){return this[n].call(this,t,i,s,a)},configurable:!0})})}class xl{constructor(t){t&&this.set(t)}set(t,e,n){const i=this;function s(o,h,f){const m=qg(h);if(!m)throw new Error("header name must be a non-empty string");const b=Se.findKey(i,m);(!b||i[b]===void 0||f===!0||f===void 0&&i[b]!==!1)&&(i[b||h]=qy(o))}const a=(o,h)=>Se.forEach(o,(f,m)=>s(f,m,h));return Se.isPlainObject(t)||t instanceof this.constructor?a(t,e):Se.isString(t)&&(t=t.trim())&&!Vit(t)?a(Hit(t),e):t!=null&&s(e,t,n),this}get(t,e){if(t=qg(t),t){const n=Se.findKey(this,t);if(n){const i=this[n];if(!e)return i;if(e===!0)return zit(i);if(Se.isFunction(e))return e.call(this,i,n);if(Se.isRegExp(e))return e.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=qg(t),t){const n=Se.findKey(this,t);return!!(n&&this[n]!==void 0&&(!e||sx(this,this[n],n,e)))}return!1}delete(t,e){const n=this;let i=!1;function s(a){if(a=qg(a),a){const o=Se.findKey(n,a);o&&(!e||sx(n,n[o],o,e))&&(delete n[o],i=!0)}}return Se.isArray(t)?t.forEach(s):s(t),i}clear(t){const e=Object.keys(this);let n=e.length,i=!1;for(;n--;){const s=e[n];(!t||sx(this,this[s],s,t,!0))&&(delete this[s],i=!0)}return i}normalize(t){const e=this,n={};return Se.forEach(this,(i,s)=>{const a=Se.findKey(n,s);if(a){e[a]=qy(i),delete e[s];return}const o=t?Git(s):String(s).trim();o!==s&&delete e[s],e[o]=qy(i),n[o]=!0}),this}concat(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.constructor.concat(this,...e)}toJSON(t){const e=Object.create(null);return Se.forEach(this,(n,i)=>{n!=null&&n!==!1&&(e[i]=t&&Se.isArray(n)?n.join(", "):n)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[e,n]=t;return e+": "+n}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const e=new this(t);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i.forEach(a=>e.set(a)),e}static accessor(t){const n=(this[pM]=this[pM]={accessors:{}}).accessors,i=this.prototype;function s(a){const o=qg(a);n[o]||(jit(i,a),n[o]=!0)}return Se.isArray(t)?t.forEach(s):s(t),this}}xl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Se.reduceDescriptors(xl.prototype,(r,t)=>{let{value:e}=r,n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(i){this[n]=i}}}),Se.freezeMethods(xl);function ox(r,t){const e=this||jg,n=t||e,i=xl.from(n.headers);let s=n.data;return Se.forEach(r,function(o){s=o.call(e,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function gM(r){return!!(r&&r.__CANCEL__)}function Kg(r,t,e){Cn.call(this,r??"canceled",Cn.ERR_CANCELED,t,e),this.name="CanceledError"}Se.inherits(Kg,Cn,{__CANCEL__:!0});function qit(r,t,e){const n=e.config.validateStatus;!e.status||!n||n(e.status)?r(e):t(new Cn("Request failed with status code "+e.status,[Cn.ERR_BAD_REQUEST,Cn.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}const Kit=eu.hasStandardBrowserEnv?{write(r,t,e,n,i,s){const a=[r+"="+encodeURIComponent(t)];Se.isNumber(e)&&a.push("expires="+new Date(e).toGMTString()),Se.isString(n)&&a.push("path="+n),Se.isString(i)&&a.push("domain="+i),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(r){const t=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Wit(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function $it(r,t){return t?r.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):r}function mM(r,t){return r&&!Wit(t)?$it(r,t):t}const Xit=eu.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let n;function i(s){let a=s;return t&&(e.setAttribute("href",a),a=e.href),e.setAttribute("href",a),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=i(window.location.href),function(a){const o=Se.isString(a)?i(a):a;return o.protocol===n.protocol&&o.host===n.host}}():function(){return function(){return!0}}();function Jit(r){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return t&&t[1]||""}function Yit(r,t){r=r||10;const e=new Array(r),n=new Array(r);let i=0,s=0,a;return t=t!==void 0?t:1e3,function(h){const f=Date.now(),m=n[s];a||(a=f),e[i]=h,n[i]=f;let b=s,x=0;for(;b!==i;)x+=e[b++],b=b%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),f-a<t)return;const B=m&&f-m;return B?Math.round(x*1e3/B):void 0}}function yM(r,t){let e=0;const n=Yit(50,250);return i=>{const s=i.loaded,a=i.lengthComputable?i.total:void 0,o=s-e,h=n(o),f=s<=a;e=s;const m={loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:h||void 0,estimated:h&&a&&f?(a-s)/h:void 0,event:i};m[t?"download":"upload"]=!0,r(m)}}const ax={http:Iit,xhr:typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(e,n){let i=r.data;const s=xl.from(r.headers).normalize();let{responseType:a,withXSRFToken:o}=r,h;function f(){r.cancelToken&&r.cancelToken.unsubscribe(h),r.signal&&r.signal.removeEventListener("abort",h)}let m;if(Se.isFormData(i)){if(eu.hasStandardBrowserEnv||eu.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if((m=s.getContentType())!==!1){const[R,...Q]=m?m.split(";").map(z=>z.trim()).filter(Boolean):[];s.setContentType([R||"multipart/form-data",...Q].join("; "))}}let b=new XMLHttpRequest;if(r.auth){const R=r.auth.username||"",Q=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";s.set("Authorization","Basic "+btoa(R+":"+Q))}const x=mM(r.baseURL,r.url);b.open(r.method.toUpperCase(),uM(x,r.params,r.paramsSerializer),!0),b.timeout=r.timeout;function B(){if(!b)return;const R=xl.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),z={data:!a||a==="text"||a==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:R,config:r,request:b};qit(function(X){e(X),f()},function(X){n(X),f()},z),b=null}if("onloadend"in b?b.onloadend=B:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(B)},b.onabort=function(){b&&(n(new Cn("Request aborted",Cn.ECONNABORTED,r,b)),b=null)},b.onerror=function(){n(new Cn("Network Error",Cn.ERR_NETWORK,r,b)),b=null},b.ontimeout=function(){let Q=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const z=r.transitional||hM;r.timeoutErrorMessage&&(Q=r.timeoutErrorMessage),n(new Cn(Q,z.clarifyTimeoutError?Cn.ETIMEDOUT:Cn.ECONNABORTED,r,b)),b=null},eu.hasStandardBrowserEnv&&(o&&Se.isFunction(o)&&(o=o(r)),o||o!==!1&&Xit(x))){const R=r.xsrfHeaderName&&r.xsrfCookieName&&Kit.read(r.xsrfCookieName);R&&s.set(r.xsrfHeaderName,R)}i===void 0&&s.setContentType(null),"setRequestHeader"in b&&Se.forEach(s.toJSON(),function(Q,z){b.setRequestHeader(z,Q)}),Se.isUndefined(r.withCredentials)||(b.withCredentials=!!r.withCredentials),a&&a!=="json"&&(b.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&b.addEventListener("progress",yM(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&b.upload&&b.upload.addEventListener("progress",yM(r.onUploadProgress)),(r.cancelToken||r.signal)&&(h=R=>{b&&(n(!R||R.type?new Kg(null,r,b):R),b.abort(),b=null)},r.cancelToken&&r.cancelToken.subscribe(h),r.signal&&(r.signal.aborted?h():r.signal.addEventListener("abort",h)));const P=Jit(x);if(P&&eu.protocols.indexOf(P)===-1){n(new Cn("Unsupported protocol "+P+":",Cn.ERR_BAD_REQUEST,r));return}b.send(i||null)})}};Se.forEach(ax,(r,t)=>{if(r){try{Object.defineProperty(r,"name",{value:t})}catch{}Object.defineProperty(r,"adapterName",{value:t})}});const _M=r=>`- ${r}`,Zit=r=>Se.isFunction(r)||r===null||r===!1,vM={getAdapter:r=>{r=Se.isArray(r)?r:[r];const{length:t}=r;let e,n;const i={};for(let s=0;s<t;s++){e=r[s];let a;if(n=e,!Zit(e)&&(n=ax[(a=String(e)).toLowerCase()],n===void 0))throw new Cn(`Unknown adapter '${a}'`);if(n)break;i[a||"#"+s]=n}if(!n){const s=Object.entries(i).map(o=>{let[h,f]=o;return`adapter ${h} `+(f===!1?"is not supported by the environment":"is not available in the build")});let a=t?s.length>1?`since :
`+s.map(_M).join(`
`):" "+_M(s[0]):"as no adapter specified";throw new Cn("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:ax};function lx(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Kg(null,r)}function bM(r){return lx(r),r.headers=xl.from(r.headers),r.data=ox.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),vM.getAdapter(r.adapter||jg.adapter)(r).then(function(n){return lx(r),n.data=ox.call(r,r.transformResponse,n),n.headers=xl.from(n.headers),n},function(n){return gM(n)||(lx(r),n&&n.response&&(n.response.data=ox.call(r,r.transformResponse,n.response),n.response.headers=xl.from(n.response.headers))),Promise.reject(n)})}const wM=r=>r instanceof xl?{...r}:r;function Hf(r,t){t=t||{};const e={};function n(f,m,b){return Se.isPlainObject(f)&&Se.isPlainObject(m)?Se.merge.call({caseless:b},f,m):Se.isPlainObject(m)?Se.merge({},m):Se.isArray(m)?m.slice():m}function i(f,m,b){if(Se.isUndefined(m)){if(!Se.isUndefined(f))return n(void 0,f,b)}else return n(f,m,b)}function s(f,m){if(!Se.isUndefined(m))return n(void 0,m)}function a(f,m){if(Se.isUndefined(m)){if(!Se.isUndefined(f))return n(void 0,f)}else return n(void 0,m)}function o(f,m,b){if(b in t)return n(f,m);if(b in r)return n(void 0,f)}const h={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(f,m)=>i(wM(f),wM(m),!0)};return Se.forEach(Object.keys(Object.assign({},r,t)),function(m){const b=h[m]||i,x=b(r[m],t[m],m);Se.isUndefined(x)&&b!==o||(e[m]=x)}),e}const xM="1.6.8",cx={};["object","boolean","number","function","string","symbol"].forEach((r,t)=>{cx[r]=function(n){return typeof n===r||"a"+(t<1?"n ":" ")+r}});const BM={};cx.transitional=function(t,e,n){function i(s,a){return"[Axios v"+xM+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,o)=>{if(t===!1)throw new Cn(i(a," has been removed"+(e?" in "+e:"")),Cn.ERR_DEPRECATED);return e&&!BM[a]&&(BM[a]=!0,console.warn(i(a," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,a,o):!0}};function tst(r,t,e){if(typeof r!="object")throw new Cn("options must be an object",Cn.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],a=t[s];if(a){const o=r[s],h=o===void 0||a(o,s,r);if(h!==!0)throw new Cn("option "+s+" must be "+h,Cn.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new Cn("Unknown option "+s,Cn.ERR_BAD_OPTION)}}const ux={assertOptions:tst,validators:cx},WA=ux.validators;class rd{constructor(t){this.defaults=t,this.interceptors={request:new AM,response:new AM}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}throw n}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Hf(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:s}=e;n!==void 0&&ux.assertOptions(n,{silentJSONParsing:WA.transitional(WA.boolean),forcedJSONParsing:WA.transitional(WA.boolean),clarifyTimeoutError:WA.transitional(WA.boolean)},!1),i!=null&&(Se.isFunction(i)?e.paramsSerializer={serialize:i}:ux.assertOptions(i,{encode:WA.function,serialize:WA.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=s&&Se.merge(s.common,s[e.method]);s&&Se.forEach(["delete","get","head","post","put","patch","common"],P=>{delete s[P]}),e.headers=xl.concat(a,s);const o=[];let h=!0;this.interceptors.request.forEach(function(R){typeof R.runWhen=="function"&&R.runWhen(e)===!1||(h=h&&R.synchronous,o.unshift(R.fulfilled,R.rejected))});const f=[];this.interceptors.response.forEach(function(R){f.push(R.fulfilled,R.rejected)});let m,b=0,x;if(!h){const P=[bM.bind(this),void 0];for(P.unshift.apply(P,o),P.push.apply(P,f),x=P.length,m=Promise.resolve(e);b<x;)m=m.then(P[b++],P[b++]);return m}x=o.length;let B=e;for(b=0;b<x;){const P=o[b++],R=o[b++];try{B=P(B)}catch(Q){R.call(this,Q);break}}try{m=bM.call(this,B)}catch(P){return Promise.reject(P)}for(b=0,x=f.length;b<x;)m=m.then(f[b++],f[b++]);return m}getUri(t){t=Hf(this.defaults,t);const e=mM(t.baseURL,t.url);return uM(e,t.params,t.paramsSerializer)}}Se.forEach(["delete","get","head","options"],function(t){rd.prototype[t]=function(e,n){return this.request(Hf(n||{},{method:t,url:e,data:(n||{}).data}))}}),Se.forEach(["post","put","patch"],function(t){function e(n){return function(s,a,o){return this.request(Hf(o||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}rd.prototype[t]=e(),rd.prototype[t+"Form"]=e(!0)});class Ax{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(s){e=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const a=new Promise(o=>{n.subscribe(o),s=o}).then(i);return a.cancel=function(){n.unsubscribe(s)},a},t(function(s,a,o){n.reason||(n.reason=new Kg(s,a,o),e(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}static source(){let t;return{token:new Ax(function(i){t=i}),cancel:t}}}function est(r){return function(e){return r.apply(null,e)}}function rst(r){return Se.isObject(r)&&r.isAxiosError===!0}const hx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(hx).forEach(r=>{let[t,e]=r;hx[e]=t});function CM(r){const t=new rd(r),e=WP(rd.prototype.request,t);return Se.extend(e,rd.prototype,t,{allOwnKeys:!0}),Se.extend(e,t,null,{allOwnKeys:!0}),e.create=function(i){return CM(Hf(r,i))},e}const fs=CM(jg);fs.Axios=rd,fs.CanceledError=Kg,fs.CancelToken=Ax,fs.isCancel=gM,fs.VERSION=xM,fs.toFormData=jy,fs.AxiosError=Cn,fs.Cancel=fs.CanceledError,fs.all=function(t){return Promise.all(t)},fs.spread=est,fs.isAxiosError=rst,fs.mergeConfig=Hf,fs.AxiosHeaders=xl,fs.formToJSON=r=>fM(Se.isHTMLForm(r)?new FormData(r):r),fs.getAdapter=vM.getAdapter,fs.HttpStatusCode=hx,fs.default=fs;const nst="https://tilemaps.icgc.cat/cdn/configs/mapicgc-config.json",ist=5e3;class EM{static async getConfigICGC(){try{const t=await fs.get(nst,{timeout:ist});return t.data?t.data:(console.log("Resposta sense dades:",t),ed)}catch(t){return t.response?(console.error("Error de resposta:",t.response.data),console.error("Codi d'estat:",t.response.status)):t.request?console.error("No s'ha rebut resposta del servidor:",t.request):console.error("Error:",t.message),ed}}}const sst={cobertesSol:{"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]}},ost="lines",Ky="labels";let nd,Wg,Qi,In,ast=class{constructor(t){EM.getConfigICGC().then(e=>{nd={...e.Styles},Qi={...e.Layers},Wg={...e.Terrains},In={...e.defaultOptions},this.initTheMap(t)}).catch(e=>{console.info("Configuracio per defecte",e),nd={...ed.Styles},Qi={...ed.Layers},Wg={...ed.Terrains},In={...ed.defaultOptions},this.initTheMap(t)})}initTheMap(t){if(!t)t=In.mapOptions;else for(const e in In.mapOptions){let n=[In.mapOptions.center[0],In.mapOptions.center[1]];In.mapOptions.center=n,t.hasOwnProperty(e)||(t[e]=In.mapOptions[e])}t.maxPitch=85,t.maplibreLogo=!1,t.attributionControl=!1,this.map=new Ts.Map(t),this.map.options=t,this.map.addControl(new Ts.AttributionControl({compact:!0})),this.map.on("load",async()=>{const e=this.map.getStyle().name,n=this.map.options.style;if(window.document.querySelector(".maplibregl-compact-show")){var i=window.document.querySelector(".maplibregl-compact-show");i.classList.remove("maplibregl-compact-show")}this.map.addControl(new jnt({color:n.indexOf("orto")===-1,defaultOptions:In}),"bottom-left"),this._dealOrto3dStyle(e)})}addGeocoderICGC(t){try{t===void 0&&(t="top-right");let e={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:Ts,showResultsWhileTyping:!0,minLength:2};const n={forwardGeocode:async s=>{const a=[];try{const o=In.geocoder.peliasUrl1+encodeURIComponent(s.query)+In.geocoder.peliasUrl2,f=await(await fetch(o)).json();for(const m of f.features){const b=m.geometry.coordinates,x={type:"Feature",geometry:{type:"Point",coordinates:b},place_name:m.properties.etiqueta,properties:m.properties,text:m.properties.etiqueta,place_type:["place"],center:b};a.push(x)}}catch(o){console.error(`Failed to forwardGeocode with error: ${o}`)}return{features:a}}};this.map.addControl(new Gnt(n,e),t);let i=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");i[0].attributes[2].nodeValue="Cerca...",i[0].addEventListener("input",function(s){s.target.value.length>3})}catch(e){console.error(`Error adding ICGC geocoder: ${e.message}`)}}async loadImage(t){try{return this.map.loadImage(t)}catch(e){console.error(`Error getting loadImage: ${e.message}`)}}getConfigStyles(){try{let t=[];for(const e of nd)t.push(e.name);return t}catch(t){console.error(`Error retrieving base styles: ${t.message}`)}}getConfigWMSLayers(){try{let t=[];for(const e in Qi.WMS)Qi.WMS.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving WMS layers: ${t.message}`)}}getConfigOrtoLayers(){try{let t=[];for(const e in Qi.Orto)Qi.Orto.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving orto image layers: ${t.message}`)}}getConfigVectorLayers(){try{let t=[];for(const e in Qi.Vector)Qi.Vector.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving vector layers: ${t.message}`)}}getConfigVectorAdminLayers(){try{let t=[];for(const e in Qi.VectorAdmin)Qi.VectorAdmin.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving vectorAdmin layers: ${t.message}`)}}getConfigFGBAdminLayers(){try{let t=[];for(const e in Qi.FGBAdmin)Qi.FGBAdmin.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving FGBAdmin layers: ${t.message}`)}}async fetchData(t,e,n){try{(!n||n===void 0)&&(n={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let i=n.layerPosition;if(t.includes(".fgb"))this.addFGBLayerICGC(t,e,n);else{const a=await(await fetch(t)).json();let o=e,h=this._dealOrderLayer(i),f=a.features[0].geometry.type;f.includes("ine")&&(n!==void 0?this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:n.layout||{},paint:n.paint||{}},h):this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},h)),f.includes("olygon")&&(n!==void 0?this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},h):this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},h)),f.includes("oint")&&(n!==void 0?this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},h):this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},h))}}catch(i){console.error(`Error fetching data: ${i.message}`)}}async fetchDataAndMenu(t,e,n,i){try{let s;i!==null?s=i.layerPosition:s=Ky;let a,o=document.getElementById("map");if(document.getElementById("menu-group")?a=document.getElementById("menu-group"):(a=document.createElement("nav"),a.id="menu-group",a.classList.add="filter-group",o.appendChild(a)),a!==null){let h="visible",f=this._dealOrderLayer(s),m;if(t.includes(".fgb")){let x=this._getKeyByUrlFGB(t);x===null&&(x="userFGB");const B=await fetch(t),P={type:"FeatureCollection",features:[]};for await(const Q of RS(B.body))P.features.push(Q);m=P;let R=e;if(this.map.addSource(R,{type:"geojson",data:P}),t.includes("text"))i!==void 0?this.map.addLayer({id:e,type:"symbol",source:R,layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"symbol",source:R,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:h,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f);else{let Q=e+"Text";this.map.addLayer({id:Q,type:"symbol",source:R,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:h,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)}}else m=await(await fetch(t)).json();if(n!=="all"){const x=document.createElement("div");x.id="titleDivMenu",x.textContent=e,a.appendChild(x);const B=document.createElement("div");B.id="titleDivMenuSub",B.textContent=` ${n}`,a.appendChild(B)}let b;if(i.type?b=i.type:b=m.features[0].geometry.type,n==="all")b.includes("ine")&&(i!==void 0?this.map.addLayer({id:e,type:"line",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"line",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),b.includes("olygon")&&(i!==void 0?this.map.addLayer({id:e,type:"fill",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"fill",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},f)),b.includes("oint")&&(i!==void 0?this.map.addLayer({id:e,type:"circle",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"circle",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},f)),b.includes("ymbol")&&(i!==void 0?this.map.addLayer({id:e,type:"symbol",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"symbol",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)),this.addMenuItem(e);else{let x=n;const B={};m.features.forEach(P=>{const R=P.properties[x],Q=R+"-userFieldFilter-"+e;R!==null&&(B[Q]||(b.includes("ine")&&(i!==void 0?this.map.addLayer({id:Q,type:"line",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint,filter:["==",`${x}`,R]},f):this.map.addLayer({id:Q,type:"line",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${x}`,R],paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),b.includes("olygon")&&(i!==void 0?this.map.addLayer({id:Q,type:"fill",source:{type:"geojson",data:m},filter:["==",`${x}`,R],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:Q,type:"fill",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${x}`,R],paint:{"fill-color":"blue","fill-opacity":.6}},f)),b.includes("oint")&&(i!==void 0?this.map.addLayer({id:Q,type:"circle",source:{type:"geojson",data:m},filter:["==",`${x}`,R],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:Q,type:"circle",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${x}`,R],paint:{"circle-color":"red","circle-opacity":.85}},f)),B[Q]=!0,this.addMenuItem(Q)))})}}}catch(s){console.error(`Error fetching data: ${s.message}`)}}on(t,e){setTimeout(()=>{try{this.map.on(t,e)}catch(n){console.error(`Error adding event ON listener: ${n.message}`)}},500)}setStyle(t,e){try{e!==void 0?this.map.setStyle(t,e):this.map.setStyle(t),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var n=window.document.querySelector(".maplibregl-compact-show");n.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(n){console.error(`Error setting style: ${n.message}`)}}addControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(t,e)}catch(n){console.error(`Error adding control: ${n.message}`)}}addMouseCoordControl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new $nt(t),e)}catch(n){console.error(`Error adding mouse coordinate control: ${n.message}`)}}addGeolocateControl(t,e){try{e===void 0&&(e="top-right"),t===void 0?this.map.addControl(new Ts.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),e):this.map.addControl(new Ts.GeolocateControl(t),e)}catch(n){console.error(`Error adding geolocate control: ${n.message}`)}}addFullscreenControl(t,e){try{e===void 0&&(e="top-right"),t===void 0?this.map.addControl(new Ts.FullscreenControl({container:HTMLElement}),e):this.map.addControl(new Ts.FullscreenControl(t),e)}catch(n){console.error(`Error adding fullscreen control: ${n.message}`)}}addLayer(t,e){try{this.map.addLayer(t,e)}catch(n){console.error(`Error adding layer: ${n.message}`)}}addImage(t,e,n){try{this.map.addImage(t,e,n)}catch(i){console.error(`Error adding image: ${i.message}`)}return this}addSource(t,e){try{this.map.addSource(t,e)}catch(n){console.error(`Error adding source: ${n.message}`)}return this}addSprite(t,e,n){try{this.map.addSprite(t,e,n)}catch(i){console.error(`Error adding sprite: ${i.message}`)}return this}areTilesLoaded(){return this.map.areTilesLoaded()}cameraForBounds(t,e){return this.map.cameraForBounds(t,e)}easeTo(t,e){return this.map.easeTo(t,e),this}fitBounds(t,e,n){return this.map.fitBounds(t,e,n),this}fitScreenCoordinates(t,e,n,i,s){return this.map.fitScreenCoordinates(t,e,n,i,s),this}flyTo(t,e){return this.map.flyTo(t,e),this}getBearing(){return this.map.getBearing()}getBounds(){return this.map.getBounds()}getCameraTargetElevation(){return this.map.getCameraTargetElevation()}getCanvas(){return this.map.getCanvas()}getCanvasContainer(){return this.map.getCanvasContainer()}getCenter(){return this.map.getCenter()}getContainer(){return this.map.getContainer()}getFeatureState(t){return this.map.getFeatureState(t)}getFilter(t){return this.map.getFilter(t)}getGlyphs(){return this.map.getGlyphs()}getImage(t){return this.map.getImage(t)}getLayer(t){return this.map.getLayer(t)}getLayersOrder(){return this.map.getLayersOrder()}getLayoutProperty(t,e){return this.map.getLayoutProperty(t,e)}getLight(){return this.map.getLight()}getMaxBounds(){return this.map.getMaxBounds()}getMaxPitch(){return this.map.getMaxPitch()}getMaxZoom(){return this.map.getMaxZoom()}getMinPitch(){return this.map.getMinPitch()}getMinZoom(){return this.map.getMinZoom()}getPadding(){return this.map.getPadding()}getPaintProperty(t,e){return this.map.getPaintProperty(t,e)}getPitch(){return this.map.getPitch()}getPixelRatio(){return this.map.getPixelRatio()}getRenderWorldCopies(){return this.map.getRenderWorldCopies()}getSource(t){return this.map.getSource(t)}getSprite(){return this.map.getSprite()}getStyle(){return this.map.getStyle()}getTerrain(){return this.map.getTerrain()}getZoom(){return this.map.getZoom()}hasControl(t){return this.map.hasControl(t)}hasImage(t){return this.map.hasImage(t)}isMoving(){return this.map.isMoving()}isRotating(){return this.map.isRotating()}isSourceLoaded(t){return this.map.isSourceLoaded(t)}isStyleLoaded(){return this.map.isStyleLoaded()}isZooming(){return this.map.isZooming()}jumpTo(t,e){return this.map.jumpTo(t,e)}listImages(){return this.map.listImages()}listens(t){return this.map.listens(t)}loadImage(t){return this.map.loadImage(t)}loaded(){return this.map.loaded()}LngLatBounds(t,e){return new Ts.LngLatBounds(t,e)}addProtocol(t,e){return this.map.addProtocol(t,e)}moveLayer(t,e){return this.map.moveLayer(t,e)}panBy(t,e,n){return this.map.panBy(t,e,n)}panTo(t,e,n){return this.map.panTo(t,e,n)}project(t){return this.map.project(t)}queryRenderedFeatures(t,e){return this.map.queryRenderedFeatures(t,e)}querySourceFeatures(t,e){return this.map.querySourceFeatures(t,e)}queryTerrainElevation(t){return this.map.queryTerrainElevation(t)}redraw(){return this.map.redraw()}remove(){return this.map.remove()}removeControl(t){return this.map.removeControl(t)}removeFeatureState(t,e){return this.map.removeFeatureState(t,e)}removeImage(t){return this.map.removeImage(t)}removeLayer(t){try{this.map.removeLayer(t)}catch(e){console.error(`Error removing layer: ${e.message}`)}}removeSource(t){try{this.map.removeSource(t)}catch(e){console.error(`Error removing source: ${e.message}`)}}removeSprite(t){return this.map.removeSprite(t)}resetNorth(t,e){return this.map.resetNorth(t,e)}resetNorthPitch(t,e){return this.map.resetNorthPitch(t,e)}resize(t){return this.map.resize(t)}rotateTo(t,e,n){return this.map.rotateTo(t,e,n)}setBearing(t,e){return this.map.setBearing(t,e)}setCenter(t,e){return this.map.setCenter(t,e)}setEventedParent(t,e){return this.map.setEventedParent(t,e)}setFeatureState(t,e){return this.map.setFeatureState(t,e)}setFilter(t,e,n){return this.map.setFilter(t,e,n)}setGlyphs(t,e){return this.map.setGlyphs(t,e)}setLayerZoomRange(t,e,n){return this.map.setLayerZoomRange(t,e,n)}setLayoutProperty(t,e,n,i){return this.map.setLayoutProperty(t,e,n,i)}setLight(t,e){return this.map.setLight(t,e)}setMaxBounds(t){return this.map.setMaxBounds(t)}setMaxPitch(t){return this.map.setMaxPitch(t)}setMaxZoom(t){return this.map.setMaxZoom(t)}setMinPitch(t){return this.map.setMinPitch(t)}setMinZoom(t){return this.map.setMinZoom(t)}setPadding(t,e){return this.map.setPadding(t,e)}setPaintProperty(t,e,n,i){return this.map.setPaintProperty(t,e,n,i)}setPitch(t,e){return this.map.setPitch(t,e)}setPixelRatio(t){return this.map.setPixelRatio(t)}setRenderWorldCopies(t){return this.map.setRenderWorldCopies(t)}setSprite(t,e){return this.map.setSprite(t,e)}setTerrain(t){return this.map.setTerrain(t)}setTransformRequest(t){return this.map.setTransformRequest(t)}setZoom(t,e){return this.map.setZoom(t,e)}snapToNorth(t,e){return this.map.snapToNorth(t,e)}stop(){return this.map.stop()}triggerRepaint(){return this.map.triggerRepaint()}unproject(t){return this.map.unproject(t)}updateImage(t,e){return this.map.updateImage(t,e)}zoomIn(t,e){return this.map.zoomIn(t,e)}zoomOut(t,e){return this.map.zoomOut(t,e)}zoomTo(t,e,n){return this.map.zoomTo(t,e,n)}addLayerGeoJSON(t,e){try{let n=this._dealOrderLayer(e);this.map.addSource(`${t.id}`,{type:"geojson",data:t.data}),this.map.addLayer({id:`${t.id}-layerIcgcMap`,type:t.type,source:`${t.id}`,layout:t.layout,paint:t.paint},n)}catch(n){console.error(`Error adding GeoJSON layer: ${n.message}`)}}addLayerWMS(t,e,n){try{let i=this._dealOrderLayer(n.layerPosition);n?(this.map.addSource(`${e}`,{type:"raster",tiles:[t],tileSize:256},i),this.map.addLayer({id:e,type:"raster",source:e,layout:n.layout,paint:n.paint},i)):(this.map.addSource(`${e}`,{type:"raster",tiles:[t],tileSize:256},i),this.map.addLayer({id:e,type:"raster",source:e,paint:{}},i))}catch(i){console.error(`Error adding WMS layer: ${i.message}`)}}addLogo(t){try{let e=document.getElementById("map"),n;n=document.createElement("div"),n.id="logos",e.appendChild(n);const i=document.createElement("img");i.src=t.url,i.style.height=t.height;const s=document.getElementById("logos"),a=document.createElement("a");a.id=t.id,a.href=t.href,a.target="_blank",a.style.position="relative",a.style.bottom="1px",a.appendChild(i),s.appendChild(a)}catch(e){console.error(`Error adding logo: ${e.message}`)}}addBasemapsICGC(t){try{const e=a=>{this.map.setStyle(a)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="filter-group",n.appendChild(i);const s=document.getElementById("basemap-group");for(const a of t)for(const o of Object.keys(In.baseStyles)){const h=In.baseStyles[o];if(a===h.url){const f=document.createElement("div");f.className="basemap-item",f.title=h.key,f.style.backgroundImage=`url('${h.image}')`,s.appendChild(f),f.addEventListener("click",()=>e(h.url))}}}catch(e){console.error(`Error adding basemaps: ${e.message}`)}}addBasemaps(t){try{const e=a=>{map.setStyle(a.url)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="basemap-group",n.appendChild(i);const s=document.getElementById("basemap-group");t.forEach(a=>{const o=document.createElement("div");o.className="basemap-item",o.title=a.label,o.style.backgroundImage=`url('${a.image}')`,s.appendChild(o),o.addEventListener("click",()=>e(a))})}catch(e){console.error(`Error adding basemaps: ${e.message}`)}}addFeatureQuery(t,e,n){try{let i;this.map.on("mouseenter",t,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",t,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",s=>{let a=this.map.queryRenderedFeatures(s.point);if(a&&a[0].source.includes(t)){let o=[s.lngLat.lng,s.lngLat.lat];if(e!==void 0&&e.length>0&&e!=="all"){if(e!==null){let h="";e.forEach(f=>{let m=a[0].properties[f];h=h+`<h4>${m}</h4>`}),i=h,this.addPopup(o,i,n)}}else{let h="";for(const f in a[0].properties)h+="<b>"+f+"</b>:"+a[0].properties[f]+"<br>";i=h,this.addPopup(o,i,n)}}})}catch(i){console.error(`Error adding feature query: ${i.message}`)}}addScaleControl(t,e){try{var n=new Ts.ScaleControl(t);this.map.addControl(n,e)}catch(i){console.error(`Error adding scale: ${i.message}`)}}addExportControl(t,e){try{typeof t=="string"&&(e=t,t=void 0),t===void 0&&(t={PageSize:Xh.A4,PageOrientation:Dg.Landscape,Format:Ku.PNG,DPI:C2[300],Crosshair:!0,PrintableArea:!0,Local:"ca"},e="top-right"),this.map.addControl(new tnt(t),e)}catch(n){console.error(`Error adding export control: ${n.message}`)}}addMarker(t){try{let e,n;return t.text===void 0?e=new Ts.Marker(t.options).setLngLat(t.coord).addTo(this.map):(n=new Ts.Popup({offset:t.textOffset}).setHTML(t.text),e=new Ts.Marker(t.options).setLngLat(t.coord).setPopup(n).addTo(this.map)),e}catch(e){return console.error(`Error adding marker: ${e.message}`),null}}addPopup(t,e,n){try{return n.image===void 0?new Ts.Popup().setLngLat(t).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${e}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new Ts.Popup().setLngLat(t).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${e}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${n.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(i){return console.error(`Error adding popup: ${i.message}`),null}}addFullScreen(t){try{t===void 0&&(t="top-right"),this.map.addControl(new Ts.FullscreenControl,t)}catch(e){console.error(`Error adding fullscreen control: ${e.message}`)}}addMenuItem(t){try{let e;if(t.includes("-userFieldFilter-")?e=t.split("-userFieldFilter-")[0]:e=t,t.length>0){const n=document.getElementById("menu-group"),i=document.createElement("input");i.type="checkbox",i.id=t,i.checked=!0,n.appendChild(i);const s=document.createElement("label");s.setAttribute("for",t),s.textContent=e,n.appendChild(s),i.addEventListener("change",a=>{this.map.setLayoutProperty(t,"visibility",a.target.checked?"visible":"none")})}}catch(e){console.error(`Error adding menu item: ${e.message}`)}}addLayerTree(t){try{let e=t.features,n=document.getElementById("map"),i=document.createElement("nav");i.id="filter-group",n.appendChild(i);const s=document.getElementById("filter-group");this.map.addSource(`${t.id}`,{type:t.type,data:e}),e.features.forEach(a=>{const o=a.properties.icon,h=`poi-${o}`;if(!this.map.getLayer(h)){this.map.addLayer({id:h,type:"circle",source:`${t.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",o]},this._firstSymbolLayer());const f=document.createElement("input");f.type="checkbox",f.id=h,f.checked=!0,s.appendChild(f);const m=document.createElement("label");m.setAttribute("for",h),m.textContent=o,s.appendChild(m),f.addEventListener("change",b=>{this.map.setLayoutProperty(h,"visibility",b.target.checked?"visible":"none")})}})}catch(e){console.error(`Error adding layer tree: ${e.message}`)}}createNavigationControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(new Ts.NavigationControl(t),e)}catch(n){return console.error(`Error creating navigation control: ${n.message}`),null}}addNavigationControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(new Ts.NavigationControl(t),e)}catch(n){console.error(`Error adding navigation control: ${n.message}`)}}addAttributionControl(t,e){try{this.map.addControl(new Ts.AttributionControl(t),e)}catch(n){console.error(`Error adding attribution control: ${n.message}`)}}addImageLayerICGC(t,e,n){try{let i=null,s,a;n?(a=n,s=n.layerPosition):a={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:Ky},i=this._findImageType(t,Qi.Orto,Qi.VectorAdmin,Qi.WMS,Qi.Vector),i||console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",t,"font-weight: bold; font-style: italic;");let o={id:e,tiles:t};this.addLayerWMS(t,e,a)}catch(i){console.error(`Error adding ICGC image layer: ${i.message}`)}}async addVectorLayerICGC(t,e,n){try{let{type:i="line",layerPosition:s=Ky,layoutOptions:a={visibility:"visible"},paintOption:o}=n||{},h=this._dealOrderLayer(s);if(!t){console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",t,"font-weight: bold; font-style: italic;");return}if(t.includes("https")){let f=this._getKeyByUrlVector(t);this.map.addSource(f,{type:"vector",url:t});let m={id:f,type:"fill",source:f,"source-layer":"cobertes",maxzoom:18,layout:n.layout,paint:sst.cobertesSol};if(f==="cobertes2018"&&this.map.addLayer(m,h),a.visibility==="visible"){let b=this._getLegendByName(f);console.info("legendUrl",b),console.info("sourceName",f),this.addLegend(b,f)}}else{let f=e;this.map.addSource(f,{type:"vector",url:In.limitsUrl});let m={id:e,type:i,source:f,"source-layer":t,layout:n.layout,paint:n.paint||{}};i==="fill"||i==="polygon"?m.paint=o||{"fill-color":"#0000FF","fill-opacity":0}:i==="line"&&(m.paint=o||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(m,h)}}catch(i){console.error(`Error adding ICGC vector layer: ${i.message}`)}}async addFGBLayerICGC(t,e,n){try{n||(n.layout={visibility:!0},n.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},n.type="lines",n.layerPosition="labels");let i=this._dealOrderLayer(n.layerPosition);const s=await fetch(t),a={type:"FeatureCollection",features:[]};for await(const h of RS(s.body))a.features.push(h);let o=e;this.map.addSource(o,{type:"geojson",data:a}),t.includes("text")?this.map.addLayer({id:e,type:"symbol",source:o,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},i):this.map.addLayer({id:e,type:n.type,source:o,layout:n.layout,paint:n.paint},i)}catch(i){console.error(`Error adding ICGC FGB layer: ${i.message}`)}}addTerrainICGC(t,e){try{let n;for(const s in Wg)if(Wg.hasOwnProperty(s)){const a=Wg[s];a===t&&(n=a)}let i=n;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(a=>{a.source==="terrainICGC"&&this.removeLayer(a.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(t.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),e==null||this.map.addControl(new g8({pitch:90,bearing:null,minpitchzoom:null}),e)}catch(n){console.error(`Error adding 3D terrain: ${n.message}`)}}addLegend(t,e){try{this.map.addControl(new qnt({url:t,idLayer:e}))}catch(n){console.error(`Error adding legend: ${n.message}`)}}_findImageType(t,e,n,i,s){const a=[e,n,i,s];for(const o of a)for(const[h,f]of Object.entries(o))if(f===t)return h;return null}_getKeyByUrlFGB(t){for(const e in Qi.FGBAdmin)if(Qi.FGBAdmin.hasOwnProperty(e)&&Qi.FGBAdmin[e]===t)return e;return null}_getLegendByName(t){for(const e in In.vectorLayers){const n=In.vectorLayers[e];if(n.key===t)return n.legend}return null}_getKeyByUrlVector(t){for(const e in Qi.Vector)if(Qi.Vector.hasOwnProperty(e)&&Qi.Vector[e]===t)return e;return null}async _raiseText3DStyle(){try{const t=await this.map.loadImage(In.map3dOptions.imageIcon);this.map.addImage("stick",t.data),this.map.getStyle().layers.forEach(e=>{if(e["source-layer"]===In.map3dOptions.sourceLayerFilterId&&e.minzoom>=In.map3dOptions.minZoomFilter&&t){const n=e.id;this.map.setLayoutProperty(n,"icon-image","stick"),this.map.setLayoutProperty(n,"text-offset",[0,-9]),this.map.setLayoutProperty(n,"symbol-placement","point"),this.map.setLayoutProperty(n,"symbol-avoid-edges",!1),this.map.setLayoutProperty(n,"text-allow-overlap",!0),this.map.setLayoutProperty(n,"text-ignore-placement",!1),this.map.setLayoutProperty(n,"text-pitch-alignment","auto"),this.map.setLayoutProperty(n,"text-rotation-alignment","auto"),this.map.setLayoutProperty(n,"text-justify","center"),this.map.setLayoutProperty(n,"text-anchor","bottom"),this.map.setLayoutProperty(n,"icon-anchor","bottom"),this.map.setPaintProperty(n,"text-color","#ffffff"),this.map.setPaintProperty(n,"text-halo-color","#000000"),this.map.setPaintProperty(n,"text-halo-width",2)}})}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealStyleMaps(t){try{if(t&&t.indexOf("icgc.cat")!=-1){for(const e in nd)if(nd.hasOwnProperty(e)){const n=nd[e];if(e===t)return n}return nd[0]}else return t}catch(e){return console.error(`Error dealing with map styles: ${e.message}`),null}}_dealOrto3dStyle(t){try{if(t=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const e=new mI({intensity:4}),n=new tw({ambientLight:e});this.map.setTerrain({source:In.map3dOptions.terrainSource,exaggeration:In.map3dOptions.exaggeration});const i=this._createCitiesMapboxLayer();this.map.getLayer(In.map3dOptions.layerId3d)||(this.map.addLayer(i,In.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(In.map3dOptions.layerId3d,In.map3dOptions.minZoomRange,In.map3dOptions.maxZoomRange),i.deck.setProps({effects:[n]}),this._raiseText3DStyle())}else this.map.getLayer(In.map3dOptions.layerId3d)&&(this.map.removeLayer(In.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealOrderLayer(t){return t===Ky?this._firstSymbolLayer():t===ost?this._firstLineLayer():""}_firstSymbolLayer(){try{const t=this.map.getStyle().layers;let e;for(let n=0;n<t.length;n++)if(t[n].type==="symbol"&&t[n].id.indexOf("contour")===-1&&t[n].id.indexOf("water")===-1){console.info(t[n].id),e=t[n].id;break}return e}catch(t){console.error(`Error getting first symbol layer: ${t.message}`)}}_firstLineLayer(){try{const t=this.map.getStyle().layers;let e;for(let n=0;n<t.length;n++)if(t[n].type==="line"){e=t[n].id;break}return e}catch(t){console.error(`Error getting first symbol layer: ${t.message}`)}}_createCitiesMapboxLayer(){try{return new M$({id:In.map3dOptions.layerId3d,type:B2,data:In.map3dOptions.urlTilesetCities,loader:x2,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:In.map3dOptions.spaceErrorFactor}},onTilesetLoad:e=>{e.options.maximumScreenSpaceError=In.map3dOptions.spaceErrorFactor},onTileLoad:e=>{e.content.cartographicOrigin.z-=In.map3dOptions.zfactor},operation:"terrain+draw"})}catch(t){return console.error(`Error adding MapboxLayer: ${t.message}`),null}}};var SM={exports:{}};function lst(r,t){var e=r.getCenter(),n=r.getZoom(),i=r.getBearing(),s=r.getPitch();t.forEach(function(a){a.jumpTo({center:e,zoom:n,bearing:i,pitch:s})})}function cst(){var r,t=arguments.length;if(t===1)r=arguments[0];else{r=[];for(var e=0;e<t;e++)r.push(arguments[e])}var n=[];r.forEach(function(o,h){n[h]=a.bind(null,o,r.filter(function(f,m){return m!==h}))});function i(){r.forEach(function(o,h){o.on("move",n[h])})}function s(){r.forEach(function(o,h){o.off("move",n[h])})}function a(o,h){s(),lst(o,h),i()}return i(),function(){s(),n=[],r=[]}}var ust=cst;(function(r){var t=ust,e=zP.EventEmitter;function n(i,s,a,o){if(this.options=o||{},this._mapA=i,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new e,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof a=="string"&&document.body.querySelectorAll){var h=document.body.querySelectorAll(a)[0];if(!h)throw new Error("Cannot find element with specified container selector.");h.appendChild(this._controlContainer)}else if(a instanceof Element&&a.appendChild)a.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();var f=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(f),this._clearSync=t(i,s),this._onResize=(function(){this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),s.on("resize",this._onResize),this.options&&this.options.mousemove&&(i.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}n.prototype={_setPointerEvents:function(i){this._controlContainer.style.pointerEvents=i,this._swiper.style.pointerEvents=i},_onDown:function(i){i.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(i){i=Math.min(i,this._horizontal?this._bounds.height:this._bounds.width);var s=this._horizontal?"translate(0, "+i+"px)":"translate("+i+"px, 0)";this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;var a=this._horizontal?"rect(0, 999em, "+i+"px, 0)":"rect(0, "+i+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+i+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+i+"px)";this._mapA.getContainer().style.clip=a,this._mapB.getContainer().style.clip=o,this.currentPosition=i},_onMove:function(i){this.options&&this.options.mousemove&&this._setPointerEvents(i.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(i)):this._setPosition(this._getX(i))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(i){i=i.touches?i.touches[0]:i;var s=i.clientX-this._bounds.left;return s<0&&(s=0),s>this._bounds.width&&(s=this._bounds.width),s},_getY:function(i){i=i.touches?i.touches[0]:i;var s=i.clientY-this._bounds.top;return s<0&&(s=0),s>this._bounds.height&&(s=this._bounds.height),s},setSlider:function(i){this._setPosition(i)},on:function(i,s){return this._ev.on(i,s),this},fire:function(i,s){return this._ev.emit(i,s),this},off:function(i,s){return this._ev.removeListener(i,s),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var i=this._mapA.getContainer();i&&(i.style.clip=null,i.removeEventListener("mousemove",this._onMove));var s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=n:r.exports=n})(SM);var Ast=SM.exports;const hst=Dp(Ast);class dst{constructor(t,e,n,i){const s=this;setTimeout(function(){s.mapCompare=new hst(t.map,e.map,n,{})},1e3)}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var dx=function(r,t){return dx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},dx(r,t)};function dc(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");dx(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var fx=function(){return fx=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},fx.apply(this,arguments)};function ko(r,t,e,n){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(m){try{f(n.next(m))}catch(b){a(b)}}function h(m){try{f(n.throw(m))}catch(b){a(b)}}function f(m){m.done?s(m.value):i(m.value).then(o,h)}f((n=n.apply(r,[])).next())})}function vo(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(f){return function(m){return h([f,m])}}function h(f){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,i=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){e.label=f[1];break}if(f[0]===6&&e.label<s[1]){e.label=s[1],s=f;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(f);break}s[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(r,e)}catch(m){f=[6,m],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function Wy(r,t,e){if(arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return r.concat(s||t)}for(var $u=function(){function r(t,e,n,i){this.left=t,this.top=e,this.width=n,this.height=i}return r.prototype.add=function(t,e,n,i){return new r(this.left+t,this.top+e,this.width+n,this.height+i)},r.fromClientRect=function(t,e){return new r(e.left+t.windowBounds.left,e.top+t.windowBounds.top,e.width,e.height)},r.fromDOMRectList=function(t,e){var n=Array.from(e).find(function(i){return i.width!==0});return n?new r(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),$y=function(r,t){return $u.fromClientRect(r,t.getBoundingClientRect())},fst=function(r){var t=r.body,e=r.documentElement;if(!t||!e)throw new Error("Unable to get document size");var n=Math.max(Math.max(t.scrollWidth,e.scrollWidth),Math.max(t.offsetWidth,e.offsetWidth),Math.max(t.clientWidth,e.clientWidth)),i=Math.max(Math.max(t.scrollHeight,e.scrollHeight),Math.max(t.offsetHeight,e.offsetHeight),Math.max(t.clientHeight,e.clientHeight));return new $u(0,0,n,i)},Xy=function(r){for(var t=[],e=0,n=r.length;e<n;){var i=r.charCodeAt(e++);if(i>=55296&&i<=56319&&e<n){var s=r.charCodeAt(e++);(s&64512)===56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),e--)}else t.push(i)}return t},ts=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var e=r.length;if(!e)return"";for(var n=[],i=-1,s="";++i<e;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===e||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},TM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pst=typeof Uint8Array>"u"?[]:new Uint8Array(256),Jy=0;Jy<TM.length;Jy++)pst[TM.charCodeAt(Jy)]=Jy;for(var IM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$g=typeof Uint8Array>"u"?[]:new Uint8Array(256),Yy=0;Yy<IM.length;Yy++)$g[IM.charCodeAt(Yy)]=Yy;for(var gst=function(r){var t=r.length*.75,e=r.length,n,i=0,s,a,o,h;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),m=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<e;n+=4)s=$g[r.charCodeAt(n)],a=$g[r.charCodeAt(n+1)],o=$g[r.charCodeAt(n+2)],h=$g[r.charCodeAt(n+3)],m[i++]=s<<2|a>>4,m[i++]=(a&15)<<4|o>>2,m[i++]=(o&3)<<6|h&63;return f},mst=function(r){for(var t=r.length,e=[],n=0;n<t;n+=2)e.push(r[n+1]<<8|r[n]);return e},yst=function(r){for(var t=r.length,e=[],n=0;n<t;n+=4)e.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return e},id=5,px=11,gx=2,_st=px-id,FM=65536>>id,vst=1<<id,mx=vst-1,bst=1024>>id,wst=FM+bst,xst=wst,Bst=32,Cst=xst+Bst,Est=65536>>px,Sst=1<<_st,Tst=Sst-1,LM=function(r,t,e){return r.slice?r.slice(t,e):new Uint16Array(Array.prototype.slice.call(r,t,e))},Ist=function(r,t,e){return r.slice?r.slice(t,e):new Uint32Array(Array.prototype.slice.call(r,t,e))},Fst=function(r,t){var e=gst(r),n=Array.isArray(e)?yst(e):new Uint32Array(e),i=Array.isArray(e)?mst(e):new Uint16Array(e),s=24,a=LM(i,s/2,n[4]/2),o=n[5]===2?LM(i,(s+n[4])/2):Ist(n,Math.ceil((s+n[4])/4));return new Lst(n[0],n[1],n[2],n[3],a,o)},Lst=function(){function r(t,e,n,i,s,a){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>id],e=(e<<gx)+(t&mx),this.data[e];if(t<=65535)return e=this.index[FM+(t-55296>>id)],e=(e<<gx)+(t&mx),this.data[e];if(t<this.highStart)return e=Cst-Est+(t>>px),e=this.index[e],e+=t>>id&Tst,e=this.index[e],e=(e<<gx)+(t&mx),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),PM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pst=typeof Uint8Array>"u"?[]:new Uint8Array(256),Zy=0;Zy<PM.length;Zy++)Pst[PM.charCodeAt(Zy)]=Zy;var Mst="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",MM=50,Ust=1,UM=2,RM=3,Rst=4,Ost=5,OM=7,DM=8,NM=9,$A=10,yx=11,kM=12,_x=13,Dst=14,Xg=15,vx=16,t1=17,Jg=18,Nst=19,QM=20,bx=21,Yg=22,wx=23,zf=24,za=25,Zg=26,tm=27,Vf=28,kst=29,Gf=30,Qst=31,e1=32,r1=33,xx=34,Bx=35,Cx=36,em=37,Ex=38,n1=39,i1=40,Sx=41,HM=42,Hst=43,zst=[9001,65288],zM="!",Qo="",s1="",Tx=Fst(Mst),Xu=[Gf,Cx],Ix=[Ust,UM,RM,Ost],VM=[$A,DM],GM=[tm,Zg],Vst=Ix.concat(VM),jM=[Ex,n1,i1,xx,Bx],Gst=[Xg,_x],jst=function(r,t){t===void 0&&(t="strict");var e=[],n=[],i=[];return r.forEach(function(s,a){var o=Tx.get(s);if(o>MM?(i.push(!0),o-=MM):i.push(!1),["normal","auto","loose"].indexOf(t)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return n.push(a),e.push(vx);if(o===Rst||o===yx){if(a===0)return n.push(a),e.push(Gf);var h=e[a-1];return Vst.indexOf(h)===-1?(n.push(n[a-1]),e.push(h)):(n.push(a),e.push(Gf))}if(n.push(a),o===Qst)return e.push(t==="strict"?bx:em);if(o===HM||o===kst)return e.push(Gf);if(o===Hst)return s>=131072&&s<=196605||s>=196608&&s<=262141?e.push(em):e.push(Gf);e.push(o)}),[n,e,i]},Fx=function(r,t,e,n){var i=n[e];if(Array.isArray(r)?r.indexOf(i)!==-1:r===i)for(var s=e;s<=n.length;){s++;var a=n[s];if(a===t)return!0;if(a!==$A)break}if(i===$A)for(var s=e;s>0;){s--;var o=n[s];if(Array.isArray(r)?r.indexOf(o)!==-1:r===o)for(var h=e;h<=n.length;){h++;var a=n[h];if(a===t)return!0;if(a!==$A)break}if(o!==$A)break}return!1},qM=function(r,t){for(var e=r;e>=0;){var n=t[e];if(n===$A)e--;else return n}return 0},qst=function(r,t,e,n,i){if(e[n]===0)return Qo;var s=n-1;if(Array.isArray(i)&&i[s]===!0)return Qo;var a=s-1,o=s+1,h=t[s],f=a>=0?t[a]:0,m=t[o];if(h===UM&&m===RM)return Qo;if(Ix.indexOf(h)!==-1)return zM;if(Ix.indexOf(m)!==-1||VM.indexOf(m)!==-1)return Qo;if(qM(s,t)===DM)return s1;if(Tx.get(r[s])===yx||(h===e1||h===r1)&&Tx.get(r[o])===yx||h===OM||m===OM||h===NM||[$A,_x,Xg].indexOf(h)===-1&&m===NM||[t1,Jg,Nst,zf,Vf].indexOf(m)!==-1||qM(s,t)===Yg||Fx(wx,Yg,s,t)||Fx([t1,Jg],bx,s,t)||Fx(kM,kM,s,t))return Qo;if(h===$A)return s1;if(h===wx||m===wx)return Qo;if(m===vx||h===vx)return s1;if([_x,Xg,bx].indexOf(m)!==-1||h===Dst||f===Cx&&Gst.indexOf(h)!==-1||h===Vf&&m===Cx||m===QM||Xu.indexOf(m)!==-1&&h===za||Xu.indexOf(h)!==-1&&m===za||h===tm&&[em,e1,r1].indexOf(m)!==-1||[em,e1,r1].indexOf(h)!==-1&&m===Zg||Xu.indexOf(h)!==-1&&GM.indexOf(m)!==-1||GM.indexOf(h)!==-1&&Xu.indexOf(m)!==-1||[tm,Zg].indexOf(h)!==-1&&(m===za||[Yg,Xg].indexOf(m)!==-1&&t[o+1]===za)||[Yg,Xg].indexOf(h)!==-1&&m===za||h===za&&[za,Vf,zf].indexOf(m)!==-1)return Qo;if([za,Vf,zf,t1,Jg].indexOf(m)!==-1)for(var b=s;b>=0;){var x=t[b];if(x===za)return Qo;if([Vf,zf].indexOf(x)!==-1)b--;else break}if([tm,Zg].indexOf(m)!==-1)for(var b=[t1,Jg].indexOf(h)!==-1?a:s;b>=0;){var x=t[b];if(x===za)return Qo;if([Vf,zf].indexOf(x)!==-1)b--;else break}if(Ex===h&&[Ex,n1,xx,Bx].indexOf(m)!==-1||[n1,xx].indexOf(h)!==-1&&[n1,i1].indexOf(m)!==-1||[i1,Bx].indexOf(h)!==-1&&m===i1||jM.indexOf(h)!==-1&&[QM,Zg].indexOf(m)!==-1||jM.indexOf(m)!==-1&&h===tm||Xu.indexOf(h)!==-1&&Xu.indexOf(m)!==-1||h===zf&&Xu.indexOf(m)!==-1||Xu.concat(za).indexOf(h)!==-1&&m===Yg&&zst.indexOf(r[o])===-1||Xu.concat(za).indexOf(m)!==-1&&h===Jg)return Qo;if(h===Sx&&m===Sx){for(var B=e[s],P=1;B>0&&(B--,t[B]===Sx);)P++;if(P%2!==0)return Qo}return h===e1&&m===r1?Qo:s1},Kst=function(r,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var e=jst(r,t.lineBreak),n=e[0],i=e[1],s=e[2];(t.wordBreak==="break-all"||t.wordBreak==="break-word")&&(i=i.map(function(o){return[za,Gf,HM].indexOf(o)!==-1?em:o}));var a=t.wordBreak==="keep-all"?s.map(function(o,h){return o&&r[h]>=19968&&r[h]<=40959}):void 0;return[n,i,a]},Wst=function(){function r(t,e,n,i){this.codePoints=t,this.required=e===zM,this.start=n,this.end=i}return r.prototype.slice=function(){return ts.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),$st=function(r,t){var e=Xy(r),n=Kst(e,t),i=n[0],s=n[1],a=n[2],o=e.length,h=0,f=0;return{next:function(){if(f>=o)return{done:!0,value:null};for(var m=Qo;f<o&&(m=qst(e,s,i,++f,a))===Qo;);if(m!==Qo||f===o){var b=new Wst(e,m,h,f);return h=f,{value:b,done:!1}}return{done:!0,value:null}}}},Xst=1,Jst=2,rm=4,KM=8,o1=10,WM=47,nm=92,Yst=9,Zst=32,a1=34,im=61,tot=35,eot=36,rot=37,l1=39,c1=40,sm=41,not=95,fa=45,iot=33,sot=60,oot=62,aot=64,lot=91,cot=93,uot=61,Aot=123,u1=63,hot=125,$M=124,dot=126,fot=128,XM=65533,Lx=42,sd=43,pot=44,got=58,mot=59,om=46,yot=0,_ot=8,vot=11,bot=14,wot=31,xot=127,ru=-1,JM=48,YM=97,ZM=101,Bot=102,Cot=117,Eot=122,t4=65,e4=69,r4=70,Sot=85,Tot=90,Ho=function(r){return r>=JM&&r<=57},Iot=function(r){return r>=55296&&r<=57343},jf=function(r){return Ho(r)||r>=t4&&r<=r4||r>=YM&&r<=Bot},Fot=function(r){return r>=YM&&r<=Eot},Lot=function(r){return r>=t4&&r<=Tot},Pot=function(r){return Fot(r)||Lot(r)},Mot=function(r){return r>=fot},A1=function(r){return r===o1||r===Yst||r===Zst},h1=function(r){return Pot(r)||Mot(r)||r===not},n4=function(r){return h1(r)||Ho(r)||r===fa},Uot=function(r){return r>=yot&&r<=_ot||r===vot||r>=bot&&r<=wot||r===xot},XA=function(r,t){return r!==nm?!1:t!==o1},d1=function(r,t,e){return r===fa?h1(t)||XA(t,e):h1(r)?!0:!!(r===nm&&XA(r,t))},Px=function(r,t,e){return r===sd||r===fa?Ho(t)?!0:t===om&&Ho(e):Ho(r===om?t:r)},Rot=function(r){var t=0,e=1;(r[t]===sd||r[t]===fa)&&(r[t]===fa&&(e=-1),t++);for(var n=[];Ho(r[t]);)n.push(r[t++]);var i=n.length?parseInt(ts.apply(void 0,n),10):0;r[t]===om&&t++;for(var s=[];Ho(r[t]);)s.push(r[t++]);var a=s.length,o=a?parseInt(ts.apply(void 0,s),10):0;(r[t]===e4||r[t]===ZM)&&t++;var h=1;(r[t]===sd||r[t]===fa)&&(r[t]===fa&&(h=-1),t++);for(var f=[];Ho(r[t]);)f.push(r[t++]);var m=f.length?parseInt(ts.apply(void 0,f),10):0;return e*(i+o*Math.pow(10,-a))*Math.pow(10,h*m)},Oot={type:2},Dot={type:3},Not={type:4},kot={type:13},Qot={type:8},Hot={type:21},zot={type:9},Vot={type:10},Got={type:11},jot={type:12},qot={type:14},f1={type:23},Kot={type:1},Wot={type:25},$ot={type:24},Xot={type:26},Jot={type:27},Yot={type:28},Zot={type:29},tat={type:31},Mx={type:32},i4=function(){function r(){this._value=[]}return r.prototype.write=function(t){this._value=this._value.concat(Xy(t))},r.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==Mx;)t.push(e),e=this.consumeToken();return t},r.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case a1:return this.consumeStringToken(a1);case tot:var e=this.peekCodePoint(0),n=this.peekCodePoint(1),i=this.peekCodePoint(2);if(n4(e)||XA(n,i)){var s=d1(e,n,i)?Jst:Xst,a=this.consumeName();return{type:5,value:a,flags:s}}break;case eot:if(this.peekCodePoint(0)===im)return this.consumeCodePoint(),kot;break;case l1:return this.consumeStringToken(l1);case c1:return Oot;case sm:return Dot;case Lx:if(this.peekCodePoint(0)===im)return this.consumeCodePoint(),qot;break;case sd:if(Px(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case pot:return Not;case fa:var o=t,h=this.peekCodePoint(0),f=this.peekCodePoint(1);if(Px(o,h,f))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(d1(o,h,f))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(h===fa&&f===oot)return this.consumeCodePoint(),this.consumeCodePoint(),$ot;break;case om:if(Px(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case WM:if(this.peekCodePoint(0)===Lx)for(this.consumeCodePoint();;){var m=this.consumeCodePoint();if(m===Lx&&(m=this.consumeCodePoint(),m===WM))return this.consumeToken();if(m===ru)return this.consumeToken()}break;case got:return Xot;case mot:return Jot;case sot:if(this.peekCodePoint(0)===iot&&this.peekCodePoint(1)===fa&&this.peekCodePoint(2)===fa)return this.consumeCodePoint(),this.consumeCodePoint(),Wot;break;case aot:var b=this.peekCodePoint(0),x=this.peekCodePoint(1),B=this.peekCodePoint(2);if(d1(b,x,B)){var a=this.consumeName();return{type:7,value:a}}break;case lot:return Yot;case nm:if(XA(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case cot:return Zot;case uot:if(this.peekCodePoint(0)===im)return this.consumeCodePoint(),Qot;break;case Aot:return Got;case hot:return jot;case Cot:case Sot:var P=this.peekCodePoint(0),R=this.peekCodePoint(1);return P===sd&&(jf(R)||R===u1)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case $M:if(this.peekCodePoint(0)===im)return this.consumeCodePoint(),zot;if(this.peekCodePoint(0)===$M)return this.consumeCodePoint(),Hot;break;case dot:if(this.peekCodePoint(0)===im)return this.consumeCodePoint(),Vot;break;case ru:return Mx}return A1(t)?(this.consumeWhiteSpace(),tat):Ho(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):h1(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:ts(t)}},r.prototype.consumeCodePoint=function(){var t=this._value.shift();return typeof t>"u"?-1:t},r.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},r.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},r.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();jf(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var n=!1;e===u1&&t.length<6;)t.push(e),e=this.consumeCodePoint(),n=!0;if(n){var i=parseInt(ts.apply(void 0,t.map(function(h){return h===u1?JM:h})),16),s=parseInt(ts.apply(void 0,t.map(function(h){return h===u1?r4:h})),16);return{type:30,start:i,end:s}}var a=parseInt(ts.apply(void 0,t),16);if(this.peekCodePoint(0)===fa&&jf(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var o=[];jf(e)&&o.length<6;)o.push(e),e=this.consumeCodePoint();var s=parseInt(ts.apply(void 0,o),16);return{type:30,start:a,end:s}}else return{type:30,start:a,end:a}},r.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return t.toLowerCase()==="url"&&this.peekCodePoint(0)===c1?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===c1?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},r.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===ru)return{type:22,value:""};var e=this.peekCodePoint(0);if(e===l1||e===a1){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===ru||this.peekCodePoint(0)===sm)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),f1)}for(;;){var i=this.consumeCodePoint();if(i===ru||i===sm)return{type:22,value:ts.apply(void 0,t)};if(A1(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===ru||this.peekCodePoint(0)===sm?(this.consumeCodePoint(),{type:22,value:ts.apply(void 0,t)}):(this.consumeBadUrlRemnants(),f1);if(i===a1||i===l1||i===c1||Uot(i))return this.consumeBadUrlRemnants(),f1;if(i===nm)if(XA(i,this.peekCodePoint(0)))t.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),f1;else t.push(i)}},r.prototype.consumeWhiteSpace=function(){for(;A1(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===sm||t===ru)return;XA(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(t){for(var e=5e4,n="";t>0;){var i=Math.min(e,t);n+=ts.apply(void 0,this._value.splice(0,i)),t-=i}return this._value.shift(),n},r.prototype.consumeStringToken=function(t){var e="",n=0;do{var i=this._value[n];if(i===ru||i===void 0||i===t)return e+=this.consumeStringSlice(n),{type:0,value:e};if(i===o1)return this._value.splice(0,n),Kot;if(i===nm){var s=this._value[n+1];s!==ru&&s!==void 0&&(s===o1?(e+=this.consumeStringSlice(n),n=-1,this._value.shift()):XA(i,s)&&(e+=this.consumeStringSlice(n),e+=ts(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var t=[],e=rm,n=this.peekCodePoint(0);for((n===sd||n===fa)&&t.push(this.consumeCodePoint());Ho(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(n===om&&Ho(i))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=KM;Ho(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((n===e4||n===ZM)&&((i===sd||i===fa)&&Ho(s)||Ho(i)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=KM;Ho(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[Rot(t),e]},r.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],n=t[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),a=this.peekCodePoint(2);if(d1(i,s,a)){var o=this.consumeName();return{type:15,number:e,flags:n,unit:o}}return i===rot?(this.consumeCodePoint(),{type:16,number:e,flags:n}):{type:17,number:e,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(jf(t)){for(var e=ts(t);jf(this.peekCodePoint(0))&&e.length<6;)e+=ts(this.consumeCodePoint());A1(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(e,16);return n===0||Iot(n)||n>1114111?XM:n}return t===ru?XM:t},r.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(n4(e))t+=ts(e);else if(XA(e,this.peekCodePoint(0)))t+=ts(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(e),t}},r}(),s4=function(){function r(t){this._tokens=t}return r.create=function(t){var e=new i4;return e.write(t),new r(e.read())},r.parseValue=function(t){return r.create(t).parseComponentValue()},r.parseValues=function(t){return r.create(t).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===31;)t=this.consumeToken();if(t.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do t=this.consumeToken();while(t.type===31);if(t.type===32)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(e.type===32)return t;t.push(e),t.push()}},r.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},r.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},n=this.consumeToken();;){if(n.type===32||rat(n,t))return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var t=this._tokens.shift();return typeof t>"u"?Mx:t},r.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},r}(),am=function(r){return r.type===15},qf=function(r){return r.type===17},ai=function(r){return r.type===20},eat=function(r){return r.type===0},Ux=function(r,t){return ai(r)&&r.value===t},o4=function(r){return r.type!==31},Kf=function(r){return r.type!==31&&r.type!==4},nu=function(r){var t=[],e=[];return r.forEach(function(n){if(n.type===4){if(e.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(e),e=[];return}n.type!==31&&e.push(n)}),e.length&&t.push(e),t},rat=function(r,t){return t===11&&r.type===12||t===28&&r.type===29?!0:t===2&&r.type===3},JA=function(r){return r.type===17||r.type===15},ps=function(r){return r.type===16||JA(r)},a4=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},$s={type:17,number:0,flags:rm},Rx={type:16,number:50,flags:rm},YA={type:16,number:100,flags:rm},lm=function(r,t,e){var n=r[0],i=r[1];return[gi(n,t),gi(typeof i<"u"?i:n,e)]},gi=function(r,t){if(r.type===16)return r.number/100*t;if(am(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},l4="deg",c4="grad",u4="rad",A4="turn",p1={name:"angle",parse:function(r,t){if(t.type===15)switch(t.unit){case l4:return Math.PI*t.number/180;case c4:return Math.PI/200*t.number;case u4:return t.number;case A4:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},h4=function(r){return r.type===15&&(r.unit===l4||r.unit===c4||r.unit===u4||r.unit===A4)},d4=function(r){var t=r.filter(ai).map(function(e){return e.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[$s,$s];case"to top":case"bottom":return Bl(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[$s,YA];case"to right":case"left":return Bl(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[YA,YA];case"to bottom":case"top":return Bl(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[YA,$s];case"to left":case"right":return Bl(270)}return 0},Bl=function(r){return Math.PI*r/180},ZA={name:"color",parse:function(r,t){if(t.type===18){var e=nat[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return e(r,t.values)}if(t.type===5){if(t.value.length===3){var n=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3);return eh(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(t.value.length===4){var n=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3),a=t.value.substring(3,4);return eh(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(a+a,16)/255)}if(t.value.length===6){var n=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6);return eh(parseInt(n,16),parseInt(i,16),parseInt(s,16),1)}if(t.value.length===8){var n=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6),a=t.value.substring(6,8);return eh(parseInt(n,16),parseInt(i,16),parseInt(s,16),parseInt(a,16)/255)}}if(t.type===20){var o=Ju[t.value.toUpperCase()];if(typeof o<"u")return o}return Ju.TRANSPARENT}},th=function(r){return(255&r)===0},Us=function(r){var t=255&r,e=255&r>>8,n=255&r>>16,i=255&r>>24;return t<255?"rgba("+i+","+n+","+e+","+t/255+")":"rgb("+i+","+n+","+e+")"},eh=function(r,t,e,n){return(r<<24|t<<16|e<<8|Math.round(n*255)<<0)>>>0},f4=function(r,t){if(r.type===17)return r.number;if(r.type===16){var e=t===3?1:255;return t===3?r.number/100*e:Math.round(r.number/100*e)}return 0},p4=function(r,t){var e=t.filter(Kf);if(e.length===3){var n=e.map(f4),i=n[0],s=n[1],a=n[2];return eh(i,s,a,1)}if(e.length===4){var o=e.map(f4),i=o[0],s=o[1],a=o[2],h=o[3];return eh(i,s,a,h)}return 0};function Ox(r,t,e){return e<0&&(e+=1),e>=1&&(e-=1),e<1/6?(t-r)*e*6+r:e<1/2?t:e<2/3?(t-r)*6*(2/3-e)+r:r}var g4=function(r,t){var e=t.filter(Kf),n=e[0],i=e[1],s=e[2],a=e[3],o=(n.type===17?Bl(n.number):p1.parse(r,n))/(Math.PI*2),h=ps(i)?i.number/100:0,f=ps(s)?s.number/100:0,m=typeof a<"u"&&ps(a)?gi(a,1):1;if(h===0)return eh(f*255,f*255,f*255,1);var b=f<=.5?f*(h+1):f+h-f*h,x=f*2-b,B=Ox(x,b,o+1/3),P=Ox(x,b,o),R=Ox(x,b,o-1/3);return eh(B*255,P*255,R*255,m)},nat={hsl:g4,hsla:g4,rgb:p4,rgba:p4},cm=function(r,t){return ZA.parse(r,s4.create(t).parseComponentValue())},Ju={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},iat={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,t){return t.map(function(e){if(ai(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},sat={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},g1=function(r,t){var e=ZA.parse(r,t[0]),n=t[1];return n&&ps(n)?{color:e,stop:n}:{color:e,stop:null}},m4=function(r,t){var e=r[0],n=r[r.length-1];e.stop===null&&(e.stop=$s),n.stop===null&&(n.stop=YA);for(var i=[],s=0,a=0;a<r.length;a++){var o=r[a].stop;if(o!==null){var h=gi(o,t);h>s?i.push(h):i.push(s),s=h}else i.push(null)}for(var f=null,a=0;a<i.length;a++){var m=i[a];if(m===null)f===null&&(f=a);else if(f!==null){for(var b=a-f,x=i[f-1],B=(m-x)/(b+1),P=1;P<=b;P++)i[f+P-1]=B*P;f=null}}return r.map(function(R,Q){var z=R.color;return{color:z,stop:Math.max(Math.min(1,i[Q]/t),0)}})},oat=function(r,t,e){var n=t/2,i=e/2,s=gi(r[0],t)-n,a=i-gi(r[1],e);return(Math.atan2(a,s)+Math.PI*2)%(Math.PI*2)},aat=function(r,t,e){var n=typeof r=="number"?r:oat(r,t,e),i=Math.abs(t*Math.sin(n))+Math.abs(e*Math.cos(n)),s=t/2,a=e/2,o=i/2,h=Math.sin(n-Math.PI/2)*o,f=Math.cos(n-Math.PI/2)*o;return[i,s-f,s+f,a-h,a+h]},fc=function(r,t){return Math.sqrt(r*r+t*t)},y4=function(r,t,e,n,i){var s=[[0,0],[0,t],[r,0],[r,t]];return s.reduce(function(a,o){var h=o[0],f=o[1],m=fc(e-h,n-f);return(i?m<a.optimumDistance:m>a.optimumDistance)?{optimumCorner:o,optimumDistance:m}:a},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},lat=function(r,t,e,n,i){var s=0,a=0;switch(r.size){case 0:r.shape===0?s=a=Math.min(Math.abs(t),Math.abs(t-n),Math.abs(e),Math.abs(e-i)):r.shape===1&&(s=Math.min(Math.abs(t),Math.abs(t-n)),a=Math.min(Math.abs(e),Math.abs(e-i)));break;case 2:if(r.shape===0)s=a=Math.min(fc(t,e),fc(t,e-i),fc(t-n,e),fc(t-n,e-i));else if(r.shape===1){var o=Math.min(Math.abs(e),Math.abs(e-i))/Math.min(Math.abs(t),Math.abs(t-n)),h=y4(n,i,t,e,!0),f=h[0],m=h[1];s=fc(f-t,(m-e)/o),a=o*s}break;case 1:r.shape===0?s=a=Math.max(Math.abs(t),Math.abs(t-n),Math.abs(e),Math.abs(e-i)):r.shape===1&&(s=Math.max(Math.abs(t),Math.abs(t-n)),a=Math.max(Math.abs(e),Math.abs(e-i)));break;case 3:if(r.shape===0)s=a=Math.max(fc(t,e),fc(t,e-i),fc(t-n,e),fc(t-n,e-i));else if(r.shape===1){var o=Math.max(Math.abs(e),Math.abs(e-i))/Math.max(Math.abs(t),Math.abs(t-n)),b=y4(n,i,t,e,!1),f=b[0],m=b[1];s=fc(f-t,(m-e)/o),a=o*s}break}return Array.isArray(r.size)&&(s=gi(r.size[0],n),a=r.size.length===2?gi(r.size[1],i):s),[s,a]},cat=function(r,t){var e=Bl(180),n=[];return nu(t).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&a.value==="to"){e=d4(i);return}else if(h4(a)){e=p1.parse(r,a);return}}var o=g1(r,i);n.push(o)}),{angle:e,stops:n,type:1}},m1=function(r,t){var e=Bl(180),n=[];return nu(t).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){e=d4(i);return}else if(h4(a)){e=(p1.parse(r,a)+Bl(270))%Bl(360);return}}var o=g1(r,i);n.push(o)}),{angle:e,stops:n,type:1}},uat=function(r,t){var e=Bl(180),n=[],i=1,s=0,a=3,o=[];return nu(t).forEach(function(h,f){var m=h[0];if(f===0){if(ai(m)&&m.value==="linear"){i=1;return}else if(ai(m)&&m.value==="radial"){i=2;return}}if(m.type===18){if(m.name==="from"){var b=ZA.parse(r,m.values[0]);n.push({stop:$s,color:b})}else if(m.name==="to"){var b=ZA.parse(r,m.values[0]);n.push({stop:YA,color:b})}else if(m.name==="color-stop"){var x=m.values.filter(Kf);if(x.length===2){var b=ZA.parse(r,x[1]),B=x[0];qf(B)&&n.push({stop:{type:16,number:B.number*100,flags:B.flags},color:b})}}}}),i===1?{angle:(e+Bl(180))%Bl(360),stops:n,type:i}:{size:a,shape:s,stops:n,position:o,type:i}},_4="closest-side",v4="farthest-side",b4="closest-corner",w4="farthest-corner",x4="circle",B4="ellipse",C4="cover",E4="contain",Aat=function(r,t){var e=0,n=3,i=[],s=[];return nu(t).forEach(function(a,o){var h=!0;if(o===0){var f=!1;h=a.reduce(function(b,x){if(f)if(ai(x))switch(x.value){case"center":return s.push(Rx),b;case"top":case"left":return s.push($s),b;case"right":case"bottom":return s.push(YA),b}else(ps(x)||JA(x))&&s.push(x);else if(ai(x))switch(x.value){case x4:return e=0,!1;case B4:return e=1,!1;case"at":return f=!0,!1;case _4:return n=0,!1;case C4:case v4:return n=1,!1;case E4:case b4:return n=2,!1;case w4:return n=3,!1}else if(JA(x)||ps(x))return Array.isArray(n)||(n=[]),n.push(x),!1;return b},h)}if(h){var m=g1(r,a);i.push(m)}}),{size:n,shape:e,stops:i,position:s,type:2}},y1=function(r,t){var e=0,n=3,i=[],s=[];return nu(t).forEach(function(a,o){var h=!0;if(o===0?h=a.reduce(function(m,b){if(ai(b))switch(b.value){case"center":return s.push(Rx),!1;case"top":case"left":return s.push($s),!1;case"right":case"bottom":return s.push(YA),!1}else if(ps(b)||JA(b))return s.push(b),!1;return m},h):o===1&&(h=a.reduce(function(m,b){if(ai(b))switch(b.value){case x4:return e=0,!1;case B4:return e=1,!1;case E4:case _4:return n=0,!1;case v4:return n=1,!1;case b4:return n=2,!1;case C4:case w4:return n=3,!1}else if(JA(b)||ps(b))return Array.isArray(n)||(n=[]),n.push(b),!1;return m},h)),h){var f=g1(r,a);i.push(f)}}),{size:n,shape:e,stops:i,position:s,type:2}},hat=function(r){return r.type===1},dat=function(r){return r.type===2},Dx={name:"image",parse:function(r,t){if(t.type===22){var e={url:t.value,type:0};return r.cache.addImage(t.value),e}if(t.type===18){var n=S4[t.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return n(r,t.values)}throw new Error("Unsupported image type "+t.type)}};function fat(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!S4[r.name])}var S4={"linear-gradient":cat,"-moz-linear-gradient":m1,"-ms-linear-gradient":m1,"-o-linear-gradient":m1,"-webkit-linear-gradient":m1,"radial-gradient":Aat,"-moz-radial-gradient":y1,"-ms-radial-gradient":y1,"-o-radial-gradient":y1,"-webkit-radial-gradient":y1,"-webkit-gradient":uat},pat={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t.filter(function(n){return Kf(n)&&fat(n)}).map(function(n){return Dx.parse(r,n)})}},gat={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,t){return t.map(function(e){if(ai(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},mat={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,t){return nu(t).map(function(e){return e.filter(ps)}).map(a4)}},yat={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,t){return nu(t).map(function(e){return e.filter(ai).map(function(n){return n.value}).join(" ")}).map(_at)}},_at=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Wf;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(Wf||(Wf={}));var vat={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,t){return nu(t).map(function(e){return e.filter(bat)})}},bat=function(r){return ai(r)||ps(r)},_1=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},wat=_1("top"),xat=_1("right"),Bat=_1("bottom"),Cat=_1("left"),v1=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return a4(e.filter(ps))}}},Eat=v1("top-left"),Sat=v1("top-right"),Tat=v1("bottom-right"),Iat=v1("bottom-left"),b1=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Fat=b1("top"),Lat=b1("right"),Pat=b1("bottom"),Mat=b1("left"),w1=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return am(e)?e.number:0}}},Uat=w1("top"),Rat=w1("right"),Oat=w1("bottom"),Dat=w1("left"),Nat={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},kat={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},Qat={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,t){return t.filter(ai).reduce(function(e,n){return e|Hat(n.value)},0)}},Hat=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},zat={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Vat={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,t){return t.type===20&&t.value==="normal"?0:t.type===17||t.type===15?t.number:0}},x1;(function(r){r.NORMAL="normal",r.STRICT="strict"})(x1||(x1={}));var Gat={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"strict":return x1.STRICT;case"normal":default:return x1.NORMAL}}},jat={name:"line-height",initialValue:"normal",prefix:!1,type:4},T4=function(r,t){return ai(r)&&r.value==="normal"?1.2*t:r.type===17?t*r.number:ps(r)?gi(r,t):t},qat={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,t){return t.type===20&&t.value==="none"?null:Dx.parse(r,t)}},Kat={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},Nx={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},B1=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},Wat=B1("top"),$at=B1("right"),Xat=B1("bottom"),Jat=B1("left"),Yat={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,t){return t.filter(ai).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Zat={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},C1=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},tlt=C1("top"),elt=C1("right"),rlt=C1("bottom"),nlt=C1("left"),ilt={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},slt={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},olt={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.length===1&&Ux(t[0],"none")?[]:nu(t).map(function(e){for(var n={color:Ju.TRANSPARENT,offsetX:$s,offsetY:$s,blur:$s},i=0,s=0;s<e.length;s++){var a=e[s];JA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:n.blur=a,i++):n.color=ZA.parse(r,a)}return n})}},alt={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},llt={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var e=Alt[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return e(t.values)}return null}},clt=function(r){var t=r.filter(function(e){return e.type===17}).map(function(e){return e.number});return t.length===6?t:null},ult=function(r){var t=r.filter(function(h){return h.type===17}).map(function(h){return h.number}),e=t[0],n=t[1];t[2],t[3];var i=t[4],s=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var a=t[12],o=t[13];return t[14],t[15],t.length===16?[e,n,i,s,a,o]:null},Alt={matrix:clt,matrix3d:ult},I4={type:16,number:50,flags:rm},hlt=[I4,I4],dlt={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,t){var e=t.filter(ps);return e.length!==2?hlt:[e[0],e[1]]}},flt={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},um;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(um||(um={}));for(var plt={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"break-all":return um.BREAK_ALL;case"keep-all":return um.KEEP_ALL;case"normal":default:return um.NORMAL}}},glt={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,t){if(t.type===20)return{auto:!0,order:0};if(qf(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},F4={name:"time",parse:function(r,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},mlt={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,t){return qf(t)?t.number:1}},ylt={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},_lt={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,t){return t.filter(ai).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return e!==0})}},vlt={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,t){var e=[],n=[];return t.forEach(function(i){switch(i.type){case 20:case 0:e.push(i.value);break;case 17:e.push(i.number.toString());break;case 4:n.push(e.join(" ")),e.length=0;break}}),e.length&&n.push(e.join(" ")),n.map(function(i){return i.indexOf(" ")===-1?i:"'"+i+"'"})}},blt={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},wlt={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,t){if(qf(t))return t.number;if(ai(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},xlt={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.filter(ai).map(function(e){return e.value})}},Blt={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Bs=function(r,t){return(r&t)!==0},Clt={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t}},Elt={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;for(var n=[],i=t.filter(o4),s=0;s<i.length;s++){var a=i[s],o=i[s+1];if(a.type===20){var h=o&&qf(o)?o.number:1;n.push({counter:a.value,increment:h})}}return n}},Slt={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return[];for(var e=[],n=t.filter(o4),i=0;i<n.length;i++){var s=n[i],a=n[i+1];if(ai(s)&&s.value!=="none"){var o=a&&qf(a)?a.number:0;e.push({counter:s.value,reset:o})}}return e}},Tlt={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,t){return t.filter(am).map(function(e){return F4.parse(r,e)})}},Ilt={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;var n=[],i=t.filter(eat);if(i.length%2!==0)return null;for(var s=0;s<i.length;s+=2){var a=i[s].value,o=i[s+1].value;n.push({open:a,close:o})}return n}},L4=function(r,t,e){if(!r)return"";var n=r[Math.min(t,r.length-1)];return n?e?n.open:n.close:""},Flt={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.length===1&&Ux(t[0],"none")?[]:nu(t).map(function(e){for(var n={color:255,offsetX:$s,offsetY:$s,blur:$s,spread:$s,inset:!1},i=0,s=0;s<e.length;s++){var a=e[s];Ux(a,"inset")?n.inset=!0:JA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:i===2?n.blur=a:n.spread=a,i++):n.color=ZA.parse(r,a)}return n})}},Llt={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,t){var e=[0,1,2],n=[];return t.filter(ai).forEach(function(i){switch(i.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),e.forEach(function(i){n.indexOf(i)===-1&&n.push(i)}),n}},Plt={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Mlt={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,t){return am(t)?t.number:0}},Ult=function(){function r(t,e){var n,i;this.animationDuration=fr(t,Tlt,e.animationDuration),this.backgroundClip=fr(t,iat,e.backgroundClip),this.backgroundColor=fr(t,sat,e.backgroundColor),this.backgroundImage=fr(t,pat,e.backgroundImage),this.backgroundOrigin=fr(t,gat,e.backgroundOrigin),this.backgroundPosition=fr(t,mat,e.backgroundPosition),this.backgroundRepeat=fr(t,yat,e.backgroundRepeat),this.backgroundSize=fr(t,vat,e.backgroundSize),this.borderTopColor=fr(t,wat,e.borderTopColor),this.borderRightColor=fr(t,xat,e.borderRightColor),this.borderBottomColor=fr(t,Bat,e.borderBottomColor),this.borderLeftColor=fr(t,Cat,e.borderLeftColor),this.borderTopLeftRadius=fr(t,Eat,e.borderTopLeftRadius),this.borderTopRightRadius=fr(t,Sat,e.borderTopRightRadius),this.borderBottomRightRadius=fr(t,Tat,e.borderBottomRightRadius),this.borderBottomLeftRadius=fr(t,Iat,e.borderBottomLeftRadius),this.borderTopStyle=fr(t,Fat,e.borderTopStyle),this.borderRightStyle=fr(t,Lat,e.borderRightStyle),this.borderBottomStyle=fr(t,Pat,e.borderBottomStyle),this.borderLeftStyle=fr(t,Mat,e.borderLeftStyle),this.borderTopWidth=fr(t,Uat,e.borderTopWidth),this.borderRightWidth=fr(t,Rat,e.borderRightWidth),this.borderBottomWidth=fr(t,Oat,e.borderBottomWidth),this.borderLeftWidth=fr(t,Dat,e.borderLeftWidth),this.boxShadow=fr(t,Flt,e.boxShadow),this.color=fr(t,Nat,e.color),this.direction=fr(t,kat,e.direction),this.display=fr(t,Qat,e.display),this.float=fr(t,zat,e.cssFloat),this.fontFamily=fr(t,vlt,e.fontFamily),this.fontSize=fr(t,blt,e.fontSize),this.fontStyle=fr(t,Blt,e.fontStyle),this.fontVariant=fr(t,xlt,e.fontVariant),this.fontWeight=fr(t,wlt,e.fontWeight),this.letterSpacing=fr(t,Vat,e.letterSpacing),this.lineBreak=fr(t,Gat,e.lineBreak),this.lineHeight=fr(t,jat,e.lineHeight),this.listStyleImage=fr(t,qat,e.listStyleImage),this.listStylePosition=fr(t,Kat,e.listStylePosition),this.listStyleType=fr(t,Nx,e.listStyleType),this.marginTop=fr(t,Wat,e.marginTop),this.marginRight=fr(t,$at,e.marginRight),this.marginBottom=fr(t,Xat,e.marginBottom),this.marginLeft=fr(t,Jat,e.marginLeft),this.opacity=fr(t,mlt,e.opacity);var s=fr(t,Yat,e.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=fr(t,Zat,e.overflowWrap),this.paddingTop=fr(t,tlt,e.paddingTop),this.paddingRight=fr(t,elt,e.paddingRight),this.paddingBottom=fr(t,rlt,e.paddingBottom),this.paddingLeft=fr(t,nlt,e.paddingLeft),this.paintOrder=fr(t,Llt,e.paintOrder),this.position=fr(t,slt,e.position),this.textAlign=fr(t,ilt,e.textAlign),this.textDecorationColor=fr(t,ylt,(n=e.textDecorationColor)!==null&&n!==void 0?n:e.color),this.textDecorationLine=fr(t,_lt,(i=e.textDecorationLine)!==null&&i!==void 0?i:e.textDecoration),this.textShadow=fr(t,olt,e.textShadow),this.textTransform=fr(t,alt,e.textTransform),this.transform=fr(t,llt,e.transform),this.transformOrigin=fr(t,dlt,e.transformOrigin),this.visibility=fr(t,flt,e.visibility),this.webkitTextStrokeColor=fr(t,Plt,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=fr(t,Mlt,e.webkitTextStrokeWidth),this.wordBreak=fr(t,plt,e.wordBreak),this.zIndex=fr(t,glt,e.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return th(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return Bs(this.display,4)||Bs(this.display,33554432)||Bs(this.display,268435456)||Bs(this.display,536870912)||Bs(this.display,67108864)||Bs(this.display,134217728)},r}(),Rlt=function(){function r(t,e){this.content=fr(t,Clt,e.content),this.quotes=fr(t,Ilt,e.quotes)}return r}(),P4=function(){function r(t,e){this.counterIncrement=fr(t,Elt,e.counterIncrement),this.counterReset=fr(t,Slt,e.counterReset)}return r}(),fr=function(r,t,e){var n=new i4,i=e!==null&&typeof e<"u"?e.toString():t.initialValue;n.write(i);var s=new s4(n.read());switch(t.type){case 2:var a=s.parseComponentValue();return t.parse(r,ai(a)?a.value:t.initialValue);case 0:return t.parse(r,s.parseComponentValue());case 1:return t.parse(r,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(t.format){case"angle":return p1.parse(r,s.parseComponentValue());case"color":return ZA.parse(r,s.parseComponentValue());case"image":return Dx.parse(r,s.parseComponentValue());case"length":var o=s.parseComponentValue();return JA(o)?o:$s;case"length-percentage":var h=s.parseComponentValue();return ps(h)?h:$s;case"time":return F4.parse(r,s.parseComponentValue())}break}},Olt="data-html2canvas-debug",Dlt=function(r){var t=r.getAttribute(Olt);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},kx=function(r,t){var e=Dlt(r);return e===1||t===e},iu=function(){function r(t,e){if(this.context=t,this.textNodes=[],this.elements=[],this.flags=0,kx(e,3))debugger;this.styles=new Ult(t,window.getComputedStyle(e,null)),Yx(e)&&(this.styles.animationDuration.some(function(n){return n>0})&&(e.style.animationDuration="0s"),this.styles.transform!==null&&(e.style.transform="none")),this.bounds=$y(this.context,e),kx(e,4)&&(this.flags|=16)}return r}(),Nlt="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",M4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Am=typeof Uint8Array>"u"?[]:new Uint8Array(256),E1=0;E1<M4.length;E1++)Am[M4.charCodeAt(E1)]=E1;for(var klt=function(r){var t=r.length*.75,e=r.length,n,i=0,s,a,o,h;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),m=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<e;n+=4)s=Am[r.charCodeAt(n)],a=Am[r.charCodeAt(n+1)],o=Am[r.charCodeAt(n+2)],h=Am[r.charCodeAt(n+3)],m[i++]=s<<2|a>>4,m[i++]=(a&15)<<4|o>>2,m[i++]=(o&3)<<6|h&63;return f},Qlt=function(r){for(var t=r.length,e=[],n=0;n<t;n+=2)e.push(r[n+1]<<8|r[n]);return e},Hlt=function(r){for(var t=r.length,e=[],n=0;n<t;n+=4)e.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return e},od=5,Qx=11,Hx=2,zlt=Qx-od,U4=65536>>od,Vlt=1<<od,zx=Vlt-1,Glt=1024>>od,jlt=U4+Glt,qlt=jlt,Klt=32,Wlt=qlt+Klt,$lt=65536>>Qx,Xlt=1<<zlt,Jlt=Xlt-1,R4=function(r,t,e){return r.slice?r.slice(t,e):new Uint16Array(Array.prototype.slice.call(r,t,e))},Ylt=function(r,t,e){return r.slice?r.slice(t,e):new Uint32Array(Array.prototype.slice.call(r,t,e))},Zlt=function(r,t){var e=klt(r),n=Array.isArray(e)?Hlt(e):new Uint32Array(e),i=Array.isArray(e)?Qlt(e):new Uint16Array(e),s=24,a=R4(i,s/2,n[4]/2),o=n[5]===2?R4(i,(s+n[4])/2):Ylt(n,Math.ceil((s+n[4])/4));return new tct(n[0],n[1],n[2],n[3],a,o)},tct=function(){function r(t,e,n,i,s,a){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>od],e=(e<<Hx)+(t&zx),this.data[e];if(t<=65535)return e=this.index[U4+(t-55296>>od)],e=(e<<Hx)+(t&zx),this.data[e];if(t<this.highStart)return e=Wlt-$lt+(t>>Qx),e=this.index[e],e+=t>>od&Jlt,e=this.index[e],e=(e<<Hx)+(t&zx),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),O4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ect=typeof Uint8Array>"u"?[]:new Uint8Array(256),S1=0;S1<O4.length;S1++)ect[O4.charCodeAt(S1)]=S1;var rct=1,Vx=2,Gx=3,D4=4,N4=5,nct=7,k4=8,jx=9,qx=10,Q4=11,H4=12,z4=13,V4=14,Kx=15,ict=function(r){for(var t=[],e=0,n=r.length;e<n;){var i=r.charCodeAt(e++);if(i>=55296&&i<=56319&&e<n){var s=r.charCodeAt(e++);(s&64512)===56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),e--)}else t.push(i)}return t},sct=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var e=r.length;if(!e)return"";for(var n=[],i=-1,s="";++i<e;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===e||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},oct=Zlt(Nlt),ad="",G4="",act=function(r){return oct.get(r)},lct=function(r,t,e){var n=e-2,i=t[n],s=t[e-1],a=t[e];if(s===Vx&&a===Gx)return ad;if(s===Vx||s===Gx||s===D4||a===Vx||a===Gx||a===D4)return G4;if(s===k4&&[k4,jx,Q4,H4].indexOf(a)!==-1||(s===Q4||s===jx)&&(a===jx||a===qx)||(s===H4||s===qx)&&a===qx||a===z4||a===N4||a===nct||s===rct)return ad;if(s===z4&&a===V4){for(;i===N4;)i=t[--n];if(i===V4)return ad}if(s===Kx&&a===Kx){for(var o=0;i===Kx;)o++,i=t[--n];if(o%2===0)return ad}return G4},cct=function(r){var t=ict(r),e=t.length,n=0,i=0,s=t.map(act);return{next:function(){if(n>=e)return{done:!0,value:null};for(var a=ad;n<e&&(a=lct(t,s,++n))===ad;);if(a!==ad||n===e){var o=sct.apply(null,t.slice(i,n));return i=n,{value:o,done:!1}}return{done:!0,value:null}}}},uct=function(r){for(var t=cct(r),e=[],n;!(n=t.next()).done;)n.value&&e.push(n.value.slice());return e},Act=function(r){var t=123;if(r.createRange){var e=r.createRange();if(e.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=t+"px",n.style.display="block",r.body.appendChild(n),e.selectNode(n);var i=e.getBoundingClientRect(),s=Math.round(i.height);if(r.body.removeChild(n),s===t)return!0}}return!1},hct=function(r){var t=r.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",r.body.appendChild(t);var e=r.createRange();t.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=t.firstChild,i=Xy(n.data).map(function(h){return ts(h)}),s=0,a={},o=i.every(function(h,f){e.setStart(n,s),e.setEnd(n,s+h.length);var m=e.getBoundingClientRect();s+=h.length;var b=m.x>a.x||m.y>a.y;return a=m,f===0?!0:b});return r.body.removeChild(t),o},dct=function(){return typeof new Image().crossOrigin<"u"},fct=function(){return typeof new XMLHttpRequest().responseType=="string"},pct=function(r){var t=new Image,e=r.createElement("canvas"),n=e.getContext("2d");if(!n)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(t,0,0),e.toDataURL()}catch{return!1}return!0},j4=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},gct=function(r){var t=r.createElement("canvas"),e=100;t.width=e,t.height=e;var n=t.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,e,e);var i=new Image,s=t.toDataURL();i.src=s;var a=Wx(e,e,0,0,i);return n.fillStyle="red",n.fillRect(0,0,e,e),q4(a).then(function(o){n.drawImage(o,0,0);var h=n.getImageData(0,0,e,e).data;n.fillStyle="red",n.fillRect(0,0,e,e);var f=r.createElement("div");return f.style.backgroundImage="url("+s+")",f.style.height=e+"px",j4(h)?q4(Wx(e,e,0,0,f)):Promise.reject(!1)}).then(function(o){return n.drawImage(o,0,0),j4(n.getImageData(0,0,e,e).data)}).catch(function(){return!1})},Wx=function(r,t,e,n,i){var s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),o=document.createElementNS(s,"foreignObject");return a.setAttributeNS(null,"width",r.toString()),a.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",e.toString()),o.setAttributeNS(null,"y",n.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(o),o.appendChild(i),a},q4=function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){return t(n)},n.onerror=e,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Xs={get SUPPORT_RANGE_BOUNDS(){var r=Act(document);return Object.defineProperty(Xs,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=Xs.SUPPORT_RANGE_BOUNDS&&hct(document);return Object.defineProperty(Xs,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=pct(document);return Object.defineProperty(Xs,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?gct(document):Promise.resolve(!1);return Object.defineProperty(Xs,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=dct();return Object.defineProperty(Xs,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=fct();return Object.defineProperty(Xs,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Xs,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Xs,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},hm=function(){function r(t,e){this.text=t,this.bounds=e}return r}(),mct=function(r,t,e,n){var i=vct(t,e),s=[],a=0;return i.forEach(function(o){if(e.textDecorationLine.length||o.trim().length>0)if(Xs.SUPPORT_RANGE_BOUNDS){var h=K4(n,a,o.length).getClientRects();if(h.length>1){var f=$x(o),m=0;f.forEach(function(x){s.push(new hm(x,$u.fromDOMRectList(r,K4(n,m+a,x.length).getClientRects()))),m+=x.length})}else s.push(new hm(o,$u.fromDOMRectList(r,h)))}else{var b=n.splitText(o.length);s.push(new hm(o,yct(r,n))),n=b}else Xs.SUPPORT_RANGE_BOUNDS||(n=n.splitText(o.length));a+=o.length}),s},yct=function(r,t){var e=t.ownerDocument;if(e){var n=e.createElement("html2canvaswrapper");n.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(n,t);var s=$y(r,n);return n.firstChild&&i.replaceChild(n.firstChild,n),s}}return $u.EMPTY},K4=function(r,t,e){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var i=n.createRange();return i.setStart(r,t),i.setEnd(r,t+e),i},$x=function(r){if(Xs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(r)).map(function(e){return e.segment})}return uct(r)},_ct=function(r,t){if(Xs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(e.segment(r)).map(function(n){return n.segment})}return wct(r,t)},vct=function(r,t){return t.letterSpacing!==0?$x(r):_ct(r,t)},bct=[32,160,4961,65792,65793,4153,4241],wct=function(r,t){for(var e=$st(r,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak}),n=[],i,s=function(){if(i.value){var a=i.value.slice(),o=Xy(a),h="";o.forEach(function(f){bct.indexOf(f)===-1?h+=ts(f):(h.length&&n.push(h),n.push(ts(f)),h="")}),h.length&&n.push(h)}};!(i=e.next()).done;)s();return n},xct=function(){function r(t,e,n){this.text=Bct(e.data,n.textTransform),this.textBounds=mct(t,this.text,n,e)}return r}(),Bct=function(r,t){switch(t){case 1:return r.toLowerCase();case 3:return r.replace(Cct,Ect);case 2:return r.toUpperCase();default:return r}},Cct=/(^|\s|:|-|\(|\))([a-z])/g,Ect=function(r,t,e){return r.length>0?t+e.toUpperCase():r},W4=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.src=n.currentSrc||n.src,i.intrinsicWidth=n.naturalWidth,i.intrinsicHeight=n.naturalHeight,i.context.cache.addImage(i.src),i}return t}(iu),$4=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.canvas=n,i.intrinsicWidth=n.width,i.intrinsicHeight=n.height,i}return t}(iu),X4=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this,s=new XMLSerializer,a=$y(e,n);return n.setAttribute("width",a.width+"px"),n.setAttribute("height",a.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(n)),i.intrinsicWidth=n.width.baseVal.value,i.intrinsicHeight=n.height.baseVal.value,i.context.cache.addImage(i.svg),i}return t}(iu),J4=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.value=n.value,i}return t}(iu),Xx=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.start=n.start,i.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,i}return t}(iu),Sct=[{type:15,flags:0,unit:"px",number:3}],Tct=[{type:16,flags:0,number:50}],Ict=function(r){return r.width>r.height?new $u(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new $u(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},Fct=function(r){var t=r.type===Lct?new Array(r.value.length+1).join(""):r.value;return t.length===0?r.placeholder||"":t},T1="checkbox",I1="radio",Lct="password",Y4=707406591,Jx=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this;switch(i.type=n.type.toLowerCase(),i.checked=n.checked,i.value=Fct(n),(i.type===T1||i.type===I1)&&(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=Ict(i.bounds)),i.type){case T1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=Sct;break;case I1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=Tct;break}return i}return t}(iu),Z4=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this,s=n.options[n.selectedIndex||0];return i.value=s&&s.text||"",i}return t}(iu),tU=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.value=n.value,i}return t}(iu),eU=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this;i.src=n.src,i.width=parseInt(n.width,10)||0,i.height=parseInt(n.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){i.tree=nU(e,n.contentWindow.document.documentElement);var s=n.contentWindow.document.documentElement?cm(e,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):Ju.TRANSPARENT,a=n.contentWindow.document.body?cm(e,getComputedStyle(n.contentWindow.document.body).backgroundColor):Ju.TRANSPARENT;i.backgroundColor=th(s)?th(a)?i.styles.backgroundColor:a:s}}catch{}return i}return t}(iu),Pct=["OL","UL","MENU"],F1=function(r,t,e,n){for(var i=t.firstChild,s=void 0;i;i=s)if(s=i.nextSibling,iU(i)&&i.data.trim().length>0)e.textNodes.push(new xct(r,i,e.styles));else if($f(i))if(uU(i)&&i.assignedNodes)i.assignedNodes().forEach(function(o){return F1(r,o,e,n)});else{var a=rU(r,i);a.styles.isVisible()&&(Mct(i,a,n)?a.flags|=4:Uct(a.styles)&&(a.flags|=2),Pct.indexOf(i.tagName)!==-1&&(a.flags|=8),e.elements.push(a),i.slot,i.shadowRoot?F1(r,i.shadowRoot,a,n):!P1(i)&&!sU(i)&&!M1(i)&&F1(r,i,a,n))}},rU=function(r,t){return tB(t)?new W4(r,t):oU(t)?new $4(r,t):sU(t)?new X4(r,t):Rct(t)?new J4(r,t):Oct(t)?new Xx(r,t):Dct(t)?new Jx(r,t):M1(t)?new Z4(r,t):P1(t)?new tU(r,t):lU(t)?new eU(r,t):new iu(r,t)},nU=function(r,t){var e=rU(r,t);return e.flags|=4,F1(r,t,e,e),e},Mct=function(r,t,e){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||Zx(r)&&e.styles.isTransparent()},Uct=function(r){return r.isPositioned()||r.isFloating()},iU=function(r){return r.nodeType===Node.TEXT_NODE},$f=function(r){return r.nodeType===Node.ELEMENT_NODE},Yx=function(r){return $f(r)&&typeof r.style<"u"&&!L1(r)},L1=function(r){return typeof r.className=="object"},Rct=function(r){return r.tagName==="LI"},Oct=function(r){return r.tagName==="OL"},Dct=function(r){return r.tagName==="INPUT"},Nct=function(r){return r.tagName==="HTML"},sU=function(r){return r.tagName==="svg"},Zx=function(r){return r.tagName==="BODY"},oU=function(r){return r.tagName==="CANVAS"},aU=function(r){return r.tagName==="VIDEO"},tB=function(r){return r.tagName==="IMG"},lU=function(r){return r.tagName==="IFRAME"},cU=function(r){return r.tagName==="STYLE"},kct=function(r){return r.tagName==="SCRIPT"},P1=function(r){return r.tagName==="TEXTAREA"},M1=function(r){return r.tagName==="SELECT"},uU=function(r){return r.tagName==="SLOT"},AU=function(r){return r.tagName.indexOf("-")>0},Qct=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},r.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},r.prototype.pop=function(t){var e=this;t.forEach(function(n){return e.counters[n].pop()})},r.prototype.parse=function(t){var e=this,n=t.counterIncrement,i=t.counterReset,s=!0;n!==null&&n.forEach(function(o){var h=e.counters[o.counter];h&&o.increment!==0&&(s=!1,h.length||h.push(1),h[Math.max(0,h.length-1)]+=o.increment)});var a=[];return s&&i.forEach(function(o){var h=e.counters[o.counter];a.push(o.counter),h||(h=e.counters[o.counter]=[]),h.push(o.reset)}),a},r}(),hU={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},dU={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Hct={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},zct={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Xf=function(r,t,e,n,i,s){return r<t||r>e?fm(r,i,s.length>0):n.integers.reduce(function(a,o,h){for(;r>=o;)r-=o,a+=n.values[h];return a},"")+s},fU=function(r,t,e,n){var i="";do e||r--,i=n(r)+i,r/=t;while(r*t>=t);return i},es=function(r,t,e,n,i){var s=e-t+1;return(r<0?"-":"")+(fU(Math.abs(r),s,n,function(a){return ts(Math.floor(a%s)+t)})+i)},ld=function(r,t,e){e===void 0&&(e=". ");var n=t.length;return fU(Math.abs(r),n,!1,function(i){return t[Math.floor(i%n)]})+e},Jf=1,rh=2,nh=4,dm=8,Yu=function(r,t,e,n,i,s){if(r<-9999||r>9999)return fm(r,4,i.length>0);var a=Math.abs(r),o=i;if(a===0)return t[0]+o;for(var h=0;a>0&&h<=4;h++){var f=a%10;f===0&&Bs(s,Jf)&&o!==""?o=t[f]+o:f>1||f===1&&h===0||f===1&&h===1&&Bs(s,rh)||f===1&&h===1&&Bs(s,nh)&&r>100||f===1&&h>1&&Bs(s,dm)?o=t[f]+(h>0?e[h-1]:"")+o:f===1&&h>0&&(o=e[h-1]+o),a=Math.floor(a/10)}return(r<0?n:"")+o},pU="",gU="",mU="",eB="",fm=function(r,t,e){var n=e?". ":"",i=e?"":"",s=e?", ":"",a=e?" ":"";switch(t){case 0:return""+a;case 1:return""+a;case 2:return""+a;case 5:var o=es(r,48,57,!0,n);return o.length<4?"0"+o:o;case 4:return ld(r,"",i);case 6:return Xf(r,1,3999,hU,3,n).toLowerCase();case 7:return Xf(r,1,3999,hU,3,n);case 8:return es(r,945,969,!1,n);case 9:return es(r,97,122,!1,n);case 10:return es(r,65,90,!1,n);case 11:return es(r,1632,1641,!0,n);case 12:case 49:return Xf(r,1,9999,dU,3,n);case 35:return Xf(r,1,9999,dU,3,n).toLowerCase();case 13:return es(r,2534,2543,!0,n);case 14:case 30:return es(r,6112,6121,!0,n);case 15:return ld(r,"",i);case 16:return ld(r,"",i);case 17:case 48:return Yu(r,"",pU,"",i,rh|nh|dm);case 47:return Yu(r,"",gU,"",i,Jf|rh|nh|dm);case 42:return Yu(r,"",pU,"",i,rh|nh|dm);case 41:return Yu(r,"",gU,"",i,Jf|rh|nh|dm);case 26:return Yu(r,"","",mU,i,0);case 25:return Yu(r,"","",mU,i,Jf|rh|nh);case 31:return Yu(r,"","",eB,s,Jf|rh|nh);case 33:return Yu(r,"","",eB,s,0);case 32:return Yu(r,"","",eB,s,Jf|rh|nh);case 18:return es(r,2406,2415,!0,n);case 20:return Xf(r,1,19999,zct,3,n);case 21:return es(r,2790,2799,!0,n);case 22:return es(r,2662,2671,!0,n);case 22:return Xf(r,1,10999,Hct,3,n);case 23:return ld(r,"");case 24:return ld(r,"");case 27:return es(r,3302,3311,!0,n);case 28:return ld(r,"",i);case 29:return ld(r,"",i);case 34:return es(r,3792,3801,!0,n);case 37:return es(r,6160,6169,!0,n);case 38:return es(r,4160,4169,!0,n);case 39:return es(r,2918,2927,!0,n);case 40:return es(r,1776,1785,!0,n);case 43:return es(r,3046,3055,!0,n);case 44:return es(r,3174,3183,!0,n);case 45:return es(r,3664,3673,!0,n);case 46:return es(r,3872,3881,!0,n);case 3:default:return es(r,48,57,!0,n)}},yU="data-html2canvas-ignore",_U=function(){function r(t,e,n){if(this.context=t,this.options=n,this.scrolledElements=[],this.referenceElement=e,this.counters=new Qct,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(t,e){var n=this,i=Vct(t,e);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=t.defaultView.pageXOffset,a=t.defaultView.pageYOffset,o=i.contentWindow,h=o.document,f=qct(i).then(function(){return ko(n,void 0,void 0,function(){var m,b;return vo(this,function(x){switch(x.label){case 0:return this.scrolledElements.forEach(Xct),o&&(o.scrollTo(e.left,e.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==e.top||o.scrollX!==e.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-e.left,o.scrollY-e.top,0,0))),m=this.options.onclone,b=this.clonedReferenceElement,typeof b>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:h.fonts&&h.fonts.ready?[4,h.fonts.ready]:[3,2];case 1:x.sent(),x.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,jct(h)]:[3,4];case 3:x.sent(),x.label=4;case 4:return typeof m=="function"?[2,Promise.resolve().then(function(){return m(h,b)}).then(function(){return i})]:[2,i]}})})});return h.open(),h.write(Wct(document.doctype)+"<html></html>"),$ct(this.referenceElement.ownerDocument,s,a),h.replaceChild(h.adoptNode(this.documentElement),h.documentElement),h.close(),f},r.prototype.createElementClone=function(t){if(kx(t,2))debugger;if(oU(t))return this.createCanvasClone(t);if(aU(t))return this.createVideoClone(t);if(cU(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return tB(e)&&(tB(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),e.loading==="lazy"&&(e.loading="eager")),AU(e)?this.createCustomElementClone(e):e},r.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return rB(t.style,e),e},r.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var n=[].slice.call(e.cssRules,0).reduce(function(s,a){return a&&typeof a.cssText=="string"?s+a.cssText:s},""),i=t.cloneNode(!1);return i.textContent=n,i}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return t.cloneNode(!1)},r.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var n=t.ownerDocument.createElement("img");try{return n.src=t.toDataURL(),n}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var i=t.cloneNode(!1);try{i.width=t.width,i.height=t.height;var s=t.getContext("2d"),a=i.getContext("2d");if(a)if(!this.options.allowTaint&&s)a.putImageData(s.getImageData(0,0,t.width,t.height),0,0);else{var o=(e=t.getContext("webgl2"))!==null&&e!==void 0?e:t.getContext("webgl");if(o){var h=o.getContextAttributes();(h==null?void 0:h.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}a.drawImage(t,0,0)}return i}catch{this.context.logger.info("Unable to clone canvas as it is tainted",t)}return i},r.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var n=e.getContext("2d");try{return n&&(n.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||n.getImageData(0,0,e.width,e.height)),e}catch{this.context.logger.info("Unable to clone video as it is tainted",t)}var i=t.ownerDocument.createElement("canvas");return i.width=t.offsetWidth,i.height=t.offsetHeight,i},r.prototype.appendChildNode=function(t,e,n){(!$f(e)||!kct(e)&&!e.hasAttribute(yU)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(e)))&&(!this.options.copyStyles||!$f(e)||!cU(e))&&t.appendChild(this.cloneNode(e,n))},r.prototype.cloneChildNodes=function(t,e,n){for(var i=this,s=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;s;s=s.nextSibling)if($f(s)&&uU(s)&&typeof s.assignedNodes=="function"){var a=s.assignedNodes();a.length&&a.forEach(function(o){return i.appendChildNode(e,o,n)})}else this.appendChildNode(e,s,n)},r.prototype.cloneNode=function(t,e){if(iU(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var n=t.ownerDocument.defaultView;if(n&&$f(t)&&(Yx(t)||L1(t))){var i=this.createElementClone(t);i.style.transitionProperty="none";var s=n.getComputedStyle(t),a=n.getComputedStyle(t,":before"),o=n.getComputedStyle(t,":after");this.referenceElement===t&&Yx(i)&&(this.clonedReferenceElement=i),Zx(i)&&Zct(i);var h=this.counters.parse(new P4(this.context,s)),f=this.resolvePseudoContent(t,i,a,pm.BEFORE);AU(t)&&(e=!0),aU(t)||this.cloneChildNodes(t,i,e),f&&i.insertBefore(f,i.firstChild);var m=this.resolvePseudoContent(t,i,o,pm.AFTER);return m&&i.appendChild(m),this.counters.pop(h),(s&&(this.options.copyStyles||L1(t))&&!lU(t)||e)&&rB(s,i),(t.scrollTop!==0||t.scrollLeft!==0)&&this.scrolledElements.push([i,t.scrollLeft,t.scrollTop]),(P1(t)||M1(t))&&(P1(i)||M1(i))&&(i.value=t.value),i}return t.cloneNode(!1)},r.prototype.resolvePseudoContent=function(t,e,n,i){var s=this;if(n){var a=n.content,o=e.ownerDocument;if(!(!o||!a||a==="none"||a==="-moz-alt-content"||n.display==="none")){this.counters.parse(new P4(this.context,n));var h=new Rlt(this.context,n),f=o.createElement("html2canvaspseudoelement");rB(n,f),h.content.forEach(function(b){if(b.type===0)f.appendChild(o.createTextNode(b.value));else if(b.type===22){var x=o.createElement("img");x.src=b.value,x.style.opacity="1",f.appendChild(x)}else if(b.type===18){if(b.name==="attr"){var B=b.values.filter(ai);B.length&&f.appendChild(o.createTextNode(t.getAttribute(B[0].value)||""))}else if(b.name==="counter"){var P=b.values.filter(Kf),R=P[0],Q=P[1];if(R&&ai(R)){var z=s.counters.getCounterValue(R.value),G=Q&&ai(Q)?Nx.parse(s.context,Q.value):3;f.appendChild(o.createTextNode(fm(z,G,!1)))}}else if(b.name==="counters"){var X=b.values.filter(Kf),R=X[0],et=X[1],Q=X[2];if(R&&ai(R)){var pt=s.counters.getCounterValues(R.value),gt=Q&&ai(Q)?Nx.parse(s.context,Q.value):3,mt=et&&et.type===0?et.value:"",ft=pt.map(function(at){return fm(at,gt,!1)}).join(mt);f.appendChild(o.createTextNode(ft))}}}else if(b.type===20)switch(b.value){case"open-quote":f.appendChild(o.createTextNode(L4(h.quotes,s.quoteDepth++,!0)));break;case"close-quote":f.appendChild(o.createTextNode(L4(h.quotes,--s.quoteDepth,!1)));break;default:f.appendChild(o.createTextNode(b.value))}}),f.className=nB+" "+iB;var m=i===pm.BEFORE?" "+nB:" "+iB;return L1(e)?e.className.baseValue+=m:e.className+=m,f}}},r.destroy=function(t){return t.parentNode?(t.parentNode.removeChild(t),!0):!1},r}(),pm;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(pm||(pm={}));var Vct=function(r,t){var e=r.createElement("iframe");return e.className="html2canvas-container",e.style.visibility="hidden",e.style.position="fixed",e.style.left="-10000px",e.style.top="0px",e.style.border="0",e.width=t.width.toString(),e.height=t.height.toString(),e.scrolling="no",e.setAttribute(yU,"true"),r.body.appendChild(e),e},Gct=function(r){return new Promise(function(t){if(r.complete){t();return}if(!r.src){t();return}r.onload=t,r.onerror=t})},jct=function(r){return Promise.all([].slice.call(r.images,0).map(Gct))},qct=function(r){return new Promise(function(t,e){var n=r.contentWindow;if(!n)return e("No window assigned for iframe");var i=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var s=setInterval(function(){i.body.childNodes.length>0&&i.readyState==="complete"&&(clearInterval(s),t(r))},50)}})},Kct=["all","d","content"],rB=function(r,t){for(var e=r.length-1;e>=0;e--){var n=r.item(e);Kct.indexOf(n)===-1&&t.style.setProperty(n,r.getPropertyValue(n))}return t},Wct=function(r){var t="";return r&&(t+="<!DOCTYPE ",r.name&&(t+=r.name),r.internalSubset&&(t+=r.internalSubset),r.publicId&&(t+='"'+r.publicId+'"'),r.systemId&&(t+='"'+r.systemId+'"'),t+=">"),t},$ct=function(r,t,e){r&&r.defaultView&&(t!==r.defaultView.pageXOffset||e!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(t,e)},Xct=function(r){var t=r[0],e=r[1],n=r[2];t.scrollLeft=e,t.scrollTop=n},Jct=":before",Yct=":after",nB="___html2canvas___pseudoelement_before",iB="___html2canvas___pseudoelement_after",vU=`{
    content: "" !important;
    display: none !important;
}`,Zct=function(r){tut(r,"."+nB+Jct+vU+`
         .`+iB+Yct+vU)},tut=function(r,t){var e=r.ownerDocument;if(e){var n=e.createElement("style");n.textContent=t,r.appendChild(n)}},bU=function(){function r(){}return r.getOrigin=function(t){var e=r._link;return e?(e.href=t,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},r.isSameOrigin=function(t){return r.getOrigin(t)===r._origin},r.setContext=function(t){r._link=t.document.createElement("a"),r._origin=r.getOrigin(t.location.href)},r._origin="about:blank",r}(),eut=function(){function r(t,e){this.context=t,this._options=e,this._cache={}}return r.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)||(oB(t)||sut(t))&&(this._cache[t]=this.loadImage(t)).catch(function(){}),e},r.prototype.match=function(t){return this._cache[t]},r.prototype.loadImage=function(t){return ko(this,void 0,void 0,function(){var e,n,i,s,a=this;return vo(this,function(o){switch(o.label){case 0:return e=bU.isSameOrigin(t),n=!sB(t)&&this._options.useCORS===!0&&Xs.SUPPORT_CORS_IMAGES&&!e,i=!sB(t)&&!e&&!oB(t)&&typeof this._options.proxy=="string"&&Xs.SUPPORT_CORS_XHR&&!n,!e&&this._options.allowTaint===!1&&!sB(t)&&!oB(t)&&!i&&!n?[2]:(s=t,i?[4,this.proxy(s)]:[3,2]);case 1:s=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise(function(h,f){var m=new Image;m.onload=function(){return h(m)},m.onerror=f,(out(s)||n)&&(m.crossOrigin="anonymous"),m.src=s,m.complete===!0&&setTimeout(function(){return h(m)},500),a._options.imageTimeout>0&&setTimeout(function(){return f("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},r.prototype.has=function(t){return typeof this._cache[t]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(t){var e=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var i=t.substring(0,256);return new Promise(function(s,a){var o=Xs.SUPPORT_RESPONSE_TYPE?"blob":"text",h=new XMLHttpRequest;h.onload=function(){if(h.status===200)if(o==="text")s(h.response);else{var b=new FileReader;b.addEventListener("load",function(){return s(b.result)},!1),b.addEventListener("error",function(x){return a(x)},!1),b.readAsDataURL(h.response)}else a("Failed to proxy resource "+i+" with status code "+h.status)},h.onerror=a;var f=n.indexOf("?")>-1?"&":"?";if(h.open("GET",""+n+f+"url="+encodeURIComponent(t)+"&responseType="+o),o!=="text"&&h instanceof XMLHttpRequest&&(h.responseType=o),e._options.imageTimeout){var m=e._options.imageTimeout;h.timeout=m,h.ontimeout=function(){return a("Timed out ("+m+"ms) proxying "+i)}}h.send()})},r}(),rut=/^data:image\/svg\+xml/i,nut=/^data:image\/.*;base64,/i,iut=/^data:image\/.*/i,sut=function(r){return Xs.SUPPORT_SVG_DRAWING||!aut(r)},sB=function(r){return iut.test(r)},out=function(r){return nut.test(r)},oB=function(r){return r.substr(0,4)==="blob"},aut=function(r){return r.substr(-3).toLowerCase()==="svg"||rut.test(r)},Ar=function(){function r(t,e){this.type=0,this.x=t,this.y=e}return r.prototype.add=function(t,e){return new r(this.x+t,this.y+e)},r}(),Yf=function(r,t,e){return new Ar(r.x+(t.x-r.x)*e,r.y+(t.y-r.y)*e)},U1=function(){function r(t,e,n,i){this.type=1,this.start=t,this.startControl=e,this.endControl=n,this.end=i}return r.prototype.subdivide=function(t,e){var n=Yf(this.start,this.startControl,t),i=Yf(this.startControl,this.endControl,t),s=Yf(this.endControl,this.end,t),a=Yf(n,i,t),o=Yf(i,s,t),h=Yf(a,o,t);return e?new r(this.start,n,a,h):new r(h,o,s,this.end)},r.prototype.add=function(t,e){return new r(this.start.add(t,e),this.startControl.add(t,e),this.endControl.add(t,e),this.end.add(t,e))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),Cl=function(r){return r.type===1},lut=function(){function r(t){var e=t.styles,n=t.bounds,i=lm(e.borderTopLeftRadius,n.width,n.height),s=i[0],a=i[1],o=lm(e.borderTopRightRadius,n.width,n.height),h=o[0],f=o[1],m=lm(e.borderBottomRightRadius,n.width,n.height),b=m[0],x=m[1],B=lm(e.borderBottomLeftRadius,n.width,n.height),P=B[0],R=B[1],Q=[];Q.push((s+h)/n.width),Q.push((P+b)/n.width),Q.push((a+R)/n.height),Q.push((f+x)/n.height);var z=Math.max.apply(Math,Q);z>1&&(s/=z,a/=z,h/=z,f/=z,b/=z,x/=z,P/=z,R/=z);var G=n.width-h,X=n.height-x,et=n.width-b,pt=n.height-R,gt=e.borderTopWidth,mt=e.borderRightWidth,ft=e.borderBottomWidth,Mt=e.borderLeftWidth,Lt=gi(e.paddingTop,t.bounds.width),at=gi(e.paddingRight,t.bounds.width),ct=gi(e.paddingBottom,t.bounds.width),wt=gi(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||a>0?Ci(n.left+Mt/3,n.top+gt/3,s-Mt/3,a-gt/3,jn.TOP_LEFT):new Ar(n.left+Mt/3,n.top+gt/3),this.topRightBorderDoubleOuterBox=s>0||a>0?Ci(n.left+G,n.top+gt/3,h-mt/3,f-gt/3,jn.TOP_RIGHT):new Ar(n.left+n.width-mt/3,n.top+gt/3),this.bottomRightBorderDoubleOuterBox=b>0||x>0?Ci(n.left+et,n.top+X,b-mt/3,x-ft/3,jn.BOTTOM_RIGHT):new Ar(n.left+n.width-mt/3,n.top+n.height-ft/3),this.bottomLeftBorderDoubleOuterBox=P>0||R>0?Ci(n.left+Mt/3,n.top+pt,P-Mt/3,R-ft/3,jn.BOTTOM_LEFT):new Ar(n.left+Mt/3,n.top+n.height-ft/3),this.topLeftBorderDoubleInnerBox=s>0||a>0?Ci(n.left+Mt*2/3,n.top+gt*2/3,s-Mt*2/3,a-gt*2/3,jn.TOP_LEFT):new Ar(n.left+Mt*2/3,n.top+gt*2/3),this.topRightBorderDoubleInnerBox=s>0||a>0?Ci(n.left+G,n.top+gt*2/3,h-mt*2/3,f-gt*2/3,jn.TOP_RIGHT):new Ar(n.left+n.width-mt*2/3,n.top+gt*2/3),this.bottomRightBorderDoubleInnerBox=b>0||x>0?Ci(n.left+et,n.top+X,b-mt*2/3,x-ft*2/3,jn.BOTTOM_RIGHT):new Ar(n.left+n.width-mt*2/3,n.top+n.height-ft*2/3),this.bottomLeftBorderDoubleInnerBox=P>0||R>0?Ci(n.left+Mt*2/3,n.top+pt,P-Mt*2/3,R-ft*2/3,jn.BOTTOM_LEFT):new Ar(n.left+Mt*2/3,n.top+n.height-ft*2/3),this.topLeftBorderStroke=s>0||a>0?Ci(n.left+Mt/2,n.top+gt/2,s-Mt/2,a-gt/2,jn.TOP_LEFT):new Ar(n.left+Mt/2,n.top+gt/2),this.topRightBorderStroke=s>0||a>0?Ci(n.left+G,n.top+gt/2,h-mt/2,f-gt/2,jn.TOP_RIGHT):new Ar(n.left+n.width-mt/2,n.top+gt/2),this.bottomRightBorderStroke=b>0||x>0?Ci(n.left+et,n.top+X,b-mt/2,x-ft/2,jn.BOTTOM_RIGHT):new Ar(n.left+n.width-mt/2,n.top+n.height-ft/2),this.bottomLeftBorderStroke=P>0||R>0?Ci(n.left+Mt/2,n.top+pt,P-Mt/2,R-ft/2,jn.BOTTOM_LEFT):new Ar(n.left+Mt/2,n.top+n.height-ft/2),this.topLeftBorderBox=s>0||a>0?Ci(n.left,n.top,s,a,jn.TOP_LEFT):new Ar(n.left,n.top),this.topRightBorderBox=h>0||f>0?Ci(n.left+G,n.top,h,f,jn.TOP_RIGHT):new Ar(n.left+n.width,n.top),this.bottomRightBorderBox=b>0||x>0?Ci(n.left+et,n.top+X,b,x,jn.BOTTOM_RIGHT):new Ar(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=P>0||R>0?Ci(n.left,n.top+pt,P,R,jn.BOTTOM_LEFT):new Ar(n.left,n.top+n.height),this.topLeftPaddingBox=s>0||a>0?Ci(n.left+Mt,n.top+gt,Math.max(0,s-Mt),Math.max(0,a-gt),jn.TOP_LEFT):new Ar(n.left+Mt,n.top+gt),this.topRightPaddingBox=h>0||f>0?Ci(n.left+Math.min(G,n.width-mt),n.top+gt,G>n.width+mt?0:Math.max(0,h-mt),Math.max(0,f-gt),jn.TOP_RIGHT):new Ar(n.left+n.width-mt,n.top+gt),this.bottomRightPaddingBox=b>0||x>0?Ci(n.left+Math.min(et,n.width-Mt),n.top+Math.min(X,n.height-ft),Math.max(0,b-mt),Math.max(0,x-ft),jn.BOTTOM_RIGHT):new Ar(n.left+n.width-mt,n.top+n.height-ft),this.bottomLeftPaddingBox=P>0||R>0?Ci(n.left+Mt,n.top+Math.min(pt,n.height-ft),Math.max(0,P-Mt),Math.max(0,R-ft),jn.BOTTOM_LEFT):new Ar(n.left+Mt,n.top+n.height-ft),this.topLeftContentBox=s>0||a>0?Ci(n.left+Mt+wt,n.top+gt+Lt,Math.max(0,s-(Mt+wt)),Math.max(0,a-(gt+Lt)),jn.TOP_LEFT):new Ar(n.left+Mt+wt,n.top+gt+Lt),this.topRightContentBox=h>0||f>0?Ci(n.left+Math.min(G,n.width+Mt+wt),n.top+gt+Lt,G>n.width+Mt+wt?0:h-Mt+wt,f-(gt+Lt),jn.TOP_RIGHT):new Ar(n.left+n.width-(mt+at),n.top+gt+Lt),this.bottomRightContentBox=b>0||x>0?Ci(n.left+Math.min(et,n.width-(Mt+wt)),n.top+Math.min(X,n.height+gt+Lt),Math.max(0,b-(mt+at)),x-(ft+ct),jn.BOTTOM_RIGHT):new Ar(n.left+n.width-(mt+at),n.top+n.height-(ft+ct)),this.bottomLeftContentBox=P>0||R>0?Ci(n.left+Mt+wt,n.top+pt,Math.max(0,P-(Mt+wt)),R-(ft+ct),jn.BOTTOM_LEFT):new Ar(n.left+Mt+wt,n.top+n.height-(ft+ct))}return r}(),jn;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(jn||(jn={}));var Ci=function(r,t,e,n,i){var s=4*((Math.sqrt(2)-1)/3),a=e*s,o=n*s,h=r+e,f=t+n;switch(i){case jn.TOP_LEFT:return new U1(new Ar(r,f),new Ar(r,f-o),new Ar(h-a,t),new Ar(h,t));case jn.TOP_RIGHT:return new U1(new Ar(r,t),new Ar(r+a,t),new Ar(h,f-o),new Ar(h,f));case jn.BOTTOM_RIGHT:return new U1(new Ar(h,t),new Ar(h,t+o),new Ar(r+a,f),new Ar(r,f));case jn.BOTTOM_LEFT:default:return new U1(new Ar(h,f),new Ar(h-a,f),new Ar(r,t+o),new Ar(r,t))}},R1=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},cut=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},O1=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},uut=function(){function r(t,e,n){this.offsetX=t,this.offsetY=e,this.matrix=n,this.type=0,this.target=6}return r}(),D1=function(){function r(t,e){this.path=t,this.target=e,this.type=1}return r}(),Aut=function(){function r(t){this.opacity=t,this.type=2,this.target=6}return r}(),hut=function(r){return r.type===0},wU=function(r){return r.type===1},dut=function(r){return r.type===2},xU=function(r,t){return r.length===t.length?r.some(function(e,n){return e===t[n]}):!1},fut=function(r,t,e,n,i){return r.map(function(s,a){switch(a){case 0:return s.add(t,e);case 1:return s.add(t+n,e);case 2:return s.add(t+n,e+i);case 3:return s.add(t,e+i)}return s})},BU=function(){function r(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),CU=function(){function r(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new lut(this.container),this.container.styles.opacity<1&&this.effects.push(new Aut(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new uut(n,i,s))}if(this.container.styles.overflowX!==0){var a=R1(this.curves),o=O1(this.curves);xU(a,o)?this.effects.push(new D1(a,6)):(this.effects.push(new D1(a,2)),this.effects.push(new D1(o,4)))}}return r.prototype.getEffects=function(t){for(var e=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,i=this.effects.slice(0);n;){var s=n.effects.filter(function(h){return!wU(h)});if(e||n.container.styles.position!==0||!n.parent){if(i.unshift.apply(i,s),e=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var a=R1(n.curves),o=O1(n.curves);xU(a,o)||i.unshift(new D1(o,6))}}else i.unshift.apply(i,s);n=n.parent}return i.filter(function(h){return Bs(h.target,t)})},r}(),aB=function(r,t,e,n){r.container.elements.forEach(function(i){var s=Bs(i.flags,4),a=Bs(i.flags,2),o=new CU(i,r);Bs(i.styles.display,2048)&&n.push(o);var h=Bs(i.flags,8)?[]:n;if(s||a){var f=s||i.styles.isPositioned()?e:t,m=new BU(o);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var b=i.styles.zIndex.order;if(b<0){var x=0;f.negativeZIndex.some(function(P,R){return b>P.element.container.styles.zIndex.order?(x=R,!1):x>0}),f.negativeZIndex.splice(x,0,m)}else if(b>0){var B=0;f.positiveZIndex.some(function(P,R){return b>=P.element.container.styles.zIndex.order?(B=R+1,!1):B>0}),f.positiveZIndex.splice(B,0,m)}else f.zeroOrAutoZIndexOrTransformedOrOpacity.push(m)}else i.styles.isFloating()?f.nonPositionedFloats.push(m):f.nonPositionedInlineLevel.push(m);aB(o,m,s?m:e,h)}else i.styles.isInlineLevel()?t.inlineLevel.push(o):t.nonInlineLevel.push(o),aB(o,t,e,h);Bs(i.flags,8)&&EU(i,h)})},EU=function(r,t){for(var e=r instanceof Xx?r.start:1,n=r instanceof Xx?r.reversed:!1,i=0;i<t.length;i++){var s=t[i];s.container instanceof J4&&typeof s.container.value=="number"&&s.container.value!==0&&(e=s.container.value),s.listValue=fm(e,s.container.styles.listStyleType,!0),e+=n?-1:1}},put=function(r){var t=new CU(r,null),e=new BU(t),n=[];return aB(t,e,e,n),EU(t.container,n),e},SU=function(r,t){switch(t){case 0:return El(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return El(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return El(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return El(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},gut=function(r,t){switch(t){case 0:return El(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return El(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return El(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return El(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},mut=function(r,t){switch(t){case 0:return El(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return El(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return El(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return El(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},yut=function(r,t){switch(t){case 0:return N1(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return N1(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return N1(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return N1(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},N1=function(r,t){var e=[];return Cl(r)?e.push(r.subdivide(.5,!1)):e.push(r),Cl(t)?e.push(t.subdivide(.5,!0)):e.push(t),e},El=function(r,t,e,n){var i=[];return Cl(r)?i.push(r.subdivide(.5,!1)):i.push(r),Cl(e)?i.push(e.subdivide(.5,!0)):i.push(e),Cl(n)?i.push(n.subdivide(.5,!0).reverse()):i.push(n),Cl(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},TU=function(r){var t=r.bounds,e=r.styles;return t.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},k1=function(r){var t=r.styles,e=r.bounds,n=gi(t.paddingLeft,e.width),i=gi(t.paddingRight,e.width),s=gi(t.paddingTop,e.width),a=gi(t.paddingBottom,e.width);return e.add(n+t.borderLeftWidth,s+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+n+i),-(t.borderTopWidth+t.borderBottomWidth+s+a))},_ut=function(r,t){return r===0?t.bounds:r===2?k1(t):TU(t)},vut=function(r,t){return r===0?t.bounds:r===2?k1(t):TU(t)},lB=function(r,t,e){var n=_ut(tp(r.styles.backgroundOrigin,t),r),i=vut(tp(r.styles.backgroundClip,t),r),s=but(tp(r.styles.backgroundSize,t),e,n),a=s[0],o=s[1],h=lm(tp(r.styles.backgroundPosition,t),n.width-a,n.height-o),f=wut(tp(r.styles.backgroundRepeat,t),h,s,n,i),m=Math.round(n.left+h[0]),b=Math.round(n.top+h[1]);return[f,m,b,a,o]},Zf=function(r){return ai(r)&&r.value===Wf.AUTO},Q1=function(r){return typeof r=="number"},but=function(r,t,e){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1];if(!a)return[0,0];if(ps(a)&&o&&ps(o))return[gi(a,e.width),gi(o,e.height)];var h=Q1(s);if(ai(a)&&(a.value===Wf.CONTAIN||a.value===Wf.COVER)){if(Q1(s)){var f=e.width/e.height;return f<s!=(a.value===Wf.COVER)?[e.width,e.width/s]:[e.height*s,e.height]}return[e.width,e.height]}var m=Q1(n),b=Q1(i),x=m||b;if(Zf(a)&&(!o||Zf(o))){if(m&&b)return[n,i];if(!h&&!x)return[e.width,e.height];if(x&&h){var B=m?n:i*s,P=b?i:n/s;return[B,P]}var R=m?n:e.width,Q=b?i:e.height;return[R,Q]}if(h){var z=0,G=0;return ps(a)?z=gi(a,e.width):ps(o)&&(G=gi(o,e.height)),Zf(a)?z=G*s:(!o||Zf(o))&&(G=z/s),[z,G]}var X=null,et=null;if(ps(a)?X=gi(a,e.width):o&&ps(o)&&(et=gi(o,e.height)),X!==null&&(!o||Zf(o))&&(et=m&&b?X/n*i:e.height),et!==null&&Zf(a)&&(X=m&&b?et/i*n:e.width),X!==null&&et!==null)return[X,et];throw new Error("Unable to calculate background-size for element")},tp=function(r,t){var e=r[t];return typeof e>"u"?r[0]:e},wut=function(r,t,e,n,i){var s=t[0],a=t[1],o=e[0],h=e[1];switch(r){case 2:return[new Ar(Math.round(n.left),Math.round(n.top+a)),new Ar(Math.round(n.left+n.width),Math.round(n.top+a)),new Ar(Math.round(n.left+n.width),Math.round(h+n.top+a)),new Ar(Math.round(n.left),Math.round(h+n.top+a))];case 3:return[new Ar(Math.round(n.left+s),Math.round(n.top)),new Ar(Math.round(n.left+s+o),Math.round(n.top)),new Ar(Math.round(n.left+s+o),Math.round(n.height+n.top)),new Ar(Math.round(n.left+s),Math.round(n.height+n.top))];case 1:return[new Ar(Math.round(n.left+s),Math.round(n.top+a)),new Ar(Math.round(n.left+s+o),Math.round(n.top+a)),new Ar(Math.round(n.left+s+o),Math.round(n.top+a+h)),new Ar(Math.round(n.left+s),Math.round(n.top+a+h))];default:return[new Ar(Math.round(i.left),Math.round(i.top)),new Ar(Math.round(i.left+i.width),Math.round(i.top)),new Ar(Math.round(i.left+i.width),Math.round(i.height+i.top)),new Ar(Math.round(i.left),Math.round(i.height+i.top))]}},xut="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",IU="Hidden Text",But=function(){function r(t){this._data={},this._document=t}return r.prototype.parseMetrics=function(t,e){var n=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),a=this._document.body;n.style.visibility="hidden",n.style.fontFamily=t,n.style.fontSize=e,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",a.appendChild(n),i.src=xut,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=t,s.style.fontSize=e,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(IU)),n.appendChild(s),n.appendChild(i);var o=i.offsetTop-s.offsetTop+2;n.removeChild(s),n.appendChild(this._document.createTextNode(IU)),n.style.lineHeight="normal",i.style.verticalAlign="super";var h=i.offsetTop-n.offsetTop+2;return a.removeChild(n),{baseline:o,middle:h}},r.prototype.getMetrics=function(t,e){var n=t+" "+e;return typeof this._data[n]>"u"&&(this._data[n]=this.parseMetrics(t,e)),this._data[n]},r}(),FU=function(){function r(t,e){this.context=t,this.options=e}return r}(),Cut=1e4,Eut=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i._activeEffects=[],i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),n.canvas||(i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px"),i.fontMetrics=new But(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),i}return t.prototype.applyEffects=function(e){for(var n=this;this._activeEffects.length;)this.popEffect();e.forEach(function(i){return n.applyEffect(i)})},t.prototype.applyEffect=function(e){this.ctx.save(),dut(e)&&(this.ctx.globalAlpha=e.opacity),hut(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),wU(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(e){return ko(this,void 0,void 0,function(){var n;return vo(this,function(i){switch(i.label){case 0:return n=e.element.container.styles,n.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.renderNode=function(e){return ko(this,void 0,void 0,function(){return vo(this,function(n){switch(n.label){case 0:if(Bs(e.container.flags,16))debugger;return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.renderTextWithLetterSpacing=function(e,n,i){var s=this;if(n===0)this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+i);else{var a=$x(e.text);a.reduce(function(o,h){return s.ctx.fillText(h,o,e.bounds.top+i),o+s.ctx.measureText(h).width},e.bounds.left)}},t.prototype.createFontStyle=function(e){var n=e.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),i=Lut(e.fontFamily).join(", "),s=am(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,n,e.fontWeight,s,i].join(" "),i,s]},t.prototype.renderTextNode=function(e,n){return ko(this,void 0,void 0,function(){var i,s,a,o,h,f,m,b,x=this;return vo(this,function(B){return i=this.createFontStyle(n),s=i[0],a=i[1],o=i[2],this.ctx.font=s,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",h=this.fontMetrics.getMetrics(a,o),f=h.baseline,m=h.middle,b=n.paintOrder,e.textBounds.forEach(function(P){b.forEach(function(R){switch(R){case 0:x.ctx.fillStyle=Us(n.color),x.renderTextWithLetterSpacing(P,n.letterSpacing,f);var Q=n.textShadow;Q.length&&P.text.trim().length&&(Q.slice(0).reverse().forEach(function(z){x.ctx.shadowColor=Us(z.color),x.ctx.shadowOffsetX=z.offsetX.number*x.options.scale,x.ctx.shadowOffsetY=z.offsetY.number*x.options.scale,x.ctx.shadowBlur=z.blur.number,x.renderTextWithLetterSpacing(P,n.letterSpacing,f)}),x.ctx.shadowColor="",x.ctx.shadowOffsetX=0,x.ctx.shadowOffsetY=0,x.ctx.shadowBlur=0),n.textDecorationLine.length&&(x.ctx.fillStyle=Us(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(z){switch(z){case 1:x.ctx.fillRect(P.bounds.left,Math.round(P.bounds.top+f),P.bounds.width,1);break;case 2:x.ctx.fillRect(P.bounds.left,Math.round(P.bounds.top),P.bounds.width,1);break;case 3:x.ctx.fillRect(P.bounds.left,Math.ceil(P.bounds.top+m),P.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&P.text.trim().length&&(x.ctx.strokeStyle=Us(n.webkitTextStrokeColor),x.ctx.lineWidth=n.webkitTextStrokeWidth,x.ctx.lineJoin=window.chrome?"miter":"round",x.ctx.strokeText(P.text,P.bounds.left,P.bounds.top+f)),x.ctx.strokeStyle="",x.ctx.lineWidth=0,x.ctx.lineJoin="miter";break}})}),[2]})})},t.prototype.renderReplacedElement=function(e,n,i){if(i&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var s=k1(e),a=O1(n);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,e.intrinsicWidth,e.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return ko(this,void 0,void 0,function(){var n,i,s,a,o,h,G,G,f,m,b,x,et,B,P,pt,R,Q,z,G,X,et,pt;return vo(this,function(gt){switch(gt.label){case 0:this.applyEffects(e.getEffects(4)),n=e.container,i=e.curves,s=n.styles,a=0,o=n.textNodes,gt.label=1;case 1:return a<o.length?(h=o[a],[4,this.renderTextNode(h,s)]):[3,4];case 2:gt.sent(),gt.label=3;case 3:return a++,[3,1];case 4:if(!(n instanceof W4))return[3,8];gt.label=5;case 5:return gt.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return G=gt.sent(),this.renderReplacedElement(n,i,G),[3,8];case 7:return gt.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof $4&&this.renderReplacedElement(n,i,n.canvas),!(n instanceof X4))return[3,12];gt.label=9;case 9:return gt.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return G=gt.sent(),this.renderReplacedElement(n,i,G),[3,12];case 11:return gt.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof eU&&n.tree?(f=new t(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,f.render(n.tree)]):[3,14];case 13:m=gt.sent(),n.width&&n.height&&this.ctx.drawImage(m,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),gt.label=14;case 14:if(n instanceof Jx&&(b=Math.min(n.bounds.width,n.bounds.height),n.type===T1?n.checked&&(this.ctx.save(),this.path([new Ar(n.bounds.left+b*.39363,n.bounds.top+b*.79),new Ar(n.bounds.left+b*.16,n.bounds.top+b*.5549),new Ar(n.bounds.left+b*.27347,n.bounds.top+b*.44071),new Ar(n.bounds.left+b*.39694,n.bounds.top+b*.5649),new Ar(n.bounds.left+b*.72983,n.bounds.top+b*.23),new Ar(n.bounds.left+b*.84,n.bounds.top+b*.34085),new Ar(n.bounds.left+b*.39363,n.bounds.top+b*.79)]),this.ctx.fillStyle=Us(Y4),this.ctx.fill(),this.ctx.restore()):n.type===I1&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+b/2,n.bounds.top+b/2,b/4,0,Math.PI*2,!0),this.ctx.fillStyle=Us(Y4),this.ctx.fill(),this.ctx.restore())),Sut(n)&&n.value.length){switch(x=this.createFontStyle(s),et=x[0],B=x[1],P=this.fontMetrics.getMetrics(et,B).baseline,this.ctx.font=et,this.ctx.fillStyle=Us(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Iut(n.styles.textAlign),pt=k1(n),R=0,n.styles.textAlign){case 1:R+=pt.width/2;break;case 2:R+=pt.width;break}Q=pt.add(R,0,0,-pt.height/2+1),this.ctx.save(),this.path([new Ar(pt.left,pt.top),new Ar(pt.left+pt.width,pt.top),new Ar(pt.left+pt.width,pt.top+pt.height),new Ar(pt.left,pt.top+pt.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new hm(n.value,Q),s.letterSpacing,P),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Bs(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(z=n.styles.listStyleImage,z.type!==0)return[3,18];G=void 0,X=z.url,gt.label=15;case 15:return gt.trys.push([15,17,,18]),[4,this.context.cache.match(X)];case 16:return G=gt.sent(),this.ctx.drawImage(G,n.bounds.left-(G.width+10),n.bounds.top),[3,18];case 17:return gt.sent(),this.context.logger.error("Error loading list-style-image "+X),[3,18];case 18:return[3,20];case 19:e.listValue&&n.styles.listStyleType!==-1&&(et=this.createFontStyle(s)[0],this.ctx.font=et,this.ctx.fillStyle=Us(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",pt=new $u(n.bounds.left,n.bounds.top+gi(n.styles.paddingTop,n.bounds.width),n.bounds.width,T4(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new hm(e.listValue,pt),s.letterSpacing,T4(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),gt.label=20;case 20:return[2]}})})},t.prototype.renderStackContent=function(e){return ko(this,void 0,void 0,function(){var n,i,z,s,a,z,o,h,z,f,m,z,b,x,z,B,P,z,R,Q,z;return vo(this,function(G){switch(G.label){case 0:if(Bs(e.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:G.sent(),n=0,i=e.negativeZIndex,G.label=2;case 2:return n<i.length?(z=i[n],[4,this.renderStack(z)]):[3,5];case 3:G.sent(),G.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:G.sent(),s=0,a=e.nonInlineLevel,G.label=7;case 7:return s<a.length?(z=a[s],[4,this.renderNode(z)]):[3,10];case 8:G.sent(),G.label=9;case 9:return s++,[3,7];case 10:o=0,h=e.nonPositionedFloats,G.label=11;case 11:return o<h.length?(z=h[o],[4,this.renderStack(z)]):[3,14];case 12:G.sent(),G.label=13;case 13:return o++,[3,11];case 14:f=0,m=e.nonPositionedInlineLevel,G.label=15;case 15:return f<m.length?(z=m[f],[4,this.renderStack(z)]):[3,18];case 16:G.sent(),G.label=17;case 17:return f++,[3,15];case 18:b=0,x=e.inlineLevel,G.label=19;case 19:return b<x.length?(z=x[b],[4,this.renderNode(z)]):[3,22];case 20:G.sent(),G.label=21;case 21:return b++,[3,19];case 22:B=0,P=e.zeroOrAutoZIndexOrTransformedOrOpacity,G.label=23;case 23:return B<P.length?(z=P[B],[4,this.renderStack(z)]):[3,26];case 24:G.sent(),G.label=25;case 25:return B++,[3,23];case 26:R=0,Q=e.positiveZIndex,G.label=27;case 27:return R<Q.length?(z=Q[R],[4,this.renderStack(z)]):[3,30];case 28:G.sent(),G.label=29;case 29:return R++,[3,27];case 30:return[2]}})})},t.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},t.prototype.formatPath=function(e){var n=this;e.forEach(function(i,s){var a=Cl(i)?i.start:i;s===0?n.ctx.moveTo(a.x,a.y):n.ctx.lineTo(a.x,a.y),Cl(i)&&n.ctx.bezierCurveTo(i.startControl.x,i.startControl.y,i.endControl.x,i.endControl.y,i.end.x,i.end.y)})},t.prototype.renderRepeat=function(e,n,i,s){this.path(e),this.ctx.fillStyle=n,this.ctx.translate(i,s),this.ctx.fill(),this.ctx.translate(-i,-s)},t.prototype.resizeImage=function(e,n,i){var s;if(e.width===n&&e.height===i)return e;var a=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,o=a.createElement("canvas");o.width=Math.max(1,n),o.height=Math.max(1,i);var h=o.getContext("2d");return h.drawImage(e,0,0,e.width,e.height,0,0,n,i),o},t.prototype.renderBackgroundImage=function(e){return ko(this,void 0,void 0,function(){var n,i,s,a,o,h;return vo(this,function(f){switch(f.label){case 0:n=e.styles.backgroundImage.length-1,i=function(m){var b,x,B,Lt,Yt,ee,wt,_t,ft,P,Lt,Yt,ee,wt,_t,R,Q,z,G,X,et,pt,gt,mt,ft,Mt,Lt,at,ct,wt,_t,Jt,Yt,ee,$t,ne,re,Be,it,bt,Pt,Ot;return vo(this,function(qt){switch(qt.label){case 0:if(m.type!==0)return[3,5];b=void 0,x=m.url,qt.label=1;case 1:return qt.trys.push([1,3,,4]),[4,s.context.cache.match(x)];case 2:return b=qt.sent(),[3,4];case 3:return qt.sent(),s.context.logger.error("Error loading background-image "+x),[3,4];case 4:return b&&(B=lB(e,n,[b.width,b.height,b.width/b.height]),Lt=B[0],Yt=B[1],ee=B[2],wt=B[3],_t=B[4],ft=s.ctx.createPattern(s.resizeImage(b,wt,_t),"repeat"),s.renderRepeat(Lt,ft,Yt,ee)),[3,6];case 5:hat(m)?(P=lB(e,n,[null,null,null]),Lt=P[0],Yt=P[1],ee=P[2],wt=P[3],_t=P[4],R=aat(m.angle,wt,_t),Q=R[0],z=R[1],G=R[2],X=R[3],et=R[4],pt=document.createElement("canvas"),pt.width=wt,pt.height=_t,gt=pt.getContext("2d"),mt=gt.createLinearGradient(z,X,G,et),m4(m.stops,Q).forEach(function(Gt){return mt.addColorStop(Gt.stop,Us(Gt.color))}),gt.fillStyle=mt,gt.fillRect(0,0,wt,_t),wt>0&&_t>0&&(ft=s.ctx.createPattern(pt,"repeat"),s.renderRepeat(Lt,ft,Yt,ee))):dat(m)&&(Mt=lB(e,n,[null,null,null]),Lt=Mt[0],at=Mt[1],ct=Mt[2],wt=Mt[3],_t=Mt[4],Jt=m.position.length===0?[Rx]:m.position,Yt=gi(Jt[0],wt),ee=gi(Jt[Jt.length-1],_t),$t=lat(m,Yt,ee,wt,_t),ne=$t[0],re=$t[1],ne>0&&re>0&&(Be=s.ctx.createRadialGradient(at+Yt,ct+ee,0,at+Yt,ct+ee,ne),m4(m.stops,ne*2).forEach(function(Gt){return Be.addColorStop(Gt.stop,Us(Gt.color))}),s.path(Lt),s.ctx.fillStyle=Be,ne!==re?(it=e.bounds.left+.5*e.bounds.width,bt=e.bounds.top+.5*e.bounds.height,Pt=re/ne,Ot=1/Pt,s.ctx.save(),s.ctx.translate(it,bt),s.ctx.transform(1,0,0,Pt,0,0),s.ctx.translate(-it,-bt),s.ctx.fillRect(at,Ot*(ct-bt)+bt,wt,_t*Ot),s.ctx.restore()):s.ctx.fill())),qt.label=6;case 6:return n--,[2]}})},s=this,a=0,o=e.styles.backgroundImage.slice(0).reverse(),f.label=1;case 1:return a<o.length?(h=o[a],[5,i(h)]):[3,4];case 2:f.sent(),f.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},t.prototype.renderSolidBorder=function(e,n,i){return ko(this,void 0,void 0,function(){return vo(this,function(s){return this.path(SU(i,n)),this.ctx.fillStyle=Us(e),this.ctx.fill(),[2]})})},t.prototype.renderDoubleBorder=function(e,n,i,s){return ko(this,void 0,void 0,function(){var a,o;return vo(this,function(h){switch(h.label){case 0:return n<3?[4,this.renderSolidBorder(e,i,s)]:[3,2];case 1:return h.sent(),[2];case 2:return a=gut(s,i),this.path(a),this.ctx.fillStyle=Us(e),this.ctx.fill(),o=mut(s,i),this.path(o),this.ctx.fill(),[2]}})})},t.prototype.renderNodeBackgroundAndBorders=function(e){return ko(this,void 0,void 0,function(){var n,i,s,a,o,h,f,m,b=this;return vo(this,function(x){switch(x.label){case 0:return this.applyEffects(e.getEffects(2)),n=e.container.styles,i=!th(n.backgroundColor)||n.backgroundImage.length,s=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],a=Tut(tp(n.backgroundClip,0),e.curves),i||n.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),th(n.backgroundColor)||(this.ctx.fillStyle=Us(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:x.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(B){b.ctx.save();var P=R1(e.curves),R=B.inset?0:Cut,Q=fut(P,-R+(B.inset?1:-1)*B.spread.number,(B.inset?1:-1)*B.spread.number,B.spread.number*(B.inset?-2:2),B.spread.number*(B.inset?-2:2));B.inset?(b.path(P),b.ctx.clip(),b.mask(Q)):(b.mask(P),b.ctx.clip(),b.path(Q)),b.ctx.shadowOffsetX=B.offsetX.number+R,b.ctx.shadowOffsetY=B.offsetY.number,b.ctx.shadowColor=Us(B.color),b.ctx.shadowBlur=B.blur.number,b.ctx.fillStyle=B.inset?Us(B.color):"rgba(0,0,0,1)",b.ctx.fill(),b.ctx.restore()}),x.label=2;case 2:o=0,h=0,f=s,x.label=3;case 3:return h<f.length?(m=f[h],m.style!==0&&!th(m.color)&&m.width>0?m.style!==2?[3,5]:[4,this.renderDashedDottedBorder(m.color,m.width,o,e.curves,2)]:[3,11]):[3,13];case 4:return x.sent(),[3,11];case 5:return m.style!==3?[3,7]:[4,this.renderDashedDottedBorder(m.color,m.width,o,e.curves,3)];case 6:return x.sent(),[3,11];case 7:return m.style!==4?[3,9]:[4,this.renderDoubleBorder(m.color,m.width,o,e.curves)];case 8:return x.sent(),[3,11];case 9:return[4,this.renderSolidBorder(m.color,o,e.curves)];case 10:x.sent(),x.label=11;case 11:o++,x.label=12;case 12:return h++,[3,3];case 13:return[2]}})})},t.prototype.renderDashedDottedBorder=function(e,n,i,s,a){return ko(this,void 0,void 0,function(){var o,h,f,m,b,x,B,P,R,Q,z,G,X,et,pt,gt,pt,gt;return vo(this,function(mt){return this.ctx.save(),o=yut(s,i),h=SU(s,i),a===2&&(this.path(h),this.ctx.clip()),Cl(h[0])?(f=h[0].start.x,m=h[0].start.y):(f=h[0].x,m=h[0].y),Cl(h[1])?(b=h[1].end.x,x=h[1].end.y):(b=h[1].x,x=h[1].y),i===0||i===2?B=Math.abs(f-b):B=Math.abs(m-x),this.ctx.beginPath(),a===3?this.formatPath(o):this.formatPath(h.slice(0,2)),P=n<3?n*3:n*2,R=n<3?n*2:n,a===3&&(P=n,R=n),Q=!0,B<=P*2?Q=!1:B<=P*2+R?(z=B/(2*P+R),P*=z,R*=z):(G=Math.floor((B+R)/(P+R)),X=(B-G*P)/(G-1),et=(B-(G+1)*P)/G,R=et<=0||Math.abs(R-X)<Math.abs(R-et)?X:et),Q&&(a===3?this.ctx.setLineDash([0,P+R]):this.ctx.setLineDash([P,R])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=Us(e),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(Cl(h[0])&&(pt=h[3],gt=h[0],this.ctx.beginPath(),this.formatPath([new Ar(pt.end.x,pt.end.y),new Ar(gt.start.x,gt.start.y)]),this.ctx.stroke()),Cl(h[1])&&(pt=h[1],gt=h[2],this.ctx.beginPath(),this.formatPath([new Ar(pt.end.x,pt.end.y),new Ar(gt.start.x,gt.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},t.prototype.render=function(e){return ko(this,void 0,void 0,function(){var n;return vo(this,function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Us(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=put(e),[4,this.renderStack(n)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}})})},t}(FU),Sut=function(r){return r instanceof tU||r instanceof Z4?!0:r instanceof Jx&&r.type!==I1&&r.type!==T1},Tut=function(r,t){switch(r){case 0:return R1(t);case 2:return cut(t);case 1:default:return O1(t)}},Iut=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},Fut=["-apple-system","system-ui"],Lut=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(t){return Fut.indexOf(t)===-1}):r},Put=function(r){dc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=n,i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),i}return t.prototype.render=function(e){return ko(this,void 0,void 0,function(){var n,i;return vo(this,function(s){switch(s.label){case 0:return n=Wx(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,Mut(n)];case 1:return i=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Us(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},t}(FU),Mut=function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){t(n)},n.onerror=e,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Uut=function(){function r(t){var e=t.id,n=t.enabled;this.id=e,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,Wy([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,Wy([this.id,this.getTime()+"ms"],t))},r.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,Wy([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,Wy([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.instances={},r}(),Rut=function(){function r(t,e){var n;this.windowBounds=e,this.instanceName="#"+r.instanceCount++,this.logger=new Uut({id:this.instanceName,enabled:t.logging}),this.cache=(n=t.cache)!==null&&n!==void 0?n:new eut(this,t)}return r.instanceCount=1,r}(),Out=function(r,t){return t===void 0&&(t={}),Dut(r,t)};typeof window<"u"&&bU.setContext(window);var Dut=function(r,t){return ko(void 0,void 0,void 0,function(){var e,n,i,s,a,o,h,f,m,b,x,B,P,R,Q,z,G,X,et,pt,mt,gt,mt,ft,Mt,Lt,at,ct,wt,_t,Jt,Yt,ee,$t,ne,re,Be,it,bt,Pt;return vo(this,function(Ot){switch(Ot.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(e=r.ownerDocument,!e)throw new Error("Element is not attached to a Document");if(n=e.defaultView,!n)throw new Error("Document is not attached to a Window");return i={allowTaint:(ft=t.allowTaint)!==null&&ft!==void 0?ft:!1,imageTimeout:(Mt=t.imageTimeout)!==null&&Mt!==void 0?Mt:15e3,proxy:t.proxy,useCORS:(Lt=t.useCORS)!==null&&Lt!==void 0?Lt:!1},s=fx({logging:(at=t.logging)!==null&&at!==void 0?at:!0,cache:t.cache},i),a={windowWidth:(ct=t.windowWidth)!==null&&ct!==void 0?ct:n.innerWidth,windowHeight:(wt=t.windowHeight)!==null&&wt!==void 0?wt:n.innerHeight,scrollX:(_t=t.scrollX)!==null&&_t!==void 0?_t:n.pageXOffset,scrollY:(Jt=t.scrollY)!==null&&Jt!==void 0?Jt:n.pageYOffset},o=new $u(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),h=new Rut(s,o),f=(Yt=t.foreignObjectRendering)!==null&&Yt!==void 0?Yt:!1,m={allowTaint:(ee=t.allowTaint)!==null&&ee!==void 0?ee:!1,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:f,copyStyles:f},h.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),b=new _U(h,r,m),x=b.clonedReferenceElement,x?[4,b.toIFrame(e,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return B=Ot.sent(),P=Zx(x)||Nct(x)?fst(x.ownerDocument):$y(h,x),R=P.width,Q=P.height,z=P.left,G=P.top,X=Nut(h,x,t.backgroundColor),et={canvas:t.canvas,backgroundColor:X,scale:(ne=($t=t.scale)!==null&&$t!==void 0?$t:n.devicePixelRatio)!==null&&ne!==void 0?ne:1,x:((re=t.x)!==null&&re!==void 0?re:0)+z,y:((Be=t.y)!==null&&Be!==void 0?Be:0)+G,width:(it=t.width)!==null&&it!==void 0?it:Math.ceil(R),height:(bt=t.height)!==null&&bt!==void 0?bt:Math.ceil(Q)},f?(h.logger.debug("Document cloned, using foreign object rendering"),mt=new Put(h,et),[4,mt.render(x)]):[3,3];case 2:return pt=Ot.sent(),[3,5];case 3:return h.logger.debug("Document cloned, element located at "+z+","+G+" with size "+R+"x"+Q+" using computed rendering"),h.logger.debug("Starting DOM parsing"),gt=nU(h,x),X===gt.styles.backgroundColor&&(gt.styles.backgroundColor=Ju.TRANSPARENT),h.logger.debug("Starting renderer for element at "+et.x+","+et.y+" with size "+et.width+"x"+et.height),mt=new Eut(h,et),[4,mt.render(gt)];case 4:pt=Ot.sent(),Ot.label=5;case 5:return(!((Pt=t.removeContainer)!==null&&Pt!==void 0)||Pt)&&(_U.destroy(B)||h.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),h.logger.debug("Finished rendering"),[2,pt]}})})},Nut=function(r,t,e){var n=t.ownerDocument,i=n.documentElement?cm(r,getComputedStyle(n.documentElement).backgroundColor):Ju.TRANSPARENT,s=n.body?cm(r,getComputedStyle(n.body).backgroundColor):Ju.TRANSPARENT,a=typeof e=="string"?cm(r,e):e===null?Ju.TRANSPARENT:4294967295;return t===n.documentElement?th(i)?th(s)?a:s:i:a};const kut=Object.freeze(Object.defineProperty({__proto__:null,default:Out},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.5.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.5.3/LICENSE */function ih(r){"@babel/helpers - typeof";return ih=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ih(r)}function cB(r,t){return cB=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},cB(r,t)}function Qut(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function H1(r,t,e){return Qut()?H1=Reflect.construct:H1=function(n,i,s){var a=[null];a.push.apply(a,i);var o=Function.bind.apply(n,a),h=new o;return s&&cB(h,s.prototype),h},H1.apply(null,arguments)}function pc(r){return Hut(r)||zut(r)||Vut(r)||Gut()}function Hut(r){if(Array.isArray(r))return uB(r)}function zut(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Vut(r,t){if(r){if(typeof r=="string")return uB(r,t);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set")return Array.from(r);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return uB(r,t)}}function uB(r,t){(t==null||t>r.length)&&(t=r.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=r[e];return n}function Gut(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var jut=Object.hasOwnProperty,LU=Object.setPrototypeOf,qut=Object.isFrozen,Kut=Object.getPrototypeOf,Wut=Object.getOwnPropertyDescriptor,zo=Object.freeze,Sl=Object.seal,$ut=Object.create,PU=typeof Reflect<"u"&&Reflect,z1=PU.apply,AB=PU.construct;z1||(z1=function(r,t,e){return r.apply(t,e)}),zo||(zo=function(r){return r}),Sl||(Sl=function(r){return r}),AB||(AB=function(r,t){return H1(r,pc(t))});var Xut=Va(Array.prototype.forEach),MU=Va(Array.prototype.pop),gm=Va(Array.prototype.push),V1=Va(String.prototype.toLowerCase),hB=Va(String.prototype.toString),UU=Va(String.prototype.match),gc=Va(String.prototype.replace),Jut=Va(String.prototype.indexOf),Yut=Va(String.prototype.trim),Js=Va(RegExp.prototype.test),dB=Zut(TypeError),RU=Va(Number.isNaN);function Va(r){return function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return z1(r,t,n)}}function Zut(r){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return AB(r,e)}}function hn(r,t,e){var n;e=(n=e)!==null&&n!==void 0?n:V1,LU&&LU(r,null);for(var i=t.length;i--;){var s=t[i];if(typeof s=="string"){var a=e(s);a!==s&&(qut(t)||(t[i]=a),s=a)}r[s]=!0}return r}function cd(r){var t=$ut(null),e;for(e in r)z1(jut,r,[e])===!0&&(t[e]=r[e]);return t}function G1(r,t){for(;r!==null;){var e=Wut(r,t);if(e){if(e.get)return Va(e.get);if(typeof e.value=="function")return Va(e.value)}r=Kut(r)}function n(i){return console.warn("fallback value for",i),null}return n}var OU=zo(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),fB=zo(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),pB=zo(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),tAt=zo(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),gB=zo(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),eAt=zo(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),DU=zo(["#text"]),NU=zo(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),mB=zo(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),kU=zo(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),j1=zo(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),rAt=Sl(/\{\{[\w\W]*|[\w\W]*\}\}/gm),nAt=Sl(/<%[\w\W]*|[\w\W]*%>/gm),iAt=Sl(/\${[\w\W]*}/gm),sAt=Sl(/^data-[\-\w.\u00B7-\uFFFF]/),oAt=Sl(/^aria-[\-\w]+$/),aAt=Sl(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),lAt=Sl(/^(?:\w+script|data):/i),cAt=Sl(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),uAt=Sl(/^html$/i),AAt=Sl(/^[a-z][.\w]*(-[.\w]+)+$/i),hAt=function(){return typeof window>"u"?null:window},dAt=function(r,t){if(ih(r)!=="object"||typeof r.createPolicy!="function")return null;var e=null,n="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(n)&&(e=t.currentScript.getAttribute(n));var i="dompurify"+(e?"#"+e:"");try{return r.createPolicy(i,{createHTML:function(s){return s},createScriptURL:function(s){return s}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function QU(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hAt(),t=function(Rt){return QU(Rt)};if(t.version="2.5.3",t.removed=[],!r||!r.document||r.document.nodeType!==9)return t.isSupported=!1,t;var e=r.document,n=r.document,i=r.DocumentFragment,s=r.HTMLTemplateElement,a=r.Node,o=r.Element,h=r.NodeFilter,f=r.NamedNodeMap,m=f===void 0?r.NamedNodeMap||r.MozNamedAttrMap:f,b=r.HTMLFormElement,x=r.DOMParser,B=r.trustedTypes,P=o.prototype,R=G1(P,"cloneNode"),Q=G1(P,"nextSibling"),z=G1(P,"childNodes"),G=G1(P,"parentNode");if(typeof s=="function"){var X=n.createElement("template");X.content&&X.content.ownerDocument&&(n=X.content.ownerDocument)}var et=dAt(B,e),pt=et?et.createHTML(""):"",gt=n,mt=gt.implementation,ft=gt.createNodeIterator,Mt=gt.createDocumentFragment,Lt=gt.getElementsByTagName,at=e.importNode,ct={};try{ct=cd(n).documentMode?n.documentMode:{}}catch{}var wt={};t.isSupported=typeof G=="function"&&mt&&mt.createHTMLDocument!==void 0&&ct!==9;var _t=rAt,Jt=nAt,Yt=iAt,ee=sAt,$t=oAt,ne=lAt,re=cAt,Be=AAt,it=aAt,bt=null,Pt=hn({},[].concat(pc(OU),pc(fB),pc(pB),pc(gB),pc(DU))),Ot=null,qt=hn({},[].concat(pc(NU),pc(mB),pc(kU),pc(j1))),Gt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),oe=null,ie=null,Ce=!0,Fe=!0,Re=!1,Ne=!0,ke=!1,fe=!0,lt=!1,pr=!1,er=!1,pe=!1,we=!1,Ie=!1,Oe=!0,nr=!1,hr="user-content-",Sr=!0,Mr=!1,kr={},ye=null,or=hn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),xr=null,De=hn({},["audio","video","img","source","image","track"]),pn=null,ge=hn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),yr="http://www.w3.org/1998/Math/MathML",je="http://www.w3.org/2000/svg",Rr="http://www.w3.org/1999/xhtml",cn=Rr,He=!1,Kn=null,sn=hn({},[yr,je,Rr],hB),Jr,Bt=["application/xhtml+xml","text/html"],Z="text/html",J,st=null,Ft=255,Nt=n.createElement("form"),Ht=function(Rt){return Rt instanceof RegExp||Rt instanceof Function},jt=function(Rt){st&&st===Rt||((!Rt||ih(Rt)!=="object")&&(Rt={}),Rt=cd(Rt),Jr=Bt.indexOf(Rt.PARSER_MEDIA_TYPE)===-1?Jr=Z:Jr=Rt.PARSER_MEDIA_TYPE,J=Jr==="application/xhtml+xml"?hB:V1,bt="ALLOWED_TAGS"in Rt?hn({},Rt.ALLOWED_TAGS,J):Pt,Ot="ALLOWED_ATTR"in Rt?hn({},Rt.ALLOWED_ATTR,J):qt,Kn="ALLOWED_NAMESPACES"in Rt?hn({},Rt.ALLOWED_NAMESPACES,hB):sn,pn="ADD_URI_SAFE_ATTR"in Rt?hn(cd(ge),Rt.ADD_URI_SAFE_ATTR,J):ge,xr="ADD_DATA_URI_TAGS"in Rt?hn(cd(De),Rt.ADD_DATA_URI_TAGS,J):De,ye="FORBID_CONTENTS"in Rt?hn({},Rt.FORBID_CONTENTS,J):or,oe="FORBID_TAGS"in Rt?hn({},Rt.FORBID_TAGS,J):{},ie="FORBID_ATTR"in Rt?hn({},Rt.FORBID_ATTR,J):{},kr="USE_PROFILES"in Rt?Rt.USE_PROFILES:!1,Ce=Rt.ALLOW_ARIA_ATTR!==!1,Fe=Rt.ALLOW_DATA_ATTR!==!1,Re=Rt.ALLOW_UNKNOWN_PROTOCOLS||!1,Ne=Rt.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ke=Rt.SAFE_FOR_TEMPLATES||!1,fe=Rt.SAFE_FOR_XML!==!1,lt=Rt.WHOLE_DOCUMENT||!1,pe=Rt.RETURN_DOM||!1,we=Rt.RETURN_DOM_FRAGMENT||!1,Ie=Rt.RETURN_TRUSTED_TYPE||!1,er=Rt.FORCE_BODY||!1,Oe=Rt.SANITIZE_DOM!==!1,nr=Rt.SANITIZE_NAMED_PROPS||!1,Sr=Rt.KEEP_CONTENT!==!1,Mr=Rt.IN_PLACE||!1,it=Rt.ALLOWED_URI_REGEXP||it,cn=Rt.NAMESPACE||Rr,Gt=Rt.CUSTOM_ELEMENT_HANDLING||{},Rt.CUSTOM_ELEMENT_HANDLING&&Ht(Rt.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Gt.tagNameCheck=Rt.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Rt.CUSTOM_ELEMENT_HANDLING&&Ht(Rt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Gt.attributeNameCheck=Rt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Rt.CUSTOM_ELEMENT_HANDLING&&typeof Rt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Gt.allowCustomizedBuiltInElements=Rt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ke&&(Fe=!1),we&&(pe=!0),kr&&(bt=hn({},pc(DU)),Ot=[],kr.html===!0&&(hn(bt,OU),hn(Ot,NU)),kr.svg===!0&&(hn(bt,fB),hn(Ot,mB),hn(Ot,j1)),kr.svgFilters===!0&&(hn(bt,pB),hn(Ot,mB),hn(Ot,j1)),kr.mathMl===!0&&(hn(bt,gB),hn(Ot,kU),hn(Ot,j1))),Rt.ADD_TAGS&&(bt===Pt&&(bt=cd(bt)),hn(bt,Rt.ADD_TAGS,J)),Rt.ADD_ATTR&&(Ot===qt&&(Ot=cd(Ot)),hn(Ot,Rt.ADD_ATTR,J)),Rt.ADD_URI_SAFE_ATTR&&hn(pn,Rt.ADD_URI_SAFE_ATTR,J),Rt.FORBID_CONTENTS&&(ye===or&&(ye=cd(ye)),hn(ye,Rt.FORBID_CONTENTS,J)),Sr&&(bt["#text"]=!0),lt&&hn(bt,["html","head","body"]),bt.table&&(hn(bt,["tbody"]),delete oe.tbody),zo&&zo(Rt),st=Rt)},Tt=hn({},["mi","mo","mn","ms","mtext"]),Xt=hn({},["foreignobject","annotation-xml"]),_e=hn({},["title","style","font","a","script"]),ue=hn({},fB);hn(ue,pB),hn(ue,tAt);var Ae=hn({},gB);hn(Ae,eAt);var ze=function(Rt){var qe=G(Rt);(!qe||!qe.tagName)&&(qe={namespaceURI:cn,tagName:"template"});var Te=V1(Rt.tagName),lr=V1(qe.tagName);return Kn[Rt.namespaceURI]?Rt.namespaceURI===je?qe.namespaceURI===Rr?Te==="svg":qe.namespaceURI===yr?Te==="svg"&&(lr==="annotation-xml"||Tt[lr]):!!ue[Te]:Rt.namespaceURI===yr?qe.namespaceURI===Rr?Te==="math":qe.namespaceURI===je?Te==="math"&&Xt[lr]:!!Ae[Te]:Rt.namespaceURI===Rr?qe.namespaceURI===je&&!Xt[lr]||qe.namespaceURI===yr&&!Tt[lr]?!1:!Ae[Te]&&(_e[Te]||!ue[Te]):!!(Jr==="application/xhtml+xml"&&Kn[Rt.namespaceURI]):!1},Ve=function(Rt){gm(t.removed,{element:Rt});try{Rt.parentNode.removeChild(Rt)}catch{try{Rt.outerHTML=pt}catch{Rt.remove()}}},Er=function(Rt,qe){try{gm(t.removed,{attribute:qe.getAttributeNode(Rt),from:qe})}catch{gm(t.removed,{attribute:null,from:qe})}if(qe.removeAttribute(Rt),Rt==="is"&&!Ot[Rt])if(pe||we)try{Ve(qe)}catch{}else try{qe.setAttribute(Rt,"")}catch{}},_r=function(Rt){var qe,Te;if(er)Rt="<remove></remove>"+Rt;else{var lr=UU(Rt,/^[\r\n\t ]+/);Te=lr&&lr[0]}Jr==="application/xhtml+xml"&&cn===Rr&&(Rt='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Rt+"</body></html>");var Or=et?et.createHTML(Rt):Rt;if(cn===Rr)try{qe=new x().parseFromString(Or,Jr)}catch{}if(!qe||!qe.documentElement){qe=mt.createDocument(cn,"template",null);try{qe.documentElement.innerHTML=He?pt:Or}catch{}}var Fn=qe.body||qe.documentElement;return Rt&&Te&&Fn.insertBefore(n.createTextNode(Te),Fn.childNodes[0]||null),cn===Rr?Lt.call(qe,lt?"html":"body")[0]:lt?qe.documentElement:Fn},Ur=function(Rt){return ft.call(Rt.ownerDocument||Rt,Rt,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null,!1)},Vr=function(Rt){return Rt instanceof b&&(typeof Rt.__depth<"u"&&typeof Rt.__depth!="number"||typeof Rt.__removalCount<"u"&&typeof Rt.__removalCount!="number"||typeof Rt.nodeName!="string"||typeof Rt.textContent!="string"||typeof Rt.removeChild!="function"||!(Rt.attributes instanceof m)||typeof Rt.removeAttribute!="function"||typeof Rt.setAttribute!="function"||typeof Rt.namespaceURI!="string"||typeof Rt.insertBefore!="function"||typeof Rt.hasChildNodes!="function")},Gr=function(Rt){return ih(a)==="object"?Rt instanceof a:Rt&&ih(Rt)==="object"&&typeof Rt.nodeType=="number"&&typeof Rt.nodeName=="string"},Zr=function(Rt,qe,Te){wt[Rt]&&Xut(wt[Rt],function(lr){lr.call(t,qe,Te,st)})},vr=function(Rt){var qe;if(Zr("beforeSanitizeElements",Rt,null),Vr(Rt)||Js(/[\u0080-\uFFFF]/,Rt.nodeName))return Ve(Rt),!0;var Te=J(Rt.nodeName);if(Zr("uponSanitizeElement",Rt,{tagName:Te,allowedTags:bt}),Rt.hasChildNodes()&&!Gr(Rt.firstElementChild)&&(!Gr(Rt.content)||!Gr(Rt.content.firstElementChild))&&Js(/<[/\w]/g,Rt.innerHTML)&&Js(/<[/\w]/g,Rt.textContent)||Te==="select"&&Js(/<template/i,Rt.innerHTML)||Rt.nodeType===7||fe&&Rt.nodeType===8&&Js(/<[/\w]/g,Rt.data))return Ve(Rt),!0;if(!bt[Te]||oe[Te]){if(!oe[Te]&&_n(Te)&&(Gt.tagNameCheck instanceof RegExp&&Js(Gt.tagNameCheck,Te)||Gt.tagNameCheck instanceof Function&&Gt.tagNameCheck(Te)))return!1;if(Sr&&!ye[Te]){var lr=G(Rt)||Rt.parentNode,Or=z(Rt)||Rt.childNodes;if(Or&&lr)for(var Fn=Or.length,jr=Fn-1;jr>=0;--jr){var gn=R(Or[jr],!0);gn.__removalCount=(Rt.__removalCount||0)+1,lr.insertBefore(gn,Q(Rt))}}return Ve(Rt),!0}return Rt instanceof o&&!ze(Rt)||(Te==="noscript"||Te==="noembed"||Te==="noframes")&&Js(/<\/no(script|embed|frames)/i,Rt.innerHTML)?(Ve(Rt),!0):(ke&&Rt.nodeType===3&&(qe=Rt.textContent,qe=gc(qe,_t," "),qe=gc(qe,Jt," "),qe=gc(qe,Yt," "),Rt.textContent!==qe&&(gm(t.removed,{element:Rt.cloneNode()}),Rt.textContent=qe)),Zr("afterSanitizeElements",Rt,null),!1)},Wr=function(Rt,qe,Te){if(Oe&&(qe==="id"||qe==="name")&&(Te in n||Te in Nt||Te==="__depth"||Te==="__removalCount"))return!1;if(!(Fe&&!ie[qe]&&Js(ee,qe))&&!(Ce&&Js($t,qe))){if(!Ot[qe]||ie[qe]){if(!(_n(Rt)&&(Gt.tagNameCheck instanceof RegExp&&Js(Gt.tagNameCheck,Rt)||Gt.tagNameCheck instanceof Function&&Gt.tagNameCheck(Rt))&&(Gt.attributeNameCheck instanceof RegExp&&Js(Gt.attributeNameCheck,qe)||Gt.attributeNameCheck instanceof Function&&Gt.attributeNameCheck(qe))||qe==="is"&&Gt.allowCustomizedBuiltInElements&&(Gt.tagNameCheck instanceof RegExp&&Js(Gt.tagNameCheck,Te)||Gt.tagNameCheck instanceof Function&&Gt.tagNameCheck(Te))))return!1}else if(!pn[qe]&&!Js(it,gc(Te,re,""))&&!((qe==="src"||qe==="xlink:href"||qe==="href")&&Rt!=="script"&&Jut(Te,"data:")===0&&xr[Rt])&&!(Re&&!Js(ne,gc(Te,re,"")))&&Te)return!1}return!0},_n=function(Rt){return Rt!=="annotation-xml"&&UU(Rt,Be)},Rn=function(Rt){var qe,Te,lr,Or;Zr("beforeSanitizeAttributes",Rt,null);var Fn=Rt.attributes;if(Fn){var jr={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ot};for(Or=Fn.length;Or--;){qe=Fn[Or];var gn=qe,Wn=gn.name,mn=gn.namespaceURI;if(Te=Wn==="value"?qe.value:Yut(qe.value),lr=J(Wn),jr.attrName=lr,jr.attrValue=Te,jr.keepAttr=!0,jr.forceKeepAttr=void 0,Zr("uponSanitizeAttribute",Rt,jr),Te=jr.attrValue,!jr.forceKeepAttr&&(Er(Wn,Rt),!!jr.keepAttr)){if(!Ne&&Js(/\/>/i,Te)){Er(Wn,Rt);continue}if(fe&&Js(/((--!?|])>)|<\/(style|title)/i,Te)){Er(Wn,Rt);continue}ke&&(Te=gc(Te,_t," "),Te=gc(Te,Jt," "),Te=gc(Te,Yt," "));var on=J(Rt.nodeName);if(Wr(on,lr,Te)){if(nr&&(lr==="id"||lr==="name")&&(Er(Wn,Rt),Te=hr+Te),et&&ih(B)==="object"&&typeof B.getAttributeType=="function"&&!mn)switch(B.getAttributeType(on,lr)){case"TrustedHTML":{Te=et.createHTML(Te);break}case"TrustedScriptURL":{Te=et.createScriptURL(Te);break}}try{mn?Rt.setAttributeNS(mn,Wn,Te):Rt.setAttribute(Wn,Te),Vr(Rt)?Ve(Rt):MU(t.removed)}catch{}}}}Zr("afterSanitizeAttributes",Rt,null)}},Zn=function Rt(qe){var Te,lr=Ur(qe);for(Zr("beforeSanitizeShadowDOM",qe,null);Te=lr.nextNode();)if(Zr("uponSanitizeShadowNode",Te,null),!vr(Te)){var Or=G(Te);Te.nodeType===1&&(Or&&Or.__depth?Te.__depth=(Te.__removalCount||0)+Or.__depth+1:Te.__depth=1),(Te.__depth>=Ft||RU(Te.__depth))&&Ve(Te),Te.content instanceof i&&(Te.content.__depth=Te.__depth,Rt(Te.content)),Rn(Te)}Zr("afterSanitizeShadowDOM",qe,null)};return t.sanitize=function(Rt){var qe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Te,lr,Or,Fn,jr;if(He=!Rt,He&&(Rt="<!-->"),typeof Rt!="string"&&!Gr(Rt))if(typeof Rt.toString=="function"){if(Rt=Rt.toString(),typeof Rt!="string")throw dB("dirty is not a string, aborting")}else throw dB("toString is not a function");if(!t.isSupported){if(ih(r.toStaticHTML)==="object"||typeof r.toStaticHTML=="function"){if(typeof Rt=="string")return r.toStaticHTML(Rt);if(Gr(Rt))return r.toStaticHTML(Rt.outerHTML)}return Rt}if(pr||jt(qe),t.removed=[],typeof Rt=="string"&&(Mr=!1),Mr){if(Rt.nodeName){var gn=J(Rt.nodeName);if(!bt[gn]||oe[gn])throw dB("root node is forbidden and cannot be sanitized in-place")}}else if(Rt instanceof a)Te=_r("<!---->"),lr=Te.ownerDocument.importNode(Rt,!0),lr.nodeType===1&&lr.nodeName==="BODY"||lr.nodeName==="HTML"?Te=lr:Te.appendChild(lr);else{if(!pe&&!ke&&!lt&&Rt.indexOf("<")===-1)return et&&Ie?et.createHTML(Rt):Rt;if(Te=_r(Rt),!Te)return pe?null:Ie?pt:""}Te&&er&&Ve(Te.firstChild);for(var Wn=Ur(Mr?Rt:Te);Or=Wn.nextNode();)if(!(Or.nodeType===3&&Or===Fn)&&!vr(Or)){var mn=G(Or);Or.nodeType===1&&(mn&&mn.__depth?Or.__depth=(Or.__removalCount||0)+mn.__depth+1:Or.__depth=1),(Or.__depth>=Ft||RU(Or.__depth))&&Ve(Or),Or.content instanceof i&&(Or.content.__depth=Or.__depth,Zn(Or.content)),Rn(Or),Fn=Or}if(Fn=null,Mr)return Rt;if(pe){if(we)for(jr=Mt.call(Te.ownerDocument);Te.firstChild;)jr.appendChild(Te.firstChild);else jr=Te;return(Ot.shadowroot||Ot.shadowrootmod)&&(jr=at.call(e,jr,!0)),jr}var on=lt?Te.outerHTML:Te.innerHTML;return lt&&bt["!doctype"]&&Te.ownerDocument&&Te.ownerDocument.doctype&&Te.ownerDocument.doctype.name&&Js(uAt,Te.ownerDocument.doctype.name)&&(on="<!DOCTYPE "+Te.ownerDocument.doctype.name+`>
`+on),ke&&(on=gc(on,_t," "),on=gc(on,Jt," "),on=gc(on,Yt," ")),et&&Ie?et.createHTML(on):on},t.setConfig=function(Rt){jt(Rt),pr=!0},t.clearConfig=function(){st=null,pr=!1},t.isValidAttribute=function(Rt,qe,Te){st||jt({});var lr=J(Rt),Or=J(qe);return Wr(lr,Or,Te)},t.addHook=function(Rt,qe){typeof qe=="function"&&(wt[Rt]=wt[Rt]||[],gm(wt[Rt],qe))},t.removeHook=function(Rt){if(wt[Rt])return MU(wt[Rt])},t.removeHooks=function(Rt){wt[Rt]&&(wt[Rt]=[])},t.removeAllHooks=function(){wt={}},t}var fAt=QU();const pAt=Object.freeze(Object.defineProperty({__proto__:null,default:fAt},Symbol.toStringTag,{value:"Module"}));var ep=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function HU(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var mm=function(r){return r&&r.Math===Math&&r},rs=mm(typeof globalThis=="object"&&globalThis)||mm(typeof window=="object"&&window)||mm(typeof self=="object"&&self)||mm(typeof ep=="object"&&ep)||mm(typeof ep=="object"&&ep)||function(){return this}()||Function("return this")(),ym={},ns=function(r){try{return!!r()}catch{return!0}},gAt=ns,mc=!gAt(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),mAt=ns,q1=!mAt(function(){var r=(function(){}).bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),yAt=q1,K1=Function.prototype.call,Ys=yAt?K1.bind(K1):function(){return K1.apply(K1,arguments)},zU={},VU={}.propertyIsEnumerable,GU=Object.getOwnPropertyDescriptor,_At=GU&&!VU.call({1:2},1);zU.f=_At?function(r){var t=GU(this,r);return!!t&&t.enumerable}:VU;var yB=function(r,t){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:t}},jU=q1,qU=Function.prototype,_B=qU.call,vAt=jU&&qU.bind.bind(_B,_B),is=jU?vAt:function(r){return function(){return _B.apply(r,arguments)}},KU=is,bAt=KU({}.toString),wAt=KU("".slice),ud=function(r){return wAt(bAt(r),8,-1)},xAt=is,BAt=ns,CAt=ud,vB=Object,EAt=xAt("".split),WU=BAt(function(){return!vB("z").propertyIsEnumerable(0)})?function(r){return CAt(r)==="String"?EAt(r,""):vB(r)}:vB,Ad=function(r){return r==null},SAt=Ad,TAt=TypeError,yc=function(r){if(SAt(r))throw new TAt("Can't call method on "+r);return r},IAt=WU,FAt=yc,_m=function(r){return IAt(FAt(r))},bB=typeof document=="object"&&document.all,ss=typeof bB>"u"&&bB!==void 0?function(r){return typeof r=="function"||r===bB}:function(r){return typeof r=="function"},LAt=ss,_c=function(r){return typeof r=="object"?r!==null:LAt(r)},wB=rs,PAt=ss,MAt=function(r){return PAt(r)?r:void 0},hd=function(r,t){return arguments.length<2?MAt(wB[r]):wB[r]&&wB[r][t]},UAt=is,W1=UAt({}.isPrototypeOf),$1=typeof navigator<"u"&&String(navigator.userAgent)||"",$U=rs,xB=$1,XU=$U.process,JU=$U.Deno,YU=XU&&XU.versions||JU&&JU.version,ZU=YU&&YU.v8,vc,X1;ZU&&(vc=ZU.split("."),X1=vc[0]>0&&vc[0]<4?1:+(vc[0]+vc[1])),!X1&&xB&&(vc=xB.match(/Edge\/(\d+)/),(!vc||vc[1]>=74)&&(vc=xB.match(/Chrome\/(\d+)/),vc&&(X1=+vc[1])));var BB=X1,tR=BB,RAt=ns,OAt=rs,DAt=OAt.String,eR=!!Object.getOwnPropertySymbols&&!RAt(function(){var r=Symbol("symbol detection");return!DAt(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&tR&&tR<41}),NAt=eR,rR=NAt&&!Symbol.sham&&typeof Symbol.iterator=="symbol",kAt=hd,QAt=ss,HAt=W1,zAt=rR,VAt=Object,nR=zAt?function(r){return typeof r=="symbol"}:function(r){var t=kAt("Symbol");return QAt(t)&&HAt(t.prototype,VAt(r))},GAt=String,J1=function(r){try{return GAt(r)}catch{return"Object"}},jAt=ss,qAt=J1,KAt=TypeError,Zu=function(r){if(jAt(r))return r;throw new KAt(qAt(r)+" is not a function")},WAt=Zu,$At=Ad,rp=function(r,t){var e=r[t];return $At(e)?void 0:WAt(e)},CB=Ys,EB=ss,SB=_c,XAt=TypeError,JAt=function(r,t){var e,n;if(t==="string"&&EB(e=r.toString)&&!SB(n=CB(e,r))||EB(e=r.valueOf)&&!SB(n=CB(e,r))||t!=="string"&&EB(e=r.toString)&&!SB(n=CB(e,r)))return n;throw new XAt("Can't convert object to primitive value")},iR={exports:{}},sR=rs,YAt=Object.defineProperty,TB=function(r,t){try{YAt(sR,r,{value:t,configurable:!0,writable:!0})}catch{sR[r]=t}return t},ZAt=rs,tht=TB,oR="__core-js_shared__",aR=iR.exports=ZAt[oR]||tht(oR,{});(aR.versions||(aR.versions=[])).push({version:"3.37.0",mode:"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.0/LICENSE",source:"https://github.com/zloirock/core-js"});var IB=iR.exports,lR=IB,FB=function(r,t){return lR[r]||(lR[r]=t||{})},eht=yc,rht=Object,Y1=function(r){return rht(eht(r))},nht=is,iht=Y1,sht=nht({}.hasOwnProperty),bc=Object.hasOwn||function(r,t){return sht(iht(r),t)},oht=is,aht=0,lht=Math.random(),cht=oht(1 .toString),cR=function(r){return"Symbol("+(r===void 0?"":r)+")_"+cht(++aht+lht,36)},uht=rs,Aht=FB,uR=bc,hht=cR,dht=eR,fht=rR,np=uht.Symbol,LB=Aht("wks"),pht=fht?np.for||np:np&&np.withoutSetter||hht,Rs=function(r){return uR(LB,r)||(LB[r]=dht&&uR(np,r)?np[r]:pht("Symbol."+r)),LB[r]},ght=Ys,AR=_c,hR=nR,mht=rp,yht=JAt,_ht=Rs,vht=TypeError,bht=_ht("toPrimitive"),wht=function(r,t){if(!AR(r)||hR(r))return r;var e=mht(r,bht),n;if(e){if(t===void 0&&(t="default"),n=ght(e,r,t),!AR(n)||hR(n))return n;throw new vht("Can't convert object to primitive value")}return t===void 0&&(t="number"),yht(r,t)},xht=wht,Bht=nR,dR=function(r){var t=xht(r,"string");return Bht(t)?t:t+""},Cht=rs,fR=_c,PB=Cht.document,Eht=fR(PB)&&fR(PB.createElement),Z1=function(r){return Eht?PB.createElement(r):{}},Sht=mc,Tht=ns,Iht=Z1,pR=!Sht&&!Tht(function(){return Object.defineProperty(Iht("div"),"a",{get:function(){return 7}}).a!==7}),Fht=mc,Lht=Ys,Pht=zU,Mht=yB,Uht=_m,Rht=dR,Oht=bc,Dht=pR,gR=Object.getOwnPropertyDescriptor;ym.f=Fht?gR:function(r,t){if(r=Uht(r),t=Rht(t),Dht)try{return gR(r,t)}catch{}if(Oht(r,t))return Mht(!Lht(Pht.f,r,t),r[t])};var tA={},Nht=mc,kht=ns,mR=Nht&&kht(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Qht=_c,Hht=String,zht=TypeError,Vo=function(r){if(Qht(r))return r;throw new zht(Hht(r)+" is not an object")},Vht=mc,Ght=pR,jht=mR,t_=Vo,yR=dR,qht=TypeError,MB=Object.defineProperty,Kht=Object.getOwnPropertyDescriptor,UB="enumerable",RB="configurable",OB="writable";tA.f=Vht?jht?function(r,t,e){if(t_(r),t=yR(t),t_(e),typeof r=="function"&&t==="prototype"&&"value"in e&&OB in e&&!e[OB]){var n=Kht(r,t);n&&n[OB]&&(r[t]=e.value,e={configurable:RB in e?e[RB]:n[RB],enumerable:UB in e?e[UB]:n[UB],writable:!1})}return MB(r,t,e)}:MB:function(r,t,e){if(t_(r),t=yR(t),t_(e),Ght)try{return MB(r,t,e)}catch{}if("get"in e||"set"in e)throw new qht("Accessors not supported");return"value"in e&&(r[t]=e.value),r};var Wht=mc,$ht=tA,Xht=yB,vm=Wht?function(r,t,e){return $ht.f(r,t,Xht(1,e))}:function(r,t,e){return r[t]=e,r},_R={exports:{}},DB=mc,Jht=bc,vR=Function.prototype,Yht=DB&&Object.getOwnPropertyDescriptor,NB=Jht(vR,"name"),Zht=NB&&(function(){}).name==="something",tdt=NB&&(!DB||DB&&Yht(vR,"name").configurable),e_={EXISTS:NB,PROPER:Zht,CONFIGURABLE:tdt},edt=is,rdt=ss,kB=IB,ndt=edt(Function.toString);rdt(kB.inspectSource)||(kB.inspectSource=function(r){return ndt(r)});var QB=kB.inspectSource,idt=rs,sdt=ss,bR=idt.WeakMap,odt=sdt(bR)&&/native code/.test(String(bR)),adt=FB,ldt=cR,wR=adt("keys"),HB=function(r){return wR[r]||(wR[r]=ldt(r))},zB={},cdt=odt,xR=rs,udt=_c,Adt=vm,VB=bc,GB=IB,hdt=HB,ddt=zB,BR="Object already initialized",jB=xR.TypeError,fdt=xR.WeakMap,r_,bm,n_,pdt=function(r){return n_(r)?bm(r):r_(r,{})},gdt=function(r){return function(t){var e;if(!udt(t)||(e=bm(t)).type!==r)throw new jB("Incompatible receiver, "+r+" required");return e}};if(cdt||GB.state){var su=GB.state||(GB.state=new fdt);su.get=su.get,su.has=su.has,su.set=su.set,r_=function(r,t){if(su.has(r))throw new jB(BR);return t.facade=r,su.set(r,t),t},bm=function(r){return su.get(r)||{}},n_=function(r){return su.has(r)}}else{var ip=hdt("state");ddt[ip]=!0,r_=function(r,t){if(VB(r,ip))throw new jB(BR);return t.facade=r,Adt(r,ip,t),t},bm=function(r){return VB(r,ip)?r[ip]:{}},n_=function(r){return VB(r,ip)}}var i_={set:r_,get:bm,has:n_,enforce:pdt,getterFor:gdt},qB=is,mdt=ns,ydt=ss,s_=bc,KB=mc,_dt=e_.CONFIGURABLE,vdt=QB,CR=i_,bdt=CR.enforce,wdt=CR.get,ER=String,o_=Object.defineProperty,xdt=qB("".slice),Bdt=qB("".replace),Cdt=qB([].join),Edt=KB&&!mdt(function(){return o_(function(){},"length",{value:8}).length!==8}),Sdt=String(String).split("String"),Tdt=_R.exports=function(r,t,e){xdt(ER(t),0,7)==="Symbol("&&(t="["+Bdt(ER(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),e&&e.getter&&(t="get "+t),e&&e.setter&&(t="set "+t),(!s_(r,"name")||_dt&&r.name!==t)&&(KB?o_(r,"name",{value:t,configurable:!0}):r.name=t),Edt&&e&&s_(e,"arity")&&r.length!==e.arity&&o_(r,"length",{value:e.arity});try{e&&s_(e,"constructor")&&e.constructor?KB&&o_(r,"prototype",{writable:!1}):r.prototype&&(r.prototype=void 0)}catch{}var n=bdt(r);return s_(n,"source")||(n.source=Cdt(Sdt,typeof t=="string"?t:"")),r};Function.prototype.toString=Tdt(function(){return ydt(this)&&wdt(this).source||vdt(this)},"toString");var SR=_R.exports,Idt=ss,Fdt=tA,Ldt=SR,Pdt=TB,dd=function(r,t,e,n){n||(n={});var i=n.enumerable,s=n.name!==void 0?n.name:t;if(Idt(e)&&Ldt(e,s,n),n.global)i?r[t]=e:Pdt(t,e);else{try{n.unsafe?r[t]&&(i=!0):delete r[t]}catch{}i?r[t]=e:Fdt.f(r,t,{value:e,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return r},TR={},Mdt=Math.ceil,Udt=Math.floor,Rdt=Math.trunc||function(r){var t=+r;return(t>0?Udt:Mdt)(t)},Odt=Rdt,a_=function(r){var t=+r;return t!==t||t===0?0:Odt(t)},Ddt=a_,Ndt=Math.max,kdt=Math.min,Qdt=function(r,t){var e=Ddt(r);return e<0?Ndt(e+t,0):kdt(e,t)},Hdt=a_,zdt=Math.min,sp=function(r){var t=Hdt(r);return t>0?zdt(t,9007199254740991):0},Vdt=sp,WB=function(r){return Vdt(r.length)},Gdt=_m,jdt=Qdt,qdt=WB,IR=function(r){return function(t,e,n){var i=Gdt(t),s=qdt(i);if(s===0)return!r&&-1;var a=jdt(n,s),o;if(r&&e!==e){for(;s>a;)if(o=i[a++],o!==o)return!0}else for(;s>a;a++)if((r||a in i)&&i[a]===e)return r||a||0;return!r&&-1}},FR={includes:IR(!0),indexOf:IR(!1)},Kdt=is,$B=bc,Wdt=_m,$dt=FR.indexOf,Xdt=zB,LR=Kdt([].push),PR=function(r,t){var e=Wdt(r),n=0,i=[],s;for(s in e)!$B(Xdt,s)&&$B(e,s)&&LR(i,s);for(;t.length>n;)$B(e,s=t[n++])&&(~$dt(i,s)||LR(i,s));return i},XB=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Jdt=PR,Ydt=XB,Zdt=Ydt.concat("length","prototype");TR.f=Object.getOwnPropertyNames||function(r){return Jdt(r,Zdt)};var MR={};MR.f=Object.getOwnPropertySymbols;var tft=hd,eft=is,rft=TR,nft=MR,ift=Vo,sft=eft([].concat),oft=tft("Reflect","ownKeys")||function(r){var t=rft.f(ift(r)),e=nft.f;return e?sft(t,e(r)):t},UR=bc,aft=oft,lft=ym,cft=tA,uft=function(r,t,e){for(var n=aft(t),i=cft.f,s=lft.f,a=0;a<n.length;a++){var o=n[a];!UR(r,o)&&!(e&&UR(e,o))&&i(r,o,s(t,o))}},Aft=ns,hft=ss,dft=/#|\.prototype\./,wm=function(r,t){var e=pft[fft(r)];return e===mft?!0:e===gft?!1:hft(t)?Aft(t):!!t},fft=wm.normalize=function(r){return String(r).replace(dft,".").toLowerCase()},pft=wm.data={},gft=wm.NATIVE="N",mft=wm.POLYFILL="P",RR=wm,l_=rs,yft=ym.f,_ft=vm,vft=dd,bft=TB,wft=uft,xft=RR,Go=function(r,t){var e=r.target,n=r.global,i=r.stat,s,a,o,h,f,m;if(n?a=l_:i?a=l_[e]||bft(e,{}):a=l_[e]&&l_[e].prototype,a)for(o in t){if(f=t[o],r.dontCallGetSet?(m=yft(a,o),h=m&&m.value):h=a[o],s=xft(n?o:e+(i?".":"#")+o,r.forced),!s&&h!==void 0){if(typeof f==typeof h)continue;wft(f,h)}(r.sham||h&&h.sham)&&_ft(f,"sham",!0),vft(a,o,f,r)}},Bft=rs,Cft=ud,xm=Cft(Bft.process)==="process",Eft=is,Sft=Zu,Tft=function(r,t,e){try{return Eft(Sft(Object.getOwnPropertyDescriptor(r,t)[e]))}catch{}},Ift=_c,Fft=function(r){return Ift(r)||r===null},Lft=Fft,Pft=String,Mft=TypeError,Uft=function(r){if(Lft(r))return r;throw new Mft("Can't set "+Pft(r)+" as a prototype")},Rft=Tft,Oft=_c,Dft=yc,Nft=Uft,OR=Object.setPrototypeOf||("__proto__"in{}?function(){var r=!1,t={},e;try{e=Rft(Object.prototype,"__proto__","set"),e(t,[]),r=t instanceof Array}catch{}return function(n,i){return Dft(n),Nft(i),Oft(n)&&(r?e(n,i):n.__proto__=i),n}}():void 0),kft=tA.f,Qft=bc,Hft=Rs,DR=Hft("toStringTag"),c_=function(r,t,e){r&&!e&&(r=r.prototype),r&&!Qft(r,DR)&&kft(r,DR,{configurable:!0,value:t})},NR=SR,zft=tA,Vft=function(r,t,e){return e.get&&NR(e.get,t,{getter:!0}),e.set&&NR(e.set,t,{setter:!0}),zft.f(r,t,e)},Gft=hd,jft=Vft,qft=Rs,Kft=mc,kR=qft("species"),Wft=function(r){var t=Gft(r);Kft&&t&&!t[kR]&&jft(t,kR,{configurable:!0,get:function(){return this}})},$ft=W1,Xft=TypeError,Jft=function(r,t){if($ft(t,r))return r;throw new Xft("Incorrect invocation")},Yft=Rs,Zft=Yft("toStringTag"),QR={};QR[Zft]="z";var tpt=String(QR)==="[object z]",ept=tpt,rpt=ss,u_=ud,npt=Rs,ipt=npt("toStringTag"),spt=Object,opt=u_(function(){return arguments}())==="Arguments",apt=function(r,t){try{return r[t]}catch{}},JB=ept?u_:function(r){var t,e,n;return r===void 0?"Undefined":r===null?"Null":typeof(e=apt(t=spt(r),ipt))=="string"?e:opt?u_(t):(n=u_(t))==="Object"&&rpt(t.callee)?"Arguments":n},lpt=is,cpt=ns,HR=ss,upt=JB,Apt=hd,hpt=QB,zR=function(){},VR=Apt("Reflect","construct"),YB=/^\s*(?:class|function)\b/,dpt=lpt(YB.exec),fpt=!YB.test(zR),Bm=function(r){if(!HR(r))return!1;try{return VR(zR,[],r),!0}catch{return!1}},GR=function(r){if(!HR(r))return!1;switch(upt(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return fpt||!!dpt(YB,hpt(r))}catch{return!0}};GR.sham=!0;var ppt=!VR||cpt(function(){var r;return Bm(Bm.call)||!Bm(Object)||!Bm(function(){r=!0})||r})?GR:Bm,gpt=ppt,mpt=J1,ypt=TypeError,_pt=function(r){if(gpt(r))return r;throw new ypt(mpt(r)+" is not a constructor")},jR=Vo,vpt=_pt,bpt=Ad,wpt=Rs,xpt=wpt("species"),qR=function(r,t){var e=jR(r).constructor,n;return e===void 0||bpt(n=jR(e)[xpt])?t:vpt(n)},Bpt=q1,KR=Function.prototype,WR=KR.apply,$R=KR.call,XR=typeof Reflect=="object"&&Reflect.apply||(Bpt?$R.bind(WR):function(){return $R.apply(WR,arguments)}),Cpt=ud,Ept=is,A_=function(r){if(Cpt(r)==="Function")return Ept(r)},JR=A_,Spt=Zu,Tpt=q1,Ipt=JR(JR.bind),ZB=function(r,t){return Spt(r),t===void 0?r:Tpt?Ipt(r,t):function(){return r.apply(t,arguments)}},Fpt=hd,YR=Fpt("document","documentElement"),Lpt=is,Ppt=Lpt([].slice),Mpt=TypeError,Upt=function(r,t){if(r<t)throw new Mpt("Not enough arguments");return r},Rpt=$1,ZR=/(?:ipad|iphone|ipod).*applewebkit/i.test(Rpt),Ga=rs,Opt=XR,Dpt=ZB,tO=ss,Npt=bc,eO=ns,rO=YR,kpt=Ppt,nO=Z1,Qpt=Upt,Hpt=ZR,zpt=xm,tC=Ga.setImmediate,eC=Ga.clearImmediate,Vpt=Ga.process,rC=Ga.Dispatch,Gpt=Ga.Function,iO=Ga.MessageChannel,jpt=Ga.String,nC=0,Cm={},sO="onreadystatechange",Em,fd,iC,sC;eO(function(){Em=Ga.location});var oC=function(r){if(Npt(Cm,r)){var t=Cm[r];delete Cm[r],t()}},aC=function(r){return function(){oC(r)}},oO=function(r){oC(r.data)},aO=function(r){Ga.postMessage(jpt(r),Em.protocol+"//"+Em.host)};(!tC||!eC)&&(tC=function(r){Qpt(arguments.length,1);var t=tO(r)?r:Gpt(r),e=kpt(arguments,1);return Cm[++nC]=function(){Opt(t,void 0,e)},fd(nC),nC},eC=function(r){delete Cm[r]},zpt?fd=function(r){Vpt.nextTick(aC(r))}:rC&&rC.now?fd=function(r){rC.now(aC(r))}:iO&&!Hpt?(iC=new iO,sC=iC.port2,iC.port1.onmessage=oO,fd=Dpt(sC.postMessage,sC)):Ga.addEventListener&&tO(Ga.postMessage)&&!Ga.importScripts&&Em&&Em.protocol!=="file:"&&!eO(aO)?(fd=aO,Ga.addEventListener("message",oO,!1)):sO in nO("script")?fd=function(r){rO.appendChild(nO("script"))[sO]=function(){rO.removeChild(this),oC(r)}}:fd=function(r){setTimeout(aC(r),0)});var lO={set:tC,clear:eC},cO=rs,qpt=mc,Kpt=Object.getOwnPropertyDescriptor,Wpt=function(r){if(!qpt)return cO[r];var t=Kpt(cO,r);return t&&t.value},uO=function(){this.head=null,this.tail=null};uO.prototype={add:function(r){var t={item:r,next:null},e=this.tail;e?e.next=t:this.head=t,this.tail=t},get:function(){var r=this.head;if(r){var t=this.head=r.next;return t===null&&(this.tail=null),r.item}}};var AO=uO,$pt=$1,Xpt=/ipad|iphone|ipod/i.test($pt)&&typeof Pebble<"u",Jpt=$1,Ypt=/web0s(?!.*chrome)/i.test(Jpt),op=rs,Zpt=Wpt,hO=ZB,lC=lO.set,tgt=AO,egt=ZR,rgt=Xpt,ngt=Ypt,cC=xm,dO=op.MutationObserver||op.WebKitMutationObserver,fO=op.document,pO=op.process,h_=op.Promise,uC=Zpt("queueMicrotask"),ap,AC,hC,d_,gO;if(!uC){var f_=new tgt,p_=function(){var r,t;for(cC&&(r=pO.domain)&&r.exit();t=f_.get();)try{t()}catch(e){throw f_.head&&ap(),e}r&&r.enter()};!egt&&!cC&&!ngt&&dO&&fO?(AC=!0,hC=fO.createTextNode(""),new dO(p_).observe(hC,{characterData:!0}),ap=function(){hC.data=AC=!AC}):!rgt&&h_&&h_.resolve?(d_=h_.resolve(void 0),d_.constructor=h_,gO=hO(d_.then,d_),ap=function(){gO(p_)}):cC?ap=function(){pO.nextTick(p_)}:(lC=hO(lC,op),ap=function(){lC(p_)}),uC=function(r){f_.head||ap(),f_.add(r)}}var igt=uC,sgt=function(r,t){try{arguments.length===1?console.error(r):console.error(r,t)}catch{}},dC=function(r){try{return{error:!1,value:r()}}catch(t){return{error:!0,value:t}}},ogt=rs,g_=ogt.Promise,mO=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",agt=mO,lgt=xm,cgt=!agt&&!lgt&&typeof window=="object"&&typeof document=="object",ugt=rs,Sm=g_,Agt=ss,hgt=RR,dgt=QB,fgt=Rs,pgt=cgt,ggt=mO,fC=BB;Sm&&Sm.prototype;var mgt=fgt("species"),pC=!1,yO=Agt(ugt.PromiseRejectionEvent),ygt=hgt("Promise",function(){var r=dgt(Sm),t=r!==String(Sm);if(!t&&fC===66)return!0;if(!fC||fC<51||!/native code/.test(r)){var e=new Sm(function(s){s(1)}),n=function(s){s(function(){},function(){})},i=e.constructor={};if(i[mgt]=n,pC=e.then(function(){})instanceof n,!pC)return!0}return!t&&(pgt||ggt)&&!yO}),Tm={CONSTRUCTOR:ygt,REJECTION_EVENT:yO,SUBCLASSING:pC},lp={},_O=Zu,_gt=TypeError,vgt=function(r){var t,e;this.promise=new r(function(n,i){if(t!==void 0||e!==void 0)throw new _gt("Bad Promise constructor");t=n,e=i}),this.resolve=_O(t),this.reject=_O(e)};lp.f=function(r){return new vgt(r)};var bgt=Go,m_=xm,sh=rs,cp=Ys,vO=dd,bO=OR,wgt=c_,xgt=Wft,Bgt=Zu,y_=ss,Cgt=_c,Egt=Jft,Sgt=qR,wO=lO.set,gC=igt,Tgt=sgt,Igt=dC,Fgt=AO,xO=i_,__=g_,mC=Tm,BO=lp,v_="Promise",CO=mC.CONSTRUCTOR,Lgt=mC.REJECTION_EVENT,Pgt=mC.SUBCLASSING,yC=xO.getterFor(v_),Mgt=xO.set,up=__&&__.prototype,pd=__,b_=up,EO=sh.TypeError,_C=sh.document,vC=sh.process,bC=BO.f,Ugt=bC,Rgt=!!(_C&&_C.createEvent&&sh.dispatchEvent),SO="unhandledrejection",Ogt="rejectionhandled",TO=0,IO=1,Dgt=2,wC=1,FO=2,w_,LO,Ngt,PO,MO=function(r){var t;return Cgt(r)&&y_(t=r.then)?t:!1},UO=function(r,t){var e=t.value,n=t.state===IO,i=n?r.ok:r.fail,s=r.resolve,a=r.reject,o=r.domain,h,f,m;try{i?(n||(t.rejection===FO&&Qgt(t),t.rejection=wC),i===!0?h=e:(o&&o.enter(),h=i(e),o&&(o.exit(),m=!0)),h===r.promise?a(new EO("Promise-chain cycle")):(f=MO(h))?cp(f,h,s,a):s(h)):a(e)}catch(b){o&&!m&&o.exit(),a(b)}},RO=function(r,t){r.notified||(r.notified=!0,gC(function(){for(var e=r.reactions,n;n=e.get();)UO(n,r);r.notified=!1,t&&!r.rejection&&kgt(r)}))},OO=function(r,t,e){var n,i;Rgt?(n=_C.createEvent("Event"),n.promise=t,n.reason=e,n.initEvent(r,!1,!0),sh.dispatchEvent(n)):n={promise:t,reason:e},!Lgt&&(i=sh["on"+r])?i(n):r===SO&&Tgt("Unhandled promise rejection",e)},kgt=function(r){cp(wO,sh,function(){var t=r.facade,e=r.value,n=DO(r),i;if(n&&(i=Igt(function(){m_?vC.emit("unhandledRejection",e,t):OO(SO,t,e)}),r.rejection=m_||DO(r)?FO:wC,i.error))throw i.value})},DO=function(r){return r.rejection!==wC&&!r.parent},Qgt=function(r){cp(wO,sh,function(){var t=r.facade;m_?vC.emit("rejectionHandled",t):OO(Ogt,t,r.value)})},Ap=function(r,t,e){return function(n){r(t,n,e)}},hp=function(r,t,e){r.done||(r.done=!0,e&&(r=e),r.value=t,r.state=Dgt,RO(r,!0))},xC=function(r,t,e){if(!r.done){r.done=!0,e&&(r=e);try{if(r.facade===t)throw new EO("Promise can't be resolved itself");var n=MO(t);n?gC(function(){var i={done:!1};try{cp(n,t,Ap(xC,i,r),Ap(hp,i,r))}catch(s){hp(i,s,r)}}):(r.value=t,r.state=IO,RO(r,!1))}catch(i){hp({done:!1},i,r)}}};if(CO&&(pd=function(r){Egt(this,b_),Bgt(r),cp(w_,this);var t=yC(this);try{r(Ap(xC,t),Ap(hp,t))}catch(e){hp(t,e)}},b_=pd.prototype,w_=function(r){Mgt(this,{type:v_,done:!1,notified:!1,parent:!1,reactions:new Fgt,rejection:!1,state:TO,value:void 0})},w_.prototype=vO(b_,"then",function(r,t){var e=yC(this),n=bC(Sgt(this,pd));return e.parent=!0,n.ok=y_(r)?r:!0,n.fail=y_(t)&&t,n.domain=m_?vC.domain:void 0,e.state===TO?e.reactions.add(n):gC(function(){UO(n,e)}),n.promise}),LO=function(){var r=new w_,t=yC(r);this.promise=r,this.resolve=Ap(xC,t),this.reject=Ap(hp,t)},BO.f=bC=function(r){return r===pd||r===Ngt?new LO(r):Ugt(r)},y_(__)&&up!==Object.prototype)){PO=up.then,Pgt||vO(up,"then",function(r,t){var e=this;return new pd(function(n,i){cp(PO,e,n,i)}).then(r,t)},{unsafe:!0});try{delete up.constructor}catch{}bO&&bO(up,b_)}bgt({global:!0,constructor:!0,wrap:!0,forced:CO},{Promise:pd}),wgt(pd,v_,!1),xgt(v_);var Im={},Hgt=Rs,zgt=Im,Vgt=Hgt("iterator"),Ggt=Array.prototype,jgt=function(r){return r!==void 0&&(zgt.Array===r||Ggt[Vgt]===r)},qgt=JB,NO=rp,Kgt=Ad,Wgt=Im,$gt=Rs,Xgt=$gt("iterator"),kO=function(r){if(!Kgt(r))return NO(r,Xgt)||NO(r,"@@iterator")||Wgt[qgt(r)]},Jgt=Ys,Ygt=Zu,Zgt=Vo,tmt=J1,emt=kO,rmt=TypeError,nmt=function(r,t){var e=arguments.length<2?emt(r):t;if(Ygt(e))return Zgt(Jgt(e,r));throw new rmt(tmt(r)+" is not iterable")},imt=Ys,QO=Vo,smt=rp,omt=function(r,t,e){var n,i;QO(r);try{if(n=smt(r,"return"),!n){if(t==="throw")throw e;return e}n=imt(n,r)}catch(s){i=!0,n=s}if(t==="throw")throw e;if(i)throw n;return QO(n),e},amt=ZB,lmt=Ys,cmt=Vo,umt=J1,Amt=jgt,hmt=WB,HO=W1,dmt=nmt,fmt=kO,zO=omt,pmt=TypeError,x_=function(r,t){this.stopped=r,this.result=t},VO=x_.prototype,GO=function(r,t,e){var n=e&&e.that,i=!!(e&&e.AS_ENTRIES),s=!!(e&&e.IS_RECORD),a=!!(e&&e.IS_ITERATOR),o=!!(e&&e.INTERRUPTED),h=amt(t,n),f,m,b,x,B,P,R,Q=function(G){return f&&zO(f,"normal",G),new x_(!0,G)},z=function(G){return i?(cmt(G),o?h(G[0],G[1],Q):h(G[0],G[1])):o?h(G,Q):h(G)};if(s)f=r.iterator;else if(a)f=r;else{if(m=fmt(r),!m)throw new pmt(umt(r)+" is not iterable");if(Amt(m)){for(b=0,x=hmt(r);x>b;b++)if(B=z(r[b]),B&&HO(VO,B))return B;return new x_(!1)}f=dmt(r,m)}for(P=s?r.next:f.next;!(R=lmt(P,f)).done;){try{B=z(R.value)}catch(G){zO(f,"throw",G)}if(typeof B=="object"&&B&&HO(VO,B))return B}return new x_(!1)},gmt=Rs,jO=gmt("iterator"),qO=!1;try{var mmt=0,KO={next:function(){return{done:!!mmt++}},return:function(){qO=!0}};KO[jO]=function(){return this},Array.from(KO,function(){throw 2})}catch{}var ymt=function(r,t){try{if(!t&&!qO)return!1}catch{return!1}var e=!1;try{var n={};n[jO]=function(){return{next:function(){return{done:e=!0}}}},r(n)}catch{}return e},_mt=g_,vmt=ymt,bmt=Tm.CONSTRUCTOR,WO=bmt||!vmt(function(r){_mt.all(r).then(void 0,function(){})}),wmt=Go,xmt=Ys,Bmt=Zu,Cmt=lp,Emt=dC,Smt=GO,Tmt=WO;wmt({target:"Promise",stat:!0,forced:Tmt},{all:function(r){var t=this,e=Cmt.f(t),n=e.resolve,i=e.reject,s=Emt(function(){var a=Bmt(t.resolve),o=[],h=0,f=1;Smt(r,function(m){var b=h++,x=!1;f++,xmt(a,t,m).then(function(B){x||(x=!0,o[b]=B,--f||n(o))},i)}),--f||n(o)});return s.error&&i(s.value),e.promise}});var Imt=Go,Fmt=Tm.CONSTRUCTOR,BC=g_,Lmt=hd,Pmt=ss,Mmt=dd,$O=BC&&BC.prototype;if(Imt({target:"Promise",proto:!0,forced:Fmt,real:!0},{catch:function(r){return this.then(void 0,r)}}),Pmt(BC)){var XO=Lmt("Promise").prototype.catch;$O.catch!==XO&&Mmt($O,"catch",XO,{unsafe:!0})}var Umt=Go,Rmt=Ys,Omt=Zu,Dmt=lp,Nmt=dC,kmt=GO,Qmt=WO;Umt({target:"Promise",stat:!0,forced:Qmt},{race:function(r){var t=this,e=Dmt.f(t),n=e.reject,i=Nmt(function(){var s=Omt(t.resolve);kmt(r,function(a){Rmt(s,t,a).then(e.resolve,n)})});return i.error&&n(i.value),e.promise}});var Hmt=Go,zmt=lp,Vmt=Tm.CONSTRUCTOR;Hmt({target:"Promise",stat:!0,forced:Vmt},{reject:function(r){var t=zmt.f(this),e=t.reject;return e(r),t.promise}});var Gmt=Vo,jmt=_c,qmt=lp,Kmt=function(r,t){if(Gmt(r),jmt(t)&&t.constructor===r)return t;var e=qmt.f(r),n=e.resolve;return n(t),e.promise},Wmt=Go,$mt=hd,Xmt=Tm.CONSTRUCTOR,Jmt=Kmt;$mt("Promise"),Wmt({target:"Promise",stat:!0,forced:Xmt},{resolve:function(r){return Jmt(this,r)}});function JO(r,t,e,n,i,s,a){try{var o=r[s](a),h=o.value}catch(f){e(f);return}o.done?t(h):Promise.resolve(h).then(n,i)}function eA(r){return function(){var t=this,e=arguments;return new Promise(function(n,i){var s=r.apply(t,e);function a(h){JO(s,n,i,a,o,"next",h)}function o(h){JO(s,n,i,a,o,"throw",h)}a(void 0)})}}var Ymt=JB,Zmt=String,ou=function(r){if(Ymt(r)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return Zmt(r)},t0t=Vo,YO=function(){var r=t0t(this),t="";return r.hasIndices&&(t+="d"),r.global&&(t+="g"),r.ignoreCase&&(t+="i"),r.multiline&&(t+="m"),r.dotAll&&(t+="s"),r.unicode&&(t+="u"),r.unicodeSets&&(t+="v"),r.sticky&&(t+="y"),t},CC=ns,e0t=rs,EC=e0t.RegExp,SC=CC(function(){var r=EC("a","y");return r.lastIndex=2,r.exec("abcd")!==null}),r0t=SC||CC(function(){return!EC("a","y").sticky}),n0t=SC||CC(function(){var r=EC("^r","gy");return r.lastIndex=2,r.exec("str")!==null}),ZO={BROKEN_CARET:n0t,MISSED_STICKY:r0t,UNSUPPORTED_Y:SC},tD={},i0t=PR,s0t=XB,o0t=Object.keys||function(r){return i0t(r,s0t)},a0t=mc,l0t=mR,c0t=tA,u0t=Vo,A0t=_m,h0t=o0t;tD.f=a0t&&!l0t?Object.defineProperties:function(r,t){u0t(r);for(var e=A0t(t),n=h0t(t),i=n.length,s=0,a;i>s;)c0t.f(r,a=n[s++],e[a]);return r};var d0t=Vo,f0t=tD,eD=XB,p0t=zB,g0t=YR,m0t=Z1,y0t=HB,rD=">",nD="<",TC="prototype",IC="script",iD=y0t("IE_PROTO"),FC=function(){},sD=function(r){return nD+IC+rD+r+nD+"/"+IC+rD},oD=function(r){r.write(sD("")),r.close();var t=r.parentWindow.Object;return r=null,t},_0t=function(){var r=m0t("iframe"),t="java"+IC+":",e;return r.style.display="none",g0t.appendChild(r),r.src=String(t),e=r.contentWindow.document,e.open(),e.write(sD("document.F=Object")),e.close(),e.F},B_,C_=function(){try{B_=new ActiveXObject("htmlfile")}catch{}C_=typeof document<"u"?document.domain&&B_?oD(B_):_0t():oD(B_);for(var r=eD.length;r--;)delete C_[TC][eD[r]];return C_()};p0t[iD]=!0;var LC=Object.create||function(r,t){var e;return r!==null?(FC[TC]=d0t(r),e=new FC,FC[TC]=null,e[iD]=r):e=C_(),t===void 0?e:f0t.f(e,t)},v0t=ns,b0t=rs,w0t=b0t.RegExp,x0t=v0t(function(){var r=w0t(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),B0t=ns,C0t=rs,E0t=C0t.RegExp,S0t=B0t(function(){var r=E0t("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),dp=Ys,E_=is,T0t=ou,I0t=YO,F0t=ZO,L0t=FB,P0t=LC,M0t=i_.get,U0t=x0t,R0t=S0t,O0t=L0t("native-string-replace",String.prototype.replace),S_=RegExp.prototype.exec,PC=S_,D0t=E_("".charAt),N0t=E_("".indexOf),k0t=E_("".replace),MC=E_("".slice),UC=function(){var r=/a/,t=/b*/g;return dp(S_,r,"a"),dp(S_,t,"a"),r.lastIndex!==0||t.lastIndex!==0}(),aD=F0t.BROKEN_CARET,RC=/()??/.exec("")[1]!==void 0,Q0t=UC||RC||aD||U0t||R0t;Q0t&&(PC=function(r){var t=this,e=M0t(t),n=T0t(r),i=e.raw,s,a,o,h,f,m,b;if(i)return i.lastIndex=t.lastIndex,s=dp(PC,i,n),t.lastIndex=i.lastIndex,s;var x=e.groups,B=aD&&t.sticky,P=dp(I0t,t),R=t.source,Q=0,z=n;if(B&&(P=k0t(P,"y",""),N0t(P,"g")===-1&&(P+="g"),z=MC(n,t.lastIndex),t.lastIndex>0&&(!t.multiline||t.multiline&&D0t(n,t.lastIndex-1)!==`
`)&&(R="(?: "+R+")",z=" "+z,Q++),a=new RegExp("^(?:"+R+")",P)),RC&&(a=new RegExp("^"+R+"$(?!\\s)",P)),UC&&(o=t.lastIndex),h=dp(S_,B?a:t,z),B?h?(h.input=MC(h.input,Q),h[0]=MC(h[0],Q),h.index=t.lastIndex,t.lastIndex+=h[0].length):t.lastIndex=0:UC&&h&&(t.lastIndex=t.global?h.index+h[0].length:o),RC&&h&&h.length>1&&dp(O0t,h[0],a,function(){for(f=1;f<arguments.length-2;f++)arguments[f]===void 0&&(h[f]=void 0)}),h&&x)for(h.groups=m=P0t(null),f=0;f<x.length;f++)b=x[f],m[b[0]]=h[b[1]];return h});var OC=PC,H0t=Go,lD=OC;H0t({target:"RegExp",proto:!0,forced:/./.exec!==lD},{exec:lD});var cD=Ys,uD=dd,z0t=OC,AD=ns,hD=Rs,V0t=vm,G0t=hD("species"),DC=RegExp.prototype,NC=function(r,t,e,n){var i=hD(r),s=!AD(function(){var f={};return f[i]=function(){return 7},""[r](f)!==7}),a=s&&!AD(function(){var f=!1,m=/a/;return r==="split"&&(m={},m.constructor={},m.constructor[G0t]=function(){return m},m.flags="",m[i]=/./[i]),m.exec=function(){return f=!0,null},m[i](""),!f});if(!s||!a||e){var o=/./[i],h=t(i,""[r],function(f,m,b,x,B){var P=m.exec;return P===z0t||P===DC.exec?s&&!B?{done:!0,value:cD(o,m,b,x)}:{done:!0,value:cD(f,b,m,x)}:{done:!1}});uD(String.prototype,r,h[0]),uD(DC,i,h[1])}n&&V0t(DC[i],"sham",!0)},kC=is,j0t=a_,q0t=ou,K0t=yc,W0t=kC("".charAt),dD=kC("".charCodeAt),$0t=kC("".slice),fD=function(r){return function(t,e){var n=q0t(K0t(t)),i=j0t(e),s=n.length,a,o;return i<0||i>=s?r?"":void 0:(a=dD(n,i),a<55296||a>56319||i+1===s||(o=dD(n,i+1))<56320||o>57343?r?W0t(n,i):a:r?$0t(n,i,i+2):(a-55296<<10)+(o-56320)+65536)}},X0t={codeAt:fD(!1),charAt:fD(!0)},J0t=X0t.charAt,QC=function(r,t,e){return t+(e?J0t(r,t).length:1)},pD=Ys,Y0t=Vo,Z0t=ss,tyt=ud,eyt=OC,ryt=TypeError,HC=function(r,t){var e=r.exec;if(Z0t(e)){var n=pD(e,r,t);return n!==null&&Y0t(n),n}if(tyt(r)==="RegExp")return pD(eyt,r,t);throw new ryt("RegExp#exec called on incompatible receiver")},nyt=Ys,iyt=NC,syt=Vo,oyt=Ad,ayt=sp,zC=ou,lyt=yc,cyt=rp,uyt=QC,gD=HC;iyt("match",function(r,t,e){return[function(n){var i=lyt(this),s=oyt(n)?void 0:cyt(n,r);return s?nyt(s,n,i):new RegExp(n)[r](zC(i))},function(n){var i=syt(this),s=zC(n),a=e(t,i,s);if(a.done)return a.value;if(!i.global)return gD(i,s);var o=i.unicode;i.lastIndex=0;for(var h=[],f=0,m;(m=gD(i,s))!==null;){var b=zC(m[0]);h[f]=b,b===""&&(i.lastIndex=uyt(s,ayt(i.lastIndex),o)),f++}return f===0?null:h}]});var VC=is,Ayt=Y1,hyt=Math.floor,GC=VC("".charAt),dyt=VC("".replace),jC=VC("".slice),fyt=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,pyt=/\$([$&'`]|\d{1,2})/g,gyt=function(r,t,e,n,i,s){var a=e+r.length,o=n.length,h=pyt;return i!==void 0&&(i=Ayt(i),h=fyt),dyt(s,h,function(f,m){var b;switch(GC(m,0)){case"$":return"$";case"&":return r;case"`":return jC(t,0,e);case"'":return jC(t,a);case"<":b=i[jC(m,1,-1)];break;default:var x=+m;if(x===0)return f;if(x>o){var B=hyt(x/10);return B===0?f:B<=o?n[B-1]===void 0?GC(m,1):n[B-1]+GC(m,1):f}b=n[x-1]}return b===void 0?"":b})},myt=XR,mD=Ys,T_=is,yyt=NC,_yt=ns,vyt=Vo,byt=ss,wyt=Ad,xyt=a_,Byt=sp,fp=ou,Cyt=yc,Eyt=QC,Syt=rp,Tyt=gyt,Iyt=HC,Fyt=Rs,qC=Fyt("replace"),Lyt=Math.max,Pyt=Math.min,Myt=T_([].concat),KC=T_([].push),yD=T_("".indexOf),_D=T_("".slice),Uyt=function(r){return r===void 0?r:String(r)},Ryt=function(){return"a".replace(/./,"$0")==="$0"}(),vD=function(){return/./[qC]?/./[qC]("a","$0")==="":!1}(),Oyt=!_yt(function(){var r=/./;return r.exec=function(){var t=[];return t.groups={a:"7"},t},"".replace(r,"$<a>")!=="7"});yyt("replace",function(r,t,e){var n=vD?"$":"$0";return[function(i,s){var a=Cyt(this),o=wyt(i)?void 0:Syt(i,qC);return o?mD(o,i,a,s):mD(t,fp(a),i,s)},function(i,s){var a=vyt(this),o=fp(i);if(typeof s=="string"&&yD(s,n)===-1&&yD(s,"$<")===-1){var h=e(t,a,o,s);if(h.done)return h.value}var f=byt(s);f||(s=fp(s));var m=a.global,b;m&&(b=a.unicode,a.lastIndex=0);for(var x=[],B;B=Iyt(a,o),!(B===null||(KC(x,B),!m));){var P=fp(B[0]);P===""&&(a.lastIndex=Eyt(o,Byt(a.lastIndex),b))}for(var R="",Q=0,z=0;z<x.length;z++){B=x[z];for(var G=fp(B[0]),X=Lyt(Pyt(xyt(B.index),o.length),0),et=[],pt,gt=1;gt<B.length;gt++)KC(et,Uyt(B[gt]));var mt=B.groups;if(f){var ft=Myt([G],et,X,o);mt!==void 0&&KC(ft,mt),pt=fp(myt(s,void 0,ft))}else pt=Tyt(G,o,X,et,mt,s);X>=Q&&(R+=_D(o,Q,X)+pt,Q=X+G.length)}return R+_D(o,Q)}]},!Oyt||!Ryt||vD);var Dyt=_c,Nyt=ud,kyt=Rs,Qyt=kyt("match"),Hyt=function(r){var t;return Dyt(r)&&((t=r[Qyt])!==void 0?!!t:Nyt(r)==="RegExp")},zyt=Hyt,Vyt=TypeError,WC=function(r){if(zyt(r))throw new Vyt("The method doesn't accept regular expressions");return r},Gyt=Rs,jyt=Gyt("match"),$C=function(r){var t=/./;try{"/./"[r](t)}catch{try{return t[jyt]=!1,"/./"[r](t)}catch{}}return!1},qyt=Go,Kyt=A_,Wyt=ym.f,$yt=sp,bD=ou,Xyt=WC,Jyt=yc,Yyt=$C,Zyt=Kyt("".slice),t1t=Math.min,wD=Yyt("startsWith"),e1t=!wD&&!!function(){var r=Wyt(String.prototype,"startsWith");return r&&!r.writable}();qyt({target:"String",proto:!0,forced:!e1t&&!wD},{startsWith:function(r){var t=bD(Jyt(this));Xyt(r);var e=$yt(t1t(arguments.length>1?arguments[1]:void 0,t.length)),n=bD(r);return Zyt(t,e,e+n.length)===n}});var r1t=Rs,n1t=LC,i1t=tA.f,XC=r1t("unscopables"),JC=Array.prototype;JC[XC]===void 0&&i1t(JC,XC,{configurable:!0,value:n1t(null)});var s1t=function(r){JC[XC][r]=!0},o1t=ns,a1t=!o1t(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),l1t=bc,c1t=ss,u1t=Y1,A1t=HB,h1t=a1t,xD=A1t("IE_PROTO"),YC=Object,d1t=YC.prototype,BD=h1t?YC.getPrototypeOf:function(r){var t=u1t(r);if(l1t(t,xD))return t[xD];var e=t.constructor;return c1t(e)&&t instanceof e?e.prototype:t instanceof YC?d1t:null},f1t=ns,p1t=ss,g1t=_c,CD=BD,m1t=dd,y1t=Rs,ZC=y1t("iterator"),ED=!1,gd,tE,eE;[].keys&&(eE=[].keys(),"next"in eE?(tE=CD(CD(eE)),tE!==Object.prototype&&(gd=tE)):ED=!0);var _1t=!g1t(gd)||f1t(function(){var r={};return gd[ZC].call(r)!==r});_1t&&(gd={}),p1t(gd[ZC])||m1t(gd,ZC,function(){return this});var SD={IteratorPrototype:gd,BUGGY_SAFARI_ITERATORS:ED},v1t=SD.IteratorPrototype,b1t=LC,w1t=yB,x1t=c_,B1t=Im,C1t=function(){return this},E1t=function(r,t,e,n){var i=t+" Iterator";return r.prototype=b1t(v1t,{next:w1t(+!n,e)}),x1t(r,i,!1),B1t[i]=C1t,r},S1t=Go,T1t=Ys,TD=e_,I1t=ss,F1t=E1t,ID=BD,FD=OR,L1t=c_,P1t=vm,rE=dd,M1t=Rs,U1t=Im,LD=SD,R1t=TD.PROPER,O1t=TD.CONFIGURABLE,PD=LD.IteratorPrototype,I_=LD.BUGGY_SAFARI_ITERATORS,Fm=M1t("iterator"),MD="keys",Lm="values",UD="entries",D1t=function(){return this},N1t=function(r,t,e,n,i,s,a){F1t(e,t,n);var o=function(z){if(z===i&&x)return x;if(!I_&&z&&z in m)return m[z];switch(z){case MD:return function(){return new e(this,z)};case Lm:return function(){return new e(this,z)};case UD:return function(){return new e(this,z)}}return function(){return new e(this)}},h=t+" Iterator",f=!1,m=r.prototype,b=m[Fm]||m["@@iterator"]||i&&m[i],x=!I_&&b||o(i),B=t==="Array"&&m.entries||b,P,R,Q;if(B&&(P=ID(B.call(new r)),P!==Object.prototype&&P.next&&(ID(P)!==PD&&(FD?FD(P,PD):I1t(P[Fm])||rE(P,Fm,D1t)),L1t(P,h,!0))),R1t&&i===Lm&&b&&b.name!==Lm&&(O1t?P1t(m,"name",Lm):(f=!0,x=function(){return T1t(b,this)})),i)if(R={values:o(Lm),keys:s?x:o(MD),entries:o(UD)},a)for(Q in R)(I_||f||!(Q in m))&&rE(m,Q,R[Q]);else S1t({target:t,proto:!0,forced:I_||f},R);return m[Fm]!==x&&rE(m,Fm,x,{name:i}),U1t[t]=x,R},k1t=function(r,t){return{value:r,done:t}},Q1t=_m,nE=s1t,RD=Im,OD=i_,H1t=tA.f,z1t=N1t,F_=k1t,V1t=mc,DD="Array Iterator",G1t=OD.set,j1t=OD.getterFor(DD),q1t=z1t(Array,"Array",function(r,t){G1t(this,{type:DD,target:Q1t(r),index:0,kind:t})},function(){var r=j1t(this),t=r.target,e=r.index++;if(!t||e>=t.length)return r.target=void 0,F_(void 0,!0);switch(r.kind){case"keys":return F_(e,!1);case"values":return F_(t[e],!1)}return F_([e,t[e]],!1)},"values"),ND=RD.Arguments=RD.Array;if(nE("keys"),nE("values"),nE("entries"),V1t&&ND.name!=="values")try{H1t(ND,"name",{value:"values"})}catch{}var K1t={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},W1t=Z1,iE=W1t("span").classList,kD=iE&&iE.constructor&&iE.constructor.prototype,$1t=kD===Object.prototype?void 0:kD,QD=rs,HD=K1t,X1t=$1t,Pm=q1t,zD=vm,J1t=c_,Y1t=Rs,sE=Y1t("iterator"),oE=Pm.values,VD=function(r,t){if(r){if(r[sE]!==oE)try{zD(r,sE,oE)}catch{r[sE]=oE}if(J1t(r,t,!0),HD[t]){for(var e in Pm)if(r[e]!==Pm[e])try{zD(r,e,Pm[e])}catch{r[e]=Pm[e]}}}};for(var aE in HD)VD(QD[aE]&&QD[aE].prototype,aE);VD(X1t,"DOMTokenList");function Z1t(r,t){if(Un(r)!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(Un(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function t_t(r){var t=Z1t(r,"string");return Un(t)=="symbol"?t:t+""}function lE(r,t,e){return t=t_t(t),t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var e_t=Zu,r_t=Y1,n_t=WU,i_t=WB,GD=TypeError,jD="Reduce of empty array with no initial value",qD=function(r){return function(t,e,n,i){var s=r_t(t),a=n_t(s),o=i_t(s);if(e_t(e),o===0&&n<2)throw new GD(jD);var h=r?o-1:0,f=r?-1:1;if(n<2)for(;;){if(h in a){i=a[h],h+=f;break}if(h+=f,r?h<0:o<=h)throw new GD(jD)}for(;r?h>=0:o>h;h+=f)h in a&&(i=e(i,a[h],h,s));return i}},s_t={left:qD(!1),right:qD(!0)},o_t=ns,KD=function(r,t){var e=[][r];return!!e&&o_t(function(){e.call(null,t||function(){return 1},1)})},a_t=Go,l_t=s_t.left,c_t=KD,WD=BB,u_t=xm,A_t=!u_t&&WD>79&&WD<83,h_t=A_t||!c_t("reduce");a_t({target:"Array",proto:!0,forced:h_t},{reduce:function(r){var t=arguments.length;return l_t(this,r,t,t>1?arguments[1]:void 0)}});var d_t=Go,f_t=A_,p_t=ym.f,g_t=sp,$D=ou,m_t=WC,y_t=yc,__t=$C,v_t=f_t("".slice),b_t=Math.min,XD=__t("endsWith"),w_t=!XD&&!!function(){var r=p_t(String.prototype,"endsWith");return r&&!r.writable}();d_t({target:"String",proto:!0,forced:!w_t&&!XD},{endsWith:function(r){var t=$D(y_t(this));m_t(r);var e=arguments.length>1?arguments[1]:void 0,n=t.length,i=e===void 0?n:b_t(g_t(e),n),s=$D(r);return v_t(t,i-s.length,i)===s}});var cE=Ys,JD=is,x_t=NC,B_t=Vo,C_t=Ad,E_t=yc,S_t=qR,T_t=QC,I_t=sp,YD=ou,F_t=rp,ZD=HC,L_t=ZO,P_t=ns,pp=L_t.UNSUPPORTED_Y,M_t=4294967295,U_t=Math.min,uE=JD([].push),AE=JD("".slice),R_t=!P_t(function(){var r=/(?:)/,t=r.exec;r.exec=function(){return t.apply(this,arguments)};var e="ab".split(r);return e.length!==2||e[0]!=="a"||e[1]!=="b"}),t6="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;x_t("split",function(r,t,e){var n="0".split(void 0,0).length?function(i,s){return i===void 0&&s===0?[]:cE(t,this,i,s)}:t;return[function(i,s){var a=E_t(this),o=C_t(i)?void 0:F_t(i,r);return o?cE(o,i,a,s):cE(n,YD(a),i,s)},function(i,s){var a=B_t(this),o=YD(i);if(!t6){var h=e(n,a,o,s,n!==t);if(h.done)return h.value}var f=S_t(a,RegExp),m=a.unicode,b=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(pp?"g":"y"),x=new f(pp?"^(?:"+a.source+")":a,b),B=s===void 0?M_t:s>>>0;if(B===0)return[];if(o.length===0)return ZD(x,o)===null?[o]:[];for(var P=0,R=0,Q=[];R<o.length;){x.lastIndex=pp?0:R;var z=ZD(x,pp?AE(o,R):o),G;if(z===null||(G=U_t(I_t(x.lastIndex+(pp?R:0)),o.length))===P)R=T_t(o,R,m);else{if(uE(Q,AE(o,P,R)),Q.length===B)return Q;for(var X=1;X<=z.length-1;X++)if(uE(Q,z[X]),Q.length===B)return Q;R=P=G}}return uE(Q,AE(o,P)),Q}]},t6||!R_t,pp);var L_={exports:{}},Mm={exports:{}};(function(){var r,t,e,n,i,s;typeof performance<"u"&&performance!==null&&performance.now?Mm.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(Mm.exports=function(){return(r()-i)/1e6},t=process.hrtime,r=function(){var a;return a=t(),a[0]*1e9+a[1]},n=r(),s=process.uptime()*1e9,i=n-s):Date.now?(Mm.exports=function(){return Date.now()-e},e=Date.now()):(Mm.exports=function(){return new Date().getTime()-e},e=new Date().getTime())}).call(ep);for(var O_t=Mm.exports,D_t=O_t,rA=typeof window>"u"?ep:window,P_=["moz","webkit"],gp="AnimationFrame",mp=rA["request"+gp],Um=rA["cancel"+gp]||rA["cancelRequest"+gp],Rm=0;!mp&&Rm<P_.length;Rm++)mp=rA[P_[Rm]+"Request"+gp],Um=rA[P_[Rm]+"Cancel"+gp]||rA[P_[Rm]+"CancelRequest"+gp];if(!mp||!Um){var hE=0,e6=0,md=[],N_t=1e3/60;mp=function(r){if(md.length===0){var t=D_t(),e=Math.max(0,N_t-(t-hE));hE=e+t,setTimeout(function(){var n=md.slice(0);md.length=0;for(var i=0;i<n.length;i++)if(!n[i].cancelled)try{n[i].callback(hE)}catch(s){setTimeout(function(){throw s},0)}},Math.round(e))}return md.push({handle:++e6,callback:r,cancelled:!1}),e6},Um=function(r){for(var t=0;t<md.length;t++)md[t].handle===r&&(md[t].cancelled=!0)}}L_.exports=function(r){return mp.call(rA,r)},L_.exports.cancel=function(){Um.apply(rA,arguments)},L_.exports.polyfill=function(r){r||(r=rA),r.requestAnimationFrame=mp,r.cancelAnimationFrame=Um};var k_t=L_.exports;const dE=HU(k_t);var r6=`	
\v\f\r \u2028\u2029\uFEFF`,Q_t=is,H_t=yc,z_t=ou,fE=r6,n6=Q_t("".replace),V_t=RegExp("^["+fE+"]+"),G_t=RegExp("(^|[^"+fE+"])["+fE+"]+$"),pE=function(r){return function(t){var e=z_t(H_t(t));return r&1&&(e=n6(e,V_t,"")),r&2&&(e=n6(e,G_t,"$1")),e}},j_t={start:pE(1),end:pE(2),trim:pE(3)},q_t=e_.PROPER,K_t=ns,i6=r6,s6="",W_t=function(r){return K_t(function(){return!!i6[r]()||s6[r]()!==s6||q_t&&i6[r].name!==r})},$_t=Go,X_t=j_t.trim,J_t=W_t;$_t({target:"String",proto:!0,forced:J_t("trim")},{trim:function(){return X_t(this)}});var Y_t=function(r){this.ok=!1,this.alpha=1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r=r.replace(/ /g,""),r=r.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};r=t[r]||r;for(var e=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(h){return[parseInt(h[1]),parseInt(h[2]),parseInt(h[3]),parseFloat(h[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(h){return[parseInt(h[1]),parseInt(h[2]),parseInt(h[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(h){return[parseInt(h[1],16),parseInt(h[2],16),parseInt(h[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(h){return[parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16),parseInt(h[3]+h[3],16)]}}],n=0;n<e.length;n++){var i=e[n].re,s=e[n].process,a=i.exec(r);if(a){var o=s(a);this.r=o[0],this.g=o[1],this.b=o[2],o.length>3&&(this.alpha=o[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var h=this.r.toString(16),f=this.g.toString(16),m=this.b.toString(16);return h.length==1&&(h="0"+h),f.length==1&&(f="0"+f),m.length==1&&(m="0"+m),"#"+h+f+m},this.getHelpXML=function(){for(var h=new Array,f=0;f<e.length;f++)for(var m=e[f].example,b=0;b<m.length;b++)h[h.length]=m[b];for(var x in t)h[h.length]=x;var B=document.createElement("ul");B.setAttribute("id","rgbcolor-examples");for(var f=0;f<h.length;f++)try{var P=document.createElement("li"),R=new RGBColor(h[f]),Q=document.createElement("div");Q.style.cssText="margin: 3px; border: 1px solid black; background:"+R.toHex()+"; color:"+R.toHex(),Q.appendChild(document.createTextNode("test"));var z=document.createTextNode(" "+h[f]+" -> "+R.toRGB()+" -> "+R.toHex());P.appendChild(Q),P.appendChild(z),B.appendChild(P)}catch{}return B}};const gE=HU(Y_t);var Z_t=Go,tvt=A_,evt=FR.indexOf,rvt=KD,mE=tvt([].indexOf),o6=!!mE&&1/mE([1],1,-0)<0,nvt=o6||!rvt("indexOf");Z_t({target:"Array",proto:!0,forced:nvt},{indexOf:function(r){var t=arguments.length>1?arguments[1]:void 0;return o6?mE(this,r,t)||0:evt(this,r,t)}});var ivt=Go,svt=is,ovt=WC,avt=yc,a6=ou,lvt=$C,cvt=svt("".indexOf);ivt({target:"String",proto:!0,forced:!lvt("includes")},{includes:function(r){return!!~cvt(a6(avt(this)),a6(ovt(r)),arguments.length>1?arguments[1]:void 0)}});var uvt=ud,Avt=Array.isArray||function(r){return uvt(r)==="Array"},hvt=Go,dvt=is,fvt=Avt,pvt=dvt([].reverse),l6=[1,2];hvt({target:"Array",proto:!0,forced:String(l6)===String(l6.reverse())},{reverse:function(){return fvt(this)&&(this.length=this.length),pvt(this)}});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var c6=function(r,t){return(c6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])})(r,t)};function u6(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}c6(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function gvt(r){var t="";Array.isArray(r)||(r=[r]);for(var e=0;e<r.length;e++){var n=r[e];if(n.type===Ue.CLOSE_PATH)t+="z";else if(n.type===Ue.HORIZ_LINE_TO)t+=(n.relative?"h":"H")+n.x;else if(n.type===Ue.VERT_LINE_TO)t+=(n.relative?"v":"V")+n.y;else if(n.type===Ue.MOVE_TO)t+=(n.relative?"m":"M")+n.x+" "+n.y;else if(n.type===Ue.LINE_TO)t+=(n.relative?"l":"L")+n.x+" "+n.y;else if(n.type===Ue.CURVE_TO)t+=(n.relative?"c":"C")+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===Ue.SMOOTH_CURVE_TO)t+=(n.relative?"s":"S")+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===Ue.QUAD_TO)t+=(n.relative?"q":"Q")+n.x1+" "+n.y1+" "+n.x+" "+n.y;else if(n.type===Ue.SMOOTH_QUAD_TO)t+=(n.relative?"t":"T")+n.x+" "+n.y;else{if(n.type!==Ue.ARC)throw new Error('Unexpected command type "'+n.type+'" at index '+e+".");t+=(n.relative?"a":"A")+n.rX+" "+n.rY+" "+n.xRot+" "+ +n.lArcFlag+" "+ +n.sweepFlag+" "+n.x+" "+n.y}}return t}function yE(r,t){var e=r[0],n=r[1];return[e*Math.cos(t)-n*Math.sin(t),e*Math.sin(t)+n*Math.cos(t)]}function wc(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var e=0;e<r.length;e++)if(typeof r[e]!="number")throw new Error("assertNumbers arguments["+e+"] is not a number. "+typeof r[e]+" == typeof "+r[e]);return!0}var oh=Math.PI;function _E(r,t,e){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var n=r.rX,i=r.rY,s=r.x,a=r.y;n=Math.abs(r.rX),i=Math.abs(r.rY);var o=yE([(t-s)/2,(e-a)/2],-r.xRot/180*oh),h=o[0],f=o[1],m=Math.pow(h,2)/Math.pow(n,2)+Math.pow(f,2)/Math.pow(i,2);1<m&&(n*=Math.sqrt(m),i*=Math.sqrt(m)),r.rX=n,r.rY=i;var b=Math.pow(n,2)*Math.pow(f,2)+Math.pow(i,2)*Math.pow(h,2),x=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(n,2)*Math.pow(i,2)-b)/b)),B=n*f/i*x,P=-i*h/n*x,R=yE([B,P],r.xRot/180*oh);r.cX=R[0]+(t+s)/2,r.cY=R[1]+(e+a)/2,r.phi1=Math.atan2((f-P)/i,(h-B)/n),r.phi2=Math.atan2((-f-P)/i,(-h-B)/n),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*oh),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*oh),r.phi1*=180/oh,r.phi2*=180/oh}function A6(r,t,e){wc(r,t,e);var n=r*r+t*t-e*e;if(0>n)return[];if(n===0)return[[r*e/(r*r+t*t),t*e/(r*r+t*t)]];var i=Math.sqrt(n);return[[(r*e+t*i)/(r*r+t*t),(t*e-r*i)/(r*r+t*t)],[(r*e-t*i)/(r*r+t*t),(t*e+r*i)/(r*r+t*t)]]}var gs,nA=Math.PI/180;function h6(r,t,e){return(1-e)*r+e*t}function d6(r,t,e,n){return r+Math.cos(n/180*oh)*t+Math.sin(n/180*oh)*e}function f6(r,t,e,n){var i=1e-6,s=t-r,a=e-t,o=3*s+3*(n-e)-6*a,h=6*(a-s),f=3*s;return Math.abs(o)<i?[-f/h]:function(m,b,x){var B=m*m/4-b;if(B<-x)return[];if(B<=x)return[-m/2];var P=Math.sqrt(B);return[-m/2-P,-m/2+P]}(h/o,f/o,i)}function p6(r,t,e,n,i){var s=1-i;return r*(s*s*s)+t*(3*s*s*i)+e*(3*s*i*i)+n*(i*i*i)}(function(r){function t(){return i(function(o,h,f){return o.relative&&(o.x1!==void 0&&(o.x1+=h),o.y1!==void 0&&(o.y1+=f),o.x2!==void 0&&(o.x2+=h),o.y2!==void 0&&(o.y2+=f),o.x!==void 0&&(o.x+=h),o.y!==void 0&&(o.y+=f),o.relative=!1),o})}function e(){var o=NaN,h=NaN,f=NaN,m=NaN;return i(function(b,x,B){return b.type&Ue.SMOOTH_CURVE_TO&&(b.type=Ue.CURVE_TO,o=isNaN(o)?x:o,h=isNaN(h)?B:h,b.x1=b.relative?x-o:2*x-o,b.y1=b.relative?B-h:2*B-h),b.type&Ue.CURVE_TO?(o=b.relative?x+b.x2:b.x2,h=b.relative?B+b.y2:b.y2):(o=NaN,h=NaN),b.type&Ue.SMOOTH_QUAD_TO&&(b.type=Ue.QUAD_TO,f=isNaN(f)?x:f,m=isNaN(m)?B:m,b.x1=b.relative?x-f:2*x-f,b.y1=b.relative?B-m:2*B-m),b.type&Ue.QUAD_TO?(f=b.relative?x+b.x1:b.x1,m=b.relative?B+b.y1:b.y1):(f=NaN,m=NaN),b})}function n(){var o=NaN,h=NaN;return i(function(f,m,b){if(f.type&Ue.SMOOTH_QUAD_TO&&(f.type=Ue.QUAD_TO,o=isNaN(o)?m:o,h=isNaN(h)?b:h,f.x1=f.relative?m-o:2*m-o,f.y1=f.relative?b-h:2*b-h),f.type&Ue.QUAD_TO){o=f.relative?m+f.x1:f.x1,h=f.relative?b+f.y1:f.y1;var x=f.x1,B=f.y1;f.type=Ue.CURVE_TO,f.x1=((f.relative?0:m)+2*x)/3,f.y1=((f.relative?0:b)+2*B)/3,f.x2=(f.x+2*x)/3,f.y2=(f.y+2*B)/3}else o=NaN,h=NaN;return f})}function i(o){var h=0,f=0,m=NaN,b=NaN;return function(x){if(isNaN(m)&&!(x.type&Ue.MOVE_TO))throw new Error("path must start with moveto");var B=o(x,h,f,m,b);return x.type&Ue.CLOSE_PATH&&(h=m,f=b),x.x!==void 0&&(h=x.relative?h+x.x:x.x),x.y!==void 0&&(f=x.relative?f+x.y:x.y),x.type&Ue.MOVE_TO&&(m=h,b=f),B}}function s(o,h,f,m,b,x){return wc(o,h,f,m,b,x),i(function(B,P,R,Q){var z=B.x1,G=B.x2,X=B.relative&&!isNaN(Q),et=B.x!==void 0?B.x:X?0:P,pt=B.y!==void 0?B.y:X?0:R;function gt(it){return it*it}B.type&Ue.HORIZ_LINE_TO&&h!==0&&(B.type=Ue.LINE_TO,B.y=B.relative?0:R),B.type&Ue.VERT_LINE_TO&&f!==0&&(B.type=Ue.LINE_TO,B.x=B.relative?0:P),B.x!==void 0&&(B.x=B.x*o+pt*f+(X?0:b)),B.y!==void 0&&(B.y=et*h+B.y*m+(X?0:x)),B.x1!==void 0&&(B.x1=B.x1*o+B.y1*f+(X?0:b)),B.y1!==void 0&&(B.y1=z*h+B.y1*m+(X?0:x)),B.x2!==void 0&&(B.x2=B.x2*o+B.y2*f+(X?0:b)),B.y2!==void 0&&(B.y2=G*h+B.y2*m+(X?0:x));var mt=o*m-h*f;if(B.xRot!==void 0&&(o!==1||h!==0||f!==0||m!==1))if(mt===0)delete B.rX,delete B.rY,delete B.xRot,delete B.lArcFlag,delete B.sweepFlag,B.type=Ue.LINE_TO;else{var ft=B.xRot*Math.PI/180,Mt=Math.sin(ft),Lt=Math.cos(ft),at=1/gt(B.rX),ct=1/gt(B.rY),wt=gt(Lt)*at+gt(Mt)*ct,_t=2*Mt*Lt*(at-ct),Jt=gt(Mt)*at+gt(Lt)*ct,Yt=wt*m*m-_t*h*m+Jt*h*h,ee=_t*(o*m+h*f)-2*(wt*f*m+Jt*o*h),$t=wt*f*f-_t*o*f+Jt*o*o,ne=(Math.atan2(ee,Yt-$t)+Math.PI)%Math.PI/2,re=Math.sin(ne),Be=Math.cos(ne);B.rX=Math.abs(mt)/Math.sqrt(Yt*gt(Be)+ee*re*Be+$t*gt(re)),B.rY=Math.abs(mt)/Math.sqrt(Yt*gt(re)-ee*re*Be+$t*gt(Be)),B.xRot=180*ne/Math.PI}return B.sweepFlag!==void 0&&0>mt&&(B.sweepFlag=+!B.sweepFlag),B})}function a(){return function(o){var h={};for(var f in o)h[f]=o[f];return h}}r.ROUND=function(o){function h(f){return Math.round(f*o)/o}return o===void 0&&(o=1e13),wc(o),function(f){return f.x1!==void 0&&(f.x1=h(f.x1)),f.y1!==void 0&&(f.y1=h(f.y1)),f.x2!==void 0&&(f.x2=h(f.x2)),f.y2!==void 0&&(f.y2=h(f.y2)),f.x!==void 0&&(f.x=h(f.x)),f.y!==void 0&&(f.y=h(f.y)),f.rX!==void 0&&(f.rX=h(f.rX)),f.rY!==void 0&&(f.rY=h(f.rY)),f}},r.TO_ABS=t,r.TO_REL=function(){return i(function(o,h,f){return o.relative||(o.x1!==void 0&&(o.x1-=h),o.y1!==void 0&&(o.y1-=f),o.x2!==void 0&&(o.x2-=h),o.y2!==void 0&&(o.y2-=f),o.x!==void 0&&(o.x-=h),o.y!==void 0&&(o.y-=f),o.relative=!0),o})},r.NORMALIZE_HVZ=function(o,h,f){return o===void 0&&(o=!0),h===void 0&&(h=!0),f===void 0&&(f=!0),i(function(m,b,x,B,P){if(isNaN(B)&&!(m.type&Ue.MOVE_TO))throw new Error("path must start with moveto");return h&&m.type&Ue.HORIZ_LINE_TO&&(m.type=Ue.LINE_TO,m.y=m.relative?0:x),f&&m.type&Ue.VERT_LINE_TO&&(m.type=Ue.LINE_TO,m.x=m.relative?0:b),o&&m.type&Ue.CLOSE_PATH&&(m.type=Ue.LINE_TO,m.x=m.relative?B-b:B,m.y=m.relative?P-x:P),m.type&Ue.ARC&&(m.rX===0||m.rY===0)&&(m.type=Ue.LINE_TO,delete m.rX,delete m.rY,delete m.xRot,delete m.lArcFlag,delete m.sweepFlag),m})},r.NORMALIZE_ST=e,r.QT_TO_C=n,r.INFO=i,r.SANITIZE=function(o){o===void 0&&(o=0),wc(o);var h=NaN,f=NaN,m=NaN,b=NaN;return i(function(x,B,P,R,Q){var z=Math.abs,G=!1,X=0,et=0;if(x.type&Ue.SMOOTH_CURVE_TO&&(X=isNaN(h)?0:B-h,et=isNaN(f)?0:P-f),x.type&(Ue.CURVE_TO|Ue.SMOOTH_CURVE_TO)?(h=x.relative?B+x.x2:x.x2,f=x.relative?P+x.y2:x.y2):(h=NaN,f=NaN),x.type&Ue.SMOOTH_QUAD_TO?(m=isNaN(m)?B:2*B-m,b=isNaN(b)?P:2*P-b):x.type&Ue.QUAD_TO?(m=x.relative?B+x.x1:x.x1,b=x.relative?P+x.y1:x.y2):(m=NaN,b=NaN),x.type&Ue.LINE_COMMANDS||x.type&Ue.ARC&&(x.rX===0||x.rY===0||!x.lArcFlag)||x.type&Ue.CURVE_TO||x.type&Ue.SMOOTH_CURVE_TO||x.type&Ue.QUAD_TO||x.type&Ue.SMOOTH_QUAD_TO){var pt=x.x===void 0?0:x.relative?x.x:x.x-B,gt=x.y===void 0?0:x.relative?x.y:x.y-P;X=isNaN(m)?x.x1===void 0?X:x.relative?x.x:x.x1-B:m-B,et=isNaN(b)?x.y1===void 0?et:x.relative?x.y:x.y1-P:b-P;var mt=x.x2===void 0?0:x.relative?x.x:x.x2-B,ft=x.y2===void 0?0:x.relative?x.y:x.y2-P;z(pt)<=o&&z(gt)<=o&&z(X)<=o&&z(et)<=o&&z(mt)<=o&&z(ft)<=o&&(G=!0)}return x.type&Ue.CLOSE_PATH&&z(B-R)<=o&&z(P-Q)<=o&&(G=!0),G?[]:x})},r.MATRIX=s,r.ROTATE=function(o,h,f){h===void 0&&(h=0),f===void 0&&(f=0),wc(o,h,f);var m=Math.sin(o),b=Math.cos(o);return s(b,m,-m,b,h-h*b+f*m,f-h*m-f*b)},r.TRANSLATE=function(o,h){return h===void 0&&(h=0),wc(o,h),s(1,0,0,1,o,h)},r.SCALE=function(o,h){return h===void 0&&(h=o),wc(o,h),s(o,0,0,h,0,0)},r.SKEW_X=function(o){return wc(o),s(1,0,Math.atan(o),1,0,0)},r.SKEW_Y=function(o){return wc(o),s(1,Math.atan(o),0,1,0,0)},r.X_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),wc(o),s(-1,0,0,1,o,0)},r.Y_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),wc(o),s(1,0,0,-1,0,o)},r.A_TO_C=function(){return i(function(o,h,f){return Ue.ARC===o.type?function(m,b,x){var B,P,R,Q;m.cX||_E(m,b,x);for(var z=Math.min(m.phi1,m.phi2),G=Math.max(m.phi1,m.phi2)-z,X=Math.ceil(G/90),et=new Array(X),pt=b,gt=x,mt=0;mt<X;mt++){var ft=h6(m.phi1,m.phi2,mt/X),Mt=h6(m.phi1,m.phi2,(mt+1)/X),Lt=Mt-ft,at=4/3*Math.tan(Lt*nA/4),ct=[Math.cos(ft*nA)-at*Math.sin(ft*nA),Math.sin(ft*nA)+at*Math.cos(ft*nA)],wt=ct[0],_t=ct[1],Jt=[Math.cos(Mt*nA),Math.sin(Mt*nA)],Yt=Jt[0],ee=Jt[1],$t=[Yt+at*Math.sin(Mt*nA),ee-at*Math.cos(Mt*nA)],ne=$t[0],re=$t[1];et[mt]={relative:m.relative,type:Ue.CURVE_TO};var Be=function(it,bt){var Pt=yE([it*m.rX,bt*m.rY],m.xRot),Ot=Pt[0],qt=Pt[1];return[m.cX+Ot,m.cY+qt]};B=Be(wt,_t),et[mt].x1=B[0],et[mt].y1=B[1],P=Be(ne,re),et[mt].x2=P[0],et[mt].y2=P[1],R=Be(Yt,ee),et[mt].x=R[0],et[mt].y=R[1],m.relative&&(et[mt].x1-=pt,et[mt].y1-=gt,et[mt].x2-=pt,et[mt].y2-=gt,et[mt].x-=pt,et[mt].y-=gt),pt=(Q=[et[mt].x,et[mt].y])[0],gt=Q[1]}return et}(o,o.relative?0:h,o.relative?0:f):o})},r.ANNOTATE_ARCS=function(){return i(function(o,h,f){return o.relative&&(h=0,f=0),Ue.ARC===o.type&&_E(o,h,f),o})},r.CLONE=a,r.CALCULATE_BOUNDS=function(){var o=function(x){var B={};for(var P in x)B[P]=x[P];return B},h=t(),f=n(),m=e(),b=i(function(x,B,P){var R=m(f(h(o(x))));function Q(re){re>b.maxX&&(b.maxX=re),re<b.minX&&(b.minX=re)}function z(re){re>b.maxY&&(b.maxY=re),re<b.minY&&(b.minY=re)}if(R.type&Ue.DRAWING_COMMANDS&&(Q(B),z(P)),R.type&Ue.HORIZ_LINE_TO&&Q(R.x),R.type&Ue.VERT_LINE_TO&&z(R.y),R.type&Ue.LINE_TO&&(Q(R.x),z(R.y)),R.type&Ue.CURVE_TO){Q(R.x),z(R.y);for(var G=0,X=f6(B,R.x1,R.x2,R.x);G<X.length;G++)0<(ne=X[G])&&1>ne&&Q(p6(B,R.x1,R.x2,R.x,ne));for(var et=0,pt=f6(P,R.y1,R.y2,R.y);et<pt.length;et++)0<(ne=pt[et])&&1>ne&&z(p6(P,R.y1,R.y2,R.y,ne))}if(R.type&Ue.ARC){Q(R.x),z(R.y),_E(R,B,P);for(var gt=R.xRot/180*Math.PI,mt=Math.cos(gt)*R.rX,ft=Math.sin(gt)*R.rX,Mt=-Math.sin(gt)*R.rY,Lt=Math.cos(gt)*R.rY,at=R.phi1<R.phi2?[R.phi1,R.phi2]:-180>R.phi2?[R.phi2+360,R.phi1+360]:[R.phi2,R.phi1],ct=at[0],wt=at[1],_t=function(re){var Be=re[0],it=re[1],bt=180*Math.atan2(it,Be)/Math.PI;return bt<ct?bt+360:bt},Jt=0,Yt=A6(Mt,-mt,0).map(_t);Jt<Yt.length;Jt++)(ne=Yt[Jt])>ct&&ne<wt&&Q(d6(R.cX,mt,Mt,ne));for(var ee=0,$t=A6(Lt,-ft,0).map(_t);ee<$t.length;ee++){var ne;(ne=$t[ee])>ct&&ne<wt&&z(d6(R.cY,ft,Lt,ne))}}return x});return b.minX=1/0,b.maxX=-1/0,b.minY=1/0,b.maxY=-1/0,b}})(gs||(gs={}));var xc,g6=function(){function r(){}return r.prototype.round=function(t){return this.transform(gs.ROUND(t))},r.prototype.toAbs=function(){return this.transform(gs.TO_ABS())},r.prototype.toRel=function(){return this.transform(gs.TO_REL())},r.prototype.normalizeHVZ=function(t,e,n){return this.transform(gs.NORMALIZE_HVZ(t,e,n))},r.prototype.normalizeST=function(){return this.transform(gs.NORMALIZE_ST())},r.prototype.qtToC=function(){return this.transform(gs.QT_TO_C())},r.prototype.aToC=function(){return this.transform(gs.A_TO_C())},r.prototype.sanitize=function(t){return this.transform(gs.SANITIZE(t))},r.prototype.translate=function(t,e){return this.transform(gs.TRANSLATE(t,e))},r.prototype.scale=function(t,e){return this.transform(gs.SCALE(t,e))},r.prototype.rotate=function(t,e,n){return this.transform(gs.ROTATE(t,e,n))},r.prototype.matrix=function(t,e,n,i,s,a){return this.transform(gs.MATRIX(t,e,n,i,s,a))},r.prototype.skewX=function(t){return this.transform(gs.SKEW_X(t))},r.prototype.skewY=function(t){return this.transform(gs.SKEW_Y(t))},r.prototype.xSymmetry=function(t){return this.transform(gs.X_AXIS_SYMMETRY(t))},r.prototype.ySymmetry=function(t){return this.transform(gs.Y_AXIS_SYMMETRY(t))},r.prototype.annotateArcs=function(){return this.transform(gs.ANNOTATE_ARCS())},r}(),mvt=function(r){return r===" "||r==="	"||r==="\r"||r===`
`},m6=function(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57},yvt=function(r){function t(){var e=r.call(this)||this;return e.curNumber="",e.curCommandType=-1,e.curCommandRelative=!1,e.canParseCommandOrComma=!0,e.curNumberHasExp=!1,e.curNumberHasExpDigits=!1,e.curNumberHasDecimal=!1,e.curArgs=[],e}return u6(t,r),t.prototype.finish=function(e){if(e===void 0&&(e=[]),this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e},t.prototype.parse=function(e,n){var i=this;n===void 0&&(n=[]);for(var s=function(b){n.push(b),i.curArgs.length=0,i.canParseCommandOrComma=!0},a=0;a<e.length;a++){var o=e[a],h=!(this.curCommandType!==Ue.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),f=m6(o)&&(this.curNumber==="0"&&o==="0"||h);if(!m6(o)||f)if(o!=="e"&&o!=="E")if(o!=="-"&&o!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(o!=="."||this.curNumberHasExp||this.curNumberHasDecimal||h){if(this.curNumber&&this.curCommandType!==-1){var m=Number(this.curNumber);if(isNaN(m))throw new SyntaxError("Invalid number ending at "+a);if(this.curCommandType===Ue.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>m)throw new SyntaxError('Expected positive number, got "'+m+'" at index "'+a+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+a+'"')}this.curArgs.push(m),this.curArgs.length===_vt[this.curCommandType]&&(Ue.HORIZ_LINE_TO===this.curCommandType?s({type:Ue.HORIZ_LINE_TO,relative:this.curCommandRelative,x:m}):Ue.VERT_LINE_TO===this.curCommandType?s({type:Ue.VERT_LINE_TO,relative:this.curCommandRelative,y:m}):this.curCommandType===Ue.MOVE_TO||this.curCommandType===Ue.LINE_TO||this.curCommandType===Ue.SMOOTH_QUAD_TO?(s({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),Ue.MOVE_TO===this.curCommandType&&(this.curCommandType=Ue.LINE_TO)):this.curCommandType===Ue.CURVE_TO?s({type:Ue.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===Ue.SMOOTH_CURVE_TO?s({type:Ue.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Ue.QUAD_TO?s({type:Ue.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Ue.ARC&&s({type:Ue.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!mvt(o))if(o===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(o!=="+"&&o!=="-"&&o!==".")if(f)this.curNumber=o,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+a+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+o+'" at index '+a+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,o!=="z"&&o!=="Z")if(o==="h"||o==="H")this.curCommandType=Ue.HORIZ_LINE_TO,this.curCommandRelative=o==="h";else if(o==="v"||o==="V")this.curCommandType=Ue.VERT_LINE_TO,this.curCommandRelative=o==="v";else if(o==="m"||o==="M")this.curCommandType=Ue.MOVE_TO,this.curCommandRelative=o==="m";else if(o==="l"||o==="L")this.curCommandType=Ue.LINE_TO,this.curCommandRelative=o==="l";else if(o==="c"||o==="C")this.curCommandType=Ue.CURVE_TO,this.curCommandRelative=o==="c";else if(o==="s"||o==="S")this.curCommandType=Ue.SMOOTH_CURVE_TO,this.curCommandRelative=o==="s";else if(o==="q"||o==="Q")this.curCommandType=Ue.QUAD_TO,this.curCommandRelative=o==="q";else if(o==="t"||o==="T")this.curCommandType=Ue.SMOOTH_QUAD_TO,this.curCommandRelative=o==="t";else{if(o!=="a"&&o!=="A")throw new SyntaxError('Unexpected character "'+o+'" at index '+a+".");this.curCommandType=Ue.ARC,this.curCommandRelative=o==="a"}else n.push({type:Ue.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=o,this.curNumberHasDecimal=o==="."}else this.curNumber+=o,this.curNumberHasDecimal=!0;else this.curNumber+=o;else this.curNumber+=o,this.curNumberHasExp=!0;else this.curNumber+=o,this.curNumberHasExpDigits=this.curNumberHasExp}return n},t.prototype.transform=function(e){return Object.create(this,{parse:{value:function(n,i){i===void 0&&(i=[]);for(var s=0,a=Object.getPrototypeOf(this).parse.call(this,n);s<a.length;s++){var o=a[s],h=e(o);Array.isArray(h)?i.push.apply(i,h):i.push(h)}return i}}})},t}(g6),Ue=function(r){function t(e){var n=r.call(this)||this;return n.commands=typeof e=="string"?t.parse(e):e,n}return u6(t,r),t.prototype.encode=function(){return t.encode(this.commands)},t.prototype.getBounds=function(){var e=gs.CALCULATE_BOUNDS();return this.transform(e),e},t.prototype.transform=function(e){for(var n=[],i=0,s=this.commands;i<s.length;i++){var a=e(s[i]);Array.isArray(a)?n.push.apply(n,a):n.push(a)}return this.commands=n,this},t.encode=function(e){return gvt(e)},t.parse=function(e){var n=new yvt,i=[];return n.parse(e,i),n.finish(i),i},t.CLOSE_PATH=1,t.MOVE_TO=2,t.HORIZ_LINE_TO=4,t.VERT_LINE_TO=8,t.LINE_TO=16,t.CURVE_TO=32,t.SMOOTH_CURVE_TO=64,t.QUAD_TO=128,t.SMOOTH_QUAD_TO=256,t.ARC=512,t.LINE_COMMANDS=t.LINE_TO|t.HORIZ_LINE_TO|t.VERT_LINE_TO,t.DRAWING_COMMANDS=t.HORIZ_LINE_TO|t.VERT_LINE_TO|t.LINE_TO|t.CURVE_TO|t.SMOOTH_CURVE_TO|t.QUAD_TO|t.SMOOTH_QUAD_TO|t.ARC,t}(g6),_vt=((xc={})[Ue.MOVE_TO]=2,xc[Ue.LINE_TO]=2,xc[Ue.HORIZ_LINE_TO]=1,xc[Ue.VERT_LINE_TO]=1,xc[Ue.CLOSE_PATH]=0,xc[Ue.QUAD_TO]=4,xc[Ue.SMOOTH_QUAD_TO]=2,xc[Ue.CURVE_TO]=6,xc[Ue.SMOOTH_CURVE_TO]=4,xc[Ue.ARC]=7,xc),vvt=Ys,bvt=bc,wvt=W1,xvt=YO,y6=RegExp.prototype,Bvt=function(r){var t=r.flags;return t===void 0&&!("flags"in y6)&&!bvt(r,"flags")&&wvt(y6,r)?vvt(xvt,r):t},Cvt=e_.PROPER,Evt=dd,Svt=Vo,_6=ou,Tvt=ns,Ivt=Bvt,vE="toString",v6=RegExp.prototype,b6=v6[vE],Fvt=Tvt(function(){return b6.call({source:"a",flags:"b"})!=="/a/b"}),Lvt=Cvt&&b6.name!==vE;(Fvt||Lvt)&&Evt(v6,vE,function(){var r=Svt(this),t=_6(r.source),e=_6(Ivt(r));return"/"+t+"/"+e},{unsafe:!0});function M_(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?M_=function(t){return typeof t}:M_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M_(r)}function Pvt(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}var Mvt=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Uvt=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function Rvt(r,t,e,n,i){if(typeof r=="string"&&(r=document.getElementById(r)),!r||M_(r)!=="object"||!("getContext"in r))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var s=r.getContext("2d");try{return s.getImageData(t,e,n,i)}catch(a){throw new Error("unable to access image data: "+a)}}function Ovt(r,t,e,n,i,s){if(!(isNaN(s)||s<1)){s|=0;var a=Rvt(r,t,e,n,i);a=Dvt(a,t,e,n,i,s),r.getContext("2d").putImageData(a,t,e)}}function Dvt(r,t,e,n,i,s){for(var a=r.data,o=2*s+1,h=n-1,f=i-1,m=s+1,b=m*(m+1)/2,x=new w6,B=x,P,R=1;R<o;R++)B=B.next=new w6,R===m&&(P=B);B.next=x;for(var Q=null,z=null,G=0,X=0,et=Mvt[s],pt=Uvt[s],gt=0;gt<i;gt++){B=x;for(var mt=a[X],ft=a[X+1],Mt=a[X+2],Lt=a[X+3],at=0;at<m;at++)B.r=mt,B.g=ft,B.b=Mt,B.a=Lt,B=B.next;for(var ct=0,wt=0,_t=0,Jt=0,Yt=m*mt,ee=m*ft,$t=m*Mt,ne=m*Lt,re=b*mt,Be=b*ft,it=b*Mt,bt=b*Lt,Pt=1;Pt<m;Pt++){var Ot=X+((h<Pt?h:Pt)<<2),qt=a[Ot],Gt=a[Ot+1],oe=a[Ot+2],ie=a[Ot+3],Ce=m-Pt;re+=(B.r=qt)*Ce,Be+=(B.g=Gt)*Ce,it+=(B.b=oe)*Ce,bt+=(B.a=ie)*Ce,ct+=qt,wt+=Gt,_t+=oe,Jt+=ie,B=B.next}Q=x,z=P;for(var Fe=0;Fe<n;Fe++){var Re=bt*et>>>pt;if(a[X+3]=Re,Re!==0){var Ne=255/Re;a[X]=(re*et>>>pt)*Ne,a[X+1]=(Be*et>>>pt)*Ne,a[X+2]=(it*et>>>pt)*Ne}else a[X]=a[X+1]=a[X+2]=0;re-=Yt,Be-=ee,it-=$t,bt-=ne,Yt-=Q.r,ee-=Q.g,$t-=Q.b,ne-=Q.a;var ke=Fe+s+1;ke=G+(ke<h?ke:h)<<2,ct+=Q.r=a[ke],wt+=Q.g=a[ke+1],_t+=Q.b=a[ke+2],Jt+=Q.a=a[ke+3],re+=ct,Be+=wt,it+=_t,bt+=Jt,Q=Q.next;var fe=z,lt=fe.r,pr=fe.g,er=fe.b,pe=fe.a;Yt+=lt,ee+=pr,$t+=er,ne+=pe,ct-=lt,wt-=pr,_t-=er,Jt-=pe,z=z.next,X+=4}G+=n}for(var we=0;we<n;we++){X=we<<2;var Ie=a[X],Oe=a[X+1],nr=a[X+2],hr=a[X+3],Sr=m*Ie,Mr=m*Oe,kr=m*nr,ye=m*hr,or=b*Ie,xr=b*Oe,De=b*nr,pn=b*hr;B=x;for(var ge=0;ge<m;ge++)B.r=Ie,B.g=Oe,B.b=nr,B.a=hr,B=B.next;for(var yr=n,je=0,Rr=0,cn=0,He=0,Kn=1;Kn<=s;Kn++){X=yr+we<<2;var sn=m-Kn;or+=(B.r=Ie=a[X])*sn,xr+=(B.g=Oe=a[X+1])*sn,De+=(B.b=nr=a[X+2])*sn,pn+=(B.a=hr=a[X+3])*sn,He+=Ie,je+=Oe,Rr+=nr,cn+=hr,B=B.next,Kn<f&&(yr+=n)}X=we,Q=x,z=P;for(var Jr=0;Jr<i;Jr++){var Bt=X<<2;a[Bt+3]=hr=pn*et>>>pt,hr>0?(hr=255/hr,a[Bt]=(or*et>>>pt)*hr,a[Bt+1]=(xr*et>>>pt)*hr,a[Bt+2]=(De*et>>>pt)*hr):a[Bt]=a[Bt+1]=a[Bt+2]=0,or-=Sr,xr-=Mr,De-=kr,pn-=ye,Sr-=Q.r,Mr-=Q.g,kr-=Q.b,ye-=Q.a,Bt=we+((Bt=Jr+m)<f?Bt:f)*n<<2,or+=He+=Q.r=a[Bt],xr+=je+=Q.g=a[Bt+1],De+=Rr+=Q.b=a[Bt+2],pn+=cn+=Q.a=a[Bt+3],Q=Q.next,Sr+=Ie=z.r,Mr+=Oe=z.g,kr+=nr=z.b,ye+=hr=z.a,He-=Ie,je-=Oe,Rr-=nr,cn-=hr,z=z.next,X+=n}}return r}var w6=function r(){Pvt(this,r),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function Nvt(){var{DOMParser:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:r,createCanvas(e,n){return new OffscreenCanvas(e,n)},createImage(e){return eA(function*(){var n=yield fetch(e),i=yield n.blob(),s=yield createImageBitmap(i);return s})()}};return(typeof DOMParser<"u"||typeof r>"u")&&Reflect.deleteProperty(t,"DOMParser"),t}function kvt(r){var{DOMParser:t,canvas:e,fetch:n}=r;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:t,fetch:n,createCanvas:e.createCanvas,createImage:e.loadImage}}var Qvt=Object.freeze({__proto__:null,offscreen:Nvt,node:kvt});function yd(r){return r.replace(/(?!\u3000)\s+/gm," ")}function x6(r){return r.replace(/^[\n \t]+/,"")}function B6(r){return r.replace(/[\n \t]+$/,"")}function pa(r){var t=(r||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return t.map(parseFloat)}var Hvt=/^[A-Z-]+$/;function C6(r){return Hvt.test(r)?r.toLowerCase():r}function bE(r){var t=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(r)||[];return t[2]||t[3]||t[4]}function E6(r){if(!r.startsWith("rgb"))return r;var t=3,e=r.replace(/\d+(\.\d+)?/g,(n,i)=>t--&&i?String(Math.round(parseFloat(n))):n);return e}var zvt=/(\[[^\]]+\])/g,Vvt=/(#[^\s+>~.[:]+)/g,Gvt=/(\.[^\s+>~.[:]+)/g,jvt=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,qvt=/(:[\w-]+\([^)]*\))/gi,Kvt=/(:[^\s+>~.[:]+)/g,Wvt=/([^\s+>~.[:]+)/g;function _d(r,t){var e=t.exec(r);return e?[r.replace(t," "),e.length]:[r,0]}function S6(r){var t=[0,0,0],e=r.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),n=0;return[e,n]=_d(e,zvt),t[1]+=n,[e,n]=_d(e,Vvt),t[0]+=n,[e,n]=_d(e,Gvt),t[1]+=n,[e,n]=_d(e,jvt),t[2]+=n,[e,n]=_d(e,qvt),t[1]+=n,[e,n]=_d(e,Kvt),t[1]+=n,e=e.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[e,n]=_d(e,Wvt),t[2]+=n,t.join("")}var vd=1e-8;function wE(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2))}function U_(r,t){return(r[0]*t[0]+r[1]*t[1])/(wE(r)*wE(t))}function xE(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(U_(r,t))}function BE(r){return r*r*r}function CE(r){return 3*r*r*(1-r)}function EE(r){return 3*r*(1-r)*(1-r)}function SE(r){return(1-r)*(1-r)*(1-r)}function TE(r){return r*r}function IE(r){return 2*r*(1-r)}function FE(r){return(1-r)*(1-r)}class Nr{constructor(t,e,n){this.document=t,this.name=e,this.value=n,this.isNormalizedColor=!1}static empty(t){return new Nr(t,"EMPTY","")}split(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:e,name:n}=this;return yd(this.getString()).trim().split(t).map(i=>new Nr(e,n,i))}hasValue(t){var{value:e}=this;return e!==null&&e!==""&&(t||e!==0)&&typeof e<"u"}isString(t){var{value:e}=this,n=typeof e=="string";return!n||!t?n:t.test(e)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var t=this.getString();switch(!0){case t.endsWith("px"):case/^[0-9]+$/.test(t):return!0;default:return!1}}setValue(t){return this.value=t,this}getValue(t){return typeof t>"u"||this.hasValue()?this.value:t}getNumber(t){if(!this.hasValue())return typeof t>"u"?0:parseFloat(t);var{value:e}=this,n=parseFloat(e);return this.isString(/%$/)&&(n/=100),n}getString(t){return typeof t>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(t)}getColor(t){var e=this.getString(t);return this.isNormalizedColor||(this.isNormalizedColor=!0,e=E6(e),this.value=e),e}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[n,i]=typeof t=="boolean"?[void 0,t]:[t],{viewPort:s}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(s.computeSize("x"),s.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(s.computeSize("x"),s.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*s.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*s.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&i):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*s.computeSize(n);default:{var a=this.getNumber();return e&&a<1?a*s.computeSize(n):a}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var t=this.getString(),e=/#([^)'"]+)/.exec(t);return e&&(e=e[1]),e||(e=t),this.document.definitions[e]}getFillStyleDefinition(t,e){var n=this.getDefinition();if(!n)return null;if(typeof n.createGradient=="function")return n.createGradient(this.document.ctx,t,e);if(typeof n.createPattern=="function"){if(n.getHrefAttribute().hasValue()){var i=n.getAttribute("patternTransform");n=n.getHrefAttribute().getDefinition(),i.hasValue()&&n.getAttribute("patternTransform",!0).setValue(i.value)}return n.createPattern(this.document.ctx,t,e)}return null}getTextBaseline(){return this.hasValue()?Nr.textBaselineMapping[this.getString()]:null}addOpacity(t){for(var e=this.getColor(),n=e.length,i=0,s=0;s<n&&(e[s]===","&&i++,i!==3);s++);if(t.hasValue()&&this.isString()&&i!==3){var a=new gE(e);a.ok&&(a.alpha=t.getNumber(),e=a.toRGBA())}return new Nr(this.document,this.name,e)}}Nr.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class T6{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(t,e){this.viewPorts.push({width:t,height:e})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:t}=this;return t[t.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(t){return typeof t=="number"?t:t==="x"?this.width:t==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class Hi{constructor(t,e){this.x=t,this.y=e}static parse(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[n=e,i=e]=pa(t);return new Hi(n,i)}static parseScale(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[n=e,i=n]=pa(t);return new Hi(n,i)}static parsePath(t){for(var e=pa(t),n=e.length,i=[],s=0;s<n;s+=2)i.push(new Hi(e[s],e[s+1]));return i}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}applyTransform(t){var{x:e,y:n}=this,i=e*t[0]+n*t[2]+t[4],s=e*t[1]+n*t[3]+t[5];this.x=i,this.y=s}}class I6{constructor(t){this.screen=t,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:t,onClick:e,onMouseMove:n}=this,i=t.ctx.canvas;i.onclick=e,i.onmousemove=n,this.working=!0}}stop(){if(this.working){var t=this.screen.ctx.canvas;this.working=!1,t.onclick=null,t.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:t,events:e,eventElements:n}=this,{style:i}=t.ctx.canvas;i&&(i.cursor=""),e.forEach((s,a)=>{for(var{run:o}=s,h=n[a];h;)o(h),h=h.parent}),this.events=[],this.eventElements=[]}}checkPath(t,e){if(!(!this.working||!e)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:h}=s;!i[a]&&e.isPointInPath&&e.isPointInPath(o,h)&&(i[a]=t)})}}checkBoundingBox(t,e){if(!(!this.working||!e)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:h}=s;!i[a]&&e.isPointInBox(o,h)&&(i[a]=t)})}}mapXY(t,e){for(var{window:n,ctx:i}=this.screen,s=new Hi(t,e),a=i.canvas;a;)s.x-=a.offsetLeft,s.y-=a.offsetTop,a=a.offsetParent;return n.scrollX&&(s.x+=n.scrollX),n.scrollY&&(s.y+=n.scrollY),s}onClick(t){var{x:e,y:n}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onclick",x:e,y:n,run(i){i.onClick&&i.onClick()}})}onMouseMove(t){var{x:e,y:n}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onmousemove",x:e,y:n,run(i){i.onMouseMove&&i.onMouseMove()}})}}var F6=typeof window<"u"?window:null,L6=typeof fetch<"u"?fetch.bind(void 0):null;class Om{constructor(t){var{fetch:e=L6,window:n=F6}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=t,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new T6,this.mouse=new I6(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=n,this.fetch=e}wait(t){this.waits.push(t)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var t=this.waits.every(e=>e());return t&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=t,t}setDefaults(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4}setViewBox(t){var{document:e,ctx:n,aspectRatio:i,width:s,desiredWidth:a,height:o,desiredHeight:h,minX:f=0,minY:m=0,refX:b,refY:x,clip:B=!1,clipX:P=0,clipY:R=0}=t,Q=yd(i).replace(/^defer\s/,""),[z,G]=Q.split(" "),X=z||"xMidYMid",et=G||"meet",pt=s/a,gt=o/h,mt=Math.min(pt,gt),ft=Math.max(pt,gt),Mt=a,Lt=h;et==="meet"&&(Mt*=mt,Lt*=mt),et==="slice"&&(Mt*=ft,Lt*=ft);var at=new Nr(e,"refX",b),ct=new Nr(e,"refY",x),wt=at.hasValue()&&ct.hasValue();if(wt&&n.translate(-mt*at.getPixels("x"),-mt*ct.getPixels("y")),B){var _t=mt*P,Jt=mt*R;n.beginPath(),n.moveTo(_t,Jt),n.lineTo(s,Jt),n.lineTo(s,o),n.lineTo(_t,o),n.closePath(),n.clip()}if(!wt){var Yt=et==="meet"&&mt===gt,ee=et==="slice"&&ft===gt,$t=et==="meet"&&mt===pt,ne=et==="slice"&&ft===pt;X.startsWith("xMid")&&(Yt||ee)&&n.translate(s/2-Mt/2,0),X.endsWith("YMid")&&($t||ne)&&n.translate(0,o/2-Lt/2),X.startsWith("xMax")&&(Yt||ee)&&n.translate(s-Mt,0),X.endsWith("YMax")&&($t||ne)&&n.translate(0,o-Lt)}switch(!0){case X==="none":n.scale(pt,gt);break;case et==="meet":n.scale(mt,mt);break;case et==="slice":n.scale(ft,ft);break}n.translate(-f,-m)}start(t){var{enableRedraw:e=!1,ignoreMouse:n=!1,ignoreAnimation:i=!1,ignoreDimensions:s=!1,ignoreClear:a=!1,forceRedraw:o,scaleWidth:h,scaleHeight:f,offsetX:m,offsetY:b}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:x,mouse:B}=this,P=1e3/x;if(this.frameDuration=P,this.readyPromise=new Promise(X=>{this.resolveReady=X}),this.isReady()&&this.render(t,s,a,h,f,m,b),!!e){var R=Date.now(),Q=R,z=0,G=()=>{R=Date.now(),z=R-Q,z>=P&&(Q=R-z%P,this.shouldUpdate(i,o)&&(this.render(t,s,a,h,f,m,b),B.runEvents())),this.intervalId=dE(G)};n||B.start(),this.intervalId=dE(G)}}stop(){this.intervalId&&(dE.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(t,e){if(!t){var{frameDuration:n}=this,i=this.animations.reduce((s,a)=>a.update(n)||s,!1);if(i)return!0}return!!(typeof e=="function"&&e()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(t,e,n,i,s,a,o){var{CLIENT_WIDTH:h,CLIENT_HEIGHT:f,viewPort:m,ctx:b,isFirstRender:x}=this,B=b.canvas;m.clear(),B.width&&B.height?m.setCurrent(B.width,B.height):m.setCurrent(h,f);var P=t.getStyle("width"),R=t.getStyle("height");!e&&(x||typeof i!="number"&&typeof s!="number")&&(P.hasValue()&&(B.width=P.getPixels("x"),B.style&&(B.style.width="".concat(B.width,"px"))),R.hasValue()&&(B.height=R.getPixels("y"),B.style&&(B.style.height="".concat(B.height,"px"))));var Q=B.clientWidth||B.width,z=B.clientHeight||B.height;if(e&&P.hasValue()&&R.hasValue()&&(Q=P.getPixels("x"),z=R.getPixels("y")),m.setCurrent(Q,z),typeof a=="number"&&t.getAttribute("x",!0).setValue(a),typeof o=="number"&&t.getAttribute("y",!0).setValue(o),typeof i=="number"||typeof s=="number"){var G=pa(t.getAttribute("viewBox").getString()),X=0,et=0;if(typeof i=="number"){var pt=t.getStyle("width");pt.hasValue()?X=pt.getPixels("x")/i:isNaN(G[2])||(X=G[2]/i)}if(typeof s=="number"){var gt=t.getStyle("height");gt.hasValue()?et=gt.getPixels("y")/s:isNaN(G[3])||(et=G[3]/s)}X||(X=et),et||(et=X),t.getAttribute("width",!0).setValue(i),t.getAttribute("height",!0).setValue(s);var mt=t.getStyle("transform",!0,!0);mt.setValue("".concat(mt.getString()," scale(").concat(1/X,", ").concat(1/et,")"))}n||b.clearRect(0,0,Q,z),t.render(b),x&&(this.isFirstRender=!1)}}Om.defaultWindow=F6,Om.defaultFetch=L6;var{defaultFetch:$vt}=Om,Xvt=typeof DOMParser<"u"?DOMParser:null;class R_{constructor(){var{fetch:t=$vt,DOMParser:e=Xvt}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=t,this.DOMParser=e}parse(t){var e=this;return eA(function*(){return t.startsWith("<")?e.parseFromString(t):e.load(t)})()}parseFromString(t){var e=new this.DOMParser;try{return this.checkDocument(e.parseFromString(t,"image/svg+xml"))}catch{return this.checkDocument(e.parseFromString(t,"text/xml"))}}checkDocument(t){var e=t.getElementsByTagName("parsererror")[0];if(e)throw new Error(e.textContent);return t}load(t){var e=this;return eA(function*(){var n=yield e.fetch(t),i=yield n.text();return e.parseFromString(i)})()}}class P6{constructor(t,e){this.type="translate",this.point=null,this.point=Hi.parse(e)}apply(t){var{x:e,y:n}=this.point;t.translate(e||0,n||0)}unapply(t){var{x:e,y:n}=this.point;t.translate(-1*e||0,-1*n||0)}applyToPoint(t){var{x:e,y:n}=this.point;t.applyTransform([1,0,0,1,e||0,n||0])}}class M6{constructor(t,e,n){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var i=pa(e);this.angle=new Nr(t,"angle",i[0]),this.originX=n[0],this.originY=n[1],this.cx=i[1]||0,this.cy=i[2]||0}apply(t){var{cx:e,cy:n,originX:i,originY:s,angle:a}=this,o=e+i.getPixels("x"),h=n+s.getPixels("y");t.translate(o,h),t.rotate(a.getRadians()),t.translate(-o,-h)}unapply(t){var{cx:e,cy:n,originX:i,originY:s,angle:a}=this,o=e+i.getPixels("x"),h=n+s.getPixels("y");t.translate(o,h),t.rotate(-1*a.getRadians()),t.translate(-o,-h)}applyToPoint(t){var{cx:e,cy:n,angle:i}=this,s=i.getRadians();t.applyTransform([1,0,0,1,e||0,n||0]),t.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]),t.applyTransform([1,0,0,1,-e||0,-n||0])}}class U6{constructor(t,e,n){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var i=Hi.parseScale(e);(i.x===0||i.y===0)&&(i.x=vd,i.y=vd),this.scale=i,this.originX=n[0],this.originY=n[1]}apply(t){var{scale:{x:e,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");t.translate(a,o),t.scale(e,n||e),t.translate(-a,-o)}unapply(t){var{scale:{x:e,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");t.translate(a,o),t.scale(1/e,1/n||e),t.translate(-a,-o)}applyToPoint(t){var{x:e,y:n}=this.scale;t.applyTransform([e||0,0,0,n||0,0,0])}}class LE{constructor(t,e,n){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=pa(e),this.originX=n[0],this.originY=n[1]}apply(t){var{originX:e,originY:n,matrix:i}=this,s=e.getPixels("x"),a=n.getPixels("y");t.translate(s,a),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t.translate(-s,-a)}unapply(t){var{originX:e,originY:n,matrix:i}=this,s=i[0],a=i[2],o=i[4],h=i[1],f=i[3],m=i[5],b=0,x=0,B=1,P=1/(s*(f*B-m*x)-a*(h*B-m*b)+o*(h*x-f*b)),R=e.getPixels("x"),Q=n.getPixels("y");t.translate(R,Q),t.transform(P*(f*B-m*x),P*(m*b-h*B),P*(o*x-a*B),P*(s*B-o*b),P*(a*m-o*f),P*(o*h-s*m)),t.translate(-R,-Q)}applyToPoint(t){t.applyTransform(this.matrix)}}class PE extends LE{constructor(t,e,n){super(t,e,n),this.type="skew",this.angle=null,this.angle=new Nr(t,"angle",e)}}class R6 extends PE{constructor(t,e,n){super(t,e,n),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class O6 extends PE{constructor(t,e,n){super(t,e,n),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function Jvt(r){return yd(r).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function Yvt(r){var[t,e]=r.split("(");return[t.trim(),e.trim().replace(")","")]}class ah{constructor(t,e,n){this.document=t,this.transforms=[];var i=Jvt(e);i.forEach(s=>{if(s!=="none"){var[a,o]=Yvt(s),h=ah.transformTypes[a];typeof h<"u"&&this.transforms.push(new h(this.document,o,n))}})}static fromElement(t,e){var n=e.getStyle("transform",!1,!0),[i,s=i]=e.getStyle("transform-origin",!1,!0).split(),a=[i,s];return n.hasValue()?new ah(t,n.getString(),a):null}apply(t){for(var{transforms:e}=this,n=e.length,i=0;i<n;i++)e[i].apply(t)}unapply(t){for(var{transforms:e}=this,n=e.length,i=n-1;i>=0;i--)e[i].unapply(t)}applyToPoint(t){for(var{transforms:e}=this,n=e.length,i=0;i<n;i++)e[i].applyToPoint(t)}}ah.transformTypes={translate:P6,rotate:M6,scale:U6,matrix:LE,skewX:R6,skewY:O6};class mi{constructor(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=t,this.node=e,this.captureTextNodes=n,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!e||e.nodeType!==1)){if(Array.from(e.attributes).forEach(o=>{var h=C6(o.nodeName);this.attributes[h]=new Nr(t,h,o.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var i=this.getAttribute("style").getString().split(";").map(o=>o.trim());i.forEach(o=>{if(o){var[h,f]=o.split(":").map(m=>m.trim());this.styles[h]=new Nr(t,h,f)}})}var{definitions:s}=t,a=this.getAttribute("id");a.hasValue()&&(s[a.getString()]||(s[a.getString()]=this)),Array.from(e.childNodes).forEach(o=>{if(o.nodeType===1)this.addChild(o);else if(n&&(o.nodeType===3||o.nodeType===4)){var h=t.createTextNode(o);h.getText().length>0&&this.addChild(h)}})}}getAttribute(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.attributes[t];if(!n&&e){var i=new Nr(this.document,t,"");return this.attributes[t]=i,i}return n||Nr.empty(this.document)}getHrefAttribute(){for(var t in this.attributes)if(t==="href"||t.endsWith(":href"))return this.attributes[t];return Nr.empty(this.document)}getStyle(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.styles[t];if(i)return i;var s=this.getAttribute(t);if(s!=null&&s.hasValue())return this.styles[t]=s,s;if(!n){var{parent:a}=this;if(a){var o=a.getStyle(t);if(o!=null&&o.hasValue())return o}}if(e){var h=new Nr(this.document,t,"");return this.styles[t]=h,h}return i||Nr.empty(this.document)}render(t){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(t.save(),this.getStyle("mask").hasValue()){var e=this.getStyle("mask").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var n=this.getStyle("filter").getDefinition();n&&(this.applyEffects(t),n.apply(t,this))}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}}setContext(t){}applyEffects(t){var e=ah.fromElement(this.document,this);e&&e.apply(t);var n=this.getStyle("clip-path",!1,!0);if(n.hasValue()){var i=n.getDefinition();i&&i.apply(t)}}clearContext(t){}renderChildren(t){this.children.forEach(e=>{e.render(t)})}addChild(t){var e=t instanceof mi?t:this.document.createElement(t);e.parent=this,mi.ignoreChildTypes.includes(e.type)||this.children.push(e)}matchesSelector(t){var e,{node:n}=this;if(typeof n.matches=="function")return n.matches(t);var i=(e=n.getAttribute)===null||e===void 0?void 0:e.call(n,"class");return!i||i===""?!1:i.split(" ").some(s=>".".concat(s)===t)}addStylesFromStyleDefinition(){var{styles:t,stylesSpecificity:e}=this.document;for(var n in t)if(!n.startsWith("@")&&this.matchesSelector(n)){var i=t[n],s=e[n];if(i)for(var a in i){var o=this.stylesSpecificity[a];typeof o>"u"&&(o="000"),s>=o&&(this.styles[a]=i[a],this.stylesSpecificity[a]=s)}}}removeStyles(t,e){var n=e.reduce((i,s)=>{var a=t.getStyle(s);if(!a.hasValue())return i;var o=a.getString();return a.setValue(""),[...i,[s,o]]},[]);return n}restoreStyles(t,e){e.forEach(n=>{var[i,s]=n;t.getStyle(i,!0).setValue(s)})}isFirstChild(){var t;return((t=this.parent)===null||t===void 0?void 0:t.children.indexOf(this))===0}}mi.ignoreChildTypes=["title"];class D6 extends mi{constructor(t,e,n){super(t,e,n)}}function Zvt(r){var t=r.trim();return/^('|")/.test(t)?t:'"'.concat(t,'"')}function tbt(r){return typeof process>"u"?r:r.trim().split(",").map(Zvt).join(",")}function ebt(r){if(!r)return"";var t=r.trim().toLowerCase();switch(t){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return t;default:return/^oblique\s+(-|)\d+deg$/.test(t)?t:""}}function rbt(r){if(!r)return"";var t=r.trim().toLowerCase();switch(t){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return t;default:return/^[\d.]+$/.test(t)?t:""}}class bo{constructor(t,e,n,i,s,a){var o=a?typeof a=="string"?bo.parse(a):a:{};this.fontFamily=s||o.fontFamily,this.fontSize=i||o.fontSize,this.fontStyle=t||o.fontStyle,this.fontWeight=n||o.fontWeight,this.fontVariant=e||o.fontVariant}static parse(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n="",i="",s="",a="",o="",h=yd(t).trim().split(" "),f={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return h.forEach(m=>{switch(!0){case(!f.fontStyle&&bo.styles.includes(m)):m!=="inherit"&&(n=m),f.fontStyle=!0;break;case(!f.fontVariant&&bo.variants.includes(m)):m!=="inherit"&&(i=m),f.fontStyle=!0,f.fontVariant=!0;break;case(!f.fontWeight&&bo.weights.includes(m)):m!=="inherit"&&(s=m),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0;break;case!f.fontSize:m!=="inherit"&&([a]=m.split("/")),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0,f.fontSize=!0;break;default:m!=="inherit"&&(o+=m)}}),new bo(n,i,s,a,o,e)}toString(){return[ebt(this.fontStyle),this.fontVariant,rbt(this.fontWeight),this.fontSize,tbt(this.fontFamily)].join(" ").trim()}}bo.styles="normal|italic|oblique|inherit",bo.variants="normal|small-caps|inherit",bo.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class Tl{constructor(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=t,this.y1=e,this.x2=n,this.y2=i,this.addPoint(t,e),this.addPoint(n,i)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(t,e){typeof t<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))}addX(t){this.addPoint(t,null)}addY(t){this.addPoint(null,t)}addBoundingBox(t){if(t){var{x1:e,y1:n,x2:i,y2:s}=t;this.addPoint(e,n),this.addPoint(i,s)}}sumCubic(t,e,n,i,s){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*n+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*s}bezierCurveAdd(t,e,n,i,s){var a=6*e-12*n+6*i,o=-3*e+9*n-9*i+3*s,h=3*n-3*e;if(o===0){if(a===0)return;var f=-h/a;0<f&&f<1&&(t?this.addX(this.sumCubic(f,e,n,i,s)):this.addY(this.sumCubic(f,e,n,i,s)));return}var m=Math.pow(a,2)-4*h*o;if(!(m<0)){var b=(-a+Math.sqrt(m))/(2*o);0<b&&b<1&&(t?this.addX(this.sumCubic(b,e,n,i,s)):this.addY(this.sumCubic(b,e,n,i,s)));var x=(-a-Math.sqrt(m))/(2*o);0<x&&x<1&&(t?this.addX(this.sumCubic(x,e,n,i,s)):this.addY(this.sumCubic(x,e,n,i,s)))}}addBezierCurve(t,e,n,i,s,a,o,h){this.addPoint(t,e),this.addPoint(o,h),this.bezierCurveAdd(!0,t,n,s,o),this.bezierCurveAdd(!1,e,i,a,h)}addQuadraticCurve(t,e,n,i,s,a){var o=t+.6666666666666666*(n-t),h=e+2/3*(i-e),f=o+1/3*(s-t),m=h+1/3*(a-e);this.addBezierCurve(t,e,o,f,h,m,s,a)}isPointInBox(t,e){var{x1:n,y1:i,x2:s,y2:a}=this;return n<=t&&t<=s&&i<=e&&e<=a}}class nn extends Ue{constructor(t){super(t.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new Hi(0,0),this.control=new Hi(0,0),this.current=new Hi(0,0),this.points=[],this.angles=[]}isEnd(){var{i:t,commands:e}=this;return t>=e.length-1}next(){var t=this.commands[++this.i];return this.previousCommand=this.command,this.command=t,t}getPoint(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",n=new Hi(this.command[t],this.command[e]);return this.makeAbsolute(n)}getAsControlPoint(t,e){var n=this.getPoint(t,e);return this.control=n,n}getAsCurrentPoint(t,e){var n=this.getPoint(t,e);return this.current=n,n}getReflectedControlPoint(){var t=this.previousCommand.type;if(t!==Ue.CURVE_TO&&t!==Ue.SMOOTH_CURVE_TO&&t!==Ue.QUAD_TO&&t!==Ue.SMOOTH_QUAD_TO)return this.current;var{current:{x:e,y:n},control:{x:i,y:s}}=this,a=new Hi(2*e-i,2*n-s);return a}makeAbsolute(t){if(this.command.relative){var{x:e,y:n}=this.current;t.x+=e,t.y+=n}return t}addMarker(t,e,n){var{points:i,angles:s}=this;n&&s.length>0&&!s[s.length-1]&&(s[s.length-1]=i[i.length-1].angleTo(n)),this.addMarkerAngle(t,e?e.angleTo(t):null)}addMarkerAngle(t,e){this.points.push(t),this.angles.push(e)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:t}=this,e=t.length,n=0;n<e;n++)if(!t[n]){for(var i=n+1;i<e;i++)if(t[i]){t[n]=t[i];break}}return t}}class lh extends mi{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var t=1,e=this;e;){var n=e.getStyle("opacity",!1,!0);n.hasValue(!0)&&(t*=n.getNumber()),e=e.parent}return t}setContext(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e){var n=this.getStyle("fill"),i=this.getStyle("fill-opacity"),s=this.getStyle("stroke"),a=this.getStyle("stroke-opacity");if(n.isUrlDefinition()){var o=n.getFillStyleDefinition(this,i);o&&(t.fillStyle=o)}else if(n.hasValue()){n.getString()==="currentColor"&&n.setValue(this.getStyle("color").getColor());var h=n.getColor();h!=="inherit"&&(t.fillStyle=h==="none"?"rgba(0,0,0,0)":h)}if(i.hasValue()){var f=new Nr(this.document,"fill",t.fillStyle).addOpacity(i).getColor();t.fillStyle=f}if(s.isUrlDefinition()){var m=s.getFillStyleDefinition(this,a);m&&(t.strokeStyle=m)}else if(s.hasValue()){s.getString()==="currentColor"&&s.setValue(this.getStyle("color").getColor());var b=s.getString();b!=="inherit"&&(t.strokeStyle=b==="none"?"rgba(0,0,0,0)":b)}if(a.hasValue()){var x=new Nr(this.document,"stroke",t.strokeStyle).addOpacity(a).getString();t.strokeStyle=x}var B=this.getStyle("stroke-width");if(B.hasValue()){var P=B.getPixels();t.lineWidth=P||vd}var R=this.getStyle("stroke-linecap"),Q=this.getStyle("stroke-linejoin"),z=this.getStyle("stroke-miterlimit"),G=this.getStyle("stroke-dasharray"),X=this.getStyle("stroke-dashoffset");if(R.hasValue()&&(t.lineCap=R.getString()),Q.hasValue()&&(t.lineJoin=Q.getString()),z.hasValue()&&(t.miterLimit=z.getNumber()),G.hasValue()&&G.getString()!=="none"){var et=pa(G.getString());typeof t.setLineDash<"u"?t.setLineDash(et):typeof t.webkitLineDash<"u"?t.webkitLineDash=et:typeof t.mozDash<"u"&&!(et.length===1&&et[0]===0)&&(t.mozDash=et);var pt=X.getPixels();typeof t.lineDashOffset<"u"?t.lineDashOffset=pt:typeof t.webkitLineDashOffset<"u"?t.webkitLineDashOffset=pt:typeof t.mozDashOffset<"u"&&(t.mozDashOffset=pt)}}if(this.modifiedEmSizeStack=!1,typeof t.font<"u"){var gt=this.getStyle("font"),mt=this.getStyle("font-style"),ft=this.getStyle("font-variant"),Mt=this.getStyle("font-weight"),Lt=this.getStyle("font-size"),at=this.getStyle("font-family"),ct=new bo(mt.getString(),ft.getString(),Mt.getString(),Lt.hasValue()?"".concat(Lt.getPixels(!0),"px"):"",at.getString(),bo.parse(gt.getString(),t.font));mt.setValue(ct.fontStyle),ft.setValue(ct.fontVariant),Mt.setValue(ct.fontWeight),Lt.setValue(ct.fontSize),at.setValue(ct.fontFamily),t.font=ct.toString(),Lt.isPixels()&&(this.document.emSize=Lt.getPixels(),this.modifiedEmSizeStack=!0)}e||(this.applyEffects(t),t.globalAlpha=this.calculateOpacity())}clearContext(t){super.clearContext(t),this.modifiedEmSizeStack&&this.document.popEmSize()}}class qn extends lh{constructor(t,e,n){super(t,e,n),this.type="path",this.pathParser=null,this.pathParser=new nn(this.getAttribute("d").getString())}path(t){var{pathParser:e}=this,n=new Tl;for(e.reset(),t&&t.beginPath();!e.isEnd();)switch(e.next().type){case nn.MOVE_TO:this.pathM(t,n);break;case nn.LINE_TO:this.pathL(t,n);break;case nn.HORIZ_LINE_TO:this.pathH(t,n);break;case nn.VERT_LINE_TO:this.pathV(t,n);break;case nn.CURVE_TO:this.pathC(t,n);break;case nn.SMOOTH_CURVE_TO:this.pathS(t,n);break;case nn.QUAD_TO:this.pathQ(t,n);break;case nn.SMOOTH_QUAD_TO:this.pathT(t,n);break;case nn.ARC:this.pathA(t,n);break;case nn.CLOSE_PATH:this.pathZ(t,n);break}return n}getBoundingBox(t){return this.path()}getMarkers(){var{pathParser:t}=this,e=t.getMarkerPoints(),n=t.getMarkerAngles(),i=e.map((s,a)=>[s,n[a]]);return i}renderChildren(t){this.path(t),this.document.screen.mouse.checkPath(this,t);var e=this.getStyle("fill-rule");t.fillStyle!==""&&(e.getString("inherit")!=="inherit"?t.fill(e.getString()):t.fill()),t.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(t.save(),t.setTransform(1,0,0,1,0,0),t.stroke(),t.restore()):t.stroke());var n=this.getMarkers();if(n){var i=n.length-1,s=this.getStyle("marker-start"),a=this.getStyle("marker-mid"),o=this.getStyle("marker-end");if(s.isUrlDefinition()){var h=s.getDefinition(),[f,m]=n[0];h.render(t,f,m)}if(a.isUrlDefinition())for(var b=a.getDefinition(),x=1;x<i;x++){var[B,P]=n[x];b.render(t,B,P)}if(o.isUrlDefinition()){var R=o.getDefinition(),[Q,z]=n[i];R.render(t,Q,z)}}}static pathM(t){var e=t.getAsCurrentPoint();return t.start=t.current,{point:e}}pathM(t,e){var{pathParser:n}=this,{point:i}=qn.pathM(n),{x:s,y:a}=i;n.addMarker(i),e.addPoint(s,a),t&&t.moveTo(s,a)}static pathL(t){var{current:e}=t,n=t.getAsCurrentPoint();return{current:e,point:n}}pathL(t,e){var{pathParser:n}=this,{current:i,point:s}=qn.pathL(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathH(t){var{current:e,command:n}=t,i=new Hi((n.relative?e.x:0)+n.x,e.y);return t.current=i,{current:e,point:i}}pathH(t,e){var{pathParser:n}=this,{current:i,point:s}=qn.pathH(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathV(t){var{current:e,command:n}=t,i=new Hi(e.x,(n.relative?e.y:0)+n.y);return t.current=i,{current:e,point:i}}pathV(t,e){var{pathParser:n}=this,{current:i,point:s}=qn.pathV(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathC(t){var{current:e}=t,n=t.getPoint("x1","y1"),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:n,controlPoint:i,currentPoint:s}}pathC(t,e){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=qn.pathC(n);n.addMarker(o,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathS(t){var{current:e}=t,n=t.getReflectedControlPoint(),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:n,controlPoint:i,currentPoint:s}}pathS(t,e){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=qn.pathS(n);n.addMarker(o,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathQ(t){var{current:e}=t,n=t.getAsControlPoint("x1","y1"),i=t.getAsCurrentPoint();return{current:e,controlPoint:n,currentPoint:i}}pathQ(t,e){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=qn.pathQ(n);n.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathT(t){var{current:e}=t,n=t.getReflectedControlPoint();t.control=n;var i=t.getAsCurrentPoint();return{current:e,controlPoint:n,currentPoint:i}}pathT(t,e){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=qn.pathT(n);n.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathA(t){var{current:e,command:n}=t,{rX:i,rY:s,xRot:a,lArcFlag:o,sweepFlag:h}=n,f=a*(Math.PI/180),m=t.getAsCurrentPoint(),b=new Hi(Math.cos(f)*(e.x-m.x)/2+Math.sin(f)*(e.y-m.y)/2,-Math.sin(f)*(e.x-m.x)/2+Math.cos(f)*(e.y-m.y)/2),x=Math.pow(b.x,2)/Math.pow(i,2)+Math.pow(b.y,2)/Math.pow(s,2);x>1&&(i*=Math.sqrt(x),s*=Math.sqrt(x));var B=(o===h?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(s,2)-Math.pow(i,2)*Math.pow(b.y,2)-Math.pow(s,2)*Math.pow(b.x,2))/(Math.pow(i,2)*Math.pow(b.y,2)+Math.pow(s,2)*Math.pow(b.x,2)));isNaN(B)&&(B=0);var P=new Hi(B*i*b.y/s,B*-s*b.x/i),R=new Hi((e.x+m.x)/2+Math.cos(f)*P.x-Math.sin(f)*P.y,(e.y+m.y)/2+Math.sin(f)*P.x+Math.cos(f)*P.y),Q=xE([1,0],[(b.x-P.x)/i,(b.y-P.y)/s]),z=[(b.x-P.x)/i,(b.y-P.y)/s],G=[(-b.x-P.x)/i,(-b.y-P.y)/s],X=xE(z,G);return U_(z,G)<=-1&&(X=Math.PI),U_(z,G)>=1&&(X=0),{currentPoint:m,rX:i,rY:s,sweepFlag:h,xAxisRotation:f,centp:R,a1:Q,ad:X}}pathA(t,e){var{pathParser:n}=this,{currentPoint:i,rX:s,rY:a,sweepFlag:o,xAxisRotation:h,centp:f,a1:m,ad:b}=qn.pathA(n),x=1-o?1:-1,B=m+x*(b/2),P=new Hi(f.x+s*Math.cos(B),f.y+a*Math.sin(B));if(n.addMarkerAngle(P,B-x*Math.PI/2),n.addMarkerAngle(i,B-x*Math.PI),e.addPoint(i.x,i.y),t&&!isNaN(m)&&!isNaN(b)){var R=s>a?s:a,Q=s>a?1:s/a,z=s>a?a/s:1;t.translate(f.x,f.y),t.rotate(h),t.scale(Q,z),t.arc(0,0,R,m,m+b,!!(1-o)),t.scale(1/Q,1/z),t.rotate(-h),t.translate(-f.x,-f.y)}}static pathZ(t){t.current=t.start}pathZ(t,e){qn.pathZ(this.pathParser),t&&e.x1!==e.x2&&e.y1!==e.y2&&t.closePath()}}class ME extends qn{constructor(t,e,n){super(t,e,n),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class iA extends lh{constructor(t,e,n){super(t,e,new.target===iA?!0:n),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(t,e);var n=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();n&&(t.textBaseline=n)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(t){if(this.type!=="text")return this.getTElementBoundingBox(t);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t);var e=null;return this.children.forEach((n,i)=>{var s=this.getChildBoundingBox(t,this,this,i);e?e.addBoundingBox(s):e=s}),e}getFontSize(){var{document:t,parent:e}=this,n=bo.parse(t.ctx.font).fontSize,i=e.getStyle("font-size").getNumber(n);return i}getTElementBoundingBox(t){var e=this.getFontSize();return new Tl(this.x,this.y-e,this.x+this.measureText(t),this.y)}getGlyph(t,e,n){var i=e[n],s=null;if(t.isArabic){var a=e.length,o=e[n-1],h=e[n+1],f="isolated";if((n===0||o===" ")&&n<a-1&&h!==" "&&(f="terminal"),n>0&&o!==" "&&n<a-1&&h!==" "&&(f="medial"),n>0&&o!==" "&&(n===a-1||h===" ")&&(f="initial"),typeof t.glyphs[i]<"u"){var m=t.glyphs[i];s=m instanceof ME?m:m[f]}}else s=t.glyphs[i];return s||(s=t.missingGlyph),s}getText(){return""}getTextFromNode(t){var e=t||this.node,n=Array.from(e.parentNode.childNodes),i=n.indexOf(e),s=n.length-1,a=yd(e.textContent||"");return i===0&&(a=x6(a)),i===s&&(a=B6(a)),a}renderChildren(t){if(this.type!=="text"){this.renderTElementChildren(t);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t),this.children.forEach((n,i)=>{this.renderChild(t,this,this,i)});var{mouse:e}=this.document.screen;e.isWorking()&&e.checkBoundingBox(this,this.getBoundingBox(t))}renderTElementChildren(t){var{document:e,parent:n}=this,i=this.getText(),s=n.getStyle("font-family").getDefinition();if(s){for(var{unitsPerEm:a}=s.fontFace,o=bo.parse(e.ctx.font),h=n.getStyle("font-size").getNumber(o.fontSize),f=n.getStyle("font-style").getString(o.fontStyle),m=h/a,b=s.isRTL?i.split("").reverse().join(""):i,x=pa(n.getAttribute("dx").getString()),B=b.length,P=0;P<B;P++){var R=this.getGlyph(s,b,P);t.translate(this.x,this.y),t.scale(m,-m);var Q=t.lineWidth;t.lineWidth=t.lineWidth*a/h,f==="italic"&&t.transform(1,0,.4,1,0,0),R.render(t),f==="italic"&&t.transform(1,0,-.4,1,0,0),t.lineWidth=Q,t.scale(1/m,-1/m),t.translate(-this.x,-this.y),this.x+=h*(R.horizAdvX||s.horizAdvX)/a,typeof x[P]<"u"&&!isNaN(x[P])&&(this.x+=x[P])}return}var{x:z,y:G}=this;t.fillStyle&&t.fillText(i,z,G),t.strokeStyle&&t.strokeText(i,z,G)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var t=this.leafTexts[this.textChunkStart],e=t.getStyle("text-anchor").getString("start"),n=!1,i=0;e==="start"&&!n||e==="end"&&n?i=t.x-this.minX:e==="end"&&!n||e==="start"&&n?i=t.x-this.maxX:i=t.x-(this.minX+this.maxX)/2;for(var s=this.textChunkStart;s<this.leafTexts.length;s++)this.leafTexts[s].x+=i;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(t){this.children.forEach((e,n)=>{this.adjustChildCoordinatesRecursiveCore(t,this,this,n)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(t,e,n,i){var s=n.children[i];s.children.length>0?s.children.forEach((a,o)=>{e.adjustChildCoordinatesRecursiveCore(t,e,s,o)}):this.adjustChildCoordinates(t,e,n,i)}adjustChildCoordinates(t,e,n,i){var s=n.children[i];if(typeof s.measureText!="function")return s;t.save(),s.setContext(t,!0);var a=s.getAttribute("x"),o=s.getAttribute("y"),h=s.getAttribute("dx"),f=s.getAttribute("dy"),m=s.getStyle("font-family").getDefinition(),b=!!m&&m.isRTL;i===0&&(a.hasValue()||a.setValue(s.getInheritedAttribute("x")),o.hasValue()||o.setValue(s.getInheritedAttribute("y")),h.hasValue()||h.setValue(s.getInheritedAttribute("dx")),f.hasValue()||f.setValue(s.getInheritedAttribute("dy")));var x=s.measureText(t);return b&&(e.x-=x),a.hasValue()?(e.applyAnchoring(),s.x=a.getPixels("x"),h.hasValue()&&(s.x+=h.getPixels("x"))):(h.hasValue()&&(e.x+=h.getPixels("x")),s.x=e.x),e.x=s.x,b||(e.x+=x),o.hasValue()?(s.y=o.getPixels("y"),f.hasValue()&&(s.y+=f.getPixels("y"))):(f.hasValue()&&(e.y+=f.getPixels("y")),s.y=e.y),e.y=s.y,e.leafTexts.push(s),e.minX=Math.min(e.minX,s.x,s.x+x),e.maxX=Math.max(e.maxX,s.x,s.x+x),s.clearContext(t),t.restore(),s}getChildBoundingBox(t,e,n,i){var s=n.children[i];if(typeof s.getBoundingBox!="function")return null;var a=s.getBoundingBox(t);return a?(s.children.forEach((o,h)=>{var f=e.getChildBoundingBox(t,e,s,h);a.addBoundingBox(f)}),a):null}renderChild(t,e,n,i){var s=n.children[i];s.render(t),s.children.forEach((a,o)=>{e.renderChild(t,e,s,o)})}measureText(t){var{measureCache:e}=this;if(~e)return e;var n=this.getText(),i=this.measureTargetText(t,n);return this.measureCache=i,i}measureTargetText(t,e){if(!e.length)return 0;var{parent:n}=this,i=n.getStyle("font-family").getDefinition();if(i){for(var s=this.getFontSize(),a=i.isRTL?e.split("").reverse().join(""):e,o=pa(n.getAttribute("dx").getString()),h=a.length,f=0,m=0;m<h;m++){var b=this.getGlyph(i,a,m);f+=(b.horizAdvX||i.horizAdvX)*s/i.fontFace.unitsPerEm,typeof o[m]<"u"&&!isNaN(o[m])&&(f+=o[m])}return f}if(!t.measureText)return e.length*10;t.save(),this.setContext(t,!0);var{width:x}=t.measureText(e);return this.clearContext(t),t.restore(),x}getInheritedAttribute(t){for(var e=this;e instanceof iA&&e.isFirstChild();){var n=e.parent.getAttribute(t);if(n.hasValue(!0))return n.getValue("0");e=e.parent}return null}}class Dm extends iA{constructor(t,e,n){super(t,e,new.target===Dm?!0:n),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class nbt extends Dm{constructor(){super(...arguments),this.type="textNode"}}class yp extends lh{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(t){var e,{document:n}=this,{screen:i,window:s}=n,a=t.canvas;if(i.setDefaults(t),a.style&&typeof t.font<"u"&&s&&typeof s.getComputedStyle<"u"){t.font=s.getComputedStyle(a).getPropertyValue("font");var o=new Nr(n,"fontSize",bo.parse(t.font).fontSize);o.hasValue()&&(n.rootEmSize=o.getPixels("y"),n.emSize=n.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:h,height:f}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var m=this.getAttribute("refX"),b=this.getAttribute("refY"),x=this.getAttribute("viewBox"),B=x.hasValue()?pa(x.getString()):null,P=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",R=0,Q=0,z=0,G=0;B&&(R=B[0],Q=B[1]),this.root||(h=this.getStyle("width").getPixels("x"),f=this.getStyle("height").getPixels("y"),this.type==="marker"&&(z=R,G=Q,R=0,Q=0)),i.viewPort.setCurrent(h,f),this.node&&(!this.parent||((e=this.node.parentNode)===null||e===void 0?void 0:e.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(t),t.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),B&&(h=B[2],f=B[3]),n.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:h,height:i.viewPort.height,desiredHeight:f,minX:R,minY:Q,refX:m.getValue(),refY:b.getValue(),clip:P,clipX:z,clipY:G}),B&&(i.viewPort.removeCurrent(),i.viewPort.setCurrent(h,f))}clearContext(t){super.clearContext(t),this.document.screen.viewPort.removeCurrent()}resize(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getAttribute("width",!0),s=this.getAttribute("height",!0),a=this.getAttribute("viewBox"),o=this.getAttribute("style"),h=i.getNumber(0),f=s.getNumber(0);if(n)if(typeof n=="string")this.getAttribute("preserveAspectRatio",!0).setValue(n);else{var m=this.getAttribute("preserveAspectRatio");m.hasValue()&&m.setValue(m.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(i.setValue(t),s.setValue(e),a.hasValue()||a.setValue("0 0 ".concat(h||t," ").concat(f||e)),o.hasValue()){var b=this.getStyle("width"),x=this.getStyle("height");b.hasValue()&&b.setValue("".concat(t,"px")),x.hasValue()&&x.setValue("".concat(e,"px"))}}}class UE extends qn{constructor(){super(...arguments),this.type="rect"}path(t){var e=this.getAttribute("x").getPixels("x"),n=this.getAttribute("y").getPixels("y"),i=this.getStyle("width",!1,!0).getPixels("x"),s=this.getStyle("height",!1,!0).getPixels("y"),a=this.getAttribute("rx"),o=this.getAttribute("ry"),h=a.getPixels("x"),f=o.getPixels("y");if(a.hasValue()&&!o.hasValue()&&(f=h),o.hasValue()&&!a.hasValue()&&(h=f),h=Math.min(h,i/2),f=Math.min(f,s/2),t){var m=4*((Math.sqrt(2)-1)/3);t.beginPath(),s>0&&i>0&&(t.moveTo(e+h,n),t.lineTo(e+i-h,n),t.bezierCurveTo(e+i-h+m*h,n,e+i,n+f-m*f,e+i,n+f),t.lineTo(e+i,n+s-f),t.bezierCurveTo(e+i,n+s-f+m*f,e+i-h+m*h,n+s,e+i-h,n+s),t.lineTo(e+h,n+s),t.bezierCurveTo(e+h-m*h,n+s,e,n+s-f+m*f,e,n+s-f),t.lineTo(e,n+f),t.bezierCurveTo(e,n+f-m*f,e+h-m*h,n,e+h,n),t.closePath())}return new Tl(e,n,e+i,n+s)}getMarkers(){return null}}class N6 extends qn{constructor(){super(...arguments),this.type="circle"}path(t){var e=this.getAttribute("cx").getPixels("x"),n=this.getAttribute("cy").getPixels("y"),i=this.getAttribute("r").getPixels();return t&&i>0&&(t.beginPath(),t.arc(e,n,i,0,Math.PI*2,!1),t.closePath()),new Tl(e-i,n-i,e+i,n+i)}getMarkers(){return null}}class k6 extends qn{constructor(){super(...arguments),this.type="ellipse"}path(t){var e=4*((Math.sqrt(2)-1)/3),n=this.getAttribute("rx").getPixels("x"),i=this.getAttribute("ry").getPixels("y"),s=this.getAttribute("cx").getPixels("x"),a=this.getAttribute("cy").getPixels("y");return t&&n>0&&i>0&&(t.beginPath(),t.moveTo(s+n,a),t.bezierCurveTo(s+n,a+e*i,s+e*n,a+i,s,a+i),t.bezierCurveTo(s-e*n,a+i,s-n,a+e*i,s-n,a),t.bezierCurveTo(s-n,a-e*i,s-e*n,a-i,s,a-i),t.bezierCurveTo(s+e*n,a-i,s+n,a-e*i,s+n,a),t.closePath()),new Tl(s-n,a-i,s+n,a+i)}getMarkers(){return null}}class Q6 extends qn{constructor(){super(...arguments),this.type="line"}getPoints(){return[new Hi(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Hi(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(t){var[{x:e,y:n},{x:i,y:s}]=this.getPoints();return t&&(t.beginPath(),t.moveTo(e,n),t.lineTo(i,s)),new Tl(e,n,i,s)}getMarkers(){var[t,e]=this.getPoints(),n=t.angleTo(e);return[[t,n],[e,n]]}}class RE extends qn{constructor(t,e,n){super(t,e,n),this.type="polyline",this.points=[],this.points=Hi.parsePath(this.getAttribute("points").getString())}path(t){var{points:e}=this,[{x:n,y:i}]=e,s=new Tl(n,i);return t&&(t.beginPath(),t.moveTo(n,i)),e.forEach(a=>{var{x:o,y:h}=a;s.addPoint(o,h),t&&t.lineTo(o,h)}),s}getMarkers(){var{points:t}=this,e=t.length-1,n=[];return t.forEach((i,s)=>{s!==e&&n.push([i,i.angleTo(t[s+1])])}),n.length>0&&n.push([t[t.length-1],n[n.length-1][1]]),n}}class H6 extends RE{constructor(){super(...arguments),this.type="polygon"}path(t){var e=super.path(t),[{x:n,y:i}]=this.points;return t&&(t.lineTo(n,i),t.closePath()),e}}class z6 extends mi{constructor(){super(...arguments),this.type="pattern"}createPattern(t,e,n){var i=this.getStyle("width").getPixels("x",!0),s=this.getStyle("height").getPixels("y",!0),a=new yp(this.document,null);a.attributes.viewBox=new Nr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.width=new Nr(this.document,"width","".concat(i,"px")),a.attributes.height=new Nr(this.document,"height","".concat(s,"px")),a.attributes.transform=new Nr(this.document,"transform",this.getAttribute("patternTransform").getValue()),a.children=this.children;var o=this.document.createCanvas(i,s),h=o.getContext("2d"),f=this.getAttribute("x"),m=this.getAttribute("y");f.hasValue()&&m.hasValue()&&h.translate(f.getPixels("x",!0),m.getPixels("y",!0)),n.hasValue()?this.styles["fill-opacity"]=n:Reflect.deleteProperty(this.styles,"fill-opacity");for(var b=-1;b<=1;b++)for(var x=-1;x<=1;x++)h.save(),a.attributes.x=new Nr(this.document,"x",b*o.width),a.attributes.y=new Nr(this.document,"y",x*o.height),a.render(h),h.restore();var B=t.createPattern(o,"repeat");return B}}class V6 extends mi{constructor(){super(...arguments),this.type="marker"}render(t,e,n){if(e){var{x:i,y:s}=e,a=this.getAttribute("orient").getString("auto"),o=this.getAttribute("markerUnits").getString("strokeWidth");t.translate(i,s),a==="auto"&&t.rotate(n),o==="strokeWidth"&&t.scale(t.lineWidth,t.lineWidth),t.save();var h=new yp(this.document,null);h.type=this.type,h.attributes.viewBox=new Nr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),h.attributes.refX=new Nr(this.document,"refX",this.getAttribute("refX").getValue()),h.attributes.refY=new Nr(this.document,"refY",this.getAttribute("refY").getValue()),h.attributes.width=new Nr(this.document,"width",this.getAttribute("markerWidth").getValue()),h.attributes.height=new Nr(this.document,"height",this.getAttribute("markerHeight").getValue()),h.attributes.overflow=new Nr(this.document,"overflow",this.getAttribute("overflow").getValue()),h.attributes.fill=new Nr(this.document,"fill",this.getAttribute("fill").getColor("black")),h.attributes.stroke=new Nr(this.document,"stroke",this.getAttribute("stroke").getValue("none")),h.children=this.children,h.render(t),t.restore(),o==="strokeWidth"&&t.scale(1/t.lineWidth,1/t.lineWidth),a==="auto"&&t.rotate(-n),t.translate(-i,-s)}}}class G6 extends mi{constructor(){super(...arguments),this.type="defs"}render(){}}class O_ extends lh{constructor(){super(...arguments),this.type="g"}getBoundingBox(t){var e=new Tl;return this.children.forEach(n=>{e.addBoundingBox(n.getBoundingBox(t))}),e}}class OE extends mi{constructor(t,e,n){super(t,e,n),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:i,children:s}=this;s.forEach(a=>{a.type==="stop"&&i.push(a)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(t,e,n){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var{stops:s}=i,a=this.getGradient(t,e);if(!a)return this.addParentOpacity(n,s[s.length-1].color);if(s.forEach(Q=>{a.addColorStop(Q.offset,this.addParentOpacity(n,Q.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:o}=this,{MAX_VIRTUAL_PIXELS:h,viewPort:f}=o.screen,[m]=f.viewPorts,b=new UE(o,null);b.attributes.x=new Nr(o,"x",-h/3),b.attributes.y=new Nr(o,"y",-h/3),b.attributes.width=new Nr(o,"width",h),b.attributes.height=new Nr(o,"height",h);var x=new O_(o,null);x.attributes.transform=new Nr(o,"transform",this.getAttribute("gradientTransform").getValue()),x.children=[b];var B=new yp(o,null);B.attributes.x=new Nr(o,"x",0),B.attributes.y=new Nr(o,"y",0),B.attributes.width=new Nr(o,"width",m.width),B.attributes.height=new Nr(o,"height",m.height),B.children=[x];var P=o.createCanvas(m.width,m.height),R=P.getContext("2d");return R.fillStyle=a,B.render(R),R.createPattern(P,"no-repeat")}return a}inheritStopContainer(t){this.attributesToInherit.forEach(e=>{!this.getAttribute(e).hasValue()&&t.getAttribute(e).hasValue()&&this.getAttribute(e,!0).setValue(t.getAttribute(e).getValue())})}addParentOpacity(t,e){if(t.hasValue()){var n=new Nr(this.document,"color",e);return n.addOpacity(t).getColor()}return e}}class j6 extends OE{constructor(t,e,n){super(t,e,n),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(t,e){var n=this.getGradientUnits()==="objectBoundingBox",i=n?e.getBoundingBox(t):null;if(n&&!i)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var s=n?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),a=n?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),o=n?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),h=n?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return s===o&&a===h?null:t.createLinearGradient(s,a,o,h)}}class q6 extends OE{constructor(t,e,n){super(t,e,n),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(t,e){var n=this.getGradientUnits()==="objectBoundingBox",i=e.getBoundingBox(t);if(n&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var s=n?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),a=n?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),o=s,h=a;this.getAttribute("fx").hasValue()&&(o=n?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(h=n?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var f=n?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),m=this.getAttribute("fr").getPixels();return t.createRadialGradient(o,h,m,s,a,f)}}class K6 extends mi{constructor(t,e,n){super(t,e,n),this.type="stop";var i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),s=this.getStyle("stop-opacity"),a=this.getStyle("stop-color",!0);a.getString()===""&&a.setValue("#000"),s.hasValue()&&(a=a.addOpacity(s)),this.offset=i,this.color=a.getColor()}}class D_ extends mi{constructor(t,e,n){super(t,e,n),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,t.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new Nr(t,"values",null);var i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}getProperty(){var t=this.getAttribute("attributeType").getString(),e=this.getAttribute("attributeName").getString();return t==="CSS"?this.parent.getStyle(e,!0):this.parent.getAttribute(e,!0)}calcValue(){var{initialUnits:t}=this,{progress:e,from:n,to:i}=this.getProgress(),s=n.getNumber()+(i.getNumber()-n.getNumber())*e;return t==="%"&&(s*=100),"".concat(s).concat(t)}update(t){var{parent:e}=this,n=this.getProperty();if(this.initialValue||(this.initialValue=n.getString(),this.initialUnits=n.getUnits()),this.duration>this.maxDuration){var i=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(i==="freeze"&&!this.frozen)this.frozen=!0,e.animationFrozen=!0,e.animationFrozenValue=n.getString();else if(i==="remove"&&!this.removed)return this.removed=!0,n.setValue(e.animationFrozen?e.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=t;var s=!1;if(this.begin<this.duration){var a=this.calcValue(),o=this.getAttribute("type");if(o.hasValue()){var h=o.getString();a="".concat(h,"(").concat(a,")")}n.setValue(a),s=!0}return s}getProgress(){var{document:t,values:e}=this,n={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(e.hasValue()){var i=n.progress*(e.getValue().length-1),s=Math.floor(i),a=Math.ceil(i);n.from=new Nr(t,"from",parseFloat(e.getValue()[s])),n.to=new Nr(t,"to",parseFloat(e.getValue()[a])),n.progress=(i-s)/(a-s)}else n.from=this.from,n.to=this.to;return n}}class W6 extends D_{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:t,from:e,to:n}=this.getProgress(),i=new gE(e.getColor()),s=new gE(n.getColor());if(i.ok&&s.ok){var a=i.r+(s.r-i.r)*t,o=i.g+(s.g-i.g)*t,h=i.b+(s.b-i.b)*t;return"rgb(".concat(Math.floor(a),", ").concat(Math.floor(o),", ").concat(Math.floor(h),")")}return this.getAttribute("from").getColor()}}class $6 extends D_{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:t,from:e,to:n}=this.getProgress(),i=pa(e.getString()),s=pa(n.getString()),a=i.map((o,h)=>{var f=s[h];return o+(f-o)*t}).join(" ");return a}}class X6 extends mi{constructor(t,e,n){super(t,e,n),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:i}=t,{children:s}=this;for(var a of s)switch(a.type){case"font-face":{this.fontFace=a;var o=a.getStyle("font-family");o.hasValue()&&(i[o.getString()]=this);break}case"missing-glyph":this.missingGlyph=a;break;case"glyph":{var h=a;h.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[h.unicode]>"u"&&(this.glyphs[h.unicode]={}),this.glyphs[h.unicode][h.arabicForm]=h):this.glyphs[h.unicode]=h;break}}}render(){}}class J6 extends mi{constructor(t,e,n){super(t,e,n),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class Y6 extends qn{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class Z6 extends iA{constructor(){super(...arguments),this.type="tref"}getText(){var t=this.getHrefAttribute().getDefinition();if(t){var e=t.children[0];if(e)return e.getText()}return""}}class tN extends iA{constructor(t,e,n){super(t,e,n),this.type="a";var{childNodes:i}=e,s=i[0],a=i.length>0&&Array.from(i).every(o=>o.nodeType===3);this.hasText=a,this.text=a?this.getTextFromNode(s):""}getText(){return this.text}renderChildren(t){if(this.hasText){super.renderChildren(t);var{document:e,x:n,y:i}=this,{mouse:s}=e.screen,a=new Nr(e,"fontSize",bo.parse(e.ctx.font).fontSize);s.isWorking()&&s.checkBoundingBox(this,new Tl(n,i-a.getPixels("y"),n+this.measureText(t),i))}else if(this.children.length>0){var o=new O_(this.document,null);o.children=this.children,o.parent=this,o.render(t)}}onClick(){var{window:t}=this.document;t&&t.open(this.getHrefAttribute().getString())}onMouseMove(){var t=this.document.ctx;t.canvas.style.cursor="pointer"}}function eN(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function N_(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?eN(Object(e),!0).forEach(function(n){lE(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):eN(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}class rN extends iA{constructor(t,e,n){super(t,e,n),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(i)}getText(){return this.text}path(t){var{dataArray:e}=this;t&&t.beginPath(),e.forEach(n=>{var{type:i,points:s}=n;switch(i){case nn.LINE_TO:t&&t.lineTo(s[0],s[1]);break;case nn.MOVE_TO:t&&t.moveTo(s[0],s[1]);break;case nn.CURVE_TO:t&&t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case nn.QUAD_TO:t&&t.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case nn.ARC:{var[a,o,h,f,m,b,x,B]=s,P=h>f?h:f,R=h>f?1:h/f,Q=h>f?f/h:1;t&&(t.translate(a,o),t.rotate(x),t.scale(R,Q),t.arc(0,0,P,m,m+b,!!(1-B)),t.scale(1/R,1/Q),t.rotate(-x),t.translate(-a,-o));break}case nn.CLOSE_PATH:t&&t.closePath();break}})}renderChildren(t){this.setTextData(t),t.save();var e=this.parent.getStyle("text-decoration").getString(),n=this.getFontSize(),{glyphInfo:i}=this,s=t.fillStyle;e==="underline"&&t.beginPath(),i.forEach((a,o)=>{var{p0:h,p1:f,rotation:m,text:b}=a;t.save(),t.translate(h.x,h.y),t.rotate(m),t.fillStyle&&t.fillText(b,0,0),t.strokeStyle&&t.strokeText(b,0,0),t.restore(),e==="underline"&&(o===0&&t.moveTo(h.x,h.y+n/8),t.lineTo(f.x,f.y+n/5))}),e==="underline"&&(t.lineWidth=n/20,t.strokeStyle=s,t.stroke(),t.closePath()),t.restore()}getLetterSpacingAt(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[t]||0}findSegmentToFitChar(t,e,n,i,s,a,o,h,f){var m=a,b=this.measureText(t,h);h===" "&&e==="justify"&&n<i&&(b+=(i-n)/s),f>-1&&(m+=this.getLetterSpacingAt(f));var x=this.textHeight/20,B=this.getEquidistantPointOnPath(m,x,0),P=this.getEquidistantPointOnPath(m+b,x,0),R={p0:B,p1:P},Q=B&&P?Math.atan2(P.y-B.y,P.x-B.x):0;if(o){var z=Math.cos(Math.PI/2+Q)*o,G=Math.cos(-Q)*o;R.p0=N_(N_({},B),{},{x:B.x+z,y:B.y+G}),R.p1=N_(N_({},P),{},{x:P.x+z,y:P.y+G})}return m+=b,{offset:m,segment:R,rotation:Q}}measureText(t,e){var{measuresCache:n}=this,i=e||this.getText();if(n.has(i))return n.get(i);var s=this.measureTargetText(t,i);return n.set(i,s),s}setTextData(t){if(!this.glyphInfo){var e=this.getText(),n=e.split(""),i=e.split(" ").length-1,s=this.parent.getAttribute("dx").split().map(et=>et.getPixels("x")),a=this.parent.getAttribute("dy").getPixels("y"),o=this.parent.getStyle("text-anchor").getString("start"),h=this.getStyle("letter-spacing"),f=this.parent.getStyle("letter-spacing"),m=0;!h.hasValue()||h.getValue()==="inherit"?m=f.getPixels():h.hasValue()&&h.getValue()!=="initial"&&h.getValue()!=="unset"&&(m=h.getPixels());var b=[],x=e.length;this.letterSpacingCache=b;for(var B=0;B<x;B++)b.push(typeof s[B]<"u"?s[B]:m);var P=b.reduce((et,pt,gt)=>gt===0?0:et+pt||0,0),R=this.measureText(t),Q=Math.max(R+P,0);this.textWidth=R,this.textHeight=this.getFontSize(),this.glyphInfo=[];var z=this.getPathLength(),G=this.getStyle("startOffset").getNumber(0)*z,X=0;(o==="middle"||o==="center")&&(X=-Q/2),(o==="end"||o==="right")&&(X=-Q),X+=G,n.forEach((et,pt)=>{var{offset:gt,segment:mt,rotation:ft}=this.findSegmentToFitChar(t,o,Q,z,i,X,a,et,pt);X=gt,!(!mt.p0||!mt.p1)&&this.glyphInfo.push({text:n[pt],p0:mt.p0,p1:mt.p1,rotation:ft})})}}parsePathData(t){if(this.pathLength=-1,!t)return[];var e=[],{pathParser:n}=t;for(n.reset();!n.isEnd();){var{current:i}=n,s=i?i.x:0,a=i?i.y:0,o=n.next(),h=o.type,f=[];switch(o.type){case nn.MOVE_TO:this.pathM(n,f);break;case nn.LINE_TO:h=this.pathL(n,f);break;case nn.HORIZ_LINE_TO:h=this.pathH(n,f);break;case nn.VERT_LINE_TO:h=this.pathV(n,f);break;case nn.CURVE_TO:this.pathC(n,f);break;case nn.SMOOTH_CURVE_TO:h=this.pathS(n,f);break;case nn.QUAD_TO:this.pathQ(n,f);break;case nn.SMOOTH_QUAD_TO:h=this.pathT(n,f);break;case nn.ARC:f=this.pathA(n);break;case nn.CLOSE_PATH:qn.pathZ(n);break}o.type!==nn.CLOSE_PATH?e.push({type:h,points:f,start:{x:s,y:a},pathLength:this.calcLength(s,a,h,f)}):e.push({type:nn.CLOSE_PATH,points:[],pathLength:0})}return e}pathM(t,e){var{x:n,y:i}=qn.pathM(t).point;e.push(n,i)}pathL(t,e){var{x:n,y:i}=qn.pathL(t).point;return e.push(n,i),nn.LINE_TO}pathH(t,e){var{x:n,y:i}=qn.pathH(t).point;return e.push(n,i),nn.LINE_TO}pathV(t,e){var{x:n,y:i}=qn.pathV(t).point;return e.push(n,i),nn.LINE_TO}pathC(t,e){var{point:n,controlPoint:i,currentPoint:s}=qn.pathC(t);e.push(n.x,n.y,i.x,i.y,s.x,s.y)}pathS(t,e){var{point:n,controlPoint:i,currentPoint:s}=qn.pathS(t);return e.push(n.x,n.y,i.x,i.y,s.x,s.y),nn.CURVE_TO}pathQ(t,e){var{controlPoint:n,currentPoint:i}=qn.pathQ(t);e.push(n.x,n.y,i.x,i.y)}pathT(t,e){var{controlPoint:n,currentPoint:i}=qn.pathT(t);return e.push(n.x,n.y,i.x,i.y),nn.QUAD_TO}pathA(t){var{rX:e,rY:n,sweepFlag:i,xAxisRotation:s,centp:a,a1:o,ad:h}=qn.pathA(t);return i===0&&h>0&&(h-=2*Math.PI),i===1&&h<0&&(h+=2*Math.PI),[a.x,a.y,e,n,o,h,s,i]}calcLength(t,e,n,i){var s=0,a=null,o=null,h=0;switch(n){case nn.LINE_TO:return this.getLineLength(t,e,i[0],i[1]);case nn.CURVE_TO:for(s=0,a=this.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),h=.01;h<=1;h+=.01)o=this.getPointOnCubicBezier(h,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case nn.QUAD_TO:for(s=0,a=this.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]),h=.01;h<=1;h+=.01)o=this.getPointOnQuadraticBezier(h,t,e,i[0],i[1],i[2],i[3]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case nn.ARC:{s=0;var f=i[4],m=i[5],b=i[4]+m,x=Math.PI/180;if(Math.abs(f-b)<x&&(x=Math.abs(f-b)),a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],f,0),m<0)for(h=f-x;h>b;h-=x)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;else for(h=f+x;h<b;h+=x)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],b,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),s}}return 0}getPointOnLine(t,e,n,i,s){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:e,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:n,h=(s-n)/(i-e+vd),f=Math.sqrt(t*t/(1+h*h));i<e&&(f*=-1);var m=h*f,b=null;if(i===e)b={x:a,y:o+m};else if((o-n)/(a-e+vd)===h)b={x:a+f,y:o+m};else{var x=0,B=0,P=this.getLineLength(e,n,i,s);if(P<vd)return null;var R=(a-e)*(i-e)+(o-n)*(s-n);R/=P*P,x=e+R*(i-e),B=n+R*(s-n);var Q=this.getLineLength(a,o,x,B),z=Math.sqrt(t*t-Q*Q);f=Math.sqrt(z*z/(1+h*h)),i<e&&(f*=-1),m=h*f,b={x:x+f,y:B+m}}return b}getPointOnPath(t){var e=this.getPathLength(),n=0,i=null;if(t<-5e-5||t-5e-5>e)return null;var{dataArray:s}=this;for(var a of s){if(a&&(a.pathLength<5e-5||n+a.pathLength+5e-5<t)){n+=a.pathLength;continue}var o=t-n,h=0;switch(a.type){case nn.LINE_TO:i=this.getPointOnLine(o,a.start.x,a.start.y,a.points[0],a.points[1],a.start.x,a.start.y);break;case nn.ARC:{var f=a.points[4],m=a.points[5],b=a.points[4]+m;if(h=f+o/a.pathLength*m,m<0&&h<b||m>=0&&h>b)break;i=this.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],h,a.points[6]);break}case nn.CURVE_TO:h=o/a.pathLength,h>1&&(h=1),i=this.getPointOnCubicBezier(h,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case nn.QUAD_TO:h=o/a.pathLength,h>1&&(h=1),i=this.getPointOnQuadraticBezier(h,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);break}if(i)return i;break}return null}getLineLength(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((t,e)=>e.pathLength>0?t+e.pathLength:t,0)),this.pathLength}getPointOnCubicBezier(t,e,n,i,s,a,o,h,f){var m=h*BE(t)+a*CE(t)+i*EE(t)+e*SE(t),b=f*BE(t)+o*CE(t)+s*EE(t)+n*SE(t);return{x:m,y:b}}getPointOnQuadraticBezier(t,e,n,i,s,a,o){var h=a*TE(t)+i*IE(t)+e*FE(t),f=o*TE(t)+s*IE(t)+n*FE(t);return{x:h,y:f}}getPointOnEllipticalArc(t,e,n,i,s,a){var o=Math.cos(a),h=Math.sin(a),f={x:n*Math.cos(s),y:i*Math.sin(s)};return{x:t+(f.x*o-f.y*h),y:e+(f.x*h+f.y*o)}}buildEquidistantCache(t,e){var n=this.getPathLength(),i=e||.25,s=t||n/100;if(!this.equidistantCache||this.equidistantCache.step!==s||this.equidistantCache.precision!==i){this.equidistantCache={step:s,precision:i,points:[]};for(var a=0,o=0;o<=n;o+=i){var h=this.getPointOnPath(o),f=this.getPointOnPath(o+i);!h||!f||(a+=this.getLineLength(h.x,h.y,f.x,f.y),a>=s&&(this.equidistantCache.points.push({x:h.x,y:h.y,distance:o}),a-=s))}}}getEquidistantPointOnPath(t,e,n){if(this.buildEquidistantCache(e,n),t<0||t-this.getPathLength()>5e-5)return null;var i=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}}var ibt=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class nN extends lh{constructor(t,e,n){super(t,e,n),this.type="image",this.loaded=!1;var i=this.getHrefAttribute().getString();if(i){var s=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);t.images.push(this),s?this.loadSvg(i):this.loadImage(i),this.isSvg=s}}loadImage(t){var e=this;return eA(function*(){try{var n=yield e.document.createImage(t);e.image=n}catch(i){console.error('Error while loading image "'.concat(t,'":'),i)}e.loaded=!0})()}loadSvg(t){var e=this;return eA(function*(){var n=ibt.exec(t);if(n){var i=n[5];n[4]==="base64"?e.image=atob(i):e.image=decodeURIComponent(i)}else try{var s=yield e.document.fetch(t),a=yield s.text();e.image=a}catch(o){console.error('Error while loading image "'.concat(t,'":'),o)}e.loaded=!0})()}renderChildren(t){var{document:e,image:n,loaded:i}=this,s=this.getAttribute("x").getPixels("x"),a=this.getAttribute("y").getPixels("y"),o=this.getStyle("width").getPixels("x"),h=this.getStyle("height").getPixels("y");if(!(!i||!n||!o||!h)){if(t.save(),t.translate(s,a),this.isSvg){var f=e.canvg.forkString(t,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:o,scaleHeight:h});f.document.documentElement.parent=this,f.render()}else{var m=this.image;e.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:o,desiredWidth:m.width,height:h,desiredHeight:m.height}),this.loaded&&(typeof m.complete>"u"||m.complete)&&t.drawImage(m,0,0)}t.restore()}}getBoundingBox(){var t=this.getAttribute("x").getPixels("x"),e=this.getAttribute("y").getPixels("y"),n=this.getStyle("width").getPixels("x"),i=this.getStyle("height").getPixels("y");return new Tl(t,e,t+n,e+i)}}class iN extends lh{constructor(){super(...arguments),this.type="symbol"}render(t){}}class sN{constructor(t){this.document=t,this.loaded=!1,t.fonts.push(this)}load(t,e){var n=this;return eA(function*(){try{var{document:i}=n,s=yield i.canvg.parser.load(e),a=s.getElementsByTagName("font");Array.from(a).forEach(o=>{var h=i.createElement(o);i.definitions[t]=h})}catch(o){console.error('Error while loading font "'.concat(e,'":'),o)}n.loaded=!0})()}}class DE extends mi{constructor(t,e,n){super(t,e,n),this.type="style";var i=yd(Array.from(e.childNodes).map(a=>a.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),s=i.split("}");s.forEach(a=>{var o=a.trim();if(o){var h=o.split("{"),f=h[0].split(","),m=h[1].split(";");f.forEach(b=>{var x=b.trim();if(x){var B=t.styles[x]||{};if(m.forEach(Q=>{var z=Q.indexOf(":"),G=Q.substr(0,z).trim(),X=Q.substr(z+1,Q.length-z).trim();G&&X&&(B[G]=new Nr(t,G,X))}),t.styles[x]=B,t.stylesSpecificity[x]=S6(x),x==="@font-face"){var P=B["font-family"].getString().replace(/"|'/g,""),R=B.src.getString().split(",");R.forEach(Q=>{if(Q.indexOf('format("svg")')>0){var z=bE(Q);z&&new sN(t).load(P,z)}})}}})}})}}DE.parseExternalUrl=bE;class oN extends lh{constructor(){super(...arguments),this.type="use"}setContext(t){super.setContext(t);var e=this.getAttribute("x"),n=this.getAttribute("y");e.hasValue()&&t.translate(e.getPixels("x"),0),n.hasValue()&&t.translate(0,n.getPixels("y"))}path(t){var{element:e}=this;e&&e.path(t)}renderChildren(t){var{document:e,element:n}=this;if(n){var i=n;if(n.type==="symbol"&&(i=new yp(e,null),i.attributes.viewBox=new Nr(e,"viewBox",n.getAttribute("viewBox").getString()),i.attributes.preserveAspectRatio=new Nr(e,"preserveAspectRatio",n.getAttribute("preserveAspectRatio").getString()),i.attributes.overflow=new Nr(e,"overflow",n.getAttribute("overflow").getString()),i.children=n.children,n.styles.opacity=new Nr(e,"opacity",this.calculateOpacity())),i.type==="svg"){var s=this.getStyle("width",!1,!0),a=this.getStyle("height",!1,!0);s.hasValue()&&(i.attributes.width=new Nr(e,"width",s.getString())),a.hasValue()&&(i.attributes.height=new Nr(e,"height",a.getString()))}var o=i.parent;i.parent=this,i.render(t),i.parent=o}}getBoundingBox(t){var{element:e}=this;return e?e.getBoundingBox(t):null}elementTransform(){var{document:t,element:e}=this;return ah.fromElement(t,e)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function k_(r,t,e,n,i,s){return r[e*n*4+t*4+s]}function Q_(r,t,e,n,i,s,a){r[e*n*4+t*4+s]=a}function ms(r,t,e){var n=r[t];return n*e}function sA(r,t,e,n){return t+Math.cos(r)*e+Math.sin(r)*n}class NE extends mi{constructor(t,e,n){super(t,e,n),this.type="feColorMatrix";var i=pa(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var s=i[0];i=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var a=i[0]*Math.PI/180;i=[sA(a,.213,.787,-.213),sA(a,.715,-.715,-.715),sA(a,.072,-.072,.928),0,0,sA(a,.213,-.213,.143),sA(a,.715,.285,.14),sA(a,.072,-.072,-.283),0,0,sA(a,.213,-.213,-.787),sA(a,.715,-.715,.715),sA(a,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=i,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(t,e,n,i,s){for(var{includeOpacity:a,matrix:o}=this,h=t.getImageData(0,0,i,s),f=0;f<s;f++)for(var m=0;m<i;m++){var b=k_(h.data,m,f,i,s,0),x=k_(h.data,m,f,i,s,1),B=k_(h.data,m,f,i,s,2),P=k_(h.data,m,f,i,s,3),R=ms(o,0,b)+ms(o,1,x)+ms(o,2,B)+ms(o,3,P)+ms(o,4,1),Q=ms(o,5,b)+ms(o,6,x)+ms(o,7,B)+ms(o,8,P)+ms(o,9,1),z=ms(o,10,b)+ms(o,11,x)+ms(o,12,B)+ms(o,13,P)+ms(o,14,1),G=ms(o,15,b)+ms(o,16,x)+ms(o,17,B)+ms(o,18,P)+ms(o,19,1);a&&(R=0,Q=0,z=0,G*=P/255),Q_(h.data,m,f,i,s,0,R),Q_(h.data,m,f,i,s,1,Q),Q_(h.data,m,f,i,s,2,z),Q_(h.data,m,f,i,s,3,G)}t.clearRect(0,0,i,s),t.putImageData(h,0,0)}}class Nm extends mi{constructor(){super(...arguments),this.type="mask"}apply(t,e){var{document:n}=this,i=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y");if(!a&&!o){var h=new Tl;this.children.forEach(P=>{h.addBoundingBox(P.getBoundingBox(t))}),i=Math.floor(h.x1),s=Math.floor(h.y1),a=Math.floor(h.width),o=Math.floor(h.height)}var f=this.removeStyles(e,Nm.ignoreStyles),m=n.createCanvas(i+a,s+o),b=m.getContext("2d");n.screen.setDefaults(b),this.renderChildren(b),new NE(n,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(b,0,0,i+a,s+o);var x=n.createCanvas(i+a,s+o),B=x.getContext("2d");n.screen.setDefaults(B),e.render(B),B.globalCompositeOperation="destination-in",B.fillStyle=b.createPattern(m,"no-repeat"),B.fillRect(0,0,i+a,s+o),t.fillStyle=B.createPattern(x,"no-repeat"),t.fillRect(0,0,i+a,s+o),this.restoreStyles(e,f)}render(t){}}Nm.ignoreStyles=["mask","transform","clip-path"];var aN=()=>{};class lN extends mi{constructor(){super(...arguments),this.type="clipPath"}apply(t){var{document:e}=this,n=Reflect.getPrototypeOf(t),{beginPath:i,closePath:s}=t;n&&(n.beginPath=aN,n.closePath=aN),Reflect.apply(i,t,[]),this.children.forEach(a=>{if(!(typeof a.path>"u")){var o=typeof a.elementTransform<"u"?a.elementTransform():null;o||(o=ah.fromElement(e,a)),o&&o.apply(t),a.path(t),n&&(n.closePath=s),o&&o.unapply(t)}}),Reflect.apply(s,t,[]),t.clip(),n&&(n.beginPath=i,n.closePath=s)}render(t){}}class km extends mi{constructor(){super(...arguments),this.type="filter"}apply(t,e){var{document:n,children:i}=this,s=e.getBoundingBox(t);if(s){var a=0,o=0;i.forEach(z=>{var G=z.extraFilterDistance||0;a=Math.max(a,G),o=Math.max(o,G)});var h=Math.floor(s.width),f=Math.floor(s.height),m=h+2*a,b=f+2*o;if(!(m<1||b<1)){var x=Math.floor(s.x),B=Math.floor(s.y),P=this.removeStyles(e,km.ignoreStyles),R=n.createCanvas(m,b),Q=R.getContext("2d");n.screen.setDefaults(Q),Q.translate(-x+a,-B+o),e.render(Q),i.forEach(z=>{typeof z.apply=="function"&&z.apply(Q,0,0,m,b)}),t.drawImage(R,0,0,m,b,x-a,B-o,m,b),this.restoreStyles(e,P)}}}render(t){}}km.ignoreStyles=["filter","transform","clip-path"];class cN extends mi{constructor(t,e,n){super(t,e,n),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(t,e,n,i,s){}}class uN extends mi{constructor(){super(...arguments),this.type="feMorphology"}apply(t,e,n,i,s){}}class AN extends mi{constructor(){super(...arguments),this.type="feComposite"}apply(t,e,n,i,s){}}class hN extends mi{constructor(t,e,n){super(t,e,n),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(t,e,n,i,s){var{document:a,blurRadius:o}=this,h=a.window?a.window.document.body:null,f=t.canvas;f.id=a.getUniqueId(),h&&(f.style.display="none",h.appendChild(f)),Ovt(f,e,n,i,s,o),h&&h.removeChild(f)}}class dN extends mi{constructor(){super(...arguments),this.type="title"}}class fN extends mi{constructor(){super(...arguments),this.type="desc"}}var sbt={svg:yp,rect:UE,circle:N6,ellipse:k6,line:Q6,polyline:RE,polygon:H6,path:qn,pattern:z6,marker:V6,defs:G6,linearGradient:j6,radialGradient:q6,stop:K6,animate:D_,animateColor:W6,animateTransform:$6,font:X6,"font-face":J6,"missing-glyph":Y6,glyph:ME,text:iA,tspan:Dm,tref:Z6,a:tN,textPath:rN,image:nN,g:O_,symbol:iN,style:DE,use:oN,mask:Nm,clipPath:lN,filter:km,feDropShadow:cN,feMorphology:uN,feComposite:AN,feColorMatrix:NE,feGaussianBlur:hN,title:dN,desc:fN};function pN(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function obt(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?pN(Object(e),!0).forEach(function(n){lE(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):pN(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}function abt(r,t){var e=document.createElement("canvas");return e.width=r,e.height=t,e}function lbt(r){return kE.apply(this,arguments)}function kE(){return kE=eA(function*(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=document.createElement("img");return t&&(e.crossOrigin="Anonymous"),new Promise((n,i)=>{e.onload=()=>{n(e)},e.onerror=(s,a,o,h,f)=>{i(f)},e.src=r})}),kE.apply(this,arguments)}class oA{constructor(t){var{rootEmSize:e=12,emSize:n=12,createCanvas:i=oA.createCanvas,createImage:s=oA.createImage,anonymousCrossOrigin:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=t,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=t.screen,this.rootEmSize=e,this.emSize=n,this.createCanvas=i,this.createImage=this.bindCreateImage(s,a),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(t,e){return typeof e=="boolean"?(n,i)=>t(n,typeof i=="boolean"?i:e):t}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:t}=this;return t[t.length-1]}set emSize(t){var{emSizeStack:e}=this;e.push(t)}popEmSize(){var{emSizeStack:t}=this;t.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(t=>t.loaded)}isFontsLoaded(){return this.fonts.every(t=>t.loaded)}createDocumentElement(t){var e=this.createElement(t.documentElement);return e.root=!0,e.addStylesFromStyleDefinition(),this.documentElement=e,e}createElement(t){var e=t.nodeName.replace(/^[^:]+:/,""),n=oA.elementTypes[e];return typeof n<"u"?new n(this,t):new D6(this,t)}createTextNode(t){return new nbt(this,t)}setViewBox(t){this.screen.setViewBox(obt({document:this},t))}}oA.createCanvas=abt,oA.createImage=lbt,oA.elementTypes=sbt;function gN(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function bd(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?gN(Object(e),!0).forEach(function(n){lE(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):gN(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}class wd{constructor(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new R_(n),this.screen=new Om(t,n),this.options=n;var i=new oA(this,n),s=i.createDocumentElement(e);this.document=i,this.documentElement=s}static from(t,e){var n=arguments;return eA(function*(){var i=n.length>2&&n[2]!==void 0?n[2]:{},s=new R_(i),a=yield s.parse(e);return new wd(t,a,i)})()}static fromString(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=new R_(n),s=i.parseFromString(e);return new wd(t,s,n)}fork(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return wd.from(t,e,bd(bd({},this.options),n))}forkString(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return wd.fromString(t,e,bd(bd({},this.options),n))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var t=arguments,e=this;return eA(function*(){var n=t.length>0&&t[0]!==void 0?t[0]:{};e.start(bd({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},n)),yield e.ready(),e.stop()})()}start(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:e,screen:n,options:i}=this;n.start(e,bd(bd({enableRedraw:!0},i),t))}stop(){this.screen.stop()}resize(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(t,e,n)}}const cbt=Object.freeze(Object.defineProperty({__proto__:null,AElement:tN,AnimateColorElement:W6,AnimateElement:D_,AnimateTransformElement:$6,BoundingBox:Tl,CB1:BE,CB2:CE,CB3:EE,CB4:SE,Canvg:wd,CircleElement:N6,ClipPathElement:lN,DefsElement:G6,DescElement:fN,Document:oA,Element:mi,EllipseElement:k6,FeColorMatrixElement:NE,FeCompositeElement:AN,FeDropShadowElement:cN,FeGaussianBlurElement:hN,FeMorphologyElement:uN,FilterElement:km,Font:bo,FontElement:X6,FontFaceElement:J6,GElement:O_,GlyphElement:ME,GradientElement:OE,ImageElement:nN,LineElement:Q6,LinearGradientElement:j6,MarkerElement:V6,MaskElement:Nm,Matrix:LE,MissingGlyphElement:Y6,Mouse:I6,PSEUDO_ZERO:vd,Parser:R_,PathElement:qn,PathParser:nn,PatternElement:z6,Point:Hi,PolygonElement:H6,PolylineElement:RE,Property:Nr,QB1:TE,QB2:IE,QB3:FE,RadialGradientElement:q6,RectElement:UE,RenderedElement:lh,Rotate:M6,SVGElement:yp,SVGFontLoader:sN,Scale:U6,Screen:Om,Skew:PE,SkewX:R6,SkewY:O6,StopElement:K6,StyleElement:DE,SymbolElement:iN,TRefElement:Z6,TSpanElement:Dm,TextElement:iA,TextPathElement:rN,TitleElement:dN,Transform:ah,Translate:P6,UnknownElement:D6,UseElement:oN,ViewPort:T6,compressSpaces:yd,default:wd,getSelectorSpecificity:S6,normalizeAttributeName:C6,normalizeColor:E6,parseExternalUrl:bE,presets:Qvt,toNumbers:pa,trimLeft:x6,trimRight:B6,vectorMagnitude:wE,vectorsAngle:xE,vectorsRatio:U_},Symbol.toStringTag,{value:"Module"}));EA.CompareMaps=dst,EA.Config=EM,EA.Map=ast,Object.defineProperty(EA,Symbol.toStringTag,{value:"Module"})});
